[{"tags": ["haskell", "maybe"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1484777360, "post_id": 41729653, "comment_id": 70655159, "body": "Not sure why you&#39;re dealing with <code>[[Double]]</code> values. Is the inner <code>[Double]</code> supposed to represent a point in 3D space? In that case, you should define a custom data type, for more type safety. Your function would also become easier to write."}, {"owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1484777849, "post_id": 41729653, "comment_id": 70655360, "body": "@Jubobs This is for N-dimensional vectors. Custom data type is on my list of things to implement!"}], "answers": [{"comments": [{"owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "edited": false, "score": 0, "creation_date": 1484777984, "post_id": 41730415, "comment_id": 70655415, "body": "Great stuff! You have given me a lot to pore over."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1484777723, "creation_date": 1484777723, "answer_id": 41730415, "question_id": 41729653, "link": "https://stackoverflow.com/questions/41729653/how-to-maybe-ify-this-recursive-code/41730415#41730415", "title": "How to Maybe-ify this recursive code?", "body": "<p>Add a case for empty lists, turn all recursive calls into binds, and apply <code>return</code> to the final result in each equation. Thus:</p>\n\n<pre><code>cost :: [[Double]] -&gt; [[Double]] -&gt; Maybe Double\ncost [] [] = return 0\ncost [[]] [[]] = return 0\ncost ((x:xs):xss) ((y:ys):yss) = do\n    c  &lt;- cost [xs] [ys]\n    c' &lt;- cost xss yss\n    return ((x-y)^2 + c + c')\ncost _ _ = Nothing\n</code></pre>\n\n<p>However, the number of cases concerns me. You could consider writing something like this, instead:</p>\n\n<pre><code>import Control.Applicative\n\ncostBy :: (a -&gt; a -&gt; Maybe Double) -&gt; [a] -&gt; [a] -&gt; Maybe Double\ncostBy f [] [] = return 0\ncostBy f (x:xs) (y:ys) = liftA2 (+) (f x y) (costBy f xs ys)\ncostBy _ _ _ = Nothing\n\ncost' :: [[Double]] -&gt; [[Double]] -&gt; Maybe Double\ncost' = costBy (costBy (\\x y -&gt; return ((x-y)^2)))\n</code></pre>\n\n<p>Here you do not need the <code>cost [xs] [ys]</code> shenanigans to reuse code, rather using polymorphism to get the same shape-checking behavior at both the <code>[Double]</code> and <code>[[Double]]</code> layers. It is also much more clear that you have covered all the cases of interest, since you are dealing with just one layer of list-iness at a time.</p>\n"}], "owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 41730415, "answer_count": 1, "score": 0, "last_activity_date": 1484777723, "creation_date": 1484774482, "last_edit_date": 1484775599, "question_id": 41729653, "link": "https://stackoverflow.com/questions/41729653/how-to-maybe-ify-this-recursive-code", "title": "How to Maybe-ify this recursive code?", "body": "<p>I have this snippet of Haskell code that computes a cost function for least squares regression:</p>\n\n<pre><code>cost :: [[Double]] -&gt; [[Double]] -&gt; Double\ncost [[]] [[]] = 0\ncost ((x:xs):xss) ((y:ys):yss) = (x-y)^2 + cost [xs] [ys] + cost xss yss\ncost _ _ = 0\n\nprint (cost [[1,2,3],[4,5,6]] [[1,3,3],[4,6,6]]) -- 2.0\n</code></pre>\n\n<p>This works fine, but now I'd like to have a return type of <code>Maybe Double</code>. How could I do that? Let's say the last case <code>cost _ _ = Nothing</code>. The result should be <code>Just 2.0</code> for the inputs given here.</p>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation", "coq", "state-monad"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1484775352, "post_id": 41728797, "comment_id": 70654203, "body": "The trick works in Haskell because the two bindings in the <code>let</code> expression are mutually recursive. IDK how it works in Coq but I&#39;m guessing there&#39;s some sort of <code>mutual</code> keyword?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1484783952, "post_id": 41728797, "comment_id": 70657432, "body": "You will also need to prove termination using a well-founded relation. I&#39;m not sure if that is possible here without also taking some kind of additional (proof?) argument in <code>bind</code> (maybe the particular well-founded relation to use)."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1484815643, "creation_date": 1484815643, "answer_id": 41737382, "question_id": 41728797, "link": "https://stackoverflow.com/questions/41728797/the-reverse-state-monad-in-coq/41737382#41737382", "title": "The reverse state monad in Coq", "body": "<p>Assume <code>g :: s -&gt; s</code>. Consider</p>\n\n<pre><code>sf :: RState s s\nsf = get = \\s -&gt; (s, s)\n\nf :: s -&gt; RState s s\nf = put . g = \\a _ -&gt; ((), g a)\n</code></pre>\n\n<p>We get:</p>\n\n<pre><code>bind sf f = \\s -&gt;\n  let (a, s'') = sf s'\n      (b, s') = f a s\n  in (b, s'')\n          = \\s -&gt;\n  let (a, s'') = (s', s')\n      (b, s') = ((), g a)\n  in (b, s'')\n          = \\s -&gt;\n  let (b, s') = ((), g s')\n  in (b, s')\n          = \\s -&gt;\n  let s' = g s' in ((), s')\n</code></pre>\n\n<p>This involves computing a fixed point for <code>g</code>, which is in general impossible in Coq due to the possible lack of termination.</p>\n\n<p>As David Young mentions above, if something like <code>bind</code> is doable in Coq, it must be enhanced with proof terms proving that this recursion terminates. This enhancement is non-trivial.</p>\n"}, {"tags": [], "owner": {"reputation": 5031, "user_id": 304284, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Bk5V3.jpg?s=128&g=1", "display_name": "larsr", "link": "https://stackoverflow.com/users/304284/larsr"}, "is_accepted": false, "score": 0, "last_activity_date": 1484911097, "last_edit_date": 1484911097, "creation_date": 1484868862, "answer_id": 41753646, "question_id": 41728797, "link": "https://stackoverflow.com/questions/41728797/the-reverse-state-monad-in-coq/41753646#41753646", "title": "The reverse state monad in Coq", "body": "<p><code>bind</code> needs a proof that the functions will actually return.  If you add an argument <code>H</code> with a type to this effect that depends on the actual <code>sf</code>, <code>f</code>, and <code>s</code> values, you can then extract the desired <code>(b, s'')</code> pair from that \"certified\" term <code>H</code>.</p>\n\n<p>Note that <em>how to actually compute</em> the <code>sf</code> and <code>f</code> functions has to be explained in the construction of <code>H</code>, for the particular <code>sf</code>, <code>f</code>, and <code>s</code>.</p>\n\n<p>(There might be other/better ways of achieveing this. Hopefully someone else can add to this thread.)</p>\n\n<pre><code>Definition RState (S A : Type) : Type := S -&gt; A * S.\n\nSection Bind.\n  Variables S A B:Type.\n\n  (* define a type that a proof should have *)\n  Definition sf_f_s_are_ok (sf : RState S A) (f : A -&gt; RState S B) (s:S) :=\n    {x | exists a s'' b s', x = (a, s'', b, s') /\\\n         (a, s'') = sf s' /\\ (b, s') = f a s}.\n\n  (* bind just returns the values we were interested in *)\n  Definition bind sf f (s:S) (H : sf_f_s_are_ok sf f s) :=\n    match H with exist _ (a, s'', b, s') _ =&gt; (b, s'') end.\n\n  (* make sure bind is ok *)\n  Lemma bind_is_ok: forall sf f s H b s'',\n      bind sf f s H = (b, s'') -&gt; exists a s', (a,s'') = sf s' /\\ (b,s') = f a s.\n  Proof.\n    intros sf f s [[[[a s''0] b0] s'] [a0 [b1 [s'0 [s''1 [Ha [Hb Hc]]]]]]] b s'' H0.\n    simpl in H0; generalize H0 Ha Hb Hc; do 4 inversion 1; subst; eauto.\n  Qed.\nEnd Bind.\n</code></pre>\n"}], "owner": {"reputation": 1315, "user_id": 3780931, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7ed60a7e72a67346cacc5173dd359c65?s=128&d=identicon&r=PG&f=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/3780931/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 251, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1484911097, "creation_date": 1484771043, "question_id": 41728797, "link": "https://stackoverflow.com/questions/41728797/the-reverse-state-monad-in-coq", "title": "The reverse state monad in Coq", "body": "<p>In Haskell, the following definition of bind is accepted:</p>\n\n<pre><code>type RState s a = s -&gt; (a, s)\n\nbind :: RState s a -&gt; (a -&gt; RState s b) -&gt; RState s b \nbind sf f = \\s -&gt;\n  let (a, s'') = sf s'\n      (b, s') = f a s\n  in (b, s'')\n</code></pre>\n\n<p>How can I get a similar definition accepted by Coq?\nMy attempt is:</p>\n\n<pre><code>Definition RState (S A : Type) : Type := S -&gt; A * S.\n\nDefinition bind (S A B : Type) (sf : RState S A) (f : A -&gt; RState S B) : RState S B :=\n  fun s =&gt;\n    let (a, s'') := sf s' in\n    let (b, s') := f a s in\n    (b, s'').\n</code></pre>\n\n<p>But it fails with the following error message:</p>\n\n<pre><code>Error: The reference s' was not found in the current environment.\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1484770200, "post_id": 41728190, "comment_id": 70651519, "body": "is it not possible for your data types to &#39;derive&#39; bifunctor (like they can do with standard functors?)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484771797, "post_id": 41728190, "comment_id": 70652301, "body": "You ask how to deduplicate, but then don&#39;t show any duplication. Perhaps you can say a bit more about what repetition you are trying to cut out on."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484860677, "post_id": 41728190, "comment_id": 70696237, "body": "Yeah; I don&#39;t think I&#39;m really sure of what I&#39;m asking either; this can probably be closed. I ended up just defining a few type aliases and dealing with the repetition."}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484770287, "post_id": 41728578, "comment_id": 70651564, "body": "Thanks; I&#39;m aware of GeneralizedNewtypeDeriving; this works of course, but now the unpacking is <code>Range (a, b)</code> for type CrdRange; which still has the name mismatch and adds in the redundant brackets as well. Definitely functional; but not ideal."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 2, "last_activity_date": 1484770329, "last_edit_date": 1484770329, "creation_date": 1484770227, "answer_id": 41728578, "question_id": 41728190, "link": "https://stackoverflow.com/questions/41728190/maintaining-expressiveness-through-type-aliases-how-much-should-i-use-type-alia/41728578#41728578", "title": "Maintaining expressiveness through type aliases (How much should I use type aliases?)", "body": "<p>The first thing that comes to mind is <code>GeneralizedNewtypeDeriving</code></p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Data.Bifunctor\n\nnewtype Coord a b = Coord (a,b) deriving Bifunctor\nnewtype Range a b = Range (a,b) deriving Bifunctor\n\ntype CrdRange = Range (Coord Int Int) (Coord Int Int)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1484788327, "last_edit_date": 1484788327, "creation_date": 1484777288, "answer_id": 41730326, "question_id": 41728190, "link": "https://stackoverflow.com/questions/41728190/maintaining-expressiveness-through-type-aliases-how-much-should-i-use-type-alia/41730326#41730326", "title": "Maintaining expressiveness through type aliases (How much should I use type aliases?)", "body": "<p>If you are working with the <strong>lens</strong> or <a href=\"http://hackage.haskell.org/package/microlens\" rel=\"nofollow noreferrer\"><strong>microlens</strong></a> libraries, perhaps you could define lenses/traversals of the form <code>coordToTuple :: Traversal' Coord (Int,Int)</code> and then use the <a href=\"http://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Setter.html#v:over\" rel=\"nofollow noreferrer\"><code>over</code></a> function like <code>over coordToTuple (first someFunction) someCoord</code>.</p>\n\n<hr>\n\n<p>To avoid having to remember the names of multiple lenses, you could define a multi-parameter typeclass like</p>\n\n<pre><code>class MonoPair c a | c -&gt; a where\n    monoPair :: Traversal' c (a,a)\n</code></pre>\n\n<p>and define instances for your types.</p>\n\n<hr>\n\n<p>Alternative idea: define your types as newtypes around <a href=\"http://hackage.haskell.org/package/linear-1.20.5/docs/Linear-V2.html#t:V2\" rel=\"nofollow noreferrer\"><code>V2</code></a> from <strong>linear</strong>. This only makes sense if your types behave like vectors. <code>V2</code> is not a bifunctor, but you can use <code>GeneralizeNewtypeDeriving</code> to derive the <a href=\"http://hackage.haskell.org/package/linear-1.20.5/docs/Linear-V2.html#t:R1\" rel=\"nofollow noreferrer\"><code>R1</code></a> and <code>R2</code> typeclasses for getting/setting components. </p>\n\n<p>To avoid awkward parentheses while pattern-matching, define auxiliary <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#pattern-synonyms\" rel=\"nofollow noreferrer\">pattern synonyms</a> like</p>\n\n<pre><code>pattern CoordV2 x y = Coord (V2 x y)\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1484788327, "creation_date": 1484768897, "last_edit_date": 1495540915, "question_id": 41728190, "link": "https://stackoverflow.com/questions/41728190/maintaining-expressiveness-through-type-aliases-how-much-should-i-use-type-alia", "title": "Maintaining expressiveness through type aliases (How much should I use type aliases?)", "body": "<p>this is mostly a stylistic question (so perhaps not the best for SO; but I don't know of anywhere else to ask);</p>\n\n<p>In my problem space I've noticed that many of my Data-structures represent Bifunctors; in many cases they're Bifunctors over a single specific type. For example:</p>\n\n<pre><code>data Coord = Coord Int Int\ndata Range = Range Coord Coord\n</code></pre>\n\n<p>etc.</p>\n\n<p>I've found it useful to map over the components of these using <code>first, second</code> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Bifunctor.html#t:Bifunctor\" rel=\"nofollow noreferrer\">Bifunctor</a>; this of course requires me to define them as Bifunctors:</p>\n\n<pre><code>data Coord a b = Coord a b\ninstance Bifunctor Coord where ...\ndata Range a b = Range a b\ninstance Bifunctor Range where ...\n</code></pre>\n\n<p>I've found several such cases where the types have the exact same structure; essentially <code>Pair a = Pair a a</code> (or even the tuple (a, a) where the data is a pair of two elements of the same type. It seems unfortunate to me that in order to benefit from Bifunctor (and all its associated helpers and lenses) I need to now specify <code>Range Coord Coord</code> as all of my types; so I've started using type aliases <code>type Range = Pair Coord Coord</code> and <code>type Coord = Pair Int Int</code>; this allows me to not have a bunch of redundant definitions; however when pattern matching each case is now the non-descriptive <code>f (Pair a b) = ...</code> where I gain no knowledge about what is inside.</p>\n\n<p>I've learned through reading <a href=\"https://stackoverflow.com/questions/19649967/how-do-i-define-a-data-type-that-only-accepts-numbers\">this informative answer</a> that types themselves shouldn't impose restrictions on what they contain; so I suppose I'm okay with having something like <code>data Range a b = Range a b</code>,</p>\n\n<p>I suppose my question boils down to; is there an established way to handle deduplication over similar data-structures while still maintaining the expressiveness of good type names/aliases?</p>\n\n<p>Right now I have:</p>\n\n<pre><code>data Range a b = Range a b\ntype CrdRange = Range Coord Coord\n</code></pre>\n\n<p>But I don't love that the type is <code>CrdRange</code> but it's unpacked with <code>Range</code> instead of <code>CrdRange</code>.</p>\n\n<p>Note that I also do have one or two special instances as well; for instance I have a special <code>instance Ord Coord</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1484767021, "post_id": 41727562, "comment_id": 70649726, "body": "I think if you name and give a type to your <code>StateT</code> value it may make the issue clearer. <code>return (putStrLn ...)</code> is returning an action that <i>when evaluated</i> will print something, but then you throw it away when you use <code>&gt;&gt;</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484767331, "post_id": 41727562, "comment_id": 70649911, "body": "That is, <code>evalStateT ... zeroState</code> has type <code>Monad m =&gt; m (IO ())</code>; it needs to have type <code>IO ()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1484769154, "post_id": 41728114, "comment_id": 70650904, "body": "I don&#39;t think this is what OP intended to do. What he wants is use <code>IO</code> from within <code>StateT s IO a</code>, and not return a <code>IO</code> value and then execute it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1484769995, "post_id": 41728114, "comment_id": 70651412, "body": "Type-wrangling aside, I&#39;m not sure I see the difference. I guess he could use <code>Debug.Trace.trace</code> instead of <code>putStrLn</code>?"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1484770406, "post_id": 41728114, "comment_id": 70651631, "body": "The difference is, that OP tries to understand Monad transformers and your solution doesn&#39;t even use the transformer part. You could just as well replace <code>StateT s IO</code> with <code>State s</code> in your code. And <code>trace</code> isn&#39;t something you want to use outside of debugging (if you were serious about that)."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1484768648, "creation_date": 1484768648, "answer_id": 41728114, "question_id": 41727562, "link": "https://stackoverflow.com/questions/41727562/haskell-no-output-from-within-statet-monad/41728114#41728114", "title": "Haskell - no output from within StateT monad", "body": "<p>The simplest fix is to use <code>join</code> to reduce the <code>IO (IO ())</code> value returned by <code>evalStateT</code> to a <code>IO ()</code> value.</p>\n\n<pre><code>foo :: IO ()\nfoo = \n        (join (evalStateT ( StateT $ \n                   \\s -&gt; \n                   let (v, newrng) = roll $ rng s in \n                         return (putStrLn $ show v, \n                                 s { rng = newrng })\n        ) zeroState) &gt;&gt;\n        putStrLn \"See you soon.\"\n</code></pre>\n\n<p>A more complicated, but cleaner, fix is to make sure you don't introduce a new <code>IO</code> action in the state itself, but simply include a string which you wrap yourself.</p>\n\n<pre><code>foo :: IO ()\nfoo = \n        evalStateT ( StateT $ \n                   \\s -&gt; \n                   let (v, newrng) = roll $ rng s in \n                         return (show v, s { rng = newrng })\n        ) zeroState &gt;&gt;= putStrLn &gt;&gt;\n        putStrLn \"See you soon.\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 3, "last_activity_date": 1484769674, "last_edit_date": 1484769674, "creation_date": 1484768684, "answer_id": 41728130, "question_id": 41727562, "link": "https://stackoverflow.com/questions/41727562/haskell-no-output-from-within-statet-monad/41728130#41728130", "title": "Haskell - no output from within StateT monad", "body": "<p>Your problem is, that you seem to have mistaken the type of <code>StateT</code> for <code>(m a, s) -&gt; StateT s m a</code>, when actually it is <code>m (a, s) -&gt; StateT s m a</code>. That is the <code>m</code> is outside and not inside of the tuple. That is why you had to use <code>return</code>, to return something of type <code>IO (a,GlobalState)</code>. What you have to do instead is something along the lines of <code>putStrLn (show v) &gt;&gt; return ((),s {rng = newrng})</code>. Like this:</p>\n\n<pre><code>import Control.Monad.Trans.State\nimport System.Random\n\ndata GlobalState = GlobalState {\n                   rng :: StdGen \n                 }\n\nfoo :: IO ()\nfoo = evalStateT (StateT $ \n        \\s -&gt; let (v, newrng) = roll $ rng s in \n          putStrLn (show v) &gt;&gt;\n          return ((),s { rng = newrng })\n      ) zeroState &gt;&gt;\n      putStrLn \"See you soon.\"\n\nzeroState :: GlobalState\nzeroState = GlobalState {\n            rng = mkStdGen 0\n          }\n\nroll :: StdGen -&gt; (Int, StdGen)\nroll gen = randomR (1, 6) gen\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 3, "last_activity_date": 1484769335, "creation_date": 1484769335, "answer_id": 41728319, "question_id": 41727562, "link": "https://stackoverflow.com/questions/41727562/haskell-no-output-from-within-statet-monad/41728319#41728319", "title": "Haskell - no output from within StateT monad", "body": "<p>In my humble opinion, monad transformers are easier to work with if you use the mtl typeclasses. This also leads to more general code since it doesn't tie you to any concrete data type. Also, I would recommend usually separating the \"what to do\" part from the \"run\" part. I've rewritten your code to hopefully demonstrate what I mean: </p>\n\n<pre><code>import System.Random\nimport Control.Monad.State\n\ndata GlobalState = GS { rng :: StdGen }\n\nzeroState = GS { rng = mkStdGen 0 }\n\nroll :: StdGen -&gt; (Int,StdGen)\nroll = randomR (1,6)\n\n-- works with any concrete monad m that supplies IO and GlobalState state\nfoo :: (MonadIO m, MonadState GlobalState m) =&gt; m () \nfoo = do\n  (v,gen) &lt;- gets (roll . rng)\n  liftIO $ print v\n  put $ GS gen\n\n -- commit to StateT here\n evalFoo :: IO ()\n evalFoo = evalStateT foo zeroState\n</code></pre>\n\n<p>The benefit is that <code>foo</code> is now reusable. For example, if we wanted to roll multiple times:</p>\n\n<pre><code> evalFooN :: Int -&gt; IO ()\n evalFooN n = evalStateT (replicateM_ n foo) zeroState\n</code></pre>\n"}], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 41728319, "answer_count": 3, "score": 3, "last_activity_date": 1484770487, "creation_date": 1484766667, "last_edit_date": 1484770487, "question_id": 41727562, "link": "https://stackoverflow.com/questions/41727562/haskell-no-output-from-within-statet-monad", "title": "Haskell - no output from within StateT monad", "body": "<p>Trying to familiarize myself with monad transformers, I wrote the following piece of code:</p>\n\n<pre><code>data GlobalState = GlobalState {\n        rng :: StdGen \n}\n\nfoo :: IO ()\nfoo = \n        evalStateT ( StateT $ \n                   \\s -&gt; \n                   let (v, newrng) = roll $ rng s in \n                         return (putStrLn $ show v, \n                                 s { rng = newrng })\n        ) zeroState &gt;&gt;\n        putStrLn \"See you soon.\"\n\nzeroState :: GlobalState\nzeroState = GlobalState {\n        rng = mkStdGen 0\n}\n\nroll :: StdGen -&gt; (Int, StdGen)\nroll gen = randomR (1, 6) gen\n</code></pre>\n\n<p>The idea was to initialize state, use it for an IO action and return back to plain IO afterwards. Something, however, goes wrong and only \"See you soon\" gets printed, <code>putStrLn $ show v</code> produces no output. </p>\n\n<p>So the question is: how do I fix it and, most importantly, <strong>why</strong> doesn't it print anything?</p>\n\n<p>Edit: thank you everyone for your answers, they help a lot.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1484765126, "post_id": 41726929, "comment_id": 70648689, "body": "What exactly is unclear?"}], "answers": [{"comments": [{"owner": {"reputation": 448, "user_id": 4339476, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7af53c0293141e765d27609212eb131f?s=128&d=identicon&r=PG&f=1", "display_name": "Gallaoui", "link": "https://stackoverflow.com/users/4339476/gallaoui"}, "edited": false, "score": 0, "creation_date": 1484770903, "post_id": 41727204, "comment_id": 70651876, "body": "and whts the difference please when we use length = foldr (\\x n -&gt; n + 1) 0 ?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 448, "user_id": 4339476, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7af53c0293141e765d27609212eb131f?s=128&d=identicon&r=PG&f=1", "display_name": "Gallaoui", "link": "https://stackoverflow.com/users/4339476/gallaoui"}, "edited": false, "score": 0, "creation_date": 1484771192, "post_id": 41727204, "comment_id": 70652028, "body": "If you use <code>foldr (\\_ n -&gt; n + 1) 0 list</code>, you don&#39;t need to first map to a list of the value <code>1</code>, since your lambda ignores the value in the list and sums a hardcoded <code>1</code>."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 5, "last_activity_date": 1484765399, "creation_date": 1484765399, "answer_id": 41727204, "question_id": 41726929, "link": "https://stackoverflow.com/questions/41726929/foldr-further-explanation-and-example-with-a-map-function/41727204#41727204", "title": "foldr - further explanation and example with a map function", "body": "<p><code>(map (\\x -&gt;1) list)</code> takes the list and turns it into a list of <code>1</code> values:</p>\n\n<pre><code>(map (\\x -&gt;1) [\"a\", \"b\", \"c\"]) == [1, 1, 1]\n</code></pre>\n\n<p>Now, if you substitute that in the original foldr, it looks like this:</p>\n\n<pre><code>foldr (+) 0 [1, 1, 1]\n</code></pre>\n\n<p>The starting point is <code>0</code> and the aggregation function is <code>(+)</code>. As it steps through each element in the list, you are basically adding up all the <code>1</code> values, and that's how you end up returning the length.</p>\n\n<p><code>foldr</code> starts from the right and works back to the head of the list. <code>foldl</code> starts from the left and works through the list. Because the aggregation function is <code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code>, the ordering of the left and right arguments in <code>(+)</code> is logically inconsequential (with the caveat that <code>foldl</code> has stack overflow problems with large lists because of lazy evaluation)</p>\n"}], "owner": {"reputation": 448, "user_id": 4339476, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7af53c0293141e765d27609212eb131f?s=128&d=identicon&r=PG&f=1", "display_name": "Gallaoui", "link": "https://stackoverflow.com/users/4339476/gallaoui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 41727204, "answer_count": 1, "score": -1, "last_activity_date": 1484765399, "creation_date": 1484764400, "last_edit_date": 1484764501, "question_id": 41726929, "link": "https://stackoverflow.com/questions/41726929/foldr-further-explanation-and-example-with-a-map-function", "title": "foldr - further explanation and example with a map function", "body": "<p>I've looked at different folds and folding in general as well as a few others and they explain it fairly well.</p>\n\n<p>I'm still having trouble on how  it would work in this case.</p>\n\n<pre><code>length :: [t] -&gt; Int\nlength list = foldr (+) 0 (map (\\x -&gt;1) list)\n</code></pre>\n\n<p>Could someone go through that step by step and try to explain that to me.</p>\n\n<p>And also how would foldl work as well.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1484759405, "post_id": 41723655, "comment_id": 70645467, "body": "Arbitrary example: the applicative instance of <code>State</code> can be used to <a href=\"http://stackoverflow.com/a/41523456/2751851\">implement <code>mapAccumL</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 3, "last_activity_date": 1484756631, "creation_date": 1484756631, "answer_id": 41724433, "question_id": 41723655, "link": "https://stackoverflow.com/questions/41723655/applicative-instances-for-reader-writer-and-state/41724433#41724433", "title": "Applicative instances for Reader, Writer and State", "body": "<p>Every time you use the <code>foo &lt;$&gt; bar &lt;*&gt; baz</code> idom with monadic functions <code>bar</code> and <code>baz</code>, you are using a Monad in an applicative way. This is not a very deep use of <code>Applicative</code>, but rather a convenient way of writing a bit of code, and independent of the <code>Monad</code> \u2013 and hence you will find this style also for <code>Reader</code>, <code>Writer</code> and <code>State</code>.</p>\n"}], "owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "closed_date": 1484780439, "answer_count": 1, "score": 0, "last_activity_date": 1484756631, "creation_date": 1484754503, "question_id": 41723655, "link": "https://stackoverflow.com/questions/41723655/applicative-instances-for-reader-writer-and-state", "closed_reason": "Needs more focus", "title": "Applicative instances for Reader, Writer and State", "body": "<p>I understand applicative vs monad style of programming, but most articles discuss this distinction with \"simple\" monads like <code>Maybe</code>. </p>\n\n<p>But what about monads like <code>Reader</code>, <code>Writer</code> and <code>State</code>. Are there pracrical examples of using them in applicative way? </p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1484754489, "post_id": 41721096, "comment_id": 70642034, "body": "This seems pretty short and simple to me. What exactly is the problem with this approach?"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1484819703, "post_id": 41721096, "comment_id": 70670574, "body": "@jkeuhlen let&#39;s say I have 100 different routes and I want to add the header to them all. I have to write an intercepter function for all those routes. and if I want to change the header I must modify all 100 functions."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484820355, "post_id": 41721096, "comment_id": 70670995, "body": "I&#39;m not familiar with snap, but can&#39;t you just define <code>apiRoutes = map (second (modifyResponse \u2026 *&gt;)) [(&quot;status&quot;, otherHandler)]</code>?"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484821074, "post_id": 41721096, "comment_id": 70671414, "body": "@sjakobi sounds like an excelenet idea. I will try it out."}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484822592, "post_id": 41721096, "comment_id": 70672435, "body": "@sjakobi I fugured it out with your hint. I sometimes completely forget about the tools that haskell provide. Thank you"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1484835527, "post_id": 41721096, "comment_id": 70680732, "body": "@miladzahedi If you figured out the problem on your own, you should write up (and accept) your own answer. That way people in the future with this problem can see what your solution was."}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1485013817, "post_id": 41721096, "comment_id": 70752702, "body": "@jkeuhlen Ok, will do."}], "answers": [{"tags": [], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "is_accepted": true, "score": 1, "last_activity_date": 1485014128, "creation_date": 1485014128, "answer_id": 41781369, "question_id": 41721096, "link": "https://stackoverflow.com/questions/41721096/add-a-header-to-all-responses-in-snap-framework/41781369#41781369", "title": "add a header to all responses in snap framework", "body": "<p>With the hint that sjakobi provided I figured it out. This can be done like:</p>\n\n<pre><code>apiRoutes :: [(ByteString, Handler b Api ())]\napiRoutes = map (mapSecond (addHeaders &gt;&gt;))\n[(\"status\",  addHeader)]\n\n\naddHeaders :: Handler b Api ()\naddHeaders = do\n   modifyResponse (setHeader \"Content-Type\" \"application/json\")\n   modifyResponse (setHeader \"more-header\" \"more-header\")\n\nmapSecond :: (b -&gt; c) -&gt; (a,b) -&gt; (a,c)\nmapSecond f (a,b) = (a,f b)\n</code></pre>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 41781369, "answer_count": 1, "score": 0, "last_activity_date": 1485014128, "creation_date": 1484747128, "last_edit_date": 1484819785, "question_id": 41721096, "link": "https://stackoverflow.com/questions/41721096/add-a-header-to-all-responses-in-snap-framework", "title": "add a header to all responses in snap framework", "body": "<p>The title sums it up. I want add a header to all my responses in snap. \nI can add a modifyRequest handler for each of my routes like :</p>\n\n<pre><code>apiRoutes :: [(ByteString, Handler b Api ())]\napiRoutes = [(\"status\",  addHeader)]\n\n\naddHeader :: Handler b Api ()\naddHeader = do\n   modifyResponse (setHeader \"Content-Type\" \"application/json\")\n   otherHandler\n\notherHandler :: Handler b Api ()\notherHandler = metod Get doActualStuff &lt;|&gt; metod Get doMoreActualStuff\n</code></pre>\n\n<p>Now if I have 100 different routes and I want to add the header to them all. I have to write an intercepter function for all those routes. and if I want to change the header I must modify all 100 intercepter functions.</p>\n\n<p>Is there a short simple way ?</p>\n"}, {"tags": ["haskell", "scotty", "haskell-wai"], "answers": [{"tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 3, "last_activity_date": 1485647493, "last_edit_date": 1485647493, "creation_date": 1484854070, "answer_id": 41750102, "question_id": 41720611, "link": "https://stackoverflow.com/questions/41720611/haskell-scotty-set-custom-headers-x-frame-options/41750102#41750102", "title": "Haskell-Scotty: Set custom headers (x-frame-options)", "body": "<p>You can define your own middleware that adds this header to each response (all the tools neccesary are available in <a href=\"https://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html\" rel=\"nofollow noreferrer\"><code>Network.Wai</code></a>):</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wai -- from the wai package\nimport Web.Scotty hiding (options)\n\naddFrameHeader :: Middleware\naddFrameHeader =\n  modifyResponse (mapResponseHeaders ((\"X-Frame-Options\", \"whatever\") :))\n</code></pre>\n\n<p>Then use it in your scotty application:</p>\n\n<pre><code>main = scotty 6000 $ do\n  middleware addFrameHeader\n  get \"/\" (text \"hello\")\n</code></pre>\n\n<p>And with <code>curl</code> we can see that it is included in the response:</p>\n\n<pre><code>&gt; curl --include localhost:6000\nHTTP/1.1 200 OK\nTransfer-Encoding: chunked\nDate: Thu, 19 Jan 2017 19:22:57 GMT\nServer: Warp/3.2.8\nX-Frame-Options: whatever\nContent-Type: text/plain; charset=utf-8\n\nhello\n</code></pre>\n"}], "owner": {"reputation": 520, "user_id": 3686036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcf20c850db8655cfa7d533dfce324b1?s=128&d=identicon&r=PG", "display_name": "afcastano", "link": "https://stackoverflow.com/users/3686036/afcastano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 41750102, "answer_count": 1, "score": 3, "last_activity_date": 1485647493, "creation_date": 1484745772, "last_edit_date": 1484860214, "question_id": 41720611, "link": "https://stackoverflow.com/questions/41720611/haskell-scotty-set-custom-headers-x-frame-options", "title": "Haskell-Scotty: Set custom headers (x-frame-options)", "body": "<p>Haskell newbie here!</p>\n\n<p>In my haskell side project, I am using scotty to serve some dynamically generated html pages. The problem is that the pages can not be opened inside an iframe, due to the \"x-frame-options\" header set to \"SAMEORIGIN\".</p>\n\n<p>How can I change that header to something different? I'd like to set that header for all responses. Is there a Middleware that can do that?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "clipboard"], "comments": [{"owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "edited": false, "score": 0, "creation_date": 1484816848, "post_id": 41715075, "comment_id": 70668714, "body": "More info: I have installed the only dependency listed on hackage (<code>libxrandr-dev</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "is_accepted": true, "score": 0, "last_activity_date": 1484817411, "creation_date": 1484817411, "answer_id": 41737928, "question_id": 41715075, "link": "https://stackoverflow.com/questions/41715075/setclipboardstring-from-system-clipboard-is-not-working/41737928#41737928", "title": "setClipboardString from System.Clipboard is not working", "body": "<p>Tried another library - <a href=\"https://hackage.haskell.org/package/Hclip-3.0.0.4/docs/System-Hclip.html\" rel=\"nofollow noreferrer\">HClip</a> (with <code>xclip</code>) and its <code>setClipboard</code> is working as intended.</p>\n\n<p>PS: I am using CopyQ and IDEA which may be interfering with clipboard operations.</p>\n"}], "owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 41737928, "answer_count": 1, "score": 0, "last_activity_date": 1484817411, "creation_date": 1484730082, "question_id": 41715075, "link": "https://stackoverflow.com/questions/41715075/setclipboardstring-from-system-clipboard-is-not-working", "title": "setClipboardString from System.Clipboard is not working", "body": "<p><code>setClipboardString</code> and <code>modifyClipboardString</code> are not changing clipboard for me (reading clipboard is fine). I am trying it on KDE (Kubuntu 16.04).</p>\n\n<p>Is there something special required to make it work or is there some other way of accessing clipboard?</p>\n"}, {"tags": ["haskell", "haddock"], "comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1484745769, "post_id": 41714826, "comment_id": 70635708, "body": "I thought you could use Named chunks of documentation ( <a href=\"https://www.haskell.org/haddock/doc/html/ch03s05.html\" rel=\"nofollow noreferrer\">haskell.org/haddock/doc/html/ch03s05.html</a> ) for that (I never did, but I sometimes see haddock complain when I comment out a dollar, as in &quot;-- $ foo&quot;).  You can define a name for a chunk, but appatently only use it in the export list, and it must be at the beginng of a comment."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1484756649, "post_id": 41714826, "comment_id": 70643536, "body": "If the functions are closely related it might be better to not duplicate the documentation, and instead refer the reader to the documentation for the other function. Then if they differ only by types the reader will see one description and two functions with slightly different type signatures."}], "answers": [{"comments": [{"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1484773333, "post_id": 41729304, "comment_id": 70653175, "body": "yes, it seems that only way to reference doc is to do <code>-- | See &#39;function_name&#39;</code>, may be we can extend answer with this example"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 2, "last_activity_date": 1484773916, "last_edit_date": 1484773916, "creation_date": 1484773090, "answer_id": 41729304, "question_id": 41714826, "link": "https://stackoverflow.com/questions/41714826/how-to-reduce-documentation-duplication-using-haddock/41729304#41729304", "title": "How to reduce documentation duplication using Haddock", "body": "<p>Unfortunately, it is not possible for function declarations to have reusable documentation with Haddock at the moment. Here is an <a href=\"https://github.com/haskell/haddock/issues/97\" rel=\"nofollow noreferrer\">issue</a> tracking this.</p>\n\n<p>The <code>-- $chunk_name</code> documentation <a href=\"https://www.haskell.org/haddock/doc/html/ch03s05.html\" rel=\"nofollow noreferrer\">chunk naming</a> is only available for module documentation, i.e for the export section. This is only handy for moving documentation from the top of the module to the bottom to reduce the clutter.</p>\n\n<p>Common workarounds for this problem are:</p>\n\n<ul>\n<li>make sure the similar function is in scope an add this to documentation:\n<code>\n-- | See `functionName`.\nOR\n-- | See 'functionName'.\n</code></li>\n<li>or manually copy and paste documentation if it is small enough, similarly how it is done in <code>bytestring</code> and <code>vector</code> packages.</li>\n</ul>\n"}], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 41729304, "answer_count": 1, "score": 4, "last_activity_date": 1484773916, "creation_date": 1484729248, "last_edit_date": 1484731639, "question_id": 41714826, "link": "https://stackoverflow.com/questions/41714826/how-to-reduce-documentation-duplication-using-haddock", "title": "How to reduce documentation duplication using Haddock", "body": "<p>I have two very similar functions and both need exactly the same documentation. Is there a way in Haddock to avoid comment duplication?</p>\n\n<p>I could not find description of this feature in Haddock documentation, but I guess there is a way to do so.</p>\n\n<p>For instance in Javadoc there is <code>{@inheritDoc}</code> and <code>@see SomeClass#someMethod()</code>. What about Haddock?</p>\n"}, {"tags": ["haskell", "http-headers"], "comments": [{"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1484747637, "post_id": 41712212, "comment_id": 70636990, "body": "A nice trick is to factor out the function, give it a name and an <code>undefined</code> body and have ghci confirm the type. You could also use <code>:i</code> e.g. for finding out what <code>BodyReader</code> or <code>ResponseHeaders</code> are and where they&#39;re from. (Not that you would need the former for now, as <code>responseHeaders</code> accepts any Response content via <code>body</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1484790995, "post_id": 41715860, "comment_id": 70659289, "body": "Thanks, @Michael Snoyman.  I see from that pattern how I can go nuts on my debug and do:   <code>withResponse req man $ (\\x -&gt; do    (print . responseStatus) x   (print . responseHeaders) x )</code> etc.  Thank you!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1484732279, "creation_date": 1484732279, "answer_id": 41715860, "question_id": 41712212, "link": "https://stackoverflow.com/questions/41712212/haskell-network-http-client-withresponse-headers/41715860#41715860", "title": "Haskell Network.HTTP.Client withResponse headers", "body": "<p>You can use the <a href=\"https://www.stackage.org/haddock/lts-7.16/http-client/Network-HTTP-Client.html#v:responseHeaders\" rel=\"nofollow noreferrer\"><code>responseHeaders</code></a> accessor functor. You had the right intuition with the type signature. In fact, <a href=\"https://www.stackage.org/lts-7.16/hoogle?q=Response+body+-%3E+ResponseHeaders\" rel=\"nofollow noreferrer\">searching for that type signature on Stackage's Hoogle yields this function at the first result</a>.</p>\n\n<p>With your original code, you're looking for something like:</p>\n\n<pre><code>withResponse req man $ print . responseHeaders\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 41715860, "answer_count": 1, "score": 0, "last_activity_date": 1484732279, "creation_date": 1484718415, "question_id": 41712212, "link": "https://stackoverflow.com/questions/41712212/haskell-network-http-client-withresponse-headers", "title": "Haskell Network.HTTP.Client withResponse headers", "body": "<p>I'm using <code>Network.HTTP.Client</code> and trying to read headers of a streaming response.</p>\n\n<p>I see <a href=\"https://hackage.haskell.org/package/http-client-0.5.5/docs/Network-HTTP-Client.html#v:withResponse\" rel=\"nofollow noreferrer\">from documentation</a> that the type signature is:</p>\n\n<pre><code>withResponse :: Request -&gt; Manager -&gt; (Response BodyReader -&gt; IO a) -&gt; IO a \n</code></pre>\n\n<p>Defined as:</p>\n\n<pre><code>withResponse req man f = bracket (responseOpen req man) responseClose f\n</code></pre>\n\n<p>And I'm trying to correctly define (\\f -> do stuff) to be able to just show all the headers in the response.</p>\n\n<pre><code>getheaders ::  String -&gt; IO ()\ngetheaders url = do\n  man &lt;- newManager tlsManagerSettings\n  req' &lt;- parseUrlThrow url\n  putStrLn url\n  let req = req' { responseTimeout = Just 1000000}\n  withResponse req man $ (\\res -&gt; do\n    (r _) &lt;- res\n    putStrLn $ show r\n    )\n</code></pre>\n\n<p>I understand \\res is actually:</p>\n\n<pre><code>(Response BodyReader -&gt; IO a) \n</code></pre>\n\n<p>How can I extract the headers from that?</p>\n\n<pre><code>responseHeaders :: Response body -&gt; ResponseHeaders\n</code></pre>\n\n<p>Any tips also on how you'd investigate these types in ghci also appreciated.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1484682170, "post_id": 41705308, "comment_id": 70606823, "body": "This looks like a bug, and as such you should report it in the bug tracker not StackOverflow."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 17, "creation_date": 1484683536, "post_id": 41705308, "comment_id": 70607587, "body": "I don&#39;t think it&#39;s reasonable to say &quot;you should report this bug properly instead of posting it on Stack Overflow&quot;. Often you need to ask on Stack Overflow to find out it&#39;s a bug rather than your own misunderstanding (and usually it&#39;s not a bug). It&#39;s fine to say &quot;yes this is a bug, please report it&quot;, I just disagree with the &quot;should&quot; phrasing and the implication that it was incorrect to ask about it here."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1484708324, "post_id": 41705308, "comment_id": 70616705, "body": "Possible duplicate bug of either <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12700\" rel=\"nofollow noreferrer\">#12700</a> or <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12702\" rel=\"nofollow noreferrer\">#12702</a>. One is fixed in 8.0.2, one isn&#39;t."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1484717932, "post_id": 41705308, "comment_id": 70619315, "body": "perhaps you should be allowing ambiguous types. i think the takeaway of #12700 is that it&#39;s OK for the warning to be present in situations where the only solution is to enable another extension; in that ticket the extension in question is flexiblecontexts and here (maybe?) it is allowambiguoustypes"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1496413331, "post_id": 41705308, "comment_id": 75666312, "body": "The correction of this defect seems to have regressed in <code>ghc-8.2.1rc2</code>."}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 302, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1484858173, "creation_date": 1484681047, "last_edit_date": 1484858173, "question_id": 41705308, "link": "https://stackoverflow.com/questions/41705308/why-is-ghc-emitting-incorrect-redundant-constraint-warning-here", "title": "Why is GHC emitting incorrect &quot;redundant constraint&quot; warning here?", "body": "<p>As per the title I'm curious as to why GHC is emitting a warning about a redundant constraint when its removal makes the code no longer compile.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Lib where\n\nimport           Protolude hiding (from, try)\n\nimport           Control.Exception.Safe\nimport           Database.Esqueleto\nimport           Database.Persist.TH\n\nnewtype PingId =\n  PingId Int\n  deriving (Enum, Eq, Integral, Num, Ord, Real, Show)\n\ndata Ping = Ping\n  {\n  } deriving (Show)\n\nshare [mkPersist sqlSettings] [persistLowerCase|\nDbPing sql=pings\n|]\n\npingToDbPing :: Ping -&gt; DbPing\npingToDbPing _ = undefined\n\ndbPingToPing :: DbPing -&gt; Either Text Ping\ndbPingToPing _ = undefined\n\nclass (PersistEntity a, ToBackendKey SqlBackend a) =&gt;\n      FromPersistEntity a b | a -&gt; b where\n  fromPersistEntity :: a -&gt; Either Text b\n\ninstance FromPersistEntity DbPing Ping where\n  fromPersistEntity = dbPingToPing\n\ntype family ToKey a :: * where\n  ToKey PingId = DbPingId\n\nfindById\n  :: forall m key record val.\n     ( Integral key\n     , Key record ~ ToKey key\n     , FromPersistEntity record val\n     , MonadCatch m\n     , MonadIO m\n     , MonadReader DbConfig m\n     )\n  =&gt; key -&gt; m (Either Text (Maybe val))\nfindById key = do\n  maybeRetOrErr &lt;-\n    try\n      (liftIO . evaluate =&lt;&lt;\n       runDB\n         (select $\n          from $ \\table -&gt; do\n            where_\n              (table ^. persistIdField ==. val (toSqlKey . fromIntegral $ key))\n            return table))\n  case maybeRetOrErr of\n    Left (e :: SomeException) -&gt; return . Left . toS . displayException $ e\n    Right [] -&gt; return . Right $ Nothing\n    Right [ret :: Entity record] -&gt;\n      return . fmap Just . fromPersistEntity . entityVal $ ret\n    Right _ -&gt; return . Left $ \"impossible happened, more than one result\"\n\ndata DbConfig = DbConfig\n  { dbConnectionPool :: ConnectionPool\n  }\n\nrunDB\n  :: (MonadIO m, MonadReader DbConfig m)\n  =&gt; SqlPersistT IO b -&gt; m b\nrunDB q = do\n  pool &lt;- asks dbConnectionPool\n  liftIO $ runSqlPool q pool\n\ntest :: IO ()\ntest = do\n  let dbConfig = DbConfig undefined\n  flip runReaderT dbConfig $ do\n    pingOrErr &lt;- findById (PingId 1)\n    print pingOrErr\n</code></pre>\n\n<p>and produces the following warning:</p>\n\n<pre><code>/home/ppb/Code/haskell/test/src/Lib.hs:49:1: warning: [-Wredundant-constraints]\n    \u2022 Redundant constraint: Key record ~ ToKey key\n    \u2022 In the type signature for:\n           findById :: (Integral key, Key record ~ ToKey key,\n                        FromPersistEntity record val, MonadCatch m, MonadIO m,\n                        MonadReader DbConfig m) =&gt;\n                       key -&gt; m (Either Text (Maybe val))\n</code></pre>\n\n<p>and removing the constraint results in the following error:</p>\n\n<pre><code>/home/ppb/Code/haskell/test/src/Lib.hs:50:6: error:\n    \u2022 Could not deduce (FromPersistEntity record0 val)\n      from the context: (Integral key,\n                         FromPersistEntity record val,\n                         MonadCatch m,\n                         MonadIO m,\n                         MonadReader DbConfig m)\n        bound by the type signature for:\n                   findById :: (Integral key, FromPersistEntity record val,\n                                MonadCatch m, MonadIO m, MonadReader DbConfig m) =&gt;\n                               key -&gt; m (Either Text (Maybe val))\n        at src/Lib.hs:(50,6)-(57,39)\n      The type variable \u2018record0\u2019 is ambiguous\n    \u2022 In the ambiguity check for \u2018findById\u2019\n      To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n      In the type signature:\n        findById :: forall m key record val.\n                    (Integral key,\n                     FromPersistEntity record val,\n                     MonadCatch m,\n                     MonadIO m,\n                     MonadReader DbConfig m) =&gt;\n                    key -&gt; m (Either Text (Maybe val))\n</code></pre>\n\n<p>I'm using GHC 8.0.1 and compiling with <code>-Wall</code>.</p>\n\n<p>Is there any way I could restructure the code to avoid the warning? Or if that's not possible is there a way to silence the warning on per-function basis, rather than across the whole module with <code>OPTIONS_GHC</code>?</p>\n\n<hr />\n\n<p><strong>EDIT</strong>: compiling with GHC 8.0.2 no longer produces a warning.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484677517, "post_id": 41704316, "comment_id": 70604387, "body": "why do you use <code>liftIO</code> in this case?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484679044, "post_id": 41704316, "comment_id": 70605259, "body": "<code>liftIO :: MonadIO m =&gt; IO a -&gt; m a</code> is used to lift an IO action into another monad that is capable of doing IO;  it does not let you exit the <code>IO</code> monad altogether."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1484677598, "creation_date": 1484677598, "answer_id": 41704387, "question_id": 41704316, "link": "https://stackoverflow.com/questions/41704316/currenttime-to-day-in-haskell/41704387#41704387", "title": "CurrentTime to Day in Haskell", "body": "<p><code>getCurrentTime :: IO UTCTime</code>, so you can't simply return a <code>Day</code> value; you can only return an <code>IO Day</code> value (ignoring <code>unsafePerformIO</code>)</p>\n\n<pre><code>localDay :: IO Day\nlocalDay = fmap utctDay getCurrentTime\n</code></pre>\n"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 41704387, "answer_count": 1, "score": 0, "last_activity_date": 1484677598, "creation_date": 1484677312, "question_id": 41704316, "link": "https://stackoverflow.com/questions/41704316/currenttime-to-day-in-haskell", "title": "CurrentTime to Day in Haskell", "body": "<p>I'm try to make a helper funcion that give the date in Day format, so I have the following code </p>\n\n<pre><code>localDay :: Day\nlocalDay = do \n  now &lt;- liftIO $ getCurrentTime\n  utctDay now\n</code></pre>\n\n<p>But get the following error</p>\n\n<pre><code>Couldn't match type \u2018m0 b0\u2019 with \u2018Day\u2019\nExpected type: m0 UTCTime -&gt; (UTCTime -&gt; m0 b0) -&gt; Day\n  Actual type: m0 UTCTime -&gt; (UTCTime -&gt; m0 b0) -&gt; m0 b0\nIn a stmt of a 'do' block: now &lt;- liftIO $ getCurrentTime\nIn the expression:\n  do { now &lt;- liftIO $ getCurrentTime;\n       utctDay now }\nIn an equation for \u2018localDay\u2019:\n    localDay\n      = do { now &lt;- liftIO $ getCurrentTime;\n             utctDay now }\n</code></pre>\n\n<p>Really I can't understant the reason of the error in this case because now should be of Type <code>UTCTime\u0323</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484674338, "post_id": 41703426, "comment_id": 70602670, "body": "This is a very redundant structure."}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484674357, "post_id": 41703426, "comment_id": 70602680, "body": "<code>n &gt; 0, n &gt; 100, n &gt; 1000</code> is equivalent to <code>n &gt; 1000</code> but three times the operations."}, {"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484674664, "post_id": 41703426, "comment_id": 70602866, "body": "Well yeah, that&#39;s why Im asking how to do the first code block properly in Haskell. Please remember I want to obtain the equivalent cost of 3 comparisons to reach any return value, no more, no less. The guard I wrote there obv fails."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1484682422, "post_id": 41703426, "comment_id": 70606956, "body": "<a href=\"http://hackage.haskell.org/package/arithmoi-0.4.3.0/docs/Math-NumberTheory-Logarithms.html#v:integerLog10\" rel=\"nofollow noreferrer\">integerLog10</a>, or its slightly faster primed version. You can probably copy-and-paste the source with minor modifications if you&#39;re working with a type other than <code>Integer</code>."}, {"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484695971, "post_id": 41703426, "comment_id": 70613260, "body": "tried but the source is huge, and gives me errors, then more errors after solving those, they got out of my haskell skill level, tells me it is hidden if I try to import"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484756196, "post_id": 41703426, "comment_id": 70643192, "body": "@DanielWagner you should add that suggestion to your answer, and @gia you should accept it. <a href=\"http://hackage.haskell.org/package/arithmoi-0.4.3.0/docs/Math-NumberTheory-Logarithms.html#v:intLog2-39-\" rel=\"nofollow noreferrer\"><code>intLog10&#39;</code></a> will probably give you the best performance you can feasibly achieve."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484757707, "post_id": 41703426, "comment_id": 70644271, "body": "@leftaroundabout Your link <i>says</i> <code>intLog10&#39;</code>, but the URL is for <code>intLog2&#39;</code>. (And there is no <code>intLog10&#39;</code>, which is why in my comment I suggested a copy-and-paste job...)"}], "answers": [{"comments": [{"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 1, "creation_date": 1484675742, "post_id": 41703737, "comment_id": 70603419, "body": "Im trying to count the number of digits of millions of numbers without actually spending the cycles to count them, a binary search with if statements sounds optimal to me, I&#39;ll benchmark the answers"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 2, "creation_date": 1484679773, "post_id": 41703737, "comment_id": 70605648, "body": "@gia Is that your actual goal? You should mention that in the question. Maybe there&#39;s a faster way to compute <code>ceil . log10</code>."}, {"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484679995, "post_id": 41703737, "comment_id": 70605773, "body": "ill try but I dont expect log10 to be faster than an if gate, @leftaroundabout benchmark: 1M numbers ~0.04s, 10M ~0.38s 100M ~3.82s (branching ifs), IO takes me 2.89s so its fast although I was hoping for faster (like 0.5s), I also need to improve the IO but I copy pasted some code labeled as fastest..., but maybe I am using it wrong as it may have not have been built for millions of numbers but hundreds of thousands."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 1, "creation_date": 1484681946, "post_id": 41703737, "comment_id": 70606703, "body": "@gia I&#39;m <b>not</b> suggesting to compute <code>log10</code>, but <code>ceil . log10</code> -- the latter might admit a faster algorithm than the trivial composition (I do not know which one, but others might know). Your question is affected by an XY problem. You ask for a vastly more general problem (nested ifs) when all you need might be much, much less. Doing so, you are discarding alternative solutions. If e.g. there were a library efficient function <code>numberOfDigits</code> nobody will ever point it to you since you asked for something completely different! -- Hence the XY problem."}, {"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484690183, "post_id": 41703737, "comment_id": 70611001, "body": "I still want the answer to faster nested ifs alternative if there is one, ceil is not found on hoogle, only ceiling, log10 was not found either"}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 4, "creation_date": 1484692373, "post_id": 41703737, "comment_id": 70611932, "body": "@gia: <code>ceil . log10</code> is most likely faster than nested <code>if</code>-s or guards. Consider the cycle penalty for mispredicted branches and Haskell&#39;s evaluation laziness. If you&#39;re just interested in the number of digits, this really is the way to go. The decision tree is overkill for this problem."}, {"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484695819, "post_id": 41703737, "comment_id": 70613215, "body": "make a separate answer with code because I havent found neither ceil nor log10 yet"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 1, "creation_date": 1484696450, "post_id": 41703737, "comment_id": 70613430, "body": "@gia: both exist in fact under those exact names <a href=\"http://hackage.haskell.org/package/cmath-0.3/docs/Foreign-C-Math-Double.html#v:log10\" rel=\"nofollow noreferrer\">in the <code>cmath</code> package</a>, but I think what chi meant is actually <code>ceiling . log 10 . fromIntegral</code>."}, {"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484730620, "post_id": 41703737, "comment_id": 70625357, "body": "I ran into bugs (eg log 10 = 1 not 2, but thats fixed with +1), then negatives, etc, so I had to use extra operations (guards,addition,etc) anyway. But still ran it with wrong results to see how fast it processes, 1M 0.07s, 10M 0.69s, 100M 6.98s"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484754122, "post_id": 41703737, "comment_id": 70641782, "body": "The benchmarks aren&#39;t really meaningful without seeing the code it benchmarks."}, {"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484801284, "post_id": 41703737, "comment_id": 70661979, "body": "the code is the same, all that is replaced is the &quot;countbench :: Int -&gt; Int&quot; function contents, the baseline is count returns literal 1 which runs in 2.89s, that makes if-nest last ~1s second, and log 10 last 4x the time. In the case of the tree benchmark I generated the tree in main and passed it down the function chain."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1484675330, "creation_date": 1484675330, "answer_id": 41703737, "question_id": 41703426, "link": "https://stackoverflow.com/questions/41703426/complex-nested-if-else-statements-in-haskell-performance/41703737#41703737", "title": "Complex nested if else statements in Haskell (Performance)", "body": "<p>Well, though <code>if</code> statements are not particularly liked by Haskellers, there's nothing <em>wrong</em> with them. Maybe the best thing would be simply</p>\n\n<pre><code>if n &gt; 0\n then if n &gt; 100\n       then if n &gt; 1000 then 1 else 2\n       else if n &gt; 50 then 3 else 4\n else ...\n</code></pre>\n\n<p>That said, you may be better off delegating the entire comparison stuff to a suitable data type from a library. In fact, these nested comparisons look quite a bit like you're trying to hard-code a <a href=\"http://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Map-Lazy.html#t:Map\" rel=\"nofollow noreferrer\"><code>Map</code></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484679626, "post_id": 41703989, "comment_id": 70605580, "body": "Thanks, this was fast for lesser millions of numbers 1M ~0.05s, 10M ~0.48s, but a bit slow once more numbers were added 100M ~4.84s (Although if I replace the search function with a plain 1 it still takes 2.89s so there&#39;s that bigger IO bottleneck)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484684353, "post_id": 41703989, "comment_id": 70608021, "body": "In most cases, deforestation is an optimization, and the deforested version of this answer (and of mine) is exactly the nested ifs that the original question proposes. So it seems unlikely that this will be faster. It could be defensible if it were more maintainable or had some other feature that nested ifs don&#39;t; does it have such an alternate feature?"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1484693008, "last_edit_date": 1484693008, "creation_date": 1484676194, "answer_id": 41703989, "question_id": 41703426, "link": "https://stackoverflow.com/questions/41703426/complex-nested-if-else-statements-in-haskell-performance/41703989#41703989", "title": "Complex nested if else statements in Haskell (Performance)", "body": "<p>You could define an appropriate decision tree:</p>\n\n<pre><code>data Tree n rv = Leaf rv | Node n (Tree n rv) (Tree n rv)\n</code></pre>\n\n<p>Your example would then be encoded as</p>\n\n<pre><code> (Node 0 ({- else nodes -}) -- depending on your other cases\n         (Node 100 (Node 50 (Leaf 4) (Leaf 3))\n                   (Node 1000 (Leaf 2) (Leaf 1)))\n</code></pre>\n\n<p>(Left and right subtrees correspond to <code>&lt;</code> and <code>&gt;=</code>. Some tweaking may be necessary if you want to further distinguish between <code>&gt;</code> and <code>==</code>.)</p>\n\n<p>Walking the tree, you compare your <code>n</code> value to the first value in each node, either returning the second value or recursively walking the appropriate subtree.</p>\n\n<pre><code>search :: (Eq a, Ord a) =&gt; a -&gt; Tree a b -&gt;b\nsearch _ (Leaf x) = x\nsearch x (Node y left right)| x &lt; y = search x left\n                                | otherwise = search x right\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 0, "creation_date": 1484695733, "post_id": 41705862, "comment_id": 70613182, "body": "Due to requiring fast IO I used code that runs a fold on a byte string per character,  I dont know how to add your lambda to the function"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "edited": false, "score": 2, "creation_date": 1484695813, "post_id": 41705862, "comment_id": 70613212, "body": "@gia Insufficient information for meaningful answer."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1484683902, "last_edit_date": 1484683902, "creation_date": 1484683059, "answer_id": 41705862, "question_id": 41703426, "link": "https://stackoverflow.com/questions/41703426/complex-nested-if-else-statements-in-haskell-performance/41705862#41705862", "title": "Complex nested if else statements in Haskell (Performance)", "body": "<p>I would probably use a <code>Map</code> and the <code>lookupLT</code> operation or similar to implement this. For example:</p>\n\n<pre><code>import Data.Map.Strict as M\n-- use a lambda to avoid recomputing results on each call\ncount = \\n -&gt; snd &lt;$&gt; M.lookupLT n results where\n    results = M.fromAscList [(0,4),(50,3),(100,2),(1000,1)]\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>&gt; count 1\nJust 4\n&gt; count 1001\nJust 1\n&gt; count (-300)\nNothing\n</code></pre>\n\n<p>If your keys happen to be <code>Int</code>s, you can make it slightly faster by swapping in <code>IntMap</code> instead.</p>\n\n<p>This should give you something quite close to the optimal number of comparisons -- in the <code>IntMap</code> case perhaps even fewer than your nested ifs. I don't know that this approach is necessarily the fastest, but it is quite \"literate\": readers of this code will not have to decipher a deeply-nested chain of ifs to discover what it does, and modifying the possible results later (if that's needed) will be very simple.</p>\n"}], "owner": {"reputation": 747, "user_id": 4675404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/101bf4435d0895eb39d67c93345b3805?s=128&d=identicon&r=PG&f=1", "display_name": "gia", "link": "https://stackoverflow.com/users/4675404/gia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 41703737, "answer_count": 3, "score": 0, "last_activity_date": 1484693008, "creation_date": 1484674234, "last_edit_date": 1484675105, "question_id": 41703426, "link": "https://stackoverflow.com/questions/41703426/complex-nested-if-else-statements-in-haskell-performance", "title": "Complex nested if else statements in Haskell (Performance)", "body": "<p>If I want to process hundreds of millions of numbers and pass them through an if-else nest like (in procedural):</p>\n\n<pre><code>if( n &gt; 0 ){\n    if( n &gt; 100 ) {\n        if( n &gt; 1000 ) {\n           return 1\n        }else{\n           return 2\n        }\n    }else{\n        if( n &gt; 50 ) {\n           return 3\n        }else{\n           return 4\n        }          \n}else{\n    //more nested else cases\n}\n</code></pre>\n\n<p>Procedurally, reaching any of those returns would take exactly 3 comparisons, making sure the average case is optimal if the ranges are set properly (I put random numbers right now, dont mind that). But not sure what would net the best performance on a functional language like Haskell (readability, or ease of typing is not important).</p>\n\n<p>I for example could probably write the if else nest directly, or use guards with the whole if path like:</p>\n\n<pre><code>| n &gt; 1000 = 1\n| n &gt; 100 = 2\n| n &gt; 50 = 3\n| n &gt; 0 = 4\n| etc\n</code></pre>\n\n<p>But I imagine that while for n>1000 there would only be one comparison, for anything on 0 and etc it would cost more than three.</p>\n\n<p>And a structure like this will probably evaluate n>0 four times, instead of branching:</p>\n\n<pre><code>| n &gt; 0, n &gt; 100, n &gt; 1000 = 1\n| n &gt; 0, n &gt; 100 = 2\n| n &gt; 0, n &gt; 50 = 3\n| n &gt; 0 = 4\n| etc\n</code></pre>\n\n<p>I could also just use a function, but not sure if functions are inexpensive as a comparison would be.</p>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 0, "creation_date": 1484677035, "post_id": 41704030, "comment_id": 70604073, "body": "This is an awesome answer, thanks so much for the tip about <code>slidingWindow</code> - That solves several other problems that I didn&#39;t know I had yet.  However, apparently the <code>Data.Conduit.Text</code> package has a <code>foldLines</code>function that I&#39;ve just discovered that handles this use-case quite well, so, re: &quot;don&#39;t reinvent the wheel&quot; I think I&#39;m going to go with that as the &#39;correct&#39; answer."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 0, "creation_date": 1484677138, "post_id": 41704030, "comment_id": 70604141, "body": "@IronGremlin Nice find! Go with that for sure - it should be a fair bit faster."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 4, "last_activity_date": 1484676349, "creation_date": 1484676349, "answer_id": 41704030, "question_id": 41702549, "link": "https://stackoverflow.com/questions/41702549/splitting-by-lines-with-conduit-on-windows/41704030#41704030", "title": "Splitting by lines with Conduit on Windows", "body": "<p>Don't try to reinvent the wheel! We can still make something prettier using <a href=\"https://www.stackage.org/haddock/lts-7.16/conduit-combinators-1.0.8.3/Conduit.html\" rel=\"nofollow noreferrer\"><code>conduit-combinators</code></a>. As a foreword, if your <code>\\r</code> values never occur except sometimes before newlines, you can just filter them out straight up. That said, I am going to assume your case is more general - you only want to get rid of <code>\\r</code> values that are followed by <code>\\n</code>.</p>\n\n<p>The idea is to use <a href=\"https://www.stackage.org/haddock/lts-7.16/conduit-combinators-1.0.8.3/Conduit.html#v:slidingWindowC\" rel=\"nofollow noreferrer\"><code>slidingWindowC</code></a> to get two character chunks, then to map these chunks to their first character - unless the characters are <code>\"\\r\\n\"</code>, in which case we drop both. Then, having removed all <code>\\r</code> that followed by newlines, we can use the conduit <code>linesUnboundedC</code>.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleContexts #-}\n\nimport Data.Text (Text, singleton, empty)\nimport Data.MonoTraversable (Element, MonoFoldable)\nimport Conduit\n\nmain = runConduitRes $ (sourceFile \"file.txt\" :: Producer (ResourceT IO) Text)\n                    .| linesUnboundedC'\n                    .| printC\n\n-- | Converted a chunked input of characters into lines delimited by \\n or \\r\\n\nlinesUnboundedC'\n  :: (Element a ~ Char, MonoFoldable a, Monad m) =&gt; ConduitM a Text m ()\nlinesUnboundedC' = concatMapC id\n                .| slidingWindowC 2\n                .| mapC (\\cs@[c,_] -&gt; if cs == \"\\r\\n\" then empty else singleton c)\n                .| linesUnboundedC\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "is_accepted": false, "score": 4, "last_activity_date": 1484677094, "creation_date": 1484677094, "answer_id": 41704243, "question_id": 41702549, "link": "https://stackoverflow.com/questions/41702549/splitting-by-lines-with-conduit-on-windows/41704243#41704243", "title": "Splitting by lines with Conduit on Windows", "body": "<p>Apparently <code>Data.Conduit.Text</code> has a function, <code>foldLines</code>, which works precisely as described.</p>\n"}], "owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1484698067, "creation_date": 1484671534, "last_edit_date": 1484698067, "question_id": 41702549, "link": "https://stackoverflow.com/questions/41702549/splitting-by-lines-with-conduit-on-windows", "title": "Splitting by lines with Conduit on Windows", "body": "<p>I am having some trouble using the conduit lib on to split Text by line.</p>\n\n<p>The source data I'm working with, unfortunately, is extremely inconsistent with line endings, containing both <code>\\r\\n</code> and <code>\\n</code> sequences in the same file.</p>\n\n<p>I have found the <code>lines</code> function in <code>Data.Conduit.Binary</code>, but it \"splits\" by single byte, (<code>\\n</code>, sensibly enough), which leaves me with a trailing <code>\\r</code>in some cases.</p>\n\n<p>I understand why the current implementation works the way it does, and I am mostly confident I could hack some kind of a solution together, but the only way I could think of to do this would be something like:</p>\n\n<pre><code>lines' = do\n   loop $ T.pack \"\"\n   where loop acc = do\n         char &lt;- await\n         case char of\n            Nothing -&gt; return ()\n            Just x -&gt; do\n            case (isOver $ acc `T.append` x) of\n                    (True,y) -&gt; yield y\n                    (False,y) -&gt; loop y\n                    where isOver n\n                           |  (T.takeEnd 2 n == _rLn)  = (True, T.dropEnd 2 n)\n                           |  (T.takeEnd 1 n == _Ln)   = (True, T.dropEnd 1 n)\n                           |  otherwise                =  (False,n)\n                           where _rLn = T.pack $! \"\\r\\n\"\n                                 _Ln = T.pack $! \"\\n\"\n</code></pre>\n\n<p>... which seems inelegant, kludgy, and terribly slow.</p>\n\n<p>It feels wrong to check the last two characters at every iteration, since all I really need to do is \"remember\" if the last character I read was <code>\\r</code>, but I can't think of a sensible way to do that.</p>\n\n<p>Is anyone aware of a better solution to this problem?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484672309, "post_id": 41702352, "comment_id": 70601493, "body": "I don&#39;t have any experience with Haskell on Windows, and can&#39;t reproduce the issue on Linux, but here are two hunches: either the spaces in the path, or the length of the path might be a problem. Can you try a shorter path that doesn&#39;t contain any spaces?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484673976, "post_id": 41702352, "comment_id": 70602476, "body": "I tried as you suggested and by accident figured out what the problem is. It seems I should not have deleted the dependency on <code>simple</code> in the cabal file even though it seemed redundant. That was it. Thanks."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484674871, "post_id": 41702352, "comment_id": 70602986, "body": "In addition, the project name is sensitive to the name of the folder it is in and possibly its location, which is also something that I should not have messed with."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484675156, "post_id": 41702352, "comment_id": 70603135, "body": "...In addition, it seems you were right about spaces as well."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 2, "creation_date": 1484675802, "post_id": 41702352, "comment_id": 70603444, "body": "That interaction with the removal of another dependency sounds strange. If you think that <code>stack</code> misbehaves in any way, please consider filing a bug report! :)"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484678486, "post_id": 41702352, "comment_id": 70604951, "body": "I&#39;ll do it tomorrow as the thing with whitespaces is stopping me from putting project with the rest of the repo. I ran into something like this when I first tried the Atom Repl plugin. It is like I am the only Haskell user on Windows. :)"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484738429, "post_id": 41702352, "comment_id": 70630691, "body": "Here is <a href=\"https://github.com/commercialhaskell/stack/issues/2936\" rel=\"nofollow noreferrer\">the report</a>. As it turns out, there is a build corruption bug. It has nothing to do with whitespaces."}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484706819, "creation_date": 1484670990, "last_edit_date": 1484706819, "question_id": 41702352, "link": "https://stackoverflow.com/questions/41702352/why-does-the-bytestring-show-package-install-using-stack-fail", "title": "Why does the bytestring-show package install using Stack fail?", "body": "<p>It installs just fine with <code>cabal install bytestring-show</code>. Here is the log:</p>\n\n<pre><code>Configuring bytestring-show-0.3.5.6...\nBuilding bytestring-show-0.3.5.6...\nPreprocessing library bytestring-show-0.3.5.6...\n[1 of 6] Compiling Text.Show.ByteString.Util ( Text\\Show\\ByteString\\Util.hs, .stack-work\\dist\\b7fec021\\build\\Text\\Show\\ByteString\\Util.o )\n[2 of 6] Compiling Text.Show.ByteString.Char ( Text\\Show\\ByteString\\Char.hs, .stack-work\\dist\\b7fec021\\build\\Text\\Show\\ByteString\\Char.o )\n[3 of 6] Compiling Text.Show.ByteString.Int ( Text\\Show\\ByteString\\Int.hs, .stack-work\\dist\\b7fec021\\build\\Text\\Show\\ByteString\\Int.o )\n[4 of 6] Compiling Text.Show.ByteString.Integer ( Text\\Show\\ByteString\\Integer.hs, .stack-work\\dist\\b7fec021\\build\\Text\\Show\\ByteString\\Integer.o )\n\nText\\Show\\ByteString\\Integer.hs:27:1: warning: [-Wunused-imports]\n    The import of `GHC.Num' is redundant\n      except perhaps to import instances from `GHC.Num'\n    To import instances alone, use: import GHC.Num()\n[5 of 6] Compiling Text.Show.ByteString.Float ( Text\\Show\\ByteString\\Float.hs, .stack-work\\dist\\b7fec021\\build\\Text\\Show\\ByteString\\Float.o )\n[6 of 6] Compiling Text.Show.ByteString ( Text\\Show\\ByteString.hs, .stack-work\\dist\\b7fec021\\build\\Text\\Show\\ByteString.o )\n\nText\\Show\\ByteString.hs:205:10: warning: [-Wredundant-constraints]\n    * Redundant constraint: Integral a\n    * In the instance declaration for `Show (Ratio a)'\n\nText\\Show\\ByteString.hs:209:10: warning: [-Wredundant-constraints]\n    * Redundant constraint: RealFloat a\n    * In the instance declaration for `Show (Complex a)'\nInstalling library in C:\\Users\\Marko\\Documents\\Visual Studio\n2015\\Projects\\Multi-armed Bandit Experiments\\Spiral V5\nHaskell\\.stack-work\\install\\93264ba9\\lib\\x86_64-windows-ghc-8.0.1\\bytestring-show-0.3.5.6-BjSy8lPQnxSIztPkxWzSlH\ncopyFile: does not exist (The system cannot find the path specified.)\n</code></pre>\n\n<p>At first the error on the last line was <code>access denied</code> so I did the above with the administrator access and it complains that it cannot find the path specified.</p>\n\n<p>I put <code>extra-deps: [bytestring-show-0.3.5.6]</code> into the yaml file and added <code>bytestring-show</code> as build dependency into the cabal file.</p>\n\n<p>I also tried upgrading stack and am getting this error:</p>\n\n<pre><code>C:\\&gt;stack upgrade\nUpdating package index Hackage (mirrored at https://github.com/commercialhaskell                                                                                Fetching package index ...remote: Counting objects: 1, done.\nremote: Total 1 (delta 0), reused 1 (delta 0), pack-reused 0\nUnpacking objects: 100% (1/1), done.\nFetched package index.\nPopulated index cache.\nCompiler version mismatched, found ghc-8.0.1 (x86_64), but expected minor version match with ghc-7.10.3 (x86_64) (based on resolver setting in C:\\Users\\Marko\\AppData\\Local\\Temp\\stack-upgrade8368\\stack-1.3.2\\stack.yaml).\nTry rerunning with --install-ghc to install the correct GHC into C:\\Users\\Marko\\AppData\\Local\\Programs\\stack\\x86_64-windows\\\n</code></pre>\n\n<p>I just installed Haskell platform yesterday, but I had an earlier version from a few month ago installed so maybe it did not get cleaned up properly.</p>\n\n<p>I am not sure what to do here.</p>\n"}, {"tags": ["c", "haskell", "ghc", "ffi", "hsc2hs"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1485034791, "post_id": 41703402, "comment_id": 70759592, "body": "I use Arch Linux and the file is found in <i>extra/libxkbfile</i> package, which is a dependency of <i>gnome-desktop</i>, <i>xorg-setxkbmap</i> and <i>xterm</i>, among others. Appears it should be quite widespread."}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1485102072, "last_edit_date": 1485102072, "creation_date": 1484674162, "answer_id": 41703402, "question_id": 41701875, "link": "https://stackoverflow.com/questions/41701875/when-using-hsc2hs-introduction-of-include-directive-in-haskell-source-results/41703402#41703402", "title": "When using hsc2hs, introduction of #include directive in haskell source results in numerous errors", "body": "<p>research into the XKBrules.h file contents indicates that it is for C++ programs, not C programs</p>\n\n<p>this web page gives some further info:</p>\n\n<p><a href=\"http://xmonad.org/xmonad-docs/X11/Graphics-X11-Xlib-Types.html\" rel=\"nofollow noreferrer\">http://xmonad.org/xmonad-docs/X11/Graphics-X11-Xlib-Types.html</a></p>\n\n<p>Which amongst other things says:</p>\n\n<pre><code>Graphics.X11.Xlib.Types\n\nA collection of type declarations for interfacing with Xlib.\n\nSynopsis\nDocumentation\n\nnewtype Display\nSource\n\npointer to an X11 Display structure\n\nConstructors\nDisplay (Ptr Display)    \n\nInstances\nEq Display   \nData Display     \nOrd Display  \nShow Display     \nTypeable Display     \n</code></pre>\n\n<p>Strongly suggest asking this question on a C++ forum</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485102072, "creation_date": 1484669438, "last_edit_date": 1485035015, "question_id": 41701875, "link": "https://stackoverflow.com/questions/41701875/when-using-hsc2hs-introduction-of-include-directive-in-haskell-source-results", "title": "When using hsc2hs, introduction of #include directive in haskell source results in numerous errors", "body": "<p>I'm writing a Haskell program that is supposed to know some details about X11 state, so I try to define an FFI that would call relevant X11 shared libraries' symbols. I generally follow the instructions from the <a href=\"https://en.wikibooks.org/wiki/Haskell/FFI#Impure_C_Functions\" rel=\"nofollow noreferrer\">wikibook</a>. When I add an <code>include</code> directive that refers to an official X11 header, <code>hsc2hs</code> throws a bucket of errors at me, as if said header is syntactically incorrect. I had to resort to writing my own header that essentially replicates the bits I need from the upstream header file and that let my code compile.</p>\n\n<p>Specifically, I need <code>_XkbRF_VarDefs</code> that is declared in <code>X11/extensions/XKBrules.h</code>. You can review my code at the <a href=\"https://github.com/kindaro/ShowKeyboardLayout\" rel=\"nofollow noreferrer\">repository</a>: commit <em>4d77785</em> contains the header I had to write to have it compile, while in <em>8d5e76c</em>  you will find my latest attemts to include the official header that fail to compile (you may see the error log below).</p>\n\n<p>Is it the official header that is broken? Or is it <code>hsc2hs</code>? Are there some magic flags I need to add to the <code>hsc2hs</code> invocation in my make script to have it compile with the official header?</p>\n\n<p>The error log:</p>\n\n<pre><code>In file included from ShowKeyboardLayout.hsc:17:0:\n/usr/include/X11/extensions/XKBrules.h:106:1: error: expected \u2018=\u2019, \u2018,\u2019, \u2018;\u2019, \u2018asm\u2019 or \u2018__attribute__\u2019 before \u2018extern\u2019\n extern Bool XkbRF_GetComponents(\n ^~~~~~\n/usr/include/X11/extensions/XKBrules.h:106:8: error: unknown type name \u2018Bool\u2019\n extern Bool XkbRF_GetComponents(\n        ^~~~\n/usr/include/X11/extensions/XKBrules.h:118:8: error: unknown type name \u2018Bool\u2019\n extern Bool XkbRF_LoadRules(\n        ^~~~\n/usr/include/X11/extensions/XKBrules.h:119:5: error: unknown type name \u2018FILE\u2019\n     FILE *  /* file */,\n     ^~~~\n/usr/include/X11/extensions/XKBrules.h:123:8: error: unknown type name \u2018Bool\u2019\n extern Bool XkbRF_LoadRulesByName(\n        ^~~~\n/usr/include/X11/extensions/XKBrules.h:145:8: error: unknown type name \u2018Bool\u2019\n extern Bool XkbRF_LoadDescriptions(\n        ^~~~\n/usr/include/X11/extensions/XKBrules.h:146:5: error: unknown type name \u2018FILE\u2019\n     FILE *  /* file */,\n     ^~~~\n/usr/include/X11/extensions/XKBrules.h:150:8: error: unknown type name \u2018Bool\u2019\n extern Bool XkbRF_LoadDescriptionsByName(\n        ^~~~\n/usr/include/X11/extensions/XKBrules.h:159:5: error: unknown type name \u2018Bool\u2019\n     Bool  /* wantDesc */,\n     ^~~~\n/usr/include/X11/extensions/XKBrules.h:160:5: error: unknown type name \u2018Bool\u2019\n     Bool  /* wantRules */\n     ^~~~\n/usr/include/X11/extensions/XKBrules.h:172:5: error: unknown type name \u2018Bool\u2019\n     Bool  /* freeRules */\n     ^~~~\n/usr/include/X11/extensions/XKBrules.h:182:8: error: unknown type name \u2018Bool\u2019\n extern Bool XkbRF_GetNamesProp(\n        ^~~~\n/usr/include/X11/extensions/XKBrules.h:183:4: error: unknown type name \u2018Display\u2019\n    Display *  /* dpy */,\n    ^~~~~~~\n/usr/include/X11/extensions/XKBrules.h:188:8: error: unknown type name \u2018Bool\u2019\n extern Bool XkbRF_SetNamesProp(\n        ^~~~\n/usr/include/X11/extensions/XKBrules.h:189:4: error: unknown type name \u2018Display\u2019\n    Display *  /* dpy */,\n    ^~~~~~~\nShowKeyboardLayout.hsc:19:1: error: expected \u2018=\u2019, \u2018,\u2019, \u2018;\u2019, \u2018asm\u2019 or \u2018__attribute__\u2019 before \u2018int\u2019\n type Display = Int -- cz idk\n ^~~\ncompiling ./ShowKeyboardLayout_hsc_make.c failed (exit code 1)\ncommand was: /usr/bin/gcc -c ./ShowKeyboardLayout_hsc_make.c -o ./ShowKeyboardLayout_hsc_make.o -fno-stack-protector -I/usr/lib/ghc-8.0.1/include/\n</code></pre>\n\n<p>P.S. In the comments, it's remarked that <code>XKBrules.h</code> is not present in an installation of Ubuntu. I use Arch Linux and the file is found in <em>extra/libxkbfile</em> package, which is a dependency of <em>gnome-desktop</em>, <em>xorg-setxkbmap</em> and <em>xterm</em>, among others.</p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1484665107, "post_id": 41699981, "comment_id": 70596500, "body": "What would you say the return type of <code>eval</code> is? It can&#39;t be <code>Num x =&gt; x</code>, because <code>eval (Eq (C 3) (C 3))</code> needs to return <code>True :: Bool</code>. It can&#39;t be <code>Bool</code> because <code>eval (Add (C 3) (C 3))</code> needs to return <code>6 :: Num x =&gt; x</code>."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484665528, "post_id": 41699981, "comment_id": 70596847, "body": "Well, obviously it should depend on the structure of CudaExpr passed into the functions. I do not see why it should not be one or the other. I know the above example is possible to encode using phantom types, so are the typeclass constraints I&#39;ve set the problem here? ...No, even if I comment out all the cases but the <code>Eq</code> it still does not work."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484665609, "post_id": 41699981, "comment_id": 70596917, "body": "Ok, I get it. It was something like the monomorhism restriction after all. Once I add the type annotation <code>eval :: CudaExpr x -&gt; x</code>, the error goes away. Thanks for the hint."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1484665980, "post_id": 41699981, "comment_id": 70597178, "body": "GADTs and type inference do not mix well: always add an explicit type annotation when you pattern match over a GADT"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1484672463, "last_edit_date": 1484672463, "creation_date": 1484672151, "answer_id": 41702745, "question_id": 41699981, "link": "https://stackoverflow.com/questions/41699981/why-is-the-eq-gadt-case-giving-me-a-type-error/41702745#41702745", "title": "Why is the Eq (GADT) case giving me a type error?", "body": "<p>From the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=gadt#ghc-flag--XGADTs\">GHC docs</a>: </p>\n\n<blockquote>\n  <p>The general principle is this: <em>type refinement is only carried out based on user-supplied type annotations</em>. So if no type signature is supplied for <code>eval</code>, no type refinement happens, and lots of obscure error messages will occur. </p>\n</blockquote>\n\n<p>In other words, when we pattern match on a GADT type (either through multiple equations or with a <code>case</code>), providing an explicit type annotation is necessary.</p>\n\n<p>As a thought experiment consider</p>\n\n<pre><code>data T a where C :: Char -&gt; T Char\n\nf (C c) = c\n</code></pre>\n\n<p>What is the right typing?</p>\n\n<pre><code>f :: T a    -&gt; a\nf :: T a    -&gt; Char\nf :: T Char -&gt; Char\n</code></pre>\n\n<p>The last one is more specific, the first two are strictly more general. However, none of the first two is more general than the other -- GHC can not pick the \"best\" one.</p>\n\n<p>GADTs are not too special in this. Most advanced features require type annotations: GADTs, higher-rank types, type families at least do.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 41702745, "answer_count": 1, "score": 3, "last_activity_date": 1484672463, "creation_date": 1484664183, "question_id": 41699981, "link": "https://stackoverflow.com/questions/41699981/why-is-the-eq-gadt-case-giving-me-a-type-error", "title": "Why is the Eq (GADT) case giving me a type error?", "body": "<pre><code>{-# LANGUAGE GADTs #-}\n\nmodule Main where\n\ndata CudaExpr x where\n  C :: x -&gt; CudaExpr x\n\n  Add :: Num x =&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr x\n  Sub :: Num x =&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr x\n  Mul :: Num x =&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr x\n  Div :: (Num x, Fractional x) =&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr x\n\n  Eq :: (Eq x) =&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr Bool\n  -- LessThan :: CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr Bool\n  -- If :: CudaExpr Bool -&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr x\n\neval (C x) = x\neval (Add a b) = eval a + eval b\neval (Sub a b) = eval a - eval b\neval (Mul a b) = eval a * eval b\neval (Div a b) = eval a / eval b\n\neval (Eq a b) = eval a == eval b\n-- eval (LessThan a b) = eval a &lt; eval b\n-- eval (If cond true false) = if eval cond then eval true else eval false\n\n\nmain :: IO ()\nmain = print \"Hello\"\n</code></pre>\n\n<p>It does not seem to be the monomorphism restriction. This is what error do I get:</p>\n\n<pre><code>* Could not deduce: x ~ Bool\n  from the context: (t ~ Bool, Eq x)\n    bound by a pattern with constructor:\n               Eq :: forall x. Eq x =&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr Bool,\n             in an equation for `eval'\n    at app\\Main.hs:23:7-12\n  `x' is a rigid type variable bound by\n    a pattern with constructor:\n      Eq :: forall x. Eq x =&gt; CudaExpr x -&gt; CudaExpr x -&gt; CudaExpr Bool,\n    in an equation for `eval'\n    at app\\Main.hs:23:7\n  Expected type: CudaExpr x -&gt; Bool\n    Actual type: CudaExpr t -&gt; t\n* In the first argument of `(==)', namely `eval a'\n  In the expression: eval a == eval b\n  In an equation for `eval': eval (Eq a b) = eval a == eval b\n* Relevant bindings include\n    b :: CudaExpr x (bound at app\\Main.hs:23:12)\n    a :: CudaExpr x (bound at app\\Main.hs:23:10)\n</code></pre>\n"}, {"tags": ["haskell", "printing"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1484661506, "post_id": 41698838, "comment_id": 70593838, "body": "Looks to me like a <i>buffering</i> problem."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1484663182, "post_id": 41698838, "comment_id": 70595151, "body": "We might need to see more code since is clear that this example doesn&#39;t produce the phenomenon. You mention <code>sequence</code> ; this might be the source of the problem."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1484668198, "post_id": 41698838, "comment_id": 70598716, "body": "In particular, how are you getting the list of bytestrings that you are successively writing?"}, {"owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "edited": false, "score": 1, "creation_date": 1484683064, "post_id": 41698838, "comment_id": 70607329, "body": "Have you tried to change your buffering mode? Add <code>hSetBuffering stdout LineBuffering</code> to the IO before the operations and import <code>System.IO</code> ."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484749278, "post_id": 41698838, "comment_id": 70638131, "body": "Note that these types of informational message are usually better written to standard error rather than standard output."}], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": false, "score": 0, "last_activity_date": 1484689582, "creation_date": 1484689582, "answer_id": 41707586, "question_id": 41698838, "link": "https://stackoverflow.com/questions/41698838/print-output-before-writing-to-file-haskell/41707586#41707586", "title": "Print output before writing to file haskell", "body": "<p>Like @WillemVanOnsem stated, this is a buffering issue. You can manually flush the buffer after each print or you can <a href=\"http://hackage.haskell.org/package/base-4.5.0.0/docs/System-IO.html#g:12\" rel=\"nofollow noreferrer\">change the buffering mode entirely</a>.</p>\n\n<pre><code>import System.IO\nimport qualified Data.ByteString as B\n\nmain = do\n            ... --some code that gets an array of ByteStrings called \"files\"\n            putStrLn \"Saving myFile1\"\n            hFlush stdout\n            B.writeFile \"myFile1.bin\" $ files!!0\n            putStrLn \"Saving myFile2\"\n            hFlush stdout\n            B.writeFile \"myFile2.bin\" $ files!!1\n            putStrLn \"Done!\"\n            hFlush stdout\n</code></pre>\n\n<p>or</p>\n\n<pre><code>import System.IO\nimport qualified Data.ByteString as B\n\nmain = do\n            ... --some code that gets an array of ByteStrings called \"files\"\n            hSetBuffering stdout LineBuffering\n            putStrLn \"Saving myFile1\"\n            B.writeFile \"myFile1.bin\" $ files!!0\n            putStrLn \"Saving myFile2\"\n            B.writeFile \"myFile2.bin\" $ files!!1\n            putStrLn \"Done!\"\n</code></pre>\n"}], "owner": {"reputation": 1250, "user_id": 732407, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8998278b580b3e3863141b864647e503?s=128&d=identicon&r=PG", "display_name": "puggsoy", "link": "https://stackoverflow.com/users/732407/puggsoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1484689582, "creation_date": 1484660948, "question_id": 41698838, "link": "https://stackoverflow.com/questions/41698838/print-output-before-writing-to-file-haskell", "title": "Print output before writing to file haskell", "body": "<p>Suppose I have this code:</p>\n\n<pre><code>import qualified Data.ByteString as B\n\nmain = do\n            ... --some code that gets an array of ByteStrings called \"files\"\n            putStrLn \"Saving myFile1\"\n            B.writeFile \"myFile1.bin\" $ files!!0\n            putStrLn \"Saving myFile2\"\n            B.writeFile \"myFile2.bin\" $ files!!1\n            putStrLn \"Done!\"\n</code></pre>\n\n<p>Instead of printing out each string before the subsequent file writing, it just seems to print out everything at once after the files have been saved. This kind of functionality is inconvenient for notifying the user of the progress, since they'll only get these messages once all the file writing is done.</p>\n\n<p>My code is obviously not this bad (I'm using a list of functions with <code>sequence</code>) but this illustrates the problem well. Is there anything I'm doing wrong or is this there no way around this?</p>\n"}, {"tags": ["function", "haskell", "insert"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484653729, "post_id": 41696230, "comment_id": 70588462, "body": "This exact question was asked yesterday already. Anyways, don&#39;t represent it using functions; that seems horribly convoluted. Use a Map (the structure, not the function)."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484653967, "post_id": 41696230, "comment_id": 70588625, "body": "SO you mean solving this with lists. Thats of course way easier but I have to solve it this way also :("}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484654054, "post_id": 41696230, "comment_id": 70588685, "body": "Not lists, a Map/Dictionary. They associate one input with another, which is what you&#39;re trying to do here: associate a name with a number."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484654109, "post_id": 41696230, "comment_id": 70588723, "body": "And the first problem I see is that you have the type of phonebook as a function. If I understand what you&#39;re trying to do correctly, the phonebook itself shouldn&#39;t be a function, each entry is a function. <code>Phonebook</code> should be a list of functions."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484654338, "post_id": 41696230, "comment_id": 70588858, "body": "So you mean type Phonebook = [String -&gt; String] ?"}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484654369, "post_id": 41696230, "comment_id": 70588883, "body": "Unfortunately the definition of Phonebook is given in the task and I have to solve it this way"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484654502, "post_id": 41696230, "comment_id": 70588972, "body": "Sorry, I can&#39;t help then. It doesn&#39;t make any sense. I&#39;d ask your teacher to clarify that. It kind of makes sense for a Phonebook to be a list of functions (kind of), but I don&#39;t see how you could store multiple bits of data in a single function in any kind of sane way."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484654807, "post_id": 41696230, "comment_id": 70589179, "body": "Yes thats the thing. Ill ask my teacher. Maybe the task is wrong :) Thanks for your help!"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484654914, "post_id": 41696230, "comment_id": 70589247, "body": "Np, also, my Haskell is pretty rusty, but I&#39;m pretty sure you can&#39;t pattern match on <code>emptyPhonebook</code> like you&#39;re doing; it&#39;s not a constructor."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484657024, "post_id": 41696230, "comment_id": 70590717, "body": "@Carcigenicate correct you cannot pattern match. However, you can achieve the task with <code>String -&gt; String</code>: start with <code>const &quot;&quot;</code> for the empty phone book, and <code>insert name number pb = \\n -&gt; if n == name then number else pb n</code>, but deletion will be tricky."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484659227, "post_id": 41696230, "comment_id": 70592230, "body": "The funny part is that it was asked by &quot;J. Doe&quot;, now this question is asked by &quot;John Doe&quot; :)"}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484660552, "post_id": 41696230, "comment_id": 70593133, "body": "Thanks Zeta, is there any way to test it? Beacuse testing it with &#39;insert &quot;name&quot; &quot;number&quot; emptyPhonebook&#39; gives the error &#39;No instance for (Show Phonebook) arising from a use of \u2018print\u2019 &#39;"}], "answers": [{"comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484657359, "post_id": 41697521, "comment_id": 70590926, "body": "Ahh, just chaining the functions. I&#39;ve done that in JS, can&#39;t believe I didn&#39;t think of it here."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484660254, "post_id": 41697521, "comment_id": 70592948, "body": "Thanks Michail but I dont understand the variable s. You didnt initialize it so how can you compare it with the string name?"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "reply_to_user": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484660949, "post_id": 41697521, "comment_id": 70593434, "body": "@JohnDoe <code>s</code> is going to be the argument of the resulting function, so when you call <code>nonEmptyPhonebook &quot;John&quot;</code> it&#39;ll be replaced with &#39;John&#39;."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484661410, "post_id": 41697521, "comment_id": 70593764, "body": "Okay I see. How can I test it? Testing with &#39;insert &quot;John&quot;&#39; &quot;12345&quot; emptyPhonebook&#39; gives the following error : &#39;No instance for (Show Phonebook) arising from a use of \u2018print\u2019 &#39;"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "reply_to_user": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484662436, "post_id": 41697521, "comment_id": 70594543, "body": "@JohnDoe You need to save the new phonebook into a variable and then call it with some arguments. Since a phonebook is actually a function you can&#39;t print it directly, but you can print its return value."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484666952, "post_id": 41697521, "comment_id": 70597877, "body": "@Michail AH okay but how do I save a phonebook in a variable? With &#39;let n = newphonebook&#39;?And why is &#39;insert &quot;John&quot;&#39; &quot;12345&quot; emptyPhonebook&#39; not working? Isnt the return value &quot;12345&quot; here? Sorry for the questions Im new to Haskell :)"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "reply_to_user": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484669513, "post_id": 41697521, "comment_id": 70599594, "body": "@JohnDoe No, the return value of function <code>insert</code> is another function, which will return &quot;12345&quot; given the argument &quot;John&quot; (and something else for different arguments if it&#39;s not the first time you use <code>insert</code>). In interactive session <code>n = insert ...</code> should suffice."}], "tags": [], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "is_accepted": false, "score": 3, "last_activity_date": 1484656984, "creation_date": 1484656984, "answer_id": 41697521, "question_id": 41696230, "link": "https://stackoverflow.com/questions/41696230/haskell-phonebook-adding-elements/41697521#41697521", "title": "Haskell Phonebook adding elements", "body": "<p>Something like this should work:</p>\n\n<pre><code>type Phonebook = String -&gt; String\n\nemptyPhonebook :: Phonebook\nemptyPhonebook _ = \"\"\n\ninsert :: String -&gt; String -&gt; Phonebook -&gt; Phonebook\ninsert name number phonebook = \n        case phonebook name of \n             \"\" -&gt; (\\s -&gt; if s == name then number else phonebook s)\n             _ -&gt; phonebook\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1484760636, "creation_date": 1484653358, "question_id": 41696230, "link": "https://stackoverflow.com/questions/41696230/haskell-phonebook-adding-elements", "title": "Haskell Phonebook adding elements", "body": "<p>He guys,</p>\n\n<p>My task is to program a phonebook in Haskell. Therefore type Phonebook is given. The Phonebook maps names(String) to their phone numbers(String). But now I have problems implementing the function 'insert':</p>\n\n<p>Heres the code:</p>\n\n<pre><code>type Phonebook = String -&gt; String\n\nemptyPhonebook :: Phonebook\nemptyPhonebook  = \\_-&gt;\"\"\n\ninsert :: String -&gt; String -&gt; Phonebook -&gt; Phonebook\ninsert name number emptyPhonebook = (\\name-&gt;number)     --is this correct?\ninsert name number existingPhonebook = ??\n</code></pre>\n\n<p>My question: How do I insert a function in a function? I mean now I have to insert an entry consisting of a function (name -> number) in another function (existing Phonebook) or am I wrong? Thanks for helping me out :)</p>\n"}, {"tags": ["parsing", "haskell", "parser-combinators"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484652541, "post_id": 41695861, "comment_id": 70587731, "body": "I would recommend <a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">megaparsec</a>."}, {"owner": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484652906, "post_id": 41695861, "comment_id": 70587967, "body": "Why? Edit: Woooow, nice! :D Related to that: How do you find packages like that? There is <a href=\"https://hackage.haskell.org/packages/#cat:Parsing\" rel=\"nofollow noreferrer\">this list</a> but can you sort hackage packages by popularity?"}, {"owner": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484653391, "post_id": 41695861, "comment_id": 70588256, "body": "No you can&#39;t. I guess you <a href=\"https://www.reddit.com/r/haskell/comments/x4g18/the_mustknow_list_of_packages_on_hackage/\" rel=\"nofollow noreferrer\">ask</a> or know the topics or read the blogs/lists. <a href=\"https://hackage.haskell.org/packages/top\" rel=\"nofollow noreferrer\">Sort by download</a> is close."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484671266, "post_id": 41695861, "comment_id": 70600757, "body": "I wholeheartedly back up the recommendation of <code>megaparsec</code>. There, as here, one sequences parsers using their <code>Monad</code> or <code>Applicative</code> instances. You are looking for the <code>spaceParser  *&gt; oParser</code> and <code>spaceParser  *&gt; aParser</code> parsers."}], "owner": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 369, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1484652223, "creation_date": 1484652223, "question_id": 41695861, "link": "https://stackoverflow.com/questions/41695861/how-to-combine-two-parsers-in-haskell-readp-anonymously", "title": "How to combine two parsers in Haskell ReadP anonymously?", "body": "<h2>The Problem</h2>\n\n<p>I want to chain two <code>ReadP</code> parsers anonymously.</p>\n\n<h2>Example</h2>\n\n<p>Input characters are in <code>{'a', 'o', '+', ' '}</code> where <code>' '</code> is a space.\nI want to parse this input according to the following rules:</p>\n\n<ul>\n<li>the first o or a is not preceeded by a space/plus</li>\n<li>every other o is preceeded by a space</li>\n<li>every other a is preceeded by a plus</li>\n</ul>\n\n<h2>The BNF</h2>\n\n<p>In case this is not clear, I came up with the following BNF:</p>\n\n<pre><code>{-\n  &lt;Input&gt; :: = &lt;O&gt; &lt;Expr&gt; | &lt;A&gt; &lt;Expr&gt;\n  &lt;Expr&gt; ::= &lt;Space&gt; &lt;O&gt; &lt;Expr&gt; | &lt;Plus&gt; &lt;A&gt; &lt;Expr&gt; | &lt;EOL&gt;\n  &lt;O&gt; ::= \"o\"\n  &lt;A&gt; ::= \"a\"\n  &lt;Space&gt; ::= \" \"\n  &lt;Plus&gt; ::= \"+\"\n-}\n</code></pre>\n\n<h2>Specific questions</h2>\n\n<p>The idea is, that the rules \"o preceeded by space\" and \"a preceeded by plus\"\n(if not at the beginning) should not be part of the o or a parser, nor do\nI want to create an explicit/named parser, because that is a part of the\ndefinition of an expression (<code>Expr</code>).</p>\n\n<p><strong>How do I chain the <code>oParser</code> with the <code>spaceParser</code>?</strong></p>\n\n<ul>\n<li>Composition (does not work): <code>spaceParser . oParser</code></li>\n<li><code>(+++)</code> is the symmetric choice: <code>oParser (+++) spaceParser</code>. And related to that: Is <code>(+++)</code> equivalent to <code>&lt;|&gt;</code> from <code>Control.Applicative</code>?</li>\n<li><code>ReadP.choice [oParser, spaceParser]</code> creates a new parser, which obviously does not work for a string, but I did that previously and the behaviour of <code>choice</code> surprised me. How does <code>choice</code> work?</li>\n</ul>\n\n<h2>The Code</h2>\n\n<pre><code>--------------------------------------------------------------------------------\nmodule Parser (main) where\n--------------------------------------------------------------------------------\n-- modules\nimport Text.ParserCombinators.ReadP as ReadP\nimport Data.Char as D\nimport Control.Applicative\n--------------------------------------------------------------------------------\n\n-- this parses one o\noParser :: ReadP Char\noParser = satisfy (== 'o')\n\n-- this parses one a\naParser :: ReadP Char\naParser = satisfy (== 'a') --(\\v -&gt; v == 'a')\n\n-- this parses one plus\npParser :: ReadP Char\npParser = satisfy (== '+')\n\nspaceParser :: ReadP Char\nspaceParser = satisfy D.isSpace    \n\nparseExpr :: ReadP String\nparseExpr = -- ReadP.choice [oParser, spaceParser]\n\nmain :: IO ()\nmain = print [ x | (x, \"\") &lt;- ReadP.readP_to_S parseExpr  \"o +a o+a+a o o\"]\n</code></pre>\n\n<p>Thank you <strong>a lot</strong> for reading all of that :) (And: Which haskell parsing libraries would you recommend?)</p>\n"}, {"tags": ["haskell", "hspec"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1611961180, "post_id": 41694407, "comment_id": 116627358, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/34168538/haskell-unit-tests-using-io-monad\">Haskell Unit tests using IO monad</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484773378, "post_id": 41699338, "comment_id": 70653197, "body": "Thanks. How would your test run inside a HSpec spec?"}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484862507, "post_id": 41699338, "comment_id": 70697153, "body": "Updated my answer."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484864629, "post_id": 41699338, "comment_id": 70698171, "body": "Does the <code>MonadDB</code> being a different package have any bearing on the ability for the compiler to select the <code>IdentityT m</code> instance?"}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484867203, "post_id": 41699338, "comment_id": 70699209, "body": "I don&#39;t think so.  Are you having trouble?"}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484898270, "post_id": 41699338, "comment_id": 70708538, "body": "Yes, the code&#39;s in another module inside a <code>Pipe</code>, but I didn&#39;t think that&#39;d matter. Should I update my question?"}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484898438, "post_id": 41699338, "comment_id": 70708601, "body": "Or rather, the calls to said typeclass functions are via <code>liftIO</code>...Could that have an impact?"}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484915732, "post_id": 41699338, "comment_id": 70719027, "body": "I&#39;m pretty sure you can run <code>getIt</code> within pipes with little change.  But without seeing the code I&#39;m not sure what your problem might be.  Might be better to make a new question rather than editing this one."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1484916172, "post_id": 41699338, "comment_id": 70719263, "body": "Yep, will do. Thanks :)"}, {"owner": {"reputation": 473, "user_id": 4137443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2123d4798a0a7a331ba33b6dd14ef01f?s=128&d=identicon&r=PG&f=1", "display_name": "Random dude", "link": "https://stackoverflow.com/users/4137443/random-dude"}, "edited": false, "score": 0, "creation_date": 1592011553, "post_id": 41699338, "comment_id": 110280076, "body": "I don&#39;t see how this helps. Where exactly does the DB call get mocked? Using <code>shouldReturn :: (HasCallStack, Show a, Eq a) =&gt; IO a -&gt; a -&gt; Expectation</code> implies that <code>runIdentityT getIt :: IO (Int, Something)</code> so it would call <code>IO</code> implementation of <code>getSomething</code> which calls the DB. How is <code>IdentityT</code> helping?"}], "tags": [], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "is_accepted": true, "score": 6, "last_activity_date": 1484862466, "last_edit_date": 1484862466, "creation_date": 1484662308, "answer_id": 41699338, "question_id": 41694407, "link": "https://stackoverflow.com/questions/41694407/unit-testing-io-actions-with-hspec/41699338#41699338", "title": "Unit testing IO actions with Hspec", "body": "<p>Would this work for you?</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack exec --package transformers --package hspec -- ghci\nimport Control.Monad.IO.Class\nimport Control.Monad.Trans.Identity\n\nimport Data.Char\nimport Test.Hspec\n\ndata Something = Something String deriving (Eq, Show)\n\nclass MonadIO m =&gt; MonadDB m where\n  getSomething :: String -&gt; m Something\n  getSomething s = return $ Something (map toUpper s)\n\ninstance MonadDB IO\n\ninstance MonadIO m =&gt; MonadDB (IdentityT m)\n\ngetIt :: MonadDB m =&gt; m (Int, Something)\ngetIt = do\n  s@(Something str) &lt;- getSomething \"hi\"\n  return (length str, s)\n\nmain :: IO ()\nmain = hspec $ do\n  describe \"Some tests\" $ do\n    it \"test getIt\" $ do\n      runIdentityT getIt `shouldReturn` (2, Something \"HI\")\n\n    it \"test getIt should fail\" $ do\n      runIdentityT getIt `shouldReturn` (1, Something \"HI\")\n</code></pre>\n\n<p>You might also be able to use <code>ReaderT</code> or <code>StateT</code> to \"supply\" data or a transformation for <code>getSomething</code> to use upon test querying.</p>\n\n<p>Edit: Example use from within hspec.</p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1184, "favorite_count": 1, "accepted_answer_id": 41699338, "answer_count": 1, "score": 4, "last_activity_date": 1484862466, "creation_date": 1484648120, "last_edit_date": 1484666659, "question_id": 41694407, "link": "https://stackoverflow.com/questions/41694407/unit-testing-io-actions-with-hspec", "title": "Unit testing IO actions with Hspec", "body": "<p>I have found other questions on similar lines but nothing that answers my question in this particular scenario. Furthermore, there seem to be few resources which succinctly cover the subject of unit testing IO actions in Haskell.</p>\n\n<p>Let's say I have this typeclass for my database communication:</p>\n\n<pre><code>data Something = Something String deriving Show\n\nclass MonadIO m =&gt; MonadDB m where\n  getSomething :: String -&gt; m Something\n  getSomething s = do\n    ... -- assume a DB call is made and an otherwise valid function\n\ninstance MonadDB IO \n</code></pre>\n\n<p>and this function which uses it:</p>\n\n<pre><code>getIt :: MonadDB m =&gt; m (Int, Something)\ngetIt = do\n  s@(Something str) &lt;- getSomething \"hi\"\n  return (length str, s) -- excuse the contrived example\n</code></pre>\n\n<p>I wish to test this <code>getIt</code> function with hspec but without it talking to the database, which presumably means replacing which <code>MonadDB</code> it uses, but how do I achieve that?</p>\n"}, {"tags": ["function", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 1, "last_activity_date": 1484643434, "last_edit_date": 1484643434, "creation_date": 1484643118, "answer_id": 41692676, "question_id": 41692527, "link": "https://stackoverflow.com/questions/41692527/return-a-function-with-signature-string-string-from-another-function/41692676#41692676", "title": "Return a function with signature String -&gt; String from another function", "body": "<p>I does not have to be an empty funtion, it has to be a <code>String-&gt;String</code> function, even <code>id</code> would do</p>\n\n<pre><code>emptyPhonebook :: Phonebook\nemptyPhonebook  = \\_ -&gt; \"\"\n</code></pre>\n\n<p>Take a look at this <a href=\"http://rextester.com/QKJ11913\" rel=\"nofollow noreferrer\">running example</a>:</p>\n"}, {"tags": [], "owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "is_accepted": false, "score": 7, "last_activity_date": 1484644374, "last_edit_date": 1495540944, "creation_date": 1484644374, "answer_id": 41693089, "question_id": 41692527, "link": "https://stackoverflow.com/questions/41692527/return-a-function-with-signature-string-string-from-another-function/41693089#41693089", "title": "Return a function with signature String -&gt; String from another function", "body": "<p>There is no such thing as an empty function. </p>\n\n<p>The question is, what should your phonebook return for names that aren't in the phone book?<br>\nIf this is a learning exercise, you could just return an empty string - as in the <a href=\"https://stackoverflow.com/a/41692676/812149\">other answer</a>.  </p>\n\n<p>However, a better definition of your phonebook would be:</p>\n\n<pre><code>type Phonebook = String -&gt; Maybe String\n</code></pre>\n\n<p>Then your function becomes:</p>\n\n<pre><code>emptyPhoneBook :: Phonebook\nemptyPhoneBook _ = Nothing\n</code></pre>\n\n<p>This is like using nullable types in languages like C#; the <code>Maybe</code> says that your value can either be a String, or <code>Nothing</code>.  </p>\n\n<p>For completeness, I should add that if <code>Maybe String</code> contains a string value, its value will be preceded by the keyword <code>Just</code>.<br>\nFor example, if the String in question was \"Judie\", the value would be <code>Just \"Judie\"</code> rather than merely \"Judie\".<br>\nThe <code>Just</code> is because the value is of type <code>Maybe String</code>, not of type <code>String</code>.</p>\n"}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 41692676, "answer_count": 2, "score": 0, "last_activity_date": 1492087942, "creation_date": 1484642687, "last_edit_date": 1492087942, "question_id": 41692527, "link": "https://stackoverflow.com/questions/41692527/return-a-function-with-signature-string-string-from-another-function", "title": "Return a function with signature String -&gt; String from another function", "body": "<p>I'm programming in Haskell and have the following type.</p>\n\n<pre><code>type Phonebook = String -&gt; String\n</code></pre>\n\n<p>Now I have to create a function that returns an empty Phonebook, so</p>\n\n<pre><code>emptyPhonebook :: Phonebook\nemptyPhonebook = ???\n</code></pre>\n\n<p>But what is an empty Phonebook? </p>\n\n<p>I mean it has to be an \"empty\" function, but how do I write that in Haskell?</p>\n"}, {"tags": ["haskell", "types", "monads"], "answers": [{"tags": [], "owner": {"reputation": 1650, "user_id": 1292223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98458fe74447603906e51a6f74039c4a?s=128&d=identicon&r=PG", "display_name": "kini", "link": "https://stackoverflow.com/users/1292223/kini"}, "is_accepted": false, "score": 1, "last_activity_date": 1484638101, "creation_date": 1484638101, "answer_id": 41691271, "question_id": 41690627, "link": "https://stackoverflow.com/questions/41690627/liftm-null-id-return-bool-but-bool-is-not-monad/41691271#41691271", "title": "liftM null id return bool, but bool is not monad", "body": "<pre><code>null :: Foldable t =&gt; t a -&gt; Bool\n</code></pre>\n\n<p>Therefore unification gives</p>\n\n<pre><code>liftM null :: (Monad m, Foldable t) =&gt; m (t a) -&gt; m Bool\n</code></pre>\n\n<p>Then <code>liftM null id</code> must unify <code>id</code>, which is of type <code>b -&gt; b</code>, with <code>m (t a)</code> where <code>m</code> is a <code>Monad</code> and <code>t</code> is a <code>Foldable</code>.  As it happens, the type <code>((-&gt;) r)</code> is <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#line-638\" rel=\"nofollow noreferrer\">defined as a Monad</a>.  So that means that the type of <code>id</code> can be written as <code>m b</code> where <code>m</code> is <code>((-&gt;) b)</code>.</p>\n\n<pre><code>id :: b -&gt; b\nid :: ((-&gt;) b) b   -- this is the same as above\n-- m = ((-&gt;) b)\n</code></pre>\n\n<p>Now, <code>b</code> can be specialized to <code>t a</code> so that we get the desired type:</p>\n\n<pre><code>id :: ((-&gt;) (t a)) (t a)\n-- m = ((-&gt;) (t a))\n</code></pre>\n\n<p>So back to <code>liftM null</code>, we have:</p>\n\n<pre><code>liftM null :: Foldable t =&gt; ((-&gt;) (t a)) (t a) -&gt; ((-&gt;) (t a)) Bool\n</code></pre>\n\n<p>Or, to write it back in the usual infix <code>-&gt;</code> form,</p>\n\n<pre><code>liftM null :: Foldable t =&gt; (t a -&gt; t a) -&gt; t a -&gt; Bool\n</code></pre>\n\n<p>The rest is clear -- we apply the above function to <code>id</code> to get</p>\n\n<pre><code>liftM null id :: Foldable t =&gt; t a -&gt; Bool\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 7424698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GQ9cOboj06c/AAAAAAAAAAI/AAAAAAAAADo/zi48sqg0TgI/photo.jpg?sz=128", "display_name": "\uae40\uac15\ud0dc", "link": "https://stackoverflow.com/users/7424698/%ea%b9%80%ea%b0%95%ed%83%9c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1484638171, "creation_date": 1484635598, "last_edit_date": 1484638171, "question_id": 41690627, "link": "https://stackoverflow.com/questions/41690627/liftm-null-id-return-bool-but-bool-is-not-monad", "title": "liftM null id return bool, but bool is not monad", "body": "<p><code>Bool</code> type is not <code>Monad</code></p>\n\n<pre><code>ghci&gt; :t liftM\nliftM :: Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r\n</code></pre>\n\n<p>Yet the following still returns <code>Bool</code></p>\n\n<pre><code>ghci&gt; :t (liftM null id)\n(liftM null id) :: Foldable t =&gt; t a -&gt; Bool\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1484631634, "post_id": 41689338, "comment_id": 70576144, "body": "Also, you&#39;re matching on the variable <code>sel</code>, rather than on the type name as @user7428320 was (incorrectly) doing."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1484632697, "post_id": 41689338, "comment_id": 70576457, "body": "@AntalSpector-Zabusky Sure. I assumed that and his several other errors (e.g. not giving <code>foo</code> an argument in the <code>map</code> expression, declaring <code>OtherType</code> as a <code>type</code> with record syntax, giving a return type of <code>OtherType</code> but a value with a list in...) were introduced in writing the question."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1484632778, "post_id": 41689338, "comment_id": 70576493, "body": "Oops, didn&#39;t notice all of those :-)  Just wanted to call that one out explicitly for the potential benefit of @user7428320, since it seemed potentially more related to their confusion!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1484629083, "creation_date": 1484629083, "answer_id": 41689338, "question_id": 41689315, "link": "https://stackoverflow.com/questions/41689315/haskell-case-inside-of-where/41689338#41689338", "title": "Haskell, Case inside of Where", "body": "<p>Just move the equation outside of the case.</p>\n\n<pre><code>foo sel t = [ x t, y t, z t &lt;&gt; something ]\n  where\n    something = case sel of\n      A -&gt; \"a selected\"\n      B -&gt; \"b selected\"\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 7428320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f317a4d45a8dde74fed450dd51394b01?s=128&d=identicon&r=PG&f=1", "display_name": "user7428320", "link": "https://stackoverflow.com/users/7428320/user7428320"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1129, "favorite_count": 0, "accepted_answer_id": 41689338, "answer_count": 1, "score": 2, "last_activity_date": 1484629083, "creation_date": 1484628886, "question_id": 41689315, "link": "https://stackoverflow.com/questions/41689315/haskell-case-inside-of-where", "title": "Haskell, Case inside of Where", "body": "<p>I'm wondering if there is an idiom to handle the following example. It has to be pretty common, and I don't think you can use where clauses to handle it. Other than writing out two separate cases, I don't know how I would do it.</p>\n\n<p>The general problem is that I want to create a map with a different value depending on a <code>SelectionType</code>, like so:</p>\n\n<pre><code>type OtherType = { x :: Int, y :: Int, z :: String } deriving (Show)\n\ndata SelectionType = A | B\n\nmyMapper = map foo someMyTypes\n</code></pre>\n\n<p>where <code>someMyTypes :: [MyType]</code> and <code>foo</code> is</p>\n\n<pre><code>foo :: SelectionType -&gt; MyType -&gt; OtherType\nfoo sel t = [ x t, y t, z t &lt;&gt; something ]\n  where\n    case SelectionType of\n      A -&gt; something = \"a selected\"\n      B -&gt; something = \"b selected\"\n</code></pre>\n\n<p>What is the best way to handle this above case, since the above doesn't compile.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4873, "user_id": 7057680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iBS3e.jpg?s=128&g=1", "display_name": "T-Heron", "link": "https://stackoverflow.com/users/7057680/t-heron"}, "edited": false, "score": 0, "creation_date": 1484620119, "post_id": 41687978, "comment_id": 70573148, "body": "What&#39;s the actual question here?  See <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>"}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1484640660, "post_id": 41687978, "comment_id": 70579998, "body": "I guess you came from c/c++,  <code>Int a</code> doesn&#39;t mean <code>a</code> is an <code>Int</code>. Recommend reading <a href=\"http://learnyouahaskell.com/types-and-typeclasses\" rel=\"nofollow noreferrer\">lyahfgg</a>"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1484621451, "last_edit_date": 1484621451, "creation_date": 1484619178, "answer_id": 41688042, "question_id": 41687978, "link": "https://stackoverflow.com/questions/41687978/what-diffrence-int-a-a-string-vs-int-string/41688042#41688042", "title": "what diffrence Int a =&gt; a -&gt; String vs Int -&gt; String", "body": "<p><code>Int</code> is a concrete type, so it cannot be used to create a constraint. Type classes (with kind <code>* -&gt; Constraint</code>) like <code>Num</code> are used to create constraints.</p>\n\n<p>Nor do you need to. The purpose of a constraint is to specify that a type variable like <code>a</code> must be a type that is an instance of a particular class. Something like <code>Int a</code> could only mean \"a type <code>a</code> that is also type <code>Int</code>\", and there is only one such type (surprise: <code>Int</code>) for which that is true, so you just write <code>Int -&gt; String</code>.</p>\n\n<p>A constraint like <code>Num a =&gt; a -&gt; String</code> defines the type of a function that takes an argument of any type that implements <code>Num</code>, which could be <code>Int</code>, <code>Integer</code>, <code>Float</code>, <code>Double</code>, or some other appropriate type.</p>\n"}], "owner": {"reputation": 31, "user_id": 7424698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GQ9cOboj06c/AAAAAAAAAAI/AAAAAAAAADo/zi48sqg0TgI/photo.jpg?sz=128", "display_name": "\uae40\uac15\ud0dc", "link": "https://stackoverflow.com/users/7424698/%ea%b9%80%ea%b0%95%ed%83%9c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "closed_date": 1484629624, "answer_count": 1, "score": 0, "last_activity_date": 1484832095, "creation_date": 1484618762, "last_edit_date": 1484832095, "question_id": 41687978, "link": "https://stackoverflow.com/questions/41687978/what-diffrence-int-a-a-string-vs-int-string", "closed_reason": "Duplicate", "title": "what diffrence Int a =&gt; a -&gt; String vs Int -&gt; String", "body": "<p>What is the difference between <code>Int a =&gt; a -&gt; String</code> and <code>Int -&gt; String</code>?</p>\n\n<p>Success:</p>\n\n<pre><code>f1 :: Int -&gt; String\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>f1 :: Int a =&gt; a -&gt; String\n\nf1 n = show n\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1484617222, "post_id": 41687700, "comment_id": 70572525, "body": "You are trying to perform IO (<code>readFile</code>) inside of a do block for a monad that is not the IO monad (<code>Handler Html</code>). I don&#39;t know the details of the <code>Handler</code> type synonym, but the fact that IO is present in its definition suggests it will support some operation such as <code>liftIO</code>, which you could use to lift the IO operation up to the proper place."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1484617523, "post_id": 41687700, "comment_id": 70572587, "body": "Basically, @amalloy is telling you to replace <code>snippet &lt;- readFile temp</code> with <code>snippet &lt;- liftIO $ readFile temp</code>."}], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 1257066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d4401806a41c0a9c8f8f1d41432f7e31?s=128&d=identicon&r=PG", "display_name": "Alphonse23", "link": "https://stackoverflow.com/users/1257066/alphonse23"}, "is_accepted": false, "score": 4, "last_activity_date": 1484703612, "last_edit_date": 1484703612, "creation_date": 1484698156, "answer_id": 41709270, "question_id": 41687700, "link": "https://stackoverflow.com/questions/41687700/couldnt-match-expected-type-handlert-with-actual-type-io-string/41709270#41709270", "title": "Couldn&#39;t match expected type `HandlerT...&#39; with actual type `IO String&#39;", "body": "<p>@Alec's answer was basically correct. Thanks!</p>\n\n<blockquote>\n  <p>Basically, @amalloy is telling you to replace <code>snippet &lt;- readFile temp</code> with <code>snippet &lt;- liftIO $ readFile temp</code>.</p>\n</blockquote>\n"}], "owner": {"reputation": 113, "user_id": 1257066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d4401806a41c0a9c8f8f1d41432f7e31?s=128&d=identicon&r=PG", "display_name": "Alphonse23", "link": "https://stackoverflow.com/users/1257066/alphonse23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 792, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1484703612, "creation_date": 1484616625, "question_id": 41687700, "link": "https://stackoverflow.com/questions/41687700/couldnt-match-expected-type-handlert-with-actual-type-io-string", "title": "Couldn&#39;t match expected type `HandlerT...&#39; with actual type `IO String&#39;", "body": "<p>Trying to make a yesod app (without stack, and <code>yesod init</code>) and when ever I compile it I run into this monad error. I know these issues are common, but I've never seen anyone ask this question with these specific types (i.e. HandlerT and IO String). Here's all my code, so I think it should be easy enough for someone to test this. Also I'm using GHC 7.10.3, which is a little older, but I don't think my issue has anything to do with the compiler version.</p>\n\n<pre><code>$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.3\n</code></pre>\n\n<p>Here's the compiler error message:</p>\n\n<pre><code>$ ghc -o yesod_test yesod_monad_test.hs\n[1 of 1] Compiling Main             ( yesod_monad_test.hs, yesod_monad_test.o )\n\nyesod_monad_test.hs:25:15:\n    Couldn't match expected type `HandlerT HelloWorld IO Text'\n                with actual type `IO String'\n    In a stmt of a 'do' block: snippet &lt;- readFile temp\n    In the expression:\n      do { let temp = \"posts/\" ++ title ++ \".html\";\n           snippet &lt;- readFile temp;\n           defaultLayout\n             ((asWidgetT . toWidget) (toHtml (preEscapedText snippet))) }\n</code></pre>\n\n<p>And here's my code.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE QuasiQuotes           #-}\n{-# LANGUAGE TemplateHaskell       #-}\n{-# LANGUAGE TypeFamilies          #-}\n{-# LANGUAGE ViewPatterns          #-}\n\nimport Yesod\nimport Network.Wai           (pathInfo, rawPathInfo, requestMethod, responseLBS)\nimport Data.Text             (Text)\nimport Text.Blaze            (preEscapedText)\nimport Control.Exception     (IOException, try)\nimport Control.Monad         (when)\n\ndata HelloWorld = HelloWorld\n\nmkYesod \"HelloWorld\" [parseRoutes|\n /post/#String PostR GET\n|]\n\ninstance Yesod HelloWorld\n\ngetPostR :: String -&gt; Handler Html\ngetPostR title = do\n   let temp = \"posts/\" ++ title ++ \".html\"\n   snippet &lt;- readFile temp\n   defaultLayout [whamlet|#{preEscapedText snippet}|]\n\nmain :: IO ()\nmain = warp 3000 HelloWorld\n</code></pre>\n\n<p>I'm surprised that this code doesn't work, since I believe I'm following the tutorial (<a href=\"http://www.yesodweb.com/book/routing-and-handlers#routing-and-handlers_overlap_checking\" rel=\"nofollow noreferrer\">http://www.yesodweb.com/book/routing-and-handlers#routing-and-handlers_overlap_checking</a>) pretty closely, though I'm using Strings over the Text type.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "fold", "proof"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1484607498, "post_id": 41686292, "comment_id": 70569905, "body": "Consider a safe version of <code>head</code>: <code>safeHead = foldr (\\x y -&gt; Just x &lt;|&gt; y) Nothing</code> (and import <code>Control.Applicative</code>). If you use the version of <code>foldr</code> defined with <code>foldl</code>, <code>safeHead [1..]</code> won&#39;t terminate. With the usual <code>foldr</code>, it will immediately return <code>Just 1</code>."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1484617440, "creation_date": 1484617440, "answer_id": 41687796, "question_id": 41686292, "link": "https://stackoverflow.com/questions/41686292/why-it-is-not-possible-to-redefine-implement-foldr-in-terms-of-foldl/41687796#41687796", "title": "Why it is not possible to redefine (implement) foldr in terms of foldl", "body": "<p>In what follows, I will refer to <code>fold</code> as <code>foldr</code> (since that is what its is called in the Haskell standard libraries).</p>\n\n<hr>\n\n<p>Taking another look at the definition of <code>foldl</code>,</p>\n\n<pre><code>foldl :: (\u03b2 -&gt; \u03b1 -&gt; \u03b2) -&gt; \u03b2 -&gt; [\u03b1] -&gt; \u03b2\nfoldl f v [] = v\nfoldl f v (x:xs) = foldl f (f v x) xs\n</code></pre>\n\n<p>note that the base case requires the list argument to be <code>[]</code> - in all other cases the list is evaluated to WNHF and we recurse immediately using the tail of the list. That establishes the fact that <code>foldl</code> is strict in its (last) list argument.</p>\n\n<p>Now, we <em>can</em> write a version of <code>foldr</code> using <code>foldl</code>, but it will only work on lists of finite length. See <a href=\"https://wiki.haskell.org/Foldl_as_foldr\" rel=\"nofollow noreferrer\">this page</a> for the motivation.</p>\n\n<pre><code>foldr' :: (\u03b1 -&gt; \u03b2 -&gt; \u03b2) -&gt; \u03b2 -&gt; [\u03b1] -&gt; \u03b2\nfoldr' f v xs = foldl (\\g u x -&gt; g (f u x)) id xs v \n</code></pre>\n\n<p>To see the problem, let's try to write a version of <code>head</code> which is total<sup>1</sup> using a right fold.</p>\n\n<pre><code>import Control.Applicative ((&lt;|&gt;))\n\nsafeHead :: [\u03b1] -&gt; Maybe \u03b1\nsafeHead = foldr (\\x y -&gt; Just x &lt;|&gt; y) Nothing\n</code></pre>\n\n<p>If we replace <code>foldr</code> with our <code>foldl</code>-based <code>foldr'</code>, we are no longer able to find the head of an infinite list <code>safeHead [1..]</code>. Even if <code>safeHead</code> only needs to look at the first element of the list, the underlying <code>foldl</code> will try to traverse the whole infinite list.</p>\n\n<hr>\n\n<p><sup>1</sup> Such a function actually already exists in the Prelude, it is called <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Maybe.html#v:listToMaybe\" rel=\"nofollow noreferrer\">listToMaybe</a></p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 5, "last_activity_date": 1484627314, "creation_date": 1484627314, "answer_id": 41689087, "question_id": 41686292, "link": "https://stackoverflow.com/questions/41686292/why-it-is-not-possible-to-redefine-implement-foldr-in-terms-of-foldl/41689087#41689087", "title": "Why it is not possible to redefine (implement) foldr in terms of foldl", "body": "<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr f acc [] = acc\nfoldr f acc (x : xs) = f x (foldr f acc xs)\n</code></pre>\n\n<p>Note that when the list isn't empty, the recursive call to <code>foldr</code> is <em>inside</em> an argument passed to <code>f</code>. Haskell is lazily evaluated, so that recursive call to <code>foldr</code> isn't necessarily actually computed. If <code>f</code> can return a result without examining the second argument (but it <strong>can</strong> examine the first argument <code>x</code> to <em>decide</em> whether or not it wants to look at its second argument), then the <code>foldr</code> call can \"stop early\", without examining the whole list.</p>\n\n<pre><code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldl f acc [] = acc\nfoldl f acc (x : xs) = foldl (f acc x) xs\n</code></pre>\n\n<p>Here (when the list isn't empty) <code>foldl</code> recurses immediately, with the call to <code>f</code> inside the accumulator argument it passes to the recursive call. <code>f</code> doesn't get the opportunity to decide whether to examine the recursive call or not; <code>foldl</code> is in complete control of how long to keep recursing for, and it keeps doing so until it finds the end of the list.</p>\n\n<p>So in particular, with <code>foldr</code> you can potentially process an infinite list; so long as the function you pass it eventually doesn't reference its second argument (<code>acc</code>). For example in GHCi:</p>\n\n<pre><code>Prelude&gt; foldr (\\x acc -&gt; if x &gt; 10 then \"...\" else show x ++ \", \" ++ acc) \"STOP\" [1..5]\n\"1, 2, 3, 4, 5, STOP\"\n\nPrelude&gt; foldr (\\x acc -&gt; if x &gt; 10 then \"...\" else show x ++ \", \" ++ acc) \"STOP\" [1..]\n\"1, 2, 3, 4, 5, 6, 7, 8, 9, 10, ...\"\n</code></pre>\n\n<p>With <code>foldr</code>, the lambda function is able to use that <code>if</code> statement to examine the list element <code>x</code> and decide whether or not to use the results of folding the rest of the list (which are referenced by <code>acc</code> but haven't actually been computed yet).</p>\n\n<p>Alternatively, the function could return a result including the recursive call but store it in the field of a data constructor. This means the <code>foldr</code> will produce an infinitely nested data structure, but allows the <em>caller</em> of <code>foldr</code> to decide how much of that infinite structure it wants to look at, so the caller might still be able to return a finite result processing it. An example would be:</p>\n\n<pre><code>Prelude&gt; take 10 $ foldr (\\x acc -&gt; x + 100 : acc) [] [1..]\n[101,102,103,104,105,106,107,108,109,110]\n</code></pre>\n\n<p>Here I'm just using <code>foldr</code> to do the same job as <code>map</code>, adding 100 to each element of the infinite list, which produces an infinite list in turn, but then <code>take 10</code> only grabs the first 10 of them. This works because the infinite \"results of folding the result of the list\" are simply stored in the second field of the list constructor <code>:</code>.</p>\n\n<p>That ability to process an infinite list (whether you actually return a finite or infinite result) can't be simulated by <code>foldl</code>, because the function you pass into <code>foldl</code> doesn't get to decide \"how much\" of the recursion to use; <code>foldl</code> itself recurses all the way to the end of the list before it returns anything other than another call to <code>foldl</code>. If the list is infinite it simply never returns anything other than another call to <code>foldl</code>, no matter what function you pass to <code>foldl</code> or what wrapper you use to try to make it do the job of <code>foldr</code>.</p>\n\n<p>It's not just about processing infinite lists either (if that seems esoteric); if all your lists are finite then you <em>can</em> use <code>foldl</code> to get the same results as <code>foldr</code> but you're still locked into examining the entire list, which can be very inefficient if you only actually needed a small prefix of it.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 41687796, "answer_count": 2, "score": 5, "last_activity_date": 1484627314, "creation_date": 1484606959, "last_edit_date": 1495541788, "question_id": 41686292, "link": "https://stackoverflow.com/questions/41686292/why-it-is-not-possible-to-redefine-implement-foldr-in-terms-of-foldl", "title": "Why it is not possible to redefine (implement) foldr in terms of foldl", "body": "<p>We have that <a href=\"https://stackoverflow.com/questions/6172004/writing-foldl-using-foldr\"><code>foldl</code> can be implemented in terms of <code>foldr</code></a>. This is explained in detail in <a href=\"http://www.cs.nott.ac.uk/~pszgmh/fold.pdf\" rel=\"nofollow noreferrer\">A tutorial on the universality and expressiveness of fold</a>. In the paper it is stated that:</p>\n\n<blockquote>\n  <p>In contrast, it is not possible to redefine <code>fold</code> in terms of <code>foldl</code> , due to the fact that <code>foldl</code> is strict in the tail of its list argument but <code>fold</code> is not.</p>\n</blockquote>\n\n<p>However I fail to see how this constitutes a proof on the impossibility of defining <code>foldr</code> in terms of <code>foldl</code> (note that in the original paper <code>fold</code> is a synonym for <code>foldr</code>). I'm quite puzzled trying to understand how strictness plays a role here. Can somebody expand on this explanation?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484602203, "post_id": 41685264, "comment_id": 70567673, "body": "It&#39;s <i>tuple(s)</i>, not <i>tupel(s)</i>."}], "answers": [{"comments": [{"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 0, "creation_date": 1484604582, "post_id": 41685324, "comment_id": 70568768, "body": "While this is a really good list of improvements to the current code, it doesn&#39;t actually answer the question."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1484605065, "last_edit_date": 1484605065, "creation_date": 1484602377, "answer_id": 41685324, "question_id": 41685264, "link": "https://stackoverflow.com/questions/41685264/pattern-match-list-of-tuple-strings/41685324#41685324", "title": "Pattern-match list of tuple Strings", "body": "<p>I don't get why you:</p>\n\n<ol>\n<li>use <code>emptybook</code> in your pattern matching part, instead of <code>[]</code>;</li>\n<li>why you repeat <code>(x:xs)</code> both in the left and in the right part of the expression;</li>\n<li>make a distinction between an empty book and a non-empty book.</li>\n</ol>\n\n<h1>Why it doesn't work</h1>\n\n<p>Because Haskell, like many other languages uses <em>variable scopes</em>, and Haskell sees <code>emptybook</code> in your function <strong>as a variable</strong>. It does not see (at least not there) that <code>emptybook</code> is a function somewhere defined. So could have written:</p>\n\n<pre><code>insert a b c = (a,b) : []\n</code></pre>\n\n<p>as well (as second line in your function definition). Now since you define a variable <code>c</code> and did not put any constraints (guards, patterns,...) on it, it <strong>matches with everything</strong>: so a non-empty book as well. Therefore Haskell will always take the first line. In fact the compiler already warns you for this. It says:</p>\n\n<pre><code>haskell.hs:9:1: Warning:\n    Pattern match(es) are overlapped\n    In an equation for \u2018insert\u2019: insert a b (x : xs) = ...\n</code></pre>\n\n<p>This means that the last line of your function definition overlaps with the previous lines. In that case you have probably done something wrong.</p>\n\n<h1>Alternative</h1>\n\n<p>You can simply use:</p>\n\n<pre><code>insert :: String -&gt; String -&gt; book -&gt; book\ninsert a b xs = (a,b) : xs\n</code></pre>\n\n<p>or even shorter:</p>\n\n<pre><code>insert :: String -&gt; String -&gt; book -&gt; book\ninsert a b = (:) (a,b)\n</code></pre>\n\n<p>Furthermore types are usually denoted with a <em>capital letter</em>, so you better use <code>Book</code> instead of <code>book</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1484605605, "last_edit_date": 1484605605, "creation_date": 1484605303, "answer_id": 41685951, "question_id": 41685264, "link": "https://stackoverflow.com/questions/41685264/pattern-match-list-of-tuple-strings/41685951#41685951", "title": "Pattern-match list of tuple Strings", "body": "<p>The clause</p>\n\n<pre><code>insert a b emptyBook = (a,b) : []\n</code></pre>\n\n<p>defines <code>insert</code> as a function of three general arguments <code>a</code>, <code>b</code> and <code>emptyBook</code>. Well, the last isn't actually used, but that makes no difference \u2013 that clause will succeed, no matter what arguments you pass in.</p>\n\n<p>The third argument also <em>shadows</em> the top-level definition <code>emptyBook</code> \u2013 basically this makes it so that within the scope of the function, <code>emptyBook</code> is now whatever book you pass in, no matter whether it's empty.</p>\n\n<p>GHC can actually give a warning highlighting this real problem with your code, if you tell it to give generous warnings:</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:~$ runhaskell -Wall /tmp/wtmpf-file2776.hs \n\n/tmp/wtmpf-file2776.hs:7:12: Warning:\n    This binding for \u2018emptyBook\u2019 shadows the existing binding\n      defined at /tmp/wtmpf-file2776.hs:4:1\n\n/tmp/wtmpf-file2776.hs:7:12: Warning:\n    Defined but not used: \u2018emptyBook\u2019\n</code></pre>\n\n<p>If you want <code>emptyBook</code> to be a <em>constant</em> that should be matched on, you have to make it explicit that this is not a newly-bound argument variable. A couple of options:</p>\n\n<ul>\n<li><p>(<em><strong>Not</strong></em> recommended) use equality comparison instead of pattern matching</p>\n\n<pre><code>insert a b book\n  | book==emptyBook  = (a,b) : []\ninsert a b (x : xs)  = (a, b) : (x:xs)\n</code></pre>\n\n<p>We generally avoid equality comparison in Haskell \u2013 it's less general, less efficient and more error-prone than pattern matching.</p></li>\n<li><p>(<em>Very <strong>not</strong></em> recommended) use a C-preprocessor macro (Template Haskell would also work) to actually insert literally <code>[]</code> in that pattern matching. You can't have a variable named <code>[]</code>, so this will do the right thing:</p>\n\n<pre><code>{-# LANGUAGE CPP #-}\n\n#define emptyBook []\n\ninsert :: String -&gt; String -&gt; Book -&gt; Book\ninsert a b emptyBook = (a,b) : []\ninsert a b (x : xs) = (a, b) : (x:xs)\n</code></pre>\n\n<p>Such macro definitions don't work very well with Haskell \u2013 they're completely oblivious of the languages scopes, can't be exported etc..</p></li>\n<li><p>(<em>Not <strong>very</strong></em> recommended) use <em>pattern synonyms</em>. Those are essentially the modern, Haskell-native way of achieving the behaviour I did above with a CPP macro:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\npattern EmptyBook :: Book\npattern EmptyBook = []\n\ninsert :: String -&gt; String -&gt; Book -&gt; Book\ninsert a b emptyBook = (a,b) : []\ninsert a b (x : xs) = (a, b) : (x:xs)\n</code></pre></li>\n</ul>\n\n<p>So, what <em>would</em> be the recommended solution? Well, as Willem Van Onsem says, you just don't need that clause at all \u2013 it's already a special case of the second clause!</p>\n\n<pre><code>insert :: String -&gt; String -&gt; Book -&gt; Book\ninsert a b (x : xs) = (a, b) : (x:xs)\n</code></pre>\n\n<p>...which is the same as</p>\n\n<pre><code>insert a b (x : xs) = (a, b) : x : xs\n</code></pre>\n\n<p>or</p>\n\n<pre><code>insert a b xxs = (a, b) : xxs\n</code></pre>\n\n<p>or</p>\n\n<pre><code>insert a b = ((a, b) :)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>import Data.Function.Pointless\n\ninsert=(:).:(,)\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 41685951, "answer_count": 2, "score": 2, "last_activity_date": 1484605605, "creation_date": 1484602157, "last_edit_date": 1484603874, "question_id": 41685264, "link": "https://stackoverflow.com/questions/41685264/pattern-match-list-of-tuple-strings", "title": "Pattern-match list of tuple Strings", "body": "<p>So I have a lost of String tuples in Haskell.\nI declared a type for that:</p>\n\n<pre><code>type Book = [(String, String)]\n</code></pre>\n\n<p>Then I declared an empty book:</p>\n\n<pre><code>emptyBook :: Book\nemptyBook = []\n</code></pre>\n\n<p>And now I want to create a function that inserts elements to a book. My solution:</p>\n\n<pre><code>insert :: String -&gt; String -&gt; Book -&gt; Book\ninsert a b emptyBook = (a,b) : []\ninsert a b (x : xs)= (a, b) : (x:xs)\n</code></pre>\n\n<p>But the function insert is not working. The compiler loads the module but gives the warning 'Pattern match is redundant'. </p>\n\n<p>Executing insert <code>\"a\" \"1\" [(\"b\",\"2\")]</code> gives <code>[(\"a\",\"1\")]</code>\ninstead of <code>[(\"a\",\"1\"),(\"b\",\"2\")]</code></p>\n\n<p>Do you know whats going wrong here?</p>\n"}, {"tags": ["haskell", "io-monad", "hspec"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484601652, "post_id": 41685141, "comment_id": 70567451, "body": "Don&#39;t do <code>IO</code> in your test, or support real <code>IO</code> in <code>WorkingDBM</code>."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484602046, "post_id": 41685141, "comment_id": 70567617, "body": "Turns out it was <code>liftIO</code> in the function that I was testing, so I can&#39;t <i>not</i> do the IO. What do you mean support real? I thought <code>MonadIO</code> would suffice for that."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1484602572, "post_id": 41685141, "comment_id": 70567826, "body": "I have written an answer with some further details on what I mean. But I challenge your claim that you must do <code>IO</code> inside the <code>MonadDB</code> instance in your test."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484603272, "post_id": 41685141, "comment_id": 70568169, "body": "I didn&#39;t say I need to do IO inside <code>MonadDB</code>; I need to use <code>liftIO</code> inside the function that I&#39;m testing (which uses the <code>MonadDB</code> instance)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484604257, "post_id": 41685141, "comment_id": 70568620, "body": "I don&#39;t understand the distinction you are trying to draw in your last comment. Somehow I feel there is a fundamental misunderstanding between the three of us (you, me, and the compiler), but I haven&#39;t seen enough details about your beliefs to have figured out what it is yet."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484604854, "post_id": 41685141, "comment_id": 70568874, "body": "I assure you the misunderstanding is all mine. I&#39;ve realised that even though I&#39;m using this technique for testing IO-driven functions, the function under test stiil doesn&#39;t ultimately use my test instance as described in this question, so I&#39;m still stuck. For background: my test target is a Pipe function that uses the MonadDB shown here (a real version of it of course). It&#39;s <i>that function&#39;s</i> usage I want to &quot;mock&quot;, and I thought this would achieve it, but alas I&#39;ve realised my mistake. I hope that makes sense? PS you&#39;ve solved the question of course, as <code>liftIO</code> was what I was asking about."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484605684, "post_id": 41685141, "comment_id": 70569187, "body": "I&#39;m not sure I understand. It sounds like it might be worth opening a fresh question with further details."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484648191, "post_id": 41685141, "comment_id": 70584762, "body": "Yep, fair point. I&#39;ve raised <a href=\"http://stackoverflow.com/questions/41694407/unit-testing-ip-actions-with-hspec\" title=\"unit testing ip actions with hspec\">stackoverflow.com/questions/41694407/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 1, "creation_date": 1484603740, "post_id": 41685337, "comment_id": 70568374, "body": "Thanks. How would I force usage of <code>WorkingDBM</code>? I currently use <code>unWorkingDBM (WorkingDBM (Identity x)) = x</code> in my test which obviously triggers the compiler to use my &quot;teset instance&quot; of <code>MonadDB</code>. Not having an equivalent when <code>IO a</code>  is used (because of no data constructor for <code>IO</code> means I can&#39;t push the compiler to use the test instance (derived or otherwise...)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 1, "creation_date": 1484604049, "post_id": 41685337, "comment_id": 70568517, "body": "@atc You can still write <code>runWorkingDBM (WorkingDBM x) = x</code>, you just have to give it type <code>runWorkingDBM :: WorkingDBM a -&gt; IO a</code> rather than <code>runWorkingDBM :: WorkingDBM a -&gt; a</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1484602433, "creation_date": 1484602433, "answer_id": 41685337, "question_id": 41685141, "link": "https://stackoverflow.com/questions/41685141/testing-a-typeclass-with-monadio-no-instance-nor-default-method-error/41685337#41685337", "title": "Testing a typeclass with MonadIO: &quot;No instance nor default method&quot; error", "body": "<p>One solution is to support real <code>IO</code> in <code>WorkingDBM</code>. For example:</p>\n\n<pre><code>newtype WorkingDBM a = WorkingDBM (IO a) -- N.B. IO not Identity\n    deriving (Functor, Applicative, Monad)\n\ninstance MonadIO WorkingDBM where\n    liftIO = WorkingDBM\n</code></pre>\n\n<p>The derived instance for <code>MonadIO</code> will also work fine; but the empty instance will not, as it is equivalent to</p>\n\n<pre><code>instance MonadIO WorkingDBM where\n    liftIO = undefined\n</code></pre>\n\n<p>which will obviously blow up the first time you try to actually do <code>IO</code>.</p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 745, "favorite_count": 0, "accepted_answer_id": 41685337, "answer_count": 1, "score": 2, "last_activity_date": 1484602433, "creation_date": 1484601537, "last_edit_date": 1484601903, "question_id": 41685141, "link": "https://stackoverflow.com/questions/41685141/testing-a-typeclass-with-monadio-no-instance-nor-default-method-error", "title": "Testing a typeclass with MonadIO: &quot;No instance nor default method&quot; error", "body": "<p>I have a typeclass that performs some IO. I've generalised it a little using <code>MonadIO</code>:</p>\n\n<pre><code>class MonadIO m =&gt; MonadDB m where\n    getSomething :: String -&gt; m Something\n    getSomething s = -- do some IO stuff with liftIO\n</code></pre>\n\n<p>In a test I wish to replace the implementation so I can test a function that uses <code>getSomething</code>, so I do this:</p>\n\n<pre><code>newtype WorkingDBM a = WorkingDBM (Identity a)\n    deriving (Functor, Applicative, Monad)\n\ninstance MonadDB WorkingDBM where\n    getSomething s = return $ Something \"blah\"\n</code></pre>\n\n<p>Without an instance declaration the code warns:</p>\n\n<pre><code>\u2022 No explicit implementation for \u2018liftIO\u2019\n\u2022 In the instance declaration for \u2018MonadIO WorkingDBM\u2019\n</code></pre>\n\n<p>So I add:</p>\n\n<pre><code>instance MonadIO WorkingDBM\n</code></pre>\n\n<p>which of course compiles.</p>\n\n<p>Running the tests in Hspec causes this runtime error:</p>\n\n<pre><code>uncaught exception: NoMethodError (test/BlahSpec.hs:45:10-33: No instance nor default method for class operation liftIO\n</code></pre>\n\n<p>I have tried using <code>liftIO</code> from <code>Control.Monad.IO.Class</code>: </p>\n\n<pre><code>-- C is the qualified import for Control.Monad.IO.Class\nliftIO = C.liftIO\n</code></pre>\n\n<p>but this results in a <code>NonTermination</code> runtime exception:</p>\n\n<pre><code>uncaught exception: NonTermination (&lt;&lt;loop&gt;&gt;)\n</code></pre>\n\n<p>Any ideas how I can resolve this please?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484608003, "post_id": 41684745, "comment_id": 70570106, "body": "No, there are no nightly/snapshot builds of stack available to my knowledge. But I&#39;d think that you could just configure the Travis cache to save your <code>stack</code> binary."}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484706835, "creation_date": 1484599640, "last_edit_date": 1484706835, "question_id": 41684745, "link": "https://stackoverflow.com/questions/41684745/snapshot-builds-of-stack-available", "title": "Snapshot builds of stack available?", "body": "<p>I need to use stack 1.3.3 in Travis CI due to a complication issue. The fix is not present in 1.3.2 and 1.3.3 has not been released yet. Currently, I am building stack myself from the source code in my Travis configuration. This adds time to the build. I would like to avoid that.</p>\n\n<p>I am looking for snapshot builds of stack, but I have only seen where to get stable versions. Are snapshot builds of stack 1.3.3 available?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["list", "haskell", "dictionary"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1484598787, "post_id": 41684438, "comment_id": 70566192, "body": "You need more basics.  Try going through the beginning of a tutorial or book, e.g. Learn You A Haskell For Great Good, or Real World Haskell (both are free online)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484601905, "post_id": 41684438, "comment_id": 70567560, "body": "Just a minor detail: it is <i>tuple</i> not <i>touple</i>..."}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484641869, "post_id": 41684438, "comment_id": 70580591, "body": "Yeah I am currently doing this aswell but due to having to learn for several tests I kinda have to rush it and do a lot of tasks etc whilst just reading as we have to know haskel wuite in depth but did it only for 2 weeks in university ^^ rest is up to us to learn :P thanks for the help though"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484642328, "post_id": 41684438, "comment_id": 70580847, "body": "And trust me I am spending every minute I have in learning to become better... yesterday I was trying to solve problems until 10 pm :) Sometimes you just need a little nudge though. (I looked for something like this in learn yourself a haskell but didn&#39;t find anything / missed it)"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484642152, "post_id": 41684591, "comment_id": 70580752, "body": "In the end it&#39;s always the easiest solution -_- thanks Daniel"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1484598979, "creation_date": 1484598979, "answer_id": 41684591, "question_id": 41684438, "link": "https://stackoverflow.com/questions/41684438/haskell-list-with-tuples-which-can-be-extended-like-a-dictionary/41684591#41684591", "title": "Haskell List with tuples which can be extended - like a Dictionary", "body": "<p>The <code>(:)</code> operator prepends elements to lists. For example:</p>\n\n<pre><code>&gt; (\"John\", \"555-1212\") : [(\"Fred\", \"42/2321\")]\n[(\"John\",\"555-1212\"),(\"Fred\",\"42/2321\")]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 6139275, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c6d4f8e0d089829b64c58ce5275bc9?s=128&d=identicon&r=PG&f=1", "display_name": "Roxxik", "link": "https://stackoverflow.com/users/6139275/roxxik"}, "is_accepted": true, "score": 1, "last_activity_date": 1484937855, "last_edit_date": 1484937855, "creation_date": 1484734121, "answer_id": 41716513, "question_id": 41684438, "link": "https://stackoverflow.com/questions/41684438/haskell-list-with-tuples-which-can-be-extended-like-a-dictionary/41716513#41716513", "title": "Haskell List with tuples which can be extended - like a Dictionary", "body": "<p>because you're asking to extend a list:\ni have to disappoint you. That's not possible in Haskell. You can construct a new one. Out of one Element and another List.</p>\n\n<p>the list type in Haskell is defined similar to:</p>\n\n<pre><code>--   1     2       3 4\ndata [a] = a : [a] | []\n-- 1: if you encounter the type [a]\n-- 3: it is either\n-- 2: an element `e` and a list `l` forming the new list `e:l`\n-- 4: or an empty List `[]`\n-- so the types of the constructors are:\n-- (:) :: a -&gt; [a] -&gt; [a]\n-- []  :: [a]\n</code></pre>\n\n<p>So having a new element and a list you can construct a new one, using <code>(:)</code>!</p>\n\n<pre><code>type Entry = (String, String)\ntype Book = [Entry]\n\naddEntry :: Entry -&gt; Book -&gt; Book\naddEntry e b = e : b -- this works, because book is just a list\n\n-- without type aliases: (this is the same, but maybe slightly less nice to read)\naddEntry' :: (String, String) -&gt; [(String, String)] -&gt; [(String, String)]\naddEntry' e b = e : b\n\n-- or even simpler:\naddEntry'' = (:)\n</code></pre>\n\n<p>The <code>type</code> keyword in Haskell has to be understood as a type alias, so it's just another name for something, the representation in Haskell is the same.</p>\n"}], "owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 41716513, "answer_count": 2, "score": 1, "last_activity_date": 1484937855, "creation_date": 1484598286, "last_edit_date": 1484601887, "question_id": 41684438, "link": "https://stackoverflow.com/questions/41684438/haskell-list-with-tuples-which-can-be-extended-like-a-dictionary", "title": "Haskell List with tuples which can be extended - like a Dictionary", "body": "<p>I am a beginner in Haskell and trying to learn it, so please excuse my obliviousness.</p>\n\n<p>I am currently trying to implement a Telephone book, which is a List of tuples <code>[(Name, Number)]</code> (Both are <code>String</code>s). </p>\n\n<pre><code>type TelephoneBook = [(String),(String)] (?)\n</code></pre>\n\n<p>However, I have no clue how I can extend this list by another tuple. \nFor example: [(\"Fred\", \"47/273\")] and now I want to add another tuple. </p>\n\n<p>I was trying to understand how the module dictionary works to see how I can extend this List and I stumbled upon \"data\" and \"type\". </p>\n\n<p>An idea I had was to create a several types of this <code>TelephonBook</code>:</p>\n\n<pre><code>let a = TelephoneBook (\"Fred\",\"42/2321\")\n</code></pre>\n\n<p>but that is just a simple idea... I am kinda lost on how to extend this list by another tuple, taking into account that once something is defined it can't be altered (or can it).</p>\n\n<p>(Please don't give the solution to the Problem but simply an idea on how to start or what I should Research further)</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484592989, "post_id": 41683217, "comment_id": 70563519, "body": "So if I understand correctly you take the length of <code>articles</code> and emit every &quot;article&quot; that occurs that often in the given list?"}, {"owner": {"reputation": 187, "user_id": 2712153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001812113067/picture?type=large", "display_name": "Vanhaeren Thomas", "link": "https://stackoverflow.com/users/2712153/vanhaeren-thomas"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484593156, "post_id": 41683217, "comment_id": 70563595, "body": "Yes, that is correct. Actually, the question is to find, given a list of articles, the Magasin (shop) that has all of them. My code works for one book in the list of articles: <code>disponible [&quot;HP7&quot;] [(E Proxis &quot;HP7&quot; 20), (E Libri &quot;HP7&quot; 50), (E Amazon &quot;Haskell&quot; 45), (E Proxis &quot;Haskell&quot; 45)]</code>  emits  <code>[(Libri,50.0),(Proxis,20.0)]</code> .  But if I give a List containing more than 1 article:  <code>disponible [&quot;HP7&quot;,&quot;Haskell&quot;] [(E Proxis &quot;HP7&quot; 20), (E Libri &quot;HP7&quot; 50), (E Amazon &quot;Haskell&quot; 45), (E Proxis &quot;Haskell&quot; 45)]</code> emits  <code>[(Libri,50.0),(Proxis,20.0),(Proxis,45.0),(Amazon,45.0)]</code>."}, {"owner": {"reputation": 187, "user_id": 2712153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001812113067/picture?type=large", "display_name": "Vanhaeren Thomas", "link": "https://stackoverflow.com/users/2712153/vanhaeren-thomas"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484593285, "post_id": 41683217, "comment_id": 70563670, "body": "So, it emits the shops that has either one or the other, not the shop that has both :/"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484593352, "post_id": 41683217, "comment_id": 70563707, "body": "what if there are multiple articles in the list that occur twice?"}, {"owner": {"reputation": 187, "user_id": 2712153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001812113067/picture?type=large", "display_name": "Vanhaeren Thomas", "link": "https://stackoverflow.com/users/2712153/vanhaeren-thomas"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484593582, "post_id": 41683217, "comment_id": 70563822, "body": "Maybe my approach is incorrect; I must return the shop(s) that has ALL the articles mentioned in the list of articles. My current code returns all the shop(s) that has either one of the articles. So if the shop A has Book1, shop A has Book2, shop C has Book1, shop D has Book2 and articles = [&quot;Book1&quot;, &quot;Book2&quot;], my code returns shop A, shop A, shop C, shop D - it should returns shop A twice (because two books) but no shop C or shop D."}, {"owner": {"reputation": 187, "user_id": 2712153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001812113067/picture?type=large", "display_name": "Vanhaeren Thomas", "link": "https://stackoverflow.com/users/2712153/vanhaeren-thomas"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484602080, "post_id": 41683217, "comment_id": 70567630, "body": "Found it: <code>disponible::[Article]-&gt;Stock-&gt;[(Magasin,Float)] disponible articles stock = map(\\(m,ls)-&gt;(m,sum $ map (\\(E _ _ p)-&gt;p) ls)) $ filter ((==length articles).length.snd) magasinsArticles      where contientArticles = (filter (\\(E _ a _)-&gt;a</code>elem<code>articles) stock)            magasins = foldl (\\acc e-&gt; if e</code>elem<code>acc then acc else (e:acc)) [] $ map (\\(E m _ _)-&gt;m) contientArticles            magasinsArticles = map (\\m-&gt;(m,filter(\\(E m2 _ _)-&gt;m2==m) contientArticles)) magasins</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1484603136, "post_id": 41683217, "comment_id": 70568102, "body": "Please put your answer as an answer, not as an edit to the question."}], "answers": [{"tags": [], "owner": {"reputation": 187, "user_id": 2712153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001812113067/picture?type=large", "display_name": "Vanhaeren Thomas", "link": "https://stackoverflow.com/users/2712153/vanhaeren-thomas"}, "is_accepted": true, "score": 0, "last_activity_date": 1485120158, "creation_date": 1485120158, "answer_id": 41796313, "question_id": 41683217, "link": "https://stackoverflow.com/questions/41683217/haskell-lists-count-fst-of-tuples-and-compare-with-length-of-list/41796313#41796313", "title": "Haskell Lists - Count fst of tuples and compare with length of list", "body": "<pre><code>disponible::[Article]-&gt;Stock-&gt;[(Magasin,Float)]\ndisponible articles stock = map(\\(m,ls)-&gt;(m,sum $ map (\\(E _ _ p)-&gt;p) ls)) $ filter ((==length articles).length.snd) magasinsArticles\n     where contientArticles = (filter (\\(E _ a _)-&gt;a`elem`articles) stock)\n           magasins = foldl (\\acc e-&gt; if e`elem`acc then acc else (e:acc)) [] $ map (\\(E m _ _)-&gt;m) contientArticles\n           magasinsArticles = map (\\m-&gt;(m,filter(\\(E m2 _ _)-&gt;m2==m) contientArticles)) magasins\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 2712153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001812113067/picture?type=large", "display_name": "Vanhaeren Thomas", "link": "https://stackoverflow.com/users/2712153/vanhaeren-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 41796313, "answer_count": 1, "score": 0, "last_activity_date": 1485120158, "creation_date": 1484592849, "last_edit_date": 1484602126, "question_id": 41683217, "link": "https://stackoverflow.com/questions/41683217/haskell-lists-count-fst-of-tuples-and-compare-with-length-of-list", "title": "Haskell Lists - Count fst of tuples and compare with length of list", "body": "<p>I have the following list: </p>\n\n<pre><code>[(Libri,50.0),(Proxis,20.0),(Proxis,45.0),(Amazon,45.0)]\n</code></pre>\n\n<p>And I have a certain List called <code>articles</code>.\nI want to transform the list above, with tuples so that if I have (length articles) times the first element of a tuple showing up in the list, get only that! </p>\n\n<p>So, for example, if I have a list <code>articles=[\"HP\",\"Haskell\"]</code>, the list should show:</p>\n\n<pre><code>[(Proxis,20.0),(Proxis,45.0)]\n</code></pre>\n\n<p>Because <code>Proxis</code> shows up two times!</p>\n\n<p>Edit: </p>\n\n<p>Data Types:</p>\n\n<pre><code>data Magasin = Proxis | Amazon | Libri deriving (Eq, Show)\ntype Article = String\ntype Prix = Float\ndata Entree = E Magasin Article Prix deriving (Eq, Show)\ntype Stock = [Entree]\n</code></pre>\n\n<p>This is my  current code: </p>\n\n<pre><code>disponible::[Article]-&gt;Stock-&gt;[(Magasin,Float)]\ndisponible [] stk = []\ndisponible (art:reste) stk = (foldl(\\acc (E m a p)-&gt;if a==art then (m,p):acc else acc) [] stk)++(disponible reste stk)\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>Edit:</p>\n\n<pre><code>disponible::[Article]-&gt;Stock-&gt;[(Magasin,Float)]\ndisponible articles stock = map(\\(m,ls)-&gt;(m,sum $ map (\\(E _ _ p)-&gt;p) ls)) $ filter ((==length articles).length.snd) magasinsArticles\n     where contientArticles = (filter (\\(E _ a _)-&gt;a`elem`articles) stock)\n           magasins = foldl (\\acc e-&gt; if e`elem`acc then acc else (e:acc)) [] $ map (\\(E m _ _)-&gt;m) contientArticles\n           magasinsArticles = map (\\m-&gt;(m,filter(\\(E m2 _ _)-&gt;m2==m) contientArticles)) magasins\n</code></pre>\n\n<p>Found the answer I was looking for.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 4, "creation_date": 1484593840, "post_id": 41683174, "comment_id": 70563945, "body": "Just a suggestion: Why don&#39;t you use a length-indexed list? Such data-types are isomorphic to tuples. It&#39;s easy to define it using GADTs."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1484605580, "creation_date": 1484605580, "answer_id": 41686003, "question_id": 41683174, "link": "https://stackoverflow.com/questions/41683174/new-type-class-with-instance-definition-generic-on-tuples-of-any-length/41686003#41686003", "title": "New type class with instance definition generic on tuples of any length", "body": "<p>The tuple types in Haskell don't really have any awareness of each other. Thankfully, for your particular case, you can solve your problem by using <code>GHC.Generics</code>. Then, you will actually be able to derive your <code>PartialOrder</code> class for <em>any</em> product type, not just tuples.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, DefaultSignatures, FlexibleContexts, \n             StandaloneDeriving, DeriveAnyClass\n  #-}\n\nimport GHC.Generics\nimport Data.Function (on)\n\ndata PartialOrdering\n  = POLessThan | POGreaterThan | POEqual | POIncomparable deriving (Eq, Show)\n\nclass PartialOrder a where\n  lessThanEq :: a -&gt; a -&gt; Bool\n\n  default lessThanEq :: (Generic a, GPartialOrder (Rep a)) =&gt; a -&gt; a -&gt; Bool\n  lessThanEq = gLessThanEq `on` from\n\n\n-- | Helper generic version of your class\nclass GPartialOrder f where\n  gLessThanEq :: f a -&gt; f a -&gt; Bool\n\n-- | Product types\ninstance (GPartialOrder a, GPartialOrder b) =&gt; GPartialOrder (a :*: b) where\n  gLessThanEq (a1 :*: b1) (a2 :*: b2) = gLessThanEq a1 a2 &amp;&amp; gLessThanEq b1 b2\n\n-- | Unary type (empty product)\ninstance GPartialOrder U1 where\n  gLessThanEq U1 U1 = True\n\n-- | Meta information on type\ninstance (GPartialOrder a) =&gt; GPartialOrder (M1 i c a) where\n  gLessThanEq (M1 a1) (M1 a2) = gLessThanEq a1 a2\n\n-- | Single type\ninstance (PartialOrder a) =&gt; GPartialOrder (K1 i a) where\n  gLessThanEq (K1 x1) (K1 x2) = lessThanEq x1 x2\n</code></pre>\n\n<p>With all that set up, one can automatically derive your class (with <code>-XDeriveAnyClass</code> enabled) if one derives <code>Generic</code> (which can be done with <code>-XDeriveGeneric</code>). Tuples types are already instances of generics, so with <code>-XStandaloneDeriving</code>, you can retro-actively derive instances of <code>Partial Order</code>. All of the below work</p>\n\n<pre><code>deriving instance (PartialOrder a, PartialOrder b) =&gt; PartialOrder (a,b)\nderiving instance (PartialOrder a, PartialOrder b, PartialOrder c) =&gt; PartialOrder (a,b,c)\n-- and so on...\n\ndata MyProduct a b = MyProduct a b deriving (Generic, PartialOrder) \n</code></pre>\n\n<p>After that, you can use your class, as expected:</p>\n\n<pre><code>ghci&gt; (POLessThan, POLessThan) `lessThanEq` (POEqual, POEqual)\nTrue\nghci&gt; (POLessThan, POEqual) `lessThanEq` (POEqual, POEqual)\nTrue\nghci&gt; (POLessThan, POEqual) `lessThanEq` (POEqual, POLessThan)\nFalse\n</code></pre>\n"}], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "accepted_answer_id": 41686003, "answer_count": 1, "score": 1, "last_activity_date": 1484605580, "creation_date": 1484592679, "last_edit_date": 1495539948, "question_id": 41683174, "link": "https://stackoverflow.com/questions/41683174/new-type-class-with-instance-definition-generic-on-tuples-of-any-length", "title": "New type class with instance definition generic on tuples of any length", "body": "<p>Is it possible to use a GHC extension to define a new type class that generalizes to tuples of arbitrary length?</p>\n\n<p>There have been a few questions already about the behavior of builtin classes in Prelude and Base (some classes support up to 15-element tuples, some up to 7) and about the (non-)possibility of extending these classes.</p>\n\n<p>Prelude and Base behavior:\n<a href=\"https://stackoverflow.com/questions/2978389/haskell-tuple-size-limit\">Haskell Tuple Size Limit</a></p>\n\n<p>extending Show with new definitions:\n<a href=\"https://stackoverflow.com/questions/30619843/extend-a-show-instance-to-a-tuple-of-any-size\">Extend a Show instance to a Tuple of any size</a></p>\n\n<p>I'm asking a slightly different question. If I'm making an entirely new type class, is it possible to add an instance rule that handles tuples of arbitrary length (possibly using a GHC extension)?</p>\n\n<p>Here's an example of such a class called PartialOrder. I want to allow tuples of arbitrary size to be partially compared using the following rule</p>\n\n<pre><code>(a,b ... , z) &lt;= (a1,b1, ... , z1) iff (a &lt;= a1) &amp;&amp; (b &lt;= b1) &amp;&amp; ... &amp;&amp; (z &lt;= z1)\n</code></pre>\n\n<p>Here's my first stab at a definition using the traditional \"define the class for tuples up to some arbitrary size\" approach.</p>\n\n<p>Is there a GHC extension that can be used to write instance definitions that cover tuples of arbitrary length?</p>\n\n<p>I think I can use Template Haskell or an external program to generate definitions in advance, but not generate them on demand like C++ templates.</p>\n\n<pre><code>-- Sets equipped with the (is_subset) operation are an example of a\n-- partial order.\n--\n-- {} &lt; {a}      less than\n-- {} = {}       equal to\n-- {a, b} &gt; {b}  greater than\n-- {a} ~ {b}     incomparable\n--\n-- in order to define a partial order we need a definition of (&lt;=)\n\ndata PartialOrdering = POLessThan | POGreaterThan | POEqual | POIncomparable deriving (Eq, Show)\n\nclass PartialOrder a where\n    lessThanEq :: a -&gt; a -&gt; Bool\n\ninstance PartialOrder PartialOrdering where\n    lessThanEq POIncomparable _ = False\n    lessThanEq _ POIncomparable = False\n\n    -- with incomparables dealt with...\n    lessThanEq POLessThan _ = True\n\n    lessThanEq POEqual POLessThan = False\n    lessThanEq POEqual _ = True\n\n    lessThanEq POGreaterThan POGreaterThan = True\n    lessThanEq POGreaterThan _ = False\n\n\n-- note this is different from the semantics for Ord applied to tuples,\n-- which uses lexicographic ordering.\n--\n-- (a,b) is less than or equal to (c,d) iff\n-- a &lt;= b and c &lt;= d\n\n-- 2 element tuple\ninstance (PartialOrder a, PartialOrder b) =&gt; PartialOrder (a, b) where\n    lessThanEq (a,b) (c,d) = (lessThanEq a c) &amp;&amp; (lessThanEq b d)\n\n-- 3 element tuple\ninstance (PartialOrder a, PartialOrder b, PartialOrder c) =&gt; PartialOrder (a, b, c) where\n    lessThanEq (a,b,c) (d,e,f) = (lessThanEq a d) &amp;&amp; (lessThanEq b e) &amp;&amp; (lessThanEq c f)\n\n-- 4 element tuple\ninstance (PartialOrder a, PartialOrder b, PartialOrder c, PartialOrder d) =&gt; PartialOrder (a, b, c, d) where\n    lessThanEq (a,b,c,d) (e,f,g,h) = (lessThanEq a e) &amp;&amp; (lessThanEq b f) &amp;&amp; (lessThanEq c g) &amp;&amp; (lessThanEq d h)\n\n\n-- etc.\n\n\nmain = putStrLn \"hi\"\n</code></pre>\n"}, {"tags": ["haskell", "thrift", "cabal", "haskell-stack", "stackage"], "comments": [{"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 2, "creation_date": 1484599460, "post_id": 41681126, "comment_id": 70566468, "body": "It seems that initially <code>remote-repo</code> referencing particular stackage snapshot [would use a hash of some sort]( <a href=\"https://www.fpcomplete.com/blog/2014/08/announcing-stackage-server\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2014/08/announcing-stackage-server</a>) (7ae494fec2db3161dfb8e64677149285857478e0) I believe that naming convention has been discontinued and snapshots <a href=\"https://www.stackage.org/lts-7.14/cabal.config?global=true\" rel=\"nofollow noreferrer\">are now referenced by name</a>"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1484609958, "creation_date": 1484585067, "last_edit_date": 1484609958, "question_id": 41681126, "link": "https://stackoverflow.com/questions/41681126/cabal-update-fails-with-404-error-trying-to-access-a-non-existing-file-when-comp", "title": "Cabal update fails with 404 error trying to access a non existing file when compiling Apache Thrift", "body": "<p>I'm trying to install <a href=\"https://thrift.apache.org\" rel=\"nofollow noreferrer\">Apache Thrift</a> on my system, which performs a <code>cabal update</code> command. This command fails with the following message:</p>\n\n<pre><code>Downloading the latest package list from stackage cabal: Failed to download\nhttp://www.stackage.org/stackage/7ae494fec2db3161dfb8e64677149285857478e0/00-index.tar.gz\n: ErrorMisc \"Error HTTP code: 404\"\n</code></pre>\n\n<p>I normally use <code>stack</code> and I never had to do a <code>cabal update</code> manually. I don't know if the interaction between <code>cabal</code> and <code>stack</code> is a problem here.</p>\n\n<p>Any ideas on how to fix this? </p>\n\n<p><em>EDIT</em>: Looking at my `~/.cabal/config~ I see the following entry:</p>\n\n<pre><code>remote-repo: stackage:http://www.stackage.org/stackage/7ae494fec2db3161dfb8e64677149285857478e0\n</code></pre>\n\n<p>So it seems that line is the culprit, but I don't know whether <code>stack</code> could have changed this for a good reason.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1484580945, "post_id": 41679658, "comment_id": 70556961, "body": "Yeah, this is it. Is there any downside to disabling the monomorphism restriction?"}, {"owner": {"reputation": 3295, "user_id": 7421086, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pLCBS.png?s=128&g=1", "display_name": "Kaynn", "link": "https://stackoverflow.com/users/7421086/kaynn"}, "edited": false, "score": 2, "creation_date": 1484581470, "post_id": 41679658, "comment_id": 70557284, "body": "There is not much downside to disabling it. But monomorphism restriction can sometimes be considered as your &#39;guideline&#39; for doing polymorphism. But most likely you won&#39;t encounter trouble with disabling it unless you are careless."}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "closed_date": 1484581874, "answer_count": 0, "score": 0, "last_activity_date": 1484580595, "creation_date": 1484580315, "last_edit_date": 1484580595, "question_id": 41679658, "link": "https://stackoverflow.com/questions/41679658/is-there-a-way-to-stop-haskell-from-complaining-about-the-type-being-ambiguous", "closed_reason": "Duplicate", "title": "Is there a way to stop Haskell from complaining about the type being ambiguous?", "body": "<pre><code>  first_forward_pass =\n    L.scanl' (L.foldl' fill_knapsack_without_parent_pointers)\n\n* Ambiguous type variable `t0' arising from a use of L.foldl'\n  prevents the constraint `(Foldable t0)' from being solved.\n</code></pre>\n\n<p>The compiler says that it wants me to specify the types to <code>L.fold'</code> which is annoying. I can't be bothered to specify the type for every little thing while I am writing stuff, so can I turn on some extension so it defers solving for the typeclass constraint until it actually needs it?</p>\n\n<p>Edit: I see now that once I use it with a list it specializes the second argument to a [[(Int,Int)]] even without type annotations. I thought it would end up being a generic [t (Int, Int)].</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484578947, "post_id": 41679211, "comment_id": 70555699, "body": "You might have several distinct instances with the same <code>a</code> and different <code>b</code>s. Hence, <code>empty :: a</code> is inherently ambiguous. Maybe you want to add a functional dependency <code>class Queue a b | a -&gt; b where ...</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1484579101, "post_id": 41679211, "comment_id": 70555789, "body": "Note that the suggested question starts from the solution for your problem (adding a functional dependency) and explains why it is necessary."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1484579281, "post_id": 41679211, "comment_id": 70555912, "body": "See also: <a href=\"http://stackoverflow.com/q/41592832/2751851\"><i>\u201cCould not deduce\u201d error on multi-parameter type class</i></a> (unlike the asker there, you need something like the first solution in the answer, rather than the second one)."}], "owner": {"reputation": 1, "user_id": 7425980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1453802e039a522df5c39ba64e9759?s=128&d=identicon&r=PG&f=1", "display_name": "Seir", "link": "https://stackoverflow.com/users/7425980/seir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "closed_date": 1484578934, "answer_count": 0, "score": 0, "last_activity_date": 1484579172, "creation_date": 1484578705, "last_edit_date": 1484579172, "question_id": 41679211, "link": "https://stackoverflow.com/questions/41679211/could-not-deduce-from-the-context-error", "closed_reason": "Duplicate", "title": "Could not deduce \u2026 from the Context error", "body": "<p>I have the following two modules, where <code>QueueA</code> is an instance of <code>Queue</code>.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts #-}\n\nmodule Queue where\n\nclass Queue a b where\n    empty :: a\n    (|&gt;) :: a -&gt; b -&gt; a\n    null :: a -&gt; Bool\n    head :: a -&gt; b\n    tail :: a -&gt; a\n    toList :: a -&gt; [b]\n</code></pre>\n\n<hr>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts #-}\n\nmodule QueueA where \n\nimport Queue\n\ndata QueueA b = QA {front :: [b], frontSize :: Int, rear :: [b], rearSize :: Int}\n\ninstance Queue (QueueA b) b where    \n\n    empty = QA [] 0 [] 0\n\n    (|&gt;) (QA f fSize r rSize) el = norm $ QA f fSize (el : r) (rSize + 1)\n\n    null (QA _ 0 _ 0) = True\n    null _ = False\n\n    head (QA a _ _ _) = Prelude.head a            \n\n    tail (QA f fSize r rSize) = norm $ QA (Prelude.tail f) (fSize - 1) r rSize      \n\n    toList (QA f _ r _) =  f ++ (reverse r)\n</code></pre>\n\n<p>It compiles, but when I try to use empty I get</p>\n\n<pre><code>Could not deduce (Queue a b0)\nfrom the context (Queue a b)\n  bound by the inferred type for \u2018it\u2019: Queue a b =&gt; a\n  at &lt;interactive&gt;:113:1-5\nThe type variable \u2018b0\u2019 is ambiguous\nWhen checking that \u2018it\u2019 has the inferred type\n  it :: forall a b. Queue a b =&gt; a\nProbable cause: the inferred type is ambiguous\n</code></pre>\n\n<p>And now I just don't know why it can't determine the type of the elements.\nWhat do I need to change?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1484577906, "post_id": 41678846, "comment_id": 70555037, "body": "See also: <a href=\"http://stackoverflow.com/q/940382/2751851\"><i>Haskell: difference between . (dot) and $ (dollar sign)</i></a>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1484577739, "creation_date": 1484577739, "answer_id": 41678895, "question_id": 41678846, "link": "https://stackoverflow.com/questions/41678846/couldnt-match-int-with-integer-int-but-works-in-ghci/41678895#41678895", "title": "Couldn&#39;t match `[Int]&#39; with `Integer -&gt; Int&#39; but works in GHCI", "body": "<p>You forgot the argument</p>\n\n<pre><code>digitalSum :: Integer -&gt; Int\ndigitalSum x = sum $ digits x\n</code></pre>\n\n<p>Alternatively, you can use function composition </p>\n\n<pre><code>digitalSum :: Integer -&gt; Int\ndigitalSum = sum . digits\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1484655322, "last_edit_date": 1484655322, "creation_date": 1484577905, "answer_id": 41678944, "question_id": 41678846, "link": "https://stackoverflow.com/questions/41678846/couldnt-match-int-with-integer-int-but-works-in-ghci/41678944#41678944", "title": "Couldn&#39;t match `[Int]&#39; with `Integer -&gt; Int&#39; but works in GHCI", "body": "<p>While <code>sum $ digits 123</code> works in GHCi (just as it will in a Haskell file), <code>sum $ digits</code> (which could just as well be written <code>sum digits</code>) won't work in GHCi either.</p>\n\n<p>The problem is that <code>sum</code> takes a list of numbers, but <code>digits</code> is not a list, it's a function.</p>\n\n<p>You want either <code>digitalSum x = sum $ digits x</code> or <code>digitalSum = sum . digits</code>. Here <code>.</code> is the function composition operator, which creates a function out of two existing functions (as opposed to <code>$</code>, which takes a function and its argument, not another function).</p>\n"}], "owner": {"reputation": 877, "user_id": 3083470, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2eaf3ff220e9b9e393be2c75694815ef?s=128&d=identicon&r=PG&f=1", "display_name": "Taxel", "link": "https://stackoverflow.com/users/3083470/taxel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 41678944, "answer_count": 2, "score": 0, "last_activity_date": 1484655322, "creation_date": 1484577576, "question_id": 41678846, "link": "https://stackoverflow.com/questions/41678846/couldnt-match-int-with-integer-int-but-works-in-ghci", "title": "Couldn&#39;t match `[Int]&#39; with `Integer -&gt; Int&#39; but works in GHCI", "body": "<p>I am new to Haskell so this question should be fairly trivial to most Haskell programmers:\nI've got a function <code>digits :: Integer -&gt; [Int]</code> which converts an integer to a list of its digits (123 to [1,2,3]). To now get the sum of those digits I enter <code>sum $ digits 123</code> in ghci and everything works, it outputs 6. As soon as I create the function in a file as follows, however, I get an error. It probably has to do with the fact that ghci infers a type for 123, but that is not enough so I can fix the problem.</p>\n\n<p>The function in a text file:</p>\n\n<pre><code>digitalSum :: Integer -&gt; Int\ndigitalSum = sum $ digits\n</code></pre>\n\n<p>and the error:</p>\n\n<pre><code>* Couldn't match type `[Int]' with `Integer -&gt; Int'\n  Expected type: Integer -&gt; Integer -&gt; Int\n    Actual type: Integer -&gt; [Int]\n* In the second argument of `($)', namely `digits'\n  In the expression: sum $ digits\n  In an equation for `digitalSum': digitalSum = sum $ digits\n</code></pre>\n"}, {"tags": ["json", "haskell", "yesod"], "comments": [{"owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484571764, "post_id": 41676998, "comment_id": 70551132, "body": "Please note that I have tried using <code>liftIO</code> , but it also did not fix the issue"}], "answers": [{"comments": [{"owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484573890, "post_id": 41677341, "comment_id": 70552439, "body": "Thanks fo the response. I tried both the approaches. Now I am getting this error:  Couldn&#39;t match type \u2018IO\u2019 with \u2018HandlerT HelloWorld IO\u2019       Expected type: HandlerT                        HelloWorld IO (Either IOException [FilePath])         Actual type: IO (Either IOException [FilePath])"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484574347, "post_id": 41677341, "comment_id": 70552703, "body": "@ChetanYewale I&#39;m thinking then you would need <code>files &lt;- liftIO . getListOfFiles =&lt;&lt; (fmap ...)</code> then. Sorry I assumed <code>lookupGetParam</code> returned a type of <code>IO</code>."}, {"owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484574839, "post_id": 41677341, "comment_id": 70553029, "body": "Thank you so much. That worked. I wanted to ask you something, I am new to Haskell. I understand the functional programming style. I also understand Functors and Applicatives. I am a somewhat uncomfortable with Monads.  Are there any practice problems that I can do which will gradually help me become better at these concepts? Let me know.. I wish to start with small problems which use Applicatives/Functors/Monads. I also want to understand the typesystem better and avoid the kind of issues that I posted. Is there something that you can suggest?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484575867, "post_id": 41677341, "comment_id": 70553704, "body": "@ChetanYewale What had worked best for me was actually implementing a few instances of the <code>Monad</code> typeclass to remove some of the &quot;magic&quot;. Beside that, doing exactly what it seems you&#39;re doing - working through things as they come up (at least, nothing ever seems to stick for me unless I&#39;ve actually <i>used</i> it to solve a problem)."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484575875, "post_id": 41677341, "comment_id": 70553712, "body": "@ChetanYewale Are you comfortable using the monadic properties of say, <code>Maybe</code> and <code>Either</code> - the concept of once you get to a certain state, you &quot;can&#39;t&quot; go any further? It comes down to the <code>&gt;&gt;= :: m a -&gt; (a -&gt; m b) -&gt; m b</code>. Given an <code>m a</code>, you need to be able to get an <code>a</code> to pass to the second parameter to get an <code>m b</code>, but in the <code>Maybe a</code> or <code>Either b a</code> case, if you have a <code>Nothing</code> or a <code>Left b</code> you <i>don&#39;t have an <code>a</code></i> to pass along, so you have no choice but to stop."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484576332, "post_id": 41677341, "comment_id": 70554018, "body": "@ChetanYewale Also, there is a technique for wrapping your transformer stack in a <code>newtype</code> and then <code>deriving</code> the instances you need/use which frequently lets your avoid the <code>liftIO</code>s and can make some helper functions much clearer. I remember seeing a great slideshow/presentation a while ago but can&#39;t seem to find it now... the quickest example I could Google up was: <a href=\"https://robots.thoughtbot.com/refactoring-to-a-monad-transformer-stack\" rel=\"nofollow noreferrer\">robots.thoughtbot.com/refactoring-to-a-monad-transformer-sta&zwnj;&#8203;ck</a>"}, {"owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484577458, "post_id": 41677341, "comment_id": 70554724, "body": "Thanks, I will check it. Yes, I am comfortable with <code>Maybe</code> and <code>Either</code> . I sure have a long way to go in Haskell :-)  I see the brilliance of Haskell. Although I understand only basic things in Haskell, it certainly has opened a new world and a new way to think."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484577949, "post_id": 41677341, "comment_id": 70555063, "body": "@ChetanYewale To be clear - comfortable from the perspective that you can implement the <code>Functor</code>/<code>Applicative</code>/<code>Monad</code> instances yourself? And if so, you could look into <code>Reader</code>/<code>Writer</code>/<code>State</code>. <code>ST</code> and <code>IO</code> I believe get tricky because the implementation in GHC uses some unboxed primitives. And if individually they are easy you could try stacking them manually."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 2, "last_activity_date": 1484574644, "last_edit_date": 1484574644, "creation_date": 1484572723, "answer_id": 41677341, "question_id": 41676998, "link": "https://stackoverflow.com/questions/41676998/getting-error-due-to-io-a-type-of-parameter/41677341#41677341", "title": "Getting error due to IO a type of parameter", "body": "<p>I think the issue is that <code>getListOfFiles</code> returns a value of type <code>IO</code>, and by using it with <code>fmap</code> you are creating a <code>Handler (IO _)</code>, and the binding in the <code>do</code> block only unwraps the <code>Handler</code> level.</p>\n\n<p>You could try <code>join</code>ing the two levels of the <code>fmap</code> result, like:</p>\n\n<pre><code>files &lt;- join $ fmap (liftIO. ...\n</code></pre>\n\n<p>Or move the <code>getListOfFiles</code> call outside the <code>fmap</code> application, like:</p>\n\n<pre><code>files &lt;- liftIO . getListOfFiles =&lt;&lt; (fmap ...)\n</code></pre>\n"}], "owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 41677341, "answer_count": 1, "score": 1, "last_activity_date": 1484578109, "creation_date": 1484571613, "last_edit_date": 1484578109, "question_id": 41676998, "link": "https://stackoverflow.com/questions/41676998/getting-error-due-to-io-a-type-of-parameter", "title": "Getting error due to IO a type of parameter", "body": "<p>I am implementing a feature which is as follows:\nUser will request for the directory contents via HTTP request. The directory path will be passed inthe request. In response, I will send a JSON containing the list of files for that directory path. IO Error handling is taken care of.\nI have implemented most of the part. But I am getting an error. The error is:</p>\n\n<blockquote>\n<pre><code>Couldn't match expected type \u2018Either IOException [FilePath]\u2019\n            with actual type \u2018IO (Either IOException [FilePath])\u2019\n\u2022 In the first argument of \u2018getJsonRepForFiles\u2019, namely \u2018files\u2019\n</code></pre>\n</blockquote>\n\n<p>The code snippet is as follows:</p>\n\n<pre><code>getInfoOfDirR::Handler Value\ngetInfoOfDirR = do\n             -- files will have type IO (Either IOException [FilePath])\n                     files &lt;- fmap (getListOfFiles.(Data.Text.unpack).fromJust) $ lookupGetParam \"dirpath\"\n                     getJsonRepForFiles files\n</code></pre>\n\n<p>The function which gets list of files:</p>\n\n<pre><code>-- This eliminates the hidden files from the results\ngetListOfFiles::FilePath -&gt; IO (Either IOException [FilePath])\ngetListOfFiles fpath = try (fmap (filter $ not.isHiddenFile) $  FS.getDirectoryContents fpath)::IO (Either IOException [FilePath])\n</code></pre>\n\n<p>The function which gets JSON representation of the files in the directory:</p>\n\n<pre><code>getJsonRepForFiles::Monad m =&gt; (Either IOException [FilePath]) -&gt; m Value\ngetJsonRepForFiles (Left e) = returnJson $ \"An error occurred\" ++ show e\ngetJsonRepForFiles (Right files) = returnJson files\n</code></pre>\n\n<p>Note that type of <code>getInfoOfDirR</code> is <code>Handler Value</code>\nI am implementing this in Haskell's Yesod framework.\nI am new to Haskell.. I understand somewhat why I am getting the error.\nBut I am not able to fix it.\nPlease help.\nThanks in Advance.</p>\n"}, {"tags": ["haskell", "typeclass", "arrows"], "answers": [{"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": true, "score": 7, "last_activity_date": 1484962493, "last_edit_date": 1484962493, "creation_date": 1484589642, "answer_id": 41682391, "question_id": 41675391, "link": "https://stackoverflow.com/questions/41675391/right-tightening-arrowloop-law/41682391#41682391", "title": "Right-tightening ArrowLoop law", "body": "<p>This is multi-faceted question with several different angles, and it goes back to the value-recursion (<code>mfix</code>/<code>mdo</code>) in Haskell. See <a href=\"https://wiki.haskell.org/MonadFix\" rel=\"nofollow noreferrer\">here</a> for background information. I'll try to address the right-tightening issue here in some detail.</p>\n\n<h2>Right-tightening for mfix</h2>\n\n<p>Here's the right-tightening property for <code>mfix</code>:</p>\n\n<pre><code>mfix (\u03bb(x, y). f x &gt;&gt;= \u03bbz. g z &gt;&gt;= \u03bbw. return (z, w))\n    = mfix f &gt;&gt;= \u03bbz. g z &gt;&gt;= \u03bbw. return (z, w)\n</code></pre>\n\n<p>Here it is in picture form:</p>\n\n<p><a href=\"https://i.stack.imgur.com/xwNdh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xwNdh.png\" alt=\"Right shrinking law, diagrammatically\"></a></p>\n\n<p>The dotted-lines show where the \"knot-tying\" is happening. This is essentially the same law as mentioned in the question, except it is expressed in terms of <code>mfix</code> and value-recursion. As shown in <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">Section 3.1 of this work</a>, for a monad with a strict bind operator, you can always write an expression that distinguishes the left-hand side of this equation from the right hand-side, thus failing this property. (See below for an actual example in Haskell.)</p>\n\n<p>When an arrow is created via the Kleisli construction from a monad with <code>mfix</code>, the corresponding <code>loop</code> operator fails the corresponding property in the same way.</p>\n\n<h2>Domain-theory and approximations</h2>\n\n<p>In domain theoretic terms, the mismatch will always be an approximation. </p>\n\n<p>That is, the left hand-side will always be less defined than the right. (More precisely, the lhs will be lower than the rhs, in the domain of PCPOs, the typical domain we use for Haskell semantics.) In practice, this means that the right hand side will terminate more often, and is to be preferred when that is an issue. Again, see Section 3.1 of <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">this</a> for details.</p>\n\n<h2>In practice</h2>\n\n<p>This may sound all abstract, and in a certain sense it is. More intuitively, the left hand side <em>gets a chance</em> to act on the recursive value as it is being produced since <code>g</code> is inside the \"loop,\" and thus is able to interfere with the fixed-point computation. Here's an actual Haskell program to illustrate:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad.Fix\n\nf :: [Int] -&gt; IO [Int]\nf xs = return (1:xs)\n\ng :: [Int] -&gt; IO Int\ng [x] = return x\ng _   = return 1\n\nlhs = mfix (\\(x, y) -&gt; f x &gt;&gt;= \\z -&gt; g z &gt;&gt;= \\w -&gt; return (z, w))\nrhs = mfix f &gt;&gt;= \\z -&gt; g z &gt;&gt;= \\w -&gt; return (z, w)\n</code></pre>\n\n<p>If you evaluate the <code>lhs</code> it will never terminate, while <code>rhs</code> will give you the infinite list of 1's as expected:</p>\n\n<pre><code>*Main&gt; :t lhs\nlhs :: IO ([Int], Int)\n*Main&gt; lhs &gt;&gt;= \\(xs, y) -&gt; return (take 5 xs, y)\n^CInterrupted.\n*Main&gt; rhs &gt;&gt;= \\(xs, y) -&gt; return (take 5 xs, y)\n([1,1,1,1,1],1)\n</code></pre>\n\n<p>I interrupted the computation in the first case as it is non-terminating. While this is a contrived example, it is the simplest to illustrate the point. (See below for a rendering of this example using the <code>mdo</code>-notation, which might be easier to read.)</p>\n\n<h2>Example monads</h2>\n\n<p>Typical examples of monads that <strong>do not</strong> satisfy this law include <code>Maybe</code>, <code>List</code>, <code>IO</code>, or any other monad that's based on an algebraic type with multiple constructors. Typical examples of monads that <strong>do</strong> satisfy this law are <code>State</code> and <code>Environment</code> monads. See <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">Section 4.10</a> for a table summarizing these results.</p>\n\n<h2>Pure-right shrinking</h2>\n\n<p>Note that a \"weaker\" form of right-tightening, where the function <code>g</code> in the above equation is pure, follows from value-recursion laws:</p>\n\n<pre><code>mfix (\u03bb(x, y). f x &gt;&gt;= \u03bbz. return (z, h z))\n  = mfix f &gt;&gt;= \u03bbz. return (z, h z)\n</code></pre>\n\n<p>This is the same law as before with, <code>g = return . h</code>. That is <code>g</code> cannot perform any effects. In this case, there is no way to distinguish the left-hand side from the right as you might expect; and the result indeed follows from value-recursion axioms. (See <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">Section 2.6.3</a> for a proof.) The picture in this case looks like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/KPkc8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KPkc8.png\" alt=\"Pure-right shrinking\"></a></p>\n\n<p>This property follows from the sliding property, which is a version of dinaturality for value-recursion, and is known to be satisfied by many monads of interest: <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">Section 2.4</a>.</p>\n\n<h2>Impact on the mdo-notation</h2>\n\n<p>The failure of this law has an impact on how the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#the-mdo-notation\" rel=\"nofollow noreferrer\">mdo notation</a> was designed in GHC. The translation includes the so called \"segmentation\" step precisely to avoid the failure of the right-shrinking law. Some people consider that a bit controversial as GHC automatically picks the segments, essentially applying the right-tightening law. If explicit control is needed, GHC provides the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#recursive-binding-groups\" rel=\"nofollow noreferrer\"><code>rec</code> keyword</a> to leave the decision to the users.</p>\n\n<p>Using the <code>mdo</code>-notation and explicit <code>do rec</code>, the above example renders\nas follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE RecursiveDo #-}\n\nf :: [Int] -&gt; IO [Int]\nf xs = return (1:xs)\n\ng :: [Int] -&gt; IO Int\ng [x] = return x\ng _   = return 1\n\n\nlhs :: IO ([Int], Int)\nlhs = do rec x &lt;- f x\n             w &lt;- g x\n         return (x, w)\n\nrhs :: IO ([Int], Int)\nrhs = mdo x &lt;- f x\n          w &lt;- g x\n          return (x, w)\n</code></pre>\n\n<p>One might naively expect that <code>lhs</code> and <code>rhs</code> above should be the same, but due to the failure of the right-shrinking law, they are not. Just like before, <code>lhs</code> gets stuck, while <code>rhs</code> successfully produces the value:</p>\n\n<pre><code>*Main&gt; lhs &gt;&gt;= \\(x, y) -&gt; return (take 5 x, y)\n^CInterrupted.\n*Main&gt; rhs &gt;&gt;= \\(x, y) -&gt; return (take 5 x, y)\n([1,1,1,1,1],1)\n</code></pre>\n\n<p>Visually inspecting the code, we see that the recursion is simply for the function <code>f</code>, which justifies the segmentation that is automatically performed by the <code>mdo</code>-notation.</p>\n\n<p>If the <code>rec</code> notation is to be preferred, the programmer will need to put it in minimal blocks to ensure termination. For instance, the above expression for <code>lhs</code> should be written as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>lhs :: IO ([Int], Int)\nlhs = do rec x &lt;- f x\n         w &lt;- g x\n         return (x, w)\n</code></pre>\n\n<p>The <code>mdo</code>-notation takes care of this and places the recursion over minimal blocks without user intervention.</p>\n\n<h2>Failure for Kleisli Arrows</h2>\n\n<p>After this lengthy detour, let us now go back to the original question about the corresponding law for arrows. Similar to the <code>mfix</code> case, we can construct a failing example for Kleisli arrows as well. In fact, the above example translates more or less directly:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE Arrows #-}\nimport Control.Arrow\n\nf :: Kleisli IO ([Int], [Int]) ([Int], [Int])\nf = proc (_, ys) -&gt; returnA -&lt; (ys, 1:ys)\n\ng :: Kleisli IO [Int] Int\ng = proc xs -&gt; case xs of\n                 [x] -&gt; returnA -&lt; x\n                 _   -&gt; returnA -&lt; 1\n\nlhs, rhs :: Kleisli IO [Int] Int\nlhs = loop (f &gt;&gt;&gt; first g)\nrhs = loop f &gt;&gt;&gt; g\n</code></pre>\n\n<p>Just like in the case of <code>mfix</code>, we have:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt; runKleisli rhs []\n1\n*Main&gt; runKleisli lhs []\n^CInterrupted.\n</code></pre>\n\n<p>The failure of right-tightening for <code>mfix</code> of the IO-monad also prevents the <code>Kleisli IO</code> arrow from satisfying the right-tightening law in the <code>ArrowLoop</code> instance.</p>\n"}], "owner": {"reputation": 642, "user_id": 473180, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4628fa2d983c78810b18ab3902f0c9a8?s=128&d=identicon&r=PG", "display_name": "themarketka", "link": "https://stackoverflow.com/users/473180/themarketka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 3, "accepted_answer_id": 41682391, "answer_count": 1, "score": 8, "last_activity_date": 1484962493, "creation_date": 1484566188, "last_edit_date": 1484579552, "question_id": 41675391, "link": "https://stackoverflow.com/questions/41675391/right-tightening-arrowloop-law", "title": "Right-tightening ArrowLoop law", "body": "<p>According to the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Arrow.html#t:ArrowLoop\" rel=\"noreferrer\"><code>Control.Arrow</code></a> documentation, for many monads (those for which the <code>&gt;&gt;=</code> operation is strict) the <code>instance MonadFix m =&gt; ArrowLoop (Kleisli m)</code> does not satisfy the right-tightening law (<code>loop (f &gt;&gt;&gt; first h) = loop f &gt;&gt;&gt; h</code>) required by the <code>ArrowLoop</code> class. Why is that so?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 5, "last_activity_date": 1484568005, "creation_date": 1484568005, "answer_id": 41675966, "question_id": 41674321, "link": "https://stackoverflow.com/questions/41674321/explicitly-depend-on-extra-source-file-when-recompiling/41675966#41675966", "title": "Explicitly depend on extra source file when recompiling", "body": "<p>You can use the addDependentFile function.</p>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-7.15/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#v:addDependentFile\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-7.15/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#v:addDependentFile</a></p>\n"}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 41675966, "answer_count": 1, "score": 3, "last_activity_date": 1484568005, "creation_date": 1484562729, "question_id": 41674321, "link": "https://stackoverflow.com/questions/41674321/explicitly-depend-on-extra-source-file-when-recompiling", "title": "Explicitly depend on extra source file when recompiling", "body": "<p>Say I have an extra file describing some data structure. In one Haskell module I have a TH declaration that takes the contents of that file and generates data types.</p>\n\n<p>How do I force that module to recompile every time that external file changes?</p>\n"}, {"tags": ["haskell", "purescript"], "answers": [{"tags": [], "owner": {"reputation": 4314, "user_id": 139614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3f2ea13b0b182e926e8bd5ff59be201?s=128&d=identicon&r=PG", "display_name": "gb.", "link": "https://stackoverflow.com/users/139614/gb"}, "is_accepted": false, "score": 2, "last_activity_date": 1484532528, "creation_date": 1484532528, "answer_id": 41668507, "question_id": 41668064, "link": "https://stackoverflow.com/questions/41668064/purescript-understanding-why-no-type-class-instance-was-found/41668507#41668507", "title": "Purescript, understanding why no type class instance was found", "body": "<p>There is no <code>MonadEff</code> instance for <code>Free</code>, so you cannot use <code>liftEff</code> in <code>ComponentDSL</code>, as it is a synonym for a <code>Free</code>.</p>\n\n<p>This is changing in the next Halogen release, and <code>ComponentDSL</code> will have a <code>MonadEff</code> instance. For the currently released version (v0.12.0) the solution is to use the <code>fromEff</code> function instead, which is mentioned in the <a href=\"https://github.com/slamdata/purescript-halogen/blob/v0.12.0/GUIDE.md#non-state-effects\" rel=\"nofollow noreferrer\">\"Non-state effects\" section of the guide</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 7423178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b7c46f8a9674582a66cef10c54bcb6?s=128&d=identicon&r=PG&f=1", "display_name": "user7423178", "link": "https://stackoverflow.com/users/7423178/user7423178"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1484532528, "creation_date": 1484527935, "last_edit_date": 1484528141, "question_id": 41668064, "link": "https://stackoverflow.com/questions/41668064/purescript-understanding-why-no-type-class-instance-was-found", "title": "Purescript, understanding why no type class instance was found", "body": "<p>I'm trying to build a simple Purescript app, and I cannot figure out why I keep getting a typeclass instance error.</p>\n\n<p>Specifically, inside of my <code>Component</code> I am defining the <code>eval</code> function to operate on my query algebra. In the process, I just log something to the console for fun.</p>\n\n<pre><code>type AppEffects eff = (HalogenEffects (console :: CONSOLE | eff))\n\ndata Query a = DoSomething a\n\neval :: Query ~&gt; H.ComponentDSL State Query (Aff (AppEffects eff))\neval (DoSomething a) = do\n    liftEff $ log \"print me out!\"\n    -- do some stuff with the action\n    pure next\n</code></pre>\n\n<p>When I run this, the compiler shouts:</p>\n\n<pre><code>No type class instance was found for\n\n    Control.Monad.Eff.Class.MonadEff ( \"console\" :: CONSOLE         \n                                     | t0                           \n                                     )                              \n                                     (Free                          \n                                        (HalogenFP EventSource      \n                                           { \"someState\" :: String  \n                                           }                        \n                                           Query                    \n                                           (Aff                     \n                                              ( \"avar\" :: AVAR      \n                                              , \"err\" :: EXCEPTION  \n                                              , \"dom\" :: DOM        \n                                              , \"console\" :: CONSOLE\n                                              | eff1                \n                                              )                     \n                                           )                        \n                                        )                           \n                                     )                              \n\nThe instance head contains unknown type variables. Consider adding a type annotation.\n</code></pre>\n\n<p>So I specified a type:</p>\n\n<pre><code>tryPrint :: Eff (console :: CONSOLE | eff) Unit\ntryPrint = log \"print me out!\"\n</code></pre>\n\n<p>However, the compiler still tells me I need to implement an instance for the <code>MonadEff</code> typeclass. I don't really understand this error. Could anyone point me in the right direction?</p>\n"}, {"tags": ["haskell", "nlp", "neural-network", "perceptron"], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 3, "last_activity_date": 1484521877, "creation_date": 1484521877, "answer_id": 41667403, "question_id": 41666937, "link": "https://stackoverflow.com/questions/41666937/perceptron-with-unigram-features-how-does-it-learn-and-what-are-the-next-steps/41667403#41667403", "title": "Perceptron with unigram features, how does it learn and what are the next steps?", "body": "<blockquote>\n  <p>1) What part of this code 'learns'?</p>\n</blockquote>\n\n<p>Learning is achieved by adjusting the weights to make the perceptron's output on the training data become closer to the desired output.</p>\n\n<blockquote>\n  <p>2) What's the 'next stage' of NLP algorithms?</p>\n</blockquote>\n\n<p>I don't know anything about NLP algorithms, but perceptrons are the building blocks of neural networks. I think the next thing you'll want to look at is feed-forward back propagation neural networks. They consist of layers of connected perceptrons. Brush up on your linear algebra and multi-variable  calculus because adjusting the weights is a bit more involved!</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 1, "accepted_answer_id": 41667403, "answer_count": 1, "score": 0, "last_activity_date": 1484521877, "creation_date": 1484518578, "question_id": 41666937, "link": "https://stackoverflow.com/questions/41666937/perceptron-with-unigram-features-how-does-it-learn-and-what-are-the-next-steps", "title": "Perceptron with unigram features, how does it learn and what are the next steps?", "body": "<p>I'm learning about basic NLP algorithms, specifically simple perceptrons with unigram features.</p>\n\n<p>I've looked over the basic's of perceptrons from <a href=\"http://www.phontron.com/slides/nlp-programming-en-05-perceptron.pdf\" rel=\"nofollow noreferrer\">this</a> and <a href=\"http://pageperso.lif.univ-mrs.fr/~alexis.nasr/Ens/M2/collins-perceptron.pdf\" rel=\"nofollow noreferrer\">this</a>.</p>\n\n<p>This is my simple Haskell perceptron, adapted from <a href=\"http://jpmoresmau.blogspot.co.uk/2007/05/perceptron-in-haskell.html\" rel=\"nofollow noreferrer\">this</a> source:</p>\n\n<pre><code>type Inputs = [Float] \ntype Weights = [Float]\ntype Threshold = Float\ntype LearnRate = Float\ntype Expected = Float\ntype Actual = Float\n\nneuronOutput :: (Num a, Ord a) =&gt; Inputs -&gt; Weights -&gt; Threshold -&gt; a \n--neuronOutput :: (Num a, Ord a) =&gt; [a] -&gt; [a] -&gt; a -&gt; a --Parametic polymorphic \nneuronOutput inputs weights thresh\n| total - thresh &gt;= 0                       = 1\n| otherwise                                 = 0\nwhere\n    total = foldl (+) 0 $ zipWith (*) inputs weights\n\n\nadjustWeights :: Inputs -&gt; Weights -&gt; Expected -&gt; Actual -&gt; LearnRate -&gt; Weights --Adjust the weights \n--adjustWeights :: (Num a) =&gt; [a] -&gt; [a] -&gt; a -&gt; a -&gt; a -&gt; [a] --Parametic polymorphic \nadjustWeights inputs orgiWeights expected actual learn = map delta $ zip inputs orgiWeights\nwhere \n    delta (i, w) = w + (learn * i * e)\n    e = expected - actual\n\n\nsingleIteration :: Inputs -&gt; Weights -&gt; Expected -&gt; LearnRate -&gt; Threshold -&gt; Weights   --Return adjusted weights based on neuronOutput\n--singleIteration :: (Num a, Ord a) =&gt; [a] -&gt; [a] -&gt; a -&gt; a -&gt; a -&gt; [a] --Parametic polymorphic \nsingleIteration inputs weights expectd learn thresh = adjustWeights inputs weights expectd output learn\n  where \n     output = neuronOutput inputs weights thresh\n\n\n\nimplementIterations :: [(Inputs, Expected)] -&gt; Weights -&gt; LearnRate -&gt; Threshold -&gt; (Inputs, Expected) --Applies singleIteration to each input set\nimplementIterations allInputs weights learnR thresH = (newWeights, delta)\n where\n    newWeights = foldl iterate weights allInputs\n    iterate w (i, e) = singleIteration i w e learnR thresH\n    delta = (foldl (+) 0 $ map abs $ zipWith (-) newWeights weights) / (fromIntegral $ length weights) --Func composition here to make better?\n\n\nrunLearning :: [(Inputs, Expected)] -&gt; LearnRate -&gt; Threshold -&gt; Weights -&gt; Int -&gt; (Inputs, Int)\nrunLearning allInputs learnR thresH weights epochNb\n  | delta == 0              = (newWeights, epochNb)\n  | otherwise               = runLearning allInputs learnR thresH newWeights (epochNb + 1) --Recusive changing weights each time\n  where\n    (newWeights, delta) = implementIterations allInputs weights learnR thresH\n\n\nmain = do\n  let inputs = [([1, 1, 1], 1), ([0, 0, 0], -1)]\n  let weights = [1, 1, 1, 0, 0, -4]\n  print  $ runLearning inputs 0.1 0.2 weights 1\n</code></pre>\n\n<p>My questions are:</p>\n\n<p>1) What part of this code 'learns'? I understand each feature has an associated weight (positive or negative), however I don't see how each iteration learns from the priors result? </p>\n\n<p>2) What's the 'next stage' of NLP algorithms? I.e. I understand single layer perceptrons are very simple, what other neural nets structures and/or different algorithms should I be looking at for more accurate classifiers?</p>\n"}, {"tags": ["haskell", "exception-handling"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484510917, "post_id": 41665344, "comment_id": 70529720, "body": "To make this work, you probably just need <code>main = recoverAll (exponentialBackoff 50 &lt;&gt; limitRetries 5) (const stuff)</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484511445, "post_id": 41665344, "comment_id": 70529863, "body": "Hmm, I think that worked.  I couldn&#39;t import Data.Monoid (&lt;&gt;) it seems, had to use import Data.Monoid (mappend)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484511502, "post_id": 41665344, "comment_id": 70529886, "body": "You probably forgot the extra set of parens you need around operators you import: <code>import Data.Monoid ((&lt;&gt;))</code>. :)"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484511668, "post_id": 41665344, "comment_id": 70529947, "body": "I&#39;m using <code>die &quot;error happened&quot;</code> inside my stuff function.  Any chance you have recommendations for something better: is it a better idea maybe if <code>stuff -&gt; IO Bool</code> rather than file system die commands?  It seems to work, but seems inelegant."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484527141, "post_id": 41665344, "comment_id": 70533983, "body": "Depends what you are doing. Personally, I don&#39;t see any reason to avoid <code>error</code> if you are describing an exception that should fail pretty hard. I generally choose between <code>Control.Monad.Except</code>, <code>Control.Exception</code> (<code>IO</code> related),  and <code>error</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484528697, "post_id": 41665344, "comment_id": 70534315, "body": "@Alec, I disagree firmly about <code>error</code>, which I believe should only be used for internal errors (cases that should be impossible). 1. It can be difficult to turn a non-recoverable error expressed using <code>error</code> into a recoverable one if your needs change--the program may have to be restructured. 2. Errors are likely to be thrown late (as a result of laziness), which makes debugging hard and can cause a program to behave badly when an old error thunk gets forced in the middle of some sensitive I/O action."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484610117, "post_id": 41665344, "comment_id": 70570748, "body": "@dfeuer, do you have recommended reading on how to do it properly?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484610158, "post_id": 41665344, "comment_id": 70570757, "body": "@Alec, if you make your comment an answer, I&#39;ll accept."}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484508645, "creation_date": 1484508320, "last_edit_date": 1484508645, "question_id": 41665344, "link": "https://stackoverflow.com/questions/41665344/sample-of-using-limitretries-in-haskell-from-control-retries", "title": "Sample of using limitRetries in Haskell from Control.Retries", "body": "<p>The Retry package looks neat:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/retry-0.7/candidate/docs/Control-Retry.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/retry-0.7/candidate/docs/Control-Retry.html</a></p>\n\n<p>I have a typical </p>\n\n<pre><code>main :: IO ()\nmain = do \n  stuff\n</code></pre>\n\n<p>I'd like to retry it 5 times with exponential backoff.</p>\n\n<p>I understand there's a policy for:</p>\n\n<pre><code>exponentialBackoff\nlimitRetries\n</code></pre>\n\n<p>And a policy transformer for:</p>\n\n<pre><code>limitRetriesByDelay\n</code></pre>\n\n<p>I also understand </p>\n\n<blockquote>\n  <p>The default under def implements a constant 50ms delay, up to 5 times</p>\n</blockquote>\n\n<p>First: How can I wrap my <code>main</code> in this (or my <code>stuff</code> function) in order to retry 5 times with exponential backoff?</p>\n\n<p>Second: is this a good package for dealing with failure, or are other exception-handling techniques better or more idiomatic?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484505471, "post_id": 41664781, "comment_id": 70527841, "body": "I&#39;m very confused by the String <code>&quot;[[&quot;2&quot;, &quot;=SUM(A0:C0)&quot;, &quot;1&quot;], [&quot;7&quot;, &quot;2&quot;, &quot;3&quot;], [&quot;2&quot;, &quot;=SUM(A0:B0)&quot;, &quot;&quot;]]&quot;</code>. It seems to be invalid."}, {"owner": {"reputation": 145, "user_id": 3816416, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d7eab7587d5591a0caf01186a8d26abf?s=128&d=identicon&r=PG&f=1", "display_name": "rocksparrow", "link": "https://stackoverflow.com/users/3816416/rocksparrow"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484505779, "post_id": 41664781, "comment_id": 70527971, "body": "@eli-sadoff, Yes, I just want to indicate that this is a String. In the file it looks like: [[&quot;2&quot;, &quot;=SUM(A0:C0)&quot;, &quot;1&quot;], [&quot;7&quot;, &quot;2&quot;, &quot;3&quot;], [&quot;2&quot;, &quot;=SUM(A0:B0)&quot;, &quot;&quot;]]. When I upload it from file the way I presented in question it is of String type."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1484506127, "post_id": 41664781, "comment_id": 70528104, "body": "The terms you are looking for is <code>read</code>ing or &quot;parsing&quot; the string.  The process of looking at text to obtain a structured value is generally referred to as parsing.  We could get more technical and discuss lexing, but if you look for CSV parsers or just the <code>read</code> function then you&#39;ll do alright."}], "answers": [{"tags": [], "owner": {"reputation": 1207, "user_id": 795380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fdf8867c62227b63bdf5cf7063f6e54?s=128&d=identicon&r=PG", "display_name": "jgriego", "link": "https://stackoverflow.com/users/795380/jgriego"}, "is_accepted": true, "score": 2, "last_activity_date": 1484505855, "creation_date": 1484505855, "answer_id": 41664876, "question_id": 41664781, "link": "https://stackoverflow.com/questions/41664781/how-to-convert-string-converted-to-string-value-back-to-the-original-type/41664876#41664876", "title": "How to convert [[String]] converted to String value back to the original type [[String]]?", "body": "<p>Check out the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Read\" rel=\"nofollow noreferrer\"><code>Read</code></a> typeclass in the prelude.</p>\n\n<p><code>read :: (Read a) =&gt; String -&gt; a</code> is a partial function that tries to a parse a value of type <code>a</code> from the input string. Not all types have a <code>Read</code> instance, but for those that do, for any <code>val :: A</code>, then <code>read (show val) :: A</code> will give you back <code>val</code>; in other words, <code>read</code> is <code>show</code>'s inverse.</p>\n\n<p>Using <code>read</code> is a bit tricky since generally speaking, the compiler will have no way of knowing what output type you want. If you hear GHC groaning about an 'ambiguous type' you should annotate the result of <code>read</code>, like this:</p>\n\n<pre><code>read \"[[\\\"1\\\", \\\"hello\\\"], []\" :: [[String]]\n</code></pre>\n"}], "owner": {"reputation": 145, "user_id": 3816416, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d7eab7587d5591a0caf01186a8d26abf?s=128&d=identicon&r=PG&f=1", "display_name": "rocksparrow", "link": "https://stackoverflow.com/users/3816416/rocksparrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 41664876, "answer_count": 1, "score": 0, "last_activity_date": 1484505855, "creation_date": 1484505305, "question_id": 41664781, "link": "https://stackoverflow.com/questions/41664781/how-to-convert-string-converted-to-string-value-back-to-the-original-type", "title": "How to convert [[String]] converted to String value back to the original type [[String]]?", "body": "<p>I'm working on a small project in haskell that is something like simple excel. Basically my spreadsheet is represented as the list of list (type is <strong>[[String]]</strong>). The example board looks like: </p>\n\n<pre><code>[[\"2\", \"=SUM(A0:C0)\", \"1\"], [\"7\", \"2\", \"3\"], [\"2\", \"=SUM(A0:B0)\", \"\"]]\n</code></pre>\n\n<p>One of the requirements is to save the board in file and also possibility to import it from file.</p>\n\n<p>To save in file I'm converting the board to String (to be able to write it in the file) :</p>\n\n<pre><code>filenameOut &lt;- getLine\nwriteFile filenameOut (show (board))\nputStrLn \"Board saved to file.\"\n</code></pre>\n\n<p>To upload the board:</p>\n\n<pre><code>filenameIn &lt;- getLine\nhandle &lt;- openFile filenameIn ReadMode\ninput &lt;- hGetContents handle\n</code></pre>\n\n<p>But input is a String \"[[\"2\", \"=SUM(A0:C0)\", \"1\"], [\"7\", \"2\", \"3\"], [\"2\", \"=SUM(A0:B0)\", \"\"]]\" and I want to convert it back to the [[String]].\n I tried to used regex but it seems to be not a good solution.</p>\n\n<p><strong>Is there some other solutions to do some kind of inverse operation to have back [[String]]?</strong>\nPlease, be gentle, I'm new in Haskell.</p>\n"}, {"tags": ["python", "haskell", "terminal"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1484501738, "post_id": 41664096, "comment_id": 70526475, "body": "sounds that haskell script has run the process with stdin closed. Can&#39;t you pass the info as command line parameter instead? (using <code>sys.argv[1]</code>). that would solve that."}, {"owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1484556832, "post_id": 41664096, "comment_id": 70542579, "body": "afaik sys.argv[1] only works if I never want to send new input."}], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "edited": false, "score": 0, "creation_date": 1484556583, "post_id": 41665172, "comment_id": 70542426, "body": "doesn\u2019t crash now. but input is still not bound to sys.stdin.readline()"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "edited": false, "score": 0, "creation_date": 1484583572, "post_id": 41665172, "comment_id": 70558566, "body": "@someidiot You can use <code>hPutStrLn input &quot;song.mp3&quot;</code> instead of <code>putStr input &quot;song.mp3\\n&quot; &gt;&gt; hFlush input</code> (unless you have changed <code>input</code> to block buffering)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1484507598, "last_edit_date": 1484507598, "creation_date": 1484507266, "answer_id": 41665172, "question_id": 41664096, "link": "https://stackoverflow.com/questions/41664096/ioerror-errno-5-input-output-error-when-calling-python-program-from-haskell/41665172#41665172", "title": "&quot;IOError: [Errno 5] Input/output error&quot; when calling python-program from haskell System.Process", "body": "<p>If you want the process' stdin to be a pipe, you have to explicitly request it:</p>\n\n<pre><code>(Just input, _, _, _) &lt;- createProcess ((proc \"python\" [\"mplayer.py\"]) { std_in = CreatePipe })\n</code></pre>\n\n<p>Quoting <a href=\"https://hackage.haskell.org/package/process-1.4.3.0/docs/System-Process.html#v:createProcess\" rel=\"nofollow noreferrer\">the fine documentation</a>:</p>\n\n<blockquote>\n  <p><code>createProcess</code> returns <code>(</code><em>mb_stdin_hdl</em><code>,</code> <em>mb_stdout_hdl</em><code>,</code> <em>mb_stderr_hdl</em><code>,</code> <em>ph</em><code>)</code>, where</p>\n  \n  <ul>\n  <li>if <code>std_in == CreatePipe</code>, then <em>mb_stdin_hdl</em> will be <code>Just</code> <em>h</em>, where <em>h</em> is the write end of the pipe connected to the child process's <code>stdin</code>.</li>\n  <li>otherwise, <em>mb_stdin_hdl</em> <code>== Nothing</code></li>\n  </ul>\n  \n  <p>Similarly for <em>mb_stdout_hdl</em> and <em>mb_stderr_hdl</em>.</p>\n</blockquote>\n"}], "owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1854, "favorite_count": 0, "accepted_answer_id": 41665172, "answer_count": 1, "score": 0, "last_activity_date": 1484556611, "creation_date": 1484501334, "last_edit_date": 1484556611, "question_id": 41664096, "link": "https://stackoverflow.com/questions/41664096/ioerror-errno-5-input-output-error-when-calling-python-program-from-haskell", "title": "&quot;IOError: [Errno 5] Input/output error&quot; when calling python-program from haskell System.Process", "body": "<p>the following script runs perfectly if I manually run it from terminal. </p>\n\n<pre><code>import sys\nimport pygame\nimport pygame.mixer\n\ndef play(path):\n    pygame.mixer.music.load(path)\n    pygame.mixer.music.play(-1)\n\npygame.mixer.pre_init(44100, -16, 2, 2048)\npygame.init()\npygame.mixer.init()\n\nwhile True:\n    path = sys.stdin.readline()[0:-1]\n    play(path)\n</code></pre>\n\n<p>whenever I type a path it starts playing that file (and stops playing the previous). </p>\n\n<p>but when i call it from this haskell script:</p>\n\n<pre><code>import System.Process\nimport GHC.IO.Handle\n\nmain = do\n    (Just input, _, _, _) &lt;- createProcess (proc \"python\" [\"mplayer.py\"])\n    hPutStr input \"song.mp3\\n\"\n</code></pre>\n\n<p>I get the following error-message:</p>\n\n<pre><code>Main: user error (Pattern match failure in do expression at     Main.hs:6:9-29)\ngernot@gernot-Aspire-5733Z:~/Dokumente/Projekte/python/music$ Traceback     (most recent call last):\n  File \"mplayer.py\", line 14, in &lt;module&gt;\n    path = sys.stdin.readline()[0:-1]\nIOError: [Errno 5] Input/output error\n</code></pre>\n\n<p>I googled the error-message and didn\u2019t find anything useful for either python or haskell. \nanyway, the error persists if I append some busy-waiting to the haskell-script</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "edited": false, "score": 0, "creation_date": 1484496211, "post_id": 41662870, "comment_id": 70524495, "body": "I guess an easier approach for me (to fix this) is to convert the (Int,Char) pairs into Strings within the RVar monad. Then I&#39;d align more closely with the problem in the linked question."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1484497150, "post_id": 41662870, "comment_id": 70524828, "body": "That&#39;s not a warning, it&#39;s an error. The original version does <i>not</i> compile. Perhaps you&#39;ve run an old executable with a trivial test that was still lying around?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1484497521, "post_id": 41662870, "comment_id": 70524947, "body": "OTOH, the <code>runRVar</code> version <i>should</i> compile, because there <i>is</i> a <code>MonadRandom IO</code> instance. Unless something is very broken with your library environment... or perhaps you&#39;ve just imported only \u201cinternal\u201d modules that don&#39;t actually export that instance? What happens if you explicitly import <code>Data.Random</code>?"}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484497612, "post_id": 41662870, "comment_id": 70524978, "body": "@leftaroundabout did you try to compile? I&#39;m using ghc 8.0.1 and it does appear to compile and I&#39;ve included links to travis ci where it does appear to build numerous times using 7.8. I guess I could have a broken env, but then I&#39;d expect Travis to complain as well."}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484497814, "post_id": 41662870, "comment_id": 70525046, "body": "I&#39;ll try the explicit import of Data.Random. (I&#39;m very confused by the packaging of Data.RVar, Data.Random and the like)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1484497843, "post_id": 41662870, "comment_id": 70525057, "body": "Aha, <code>Cover5</code> imports <code>Data.Random.Show.Unsafe</code>. Why do people keep doing explicitly <b>unsafe</b> things and then come here complaining that strange stuff happens?"}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484497925, "post_id": 41662870, "comment_id": 70525086, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/133205/discussion-between-michael-welch-and-leftaroundabout\">continue this discussion in chat</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1484497973, "post_id": 41662870, "comment_id": 70525105, "body": "<code>Data.Random</code> is the principal module you need for actually doing randomness stuff. It&#39;s the public interface of  random-fu, as it were. <code>Data.RVar</code> is merely the <i>definition of the data type called <code>RVar</code></i>, not a module that gives you routines for working with that."}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484498184, "post_id": 41662870, "comment_id": 70525178, "body": "In the discussion I mentioned that @leftaroundabout solved my issue. If he would go ahead and write up the answer I&#39;ll accept it. 1. It compiled because I used Unsafe and implicitly exported everything from Cover 5  2. I wasn&#39;t importing the public module"}], "answers": [{"tags": [], "owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "is_accepted": true, "score": 0, "last_activity_date": 1484586980, "last_edit_date": 1484586980, "creation_date": 1484501610, "answer_id": 41664142, "question_id": 41662870, "link": "https://stackoverflow.com/questions/41662870/how-to-print-the-results-of-sampling-an-rvar/41664142#41664142", "title": "How to print the results of sampling an RVar", "body": "<p>The answer(s) were provided by @leftaroundabout in the comments. Posting an answer here for others new to <code>Random</code> in case it proves helpful</p>\n\n<p><strong>First Question</strong>\nI had written the original program about 3 years ago. I had no idea how to print results from <code>RVar</code>s. I chose to use <code>Data.Random.Show.Unsafe</code>. Apparently this module provides an instance of Show for <code>RVar a</code>. I didn't remember that. </p>\n\n<p>In addition, I was implicitly exporting everything from my Cover5 module so the main module whose code is above was importing that instance.</p>\n\n<p>So that's why <code>print</code> was working.</p>\n\n<p><strong>Second Question</strong>\nInstances are available in <code>Data.Random</code>, which I wasn't importing.</p>\n\n<p>The reason why I was getting errors but was thinking they were warnings is because I changed 2 (actually more than 2) things at once: </p>\n\n<ol>\n<li>I restricted what was exported from Cover5 module so the Unsafe\ninstance of Show wasn't exported anymore  </li>\n<li>I ran the build with some arguments which I thought were just going to show more warnings than a traditional build.</li>\n</ol>\n"}], "owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 41664142, "answer_count": 1, "score": 0, "last_activity_date": 1484586980, "creation_date": 1484494372, "last_edit_date": 1495539932, "question_id": 41662870, "link": "https://stackoverflow.com/questions/41662870/how-to-print-the-results-of-sampling-an-rvar", "title": "How to print the results of sampling an RVar", "body": "<p>I have a program that works. However, I wasn't exactly sure why it was compiling.</p>\n\n<p>Here's my main function</p>\n\n<pre><code>module Main where\n\nimport System.Environment\nimport Cover5\n\nmain :: IO ()\nmain = do\n         args &lt;- getArgs\n         let numGames = if null args then 13 else read $ head args\n         putStrLn $ \"Making picks for \" ++ show numGames ++ \" games.\"\n         print $ run numGames\n</code></pre>\n\n<p>where the function <code>run</code> has the signature <code>run :: Int -> RVar [(Int, Char)]</code>.</p>\n\n<p>What is confusing is that there is no instance of <code>Show</code> for <code>RVar [(Int,Char)]</code> so I figure it shouldn't compile, but it does (see <a href=\"https://travis-ci.org/michaelgwelch/cover5/builds/192025653\" rel=\"nofollow noreferrer\">Travis-CI build</a> and the related source for that <a href=\"https://github.com/michaelgwelch/cover5/blob/3ef47f24e436619916a8cc3d4ba3f4726bf48e1c/src/Main.hs\" rel=\"nofollow noreferrer\">commit of Main.hs</a>). I can force a warning with this command:</p>\n\n<pre><code>cabal build --ghc-options=\"-fforce-recomp -fno-code\"\nPreprocessing executable 'cover5' for cover5-0.1.0.1...\n[1 of 2] Compiling Cover5           ( src/Cover5.hs, nothing )\n[2 of 2] Compiling Main             ( src/Main.hs, nothing )\n\nsrc/Main.hs:13:10: error:\n    \u2022 No instance for (Show (RVar [(Int, Char)]))\n        arising from a use of \u2018print\u2019\n    \u2022 In a stmt of a 'do' block: print $ run numGames\n      In the expression:\n        do { args &lt;- getArgs;\n             let numGames = ...;\n             putStrLn $ \"Making picks for \" ++ show numGames ++ \" games.\";\n             print $ run numGames }\n      In an equation for \u2018main\u2019:\n          main\n            = do { args &lt;- getArgs;\n                   let numGames = ...;\n                   putStrLn $ \"Making picks for \" ++ show numGames ++ \" games.\";\n                   .... }\n</code></pre>\n\n<p>I'd like to \"fix\" this and have followed guidance from the question <a href=\"https://stackoverflow.com/questions/13120612/convert-data-rvar-rvar-char-to-char#13121497\">Convert Data.RVar.RVar [Char] to [Char]</a></p>\n\n<p>So I add the appropriate imports for StdRandom and runRVar and write the following lines</p>\n\n<pre><code>results &lt;- runRVar (run numGames) StdRandom\nputStrLn $ show results\n</code></pre>\n\n<p>But I'm tripping over myself trying to find instances of MonadRandom IO for my usage:</p>\n\n<pre><code>src/Main.hs:13:21: error:\n    \u2022 No instance for (MonadRandom IO) arising from a use of \u2018runRVar\u2019\n    \u2022 In a stmt of a 'do' block:\n        results &lt;- runRVar (run numGames) StdRandom\n      In the expression:\n        do { args &lt;- getArgs;\n             let numGames = ...;\n             putStrLn $ \"Making picks for \" ++ show numGames ++ \" games.\";\n             results &lt;- runRVar (run numGames) StdRandom;\n             .... }\n      In an equation for \u2018main\u2019:\n          main\n            = do { args &lt;- getArgs;\n                   let numGames = ...;\n                   putStrLn $ \"Making picks for \" ++ show numGames ++ \" games.\";\n                   .... }\n</code></pre>\n\n<p>So two questions:</p>\n\n<ol>\n<li>Why does the original version compile and work?</li>\n<li>What might you suggest I do to remove the warning and write this \"correctly\"?</li>\n</ol>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484506467, "post_id": 41662486, "comment_id": 70528224, "body": "Try installing <a href=\"https://hackage.haskell.org/package/hashtables\" rel=\"nofollow noreferrer\"><code>hashtables</code></a> first."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484517831, "post_id": 41662486, "comment_id": 70531789, "body": "@Alec It looks like that&#39;s installed to me; the error says, in part, &quot;Perhaps you meant... Data.HashTable.IO (... hashtables-&gt;1.2.1.0...)&quot;."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484517875, "post_id": 41662486, "comment_id": 70531800, "body": "Where is the documentation on Hackage? It should be pretty trivial to discover the right package name and version bounds given that."}, {"owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "edited": false, "score": 0, "creation_date": 1484555279, "post_id": 41662486, "comment_id": 70541833, "body": "[link]<a href=\"http://hackage.haskell.org/package/base-4.4.1.0/docs/Data-HashTable.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.4.1.0/docs/&hellip;</a> at least the name matches. I did cabal install base and it said, everything\u2019s installed already."}, {"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1489868564, "post_id": 41662486, "comment_id": 72862416, "body": "@Alec that is a different package then the one OP is looking for."}], "answers": [{"tags": [], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "is_accepted": true, "score": 4, "last_activity_date": 1489888679, "last_edit_date": 1489888679, "creation_date": 1489869056, "answer_id": 42879510, "question_id": 41662486, "link": "https://stackoverflow.com/questions/41662486/cabal-install-missingpy-can-t-find-data-hashtable/42879510#42879510", "title": "cabal install MissingPy can\u2019t find Data.HashTable", "body": "<p>The <a href=\"https://hackage.haskell.org/package/base-4.6.0.0/docs/Data-HashTable.html\" rel=\"nofollow noreferrer\"><code>Data.Hashtable</code> package</a> was deprecated in <code>base 4.6</code> and removed in <code>base 4.7</code>. <a href=\"https://wiki.haskell.org/Base_package\" rel=\"nofollow noreferrer\"><code>base</code> is a core library</a>. Each version of <code>ghc</code> is package with specific version of <code>base</code>, so if you wanted to use an older version of <code>base</code>, you would have to use an older <code>ghc</code>. The last version of <code>ghc</code> packaged with <code>base 4.6</code> was <code>ghc 7.6</code>.</p>\n\n<p>If you need a map, there are better alternatives: <code>Data.Map</code> and <code>Data.IntMap</code> are ordered map. <code>Data.HashMap</code> is a immutable unordered map. <code>Data.HashTable</code> and <code>Data.Judy</code> are mutable unordered maps.</p>\n"}], "owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 455, "favorite_count": 0, "accepted_answer_id": 42879510, "answer_count": 1, "score": 2, "last_activity_date": 1489888679, "creation_date": 1484492019, "question_id": 41662486, "link": "https://stackoverflow.com/questions/41662486/cabal-install-missingpy-can-t-find-data-hashtable", "title": "cabal install MissingPy can\u2019t find Data.HashTable", "body": "<p>I tried to install MissingPy, but it failed with</p>\n\n<pre><code>on the commandline: Warning:\n -XOverlappingInstances is deprecated: instead use per-instance pragmas     OVERLAPPING/OVERLAPPABLE/OVERLAPS\n\nsrc/Database/AnyDBM.hs:44:8:\n    Could not find module \u2018Data.HashTable\u2019\n Perhaps you meant\n   Data.Hashable (needs flag -package-key     hashable-&gt;1.2.5.0@hasha_Evd2cSGupW8AJnHTBSvXg8)\n      Data.HashTable.IO (needs flag -package-key     hashtables-&gt;1.2.1.0@hasht_EuNk8qBpsPjAV2dYmonrJi)\n    Use -v to see a list of the files searched for.\ncabal: Error: some packages failed to install:\nanydbm-1.0.7 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>Somewhere I found, Data.HashTable is deprecated. There\u2019s still documentation on hackage for it but it doesn\u2019t mention the package name. \nhow do I install Data.HashTable?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484490096, "post_id": 41661984, "comment_id": 70522556, "body": "Thank you. I have changed the data constructor to use values like &quot;North | South&quot; etc.. Its now working. Also, when I tried to use Left | Right, ghci complained that it conflicts with the Left and Right from <code>Either</code> datatype"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1484489040, "creation_date": 1484489040, "answer_id": 41661984, "question_id": 41661910, "link": "https://stackoverflow.com/questions/41661910/getting-error-not-a-data-constructor-when-defining-a-new-datatype-in-haskell/41661984#41661984", "title": "Getting Error &quot;Not a Data constructor&quot; when defining a new datatype in Haskell", "body": "<p>Ignoring infix data constructors, a data constructor must begin with a capital letter.</p>\n\n<pre><code>data Dir = Left | Right | Up | Down\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1484528202, "post_id": 41662699, "comment_id": 70534207, "body": "Indeed, hiding <code>Either</code> and defining your own <code>Left</code> and <code>Right</code> will very likely confuse other people reading your code."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 2, "last_activity_date": 1484493326, "creation_date": 1484493326, "answer_id": 41662699, "question_id": 41661910, "link": "https://stackoverflow.com/questions/41661910/getting-error-not-a-data-constructor-when-defining-a-new-datatype-in-haskell/41662699#41662699", "title": "Getting Error &quot;Not a Data constructor&quot; when defining a new datatype in Haskell", "body": "<p>As @chepner rightly points out, the data constructors should begin with capital letters. To address the next problem you run into i.e. <code>Left</code> and <code>Right</code> are ambiguous between your defined ones and those from <code>Either</code>, you can do this:</p>\n\n<ol>\n<li><p>Explicitly import Prelude and hide <code>Either</code> type constructor to avoid the ambiguity. This will let you continue using all the other 'default' functions from <code>Prelude</code> without issue</p>\n\n<pre><code>import Prelude hiding (Either(..)) --Everything except Either which causes ambiguity issues        \n</code></pre></li>\n<li><p>(Optional) Do a qualified import of <code>Data.Either</code> if you wish to use it elsewhere in your code.</p>\n\n<pre><code>import qualified Data.Either as E --You will be able to use Either by writing E.Either in your code\n</code></pre></li>\n</ol>\n\n<p>That said, you could avoid this trouble by renaming your data constructors if that is an option.</p>\n"}], "owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1589, "favorite_count": 0, "accepted_answer_id": 41661984, "answer_count": 2, "score": 0, "last_activity_date": 1484493326, "creation_date": 1484488630, "question_id": 41661910, "link": "https://stackoverflow.com/questions/41661910/getting-error-not-a-data-constructor-when-defining-a-new-datatype-in-haskell", "title": "Getting Error &quot;Not a Data constructor&quot; when defining a new datatype in Haskell", "body": "<p>I am trying to define a new datatype for directions.\nBut, I am getting an error <strong>\"Not a data constructor: left\"</strong> when I load the file in ghci.</p>\n\n<p>Here is the code snippet:</p>\n\n<pre><code>data Dir =   left\n           | right \n           | up\n           | down \n\ninstance Show Dir where\n show left = \"left\"\n show right = \"right\"\n show up = \"up\"\n show down = \"down\"\n\n\n-- initialpos is assumed to be valid one\nmove::Pos-&gt;Dir-&gt;Pos\nmove prevPos left = ( (-1)  $ fst prevPos  ,  snd prevPos)   \nmove prevPos right = ( (+1) $ fst prevPos ,  snd prevPos )\nmove prevPos up = ( fst prevPos, (+1) $ snd prevPos  )\nmove prevPos down = ( fst prevPos, (-1) $ snd prevPos )\n</code></pre>\n\n<p>Please help me in figuring out what is wrong.</p>\n"}, {"tags": ["haskell", "implicit-parameters"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1484487981, "creation_date": 1484487981, "answer_id": 41661793, "question_id": 41661714, "link": "https://stackoverflow.com/questions/41661714/a-function-that-sets-an-implicit-parameter-context/41661793#41661793", "title": "A function that sets an implicit parameter context", "body": "<p>You need an explicit type annotation for <code>f</code>. GHC isn't able to infer the right type.</p>\n\n<pre><code>{-# LANGUAGE ImplicitParams, Rank2Types #-}\n\nmain = print (f z)\n\nf :: ((?x :: Int, ?y :: Int) =&gt; a) -&gt; a\nf g =\n  let \n    ?x = 42\n    ?y = 5\n  in\n    g\n\nz :: (?x :: Int) =&gt; Int\nz = ?x\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 41661793, "answer_count": 1, "score": 2, "last_activity_date": 1484487981, "creation_date": 1484487540, "question_id": 41661714, "link": "https://stackoverflow.com/questions/41661714/a-function-that-sets-an-implicit-parameter-context", "title": "A function that sets an implicit parameter context", "body": "<p>I've been mucking around with implicit parameters which I've sometimes found useful, but trying to do something like the code below (which doesn't compile)</p>\n\n<pre><code>{-# LANGUAGE ImplicitParams #-}\n\nmain = print (f z)\n\nf g =\n  let \n    ?x = 42\n    ?y = 5\n  in\n    g\n\nz :: (?x :: Int) =&gt; Int\nz = ?x\n</code></pre>\n\n<p>What I want basically is a function <code>f</code> which runs a given function with a \"context\". In the case above, <code>f z</code> will run <code>z</code> with <code>?x = 42</code>, which naturally just returns <code>42</code> in this case and hence this program should print <code>42</code>. But I get the error:</p>\n\n<pre><code>\u2022 Unbound implicit parameter ?x::Int arising from a use of \u2018z\u2019\n\u2022 In the first argument of \u2018f\u2019, namely \u2018z\u2019\n  In the first argument of \u2018print\u2019, namely \u2018(f z)\u2019\n  In the expression: print (f z)\n</code></pre>\n\n<p>This is because there's no context for <code>z</code> where it's first used in <code>main</code>, even though <code>f</code> is providing the context.</p>\n\n<p>The reason I'm attempting to do this is because I've got a number of functions which work with implicit parameters, and a <code>GADT</code> which has differing but similar implementation options. It's relatively trivial to write a function which extracts the appropriate implicit parameters from each of the possible <code>GADT</code> constructors, but then I want to apply a function with those implicit parameters.</p>\n\n<p>Something like this approach (that compiles) would be good, or alternatively a different approach which allows me to easily set an implicit parameter context for a variety of functions would also be fine.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1484486938, "post_id": 41661571, "comment_id": 70521480, "body": "I suspect <code>-XDefaultSignatures</code> and <code>-XTypeApplications</code> just don&#39;t really work together yet. Both of these are pretty new and not completely mature. The type <code>count :: EAmbiguous a =&gt; Int</code> was in fact completely useless prior to <code>-XTypeApplications</code>, so <code>-XDefaultSignatures</code> was probably implemented with the assumption that such a type doesn&#39;t occur."}], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 1625775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93ba8ea9c25121eed04596f62100474?s=128&d=identicon&r=PG", "display_name": "teh", "link": "https://stackoverflow.com/users/1625775/teh"}, "is_accepted": false, "score": 2, "last_activity_date": 1484493166, "creation_date": 1484493166, "answer_id": 41662674, "question_id": 41661571, "link": "https://stackoverflow.com/questions/41661571/why-does-ghc-think-that-the-type-variable-is-ambiguous-for-a-class-with-a-defaul/41662674#41662674", "title": "Why does GHC think that the type variable is ambiguous for a class with a default implementation?", "body": "<p>This turned out to be a GHC bug which is fixed in GHC 8.0.2: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12220\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/12220</a></p>\n"}], "owner": {"reputation": 75, "user_id": 1625775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93ba8ea9c25121eed04596f62100474?s=128&d=identicon&r=PG", "display_name": "teh", "link": "https://stackoverflow.com/users/1625775/teh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1484493166, "creation_date": 1484486666, "question_id": 41661571, "link": "https://stackoverflow.com/questions/41661571/why-does-ghc-think-that-the-type-variable-is-ambiguous-for-a-class-with-a-defaul", "title": "Why does GHC think that the type variable is ambiguous for a class with a default implementation?", "body": "<p>In the following example I would expect GHC to be able to constrain the variable <code>a</code> to type <code>A</code> because that's what I say in <code>instance EAmbiguous A</code>. However when loading this into ghci I get: </p>\n\n<blockquote>\n  <p>Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018Main.$dmcount\u2019</p>\n</blockquote>\n\n<p>The code in question:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport GHC.Generics (Rep, Generic)\nimport GHC.Base (Type)\n\nclass EAmbiguous a where\n  count :: Int\n  default count :: (Generic a, GenericAmbiguous (Rep a)) =&gt; Int\n  count = genericCount @(Rep a)\n\nclass GenericAmbiguous (a :: Type -&gt; Type) where\n  genericCount :: Int\n\ninstance GenericAmbiguous (f p) where\n  genericCount = 10\n\ndata A = A deriving Generic\n\n-- The error happens when defining a body-less instance:\n--     \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018Main.$dmcount\u2019\n--      prevents the constraint \u2018(Generic a0)\u2019 from being solved.\ninstance EAmbiguous A\n</code></pre>\n\n<p>I've been looking at this for a good while and I'm convinced that this should work, but I'm clearly missing something. So my question is: Why can't GHC solve <code>a</code> to <code>A</code>?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1484469907, "post_id": 41659240, "comment_id": 70517242, "body": "Got it.  Ended up needing OverloadedStrings, so went with:    let csvs = sort $ filter (\\x -&gt; x =~ (&quot;csv$&quot; :: String) :: Bool) ls"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 2, "creation_date": 1484470287, "post_id": 41659240, "comment_id": 70517329, "body": "@Mittenchops If you are using <code>filter</code> from the Prelude, <code>let csvs = sort $ filter (\\x -&gt; x =~ (&quot;csv$&quot; :: String)) ls</code>  is enough (no need for the <code>:: Bool</code>)."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1484469612, "last_edit_date": 1484469612, "creation_date": 1484468992, "answer_id": 41659240, "question_id": 41659083, "link": "https://stackoverflow.com/questions/41659083/haskell-regex-context-ambiguous-type-despite-explicit-bool-type-annotation-succ/41659240#41659240", "title": "Haskell regex context ambiguous type despite explicit Bool type annotation, succeeds in ghci", "body": "<p>The ambiguity is not about what the type of <code>x =~ \"csv$\"</code> is - that is already determined from your use of <code>filter</code>. The problem is the <code>\"csv$\"</code> literal itself. Based on the error message, you have the <code>OverloadedStrings</code> language extension enabled. The ambiguity here is figuring out which type of string <code>\"csv$\"</code> needs to be.</p>\n\n<p>Your solution is to either</p>\n\n<ul>\n<li>turn off <code>OverloadedStrings</code> (if you don't need it for this module), or</li>\n<li>add a type annotation to <code>\"csv$\"</code>, so you have <code>\\x -&gt; x =~ (\"csv$\" :: String)</code> instead of <code>\\x -&gt; x =~ \"csv$\" :: Bool</code></li>\n</ul>\n\n<p>If this is a problem that is cropping up a lot, you may want to play with the <code>ExtendedDefaultRules</code> and have a <code>default</code> declaration in your file.</p>\n\n<p>The reason this succeeds in GHCi is probably because because you didn't have <code>OverloadedStrings</code> enabled there (or possibly due to GHCi's different defaulting rules).</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 41659240, "answer_count": 1, "score": 0, "last_activity_date": 1484469612, "creation_date": 1484467616, "question_id": 41659083, "link": "https://stackoverflow.com/questions/41659083/haskell-regex-context-ambiguous-type-despite-explicit-bool-type-annotation-succ", "title": "Haskell regex context ambiguous type despite explicit Bool type annotation, succeeds in ghci", "body": "<p>This works in an interpreter session</p>\n\n<pre><code>\u03bb&gt; import Text.Regex.Base\n\u03bb&gt; import Text.Regex.Posix\n\u03bb&gt; import Data.List (sort)\n\u03bb&gt; import System.Directory\n\n\u03bb&gt; ls &lt;- getDirectoryContents \".\"\n\u03bb&gt; let csvs = sort $ filter (\\x -&gt; x =~ \"csv$\" :: Bool) ls\n\u03bb&gt; recent = last csvs\n</code></pre>\n\n<p>This is great and gives me exactly what I need.</p>\n\n<p>However, the same code fails to compile in a script:</p>\n\n<pre><code>t10.hs:40:35-45: error: \u2026\n    \u2022 Ambiguous type variable \u2018source0\u2019 arising from a use of \u2018=~\u2019\n      prevents the constraint \u2018(RegexMaker\n                                  Regex CompOption ExecOption source0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018source0\u2019 should be.\n      These potential instances exist:\n        instance RegexMaker Regex CompOption ExecOption C.ByteString\n          -- Defined in \u2018Text.Regex.Posix.ByteString\u2019\n        instance RegexMaker Regex CompOption ExecOption LB.ByteString\n          -- Defined in \u2018Text.Regex.Posix.ByteString.Lazy\u2019\n    \u2022 In the expression: x =~ \"csv$\" :: Bool\n      In the first argument of \u2018filter\u2019, namely\n        \u2018(\\ x -&gt; x =~ \"csv$\" :: Bool)\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018filter (\\ x -&gt; x =~ \"csv$\" :: Bool) ls\u2019\nt10.hs:40:40-45: error: \u2026\n    \u2022 Ambiguous type variable \u2018source0\u2019 arising from the literal \u2018\"csv$\"\u2019\n      prevents the constraint \u2018(Data.String.IsString\n                                  source0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018source0\u2019 should be.\n</code></pre>\n\n<p>I have an explicit <code>:: Bool</code> context at the end to provide exactly this information.  Why would this be succeeding in ghci but failing to catch this same instruction when compiling, and how can I fix it?</p>\n"}, {"tags": ["haskell", "memory-management", "functional-programming", "ghc", "lazy-evaluation"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484464579, "post_id": 41658636, "comment_id": 70516116, "body": "<a href=\"http://simonmar.github.io/bib/papers/parallel-gc.pdf\" rel=\"nofollow noreferrer\">Relevant paper on GHC&#39;s garbage collector</a>."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 1, "creation_date": 1484586927, "post_id": 41658636, "comment_id": 70560423, "body": "Memory allocation for garbage collected envrionments is often radically different from the way you would do things in C. The reason <code>malloc</code> is so expensive is because objects can be freed in any order but cannot be moved.  However, it&#39;s common for garbage collectors to move objects, which means you can make the allocator itself much, much simpler."}], "answers": [{"tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 1, "last_activity_date": 1484493620, "creation_date": 1484493620, "answer_id": 41662752, "question_id": 41658636, "link": "https://stackoverflow.com/questions/41658636/is-slab-allocator-used-to-allocate-memory-for-thunks-in-ghc/41662752#41662752", "title": "Is slab allocator used to allocate memory for thunks in GHC?", "body": "<p>GHC uses a custom allocator, descibed here: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/BlockAlloc\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/BlockAlloc</a></p>\n\n<p>It's based on blocks. If you're interested in how GHC manages its memory, <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage</a> is a good start. </p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1484586066, "creation_date": 1484586066, "answer_id": 41681397, "question_id": 41658636, "link": "https://stackoverflow.com/questions/41658636/is-slab-allocator-used-to-allocate-memory-for-thunks-in-ghc/41681397#41681397", "title": "Is slab allocator used to allocate memory for thunks in GHC?", "body": "<p>Allocation of thunks and other normal, small allocations are \"open coded\" during translation to Cmm, GHC's low-level intermediate language, and look something like</p>\n\n<pre><code>       Hp = Hp + 16;\n       if (Hp &gt; HpLim) goto cV2; else goto cV1;\n   cV2:\n       HpAlloc = 16;\n       /* jump to garbage collector */\n   cV1:\n       /* Write to the newly-allocated memory and continue */\n       /* ... */\n</code></pre>\n\n<p><code>Hp</code> is a machine register that points to the last allocated word and <code>HpLim</code> is a memory location the upper limit of the current allocation area. <code>HpLim</code> can also be set to <code>0</code> to send a signal (e.g., an asynchronous exception or GC synchronization) to the thread. So, allocation is pretty cheap and also handles messaging.</p>\n\n<p>Each Haskell capability (~ OS thread that executes Haskell code) has a separate \"nursery\" or allocation pool into which <code>Hp</code> points and which is delimited by <code>HpLim</code>. The block allocator mentioned in bennofs's answer is used to allocate these nurseries themselves and other large objects.</p>\n"}], "owner": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 41662752, "answer_count": 2, "score": 1, "last_activity_date": 1484586066, "creation_date": 1484463349, "question_id": 41658636, "link": "https://stackoverflow.com/questions/41658636/is-slab-allocator-used-to-allocate-memory-for-thunks-in-ghc", "title": "Is slab allocator used to allocate memory for thunks in GHC?", "body": "<p>Is any slab allocator or something similar used to allocate memory for thunk structures in GHC? Or, does it use something naive like <code>malloc</code> in C?</p>\n\n<p>I guess number of thunks are allocated within a short time in lazy functional programming languages especially when multiple threads are running on them. Or, don't the allocations occur so often? I tried looking for code for it in <a href=\"https://github.com/ghc/ghc\" rel=\"nofollow noreferrer\">the GHC repository</a> but couldn't find any.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 5, "creation_date": 1484449947, "post_id": 41657355, "comment_id": 70513505, "body": "ghci implicitly adds <code>print</code> to non-IO values."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484469829, "post_id": 41657355, "comment_id": 70517227, "body": "Your rewriting are correct, but GHCi performs some magic. It allows <code>import, data, :command</code>, for instance, which can not occur in <code>do</code> blocks. It also has some extended defaulting rules, and when entering an expression whose type can not be made into <code>IO a</code>, it checks whether is type is in class <code>Show</code>, and prints it. So you should insert <code>print $ length $ ...</code> as GHCi automagically did."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1484480682, "creation_date": 1484480682, "answer_id": 41660709, "question_id": 41657355, "link": "https://stackoverflow.com/questions/41657355/haskell-refactoring-a-do-block-to-use-bind-in-simple-file-field-count/41660709#41660709", "title": "Haskell refactoring a do block to use (&gt;&gt;=) bind in simple file field count", "body": "<p>As you said, the following two are equivalent:</p>\n\n<pre><code>do x &lt;- y\n   f x\n</code></pre>\n\n\n\n<pre><code>y &gt;&gt;= (\\x -&gt; f x)\n</code></pre>\n\n<p>However, in order to actually work, we have to respect <code>(&gt;&gt;=)</code>'s type:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>If we have a look at your expressions, we see that something's not quite right:</p>\n\n<pre><code>((last . lines) &lt;$&gt; readFile fname)    :: IO String     -- seems right\n(\\lline -&gt; (length $ split \",\" lline)) :: String -&gt; Int -- no IO on the right hand side!\n</code></pre>\n\n<p>Your function <code>length . split \",\"</code> doesn't return something in <code>IO</code>, it returns an <code>Int</code>. So you either have to use <code>print</code> or something similar to show it, or return an <code>IO Int</code> (depending on what you want to do):</p>\n\n<pre><code>((last . lines) &lt;$&gt; readLine fname) &gt;&gt;= print . length . split \",\"\n</code></pre>\n\n<p>Remember that GHCi isn't really a \"normal\" <code>do</code> block, otherwise simple expressions like</p>\n\n<pre><code>ghci&gt; 1 + 1\n2\n</code></pre>\n\n<p>would lead to type errors. Instead, GHCi checks whether the type is <code>IO a</code>. If it is, it runs the action, and if <code>a</code> is an instance of <code>Show</code>, it will also show the result:</p>\n\n<pre><code>ghci&gt; data Foo = Foo -- no instance of Show\nghci&gt; return Foo -- no output!\nghci&gt; return (1 + 1)\n2\n</code></pre>\n\n<p>If you have another expression <code>x</code> which doesn't have type <code>IO a</code>, it will act as <code>print x</code>, including <code>Show</code> instance errors:</p>\n\n<pre><code>ghci&gt; Foo \n\nNo instance for (Show Foo) arising from a use of `print'\nghci&gt; 1 + 1\n2\n</code></pre>\n\n<h1>TL;DR</h1>\n\n<p>Pay attention to the types and remember that GHCi has a lot of magic for convenience.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 41660709, "answer_count": 1, "score": 2, "last_activity_date": 1484480682, "creation_date": 1484448916, "last_edit_date": 1484449358, "question_id": 41657355, "link": "https://stackoverflow.com/questions/41657355/haskell-refactoring-a-do-block-to-use-bind-in-simple-file-field-count", "title": "Haskell refactoring a do block to use (&gt;&gt;=) bind in simple file field count", "body": "<p>If </p>\n\n<pre><code>do\n    x &lt;- y\n    f x\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>y &gt;&gt;= \\x -&gt; f x\n</code></pre>\n\n<p>Then </p>\n\n<p>why is this (\"retrieve the number of comma separated fields on the last line of a file\") :</p>\n\n<pre><code>\u03bb&gt; lline &lt;- (last . lines) &lt;$&gt; readFile fname\n\u03bb&gt; length $ split \",\" lline\n11\n</code></pre>\n\n<p>Which if I'm doing this right, I /think/ in a do-like Prelude session I can translate like this:</p>\n\n<pre><code>x := lline\ny := (last . lines) &lt;$&gt; readFile fname\nf := (\\lline -&gt; length $ split \",\" lline)\n</code></pre>\n\n<p>Not equal to</p>\n\n<pre><code>\u03bb&gt; ((last . lines) &lt;$&gt; readFile fname) &gt;&gt;= (\\lline -&gt; (length $ split \",\" lline))\n\n&lt;interactive&gt;:97:53-76: error:\n    \u2022 Couldn't match expected type \u2018IO b\u2019 with actual type \u2018Int\u2019\n    \u2022 In the expression: (length $ split \",\" lline)\n</code></pre>\n\n<p>Or, my attempt at a \"point-free\" translation</p>\n\n<pre><code>\u03bb&gt; ((last . lines) &lt;$&gt; readFile fname) &gt;&gt;= (length $ split \",\")\n\n&lt;interactive&gt;:154:42-59: error:\n    \u2022 Couldn't match expected type \u2018String -&gt; IO b\u2019\n                  with actual type \u2018Int\u2019\n</code></pre>\n\n<p>?</p>\n\n<p>I'd like to assign that Int to a value.  Maybe I have parentheses in the wrong place or otherwise mistranslated?</p>\n\n<p>On the one hand, I see that this \"works\":</p>\n\n<pre><code>\u03bb&gt; ((last . lines) &lt;$&gt; readFile fname) &gt;&gt;= (\\x -&gt; putStrLn $ show $ length $ split \",\" x)\n11\n</code></pre>\n\n<p>So I know I'm close.  This is fine for printing, but how do I assign the Int to somewhere in this translated and desugared form?</p>\n\n<p>Even my intuitive, monstrous rookie ideas trying to extract that string with read:</p>\n\n<pre><code>\u03bb&gt; val = read $ ((last . lines) &lt;$&gt; readFile fname) &gt;&gt;= (\\x -&gt; length $ split \",\" x) :: Int\n</code></pre>\n\n<p>Are naturally failing.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484453960, "post_id": 41657249, "comment_id": 70514172, "body": "What exactly are you asking? Do you have an example you could show of this?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484469361, "post_id": 41657249, "comment_id": 70517112, "body": "There is almost no information in this question. We can&#39;t guess what&#39;s going on if you don&#39;t share more details. You should provide a <a href=\"http://stackoverflow.com/help/mcve\">MCVE</a>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1484527794, "post_id": 41665258, "comment_id": 70534127, "body": "The first strict pattern is fine, because <code>&lt;|&gt;</code> is left-biased. So this could be written <code>Parser q &lt;|&gt; ~(Parser p) = ...</code>. But of course the best solution in this case is just to use <code>newtype</code>!"}, {"owner": {"reputation": 471, "user_id": 5359449, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f3fc3ecbd679a426e43699d7c65aba0?s=128&d=identicon&r=PG&f=1", "display_name": "Procrade", "link": "https://stackoverflow.com/users/5359449/procrade"}, "edited": false, "score": 0, "creation_date": 1484616595, "post_id": 41665258, "comment_id": 70572376, "body": "Thanks, that helps a lot. I still don&#39;t quite understand the relationship between a <code>data</code> being evaluated to a WNHF and the problem about <code>&lt;|&gt;</code> though."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1484524338, "last_edit_date": 1495542275, "creation_date": 1484507812, "answer_id": 41665258, "question_id": 41657249, "link": "https://stackoverflow.com/questions/41657249/why-does-this-loops-with-data-but-not-newtype/41665258#41665258", "title": "Why does this loops with &#39;data&#39; but not &#39;newtype&#39;?", "body": "<p>This is a great way of getting at one of <a href=\"https://stackoverflow.com/questions/5889696/difference-between-data-and-newtype-in-haskell\">the difference between <code>data</code> and <code>newtype</code></a>. The heart of the problem here is actually in the pattern matching of the <code>&lt;|&gt;</code> definition.</p>\n\n<pre><code>instance Alternative Parser where\n  empty = Parser (\\s -&gt; [])\n  Parser q &lt;|&gt; Parser p = Parser (\\s -&gt; q s ++ p s)\n</code></pre>\n\n<p>Remember that at runtime, a <code>newtype</code> becomes the same thing as the type it is wrapping. Then, when a <code>newtype</code> is pattern matched, GHC doesn't do anything - there is no constructor to evaluate to WNHF.</p>\n\n<p>On the contrary, when a <code>data</code> is matched, seeing the pattern <code>Parser q</code> tells GHC it needs to evaluate that parser to WNHF. That is a problem, because <code>some</code> is an infinite fold of <code>&lt;|&gt;</code>. There are two ways to solve the problem with <code>data</code>:</p>\n\n<ul>\n<li><p>Don't have <code>Parser</code> patterns in <code>&lt;|&gt;</code>:</p>\n\n<pre><code>instance Alternative Parser where\n  empty = Parser (\\s -&gt; [])\n  q &lt;|&gt; p = Parser (\\s -&gt; runParser q s ++ runParser p s)\n</code></pre></li>\n<li><p>Use <a href=\"https://stackoverflow.com/questions/2263541/what-does-mean-in-haskell\">lazy patterns</a>:</p>\n\n<pre><code>instance Alternative Parser where\n  empty = Parser (\\s -&gt; [])\n  ~(Parser q) &lt;|&gt; ~(Parser p) = Parser (\\s -&gt; q s ++ p s)\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 471, "user_id": 5359449, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f3fc3ecbd679a426e43699d7c65aba0?s=128&d=identicon&r=PG&f=1", "display_name": "Procrade", "link": "https://stackoverflow.com/users/5359449/procrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "accepted_answer_id": 41665258, "answer_count": 1, "score": 2, "last_activity_date": 1484524338, "creation_date": 1484447682, "last_edit_date": 1484497453, "question_id": 41657249, "link": "https://stackoverflow.com/questions/41657249/why-does-this-loops-with-data-but-not-newtype", "title": "Why does this loops with &#39;data&#39; but not &#39;newtype&#39;?", "body": "<p>Here is the code :</p>\n\n<pre><code>import Control.Applicative\n\n-- newtype Parser a = Parser { runParser :: String -&gt; [(a, String)] }\ndata Parser a = Parser { runParser :: String -&gt; [(a, String)] }\n\ninstance Functor Parser where\n  fmap f (Parser p) = Parser (\\s -&gt; [(f x, s') | (x, s') &lt;- p s ] )\n\ninstance Applicative Parser where\n  pure a = Parser (\\s -&gt; [(a, s)])\n  Parser q &lt;*&gt; Parser p = Parser (\\s -&gt; [(f x, s'') | (f, s') &lt;- q s, (x, s'') &lt;- p s'])\n\ninstance Alternative Parser where\n  empty = Parser (\\s -&gt; [])\n  Parser q &lt;|&gt; Parser p = Parser (\\s -&gt; q s ++ p s)\n\nitem = Parser (\\s -&gt; case s of\n                  (x:xs) -&gt; [(x, xs)]\n                  _ -&gt; []\n              )\n</code></pre>\n\n<p>With the current code, <code>runParser (some item) \"abcd\"</code> loops, but if Parser is declared as <code>newtype</code>, it works just fine.</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "mmap"], "comments": [{"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 1, "creation_date": 1484446184, "post_id": 41656678, "comment_id": 70512925, "body": "The <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:readFile\" rel=\"nofollow noreferrer\"><code>readFile</code></a> function returns a lazily evaluated string, meaning you can use it to process, say, multiple GB sized files without running out of memory (as explained <a href=\"http://book.realworldhaskell.org/read/io.html#io.lazy\" rel=\"nofollow noreferrer\">here</a>). Considering that, what do you see wrong in a simple combination of <code>readFile</code>, <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:lines\" rel=\"nofollow noreferrer\"><code>lines</code></a>, and <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:last\" rel=\"nofollow noreferrer\"><code>last</code></a>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1484446187, "post_id": 41656678, "comment_id": 70512926, "body": "Jeez, segfaults shouldn&#39;t happen in pure Haskell! Suspect it&#39;s a bug in <code>mmap</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1484446471, "post_id": 41656678, "comment_id": 70512980, "body": "@MarcusVin&#237;ciusMonteiro, I don&#39;t know if I did this correctly, but <code>\u03bb&gt; (last . lines) &lt;$&gt; readFile fname</code> gives me <code>&quot;\\&quot;val1\\&quot;,\\&quot;val2\\&quot;,</code> correctly. (It&#39;s just kind of slow on account of the large file.)"}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1484448880, "post_id": 41656678, "comment_id": 70513327, "body": "@Mittenchops does it work in a file with size larger than your RAM? I don&#39;t have a file large enough to test it."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 1, "creation_date": 1484449071, "post_id": 41656678, "comment_id": 70513355, "body": "@MarcusVin&#237;ciusMonteiro I don&#39;t think it&#39;s too big. The file I&#39;m working on is about 70MB on an 8GB RAM machine.  I have a lot of browser tabs open and all, but not /that/ many?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484462432, "post_id": 41656678, "comment_id": 70515697, "body": "@Mittenchops Updated the answer for something using <code>mmap</code>. This was a cool problem. Having found the <code>bytestring-mmap</code> package, I reckon I will reach again for it next time I am playing with very large files in Haskell. Thanks for the question!"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1484463171, "last_edit_date": 1484463171, "creation_date": 1484453923, "answer_id": 41657786, "question_id": 41656678, "link": "https://stackoverflow.com/questions/41656678/haskell-read-last-line-with-a-lazy-mmap/41657786#41657786", "title": "Haskell Read Last Line with a Lazy mmap", "body": "<p>I would prefer the use of <a href=\"https://hackage.haskell.org/package/bytestring-mmap-0.2.2\" rel=\"nofollow noreferrer\"><code>bytestring-mmap</code></a> made by the same author as <code>bytestring</code>. In either case, all you need is</p>\n\n<pre><code>import System.IO.Posix.MMap (unsafeMMapFile)\nimport qualified Data.ByteString.Char8 as BS\n\nmain = do\n   -- can be swapped out for `mmapFileByteString` from `mmap`\n  bs &lt;- unsafeMMapFile \"file.txt\"\n\n  let (firstLine, _) = BS.break (== '\\n') bs\n      (_, lastLine) = BS.breakEnd (== '\\n') bs\n\n  putStrLn $ \"First line: \" ++ BS.unpack firstLine\n  putStrLn $ \"Last line: \" ++ BS.unpack lastLine\n</code></pre>\n\n<p>This runs instantly too, with no extra allocations. As before, there is the caveat that many files end in newlines, so one may want to have <code>BS.breakEnd (== '\\n') (init bs)</code> to ignore the last <code>\\n</code> character.</p>\n\n<p>Also, I would not recommend reversing the bytestring - that will require at least some allocations, which are in this case completely avoidable. Even if you use a lazy bytestring, you still pay the cost of going through all the chunks of the bytestring (which hopefully shouldn't even have been constructed at this point). That said, your reversing code <em>should</em> work. I reckon something is off with <code>mmap</code> (probably the package as the doing the same thing with a strict bytestring works just fine). </p>\n\n<h3>Previous answer, from before OP's edit</h3>\n\n<p>I'm not sure what the problem is with the functions in <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html\" rel=\"nofollow noreferrer\"><code>System.IO</code></a>. The following runs instantly on my laptop, file <code>file.txt</code> being almost 4GB. It isn't elegant, but it is certainly efficient.</p>\n\n<pre><code>import System.IO\n\nhGetLastLine :: Handle -&gt; IO String\nhGetLastLine hdl = go \"\" (negate 1)\n  where\n  go s i = do\n    hSeek hdl SeekFromEnd i\n    c &lt;- hGetChar hdl\n    if c == '\\n'\n      then pure s\n      else go (c:s) (i-1)\n\n\nmain = do\n  handle &lt;- openFile \"file.txt\" ReadMode\n\n  firstLine &lt;- hGetLine handle\n  putStrLn $ \"First line: \" ++ firstLine\n\n  lastLine &lt;- hGetLastLine handle\n  putStrLn $ \"Last line: \" ++ lastLine\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 41657786, "answer_count": 1, "score": 2, "last_activity_date": 1484463171, "creation_date": 1484441570, "last_edit_date": 1495535364, "question_id": 41656678, "link": "https://stackoverflow.com/questions/41656678/haskell-read-last-line-with-a-lazy-mmap", "title": "Haskell Read Last Line with a Lazy mmap", "body": "<p>I want to read the last line of my file and make sure it has the same number of fields as my first---I don't care about anything in the middle.  I'm using mmap because it's fast for random access on large files, but am encountering problems not understanding Haskell or laziness.</p>\n\n<pre><code>\u03bb&gt; import qualified Data.ByteString.Lazy.Char8 as LB\n\u03bb&gt; import System.IO.MMap\n\u03bb&gt; outh &lt;- mmapFileByteStringLazy fname Nothing \n\u03bb&gt; LB.length outh\n87094896\n\u03bb&gt; LB.takeWhile (`notElem` \"\\n\") outh\n\"\\\"Field1\\\",\\\"Field2\\\",\n</code></pre>\n\n<p>Great.</p>\n\n<p>From <a href=\"http://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Sequence.html#v:takeWhileR\" rel=\"nofollow noreferrer\">here</a>, I know that </p>\n\n<blockquote>\n  <p>takeWhileR p xs is equivalent to reverse (takeWhileL p (reverse\n  xs)).</p>\n</blockquote>\n\n<p>So let's make this.  That is, let's get the last line by reversing my lazy bytestring, taking while not \"\\n\" just as before, then unreversing it.  Laziness makes me think the compiler will let me do this easily.</p>\n\n<p>So trying this out:</p>\n\n<pre><code>LB.reverse (LB.takeWhile (`notElem` \"\\n\") (LB.reverse outh))\n</code></pre>\n\n<p>What I expect to see is:</p>\n\n<pre><code>\"\\\"val1\\\",\\\"val2\\\",\n</code></pre>\n\n<p>Instead, this crashes my session.  </p>\n\n<pre><code>Segmentation fault (core dumped)\n</code></pre>\n\n<p>Questions:</p>\n\n<ol>\n<li>What am I doing wrong with laziness, or bytestrings, or the mmap library, or Haskell?</li>\n<li>How can I get this line correctly and with memory efficiency?  (The answer possibly using foreign pointers instead of lazy bytestrings?)</li>\n</ol>\n\n<p>For other readers, if you're looking to get the last line, you may find a very fast and suitable method described in the answer here: <a href=\"https://stackoverflow.com/questions/41654849/hseek-and-seekfromend-in-haskell\">hSeek and SeekFromEnd in Haskell</a></p>\n\n<p>In this thread, I'm looking specifically for a solution using mmap.</p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1484440568, "post_id": 41656035, "comment_id": 70511927, "body": "<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#ghc-flag--interactive-print\" rel=\"nofollow noreferrer\">This</a> can get you the output without to much work. Alternately, <code>script</code> (called from a shell) could do the job (but might be a bit verbose)."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484476863, "post_id": 41656035, "comment_id": 70518855, "body": "Yeah, that hook is great. It might just work. Shame there isn&#39;t a similar one for input."}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484435600, "creation_date": 1484435600, "question_id": 41656035, "link": "https://stackoverflow.com/questions/41656035/get-ghci-input-and-output-history-of-the-current-session", "title": "Get GHCi input and output history of the current session", "body": "<p>Is there a way to get everything that was typed by the user and outputed by GHCi in the current session?</p>\n\n<p>I'm talking either from within the session itself, or externally from the process.</p>\n\n<p>I also need to know which lines are input and which are output.</p>\n"}, {"tags": ["haskell", "hunit"], "comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484433735, "post_id": 41655790, "comment_id": 70510255, "body": "It seems like from what I have seen so far it is impossible to use hunit with a non-IO Monad."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484433773, "post_id": 41655790, "comment_id": 70510267, "body": "an alternative to hunit?"}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484433835, "post_id": 41655790, "comment_id": 70510282, "body": "I&#39;m not sure. Is there a reason you are using Except? I would use <code>Maybe</code> instead here."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1484433892, "post_id": 41655790, "comment_id": 70510299, "body": "I have a more complex case, that is a shortest example"}], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1484436403, "post_id": 41656012, "comment_id": 70510980, "body": "thanks, I was already trying to use <code>runExcept</code> but I was getting some errors, and I wasn&#39;t sure was the right thing to do."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 2, "last_activity_date": 1484435314, "creation_date": 1484435314, "answer_id": 41656012, "question_id": 41655790, "link": "https://stackoverflow.com/questions/41655790/how-to-test-import-control-monad-except-with-hunit/41656012#41656012", "title": "how to test import Control.Monad.Except with Hunit?", "body": "<p>It's pretty straightforward to write some functions which use <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Except.html#v:runExcept\" rel=\"nofollow noreferrer\"><code>runExcept</code></a> to execute an <code>Except</code> action and use <a href=\"https://hackage.haskell.org/package/HUnit-1.5.0.0/docs/Test-HUnit-Base.html#v:-126--63--61-\" rel=\"nofollow noreferrer\"><code>~?=</code></a> to check its results.</p>\n\n<pre><code>shouldThrow :: Eq e =&gt; Except e a -&gt; e -&gt; Test\nm `shouldThrow` e = runExcept m ~?= Left e\n\nshouldReturn :: Eq a =&gt; Except e a -&gt; a -&gt; Test\nm `shouldReturn` x = runExcept m ~?= Right x\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>testFoo = TestList [\n    foo -11 2 `shouldThrow` \"Invalid parameter\",\n    foo 3 1 `shouldReturn` 4\n    ]\n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 41656012, "answer_count": 1, "score": 0, "last_activity_date": 1484435314, "creation_date": 1484433631, "question_id": 41655790, "link": "https://stackoverflow.com/questions/41655790/how-to-test-import-control-monad-except-with-hunit", "title": "how to test import Control.Monad.Except with Hunit?", "body": "<p>How can I test <code>Control.Monad.Except</code> (both guard results) a function like:</p>\n\n<pre><code>foo :: Double -&gt; Double -&gt; Except String Double\nfoo x y\n  | x &lt; -10.0 = throwError \"Invalid parameter\"\n  | otherwise = pure $ x + y\n</code></pre>\n\n<p>using <code>hunit</code>?</p>\n"}, {"tags": ["haskell", "reflex"], "answers": [{"comments": [{"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 1, "creation_date": 1484565742, "post_id": 41668325, "comment_id": 70547616, "body": "Many thanks! This is very clean, a good explanation and works perfectly. Unfortunately I have not yet enough points to upvote your answer..."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 1, "creation_date": 1484578616, "post_id": 41668325, "comment_id": 70555461, "body": "It&#39;s not necessary to import <code>GHCJS.DOM.Events</code>. Everything can be done within Reflex.Dom: The function call to <i>wrapDomEvent</i> can be deleted and the next line written as: <code>return (i &lt;$ domEvent Dblclick e)</code>"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1484579457, "post_id": 41668325, "comment_id": 70556019, "body": "Thanks!  Yes that&#39;s better of course.  I edited the answer accordingly."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 2, "last_activity_date": 1484579365, "last_edit_date": 1484579365, "creation_date": 1484530734, "answer_id": 41668325, "question_id": 41655463, "link": "https://stackoverflow.com/questions/41655463/how-to-get-a-doubleclicked-event-from-a-reflex-dom-listbox/41668325#41668325", "title": "How to get a DoubleClicked event from a reflex-dom listbox", "body": "<p>You can use <code>domEvent</code> to get at the double click.</p>\n\n<p>The following code uses <code>elAttr</code> to create a listbox like the one you created with dropdown.  The <code>domEvent</code> function is used to create double click <code>Event</code>'s for each of the listbox options which are then combined to get a <code>Dynamic</code> that represents the most recently double clicked option.</p>\n\n<p>I left the dropbox code in place for comparison purposes.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport           Reflex.Dom\nimport qualified Data.Text as T\nimport qualified Data.Map as Map\nimport           Data.Monoid((&lt;&gt;))\nimport           Data.Maybe (fromJust)\nimport           Data.Traversable (forM)\n\n\n-- a listbox that responds to double clicks\nlistbox :: MonadWidget t m =&gt;    T.Text                -- default\n                              -&gt; Map.Map T.Text T.Text -- entries\n                              -&gt; Map.Map T.Text T.Text -- attributes\n                              -&gt; m (Dynamic t T.Text)  \nlistbox def entries attr = do\n  optEv &lt;- elAttr \"select\" attr $ \n             forM (Map.toList entries) $ \\(i,c) -&gt; do\n\n               let sel = if i == def\n                         then \"selected\" =: \"selected\"\n                         else mempty \n\n               (e, _) &lt;- elAttr' \"option\"  sel $ text c\n\n               return (i &lt;$ domEvent Dblclick e)\n\n  holdDyn def $ leftmost optEv\n\nmain :: IO ()\nmain = mainWidget $ el \"div\" $ do\n  -- original code (responds to single clicks)\n  dd &lt;- dropdown \"2\" (constDyn countries) $ def &amp; attributes .~ constDyn (\"size\" =: \"10\")\n  el \"p\" $ return ()\n  let selItem = result &lt;$&gt; value dd\n  dynText selItem\n\n  el \"p\" $ return ()\n\n  -- new code (responds to double clicks)\n  lb &lt;- listbox \"3\" countries (\"size\" =: \"10\")\n  el \"p\" $ return ()\n  let dblItem = result &lt;$&gt; lb\n  dynText dblItem\n\n  return ()\n\ncountries :: Map.Map T.Text T.Text\ncountries = Map.fromList [(\"1\", \"France\"), (\"2\", \"Switzerland\"), (\"3\", \"Germany\"), (\"4\", \"Italy\"), (\"5\", \"USA\")]\n\nresult :: T.Text -&gt; T.Text\nresult key = \"You selected: \" &lt;&gt; fromJust (Map.lookup key countries)\n</code></pre>\n"}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 1, "accepted_answer_id": 41668325, "answer_count": 1, "score": 3, "last_activity_date": 1484579365, "creation_date": 1484431453, "question_id": 41655463, "link": "https://stackoverflow.com/questions/41655463/how-to-get-a-doubleclicked-event-from-a-reflex-dom-listbox", "title": "How to get a DoubleClicked event from a reflex-dom listbox", "body": "<p>The following code displays a reflex-dom dropdown element visually as a listbox and displays at the bottom always the last selected (clicked) line.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport           Reflex.Dom\nimport qualified Data.Text as T\nimport qualified Data.Map as Map\nimport           Data.Monoid((&lt;&gt;))\nimport           Data.Maybe (fromJust)\n\nmain :: IO ()\nmain = mainWidget $ el \"div\" $ do\n  dd &lt;- dropdown \"2\" (constDyn countries) $ def &amp; attributes .~ constDyn (\"size\" =: \"10\")\n  el \"p\" $ return ()\n  let selItem = result &lt;$&gt; value dd \n  dynText selItem\n  return ()\n\ncountries :: Map.Map T.Text T.Text\ncountries = Map.fromList [(\"1\", \"France\"), (\"2\", \"Switzerland\"), (\"3\", \"Germany\"), (\"4\", \"Italy\"), (\"5\", \"USA\")]\n\nresult :: T.Text -&gt; T.Text\nresult key = \"You selected: \" &lt;&gt; fromJust (Map.lookup key countries)\n</code></pre>\n\n<p>I want to change this code, so it displays at the bottom always the last <strong>double clicked</strong> line!</p>\n\n<p>I tried several things</p>\n\n<ul>\n<li>use the <em>domEvent</em> function: This does not work, because <em>Dropdown</em> is not an instance of the <em>HasDomEvent</em> class.</li>\n<li>filter the event in the value <em>_dropdown_change</em> of the Dropdown record. But I didn't find any way to filter only DoubleClick events.</li>\n<li>use the newtype <em>EventSelector</em>. Again I don't see hwo I can use it.</li>\n</ul>\n\n<p><strong>Question:</strong> How can I get at the double click event?</p>\n"}, {"tags": ["haskell", "io", "bind"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1484430004, "creation_date": 1484430004, "answer_id": 41655287, "question_id": 41655218, "link": "https://stackoverflow.com/questions/41655218/printing-timestamps-while-debugging-in-haskell/41655287#41655287", "title": "Printing Timestamps while Debugging in Haskell", "body": "<p>Your code is perfectly fine. Any programmer fluent in Haskell should understand it quickly.</p>\n\n<p>In my own style, though, I tend to prefer <code>let</code> in <code>do</code> blocks:</p>\n\n<pre><code>doSomeAction :: String -&gt; IO ()\ndoSomeAction arg1 = do\n  let makeTime = formatTime defaultTimeLocale \"%Y%m%d%H%M%S\" &lt;$&gt; getZonedTime\n  putStrLn =&lt;&lt; makeTime\n  theThingthatTakesAwhile arg1\n  putStrLn =&lt;&lt; makeTime\n</code></pre>\n\n<p>or possibly some variation of</p>\n\n<pre><code>doSomeAction :: String -&gt; IO ()\ndoSomeAction arg1 = do\n  let printTime = putStrLn . formatTime defaultTimeLocale \"%Y%m%d%H%M%S\" =&lt;&lt; getZonedTime\n  printTime\n  theThingthatTakesAwhile arg1\n  printTime\n</code></pre>\n\n<p>but again, It's only a matter of personal preference.</p>\n"}, {"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1484443279, "post_id": 41656226, "comment_id": 70512420, "body": "Can you provide an example to help me understand how to declare the initialization outside of my function so I can easily call <code>updateGlobalLogger rootLoggerName</code> inside?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1484576851, "post_id": 41656226, "comment_id": 70554347, "body": "@Mittenchops I&#39;ve updated answer with example of logging initialization."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1484576824, "last_edit_date": 1495540917, "creation_date": 1484437330, "answer_id": 41656226, "question_id": 41655218, "link": "https://stackoverflow.com/questions/41655218/printing-timestamps-while-debugging-in-haskell/41656226#41656226", "title": "Printing Timestamps while Debugging in Haskell", "body": "<p>You can do better if you use some logging library. For example <a href=\"https://www.stackage.org/lts-7.15/package/hslogger-1.2.10\" rel=\"nofollow noreferrer\"><code>hslogger</code></a>. It can print messages with timestamps. You can see examples of usages under this questions: <a href=\"https://stackoverflow.com/questions/40982746/hslogger-duplicate-log-lines/40995265#40995265\">hslogger &amp; Duplicate Log Lines</a></p>\n\n<p><strong>UPD:</strong> <em>Example with logging timestamps</em></p>\n\n<p>Here is complete example of module with initialization of logging:</p>\n\n<pre><code>import           Control.Concurrent        (threadDelay)\nimport           System.IO                 (stdout)\nimport           System.Log.Formatter      (simpleLogFormatter)\nimport           System.Log.Handler        (setFormatter)\nimport           System.Log.Handler.Simple (streamHandler)\nimport           System.Log.Logger         (Priority (DEBUG), debugM, rootLoggerName,\n                                            setHandlers, setLevel, updateGlobalLogger)\n\ninitLogging :: IO ()\ninitLogging = do\n    stdOutHandler &lt;- streamHandler stdout DEBUG &gt;&gt;= \\lh -&gt; return $\n            setFormatter lh (simpleLogFormatter \"[$loggername:$time] $msg\")\n    updateGlobalLogger rootLoggerName (setLevel DEBUG . setHandlers [stdOutHandler])\n\ndoSomeAction :: String -&gt; IO ()\ndoSomeAction arg1 = do\n    debugM \"someAction\" \"before long thing\"\n    theThingThatTakesAWhile arg1\n    debugM \"someAction\" \"after long thing\"\n\ntheThingThatTakesAWhile :: String -&gt; IO ()\ntheThingThatTakesAWhile arg = threadDelay (3 * 10^(6 :: Int)) &gt;&gt; putStrLn arg\n\nmain :: IO ()\nmain = do\n    initLogging\n    doSomeAction \"some long action\" \n</code></pre>\n\n<p>And the output is:</p>\n\n<pre><code>[someAction:2017-01-16 17:19:49 MSK] before long thing\nsome long action\n[someAction:2017-01-16 17:19:52 MSK] after long thing\n</code></pre>\n\n<p>If you want time to be printed as timestamps (only seconds) than you can use <a href=\"http://hackage.haskell.org/package/hslogger-1.2.10/docs/System-Log-Formatter.html#v:tfLogFormatter\" rel=\"nofollow noreferrer\"><code>tfLogFormatter</code></a> function to specify exact format of your message.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1484576824, "creation_date": 1484429486, "question_id": 41655218, "link": "https://stackoverflow.com/questions/41655218/printing-timestamps-while-debugging-in-haskell", "title": "Printing Timestamps while Debugging in Haskell", "body": "<p>I'm still learning Haskell and debugging some functions, and usually have a timestamp function to get a sense of when certain operations start and stop:</p>\n\n<pre><code>doSomeAction :: String -&gt; IO ()\ndoSomeAction arg1 = do\n  putStrLn =&lt;&lt; makeTime\n  theThingthatTakesAwhile arg1\n  putStrLn =&lt;&lt; makeTime\n  where\n    makeTime = (formatTime defaultTimeLocale \"%Y%m%d%H%M%S\") &lt;$&gt; getZonedTime\n</code></pre>\n\n<p>Is my <code>=&lt;&lt;</code> and <code>where</code> clause containing an <code>&lt;$&gt;</code> a reasonable way to interact with the IO around <code>getZonedTime</code>?  </p>\n\n<pre><code>\u03bb&gt; :t getZonedTime\ngetZonedTime :: IO ZonedTime\n</code></pre>\n\n<p>Or is this misleading to me or the reader or non-idiomatic? </p>\n\n<p>Output is:</p>\n\n<pre><code>20170114152312\nDoing some long function....\n20170114152336\n</code></pre>\n\n<p>Which is exactly what I want to see---it tells me what I need.  Just seems odd to <code>putStrLn =&lt;&lt; something</code> to get that effect.</p>\n"}, {"tags": ["haskell", "mmap"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1484430544, "post_id": 41654849, "comment_id": 70509360, "body": "It seems that <code>hSeek outh SeekFromEnd 1000</code> moved to 1000 bytes <i>after</i> the end! That should not happen. <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hSeek\" rel=\"nofollow noreferrer\">&quot;It is not possible to set a negative I/O position, or for a physical file, an I/O position beyond the current end-of-file.&quot;</a> Now I&#39;m confused as well. Anyway, I think you should use offset -1000."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484436890, "post_id": 41654849, "comment_id": 70511092, "body": "Ah, I should have used the ancient science of subtraction.  Thanks, @chi, didn&#39;t even notice that."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484455460, "post_id": 41654849, "comment_id": 70514458, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/41656678/haskell-read-last-line-with-a-lazy-mmap\">Haskell Read Last Line with a Lazy mmap</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484455507, "post_id": 41654849, "comment_id": 70514467, "body": "I&#39;m voting to close this as a duplicate of your newer question. My answer there answers your questions here to. I wish I had seen this question first and put my answer here instead. Oh well. :)"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484456073, "post_id": 41654849, "comment_id": 70514555, "body": "Thank you as always for your help @Alec.  Any chance you can rather move that answer here, and we keep that thread open for an answer using mmap, where this one uses seek?  I&#39;d like to learn both IO patterns."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484456638, "post_id": 41654849, "comment_id": 70514670, "body": "@Mittenchops Fair point, I guess."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484456763, "post_id": 41654849, "comment_id": 70514689, "body": "Thanks again, @Alec.  I&#39;ll learn Haskell yet...!"}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1484460063, "post_id": 41658016, "comment_id": 70515246, "body": "This works super quickly on my machine.  I had to change  hGetLastLine hdl = go &quot;&quot; (negate 2) To do exactly what you said, with the last character being \\n.  I guess on windows it would need to be 3 because of \\r\\n..."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1484457006, "creation_date": 1484457006, "answer_id": 41658016, "question_id": 41654849, "link": "https://stackoverflow.com/questions/41654849/hseek-and-seekfromend-in-haskell/41658016#41658016", "title": "hSeek and SeekFromEnd in Haskell", "body": "<p>The offset to <code>SeekFromEnd</code> is expected to be negative.</p>\n\n<p>As for getting the last line of a file, we come across the annoyance that we have to scan each character from the end, one by one, every time resetting the position. That said, we <em>can</em> do it - we just keep moving back until we encounter the first <code>\\n</code> character. </p>\n\n<pre><code>import System.IO\n\n-- | Given a file handle, find the last line. There are no guarantees as to the \n-- position of the handle after this call, and it is expected that the given\n-- handle is seekable.\nhGetLastLine :: Handle -&gt; IO String\nhGetLastLine hdl = go \"\" (negate 1)\n  where\n  go s i = do\n    hSeek hdl SeekFromEnd i\n    c &lt;- hGetChar hdl\n    if c == '\\n'\n      then pure s\n      else go (c:s) (i-1)\n</code></pre>\n\n<p>You may want to add an off by one here, as most files generally end in an <code>\\n</code> (and that empty line is probably not what you want)</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 41658016, "answer_count": 1, "score": 3, "last_activity_date": 1484457006, "creation_date": 1484426852, "last_edit_date": 1484456844, "question_id": 41654849, "link": "https://stackoverflow.com/questions/41654849/hseek-and-seekfromend-in-haskell", "title": "hSeek and SeekFromEnd in Haskell", "body": "<p>I'm looking to retrieve just the last line of a file quickly in Haskell---starting from the end, not the beginning---and having some difficulties using hSeek correctly.</p>\n\n<p>It seems the <code>SeekFromEnd N</code> behaves differently than finding the length of the file <code>sz</code>, and using <code>AbsoluteSeek</code> to go <code>(sz - N)</code> bytes.</p>\n\n<pre><code>outh &lt;- openFile \"test.csv\" ReadMode\n\n\u03bb&gt; hIsSeekable outh\nTrue\n\n\u03bb&gt; hFileSize outh\n81619956\n\u03bb&gt; hSeek outh AbsoluteSeek 1000\n\u03bb&gt; hTell outh\n1000\n\n\u03bb&gt; hSeek outh SeekFromEnd 1000\n\u03bb&gt; hTell outh\n81620956\n\n\u03bb&gt; hSeek outh AbsoluteSeek 0\n\u03bb&gt; hGetLine outh\n\"here's my data\"\n\n\u03bb&gt; hSeek outh SeekFromEnd 10000\n-*** Exception: test.csv: hGetLine: end of file\n</code></pre>\n\n<p>Hm, that's weird.</p>\n\n<p>So, I made a function that does this with absolute instead:</p>\n\n<pre><code>\u03bb&gt; hSeek outh SeekFromEnd 100000\n\u03bb&gt; hTell outh\n81719956\n\nfromEnd outh = do\n  sz &lt;- hFileSize outh\n  hSeek outh AbsoluteSeek (sz - 100000)\n\n\u03bb&gt; fromEnd outh\n\n\u03bb&gt; hTell outh\n81519956\n</code></pre>\n\n<p>So output-wise, they have different answers which is weird.  Additionally, I can now also use hGetLine, which SeekFromEnd failed on:</p>\n\n<pre><code>\u03bb&gt; hGetLine outh\n\"partial output\"\n\u03bb&gt; hGetLine outh\n\"full output, lots of fields, partial output\"\n</code></pre>\n\n<p>Not clear to me what's going on here.  Why does my fromEnd behave differently than SeekFromEnd in permitting hGetLine?</p>\n\n<p>Part II of the question: what /would/ be the right strategy for starting at the end of the file and seeking backwards to the first newline (the first \\n after the EOF newline)? </p>\n\n<p>In this question, I'm looking specifically for an answer using SeekFromEnd.</p>\n"}, {"tags": ["haskell", "demorgans-law", "dot-operator"], "answers": [{"tags": [], "owner": {"reputation": 353, "user_id": 1813349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f9c49512653eaa772fed0b1e25a9028?s=128&d=identicon&r=PG", "display_name": "Alex Shpilkin", "link": "https://stackoverflow.com/users/1813349/alex-shpilkin"}, "is_accepted": true, "score": 3, "last_activity_date": 1484414217, "creation_date": 1484414217, "answer_id": 41652775, "question_id": 41652495, "link": "https://stackoverflow.com/questions/41652495/haskell-dot-operator-in-de-morgans-law-implementation/41652775#41652775", "title": "Haskell dot (.) operator in de Morgan&#39;s law implementation", "body": "\n\n<p>Recall that the definition of the <code>.</code> operator is <code>(f . g) x = f (g x)</code>, <em>i.e.</em> <code>f . g = \\x -&gt; f (g x)</code> (syntactically, it is a <em>binary</em> operator, it is just that Haskell\u2019s syntax sugar permits the latter definition to be restated as the former). So, the definition you have can be rephrased as</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>notAorB f = ((\\x -&gt; f (Left x)), (\\y -&gt; f (Right y)))\n</code></pre>\n\n<p>(this can be done mechanically by <a href=\"https://wiki.haskell.org/Lambdabot\" rel=\"nofollow noreferrer\">Lambdabot</a> on <a href=\"https://wiki.haskell.org/IRC_channel\" rel=\"nofollow noreferrer\">#haskell</a>, tell him to <code>@unpl \u2039expr\u203a</code>), or more verbosely</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>notAorB f = (lt, rt)\n  where lt x = f (Left x)\n        rt y = f (Right y)\n</code></pre>\n\n<hr>\n\n<p>As always, try writing down the types. If <code>(.) :: \u2200 s t u. (t -&gt; u) -&gt; (s -&gt; t) -&gt; s -&gt; u</code>, <code>f :: Either a b -&gt; c</code>, <code>Left :: \u2200 p q. p -&gt; Either p q</code>, then <code>f . Left</code> or <code>(.) f Left :: a -&gt; c</code>, <em>etc.</em></p>\n"}], "owner": {"reputation": 1205, "user_id": 3650662, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/99956760f1ddc06f88b1ebbd01701b33?s=128&d=identicon&r=PG&f=1", "display_name": "helencrump", "link": "https://stackoverflow.com/users/3650662/helencrump"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 41652775, "answer_count": 1, "score": 2, "last_activity_date": 1484414217, "creation_date": 1484412640, "last_edit_date": 1495542832, "question_id": 41652495, "link": "https://stackoverflow.com/questions/41652495/haskell-dot-operator-in-de-morgans-law-implementation", "title": "Haskell dot (.) operator in de Morgan&#39;s law implementation", "body": "<p>In <a href=\"https://stackoverflow.com/questions/37016673/de-morgans-laws-in-haskell-via-the-curry-howard-correspondence\">this question</a>, the author has written an implementation of de Morgan's laws in Haskell. I understand the implementations of <code>notAandnotB</code>, and <code>notAornotB</code>, but I'm struggling to understand the implementation of <code>notAorB</code> which is:</p>\n\n<pre><code>notAorB :: (Either a b -&gt; c) -&gt; (a -&gt; c, b -&gt; c)\nnotAorB f = (f . Left, f . Right)\n</code></pre>\n\n<p>Could someone explain how the <code>(f . Left, f . Right)</code> part works? I've seen the <code>.</code> operator used before, but with three arguments, not two.</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 2, "last_activity_date": 1484408497, "creation_date": 1484408497, "answer_id": 41651786, "question_id": 41651739, "link": "https://stackoverflow.com/questions/41651739/more-general-pattern-matching/41651786#41651786", "title": "More general pattern matching", "body": "<p>You can use guards:</p>\n\n<pre><code>f x y | x &lt; 0 = ...\nf x y | y &gt; someValue = ...\nf x y | otherwise = ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": false, "score": 2, "last_activity_date": 1484408515, "creation_date": 1484408515, "answer_id": 41651790, "question_id": 41651739, "link": "https://stackoverflow.com/questions/41651739/more-general-pattern-matching/41651790#41651790", "title": "More general pattern matching", "body": "<p>Sure, there is a mechanism called <a href=\"https://wiki.haskell.org/Pattern_guard\" rel=\"nofollow noreferrer\">guards</a> for that:</p>\n\n<pre><code>f x y | x &lt; 0 = y\n</code></pre>\n"}], "owner": {"reputation": 156, "user_id": 6454491, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/29f7a4c16db6818c194c04a56eb60b46?s=128&d=identicon&r=PG&f=1", "display_name": "user6454491", "link": "https://stackoverflow.com/users/6454491/user6454491"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 41651786, "answer_count": 2, "score": -2, "last_activity_date": 1484413919, "creation_date": 1484408262, "last_edit_date": 1484408613, "question_id": 41651739, "link": "https://stackoverflow.com/questions/41651739/more-general-pattern-matching", "title": "More general pattern matching", "body": "<p>If I have a function, for example</p>\n\n<pre><code>f :: Int -&gt; Int -&gt; Int\nf x y = x + y\n</code></pre>\n\n<p>and I want to have different functionality based on the parameters, I use pattern matching.<br>\nI have only found the syntax of how to match against concrete values, e.g.</p>\n\n<pre><code>f 0 y = y\n</code></pre>\n\n<p>Is it possible to match against something more general?<br>\nI would like to have different functionality in the case that the first parameter is less than 0. A second case could be if the second parameter exceeds a certain value.</p>\n"}, {"tags": ["haskell", "import", "module"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 3, "creation_date": 1484406654, "post_id": 41650983, "comment_id": 70501635, "body": "In ghci use <code>:l Cube.hs</code> to load a source file."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1484408286, "post_id": 41650983, "comment_id": 70502113, "body": "<code>import</code> takes a module name, not a file name"}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1525975841, "creation_date": 1525975841, "answer_id": 50279043, "question_id": 41650983, "link": "https://stackoverflow.com/questions/41650983/haskell-parse-error-on-input/50279043#50279043", "title": "Haskell parse error on input", "body": "<p>Start <code>GHCi</code>:</p>\n\n<ul>\n<li>ghci <code>Cube.hs</code></li>\n<li>stack ghci <code>Cube.hs</code></li>\n</ul>\n\n<p>While already in <code>GHCi</code>:</p>\n\n<ul>\n<li><code>:l Cube.hs</code> or <code>:load Cube.hs</code></li>\n<li><code>:r Cube.hs</code> or <code>:reload Cube.hs</code></li>\n</ul>\n\n<p>You can see all the available types and functions by entering <code>:browse</code>.</p>\n"}], "owner": {"reputation": 41, "user_id": 3741208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3079879ae6c1d4ffa3409d22da9e717b?s=128&d=identicon&r=PG&f=1", "display_name": "dor132", "link": "https://stackoverflow.com/users/3741208/dor132"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 560, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525975841, "creation_date": 1484403578, "last_edit_date": 1484404053, "question_id": 41650983, "link": "https://stackoverflow.com/questions/41650983/haskell-parse-error-on-input", "title": "Haskell parse error on input", "body": "<p>I'm new to haskell, and I'm trying to play around with some modules.\nI wrote this very basic module:</p>\n\n<pre><code>module Cube\n(\n    cubeArea\n) where\n\ncubeArea :: Float -&gt; Float\ncubeArea sideSize = sideSize * sideSize * sideSize\n</code></pre>\n\n<p>in a file named \"Cube.hs\".\nThen, I opened ghci in the cmd in the same folder the Cube.hs is.\nNow, when I type <code>import Cube.hs</code>, I get this error:</p>\n\n<blockquote>\n  <p>:26:8: error: parse error on input `Cube.hs'</p>\n</blockquote>\n\n<p>Any idea why?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": true, "score": 2, "last_activity_date": 1484402633, "creation_date": 1484402633, "answer_id": 41650839, "question_id": 41650652, "link": "https://stackoverflow.com/questions/41650652/haskel-currying-merging-functions/41650839#41650839", "title": "Haskel Currying merging functions", "body": "<pre><code>const :: a -&gt; b -&gt; a\nid :: c -&gt; c\n</code></pre>\n\n<p>const before applied with id</p>\n\n<pre><code>const :: (c-&gt;c) -&gt; b -&gt; (c-&gt;c)\n</code></pre>\n\n<p>const after applied id</p>\n\n<pre><code>const id :: b -&gt; (c -&gt; c)\nconst id :: b -&gt; c -&gt; c\n</code></pre>\n\n<p>No matter what you apply to <code>const id</code> you get <code>c -&gt; c</code></p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1484402674, "creation_date": 1484402674, "answer_id": 41650845, "question_id": 41650652, "link": "https://stackoverflow.com/questions/41650652/haskel-currying-merging-functions/41650845#41650845", "title": "Haskel Currying merging functions", "body": "<p><code>const x :: b -&gt; ??</code>, where <code>??</code> is the type of <code>x</code>. In this case, <code>x</code> is the function <code>id</code>, which has type <code>a -&gt; a</code>. Thus, <code>const id :: b -&gt; (a -&gt; a)</code>, and you can drop the parentheses because <code>-&gt;</code> is right-associative.</p>\n"}], "owner": {"reputation": 372, "user_id": 2397226, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ecf8aae1b1c82da6448fdac37204319e?s=128&d=identicon&r=PG", "display_name": "MrX", "link": "https://stackoverflow.com/users/2397226/mrx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 41650839, "answer_count": 2, "score": 0, "last_activity_date": 1484402674, "creation_date": 1484401355, "last_edit_date": 1484401930, "question_id": 41650652, "link": "https://stackoverflow.com/questions/41650652/haskel-currying-merging-functions", "title": "Haskel Currying merging functions", "body": "<p>Quick question I'm unable to understand how and why the following type definition gets formulated</p>\n\n<pre><code>:t const\nconst :: a -&gt; b -&gt; a\n\n:t id\nid :: a -&gt; a\n\n:t (const id)\n(const id) :: b -&gt; a -&gt; a\n</code></pre>\n\n<p>Doesn't the following actually resolve too <code>a -&gt; a -&gt; b -&gt; a</code> where  <code>a -&gt; a</code> is feed inside of <code>a -&gt; b -&gt; a</code> AKA <code>(const(id _))</code> </p>\n\n<p>anyone mind explaining how this is actually being transformed?</p>\n"}, {"tags": ["list", "haskell", "concat"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1484399573, "post_id": 41650315, "comment_id": 70499417, "body": "I don&#39;t think there&#39;s a standard library function that helps you very much with this, but it&#39;s really not so difficult to code this up yourself, at least if you don&#39;t mind <i>O</i> (<i>n</i> &#178;) complexity."}, {"owner": {"reputation": 7892, "user_id": 3310334, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/BTb0z.jpg?s=128&g=1", "display_name": "theonlygusti", "link": "https://stackoverflow.com/users/3310334/theonlygusti"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484399653, "post_id": 41650315, "comment_id": 70499432, "body": "@leftaroundabout I can&#39;t figure out how to do that, I&#39;ve been trying for  a while now xD"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1484399786, "post_id": 41650315, "comment_id": 70499474, "body": "Well, the na&#239;ve way would be to try out all possible prefixes (<a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:tails\" rel=\"nofollow noreferrer\"><code>tails</code></a> from the first list) that you could possibly strip from the second one. Choose the longest."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1484400172, "post_id": 41650315, "comment_id": 70499595, "body": "I think you can do it with a simple recursive solution that&#39;s <code>O(length(l1))</code>: first see whether <code>l1</code> is a prefix of <code>l2</code>, then whether <code>tail l1</code> is a prefix of <code>l2</code>, then <code>tail (tail l1))</code> is a prefix of <code>l2</code>..."}, {"owner": {"reputation": 7892, "user_id": 3310334, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/BTb0z.jpg?s=128&g=1", "display_name": "theonlygusti", "link": "https://stackoverflow.com/users/3310334/theonlygusti"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1484400264, "post_id": 41650315, "comment_id": 70499625, "body": "@mb21 <code>tails</code> returns a list of lists. Therefore, <code>tails ...</code> will never be a prefix of <code>l2</code>"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1484400506, "post_id": 41650315, "comment_id": 70499701, "body": "@theonlygusti right, I meant <code>tail</code> not <code>tails</code> (corrected the comment above)... but <code>tails</code> is of course a nice solutions as well.. btw, you don&#39;t have to &quot;choose the longest&quot; since &quot;The tails function returns all final segments of the argument, longest first.&quot; so it should be O(n), right?"}], "answers": [{"tags": [], "owner": {"reputation": 7892, "user_id": 3310334, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/BTb0z.jpg?s=128&g=1", "display_name": "theonlygusti", "link": "https://stackoverflow.com/users/3310334/theonlygusti"}, "is_accepted": false, "score": 1, "last_activity_date": 1484401197, "creation_date": 1484401197, "answer_id": 41650627, "question_id": 41650315, "link": "https://stackoverflow.com/questions/41650315/concatenate-lists-without-overlap/41650627#41650627", "title": "Concatenate (++) lists without overlap", "body": "<p>I found a way to do it:</p>\n\n<pre><code>import Data.List\noverlap xs ys = xs ++ (ys \\\\ (head ((tails xs) `intersect` (inits ys))))\n</code></pre>\n\n<p>but I don't find it very attractive and am hoping someone can improve upon it.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 7418640, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/97f2f9337c9f9ca8ba742e91349652ab?s=128&d=identicon&r=PG", "display_name": "user7418640", "link": "https://stackoverflow.com/users/7418640/user7418640"}, "is_accepted": false, "score": 2, "last_activity_date": 1484401919, "last_edit_date": 1484401919, "creation_date": 1484401367, "answer_id": 41650654, "question_id": 41650315, "link": "https://stackoverflow.com/questions/41650315/concatenate-lists-without-overlap/41650654#41650654", "title": "Concatenate (++) lists without overlap", "body": "<p>Here's a simple recursive solution:</p>\n\n<pre><code>magic x y = f x y y\n  where f [] y z = y\n        f x [] z = x\n        f (x:xs) (y:ys) z = x : if x == y then f xs ys z else f xs z z\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 0, "last_activity_date": 1484403116, "creation_date": 1484403116, "answer_id": 41650907, "question_id": 41650315, "link": "https://stackoverflow.com/questions/41650315/concatenate-lists-without-overlap/41650907#41650907", "title": "Concatenate (++) lists without overlap", "body": "<p>Since noone wrote this one up yet:</p>\n\n<pre><code>import Data.List (isPrefixOf)\n\nmagic xs ys = s' ++ r'\n  where\n    (s', r') = go xs\n    go []    = ([], [])\n    go (x:xs)\n      | isPrefixOf (x:xs) ys = ([], ys)\n      | otherwise            = (x:s, r)\n        where\n          (s, r) = go xs\n</code></pre>\n"}], "owner": {"reputation": 7892, "user_id": 3310334, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/BTb0z.jpg?s=128&g=1", "display_name": "theonlygusti", "link": "https://stackoverflow.com/users/3310334/theonlygusti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1484403116, "creation_date": 1484399273, "last_edit_date": 1484399629, "question_id": 41650315, "link": "https://stackoverflow.com/questions/41650315/concatenate-lists-without-overlap", "title": "Concatenate (++) lists without overlap", "body": "<p>Imagine I have two lists:</p>\n\n<pre><code>l1 = \"Hey there\"\nl2 = \"there is a turtle\"\n</code></pre>\n\n<p>how do I \"concatenate\" the lists but remove the start of the second list that matches the end of the first?</p>\n\n<pre><code>magic l1 l2 == \"Hey there is a turtle\"\n</code></pre>\n\n<hr>\n\n<p>More examples,</p>\n\n<pre><code>magic \"What's going on\" \"ing on in the world\" == \"What's going on in the world\"\nmagic [1,2,3,2] [2,3,2,1] == [1,2,3,2,1]\nmagic [1..10] [5..20] == [1..20]\nmagic [1,2] [1,2] == []\n</code></pre>\n\n<p>What I'm looking for is something that will concatenate the lists and then remove the parts - only at the \"joint\" - where the lists matched up.</p>\n\n<hr>\n\n<p>Things I've looked at: </p>\n\n<ul>\n<li><code>++</code> just concatenates, so isn't what I'm after.</li>\n<li><code>Data.List</code>'s <code>\\\\</code> list difference operator starts from the front of the first list and removes the occurrence from the second list no matter where it is, so won't work.</li>\n<li>I couldn't figure out if I could use <code>stripPrefix</code> for this, maybe it's doable but my understanding of haskell isn't good enough.</li>\n</ul>\n\n<p>I've also looked through <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html\" rel=\"nofollow noreferrer\">the entire Data.List</a> module, and couldn't find anything that does what I want out of the box. </p>\n\n<p>Thus it looks like it's necessary to make our own function to do this, in which case a Prelude-function solution is preferable over something with dependencies.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 302, "user_id": 5894529, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-srgjd8HpmJM/AAAAAAAAAAI/AAAAAAAAAFA/NuZYLQlwJPY/photo.jpg?sz=128", "display_name": "David Whitlock", "link": "https://stackoverflow.com/users/5894529/david-whitlock"}, "edited": false, "score": 0, "creation_date": 1484383794, "post_id": 41648122, "comment_id": 70495648, "body": "The code you have quoted runs fine. I think your error must be somewhere else."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1484383945, "post_id": 41648122, "comment_id": 70495677, "body": "<code>d</code> is indented with spaces, <code>e</code> is indented by TABs. GHC does not see them aligned on the same column. (GHC should also warn about this, at least newer GHCs do...)"}, {"owner": {"reputation": 1, "user_id": 7417968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37eb73e912eabdbae19cd96ed66d443c?s=128&d=identicon&r=PG&f=1", "display_name": "RackemW", "link": "https://stackoverflow.com/users/7417968/rackemw"}, "edited": false, "score": 0, "creation_date": 1484415441, "post_id": 41648122, "comment_id": 70504560, "body": "Interesting. I was given this assignment and have no experience with haskell. So based on some haskell tutorials I banged the code out. Can&#39;t seem to get it to run on my end, but perhaps I am trying to run it the wrong way."}], "owner": {"reputation": 1, "user_id": 7417968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37eb73e912eabdbae19cd96ed66d443c?s=128&d=identicon&r=PG&f=1", "display_name": "RackemW", "link": "https://stackoverflow.com/users/7417968/rackemw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "closed_date": 1484397514, "answer_count": 0, "score": 0, "last_activity_date": 1484383018, "creation_date": 1484382516, "last_edit_date": 1484383018, "question_id": 41648122, "link": "https://stackoverflow.com/questions/41648122/haskell-parse-error-on-input-for-quadratic-formula", "closed_reason": "Duplicate", "title": "Haskell parse error on input &#39;=&#39; for quadratic formula", "body": "<p>I am trying to write a haskell function which will calculate the two roots of the quadratic function. I keep getting the error \"parse error on input '='. It further says that \"perhaps you need a 'let' in a 'do'block. </p>\n\n<pre><code>import Data.List\nimport System.IO\n\nquad :: (Double, Double, Double) -&gt; (Double, Double)\nquad (a, b, c) = (x0, x1)\n    where\n        d = b * b - (4 * a * c)\n        e = - b / (2 * a)\n        x0 = e + sqrt d / (2 * a)\n        x1 = e - sqrt d / (2 * a)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "purescript"], "comments": [{"owner": {"reputation": 2111, "user_id": 1434220, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d48e2a034dc8b5a8d28840c68e71f902?s=128&d=identicon&r=PG", "display_name": "hdgarrood", "link": "https://stackoverflow.com/users/1434220/hdgarrood"}, "edited": false, "score": 4, "creation_date": 1484383857, "post_id": 41647753, "comment_id": 70495660, "body": "Try to start just by writing a function which takes a single record and returns a single &lt;li&gt; element, suppose it&#39;s called <code>recordToHtml</code>. Then I think the function you want is <code>map recordToHtml</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "edited": false, "score": 0, "creation_date": 1484531877, "post_id": 41650746, "comment_id": 70534959, "body": "Thank you very much! Great explanation and the &quot;ah-hah&quot; I needed."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 15, "last_activity_date": 1513251933, "last_edit_date": 1513251933, "creation_date": 1484401975, "answer_id": 41650746, "question_id": 41647753, "link": "https://stackoverflow.com/questions/41647753/thinking-functionally-building-a-new-array-in-haskell-purescript/41650746#41650746", "title": "Thinking Functionally. Building a New Array in Haskell / Purescript", "body": "<blockquote>\n  <p>My first idea was vaguely around creating a list with something like</p>\n\n<pre><code>take $ length xs $ repeat ARecordObject\n</code></pre>\n  \n  <p>and then map the record over that list, but I wasn't really sure how\n  to translate that into code. It seemed wrong anyway, since my plan\n  involved mutating the state of <code>ARecordObject</code>, which is a no-no.</p>\n</blockquote>\n\n<p>Functional programmers don't just avoid mutation because it's a no-no (indeed, many functional programs make careful use of a controlled dose of mutability) - we do it because it produces safer, simpler code.</p>\n\n<p>To wit: You're thinking in what I call \"alloc-init mode\", wherein you create some sort of \"empty\" value and then go about calculating its properties. Forgive my vehemency, but that's a <em>fundamentally broken</em> programming model, left over from the days of manual memory management; code which uses it will never be safe and abstractions relying on it will forever be leaky. The idiom doesn't fit into any language that's higher-level than C, and yet, if I had a pound for every time I see code like this...</p>\n\n<pre><code>var foo = new Foo();\nfoo.Bar = new Bar();\nfoo.Bar.Baz = new Baz();\n</code></pre>\n\n<p>...I would be a rich man (na na na). The default should be to create objects after you know what they're going to look like:</p>\n\n<pre><code>var foo = new Foo(new Bar(new Baz()));\n</code></pre>\n\n<p>This is simpler - you're just <em>calculating a value</em>, rather than reaching into the memory referenced by a pointer to update its contents - and more importantly it's safer because the type-checker ensures that you haven't forgotten a property and it allows you to make <code>Foo</code> immutable. The cleanest imperative code is functional code - you should only be imperative where necessary for performance (or when the language forces your hand).</p>\n\n<hr>\n\n<p>Anyway, rant over. The point is that you're making life harder for yourself than necessary by thinking imperatively. Just write a function that calculates a single <code>&lt;li&gt;</code> from a single object...</p>\n\n<pre><code>toLi :: MyRecord -&gt; HTML\ntoLi x = li [ id_ x.id, name_ x.name, class_ x.class ] [ text x.content ]\n</code></pre>\n\n<p>... (note that I'm not somehow creating an \"empty\" <code>li</code> and then populating its values), and then <code>map</code> it over your input list.</p>\n\n<pre><code>toLis :: [MyRecord] -&gt; [HTML]\ntoLis = map toLi\n</code></pre>\n\n<p>This is how I'd do it in JS, too, even though I'm not <em>required</em> to by the language. No side-effects, no mutation, no need for <code>Eff</code> - just simple, safe, purely functional code.</p>\n"}], "owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 41650746, "answer_count": 1, "score": 5, "last_activity_date": 1513251933, "creation_date": 1484378758, "question_id": 41647753, "link": "https://stackoverflow.com/questions/41647753/thinking-functionally-building-a-new-array-in-haskell-purescript", "title": "Thinking Functionally. Building a New Array in Haskell / Purescript", "body": "<p>I'm new to functional programming, and I've decided to build an app in Purescript. I've hit my first hurdle, and I'm not sure how to think about this conceptually.</p>\n\n<blockquote>\n  <p>I'm not looking for code as much as a way to think functionally about this problem.</p>\n</blockquote>\n\n<p>I have a list of data. Specifically, something like</p>\n\n<pre><code>[ {a :: String, b :: String, c :: String} ]\n</code></pre>\n\n<p>I would like to create a list of <code>Html</code> (which is a <code>purescript-halogen</code> type) by using the record provided (with a list of the above types).</p>\n\n<p>So, I would have a function</p>\n\n<pre><code>buildElements :: forall p i. MyRecordObject -&gt; Array (HTML p i)\n</code></pre>\n\n<p>Now, I think I'm going to need to give this function result type a Monad computational context (purescript <code>Eff</code> is like Haskell <code>IO</code>)</p>\n\n<p>So something like:</p>\n\n<pre><code>buildElements :: forall p i. MyRecordObject -&gt; Eff (Array (HTML p i))\n</code></pre>\n\n<p>My first idea was vaguely around creating a list with something like</p>\n\n<pre><code>take $ length xs $ repeat ARecordObject\n</code></pre>\n\n<p>and then map the record over that list, but I wasn't really sure how to translate that into code. It seemed wrong anyway, since my plan involved mutating the state of <code>ARecordObject</code>, which is a no-no.</p>\n\n<p>So then I found this function:</p>\n\n<pre><code>forEach :: forall e a. Array a -&gt; (a -&gt; Eff e Unit) -&gt; Eff Unit\n</code></pre>\n\n<p>which looks almost perfect! I get an array, I give it a function that somehow assigns the properties in the record to this new array...but no, wait...I'm thinking non-functionally again.</p>\n\n<p>I'm really at a bit of a loss here. Basically, I want to create something like a list of <code>&lt;li&gt;&lt;/li&gt;</code> elements, where I assign properties to each item.</p>\n\n<p>E.g</p>\n\n<p>I'm provided a record with:</p>\n\n<pre><code>[ { id: \"id1\", name: \"name1\", class: \"class1\", content: \"content1\" }\n, { id: \"id2\", name: \"name2\", class: \"class2\", content: \"content2\" } ]\n</code></pre>\n\n<p>And I would like a function <code>foo</code> that returns an array:</p>\n\n<pre><code>[ li [ id_ rec.id, name_ rec.name, class_ rec.class ] [ text rec.content ]\n, li [ id_ rec.id, name_ rec.name, class_ rec.lass ] [ text rec.content ] ]\n</code></pre>\n\n<p>where <code>rec</code> is the name of the recordObject (and obviously the two arrays are not identical, but actually mapped over the initial record).</p>\n\n<p>(the dot syntax is a purescript record syntax notation similar to standard getter/setter notation)</p>\n"}, {"tags": ["haskell", "conduit", "postgresql-simple"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1484555193, "post_id": 41643485, "comment_id": 70541792, "body": "In persistent-postgresql, we dropped down to <a href=\"https://www.stackage.org/package/postgresql-libpq\" rel=\"nofollow noreferrer\">postgresql-libpq</a> to implement this behavior. I&#39;m not sure that postgresql-simple can do this (besides with the <code>TMChan</code> approach @Alec mentioned)."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1484627915, "post_id": 41643485, "comment_id": 70575000, "body": "There is a <code>pipes-postgresql-simple</code> with a function, <a href=\"https://hackage.haskell.org/package/pipes-postgresql-simple-0.1.2.0/docs/Pipes-PostgreSQL-Simple.html#v:query\" rel=\"nofollow noreferrer\"><code>query</code></a> for this; it is basically using the strategy @Alec mentions (implemented with <code>pipes-concurrency</code> though) as you can see in the implementation of <a href=\"https://github.com/ocharles/pipes-postgresql-simple/blob/master/src/Pipes/PostgreSQL/Simple.hs#L117\" rel=\"nofollow noreferrer\"><code>produceIO</code></a>"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1484345783, "last_edit_date": 1484345783, "creation_date": 1484345421, "answer_id": 41644226, "question_id": 41643485, "link": "https://stackoverflow.com/questions/41643485/creating-a-streaming-conduit-source-with-postgresql-simple/41644226#41644226", "title": "Creating a streaming Conduit Source with postgresql-simple", "body": "<p>One (not so nice) way to go about this it to</p>\n\n<ul>\n<li>make a new <a href=\"https://hackage.haskell.org/package/stm-chans-3.0.0.4/docs/Control-Concurrent-STM-TMChan.html#t:TMChan\" rel=\"noreferrer\"><code>TMChan</code></a> to receive rows</li>\n<li>set <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.2.1/docs/Database-PostgreSQL-Simple.html#v:forEach_\" rel=\"noreferrer\"><code>foreach_</code></a> to just dump rows into this channel</li>\n<li>finally use <a href=\"https://hackage.haskell.org/package/stm-conduit-3.0.0/docs/Data-Conduit-TMChan.html\" rel=\"noreferrer\"><code>stm-conduit</code></a> to make a source out of the channel</li>\n</ul>\n\n<p>I don't have the means to test this off-hand, but the following should work</p>\n\n<pre><code>import Conduit\nimport Database.PostgreSQL.Simple (foreach_)\nimport Data.Conduit.TMChan (sourceTMChan)\nimport Control.Concurrent.STM.TMChan (newTMChanIO, writeTMChan, atomically)\n\nmySource :: (FromRow row, MonadIO m) =&gt; Connection -&gt; Query -&gt; IO (Source m row)\nmySource connection query = do\n  chan &lt;- newTMChanIO\n  forEach_ connection query (atomically . writeTMChan chan)\n  pure (sourceTMChan chan)\n</code></pre>\n\n<p>If only we had <code>forEach_ :: (MonadIO m, FromRow r) =&gt; Connection -&gt; Query -&gt; (r -&gt; m ()) -&gt; m ()</code> this might be easier...</p>\n"}, {"tags": [], "owner": {"reputation": 2094, "user_id": 1553178, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/7389892951607424b63e62dece94ac88?s=128&d=identicon&r=PG&f=1", "display_name": "TG-T", "link": "https://stackoverflow.com/users/1553178/tg-t"}, "is_accepted": false, "score": 0, "last_activity_date": 1496542366, "creation_date": 1496542366, "answer_id": 44350174, "question_id": 41643485, "link": "https://stackoverflow.com/questions/41643485/creating-a-streaming-conduit-source-with-postgresql-simple/44350174#44350174", "title": "Creating a streaming Conduit Source with postgresql-simple", "body": "<p>Here's a modification of Alec's above that compiles and runs. <code>mkPgSource</code> is the general function that Alec referred to at the end of his post.</p>\n\n<pre><code>import Database.PostgreSQL.Simple\nimport Database.PostgreSQL.Simple.FromRow\nimport Database.PostgreSQL.Simple.ToRow\nimport Control.Monad.IO.Class (MonadIO)\nimport Data.Conduit.TMChan (sourceTMChan)\nimport Control.Concurrent.STM.TMChan (newTMChanIO, writeTMChan, \ncloseTMChan, TMChan)\nimport GHC.Conc (atomically, forkIO)\nimport Conduit\n\n--closes the channel after action is done to terminate the source\nmkPgSource :: (MonadIO m, FromRow r) =&gt; ((r -&gt; IO ()) -&gt; IO ()) -&gt; IO (Source m r)\nmkPgSource action = do\n  chan &lt;- newTMChanIO\n  _ &lt;- forkIO $ do action $ atomically . (writeTMChan chan)\n               atomically $ closeTMChan chan\n  pure $ sourceTMChan chan\n\nsourceQuery :: (ToRow params, FromRow r, MonadIO m) =&gt;\n     Connection -&gt; Query -&gt; params -&gt; IO (Source m r)\nsourceQuery conn q params = mkPgSource $ forEach conn q params\n\nsourceQuery_ :: (FromRow r, MonadIO m) =&gt; Connection -&gt; Query -&gt; IO \n(Source m r)\nsourceQuery_ conn q = mkPgSource $ forEach_ conn q\n</code></pre>\n"}], "owner": {"reputation": 517, "user_id": 400405, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c5526c6d8fbdd01a7dd23b384b972ded?s=128&d=identicon&r=PG", "display_name": "icz", "link": "https://stackoverflow.com/users/400405/icz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 1, "accepted_answer_id": 41644226, "answer_count": 2, "score": 4, "last_activity_date": 1496542366, "creation_date": 1484341839, "last_edit_date": 1484345363, "question_id": 41643485, "link": "https://stackoverflow.com/questions/41643485/creating-a-streaming-conduit-source-with-postgresql-simple", "title": "Creating a streaming Conduit Source with postgresql-simple", "body": "<p><code>postgresql-simple</code> provides functions for streaming queries, e.g.</p>\n\n<pre><code>fold \n  :: (FromRow row, ToRow params)\n  =&gt; Connection -&gt; Query -&gt; params -&gt; a -&gt; (a -&gt; row -&gt; IO a) -&gt; IO a\n</code></pre>\n\n<p>I want to create a conduit source which takes full advantage of streaming.</p>\n\n<pre><code>mySource :: (FromRow row, Monad m) =&gt; Source m row\n</code></pre>\n\n<p>Unfortunately, because <code>IO</code> appears in a contravariant position (I think?) in <code>fold</code>, I'm really struggling with the types. The following type-checks, but folds the entire stream before yielding values.</p>\n\n<pre><code>getConduit :: Connection -&gt; IO (C.ConduitM () Event IO ())\ngetConduit conn = fold_ conn queryEventRecord CL.sourceNull foo\n  where\n    foo :: C.ConduitM () Event IO () -&gt; Event -&gt; IO (C.ConduitM () Event IO ())\n    foo cond evt = pure (cond &gt;&gt; C.yield evt)\n</code></pre>\n\n<p>Any pointers on how to implement this would be greatly appreciated! Thanks!</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484341433, "post_id": 41643333, "comment_id": 70486655, "body": "GHC requires that the module that requires the main <code>main :: IO ()</code> is named <code>Main</code>. Modules must generally have a filepath that corresponds to the module name. You&#39;ll have to rename <code>LogAnalysis.hs</code> to <code>Main.hs</code> again."}, {"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484341583, "post_id": 41643333, "comment_id": 70486718, "body": "Isn&#39;t <code>main-is</code> supposed to override this?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484341772, "post_id": 41643333, "comment_id": 70486785, "body": "I think <code>main-is</code> serves only to point at the right <code>Main</code> module when there are several."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1484343765, "post_id": 41643333, "comment_id": 70487601, "body": "The project worked for me when I did your created/renamed/adjusted....  Then <code>stack exec xyz-exe</code> works for me, printing &quot;somefunc&quot;.  What command are you running when you get the error?"}, {"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1484344234, "post_id": 41643333, "comment_id": 70487788, "body": "stack build - look at accepted answer. I mistaken meaning of <code>main-is</code>, and thought it will make ghc look into different <b>module</b>, while in truth it only tells ghc to look for module <code>Main</code> inside different file then <code>Main.hs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 534, "user_id": 382462, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/728ff954f60f1b890707d51141469595?s=128&d=identicon&r=PG", "display_name": "jp.rider63", "link": "https://stackoverflow.com/users/382462/jp-rider63"}, "edited": false, "score": 1, "creation_date": 1580225438, "post_id": 41643711, "comment_id": 106023539, "body": "You <a href=\"https://stackoverflow.com/a/46895256\">don&#39;t need to rename the module</a>. You just need to tell GHC the name of your main module. You can do this in your cabal file with:   <code>ghc-options: -main-is LogAnalysis</code>"}], "tags": [], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "is_accepted": true, "score": 3, "last_activity_date": 1484343460, "last_edit_date": 1484343460, "creation_date": 1484342859, "answer_id": 41643711, "question_id": 41643333, "link": "https://stackoverflow.com/questions/41643333/haskell-stack-cabal-ignore-main-is-option-and-fail-to-build-app/41643711#41643711", "title": "Haskell Stack + Cabal ignore &#39;main-is&#39; option and fail to build app", "body": "<p>Is it possible you changed <code>module Main where</code> to <code>module LogAnalysis where</code>?  If you did, you would get exactly this error.</p>\n\n<p><code>Main-is</code> just says check for the <code>Main</code> module inside this file, but it must still be the <code>Main</code> module, not the <code>LogAnalysis</code> module.  This makes it clear that the main function in this file should be run, rather than some main functions that might happen to exist in some other modules.</p>\n"}], "owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "closed_date": 1484346311, "accepted_answer_id": 41643711, "answer_count": 1, "score": 1, "last_activity_date": 1484343460, "creation_date": 1484341123, "last_edit_date": 1484342735, "question_id": 41643333, "link": "https://stackoverflow.com/questions/41643333/haskell-stack-cabal-ignore-main-is-option-and-fail-to-build-app", "closed_reason": "Duplicate", "title": "Haskell Stack + Cabal ignore &#39;main-is&#39; option and fail to build app", "body": "<p><strong>Q: How to adjust cabal(stack?) settings so that <code>app/LogAnalysis.hs</code> is treated as main log after all?</strong></p>\n\n<p>Here is how I got myself this error:</p>\n\n<ul>\n<li>Created new project with <code>stack new xyz</code></li>\n<li>Renamed <code>app/Main.hs</code> to <code>app/LogAnalysis.hs</code></li>\n<li>Adjusted <code>main-is</code> option in <code>xyz.cabal</code> file</li>\n</ul>\n\n<p>Problem is I either entered that data somehow incorrectly or cabal ignores that new value. Here is error I get:</p>\n\n<pre><code>Preprocessing executable 'WeekTwo-exe' for WeekTwo-0.1.0.0...\n\n&lt;no location info&gt;: error:\n    output was redirected with -o, but no output will be generated\nbecause there is no Main module.\n</code></pre>\n\n<p>Here is relevant entry in <code>xyz.cabal</code></p>\n\n<pre><code>executable WeekTwo-exe\n    hs-source-dirs:      app\n    main-is:             LogAnalysis.hs\n    ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n    build-depends:       base\n                       , WeekTwo\n    default-language:    Haskell2010\n</code></pre>\n\n<p>And module in question is:</p>\n\n<pre><code>module LogAnalysis where\nimport Log\n\nmain :: IO ()\nmain = print (parseMessage \"I 29 la la\")\n</code></pre>\n\n<p><em>Versions:\nStack - Version 1.3.2\nGHC - 7.15\nCabal - 1.24.0.0</em></p>\n\n<p>PS if it's of any interest I'm doin 2nd week of Haskel course CIS 194.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1484341330, "post_id": 41642349, "comment_id": 70486624, "body": "There should be a select (or poll) loop somewhere in the ghc runtime system. In general, ghc tries to use non-blocking I/O everywhere."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1484348501, "post_id": 41642349, "comment_id": 70489334, "body": "I&#39;d <i>guess</i> that this is used as a &#39;yield&#39; point for GHCs green thread scheduler to (possibly) give control to another thread? Don&#39;t really know either though."}], "answers": [{"comments": [{"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1484349409, "post_id": 41644911, "comment_id": 70489631, "body": "Wouldn&#39;t it better fit that model if <code>network</code> relied on <code>epoll</code> instead of <code>select</code>?"}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 3, "creation_date": 1484349853, "post_id": 41644911, "comment_id": 70489762, "body": "It might be that it acutally uses <code>epoll</code> on linux, I belive that is the case.  @sapanoia see <a href=\"http://stackoverflow.com/a/39106000/2494803\">stackoverflow.com/a/39106000/2494803</a>"}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 9, "last_activity_date": 1484349920, "last_edit_date": 1484349920, "creation_date": 1484349250, "answer_id": 41644911, "question_id": 41642349, "link": "https://stackoverflow.com/questions/41642349/why-does-haskells-network-library-use-non-blocking-sockets/41644911#41644911", "title": "Why does haskell&#39;s network library use non-blocking sockets?", "body": "<p>The non-blocking IO event loop is part of GHC's runtime system (RTS). This interacts very nicely with GHC's green thread system: instead of writing asynchronous code, you can just use lightweight threads and the runtime will take care of waking up the correct one. </p>\n\n<p>All IO in in Haskell is non-blocking by default, so if you've got two threads that are each blocked on a different socket, then the runtime system will internally do <code>select</code> (or some other platform-specific way to wait on multiple file descriptors like <code>epoll</code> or <code>kqueue</code>) to only wake the thread up when the file descriptor becomes ready. See <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/IOManager\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/IOManager</a> for more details. </p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 0, "accepted_answer_id": 41644911, "answer_count": 1, "score": 8, "last_activity_date": 1484349920, "creation_date": 1484336721, "last_edit_date": 1484337216, "question_id": 41642349, "link": "https://stackoverflow.com/questions/41642349/why-does-haskells-network-library-use-non-blocking-sockets", "title": "Why does haskell&#39;s network library use non-blocking sockets?", "body": "<p>I'm trying to better understand a design decision made in the <a href=\"http://hackage.haskell.org/package/network\" rel=\"noreferrer\">network</a> library. Reputable sources mention in <a href=\"https://github.com/haskell/network/issues/151#issuecomment-65463634\" rel=\"noreferrer\">a github issue</a> and a <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2010-August/082727.html\" rel=\"noreferrer\">mailing list response</a> that <code>network</code> uses non-blocking sockets. Instead of using the default blocking behavior, they use <a href=\"http://man7.org/linux/man-pages/man2/select.2.html\" rel=\"noreferrer\">select</a> to block until the socket is ready to be read. Why is this better? Either way, it ends up blocking, and <code>network</code> only exposes a blocking API to end users. My guess is that it's bad for an FFI call to block and that there is some kind of GHC magic around <code>select</code>, but I haven't been able to confirm that.</p>\n\n<p>As a minor aside, I cannot find where <code>select</code> in called in <code>network</code>. Grepping the codebase did not turn up anything. I just discovered <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Event.html\" rel=\"noreferrer\">GHC.Event</a>, which seems to provide functions that would be used instead of calling <code>select</code> directly, but grepping shows <code>network</code> doesn't use this either.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1484328777, "post_id": 41640151, "comment_id": 70480391, "body": "The problem with checking first is that between the check and the actual rename some other process may have created the target file. This is a classic race condition. I don&#39;t think it&#39;s fixable."}, {"owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1484328928, "post_id": 41640151, "comment_id": 70480478, "body": "How are other programs dealing with this? <code>jhead</code> renames image files and adds letters to a file name to prevent overwriting existing files. Or do you think that they have the same problem and just consider it unlikely that a new file is created or another one is rename in the time between check and renaming?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1484329125, "post_id": 41640151, "comment_id": 70480583, "body": "Oh, I&#39;m dumb. It can be done safely by using <code>link</code>/<code>unlink</code> instead of <code>rename</code>. <code>link(oldname, newname)</code> will fail if <code>newname</code> already exists. In Haskell, these would be <a href=\"http://hackage.haskell.org/package/unix-2.7.2.1/docs/System-Posix-Files.html#g:8\" rel=\"nofollow noreferrer\"><code>createLink</code> and <code>removeLink</code></a>, respectively."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1484330209, "post_id": 41640151, "comment_id": 70481181, "body": "@melpomene: That assumes that you&#39;re linking/unlinking a file in the same directory -- if you want to be more precise, linking and unlinking on the same file system. This is generally the case, but you have to be careful if you cross directory boundaries because directories are mount points, and you could inadvertently cross file systems. That would cause link and unlink to fail."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1484330266, "post_id": 41640151, "comment_id": 70481217, "body": "@scootermefecit <code>renameFile</code> has the same limitation."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1484331410, "post_id": 41640151, "comment_id": 70481863, "body": "@melpomene: Just a cautionary note about using link/unlink, nothing more. Doesn&#39;t really solve the problem of the OP, tho."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1484331526, "post_id": 41640151, "comment_id": 70481926, "body": "@melpomene I guess the generic non-POSIX <code>renameFile</code> can not assume to have a safe way to do that provided by the OS. :-/"}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1484332193, "post_id": 41640151, "comment_id": 70482269, "body": "@Dominik: I think you need to restate your question with more clarity of purpose: When you attempt to rename a file, are you trying to generate alternate file names in the event the original target file name exists? Or just ensure that the target doesn&#39;t exist before you rename?"}, {"owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1484332312, "post_id": 41640151, "comment_id": 70482320, "body": "I want to rename photos, videos, live photos by creation data from either EXIF (similar to <code>jhead</code>) or the file system timestamp normalized to the timezone the photo was taken in. It might be that two photos were taken at exactly the same time and would end up with the same name: <code>2017-01-12 \u2013 11-12-11.jpg</code>. This must not happen. The second photo should be called something like <code>2017-01-12 \u2013 11-12-11a.jpg</code>. Does that make it clearer? Which other information do you need? If this helps I&#39;ll add it to the question."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1484332326, "post_id": 41640151, "comment_id": 70482327, "body": "@melpomene: It&#39;s perhaps a defect in base&#39;s file creation functions: you can eliminate the operating system&#39;s potential file creation race condition if you could specify O_EXCL when creating it. Might be an enhancement to propose, e.g., createFileExclusively (or some such.)"}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1484332453, "post_id": 41640151, "comment_id": 70482386, "body": "@Dominik: Ok, you just want to ensure the target file doesn&#39;t exist before you rename. IIRC, you have to see if the file exists before you rename."}, {"owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1484332641, "post_id": 41640151, "comment_id": 70482461, "body": "Yes. I want to make sure that I&#39;m not overwriting an existing picture. This <i>must</i> not happen."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1484433732, "post_id": 41640151, "comment_id": 70510252, "body": "@melpomene: The <code>stdio</code> library actually uses <code>link</code> and <code>unlink</code> as the implementation for <code>rename</code>, hence, the same limitation issue."}], "answers": [{"comments": [{"owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1484380935, "post_id": 41645324, "comment_id": 70495087, "body": "So if I would want to add something to the file name I&#39;d remove the Boolean return value and either recursively call the function or check different paths <code>2017-01-11 - 11-21-21a.jpg</code>, <code>2017-01-11 - 11-21-21b.jpg</code>, \u2026 and rename then. Korrekt? Or would you do that from another function?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1484385206, "post_id": 41645324, "comment_id": 70495923, "body": "@Dominik Both approaches seem OK to me. You can also write a <code>genFreshName :: String -&gt; IO String</code> which returns an unused filename, possibly adding a trailer, and after using the regular rename. (The same race is still here, obviously)"}, {"owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1484385395, "post_id": 41645324, "comment_id": 70495956, "body": "If I iterate over a list of paths in Haskell there will be no race condition inside my script, right? So Haskell will not try to parallelize the work and rename in different processes. The only race condition here is from the outside world. Some other program might work on the files at the same time."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 1, "creation_date": 1484431706, "post_id": 41645324, "comment_id": 70509682, "body": "@Dominik: The complete solution is a combination of <code>renameSafely</code> and <code>genFreshName</code>.  You are correct about the O/S race condition: it will only manifest itself if there are competing (external) processes trying to create the same file."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1484431918, "post_id": 41645324, "comment_id": 70509749, "body": "@Dominik: There&#39;s another way to do it, although I don&#39;t have time this afternoon to code it up and test: You could use <code>takeWhileM</code> as a way to filter out existing file names (i.e., the predicate returns <code>False</code> if the file exists, <code>True</code> if it doesn&#39;t exist) -- <code>takeWhileM</code> drops all of the generated names in a list, the head of the returned list is the first name of a legitimate (non-existent) file. Then you use that name to rename the source file."}], "tags": [], "owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "is_accepted": false, "score": 2, "last_activity_date": 1484353489, "last_edit_date": 1484353489, "creation_date": 1484352532, "answer_id": 41645324, "question_id": 41640151, "link": "https://stackoverflow.com/questions/41640151/how-can-i-ensure-the-destination-file-does-not-exist-when-renaming-a-file-with-h/41645324#41645324", "title": "How can I ensure the destination file does not exist when renaming a file with Haskell, to avoid overwriting it?", "body": "<p>Here is one potential solution:</p>\n\n<pre><code>import System.Directory (doesFileExist, renameFile)\n\n-- | Rename a src file as tgt file, safely. If the tgt file exists, don't\n-- rename and return False. Otherwise, rename src to tgt and return True.\nrenameSafely :: FilePath -&gt; FilePath -&gt; IO Bool\nrenameSafely src tgt = do\n  exists &lt;- doesFileExist tgt\n  if not exists\n  then (renameFile src tgt &gt;&gt; return True)\n  else return False\n</code></pre>\n\n<p>(Disclaimer: I didn't run this through GHC to ensure that it compiles; the \">>\" in the <code>then</code> clause might be an issue.)</p>\n\n<p>As noted in the comments, there is a potential race condition in the file system with two processes trying to create or rename a file with the same name at the same time. However, as you pointed out, that is unlikely to be an issue for you.</p>\n\n<p>If <code>renameSafely</code> returns <code>IO False</code>, then simply try another name. :-)</p>\n"}, {"tags": [], "owner": {"reputation": 1616, "user_id": 215485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541f0288a353e77239c21fa58ba81be3?s=128&d=identicon&r=PG", "display_name": "Dave Turner", "link": "https://stackoverflow.com/users/215485/dave-turner"}, "is_accepted": false, "score": 3, "last_activity_date": 1527654756, "creation_date": 1527654756, "answer_id": 50596445, "question_id": 41640151, "link": "https://stackoverflow.com/questions/41640151/how-can-i-ensure-the-destination-file-does-not-exist-when-renaming-a-file-with-h/50596445#50596445", "title": "How can I ensure the destination file does not exist when renaming a file with Haskell, to avoid overwriting it?", "body": "<p>POSIX has the ability to <em>create a new file</em>: atomically check a file exists and only create it if it does not, via the <code>O_EXCL</code> flag to <a href=\"http://man7.org/linux/man-pages/man2/open.2.html\" rel=\"nofollow noreferrer\"><code>open()</code></a>. This lets you avoid the race condition in the more obvious implementation in which two processes may check that a file doesn't exist before either of them creates it, causing one process to overwrite the other's file. This can help here: the idea is to exclusively create an empty file at the target, and then overwrite it with a rename only if the exclusive creation succeeded. If the exclusive creation failed then another process already created the file. This is exposed in Haskell's <a href=\"https://hackage.haskell.org/package/unix-2.7.2.2/\" rel=\"nofollow noreferrer\"><code>unix</code> package</a>, via the <a href=\"https://hackage.haskell.org/package/unix-2.7.2.2/docs/System-Posix-IO.html#v:openFd\" rel=\"nofollow noreferrer\"><code>openFd</code> function</a>, which either succeeds or else throws an <code>IOException</code>. It can be used like this:</p>\n\n<pre><code>module RenameNoOverwrite where\n\nimport           Control.Exception\nimport           Control.Monad\nimport           Data.Bits\nimport           System.Directory\nimport           System.Posix.Files\nimport           System.Posix.IO\n\nrenameFileNoOverwrite :: FilePath -&gt; FilePath -&gt; IO Bool\nrenameFileNoOverwrite old new = do\n  created &lt;- handle handleIOException $ bracket createNewFile closeFd $ pure $ pure True\n  when created $ renameFile old new\n  return created\n\n  where\n  createNewFile = openFd new WriteOnly (Just defaultMode) defaultFileFlags {exclusive = True}\n  defaultMode = ownerReadMode  .|. ownerWriteMode .|. groupReadMode  .|. otherReadMode\n\n  handleIOException :: IOException -&gt; IO Bool\n  handleIOException _ = return False\n</code></pre>\n\n<p>The key part is the <code>{exclusive = True}</code> option, which sets the <code>O_EXCL</code> flag on the resulting call to <code>open()</code>.</p>\n\n<p>Windows has a similar ability, exposed via the <code>CREATE_NEW</code> flag to <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa363858(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>CreateFile</code></a>. There's also a <code>MOVEFILE_REPLACE_EXISTING</code> flag to <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa365240(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>MoveFileEx</code></a> that looks like it might be useful, but I've never used it and the documentation is not 100% clear to me. These are exposed in Haskell's <a href=\"https://hackage.haskell.org/package/Win32-2.8.0.0\" rel=\"nofollow noreferrer\"><code>Win32</code> package</a>.</p>\n\n<p>Unfortunately there doesn't currently seem to be a portable way of doing this.</p>\n"}], "owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1602690967, "creation_date": 1484328267, "last_edit_date": 1602690967, "question_id": 41640151, "link": "https://stackoverflow.com/questions/41640151/how-can-i-ensure-the-destination-file-does-not-exist-when-renaming-a-file-with-h", "title": "How can I ensure the destination file does not exist when renaming a file with Haskell, to avoid overwriting it?", "body": "<p>I want to rename a file in Haskell without overwriting an already existing one. In case the target file exists I want to deal with that in my code (by appending something to the file name).</p>\n\n<p>The description of <a href=\"https://hackage.haskell.org/package/directory-1.3.0.0/docs/System-Directory.html\" rel=\"nofollow noreferrer\"><code>renameFile</code></a> from <code>System.Directory</code> says:</p>\n\n<blockquote>\n  <p><code>renameFile old new</code> changes the name of an existing file system object from <code>old</code> to <code>new</code>. If the <code>new</code> object already exists, it is atomically replaced by the <code>old</code> object. Neither path may refer to an existing directory.</p>\n</blockquote>\n\n<p>Is there any existing module or command that would let me rename without overwriting?</p>\n\n<p>I know I can do the checks myself. I'd just feel <em>much</em> better if there was a function written by someone experienced. Overwritten files are gone for good.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I want to rename photos, videos, live photos by creation data from either EXIF (similar to <code>jhead</code>) or the file system timestamp normalized to the timezone the photo was taken in. It might be that two photos were taken at exactly the same time and would end up with the same name: <code>2017-01-12 \u2013 11-12-11.jpg</code>. This <em>must</em> not happen. The second photo should be called something like <code>2017-01-12 \u2013 11-12-11a.jpg</code>.</p>\n"}, {"tags": ["performance", "haskell", "recursion", "clojure"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1484326011, "post_id": 41639411, "comment_id": 70478776, "body": "<code>length h &lt; 2</code> will traverse the whole list. I&#39;d use pattern matching instead for <code>[]</code> and <code>[_]</code>, even if this require a minor duplication. (In the last case, I&#39;d use <code>(x1:x2:xs)</code> and avoid the partial <code>!!</code> -- this does not improve speed but it is way more idiomatic)"}, {"owner": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484326216, "post_id": 41639411, "comment_id": 70478907, "body": "Thanks! I&#39;d definitely appreciate an example implementation of findMindDiff that illustrates this @chi."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1484326377, "post_id": 41639625, "comment_id": 70479013, "body": "Note that <code>if...then...else</code> is just an expression, so you can factor out the functional call and first argument: <code>findMinDiff hs (if h1 - h0 &lt; m then h1 - h0 else m)</code>. You can also replace the expression with call to <code>min</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1484326552, "post_id": 41639625, "comment_id": 70479115, "body": "@chepner Yes, but the goal in this answer is for the code to be as similar as possible to the OPs to demonstrate the difference between guarding on length and pattern matching. If I could have written the <code>if ... then ... else</code> with guards without it being hideous I would have."}, {"owner": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "edited": false, "score": 0, "creation_date": 1484326565, "post_id": 41639625, "comment_id": 70479122, "body": "I&#39;m sure the code works, but this syntax <code>(h0 : hs@(h1 : _))</code> terrifies/confuses me. From the link, it looks like there may be ways to do it in a more verbose but easier to follow way? Or just help me out with that syntax - what&#39;s the @ doing? Feel free to assume I&#39;m a moron."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "edited": false, "score": 3, "creation_date": 1484326804, "post_id": 41639625, "comment_id": 70479262, "body": "@Orphid the more verbose way would pattern match on <code>(h0 : h1 : hs&#39;)</code> and then reconstruct the list <code>h1 : hs&#39;</code> for the calls to the tail. Since <code>h1 : hs&#39;</code> is already in the pattern I&#39;m capturing it with a new name using <code>hs@(h1 : hs&#39;)</code>, then since <code>hs&#39;</code> isn&#39;t used anywhere replacing it with a <code>_</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "edited": false, "score": 1, "creation_date": 1484329806, "post_id": 41639625, "comment_id": 70480931, "body": "@Orphid You can read the pattern <code>h0 : hs@(h1 : _)</code> as &quot;if the input list has the form <code>h0 : hs</code> (so it&#39;s nonempty) where the tail <code>hs</code> has the form <code>h1 : _</code> (again, nonempty), then proceed as follows: ...&quot;. You can then use <code>h0,h1,hs</code> in what follows with their natural meaning."}, {"owner": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484330133, "post_id": 41639625, "comment_id": 70481138, "body": "@chi Ciridec also added the line <code>findMinDiff _ m = m</code> after the function. How does that affect things?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "edited": false, "score": 2, "creation_date": 1484330205, "post_id": 41639625, "comment_id": 70481178, "body": "@Orphid Yes: that line is only reached when the first pattern fails, i.e. when <code>length h &lt; 2</code>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1484326268, "creation_date": 1484326268, "answer_id": 41639625, "question_id": 41639411, "link": "https://stackoverflow.com/questions/41639411/performance-of-iterating-a-list-by-recursively-examining-the-tail/41639625#41639625", "title": "Performance of iterating a list by recursively examining the tail", "body": "<p>You're calculating the <code>length</code> of the list in every recursion into <code>findMinDiff</code>. Since <a href=\"http://hackage.haskell.org/package/base-4.7.0.0/docs/Prelude.html#v:length\" rel=\"noreferrer\"><code>length</code></a> takes <code>O(n)</code> time <code>findMinDiff</code> takes <code>O(n^2)</code> time instead of <code>O(n)</code>.</p>\n\n<p>You can write the same thing with <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"noreferrer\">pattern matching</a> instead of <code>length</code>, <code>!!</code>, and <code>tail</code></p>\n\n<pre><code>findMinDiff :: [Int] -&gt; Int -&gt; Int\nfindMinDiff (h0 : hs@(h1 : _)) m = \n    if h1 - h0 &lt; m\n    then findMinDiff hs (h1 - h0)\n    else findMinDiff hs m\nfindMinDiff _ m = m\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "edited": false, "score": 0, "creation_date": 1484330600, "post_id": 41640735, "comment_id": 70481426, "body": "Yes - in fact, after I completed the challenge I was able to view the solutions of others. exlevan&#39;s seems to be the top rated, and uses <code>minimum</code> and <code>zipWith</code> too."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "edited": false, "score": 3, "creation_date": 1484330796, "post_id": 41640735, "comment_id": 70481533, "body": "@Orphid Knowing library functions surely can help, but as an exercise it is more important to learn to solve this without too much library help. If possible, I&#39;d suggest to avoid <code>length, head, tail, !!</code> (and perhaps guards as well) since in many beginner&#39;s exercises they are unneeded and only lead to fragile code. It is much better, in Haskell, to prefer pattern matching to anything else."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1484330388, "creation_date": 1484330388, "answer_id": 41640735, "question_id": 41639411, "link": "https://stackoverflow.com/questions/41639411/performance-of-iterating-a-list-by-recursively-examining-the-tail/41640735#41640735", "title": "Performance of iterating a list by recursively examining the tail", "body": "<p>By the way, a completely alternative implementation could be written as follows. (Pseudocode follows)</p>\n\n<p>Take the list</p>\n\n<pre><code>h = [h0, h1, h2 ...\n</code></pre>\n\n<p>Remove one element</p>\n\n<pre><code>drop 1 h = [h1, h2, h3 ...\n</code></pre>\n\n<p>Compute pointwise differences</p>\n\n<pre><code>zipWith (-) (drop 1 h) h = [h1-h0, h2-h1, h3-h2, ...\n</code></pre>\n\n<p>Then take the minimum. Full code:</p>\n\n<pre><code>minDiff :: [Int] -&gt; Int\nminDiff h = minimum (zipWith (-) (drop 1 h) h)\n</code></pre>\n\n<p>Note that this will crash on the empty list. On the other hand, there's no need of the <code>9999999</code> hack. Thanks to laziness, it runs in constant space, too.</p>\n\n<p>For a better error handling:</p>\n\n<pre><code>minDiff :: [Int] -&gt; Int\nminDiff [] = error \"minDiff: empty list\"\nminDiff h = minimum (zipWith (-) (drop 1 h) h)\n</code></pre>\n\n<p>or even, more pedantically (but respecting totality):</p>\n\n<pre><code>minDiff :: [Int] -&gt; Maybe Int\nminDiff [] = Nothing\nminDiff h  = Just (minimum (zipWith (-) (drop 1 h) h))\n</code></pre>\n"}], "owner": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 41639625, "answer_count": 2, "score": 2, "last_activity_date": 1484330388, "creation_date": 1484325573, "question_id": 41639411, "link": "https://stackoverflow.com/questions/41639411/performance-of-iterating-a-list-by-recursively-examining-the-tail", "title": "Performance of iterating a list by recursively examining the tail", "body": "<p>I decided to try to learn Haskell by doing some of the <a href=\"https://www.codingame.com\" rel=\"nofollow noreferrer\">CodinGame</a> challenges (so this question is super beginner-level stuff I'm sure). One of them requires searching through a list of integers for the smallest difference between any two values. I've previously solved it in Clojure by doing this:</p>\n\n<pre><code>(ns Solution\n  (:gen-class))\n\n(defn smallest-difference [values]\n  (let [v (sort values)]\n    (loop [[h &amp; t] v curr-min 999999]\n      (if (nil? t) curr-min\n        (let [dif (- (first t) h)]\n          (recur t (if (&gt; curr-min dif) dif curr-min)))))))\n\n(defn -main [&amp; args]\n  (let [horse-strengths (repeatedly (read) #(read))]\n      (let [answer (smallest-difference horse-strengths)]\n        (println answer)))) \n</code></pre>\n\n<p>I tried to implement the same solution in Haskell, with the following:</p>\n\n<pre><code>readHorses :: Int -&gt; [Int] -&gt; IO [Int]\nreadHorses n h\n    | n &lt; 1 = return h\n    | otherwise = do\n        l &lt;- getLine\n        let hn = read l :: Int\n        readHorses (n - 1) (hn:h)\n\nfindMinDiff :: [Int] -&gt; Int -&gt; Int\nfindMinDiff h m\n    | (length h) &lt; 2    = m\n    | (h!!1 - h!!0) &lt; m = findMinDiff (tail h) (h!!1 - h!!0)\n    | otherwise         = findMinDiff (tail h) m\n\n\n\nmain :: IO ()\nmain = do\n    hSetBuffering stdout NoBuffering -- DO NOT REMOVE\n    input_line &lt;- getLine\n    let n = read input_line :: Int\n    hPrint stderr n\n    horses &lt;- readHorses n []\n    hPrint stderr \"Read all horses\"\n    print (findMinDiff (sort horses) 999999999)\n    return ()\n</code></pre>\n\n<p>This times-out for large inputs (99999 values) where the Clojure solution does not. They look pretty similar to me however. </p>\n\n<p>It at least superficially seems that reading the values and constructing the list isn't the problem, as \"Read all horses\" is printed before the timeout. </p>\n\n<p>How can I make the Haskell version more performant? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484316526, "post_id": 41636387, "comment_id": 70472500, "body": "When you say <code>f = id</code>, you&#39;re literally just making <code>f</code> an alias for <code>id</code>. The error comes from the fact though that you can&#39;t omit arguments from one form of a function definition, if the other forms have all their arguments explicitly. Annoying, but not a big deal. Just explicitly pass <code>x</code> to <code>id</code>. Of course, that defeats the purpose though, so just use your first way."}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484316855, "post_id": 41636387, "comment_id": 70472731, "body": "Thank you, that is interesting. I&#39;ve never come across such an example even tough I have been playing around with Haskell for a while now. Do you know any tutorial/book/reference where this is mentioned?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484317000, "post_id": 41636387, "comment_id": 70472835, "body": "No, I think this is just one of those quirks that everyone runs into eventually. This is rarely an issue though, since most of the time you write function definitions that omit arguments, they&#39;re in point-free form, and they only have the one definition since they&#39;re just a short-hand for another partially applied function."}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1484317090, "post_id": 41636387, "comment_id": 70472898, "body": "Haha, well thank you very much for your explanation!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1484318939, "post_id": 41636387, "comment_id": 70474090, "body": "For some reason the Haskell definition requires all the equations to have exactly the same number of arguments. Probably, the committee decided that a missing argument was much more likely to be a programmer error than an intended eta-contraction, and ruled that out from the Haskell syntax. But yes, it would make total sense."}], "answers": [{"comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1484316955, "post_id": 41636551, "comment_id": 70472800, "body": "Thank you! So if we just consider <code>g x = x</code> alone, then it is completely equivalent to <code>g = id</code>?"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 1, "creation_date": 1484316996, "post_id": 41636551, "comment_id": 70472832, "body": "@flawr Correct."}], "tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": false, "score": 2, "last_activity_date": 1484577741, "last_edit_date": 1484577741, "creation_date": 1484316855, "answer_id": 41636551, "question_id": 41636387, "link": "https://stackoverflow.com/questions/41636387/is-f-x-x-not-equivalent-to-f-id/41636551#41636551", "title": "Is `f x = x` not equivalent to `f = id`?", "body": "<p>You get an error for mismatching the parameters between the different equations of the function. So</p>\n\n<pre><code>valid (Just x) = ...\nvalid _ = ...\n\nvalid2 = ...\nvalid2 = ...\n</code></pre>\n\n<p>And this will fail:</p>\n\n<pre><code>invalid x = ...\ninvalid = ...\n</code></pre>\n\n<p>If you really want to use <code>id</code>, you still can. Just omit the parameter in the function equation that uses it, and re-introduce it on the RHS in a lambda (I don't know if I would do it personally though, it depends on the situation).</p>\n\n<hr>\n\n<p>That being said, in GHC, there really <em>is</em> a difference between <code>f = id</code> to <code>f a = a</code>.</p>\n\n<p>The inliner in GHC can only inline functions that are called with the same amount of parameters that are in the function definition.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1484319123, "post_id": 41636652, "comment_id": 70474229, "body": "Well, the compiler could always eta-expand before generating the <code>case</code>. It should be semantics-preserving if previous equations had all the arguments (even in the presence of <code>seq</code> and function-typed bottoms). Still, this is an interesting point of view."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1484318768, "last_edit_date": 1484318768, "creation_date": 1484317185, "answer_id": 41636652, "question_id": 41636387, "link": "https://stackoverflow.com/questions/41636387/is-f-x-x-not-equivalent-to-f-id/41636652#41636652", "title": "Is `f x = x` not equivalent to `f = id`?", "body": "<p>Note that the piecewise definition of a function isn't first-class syntax; it is just <a href=\"https://en.wikibooks.org/wiki/Haskell/Syntactic_sugar#Function_Bindings\" rel=\"nofollow noreferrer\">syntactic sugar for a <code>case</code> expression</a>:</p>\n\n<pre><code> f :: Eq a =&gt; [a] -&gt; [a]\n f = \\x -&gt; case x of\n           (a:b:xs) | a == b -&gt; f xs\n                    | otherwise -&gt; a : f (b:xs)\n           x -&gt; x\n</code></pre>\n\n<p>This makes it a little easier to see why you can't change the number of arguments from piece to piece: the compiler wouldn't be able to correctly fill in the last line of the <code>case</code> expression.</p>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "closed_date": 1484324474, "accepted_answer_id": 41636652, "answer_count": 2, "score": 2, "last_activity_date": 1484577741, "creation_date": 1484316332, "question_id": 41636387, "link": "https://stackoverflow.com/questions/41636387/is-f-x-x-not-equivalent-to-f-id", "closed_reason": "Duplicate", "title": "Is `f x = x` not equivalent to `f = id`?", "body": "<p>I just tried to write a function that removes two subsequent identical entries of a list. (As soon as there are two identical entries in the list, they should be removed.) I came up with following recursive function, which works exactly as expected. It relies on pattern matching:</p>\n\n<pre><code> f :: Eq a =&gt; [a] -&gt; [a]\n f(a:b:xs)|a==b = f xs\n          |otherwise = a : f (b:xs)\n f x=x                                -- if the list has less than two entries\n</code></pre>\n\n<p>Now I though we could rewrite the second case as <code>f=id</code>, but for the code</p>\n\n<pre><code>f :: Eq a =&gt; [a] -&gt; [a]\nf(a:b:xs)|a==b = f xs\n         |otherwise = a : f (b:xs)\nf = id\n</code></pre>\n\n<p>I get following error, which I do not understand:</p>\n\n<pre><code>\\path\\to\\my\\program.hs:1:1:\nEquations for `f' have different numbers of arguments\n  \\path\\to\\my\\program.hs:\n(1,1)-(2,34)\n  \\path\\to\\my\\program.hs:\n3:1-6\nFailed, modules loaded: none.\n</code></pre>\n\n<p>As I see it both have the exact same number of arguments (one), but GHC does not seem to agree, can anyone explain what I did wrong?</p>\n\n<p><a href=\"https://tio.run/nexus/haskell#fYwxD4IwEIX3/oo3OGACA7g1qZubmyNhKNpKEyzIHaED/x0PE1ffDXd57923eWiNyxsW5ozaNii@S/nM6lYnOq7WmBYGHokUfloH7ty0BHISWWiJs29dSU@shH8qCgQPIaAPxOgsoXdE4tgIXga4yFNwpKTohRYe28uGKNc4842na8QB1A2LLI@6zMu8yk8yZbOzXRrdnUN8oq52S/DDzPK6fQA\" rel=\"nofollow noreferrer\" title=\"Haskell \u2013 TIO Nexus\">Try it online!</a></p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484315538, "post_id": 41635995, "comment_id": 70471899, "body": "So they should be dividable by <i>all</i> elements in the given list?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484315734, "post_id": 41635995, "comment_id": 70472022, "body": "What do you hope this recursion to accomplish? Give some example outputs that the function should yield once it works!"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484316391, "post_id": 41635995, "comment_id": 70472408, "body": "Sorry about that, they should be all number that are divisible by any number of the given list for example take 5 (myCode[2,5]) would get me the List [2,4,5,6,8]"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484316066, "post_id": 41636236, "comment_id": 70472221, "body": "Thank you very much for your help, however in this case I am looking for all Numbers which are divisible by either numer and not ALL numbers of the List for example take 4 (myCode[2,3]) would be [2,3,4,6] sorry for not specifying clearly enough"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484316455, "post_id": 41636236, "comment_id": 70472446, "body": "However through your coment I still did learn a lot of functions I should research :) Thanks a bunch"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484316499, "post_id": 41636236, "comment_id": 70472480, "body": "@HenrikBaumann: in that case you simply need to replace <code>all</code> with <code>any</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1484317233, "last_edit_date": 1484317233, "creation_date": 1484315828, "answer_id": 41636236, "question_id": 41635995, "link": "https://stackoverflow.com/questions/41635995/haskell-an-infinite-list-which-is-divisible-by-every-number-of-a-given-list/41636236#41636236", "title": "Haskell - an infinite List which is divisible by every number of a given List", "body": "<p>No need to use recursion here: simply use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:all\" rel=\"nofollow noreferrer\"><code>all</code></a> (or <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:any\" rel=\"nofollow noreferrer\"><code>any</code></a>) as condition:</p>\n\n<pre><code>alldiv :: [Int] -&gt; Int -&gt; Bool\nalldiv l b = all (\\n -&gt; b `mod` n == 0) l\n\nmyCode :: [Int] -&gt; [Int]\nmyCode as = [ x | x &lt;- [0..] , alldiv as x]\n</code></pre>\n\n<p>You can rewrite <code>alldiv</code> to:</p>\n\n<pre><code>alldiv :: [Int] -&gt; Int -&gt; Bool\nalldiv l b = all ((==) 0 . mod b) l\n</code></pre>\n\n<p>or even attach it locally to <code>myCode</code>:</p>\n\n<pre><code>myCode :: [Int] -&gt; [Int]\nmyCode as = [ x | x &lt;- [0..] , alldiv x]\n    where alldiv b = all ((==) 0 . mod b) as\n</code></pre>\n\n<p>Finally you do not need list comprehension, you can simply use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a>:</p>\n\n<pre><code>myCode :: [Int] -&gt; [Int]\nmyCode as = filter alldiv [0..]\n    where alldiv b = all ((==) 0 . mod b) as\n</code></pre>\n\n<h1>EDIT</h1>\n\n<p>Since it is sufficient that it one element in the list is a divider, you only need to replace <code>all</code> with <code>any</code>.</p>\n"}], "owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 886, "favorite_count": 0, "accepted_answer_id": 41636236, "answer_count": 1, "score": 2, "last_activity_date": 1484317233, "creation_date": 1484314976, "last_edit_date": 1484315506, "question_id": 41635995, "link": "https://stackoverflow.com/questions/41635995/haskell-an-infinite-list-which-is-divisible-by-every-number-of-a-given-list", "title": "Haskell - an infinite List which is divisible by every number of a given List", "body": "<p>I am still a beginner in Haskell and currently I am trying to create a function in which i generate an infinite list from which I (if I use take 10 for example) take the first ten number, which are divisible by another list, which is given.</p>\n\n<p>Here is my idea: </p>\n\n<pre><code>myCode :: [Int] -&gt; [Int]\nmyCode (a:as) = [ x | x &lt;- [0..] , x `mod` a == 0 , x `mod` myCode as ==0]\n</code></pre>\n\n<p>As you may have notices is that I am trying to solve it through recursion, however I always get the error \"Couldn't match expected type \u2018Bool\u2019 with actual type \u2018[Int]\u2019 \" \nI am kinda at a loss, because I wouldn't know how else to solve this particular problem.</p>\n"}, {"tags": ["haskell", "recursion", "addition"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484314340, "post_id": 41635697, "comment_id": 70471179, "body": "<code>y</code> is the value that is decreasing towards 0, not <code>x</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1484314426, "creation_date": 1484314426, "answer_id": 41635835, "question_id": 41635697, "link": "https://stackoverflow.com/questions/41635697/recursive-addition-in-haskell/41635835#41635835", "title": "Recursive addition in Haskell", "body": "<p>You are mixing up <code>x</code> and <code>y</code> in your recursive case</p>\n\n<pre><code>addition x y | y &gt; 0 = addition (plusOne x) (y - 1)  -- x + y == (x + 1) + (y - 1)\n             | otherwise = x   -- x + 0 = x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": false, "score": 0, "last_activity_date": 1484341793, "creation_date": 1484341793, "answer_id": 41643475, "question_id": 41635697, "link": "https://stackoverflow.com/questions/41635697/recursive-addition-in-haskell/41643475#41643475", "title": "Recursive addition in Haskell", "body": "<p>using <code>==</code> and <code>0</code></p>\n\n<pre><code>addition = add 0 where\n    add a y x | a == y = x\n              | otherwise = add (plusOne a) y (plusOne x)\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 859, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1484341793, "creation_date": 1484313998, "last_edit_date": 1484324835, "question_id": 41635697, "link": "https://stackoverflow.com/questions/41635697/recursive-addition-in-haskell", "title": "Recursive addition in Haskell", "body": "<p>The problem:</p>\n\n<blockquote>\n  <p>You are given a function <code>plusOne x = x + 1</code>. Without using any other <code>(+)</code>s, define a recursive function <code>addition</code> such that <code>addition x y</code> adds <code>x</code> and <code>y</code> together.</p>\n</blockquote>\n\n<p>(from <a href=\"https://en.wikibooks.org/wiki/Haskell/Recursion#Other_recursive_functions\" rel=\"nofollow noreferrer\">wikibooks.org</a>)</p>\n\n<p>My code (it does not work -- endless loop):</p>\n\n<pre><code>plusOne x = x + 1\n\naddition x y \n  | x &gt; 0  =  addition (plusOne y) (x-1)\n  | otherwise = y\n</code></pre>\n\n<p>Questions:</p>\n\n<ol>\n<li>How to connect the <code>plusOne</code> function to the <code>addition</code> recursive function?</li>\n<li>How should it be written?</li>\n</ol>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1484331281, "post_id": 41635563, "comment_id": 70481786, "body": "What version of stack are you using? I&#39;m using 1.2.0 and the eval works."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1484331322, "post_id": 41635563, "comment_id": 70481808, "body": "And my configuration is similar to yours -- no globally installed GHC."}, {"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "reply_to_user": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1484369312, "post_id": 41635563, "comment_id": 70493165, "body": "@scootermefecit I use stack 1.3, but think it is something in my configuration. I perhaps used to have a global GHC long ago, and it may even have been in this folder. So there might be some leftovers somewhere but I couldn&#39;t figure out what and where"}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1484433436, "post_id": 41635563, "comment_id": 70510176, "body": "It looks like the main difference between you and me is compiler version: I&#39;m using 8.0.1. If I force 7.10.3, you&#39;re right, the stack command doesn&#39;t work."}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484313538, "creation_date": 1484313538, "question_id": 41635563, "link": "https://stackoverflow.com/questions/41635563/haskell-stack-and-ghc-paths-libdir", "title": "Haskell stack and GHC.Paths.libdir", "body": "<p>I am asking GHC for the lib path and it gives me a path that doesn't exist:</p>\n\n<pre><code>bash-3.2$ stack eval GHC.Paths.libdir\nunknown option: 'c'\n\"/Users/alexey/haskell/ghc-7.10.3/lib/ghc-7.10.3\"\n</code></pre>\n\n<p>This folder does not exist, not in my <code>PATH</code> and doesn't appear anywhere in my <code>env</code>. I don't currently have global/system GHC installed.</p>\n\n<p>at the same time I get</p>\n\n<pre><code>bash-3.2$ stack exec ghc -- --print-libdir\n/Users/alexey/.stack/programs/x86_64-osx/ghc-7.10.3/lib/ghc-7.10.3\n</code></pre>\n\n<p>which is expected.</p>\n\n<p>This is not project specific and is replicated in any project that uses GHC 7.10.3.</p>\n\n<p>Both commands show the same and correct output when executed in other projects that use other GHC version (8.0.1).</p>\n\n<p>Where this wrong path is coming from and how to fix it?</p>\n"}, {"tags": ["haskell", "functional-programming", "records", "algebraic-data-types"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484307818, "post_id": 41633607, "comment_id": 70467242, "body": "&quot;This approach has the problem that the user of any given step is suddenly exposed to all the steps before&quot; &lt;- what do you mean by this?"}, {"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484308379, "post_id": 41633607, "comment_id": 70467605, "body": "for the user of any given step the expectation would be to access any property via <code>someInstance.itemX</code> vs <code>someInstance.b.a.itemX</code>"}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1484313859, "post_id": 41634063, "comment_id": 70470884, "body": "<a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/trees-that-grow.pdf\" rel=\"nofollow noreferrer\">Source</a> for the type family trick (page 4)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484330107, "post_id": 41634063, "comment_id": 70481117, "body": "@BenjaminHodgson Thanks! On that note, I am playing a bit faster and dirtier by assuming that a field always goes from restricted to available (and never back again), so I need only one type family. In order to represent arbitrary masking of fields at different stages, one would need one type family per field."}, {"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1484335173, "post_id": 41634063, "comment_id": 70483666, "body": "thx for your answer. very nice. is it possible to emulate that same effect without using type families just by using higher kinded types?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1484337301, "post_id": 41634063, "comment_id": 70484736, "body": "@robkuz I don&#39;t think so, but see my edit if you want to avoid having to define any type families yourself."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1484337268, "last_edit_date": 1495535392, "creation_date": 1484308377, "answer_id": 41634063, "question_id": 41633607, "link": "https://stackoverflow.com/questions/41633607/how-to-design-for-extension-using-records/41634063#41634063", "title": "How to design for extension using records", "body": "<p>If you want to avoid language extensions, the two solutions you propose are the way to go. For the variant where you get nesting, I'd recommend you <code>{-# UNPACK #-}</code> the nested data. That way you avoid indirection at runtime at least.</p>\n\n<p>If you <em>really</em> want to use something subtyping-like, check out <a href=\"https://stackoverflow.com/a/41511007/3072788\">this solution</a> I came up with a couple of days ago. </p>\n\n<p>However, I think for this problem you would be better off following an approach commonly used for data that gets transformed stage to stage (GHC uses something similar for processing Haskell AST). Basically, you make a <code>type familiy</code> that \"hides\" fields until the right stage by given them type <code>()</code> until the right stage.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds #-}\n\ndata Stage = A | B | C\n\n-- | A data type containing the final set of fields\ndata Complete (stage :: Stage) = Complete\n  { item1 :: RestrictedUntilAfter A stage SomeType\n  , item2 :: RestrictedUntilAfter B stage SomeOtherType\n  , item3 :: RestrictedUntilAfter C stage SomeOtherTypeAgain\n  }\n\n-- | Compares the two given stages to determine if the result type should be hidden\n-- as `()` or not\ntype family RestrictedUntilAfter (s1 :: Stage) (s2 :: Stage) x :: * where\n  RestrictedUntilAfter B A _ = ()\n  RestrictedUntilAfter C A _ = ()\n  RestrictedUntilAfter C B _ = ()\n  RestrictedUntilAfter _ _ t = t\n</code></pre>\n\n<p>Then, your types going through the pipeline are <code>Complete A</code>, <code>Complete B</code>, and <code>Complete C</code>. Fields that are restricted until a certain stage will have type <code>()</code> before that stage.</p>\n\n<pre><code>c1 = Complete { item1 = x, item2 = (), item3 = () } :: Complete A -- x :: SomeType\nc2 = Complete { item1 = x, item2 = y, item3 = () } :: Complete B  -- y :: SomeOtherType\nc3 = Complete { item1 = x, item2 = y, item3 = z } :: Complete C   -- z :: SomeOtherTypeAgain\n</code></pre>\n\n<p>(The type family might be better being open, or pattern-matched in a different order, but the idea is the same) </p>\n\n<h2>EDIT</h2>\n\n<p>As I suspected, there is a cleaner type family approach. In fact, with this approach, you don't even need to define any type families and it scales nicely in terms of LOC as you add both stages and fields. Finally, it is even more flexible. However, it does depend on <a href=\"https://hackage.haskell.org/package/type-list-0.5.0.0\" rel=\"nofollow noreferrer\"><code>type-list</code></a>.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, TypeOperators #-}\n\nimport Data.Type.List\nimport Data.Type.Bool\n\ndata Stage = A | B | C\n\ntype RestrictedTo stage validStages ty = If (Find stage validStages) ty ()\n\n-- | A data type containing the final set of fields\ndata Complete (stage :: Stage) = Complete\n  { item1 :: stage `RestrictedTo` [A,B,C] SomeType\n  , item2 :: stage `RestrictedTo` [B,C]   SomeOtherType\n  , item3 :: stage `RestrictedTo` [C]     SomeOtherTypeAgain\n  }\n</code></pre>\n\n<p>Now, you can even have a field that is non-<code>()</code> only at stages <code>A</code> and <code>C</code> (but not <code>B</code>): <code>item4 :: stage `RestrictedTo` [A,C] SomeOtherOtherType</code></p>\n"}], "owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 2, "accepted_answer_id": 41634063, "answer_count": 1, "score": 3, "last_activity_date": 1484346223, "creation_date": 1484306819, "last_edit_date": 1484346223, "question_id": 41633607, "link": "https://stackoverflow.com/questions/41633607/how-to-design-for-extension-using-records", "title": "How to design for extension using records", "body": "<p>I'd like to know how people from the Haskell community approach the following design.\nAssume a workflow-like system where you are piping some data (structure) through multiple steps in the system.\nAs that data flows through the system, more and more data items are to be added to that structure that are not available in prior steps.\nNow I want to make sure that data items that are not available in a prior step are unaccessible - ideally via compile time checking.</p>\n\n<p>So far, I came up with two different approaches.</p>\n\n<p>Approach 1: recreate all types over and over again:</p>\n\n<pre><code>module Step1 where\n\n    data A = A { item1 :: SomeType }\n\nmodule Step2 where\n\n    data B = B { item1 :: SomeType, item2 :: SomeOtherType }\n\n    fromAtoB :: A -&gt; B\n\nmodule Step3 where\n\n    data C = C { item1 :: SomeType, item2 :: SomeOtherType, item3 :: SomeOtherTypeAgain }\n\n    fromBtoC :: B -&gt; C\n</code></pre>\n\n<p>Obviously this becomes pretty burdensome the more steps there are and the deeper and wider the data types are defined.</p>\n\n<p>Approach 2: compose the types:</p>\n\n<pre><code>module Step1 where\n\n    data A = A { item1 :: SomeType }\n\nmodule Step2 where\n\n    data B = B { a :: A , item2 :: SomeOtherType }\n\n    fromAtoB :: A -&gt; B\n\nmodule Step3 where\n\n    data C = C { b :: B, item3 :: SomeOtherTypeAgain }\n\n    fromBtoC :: B -&gt; C\n</code></pre>\n\n<p>This approach has the problem that the user of any given step is suddenly exposed to all the steps before, as the access to some of the properties is different than to others (for instance, <code>cInstance.b.a.Item1</code> vs. <code>cInstance.Item1</code>), een though for the user of any given step the data structure is naturally flat.\nIndeed he/she will not necessarily even know that there are steps before their own step. In an OO system, I would simply extend C from B and B from A.</p>\n\n<p>Any ideas are greatly welcome.</p>\n"}, {"tags": ["haskell", "atom-editor"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484299179, "post_id": 41630822, "comment_id": 70462087, "body": "The <a href=\"https://atom.io/packages/language-haskell\" rel=\"nofollow noreferrer\">first</a> <a href=\"https://atom.io/packages/ide-haskell\" rel=\"nofollow noreferrer\">three</a> <a href=\"https://github.com/simonmichael/haskell-atom-setup\" rel=\"nofollow noreferrer\">links</a> on Google seem like a good start. As it stands, this question is too broad - it might be better to ask about particular setups."}], "answers": [{"tags": [], "owner": {"reputation": 399, "user_id": 766578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ebb5e42eb5f6c73b2a74705bcf9b274?s=128&d=identicon&r=PG", "display_name": "cmende", "link": "https://stackoverflow.com/users/766578/cmende"}, "is_accepted": false, "score": 0, "last_activity_date": 1484304659, "creation_date": 1484304659, "answer_id": 41632887, "question_id": 41630822, "link": "https://stackoverflow.com/questions/41630822/how-to-configure-haskell-in-atom-text-editor/41632887#41632887", "title": "How to configure Haskell in Atom text editor?", "body": "<p>Take a look at <a href=\"https://github.com/atom-haskell/ide-haskell#readme\" rel=\"nofollow noreferrer\">the IDE Haskell package</a>. It includes requirements on other packages and instructions on how to install those.</p>\n"}, {"comments": [{"owner": {"reputation": 5434, "user_id": 5404226, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/awXQh.png?s=128&g=1", "display_name": "Ahx", "link": "https://stackoverflow.com/users/5404226/ahx"}, "edited": false, "score": 3, "creation_date": 1546251203, "post_id": 41633055, "comment_id": 94809519, "body": "Setting Up A Haskell Development Environment (Mac OS) link is dead"}], "tags": [], "owner": {"reputation": 3753, "user_id": 947114, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5fa834cee92d92c5a034d5aac791e6f1?s=128&d=identicon&r=PG", "display_name": "mdm", "link": "https://stackoverflow.com/users/947114/mdm"}, "is_accepted": true, "score": 3, "last_activity_date": 1495140671, "last_edit_date": 1495140671, "creation_date": 1484305211, "answer_id": 41633055, "question_id": 41630822, "link": "https://stackoverflow.com/questions/41630822/how-to-configure-haskell-in-atom-text-editor/41633055#41633055", "title": "How to configure Haskell in Atom text editor?", "body": "<p>I personally followed a mix of these two:</p>\n\n<p><a href=\"http://www.prigrammer.com/?p=332\" rel=\"nofollow noreferrer\">Setting Up A Haskell Development Environment (Mac OS)</a> - very recent, which is good, given the focus on Atom.</p>\n\n<p><a href=\"http://seanhess.github.io/2015/08/05/practical-haskell-editors.html\" rel=\"nofollow noreferrer\">Practical Haskell - Editor Setup with Stack</a> - useful to compare things, and crosschecking packages to install in Atom.</p>\n\n<p>But that's because I wanted to setup macOS, Haskell, Stack, Atom.io, using Homebrew.<br>\nHope that's similar enough to your usecase to be useful. :) </p>\n"}], "owner": {"reputation": 5185, "user_id": 1708647, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/a0dvT.jpg?s=128&g=1", "display_name": "Amit Bhati", "link": "https://stackoverflow.com/users/1708647/amit-bhati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7938, "favorite_count": 0, "accepted_answer_id": 41633055, "answer_count": 2, "score": 6, "last_activity_date": 1495140671, "creation_date": 1484298132, "last_edit_date": 1484696008, "question_id": 41630822, "link": "https://stackoverflow.com/questions/41630822/how-to-configure-haskell-in-atom-text-editor", "title": "How to configure Haskell in Atom text editor?", "body": "<p>I am new to Haskell and want to use it along with Atom text editor, please can someone tell me the steps on how to configure haskell in atom text editor?</p>\n"}, {"tags": ["haskell", "types", "monads", "category-theory"], "answers": [{"comments": [{"owner": {"reputation": 136, "user_id": 1553834, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/Rk6Gb.jpg?s=128&g=1", "display_name": "urbanslug", "link": "https://stackoverflow.com/users/1553834/urbanslug"}, "edited": false, "score": 1, "creation_date": 1484309545, "post_id": 41631004, "comment_id": 70468331, "body": "I see (just a comment), the resulting structure in the same but the value is not. Which is the point of monads, compared to monad transformers: to affect the <code>a</code> in <code>m a</code> but leave the <code>m</code>; compared to monad transformers which would affect the <code>m</code> and leave the <code>a</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1484298851, "creation_date": 1484298851, "answer_id": 41631004, "question_id": 41630650, "link": "https://stackoverflow.com/questions/41630650/are-join-and-fmap-join-equals-in-haskell-from-category-theory-point-of-view/41631004#41631004", "title": "Are `join` and `fmap join` equals in Haskell (from Category theory point of view)?", "body": "<blockquote>\n  <p>I am confused by the fact that this example uses instances of types, not the types. Because the objects in category Hask are types, not their instances.</p>\n</blockquote>\n\n<p>The example uses an instance of a <em>class</em>, which is itself a <em>type</em>. </p>\n\n<hr>\n\n<p>In Haskell, yes this is the same object (type). Instances of the <code>Monad</code> typeclass have to be type constructors and type constructors are injective. Then, it should be pretty clear that</p>\n\n<pre><code>X = X   =&gt;   M(X) = M(X)   =&gt;   M(M(X)) = M(M(X))\n</code></pre>\n\n<p>The catch here is that that only means they are the same type, not value. Just because <code>fmap join</code> and <code>join</code> can both have their types specialized to <code>Monad m =&gt; m (m (m a)) -&gt; m (m a)</code> does not mean that they do the same thing.</p>\n\n<p>They don't.</p>\n\n<pre><code>ghci&gt; (fmap join) [[[1],[2],[3]]]\n[[1,2,3]]         \nghci&gt; join [[[1],[2],[3]]]\n[[1],[2],[3]]\n</code></pre>\n\n<p>Not all drawings of categories have to end up being commuting diagrams. :)</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 7, "last_activity_date": 1484313975, "creation_date": 1484313975, "answer_id": 41635687, "question_id": 41630650, "link": "https://stackoverflow.com/questions/41630650/are-join-and-fmap-join-equals-in-haskell-from-category-theory-point-of-view/41635687#41635687", "title": "Are `join` and `fmap join` equals in Haskell (from Category theory point of view)?", "body": "<p>From the picture, you can see that <code>fmap join</code> and <code>join</code> produce <em>different</em> values of the same <em>type</em>. Thus, they are not the same, even though their <em>composition</em> with <code>join</code> ultimately produces identical values.</p>\n\n<p>In category theory, an <a href=\"https://en.wikipedia.org/wiki/Epimorphism\"><em>epimorphism</em></a> is a morphism <code>g</code> such that <code>f1 . g == f2 . g</code> implies that <code>f1 == f2</code> as well. In this case, we can see that <code>join</code> is <em>not</em> an epimorphism, because although <code>fmap join . join == join. join</code>, it is not true that <code>fmap join == join</code>.</p>\n"}], "owner": {"reputation": 797, "user_id": 2799055, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/94df8a6bb7ee4d9b77adb8ab4f381422?s=128&d=identicon&r=PG&f=1", "display_name": "azaviruha", "link": "https://stackoverflow.com/users/2799055/azaviruha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 41631004, "answer_count": 2, "score": 6, "last_activity_date": 1484346265, "creation_date": 1484297560, "last_edit_date": 1484346265, "question_id": 41630650, "link": "https://stackoverflow.com/questions/41630650/are-join-and-fmap-join-equals-in-haskell-from-category-theory-point-of-view", "title": "Are `join` and `fmap join` equals in Haskell (from Category theory point of view)?", "body": "<p>My question arises from first law of monads in Haskell: <code>join . fmap join = join . join</code>.</p>\n\n<p>In <a href=\"https://en.wikibooks.org/wiki/Haskell/Category_theory#Monads\" rel=\"nofollow noreferrer\">Haskell/Category_theory</a> this law is demonstrated by the following picture:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Lm7wO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Lm7wO.png\" alt=\"enter image description here\"></a></p>\n\n<p>I am confused by the fact that this example uses instances of types, not the types. Because the objects in category <code>Hask</code> are types, not their instances.</p>\n\n<p>So I tried to redraw this example with types, and here what I got:\n<a href=\"https://i.stack.imgur.com/dWK5X.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dWK5X.png\" alt=\"enter image description here\"></a></p>\n\n<p>In this picture both arrows (<code>join</code> and <code>fmap join</code>) leads to the <code>M(M(X))</code>. Is this the same object, or there are two different <code>M(M(X))</code>?</p>\n"}, {"tags": ["haskell", "haskell-stack", "haddock"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484290423, "post_id": 41628606, "comment_id": 70458118, "body": "Try replacing <code>stack exec -- which haddock</code>."}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 2, "creation_date": 1484298865, "post_id": 41628606, "comment_id": 70461913, "body": "While that works, it&#39;s only good as a workaround. I&#39;d rather avoid having to overwrite files which are managed by stack."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484307280, "post_id": 41628606, "comment_id": 70466918, "body": "Alternatively you can use <code>--system-ghc</code> to use <i>both</i> the <code>ghc</code> and <code>haddock</code> that are on your <code>PATH</code>. This requires that the <code>ghc</code> on your <code>PATH</code> has the right version for your project."}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484312533, "post_id": 41628606, "comment_id": 70470086, "body": "I wonder if I can somehow extract the path to the stack-managed GHC (~/.stack/.../ghc-8.0.1/bin/), prepend the path to my haddock binary (so my haddock binary gets precedence), and then use --system-ghc. That would give me the best of both world: always an accurate version of GHC (managed by stack) while still allowing to use a custom haddock."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484314525, "post_id": 41628606, "comment_id": 70471286, "body": "That&#39;s <code>stack path --compiler-bin</code>."}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484391963, "post_id": 41628606, "comment_id": 70497441, "body": "Unfortunately that doesn&#39;t work."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484411058, "post_id": 41628606, "comment_id": 70503059, "body": "How does it fail?"}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484591299, "post_id": 41628606, "comment_id": 70562665, "body": "The documentation is rendered with the old binary (and thus has the old style)."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484606917, "post_id": 41628606, "comment_id": 70569673, "body": "<code>stack path --compiler-bin</code> works for me with both v1.3.2 and HEAD."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484607489, "post_id": 41628606, "comment_id": 70569901, "body": "Ah, sorry, I misunderstood you. You&#39;ll have to hide/rename the original haddock binary then. That works for me at least. Or you could submit a patch for a <code>--which-haddock</code> option, that would solve it for all of us! :)"}], "owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 209, "favorite_count": 1, "answer_count": 0, "score": 6, "last_activity_date": 1484288850, "creation_date": 1484288850, "question_id": 41628606, "link": "https://stackoverflow.com/questions/41628606/how-to-use-a-custom-haddock-executable-to-generate-documentation-with-stack", "title": "How to use a custom haddock executable to generate documentation with stack?", "body": "<p>I'm working on a new theme for Haddock and want to try it on some real projects. How can I configure stack to use my haddock executable? I don't see any config option in stack.yaml. I've also tried putting the new haddock executable into my PATH but that didn't help.</p>\n"}, {"tags": ["git", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 3, "creation_date": 1484265576, "post_id": 41624959, "comment_id": 70451608, "body": "Well, the project has to specify versions of all transitive dependencies somehow, and the straight forward way to do that is to add them to the <code>extra-deps</code> as suggested. <code>stack</code> currently respects only a single <code>stack.yaml</code>, so <code>risk-types</code>&#39;s <code>stack.yaml</code> is ignored. If you want to avoid redundantly declaring extra-deps in multiple <code>stack.yaml</code>s, the easiest way might be to move all internal packages into a common stack project."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484302255, "post_id": 41624959, "comment_id": 70463928, "body": "Oh, maybe there&#39;s an alternative to moving everything into a single stack project: Define a <a href=\"https://docs.haskellstack.org/en/stable/custom_snapshot/\" rel=\"nofollow noreferrer\">custom snapshot</a> that includes your extra-deps!"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484325943, "post_id": 41624959, "comment_id": 70478731, "body": "Thanks. Your comment about there being only one stack.yaml makes things much clearer."}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1517908671, "creation_date": 1484264035, "last_edit_date": 1517908671, "question_id": 41624959, "link": "https://stackoverflow.com/questions/41624959/build-plan-error-when-depending-on-git-package-with-extra-deps", "title": "Build Plan error when depending on git package with extra-deps", "body": "<p>I need some way to share private code between internal packages. In this case, I have a project, called <code>cra-products</code> which depends on <code>risk-types</code>. <code>risk-types</code> needs to be shared between several projects, and it cannot be public. </p>\n\n<p>I'm using stack and the packages node to depend on <code>risk-types</code> like this:</p>\n\n<pre><code>packages:\n- '.'\n- location:\n   git: git@git.xxxx.com:risk/risk-types.git\n   commit: 9653ca15\n  extra-dep: true\n</code></pre>\n\n<p>But <code>risk-types</code> itself depends on other code not in the index: <code>refined</code>, <a href=\"https://hackage.haskell.org/package/refined\" rel=\"nofollow noreferrer\">which is on Hackage</a>, and <code>validated-types</code>, <a href=\"https://github.com/seanhess/validated-types\" rel=\"nofollow noreferrer\">which is something I wrote on github</a> (haven't published it yet, because I'm still working on it). </p>\n\n<p>Here's <code>risk-types</code>' stack.yaml:</p>\n\n<pre><code>packages:\n- '.'\n- location:\n   git: https://github.com/seanhess/validated-types.git\n   commit: fc59f3d\n  extra-dep: true\nextra-deps:\n- validated-types-0.1.0.0\n- refined-0.1.2.1\n</code></pre>\n\n<p>When I got to build <code>cra-products</code>, I get this error:</p>\n\n<pre><code>$ stack build\n\nWarning: Some extra-deps are neither installed nor in the index:\n    * risk-types-0.1.0.0\n\nError: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for risk-types-0.1.0.0:\n    refined must match -any, but the stack configuration has no specified version (latest applicable is 0.1.2.1)\n    validated-types must match -any, but the stack configuration has no specified version\nneeded due to cra-products-0.1.0.0 -&gt; risk-types-0.1.0.0\n\nRecommended action: try adding the following to your extra-deps in /Users/seanhess/projects/simple/cra-products/stack.yaml:\n- refined-0.1.2.1\n</code></pre>\n\n<p>Even if I add <code>refined</code> to the extra-deps section of <code>cra-products</code>, I still get an error for <code>validated-types</code>. I don't want to have to do this, because my project doesn't currently depend directly on either of those, just on <code>risk-types</code>. How can I fix this?</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484315155, "post_id": 41624140, "comment_id": 70471651, "body": "Your question&#39;s kind of unclear. You say &quot;all <code>Action</code>s work inside a <code>BufAction</code> without lifting, while <code>BufAction</code>s cannot run inside an <code>Action</code>&quot; - how would this work, when <code>BufAction</code>&#39;s state is smaller than <code>Action</code>&#39;s state? Surely it should be the other way round?"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484322498, "post_id": 41624140, "comment_id": 70476434, "body": "Sorry that it&#39;s unclear; I&#39;ll attempt to explain a little better. Correct, BufAction uses a smaller state than <code>Action</code>, but it&#39;s not so much a &#39;smaller state&#39; as it is a state with &#39;more information&#39;. We can think of the state available to <code>BufAction</code> as <code>(ActionState, BufId)</code>; essentially the entire <code>ActionState</code> is available (just like <code>Action</code>) but we have info that lets us focus a specific buffer as well. So any <code>Action</code>s which operate over <code>ActionState</code> should still be available in <code>BufAction</code>; but <code>BufAction</code>s require the <code>BufId</code> context and can&#39;t run in an <code>Action</code>. Any clearer?"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484323214, "post_id": 41624140, "comment_id": 70476891, "body": "This means of course we&#39;ll have to change the state which the BufAction acts over to something that actually contains the larger state; but that&#39;s what the <code>HasEditor</code> and <code>HasBuffer</code> constraints refer to; <code>Action</code> should be run over a state with only <code>HasEditor</code>; while <code>BufAction</code> should be run over state with <code>HasEditor</code> AND <code>HasBuffer</code>, so it&#39;s more restrictive."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484323790, "post_id": 41624140, "comment_id": 70477245, "body": "So if I understand you correctly you have <code>type Buffer = (ActionState, BufId)</code> and you want to compose a <code>State ActionState</code> with a <code>State Buffer</code>? What&#39;s wrong with <code>zoom _1</code>?"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484415309, "post_id": 41624140, "comment_id": 70504521, "body": "@BenjaminHodgson That actually should work; but the trouble is in specifying the actual types of the monad stack; If I want my <code>Action</code> Monad stack to work in both <code>BufAction</code> stack and <code>Action</code> stacks I need the stack to be generic enough; i.e. something like <code>newtype Action a = forall s. HasEditor s =&gt; Action (StateT s IO a)</code>; but you can&#39;t have existentials in your newtype; You can do it for a <code>data</code> type, but then I lose GeneralizedNewType deriving and have to write instances for (Functor, Applicative, Monad, MonadState s, MonadIO) myself; which I could do; but I&#39;d rather not."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484418080, "post_id": 41624140, "comment_id": 70505427, "body": "@BenjaminHodgson I rewrote the second half of the question to reflect a few other (failed) attempts at solving the problem."}], "answers": [{"tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": true, "score": 0, "last_activity_date": 1484794626, "creation_date": 1484794626, "answer_id": 41732955, "question_id": 41624140, "link": "https://stackoverflow.com/questions/41624140/zoom-monad-stack-maintaining-context/41732955#41732955", "title": "Zoom monad stack maintaining context", "body": "<p>It looks like this is what you're trying to do to me. The constraints about what kind of state is acceptable in an Action will be specified on definitions using Action, not action itself. Then you'll be able to use the <code>zoom</code> function from the lens package to focus on different <code>Buffer</code>s in your <code>Editor</code>, for example.</p>\n\n<pre><code>{-# Language TemplateHaskell #-}\n{-# Language GeneralizedNewtypeDeriving #-}\n{-# Language MultiParamTypeClasses #-}\n{-# Language FlexibleInstances #-}\n{-# Language TypeFamilies #-}\n{-# Language UndecidableInstances #-} -- for the Zoomed type instance\n\nmodule Demo where\n\nimport Control.Monad.State\nimport Control.Monad.Reader\nimport Control.Lens\n\ndata Hooks\n\ndata SomeState = SomeState\n  { _thing1, _thing2 :: Int }\n\nmakeLenses ''SomeState\n\nnewtype Action s a = Action\n  { runAct :: StateT s (ReaderT Hooks IO) a\n  } deriving (Functor, Applicative, Monad, MonadState s)\n\ninstance Zoom (Action a) (Action s) a s where\n  zoom l (Action m) = Action (zoom l m)\n\ntype instance Zoomed (Action s) = Zoomed (StateT s (ReaderT Hooks IO))\n\nexample :: Action Int a -&gt; Action SomeState a\nexample = zoom thing1\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 41732955, "answer_count": 1, "score": 1, "last_activity_date": 1484794626, "creation_date": 1484260020, "last_edit_date": 1484417965, "question_id": 41624140, "link": "https://stackoverflow.com/questions/41624140/zoom-monad-stack-maintaining-context", "title": "Zoom monad stack maintaining context", "body": "<p>Time for my weekly lens question;</p>\n\n<p>I have a monad stack:</p>\n\n<pre><code>newtype Action a = Action\n  { runAct :: StateT ActionState (ReaderT Hooks IO) a\n  } deriving (Functor, Applicative, Monad, MonadState ActionState, MonadReader Hooks, MonadIO)\n\ndata ActionState = ActionState\n  { _ed :: Editor\n  , _asyncs :: [AsyncAction]\n  }\n</code></pre>\n\n<p>I used <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-TH.html#v:makeClassy\" rel=\"nofollow noreferrer\"><code>makeClassy</code></a> on the <code>Editor</code> type to generate a <code>HasEditor</code> typeclass which my editor lenses depend on.</p>\n\n<p>An <code>Editor</code> has many <code>Buffer</code>s; I've defined another monad stack type for an action that acts over a specific buffer (a <code>BufAction</code>); the only difference is that the StateT is over a <code>Buffer</code>:</p>\n\n<pre><code>newtype BufAction a = BufAction\n  { runBufAct::StateT Buffer (ReaderT Hooks IO) a\n  } deriving (Functor, Applicative, Monad, MonadState Buffer, MonadReader Hooks, MonadIO)\n</code></pre>\n\n<p>to run a <code>BufAction</code> I use <code>zoom (editor.buffers.ix selected)</code> to zoom the StateT to a specific buffer; but the issue is that now inside the <code>BufAction</code> I can no longer use any lenses that operate over <code>editor</code> or require <code>HasEditor</code>.</p>\n\n<p>Ideally all <code>Action</code>s run inside a <code>BufAction</code> without lifting, while <code>BufAction</code>s cannot run inside an <code>Action</code>. In this case <code>BufAction</code> would require the full <code>ActionState</code>, but also a reference to a specific buffer in order to run; whereas <code>Action</code> just requires the <code>ActionState</code>; so <code>BufAction</code> is a more restrictive Monad and <code>Action</code>s should be embeddable in it.</p>\n\n<p>So approximately I want some sort of type like this:</p>\n\n<pre><code>newtype Action a = forall s. HasEditor s =&gt; Action\n  { runAct :: StateT s (ReaderT Hooks IO) a\n  } deriving (Functor, Applicative, Monad, MonadState s, MonadReader Hooks, MonadIO)\n</code></pre>\n\n<p>However GHC chokes on this; it can't handle existentials and constraints in a newtype;</p>\n\n<p>I switched it to a <code>data</code> type; but then I lose GeneralizedNewtypeDeriving and need to implement all of those deriving\nclauses manually; which I'd really rather not do.</p>\n\n<p>I've also tried using a type alias; which would mean I don't need to derive typeclasses, but since I also embed Actions\nin other datatypes I run into errors; for example since I use <code>Action</code> here:</p>\n\n<pre><code>data ActionState = ActionState\n{ _ed :: Editor\n, _asyncs :: [Async (Action ())]\n, _hooks :: Hooks\n, _nextHook :: Int\n}\n</code></pre>\n\n<p>I run into:</p>\n\n<pre><code>\u2022 Illegal polymorphic type: Action ()\n  GHC doesn't yet support impredicative polymorphism\n\u2022 In the definition of data constructor \u2018ActionState\u2019\n  In the data type declaration for \u2018ActionState\u2019\n</code></pre>\n\n<p>Taking a different tact; I've also tried implementing a flexible MonadState instance:</p>\n\n<pre><code>instance (HasEditor s, HasBuffer s) =&gt; (MonadState s) BufAction where\n</code></pre>\n\n<p>but get:</p>\n\n<pre><code>\u2022 Illegal instance declaration for \u2018MonadState s BufAction\u2019\n    The coverage condition fails in class \u2018MonadState\u2019\n      for functional dependency: \u2018m -&gt; s\u2019\n    Reason: lhs type \u2018BufAction\u2019 does not determine rhs type \u2018s\u2019\n    Un-determined variable: s\n\u2022 In the instance declaration for \u2018(MonadState s) BufAction\u2019\n</code></pre>\n\n<p>Because MonadState uses functional dependencies...</p>\n\n<p>Really stuck on this one and I could use a hand!</p>\n\n<p>Thanks for taking a look! I really appreciate the help!</p>\n"}, {"tags": ["haskell", "markdown", "github-flavored-markdown", "hackage"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1484261036, "post_id": 41623846, "comment_id": 70450093, "body": "I am not voting to close: this doesn&#39;t appear to be a question asking for a library/tool recommendation at all, but rather a question about what tool Hackage uses. It seems perfectly on-topic to me, and well-phrased as well."}], "answers": [{"comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484267000, "post_id": 41624459, "comment_id": 70452014, "body": "Thanks for the well-researched answer! I have submitted <a href=\"https://github.com/haskell/hackage-server/issues/565\" rel=\"nofollow noreferrer\">a request</a> to support a larger subset of GitHub-flavored Markdown!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484268265, "post_id": 41624459, "comment_id": 70452352, "body": "@sjakobi I reckon your best chance is probably if Hackage decides to enable inline HTML. Moving away from <code>cheapskate</code> would probably be a bad idea (it is fast and forgiving), and I think <code>cheapskate</code> won&#39;t be interested in adding non-standard features."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484269239, "post_id": 41624459, "comment_id": 70452574, "body": "You may be right. I have opened <a href=\"https://github.com/jgm/cheapskate/issues/18\" rel=\"nofollow noreferrer\">an issue</a> for <code>cheapskate</code> anyway."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1484261890, "last_edit_date": 1484261890, "creation_date": 1484261407, "answer_id": 41624459, "question_id": 41623846, "link": "https://stackoverflow.com/questions/41623846/which-dialect-of-markdown-does-hackage-use-to-render-readmes/41624459#41624459", "title": "Which dialect of Markdown does Hackage use to render READMEs?", "body": "<p>A quick <a href=\"https://github.com/haskell/hackage-server/search?utf8=%E2%9C%93&amp;q=markdown\" rel=\"noreferrer\">search through the source</a> of Hackage shows that is uses <a href=\"https://hackage.haskell.org/package/cheapskate-0.1.0.5\" rel=\"noreferrer\"><code>cheapskate</code></a> (by John MacFarlane, the author of Pandoc). Looking at the <a href=\"https://hackage.haskell.org/package/cheapskate-0.1.0.5/docs/Cheapskate-Types.html\" rel=\"noreferrer\"><code>Cheapskate.Types</code></a> you can see everything that is supported - and tables are not part of that.</p>\n\n<p>Furthermore, it appears that Hackage <a href=\"https://github.com/haskell/hackage-server/search?utf8=%E2%9C%93&amp;q=Markdown.allowRawHtml\" rel=\"noreferrer\">has the raw HTML option for rendering set to <code>False</code></a>, thereby quashing any hope one may have had of putting in a simple HTML table (which I think should also work in GitHub).</p>\n\n<p>I think the best alternative (supported by both Hackage and GitHub) is just to put your table in a code block. That way, it is at least monospace font (so columns can align). That means you enter something like</p>\n\n<pre><code>```\n| Header1 | Header2 | Header2 |\n+---------+---------+---------+\n| Cell1   | Cell2   | Cell3   |\n+---------+---------+---------+\n```\n</code></pre>\n\n<p>And it will render as</p>\n\n<pre><code>| Header1 | Header2 | Header2 |\n+---------+---------+---------+\n| Cell1   | Cell2   | Cell3   |\n+---------+---------+---------+\n</code></pre>\n"}], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 41624459, "answer_count": 1, "score": 4, "last_activity_date": 1484261890, "creation_date": 1484258819, "question_id": 41623846, "link": "https://stackoverflow.com/questions/41623846/which-dialect-of-markdown-does-hackage-use-to-render-readmes", "title": "Which dialect of Markdown does Hackage use to render READMEs?", "body": "<p>Hackage has been able to display Markdown READMEs <a href=\"https://www.well-typed.com/blog/2015/05/recent-hackage-improvements/\" rel=\"nofollow noreferrer\">for a while</a>.</p>\n\n<p>But as one can see for example on <a href=\"http://hackage.haskell.org/package/hpack-0.16.0#readme\" rel=\"nofollow noreferrer\">the Hackage page for <code>hpack</code></a>, Hackage doesn't seem to support the same table syntax as GitHub.</p>\n\n<h3>Markdown:</h3>\n\n<pre><code>#### &lt;a name=\"flags\"&gt;&lt;/a&gt;Flags\n\n| Hpack | Cabal | Default | Notes |\n| --- | --- | --- | --- |\n| `description` | `description` | | Optional |\n| `manual` | `manual` | | Required (unlike Cabal) |\n| `default` | `default` | | Required (unlike Cabal) |\n</code></pre>\n\n<h3>Rendered on GitHub:</h3>\n\n<p><a href=\"https://i.stack.imgur.com/C2uFh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/C2uFh.png\" alt=\"enter image description here\"></a></p>\n\n<h3>Rendered on Hackage:</h3>\n\n<p><a href=\"https://i.stack.imgur.com/FikK7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FikK7.png\" alt=\"enter image description here\"></a></p>\n\n<p>So, I'm wondering:</p>\n\n<ul>\n<li>Which Markdown dialect does Hackage support?</li>\n<li>Is there a syntax for tables in that dialect?</li>\n<li>Is there a syntax for tables in the subset of Markdown that is supported by both GitHub and Hackage?</li>\n</ul>\n"}, {"tags": ["haskell", "strictness"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 8, "last_activity_date": 1484256890, "creation_date": 1484256890, "answer_id": 41623389, "question_id": 41623284, "link": "https://stackoverflow.com/questions/41623284/example-of-performance-degradation-due-to-the-use-of-strict-data-constructors/41623389#41623389", "title": "Example of performance degradation due to the use of strict data constructors", "body": "<p>Forcing a value, even if it is already evaluated, has a small but existent cost.</p>\n\n<p>If you have a pointer to something that might or might not be already evaluated (a thunk or a value), and you wrap it in a lazy data constructor, you just copy that address to its place in memory. That\u2019s quick.</p>\n\n<p>If you have such a pointer and you want to store it in a strict constructor, you have to evaluate it first. This requires checking the lowest bits of the pointer for possible tags (a trick to indicate evaluatedness). If no tag is present, you actually jump to this pointer to <em>enter</em> the thunk. Before you do that, you have to push an <em>return frame</em> onto the stack so that execution flow returns to you in the end. Then the thunk evaluates itself, puts the result in a register and jumps to the return address. Then you can put this result into memory.</p>\n\n<p>So even if the thing you point to is already evaluated, you still have to do the tag check. And I believe in some cases evaluated things do not have a tag (it is optional), so all the other work might still happen \u2013 for nothing.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 41623389, "answer_count": 1, "score": 8, "last_activity_date": 1484257023, "creation_date": 1484256345, "last_edit_date": 1484257023, "question_id": 41623284, "link": "https://stackoverflow.com/questions/41623284/example-of-performance-degradation-due-to-the-use-of-strict-data-constructors", "title": "Example of performance degradation due to the use of strict data constructors", "body": "<p>I'm reading about <a href=\"https://wiki.haskell.org/Performance/Data_types#Strict_fields\" rel=\"noreferrer\">strict data constructors</a>. The linked Wiki article states that, </p>\n\n<blockquote>\n  <p>\"strictness annotations can make performance worse [because] a strictness annotation forces the compiler to ensure that the field is fully evaluated before building the constructor, and if it turns out that the field was already evaluated then this is just wasted work\". </p>\n</blockquote>\n\n<p>I do not understand why if the field was already evaluated it is wasted work, since its value is needed anyway to apply the constructor. </p>\n\n<p>Is there an example that illustrates this problem or other loses of efficiency due to strictness? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484245773, "post_id": 41620351, "comment_id": 70442203, "body": "How do you do it with pairs?"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484246787, "post_id": 41620462, "comment_id": 70442720, "body": "Side comment (maybe just musing): defining functions like <code>fst3</code>, <code>fst4</code>, <code>snd3</code>, etc always struck me as not-scalable. I&#39;d recommend just using <code>sortBy (comparing (\\(a, _, _) -&gt; a))</code>. That said, a <a href=\"https://www.stackage.org/lts-7.15/hoogle?q=%28a%2Cb%2Cc%29+-%3E+a\" rel=\"nofollow noreferrer\">quick search</a> reveals that a <i>bunch</i> of packages redefine this function. I can&#39;t help wondering which is worse: having things like <code>fst3</code> in the Prelude, or having a bunch of equivalent functions sprinkled across various package? Oh well..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1484249643, "post_id": 41620462, "comment_id": 70444253, "body": "The only thing <code>fst3</code> gets you is stable ordering when the first elements are identical. The default ordering for 3-tuples already sorts for <code>a</code> first, then <code>b</code> when necessary, and finally <code>c</code> if necessary."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1484249865, "post_id": 41620462, "comment_id": 70444384, "body": "@chepner It also gets you the ability to sort things where the second or third elements don&#39;t support Ord."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 5, "last_activity_date": 1484245911, "creation_date": 1484245911, "answer_id": 41620462, "question_id": 41620351, "link": "https://stackoverflow.com/questions/41620351/haskell-sorting-trios-only-by-first-field/41620462#41620462", "title": "Haskell, sorting trios only by first field", "body": "<p>If you defined a <code>fst</code>-like function for a tuple of size three:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>fst3 :: (a, b, c) -&gt; a\nfst3 (a, _, _) = a\n</code></pre>\n\n<p>then you can use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Ord.html#v:comparing\" rel=\"nofollow noreferrer\"><code>comparing</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List\nimport Data.Ord\n\nsortByFst3 :: Ord a =&gt; [(a, b, c)] -&gt; [(a, b, c)]\nsortByFst3 = sortBy (comparing fst3)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": false, "score": 0, "last_activity_date": 1484291133, "last_edit_date": 1484291133, "creation_date": 1484290703, "answer_id": 41629011, "question_id": 41620351, "link": "https://stackoverflow.com/questions/41620351/haskell-sorting-trios-only-by-first-field/41629011#41629011", "title": "Haskell, sorting trios only by first field", "body": "<p>Since <a href=\"https://www.stackage.org/package/base\" rel=\"nofollow noreferrer\">base</a> 4.8.0, there is Data.List.<a href=\"https://www.stackage.org/haddock/lts-7.15/base-4.9.0.0/Data-List.html#v:sortOn\" rel=\"nofollow noreferrer\">sortOn</a></p>\n\n<pre><code>import Data.List\n\nlst = [(3,1,2), (2,1,3), (1,3,2)]\n\nmain = do\n  let srt = sortOn (\\(a,_,_) -&gt; a) lst\n  print $ srt\n</code></pre>\n\n<p>yield</p>\n\n<pre><code>[(1,3,2),(2,1,3),(3,1,2)] \n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7361363"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 41620462, "answer_count": 2, "score": 0, "last_activity_date": 1484291133, "creation_date": 1484245524, "last_edit_date": 1484246024, "question_id": 41620351, "link": "https://stackoverflow.com/questions/41620351/haskell-sorting-trios-only-by-first-field", "title": "Haskell, sorting trios only by first field", "body": "<p>I have a list of elements of <code>(Int, Int, Int)</code>.<br>\nHow to sort this list only by first element ?<br>\nWith pairs I can deal, but with three elements I have a problem</p>\n"}, {"tags": ["haskell", "set", "intersection"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1484243969, "post_id": 41619756, "comment_id": 70441257, "body": "I think your conclusion (&quot;<code>Data.Set.intersection</code> is the largest cost center&quot;) is not supported by your data, which says only that <code>check.removecandidates</code> is the largest cost center. Is it possible to do everything in terms of sets, so that you aren&#39;t converting back and forth between <code>Set</code> and <code>[]</code> in your inner loop?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1484245409, "post_id": 41619756, "comment_id": 70442023, "body": "For lists with fewer than 5 elements, I would expect list intersection to outperform converting to a Set, using Set intersection, and converting back to a list."}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 1, "creation_date": 1484256925, "post_id": 41619756, "comment_id": 70448238, "body": "I tried to help, but I was unable to really figure out what the code is supposed to be doing.  Maybe fill in the types and provide something that is runnable?"}, {"owner": {"reputation": 111, "user_id": 4586632, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1ef8a257abcede4daee9fba747dad5cc?s=128&d=identicon&r=PG&f=1", "display_name": "brander", "link": "https://stackoverflow.com/users/4586632/brander"}, "edited": false, "score": 0, "creation_date": 1484310478, "post_id": 41619756, "comment_id": 70468891, "body": "Thanks. I&#39;ve added a few clarification comments above.  Also adding fully executable code"}], "owner": {"reputation": 111, "user_id": 4586632, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1ef8a257abcede4daee9fba747dad5cc?s=128&d=identicon&r=PG&f=1", "display_name": "brander", "link": "https://stackoverflow.com/users/4586632/brander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484310905, "creation_date": 1484243264, "last_edit_date": 1484310905, "question_id": 41619756, "link": "https://stackoverflow.com/questions/41619756/intersect-vs-data-set-intersection-runtime", "title": "Intersect vs Data.Set Intersection Runtime", "body": "<p>Based on another thread here on stackExchange, I tried to improve the runtime of a repeated intersection using Data.Set.intersection rather than Prelude's intersect on a short list of integers ( &lt;5 elements each).  Trying a simple example in the GHCI console I saw a significant performance difference:\n<code>intersect [1..10000] [5000..200000] \n(16.04 secs, 21919236 bytes)</code></p>\n\n<p>while </p>\n\n<pre><code>S.intersection (S.fromList [1..10000]) (S.fromList [5000..200000])\n(0.25 secs, 125337020 bytes)\n</code></pre>\n\n<p>I hoped to revise my algorithm and experience a similar miracle performance boost intersecting small lists of integers:</p>\n\n<pre><code>--Check takes a list of integers and then checks if another integer n is\n--\"swappable\"  Swappable integers are two integers that, when concatenated, are prime. Any new sets created with n are returned\ncheck ::[[Integer]] -&gt; Integer -&gt; [[Integer]]\ncheck [] n = [[n]]\ncheck (x:xs) n\n         |nonswappable == [] = (x++[n]):(check xs (n))\n         |otherwise  = (check (removecandidates xs) n)\n         where\n             --nonswappable returns null if the input n isswappable with everything\n             --isswappable:: Integer-&gt;Integer-&gt;Bool This function concatenates two numbers and checks if they are prime.\n             nonswappable = snd(partition (isswappable n) x)\n             --removecandidates strikes out candidate lists in the list containing a nonswappable number in the set just checked\n             removecandidates list = filter ((==[]).(intersect nonswappable))  list\n</code></pre>\n\n<p>relevant profiler details:</p>\n\n<pre><code>    total time  =        5.30 secs   (5304 ticks @ 1000 us, 1 processor)\n    total alloc = 2,676,617,968 bytes  (excludes profiling overheads)\n\nCOST CENTRE             MODULE  %time %alloc\n\npowm                    Main     29.3   36.2\nisswappable             Main     26.3   25.3\ncheck.removecandidates  Main     15.9   18.5\nprobmrisPrime.randomAs  Main      6.9    3.8\n\n\n\n                                                                               individual     inherited\nCOST CENTRE                       MODULE                     no.     entries  %time %alloc   %time %alloc\n\n  primes                          Main                       110           1    0.0    0.0     0.2    0.5\n   sieve                          Main                       111         573    0.2    0.5     0.2    0.5\n  findsets                        Main                       104           1    0.0    0.0    99.8   99.5\n   sets                           Main                       105         571    0.2    0.2    99.8   99.5\n    check                         Main                       106       55704    0.2    0.1    99.6   99.3\n     check.removecandidates       Main                       126       52920   15.9   18.5    15.9   18.5\n     check.nonswappable           Main                       107       55135    0.4    0.2    83.5   80.7\n</code></pre>\n\n<p>Changing in what I expected would be similar to above using Data.Set: </p>\n\n<pre><code>--Check takes a list of integers and then checks if another integer n is\n--\"swappable\"  Swappable integers are two integers that, when concatenated, are prime. Any new sets created with n are returned\n    check ::[[Integer]] -&gt; Integer -&gt; [[Integer]]\n\ncheck [] n = [[n]]\ncheck (x:xs) n\n         |nonswappable == [] = (x++[n]):(check xs (n))\n         |otherwise  = (check (removecandidates xs) n)\n         where\n               --nonswappable returns null if the input n is swappable with everything\n               --isswappable:: Integer-&gt;Integer-&gt;Bool This function concatenates two numbers and checks if they are prime.\n              nonswappable = snd(partition (isswappable n) x)\n               --removecandidates strikes out candate lists in the list containing a nonswappable number in the set just checked\n              removecandidates list = filter ((==[]).(S.toList.S.intersection setnonswappable.setx))  list\n                  where\n                     setnonswappable = S.fromList nonswappable\n                     setx lst = S.fromList lst\n</code></pre>\n\n<p>related profiler details:</p>\n\n<pre><code>total time  =        7.36 secs   (7361 ticks @ 1000 us, 1 processor)\ntotal alloc = 3,019,801,528 bytes  (excludes profiling overheads)\n\nCOST CENTRE                 MODULE  %time %alloc\n\ncheck.removecandidates      Main     30.7   21.8\npowm                        Main     21.6   32.1\nisswappable                 Main     20.6   22.4\ncheck.removecandidates.setx Main      6.8    5.9\nprobmrisPrime.randomAs      Main      4.9    3.4\n\n\n\n        individual     inherited\n    COST CENTRE                                  MODULE                     no.     entries  %time %alloc   %time %alloc\n\n    MAIN                                         MAIN                                     63           0    0.0    0.0     \n      primes                                     Main                       112           1    0.0    0.0     0.3    0.4\n       sieve                                     Main                       113         573    0.3    0.4     0.3    0.4\n      findsets                                   Main                       106           1    0.0    0.0    99.7   99.6\n       sets                                      Main                       107         571    0.3    0.2    99.7   99.6\n        check                                    Main                       108       55704    0.2    0.1    99.4   99.4\n         check.removecandidates                  Main                       128       52920   30.7   21.8    37.5   27.8\n          check.removecandidates.setx            Main                       130     4949177    6.8    5.9     6.8    5.9\n          check.removecandidates.setnonswappable Main                       129       52446    0.0    0.0     0.0    0.0\n</code></pre>\n\n<p>the performance was degraded to the extent that the function(check.removecandidates) calling Data.Set.intersection moved up to the largest cost-center!  What advice can you provide to pinpoint the severe performance issues. Also, is there a completely different approach to more efficiently test the intersection of many small integer lists.</p>\n\n<p>Per comments, also adding fully executable code with all the relevant functions. </p>\n\n<pre><code>module Main where\n\nimport Data.List\nimport System.Random\nimport qualified Data.Set as S\n\nprimes::[Integer]\nprimes = sieve (2:[3,5..])\nsieve []=[]\nsieve (x:xs) = x:sieve[y|y&lt;-xs, (y `rem` x)/=0]\n\n\n--isswappabble using probablistic prime\nisswappable:: Integer-&gt;Integer-&gt;Bool\nisswappable x y =  (probmrisPrime 3 (read ((show x) ++ (show y))) == \"prob prime\") &amp;&amp;\n                        ((probmrisPrime 3 (read ((show y) ++ (show x))) == \"prob prime\"))\n\n\n\n--miller rabine probablistic prime test\n--Input: n &gt; 3, an odd integer to be tested for primality;\n--Input: k, a parameter that determines the accuracy of the test\n--random seed for miller-rabine test\nmygen = mkStdGen 32123432141312332130\n\nprobmrisPrime k n\n    | n `mod` 2 == 0 = \"composite\"\n    |otherwise = witnessloop n randomAs\n    where randomAs = take k (randomRs (2, (n-2)) (mygen))::[Integer]\n\nwitnessloop _ [] = \"prob prime\"\nwitnessloop n (hd:lst)\n    | x == 1 || x==n-1 = witnessloop n (lst)\n    | otherwise = checks (s-1) x\n    where x = powm hd d n 1\n          d = millerrabined n\n          s = millerrabines n\n          checks 0 _ = \"composite\"\n          checks s x\n            | newx == 1 = \"composite\"\n            | newx == n-1 = witnessloop n (lst)\n            | otherwise = checks (s-1) newx\n            where newx = (x^2) `mod` n\n\nmillerrabines num=factor2 (num-1)\nmillerrabined num=quot (num-1) (2^(millerrabines num))\n\nfactor2 num\n    | num `rem` 2 ==0 = 1 + factor2 (quot num 2)\n    | otherwise = 0\n\npowm :: Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer\npowm b 0 m r = r\npowm b e m r | e `mod` 2 == 1 = powm (b * b `mod` m) (e `div` 2) m (r * b `mod` m)\npowm b e m r = powm (b * b `mod` m) (e `div` 2) m r\n\n\n\n\nsets :: Int-&gt;[[Integer]]\n--sets 1 = [[3]]\n--checks all the previous sets with the next prime number and appends any new sets with n to the list\nsets 2 = [[3]]\n--start with prime == 7 since any prime with 5 will always divide by 5\nsets n = check (take (n-2) findsets) (primes!!n)\ncheck [] n = [[n]]\ncheck (x:xs) n\n         |nonswappable == [] = (x++[n]):(check xs (n))\n         |otherwise  = (check (removecandidates xs) n)\n         where\n         --returns null if the input n is swappable with everything\n               nonswappable = snd(partition (isswappable n) x)\n               removecandidates list = [x| x&lt;-list, intersect nonswappable x == [] ]\n         {-replacement logic using Data.Set\n              removecandidates list = filter ((==[]).(intersect nonswappable))  list\n              removecandidates list = filter ((==[]).(S.toList.S.intersection setnonswappable.setx))  list\n                  where\n                     setnonswappable = S.fromList nonswappable--                     \n                     setx lst = S.fromList lst -}\n\n--generate all the sets\nfindsets= concat(map sets [2..])\n\n--find sets of certain length\nfindGroups list len = [x| x&lt;-list, length x &gt;= len]\n\nmain = do\n      putStrLn $ show ( take 1 (findGroups (findsets) 5))\n</code></pre>\n"}, {"tags": ["haskell", "numbers", "sequence"], "answers": [{"tags": [], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "is_accepted": false, "score": 0, "last_activity_date": 1484242441, "creation_date": 1484242441, "answer_id": 41619525, "question_id": 41618440, "link": "https://stackoverflow.com/questions/41618440/matching-number-sequences-in-haskell/41619525#41619525", "title": "Matching Number sequences in haskell", "body": "<p>Got it.. almost</p>\n\n<pre><code>seq :: [Int]-&gt;[Int]\nseq (x:xs) if (mod x 5 == 0 || mod x 7 == 0 || mod x 9 == 0) then (x: seq xs) \n     else (seq xs)\n</code></pre>\n\n<p>but stll you have to input the list of the natural numbers for it to work. Is it possible without any input?</p>\n"}, {"tags": [], "owner": {"reputation": 5896, "user_id": 5644961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-r4jx_ltcdtA/AAAAAAAAAAI/AAAAAAAAAAA/7RjDfLKZHxg/photo.jpg?sz=128", "display_name": "Copperfield", "link": "https://stackoverflow.com/users/5644961/copperfield"}, "is_accepted": true, "score": 1, "last_activity_date": 1484266763, "last_edit_date": 1484266763, "creation_date": 1484245798, "answer_id": 41620439, "question_id": 41618440, "link": "https://stackoverflow.com/questions/41618440/matching-number-sequences-in-haskell/41620439#41620439", "title": "Matching Number sequences in haskell", "body": "<p>how about this</p>\n\n<pre><code>multiples_of_any_of :: [Int] -&gt; [Int] \nmultiples_of_any_of base = filter (\\x -&gt; any (\\b -&gt; 0 == mod x b) base ) [1..]\n\nanswer::[Int]    \nanswer = multiples_of_any_of [5,7,9]    \n</code></pre>\n\n<p>I leave the main function in a general form so it can be used to get any combination of multiples of numbers, not just <code>[5,7,9]</code>, and as part of its definition it include a supply of natural numbers in the form of <code>[1..]</code>. Finally the answer is as simple as show above</p>\n\n<p>examples</p>\n\n<pre><code>*Main&gt; take 30 answer \n[5,7,9,10,14,15,18,20,21,25,27,28,30,35,36,40,42,45,49,50,54,55,56,60,63,65,70,72,75,77]\n(0.00 secs, 0 bytes)\n*Main&gt; \n*Main&gt; take 10 (multiples_of_any_of [5,13,23])\n[5,10,13,15,20,23,25,26,30,35]\n(0.00 secs, 933980 bytes)\n*Main&gt; \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "is_accepted": false, "score": 0, "last_activity_date": 1484284008, "creation_date": 1484284008, "answer_id": 41627720, "question_id": 41618440, "link": "https://stackoverflow.com/questions/41618440/matching-number-sequences-in-haskell/41627720#41627720", "title": "Matching Number sequences in haskell", "body": "<p>The previous answers are much better, but here's a brute-force approach that follows your line of thinking.</p>\n\n<pre><code>merge :: [[Integer]] -&gt; [Integer]\nmerge all@[(a:as), (b:bs), (c:cs)] = let min = minimum [a, b, c]\n    in min : (merge (map (dropMin min) all))\n    where dropMin m (x:xs)\n            | x == m    = xs\n            | otherwise = (x:xs)\n\n&gt; take 15 $ merge [[5, 10 .. ], [7, 14 ..], [9, 18 ..]] \n[5,7,9,10,14,15,18,20,21,25,27,28,30,35,36]\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 41620439, "answer_count": 3, "score": 1, "last_activity_date": 1484284008, "creation_date": 1484238994, "last_edit_date": 1484267695, "question_id": 41618440, "link": "https://stackoverflow.com/questions/41618440/matching-number-sequences-in-haskell", "title": "Matching Number sequences in haskell", "body": "<p>my task is to match the number sequences of the numbers 5,7 and 9 in a list in Haskell. The list must be infinite, so that the following is possible:</p>\n\n<p>take 10 seq\n[5,7,9,10,14,15,18,20,21,25]</p>\n\n<p>I already figured out how to create an infinite sequence list of a single number:</p>\n\n<pre><code>    sevens :: [Int]\n    sevens = sevens : (map (+7) sevens)\n</code></pre>\n\n<p>This works but how do I do this with multiple numbers (5,7 and 9 in this case)?</p>\n\n<p>Thanks for your help :)</p>\n"}, {"tags": ["file", "haskell", "types"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 5, "creation_date": 1484243013, "post_id": 41617446, "comment_id": 70440707, "body": "So what is your question? Do you need a recommendation on what parser library to use? That&#39;s the sort of question generally answerable by google and something stackoverflow discourages. Do you need help with a particular parsing technique? If so, please include the details in your question. As for dynamically defining types, that&#39;s not something that Haskell does. There are ways to describing generic types, but you end up with a value representing what the type would be if it were compiled, not a type itself. Your best bet would probably be to generate a Haskell file that is then compiled."}, {"owner": {"reputation": 127, "user_id": 4092894, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2146b59eb3906df67f0d1b5c327af46d?s=128&d=identicon&r=PG&f=1", "display_name": "Teo ", "link": "https://stackoverflow.com/users/4092894/teo"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1484257425, "post_id": 41617446, "comment_id": 70448510, "body": "I just do not know how to start...I was thinking about using some shell script at first and generate the haskell file using the shell."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1484257650, "post_id": 41617446, "comment_id": 70448619, "body": "If you want to solve this problem with Haskell I would recommend starting with the parsec library.  It&#39;s a bit different for parsing text than what you&#39;re probably used to, but there&#39;s a lot of tutorials out there for how to use it, and it&#39;s really quite easy to use once you learn a few basics.  After that you can pretty simply produce your desired output.  Just follow the program flow &quot;Get Input -&gt; Parse Input to Internal Representation -&gt; Manipulate Internal Representation -&gt; Generate Output -&gt; Save Output To Disk&quot;.  That way only the first and last steps should need IO."}, {"owner": {"reputation": 127, "user_id": 4092894, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2146b59eb3906df67f0d1b5c327af46d?s=128&d=identicon&r=PG&f=1", "display_name": "Teo ", "link": "https://stackoverflow.com/users/4092894/teo"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1484258274, "post_id": 41617446, "comment_id": 70448899, "body": "Can you provide some links to good tutorials?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1484258460, "post_id": 41617446, "comment_id": 70448991, "body": "I&#39;d start with the website: <a href=\"https://github.com/aslatter/parsec\" rel=\"nofollow noreferrer\">github.com/aslatter/parsec</a>."}, {"owner": {"reputation": 127, "user_id": 4092894, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2146b59eb3906df67f0d1b5c327af46d?s=128&d=identicon&r=PG&f=1", "display_name": "Teo ", "link": "https://stackoverflow.com/users/4092894/teo"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1484258859, "post_id": 41617446, "comment_id": 70449163, "body": "Do you actually find my idea to make a shell script better ? I don&#39;t really have much experience with haskell."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 127, "user_id": 4092894, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2146b59eb3906df67f0d1b5c327af46d?s=128&d=identicon&r=PG&f=1", "display_name": "Teo ", "link": "https://stackoverflow.com/users/4092894/teo"}, "edited": false, "score": 0, "creation_date": 1484258934, "post_id": 41617446, "comment_id": 70449200, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/133038/discussion-between-bheklilr-and-teo\">continue this discussion in chat</a>."}], "owner": {"reputation": 127, "user_id": 4092894, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2146b59eb3906df67f0d1b5c327af46d?s=128&d=identicon&r=PG&f=1", "display_name": "Teo ", "link": "https://stackoverflow.com/users/4092894/teo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 251, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1484236169, "creation_date": 1484236169, "question_id": 41617446, "link": "https://stackoverflow.com/questions/41617446/haskell-how-to-extract-data-types-and-function-definitions-from-a-text-file", "title": "Haskell - how to extract data types and function definitions from a text file?", "body": "<p>I am stuck with an assignment I have to do for my own haskell project.\nI have a .txt file, the structure of which looks like this:</p>\n\n<pre><code>types{\ntype1\ntype2\n}\n\ntype1{\nsub11\nsub12\n}\n\ntype2{\nsub21\nsub22\n}\n\ngenerate{\ntype1-&gt;type2\ntype2-&gt;type1\n}\n</code></pre>\n\n<p>Now, I need to take the strings before each \"{\" and make them to a Data Type.\nSo, in this case :</p>\n\n<pre><code> Data Types = Type1 | Type2\n Data Type1 = Sub11 | Sub12\n Data Type2 = Sub21 | Sub22\n</code></pre>\n\n<p>Between the last pair of brackets \"{}\"  are defined the functions like this:</p>\n\n<pre><code> blob::Type1 -&gt; Type2 -&gt; String\n bar :: Type2 -&gt; Type1 -&gt; String\n</code></pre>\n\n<p>The blob and bar  functions must take all possible subtypes of Type1 and Type2 and build the cartesian product.\nSo, in this case the result of blob would be:(sub11,sub21),(sub11,sub22),(sub12,sub21),(sub12,sub22)</p>\n\n<p>I know how to read a file in haskell with the readFile function which returns the file content as a string. What I do not know is how to parse the text from the text file and define the types and functions dinamically.</p>\n"}, {"tags": ["javascript", "node.js", "haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484243641, "post_id": 41616853, "comment_id": 70441070, "body": "Compile using GHCJS?"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1484243899, "post_id": 41616853, "comment_id": 70441218, "body": "<a href=\"https://nodejs.org/api/child_process.html\" rel=\"nofollow noreferrer\">nodejs.org/api/child_process.html</a> ?"}, {"owner": {"reputation": 391, "user_id": 480146, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfe2f5f477cb68954d1aed04194485f1?s=128&d=identicon&r=PG", "display_name": "agreif", "link": "https://stackoverflow.com/users/480146/agreif"}, "edited": false, "score": 0, "creation_date": 1507189663, "post_id": 41616853, "comment_id": 80113679, "body": "<a href=\"https://github.com/nh2/call-haskell-from-anything\" rel=\"nofollow noreferrer\">github.com/nh2/call-haskell-from-anything</a>"}], "owner": {"reputation": 216, "user_id": 2469967, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/jy0ME.png?s=128&g=1", "display_name": "Debjit", "link": "https://stackoverflow.com/users/2469967/debjit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 379, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1484234575, "creation_date": 1484234575, "question_id": 41616853, "link": "https://stackoverflow.com/questions/41616853/embed-haskell-in-node-js", "title": "Embed Haskell in Node.js", "body": "<p>I am writing a Node.js service that uses various utilities from the Node ecosystem, but the core part of the logic needs to generate a JavaScript AST (ESTree) from some given JSON configuration. It will also include reading various JS files and combining them if required. I am designing the code generation part by defining a domain specific grammar.</p>\n\n<p>The Haskell code will return a ESTree AST which Node.js will convert to JS code using some existing utility.</p>\n\n<p>I am looking for a good way to call Haskell code from Node.js to achieve this.</p>\n"}, {"tags": ["haskell", "monads", "yesod"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1484231572, "post_id": 41615532, "comment_id": 70432740, "body": "Probable duplicate of <a href=\"http://stackoverflow.com/questions/1675366/a-haskell-function-of-type-io-string-string\" title=\"a haskell function of type io string string\">stackoverflow.com/questions/1675366/&hellip;</a>"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 2, "creation_date": 1484231579, "post_id": 41615532, "comment_id": 70432743, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/1675366/a-haskell-function-of-type-io-string-string\">A Haskell function of type: IO String-&gt; String</a>"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1484232336, "post_id": 41615532, "comment_id": 70433287, "body": "The error you see is because <code>fmap toHtml $ getListOfFiles &quot;&#47;home&#47;chetan&quot;</code> has type <code>IO (MarkupM ())</code>, since <code>type Html = MarkupM ()</code> in the blaze-html library.  However, the <code>H.p</code> function has type <code>Html -&gt; Html</code>, so it takes a <code>MarkupM ()</code> and returns a new <code>MarkupM ()</code>.  You&#39;re giving it a <code>IO (MarkupM ())</code>, so the compiler complains.  You&#39;ll have to do the <code>getListOfFiles</code> outside of your blaze code."}], "answers": [{"comments": [{"owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484232736, "post_id": 41615820, "comment_id": 70433574, "body": "Thanks. H.p does not work on [Html]. It works on Html only. I am getting the related error which mentions it. Any idea how I could fix it"}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "reply_to_user": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "edited": false, "score": 0, "creation_date": 1484233121, "post_id": 41615820, "comment_id": 70433838, "body": "That depends on you - you have a list of files and want to convert it to html. The function <code>toHtml</code> converts e.g. a <code>String</code> to html, so e.g. in this example I have concatenated the strings together. Import the <code>interacalate</code> from <code>Data.List</code>."}], "tags": [], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "is_accepted": true, "score": 3, "last_activity_date": 1484233045, "last_edit_date": 1484233045, "creation_date": 1484231772, "answer_id": 41615820, "question_id": 41615532, "link": "https://stackoverflow.com/questions/41615532/convert-a-monadic-value-to-non-monadic/41615820#41615820", "title": "Convert a Monadic value to Non-monadic", "body": "<p>I'm not well versed in Yesod, but this should work.</p>\n\n<p>You cannot convert an <code>IO</code> value to non-IO value. However, you can work with these values, while staying in <code>IO</code>. To say it somewhat incorrectly, you can work with these values while being inside IO. I.e. this should work (not-tested):</p>\n\n<pre><code>getTestHamletR = do\n    files &lt;- liftIO $ getListOfFiles \"/home/chtan\"\n    defaultLayout $ do\n        setTitle \"Test Hamlet\"\n        toWidget $ \\render -&gt; do\n           H.p $ toHtml (intercalate \", \" files)\n</code></pre>\n\n<p>I guess that <code>getTestHamletR</code> is not directly <code>IO</code>, but it is some layer above <code>IO</code>, so we can use <code>liftIO</code> to convert the <code>IO [FilePath]</code> to <code>m [FilePath]</code> where <code>m</code> is the Monad yesod uses. </p>\n\n<p>The <code>getTestHamletR</code> is an <code>IO</code> function - every line works inside <code>IO</code>, you get the directory contents as <code>IO [FilePath]</code> and you essentially convert it to <code>IO Html</code>.</p>\n"}], "owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 41615820, "answer_count": 1, "score": 0, "last_activity_date": 1484233045, "creation_date": 1484230925, "question_id": 41615532, "link": "https://stackoverflow.com/questions/41615532/convert-a-monadic-value-to-non-monadic", "title": "Convert a Monadic value to Non-monadic", "body": "<p>I am new to Haskell.\nI need to read the contents from a directory (i.e list all the files in the directory) and convert it to HTML.\nI have a codebase which uses the Yesod framework.</p>\n\n<p>Now, I was able to read the directory contents using <code>getDirectoryContents</code> which returns type of <code>IO [FilePath]</code>. I want to be able to represent this in HTML.</p>\n\n<p>Can someone help me on this? So far this is what I have tried. \nThe error that I get is:\n<code>Couldn't match type \u2018IO\u2019 with \u2018Text.Blaze.Internal.MarkupM\u2019\n      Expected type: Text.Blaze.Internal.MarkupM Html\n        Actual type: IO Html\n</code></p>\n\n<p>Please check the code below:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE QuasiQuotes           #-}\n{-# LANGUAGE TemplateHaskell       #-}\n{-# LANGUAGE TypeFamilies          #-}\n\nimport Yesod.Core\nimport Text.Blaze.Html (toValue, (!))\nimport qualified Text.Blaze.Html5 as H\nimport qualified Text.Blaze.Html5.Attributes as HA\nimport System.Directory as FS\n\n\n\ngetTestHamletR = defaultLayout $ do\n    setTitle \"Test Hamlet\"\n    toWidget $ \\render -&gt; do\n           H.p $ do\n                result &lt;- fmap toHtml $ getListOfFiles \"/home/chetan\"\n                result\n</code></pre>\n\n<p>Here is the <code>getListOfFiles</code> function:</p>\n\n<pre><code>getListOfFiles::FilePath -&gt; IO [FilePath]\ngetListOfFiles fpath = FS.getDirectoryContents fpath\n</code></pre>\n"}, {"tags": ["haskell", "monads", "category-theory"], "comments": [{"owner": {"reputation": 797, "user_id": 2799055, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/94df8a6bb7ee4d9b77adb8ab4f381422?s=128&d=identicon&r=PG&f=1", "display_name": "azaviruha", "link": "https://stackoverflow.com/users/2799055/azaviruha"}, "reply_to_user": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 0, "creation_date": 1484223539, "post_id": 41612919, "comment_id": 70427299, "body": "It&#39;s from &quot;Haskell/Categry theory&quot;: &quot;The main category we&#39;ll be concerning ourselves with in this article is Hask, which treats Haskell types as objects and Haskell functions as morphisms ...&quot;"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1484223790, "post_id": 41612919, "comment_id": 70427463, "body": "The <code>M : C -&gt; C</code> corresponds to <code>m</code> in <code>class Monad m where ..</code> , and <code>C</code> is the category <code>Hask</code>, but in the context <code>.. : C -&gt; C</code>, <code>C</code> is referring to an object of <code>C</code>, which in this case is a type. I suppose it is &#39;more correct&#39; to write <code>M : Obj(C) -&gt; Obj(C)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1484225283, "creation_date": 1484225283, "answer_id": 41613647, "question_id": 41612919, "link": "https://stackoverflow.com/questions/41612919/are-all-monad-instances-in-haskell-just-different-ways-for-mapping-from-hask-to/41613647#41613647", "title": "Are all Monad instances in Haskell just different ways for mapping from Hask to Hask?", "body": "<p>A monad is, by definition, an endofunctor. The typeclass <code>Functor</code> is really represents endofunctors, as instances of <code>Functor</code> are defined for type constructors, which are type-level functions which take a type and return a new type (that is, they have kind <code>* -&gt; *</code>).</p>\n\n<p><code>return :: Monad m =&gt; a -&gt; m a</code>, so it is not surprising that <code>return</code> can take a value of type <code>Int</code> and return a value of type <code>[Int]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 797, "user_id": 2799055, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/94df8a6bb7ee4d9b77adb8ab4f381422?s=128&d=identicon&r=PG&f=1", "display_name": "azaviruha", "link": "https://stackoverflow.com/users/2799055/azaviruha"}, "edited": false, "score": 0, "creation_date": 1484226113, "post_id": 41613656, "comment_id": 70428993, "body": "Thank you, your answer is very helpful!"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 7, "last_activity_date": 1484225298, "creation_date": 1484225298, "answer_id": 41613656, "question_id": 41612919, "link": "https://stackoverflow.com/questions/41612919/are-all-monad-instances-in-haskell-just-different-ways-for-mapping-from-hask-to/41613656#41613656", "title": "Are all Monad instances in Haskell just different ways for mapping from Hask to Hask?", "body": "<p>This is a common point of confusion and you've asked the question clearly enough for it to be answerable.</p>\n\n<blockquote>\n  <p>I'm not sure that \"<em>functor from category to it's subcategory</em>\" is the same as \"<em>functor from category to the same category</em>\".</p>\n</blockquote>\n\n<p>It's not the same. A functor consists of four pieces of data: a source category C, a target category D, a mapping of objects of C to objects of D, and a mapping of morphisms of C to morphisms of D, satisfying some conditions. If you change D, then you change the functor.</p>\n\n<p>However when we define a functor, we often have some choice in the category D. I infer from your question that <code>Lst</code> is a subcategory of <code>Hask</code> whose objects are types of the form <code>[a]</code>, though I'm not sure what the morphisms of <code>Lst</code> are supposed to be. We could define a functor <code>[]</code> of either of these two shapes:</p>\n\n<ol>\n<li><p><code>[]</code> : <code>Hask</code> -> <code>Lst</code> (i.e., the target category of <code>[]</code> is <code>Lst</code>)</p></li>\n<li><p><code>[]</code> : <code>Hask</code> -> <code>Hask</code> (i.e., the target category of <code>[]</code> is <code>Hask</code>)</p></li>\n</ol>\n\n<p>These are technically different functors, and we have to make a choice. In this context, the correct choice is choice 2. We need the source and target categories to be the same because we need to apply <code>[]</code> to the output of <code>[]</code>, in <code>join</code>. So <strong>C</strong> = <code>Hask</code> and <strong>M</strong> = <code>[]</code>.</p>\n\n<p>In general, it turns out to rarely be useful to consider categories like <code>Lst</code> that are defined as the image of some type constructor. I'm not sure where this (very common) idea comes from. I recommend you set aside the idea of \"the category <code>Lst</code>\". Just one category is enough for now!</p>\n\n<p>For an analogy consider the function that squares a real number f(x) = x^2. We can view this as a function f : R -> R from the real numbers to the real numbers, even though it so happens that f(x) only takes on nonnegative real values. The target of f does not have to be equal to the image of f (the values that are actually attained by f on its input values).</p>\n"}], "owner": {"reputation": 797, "user_id": 2799055, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/94df8a6bb7ee4d9b77adb8ab4f381422?s=128&d=identicon&r=PG&f=1", "display_name": "azaviruha", "link": "https://stackoverflow.com/users/2799055/azaviruha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 41613656, "answer_count": 2, "score": 3, "last_activity_date": 1484230061, "creation_date": 1484223059, "last_edit_date": 1592644375, "question_id": 41612919, "link": "https://stackoverflow.com/questions/41612919/are-all-monad-instances-in-haskell-just-different-ways-for-mapping-from-hask-to", "title": "Are all Monad instances in Haskell just different ways for mapping from Hask to Hask?", "body": "<p>I'm reading <a href=\"https://en.wikibooks.org/wiki/Haskell/Category_theory\" rel=\"nofollow noreferrer\">Haskell/Category theory</a> and here is the <a href=\"https://en.wikibooks.org/wiki/Haskell/Category_theory#Monads\" rel=\"nofollow noreferrer\">definition of monad</a> from that article:</p>\n<blockquote>\n<p>A monad is a special type of functor, from a category to that same\ncategory, that supports some additional structure. So, down to\ndefinitions. A monad is a functor <em><strong>M:C-&gt;C</strong></em>, along with two\nmorphisms for every <strong>object X in C</strong>:</p>\n<p>unit: X -&gt; M(X)</p>\n<p>join: M(M(X)) -&gt; M(X)</p>\n</blockquote>\n<p>As I understand it, in Haskell <code>return</code> is equivalent to <code>unit</code>. But with <code>return</code> I can write:</p>\n<pre><code>x :: [Int]  -- x is a member of Lst category\nx = return 5\n</code></pre>\n<p>and this is valid code in Haskell.\nNow, as you can see, <code>5</code> here is not a member of <code>Lst</code>, but <code>return</code> works for it.</p>\n<p>So, I guess that <code>Lst</code> is not <strong>\u0421</strong> from <strong>M:C-&gt;C</strong>. But who then?</p>\n<p>Maybe the right answer is <code>Hask</code>, but I'm not sure that &quot;<em>functor from a category to its subcategory</em>&quot; is the same as &quot;<em>functor from a category to the same category</em>&quot;.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1484225470, "post_id": 41609353, "comment_id": 70428569, "body": "if you add a type signature to <code>f</code> (maybe <code>[Int] -&gt; [Int] -&gt; Int -&gt; (Int, Int)</code>) then you&#39;ll help the compiler understand which part of your program is wrong, and you&#39;ll probably get a more helpful error."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 7, "last_activity_date": 1484214373, "last_edit_date": 1484214373, "creation_date": 1484214047, "answer_id": 41609674, "question_id": 41609353, "link": "https://stackoverflow.com/questions/41609353/haskell-error-non-type-variable-argument-in-the-constraint-num-c/41609674#41609674", "title": "Haskell error Non type-variable argument in the constraint: Num [c]", "body": "<p>Because you use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:foldl\" rel=\"noreferrer\"><code>foldl</code></a> probably the wrong way. <code>foldl</code> has as signature:</p>\n\n<pre><code>Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>So you feed it a function (here <code>(+)</code>) an initial value and a sequence of values. You can probably fix your code with:</p>\n\n<pre>\nmodule Asig1 where\n\nf as ys x = (s,z)\n       where\n       ws = zipWith (*) as ys\n<b>       s = foldl (+) x ws</b> --instead of foldl (+) ws x\n       z = s\n</pre>\n\n<p>You can further improve your code because <code>z = s</code> is not necessary:</p>\n\n<pre>\nmodule Asig1 where\n\nf as ys x = (s,<b>s</b>)\n       where\n       ws = zipWith (*) as ys\n       s = foldl (+) x ws --instead of foldl (+) ws x\n</pre>\n"}], "owner": {"reputation": 131, "user_id": 6439248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1af81865511e746630f6ab412edd6279?s=128&d=identicon&r=PG&f=1", "display_name": "nourdin", "link": "https://stackoverflow.com/users/6439248/nourdin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2000, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1484241416, "creation_date": 1484213169, "last_edit_date": 1484241416, "question_id": 41609353, "link": "https://stackoverflow.com/questions/41609353/haskell-error-non-type-variable-argument-in-the-constraint-num-c", "title": "Haskell error Non type-variable argument in the constraint: Num [c]", "body": "<p>When i try to load my code using ghci it gives me this error:</p>\n\n<pre><code>Asig1.hs:4:1:\n    Non type-variable argument in the constraint: Num [c]\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018f\u2019 has the inferred type\n      f :: forall c (t :: * -&gt; *).\n           (Num c, Num [c], Foldable t) =&gt;\n           [c] -&gt; [c] -&gt; t [c] -&gt; ([c], [c])\n</code></pre>\n\n<p>I don't understand what i did wrong.\nThis is my code:</p>\n\n<pre><code>module Asig1 where\n\nf as ys x = (s,z)\n       where\n       ws = zipWith (*) as ys\n       s = foldl (+) ws x\n       z = s\n</code></pre>\n"}, {"tags": ["haskell", "time-complexity"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1484206406, "post_id": 41606660, "comment_id": 70416582, "body": "Take a look at the <a href=\"https://wiki.haskell.org/The_Fibonacci_sequence#Canonical_zipWith_implementation\" rel=\"nofollow noreferrer\">canonical Fibonacci implementation</a>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1484207468, "post_id": 41606660, "comment_id": 70417071, "body": "You can just tabulate the values for that function starting from <code>0</code> and replace the recursive calls with lookups over this table. Using a simple list this becomes O(n^2). As suggested by n.m. this can then evolve in a way that avoids the O(n) lookups and achieve O(n) total complexity."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1484216487, "post_id": 41606660, "comment_id": 70422516, "body": "This is a semi-duplicate of <a href=\"https://stackoverflow.com/questions/3208258/memoization-in-haskell\" title=\"memoization in haskell\">stackoverflow.com/questions/3208258/memoization-in-haskell</a>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484258130, "post_id": 41611188, "comment_id": 70448841, "body": "Another approach is to express the recurrence in terms of matrix multiplication. That is, given a column vector of four successive elements of the sequence, you can multiply them on the left by a fixed matrix to get the next four elements of the sequence. <code>m * m * m * ... * v</code>. But this is just <code>m ^ k * v</code>, and using exponentiation by squaring (<code>stimesMonoid</code>), this calculation is much more efficient, in practice, than <code>c1</code>."}, {"owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1484283841, "post_id": 41611188, "comment_id": 70455925, "body": "@dfeuer, That&#39;s indeed excellent mathematical approach for recurrent formulas, both elegant and practical. In general non-numeric (or nonlinear ) cases iterative cycles or memorization  are still useful."}], "tags": [], "owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "is_accepted": true, "score": 5, "last_activity_date": 1484284089, "last_edit_date": 1484284089, "creation_date": 1484218147, "answer_id": 41611188, "question_id": 41606660, "link": "https://stackoverflow.com/questions/41606660/function-complexity-from-exponential-to-linear/41611188#41611188", "title": "Function complexity from exponential to linear", "body": "<p>There are at least two ways to solve this problem linearly in time.</p>\n\n<h2>Using intermediate memory</h2>\n\n<pre><code>c1 :: Integer -&gt; Integer\nc1 n \n  | n &lt;= 4 = n + 10\n  | otherwise = go n (map c1 [4,3,2,1])\n  where\n    go 4 (a:_) = a \n    go n [a,b,c,d] = go (n-1) [a + 2*d, a, b, c]\n</code></pre>\n\n<p>Here we use four intermediate registers and shift them while <code>go</code>ing through the cycle. We could use tuple <code>(a, b, c, d)</code> instead of a list, but it is more handy to start with mapping here.</p>\n\n<p>This solution is constant in space and linear in time.</p>\n\n<h2>Memoization (codata generation)</h2>\n\n<pre><code>c2 :: Integer -&gt; Integer\nc2 n\n  | n &lt;= 4 = n + 10\n  | otherwise = results !! fromInteger (n - 1)\n  where\n    results = [11..14] ++ zipWith f (drop 3 results) results \n    f a b = a + 2*b\n</code></pre>\n\n<p>Here we use the laziness of Haskell (normal evaluation strategy + memoization). The infinite list <code>results</code>  generates values one-by-one on demand. It is used as data by <code>c2</code> function which just requests the generator for <code>n</code>-th number, and in self-definition. At the same time this data does not exist until it is needed. Such sort of data is called <em>codata</em> and it is rather common in Haskell.</p>\n\n<p>This solution is linear in space and time.</p>\n\n<p>Both solutions handle negative numbers and large positive numbers.</p>\n"}], "owner": {"reputation": 327, "user_id": 3374117, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BQsT9.jpg?s=128&g=1", "display_name": "Kert Kukk", "link": "https://stackoverflow.com/users/3374117/kert-kukk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 2, "accepted_answer_id": 41611188, "answer_count": 1, "score": 1, "last_activity_date": 1484284089, "creation_date": 1484203219, "last_edit_date": 1484204938, "question_id": 41606660, "link": "https://stackoverflow.com/questions/41606660/function-complexity-from-exponential-to-linear", "title": "Function complexity from exponential to linear", "body": "<p>I have following function which has exponential complexity:</p>\n\n<pre><code>c :: Integer -&gt; Integer\nc n \n   | n &lt;= 4 = n + 10\n   | otherwise = c (n-1) + 2 * (c (n-4))\n</code></pre>\n\n<p>I'm struggling to make the complexity of this function to linear.</p>\n\n<p><code>c x</code> shoud terminate even if 1000 &lt; x &lt; 100000</p>\n"}, {"tags": ["haskell", "purescript"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1484201240, "post_id": 41606126, "comment_id": 70414285, "body": "If this is just for debugging purposes, you might be interested in using <a href=\"https://github.com/garyb/purescript-debug\" rel=\"nofollow noreferrer\">the <code>Debug.Trace</code> module from <code>purescript-debug</code></a> instead of dealing with propagating the effects everywhere, which is pretty burdensome for some temporary debug logging. You shouldn\u2019t use that for anything but debugging, though, as the name would imply."}, {"owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1484201649, "post_id": 41606126, "comment_id": 70414423, "body": "@AlexisKing This isn&#39;t for debugging, as much as wanting to be able to quickly shoot off a message. Also, I&#39;d like to know why it&#39;s not working for my own education."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484202359, "post_id": 41606126, "comment_id": 70414701, "body": "<code>H.modify</code> produces a <code>Free .. ..</code> while <code>log</code> produces a <code>Eff .. ..</code> - the error is telling you these are different types. You cannot use them in the same <code>do</code> block."}], "answers": [{"comments": [{"owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "edited": false, "score": 0, "creation_date": 1484203671, "post_id": 41606670, "comment_id": 70415313, "body": "ah thank you. I left out my attempt to use liftEff as was confused why it wasn&#39;t lifting to the correct context."}, {"owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "edited": false, "score": 0, "creation_date": 1484204754, "post_id": 41606670, "comment_id": 70415778, "body": "However, I am still unable to successfully lift the Eff monad. I believe I need to specify the type in the annotation?? Is this a compiler thing?"}, {"owner": {"reputation": 1354, "user_id": 3027554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a52e97f946b17d363caca57df2692b0?s=128&d=identicon&r=PG&f=1", "display_name": "Christoph Hegemann", "link": "https://stackoverflow.com/users/3027554/christoph-hegemann"}, "reply_to_user": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "edited": false, "score": 3, "creation_date": 1484206107, "post_id": 41606670, "comment_id": 70416422, "body": "you can&#39;t keep <code>g</code> fully polymorphic anymore. It&#39;s used to carry the effects used throughout your program. See <a href=\"https://github.com/slamdata/purescript-halogen/blob/v0.12.0/examples/ajax/src/Main.purs\" rel=\"nofollow noreferrer\">github.com/slamdata/purescript-halogen/blob/v0.12.0/examples&zwnj;&#8203;/&hellip;</a> for an example. You&#39;ll want to replace <code>ajax :: AJAX</code> with <code>console :: CONSOLE</code>"}], "tags": [], "owner": {"reputation": 1354, "user_id": 3027554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a52e97f946b17d363caca57df2692b0?s=128&d=identicon&r=PG&f=1", "display_name": "Christoph Hegemann", "link": "https://stackoverflow.com/users/3027554/christoph-hegemann"}, "is_accepted": true, "score": 8, "last_activity_date": 1484203236, "creation_date": 1484203236, "answer_id": 41606670, "question_id": 41606126, "link": "https://stackoverflow.com/questions/41606126/understanding-purescript-eff-monad-and-do-blocks/41606670#41606670", "title": "Understanding Purescript Eff Monad and do blocks", "body": "<p>If you're working with version 0.12.0 of halogen you should be able to use <code>fromEff</code> from <a href=\"https://pursuit.purescript.org/packages/purescript-aff-free/3.0.0/docs/Control.Monad.Aff.Free#v:fromEff\" rel=\"noreferrer\">https://pursuit.purescript.org/packages/purescript-aff-free/3.0.0/docs/Control.Monad.Aff.Free#v:fromEff</a> like so:</p>\n\n<pre><code>data Query a = ToggleState a\n\neval :: Query ~&gt; H.ComponentDSL State Query g\neval (Toggle next) = do\n    H.modify (\\state -&gt; state { isOn = not state.isOn })\n    _ &lt;- H.fromEff (log \"updating the state!\")\n    pure next\n</code></pre>\n\n<p>This is going to get a lot nicer in upcoming versions of halogen (>= 0.13) in which <code>liftEff</code> should be enough.</p>\n\n<p>The reason for why you can't just use <code>log</code> right away, is that <code>H.ComponentDSL</code> is not a type synonym for <code>Eff</code>, but for <code>Free</code> and so you can't simply mix <code>Eff</code> and <code>ComponentDSL</code> actions.</p>\n"}], "owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "accepted_answer_id": 41606670, "answer_count": 1, "score": 4, "last_activity_date": 1484203236, "creation_date": 1484200995, "question_id": 41606126, "link": "https://stackoverflow.com/questions/41606126/understanding-purescript-eff-monad-and-do-blocks", "title": "Understanding Purescript Eff Monad and do blocks", "body": "<p>I'm trying to understand why the following does not work in Purescript. I have a feeling it can also be answered by the Haskell community, thus I've cross listed it.</p>\n\n<p>The general gist is:</p>\n\n<p>If I have a <code>do</code> block, can I not throw in a disposable value? In this instance, I'm trying to log something (similar to Haskell's <code>print</code>) in the middle of a series of monadic computations.</p>\n\n<pre><code>main = do\n    a &lt;- someAction1\n    b &lt;- someAction2\n    _ &lt;- log \"here is a statement I want printed\"\n    someAction3 a b\n</code></pre>\n\n<p>Specifically, I have a function which takes the following (from the Halogen example template project)</p>\n\n<pre><code>data Query a = ToggleState a\n\neval :: Query ~&gt; H.ComponentDSL State Query g\neval (Toggle next) = do\n    H.modify (\\state -&gt; state { isOn = not state.isOn })\n    _ &lt;- log \"updating the state!\"\n    pure next\n</code></pre>\n\n<p>In my mind, this should work like in Haskell</p>\n\n<pre><code>barf :: IO Int\nbarf = do\n  _ &lt;- print \"Here I am!\"\n  return 5\n\nmain :: IO ()\nmain = do\n  a &lt;- barf\n  _ &lt;- print $ \"the value is: \" ++ (show a)\n  print \"done\"\n</code></pre>\n\n<p>Specifically, the error that I get is type mismatch of the monads</p>\n\n<blockquote>\n  <p>Could not match type <code>Eff</code> with type <code>Free</code> while trying to match type <code>Eff ( \"console\" :: CONSOLE | t6 )</code> with type <code>Free (HalogenFP t0 { \"isOn\" :: t1 | t2 } t3 t4)</code> ... etc...</p>\n</blockquote>\n\n<p>I know purescript makes me declare the \"things I'm touching in the monad\" (i.e. <code>forall e. Eff ( a :: SOMEVAR, b :: SOMEOTHERVAR | eff ) Unit</code>, but I'm not sure how to do that in this case...</p>\n"}, {"tags": ["haskell", "graph", "functional-programming"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484202527, "post_id": 41605407, "comment_id": 70414770, "body": "&quot;...because I get type errors with components type Forest Vertex vs Tree Int&#39;s.&quot; - include this code and the type error you get."}, {"owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484203290, "post_id": 41605407, "comment_id": 70415109, "body": "I still haven&#39;t been able to write any code, but I included what I have been looking at so far."}], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484203231, "creation_date": 1484197117, "last_edit_date": 1484203231, "question_id": 41605407, "link": "https://stackoverflow.com/questions/41605407/how-would-i-take-the-sum-of-different-paths-in-a-graph-with-haskell", "title": "How would I take the sum of different paths in a graph with Haskell", "body": "<blockquote>\n  <h2>Problem</h2>\n  \n  <p><code>relatedQuestions</code> calculates the question with the shortest reading\n  time. Given the number of questions, an array of each questions\n  reading time, and and array of edges between questions. </p>\n\n<pre><code>questions = 5\nreadingTimes = [2, 1, 13, 1, 12]\nedges = [[3,0], [3,2], [4,1], [3,1]]\n\nanswer: 3\n</code></pre>\n  \n  <p>To calculate the \"shortest reading time\" of a question you need to\n  take the sum of reading times of each path a child node makes and divide it by the number of direct children the question has <em>(question\n  being the current node)</em>. Then add this number to the current\n  questions reading time.</p>\n  \n  <p>Ex using inputs above:</p>\n\n<pre><code>      (paths)\n current question          children       #direct    #readingTime\n 0 -&gt; 3 -&gt; 1 -&gt; 4      2   + (1 + 1 + 12) / 1        = 30 \n        -&gt; 2               + (1 + 13)     / 1          \n\n 1 -&gt; 4                 1  + (12)         / 1        = 13\n\n 2 -&gt; 3 -&gt; 0           13  + (1 + 2)      / 1        = 28\n        -&gt; 1 -&gt; 4          + (1 + 12)     / 1\n\n 3 -&gt; 0                 1  + (2)          / 3        = 10.3 \n   -&gt; 1 -&gt; 4               + (1 + 12)     / 3\n   -&gt; 2                    + (13)         / 3\n</code></pre>\n</blockquote>\n\n<h2>Issue and Request</h2>\n\n<p>My code works for the given test cases below, but it may fail for others. My code depends on Data.Graph's reachable to get all nodes that a current node can reach and sum all its children divided by the total direct children, but I need to divide each individual child nodes tree sum by the total direct children. So what I'm doing is taking the sum of all paths and dividing by the number of direct children when I should be dividing each path sum.</p>\n\n<p>I want to use Data.Graph's component function to fold the tree accordingly and accumulate the smallest sum. I was having issues with working on a <code>Forest Vertex</code> type, but using <code>sequence</code> I got a type of <code>Tree [Vertex]</code> making it a bit easier for me to work with regardless I have not been able to wrap my mind around the recursion/traversing necessary.</p>\n\n<pre><code> *Main&gt; :t graph1\n graph1 :: Graph\n *Main&gt; :t components graph1\n components graph1 :: Forest Vertex\n *Main&gt; :t sequence . components $ graph1\n sequence . components $ graph1 :: Tree [Vertex]\n *Main&gt; sequence . components $ graph1\n Node {rootLabel = [0], subForest = [Node {rootLabel = [3], subForest= [Node {rootLabel = [2], subForest = []},Node {rootLabel = [1], subForest = [Node {rootLabel = [4], subForest = []}]}]}]}\n</code></pre>\n\n<p>I'd really appreciate some help on either optimizing my current code to be a full solution or explanations on how I can use <code>Data.Graph</code>'s component function to fold/traverse a <code>[Forest Vertex]</code>.</p>\n\n<pre><code>import Data.Graph\nimport Data.List\nimport qualified Data.Vector as V\n\nrelatedQuestions :: Int -&gt; [Int] -&gt; [[Int]] -&gt; Int\nrelatedQuestions n t edges = snd smallest\n     where \n           smallest = minimum [(price (snd q) (related (snd q) edges) (fst q) , snd q) | q &lt;- zip t (vertices graph)] \n           price q r i = (fromIntegral (reach q) / fromIntegral r) + fromIntegral i\n           reach q = V.sum . V.tail $ V.fromList [ (V.fromList t) V.! x | x &lt;- reachable graph q]\n           graph = createGraph n createEdges\n           createEdges = concat [permutations x | x &lt;- edges] -- makes sure edge [1,0] has edge [0,1]\n\n\n-- | helper functions \n\n-- | number of children at node   \nrelated :: Int -&gt; [[Int]] -&gt; Int\nrelated n = length . filter (==n) . concat\n\ncreateGraph :: Int -&gt; [[Int]] -&gt; Graph\ncreateGraph e = buildG (0, e-1) . map (\\[x,y] -&gt; (x,y))\n</code></pre>\n\n<h2>Test Cases</h2>\n\n<pre><code>-- | test cases \nmain :: IO ()\nmain = hspec $ do\n   describe \"relatedQuestions\" $ do \n         it \"test case 1\" $ do \n       relatedQuestions n1 t1 edges1 `shouldBe` (3 :: Int)  \n         it \"test case 2\" $ do \n       relatedQuestions n2 t2 edges2 `shouldBe` (4 :: Int)  \n         it \"test case 3\" $ do \n       relatedQuestions n3 t3 edges3 `shouldBe` (2 :: Int)  \n\nn1 :: Int   \nn1 =  5\n\nt1 :: [Int]\nt1 = [2, 1, 13, 1, 12]\n\nedges1 :: [[Int]]\nedges1 = [[3,0], [3,2], [4,1], [3,1]]\n\nn2 :: Int\nn2 = 5\n\nt2 :: [Int]\nt2 = [3, 11, 3, 18, 3]\n\nedges2 :: [[Int]]\nedges2 = [[3,1], [4,2], [0,3], [4,1]]\n\nn3 :: Int\nn3 = 10\n\nt3 :: [Int]\nt3 = [9, 2, 7, 14, 4, 26, 21, 18, 39, 33]\n\nedges3 :: [[Int]]\nedges3 = [[2,7], [0,9], [3,5], [4,7], [0,2], [8,5], [3,6], [2,1], [5,0]]\n</code></pre>\n"}]