[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 8, "creation_date": 1433971913, "post_id": 30767649, "comment_id": 49587535, "body": "What would be the type of that generalized version?"}, {"owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1433973074, "post_id": 30767649, "comment_id": 49588076, "body": "@sepp2k something like (a1-&gt;a2-&gt;...-&gt;an-&gt;b) -&gt; ([a1-&gt;a2-&gt;...-&gt;an-&gt;b]-&gt;[b]) -&gt; [b] , but don`t know about actual implementation"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1433995924, "post_id": 30767649, "comment_id": 49594162, "body": "@Sigrlami, you can handwave with <code>...</code> on SO, but that doesn&#39;t work so well in an actual type system. Variadic functions are pretty horrible in typed languages."}], "answers": [{"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 3, "creation_date": 1433974616, "post_id": 30767747, "comment_id": 49588637, "body": "The lists of different types case can be done easily using the <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\"><code>ZipList</code></a> applicative."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 7, "last_activity_date": 1433972233, "creation_date": 1433972233, "answer_id": 30767747, "question_id": 30767649, "link": "https://stackoverflow.com/questions/30767649/why-prelude-have-same-functions-with-just-different-args/30767747#30767747", "title": "Why Prelude have same functions with just different args?", "body": "<p>It is theoretically possible to write a function with variable number of arguments in Haskell, some libraries use this quite well, but nothing is going to beat the clarity and efficiency of having individual functions that the compiler can more easily optimize.  The <code>zipWithN</code> functions are easy to use, make sense to beginners and advanced users alike, and do their jobs very well.</p>\n\n<p>If you need an N-way <code>zipWith</code> where all the lists have the same type, then just use <code>Data.List.transpose</code>:</p>\n\n<pre><code>zipWithN :: ([a] -&gt; b) -&gt; [[a]] -&gt; [b]\nzipWithN f = map f . transpose\n</code></pre>\n\n<p>If you need the lists to have differing types, you're probably going about it wrong.  Heterogeneous lists are not trivial in Haskell and most other statically typed languages pretty much by definition.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1433975714, "post_id": 30767977, "comment_id": 49589019, "body": "This answer would benefit from some examples, e.g. what you mean by &quot;combiner-function&quot;"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1433973252, "creation_date": 1433973252, "answer_id": 30767977, "question_id": 30767649, "link": "https://stackoverflow.com/questions/30767649/why-prelude-have-same-functions-with-just-different-args/30767977#30767977", "title": "Why Prelude have same functions with just different args?", "body": "<p>The primary purpose of generalised functions is that you can use them to write other polymorphic code, without a hassle. That can drastically <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\">reduce code duplication</a>.</p>\n\n<p>However, that's barely possible with something like a generalised <code>zipWith</code>: at least where you use it, you will need to have some <em>fixed</em> number of list arguments, otherwise the compiler couldn't be sure the combiner-function also has that right number of arguments. So the only advantage of such a generalised function would be that you only need a single exposed name. And that is rather less beneficial, it would hardly outweigh the disadvantages of the more obscure error messages when you get something wrong, and the occasionally needed explicit local signatures when things get <em>too</em> polymorphic.</p>\n"}, {"comments": [{"owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 0, "creation_date": 1433988236, "post_id": 30768327, "comment_id": 49592383, "body": "This is a nice example, but still follows the pattern I&#39;ve described initially, I found examples of functions that go on to 26 arguments in xml parsing library. I understand idea of quick-and-ready approach, but it&#39;s seems to me strange to use such hadwritten functions. As I understand to create in general n-ary functions we will need dependent types."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 1, "creation_date": 1433990437, "post_id": 30768327, "comment_id": 49592868, "body": "@Sigrlami, the usual saying is that if a function has five arguments, it&#39;s probably missing some. I think that&#39;s the most I&#39;ve ever used. Some oddballs in <code>HList</code>, <code>printf</code>, and of course Okasaki&#39;s embedded postscript calculator can use lots, but generally that&#39;s code smell."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 1, "creation_date": 1434013782, "post_id": 30768327, "comment_id": 49603174, "body": "@Sigrlami The point of this answer is not to define <code>zipWith, zipWith2, ...</code> up to a large number of arguments. Instead, the point is to directly use <code>getZipList,(&lt;$&gt;),(&lt;*&gt;),ZipList</code> -- four functions only -- to achieve the same goal. In other words, this is suggesting to avoid defining a variadic function and applying it, instead using a slightly more verbose syntax for applicatives which works for any number of lists."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1434089101, "post_id": 30768327, "comment_id": 49641609, "body": "@chi: Yeah, I clearly messed this one up.  I&#39;ve added an edit to clarify."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 12, "last_activity_date": 1434089034, "last_edit_date": 1434089034, "creation_date": 1433974958, "answer_id": 30768327, "question_id": 30767649, "link": "https://stackoverflow.com/questions/30767649/why-prelude-have-same-functions-with-just-different-args/30768327#30768327", "title": "Why Prelude have same functions with just different args?", "body": "<p>The generalized version of <code>zipWith</code> does exist: it's the <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow\"><code>ZipList</code> applicative functor</a>:</p>\n\n<pre><code>import Control.Applicative\n\nzipWith  f a1 a2 = getZipList (f &lt;$&gt; ZipList a1 &lt;*&gt; ZipList a2)\nzipWith3 f a1 a2 a3 = getZipList (f &lt;$&gt; ZipList a1 &lt;*&gt; ZipList a2 &lt;*&gt; ZipList a3)\n</code></pre>\n\n<p>And so on.  The thing is, it's generally just quicker to use the <code>zipWithN</code> functions that to wrap everything with a <code>ZipList</code> constructor.</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> chi's comment points out that I wasn't as clear as I should have been.  The point was that the <code>ZipList</code> wrapper allows us to use the applicative <code>f &lt;$&gt; x1 &lt;*&gt; ... &lt;*&gt; xn</code> idiom to zip any number of lists whose element types are compatible with <code>f</code>'s type.</p>\n"}], "owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 30768327, "answer_count": 3, "score": 4, "last_activity_date": 1434089034, "creation_date": 1433971844, "question_id": 30767649, "link": "https://stackoverflow.com/questions/30767649/why-prelude-have-same-functions-with-just-different-args", "title": "Why Prelude have same functions with just different args?", "body": "<p>Consider functions from Prelude like <code>zipWith</code>. There are other functions like <code>zipWith3</code> ... <code>zipWith7</code> which differs only by number of arguments. There are many similar examples, in other languages too (scala, ocaml).</p>\n\n<p>What are reasons for creating functions with particular number of elements? Why not use generalized version? Maybe derive particular <code>zipWith</code> from number of applied arguments</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1433965354, "post_id": 30765800, "comment_id": 49583821, "body": "First of all, don&#39;t put class constraints on data types.  If you need that functionality there are GADTs, but it looks like that isn&#39;t the solution you need here."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1433965594, "post_id": 30765800, "comment_id": 49583958, "body": "The problem is that your class says: I can convert this to whatever <code>Fractional</code> you want, whereas the data clearly restricts it based on the decisions you&#39;ve made."}, {"owner": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433965644, "post_id": 30765800, "comment_id": 49583979, "body": "I have done a whole big program by using them, and it works correctly, but its first time i create a class in the program :)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433965752, "post_id": 30765800, "comment_id": 49584039, "body": "from the small part I can see here I wonder why you need the <code>Ped</code> class in the first place - what&#39;s wrong with <code>prizeOrder</code> by itself?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433965787, "post_id": 30765800, "comment_id": 49584052, "body": "@Carsten: that&#39;s indicated by the question, one wishes for instance to provide a function with the same name for <code>[Order]</code>, for instance to sum by."}, {"owner": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433965936, "post_id": 30765800, "comment_id": 49584153, "body": "I have to create a class with one method called prize&#39; which depending on if i use an Order or a [Order], prizeOrder only gets the first case. Plus i need to do it this way of course i know how to calculete prizeOrder[Order]"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1433965939, "post_id": 30765800, "comment_id": 49584155, "body": "@CommuSoft yeah I&#39;ve seen it - but well <code>sum . map prizeOrder</code> and stuff ... well just saying"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433967179, "post_id": 30766099, "comment_id": 49584803, "body": "Thank you very much, Ive tried that before but i dont know how to activate those features y copied your code and prelude tells me: Too many parameters for class <code>Ped&#39;     (Use MultiParamTypeClasses to allow multi-parameter classes)     In the class declaration for </code>Ped&#39;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433967328, "post_id": 30766099, "comment_id": 49584895, "body": "@KannaKiski: using the directives between the <code>{-#</code> and <code>#-}</code>. Those aren&#39;t comments."}, {"owner": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433967419, "post_id": 30766099, "comment_id": 49584963, "body": "I already did it, but it sais the same thing...Could it be Eclipse?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433967557, "post_id": 30766099, "comment_id": 49585041, "body": "Are you using the <i>Glasgow Haskell Compiler (GHC)</i>?"}, {"owner": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433967620, "post_id": 30766099, "comment_id": 49585093, "body": "Yap i use eclipse option: degug as GHCi sesion"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433967820, "post_id": 30766099, "comment_id": 49585199, "body": "Perhaps restart the session or search whether you can enable these options in the debugging."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "edited": false, "score": 0, "creation_date": 1433977079, "post_id": 30766099, "comment_id": 49589496, "body": "@KannaKiski In GHCI, you can&#39;t turn on extensions using <code>LANGUAGE</code> pragmas. Use the <code>:set</code> command instead: <code>:set -XMultiParamTypeClasses</code> etc. I would suggest putting the code into a file and then loading it though. Have you tried that? I&#39;m not sure how that Eclipse command works."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1433966562, "last_edit_date": 1433966562, "creation_date": 1433966210, "answer_id": 30766099, "question_id": 30765800, "link": "https://stackoverflow.com/questions/30765800/haskell-class-misunderstanding/30766099#30766099", "title": "Haskell class misunderstanding", "body": "<p>The problem is that your <code>class</code> definition gives an additional <em>degree of freedom</em>, your <code>instance</code> fails to provide. In your class you state:</p>\n\n<pre><code>class Ped a where\n    prize' :: Fractional b =&gt; a -&gt; b\n</code></pre>\n\n<p>That means that the programmer could choose whatever <code>Fraction b</code> for <code>b</code> he/she wants.</p>\n\n<p>Now if we look to your instance:</p>\n\n<pre><code>instance (Integral n, Fractional p) =&gt; Ped (Order n p) where\n    prize' x = prizeOrder x\n</code></pre>\n\n<p>Here you say that <code>prize'</code> depends on <code>prizeOrder</code>. The <code>prizeOrder</code> function has however the signature:</p>\n\n<pre><code>prizeOrder :: (Fractional p, Integral c) =&gt; (Order c p) -&gt; p\n</code></pre>\n\n<p>Which means you cannot choose <code>b</code> at all. If I would use <code>prize'</code> with as expected return type <code>Float</code>, that would be accepted by <code>Ped</code>, but not by a datastructure <code>Order Double Int</code>.</p>\n\n<p>You can \"solve\" this by using <em>multi-parameter classes</em>, you take the <code>b</code> in the <code>class</code> signature:</p>\n\n<pre><code>class Ped a b where\n    prize' :: a -&gt; b\n</code></pre>\n\n<p>Next you need to define the instance with a second type parameter to ensure the output is <code>p</code>:</p>\n\n<pre><code>instance (Integral n, Fractional p) =&gt; Ped (Order n p) p where\n    prize' x = prizeOrder x\n</code></pre>\n\n<p>You will need to activate some additional <em>GHC</em> features, the full code would read like:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE DatatypeContexts #-}\n\nclass Ped a b where\n    prize' :: a -&gt; b\n\ninstance (Integral n, Fractional p) =&gt; Ped (Order n p) p where\n    prize' x = prizeOrder x\n\ndata (Integral c,Fractional p) =&gt; Product c p\n    = Prod c String p\n    deriving (Show, Read) \n\ndata (Integral n, Fractional p) =&gt; Order n p\n    = PdMult (Product n p) n\n    | PdUnit (Product n p)\n    deriving (Show)\n\nprize :: (Fractional p, Integral c) =&gt;(Product c p) -&gt; p\nprize (Prod _ _ x) = x\n\nprizeOrder :: (Fractional p, Integral c) =&gt; (Order c p) -&gt; p\nprizeOrder (PdMult p n) = (prize p) * (fromIntegral n)\nprizeOrder (PdUnit p) = prize p\n</code></pre>\n\n<p>But as said by @bheklilr, don't use \"<em>class constraints on data types</em>\". Furthermore one better asks his/herself whether it pays off to use a <code>class</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 4951139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc929a4500d661b4db656c3a87394a7e?s=128&d=identicon&r=PG&f=1", "display_name": "KannaKiski", "link": "https://stackoverflow.com/users/4951139/kannakiski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1433966562, "creation_date": 1433965255, "last_edit_date": 1433965490, "question_id": 30765800, "link": "https://stackoverflow.com/questions/30765800/haskell-class-misunderstanding", "title": "Haskell class misunderstanding", "body": "<p>Hello i need to create a class which contains a method called <code>prize'</code> which calculates some Fractional. I want to instance in case I get an <code>Order</code>, later I will have to instance again in case I get a <code>[Order]</code>, this is the code :</p>\n\n<pre><code>class Ped a where\n    prize' :: Fractional b =&gt; a -&gt; b\n\ninstance (Integral n, Fractional p) =&gt; Ped (Order n p) where\n    prize' x = prizeOrder x\n\ndata (Integral c,Fractional p) =&gt; Product c p\n    = Prod c String p\n    deriving (Show, Read) \n\ndata (Integral n, Fractional p) =&gt; Order n p\n    = PdMult (Product n p) n\n    | PdUnit (Product n p)\n    deriving (Show, Eq)\n\nprize :: (Fractional p, Integral c) =&gt;(Product c p) -&gt; p\nprize (Prod _ _ x) = x\n\nprizeOrder :: (Fractional p, Integral c) =&gt; (Order c p) -&gt; p\nprizeOrder (PdMult p n) = (prize p) * (fromIntegral n)\nprizeOrder (PdUnit p) = prize p\n</code></pre>\n\n<p>Prelude says:</p>\n\n<pre><code>Could not deduce (p ~ b)\nfrom the context (Integral n, Fractional p)\nbound by the instance declaration\nat src\\Funciones.hs:6:10-55\nor from (Fractional b)\nbound by the type signature for\n     prize' :: Fractional b =&gt; Order n p -&gt; b\nat src\\Funciones.hs:7:5-11\n`p' is a rigid type variable bound by\n  the instance declaration\n  at src\\Funciones.hs:6:10\n`b' is a rigid type variable bound by\n  the type signature for prize' :: Fractional b =&gt; Order n p -&gt; b\n  at src\\Funciones.hs:7:5\nExpected type: Order b\n  Actual type: Order n p\nRelevant bindings include\n  x :: Order n p\n    (bound at src\\Funciones.hs:7:13)\n  prize' :: Order n p -&gt; b\n    (bound at src\\Funciones.hs:7:5)\nIn the first argument of `prizeOrder', namely `x'\nIn the expression: prizeOrder x\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1433961097, "post_id": 30764420, "comment_id": 49581443, "body": "Next time you could use <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a>, the Haskell API search engine. The function that you are looking for is <a href=\"https://www.haskell.org/hoogle/?hoogle=zipWith\" rel=\"nofollow noreferrer\">zipWith</a>."}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1433962345, "post_id": 30764483, "comment_id": 49582187, "body": "You shouldn&#39;t need the import since <code>zipWith</code> is included with the Prelude."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433963063, "post_id": 30764483, "comment_id": 49582576, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+b+-%3E+c%29+-%3E+%5Ba%5D+-%3E+%5Bb%5D+-%3E+%5Bc%5D\" rel=\"nofollow noreferrer\">It&#39;s the first result on hoogle with the more general type signature</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1433965813, "post_id": 30764483, "comment_id": 49584076, "body": "@Eric Thanks -- simplified."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433965968, "post_id": 30764483, "comment_id": 49584172, "body": "@bheklilr True. I used the one provided by the OP since realizing the generalization can be a non trivial step for a beginner, I think."}, {"owner": {"reputation": 136, "user_id": 4992699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29b1990896b63e27b78ab4b7c1b8d10?s=128&d=identicon&r=PG", "display_name": "Tejing", "link": "https://stackoverflow.com/users/4992699/tejing"}, "edited": false, "score": 0, "creation_date": 1433973871, "post_id": 30764483, "comment_id": 49588345, "body": "You might want to specifically mention the behavior when one list is longer than another, since the phrasing of the original question doesn&#39;t show an awareness of this issue. (The code he wrote will throw an exception if the first list is longer than the second)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1433974480, "last_edit_date": 1433974480, "creation_date": 1433960979, "answer_id": 30764483, "question_id": 30764420, "link": "https://stackoverflow.com/questions/30764420/is-there-any-function-in-haskell-that-applies-a-two-argument-function-to-two-lis/30764483#30764483", "title": "Is there any function in Haskell that applies a two argument function to two lists, element by element?", "body": "<pre><code>&gt; :t zipWith\nzipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n&gt; zipWith (*) [1,2,3] [4,5,6]\n[4,10,18]\n</code></pre>\n\n<p>It's the eighth result provided by <a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+a+-%3E+a%29+-%3E+[a]+-%3E+[a]+-%3E+[a]\" rel=\"nofollow\">Hoogle</a> when queried with your type</p>\n\n<pre><code>(a -&gt; a -&gt; a) -&gt; [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Moreover, when you need to implement your own function, use <code>list !! index</code> only as a last resort, since it usually leads to a bad performance, having a cost of <code>O(index)</code>. Similarly, <code>length</code> should be used only when necessary, since it needs to scan the whole list. </p>\n\n<p>In the <code>zipWith</code> case, you can avoid both and proceed recursively in a natural way: it is roughly implemented as</p>\n\n<pre><code>zipWith _ []     _      = []\nzipWith _ _      []     = []\nzipWith f (x:xs) (y:ys) = f x y : zipWith f xs ys\n</code></pre>\n\n<p>Note that this will only recurse as much as needed to reach the end of the shortest list. The remaining part of the longer list will be discarded.</p>\n"}], "owner": {"reputation": 138, "user_id": 4996192, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/017c815c3972a18001cb840713ea761a?s=128&d=identicon&r=PG", "display_name": "Victor Magalh&#227;es", "link": "https://stackoverflow.com/users/4996192/victor-magalh%c3%a3es"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1255, "favorite_count": 0, "accepted_answer_id": 30764483, "answer_count": 1, "score": 1, "last_activity_date": 1433974480, "creation_date": 1433960762, "question_id": 30764420, "link": "https://stackoverflow.com/questions/30764420/is-there-any-function-in-haskell-that-applies-a-two-argument-function-to-two-lis", "title": "Is there any function in Haskell that applies a two argument function to two lists, element by element?", "body": "<p>I just wanted to multiply two lists element by element, so I'd pass (*) as the first argument to that function:</p>\n\n<pre><code>apply :: Num a =&gt; (a -&gt; a -&gt; a) -&gt; [a] -&gt; [a] -&gt; [a]\napply f xs ys = [f (xs !! i) (ys !! i) | i &lt;- [0..(length xs - 1)]]\n</code></pre>\n\n<p>I may be asking a silly question, but I actually googled a lot for it and just couldn't find. Thank you, guys!</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 3, "creation_date": 1433944444, "post_id": 30755721, "comment_id": 49569918, "body": "&quot;I got errors:&quot; - what errors"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433944552, "post_id": 30755721, "comment_id": 49570006, "body": "it&#39;s just my 50cts. but this seems to be to OO for my taste - there might be a different problem lurking in the background which should be taken care of. Anway this really reminds me of <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">this Antipattern</a> - maybe you find the article (and the alternatives there) interesting"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1433952297, "post_id": 30755721, "comment_id": 49575916, "body": "Your approach should work, although you will have to be a bit careful since you have five different identifiers named <code>id</code> (the three from Data1, Data2, Data3, the class method of MyDataBase, and the one from Prelude)."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1433944331, "post_id": 30755841, "comment_id": 49569825, "body": "<b>What about types you don&#39;t know about that also have that field?</b> - the same thing."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1433944385, "post_id": 30755841, "comment_id": 49569868, "body": "sorry, I don&#39;t understand your answer, it&#39;s too much vague."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433962724, "post_id": 30755841, "comment_id": 49582403, "body": "@jawanam For what it&#39;s worth, I don&#39;t understand your question for the exact same reason."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433968120, "post_id": 30755841, "comment_id": 49585412, "body": "@DanielWagner, what&#39;s it got to do with you?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433968320, "post_id": 30755841, "comment_id": 49585539, "body": "@jawanam If you poke around, you will find I am one of the most active users answering questions in the haskell tag. So &quot;what it&#39;s got to do with me&quot; is that questions I understand often get high quality answers."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 4, "last_activity_date": 1433946752, "last_edit_date": 1433946752, "creation_date": 1433937926, "answer_id": 30755841, "question_id": 30755721, "link": "https://stackoverflow.com/questions/30755721/specifying-a-constraint-for-a-class/30755841#30755841", "title": "Specifying a constraint for a class", "body": "<blockquote>\n  <p>so that only Data1, Data2 and Data3 can be instantiated by MyClass1 because they all have the field id? </p>\n</blockquote>\n\n<p>What about types you don't know about that also have that field?</p>\n\n<p>In general, you can accomplish things like that with Lens (regular Haskell records are IMHO unusable); if you name your fields <code>_Data1Id</code> and <code>_Data2Id</code> (customizable), you'll get a <code>HasId</code> class with <code>id</code> lens and instances for that class for <code>Data1</code> and <code>Data2</code>. Then you can use that class as a constraint further.</p>\n\n<p>Of course you don't have to use <code>makeFields</code> and you can write the instances yourself. Not sure why you'd do that, though.</p>\n\n<hr>\n\n<p>You didn't specify what errors you got, but I bumped off <code>UndecidableInstances</code>. Here's how to get around \"Constraint is no smaller than the instance head\" error:</p>\n\n<pre><code>class A a where aOp :: a -&gt; Int\nclass B a where bOp :: a -&gt; Int\n\ndata C = forall a. B a =&gt; C a\ninstance A C where aOp (C a) = bOp a\n</code></pre>\n\n<p>This will allow you to use any type that satisifies B in a A context (but as Carsten pointed out, it's also an antipattern of sorts).</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1433968198, "post_id": 30764328, "comment_id": 49585460, "body": "That&#39;s great. Is there any way to avoid redundancy in using &quot;getId&quot; and &quot;id&quot; to use only &quot;id&quot;?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1434002544, "post_id": 30764328, "comment_id": 49596388, "body": "Yes, and this is what my answer presents. If you Google <code>makeFields</code> you should be able to find examples without a problem. This approach has one significant drawback at the cost of &quot;simplicity&quot;: <code>HasId</code> can now only be used to <i>read</i> data, you can&#39;t update a field with it. If you tried to write proper lenses yourself it would OTOH get more lengthy and complicated."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1434039298, "post_id": 30764328, "comment_id": 49622024, "body": "@BartekBanachewicz, your answer focuses on the libraries instead of fundamentals. What would you do if Lens didn&#39;t exist?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1434044568, "post_id": 30764328, "comment_id": 49625181, "body": "What would you do if Haskell didn&#39;t exist? I told you, you can write your own lenses for everything, there&#39;s hardly any magic in <code>makeFields</code> besides boilerplate removal. We thankfully live in a world where Lens DOES exist and I see no reasons to not use it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1434078908, "post_id": 30764328, "comment_id": 49638824, "body": "@BartekBanachewicz, to be able to apply Lens one has to know what&#39;s behind Lens <b>first</b> and how accomplish the same thing without using Lens."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 0, "last_activity_date": 1433960446, "creation_date": 1433960446, "answer_id": 30764328, "question_id": 30755721, "link": "https://stackoverflow.com/questions/30755721/specifying-a-constraint-for-a-class/30764328#30764328", "title": "Specifying a constraint for a class", "body": "<p>You don't want to do that. The simplest way of achieving what you want is the following:</p>\n\n<pre><code>class HasId a where\n    getId :: a -&gt; UUID\n\nclass HasId a =&gt; MyClass1 a where\n    method1 =   -- NOTE: Use \"getId\" instead of plain \"id\".\n</code></pre>\n\n<p>when you define your data types you simply do:</p>\n\n<pre><code>data Data1 = Data1\n    { id :: UUID\n    , field2 :: String\n    , field3 :: Int\n    }\n\ninstance HasId Data1 where\n    getId = id\n</code></pre>\n\n<p>If you want to add a new data type to the family you simply create a new instance of the <code>HasId</code> class.</p>\n\n<p>You don't need no extensions, nothing fancy, no libraries. Sure you can probably shorten the code or do something more fancy, but I'd prefer to use simple code that works and I understand versus code that I don't understand.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1531706090, "creation_date": 1433937631, "last_edit_date": 1531706090, "question_id": 30755721, "link": "https://stackoverflow.com/questions/30755721/specifying-a-constraint-for-a-class", "title": "Specifying a constraint for a class", "body": "<p>I have three data declarations in the different modules:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Data1 = Data1\n  { id :: UUID\n  , field2 :: String\n  , field3 :: Int\n  }\n\ndata Data2 = Data2\n  { id :: UUID\n  , field1112 :: String\n  , field4433 :: String\n  }\n\n\ndata Data3 = Data3\n  { id :: UUID\n  , field22 :: Double\n  , field344 :: Int\n  }\n</code></pre>\n\n<p>And a class declaration:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class MyClass1 a where\n  method1 ....\n</code></pre>\n\n<p>How can I specify a constraint for <code>MyClass1</code> so that only <code>Data1, Data2 and Data3</code> can be instantiated by <code>MyClass1</code> because they <strong>all have the field <code>id</code></strong>?\nI tried the following, but it didn't seem right to me and I got errors:</p>\n\n<pre><code>-- in the different module\nclass MyDataBase a where\n  id :: a -&gt; UUID\n\n-- in the module Data1.hs\ninstance MyDataBase Data1 where\n  id d1 =  \n\n-- in the module Data2.hs\n-- and so on....\n\n\nclass (MyDataBase a) =&gt; MyClass1 a where\n  method1 .... = -- calling \n</code></pre>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1433936671, "post_id": 30754991, "comment_id": 49563867, "body": "<code>x</code> is a number, not a function..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433960933, "post_id": 30754991, "comment_id": 49581333, "body": "See also the <a href=\"http://hackage.haskell.org/package/universe\" rel=\"nofollow noreferrer\">universe</a> package, which provides <code>ints</code> under the name <code>universe</code>, and for many types, not just <code>Int</code>. The ordering for <code>Integer</code> matches the ordering given here (though not the one for <code>Int</code>); and I bet you want <code>Integer</code> anyway, since you claim you want an infinite list, which <code>ints</code> is not."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1433936439, "post_id": 30755107, "comment_id": 49563695, "body": "Alternatively, with a right fold: <code>ints = 0 : foldr (\\n ns -&gt; n : -n : ns) [] [1 ..]</code>."}, {"owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1433936526, "post_id": 30755107, "comment_id": 49563757, "body": "indeed, sticked with list comprehension as that was what OP used but actually prefer the right fold."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1433936736, "post_id": 30755107, "comment_id": 49563926, "body": "Or maybe <code>ints = 0 : ([1..] &gt;&gt;= \\x -&gt; [x, -x])</code> ."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1433936812, "post_id": 30755107, "comment_id": 49563986, "body": "@AJFarmar Beat me to it by one minute."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1433936817, "post_id": 30755107, "comment_id": 49563990, "body": "@AJFarmar Ah yes, using the list monad. Nice."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1433936984, "post_id": 30755107, "comment_id": 49564117, "body": "Actually, <code>x (-x)</code> <i>is</i> valid syntax, it just doesn&#39;t make much sense type-wise (since <code>x</code> has to be both a function and a number)."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1433937225, "post_id": 30755107, "comment_id": 49564295, "body": "@leftaroundabout True; valid syntax and valid types are two <i>very</i> different things."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1433939925, "post_id": 30755107, "comment_id": 49566219, "body": "@leftaroundabout, it makes <a href=\"http://stackoverflow.com/a/27665374/3237465\">some</a> sense, actually."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433946424, "post_id": 30755107, "comment_id": 49571420, "body": "Note that the foldr version above is basically just <code>concatMap (\\x -&gt; [x,-x])  [1..]</code> - or <code>[1..] &gt;&gt;= (\\x -&gt; [x,-x])</code> if you prefer infix."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1433960894, "post_id": 30755107, "comment_id": 49581306, "body": "Why use <code>concat</code> when you&#39;re already using a list comprehension? <code>ints = 0 : [v | x &lt;- [1..], v &lt;- [x, -x]]</code>"}, {"owner": {"reputation": 505, "user_id": 4612105, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/10205926013086481/picture?type=large", "display_name": "Syzorr", "link": "https://stackoverflow.com/users/4612105/syzorr"}, "edited": false, "score": 0, "creation_date": 1433968922, "post_id": 30755107, "comment_id": 49585909, "body": "I have really appreciated all these comments. I wasn&#39;t sure what was wrong with me when trying to figure this out but I kept trying various things that were close to what you guys have provided but not quite right and the many different ways given have really shown me a lot."}], "tags": [], "owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "is_accepted": true, "score": 6, "last_activity_date": 1433937854, "last_edit_date": 1433937854, "creation_date": 1433936102, "answer_id": 30755107, "question_id": 30754991, "link": "https://stackoverflow.com/questions/30754991/generating-infinite-list-in-haskell/30755107#30755107", "title": "Generating Infinite List in Haskell", "body": "<p>The problem is that <code>x (-x)</code> is not of type <code>Int</code> (thanks to @leftaroundabout removed non-sense about non-valid syntax here). You want to generate two values for every <code>x</code>. So I guess the easiest way is to create lots of list pairs <code>[1, -1]</code>, <code>[2, -2]</code>, ... and then to concatenate them all together. And obviously prepend a <code>0</code>.</p>\n\n<pre><code>ints :: [Int]\nints = 0 : concat [[x, (-x)] | x &lt;- [1..]]\n</code></pre>\n\n<p>Also, you might want to use <code>Integer</code> instead of <code>Int</code> as <code>Int</code> will overflow at some point but <code>Integer</code> won't.</p>\n"}], "owner": {"reputation": 505, "user_id": 4612105, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/10205926013086481/picture?type=large", "display_name": "Syzorr", "link": "https://stackoverflow.com/users/4612105/syzorr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 30755107, "answer_count": 1, "score": 0, "last_activity_date": 1433937854, "creation_date": 1433935821, "last_edit_date": 1433935853, "question_id": 30754991, "link": "https://stackoverflow.com/questions/30754991/generating-infinite-list-in-haskell", "title": "Generating Infinite List in Haskell", "body": "<p>So, been going over some old exams in preparation for my upcoming one and came across this question:</p>\n\n<p>Write Haskell code to define <code>ints :: [Int]</code> an infinite list of the following form:\n<code>[0, 1, -1, 2, -2, 3, -3, 4, -4..]</code></p>\n\n<p>I've been plugging at it for the past half an hour but can't seem to find anything to solve it or that will do what I want. I get the feeling that what I am really wanting is a list comprehension of the form</p>\n\n<pre><code>ints :: [Int]\nints = [0] ++ [x (-x) | x &lt;- [1..]]\n</code></pre>\n\n<p>But this doesn't work and I'm unsure of how to get it to work</p>\n"}, {"tags": ["haskell", "profiling", "ghc", "cabal-install"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433946203, "post_id": 30754980, "comment_id": 49571226, "body": "And if you run <code>cabal build</code> now?"}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433947265, "post_id": 30754980, "comment_id": 49572145, "body": "@ReidBarton, I did do a second cabal build (just forgot to mention it), and it ran without errors. I&#39;ve updated the question."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433948386, "post_id": 30754980, "comment_id": 49573072, "body": "Are you sure you&#39;re running the executable that was just built, rather than one that was installed to your PATH earlier? (You can use <code>cabal run -- +RTS -p</code> to run the executable that cabal has just built, or invoke it via its path <code>dist&#47;...</code>.)"}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433949991, "post_id": 30754980, "comment_id": 49574302, "body": "@ReidBarton Now <i>that&#39;s</i> interesting... Although I omitted it above, I was actually running the executable by pointing to the binary in the <code>bin</code> directory in the sandbox. That binary has the timestamp of the last time I changed anything and did <code>cabal build</code>. But now when I run it using <code>cabal run -- +RTS -p</code>, it creates a new executable, which does work, and I get profiling info as expected. Maybe <code>cabal build</code> doesn&#39;t produce a new executable unless there&#39;s been a change in <i>source</i> code (as opposed to a change to the cabal file)? I&#39;ll have to experiment."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1433952488, "post_id": 30754980, "comment_id": 49576038, "body": "I don&#39;t use sandboxes much but I wouldn&#39;t expect <code>cabal build</code> to ever install anything into the sandbox. So that part has me a bit confused. I expect <code>cabal build</code> to build an executable to <code>dist&#47;build&#47;foo&#47;foo</code> and for <code>cabal run</code> to run that executable."}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433955329, "post_id": 30754980, "comment_id": 49577820, "body": "@ReidBarton Now that you say it, that makes sense. But I&#39;d always thought of the <code>dist</code> directory as being full of stuff I don&#39;t need to see. In my mind <code>dist</code> had nothing to do with sandboxes, since sandboxes didn&#39;t exist in the beginning. With non-sandboxed builds, any executable produced goes into your <code>.cabal&#47;bin</code>. So then when sandboxes became a thing, there was this new directory (the sandbox), and I expected the executable to go there."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433955818, "post_id": 30754980, "comment_id": 49578138, "body": "Right, but the executables only go to <code>.cabal&#47;bin</code> on <code>cabal install</code>, not <code>cabal build</code>. And <code>cabal install</code> with a sandbox installs the executable into the sandbox, so I wouldn&#39;t expect <code>cabal build</code> to touch the sandbox at all."}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433956367, "post_id": 30754980, "comment_id": 49578488, "body": "Ah, that makes perfect sense. Thank you."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1457412053, "post_id": 30754980, "comment_id": 59383156, "body": "@ReidBarton as you seemed to answer the question with your comment, perhaps you can post it as an answer?"}], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 287, "favorite_count": 2, "answer_count": 0, "score": 8, "last_activity_date": 1433960656, "creation_date": 1433935786, "last_edit_date": 1433960656, "question_id": 30754980, "link": "https://stackoverflow.com/questions/30754980/what-is-the-procedure-for-profiling-under-ghc-7-10-1-and-cabal-1-23", "title": "What is the procedure for profiling under GHC 7.10.1 and cabal 1.23?", "body": "<p>What is the recommended procedure for profiling under GHC 7.10.1 and cabal 1.23? The profiling-related error and warning messages from GHC and cabal-install are very inconsistent.\n</p>\n\n<ol>\n<li><p>Try to run an executable with profiling, and you are told:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ prediction-interactive +RTS -p\n\nprediction-interactive: the flag -p requires the program to be built with -prof\n</code></pre></li>\n<li><p>Put <code>-prof</code> in your cabal file, and you are told:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ cabal build\n\nWarning: 'ghc-options: -prof' is not necessary and will lead to problems when\nused on a library. Use the configure flag --enable-library-profiling and/or\n--enable-executable-profiling.\n</code></pre></li>\n<li><p>Follow that advice (and remove -prof from the cabal file), and you are told:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ cabal configure --enable-executable-profiling\n\nResolving dependencies...\nConfiguring creatur-wains-prediction-1.0...\nWarning: The flag --enable-executable-profiling is deprecated. Please use\n--enable-profiling instead.\n</code></pre></li>\n<li><p>Follow that advice, and you are told:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ cabal configure --enable-profiling\n\nResolving dependencies...\nConfiguring creatur-wains-prediction-1.0...\n\n$ cabal build\n\n. . .\nInstalling executable(s) in\n/home/eamybut/nosync/sandboxes/prediction-wains/bin\nInstalled creatur-wains-prediction-1.0\n\n$ prediction-interactive +RTS -p\n\nprediction-interactive: the flag -p requires the program to be built with -prof\n</code></pre></li>\n</ol>\n\n<p>Facepalm!</p>\n\n<p><strong>EDIT</strong>: Added cabal build in step 4.</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1433941139, "post_id": 30752653, "comment_id": 49567162, "body": "Pretty much any code one might write with <code>Nat</code>-s should work equally with statically known and unknown values. Is there something specific you&#39;d like to do, but don&#39;t know how to implement?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1433950781, "post_id": 30752653, "comment_id": 49574845, "body": "You can define <code>Vec</code> as <code>Vec (n :: Maybe Nat) a</code>, but I wouldn&#39;t do such a thing in Haskell. One another option is to <a href=\"http://stackoverflow.com/a/27070207/3237465\">check your invariants</a>. Or you can use <a href=\"http://stackoverflow.com/a/27220545/3237465\">ornaments</a>."}], "answers": [{"comments": [{"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1434011252, "post_id": 30762622, "comment_id": 49601463, "body": "Thanks that was informative. To be honest I don&#39;t know if I can apply it if the need comes up (see edit above), but the concept seems clear."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 10, "last_activity_date": 1433955204, "creation_date": 1433955204, "answer_id": 30762622, "question_id": 30752653, "link": "https://stackoverflow.com/questions/30752653/can-i-have-an-unknown-knownnat/30762622#30762622", "title": "Can I have an unknown KnownNat?", "body": "<p>Here's something potentially interesting...</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, ScopedTypeVariables #-}\n\nimport GHC.TypeLits\nimport Data.Proxy\n\ndata Bar (n :: Nat) = Bar String deriving Show\n\nbar :: KnownNat n =&gt; Bar n -&gt; (String, Integer)\nbar b@(Bar s) = (s, natVal b)\n</code></pre>\n\n<p>Ok, it's very pointless.  But it's an example of using <code>KnownNat</code> to get at compile-time information.  But thanks to the other functions in <code>GHC.TypeLits</code>, it can be used with run-time information as well.</p>\n\n<p>Just add this on to the above code, and try it out.</p>\n\n<pre><code>main :: IO ()\nmain = do\n    i &lt;- readLn\n    let Just someNat = someNatVal i\n    case someNat of\n       SomeNat (_ :: Proxy n) -&gt; do\n           let b :: Bar n\n               b = Bar \"hello!\"\n           print $ bar b\n</code></pre>\n\n<p>Let's break down what happens here.</p>\n\n<ol>\n<li>Read an <code>Integer</code> from stdin.</li>\n<li>Create a <code>SomeNat</code>-typed value from it, failing the pattern-match if the input was negative. For such a simple example, handling that error just gets in the way.</li>\n<li>Here's the real magic.  Pattern-match with a <code>case</code> expression, using <code>ScopedTypeVariables</code> to bind the (statically unknown) <code>Nat</code>-kinded type to the type variable <code>n</code>.</li>\n<li>Finally, create a <code>Bar</code> value with that particular <code>n</code> as its type variable and then do things with it.</li>\n</ol>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 783, "favorite_count": 3, "accepted_answer_id": 30762622, "answer_count": 1, "score": 7, "last_activity_date": 1434011349, "creation_date": 1433929187, "last_edit_date": 1434011349, "question_id": 30752653, "link": "https://stackoverflow.com/questions/30752653/can-i-have-an-unknown-knownnat", "title": "Can I have an unknown KnownNat?", "body": "<p>I wonder if I can have my cake and eat it too regarding <code>KnownNats</code>. Can I write code that uses <code>Nats</code> that may be both <code>KnownNats</code> and <code>UnknownNats</code> (<code>SomeNats</code>?).</p>\n\n<p>For example if I have a dependently typed vector <code>Vec (n :: Nat) a</code>, can I write code that works both if the size is known at compile and at runtime? Thing is that I don't want to duplicate the whole code for statically and dynamically sized \"things\". And I don't want to lose static guarantees by storing sizes in the data structure. </p>\n\n<h3>Edit</h3>\n\n<p>Answer to Andr\u00e1s Kov\u00e1cs:</p>\n\n<p>My specific usecase is reading images from disk (which are luckily of fixed size) and then extracting patches from that, so basically I have a function <code>extractPatch :: (KnownNat w2, KnownNat h2) =&gt; Image w1 h1 a -&gt; Patch w2 h2</code> a where both <code>Image</code> and <code>Patch</code> are instances of a common <code>Mat (w :: Nat) (h :: Nat)</code> a type. </p>\n\n<p>If I wouldn't know the image size I would have to encode this in \"runtime types\". Just wondering.</p>\n"}, {"tags": ["haskell", "applicative", "operator-sections"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1433926151, "post_id": 30748319, "comment_id": 49557025, "body": "in Scala you could have <code>_ &lt;$&gt; a &lt;*&gt; b</code> but Haskell has no such syntax."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1433937013, "post_id": 30748319, "comment_id": 49564138, "body": "@ErikAllik That&#39;s interesting syntax! I wonder if someone&#39;s written a template-haskell extension for it. That&#39;d be great."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1433937642, "post_id": 30748319, "comment_id": 49564595, "body": "but <code>_</code> has already been taken by typed holes; perhaps something similar though; although the lambda syntax is quite fine."}], "answers": [{"comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 2, "creation_date": 1433917135, "post_id": 30748372, "comment_id": 49551410, "body": "@frasertweedale: In that case, I\u2019d just use your first method. It\u2019s not as if it has to be a lambda, though. <code>g f = f &lt;$&gt; a1 &lt;*&gt; a2</code>"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 4, "creation_date": 1433920722, "post_id": 30748372, "comment_id": 49553524, "body": "@frasertweedale: Even when it\u2019s not just the top level, you can use <code>let</code> etc.. Less verbosity doesn\u2019t mean more clarity."}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": false, "score": 8, "last_activity_date": 1433916566, "creation_date": 1433916566, "answer_id": 30748372, "question_id": 30748319, "link": "https://stackoverflow.com/questions/30748319/operator-section-for-applicative-with-and/30748372#30748372", "title": "Operator section for applicative with &lt;$&gt; and &lt;*&gt;", "body": "<p><code>&lt;*&gt;</code> operates on the result of <code>&lt;$&gt;</code>, so:</p>\n\n<pre><code>g = (&lt;*&gt; a2) . (&lt;$&gt; a1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 6, "last_activity_date": 1433925159, "creation_date": 1433925159, "answer_id": 30751105, "question_id": 30748319, "link": "https://stackoverflow.com/questions/30748319/operator-section-for-applicative-with-and/30751105#30751105", "title": "Operator section for applicative with &lt;$&gt; and &lt;*&gt;", "body": "<p>I'm not really convinced pointfree can be made better than using an explicit argument here, but a couple more ideas:</p>\n\n<ul>\n<li><p>You can use <code>flip</code> infix:</p>\n\n<pre><code>g = liftA2 `flip` a1 `flip` a2\n</code></pre></li>\n<li><p>You can use <code>&gt;&gt;&gt;</code> from <code>Control.Category</code>, which is <code>.</code> flipped:</p>\n\n<pre><code>g = (&lt;$&gt; a1) &gt;&gt;&gt; (&lt;*&gt; a2)\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 820, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1433940227, "creation_date": 1433916337, "last_edit_date": 1433938698, "question_id": 30748319, "link": "https://stackoverflow.com/questions/30748319/operator-section-for-applicative-with-and", "title": "Operator section for applicative with &lt;$&gt; and &lt;*&gt;", "body": "<p>Consider functions of type <code>a -&gt; b -&gt; c</code>, and the applicative values <code>a1, a2 :: (Applicative f) =&gt; f a</code>.</p>\n\n<p>I wish to construct a function which may be applied to functions of type <code>a -&gt; b -&gt; c</code> to obtain values of type <code>Applicative f :: f c</code>.  I can do this in the following way:</p>\n\n<pre><code>g :: (Applicative f) =&gt; (a -&gt; b -&gt; c) -&gt; f c\ng = \\f -&gt; f &lt;$&gt; a1 &lt;*&gt; a2\n</code></pre>\n\n<p>(The explicit lambda is deliberate, as I am considering the construction of this function at any level, not just the top level).</p>\n\n<p>If I try to write <code>g</code> in point-free style:</p>\n\n<pre><code>g = (&lt;$&gt; a1 &lt;*&gt; a2)\n</code></pre>\n\n<p>I get the following compile error:</p>\n\n<pre><code>The operator `&lt;$&gt;' [infixl 4] of a section\n    must have lower precedence than that of the operand,\n      namely `&lt;*&gt;' [infixl 4]\n    in the section: `&lt;$&gt; gen1 &lt;*&gt; gen2'\n</code></pre>\n\n<p>I <em>could</em> write this point-free implementation:</p>\n\n<pre><code>g = flip (flip liftA2 a1) a2\n</code></pre>\n\n<p>but I feel that this is less readable, and it is simpler to refactor the infix function-based implementation to, e.g., add another argument, than changing the above to use <code>liftA3</code>.</p>\n\n<p>One can write a chain of compositions:</p>\n\n<pre><code>g = (&lt;*&gt; a2) . (&lt;$&gt; a1)\n</code></pre>\n\n<p>This achieves point-free style and it is simple to add arguments - but they get <em>prepended</em> on the left instead of appended on the right, so you lose the correspondence with the function type <code>(a -&gt; b -&gt; c)</code>.  Furthermore, with more arguments you end up with a much longer expression than just using a lambda as in the first implementation.</p>\n\n<p>So, is there are nice, terse way to write the section I desire, or am I stuck with a lambda?</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 7322, "user_id": 1027951, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0yrpY.jpg?s=128&g=1", "display_name": "m09", "link": "https://stackoverflow.com/users/1027951/m09"}, "edited": false, "score": 3, "creation_date": 1433918111, "post_id": 30747463, "comment_id": 49551895, "body": "looks like direct pasting of homeworks to me"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1433913565, "creation_date": 1433913565, "answer_id": 30747640, "question_id": 30747463, "link": "https://stackoverflow.com/questions/30747463/haskell-tree-problems/30747640#30747640", "title": "Haskell, Tree problems", "body": "<p><code>biep</code> returns <code>True</code> if an in-order traversal of the tree yields a strictly decreasing sequence.</p>\n\n<p>If the tree is empty, this claim is vacuously true - the sequence is empty, hence strictly decreasing. However, if it is not empty, then we need to check a couple of things</p>\n\n<ul>\n<li>that the left child (if it exists) has a larger value than the current node</li>\n<li>that the right child (if it exists) has a smaller value than the current node</li>\n<li>that both children's trees also obey the order property</li>\n</ul>\n\n<p>Hope that helps! </p>\n"}, {"tags": [], "owner": {"reputation": 1384, "user_id": 2916232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTZpa.jpg?s=128&g=1", "display_name": "Pavel P&#225;ja Halbich", "link": "https://stackoverflow.com/users/2916232/pavel-p%c3%a1ja-halbich"}, "is_accepted": false, "score": 0, "last_activity_date": 1433913573, "creation_date": 1433913573, "answer_id": 30747642, "question_id": 30747463, "link": "https://stackoverflow.com/questions/30747463/haskell-tree-problems/30747642#30747642", "title": "Haskell, Tree problems", "body": "<p>Hopefully I was able to rewrite it correctly:</p>\n\n<pre><code>biep :: (Ord a) =&gt; Tree a -&gt; Bool\nbiep Empty_Tree = True\nbiep (Node e left right) = (ibiep left e (&lt;) )&amp;&amp; (ibiep right e (&gt;))\n                          where ibiep Empty_Tree _ _ = True\n                                ibiep n@(Node en _ _) val op = ( e `op` en  ) &amp;&amp; (biep n)\n</code></pre>\n\n<p>You must include brackets when using data constructors.</p>\n"}], "owner": {"reputation": 11, "user_id": 4879159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8633f100bd4a1ba3ca0e6d03c864ff?s=128&d=identicon&r=PG&f=1", "display_name": "rabbithole", "link": "https://stackoverflow.com/users/4879159/rabbithole"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1433913573, "creation_date": 1433912583, "question_id": 30747463, "link": "https://stackoverflow.com/questions/30747463/haskell-tree-problems", "title": "Haskell, Tree problems", "body": "<pre><code>data Tree a = Empty_Tree\n | Node {element :: a, left_tree, right_tree :: Tree a}\n deriving (Eq)\nbiep :: (Ord a) =&gt; Tree a -&gt; Bool\nbiep tree = case tree of\n Empty_Tree -&gt; True\n Node e left right -&gt;\n (left == Empty_Tree || (e &lt; element left &amp;&amp; biep left )) &amp;&amp;\n (right == Empty_Tree || (e &gt; element right &amp;&amp; biep right))\n</code></pre>\n\n<p>The above codes can compile correctly.\nWhat can you say about a tree if <code>biep</code> tree returns True? </p>\n"}, {"tags": ["haskell", "binding", "bind", "chain"], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 1883963, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d801a0f467dfd454c939a2929910987d?s=128&d=identicon&r=PG", "display_name": "Tye", "link": "https://stackoverflow.com/users/1883963/tye"}, "edited": false, "score": 0, "creation_date": 1434004779, "post_id": 30749989, "comment_id": 49597443, "body": "Thank you. I guess that makes sense considering the relationship between do and binding. The value is used within the same case/scope."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1433922149, "last_edit_date": 1433922149, "creation_date": 1433921794, "answer_id": 30749989, "question_id": 30747005, "link": "https://stackoverflow.com/questions/30747005/how-do-i-reuse-an-intermediate-value-in-chain-of-haskell-either-binds/30749989#30749989", "title": "How do I reuse an intermediate value in chain of Haskell Either binds?", "body": "<p>You have to thread it all the way back up to where you need it.</p>\n\n<pre><code>repr &lt;- case playerInput of\n    -- now you have to return something of the appropriate type,\n    -- say, `Left \"didn't get it\"`, from these other cases.\n\n    _ -&gt; do let repr = ... &gt;&gt;= whatHandRepresents\n                handValue = repr &gt;&gt;= handBeatsCurrentTopTrick\n            -- use handValue\n            return repr\n-- now use repr :: Either String HandRepresentationOrWhatever\n</code></pre>\n\n<p>I sure hope you actually are using <code>handValue</code> within the default case and not trying to assign it for use later on.  It will only be in scope within that case; if you want to use it afterward you have to return it also, just like <code>repr</code> (e.g. in a tuple).</p>\n"}], "owner": {"reputation": 87, "user_id": 1883963, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d801a0f467dfd454c939a2929910987d?s=128&d=identicon&r=PG", "display_name": "Tye", "link": "https://stackoverflow.com/users/1883963/tye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 1, "accepted_answer_id": 30749989, "answer_count": 1, "score": 1, "last_activity_date": 1433922149, "creation_date": 1433909782, "question_id": 30747005, "link": "https://stackoverflow.com/questions/30747005/how-do-i-reuse-an-intermediate-value-in-chain-of-haskell-either-binds", "title": "How do I reuse an intermediate value in chain of Haskell Either binds?", "body": "<p>I'm sure this has been answered but apparently I don't know what to search for.</p>\n\n<p>I am working on my first non-trivial Haskell program -- a simulation of a card game I enjoy. I have the program working but there is a situation that I am certain can be handled better.</p>\n\n<p>If I have a series of binds which are <code>Either String TypeChangesBasedOnTheFunction</code>.  </p>\n\n<pre><code>playerInput &lt;- getLine\ncase playerInput of\n   {- CASE STUFF NOT IMPORTANT TO THIS QUESTION -}\n   _ -&gt; do let handValue = inputHasAllValidChars playerInput &gt;&gt;= makeDeckFromString &gt;&gt;= deckSubset (getCurrentPlayersDeck gameState) &gt;&gt;= whatHandRepresents &gt;&gt;= handBeatsCurrentTopTrick\n</code></pre>\n\n<p>Very soon after this part of the code runs, I need the value for <code>whatHandRepresents</code>. I can just run the same chain of binds again but I am certain there must be a better way by storing the value when it is determined in the code above.</p>\n\n<p>My question is, is it possible to store this value. If so, how?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433910302, "post_id": 30746953, "comment_id": 49548989, "body": "what is <code>httpLbs</code>? Based on the error I would guess that you need a <a href=\"https://hackage.haskell.org/package/http-types-0.8.1/docs/Network-HTTP-Types-Header.html#t:Header\" rel=\"nofollow noreferrer\"><code>HeaderName</code> from Types</a> but you use the one from <code>Headers</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433910494, "post_id": 30746953, "comment_id": 49549051, "body": "@Carsten httpLbs --&gt; <a href=\"https://hackage.haskell.org/package/http-client-0.2.1.1/docs/Network-HTTP-Client.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/http-client-0.2.1.1/docs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1433914066, "post_id": 30747141, "comment_id": 49550132, "body": "What am I using from <code>Network.HTTP.Conduit</code>? Or rather what am I using what I shouldn&#39;t be?"}, {"owner": {"reputation": 528, "user_id": 3066608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t0ZlK.png?s=128&g=1", "display_name": "creichert", "link": "https://stackoverflow.com/users/3066608/creichert"}, "edited": false, "score": 0, "creation_date": 1433916885, "post_id": 30747141, "comment_id": 49551277, "body": "You are currently using <code>httpLbs</code> from <code>http-conduit</code> which is a layer over <code>http-client</code> providing streaming capabilities. You imported <code>Network.HTTP.Conduit</code> in your pasted code, not <code>Network.HTTP.Client</code>. They are effectively the same thing in this example."}], "tags": [], "owner": {"reputation": 528, "user_id": 3066608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t0ZlK.png?s=128&g=1", "display_name": "creichert", "link": "https://stackoverflow.com/users/3066608/creichert"}, "is_accepted": true, "score": 1, "last_activity_date": 1433911618, "last_edit_date": 1433911618, "creation_date": 1433910664, "answer_id": 30747141, "question_id": 30746953, "link": "https://stackoverflow.com/questions/30746953/unable-to-create-a-custom-header-to-use-it-in-withmanager/30747141#30747141", "title": "Unable to create a custom header to use it in &quot;withManager&quot;", "body": "<p><a href=\"https://hackage.haskell.org/package/http-conduit-2.1.5/docs/Network-HTTP-Conduit.html\" rel=\"nofollow\">Network.HTTP.Conduit</a> and <a href=\"https://hackage.haskell.org/package/HTTP-4000.0.7/docs/Network-HTTP-Headers.html\" rel=\"nofollow\">Network.HTTP.Headers</a> are from incompatible HTTP libraries. Request headers for <code>http-conduit</code>/<code>http-client</code> can be created using the <code>http-types</code> library:</p>\n\n<pre><code>import Data.Aeson\nimport qualified Data.ByteString.Lazy as B\nimport Network.HTTP.Conduit as HHeaders\nimport qualified Network.HTTP.Types as HTypes\nimport qualified Data.ByteString.Char8 as C8\nimport qualified Data.ByteString.Lazy.Char8 as LC8\n\nmyHeader1 = (HTypes.hAccept, C8.pack \"some data\")\n\nget :: String -&gt; IO (Response LC8.ByteString)\nget url1 = do\n  req1 &lt;- parseUrl \"some url\"\n  res1 &lt;- withManager $ httpLbs req1 { method = HTypes.methodGet, requestHeaders = [myHeader1] }\n  return res1\n</code></pre>\n\n<p>To clarify:</p>\n\n<p>You were importing <a href=\"https://hackage.haskell.org/package/HTTP-4000.0.7/docs/Network-HTTP-Headers.html\" rel=\"nofollow\">Network.HTTP.Headers</a> from the <code>HTTP</code> library. Although the imports look similar, this is a self-contained library which defines it's own header types and not intended to be used with http-types.</p>\n\n<p><code>http-client</code> is compatible with the <code>http-types</code>. If you follow the definition for <a href=\"https://hackage.haskell.org/package/http-types-0.8.6/docs/Network-HTTP-Types-Header.html#t:RequestHeaders\" rel=\"nofollow\">RequestHeader</a> it will lead you to <code>http-types</code>.</p>\n\n<p>In the future, one way to check the compatibility of orthogonal libraries is to look at the build depends on the Hackage index or follow the types as far as possible.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 30747141, "answer_count": 1, "score": 1, "last_activity_date": 1433911618, "creation_date": 1433909391, "last_edit_date": 1433910274, "question_id": 30746953, "link": "https://stackoverflow.com/questions/30746953/unable-to-create-a-custom-header-to-use-it-in-withmanager", "title": "Unable to create a custom header to use it in &quot;withManager&quot;", "body": "<p>I can't create a custom header <strong>without using OverloadedStrings</strong></p>\n\n<pre><code>import Data.Aeson\nimport qualified Data.ByteString.Lazy as B\nimport Network.HTTP.Conduit\n\nimport qualified Network.HTTP.Headers as HHeaders\nimport qualified Network.HTTP.Types as HTypes\nimport qualified Data.ByteString.Char8 as C8\nimport qualified Data.ByteString.Lazy.Char8 as LC8\n\n-- myHeader1 = (HHeaders.HdrAccept $ C8.pack \"some data\")\nmyHeader1 = HHeaders.mkHeader HHeaders.HdrAccept \"some data\"\n\nget :: String -&gt; IO (Response LC8.ByteString)\nget url1 = do\n  req1 &lt;- parseUrl url1\n  res1 &lt;- withManager $ httpLbs req1 { method = HTypes.methodGet, requestHeaders = [myHeader1] }\n  return res1\n</code></pre>\n\n<p>An error:</p>\n\n<pre><code>Couldn't match type \u2018HHeaders.Header\u2019\n                   with \u2018(HTypes.HeaderName, C8.ByteString)\u2019\n    Expected type: HTypes.Header\n      Actual type: HHeaders.Header\n    In the expression: myHeader1\n    In the \u2018requestHeaders\u2019 field of a record\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["parsing", "haskell", "data-structures", "ascii", "pgm"], "comments": [{"owner": {"reputation": 121, "user_id": 1781815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab0b878bcf73c8f016480de339a88154?s=128&d=identicon&r=PG", "display_name": "danplubell", "link": "https://stackoverflow.com/users/1781815/danplubell"}, "edited": false, "score": 0, "creation_date": 1433937732, "post_id": 30744680, "comment_id": 49564644, "body": "The book Real World Haskell has an example that might be useful to you: <a href=\"http://book.realworldhaskell.org/read/code-case-study-parsing-a-binary-data-format.html\" rel=\"nofollow noreferrer\">book.realworldhaskell.org/read/&hellip;</a>"}, {"owner": {"reputation": 41, "user_id": 4992547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a23fbdb4b01ea9890f7a41b3d3801af?s=128&d=identicon&r=PG&f=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/4992547/florian"}, "reply_to_user": {"reputation": 121, "user_id": 1781815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab0b878bcf73c8f016480de339a88154?s=128&d=identicon&r=PG", "display_name": "danplubell", "link": "https://stackoverflow.com/users/1781815/danplubell"}, "edited": false, "score": 0, "creation_date": 1433941657, "post_id": 30744680, "comment_id": 49567601, "body": "@danplubell Thanks for the link. I have looked at this example already. The example code in the book is for raw pgm images but can be enhanced to read ascii pgms (There are some links with solutions in the comments).  My problem is that they don&#39;t parse comments. And i don&#39;t know how to add that. So i thought that a line by line solution would be easier to implement."}], "owner": {"reputation": 41, "user_id": 4992547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a23fbdb4b01ea9890f7a41b3d3801af?s=128&d=identicon&r=PG&f=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/4992547/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1434018317, "creation_date": 1433892947, "last_edit_date": 1434018317, "question_id": 30744680, "link": "https://stackoverflow.com/questions/30744680/how-to-parse-ascii-pgm-files-in-data-structures-with-haskell", "title": "How to parse ASCII PGM files in data structures with Haskell?", "body": "<p>I am completely new to functional programming and Haskell and i need to parse an ASCII PGM image into a data structure but i can't figure out how to do that.</p>\n\n<p>I have looked at quite a few examples (including the Graphics.Pgm module) but still don't know how to write it in Haskell. Here is what i have so far (this code does not compile):</p>\n\n<pre><code>import System.IO  \nimport Control.Monad\nimport Control.Applicative\nimport Data.Attoparsec.Char8\n\nimport qualified Data.ByteString as B\n\ndata ASCIIGreymap = ASCIIGreymap {\n      aGreyType    :: String\n    , aGreyComment :: String\n    , aGreyWidth   :: Int\n    , aGreyHeight  :: Int\n    , aGreyMax     :: Int\n    , aGreyData    :: [Int]\n    } deriving (Eq)\n\ninstance Show ASCIIGreymap where\n    show ( ASCIIGreymap t c w h m _ ) = \"ASCIIGreymap Type: \"++show t ++ \"Comment: \" ++ show c ++ \" w: \" ++ show w ++ \" h: \" ++ show h ++ \" max: \" ++ show m\n\nparseASCIIGreymap :: Parser ASCIIGreymap\nparseASCIIGreymap = do\n                      pgmType      &lt;- string\n                      pgmComment   &lt;- string\n                      pgmWidth     &lt;- integer\n                      char ' '\n                      pgmHeight    &lt;- integer\n                      pgmMax       &lt;- integer\n                      pgmGreyData  &lt;- [integer]\n                      return $ ASCIIGreymap pgmType pgmComment pgmWidth pgmHeight pgmMax pgmGreyData\n\n\n\npgmFile :: FilePath\npgmFile = \"test_ascii.pgm\"\n\nmain = B.readFile logFile &gt;&gt;= print . parseOnly parseASCIIGreymap\n</code></pre>\n\n<p>A example file (test_ascii.pgm) looks like this:</p>\n\n<pre><code>P2\n# CREATOR: GIMP PNM Filter Version 1.1\n10 10\n255\n0\n0\n0\n0\n0\n64\n255\n255\n255\n179\n0\n0\n0\n0\n0\n159\n255\n255\n255\n243\n0\n0\n0\n0\n96\n223\n255\n255\n255\n255\n0\n0\n64\n96\n223\n255\n255\n255\n255\n255\n128\n128\n191\n223\n255\n255\n255\n255\n255\n255\n255\n255\n255\n255\n255\n249\n217\n179\n128\n128\n255\n255\n255\n255\n249\n198\n89\n51\n0\n0\n255\n255\n255\n249\n198\n77\n0\n0\n0\n0\n255\n255\n255\n236\n128\n0\n0\n0\n0\n0\n191\n255\n255\n218\n51\n0\n0\n0\n0\n0\n</code></pre>\n\n<ol>\n<li>The first line holds the \"magicNumber\" where P2 stands for 8bit grey\nimage</li>\n<li>The second line is a comment</li>\n<li>The third line has the width and height of the image separated with\na space</li>\n<li>In the fourth line is the max grey value</li>\n<li>From here on to the end of the file are the grey values for each\npixel</li>\n</ol>\n\n<p>I would like to parse this pgm file into the data structure (ASCIIGreymap) to compare two images later. But like i said i don't know how to get there. If my approach is wrong or if there are better ways of parsing a pgm image please let me know.</p>\n\n<p>Any help is much appreciated!</p>\n\n<hr>\n\n<p>Edit: Since i haven't made any progress with parsing a pgm file i am not so sure anymore if my approach is correct.<br>\nCan someone please comment on my general idea to take the content of the file and put it in a data structure to further work with the data? Or is there a better way?</p>\n\n<p>Thanks again!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1433961139, "post_id": 30744548, "comment_id": 49581469, "body": "beware of the infinite lists!"}], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 4992699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29b1990896b63e27b78ab4b7c1b8d10?s=128&d=identicon&r=PG", "display_name": "Tejing", "link": "https://stackoverflow.com/users/4992699/tejing"}, "is_accepted": false, "score": 6, "last_activity_date": 1433894773, "creation_date": 1433894773, "answer_id": 30744957, "question_id": 30744548, "link": "https://stackoverflow.com/questions/30744548/elegant-way-to-return-the-longer-of-two-strings/30744957#30744957", "title": "Elegant way to return the longer of two strings", "body": "<p>That's pretty much the most concise way to write it. However, the version below will terminate even when one list is infinite (O(min(a,b)) instead of O(a + b)).</p>\n\n<pre><code>compareLengths :: [a] -&gt; [b] -&gt; Ordering\ncompareLengths [    ] [    ] = EQ\ncompareLengths (a:as) [    ] = GT\ncompareLengths [    ] (b:bs) = LT\ncompareLengths (a:as) (b:bs) = compareLengths as bs\n\nmaxList :: [a] -&gt; [a] -&gt; [a]\nmaxList a b = case compareLengths a b of\n  GT -&gt; a\n  _  -&gt; b\n</code></pre>\n\n<p>Also, there's no real reason to limit your function to just Strings when it would make sense for arbitrary lists.</p>\n"}, {"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1433897551, "post_id": 30745097, "comment_id": 49546021, "body": "You can also write <code>compare `on` length</code> as <code>comparing length</code>."}], "tags": [], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "is_accepted": false, "score": 8, "last_activity_date": 1433950057, "last_edit_date": 1433950057, "creation_date": 1433895870, "answer_id": 30745097, "question_id": 30744548, "link": "https://stackoverflow.com/questions/30744548/elegant-way-to-return-the-longer-of-two-strings/30745097#30745097", "title": "Elegant way to return the longer of two strings", "body": "<p>You can use existing Haskell facilities in <code>Data.Ord</code> and <code>Data.Function</code> and obtain a one-liner as follows:</p>\n\n<pre><code>maxString' x y = maximumBy (compare `on` length) [x, y]\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>import Data.Ord\nimport Data.Function\nimport Data.List\n\nmaxString' x y = maximumBy (compare `on` length) [x, y]\n\n*Main&gt; maxString' \"ab\" \"c\"\n\"ab\"\n</code></pre>\n\n<p>-- EDIT --</p>\n\n<p>As @DavidYoung pointed out, </p>\n\n<pre><code>compare `on` length\n</code></pre>\n\n<p>above can also be written in a shorter form:  <code>comparing length</code></p>\n"}, {"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1433911038, "post_id": 30745697, "comment_id": 49549201, "body": "This is interesting . kudos"}], "tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 9, "last_activity_date": 1433900605, "creation_date": 1433900605, "answer_id": 30745697, "question_id": 30744548, "link": "https://stackoverflow.com/questions/30744548/elegant-way-to-return-the-longer-of-two-strings/30745697#30745697", "title": "Elegant way to return the longer of two strings", "body": "<p>So far all answers except Tejing's fully traverse both arguments. This one only traverses as far as the end of the shorter one.</p>\n\n<pre><code>longest a b = l' a b where\n  l' _ [] = a\n  l' [] _ = b\n  l' (_:ar) (_:br) = l' ar br\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 8, "last_activity_date": 1433909062, "creation_date": 1433909062, "answer_id": 30746903, "question_id": 30744548, "link": "https://stackoverflow.com/questions/30744548/elegant-way-to-return-the-longer-of-two-strings/30746903#30746903", "title": "Elegant way to return the longer of two strings", "body": "<p>Played around with this one a bit. I wanted it to be a one-liner as well as having complexity <code>O(min(n,m))</code>. (ie. working even with infinite lists)</p>\n\n<pre><code>maxList :: [a] -&gt; [a] -&gt; [a]\nmaxList s s' = if s == zipWith const s s' then s' else s\n</code></pre>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 2, "answer_count": 4, "score": 6, "last_activity_date": 1436549141, "creation_date": 1433892210, "last_edit_date": 1436549141, "question_id": 30744548, "link": "https://stackoverflow.com/questions/30744548/elegant-way-to-return-the-longer-of-two-strings", "title": "Elegant way to return the longer of two strings", "body": "<p>I'm trying to write a function that returns the longer of two strings. So far this is what I have:</p>\n\n<pre><code>maxString :: String -&gt; String -&gt; String\nmaxString a b\n    | (length a) &gt; (length b) = a\n    | otherwise = b\n</code></pre>\n\n<p>This works, but I'm wondering if there is a more elegant way to write this. Note: the two arguments cannot be in a list. They must be separate arguments to allow for currying.</p>\n\n<p>Thoughts?</p>\n"}, {"tags": ["java", "swing", "haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 404, "user_id": 6351392, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c7cba4bdef771e7018ba130cac8e7cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Haemin Yoo", "link": "https://stackoverflow.com/users/6351392/haemin-yoo"}, "edited": false, "score": 0, "creation_date": 1533282260, "post_id": 30742663, "comment_id": 90298039, "body": "the import should be <code>Monad.Hooks.SetWMName</code>. I wonder why StackOverflow doesn&#39;t allow edits that change only one character."}, {"owner": {"reputation": 23192, "user_id": 2684, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/Z9oZ0.jpg?s=128&g=1", "display_name": "Martin Marconcini", "link": "https://stackoverflow.com/users/2684/martin-marconcini"}, "edited": false, "score": 0, "creation_date": 1589978056, "post_id": 30742663, "comment_id": 109505939, "body": "This works for Android Studio (3.6.x at the moment) on a fresh Ubuntu where you install XMonad and launch Android Studio."}], "tags": [], "owner": {"reputation": 19188, "user_id": 390708, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/34539ce56dfaf01d34a91861205f379d?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/390708/brian"}, "is_accepted": false, "score": 11, "last_activity_date": 1589978009, "last_edit_date": 1589978009, "creation_date": 1433883349, "answer_id": 30742663, "question_id": 30742662, "link": "https://stackoverflow.com/questions/30742662/java-swing-gui-not-displaying-in-xmonad/30742663#30742663", "title": "Java Swing GUI Not Displaying in Xmonad", "body": "<p>In <code>~/.xmonad/xmonad.hs</code> add  <code>import XMonad.Hooks.SetWMName</code>.</p>\n\n<p>Then add <code>startupHook = setWMName \"LG3D\"</code> to tell Xmonad to use <code>LG3D</code> as the window manager name.</p>\n\n<pre><code>xmonad $ defaultConfig\n  { ...\n    startupHook = setWMName \"LG3D\",\n  }\n</code></pre>\n\n<p>Lastly, restart Xmonad using mod-q to reload xmonad.hs.</p>\n\n<p>Sources:</p>\n\n<p><a href=\"http://thinkingeek.com/2012/01/24/fix-java-gui-applications-xmonad/\" rel=\"nofollow noreferrer\">http://thinkingeek.com/2012/01/24/fix-java-gui-applications-xmonad/</a></p>\n\n<p><a href=\"http://xmonad.org/xmonad-docs/xmonad-contrib/XMonad-Hooks-SetWMName.html\" rel=\"nofollow noreferrer\">http://xmonad.org/xmonad-docs/xmonad-contrib/XMonad-Hooks-SetWMName.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 1004, "user_id": 267437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30d6fbf81284ac9005e8e9ccc7ecfb1e?s=128&d=identicon&r=PG", "display_name": "David Kay", "link": "https://stackoverflow.com/users/267437/david-kay"}, "is_accepted": false, "score": 2, "last_activity_date": 1469646094, "creation_date": 1469646094, "answer_id": 38621162, "question_id": 30742662, "link": "https://stackoverflow.com/questions/30742662/java-swing-gui-not-displaying-in-xmonad/38621162#38621162", "title": "Java Swing GUI Not Displaying in Xmonad", "body": "<p>For a 100% explicit answer, just paste this into <code>~/.xmonad/xmonad.hs</code>:</p>\n\n<pre><code>import XMonad\nimport XMonad.Hooks.SetWMName\n\nmain = xmonad defaultConfig\n    { startupHook = setWMName \"LG3D\" }\n</code></pre>\n"}], "owner": {"reputation": 19188, "user_id": 390708, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/34539ce56dfaf01d34a91861205f379d?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/390708/brian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1710, "favorite_count": 1, "answer_count": 2, "score": 11, "last_activity_date": 1589978009, "creation_date": 1433883349, "question_id": 30742662, "link": "https://stackoverflow.com/questions/30742662/java-swing-gui-not-displaying-in-xmonad", "title": "Java Swing GUI Not Displaying in Xmonad", "body": "<p>I have a Java swing GUI that runs and displays fine using other window managers but when I run it in Xmonad it does not display correctly. All that displays is the frame of the window which is grayed out with no buttons, menus, etc. How can I make the Swing GUI display correctly?</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 130, "user_id": 4556259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa05e19e1fe6c92d35f0d1631e70d4d6?s=128&d=identicon&r=PG&f=1", "display_name": "Joris Buchou", "link": "https://stackoverflow.com/users/4556259/joris-buchou"}, "edited": false, "score": 0, "creation_date": 1433958643, "post_id": 30757307, "comment_id": 49579881, "body": "Thank you very much. The solution I found was really close from your second way. But I didn&#39;t handle the empty array case. Good catch."}], "tags": [], "owner": {"reputation": 1585, "user_id": 1413081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8d1f596731eaae04f3ade303d211ca?s=128&d=identicon&r=PG", "display_name": "Reite", "link": "https://stackoverflow.com/users/1413081/reite"}, "is_accepted": true, "score": 3, "last_activity_date": 1433941719, "creation_date": 1433941719, "answer_id": 30757307, "question_id": 30742375, "link": "https://stackoverflow.com/questions/30742375/pattern-match-vector-value-in-data-aeson/30757307#30757307", "title": "Pattern Match Vector Value in Data.Aeson", "body": "<p>No, you cannot pattern match the way you are trying to do here. A JSON Array can contain values of different types, and you cannot pattern match on all values in a list like they where one.</p>\n\n<p>There are several ways to solve your actual problem here. There is a <strong>easy way</strong>, and there is an <strong>explicit way</strong> that will give you better error messages. </p>\n\n<h3>Easy way</h3>\n\n<p>The easy way is to use the fact that there already exist <code>FromJSON</code> instances for <code>Text</code> and <code>[a]</code>. Because of this you can use the <code>Alternative</code> operator to write your instance like this:</p>\n\n<pre><code>instance FromJSON Foo where\n    parseJSON v =  (SimpleText &lt;$&gt; parseJSON v) \n               &lt;|&gt; (ListOfText &lt;$&gt; parseJSON v) \n               &lt;|&gt; (ListOfListOfText &lt;$&gt; parseJSON v)\n</code></pre>\n\n<p>The trick here is that Aeson first will try to parse a <code>Text</code> value, then if it fails it will try a <code>[Text]</code>, if it fails again it will try <code>[[Text]]</code>.</p>\n\n<p>The problem with this solution is that if your JSON is malformed the error messages might not make sense. For example if you give it a top level Null value your error will be that it expects a <code>[[Text]]</code>, since you will always get the error for the last value in the chain.</p>\n\n<h3>Explicit way</h3>\n\n<p>To get better error messages you have to be more expicit about what values you expect. What if the result is an empty array, should it be a <code>ListOfText</code> or a <code>ListOfListOfText</code>? Since we cant pattern match on a <code>Vector</code> directly, we can turn it into a list and pattern match on it:</p>\n\n<pre><code>instance FromJSON Foo where\n    parseJSON v = case v of\n        -- If its a string, we return the string as a SimpleText\n        (String s) -&gt; return $ SimpleText s\n\n        -- If its an array, we turn the vector to a list so we can pattern match on it\n        (Array a)  -&gt; case V.toList a of\n\n            -- If its a empty list, we return a empty ListOfText\n            []             -&gt; return $ ListOfText []\n\n            -- If the first value is a string, we put it as the first element of our ListOfTexts and try to parse the rest.\n            (String s: xs) -&gt; ListOfText . (s:) &lt;$&gt; mapM parseJSON xs\n\n            -- If the first value is an array, we try to parse it as [Text], then parse the rest.\n            (Array a: xa)  -&gt; ListOfListOfText &lt;$&gt; ((:) &lt;$&gt; parseJSON (Array a) &lt;*&gt; mapM parseJSON xa)\n\n            -- If the first value is neither a string or array we return a error message.\n            _              -&gt; fail \"Expected an Array or an Array of Arrays.\"\n\n        -- If the top level value is not a string or array we return a error message.\n        _ -&gt; fail \"Expected a String or Array\"\n</code></pre>\n"}], "owner": {"reputation": 130, "user_id": 4556259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa05e19e1fe6c92d35f0d1631e70d4d6?s=128&d=identicon&r=PG&f=1", "display_name": "Joris Buchou", "link": "https://stackoverflow.com/users/4556259/joris-buchou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 0, "accepted_answer_id": 30757307, "answer_count": 1, "score": 4, "last_activity_date": 1433941719, "creation_date": 1433882310, "question_id": 30742375, "link": "https://stackoverflow.com/questions/30742375/pattern-match-vector-value-in-data-aeson", "title": "Pattern Match Vector Value in Data.Aeson", "body": "<p>I am using Data.Aeson to parse JSON to my custom type. \nI try to pattern match <code>Vector Value</code> (<code>Array</code>) in my <code>FromJSON</code> instance, but don't know how I can do it. JSON <code>value</code> key can have a value of a <code>String</code>, a list of <code>String</code> or a list of list of <code>String</code>.</p>\n\n<pre><code>instance FromJSON Foo where\n  parseJSON (Object o) =\n    case lookup \"value\" o of\n      Just (String s) -&gt; pure $ SimpleText s\n      Just foo@(Array (String s)) -&gt; pure $ ListOfText $ V.toList &lt;$&gt; V.mapM (parseJSON :: Value -&gt; Parser Text) foo\n      Just foo@(Array (Array (String s))) -&gt; pure $ ListOfListOfText $ V.toList &lt;$&gt; V.mapM (parseJSON :: Value -&gt; Parser Text) $ V.toList &lt;$&gt; V.mapM (parseJSON :: Value -&gt; [Parser Value]) foo\n</code></pre>\n\n<p>with  </p>\n\n<pre><code>data Foo = SimpleText Text\n         | ListOfText [Text]\n         | ListOfListOfText [[Text]]\n         deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>Can I use pattern matching on Array to handle this case? or should I manually check the type of every <code>Value</code>? and how do to it? </p>\n"}, {"tags": ["list", "haskell", "random"], "comments": [{"owner": {"reputation": 4172, "user_id": 2466193, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/924f98d3b38288b4dba37b636c0e714a?s=128&d=identicon&r=PG", "display_name": "Ali Beadle", "link": "https://stackoverflow.com/users/2466193/ali-beadle"}, "edited": false, "score": 1, "creation_date": 1433876104, "post_id": 30740366, "comment_id": 49536872, "body": "Please describe in more detail what is not working with what you have at present."}], "answers": [{"comments": [{"owner": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 1, "creation_date": 1532380359, "post_id": 30740538, "comment_id": 89943606, "body": "And then we can write it point-free <code>test = ($ randomRIO (1,6::Int)) . replicateM</code>"}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": false, "score": 13, "last_activity_date": 1433876244, "creation_date": 1433876244, "answer_id": 30740538, "question_id": 30740366, "link": "https://stackoverflow.com/questions/30740366/list-with-random-numbers-in-haskell/30740538#30740538", "title": "List with random numbers in Haskell", "body": "<p>You need to run <code>randomRIO</code> n times. For this you can use <code>replicate</code>. This will give you a list of monadic values, that you can transform into a monadic list of values with <code>sequence</code>:</p>\n\n<pre><code>test :: Int -&gt; IO [Int]\ntest n = sequence $ replicate n $ randomRIO (1,6::Int)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 8, "last_activity_date": 1433878851, "last_edit_date": 1433878851, "creation_date": 1433878167, "answer_id": 30741139, "question_id": 30740366, "link": "https://stackoverflow.com/questions/30740366/list-with-random-numbers-in-haskell/30741139#30741139", "title": "List with random numbers in Haskell", "body": "<p>While JP Moresmau solution is certainly preferable, you might be interested in a more transparent solution that shines some light on the <code>do</code> notation and recursive functions using <code>IO</code>:</p>\n\n<pre><code>import System.Random (randomRIO)\n\nrandomList :: Int -&gt; IO([Int])\nrandomList 0 = return []\nrandomList n = do\n  r  &lt;- randomRIO (1,6)\n  rs &lt;- randomList (n-1)\n  return (r:rs) \n</code></pre>\n\n<p>you should note the following:</p>\n\n<ul>\n<li>if <code>n == 0</code> the function will use <code>return</code> to wrap the empty list into <code>IO</code> and return this</li>\n<li>else inside the <code>do</code> body it will first generate a random number <code>r</code> using <code>randomRIO</code></li>\n<li>next it will recursively generate a <code>n-1</code> element list of random numbers using <code>randomList (n-1)</code> and bind it to <code>rs</code></li>\n<li>finally it uses <code>return</code> again to wrap <code>r:rs</code> (a <code>n</code> element list) into <code>IO</code> and return it</li>\n</ul>\n\n<p>here is an example in <strong>GHCi</strong>:</p>\n\n<pre><code>\u03bb&gt; randomList 10\n[2,4,4,5,2,2,2,5,6,2]\n\n\u03bb&gt; randomList 10\n[2,4,4,2,5,2,6,3,4,1]\n</code></pre>\n\n<p>seems random enough</p>\n\n<h3>remarks/exercise:</h3>\n\n<p>the function has a problem with certain values of <code>n</code> - can <strong>you</strong> spot it? And if so - can you change the function to be <em>total</em>?</p>\n\n<h3>having some fun</h3>\n\n<p>If you look closely you see that you can pull out <code>randomRIO (1,6) :: IO Int</code> there like this:</p>\n\n<pre><code>mList :: Int -&gt; IO a -&gt; IO([a])\nmList 0 gen = return []\nmList n gen = do\n  r  &lt;- gen\n  rs &lt;- mList(n-1) gen\n  return (r:rs) \n</code></pre>\n\n<p>which of course you would have to use like this:</p>\n\n<pre><code>\u03bb&gt; mList 10 $ randomRIO (1,6)\n[2,2,2,5,5,1,3,6,6,1]\n</code></pre>\n\n<p>now this has been done before (in a slightly different/better) way and you can find it as <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:replicateM\"><code>replicateM</code></a> in <code>Control.Monad</code> - with this import the function simplifies to:</p>\n\n<pre><code>import System.Random (randomRIO)\nimport Control.Monad (replicateM)\n\nrandomList :: Int -&gt; IO([Int])\nrandomList n = replicateM n $ randomRIO (1,6)\n</code></pre>\n\n<p><strong>fun fact</strong> <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/Control-Monad.html#replicateM\">internally</a> this is implemented exactly as what JP answered ;)</p>\n"}, {"tags": [], "owner": {"reputation": 914, "user_id": 4135158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ecuuA.jpg?s=128&g=1", "display_name": "Santa Claus", "link": "https://stackoverflow.com/users/4135158/santa-claus"}, "is_accepted": false, "score": 2, "last_activity_date": 1541775123, "last_edit_date": 1541775123, "creation_date": 1541774290, "answer_id": 53227810, "question_id": 30740366, "link": "https://stackoverflow.com/questions/30740366/list-with-random-numbers-in-haskell/53227810#53227810", "title": "List with random numbers in Haskell", "body": "<p>Using only one generator and infinite list</p>\n\n<pre><code>import Data.List\nimport System.Random\n\nrandomList :: (Int, Int) -&gt; IO [Int]\nrandomList interval =\n  newStdGen &gt;&gt;= return . unfoldr (Just . randomR interval)\n\nmain :: IO ()\nmain = do\n  ls &lt;- randomList (1, 6)\n  putStrLn $ show $ take 4 ls\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 4991913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000708939116/picture?type=large", "display_name": "Thiago Almeida Marques", "link": "https://stackoverflow.com/users/4991913/thiago-almeida-marques"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7534, "favorite_count": 0, "accepted_answer_id": 30741139, "answer_count": 3, "score": 4, "last_activity_date": 1541775123, "creation_date": 1433875689, "question_id": 30740366, "link": "https://stackoverflow.com/questions/30740366/list-with-random-numbers-in-haskell", "title": "List with random numbers in Haskell", "body": "<p>I want to generate a list with random numbers in Haskell. I have to use the import System.Random library. I started doing something like that but it doesn't work. I have to create a list with N positions, and all these positions must have random numbers. Thanks!</p>\n\n<pre><code>System.Random library\nimport System.IO\n\nx = randomRIO (1,6::Int) \n\ntest :: IO Int\ntest = randomRIO (1,6::Int)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1433876360, "post_id": 30738815, "comment_id": 49537034, "body": "What are you trying to achieve that you can&#39;t do with the date time support in the base libraries"}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1433901570, "post_id": 30738815, "comment_id": 49546969, "body": "@JPMoresmau, what&#39;s the date time support in the base libraries?"}, {"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1433914958, "post_id": 30738815, "comment_id": 49550443, "body": "Look at <a href=\"http://hackage.haskell.org/package/time\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/time</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1433915025, "post_id": 30738815, "comment_id": 49550469, "body": "@JPMoresmau, thank you."}], "answers": [{"comments": [{"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "edited": false, "score": 0, "creation_date": 1437403191, "post_id": 31502679, "comment_id": 50999869, "body": "Note that there is an ongoing process about updating the original package on Hackage <a href=\"https://github.com/stackbuilders/datetime/issues/3\" rel=\"nofollow noreferrer\">github.com/stackbuilders/datetime/issues/3</a>"}], "tags": [], "owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "is_accepted": false, "score": 1, "last_activity_date": 1437480904, "last_edit_date": 1437480904, "creation_date": 1437318739, "answer_id": 31502679, "question_id": 30738815, "link": "https://stackoverflow.com/questions/30738815/date-time-package-in-haskell-error-in-the-current-one-cant-find-an-analog/31502679#31502679", "title": "Date-time package in haskell - error in the current one, can&#39;t find an analog", "body": "<p>Luckily <a href=\"http://www.stackbuilders.com/\" rel=\"nofollow\">Stack Builders</a> wrote a version which is compatible with the latest compiler. You can find the source <a href=\"https://github.com/stackbuilders/datetime\" rel=\"nofollow\">here</a>. As the repo doc says, this is updated to Hackage with the name <code>datetime-sb</code>, so you can install it and use it in your dependencies exactly like the original library, just substituting <code>datetime</code> with <code>datetime-sb</code> wherever you need to refer to the package name</p>\n\n<hr>\n\n<h3>Edit:</h3>\n\n<p>Eventually <a href=\"https://github.com/stackbuilders/datetime/issues/3#issuecomment-123070968\" rel=\"nofollow\">Stack Builders took over</a> maintaining the <code>datetime</code> package. This problem should not happen anymore for anybody</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437480904, "creation_date": 1433870677, "question_id": 30738815, "link": "https://stackoverflow.com/questions/30738815/date-time-package-in-haskell-error-in-the-current-one-cant-find-an-analog", "title": "Date-time package in haskell - error in the current one, can&#39;t find an analog", "body": "<p>When I was installing the package datetime I got an error in it:</p>\n\n<pre><code>$ cabal install datetime\nResolving dependencies...\nConfiguring datetime-0.2.1...\nBuilding datetime-0.2.1...\nPreprocessing library datetime-0.2.1...\n[1 of 1] Compiling Data.DateTime    ( src/Data/DateTime.lhs, dist/dist-sandbox-5f6496af/build/Data/DateTime.o )\n\nsrc/Data/DateTime.lhs:139:31:\n    Ambiguous occurrence \u2018defaultTimeLocale\u2019\n    It could refer to either \u2018Data.Time.Format.defaultTimeLocale\u2019,\n                             imported from \u2018Data.Time.Format\u2019 at src/Data/DateTime.lhs:8:3-25\n                             (and originally defined in \u2018time-1.5.0.1:Data.Time.Format.Locale\u2019)\n                          or \u2018System.Locale.defaultTimeLocale\u2019,\n                             imported from \u2018System.Locale\u2019 at src/Data/DateTime.lhs:12:3-22\n\nsrc/Data/DateTime.lhs:142:29:\n    Ambiguous occurrence \u2018defaultTimeLocale\u2019\n    It could refer to either \u2018Data.Time.Format.defaultTimeLocale\u2019,\n                             imported from \u2018Data.Time.Format\u2019 at src/Data/DateTime.lhs:8:3-25\n                             (and originally defined in \u2018time-1.5.0.1:Data.Time.Format.Locale\u2019)\n                          or \u2018System.Locale.defaultTimeLocale\u2019,\n                             imported from \u2018System.Locale\u2019 at src/Data/DateTime.lhs:12:3-22\n\nsrc/Data/DateTime.lhs:144:15:\n    Ambiguous occurrence \u2018iso8601DateFormat\u2019\n    It could refer to either \u2018Data.Time.Format.iso8601DateFormat\u2019,\n                             imported from \u2018Data.Time.Format\u2019 at src/Data/DateTime.lhs:8:3-25\n                             (and originally defined in \u2018time-1.5.0.1:Data.Time.Format.Locale\u2019)\n                          or \u2018System.Locale.iso8601DateFormat\u2019,\n                             imported from \u2018System.Locale\u2019 at src/Data/DateTime.lhs:12:3-22\nFailed to install datetime-0.2.1\ncabal: Error: some packages failed to install:\ndatetime-0.2.1 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>Since its repository at github doesn't exist anymore, what do you suggest me: somehow fix the error or chose another package? I tried to find another find but couldn't. What I need is to be able to work with the date-times.</p>\n"}, {"tags": ["multithreading", "haskell", "gtk", "reactive-banana"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433867697, "post_id": 30737397, "comment_id": 49531794, "body": "<code>forever $ return ()</code> is a bad idea -- wait for the <code>mainGUI</code> thread to finish instead. e.g. <a href=\"http://hackage.haskell.org/package/threads-0.5.1.3/docs/Control-Concurrent-Thread.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/threads-0.5.1.3/docs/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433871198, "post_id": 30737397, "comment_id": 49533933, "body": "Also, you should use <code>forkOS mainGUI</code>. See <a href=\"http://dmwit.com/gtk2hs\" rel=\"nofollow noreferrer\">my discussion of multithreading in gtk2hs</a> for why."}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1433936167, "post_id": 30737397, "comment_id": 49563524, "body": "(Author of reactive-banana here.) I think the issue is independent of reactive-banana. It seems to me that you need <code>-threaded</code> in order for <code>threadWaitRead</code> to be run concurrently with with the GTK GUI; not entirely sure though."}, {"owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1435322342, "post_id": 30737397, "comment_id": 50165491, "body": "@HeinrichApfelmus Yes, it&#39;s pretty independent of reactive-banana, I just included the info to better explain my use case. Also, this is my second reactive-banana question you&#39;ve answered personally -- thanks for being so active!"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1433876714, "creation_date": 1433876714, "answer_id": 30740690, "question_id": 30737397, "link": "https://stackoverflow.com/questions/30737397/multithreading-and-gtk2hs/30740690#30740690", "title": "Multithreading and gtk2hs", "body": "<p>The basic problem here is that, in Haskell, as soon as <code>main</code> exits, the entire program is torn down. The solution is simply to keep the <code>main</code> thread open; e.g.</p>\n\n<pre><code>done &lt;- newEmptyMVar\nforkOS (mainGUI &gt;&gt; putMVar done ())\ntakeMVar done\n</code></pre>\n\n<p>I've also replaced <code>forkIO</code> with <code>forkOS</code>. GTK uses (OS-)thread-local state on Windows, so as a matter of defensive programming it is best to ensure that <code>mainGUI</code> runs on a bound thread just in case one day you want to support Windows.</p>\n"}, {"tags": [], "owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "is_accepted": false, "score": 1, "last_activity_date": 1435323398, "creation_date": 1435323398, "answer_id": 31073785, "question_id": 30737397, "link": "https://stackoverflow.com/questions/30737397/multithreading-and-gtk2hs/31073785#31073785", "title": "Multithreading and gtk2hs", "body": "<p>Daniel Wagner answered my question as asked, but I got a more informative perspective from the #haskell IRC channel, which I'll post here for future reference. </p>\n\n<p>Rather than jumping through awkward hoops of forking off the GUI thread and putting the main thread to sleep, a better solution is to let the main thread be the GUI thread and deal with the reactive-banana event network in a new thread. I ended up modifying my <code>main</code> function to contain the following: </p>\n\n<pre><code>keyChan &lt;- newChan\n_ &lt;- forkIO $ watchKeys keyPress keyChan\n_ &lt;- win `on` keyPressEvent $\n    eventKeyVal &gt;&gt;= liftIO . writeChan keyChan &gt;&gt; return True\n</code></pre>\n\n<p>where <code>watchKeys</code> is defined as:</p>\n\n<pre><code>watchKeys :: EventSource KeyVal -&gt; Chan KeyVal -&gt; IO ()\nwatchKeys keyPress chan = forever $\n    readChan chan &gt;&gt;= fire keyPress \n</code></pre>\n\n<p>Now I can deal with the <code>postGUI(A)Sync</code> issues in exactly one place, by defining:</p>\n\n<pre><code>reactimateSafe :: Frameworks t =&gt; Event t (IO ()) -&gt; Moment t ()\nreactimateSafe = reactimate . fmap postGUIAsync\n</code></pre>\n\n<p>and using <code>reactimateSafe</code> for any IO action that modifies a GTK object</p>\n"}], "owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 30740690, "answer_count": 2, "score": 2, "last_activity_date": 1435323398, "creation_date": 1433866159, "question_id": 30737397, "link": "https://stackoverflow.com/questions/30737397/multithreading-and-gtk2hs", "title": "Multithreading and gtk2hs", "body": "<p>I'm writing some code with reactive-banana and gtk2hs that needs to read from a file handle. I need to have at least two threads (one to read keyboard events with reactive banana and one to read from the file handle), so at the moment I have code that looks something like this:</p>\n\n<pre><code>type EventSource a = (AddHandler a, a -&gt; IO ())\n\nfire :: EventSource a -&gt; a -&gt; IO ()\nfire = snd\n\nwatch :: EventSource ByteString -&gt; Handle -&gt; IO ()\nwatch textIn pty = forever $\n  hGetLine pty &gt;&gt;= fire textIn &gt;&gt; threadWaitRead pty\n</code></pre>\n\n<p>With the following main function:</p>\n\n<pre><code>mainAxn :: IO ()\nmainAxn = do\n  h &lt;- openFile \"foo\" ReadMode\n\n  initGUI\n\n  win &lt;- windowNew\n  txt &lt;- textViewNew\n\n  containerAdd win txt\n\n  widgetShowAll win\n\n  (keyPress, textIn) &lt;-\n    (,) &lt;$&gt; newAddHandler &lt;*&gt; newAddHandler\n  network &lt;- setupNetwork keyPress textIn\n  actuate network\n\n  _ &lt;- forkIO $ watch textIn h\n\n  _ &lt;- win `on` keyPressEvent $\n       eventKeyVal &gt;&gt;= liftIO . fire keyPress &gt;&gt; return True\n\n  mainGUI\n</code></pre>\n\n<p>and my event network set up as follows:</p>\n\n<pre><code>setupNetwork :: EventSource KeyVal -&gt; EventSource ByteString -&gt; IO EventNetwork\nsetupNetwork keyPress textIn = compile $ do\n  ePressed &lt;- fromAddHandler $ addHandler keyPress\n  eText &lt;- fromAddHandler $ addHandler textIn\n\n  reactimate $ print &lt;$&gt; (filterJust $ keyToChar &lt;$&gt; ePressed)\n  reactimate $ print &lt;$&gt; eText\n</code></pre>\n\n<p>(except in my actual code, those <code>reactimate</code> calls write to the <code>TextView</code> built in <code>mainAxn</code>). I found that I needed to build with <code>-threaded</code> to make the event network correctly capture both text from <code>textIn</code> and keypresses from <code>keyPress</code>, which caused issues because it's not safe to modify objects from the gtk package concurrently. </p>\n\n<p>At the moment, I have <code>postGUIAsync</code> calls scattered throughout my code, and I've found that using <code>postGUISync</code> causes the whole thing to deadlock --- I'm not sure why. I think it's because I end up calling <code>postGUISync</code> inside of the same thread that ran <code>mainGUI</code>.</p>\n\n<p>It seems like it would be better to run all of the GUI stuff in its own thread and use the <code>postGUI*</code> functions for every access to it. However, when I change the last line of <code>mainAxn</code> to be </p>\n\n<pre><code>forkIO mainGUI\nreturn ()\n</code></pre>\n\n<p>the program returns immediately when it hits the end of <code>mainAxn</code>. I tried to fix that by using:</p>\n\n<pre><code>forkIO mainGUI \nforever $ return ()\n</code></pre>\n\n<p>but then the gtk GUI never opens at all, and I don't understand why.</p>\n\n<p>What's the right way to do this? What am I missing?</p>\n"}, {"tags": ["haskell", "threepenny-gui"], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 4438776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512bdc9775b923e0444553ea5d919854?s=128&d=identicon&r=PG", "display_name": "655321", "link": "https://stackoverflow.com/users/4438776/655321"}, "edited": false, "score": 0, "creation_date": 1433870861, "post_id": 30737384, "comment_id": 49533746, "body": "Thanks, now that i found <code>sink</code>, the whole question looks a bit stupid. Got the program to work though (although the listbox selection doesn&#39;t actually change and I&#39;m only reading the <code>facts</code>-part of <code>userSelection</code>)."}, {"owner": {"reputation": 195, "user_id": 4438776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512bdc9775b923e0444553ea5d919854?s=128&d=identicon&r=PG", "display_name": "655321", "link": "https://stackoverflow.com/users/4438776/655321"}, "edited": false, "score": 0, "creation_date": 1433883524, "post_id": 30737384, "comment_id": 49541211, "body": "I don&#39;t know how many people will read this anymore, but I&#39;m still having a hard time making the actual change happen. I&#39;m pretty sure the <code>rumors</code> of <code>userSelection</code> should be read somewhere and the <code>facts</code> changed accordingly but I don&#39;t know how to do this."}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 1, "last_activity_date": 1433866107, "creation_date": 1433866107, "answer_id": 30737384, "question_id": 30735436, "link": "https://stackoverflow.com/questions/30735436/changes-in-other-elements-based-on-listbox-selections-in-threepenny-gui/30737384#30737384", "title": "Changes in other elements based on listbox selections in threepenny-gui", "body": "<p><em>Caution</em>: I am not familiar with ThreePenny, I'm just reading the documentation.</p>\n\n<p>I think you need to <code>sink</code> your listbox into your text area:</p>\n\n<pre><code>element display # sink UI.text ((maybe \"new text\" id) &lt;$&gt; (facts $ userSelection listBox)) \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 195, "user_id": 4438776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512bdc9775b923e0444553ea5d919854?s=128&d=identicon&r=PG", "display_name": "655321", "link": "https://stackoverflow.com/users/4438776/655321"}, "edited": false, "score": 0, "creation_date": 1434580783, "post_id": 30854314, "comment_id": 49846076, "body": "Well, first the types in <code>stepper Nothing (userSelection listBox)</code> don&#39;t match (I tried <code>stepper Nothing (rumors $ userSelection listBox)</code>). I still can&#39;t get anything to happen, even with just <a href=\"http://pastebin.com/D97sFUuA\" rel=\"nofollow noreferrer\">pastebin.com/D97sFUuA</a> (the value changes when clicking the button, but always to &quot;new text&quot;)."}, {"owner": {"reputation": 195, "user_id": 4438776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512bdc9775b923e0444553ea5d919854?s=128&d=identicon&r=PG", "display_name": "655321", "link": "https://stackoverflow.com/users/4438776/655321"}, "edited": false, "score": 0, "creation_date": 1434581361, "post_id": 30854314, "comment_id": 49846278, "body": "There really is something I don&#39;t understand about these <code>Tidings</code> and <code>Behavior</code> -things as I can&#39;t get this to work."}, {"owner": {"reputation": 31, "user_id": 784936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9548ee722349753e11bf6ddd9f4ca161?s=128&d=identicon&r=PG", "display_name": "Massudaw", "link": "https://stackoverflow.com/users/784936/massudaw"}, "reply_to_user": {"reputation": 195, "user_id": 4438776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512bdc9775b923e0444553ea5d919854?s=128&d=identicon&r=PG", "display_name": "655321", "link": "https://stackoverflow.com/users/4438776/655321"}, "edited": false, "score": 0, "creation_date": 1434743947, "post_id": 30854314, "comment_id": 49927226, "body": "Tidings is just a combination of behavior and event. It&#39;s usefull when you need to sample two or more events and behaviors using the applicative instance defined for tidings . Your fix adding rumors is right.  Maybe you are hitting the bug that i reported on github and duplode suggests in his answer."}], "tags": [], "owner": {"reputation": 31, "user_id": 784936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9548ee722349753e11bf6ddd9f4ca161?s=128&d=identicon&r=PG", "display_name": "Massudaw", "link": "https://stackoverflow.com/users/784936/massudaw"}, "is_accepted": false, "score": 1, "last_activity_date": 1434399690, "creation_date": 1434399690, "answer_id": 30854314, "question_id": 30735436, "link": "https://stackoverflow.com/questions/30735436/changes-in-other-elements-based-on-listbox-selections-in-threepenny-gui/30854314#30854314", "title": "Changes in other elements based on listbox selections in threepenny-gui", "body": "<p>Try creating a stepper for the listbox and then just sink to display</p>\n\n<pre><code>listB &lt;- stepper Nothing (userSelection listBox)\nelement display # sink UI.text ((maybe \"new text\" id) &lt;$&gt; (listB) \n</code></pre>\n\n<p>Then if you want to sample the behavior with the button</p>\n\n<pre><code>listB &lt;- stepper Nothing (userSelection listBox)\nbutton      &lt;- UI.button    # set UI.text \"Button\"\ncutedListB &lt;- stepper Nothing (listB &lt;@ UI.click button)\nelement display # sink UI.text ((maybe \"new text\" id) &lt;$&gt; (listB) \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 195, "user_id": 4438776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512bdc9775b923e0444553ea5d919854?s=128&d=identicon&r=PG", "display_name": "655321", "link": "https://stackoverflow.com/users/4438776/655321"}, "edited": false, "score": 0, "creation_date": 1434804177, "post_id": 30944030, "comment_id": 49941326, "body": "Thank you so much! I ended up trying many different things, but with the same (non-existent) results. Your example code didn&#39;t indeed work with Threepenny 0.6, but going back to Threepenny 0.5 has solved this problem."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1439249184, "last_edit_date": 1439249184, "creation_date": 1434735065, "answer_id": 30944030, "question_id": 30735436, "link": "https://stackoverflow.com/questions/30735436/changes-in-other-elements-based-on-listbox-selections-in-threepenny-gui/30944030#30944030", "title": "Changes in other elements based on listbox selections in threepenny-gui", "body": "<p>First of all, there was <a href=\"https://github.com/HeinrichApfelmus/threepenny-gui/issues/109\" rel=\"nofollow\">a regression</a> which affected the code here. That issue is now solved. Threepenny 0.6.0.3 has a temporary fix, and the definitive one will be included in the release after that.</p>\n\n<hr>\n\n<p>The code in the <a href=\"http://pastebin.com/D97sFUuA\" rel=\"nofollow\">pastebin you provided</a> is almost correct. The only needed change is that you don't need to use <code>sink</code> within the button click callback - in your case, <code>sink</code> should establish a permanent connection between a behavior and the content of the text area, with the behavior value changing in response to the button click events.</p>\n\n<p>For the sake of completeness, here is a full solution:</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\nmodule Main where\n\nimport Control.Applicative\nimport Control.Monad\nimport Data.Maybe\n\nimport qualified Graphics.UI.Threepenny as UI\nimport Graphics.UI.Threepenny.Core\n\nmain :: IO ()\nmain = startGUI defaultConfig setup\n\nsetup :: Window -&gt; UI ()\nsetup w = void $ mdo\n    return w # set UI.title \"Simple example\"\n\n    listBox &lt;- UI.listBox\n        (pure [\"First\", \"Second\"]) bSelected (pure $ UI.string)\n    button  &lt;- UI.button # set UI.text \"Button\"\n    display &lt;- UI.textarea\n\n    element listBox # set (attr \"size\") \"10\"\n\n    getBody w #+ [element listBox, element button, element display]\n\n    bSelected &lt;- stepper Nothing $ rumors (UI.userSelection listBox)\n    let eClick = UI.click button\n        eValue = fromMaybe \"No selection\" &lt;$&gt; bSelected &lt;@ eClick\n    bValue    &lt;- stepper \"Initial value\" eValue\n\n    element display # sink UI.text bValue\n</code></pre>\n\n<p>The two key things to take away are:</p>\n\n<ul>\n<li>The <code>Behavior (Maybe a)</code> argument to <code>listBox</code> does not set just the initial selected value, but determines the evolution of the value throughout the lifetime of the application. In this example, <code>facts $ UI.userSelection listBox</code> is just <code>bSelected</code>, as can be verified through <a href=\"http://hackage.haskell.org/package/threepenny-gui-0.6.0.2/docs/src/Graphics-UI-Threepenny-Widgets.html#listBox\" rel=\"nofollow\">the source code of the <code>Widgets</code> module</a>.</li>\n<li>The typical way to sample a behavior on event occurrences is through <code>(&lt;@)</code> (or <code>&lt;@&gt;</code> if the event carries data you wish to make use of).</li>\n</ul>\n"}], "owner": {"reputation": 195, "user_id": 4438776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512bdc9775b923e0444553ea5d919854?s=128&d=identicon&r=PG", "display_name": "655321", "link": "https://stackoverflow.com/users/4438776/655321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 30944030, "answer_count": 3, "score": 4, "last_activity_date": 1439249184, "creation_date": 1433861180, "question_id": 30735436, "link": "https://stackoverflow.com/questions/30735436/changes-in-other-elements-based-on-listbox-selections-in-threepenny-gui", "title": "Changes in other elements based on listbox selections in threepenny-gui", "body": "<p>So I have a simple example layout with a listbox, a button and a textarea, where clicking the button changes the text in the textarea:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\nimport Data.Maybe\n\nimport qualified Graphics.UI.Threepenny as UI\nimport Graphics.UI.Threepenny.Core\n\nmain :: IO ()\nmain = startGUI defaultConfig setup\n\nsetup :: Window -&gt; UI ()\nsetup w = do\n    return w # set UI.title \"Simple example\"\n\n    listBox     &lt;- UI.listBox   (pure [\"First\", \"Second\"]) (pure Nothing) ((UI.string .) &lt;$&gt; (pure id))\n    button      &lt;- UI.button    # set UI.text \"Button\"\n    display     &lt;- UI.textarea  # set UI.text \"Initial value\"\n\n    element listBox # set (attr \"size\") \"10\"    \n\n    getBody w   #+ [element listBox, element button, element display]\n\n    on UI.click button $ const $ do\n        element display # set UI.text \"new text\"\n</code></pre>\n\n<p>What I wanted to do is have the change be dependent on the listbox selection (for example have the <code>\"new text\"</code> be <code>\"First\"</code> or <code>\"Second\"</code> based on the selection).</p>\n\n<p>I can quite easily get the selection by combining <code>userSelection</code> and <code>facts</code> as</p>\n\n<pre><code>facts . userSelection :: ListBox a -&gt; Behavior (Maybe a)\n</code></pre>\n\n<p>but because setting the value for the textarea is done with</p>\n\n<pre><code>set text :: String -&gt; UI Element -&gt; UI Element\n</code></pre>\n\n<p>I don't know how to work around the fact that the selection is a <code>Behavior</code>.</p>\n\n<p>All this seems a bit unidiomatic to me and I was wondering what would be the correct way to do this. Maybe I should do something already when the listbox selection is done or changed and not only when the button is pressed.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1433845537, "post_id": 30729326, "comment_id": 49514875, "body": "<code>resolving my type-issue</code> - which one? You have shown so many functions"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1433846183, "post_id": 30729326, "comment_id": 49515337, "body": "<code>decrease_first n l = map (subtract 1) (take n l) ++ drop n l</code> is perfectly fine."}, {"owner": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "reply_to_user": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1433849112, "post_id": 30729326, "comment_id": 49517411, "body": "@thefourtheye I only mentioned compilation problems for 2 functions (the others worked) and both seemed to be because of a misunderstanding of the composition operator. I&#39;m sorry if it was too confusing."}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1433940281, "post_id": 30730395, "comment_id": 49566479, "body": "Or alternatively: <code>decrease_first = (uncurry ((++) . map (subtract 1)) .) . splitAt</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1433848315, "creation_date": 1433848315, "answer_id": 30730395, "question_id": 30729326, "link": "https://stackoverflow.com/questions/30729326/perform-a-function-on-first-elements-of-list/30730395#30730395", "title": "perform a function on first elements of list", "body": "<p>Your first point-free attempts don't work because <code>.</code> composes functions <em>with one argument</em>, while <code>take</code> takes <em>two</em>. What really happens is that code like</p>\n\n<pre><code>decrease_first = map (subtract1) . take\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>decrease_first n = map (subtract1) (take n)\n</code></pre>\n\n<p>but now <code>take n</code> is not a list, hence a type error arises.</p>\n\n<p>Instead, in</p>\n\n<pre><code>decrease_first n l = map (subtract1) . take n l\n</code></pre>\n\n<p>we have that <code>take n l</code> is a list, not a function. Here you need application, not function composition e.g.</p>\n\n<pre><code>decrease_first n l = map (subtract1) $ take n l\n</code></pre>\n\n<p>Your last attempt looks fine to me:</p>\n\n<pre><code>decrease_first n l = map (subtract 1) (take n l) ++ drop n l\n</code></pre>\n\n<p>As a variant, you can use <code>splitAt</code> to get <code>take</code>&amp;<code>drop</code> together:</p>\n\n<pre><code>import Data.List\ndecrease_first n l = map (subtract 1) left ++ right\n      where (left,right) = splitAt n l\n</code></pre>\n\n<p>or alternatively:</p>\n\n<pre><code>decrease_first n l = \n  (\\(left, right) -&gt; map (subtract 1) left ++ right) (splitAt n l)\n</code></pre>\n\n<p>which is not really better than the above ones.</p>\n"}], "owner": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1835, "favorite_count": 1, "accepted_answer_id": 30730395, "answer_count": 1, "score": 1, "last_activity_date": 1433848315, "creation_date": 1433845362, "question_id": 30729326, "link": "https://stackoverflow.com/questions/30729326/perform-a-function-on-first-elements-of-list", "title": "perform a function on first elements of list", "body": "<p>In an attempt to write the Havel-Hakimi algorithm in Haskell, I wrote following function to subtract 1 from the first n elements of a list.</p>\n\n<pre><code>decrease_first :: Int -&gt; [Int] -&gt; [Int]\ndecrease_first 0 l = l\ndecrease_first n (x:xs) = (x-1):decrease_first (n-1) xs\n</code></pre>\n\n<p>This code works, but as I am trying to prepare for a Haskell-test and I was convinced this code is rather lame, I wanted to rewrite this function as follows: </p>\n\n<pre><code>decrease_first :: Int -&gt; [Int] -&gt; [Int]\ndecrease_first = map (subtract1) . take\n</code></pre>\n\n<p>I'm aware of the fact this does not do exactly the same, but I was just trying to understand partially applied functions etc. better and wanted to give this function a try. This turned out not to be the greatest of ideas, because I didn't get this compiled (type-definitions) and I am left with a massive mind-you-know-what, because next code does work, even though I considered it equivalent:</p>\n\n<pre><code>decrease_first n = map (subtract1) . take n \n</code></pre>\n\n<p>and this code fails again:</p>\n\n<pre><code>decrease_first n l = map (subtract1) . take n l\n</code></pre>\n\n<p>Moreover I tried looking for some nice way to apply a function to the first elements of a list, but I couldn't find anything. The first way is probably the most efficient way to do it, but I was wondering whether there was some way to apply any function on the first elements of a list. My idea eventually was to do something like: </p>\n\n<pre><code>decrease_first n l = map (subtract 1) (take n l) ++ drop n l\n</code></pre>\n\n<p>It works like this, but it doesn't look as nice as I had it in mind. So if anyone could help me resolving my type-issue, I would be very grateful.</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "traversal", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "edited": false, "score": 0, "creation_date": 1433842147, "post_id": 30727641, "comment_id": 49512507, "body": "Thank you very much, that was very helpful"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1433841220, "last_edit_date": 1495540713, "creation_date": 1433840870, "answer_id": 30727641, "question_id": 30725465, "link": "https://stackoverflow.com/questions/30725465/haskell-lens-let-binding-of-traversal/30727641#30727641", "title": "Haskell lens: let binding of Traversal&#39;", "body": "<p>The key point here is that the annotation should be in a separate line. If we do that, then we have a binding with an explicit type, as far as GHC is concerned.</p>\n\n<pre><code>someFunction :: MyMonad ()\nsomeFunction = do\n  ...\n  let x :: Traversal' MyState MyDataT \n      x = myState.clients.ix clientIdx.someData.ix dataIdx\n  ...\n</code></pre>\n\n<p>What you first tried very rarely works as you intended:</p>\n\n<pre><code>let x :: Traversal' MyState MyDataT = ...\n</code></pre>\n\n<p>This is a binding without an explicit type; the annotation is <em>inside</em> the left hand side. GHC considers the type of the variable fixed before looking at the right hand side, but the annotation only applies to the left hand side, so GHC just infers a type for the right had side separately, and then tries to match it exactly with the annotation. This makes the type checking fail for all but the simplest non-polymorphic cases. </p>\n\n<p>The right way of putting annotations inside bindings is the following:</p>\n\n<pre><code>let x = ... :: Traversal' MyState MyDataT\n</code></pre>\n\n<p>Here, GHC first assigns a \"malleable\" indeterminate type variable to <code>x</code>, then infers a type for the right side informed by the annotation there, then unifies the type of <code>x</code> with it. </p>\n\n<p>This is still a binding without an explicit type, but it works in general if we enable <code>NoMonomorphismRestriction</code>, for reasons detailed in this <a href=\"https://stackoverflow.com/questions/29193338/ghci-ignores-type-signature\">SO question</a>.</p>\n"}], "owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 30727641, "answer_count": 1, "score": 3, "last_activity_date": 1433841220, "creation_date": 1433834628, "question_id": 30725465, "link": "https://stackoverflow.com/questions/30725465/haskell-lens-let-binding-of-traversal", "title": "Haskell lens: let binding of Traversal&#39;", "body": "<p>I'm a bit confused and don't know where to look for the information/explanation of the following \"issue\" (it's not an issue per se, but more of a situation where I don't understand what is wrong behind the scenes):</p>\n\n<p>I have a monad transformer stack with <strong><em>StateT</em></strong>. At some point in my function I would like to bind a small fraction of my state into the local variable so I can refer to it instead of writing out the whole path to the chunk of the state I'm interested in. Here is what I mean:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\n...\n\nsomeFunction :: MyMonad ()\nsomeFunction = do\n  ...\n  let x :: Traversal' MyState MyDataT = myState.clients.ix clientIdx.someData.ix dataIdx\n  ...\n</code></pre>\n\n<p>Now this doesn't compile:</p>\n\n<pre><code>Couldn't match type \u2018(MyDataT -&gt; f0 MyDataT)\n                     -&gt; MyState -&gt; f0 MyState\u2019\n              with \u2018forall (f :: * -&gt; *).\n                    Control.Applicative.Applicative f =&gt;\n                    (MyDataT -&gt; f MyDataT) -&gt; MyState -&gt; f MyState\u2019\n</code></pre>\n\n<p>But if I move the referencing of this data chunk into a function then everything compiles ok:</p>\n\n<pre><code>someFunction :: MyMonad ()\nsomeFunction = do\n  ...\n  let x = clientData clientIdx dataIdx\n  ...\n\n  where clientData :: Int -&gt; Int -&gt; Traversal' MyState MyDataT\n        clientData clientIdx dataIdx = myState.clients.ix clientIdx.someData.ix dataIdx\n</code></pre>\n\n<p>I'm looking for some kind of information that will help me understand what is going on here, why it happens, so that I'm aware of what I'm doing wrong. Basically I would like to expand my knowledge to understand this use case a bit better.</p>\n"}, {"tags": ["haskell", "ide", "leksah", "sodiumfrp"], "answers": [{"tags": [], "owner": {"reputation": 386, "user_id": 946152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900fe348fc542ba21bf84a69d552829b?s=128&d=identicon&r=PG", "display_name": "Hamish Mackenzie", "link": "https://stackoverflow.com/users/946152/hamish-mackenzie"}, "is_accepted": false, "score": 1, "last_activity_date": 1434164840, "creation_date": 1434164840, "answer_id": 30814678, "question_id": 30723209, "link": "https://stackoverflow.com/questions/30723209/how-to-get-the-type-of-a-term-inside-a-do-block-in-leksah/30814678#30814678", "title": "How to get the type of a term inside a do block in Leksah?", "body": "<p>This is a tricky problem with a number of different solutions (ghc-mod, ide-backend and others).  Currently I think integrating <code>ide-backend</code> into Leksah is probably the best approach to fix this properly.</p>\n\n<p>There is slightly clunky a work around that I find myself using some times.  Specify the type to be <code>()</code> and let the compiler complain that it is not.  For instance if you change the code so it is like this...</p>\n\n<pre><code>unlisten :: () &lt;- listen ev $ \\letter -&gt; modifyIORef outRef (++ [letter])\n</code></pre>\n\n<p>You should get an error that includes the inferred type of <code>unlisten</code>.  You may get an error asking you to turn on <code>ScopedTypeVariables</code> when you do this.  If so, press <code>Ctrl+R</code> and Leksah should add <code>{-# LANGUAGE ScopedTypeVariables #-}</code> to the top of the file for you to switch it on.</p>\n\n<p>One advantage of this approach is that it works even when your code is does not compile (I am not sure how well the other approaches cope with broken code).</p>\n\n<p>I think you can also change it to a type hole by renaming <code>unlisten</code> to <code>_unlisten</code>, but that only works for names and not any expression and also if you don't rename all of the occurrences you might get a different inferred type.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1434164840, "creation_date": 1433825239, "last_edit_date": 1433827313, "question_id": 30723209, "link": "https://stackoverflow.com/questions/30723209/how-to-get-the-type-of-a-term-inside-a-do-block-in-leksah", "title": "How to get the type of a term inside a do block in Leksah?", "body": "<p>Question in video format : <a href=\"http://youtu.be/3_pvK-gcLMM\" rel=\"nofollow noreferrer\">http://youtu.be/3_pvK-gcLMM</a></p>\n\n<p>Question in text format : how can I get Leksah to tell me the type of <code>unlisten</code> in the code below ? </p>\n\n<p>Code is taken from <a href=\"https://github.com/SodiumFRP/sodium/blob/master/haskell/examples/tests/unit-tests.hs\" rel=\"nofollow noreferrer\">https://github.com/SodiumFRP/sodium/blob/master/haskell/examples/tests/unit-tests.hs</a></p>\n\n<p>If this is not possible with Leksah (to get a type of a term inside a do block) then how is it possible to extract that information ? Is there some other Haskell tool or IDE that can do that ?</p>\n\n<pre><code>module Main where\n\nimport FRP.Sodium\nimport Control.Applicative\nimport Control.Monad\nimport Control.Monad.Trans\nimport Data.Char\nimport Data.IORef\nimport Test.HUnit\n\n\n\nmain = do\n          putStrLn \"Give me a line\"\n\n\nevent1 = TestCase $ do\n    (ev, push) &lt;- sync newEvent\n    outRef &lt;- newIORef \"\"\n    sync $ do\n        push '?'\n    unlisten &lt;- sync $ do\n        push 'h'\n        unlisten &lt;- listen ev $ \\letter -&gt; modifyIORef outRef (++ [letter])\n        push 'e'\n        return unlisten\n    sync $ do\n        push 'l'\n        push 'l'\n        push 'o'\n    unlisten\n    sync $ do\n        push '!'\n    out &lt;- readIORef outRef\n    assertEqual \"event1\" \"hello\" =&lt;&lt; readIORef outRef\n</code></pre>\n\n<p>EDIT: It seems that haskell-vim-now can do it :</p>\n\n<p><img src=\"https://i.stack.imgur.com/F79Yb.png\" alt=\"enter image description here\"></p>\n\n<p>Would be nice to have the same in Leksah somehow.</p>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "answers": [{"comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1433841683, "post_id": 30720978, "comment_id": 49512174, "body": "Note that it&#39;s about compile-time, but not about the compiler (ghc&#39;s simplifier).We are running template haskell code that can do domain-specific simplifications (and it does, see example below)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1433808218, "creation_date": 1433808218, "answer_id": 30720978, "question_id": 30720812, "link": "https://stackoverflow.com/questions/30720812/compile-time-vs-run-time-cost-of-hamlet-templates/30720978#30720978", "title": "compile-time vs. run-time cost of Hamlet templates", "body": "<p>Probably not: what you are asking for sounds a lot like partial evaluation (not to be confused with partial application), which is a bit of a compiler-performance minefield, hence often avoided. But you can check for yourself; use <code>-ddump-simpl</code> with your preferred optimization level to see the core that GHC generates.</p>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 7, "last_activity_date": 1433819537, "creation_date": 1433819537, "answer_id": 30722390, "question_id": 30720812, "link": "https://stackoverflow.com/questions/30720812/compile-time-vs-run-time-cost-of-hamlet-templates/30722390#30722390", "title": "compile-time vs. run-time cost of Hamlet templates", "body": "<p>It's been a while since I worked on the code, so don't take this as authoratative (like Daniel mentioned, <code>-ddump-simpl</code> is a good call here). But I don't believe we're using the blaze-html combinators, just the data type. Hamlet itself concatenates strings as much as possible at compile time to avoid that cost at runtime. I know when I last benchmarked (which granted was years ago), that optimization did pay off pretty well.</p>\n"}, {"tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 3, "last_activity_date": 1433849648, "last_edit_date": 1433849648, "creation_date": 1433838785, "answer_id": 30726860, "question_id": 30720812, "link": "https://stackoverflow.com/questions/30720812/compile-time-vs-run-time-cost-of-hamlet-templates/30726860#30726860", "title": "compile-time vs. run-time cost of Hamlet templates", "body": "<p>as Michael says \"Hamlet itself concatenates strings as much as possible at compile time to avoid that cost at runtime.\" </p>\n\n<p>For the example from the book,</p>\n\n<pre><code>main = putStrLn $ renderHtml [shamlet|\n&lt;p&gt;Hello, my name is #{name person} and I am #{show $ age person}.\n&lt;p&gt;\n    Let's do some funny stuff with my name: #\n    &lt;b&gt;#{sort $ map toLower (name person)}\n&lt;p&gt;Oh, and in 5 years I'll be #{show ((+) 5 (age person))} years old.\n|]\n  where\n    person = Person \"Michael\" 26\n</code></pre>\n\n<p><code>-ddump-simpl</code> contains this:</p>\n\n<pre><code>               (&gt;&gt;\n                  @ Text.Blaze.Internal.MarkupM\n                  Text.Blaze.Internal.$fMonadMarkupM\n                  @ ()\n                  @ ()\n                  (id\n                     @ (Text.Blaze.Internal.MarkupM ())\n                     (. @ Data.Text.Internal.Text\n                        @ Text.Blaze.Internal.Markup\n                        @ String\n                        Text.Blaze.Internal.preEscapedText\n                        Data.Text.pack\n                        (GHC.CString.unpackCString#\n                           \".&lt;/p&gt;\\n\\\n                           \\&lt;p&gt;Let's do some funny stuff with my name: &lt;b&gt;\"#)))\n</code></pre>\n\n<p>Indeed, that's not the syntax tree of the HTML (last line - the string contains a closing tag and the next opening tag). </p>\n\n<p>This Hamlet feature should be advertised more!</p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 30722390, "answer_count": 3, "score": 9, "last_activity_date": 1433849648, "creation_date": 1433807087, "last_edit_date": 1433838110, "question_id": 30720812, "link": "https://stackoverflow.com/questions/30720812/compile-time-vs-run-time-cost-of-hamlet-templates", "title": "compile-time vs. run-time cost of Hamlet templates", "body": "<p>For the <a href=\"http://www.yesodweb.com/book/shakespearean-templates\" rel=\"noreferrer\">Hamlet</a> template mechanism, I understand that the template is parsed at compile time, resulting in source code that contains calls to blaze-html combinators (and possibly other expressions because of interpolation). So the points (subtrees) where interpolation happens are known at compile-time. </p>\n\n<p>At run-time, we need to compute the interpolated value (of course),\nand \"plug it\" in the tree, that is, apply the html combinators.\nAll of them? Actually some of these applications could be evaluated at compile-time (those that have no interpolation below them). Does this happen?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1433862774, "post_id": 30724308, "comment_id": 49528236, "body": "This is a fantastic answer. Thank you for walking me through how you figured it out. What does <code>source</code> mean in the constraint?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 1, "creation_date": 1433863906, "post_id": 30724308, "comment_id": 49529104, "body": "It means that installed instances are excluded."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 5, "last_activity_date": 1433830652, "creation_date": 1433830652, "answer_id": 30724308, "question_id": 30718440, "link": "https://stackoverflow.com/questions/30718440/cabal-sandbox-is-using-a-global-dependency-could-not-resolve/30724308#30724308", "title": "Cabal sandbox is using a global dependency. Could not resolve", "body": "<p>It is difficult for cabal-install to produce a complete description of the mutual incompatibilities of an installation problem. It instead decides to print the first path to failure.</p>\n\n<p>However, it prints <code>Dependency tree exhaustively searched.</code> which indicates that there actually is no solution to the given problem.</p>\n\n<p>One thing that often helps is to look at the choices cabal-install has made, find one that seems suboptimal, and then add an explicit constraint to change that. This may result in a better error message.</p>\n\n<p>Let's try [note that I'm not sure if I have exactly the same package DB as you have, so it may produce different results on your system].</p>\n\n<p>You had (modulo hashes of installed packages):</p>\n\n<pre><code>$ cabal install --only-dependencies\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: serials-0.1.0.2 (user goal)\ntrying: mandrill-0.2.2.0 (dependency of serials-0.1.0.2)\ntrying: http-client-tls-0.2.2 (dependency of mandrill-0.2.2.0)\ntrying: tls-1.2.17 (dependency of http-client-tls-0.2.2)\ntrying: x509-validation-1.5.2 (dependency of tls-1.2.17)\ntrying: process-1.2.0.0/installed-06c... (dependency of x509-validation-1.5.2)\nnext goal: unix (dependency of process-1.2.0.0/installed-06c...)\nrejecting: unix-2.7.0.1/installed-f86... (conflict: unix =&gt;\ntime==1.4.2/installed-9b3..., serials =&gt; time&gt;=1.5)\nrejecting: unix-2.7.1.0, 2.7.0.1, 2.7.0.0, 2.6.0.1, 2.6.0.0, 2.5.1.1, 2.5.1.0,\n2.5.0.0, 2.4.2.0, 2.4.1.0, 2.4.0.2, 2.4.0.1, 2.4.0.0, 2.3.2.0, 2.3.1.0,\n2.3.0.0, 2.2.0.0, 2.0 (conflict: process =&gt; unix==2.7.0.1/installed-f86...)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>Looking through this, the error occurs with <code>unix</code>, which is a dependency of <code>process</code>. So the installed instance of <code>process</code> being chosen leads to trouble. So what if we disallow choosing that instance of <code>process</code>?</p>\n\n<pre><code>$ cabal install --only-dependencies --constraint=\"process source\"\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: serials-0.1.0.2 (user goal)\nnext goal: time (dependency of serials-0.1.0.2)\nrejecting: time-1.4.2/installed-9b3... (conflict: serials =&gt; time&gt;=1.5)\ntrying: time-1.5.0.1\nnext goal: rethinkdb (dependency of serials-0.1.0.2)\nrejecting: rethinkdb-1.16.0.0 (conflict: time==1.5.0.1, rethinkdb =&gt;\ntime==1.4.*)\nrejecting: rethinkdb-1.15.2.1, 1.15.2.0, 1.15.1.0, 1.15.0.0, 1.8.0.5, 1.8.0.4,\n1.8.0.3, 1.8.0.2, 1.8.0.1, 1.8.0.0, 0.1.0.0 (conflict: serials =&gt;\nrethinkdb&gt;=1.16)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>Aha! So <code>rethinkdb</code>, which is a direct dependency of <code>serials</code>, has an explicit dependency on <code>time == 1.4.*</code>. This is in direct conflict with the dependency of <code>serials</code> on <code>time &gt;= 1.5</code>.</p>\n\n<p>This is not easy to fix. You either need to make <code>rethinkdb</code> work with the newer <code>time</code> library, or <code>serials</code> with the older.</p>\n\n<p>We enter the realm of speculation now: It is possible, but not guaranteed, that <code>rethinkdb</code> actually works with a newer version of <code>time</code>. We can try to instruct cabal-install to consider such install plans:</p>\n\n<pre><code>$ cabal install --only-dependencies --allow-newer=time\n</code></pre>\n\n<p>This actually yields an install plan on my machine. I have not tried building it, and I don't know whether it works. But it may be worth a try.</p>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 30724308, "answer_count": 1, "score": 4, "last_activity_date": 1433830652, "creation_date": 1433795145, "last_edit_date": 1433795547, "question_id": 30718440, "link": "https://stackoverflow.com/questions/30718440/cabal-sandbox-is-using-a-global-dependency-could-not-resolve", "title": "Cabal sandbox is using a global dependency. Could not resolve", "body": "<p>I'm trying to add <code>timerep</code> onto an existing application. I can't get it to resolve my dependencies. It looks like it is using the globally installed version of <code>time == 1.4.2</code>, when <code>&gt;= 1.5</code> would be ideal for my application. </p>\n\n<p>How can I get cabal to use time 1.5? I've poked through unix, tls, process, timerep, and they all seem like they would work fine if it would just use <code>time &gt;= 1.5</code>.</p>\n\n<p>Here's the error:</p>\n\n<pre><code>serials&gt; cabal install --only-dependencies\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: serials-0.1.0.2 (user goal)\ntrying: mandrill-0.2.2.0 (dependency of serials-0.1.0.2)\ntrying: http-client-tls-0.2.2 (dependency of mandrill-0.2.2.0)\ntrying: tls-1.2.17 (dependency of http-client-tls-0.2.2)\ntrying: x509-validation-1.5.2 (dependency of tls-1.2.17)\ntrying: process-1.2.0.0/installed-487... (dependency of x509-validation-1.5.2)\nnext goal: unix (dependency of process-1.2.0.0/installed-487...)\nrejecting: unix-2.7.0.1/installed-299... (conflict: unix =&gt;\ntime==1.4.2/installed-bf9..., serials =&gt; time&gt;=1.5)\nrejecting: unix-2.7.1.0, 2.7.0.1, 2.7.0.0, 2.6.0.1, 2.6.0.0, 2.5.1.1, 2.5.1.0,\n2.5.0.0, 2.4.2.0, 2.4.1.0, 2.4.0.2, 2.4.0.1, 2.4.0.0, 2.3.2.0, 2.3.1.0,\n2.3.0.0, 2.2.0.0, 2.0 (conflict: process =&gt; unix==2.7.0.1/installed-299...)\nDependency tree exhaustively searched.\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://github.com/seanhess/serials/blob/master/cabal.config\" rel=\"nofollow\">Cabal file</a>: </p>\n\n<pre><code>-- Initial serials.cabal generated by cabal init.  For further\n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                serials\nversion:             0.1.0.2\nsynopsis:            serials\ndescription:         serials\nlicense:             MIT\nlicense-file:        LICENSE\nauthor:              Sean Hess\nmaintainer:          Sean Hess\n-- copyright:\ncategory:            Web Scraper\nbuild-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\nSource-repository head\n  type:       git\n  location:   git@github.com:seanhess/serials.git\n\nexecutable serials\n  main-is:             Main.hs\n  hs-source-dirs:      server\n  ghc-options:         -fcontext-stack=36\n  -- other-modules:\n  -- other-extensions:\n  default-language:     Haskell2010\n  build-depends:\n    base &gt;=4.7 &amp;&amp; &lt;5,\n    tagsoup,\n    text,\n    scalpel,\n    containers,\n    network-uri,\n    monad-loops,\n    wreq,\n    lens,\n    bytestring,\n    parsec,\n    utf8-string,\n    tagsoup,\n    xml,\n    feed,\n    regex-pcre,\n    aeson,\n    network,\n    wai,\n    wai-extra,\n    wai-cors,\n    wai-middleware-static,\n    warp,\n    servant-server &gt;= 0.4,\n    rethinkdb &gt;= 1.16,\n    transformers,\n    either,\n    unordered-containers,\n    mtl,\n    http-types,\n    safe,\n    hashable,\n    resource-pool,\n    time &gt;= 1.5,\n    pooled-io,\n    shelly,\n    string-conversions,\n    bcrypt,\n    random,\n    jwt,\n    cookie,\n    entropy,\n    mandrill == 0.2.2.0,\n    email-validate,\n    blaze-markup,\n    blaze-html,\n    iso8601-time,\n    scotty == 0.10.0,\n    timerep &gt;= 2.0.0\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1433791419, "post_id": 30717009, "comment_id": 49492382, "body": "what type has <code>f</code> in <code>let g f = fmap f [[1,2,3],[4,5,6]]</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1433791762, "post_id": 30717009, "comment_id": 49492553, "body": "<code>[[[]]]</code> looks ill-kinded."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1433866058, "post_id": 30717009, "comment_id": 49530729, "body": "My friend, You have just discovered FREE MONADS! Sorta. <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">haskellforall.com/2012/06/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1433793513, "last_edit_date": 1433793513, "creation_date": 1433792397, "answer_id": 30717670, "question_id": 30717009, "link": "https://stackoverflow.com/questions/30717009/generating-instances-for-n-depth-structures/30717670#30717670", "title": "Generating instances for n-depth structures?", "body": "<p>What you're talking about is essentially composition of functors (<em>n</em>-fold self-composition, specifically, but that doesn't really matter).</p>\n\n<p>Indeed <a href=\"https://hackage.haskell.org/package/transformers-0.2.2.0/docs/Data-Functor-Compose.html\">such compositions</a> can be made automatically instances of the <code>Functor</code>, <code>Applicative</code>, <code>Foldable</code> and <code>Traversable</code> class. Also, you can have stacks of <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Class.html\">monad transformers</a> (which are essentially an alternative approach to functor composition).</p>\n\n<p>To make it <em>n</em>-fold with the same functor, you need a suitable wrapper.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, GADTs, FlexibleInstances, FlexibleContexts #-}\ndata Nat = Z | S Nat\n\ndata NCompose :: Nat -&gt; (* -&gt; *) -&gt; * -&gt; * where\n  Singly :: f x -&gt; NCompose (S Z) f x\n  Multiplie :: NCompose n f (f x) -&gt; NCompose (S n) f x\n\ninstance Functor (NCompose Z f) where\n  fmap _ _ = undefined -- safe, since there's no constructor for `NCompose Z f x`\ninstance (Functor f, Functor (NCompose n f)) =&gt; Functor (NCompose (S n) f) where\n  fmap f (Singly q) = Singly $ fmap f q\n  fmap f (Multiplie q) = Multiplie $ fmap (fmap f) q\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433795155, "post_id": 30718115, "comment_id": 49494413, "body": "I see you are counting from one -- any particular reason?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433796069, "post_id": 30718115, "comment_id": 49494873, "body": "@chi if we count from zero, then we have the identity function for the <code>fmapN</code> zero case, which means the <code>f</code> type constructor doesn&#39;t appear in the return type, which results in ambiguous class constraints. We also get ambiguous types for non-zero cases, because <code>f</code> only appears inside a type family in the return type. It&#39;s better to always have something to <code>fmap</code> over. The same thing applies to <code>traverseN</code> and <code>foldMapN</code>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 5, "last_activity_date": 1433794622, "last_edit_date": 1433794622, "creation_date": 1433793965, "answer_id": 30718115, "question_id": 30717009, "link": "https://stackoverflow.com/questions/30717009/generating-instances-for-n-depth-structures/30718115#30718115", "title": "Generating instances for n-depth structures?", "body": "<p>We can do this with the current GHC support for dependent typing. Preliminaries:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies #-}\n\nimport Data.Singletons -- from \"singletons\" package\nimport Data.Nat        -- from my \"singleton-nats\" package\n</code></pre>\n\n<p>From <a href=\"https://hackage.haskell.org/package/singleton-nats\"><code>Data.Nat</code></a> we get a natural number type that can be used on the type level with the <code>DataKinds</code> extension. We also get its <a href=\"https://github.com/goldfirere/singletons/\">singleton</a> type,  which enables us to pattern match on <code>Nat</code> runtime. We use the <code>Z</code> and <code>S</code> constructors in the type level, and the <code>SZ</code> and <code>SS</code> constructors on the term level, for the zero and successor constructors respectively. </p>\n\n<p>We define iteration of type constructors with a type family:</p>\n\n<pre><code>type family Iterate n f x where\n  Iterate Z     f x = x\n  Iterate (S n) f x = f (Iterate n f x)\n</code></pre>\n\n<p>For example, <code>Iterate (S (S Z)) [] Int</code> reduces to <code>[[Int]]</code>. </p>\n\n<p>We don't use instances here, since the desired functionality can be achieved by simply writing functions. </p>\n\n<pre><code>fmapN :: Functor f =&gt; Sing (S n) -&gt; (a -&gt; b) -&gt; f (Iterate n f a) -&gt; f (Iterate n f b)\nfmapN (SS SZ)     f = fmap f\nfmapN (SS (SS n)) f = fmap (fmapN (SS n) f)\n\ntraverseN :: (Applicative f, Traversable t) =&gt; Sing (S n) -&gt; (a -&gt; f b) -&gt; t (Iterate n t a) -&gt; f (t (Iterate n t b))\ntraverseN (SS SZ)     f = traverse f\ntraverseN (SS (SS n)) f = traverse (traverseN (SS n) f)\n\nfoldMapN :: (Monoid m, Foldable f) =&gt; Sing (S n) -&gt; (a -&gt; m) -&gt; f (Iterate n f a) -&gt; m\nfoldMapN (SS SZ)     f = foldMap f\nfoldMapN (SS (SS n)) f = foldMap (foldMapN (SS n) f)\n</code></pre>\n\n<p>Some testing:</p>\n\n<pre><code>&gt; traverseN (sing :: SLit 3) putStrLn [[[\"foo\"]]]\nfoo\n[[[()]]]\n&gt; fmapN (sing :: SLit 5) (+10) [[[[[0]]]]]\n[[[[[10]]]]]\n</code></pre>\n\n<p><code>sing :: SLit n</code> is a shorthand notation here for <code>Nat</code> singletons. <a href=\"https://hackage.haskell.org/package/singletons-1.1.2/docs/Data-Singletons.html#t:SingI\"><code>sing</code></a> comes from <code>Data.Singletons</code>, and it polymorphically creates singleton values based on the provided type annotations. <code>SLit</code> is a type synonym from <code>Data.Nat</code> which makes use of GHC's <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/GHC-TypeLits.html\">type literals</a>. </p>\n\n<p>We could also write out the <code>Nat</code> singletons without sugar; for example, <code>SS (SS (SS SZ))</code> corresponds to <code>sing :: SLit 3</code>. In general, we can use the <code>Lit n</code> shorthand on the type level and <code>sing :: SLit n</code> on the term level. </p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1433806970, "last_edit_date": 1433806970, "creation_date": 1433806238, "answer_id": 30720710, "question_id": 30717009, "link": "https://stackoverflow.com/questions/30717009/generating-instances-for-n-depth-structures/30720710#30720710", "title": "Generating instances for n-depth structures?", "body": "<p>The other answers are quite nice in that they present a single (parameterized) data type that can handle structures of any depth; however, they use advanced type system features to achieve this. On the other hand, there are quite simple features that can be used instead to achieve the same thing, and with greater flexibility. The basic idea is to define functor composition once and for all:</p>\n\n<pre><code>newtype Compose f g a = Compose { getComposition :: f (g a) }\ninstance (Functor f, Functor g) =&gt; Functor (Compose f g) where\n    fmap f (Compose v) = Compose (fmap (fmap f) v)\n</code></pre>\n\n<p>One can similarly define instances for <code>Foldable</code> and <code>Traversable</code> with no extensions. Then you get one-fold, two-fold, and three-fold nesting as, e.g.</p>\n\n<pre><code>type DepthOneList = []\ntype DepthTwoList = Compose [] []                -- = Compose [] DepthOneList\ntype DepthThreeList = Compose [] (Compose [] []) -- = Compose [] DepthTwoList\n</code></pre>\n\n<p>and these have the requisite <code>Functor</code>, <code>Foldable</code>, and <code>Traversable</code> operations. Moreover, you have great flexibility here; you need not have the same functor at every depth but could have for example</p>\n\n<pre><code>type Mixed = Compose [] (Compose Vector [])\n</code></pre>\n\n<p>with no problem. If it is really needed, one can happily unroll type-level nats into this more structured type-level object (though of course this requires similar extensions to the ones used in other answers):</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE DataKinds    #-}\ndata Nat = Z | S Nat\ntype family IterCompose (n :: Nat) (f :: * -&gt; *) :: * -&gt; * where\n    IterCompose Z f = Identity\n    IterCompose (S n) f = Compose f (IterCompose n f)\n</code></pre>\n\n<p>But this type-level translation is, in most cases, less flexible, less usable, and less readable than just writing the composed type by hand, so I would consider this part the \"uninteresting\" part in some sense.</p>\n\n<p>A pre-implemented functor composition operation is available from Hackage in the <a href=\"http://hackage.haskell.org/package/TypeCompose\" rel=\"nofollow\">TypeCompose</a> package and, perhaps more canonically, in <a href=\"http://hackage.haskell.org/package/transformers\" rel=\"nofollow\">transformers</a>.</p>\n"}], "owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 2, "accepted_answer_id": 30720710, "answer_count": 3, "score": 3, "last_activity_date": 1433811654, "creation_date": 1433789923, "last_edit_date": 1433811654, "question_id": 30717009, "link": "https://stackoverflow.com/questions/30717009/generating-instances-for-n-depth-structures", "title": "Generating instances for n-depth structures?", "body": "<p>By <code>n-depth structure</code> I mean some structure that nests one kind of structure <code>n</code> times, for example <code>[[a]]</code> is a 2-depth list.</p>\n\n<p>I was randomly thinking about an instance of <code>Functor</code>, <code>Foldable</code> and <code>Traversable</code> for a 3-depth list (<code>[[[a]]]</code>) today, and found some regularity as you can see below:</p>\n\n<pre><code>instance Functor [[[]]] where\n    fmap f n = fmap (fmap (fmap f)) n\n\ninstance Foldable [[[]]] where\n    foldMap f n = foldMap (foldMap (foldMap f)) n\n\ninstance Traversable [[[]]] where\n    sequenceA n =\n        let fz = \\z -&gt; sequenceA z\n            fy = \\y -&gt; sequenceA (fmap fz y)\n            fx = \\x -&gt; sequenceA (fmap fy x)\n        in  fx n\n</code></pre>\n\n<p>I think this can be automated typesafely in some way, not only for <code>[]</code> but any structures that have these instances (like <code>Vector</code>), and not only 3-depth but any depths as long as it's more than zero.</p>\n\n<p>I think something like <code>data Depth = One | Succ Depth</code> will be used for compile-time depth calculation, but beyond that, I have no idea how it goes. Do you think this is actually possible? How would you implement it?</p>\n"}, {"tags": ["multithreading", "haskell", "stm"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1433778191, "creation_date": 1433778191, "answer_id": 30713584, "question_id": 30713375, "link": "https://stackoverflow.com/questions/30713375/pipeline-like-operation-using-tchan/30713584#30713584", "title": "Pipeline-like operation using TChan", "body": "<p>I think there's a race condition:</p>\n\n<ul>\n<li>stop <code>fstPipe</code> just before the <code>putMVar</code></li>\n<li>advance <code>lastPipe</code> to read everything, and then call <code>pipelineDone</code></li>\n<li><code>pipelineDone</code> returns <code>False</code> since <code>putMVar</code> was not yet done</li>\n<li><code>lastPipe</code> will try to read from the channel</li>\n<li><code>putMVar</code> executes, but it's too late</li>\n</ul>\n\n<p>Now <code>lastPipe</code> is stuck reading on an empty channel.</p>\n"}, {"comments": [{"owner": {"reputation": 573, "user_id": 1485641, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/DZfVI.jpg?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/1485641/bruno"}, "edited": false, "score": 0, "creation_date": 1433778996, "post_id": 30713652, "comment_id": 49485103, "body": "Thanks! So if I understand well, if I write &quot;writeTchan chin $ seq $ f x&quot; it will evaluate f x then add it to the channel?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 573, "user_id": 1485641, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/DZfVI.jpg?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/1485641/bruno"}, "edited": false, "score": 1, "creation_date": 1433779147, "post_id": 30713652, "comment_id": 49485215, "body": "If you do <code>writeTChan ch $! f x</code> (notice <code>$!</code> rather than <code>$</code>), that will force the result of <code>f</code> <i>to weak-head normal-form</i>. If you want to evaluate further than that... well, this is an entire other question. Search SO for previous answers. ;-)"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1433778401, "creation_date": 1433778401, "answer_id": 30713652, "question_id": 30713375, "link": "https://stackoverflow.com/questions/30713375/pipeline-like-operation-using-tchan/30713652#30713652", "title": "Pipeline-like operation using TChan", "body": "<p>It seems odd to me to be using STM <em>and</em> semaphores in the same code block... Why not do the entire thing in STM?</p>\n\n<p>In particular, why not a <code>TChan (Maybe x)</code>, with <code>Nothing</code> indicating the end of the sequence?</p>\n\n<p>Also, notice that your <code>fstPipe</code> likely just generates a bunch of unevaluated thunks and immediately chucks them into the <code>TChan</code>, without actually computing anything. You probably want a <code>seq</code> or similar in there to force some actual <em>work</em> to happen on that thread.</p>\n"}, {"tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": false, "score": 1, "last_activity_date": 1433779826, "creation_date": 1433779826, "answer_id": 30714154, "question_id": 30713375, "link": "https://stackoverflow.com/questions/30713375/pipeline-like-operation-using-tchan/30714154#30714154", "title": "Pipeline-like operation using TChan", "body": "<p>Your problem is in the logic of <code>pipelineDone</code>.  Currently, you have:</p>\n\n<pre><code>pipelineDone channel mIn = do\n  isDone &lt;- fmap isJust $ tryTakeMVar mIn\n  isEmpty &lt;- atomically $ isEmptyTChan channel\n  return $ isDone &amp;&amp; isEmpty\n</code></pre>\n\n<p><code>tryTakeMVar</code> is going to take the contents of the MVar assuming there is something in there.  Assuming your producer finishes first, it is going to write <code>()</code> into the MVar.  Your consumer is then going to try and take the contents of it.  If it succeeds, then the MVar goes empty.  Any subsequent <code>tryTakeMVar</code> will always return <code>Nothing</code>, thus <code>isDone &amp;&amp; isEmpty</code> will always return false and you will keep trying to read from the <code>TChan</code>.  Once the <code>TChan</code> goes empty, GHC can tell you that it has encountered a deadlock.  </p>\n\n<p>You should instead change your pipelineDone implementation to:</p>\n\n<pre><code>pipelineDone channel mIn = do\n  stillRunning &lt;- isEmptyMVar mIn\n  isEmpty &lt;- atomically $ isEmptyTChan channel\n  return $ (not stillRunning) &amp;&amp; isEmpty\n</code></pre>\n\n<p>This will instead simply poll the MVar, instead of actually emptying it.</p>\n"}], "owner": {"reputation": 573, "user_id": 1485641, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/DZfVI.jpg?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/1485641/bruno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 30713652, "answer_count": 3, "score": 2, "last_activity_date": 1433779826, "creation_date": 1433777596, "question_id": 30713375, "link": "https://stackoverflow.com/questions/30713375/pipeline-like-operation-using-tchan", "title": "Pipeline-like operation using TChan", "body": "<p>I want to implement a pipeline between two threads. I have thread A that take the data, process it, and send it to thread B. I have a MVar that check if the data is completely processed</p>\n\n<p>However, I'm having an exception <code>*** Exception: thread blocked indefinitely in an STM transaction</code></p>\n\n<p>Why are my threads blocked? I though than when the first thread write on the channel, then when there is a data on the channel, the second one can read it</p>\n\n<pre><code>fstPipe :: (a -&gt; b) -&gt; TChan b -&gt; MVar () -&gt; [a] -&gt; IO ()\nfstPipe f chIn m xs = do\n    ( mapM_(\\x-&gt; atomically $ writeTChan chIn $ f x) xs) &gt;&gt; putMVar m ()\n\npipelineDone channel mIn = do\n    isDone &lt;- fmap isJust $ tryTakeMVar mIn\n    isEmpty &lt;- atomically $ isEmptyTChan channel\n    return $ isDone &amp;&amp; isEmpty\n\nlastPipe f chIn mIn = iter \n    where iter = do\n        atomically $ fmap f $ readTChan chIn\n        isDone &lt;- pipelineDone chIn mIn\n        unless isDone $ iter\n\npipeline = do\n    chIn &lt;- atomically newTChan\n    m &lt;- newEmptyMVar\n    first &lt;- async $ fstPipe reverse chIn m $ replicate 10 [1..500]\n    last &lt;- async $ lastPipe print chIn m\n    wait first\n    wait last\n</code></pre>\n"}, {"tags": ["haskell", "syntactic-sugar"], "answers": [{"tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": false, "score": 2, "last_activity_date": 1433768538, "creation_date": 1433768538, "answer_id": 30709864, "question_id": 30709787, "link": "https://stackoverflow.com/questions/30709787/haskell-stripping-function-of-syntactic-sugar/30709864#30709864", "title": "Haskell stripping function of syntactic sugar", "body": "<p>Because the <code>tails1 []</code> entry comes first, we don't need to ensure that the desugared <code>tails1 xs@(x:xs')</code> only matches nonempty lists, as they are guaranteed to be nonempty.  Thus, the only effect of writing <code>xs@(x:xs')</code> is to give us access to both <code>xs</code> and <code>tail xs</code>, and so the line can be rewritten as:</p>\n\n<pre><code>tails1 xs = xs : tails1 (tail xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "is_accepted": true, "score": 4, "last_activity_date": 1433769297, "creation_date": 1433769297, "answer_id": 30710150, "question_id": 30709787, "link": "https://stackoverflow.com/questions/30709787/haskell-stripping-function-of-syntactic-sugar/30710150#30710150", "title": "Haskell stripping function of syntactic sugar", "body": "<p>First you need to understand the list data type.\nHere are the list data constructors:</p>\n\n<pre><code>[] :: [a]\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>where:</p>\n\n<ol>\n<li>[] create an empty list</li>\n<li>(:) takes an <code>a</code> , a list of <code>a</code> and returns a list of <code>a</code> with the new element appedned</li>\n</ol>\n\n<p>Let say you have a list <code>[1,2,3,4]</code>.\nThis can be written as <code>(:) 1 ((:) 2 ((:) 3 ((:) 4 [])))</code>\nIn expression <code>x:xs'</code>, <code>x</code> hold <code>1</code> and <code>xs'</code> will hold <code>(:) 2 ((:) 3 ((:) 4 []))</code>.\nIn other words <code>:</code> takes an element and a list, appending this element to the list.</p>\n\n<p>The equivalent expression for your example is:</p>\n\n<pre><code>tails1 ((:) x xs') = ((:)x xs'):tails1 xs'\n</code></pre>\n\n<p>Where <code>x</code> is holding the first element of the list and <code>xs'</code> the rest of the list. <code>xs'</code> cannot hold multiple elements. In your example <code>tails1 ((:) x ((:) xs' [])) = xs:tails1 xs'</code>, <code>xs'</code> should hold everything except first element and <code>[]</code>. (in my examle it should be 2:3:4 which is not a valid list because is not ended by []).</p>\n"}, {"comments": [{"owner": {"reputation": 2768, "user_id": 4271479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/288848609fdf4ebb07ce8104e2a45559?s=128&d=identicon&r=PG&f=1", "display_name": "mastov", "link": "https://stackoverflow.com/users/4271479/mastov"}, "edited": false, "score": 0, "creation_date": 1433968450, "post_id": 30721260, "comment_id": 49585629, "body": "Can you provide a reference to the general transformation (including correct pattern-matching)?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1433969268, "last_edit_date": 1495540275, "creation_date": 1433810293, "answer_id": 30721260, "question_id": 30709787, "link": "https://stackoverflow.com/questions/30709787/haskell-stripping-function-of-syntactic-sugar/30721260#30721260", "title": "Haskell stripping function of syntactic sugar", "body": "<p>In other answers, we have seen two proposals:</p>\n\n<pre><code>tailsA (x:xs') = (x:xs'):tailsA xs\ntailsB xs = xs:tailsB (tail xs)\n</code></pre>\n\n<p>The former has the right denotational semantics, but the wrong operational semantics. The original <code>tails</code> has only one call to <code>(:)</code>; one might therefore worry that a sufficiently stupid compiler would allocate extra cons cells when running <code>tailsA</code> compared to the original definition of <code>tails</code>. The latter also has the right denotation, and only has one call to <code>(:)</code>, but inserts a brand new function <code>tail</code> which does not appear in the original; this transformation seems to require some programmer insight to perform. Below, I will show how the original definition may be transformed into one with no at-patterns in a way that does not require programmer insight (hence can be performed by a compiler) and which does not risk additional allocation.</p>\n\n<pre><code>tailsC xs = case xs of\n    x:xs' -&gt; xs:tailsC xs'\n</code></pre>\n\n<p>Of special interest here: the original equation's right-hand side appears verbatim as the right-hand side of the case statement. (Neither of <code>tailsA</code> or <code>tailsB</code> contains the original equation's right-hand side as a subterm at all.) The general translation of at patterns suggested by this special-case transformation is not fully correct (since <code>xs</code> matches any value whereas <code>xs@(x:xs')</code> matches only non-empty lists); a full treatment of turning Haskell-style patterns into GHC-Core-style case statements (which scrutinize only a single variable, and whose patterns all contain exactly one constructor) is out of scope for a StackOverflow answer. There have been several research papers discussing how to do this correctly, efficiently, and producing speedy code; see also the related question <a href=\"https://stackoverflow.com/q/7883023/791604\">Algorithm for type checking ML-like pattern matching?</a> and basically all of the results in the Google Scholar search for <a href=\"http://scholar.google.com/scholar?q=compiling+pattern+matching\" rel=\"nofollow noreferrer\">compiling pattern matching</a>.</p>\n\n<p>But the basic idea is that <code>name@pattern</code> matches exactly when <code>pattern</code> matches (binding all the same names <code>pattern</code> does to all the same values), but additionally binds <code>name</code> to the full value.</p>\n"}], "owner": {"reputation": 368, "user_id": 4204160, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/62550e8dec6bd6a777fe3c0013b820df?s=128&d=identicon&r=PG&f=1", "display_name": "Marcin", "link": "https://stackoverflow.com/users/4204160/marcin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 30710150, "answer_count": 3, "score": 0, "last_activity_date": 1433969268, "creation_date": 1433768282, "question_id": 30709787, "link": "https://stackoverflow.com/questions/30709787/haskell-stripping-function-of-syntactic-sugar", "title": "Haskell stripping function of syntactic sugar", "body": "<p>I'm wondering how would the following function look without any syntactic sugar: </p>\n\n<pre><code>tails1 :: [a] -&gt; [[a]]\ntails1 [] = [[]]\ntails1 xs@(x:xs') = xs:tails1 xs'\n</code></pre>\n\n<p>I'm mostly concerned with the usage of the @ operator, I've tried what follows, but that's obviously not the correct way</p>\n\n<pre><code>tails1 ((:) x ((:) xs' [])) = xs:tails1 xs'\n</code></pre>\n"}, {"tags": ["linux", "haskell", "ubuntu", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 0, "creation_date": 1433833487, "post_id": 30708787, "comment_id": 49507138, "body": "@jawanam What platform / OS and version are you using?"}], "tags": [], "owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "is_accepted": false, "score": 0, "last_activity_date": 1433765301, "creation_date": 1433765301, "answer_id": 30708787, "question_id": 30708737, "link": "https://stackoverflow.com/questions/30708737/unable-to-upgrade-cabal-to-the-latest-version-in-linux/30708787#30708787", "title": "Unable to upgrade cabal to the latest version in Linux", "body": "<p>Try installing it using cabal itself:</p>\n\n<pre><code>cabal update\ncabal install cabal-install\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1433768674, "creation_date": 1433768674, "answer_id": 30709928, "question_id": 30708737, "link": "https://stackoverflow.com/questions/30708737/unable-to-upgrade-cabal-to-the-latest-version-in-linux/30709928#30709928", "title": "Unable to upgrade cabal to the latest version in Linux", "body": "<p>After running either <code>cabal install</code> or <code>cabal build</code>, look in <code>./dist/build/cabal/</code> for the built cabal binary.</p>\n\n<p>You can also use this recipe:</p>\n\n<pre><code>cabal get cabal-install\ncd cabal-install-1.22.4.0   # or whatever the get command says\ncabal build\n# binary resides in dist/build/cabal\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "edited": false, "score": 0, "creation_date": 1445547959, "post_id": 32497672, "comment_id": 54381657, "body": "Worked as advertised. One thing to note: you might need to create a soft link for <code>hsc2hs</code> as well since <code>cabal-install</code> wouldn&#39;t install for me otherwise."}, {"owner": {"reputation": 271, "user_id": 2925208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8cc2e6c8da46e3eb9be370b90d5fe06?s=128&d=identicon&r=PG&f=1", "display_name": "axm", "link": "https://stackoverflow.com/users/2925208/axm"}, "reply_to_user": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "edited": false, "score": 0, "creation_date": 1445681265, "post_id": 32497672, "comment_id": 54431947, "body": "Well, as of now I would not use cabal-install for anything anymore. I completely switched to stack - which makes this kind of situation obsolete for me."}, {"owner": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "edited": false, "score": 0, "creation_date": 1445689663, "post_id": 32497672, "comment_id": 54434305, "body": "Actually I wanted to <code>cabal install stack</code> but this only works with a recent version of cabal it seems so I had to upgrade cabal first. There probably would have been an easier way but this was good enough for me."}], "tags": [], "owner": {"reputation": 271, "user_id": 2925208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8cc2e6c8da46e3eb9be370b90d5fe06?s=128&d=identicon&r=PG&f=1", "display_name": "axm", "link": "https://stackoverflow.com/users/2925208/axm"}, "is_accepted": false, "score": 1, "last_activity_date": 1441876329, "creation_date": 1441876329, "answer_id": 32497672, "question_id": 30708737, "link": "https://stackoverflow.com/questions/30708737/unable-to-upgrade-cabal-to-the-latest-version-in-linux/32497672#32497672", "title": "Unable to upgrade cabal to the latest version in Linux", "body": "<p>Currently in ghc-7.10 there seems to be no way to upgrade cabal-install from 1.16 (which it is shipped with and reverts to when deleting .ghc).</p>\n\n<p>Workaround:</p>\n\n<ul>\n<li>install ghc-7.8 and</li>\n<li>upgrade cabal-install</li>\n<li>switch back to ghc-7.10</li>\n</ul>\n\n<p><a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2014-December/117512.html\" rel=\"nofollow\">https://mail.haskell.org/pipermail/haskell-cafe/2014-December/117512.html</a></p>\n\n<p>Luckily for me, I already had a script ready for switching versions globally:</p>\n\n<pre><code>#!/bin/bash -e\n\nif [ $# -ne 1 ]; then\n echo \"usage: $0 &lt;version&gt; \\# e.g.: $0 7.8.3 - being run for example in /usr/local/bin\"\n exit 1\nfi\n\nVERSION=$1\n\nsudo rm ghc\nsudo ln -s ghc-${VERSION} ghc\n\nsudo rm ghci\nsudo ln -s ghci-${VERSION} ghci\n\nsudo rm ghc-pkg\nsudo ln -s ghc-pkg-${VERSION} ghc-pkg\n\nsudo rm haddock \nsudo ln -s haddock-ghc-${VERSION} haddock\n\nsudo rm runghc\nsudo ln -s runghc-${VERSION} runghc\n</code></pre>\n\n<p>(May need adjustment depending on your ghc install.)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 972, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1441876329, "creation_date": 1433765183, "last_edit_date": 1433765742, "question_id": 30708737, "link": "https://stackoverflow.com/questions/30708737/unable-to-upgrade-cabal-to-the-latest-version-in-linux", "title": "Unable to upgrade cabal to the latest version in Linux", "body": "<p>I'm trying to upgrade cabal to the latest version because the current version has a bug:</p>\n\n<pre><code>cabal --version\ncabal-install version 1.16.0.2\nusing version 1.16.0 of the Cabal library \n\n which cabal\n/usr/bin/cabal\n\ncurl http://hackage.haskell.org/package/cabal-install-1.22.3.0/cabal-install-1.22.0.3.tar.gz\ntar xvfz cabal-install-1.22.3.0.tar.gz\ncd cabal-install-1.22.3.0\ncabal install\n</code></pre>\n\n<p>It <strong>seems</strong> to install cabal 1.22.3.0 in <code>~/.cabal</code> but there's no <code>bin</code> directory in it, there're only <code>share, packages, logs, lib</code> directories and I can't find executable in the folder.</p>\n\n<p>So can I find the new cabal which I've just installed? </p>\n\n<p>UPDATE:</p>\n\n<pre><code>cabal update\ncabal install cabal-install\n...................\nchecking for sendfile in sys/socket.h... no\nchecking for gethostent... yes\nchecking for accept4... yes\nconfigure: creating ./config.status\nconfig.status: creating network.buildinfo\nconfig.status: creating include/HsNetworkConfig.h\nconfigure: WARNING: unrecognized options: --with-compiler, --with-gcc\nBuilding network-2.6.2.0...\nPreprocessing library network-2.6.2.0...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install network-2.6.2.0\nConfiguring old-locale-1.0.0.7...\nBuilding old-locale-1.0.0.7...\nPreprocessing library old-locale-1.0.0.7...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install old-locale-1.0.0.7\nConfiguring random-1.1...\nBuilding random-1.1...\nPreprocessing library random-1.1...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install random-1.1\nConfiguring stm-2.4.4...\nBuilding stm-2.4.4...\nPreprocessing library stm-2.4.4...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install stm-2.4.4\nConfiguring text-1.2.1.1...\nBuilding text-1.2.1.1...\nPreprocessing library text-1.2.1.1...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install text-1.2.1.1\nConfiguring zlib-0.5.4.2...\nBuilding zlib-0.5.4.2...\nPreprocessing library zlib-0.5.4.2...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install zlib-0.5.4.2\ncabal: Error: some packages failed to install:\nHTTP-4000.2.19 depends on text-1.2.1.1 which failed to install.\ncabal-install-1.22.4.0 depends on zlib-0.5.4.2 which failed to install.\nmtl-2.2.1 failed during the building phase. The exception was:\nExitFailure 1\nnetwork-2.6.2.0 failed during the building phase. The exception was:\nExitFailure 1\nnetwork-uri-2.6.0.3 depends on text-1.2.1.1 which failed to install.\nold-locale-1.0.0.7 failed during the building phase. The exception was:\nExitFailure 1\nold-time-1.1.0.3 depends on old-locale-1.0.0.7 which failed to install.\nparsec-3.1.9 depends on text-1.2.1.1 which failed to install.\nrandom-1.1 failed during the building phase. The exception was:\nExitFailure 1\nstm-2.4.4 failed during the building phase. The exception was:\nExitFailure 1\ntext-1.2.1.1 failed during the building phase. The exception was:\nExitFailure 1\nzlib-0.5.4.2 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "instances"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 11, "last_activity_date": 1433760847, "creation_date": 1433760847, "answer_id": 30707290, "question_id": 30707249, "link": "https://stackoverflow.com/questions/30707249/ghc-complains-about-overlapping-instances-when-in-fact-they-are-not/30707290#30707290", "title": "GHC complains about overlapping instances when in fact they are not", "body": "<p>Instances are <em>only matched by the instance head</em>. So, for the purpose of overlapping or not, what you wrote is no better than</p>\n\n<pre><code>instance ToAVector [] a\ninstance ToAVector v a\n</code></pre>\n\n<p>which is clearly overlapping.</p>\n\n<p>To argue another way:</p>\n\n<blockquote>\n  <p>... as <code>[]</code> does not match <code>G.Vector [] a</code> ...</p>\n</blockquote>\n\n<p>this is never valid reasoning in Haskell, since type classes are <em>open</em>. You can never know something is not an instance of a particular class, because anyone could make it an instance later on.</p>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 30707290, "answer_count": 1, "score": 2, "last_activity_date": 1433760847, "creation_date": 1433760714, "question_id": 30707249, "link": "https://stackoverflow.com/questions/30707249/ghc-complains-about-overlapping-instances-when-in-fact-they-are-not", "title": "GHC complains about overlapping instances when in fact they are not", "body": "<p>I have the function <code>toAVector</code> defined like this:</p>\n\n<pre><code>class Elt a =&gt; ToAVector v a where\n  toAVector :: v a -&gt; A.Array DIM1 a\n\ninstance Elt a =&gt; ToAVector [] a where\n  toAVector l =\n    A.fromList (Z :. P.length l) l\n\ninstance (Elt a, G.Vector v a) =&gt; ToAVector v a where\n  toAVector v =\n    A.fromFunction (Z :. G.length v) (\\(Z :. i) -&gt; v G.! i)\n  {-# INLINE toAVector #-}\n</code></pre>\n\n<p>When trying to use <code>toAVector</code> in another library, I get the error:</p>\n\n<pre><code>Overlapping instances for ToAVector [] Double\n  arising from a use of \u2018toAVector\u2019\nMatching instances:\n  instance (A.Elt a, G.Vector v a) =&gt; ToAVector v a\n    -- Defined in \u2018Data.Array.Accelerate.Utils\u2019\n  instance A.Elt a =&gt; ToAVector [] a\n    -- Defined in \u2018Data.Array.Accelerate.Utils\u2019\n</code></pre>\n\n<p>This doesn't make sense to me as <code>[]</code> does not match <code>G.Vector [] a</code>, so how could the instances be overlapped? </p>\n"}, {"tags": ["haskell", "odbc", "hdbc", "haskelldb"], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457900573, "creation_date": 1457900573, "answer_id": 35975346, "question_id": 30706806, "link": "https://stackoverflow.com/questions/30706806/build-connection-with-haskelldb-hdbc-odbc/35975346#35975346", "title": "Build connection with HaskellDB.HDBC.Odbc", "body": "<p>You connect with the <code>odbcConnect</code> function in the <code>[haskelldb-hdbc-opbc][1]</code> package.</p>\n\n<p>Here is at its source:</p>\n\n<pre><code>odbcConnect :: MonadIO m =&gt; SqlGenerator -&gt; [(String,String)] -&gt; (Database -&gt; m a) -&gt; m a\nodbcConnect gen opts = hdbcConnect gen (connectODBC conninfo)\n    -- strangely enough, mysql+unixodbc want a semicolon terminating connstring\n    where conninfo = foldr (\\(k,v) z -&gt; k ++ \"=\" ++ v ++ \";\" ++ z) [] opts\n</code></pre>\n\n<p>There we can see that it calls out to <code>connectODBC</code> which you know how to use already. The difference is that here we take a list of pairs of <code>(OptionName,OptionValue)</code> rather than a simple string, and those options get rendered as <code>key=value;</code> pairs in the connection string passed to <code>connectODBC</code>.</p>\n"}], "owner": {"reputation": 133, "user_id": 3535953, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0eec2af1e498005f4f73387a2d958628?s=128&d=identicon&r=PG&f=1", "display_name": "user3535953", "link": "https://stackoverflow.com/users/3535953/user3535953"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1457900573, "creation_date": 1433759444, "question_id": 30706806, "link": "https://stackoverflow.com/questions/30706806/build-connection-with-haskelldb-hdbc-odbc", "title": "Build connection with HaskellDB.HDBC.Odbc", "body": "<p>I'm new to Haskell. I've read most of LYAH and RWH and have also done some small programms. No I would like to use Haskell with an Oracle DB. I would like to use HaskellDB with HDBC.ODBC.</p>\n\n<p>I was able to connect to the DB via HDBC and run a query. But I don't know how to connect via HaskellDB and ODBC. I can't find an example. </p>\n"}, {"tags": ["haskell", "pandoc"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1433838416, "post_id": 30704736, "comment_id": 49510039, "body": "might be a bug in pandoc... what version of pandoc are you using on what platform? can you reproduce with the newest version? what exactly is the input markdown? what&#39;s the smallest input you can reproduce this with?"}, {"owner": {"reputation": 965, "user_id": 4427499, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Stfuu.jpg?s=128&g=1", "display_name": "Vanarajan", "link": "https://stackoverflow.com/users/4427499/vanarajan"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1433840283, "post_id": 30704736, "comment_id": 49511238, "body": "I am using pandoc.exe 1.13.2 in windows 7 with node.js."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1433841827, "post_id": 30704736, "comment_id": 49512278, "body": "can you try the newest version and tell us: what exactly is the input markdown? what&#39;s the smallest input you can reproduce this with?"}, {"owner": {"reputation": 965, "user_id": 4427499, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Stfuu.jpg?s=128&g=1", "display_name": "Vanarajan", "link": "https://stackoverflow.com/users/4427499/vanarajan"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1433842625, "post_id": 30704736, "comment_id": 49512831, "body": "I will try.  Normally it is working fine.   Because of many images, it shows error. Small input conversion is working fine."}], "answers": [{"comments": [{"owner": {"reputation": 965, "user_id": 4427499, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Stfuu.jpg?s=128&g=1", "display_name": "Vanarajan", "link": "https://stackoverflow.com/users/4427499/vanarajan"}, "edited": false, "score": 0, "creation_date": 1433847407, "post_id": 30728948, "comment_id": 49516224, "body": "Got issue: size outside allowed  range."}, {"owner": {"reputation": 14059, "user_id": 1465387, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3ad9125ecbef5bfdf50aeb10d2c16502?s=128&d=identicon&r=PG", "display_name": "sebastian-c", "link": "https://stackoverflow.com/users/1465387/sebastian-c"}, "reply_to_user": {"reputation": 965, "user_id": 4427499, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Stfuu.jpg?s=128&g=1", "display_name": "Vanarajan", "link": "https://stackoverflow.com/users/4427499/vanarajan"}, "edited": false, "score": 1, "creation_date": 1476799933, "post_id": 30728948, "comment_id": 67492465, "body": "@Vanarajan If you&#39;re on Windows, there&#39;s a limit of 2GB. You can increase it with <a href=\"https://jonathanchang.org/coding/fixing-pandoc-out-of-memory-errors-on-windows/\" rel=\"nofollow noreferrer\">these instructions</a>."}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 1, "last_activity_date": 1433844674, "last_edit_date": 1433844674, "creation_date": 1433844212, "answer_id": 30728948, "question_id": 30704736, "link": "https://stackoverflow.com/questions/30704736/how-to-increase-heap-memory-in-pandoc-execution/30728948#30728948", "title": "How to increase heap memory in pandoc execution?", "body": "<p>You can increase the memory available to pandoc, to say <code>2048 MB</code>, with:</p>\n\n<pre><code>pandoc.exe +RTS -M2048\n</code></pre>\n\n<p>But the underlying problem is probably that Pandoc uses <a href=\"https://github.com/jgm/zip-archive\" rel=\"nofollow\">zip-archive</a> to zip the EPUB file. It seems you currently need at least as much memory as the uncompressed EPUB you want to generate (but I'd verify this before filing a bug report there).</p>\n\n<p>You probably also should scale down your images a bit since 2GB seems rather excessive for an e-book (even if it's a bit smaller when compressed).</p>\n"}], "owner": {"reputation": 965, "user_id": 4427499, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Stfuu.jpg?s=128&g=1", "display_name": "Vanarajan", "link": "https://stackoverflow.com/users/4427499/vanarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1856, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1433844674, "creation_date": 1433753310, "last_edit_date": 1433838295, "question_id": 30704736, "link": "https://stackoverflow.com/questions/30704736/how-to-increase-heap-memory-in-pandoc-execution", "title": "How to increase heap memory in pandoc execution?", "body": "<p>I am working on converting docx to epub.  Document contains lot of images.  When execution of converting, i have error:</p>\n\n<pre><code> \u201cpandoc.exe: Heap exhausted; Current maximum heap size is 1073741824 \n   bytes (1024 MB); use `+RTS -M' to increase it. \n   Error while executing job!\u201d\n</code></pre>\n\n<p>I am using Node.js.</p>\n\n<p>Can any one assist me how to increase heap size?</p>\n\n<p>Update: </p>\n\n<pre><code>I have increased size till 2GB.  But pandoc still shows error \n\"Pandoc.exe out of memory\"\n</code></pre>\n\n<p>Is it possible to solve this issue?</p>\n"}, {"tags": ["parsing", "haskell", "integer", "attoparsec"], "comments": [{"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 2, "creation_date": 1433752599, "post_id": 30704459, "comment_id": 49466691, "body": "Why do you have a hardcoded <code>char &#39;1&#39;</code> at the start of both the parsers? That wouldn&#39;t parse your sample input of <code>&quot;341&quot;</code>."}, {"owner": {"reputation": 171, "user_id": 4100057, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c6c4f4371c79d73eec08feecd688fb08?s=128&d=identicon&r=PG&f=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4100057/frank-wang"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1433752709, "post_id": 30704459, "comment_id": 49466766, "body": "Sorry, I didn&#39;t explain that. The actual input would look like 1341 but the first character is just a flag for the type of data that follows."}], "answers": [{"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 1, "last_activity_date": 1434283469, "last_edit_date": 1434283469, "creation_date": 1434138952, "answer_id": 30811194, "question_id": 30704459, "link": "https://stackoverflow.com/questions/30704459/how-can-i-parse-fixed-length-non-delimited-integers-with-attoparsec/30811194#30811194", "title": "How can I parse fixed-length, non-delimited integers with attoparsec?", "body": "<p>Your code snippet is far from being self-contained (in particular, imports and the definition of your <code>Packet</code> data type are missing), but you seem to be overcomplicating things.</p>\n\n<p>First, define a parser for one-digit integers. Then, use the latter as a building block for a parser for two-digit integers. After that, use applicative operators to combine those two parsers and define a parser for your custom <code>Packet</code> data type. See below.</p>\n\n<p>Note that you don't need the full power of monads; applicative parsing is sufficient, here.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- test_attoparsec.hs\n\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Applicative ((&lt;$&gt;))\nimport Data.Attoparsec.Text\nimport Data.Char\n\ndata Packet = Std {-# UNPACK #-} !Int\n                  {-# UNPACK #-} !Int\n  deriving (Show)\n\nstdK :: Parser Packet\nstdK = char '1' *&gt; (Std &lt;$&gt; twoDigitInt &lt;*&gt; oneDigitInt)\n\ntwoDigitInt :: Parser Int\ntwoDigitInt = timesTenPlus &lt;$&gt; oneDigitInt &lt;*&gt; oneDigitInt\n  where\n    timesTenPlus x y = 10 * x + y\n\noneDigitInt :: Parser Int\noneDigitInt = digitToInt &lt;$&gt; digit\n</code></pre>\n\n<p>Tests in GHCi:</p>\n\n<pre><code>\u03bb&gt; :l test_attoparsec.hs\n[1 of 1] Compiling Main             ( test_attoparsec.hs, interpreted )\nOk, modules loaded: Main.\n\n\u03bb&gt; :set -XOverloadedStrings \n\n\u03bb&gt; parseOnly stdK \"1341\"\nRight (Std 34 1)\n\n\u03bb&gt; parseOnly stdK \"212\"\nLeft \"1: Failed reading: satisfyWith\"\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 4100057, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c6c4f4371c79d73eec08feecd688fb08?s=128&d=identicon&r=PG&f=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4100057/frank-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 30811194, "answer_count": 1, "score": 3, "last_activity_date": 1434310492, "creation_date": 1433752443, "last_edit_date": 1434310492, "question_id": 30704459, "link": "https://stackoverflow.com/questions/30704459/how-can-i-parse-fixed-length-non-delimited-integers-with-attoparsec", "title": "How can I parse fixed-length, non-delimited integers with attoparsec?", "body": "<p>I'm trying to parse two integers from 3 characters using attoparsec. A sample input might look something like this:</p>\n\n<pre><code>341\n</code></pre>\n\n<p>... which I would like to parse into:</p>\n\n<pre><code>Constructor 34 1\n</code></pre>\n\n<p>I have two solutions that work but which are somewhat clunky:</p>\n\n<pre><code>stdK :: P.Parser Packet\nstdK = do\n    P.char '1'\n    qstr &lt;- P.take 2\n    let q = rExt $ P.parseOnly P.decimal qstr\n    n &lt;- P.decimal\n    return $ Std q n\n\nstdK2 :: P.Parser Packet\nstdK2 = do\n    P.char '1'\n    qn &lt;- P.decimal\n    let q = div qn 10\n    let n = rem qn 10\n    return $ Std q n\n</code></pre>\n\n<p>There must be a better way to achieve something as simple as this. Am I missing something?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433740946, "post_id": 30701532, "comment_id": 49461343, "body": "just to be sure - you use <code>Kind</code> not in the <code>* -&gt; *</code> sense right? Aside from that search for <i>type level functions</i> (in Haskell) - you can do quite a lot but we don&#39;t have full dependent types in Haskell (yet?)"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433741717, "post_id": 30701532, "comment_id": 49461604, "body": "@Carsten You&#39;re correct; the kind for SomeValue is <code>SomeKind -&gt; *</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1433745543, "post_id": 30701532, "comment_id": 49463054, "body": "You might find what you need in <a href=\"http://stackoverflow.com/questions/26291740/is-it-possible-to-get-the-kind-of-a-type-constructor-in-haskell/26293317#26293317\">this answer about a <code>Kindable</code> class</a>"}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 10, "last_activity_date": 1433750582, "last_edit_date": 1433750582, "creation_date": 1433745529, "answer_id": 30702605, "question_id": 30701532, "link": "https://stackoverflow.com/questions/30701532/how-to-bring-a-data-kind-to-the-value-level/30702605#30702605", "title": "How to bring a data kind to the value level?", "body": "<p><code>valueKind :: SomeValue a -&gt; SomeKind</code> is not possible. The <code>a</code> type parameter isn't present runtime in any shape or form, so we can't branch on it.</p>\n\n<p>The standard method for making use of types both at runtime and compile time is to make so-called singleton types. Singletons are indexed by the type-level version of the original type, and have the property that we can reveal the index by pattern matching on them:</p>\n\n<pre><code>data SSomeKind (i :: SomeKind) where\n  SKind1 :: SSomeKind Kind1\n  SKind2 :: SSomeKind Kind2\n</code></pre>\n\n<p>They're called singletons because for each type index there is only a single value. Similarly, for each value there is only a single choice of type index. This correspondence lets us use <code>SSomeKind</code> as a runtime representation of <code>SomeKind</code>. </p>\n\n<pre><code>valueKind' :: SSomeKind a -&gt; SomeKind\nvalueKind' SKind1 = Kind1\nvalueKind' SKind2 = Kind2\n</code></pre>\n\n<p>Creating singleton definitions and associated lifting and lowering functions is a rather mechanical job. The <a href=\"https://hackage.haskell.org/package/singletons\"><code>singletons</code></a> library automates and streamlines it. In our case:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, DataKinds, GADTs, TypeFamilies, ScopedTypeVariables #-}\n\nimport Data.Singletons.TH\n\n$(singletons [d| data SomeKind = Kind1 | Kind2  |])\n-- generates a lot of stuff, including the SSomeKind definition.\n\n-- works the same as our previously defined function\nvalueKind' :: SSomeKind a -&gt; SomeKind\nvalueKind' = fromSing\n\n-- we can also polymorphically get specific singleton values:\nfoo :: Sing Kind1\nfoo = sing -- now foo equals SKind1\n</code></pre>\n\n<p>There's a lot more in the library. See <a href=\"https://github.com/goldfirere/singletons\">this page</a> for a quick start and further references. </p>\n"}, {"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 5, "last_activity_date": 1433745620, "creation_date": 1433745620, "answer_id": 30702623, "question_id": 30701532, "link": "https://stackoverflow.com/questions/30701532/how-to-bring-a-data-kind-to-the-value-level/30702623#30702623", "title": "How to bring a data kind to the value level?", "body": "<p>You can define a type-class that returns the associated value based on the type-parameter.</p>\n\n<pre><code>class ValueKind (t :: SomeKind) where\n    valueKind :: f t -&gt; SomeKind\n\ninstance ValueKind Kind1 where\n    valueKind _ = Kind1\n\ninstance ValueKind Kind2 where\n    valueKind _ = Kind2\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1506418954, "post_id": 30702636, "comment_id": 79803161, "body": "This is the same idea as behind <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/type-level-literals.html\" rel=\"nofollow noreferrer\"><code>natVal :: KnownNat n =&gt; proxy n -&gt; Integer</code></a>, right?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 1, "creation_date": 1506422434, "post_id": 30702636, "comment_id": 79805554, "body": "@Turion Yes, it is."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 7, "last_activity_date": 1433745683, "creation_date": 1433745683, "answer_id": 30702636, "question_id": 30701532, "link": "https://stackoverflow.com/questions/30701532/how-to-bring-a-data-kind-to-the-value-level/30702636#30702636", "title": "How to bring a data kind to the value level?", "body": "<p>If you can tolerate a type class constraint, this can be accomplished with instances for each of the kinds in <code>SomeKind</code>. This is very similar to the <code>Kindable</code> typeclass </p>\n\n<pre><code>class SomeKindable (k :: SomeKind) where\n    someKindOf :: p k -&gt; SomeKind\n\ninstance SomeKindable Kind1 where\n    someKindOf _ = Kind1\n\ninstance SomeKindable Kind2 where\n    someKindOf _ = Kind2\n\nvalueKind ::  SomeKindable a =&gt; SomeValue a -&gt; SomeKind\nvalueKind = someKindOf\n</code></pre>\n\n<p>The compiler can't tell that for all <code>k :: SomeKind</code> there is a <code>SomeKindable k</code> instance. If you need this to be available for every <code>SomeValue</code> without being able to show <code>SomeKindable</code> you can package up the value along with a <code>SomeKindable</code> dictionary in a <code>GADT</code>.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata SomeValue (t :: SomeKind) where\n    SomeValue :: SomeKindable t =&gt; SomeValue t\n\nvalueKind :: SomeValue a -&gt; SomeKind\nvalueKind (p@SomeValue) = someKindOf p\n</code></pre>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 1, "accepted_answer_id": 30702605, "answer_count": 3, "score": 6, "last_activity_date": 1433750582, "creation_date": 1433739870, "question_id": 30701532, "link": "https://stackoverflow.com/questions/30701532/how-to-bring-a-data-kind-to-the-value-level", "title": "How to bring a data kind to the value level?", "body": "<p>I have something like this in my code:</p>\n\n<pre><code>data SomeKind = Kind1 | Kind2 deriving Eq\n\ndata SomeValue (t :: SomeKind) = SomeValue\n\nsomeValue1 :: SomeValue Kind1\nsomeValue1 = SomeValue\n\nsomeValue2 :: SomeValue Kind2\nsomeValue2 = SomeValue\n</code></pre>\n\n<p>I want to get the kind that's in the type level to the value level, perhaps something like:</p>\n\n<pre><code>valueKind :: SomeValue a -&gt; SomeKind\n</code></pre>\n\n<p>that will:</p>\n\n<pre><code>valueKind someValue1 == Kind1\nvalueKind someValue2 == Kind2\n</code></pre>\n\n<p>Is it possible?</p>\n"}, {"tags": ["postgresql", "haskell", "persistent", "esqueleto"], "owner": {"reputation": 237, "user_id": 3776949, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/be6672e55870194da81b207a1595fbac?s=128&d=identicon&r=PG&f=1", "display_name": "user3776949", "link": "https://stackoverflow.com/users/3776949/user3776949"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1433738147, "creation_date": 1433738147, "question_id": 30701305, "link": "https://stackoverflow.com/questions/30701305/specifying-postgres-table-schemas-in-esqueleto-persistent", "title": "Specifying Postgres table schemas in Esqueleto/Persistent", "body": "<p>I'm using Esqueleto with Postgres and I don't see a way to specify the schema that a table resides in.  Currently I'm issuing the following sql to set the schemas:</p>\n\n<pre><code>set search_path to foo,bar;\n</code></pre>\n\n<p>This allows me to use the tables I want as long as they are in schema foo or schema bar.  Is there a way to just set the schema for each table?</p>\n"}, {"tags": ["linux", "haskell", "ubuntu", "cabal"], "comments": [{"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1433776249, "post_id": 30700447, "comment_id": 49483067, "body": "Did you update GHC as well?"}], "answers": [{"comments": [{"owner": {"reputation": 266, "user_id": 222938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f48e48b36a6ba97bf1971b15cb1ac62?s=128&d=identicon&r=PG", "display_name": "Joe", "link": "https://stackoverflow.com/users/222938/joe"}, "edited": false, "score": 0, "creation_date": 1484072243, "post_id": 31933211, "comment_id": 70355985, "body": "Another possibility is that you have a locally-installed version of cabal that&#39;s too old.  Try <code>type cabal</code> and rm as necessary."}], "tags": [], "owner": {"reputation": 1489, "user_id": 1692268, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/54836036152193dbb1f54c65ad7d1623?s=128&d=identicon&r=PG", "display_name": "Shou", "link": "https://stackoverflow.com/users/1692268/shou"}, "is_accepted": false, "score": 1, "last_activity_date": 1439267174, "creation_date": 1439267174, "answer_id": 31933211, "question_id": 30700447, "link": "https://stackoverflow.com/questions/30700447/unable-to-upgrade-cabal-itself/31933211#31933211", "title": "Unable to upgrade cabal itself", "body": "<p>Most likely what has happened is that you've upgraded GHC, and GHC 7.10 requires Cabal 1.22, otherwise the error\n<code>ghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.</code> appears. Since you're on Ubuntu you can install <code>cabal-install</code> from <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow\">the PPA</a>:</p>\n\n<pre><code>sudo apt-add-repository ppa:hvr/ghc\nsudo apt-get update &amp;&amp; sudo apt-get install cabal-install-1.22\n</code></pre>\n\n<p>Since the PPA install location is isn't in the PATH you can either add <code>/opt/cabal/1.22/bin</code> to your PATH, or optionally run <code>/opt/cabal/1.22/bin/cabal install cabal</code> if you prefer to have all your Haskell binaries in one location and later uninstall <code>cabal-install</code> with <code>apt-get</code>.</p>\n\n<p>Otherwise there are binaries available at <a href=\"https://www.haskell.org/cabal/download.html\" rel=\"nofollow\">haskell.org</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1439267174, "creation_date": 1433729812, "question_id": 30700447, "link": "https://stackoverflow.com/questions/30700447/unable-to-upgrade-cabal-itself", "title": "Unable to upgrade cabal itself", "body": "<p>I'm trying to upgrade Cabal on Linux:</p>\n\n<pre><code>$ cabal --version\ncabal-install version 1.16.0.2\nusing version 1.16.0 of the Cabal library\n</code></pre>\n\n<p>And I get plenty of errors:</p>\n\n<pre><code>$ cabal install cabal cabal-install\n.............................\n\nchecking for sendfile in sys/socket.h... no\nchecking for gethostent... yes\nchecking for accept4... yes\nconfigure: creating ./config.status\nconfig.status: creating network.buildinfo\nconfig.status: creating include/HsNetworkConfig.h\nconfigure: WARNING: unrecognized options: --with-compiler, --with-gcc\nBuilding network-2.6.2.0...\nPreprocessing library network-2.6.2.0...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install network-2.6.2.0\nConfiguring old-locale-1.0.0.7...\nBuilding old-locale-1.0.0.7...\nPreprocessing library old-locale-1.0.0.7...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install old-locale-1.0.0.7\nConfiguring random-1.1...\nBuilding random-1.1...\nPreprocessing library random-1.1...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install random-1.1\nConfiguring stm-2.4.4...\nBuilding stm-2.4.4...\nPreprocessing library stm-2.4.4...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install stm-2.4.4\nConfiguring text-1.2.1.1...\nBuilding text-1.2.1.1...\nPreprocessing library text-1.2.1.1...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install text-1.2.1.1\nConfiguring zlib-0.5.4.2...\nBuilding zlib-0.5.4.2...\nPreprocessing library zlib-0.5.4.2...\nghc: ghc no longer supports single-file style package databases (dist/package.conf.inplace) use 'ghc-pkg init' to create the database with the correct format.\nFailed to install zlib-0.5.4.2\ncabal: Error: some packages failed to install:\nHTTP-4000.2.19 depends on text-1.2.1.1 which failed to install.\ncabal-install-1.22.4.0 depends on zlib-0.5.4.2 which failed to install.\nmtl-2.2.1 failed during the building phase. The exception was:\nExitFailure 1\nnetwork-2.6.2.0 failed during the building phase. The exception was:\nExitFailure 1\nnetwork-uri-2.6.0.3 depends on text-1.2.1.1 which failed to install.\nold-locale-1.0.0.7 failed during the building phase. The exception was:\nExitFailure 1\nold-time-1.1.0.3 depends on old-locale-1.0.0.7 which failed to install.\nparsec-3.1.9 depends on text-1.2.1.1 which failed to install.\nrandom-1.1 failed during the building phase. The exception was:\nExitFailure 1\nstm-2.4.4 failed during the building phase. The exception was:\nExitFailure 1\ntext-1.2.1.1 failed during the building phase. The exception was:\nExitFailure 1\nzlib-0.5.4.2 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "algebraic-data-types"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1433737724, "post_id": 30700169, "comment_id": 49460440, "body": "although I think that I know what you want (and probably Reid already <i>solved</i> it) can you please add what you understand under a <i>flat</i> data-structure? (Because you don&#39;t seem to mind the <i>recursion</i> which I find surprising)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433741228, "post_id": 30700169, "comment_id": 49461447, "body": "Specifically, I want it to be expressible as a sum of products with, yes, possibly, recursion on the bound variable. Ex: <code>data Rec a = A a (Rec a) | B a a a a | C a (Rec a) a | D a</code>, is perfectly valid. But recursion on another recursive procedure (such as the <code>[Tree a]</code> here) isn&#39;t OK. I want that specifically because I&#39;m encoding Haskell datatypes on the Lambda Calculus using the Scott Encoding, which doesn&#39;t account for nested types, so I have to somehow do it without nesting."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1433755279, "post_id": 30700169, "comment_id": 49468337, "body": "@Viclib <code>Tree</code> doesn&#39;t seem problematic to me, for Scott encoding. Shouldn&#39;t <a href=\"http://lpaste.net/134093\" rel=\"nofollow noreferrer\">this</a> work?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1433777054, "post_id": 30700169, "comment_id": 49483674, "body": "Andr&#225;s, not when you are trying to fold over them with normalizing terms, as you proved in another thread. For that, I had to extend the encoding with recursive calls, such that cons becomes <code>(head tail cons nil \u2192 cons cons nil head tail)</code> instead of <code>(head tail cons nil \u2192 cons head tail)</code>. Using that, I&#39;m able to derive a normalizing <code>fold</code> for any datatype generically by representing them as <code>Scott :: [[Field]]</code>, where <code>(Field :: Bool) == true if the field is recursive</code>. That way, List is represented as <code>[[false true] []]</code>, for example. Not sure it is the only way. Any idea?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1433824524, "post_id": 30700169, "comment_id": 49503369, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/30655680/how-do-you-represent-nested-types-using-the-scott-encoding\">How do you represent nested types using the Scott Encoding?</a>"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1433830459, "post_id": 30700169, "comment_id": 49505639, "body": "You are mistaken, it is not a duplicate, as I explained on the last edit."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1433741403, "post_id": 30701170, "comment_id": 49461514, "body": "That&#39;s neat, thank you. While it obviously solves the particular issue, it makes me curious, so, in case anyone is willing to, I&#39;d be very glad to hear why this is works and if this can always be done :)"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 12, "last_activity_date": 1433736981, "creation_date": 1433736981, "answer_id": 30701170, "question_id": 30700169, "link": "https://stackoverflow.com/questions/30700169/how-to-write-a-type-that-is-isomorphic-to-tree-without-nested-lists/30701170#30701170", "title": "How to write a type that is isomorphic to Tree without nested lists?", "body": "<p>Once you got to</p>\n\n<pre><code>T a = a * (1 + T a * L (T a))\n</code></pre>\n\n<p>you could continue</p>\n\n<pre><code>    = a + a * T a * L (T a)   -- distribute\n    = a + T a * (a * L (T a)) -- commute and reassociate\n    = a + T a * T a           -- using your original definition of T backwards\n</code></pre>\n\n<p>so you arrive at</p>\n\n<pre><code>data Tree a = Leaf a | InsertLeftmostSubtree (Tree a) (Tree a)\n</code></pre>\n\n<p>I'm not sure to what extent this is an instance of a general procedure, however.</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1433869380, "post_id": 30721273, "comment_id": 49532860, "body": "Thanks a lot for explaining your thought process, that was very insightful and helped me a lot with what I&#39;m doing."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1433812593, "last_edit_date": 1433812593, "creation_date": 1433810393, "answer_id": 30721273, "question_id": 30700169, "link": "https://stackoverflow.com/questions/30700169/how-to-write-a-type-that-is-isomorphic-to-tree-without-nested-lists/30721273#30721273", "title": "How to write a type that is isomorphic to Tree without nested lists?", "body": "<p>Before reading any of the answers, I thought this was a fun puzzle and worked out something equivalent to the accepted answer:</p>\n\n<pre><code>data Tree' a = Node a [Tree' a] deriving (Show, Eq, Ord)\ndata Tree a = Leaf a | Branch (Tree a) (Tree a) deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>Beyond that, I wrote the conversion functions, in what seems like the only possible way:</p>\n\n<pre><code>convert :: Tree' a -&gt; Tree a\nconvert (Node x [])     = (Leaf x)\nconvert (Node x (t:ts)) = Branch (convert t) $ convert (Node x ts)\n\nconvert' :: Tree a -&gt; Tree' a\nconvert' (Leaf x)      = Node x []\nconvert' (Branch t ts) = Node x $ convert' t : subtrees\n  where (Node x subtrees) = convert' ts\n</code></pre>\n\n<p>The implementations of these functions aren't a proof of correctness, but the fact that they typecheck, have no non-exhaustive pattern matches, and seem to work for simple inputs (ie <code>convert . convert' == id</code>), helps suggest that the data types are isomorphic to each other, which is encouraging.</p>\n\n<p>As for the general structure of how to build such a thing, I came at it differently than the type algebra in the accepted answer, so maybe my thought process will be helpful in deriving a general method. The main thing was noticing that <code>[x]</code> can be converted, in the usual way, to <code>data List a = Nil | Cons a (List a)</code>. So, we need to apply that transformation to the <code>[Tree' a]</code> field, while also preserving the extra <code>a</code> \"above\" the <code>[Tree' a]</code>. So, my <code>Leaf a</code> follows naturally as an equivalent to <code>Nil</code> but with an extra <code>a</code>; then the <code>Branch</code> constructor is analogous to <code>Cons b (List b)</code>.</p>\n\n<p>I think you can do something similar for any data constructor that contains a list: given <code>Constructor a b [c]</code>, you convert this to two constructors in the new type:</p>\n\n<pre><code>data Converted a b c = Nil a b | Cons c (Converted a b c)\n</code></pre>\n\n<p>And if there are two lists in the old constructor, you can give each of them a constructor for just adding a single item to one of the lists:</p>\n\n<pre><code>data Old a b c = Old a [b] [c]\n\ndata New a b c = Done a\n               | AddB b (New a b c)\n               | AddC c (New a b c)\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 1, "accepted_answer_id": 30701170, "answer_count": 2, "score": 9, "last_activity_date": 1433830620, "creation_date": 1433727254, "last_edit_date": 1495542589, "question_id": 30700169, "link": "https://stackoverflow.com/questions/30700169/how-to-write-a-type-that-is-isomorphic-to-tree-without-nested-lists", "title": "How to write a type that is isomorphic to Tree without nested lists?", "body": "<p>In Haskell, it is said that any ADT can be expressed as sum of products. I'm trying to find a flat type that is isomorphic to <code>Tree</code>, on <code>Data.Tree</code>.</p>\n\n<pre><code>Tree a = Node a [Tree a] -- has a nested type (List!)\n</code></pre>\n\n<p>I want to write a functionally identical definition for Tree without nested types:</p>\n\n<pre><code>Tree = ??? -- no nested types allowed\n</code></pre>\n\n<p>For that, I tried writing the recursive relation for the type algebras:</p>\n\n<pre><code>L a = 1 + a * L a\nT a = a * L (T a)\n</code></pre>\n\n<p>Inlining L, I had:</p>\n\n<pre><code>T a = a * (1 + T a * L (T a))\nT a = a * (1 * T a * (1 + T a * L (T a)))\nT a = a * (1 + T a * (1 + T a * (1 + T a * L (T a))))\n</code></pre>\n\n<p>That wasn't going anywhere, so I stopped and did the multiplications, leaving me with:</p>\n\n<pre><code>T a = a + a * T a + a * T a * T a ...\n</code></pre>\n\n<p>Which is the same as:</p>\n\n<pre><code>T a = a * (T a) ^ 0 + a * (T a) ^ 1 + a * (T a) ^ 2 ...\n</code></pre>\n\n<p>That is a sum of products, but it is infinite. I can't write that in Haskell. By abusing the algebra:</p>\n\n<pre><code>(T a) - (T a) ^ 2 = a * T a\n- (T a) ^ 2 - a * T a + (T a) = 0\n</code></pre>\n\n<p>Solving for <code>T a</code>, I found that:</p>\n\n<pre><code>T a = 1 - a\n</code></pre>\n\n<p>Which obviously doesn't make any sense. So, back to the original question: how do I flatten <code>Tree</code> from <code>Data.Tree</code> so I can write a type that is isomorphic to it without nested types?</p>\n\n<p>This question isn't a duplicate of <a href=\"https://stackoverflow.com/questions/30655680/how-do-you-represent-nested-types-using-the-scott-encoding\">my previous question</a>. The last one is about representing nested types with the Scott Encoding, for which the correct answer is \"ignore the nesting\". This one proceeds to ask how to flatten a nested type anyway (since it is needed for a particular use of the Scott Encoding, but not obligatory in general).</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1433696183, "post_id": 30696089, "comment_id": 49450354, "body": "Change your <code>Foo</code> to <code>foo</code>. Note that <code>foo</code> is a function that you get for free from Record syntax. You cannot have capital case for function names in Haskell. This has got nothing to do with handling capital case in JSON."}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1433698085, "post_id": 30696089, "comment_id": 49451039, "body": "ok, I thought that deriveJSON allowed the capital casing to match. So how could I decode a person object with capital letter within a JSON to match with my data object with lower casing?"}], "answers": [{"comments": [{"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1433708931, "post_id": 30697123, "comment_id": 49454547, "body": "@hammar-with that code should I not be able to write (decode &quot;{\\&quot;Foo\\&quot;:\\&quot;TEXT\\&quot;,\\&quot;bar\\&quot;:\\&quot;x\\&quot;}&quot; :: Maybe Person) &gt;&gt;= print in the main?"}, {"owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "reply_to_user": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1433743486, "post_id": 30697123, "comment_id": 49462229, "body": "@hotGopher: Yes, except for the <code>&gt;&gt;= print</code> part, since <code>decode</code> is a pure function. <code>print  (decode &quot;{\\&quot;Foo\\&quot;:\\&quot;TEXT\\&quot;,\\&quot;bar\\&quot;:\\&quot;x\\&quot;}&quot; :: Maybe Person)</code> should work, though, assuming you have <code>OverloadedStrings</code> enabled (<code>decode</code> takes a lazy <code>ByteString</code>)."}], "tags": [], "owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "is_accepted": true, "score": 10, "last_activity_date": 1433702319, "creation_date": 1433702319, "answer_id": 30697123, "question_id": 30696089, "link": "https://stackoverflow.com/questions/30696089/how-to-handle-capital-case-in-json/30697123#30697123", "title": "how to handle capital case in JSON?", "body": "<p><code>deriveJSON</code> and friends are Template Haskell functions which will generate instances for you. As such, you should not try to list them in the <code>deriving</code> clause. Instead, call them in a splice at the top level like this:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Data.Aeson.TH\n\ndata Person = Person { \n    foo :: String,\n    bar :: String\n} deriving (Eq, Show)\n\n$(deriveJSON defaultOptions ''Person)\n</code></pre>\n\n<p>As mentioned in the mailing list, you can customize the field names by overriding the <code>fieldLabelModifier</code> function of the <code>defaultOptions</code> record, for example this will change the JSON name of <code>foo</code> to <code>Foo</code>:</p>\n\n<pre><code>$(deriveFromJSON defaultOptions {\n    fieldLabelModifier = let f \"foo\" = \"Foo\"\n                             f other = other\n                         in f\n} ''Person)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 0, "last_activity_date": 1433702370, "creation_date": 1433702370, "answer_id": 30697132, "question_id": 30696089, "link": "https://stackoverflow.com/questions/30696089/how-to-handle-capital-case-in-json/30697132#30697132", "title": "how to handle capital case in JSON?", "body": "<p>Do you have any control of the instance being generated? If so, don't emit keys starting with capital letters.</p>\n\n<p>If not: Just define the instance yourself instead of deriving it. It's just a couple lines of code.</p>\n"}], "owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "accepted_answer_id": 30697123, "answer_count": 2, "score": 2, "last_activity_date": 1433702370, "creation_date": 1433696012, "question_id": 30696089, "link": "https://stackoverflow.com/questions/30696089/how-to-handle-capital-case-in-json", "title": "how to handle capital case in JSON?", "body": "<p>This is a stupid question, and I have tried to understand from different tutorials. When having a JSON with capital case Haskell crashes as explained by others (<a href=\"https://mail.haskell.org/pipermail/beginners/2013-October/012865.html\" rel=\"nofollow\">https://mail.haskell.org/pipermail/beginners/2013-October/012865.html</a>). As suggested it could be solved with deriving from deriveFromJSON. DeriveJSON requires a function input, how should I write the derive statement in the below code? I am missing something in my understanding, and would appreciate any help. </p>\n\n<pre><code>import Data.Aeson.TH\n\ndata Person = Person { \n        Foo :: String\n        , bar :: String\n    } deriving (Eq, Show, deriveJSON)\n\nmain = do \nlet b = Person \"t\" \"x\" \nprint b  \n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1433692755, "post_id": 30695451, "comment_id": 49449276, "body": "If you use explicit braces it seems the parser requires the <code>in</code> in the let statement. So <code>do { let x = 10 ; print x }</code> does not work but <code>do { let x = 10 in print x }</code> does. Alternatively, omit the braces and you can omit the <code>in</code>."}], "answers": [{"tags": [], "owner": {"reputation": 8263, "user_id": 32878, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e44c79ea155b0bca0a4027d9a38b11d0?s=128&d=identicon&r=PG", "display_name": "Jay Kominek", "link": "https://stackoverflow.com/users/32878/jay-kominek"}, "is_accepted": true, "score": 4, "last_activity_date": 1433692800, "creation_date": 1433692800, "answer_id": 30695610, "question_id": 30695451, "link": "https://stackoverflow.com/questions/30695451/how-to-properly-use-monadic-expressions-in-haskell-without-getting-parse-errors/30695610#30695610", "title": "How to properly use monadic expressions in Haskell without getting parse errors?", "body": "<pre><code>main = do let x = [0..10]\n          print x\n</code></pre>\n\n<p>works for me</p>\n\n<p>and so does</p>\n\n<pre><code>main = do { let x = [0..10]\n            in print x }\n</code></pre>\n\n<p>I think you're trying to mix some different syntax options up.</p>\n"}, {"tags": [], "owner": {"reputation": 7341, "user_id": 991762, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0427cc380ee354ba126c1f0cb89d719e?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/991762/chris"}, "is_accepted": false, "score": 5, "last_activity_date": 1433693038, "creation_date": 1433693038, "answer_id": 30695642, "question_id": 30695451, "link": "https://stackoverflow.com/questions/30695451/how-to-properly-use-monadic-expressions-in-haskell-without-getting-parse-errors/30695642#30695642", "title": "How to properly use monadic expressions in Haskell without getting parse errors?", "body": "<p>I was about to say, with no useful information,  that</p>\n\n<pre><code>main =  do \n    let x = [0..10]\n    print x\n</code></pre>\n\n<p>Was working for me, but I'm now off to read about the <code>in</code> within the braces. </p>\n\n<p>As a slight aside, I found <a href=\"http://echo.rsmw.net/n00bfaq.html\">http://echo.rsmw.net/n00bfaq.html</a> quite handy for reading about identation/formatting.</p>\n"}, {"comments": [{"owner": {"reputation": 7341, "user_id": 991762, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0427cc380ee354ba126c1f0cb89d719e?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/991762/chris"}, "edited": false, "score": 2, "creation_date": 1433696147, "post_id": 30695886, "comment_id": 49450340, "body": "Great answer, I&#39;m very new to Haskell (which is why I&#39;m browsing the SO questions) and this helped fill in the blanks."}, {"owner": {"reputation": 6568, "user_id": 1795924, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/tC8HY.jpg?s=128&g=1", "display_name": "Ericson Willians", "link": "https://stackoverflow.com/users/1795924/ericson-willians"}, "edited": false, "score": 0, "creation_date": 1433697461, "post_id": 30695886, "comment_id": 49450815, "body": "Very, very good! Yes, it was very helpful, and I now I understand it completely (And it&#39;s going to help other lost souls out there in the future)"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1433759788, "post_id": 30695886, "comment_id": 49471187, "body": "If I hadn&#39;t just spent a month reading the Report, I too would have no idea what you&#39;re talking about... Well played!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 15, "last_activity_date": 1433700891, "last_edit_date": 1433700891, "creation_date": 1433694674, "answer_id": 30695886, "question_id": 30695451, "link": "https://stackoverflow.com/questions/30695451/how-to-properly-use-monadic-expressions-in-haskell-without-getting-parse-errors/30695886#30695886", "title": "How to properly use monadic expressions in Haskell without getting parse errors?", "body": "<p>It took me a while to see what was actually going on here:</p>\n\n<pre><code>main = \n    do {\n    let x = [0..10];\n    print x\n}\n</code></pre>\n\n<p>The above looks as if we have a <code>do</code> with two statements, which is perfectly fine. Sure, it is not common practice to use explicit braces-and-semicolons when indentation implicitly inserts them. But they shouldn't hurt... why then the above fails parsing?</p>\n\n<p>The real issue is that <code>let</code> opens a new block! The <code>let</code> block has no braces, so the indentation rule applies. The block starts with the definition <code>x = [0..10]</code>. Then a semicolon is found, which promises that another definition is following e.g.</p>\n\n<pre><code>let x = [0..10] ; y = ...\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>let x = [0..10] ;\n      y = ...      -- must be indented as the x above, or more indented\n</code></pre>\n\n<p>However, after the semicolon we find <code>print</code>, which is even indented less than <code>x</code>. According to the indentation rule, this is equivalent to inserting braces like:</p>\n\n<pre><code>main = \n    do {\n    let { x = [0..10]; }\n    print x\n}\n</code></pre>\n\n<p>but the above does not parse. The error message does not refer to the implicitly inserted braces (which would be very confusing!), but only to the next line (nearly as confusing in this case, unfortunately).</p>\n\n<p>The code can be fixed by e.g. providing explicit braces for <code>let</code>:</p>\n\n<pre><code>main = do { let { x = [0..10] };\n            print x }\n</code></pre>\n\n<p>Above, indentation is completely irrelevant: you can add line breaks and/or spaces without affecting the parsing (e.g. as in Java, C, etc.). Alternatively, we can move the semicolon below:</p>\n\n<pre><code>main = do { let x = [0..10]\n          ; print x }\n</code></pre>\n\n<p>The above semicolon is on the next line and is less indented than <code>x</code>, implicitly inserting a <code>}</code> which closes the <code>let</code> block. Here indentation matters, since <code>let</code> uses the indentation rule. If we indent the semicolon more, we can cause the same parse error we found earlier.</p>\n\n<p>Of course, the most idiomatic choice is using the indentation rule for the whole code:</p>\n\n<pre><code>main = do let x = [0..10]\n          print x\n</code></pre>\n"}], "owner": {"reputation": 6568, "user_id": 1795924, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/tC8HY.jpg?s=128&g=1", "display_name": "Ericson Willians", "link": "https://stackoverflow.com/users/1795924/ericson-willians"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 30695610, "answer_count": 3, "score": 5, "last_activity_date": 1433700891, "creation_date": 1433691789, "last_edit_date": 1495542116, "question_id": 30695451, "link": "https://stackoverflow.com/questions/30695451/how-to-properly-use-monadic-expressions-in-haskell-without-getting-parse-errors", "title": "How to properly use monadic expressions in Haskell without getting parse errors?", "body": "<p>I'm running GHC version 7.8.3 on Windows 7.</p>\n\n<p>Ok, this is not about fancy code snippets. I'm just trying not be a noob here and actually compile something in a way that vaguely resembles the structure of side-effect languages.</p>\n\n<p>I have the following code:</p>\n\n<pre><code>main = \n    do {\n    let x = [0..10];\n    print x\n}\n</code></pre>\n\n<p><a href=\"https://wiki.haskell.org/Keywords#do\" rel=\"nofollow noreferrer\">I've learned here</a>, that the keyword do is a fancy syntactic sugar for fancy monadic expressions. When I try to compile it, I get the following error:</p>\n\n<pre><code>main.hs:4:1: parse error on input 'print'\n</code></pre>\n\n<p>And I've learned in <a href=\"https://stackoverflow.com/a/3441177/1795924\">this other question</a>, that tabs in Haskell are evil, so I've tried to omit them:</p>\n\n<pre><code>main = \n    do {\nlet x = [0..10];\nprint x\n}\n</code></pre>\n\n<p>And I've failed miserably, because the parse error persists.</p>\n\n<p><a href=\"https://stackoverflow.com/a/5952194/1795924\">I've also learned here</a>, that print is a syntactic sugar for the fancy equivalent:</p>\n\n<pre><code>main = \n    do {\n    let x = [0..10];\n    putStrLn $ show x \n}\n</code></pre>\n\n<p>But then I get this error instead:</p>\n\n<pre><code>main.hs:4:9: parse error on input 'putStrLn'\n</code></pre>\n\n<p>Trying to face my despair, I've tried to omit the let keyword, <a href=\"https://stackoverflow.com/a/6185168/1795924\">after reading this answer</a>:</p>\n\n<pre><code>main = \n    do {\n    x = [0..10];\n    print x \n}\n</code></pre>\n\n<p>And then I get:</p>\n\n<pre><code>main.hs:4:1: parse error on input '='\n</code></pre>\n\n<p>And in a final useless attempt, I've even tried to omit the ';' like this:</p>\n\n<pre><code>main = \n    do {\n    let x = [0..10]\n    print x \n}\n</code></pre>\n\n<p>And got:</p>\n\n<pre><code>main.hs:4:1: parse error on input 'print'\n</code></pre>\n\n<p>So,</p>\n\n<p><strong>How</strong> to properly use monadic expressions in Haskell without getting parse errors? Is there any hope? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1433698077, "post_id": 30694244, "comment_id": 49451035, "body": "hey you are posting quite a few questions all in that similar matter here - maybe instead you could try and explain what you are really trying to do - because your questions/functions get more and more complicated and there will most certainly be a much better way to solve your original problem than working with <b>9-tuples</b> (you should never do this - you need a genius to remember what every one of those 9 components are for when trying to understand your code)"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433685686, "post_id": 30694293, "comment_id": 49447050, "body": "It lacks a case for when there is more than one element as well."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433691642, "post_id": 30694293, "comment_id": 49448896, "body": "@chi True, good catch! I incorporated that into my answer now."}], "tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": true, "score": 4, "last_activity_date": 1433710209, "last_edit_date": 1433710209, "creation_date": 1433685086, "answer_id": 30694293, "question_id": 30694244, "link": "https://stackoverflow.com/questions/30694244/non-exhaustive-patterns-in-function-combadd1/30694293#30694293", "title": "Non-exhaustive patterns in function combadd1", "body": "<p><code>combadd1</code> doesn't have any definition in case the given list is empty, or in case the given list contains more than one element. Maybe the type of the function is not quite appropriate - why does it take a list in the first place? It may be that you can fix this issue by changing the type such that a 3-tuple is expected as the first argument (instead of a list of 3-tuples).</p>\n"}], "owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 30694293, "answer_count": 1, "score": 0, "last_activity_date": 1433710209, "creation_date": 1433684760, "question_id": 30694244, "link": "https://stackoverflow.com/questions/30694244/non-exhaustive-patterns-in-function-combadd1", "title": "Non-exhaustive patterns in function combadd1", "body": "<p>already added count - 1 > 0 terminate it , no infinity loop, do not know why it has this pattern</p>\n\n<pre><code>./hello\nhello: main.hs:(95,1)-(102,9): Non-exhaustive patterns in function combadd1\n</code></pre>\n\n<p>expect to add one of combination of output to output of logic table\nthough combination is not full combination, would like to glue back \none kind of combination to output of logic table</p>\n\n<p>code:</p>\n\n<pre><code>combadd :: [(Int, Int, Int)] -&gt; (Int, Int, Int, Int, Int, Int,Int, Int, Int) -&gt; Int -&gt; [(Int, Int, Int)]\ncombadd [] (a1,a2,a3,a4,a5,a6,a7,a8,a9) count = []\ncombadd ((x1,x2,x3):xs) (a1,a2,a3,a4,a5,a6,a7,a8,a9) count =\n  if x1 == 0 &amp;&amp; x2 == 0 \n  then (x1,x2,x3) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) count\n  else\n    if count == 9 then\n      (x1,x2,x3+a2) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) (count-1)\n    else if count == 8 then \n      (x1,x2,x3+a3) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) (count-1)\n    else if count == 7 then \n      (x1,x2,x3+a4) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) (count-1)\n    else if count == 6 then \n      (x1,x2,x3+a5) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) (count-1)\n    else if count == 5 then \n      (x1,x2,x3+a6) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) (count-1)\n    else if count == 4 then \n      (x1,x2,x3+a7) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) (count-1)\n    else if count == 3 then \n      (x1,x2,x3+a8) : combadd xs (a1,a2,a3,a4,a5,a6,a7,a8,a9) (count-1)\n    else if count == 2 then \n      (x1,x2,x3+a9) : []\n    else\n      []\n\ncombadd1 :: [(Int, Int, Int)] -&gt; [(Int, Int, Int, Int, Int, Int, Int, Int, Int)] -&gt; Int -&gt; Int -&gt; [(Int, Int, Int)]\ncombadd1 [(x1,x2,x3)] ((a1,a2,a3,a4,a5,a6,a7,a8,a9):ys) count po =\n  if count == po\n  then combadd [(x1,x2,x3)] (a1,a2,a3,a4,a5,a6,a7,a8,a9) 9\n  else\n     if count-1 &gt; 0 then \n       combadd1 [(x1,x2,x3)] ys (count-1) po\n     else\n       []\n\ncomb0 :: [(Int, Int, Int)]\ncomb0 = do\n   a &lt;- [0,1,2]\n   b &lt;- [0,1,2]\n   return (a, b, max a b)\n\ncomb :: [(Int, Int, Int, Int, Int, Int, Int, Int, Int)]\ncomb = do\n   a1 &lt;- [0]\n   a2 &lt;- [0,1]\n   a3 &lt;- [0]\n   a4 &lt;- [0,1] \n   a5 &lt;- [0,1]\n   a6 &lt;- [0]\n   a7 &lt;- [0]\n   a8 &lt;- [0]\n   a9 &lt;- [0]\n   return (a1,a2,a3,a4,a5,a6,a7,a8,a9)\n\nmain :: IO()\nmain = do \n  mapM_ print $ combadd1 comb0 comb 3 3\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads", "do-notation"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 5, "creation_date": 1433689993, "post_id": 30694178, "comment_id": 49448365, "body": "<code>&lt;-</code> <i>Does not</i> &#39;remove&#39; the value from a monad. It is syntactic sugar that <i>represents</i> pulling out a value, but is actually just manipulating it in a specific manner. For this reason, you can treat functions as monads, because, while you can&#39;t literally &#39;pull out&#39; the result of a function, you can pipe functions together to make another."}], "answers": [{"comments": [{"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 2, "creation_date": 1433688553, "post_id": 30694452, "comment_id": 49447903, "body": "You might want to name the monad (Reader) so that the asker can search for resources about it. :)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1433691433, "post_id": 30694452, "comment_id": 49448826, "body": "I wouldn&#39;t call it a &#39;wierd&#39; monad; it&#39;s certainly difficult to get your head around at first, but it, to my mind, is the perfect example of a Monad as an unreachable computation, or computational context."}], "tags": [], "owner": {"reputation": 44935, "user_id": 79061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3807bbfd4712d98d2ac0c79f01feb921?s=128&d=identicon&r=PG", "display_name": "Sebastian Paaske T&#248;rholm", "link": "https://stackoverflow.com/users/79061/sebastian-paaske-t%c3%b8rholm"}, "is_accepted": true, "score": 16, "last_activity_date": 1433686022, "creation_date": 1433686022, "answer_id": 30694452, "question_id": 30694178, "link": "https://stackoverflow.com/questions/30694178/what-is-the-type-of-the-variable-in-do-notation-here-in-haskell/30694452#30694452", "title": "What is the type of the variable in do-notation here in Haskell?", "body": "<p>Well, you've stumbled upon a kind of weird monad.</p>\n\n<p>The monad in question is the <code>Monad ((-&gt;) r)</code>. Now, what does that mean? Well, it's the monad of functions of the form <code>r -&gt; *</code>. I.e., of functions that take the same type of input.</p>\n\n<p>You asked what the type of <code>a</code> and <code>b</code> are in this instance. Well, they are both <code>Num a =&gt; a</code>, but that doesn't really explain much.</p>\n\n<p>Intuitively, we can understand the monad like this: A monadic value is a function that takes a value of type <code>r</code> as input. Whenever we bind in the monad, we take that value and pass it to the bound function.</p>\n\n<p>I.e., in our <code>addStuff</code> example, if we call <code>addStuff 5</code>, then <code>a</code> is bound to <code>(*2) 5</code> (which is <code>10</code>), and <code>b</code> is bound to <code>(+10) 5</code> (which is <code>15</code>).</p>\n\n<p>Let's see a simpler example from this monad to try to understand how it works precisely:</p>\n\n<pre><code>mutate = do a &lt;- (*2)\n            return (a + 5)\n</code></pre>\n\n<p>If we desugar this to a bind, we get:</p>\n\n<pre><code>mutate = (*2) &gt;&gt;= (\\a -&gt; return (a + 5))\n</code></pre>\n\n<p>Now, this doesn't help much, so let's use <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#line-621\" rel=\"noreferrer\">the definition of bind</a> for this monad:</p>\n\n<pre><code>mutate = \\ r -&gt; (\\a -&gt; return (a + 5)) ((*2) r) r\n</code></pre>\n\n<p>This reduces to</p>\n\n<pre><code>mutate = \\ r -&gt; return ((r*2) + 5) r\n</code></pre>\n\n<p>Which we using the definition that <code>return</code> is <code>const</code>, can reduce to</p>\n\n<pre><code>mutate = \\ r -&gt; (r*2) + 5\n</code></pre>\n\n<p>Which is a function, that multiplies a number by 2, and then adds 5.</p>\n\n<p>That's one weird monad.</p>\n"}, {"tags": [], "owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "is_accepted": false, "score": 9, "last_activity_date": 1433691144, "creation_date": 1433691144, "answer_id": 30695328, "question_id": 30694178, "link": "https://stackoverflow.com/questions/30694178/what-is-the-type-of-the-variable-in-do-notation-here-in-haskell/30695328#30695328", "title": "What is the type of the variable in do-notation here in Haskell?", "body": "<p>Given <code>addStuff</code></p>\n\n<pre><code>addStuff :: Int -&gt; Int\naddStuff = do\n  a&lt;-(*2)\n  b&lt;-(+10)\n  return (a+b)\n</code></pre>\n\n<p>the definition desugars into</p>\n\n<pre><code>addStuff = \n    (* 2) &gt;&gt;= \\a -&gt; \n        (+ 10) &gt;&gt;= \\b -&gt; \n            return (a + b)\n</code></pre>\n\n<p>Hovering over the <code>&gt;&gt;=</code> in <a href=\"https://www.fpcomplete.com/page/project-build\">fpcomplete online editor</a> shows</p>\n\n<pre><code>:: Monad m =&gt; forall a b. \n              (m a       ) -&gt; (a   -&gt; m b       ) -&gt; (m b       )\n::            (Int -&gt; a  ) -&gt; (a   -&gt; Int -&gt; b  ) -&gt; (Int -&gt; b  )\n::            (Int -&gt; Int) -&gt; (Int -&gt; Int -&gt; Int) -&gt; (Int -&gt; Int)\n</code></pre>\n\n<p>That leads us to believe we use a Monad instance for functions. Indeed if we look at the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#line-621\">source code</a>, we see</p>\n\n<pre><code>instance Monad ((-&gt;) r) where\n    return = const\n    f &gt;&gt;= k = \\ r -&gt; k (f r) r\n</code></pre>\n\n<hr>\n\n<p>Using this newly obtained information we can evaluate the <code>addStuff</code> function ourselves.</p>\n\n<p>Given the initial expression </p>\n\n<pre><code>(* 2) &gt;&gt;= ( \\a -&gt; (+10) &gt;&gt;= \\b -&gt; return (a + b) )\n</code></pre>\n\n<p>we substitute using the <code>&gt;&gt;=</code> definition, giving us (in the following <code>{}</code>, <code>[]</code>, <code>()</code> just illustrate different depth of <code>()</code>)</p>\n\n<pre><code>\\r1 -&gt; {\\a -&gt; (+10) &gt;&gt;= \\b -&gt; return (a + b)} {(* 2) r1} r1\n</code></pre>\n\n<p>simplify the second-to-last term inside the outermost lambda</p>\n\n<pre><code>\\r1 -&gt; {\\a -&gt; (+10) &gt;&gt;= \\b -&gt; return (a + b)} {r1 * 2} r1\n</code></pre>\n\n<p>apply <code>{r1 * 2}</code> to <code>{\\a -&gt; ...}</code></p>\n\n<pre><code>\\r1 -&gt; {(+10) &gt;&gt;= \\b -&gt; return ((r1 * 2) + b)} r1 \n</code></pre>\n\n<p>substitute remaining <code>&gt;&gt;=</code> with its definition again</p>\n\n<pre><code>\\r1 -&gt; {\\r2 -&gt; [\\b -&gt; return (r1 * 2 + b)] [(+10) r2] r2} r1\n</code></pre>\n\n<p>simplify second-to-last term inside inner lambda</p>\n\n<pre><code>\\r1 -&gt; {\\r2 -&gt; [\\b -&gt; return (r1 * 2 + b)] [r2 + 10] r2} r1\n</code></pre>\n\n<p>apply <code>[r2 + 10]</code> to <code>{\\b -&gt; ...}</code></p>\n\n<pre><code>\\r1 -&gt; {\\r2 -&gt; [return (r1 * 2 + (r2 + 10))] r2} r1\n</code></pre>\n\n<p>apply <code>r1</code> to <code>{\\r2 -&gt; ...}</code></p>\n\n<pre><code>\\r1 -&gt; {return (r1 * 2 + r1 + 10) r1}\n</code></pre>\n\n<p>substitute <code>return</code> with its definition</p>\n\n<pre><code>\\r1 -&gt; {const (r1 * 2 + r1 + 10) r1}\n</code></pre>\n\n<p>evaluate <code>const x _ = x</code></p>\n\n<pre><code>\\r1 -&gt; {r1 * 2 + r1 + 10}\n</code></pre>\n\n<p>prettify</p>\n\n<pre><code>\\x -&gt; 3 * x + 10\n</code></pre>\n\n<p>finally we get</p>\n\n<pre><code>addStuff :: Int -&gt; Int\naddStuff = (+ 10) . (* 3)\n</code></pre>\n"}], "owner": {"reputation": 38877, "user_id": 1272683, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6ea2bbebf39d8f4d9ba654471289d576?s=128&d=identicon&r=PG", "display_name": "Hanfei Sun", "link": "https://stackoverflow.com/users/1272683/hanfei-sun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 2, "accepted_answer_id": 30694452, "answer_count": 2, "score": 13, "last_activity_date": 1433691144, "creation_date": 1433684355, "last_edit_date": 1433689838, "question_id": 30694178, "link": "https://stackoverflow.com/questions/30694178/what-is-the-type-of-the-variable-in-do-notation-here-in-haskell", "title": "What is the type of the variable in do-notation here in Haskell?", "body": "<p>The codes below looks quite clear:</p>\n\n<pre><code>do \n  x &lt;- Just 3\n  y &lt;- Just \"!\"\n  Just (show x ++ y)\n</code></pre>\n\n<p>Here the type of <code>x</code> is <code>Num</code> and <code>y</code> is <code>String</code>. (<code>&lt;-</code> here is used to take actual value out of the Monad)</p>\n\n<p>However, this snippet looks not so clear to me:</p>\n\n<pre><code>import Control.Monad.Instances\naddStuff :: Int -&gt; Int\naddStuff = do\n  a &lt;- (* 2)\n  b &lt;- (+ 10)\n  return (a + b)\n</code></pre>\n\n<p>What is the type of <code>a</code> and type of <code>b</code> here? It seems they act like a <code>Num</code>, but <code>a &lt;- (* 2)</code> and <code>b &lt;- (+ 10)</code> looks cryptic here...</p>\n\n<p>Does anyone have ideas about this?</p>\n"}, {"tags": ["haskell", "build", "ghc", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433690365, "post_id": 30694118, "comment_id": 49448473, "body": "If I understand correctly, one of your modules is named the same as a module from one of the libraries you have installed. If that is the case, the simplest way to hide that library is probably to use a <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#developing-with-sandboxes\" rel=\"nofollow noreferrer\">cabal sandbox</a>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1433693450, "post_id": 30694118, "comment_id": 49449481, "body": "<i>Don&#39;t</i>. Avoid name clashes. Sure you can work around them but it&#39;s a lot of work when you simply could avoid all the hassle by choosing  a unique name."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 2, "last_activity_date": 1433695535, "creation_date": 1433695535, "answer_id": 30696016, "question_id": 30694118, "link": "https://stackoverflow.com/questions/30694118/force-ghc-using-local-files/30696016#30696016", "title": "Force GHC using local files", "body": "<p>Yes, use <code>ghc -hide-package evil-package</code>. Or you can hide the package temporarily with <code>ghc-pkg hide evil-package</code>, and then undo it later with <code>ghc-pkg expose evil-package</code>.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 30696016, "answer_count": 1, "score": 2, "last_activity_date": 1433695535, "creation_date": 1433684024, "question_id": 30694118, "link": "https://stackoverflow.com/questions/30694118/force-ghc-using-local-files", "title": "Force GHC using local files", "body": "<p>I'm making some \"experiments\" on a haskell module and I have a problem with a source file I wish to modify. </p>\n\n<p>I have many reasons to think that GHC seek the installed (with cabal) library on my system and not the local sources files.<br>\nI deleted the <code>*.o</code> files locally and the other source files in this module are not rebuild by GHC.</p>\n\n<p><strong>Can I force GHC to use the local sources files of a module or ignore an installed module in particular?</strong>  </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": false, "score": 4, "last_activity_date": 1433679060, "creation_date": 1433679060, "answer_id": 30693366, "question_id": 30693323, "link": "https://stackoverflow.com/questions/30693323/couldnt-match-expected-type-int-int-int-int-b5/30693366#30693366", "title": "Couldn&#39;t match expected type `((Int, Int, Int) -&gt; Int, b5)&#39;", "body": "<p>The function <code>fst</code> takes a pair, not a triple.</p>\n\n<pre><code>fst :: (a, b) -&gt; a\n</code></pre>\n\n<p>You need a different function, <code>fst3</code>:</p>\n\n<pre><code>fst3 :: (a, b, c) -&gt; a\n</code></pre>\n\n<p>You can write this function, or you can use pattern matching / switch expressions.</p>\n\n<p>The appearance of <code>fst snd x</code> also makes no sense, because <code>fst</code> only takes one argument, and <code>x</code> has type <code>(Int, Int, Int)</code> anyway.  Not sure what you're trying to accomplish here.  Try using pattern matching or switch expressions.</p>\n\n<p>This is not intended to be exhaustive.  There are other problems in the code.</p>\n"}, {"comments": [{"owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433680862, "post_id": 30693548, "comment_id": 49445719, "body": "could you help me one more in <a href=\"http://stackoverflow.com/questions/30662811/how-to-do-combination-for-extra-column-view-with-maximum-value-2\" title=\"how to do combination for extra column view with maximum value 2\">stackoverflow.com/questions/30662811/&hellip;</a>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433681946, "post_id": 30693548, "comment_id": 49446026, "body": "I just did - but you should really try to figure it out yourself - also (I hope you don&#39;t mind me asking): Do you try to learn FP, F# and Haskell all at the same time? If so I would drop one of the languages for now and only concentrate on the FP parts - the other language will be easy to learn after (well if it&#39;s Haskell the basics will be easy to learn at least)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1433680618, "last_edit_date": 1433680618, "creation_date": 1433680198, "answer_id": 30693548, "question_id": 30693323, "link": "https://stackoverflow.com/questions/30693323/couldnt-match-expected-type-int-int-int-int-b5/30693548#30693548", "title": "Couldn&#39;t match expected type `((Int, Int, Int) -&gt; Int, b5)&#39;", "body": "<p>As Dietrich pointed you already to the main problem I thought I could help you out a bit more.</p>\n\n<p>This one will compile and I think it does what you want (although I am not sure):</p>\n\n<pre><code>comb0 :: [(Int, Int, Int)]\ncomb0 = do\n   a &lt;- [0,1,2]\n   b &lt;- [0,1,2]\n   return (a, b, max a b)\n\nfirstlogic :: [(Int, Int, Int)] -&gt; Int -&gt; Int -&gt; Int\nfirstlogic [] _ _ = 0\nfirstlogic ((x1,x2,x3):xs) a1 b1\n  | x1==a1 &amp;&amp; x2==b1 = x3\n  | otherwise = firstlogic xs a1 b1\n\n\nmain :: IO ()\nmain = \n  print $ firstlogic comb0 1 2\n</code></pre>\n\n<p>the reason why I am not sure if it does what you want is that I don't understand what you are trying to do - first you take every combination of <code>[0,1,2]</code> with itself, add the maximum of the two parts and then you search for a certain combination in <code>firstlogic</code> and return the <code>max</code> again</p>\n\n<p>If I am right this function does exactly the same but does not need <code>comb0</code> and has no need to search:</p>\n\n<pre><code>firstlogic :: Int -&gt; Int -&gt; Int\nfirstlogic = max\n</code></pre>\n\n<p>(ok: what it does not is check if both of the inputs are in <code>[0,1,2]</code> - but you can easily add this)</p>\n"}], "owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 30693548, "answer_count": 2, "score": 0, "last_activity_date": 1433680618, "creation_date": 1433678767, "question_id": 30693323, "link": "https://stackoverflow.com/questions/30693323/couldnt-match-expected-type-int-int-int-int-b5", "title": "Couldn&#39;t match expected type `((Int, Int, Int) -&gt; Int, b5)&#39;", "body": "<p>do not know why debug many times still have error even if explicit declare type\nint, do not know where do b0, a0, b2 come from</p>\n\n<pre><code> ghc -o hello main.hs\n[1 of 1] Compiling Main             ( main.hs, main.o )\n\nmain.hs:92:10:\n    Couldn't match expected type `(Int, b0)'\n                with actual type `(Int, Int, Int)'\n    In the first argument of `fst', namely `x'\n    In the first argument of `(==)', namely `fst x'\n    In the first argument of `(&amp;&amp;)', namely `fst x == a1'\n\nmain.hs:92:25:\n    Couldn't match expected type `((Int, Int, Int) -&gt; Int, b1)'\n                with actual type `(a0, b2) -&gt; b2'\n    In the first argument of `fst', namely `snd'\n    In the first argument of `(==)', namely `fst snd x'\n    In the second argument of `(&amp;&amp;)', namely `fst snd x == b1'\n\nmain.hs:93:12:\n    Couldn't match expected type `(a1, (Int, Int, Int) -&gt; Int)'\n                with actual type `(a2, b3) -&gt; b3'\n    In the first argument of `snd', namely `snd'\n    In the expression: snd snd x\n    In a stmt of a 'do' block:\n      if fst x == a1 &amp;&amp; fst snd x == b1 then snd snd x else 0\n\nmain.hs:97:10:\n    Couldn't match expected type `(Int, b4)'\n                with actual type `(Int, Int, Int)'\n    In the first argument of `fst', namely `x'\n    In the first argument of `(==)', namely `fst x'\n    In the first argument of `(&amp;&amp;)', namely `fst x == a1'\n\nmain.hs:97:25:\n    Couldn't match expected type `((Int, Int, Int) -&gt; Int, b5)'\n                with actual type `(a3, b6) -&gt; b6'\n    In the first argument of `fst', namely `snd'\n    In the first argument of `(==)', namely `fst snd x'\n    In the second argument of `(&amp;&amp;)', namely `fst snd x == b1'\n\nmain.hs:98:12:\n    Couldn't match expected type `(a4, (Int, Int, Int) -&gt; Int)'\n                with actual type `(a5, b7) -&gt; b7'\n    In the first argument of `snd', namely `snd'\n    In the expression: snd snd x\n    In a stmt of a 'do' block:\n      if fst x == a1 &amp;&amp; fst snd x == b1 then\n          snd snd x\n      else\n          firstlogic xs a1 b1\n</code></pre>\n\n<p>this code mainly to use generated logic table as a function to return the value\nof the logic after input two parameters\ncode:</p>\n\n<pre><code>comb0 :: [(Int, Int, Int)]\ncomb0 = do\n   a &lt;- [0,1,2]\n   b &lt;- [0,1,2]\n   return (a, b, max a b)\n\nfirstlogic :: [(Int, Int, Int)] -&gt; Int -&gt; Int -&gt; Int\nfirstlogic [] a1 b1 = 0\nfirstlogic [x] a1 b1 = do\n  if fst x == a1 &amp;&amp; fst snd x == b1\n  then snd snd x\n  else\n    0\nfirstlogic (x:xs) a1 b1 = do\n  if fst x == a1 &amp;&amp; fst snd x == b1\n  then snd snd x \n  else\n    firstlogic xs a1 b1\n\nmain :: IO()\nmain = do \n  print firstlogic comb0 1 2\n</code></pre>\n"}, {"tags": ["list", "pointers", "haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 228114, "user_id": 33213, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ca5a23ced3d81ee8bfa73b8fdc1677c2?s=128&d=identicon&r=PG", "display_name": "jalf", "link": "https://stackoverflow.com/users/33213/jalf"}, "edited": false, "score": 9, "creation_date": 1433681339, "post_id": 30692645, "comment_id": 49445858, "body": "I like algorithms which depend on &quot;there <i>may</i> be some tricks to do this in constant time&quot;. :)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1433698492, "post_id": 30692645, "comment_id": 49451189, "body": "None of the language you used (&quot;pointers&quot;, &quot;copy&quot;, &quot;linked list&quot;) make much sense in the context of Haskell&#39;s semantics. <code>[a]</code> is not at all a linked list, although it might resemble one in the way GHC lays it out in memory (or it might not, or it might not exist in memory at all)"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1433736150, "post_id": 30692645, "comment_id": 49460087, "body": "How do you plan to copy <i>n</i> things without taking O(<i>n</i>) time?"}, {"owner": {"reputation": 38877, "user_id": 1272683, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6ea2bbebf39d8f4d9ba654471289d576?s=128&d=identicon&r=PG", "display_name": "Hanfei Sun", "link": "https://stackoverflow.com/users/1272683/hanfei-sun"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1433736349, "post_id": 30692645, "comment_id": 49460128, "body": "@immibis @jalf only copy the part which will be changed later, which is the last element of <code>a</code>"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 5, "creation_date": 1433736469, "post_id": 30692645, "comment_id": 49460151, "body": "@hanfeisun But then the second-to-last element needs to point to the new last element. And then the third-to-last element needs to point to the new second-to-last element."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1433736550, "post_id": 30692645, "comment_id": 49460170, "body": "You&#39;d be right if lists were trees, then you could allocate a new root node pointing to both the original lists."}, {"owner": {"reputation": 38877, "user_id": 1272683, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6ea2bbebf39d8f4d9ba654471289d576?s=128&d=identicon&r=PG", "display_name": "Hanfei Sun", "link": "https://stackoverflow.com/users/1272683/hanfei-sun"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1433736704, "post_id": 30692645, "comment_id": 49460193, "body": "@immibis got it, thanks!"}, {"owner": {"reputation": 2768, "user_id": 4271479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/288848609fdf4ebb07ce8104e2a45559?s=128&d=identicon&r=PG&f=1", "display_name": "mastov", "link": "https://stackoverflow.com/users/4271479/mastov"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1433875348, "post_id": 30692645, "comment_id": 49536444, "body": "@immibis: NO, that tree data structure wouldn&#39;t save you. When you finally iterate over the list, the additional treatment of additional root node would add a constant-time overhead to the access of every element of the first part of the list - effectively adding the O(n) additional time again!"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 2768, "user_id": 4271479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/288848609fdf4ebb07ce8104e2a45559?s=128&d=identicon&r=PG&f=1", "display_name": "mastov", "link": "https://stackoverflow.com/users/4271479/mastov"}, "edited": false, "score": 0, "creation_date": 1433900291, "post_id": 30692645, "comment_id": 49546658, "body": "@mastov Iterating over a list is always at least O(n), so in terms of big-O notation, nothing changes."}, {"owner": {"reputation": 2768, "user_id": 4271479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/288848609fdf4ebb07ce8104e2a45559?s=128&d=identicon&r=PG&f=1", "display_name": "mastov", "link": "https://stackoverflow.com/users/4271479/mastov"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1433925963, "post_id": 30692645, "comment_id": 49556913, "body": "@immibis: That simplification only works, if you iterate at least once per application of <code>++</code>, but not in general. Just take the na&#239;ve <code>myrev</code> operation as example: <code>myrev [] = [] ; myrev (x:xs) = myrev xs ++ [x]</code>. For a list of length n it applies <code>++</code> n times before someone iterates over the result, so in your tree it would add n nodes: <code>CombList (CombList (CombList ... [x3]) [x2]) [x1]</code>. Accessing the first element <code>xn</code> of the reversed list requires going through all n nodes, accessing the second element n-1 nodes etc., so it&#39;s quadratic, which is only possible if you consider <code>++</code> linear."}], "answers": [{"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 17, "last_activity_date": 1433674837, "creation_date": 1433674837, "answer_id": 30692744, "question_id": 30692645, "link": "https://stackoverflow.com/questions/30692645/why-is-for-haskell-list-implemented-recursively-and-costs-on-time/30692744#30692744", "title": "Why is `++` for Haskell List implemented recursively and costs O(n) time?", "body": "<p>That's pretty much what the recursive solution does. It's the copying of <code>a</code> which takes O(n) (where <code>n</code> is the length of <code>a</code>. The length of <code>b</code> doesn't affect the complexity).</p>\n\n<p>There is really no \"trick\" to copy a list of <code>n</code> elements in O(1) time.</p>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 12, "last_activity_date": 1433680505, "last_edit_date": 1433680505, "creation_date": 1433679494, "answer_id": 30693437, "question_id": 30692645, "link": "https://stackoverflow.com/questions/30692645/why-is-for-haskell-list-implemented-recursively-and-costs-on-time/30693437#30693437", "title": "Why is `++` for Haskell List implemented recursively and costs O(n) time?", "body": "<p>See the <em>copy(fork)</em> part is the problem - the recursive solution does exactly this (and you really have to do it, because you have to adjust all the pointers for the elements in the <code>a</code> list.</p>\n\n<p>Let's say <code>a = [a1,a2,a3]</code> and <code>b</code> is some list.</p>\n\n<p>You have to make a new copy of <code>a3</code> (let's call it <code>a3'</code>) because it should now no longer point to an empty list but to the start of <code>b</code>.</p>\n\n<p>Then you have to make a copy of the second to last element <code>a2</code> too because it must point to <code>a3'</code> and finally - for the same reason - you have to create a new copy of <code>a1</code> too (pointing to <code>a2'</code>).</p>\n\n<p>This is exactly what the recursive definition does - it's no problem with the algorithm - it's a problem with the data-structure (it's just not good with concatenation).</p>\n\n<p>If you don't allow mutability and want the structure of a list you can really do nothing else.</p>\n\n<p>You have this in other langs. too if they provide immutable data - for example in .net strings are immutable - so there is almost the same problem with string-concatenation as is here (if you concat lots of strings your program will perform poorly). There are workaround (<code>StringBuilder</code>) that will deal better with the memory footprint - but of course those are no longer immutable data-structures.</p>\n"}, {"tags": [], "owner": {"reputation": 2768, "user_id": 4271479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/288848609fdf4ebb07ce8104e2a45559?s=128&d=identicon&r=PG&f=1", "display_name": "mastov", "link": "https://stackoverflow.com/users/4271479/mastov"}, "is_accepted": false, "score": 1, "last_activity_date": 1433889696, "last_edit_date": 1433889696, "creation_date": 1433875125, "answer_id": 30740181, "question_id": 30692645, "link": "https://stackoverflow.com/questions/30692645/why-is-for-haskell-list-implemented-recursively-and-costs-on-time/30740181#30740181", "title": "Why is `++` for Haskell List implemented recursively and costs O(n) time?", "body": "<p>There is no way to do that concatenation in constant time, simply because the immutability of the data structure doesn't allow it.</p>\n\n<hr>\n\n<p>You might think that you could do something similar to the \"cons\" operator (<code>:</code>) that adds an additional element <code>x0</code> to the <strong>front</strong> of a list <code>oldList=[x1,x2,x3]</code> (resulting in <code>newList=(x0:oldLIst)</code>) without having to run through the whole list. But that's just because you don't touch the existing list <code>oldList</code>, but simply reference it.</p>\n\n<pre><code>x0  :  ( x1  :  ( x2  :  ( x3  :  [] )   )   )\n^        ^\nnewList  oldList\n</code></pre>\n\n<p>But in your case (<code>a ++ b</code>) we are talking about updating a reference deep within the data structure. You want to replace the <code>[]</code> in <code>1:(2:(3:[]))</code> (the explicit form of <code>[1,2,3]</code>) by the new tail <code>b</code>. Just count the parenthesis and you'll see that we have to go deep inside to get to the <code>[]</code>. That's always expensive because we have to duplicate the whole outer part, in order to make sure that <code>a</code> stays unmodified. In the resulting list, where would the old <code>a</code> point to in order to have the unmodified list?</p>\n\n<pre><code>1  :  ( 2  :  ( 3  :  b  )   )\n^                     ^\na++b                  b\n</code></pre>\n\n<p>That's impossible in the same data structure. So we need a second one:</p>\n\n<pre><code>1  :  ( 2  :  ( 3  :  []  )   )\n^\na\n</code></pre>\n\n<p>And that means duplicating those <code>:</code> nodes, which necessarily costs the mentioned linear time in the first list. The \"copy(fork)\" that you mentioned is therefore, differently from what you said, <em>not</em> in O(1).</p>\n\n<hr>\n\n<blockquote>\n  <p>make a copy(fork) of a, let's call it a', there may be some tricks to do this in O(1) time </p>\n</blockquote>\n\n<p>When you talk about a \"trick\" to fork something in constant time, you probably think about not actually making a full copy, but creating a reference to the original <code>a</code>, with the changes stored as \"annotations\" (like the hint: \"modification to tail: use <code>b</code> instead of <code>[]</code>\").</p>\n\n<p>But that's what Haskell, thanks to its lazyness, does anyway! It doesn't immediately execute the O(n) algorithm, but just \"remembers\" that you wanted a concatenated list, until you actually access its elements. But that doesn't save you from paying the cost in the end. Because even though in the beginning the reference was cheap (in O(1), just like you wanted), when you do access the actual list elements, every instance of the <code>++</code> operator adds a little overhead (the cost of \"interpreting the annotation\" that you added to your reference) to the access of every element in the first part of the concatenation, effectively adding the O(n) cost finally.</p>\n"}], "owner": {"reputation": 38877, "user_id": 1272683, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6ea2bbebf39d8f4d9ba654471289d576?s=128&d=identicon&r=PG", "display_name": "Hanfei Sun", "link": "https://stackoverflow.com/users/1272683/hanfei-sun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 30692744, "answer_count": 3, "score": 7, "last_activity_date": 1433889696, "creation_date": 1433674231, "last_edit_date": 1433674649, "question_id": 30692645, "link": "https://stackoverflow.com/questions/30692645/why-is-for-haskell-list-implemented-recursively-and-costs-on-time", "title": "Why is `++` for Haskell List implemented recursively and costs O(n) time?", "body": "<p>As I understood, a List in Haskell is a similar to a Linked-List in C language.</p>\n\n<p>So for expressions below:</p>\n\n<pre><code>a = [1,2,3]\nb = [4,5,6]\na ++ b\n</code></pre>\n\n<p>Haskell implement this in a recursive way like this:</p>\n\n<pre><code>(++) (x:xs) ys = x:xs ++ ys\n</code></pre>\n\n<p>The time complexity for that is <code>O(n)</code>..</p>\n\n<p>However, I was wondering why can't I implement <code>++</code> more efficiently.</p>\n\n<p>The most efficient way may be like this:</p>\n\n<ol>\n<li><p>make a copy(fork) of <code>a</code>, let's call it <code>a'</code>, there may be some tricks to do this in <code>O(1)</code> time </p></li>\n<li><p>make the last element of <code>a'</code> to point to the first element of <code>b</code>. This can be done easily in <code>O(1)</code> time..</p></li>\n</ol>\n\n<p>Does anyone have ideas about this? Thanks!</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1433715619, "post_id": 30691816, "comment_id": 49456303, "body": "Do you mean associative?"}, {"owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1433752653, "post_id": 30691816, "comment_id": 49466727, "body": "@Alec commutativity would suffice for my needs (e.g. non-deterministic execution and combination order of parallel sparks)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1433788009, "post_id": 30691816, "comment_id": 49490322, "body": "Ummm... Are you sure? If your function is not associative, you will need to tell us the order in which operations occur (where to place the brackets) and that will almost certainly constrain considerably any parallel fold."}, {"owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1433854295, "post_id": 30691816, "comment_id": 49521233, "body": "@Alec yes, you are right. It is better to require an associative function."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1433854700, "post_id": 30691816, "comment_id": 49521580, "body": "I think your question might be tightly related to this one: <a href=\"https://stackoverflow.com/questions/19117922/parallel-folding-in-haskell\" title=\"parallel folding in haskell\">stackoverflow.com/questions/19117922/&hellip;</a> (or better to it&#39;s great answer)"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433857517, "post_id": 30691816, "comment_id": 49523933, "body": "@Carsten is (very) different when your hard computation is each element (as in your reference) or whole list; if the former, muffel has no problem (how to know chunk size) if the later, muffel want to know the split size (but your referred solution not solve)."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 1, "creation_date": 1433857618, "post_id": 30691816, "comment_id": 49524032, "body": "@muffel I think you must to use repa (<a href=\"https://hackage.haskell.org/package/repa\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/repa</a>) or other for intensive parallel computations and Carsten reference for individual hard computations."}, {"owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1433872805, "post_id": 30691816, "comment_id": 49534831, "body": "@josejuan sounds great, I&#39;ll definitely try it, thank you"}], "owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 1, "closed_date": 1458366689, "answer_count": 0, "score": 4, "last_activity_date": 1433854305, "creation_date": 1433668156, "last_edit_date": 1433854305, "question_id": 30691816, "link": "https://stackoverflow.com/questions/30691816/how-to-parallelize-a-fold-with-parallel-evaluation-strategies-in-haskell", "closed_reason": "Duplicate", "title": "How to parallelize a fold with Parallel Evaluation Strategies in Haskell", "body": "<p>Is it possible to create a parallel fold with Parallel Evaluation Strategies (<code>Control.Parallel.Strategies</code>) in Haskell, when the fold function is associative (e.g. addition)?</p>\n\n<p>My idea was to split the list into chunks, but how should the (optimal) chunk size be calculated? Is there a generic way?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1433667563, "post_id": 30691346, "comment_id": 49442282, "body": "If you don&#39;t use the fact it&#39;s a <code>Sum</code> why  do you need to know it ? You probably just do  <code>disp (Sum (Name a) b</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3346, "user_id": 565840, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/f286d944df48ecb41d925b3d6bc29b84?s=128&d=identicon&r=PG", "display_name": "fouronnes", "link": "https://stackoverflow.com/users/565840/fouronnes"}, "edited": false, "score": 0, "creation_date": 1433664958, "post_id": 30691356, "comment_id": 49441723, "body": "Cool, thanks. I&#39;m learning Haskell and just curious: does something like <code>disp (Sum (Name a) s::Sum) = ...</code> exist? Then I wouldn&#39;t even have to use <code>_</code> or know the number of args to the Sum constructor."}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "reply_to_user": {"reputation": 3346, "user_id": 565840, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/f286d944df48ecb41d925b3d6bc29b84?s=128&d=identicon&r=PG", "display_name": "fouronnes", "link": "https://stackoverflow.com/users/565840/fouronnes"}, "edited": false, "score": 0, "creation_date": 1433665868, "post_id": 30691356, "comment_id": 49441940, "body": "if you add a function <code>isSum :: Expr -&gt; Bool</code>, you can do <code>disp (Sum (Name a) s) | isSum s = a ++ &quot;:&quot; ++ disp s</code>"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 9, "creation_date": 1433667205, "post_id": 30691356, "comment_id": 49442224, "body": "You can use <code>s@Sum{}</code> if you want to match without knowing the number of constructor arguments."}], "tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": true, "score": 14, "last_activity_date": 1433664248, "creation_date": 1433664248, "answer_id": 30691356, "question_id": 30691346, "link": "https://stackoverflow.com/questions/30691346/pattern-matching-on-variant-without-deconstructing-in-haskell/30691356#30691356", "title": "Pattern matching on variant without deconstructing in Haskell", "body": "<p><code>disp (Sum (Name a) s@(Sum _ _)) = a ++ \":\" ++ disp s</code></p>\n\n<p><code>@</code> allows multiple matches for the same thing</p>\n"}], "owner": {"reputation": 3346, "user_id": 565840, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/f286d944df48ecb41d925b3d6bc29b84?s=128&d=identicon&r=PG", "display_name": "fouronnes", "link": "https://stackoverflow.com/users/565840/fouronnes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 30691356, "answer_count": 1, "score": 2, "last_activity_date": 1433664248, "creation_date": 1433664131, "question_id": 30691346, "link": "https://stackoverflow.com/questions/30691346/pattern-matching-on-variant-without-deconstructing-in-haskell", "title": "Pattern matching on variant without deconstructing in Haskell", "body": "<p>In the following code, the function <code>disp</code> is defined by de-constructing <code>Sum b c</code> and then immediately reconstructing it. The problem is that I don't need <code>b</code> and <code>c</code>, only the fact that it is of type <code>Sum</code>.</p>\n\n<pre><code>data Expr = Name String | Sum Expr Expr\n    deriving(Show)\n\ndisp (Sum (Name a) (Sum b c)) = a ++ \":\" ++ disp (Sum b c)\n</code></pre>\n\n<p>Is there a way of writing <code>disp</code> without this deconstruction - reconstruction (and the <code>b</code> and <code>c</code> bindings), or is this the correct way of writing such a function?</p>\n"}, {"tags": ["c", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "is_accepted": true, "score": 0, "last_activity_date": 1433665270, "creation_date": 1433665270, "answer_id": 30691482, "question_id": 30690576, "link": "https://stackoverflow.com/questions/30690576/importing-inline-c-modules-in-ghci/30691482#30691482", "title": "importing inline-c modules in ghci", "body": "<p>A minimal change to the <code>ghci</code> invocation did the job:  </p>\n\n<pre><code>ghci src/Main.hs src/Test1_c.o -isrc/ \n</code></pre>\n\n<p>which means that we add an include path with the <code>-i</code> flag to fix the <code>Could not find module</code> error, and explicitly link the object file generated from the <code>inline-c</code> snippets.</p>\n"}], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 30691482, "answer_count": 1, "score": 1, "last_activity_date": 1433672037, "creation_date": 1433657241, "last_edit_date": 1433672037, "question_id": 30690576, "link": "https://stackoverflow.com/questions/30690576/importing-inline-c-modules-in-ghci", "title": "importing inline-c modules in ghci", "body": "<p>I would like to import some <code>inline-c</code> generated functions in a ghci session. All source and object files are in a <code>src/</code> subfolder but I get import error: </p>\n\n<pre><code>src/Main.hs:3:8:\n    Could not find module \u2018Test1\u2019\n</code></pre>\n\n<p>I include all files for reference. Thanks in advance</p>\n\n<p>Main.hs</p>\n\n<pre><code>module Main where\n\nimport Test1\n\nmain = \n  test1\n</code></pre>\n\n<p>and the functionality to be imported</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\nmodule Test1 where\n\nimport qualified Language.C.Inline as C\nimport Foreign.C.Types\n\nC.include \"&lt;stdio.h&gt;\"\nC.include \"&lt;math.h&gt;\"\n\ntest1 = do\n  s &lt;- readAndSum n\n  [C.exp| void{ printf( \"Sum: %.2d\\n\", $(int s)) } |]\n  putStrLn $ \"Sum: \" ++ show s\n\nreadAndSum n = \n  [C.block| int {\n      int i, sum = 0, tmp;\n      for (i = 0; i &lt; $(int n); i++) {\n        scanf(\"%d \", &amp;tmp);\n        sum += tmp;\n      }\n      return sum;\n    } |]\n</code></pre>\n\n<p>makefile:</p>\n\n<pre><code>main:\n    ghc -c src/Test1.hs \n    cc -c src/Test1.c -o src/Test1_c.o\n    ghci src/Main.hs src/Test1_c.o -isrc/ \n    # ghci src/Main.hs -Lsrc/ \n</code></pre>\n\n<hr>\n\n<p>UPDATE: I've fixed the makefile, the above now compiles. However the next big question is how to isolate effects within each call, i.e. resetting the values in a consistent manner.</p>\n"}, {"tags": ["haskell", "reactive-programming", "audio-processing", "euterpea"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1433654623, "post_id": 30689943, "comment_id": 49439677, "body": "See page 362 in this PDF <a href=\"http://haskell.cs.yale.edu/wp-content/uploads/2015/03/HSoM.pdf\" rel=\"nofollow noreferrer\">haskell.cs.yale.edu/wp-content/uploads/2015/03/HSoM.pdf</a>"}, {"owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1433681832, "post_id": 30689943, "comment_id": 49445983, "body": "Omg, thanks a lot @Arnon. I&#39;ve been already reading Hudak&#39;s book but haven&#39;t reached that peage yet :) thanks again"}], "owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 138, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1548889095, "creation_date": 1433649960, "last_edit_date": 1548889095, "question_id": 30689943, "link": "https://stackoverflow.com/questions/30689943/modulating-audio-signal-with-euterpea", "title": "Modulating audio signal with Euterpea", "body": "<p>I seem to have a problem with choosing library for my project.\nI have to write an application in Haskell to modulate, filter etc. audio.\nLet's say I want to read an audio file and apply low-pass filter to it.</p>\n\n<p>Is it possible to write the low-pass filter with Euterpea? \nThe project should be done using reactive programming but I know that Euterpea uses Arrows and FRP.</p>\n\n<p>I would really appreciate some information :)</p>\n"}, {"tags": ["debugging", "haskell", "profiling"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1433648869, "post_id": 30689137, "comment_id": 49438883, "body": "If you run your program with <code>+RTS -xc</code>, GHC will print a stack trace if your program encounters an error. You just have to wait for some memory error to occur, although I believe some versions of GHC will consume memory almost indefinitely."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1433650692, "post_id": 30689137, "comment_id": 49439142, "body": "<code>+RTS -h</code> gives you a heap profile.  Don&#39;t be surprised stack use doesn&#39;t show up on it..."}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1433651268, "post_id": 30689137, "comment_id": 49439221, "body": "@Carl: I realised that as I was writing the question earlier but I figured to ask anyway since I didn&#39;t know how to debug stack overflow."}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1433651373, "post_id": 30689137, "comment_id": 49439239, "body": "@user2407038: that flag was very helpful, thanks!  However, I found that it needs to be combined with <code>-auto-all</code> to produce useful results.  Feel free to add that as an answer."}, {"owner": {"reputation": 38606, "user_id": 23771, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NeuGc.jpg?s=128&g=1", "display_name": "Mike Dunlavey", "link": "https://stackoverflow.com/users/23771/mike-dunlavey"}, "edited": false, "score": 0, "creation_date": 1433658951, "post_id": 30689137, "comment_id": 49440470, "body": "The way you find an infinite loop (interrupt it and examine the stack) is also useful for finding non-infinite loops (plain old slowness). Just interrupt it more times. If you see something you could remove on two or more interrupts, removing it will give you a healthy speedup."}], "owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 325, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1433640004, "creation_date": 1433640004, "question_id": 30689137, "link": "https://stackoverflow.com/questions/30689137/how-does-one-debug-infinite-recursion-in-haskell", "title": "How does one debug infinite recursion in Haskell?", "body": "<p>How would one debug this (obviously) flawed program using GHC's profiling tools?  The program enters an infinite recursion within the second clause of <code>frobnicate</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Foo.hs\nfrobnicate :: Show a =&gt; Maybe a -&gt; String\nfrobnicate Nothing = \"\"\nfrobnicate x       = case frobnicate x of\n  \"\" -&gt; \"X\"\n  _  -&gt; show x\n\nmain :: IO ()\nmain = print (frobnicate (Just \"\" :: Maybe String))\n</code></pre>\n\n<p>The example might look contrived, but it's actually stripped down version of a real bug I encountered today.</p>\n\n<p>In an imperative language one the mistake would be obvious as the stack trace would say something like <code>frobnicate -&gt; frobnicate -&gt; frobnicate -&gt; ...</code>.  But how would one discover this in Haskell?  <em>How would one narrow down the blame to this one particular function?</em></p>\n\n<p>I tried something akin to the following:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ghc -fforce-recomp -rtsopts -prof -fprof-auto Foo.hs\n./Foo +RTS -M250M -i0.001 -h\nhp2ps -c Foo.hp\n</code></pre>\n\n<p>where the <code>-M250M</code> flag is added to ensure it doesn't kill the machine, <code>-i0.001</code> increases the profiling frequency in an attempt to catch the overflow in action (which happens very fast).</p>\n\n<p>This produces this rather unhelpful plot:</p>\n\n<p><img src=\"https://i.stack.imgur.com/99Y6M.png\" alt=\"enter image description here\"></p>\n\n<p>There is no obvious overflow in this plot.  The y-axis doesn't go past even a single megabyte!  What am I doing wrong here?</p>\n"}, {"tags": ["haskell", "ghc", "zlib", "cabal"], "comments": [{"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 5, "creation_date": 1433640658, "post_id": 30688778, "comment_id": 49437620, "body": "Remove all your packages with <code>rm -rf ~&#47;.ghc ~&#47;.cabal</code>. Don&#39;t globally install packages that have no reason to be installed globally. Use <a href=\"http://coldwa.st/e/blog/2013-08-20-Cabal-sandbox.html\" rel=\"nofollow noreferrer\">sandboxes</a>. Use <a href=\"https://www.reddit.com/r/haskell/comments/2ywbwy/how_do_i_tell_ghc_that_i_have_a_cabal_sandbox/\" rel=\"nofollow noreferrer\"><code>cabal exec</code> or <code>cabal repl</code></a> to run your programs more interactively inside the sandboxed environment. And, last but not least, use <a href=\"http://www.stackage.org/\" rel=\"nofollow noreferrer\">Stackage</a>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433646332, "post_id": 30688778, "comment_id": 49438494, "body": "Or just unregister <code>regex-posix-0.95.1</code> and <code>regex-compat-0.95.1</code> and anything that depends on them and if you want to keep them, try reinstalling them at the same time as whatever other package you are trying to install."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1433899471, "post_id": 30688778, "comment_id": 49546468, "body": "I would recommend using a cabal sandbox, one per project, if you happen to have a recent cabal."}, {"owner": {"reputation": 1531, "user_id": 4645236, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QVYcq.jpg?s=128&g=1", "display_name": "hellyale", "link": "https://stackoverflow.com/users/4645236/hellyale"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1433901193, "post_id": 30688778, "comment_id": 49546875, "body": "@9000 I have a sandbox in the project. Anything special that needs to be done to utilize it? I thought <code>cabal build</code> would be enough."}, {"owner": {"reputation": 1531, "user_id": 4645236, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QVYcq.jpg?s=128&g=1", "display_name": "hellyale", "link": "https://stackoverflow.com/users/4645236/hellyale"}, "reply_to_user": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1433910389, "post_id": 30688778, "comment_id": 49549018, "body": "@MarcusVin&#237;ciusMonteiro the <code>rm -rf ~&#47;.ghc ~&#47;.cabal</code> was ran and I tried to use Stackage, I came across the same errors with a Stackage install.   Not at the point where I can run anything yet, as I am still trying to build here."}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1433934135, "post_id": 30688778, "comment_id": 49562287, "body": "The same errors? Why don&#39;t you put all the packages you want to install in your question, so we can replicate it?"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1433944921, "post_id": 30688778, "comment_id": 49570315, "body": "@hellyale: Good to know. I just thought that interference between different projects might be the culprit."}, {"owner": {"reputation": 1531, "user_id": 4645236, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QVYcq.jpg?s=128&g=1", "display_name": "hellyale", "link": "https://stackoverflow.com/users/4645236/hellyale"}, "reply_to_user": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1433959864, "post_id": 30688778, "comment_id": 49580644, "body": "@MarcusVin&#237;ciusMonteiro The packages that are left are in the question. The current roadblock is adding the libghc-zlib-dev. I am not sure, but that likely might be the final roadblock."}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1433960515, "post_id": 30688778, "comment_id": 49581052, "body": "Not only the packages left, but the entire process that lead to it. All the cabal installs since the beginning. I want to see if this error repeats itself if I try to install all the packages you want to install using Stackage inside a sandbox."}, {"owner": {"reputation": 1531, "user_id": 4645236, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QVYcq.jpg?s=128&g=1", "display_name": "hellyale", "link": "https://stackoverflow.com/users/4645236/hellyale"}, "reply_to_user": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1433978479, "post_id": 30688778, "comment_id": 49589956, "body": "@MarcusVin&#237;ciusMonteiro I wasn&#39;t keeping track of the process until I encountered the issue."}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1433988428, "post_id": 30688778, "comment_id": 49592434, "body": "Then I think that the best thing you can do is follow my first comment. It&#39;s good to not clutter your global environment, not only with cabal packages but with any programs. <a href=\"https://www.docker.com/\" rel=\"nofollow noreferrer\">Docker</a> and <a href=\"https://www.vagrantup.com/\" rel=\"nofollow noreferrer\">Vagrant</a> are some good tools for that."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1433996875, "post_id": 30688778, "comment_id": 49594425, "body": "for the <code>zlib.h</code> headers: those should be in <code>zlib1g-dev</code> - you should usually be able to install those with <code>sudo apt-get install zlib1g-dev</code> - I have no ubuntu 12.04 at hand but you should be able to find the right one (if this isn&#39;t) - start <code>synaptic</code> and search for packages with the name <code>zlib</code> (<code>sudo aptitude zlib</code> from the bash/terminal should also do) - then look for one with <code>-dev</code> that&#39;s usually where the headers are ;) - after this you can continue your <code>cabal</code> adventures ;)"}], "answers": [{"comments": [{"owner": {"reputation": 1531, "user_id": 4645236, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QVYcq.jpg?s=128&g=1", "display_name": "hellyale", "link": "https://stackoverflow.com/users/4645236/hellyale"}, "edited": false, "score": 0, "creation_date": 1459744406, "post_id": 35967144, "comment_id": 60405779, "body": "Luckily the machine now has 14.04"}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1457849471, "creation_date": 1457849471, "answer_id": 35967144, "question_id": 30688778, "link": "https://stackoverflow.com/questions/30688778/braving-cabal-hell-on-ubuntu-12-04/35967144#35967144", "title": "Braving cabal hell on Ubuntu 12.04", "body": "<p>It looks like you're trying to build just a single package, and the issue is that it has many dependencies.</p>\n\n<p>The best way to install all the dependencies (since a \"build\" unlike an \"install\" won't find a solution to installing them all for you) is just to (preferably in a sandbox) run <code>cabal install --dependencies-only</code>. This will also solve them all simultaneously, rather than one-by-one where incompatible local choices may be made...</p>\n"}], "owner": {"reputation": 1531, "user_id": 4645236, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QVYcq.jpg?s=128&g=1", "display_name": "hellyale", "link": "https://stackoverflow.com/users/4645236/hellyale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1229, "favorite_count": 1, "accepted_answer_id": 35967144, "answer_count": 1, "score": 4, "last_activity_date": 1457849471, "creation_date": 1433635825, "last_edit_date": 1495541213, "question_id": 30688778, "link": "https://stackoverflow.com/questions/30688778/braving-cabal-hell-on-ubuntu-12-04", "title": "Braving cabal hell on Ubuntu 12.04", "body": "<p>Attempting to travel through the entirety of Cabal dependency hell in 12.04 precise build of Ubuntu, and I have been making slow progress.</p>\n\n<p>My first bash command \n<code>cabal install --allow-newer</code> yields the following message at the bottom of a long list of new packages:</p>\n\n<blockquote>\n<pre><code>cabal: The following packages are likely to be broken by the\nreinstalls:\n    regex-posix-0.95.1 \n    regex-compat-0.95.1 \nUse `--force-reinstalls` if you want to install anyway.\n</code></pre>\n</blockquote>\n\n<p>(NOTE: A force reinstall was never ran.)</p>\n\n<p>How can I fix these packages and finish the process of installing cabal?\nI must stay in 12.04 and cabal has been updated.</p>\n\n<p><code>cabal install ad --reorder-goals</code> ended up getting it to install.</p>\n\n<p>However I am still not out of cabal hell, as I now have to deal with:</p>\n\n<blockquote>\n  <p>cabal: At least the following dependencies are missing: aeson -any, json-schema -any, monad-logger -any, mtl -any, persistent -any, persistent-postgresql ==2.1.6, persistent-template -any, rest-core -any, rest-snap -any, snap-core -any, snap-server -any, text -any\"</p>\n</blockquote>\n\n<p>when I attempt to execute <code>cabal build</code></p>\n\n<p>UPDATE: The dependencies needed list has shrunk to:\nmonad-logger, persistent, (Fine name for a cabal installer.)\npersistant-postgresql == 2.1.6\n'persistent-template\nrest-snap\nsnap-core\nsnap-server</p>\n\n<p>So aside from persistant-postgresql any version will work. </p>\n\n<p>Update 2 : Good news though, Running <code>sudo apt-get install libghc-zlib-dev</code> \nUncovers an interesting roadblock. </p>\n\n<p>While trying as suggested in one of the answers in this question : <a href=\"https://stackoverflow.com/questions/8961413/zlib-build-error-with-ghc/9030944#9030944/%20Question\">Question</a></p>\n\n<p>to install libghc-zlib-bindings-dev, which installed fine, and libghc-zlib-dev.</p>\n\n<p>The zlib is the dependency that is in the way right now. Once that installs progress will continue. </p>\n\n<p>Current warning on the <code>libghc-zlib-dev</code> install attempt : </p>\n\n<blockquote>\n  <p>warning: Please check that your locale settings:\n  LANGUAGE = (unset),\n  LC_ALL = (unset),\n  LANG = \"en_US.UTF-8\n  are supported and installed on your system.</p>\n</blockquote>\n\n<p>also </p>\n\n<blockquote>\n  <p>perl: warning : Falling back to the standard locale (\"C\"). </p>\n</blockquote>\n\n<p>displayed. </p>\n\n<p>Perhaps this can help us dig deeper into the investigation. </p>\n\n<p>Trudge out of cabal hell we must. </p>\n\n<p>Pretty sure this is the place to plant the red flag : </p>\n\n<blockquote>\n  <p>#include \"zlib.h\"</p>\n  \n  <p>^</p>\n  \n  <p>compilation terminated.\n  setup-Simple-Cabal-1.22.2.0-x86_64-linux-ghc-7.10.1: Missing dependency on > a\n  foreign library:\n  * Missing (or bad) header file: zlib.h\n  * Missing C library: z</p>\n</blockquote>\n\n<p>Man I wish this site would have auto Ctrl - C Ctrl -V formating, how awesome would that be? </p>\n"}, {"tags": ["haskell", "linker", "ghc"], "comments": [{"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1434402341, "post_id": 30687926, "comment_id": 49753321, "body": "Later, I mentioned this problem to someone and they were surprised that you actually got this error. So I tried to reproduce your error and couldn&#39;t; i.e. my linker seems to be happy to link HSunix-2.7.1.0 and HSunix-2.6.0.1 together. Could this be a linker thing?I&#39;m using ld (BNU Binutils for Ubuntu) 2.25. What ld do you have?"}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1434402961, "post_id": 30687926, "comment_id": 49753612, "body": "OK, sorry, it just be takes a little more work to reproduce this problem: you can&#39;t tug on the same symbol in the second case: you have to try to use a different symbol in the same object file to cause the conflict."}], "answers": [{"tags": [], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "is_accepted": true, "score": 12, "last_activity_date": 1433631975, "last_edit_date": 1433631975, "creation_date": 1433629198, "answer_id": 30688119, "question_id": 30687926, "link": "https://stackoverflow.com/questions/30687926/should-ghc-be-linking-different-versions-of-the-same-libraries/30688119#30688119", "title": "Should GHC be linking different versions of the same libraries?", "body": "<p>So, you haven't given me enough information in this bug per se, but I am going to attempt to use my psychic debugging powers to answer your question. </p>\n\n<p>You attempting to compile a GHC program which relies on packages <code>p</code> and <code>q</code>. You probably specified them using <code>-package p</code> and <code>-package q</code>. Your package database probably looks something like this (or transitively looks like this):</p>\n\n<pre><code>id: p-0.1-8aa5d403c45ea59dcd2c39f123e27d57\ndepends: unix-2.6.0.1-9ce33138f4fcfb9c37f6e6c300bcc367\n\nid: q-0.1-d5221a8c8a269b66ab9a07bdc23317dd\ndepends: unix-2.7.1.0-2f15426f5b53fe4c6490832f9b20d8d7\n\nid: unix-2.6.0.1-9ce33138f4fcfb9c37f6e6c300bcc367\ndepends: (none)\n\nid: unix-2.7.1.0-2f15426f5b53fe4c6490832f9b20d8d7\ndepends: (none)\n</code></pre>\n\n<p>When GHC looks for package <code>p</code>, it sees <code>p-0.1-8aa5d403c45ea59dcd2c39f123e27d57</code> and decides to use it. Then, when it looks for package <code>q</code>, it sees <code>q-0.1-d5221a8c8a269b66ab9a07bdc23317dd</code> and decides to use it. It then does a consistency check, to make sure that for any <em>package id</em> <code>foo-0.1</code>, it didn't pick two installed package IDs. In my example, this is trivially true, since the two versions of <code>unix</code> which were picked had DIFFERENT package IDs (<code>unix-2.6.0.1</code> and <code>unix-2.7.1.0</code>), and my psychic debugging powers say that in your extended package database, this is also true. (By the way, if you're running GHC 7.10, then the shadowing check ensures for any <em>package key</em> it didn't pick two different installed package IDs. So this is almost certainly guaranteed to be true.)</p>\n\n<p>So GHC accepts the kaboodle, and we try to link in two different version of <code>unix</code>. Oops!</p>\n\n<p>So, what should you do? Here are your options.</p>\n\n<ol>\n<li><p>Use Cabal. Cabal will enforce a stronger constraint, namely for every PACKAGE NAME there is only one PACKAGE VERSION. So when you try to <code>cabal configure</code> it will tell you it couldn't resolve the dependencies, or maybe pick an earlier version of <code>q</code> which was installed against <code>unix-2.6.0.1</code> instead of <code>unix-2.7.1.0</code></p></li>\n<li><p>Look and see if you have a version of <code>q</code> which is installed against the older <code>unix</code>, and explicitly request it. By default, if there are multiple possible choices for a package, GHC will pick the latest version. You can tell it to use an earlier version.</p></li>\n<li><p>Reinstall a NEWER version of <code>p</code> compiled against <code>unix-2.7.1.0</code>. Then GHC will pick it up and there's no incompatibility. Note that it has to be a newer version since today's Cabal won't let you have a copy of <code>p-0.1</code> compiled against <code>unix-2.6.0.1</code> AS WELL as a copy of <code>p-0.1</code> compiled against <code>unix-2.7.1.0</code>. Silly right? We're trying to fix it.</p></li>\n<li><p>Blow away your <code>.cabal</code> and <code>.ghc</code> directories, and then <code>cabal install</code> the newest version of <code>unix</code>, and then everything else. Then everything will (probably) be compiled against the new version of <code>unix</code> and there won't be a problem.</p></li>\n</ol>\n\n<p>Here are three more, not so useful solutions:</p>\n\n<ol start=\"5\">\n<li><p>Note that you are really only getting this link error because <code>unix</code> has C sources which get assigned the same name even under different versions of the package (this is not the case for Haskell identifiers, they are properly version prefixed). If <code>unix</code> were fixed so that all its C symbols were version prefixed, you would not have seen this problem and your program would have compiled fine. Well, unless you tried to use types from the two different versions of <code>unix</code> together (then you'd be told that <code>unix-2.6.0.1:BlahBlah</code> is not the same as <code>unix-2.7.1.0:BlahBlah</code>. If you're lucky.) There's no convention for how to do this right now but there is a GHC ticket about it: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9351\">https://ghc.haskell.org/trac/ghc/ticket/9351</a></p></li>\n<li><p>Recently, some people have proposed that GHC should enforce a stronger consistency constraint when implementing shadowing, namely the same constraint that Cabal enforces. In that world, GHC would not have been able to find one of <code>p</code> or <code>q</code>, and would have reported that not all packages were satisfiable. Would that have been better? The plan for how to do this is to have <code>Cabal</code> manage a consistent \"view\" of the package database, so that when you use <code>ghc</code> by itself you'll never see packages that shouldn't actually be visible. That's this GSoC project: <a href=\"https://www.google-melange.com/gsoc/project/details/google/gsoc2015/vishal4556/5634387206995968\">https://www.google-melange.com/gsoc/project/details/google/gsoc2015/vishal4556/5634387206995968</a></p></li>\n<li><p>Perhaps you might say, \"Forget about all this fancy view business, really, GHC should just do a better consistency check on the packages you try to make it use to make sure that it's consistent with respect to a name to version mapping.\" (By the way, a simplified check would be the one that Setup executables currently do). Last summer I tried to convince Duncan that GHC should do this, but he was soundly of the opinion that this was Cabal's job, and we shouldn't duplicate this code in GHC. So to this day there is no ticket on the GHC bugtracker suggesting we should do this.</p></li>\n</ol>\n"}], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 30688119, "answer_count": 1, "score": 4, "last_activity_date": 1433631975, "creation_date": 1433627506, "question_id": 30687926, "link": "https://stackoverflow.com/questions/30687926/should-ghc-be-linking-different-versions-of-the-same-libraries", "title": "Should GHC be linking different versions of the same libraries?", "body": "<p>I'm trying to compile a program with GHC 7.6.3 and I get the error</p>\n\n<pre><code>/usr/lib/ghc/unix-2.6.0.1/libHSunix-2.6.0.1.a(execvpe.o): In function `pPrPr_disableITimers':\n(.text+0x300): multiple definition of `pPrPr_disableITimers'\n/home/tom/.cabal/lib/i386-linux-ghc-7.6.3/unix-2.7.1.0/libHSunix-2.7.1.0.a(ghcrts.o):ghcrts.c:(.text+0x0): first defined here\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>(The problem ultimately derives from a usage of <code>readProcessWithExitCode</code> but I don't think that's especially relevant)</p>\n\n<p>If I run <code>ghc</code> with <code>-v</code> then I see amongst the command line parameters</p>\n\n<ul>\n<li><code>'-L/home/tom/.cabal/lib/i386-linux-ghc-7.6.3/unix-2.7.1.0'</code></li>\n<li><code>'-L/usr/lib/ghc/unix-2.6.0.1'</code></li>\n<li><code>'-lHSunix-2.7.1.0'</code></li>\n<li><code>'-lHSunix-2.6.0.1'</code></li>\n</ul>\n\n<p>Is this a bug?  Should GHC really be trying to link two different versions of <code>unix</code>?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1433638362, "post_id": 30687837, "comment_id": 49437238, "body": "What do you mean by extensible typeclass? Typeclasses define a <a href=\"http://book.realworldhaskell.org/read/using-typeclasses.html\" rel=\"nofollow noreferrer\">set of functions that can have different implementations depending on the type of data they&#39;re given</a>. For example <code>class Eq a where (==), (&#47;=) :: a -&gt; a -&gt; Bool</code> means that instance types of <code>Eq</code> will have to implement <code>(==)</code> and <code>(&#47;=)</code>. It&#39;s for ensuring that they will have these operations. I didn&#39;t get what you mean by it."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1433629330, "post_id": 30687894, "comment_id": 49435711, "body": "This is an <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">antipattern</a> -- there&#39;s no practical difference between a <code>[Showable]</code> and a <code>[String]</code>, and the latter is much simpler."}, {"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433629859, "post_id": 30687894, "comment_id": 49435831, "body": "You&#39;re right, but what if the typeclass provides more than one method?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433629978, "post_id": 30687894, "comment_id": 49435860, "body": "Actually, my opinion is not as radical as the one expressed by Luke Palmer in his blog, but I do think he has a point. The existential-typeclass pattern can be useful in some cases, but it can be easily abused."}, {"owner": {"reputation": 2895, "user_id": 1385269, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a7d953ada68569a034a0a4e7030bc4a2?s=128&d=identicon&r=PG", "display_name": "Ryan Kennedy", "link": "https://stackoverflow.com/users/1385269/ryan-kennedy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433649377, "post_id": 30687894, "comment_id": 49438953, "body": "There will be more than one method on <code>Foo</code>. Thank you @utdemir for the answer, and @chi for the link to Luke Palmer&#39;s article, as I may rewrite my code once I wrap my head around the concepts."}], "tags": [], "owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "is_accepted": true, "score": 2, "last_activity_date": 1433627195, "creation_date": 1433627195, "answer_id": 30687894, "question_id": 30687837, "link": "https://stackoverflow.com/questions/30687837/representing-arbitrary-implementations-of-a-typeclass-in-haskell/30687894#30687894", "title": "Representing arbitrary implementations of a typeclass in Haskell", "body": "<p>What you're looking is <a href=\"https://wiki.haskell.org/Heterogenous_collections\" rel=\"nofollow\">Heterogenous collections</a></p>\n\n<p>IMHO the best way is to use existentials, as described on wiki:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata Showable = forall a . Show a =&gt; MkShowable a\n\npack :: Show a =&gt; a -&gt; Showable\npack = MkShowable\n\nhlist :: [Showable]\nhlist = [ pack 3\n        , pack 'x'\n        , pack pi\n        , pack \"string\"\n        , pack (Just ()) ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 2, "last_activity_date": 1433663989, "creation_date": 1433663989, "answer_id": 30691325, "question_id": 30687837, "link": "https://stackoverflow.com/questions/30687837/representing-arbitrary-implementations-of-a-typeclass-in-haskell/30691325#30691325", "title": "Representing arbitrary implementations of a typeclass in Haskell", "body": "<p>The problem with what you are trying to do (heterogenous) collection is that : once you have a list of <code>Foo</code> it's hard to go back to the original type. However, if you are happy to <em>forget</em> the original type, an other way to solve your problem is to <em>convert</em> your data to <code>Foo</code>. This approach might seems wrong but remember, data are immutable in Haskell, so you'll never be able to modify your objects anyway, so the only thing you can do with your <code>Foo</code>s is get information from them. There is then no difference between a real <code>Bar</code> acting like a <code>Foo</code> and a new <code>Foo</code> acting as the <code>Bar</code> version would (also, Haskell lazy, so the <em>conversion</em> will be only done if needed).</p>\n\n<p>When you realized that, you can even go further and replace <code>object</code> but just a bunch of functions (as stated in @chi link). Your code becomes</p>\n\n<pre><code> data Foo = { saySomething :: String, saySomethingElse :: String }\n -- Haskell is lazzy, so saySomething can be seen as function\n -- without argument\n\n class Fooable a where\n       toFoo :: a -&gt; Foo\n\n data Bar = Bar Int Char\n data Baz = Bar String\n\n instance Fooable Bar where\n        toFoo (Bar i c) = { \"Bar number : \" ++ show i, \"Bar char : \" ++ [c] }\n instance Fooable Baz where\n        toFoo (Baz s) = {\"Your baz is \" ++ s, \"Nothing to add.\" }\n\n sayAll : [Foo] -&gt; [String]\n sayAll = map saySomething\n\n bar = Bar 1 'a'\n baz = Baz \"Bazzar\"\n\n sayAll [toFoo bar, toFoo baz]\n</code></pre>\n\n<p>Please note, that even though <code>somethingElse</code> doesn't look like a function but it's just a plain function, it will never been called (in this example). The result of <code>toFoo</code> can be seen as a <em>bridge</em> between <code>Bar</code> and <code>Foo</code>.</p>\n"}], "owner": {"reputation": 2895, "user_id": 1385269, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a7d953ada68569a034a0a4e7030bc4a2?s=128&d=identicon&r=PG", "display_name": "Ryan Kennedy", "link": "https://stackoverflow.com/users/1385269/ryan-kennedy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 30687894, "answer_count": 2, "score": 3, "last_activity_date": 1433663989, "creation_date": 1433626827, "question_id": 30687837, "link": "https://stackoverflow.com/questions/30687837/representing-arbitrary-implementations-of-a-typeclass-in-haskell", "title": "Representing arbitrary implementations of a typeclass in Haskell", "body": "<p>I'm trying to overcome years of working within the classic Java-style inheritance model to truly get comfortable with Haskell. It hasn't been going well, and I need a bit of help.</p>\n\n<p>Suppose I have a typeclass <code>Foo</code>. I want to represent a list of arbitrary implementing classes of <code>Foo</code>, but not in a way that restricts every item in the list to be the same; I need to have a heterogeneous, open type so consumers of my library can implement their own <code>Foo</code>.</p>\n\n<p>The reason why is because I'd like to write something like the following (pidgin Haskell):</p>\n\n<pre><code>class Foo -- something...\n\ndata Bar = Bar Int Char\ndata Baz = Baz String\n\ninstance Foo Bar\ninstance Foo Baz\n\nsaySomething :: Foo -&gt; String\nsaySomething (Bar x _) = \"Bar number \" ++ (show x)\nsaySomething (Baz x) = \"Your baz is \" ++ x\nsaySomething _ = \"Unknown Foo\"\n\nsayAll :: [Foo] -&gt; [String]\nsayAll = map (saySomething)\n\nmain = putStrLn $ sayAll [ (Bar 5 'k'), (Bar 7 'G'), (Baz \"hello\") ]\n</code></pre>\n\n<p><strong>How would I create an extensible typeclass (or other datatype) that can be freely mixed with others of the same typeclass, but not necessarily the same exact type?</strong></p>\n"}, {"tags": ["json", "mongodb", "haskell", "bson", "scotty"], "answers": [{"comments": [{"owner": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "edited": false, "score": 0, "creation_date": 1433619407, "post_id": 30686771, "comment_id": 49433210, "body": "Oh damn, haha, can&#39;t believe I missed that (or, well to be fair I&#39;m still pretty bad at reading Haskell error messages, so maybe &#39;missed&#39; isn&#39;t the right term). Thank you a ton for taking a look at that.  I do use cabal for managing my dependencies, but probably got myself into a bad spot with reckless package install sessions."}, {"owner": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "edited": false, "score": 0, "creation_date": 1433620078, "post_id": 30686771, "comment_id": 49433395, "body": "So simply removing <code>aeson 0.8</code> fixed the problem (<code>AesonBson</code> seems to rely on <code>aeson 0.6</code>, thanks again for the help on that one. I tried running <code>ghc-pkg list transformers</code> and got two results, but I&#39;m not really sure what it&#39;s telling me. Do you see a problem?   <code>&#47;usr&#47;local&#47;Cellar&#47;ghc&#47;7.8.4&#47;lib&#47;ghc-7.8.4&#47;package.conf.d    transformers-0.3.0.0 &#47;Users&#47;tolson&#47;.ghc&#47;x86_64-darwin-7.8.4&#47;package.conf.d</code>"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 3, "last_activity_date": 1433619160, "creation_date": 1433619160, "answer_id": 30686771, "question_id": 30686675, "link": "https://stackoverflow.com/questions/30686675/convert-bson-to-json-and-send-as-api-response-haskell/30686771#30686771", "title": "Convert BSON to JSON and send as API response Haskell", "body": "<p>You have two different versions of <code>aeson</code> package: <code>aeson-0.8.0.2</code> and <code>aeson-0.6.2.1</code>. Clearly the <code>Value</code> from <code>aeson-0.6.2.1</code> is not an instance of <code>FromJSON</code> from <code>aeson-0.8.0.2</code>.</p>\n\n<p>I'd recommend you to cabalize the code and/or use cabal sandbox. Alternatively you can use <code>ghc-pkg</code> to unregister one of <code>aeson</code> versions.</p>\n\n<p>ADD: you seems to have the same issue with <code>transformers-0.3.0.0</code>. GHC never qualifies identifiers with package name and version in error messages unless it is ambiguous. Try <code>ghc-pkg list transformers</code></p>\n"}], "owner": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1433619160, "creation_date": 1433618467, "question_id": 30686675, "link": "https://stackoverflow.com/questions/30686675/convert-bson-to-json-and-send-as-api-response-haskell", "title": "Convert BSON to JSON and send as API response Haskell", "body": "<p>I'm working on my first Haskell web app, and am having trouble converting a BSON document into JSON and then sending it as an API response. I'm currently using the <code>AesonBson</code> package to convert my BSON to an Aeson <code>Object</code>, but can't figure out how to send that Aeson <code>Object</code> as a JSON API response. </p>\n\n<p>Here is an example of a route handler in my server:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Web.Routes where\n\n\nimport Web.Scotty\nimport Web.Utils\nimport Web.Actions.Database\nimport Control.Monad.Trans (liftIO)\nimport Data.AesonBson\n\n\nroutes :: ScottyM ()\nroutes = do\n  get \"/databases/:db/:collection\" $ do\n      db &lt;- param \"db\"\n      collection &lt;- param \"collection\"\n      docs &lt;- liftIO $ getAllDocuments \"127.0.0.1\" db collection\n      json $ map aesonify docs\n</code></pre>\n\n<p>These seems like it should be simple - <code>getAllDocuments</code> returns <code>IO [Document]</code>, and then I map <code>aesonfy</code> over my list of docs, before attempting to return them as a JSON server response.</p>\n\n<p>Problem is I keep getting this <code>No instance for ToJSON</code> error:</p>\n\n<pre><code>No instance for (aeson-0.8.0.2:Data.Aeson.Types.Class.ToJSON\n                   aeson-0.6.2.1:Data.Aeson.Types.Internal.Value)\n  arising from a use of \u2018Web.Scotty.json\u2019\nIn the expression: Web.Scotty.json\nIn a stmt of a 'do' block:\n  Web.Scotty.json\n  GHC.Base.$ GHC.Base.map Data.AesonBson.aesonify docs\nIn the second argument of \u2018(GHC.Base.$)\u2019, namely\n  \u2018do { db &lt;- Web.Scotty.param \"db\";\n        collection &lt;- Web.Scotty.param \"collection\";\n        docs &lt;- transformers-0.3.0.0:Control.Monad.IO.Class.liftIO\n                GHC.Base.$\n                  Web.Actions.Database.getAllDocuments \"127.0.0.1\" db collection;\n        Web.Scotty.json\n        GHC.Base.$ GHC.Base.map Data.AesonBson.aesonify docs }\u2019\n</code></pre>\n\n<p>Any idea what I am missing? It looks like <code>aesonify</code> returns an Aeson <code>Object</code>... shouldn't that be an instace of <code>ToJSON</code>? Any help would be greatly appreciated, I've been spinning my wheels on this one for a while now. I've tried placing Aeson's <code>object</code> function in different places, manually adding documents as an instance of <code>ToJSON</code>, but really can't figure this out.</p>\n"}, {"tags": ["haskell", "recursion", "fold"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1433616509, "post_id": 30686363, "comment_id": 49432435, "body": "Evaluate it manually and see for yorself."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1433629895, "post_id": 30686363, "comment_id": 49435840, "body": "<code>acc</code> is  not an accumulator (from the left); it stands for the recursive result (from the right), so better to call it <code>r</code>, to avoid the cognitive dissonance."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1433631705, "post_id": 30686363, "comment_id": 49436183, "body": "@WillNess, did you mean that when we use foldl/foldl&#39; we should call the &quot;acc&quot; really acc, and when we use foldr we should call it r, cause it is the recursive part of the function?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1434546101, "post_id": 30686363, "comment_id": 49823928, "body": "@FtheBuilder on the second thought, basically, yes, that&#39;s it. :)"}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1433632128, "post_id": 30686421, "comment_id": 49436261, "body": "Thank you very much, your example helped a lot. Just a little point: So considering that <code>foldr f a (x:xs) = f x (foldr f a xs)</code> if it was instead <code>foldr f a (x:xs) = f (foldr f a xs) x</code>, it wouldn&#39;t work on infinity lists?"}, {"owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1433632581, "post_id": 30686421, "comment_id": 49436346, "body": "@FtheBuilder If <code>f</code> needs to fully evaluate the exact value of the first argument (like in your example <code>\\(k,v) acc -&gt; if k == 1 then ... else ...</code>), then it wouldn&#39;t work. However, if <code>f</code> doesn&#39;t need to evaluate it (e.g. <code>\\pair acc -&gt; acc</code>) then it should work."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "edited": false, "score": 0, "creation_date": 1433632840, "post_id": 30686421, "comment_id": 49436392, "body": "@mucaho Uhhmm, so, it only evaluates the argument (doesn&#39;t matter the order) if it is needed inside its logics basically??"}, {"owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1433635431, "post_id": 30686421, "comment_id": 49436823, "body": "@FtheBuilder Yes, that&#39;s the gist of lazy evaluation. Calling your 2nd foldr like so  <code>foldr (\\_ x -&gt; x) 0 [10..]</code> evaluates to <code>(\\_ x -&gt; x) *thunk* 10</code> and prints <code>10</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1433639458, "post_id": 30686421, "comment_id": 49437426, "body": "@FtheBuilder Yes, the order does not matter. What matters is whether an argument is forced/demanded/needed. For instance, pattern matching (<code>case</code>) and basic operators (<code>==,+,*,...</code>) can force an argument. This makes <code>(\\x -&gt; 4)</code> and <code>(\\x -&gt; x*0 + 4)</code> different functions: the latter will evaluate <code>x</code> unlike the former."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "edited": false, "score": 1, "creation_date": 1433641571, "post_id": 30686421, "comment_id": 49437784, "body": "@mucaho @chi - Your examples were really clarifying for me, because certainly the differences between <code>(\\x -&gt; 4)</code> and <code>(\\x -&gt; x*0 + 4)</code>, aren&#39;t mere details: if x is a complex &quot;thing&quot; to be evaluated the former way will avoid useless computations."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1433617048, "last_edit_date": 1433617048, "creation_date": 1433616508, "answer_id": 30686421, "question_id": 30686363, "link": "https://stackoverflow.com/questions/30686363/why-foldr-works-on-infinity-list/30686421#30686421", "title": "Why foldr works on infinity list?", "body": "<p>Because the function passed to <code>foldr</code> does not always evaluate the <code>acc</code> parameter, i.e. it is lazy in that parameter.</p>\n\n<p>For example,</p>\n\n<pre><code>(\\(k,v) acc -&gt; if 1 == k then Just v else acc) (1,\"one\") (error \"here be dragons!\")\n</code></pre>\n\n<p>will return <code>\"one\"</code> without even attempting to evaluate the <code>error</code> expression.</p>\n\n<p>Moreover, <code>foldr</code> by definition satisfies:</p>\n\n<pre><code>foldr f a (x:xs) = f x (foldr f a xs)\n</code></pre>\n\n<p>If <code>x:xs</code> is infinite, but <code>f</code> does not use its second argument, then <code>foldr</code> can return immediately. </p>\n\n<p>In your example, <code>f</code> evaluates its second element if and only if the first argument is not the wanted association. This means that the association list will only be evaluated only enough to find the <code>key</code> association.</p>\n\n<p>If you like to experiment, try this instead:</p>\n\n<pre><code>foldr (\\(k,v) acc -&gt; case acc of\n          Nothing -&gt; if key == k then Just v else acc\n          Just y  -&gt; if key == k then Just v else acc) Nothing\n</code></pre>\n\n<p>The <code>case</code> looks redundant, since the function returns the same thing in both branches. <em>However</em>, this demands the evaluation of <code>acc</code> breaking the code on infinite lists.</p>\n\n<p>Another thing you might want to try</p>\n\n<pre><code>foldr (:) [] [0..]\n</code></pre>\n\n<p>This basically rebuilds the infinite list as it is.</p>\n\n<pre><code>foldr (\\x xs -&gt; x*10 : xs) [] [0..]\n</code></pre>\n\n<p>This multiplies everything by <code>10</code>, and is equivalent to <code>map (*10) [0..]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1433632582, "post_id": 30686445, "comment_id": 49436347, "body": "What do you mean by &quot;The non-empty case of <code>foldr</code>&quot;? Your answer also was quite helpful for me, thanks!"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1433634934, "post_id": 30686445, "comment_id": 49436742, "body": "@FtheBuilder The definition of <code>foldr</code> consists of two cases: one for the empty list (<code>foldr _ init [] = init</code>) and one for non-empty lists (<code>foldr f init (x:xs) = f x (foldr f init xs)</code>). Since the former wasn&#39;t relevant to the question, I only talked about the latter case. That&#39;s what I meant by &quot;the non-empty case&quot;."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1433640237, "post_id": 30686445, "comment_id": 49437547, "body": "Thank you, now your answer is completely clear for me!"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 2, "last_activity_date": 1433616664, "creation_date": 1433616664, "answer_id": 30686445, "question_id": 30686363, "link": "https://stackoverflow.com/questions/30686363/why-foldr-works-on-infinity-list/30686445#30686445", "title": "Why foldr works on infinity list?", "body": "<p>The non-empty case of <code>foldr</code> can be defined as <code>foldr f init (x:xs) = f x (foldr f init xs)</code>. In your case <code>f</code> is <code>(\\(k,v) acc -&gt; if key == k then Just v else acc)</code>, so <code>(k,v)</code> stands for the current element in the list and <code>acc</code> stands for <code>(foldr f init xs)</code>. That is, <code>acc</code> stands for the recursive call. In the <code>then</code>-case, you do not use <code>acc</code>, therefore the recursive call does not happen since Haskell is lazy meaning arguments aren't evaluated until (and unless) used.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 1, "accepted_answer_id": 30686421, "answer_count": 2, "score": 3, "last_activity_date": 1433617048, "creation_date": 1433616138, "question_id": 30686363, "link": "https://stackoverflow.com/questions/30686363/why-foldr-works-on-infinity-list", "title": "Why foldr works on infinity list?", "body": "<p>This function may work on infinity association lists, and it is easy to find out why:</p>\n\n<pre><code>findKey :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v  \nfindKey key [] = Nothing  \nfindKey key ((k,v):xs) = if key == k  \n                         then Just v  \n                         else findKey key xs\n</code></pre>\n\n<p>When it find the key, it returns <code>Just v</code>, stopping the recursion.\nNow look at this another implementation:</p>\n\n<pre><code> findKey' :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v  \n findKey' key = foldr (\\(k,v) acc -&gt; if key == k then Just v else acc) Nothing\n</code></pre>\n\n<p>How does the compiler/interpreter know that when the key matches k, it can return it?</p>\n\n<pre><code> *Main&gt; findKey' 1 $ zip [1..] [1..]\n</code></pre>\n\n<p>returns <code>Just 1</code></p>\n\n<p>When it finds that <code>key == k</code>, it returns <code>Just v</code>. Why does the recursion stop there, allowing us to do such things with infinity association lists?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1433617229, "creation_date": 1433615887, "last_edit_date": 1433617229, "question_id": 30686318, "link": "https://stackoverflow.com/questions/30686318/automatic-lens-aggregation", "title": "Automatic lens aggregation", "body": "<p>I've just discover <code>makeClass</code> from the <code>lens</code> package. It allows you to things like</p>\n\n<pre><code>data Point2 = Point2 { _x:: Double, _y :: Double }\nmakeClassy ''Point2\n\ndata Point3 = Point3 { _p2 : Point2, _z :: Double}\nmakeclassy ''Point3\n\ninstance HasPoint2 Point3 where\n    point2 = p2\n</code></pre>\n\n<p>You can then do things like</p>\n\n<pre><code>p3 = Point3 (Point 2 1 2) 3\n\np3 ^. x -- 1\np3 ^. y -- 2\np3 ^. z -- 3\n</code></pre>\n\n<p>Which is brilliant. However, is there a way to regroup the <code>makeClassy</code> and <code>instance HasPoint2</code> in one step?</p>\n"}, {"tags": ["haskell", "types", "ghc", "typeclass"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 6, "creation_date": 1433610731, "post_id": 30685425, "comment_id": 49430751, "body": "The <code>tai</code> parameter is fixed to <code>Double</code> because of your datatype. Change it to <code>data Method a = Ndiv Int | Size a</code>, for example, then your function should typecheck, although you&#39;ll need a stronger constraint than <code>Num</code>, <code>cieling</code> requires <code>RealFrac</code>. The type will be <code>RealFrac a =&gt; (a,a,a) -&gt; (a,a,a) -&gt; Method a -&gt; [(a,a,a)] </code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1433613481, "post_id": 30685425, "comment_id": 49431535, "body": "@user2407038 you should put this into an answer ;)"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1433619122, "creation_date": 1433619122, "answer_id": 30686766, "question_id": 30685425, "link": "https://stackoverflow.com/questions/30685425/could-not-deduce-a-double-with-haskell/30686766#30686766", "title": "Could not deduce (a ~ Double) with Haskell", "body": "<p>The <code>tai</code> parameter is fixed to <code>Double</code> because of your datatype. Change it to </p>\n\n<pre><code>data Method a = Ndiv Int | Size a\n</code></pre>\n\n<p>for example, then your function should typecheck, although you'll need a stronger constraint than <code>Num</code>, as <code>cieling</code> requires <code>RealFrac</code>. The type will be </p>\n\n<pre><code>function :: RealFrac a =&gt; (a,a,a) -&gt; (a,a,a) -&gt; Method a -&gt; [(a,a,a)]\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 30686766, "answer_count": 1, "score": 1, "last_activity_date": 1433619122, "creation_date": 1433610315, "question_id": 30685425, "link": "https://stackoverflow.com/questions/30685425/could-not-deduce-a-double-with-haskell", "title": "Could not deduce (a ~ Double) with Haskell", "body": "<p>I have a typing problem with a Haskell function.\nI implemented this (simplified) function :</p>\n\n<pre><code>function (xa,ya,za) (xb,yb,zb) (Size tai) = function (xa,ya,za) (xb,yb,zb) (Ndiv ndiv)\n  where \n        ndiv = ceiling (leng / tai)\n        leng = sqrt((xb-xa)**2+(yb-ya)**2+(zb-za)**2)\n\ndata Method = Ndiv Int\n            | Size Double\n</code></pre>\n\n<p>It working well if I give my <code>function</code> this signature : </p>\n\n<pre><code>function :: (Double,Double,Double) -&gt; (Double,Double,Double) -&gt; Method -&gt; [(Double,Double,Double)] \n</code></pre>\n\n<p>Now, I would like to extend my function to the whole <code>Num</code> class. I forced the type with : </p>\n\n<pre><code>function :: Num a =&gt; (a,a,a) -&gt; (a,a,a) -&gt; Method -&gt; [(a,a,a)] \n</code></pre>\n\n<p>and when compiling, GHC give me the following error : </p>\n\n<pre><code>Could not deduce (a ~ Double)\nfrom the context (Num a)\n  bound by the type signature for\n             function :: Num a =&gt;\n                         (a, a, a) -&gt; (a, a, a) -&gt; Method -&gt; [(a, a, a)]\n  at Type.hs:7:13-62\n  `a' is a rigid type variable bound by\n      the type signature for\n        function :: Num a =&gt;\n                    (a, a, a) -&gt; (a, a, a) -&gt; Method -&gt; [(a, a, a)]\n      at Type.hs:7:13\nIn the second argument of `(/)', namely `tai'\nIn the first argument of `ceiling', namely `(leng / tai)'\nIn the expression: ceiling (leng / tai)\n</code></pre>\n\n<p>I never had a such error and I'm a bit disappointed.<br>\nI suspect a class conflict/mismatch but I don't see how to solve it ?</p>\n\n<p><strong>Do you know what is wrong with my function and how to make it work?</strong></p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1457850222, "creation_date": 1457850222, "answer_id": 35967233, "question_id": 30685248, "link": "https://stackoverflow.com/questions/30685248/cabal-sandbox-v-global-package-db/35967233#35967233", "title": "cabal sandbox v. global package db", "body": "<p>You should be able to pass <code>cabal configure</code> the <code>--package-db</code> flag, documented like so:</p>\n\n<blockquote>\n<pre><code>--package-db=DB                  Append the given package database to the\n                                 list of package databases used (to satisfy\n                                 dependencies and register into). May be a\n                                 specific file, 'global' or 'user'. The\n                                 initial list is ['global'], ['global',\n                                 'user'], or ['global', $sandbox],\n                                 depending on context. Use 'clear' to reset\n                                 the list to empty. See the user guide for\n                                 details.\n</code></pre>\n</blockquote>\n\n<p>So in particular, you can pass it <code>clear</code> and then pass it just the sandbox db.</p>\n\n<p>This is all discussed in wonderful detail in the <a href=\"https://www.vex.net/~trebla/haskell/sicp.xhtml\" rel=\"nofollow\">Storage and Interpretation of Cabalized Packages</a> article.</p>\n"}], "owner": {"reputation": 596, "user_id": 559523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ab40d2dbf7e2bb0f3c2f53d302a8bd2?s=128&d=identicon&r=PG", "display_name": "Jeff Clites", "link": "https://stackoverflow.com/users/559523/jeff-clites"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1457850222, "creation_date": 1433609224, "question_id": 30685248, "link": "https://stackoverflow.com/questions/30685248/cabal-sandbox-v-global-package-db", "title": "cabal sandbox v. global package db", "body": "<p>When installing inside a cabal sandbox, cabal will still use packages from the global package db (in particular, packages which came from the Haskell Platform). This can lead to install conflicts. Is it possible to configure cabal to ignore the global package db?</p>\n\n<p>I see the corresponding feature has been implemented in <code>ghc</code> itself, via a <code>-no-global-package-db</code> option (see <a href=\"https://ghc.haskell.org/trac/ghc/ticket/5977\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/5977</a>), and <code>ghc-pkg</code> will ignore the global package db if you do not pass it the <code>--global</code> flag. Is there a way to configure cabal similarly?</p>\n\n<p>Also, there's a closed issue against cabal implying the opposite behavior (rebuilding everything instead of using packages from the installed Haskell Platform), so I'm not sure if this behavior has changed over time; see <a href=\"https://github.com/haskell/cabal/issues/1695\" rel=\"nofollow\">https://github.com/haskell/cabal/issues/1695</a></p>\n"}, {"tags": ["c", "haskell", "ffi"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433611251, "post_id": 30685086, "comment_id": 49430860, "body": "Your C code in <code>main.c</code> is already wrong for what you want to do, since <code>setIntArray(ints)</code> cannot modify the value of <code>ints</code> itself, which it would need to do to have <code>ints</code> point to allocated memory after the call. Maybe you wanted to call <code>setIntArray(&amp;ints)</code>, with <code>setIntArray</code> of type <code>Ptr (Ptr CInt) -&gt; IO CInt</code>?"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433612073, "post_id": 30685086, "comment_id": 49431094, "body": "Hmm, my code works fine if I do <code>malloc_</code> in C and not Haskell and modifies the values. <code>ints</code> is already a pointer. If I am not mistaken the appropriate syntax should be <code>setIntArray(ints)</code>, just double checked, if I <code>setIntArrays(&amp;ints)</code> it gets a segmentation fault. I don&#39;t think it needs to be a double pointer, it is just 1D array being set."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433612604, "post_id": 30685086, "comment_id": 49431267, "body": "But you had to pass <code>&amp;ints</code> into <code>malloc_</code>, so that <code>malloc_</code> could change the value of <code>ints</code>... the same will be true of <code>setIntArray</code>, if you want to move the allocation there."}], "answers": [{"comments": [{"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1433613774, "post_id": 30685794, "comment_id": 49431618, "body": "The problem I was trying to solve is that I didn&#39;t see a way to allocate memory via the provided functions <code>malloc</code> or <code>mallocArray</code> and then mutate <code>is</code> to equal the memory I allocated. That&#39;s why I came up with importing <code>malloc_</code>. I don&#39;t fully understand <code>with</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1433621854, "post_id": 30685794, "comment_id": 49433871, "body": "You can&#39;t do that regardless of <code>malloc_</code> or anything else because your C type for <code>setIntArray</code> is wrong. That&#39;s what I was trying to explain in my comments. Just try writing the whole program in C with the allocation inside <code>setIntArray</code> and you will see the problem."}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1433655174, "post_id": 30685794, "comment_id": 49439764, "body": "Ok, now I see what you mean about <code>setInArray</code> being wrong."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 1, "last_activity_date": 1433612528, "creation_date": 1433612528, "answer_id": 30685794, "question_id": 30685086, "link": "https://stackoverflow.com/questions/30685086/trouble-importing-a-c-function-into-haskell/30685794#30685794", "title": "Trouble importing a C function into Haskell", "body": "<p>Ignoring the other issues with your question, and just addressing the part about calling <code>malloc</code>: you have a few options.</p>\n\n<ul>\n<li><p><code>malloc</code> is already imported for you as <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Foreign-Marshal-Alloc.html#v:malloc\" rel=\"nofollow\">malloc</a>, or you can even use <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Foreign-Marshal-Array.html#v:mallocArray\" rel=\"nofollow\">mallocArray</a> in this case.</p></li>\n<li><p>If you really want to import <code>malloc</code> yourself (maybe you actually want to use a different allocator), you'd make things more convenient for yourself by just returning the pointer value from your wrapper, like <code>malloc</code> itself does:</p>\n\n<pre><code>void *malloc_ (size_t size, int m) {\n  return malloc(size*m);\n}\n</code></pre>\n\n<p>then <code>foreign import ccall \"malloc_\" malloc_ :: CSize -&gt; CInt -&gt; IO (Ptr ())</code>, and just call it.</p></li>\n<li><p>If you really want to use this out-argument-style <code>void malloc_ (void **p, size_t size, int m)</code>, then you have to allocate storage for a <code>void *</code>, so that you can pass its address as the first argument of <code>malloc_</code>, like you would do in C.</p>\n\n<pre><code>  my_allocated_pointer &lt;- with nullPtr $ \\pp -&gt; do\n    malloc_ pp (fromIntegral $ sizeOf (undefined :: CInt)) (fromIntegral 10)\n    peek pp\n</code></pre>\n\n<p>(This is now starting to get a bit silly, since <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Foreign-Marshal-Utils.html#v:with\" rel=\"nofollow\">with</a> uses <code>malloc</code> internally... but it's the approach you would use in general.)</p></li>\n</ul>\n"}], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 30685794, "answer_count": 1, "score": 3, "last_activity_date": 1433612528, "creation_date": 1433608202, "question_id": 30685086, "link": "https://stackoverflow.com/questions/30685086/trouble-importing-a-c-function-into-haskell", "title": "Trouble importing a C function into Haskell", "body": "<p>I have a C program that calls a Haskell function. I want the Haskell function to be responsible for determining the size of the array (pointer) so I also want Haskell to malloc the pointer from C. I get an error when <code>malloc_</code> is called in Haskell. I am not sure how to emulate the way <code>malloc_</code> is called in C <code>malloc_((void *)&amp;ints,sizeof(int),10);</code> into Haskell. </p>\n\n<h3>aux.c</h3>\n\n<pre><code>void malloc_ (void **p, size_t size, int m) {\n  *p = malloc(size*m);\n}\n</code></pre>\n\n<h3>main.c</h3>\n\n<pre><code>int *ints;\n// want to call this function in Haskell, C doesn't know how large the array is\n// malloc_((void *)&amp;ints,sizeof(int),10);\n\nint ints_size = setIntArray(ints);\n\nfor (int i = 0; i &lt; ints_size; i++) {\n  printf(\"ints[%d]: %d\\n\", i, ints[i]);\n}\n</code></pre>\n\n<h3>Arrays.hs</h3>\n\n<pre><code>#include \"aux.h\"\n-- this might be wrong\nforeign import ccall \"malloc_\" malloc_ :: Ptr (Ptr ()) -&gt; CSize -&gt; CInt -&gt; IO ()\n\nforeign export ccall \"setIntArray\" setIntArray :: Ptr CInt -&gt; IO CInt\nsetIntArray :: Ptr CInt -&gt; IO (CInt)\nsetIntArray is =  do\n  let r = 10 :: Int\n\n  -- if I remove this and malloc in C then it is fine\n  malloc_ (castPtr is) (fromIntegral $ sizeOf is) (fromIntegral r)\n\n\n  x &lt;- addArrayElement r 0\n\n  return $ fromIntegral x\n\n  where\n    addArrayElement :: Int -&gt; Int -&gt; IO Int\n    addArrayElement r pointerCounter =\n      case pointerCounter &gt;= r of\n        True  -&gt; return r\n        False -&gt; do\n          let x = 1234\n          poke (advancePtr is pointerCounter) (x :: CInt)\n          addArrayElement r (pointerCounter + 1)\n</code></pre>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1433608903, "post_id": 30684755, "comment_id": 49430160, "body": "Why would you need that? Just curious. You certainly can&#39;t find typeclasses defined in modules you don&#39;t import; as far as I can tell TH doesn&#39;t have any way to enumerate &quot;whatever is visible from here&quot;."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1433610565, "post_id": 30684755, "comment_id": 49430697, "body": "I&#39;m trying to automatically instanciate typeclass for sum types."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1433613529, "post_id": 30684755, "comment_id": 49431546, "body": "How would you instantiate e.g. a Monad for a sum type?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1433614495, "post_id": 30684755, "comment_id": 49431821, "body": "I&#39;m only instantiating typeclasses following a certain pattern, not every typeclasses."}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1433610599, "creation_date": 1433605782, "last_edit_date": 1433610599, "question_id": 30684755, "link": "https://stackoverflow.com/questions/30684755/is-there-a-way-to-find-all-typeclasses-of-type-in-template-haskell", "title": "Is there a way to find all typeclasses of type in Template Haskell", "body": "<p>The question is in the title. Given a type, is there a way to find all the typeclasses it instantiates. I'm try to get the list of <em>fields</em> generated by <code>makeField</code> (<code>lens</code>).Example</p>\n\n<pre><code> data Point = Point { _x :: Double, _y :: Double } deriving (Show).\n</code></pre>\n\n<p>I would like given <code>Point</code> to get <code>[HasX, HasY, Show]</code>.\nAlternatively, is there a way to get all the <code>Name</code> in scope ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 52334, "user_id": 702638, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/892f65bc0a8a0949ab88598de7d83cab?s=128&d=identicon&r=PG", "display_name": "Hunter McMillen", "link": "https://stackoverflow.com/users/702638/hunter-mcmillen"}, "edited": false, "score": 3, "creation_date": 1433605658, "post_id": 30684725, "comment_id": 49429198, "body": "It is the identity function: <a href=\"https://www.haskell.org/hoogle/?hoogle=id\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=id</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1433605709, "post_id": 30684725, "comment_id": 49429213, "body": "<code>id</code> is just the identity function. <code>filter id</code> is the same as <code>filter (==True)</code> - it just removes the <code>False</code> elements."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 7, "creation_date": 1433606102, "post_id": 30684725, "comment_id": 49429330, "body": "I wonder who would downvote this perfectly good question (for a beginner) - guys we should keep the extremely positive Haskell subgroup friendly!"}, {"owner": {"reputation": 6631, "user_id": 1488533, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e063fcfd88a6af736427025f7ac14649?s=128&d=identicon&r=PG&f=1", "display_name": "lllllllllllll", "link": "https://stackoverflow.com/users/1488533/lllllllllllll"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433606776, "post_id": 30684725, "comment_id": 49429512, "body": "@Carsten, Thank you! I searched the meaning of <code>id</code> function. But what I was confused is why <code>id</code> can be used here. Now I understand it due to great answers below :)"}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1433608815, "post_id": 30684725, "comment_id": 49430128, "body": "@Carsten Yes, the Haskell community has a reputation for being <a href=\"https://www.simple-talk.com/opinion/geek-of-the-week/simon-peyton-jones-geek-of-the-week/\" rel=\"nofollow noreferrer\">welcoming and friendly</a> to maintain!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1433616388, "post_id": 30684725, "comment_id": 49432404, "body": "On an unrelated not, you can also define <code>xor</code> more concisely, and with less memory consumption as <code>xor = foldr1 (&#47;=)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 13, "last_activity_date": 1433605654, "creation_date": 1433605654, "answer_id": 30684734, "question_id": 30684725, "link": "https://stackoverflow.com/questions/30684725/what-does-id-in-this-haskell-code-mean/30684734#30684734", "title": "What does &quot;id&quot; in this Haskell code mean?", "body": "<p>The definition of <code>id</code> is <code>id x = x</code>, so <code>filter id</code> is the same as <code>filter (\\x -&gt; x)</code>. That is it takes all the elements of the list whose value is <code>True</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 6631, "user_id": 1488533, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e063fcfd88a6af736427025f7ac14649?s=128&d=identicon&r=PG&f=1", "display_name": "lllllllllllll", "link": "https://stackoverflow.com/users/1488533/lllllllllllll"}, "edited": false, "score": 0, "creation_date": 1433606699, "post_id": 30684742, "comment_id": 49429489, "body": "Thank you bheklilr, you give me the correct response but I can only choose one as &quot;answer&quot;. I somehow know <code>id</code>, it is like the <code>[]</code> for <code>function</code>. However, using it in this particular problem really blows my mind :)"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 10, "last_activity_date": 1433605729, "creation_date": 1433605729, "answer_id": 30684742, "question_id": 30684725, "link": "https://stackoverflow.com/questions/30684725/what-does-id-in-this-haskell-code-mean/30684742#30684742", "title": "What does &quot;id&quot; in this Haskell code mean?", "body": "<p>The <code>id</code> function is the identity function, with the very simple definition</p>\n\n<pre><code>id :: a -&gt; a\nid x = x\n</code></pre>\n\n<p>The function <code>filter</code> has the type</p>\n\n<pre><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>It takes a function returning a boolean, applies that function to every element of the list and keeps all the elements for which the function returns <code>True</code>.  So when you have <code>filter id</code>, it filters the list returning all the elements equal to <code>True</code>.</p>\n"}], "owner": {"reputation": 6631, "user_id": 1488533, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e063fcfd88a6af736427025f7ac14649?s=128&d=identicon&r=PG&f=1", "display_name": "lllllllllllll", "link": "https://stackoverflow.com/users/1488533/lllllllllllll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1767, "favorite_count": 0, "accepted_answer_id": 30684734, "answer_count": 2, "score": 7, "last_activity_date": 1433605729, "creation_date": 1433605543, "question_id": 30684725, "link": "https://stackoverflow.com/questions/30684725/what-does-id-in-this-haskell-code-mean", "title": "What does &quot;id&quot; in this Haskell code mean?", "body": "<p>this question is from a Haskell newbie.</p>\n\n<p>I write code below to check how many <code>True</code> in a list, and if it has <code>even</code> number of <code>True</code>, then return <code>True</code>, otherwise return `False'.</p>\n\n<pre><code>xor =\nfoldr xor' False\nwhere\nxor' True True = False\nxor' False False = False\nxor' _ _ = True\n</code></pre>\n\n<p>However, I found some code snippets below, and it seems that it can do the same thing.. \nHere is the code:</p>\n\n<pre><code>xor :: [Bool] -&gt; Bool\nxor = odd . length . filter id \n</code></pre>\n\n<p>But I just have no idea how <code>id</code> works in the above code, could anyone give me some help?</p>\n"}, {"tags": ["class", "haskell", "instance"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1433590907, "post_id": 30682300, "comment_id": 49425076, "body": "Use ghci and find out. Otherwise you can use the fact that <code>(a + b) mod n == (a mod n) + (b mod n) mod n</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1433591354, "creation_date": 1433591354, "answer_id": 30682481, "question_id": 30682300, "link": "https://stackoverflow.com/questions/30682300/haskell-class-instance-branch/30682481#30682481", "title": "Haskell class instance branch", "body": "<p>I'd think in the following way. Start from the <code>foo</code> type</p>\n\n<pre><code>foo :: a -&gt; Int\n</code></pre>\n\n<p>OK, so the type if its parameter determines the instance. Then I look at the call:</p>\n\n<pre><code> foo $ Branch True (Leaf [1::Int,2,3])\n              (Branch False (Leaf [0,3]) (Leaf [2,5]))\n</code></pre>\n\n<p>What's the type of that <code>Branch ...</code>?  It must be some <code>Tree a b</code> but for which <code>a</code> and <code>b</code>? Let's see...</p>\n\n<pre><code>Leaf [1::Int,2,3]\n</code></pre>\n\n<p>Ah! the <code>Leaf</code> contains a list of <code>Int</code>. I now know <code>a</code> is <code>[Int]</code>. What about <code>b</code>?</p>\n\n<pre><code>Branch True ....\n</code></pre>\n\n<p>The first argument of <code>Branch</code> must be of type <code>b</code>, so <code>True :: b</code> must hold. Well, this means that <code>b</code> is <code>Bool</code>.</p>\n\n<p>Summing up, <code>foo</code> is being called with a <code>Tree [Int] Bool</code> parameter.\nThis matches with</p>\n\n<pre><code>instance (Foo a, Foo b) =&gt; Foo (Tree a b) where\n</code></pre>\n\n<p>where <code>a,b</code> are as we found. This is also using <code>Foo a</code> and <code>Foo b</code>... which mean <code>Foo [Int]</code> and <code>Foo Bool</code>.</p>\n\n<pre><code>  foo (Leaf a) = foo a   -- this refers to Foo [Int]\n  foo (Branch a b c) = (foo a + foo b + foo c) `mod` 5\n                  --    ^-- this to Foo Bool\n                  --            ^-- this to Foo (Tree [Int] Bool), recursively\n                  --                    ^-- this to Foo (Tree [Int] Bool), recursively\n</code></pre>\n\n<p>Now, what's the instance for <code>Foo [Int]</code> and <code>Foo Bool</code>?</p>\n\n<p>And so on. I think you can figure out the rest.</p>\n"}], "owner": {"reputation": 11, "user_id": 4981059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b57a957ccbbd49b205deea522836536f?s=128&d=identicon&r=PG&f=1", "display_name": "662", "link": "https://stackoverflow.com/users/4981059/662"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1433591426, "creation_date": 1433590255, "last_edit_date": 1433591426, "question_id": 30682300, "link": "https://stackoverflow.com/questions/30682300/haskell-class-instance-branch", "title": "Haskell class instance branch", "body": "<p>Could someone help me with how I should think in this question? </p>\n\n<p>Given the following datatype</p>\n\n<pre><code>data Tree a b = Leaf a | Branch b (Tree a b) (Tree a b) \n</code></pre>\n\n<p>and the following typeclass</p>\n\n<pre><code>class Foo a where\n  foo :: a -&gt; Int\n</code></pre>\n\n<p>with the following instances</p>\n\n<pre><code>instance Foo Bool where\n  foo True = 1\n  foo False = 0\n\ninstance Foo Int where foo n = n `mod` 5\n\ninstance (Foo a, Foo b) =&gt; Foo (Tree a b) where\nfoo (Leaf a) = foo a\nfoo (Branch a b c) = (foo a + foo b + foo c) `mod` 5\n\ninstance Foo a =&gt; Foo [a] where\n  foo l = (sum (map foo l)) `mod` 5\n</code></pre>\n\n<p>What is the value of</p>\n\n<pre><code>foo $ Branch True (Leaf [1::Int,2,3])\n                  (Branch False (Leaf [0,3])\n                                (Leaf [2,5]))\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1433621288, "post_id": 30682688, "comment_id": 49433724, "body": "Thank you! I think is perfect! <i>&quot;However&quot;</i> yes of course, many additional things could be done to ensure compatibility (<code>getVersion</code>) and retrocompatibility (<code>getPlugin :: Maybe (a -&gt; a)</code>, <code>getPluginV2 :: Maybe (a -&gt; a -&gt; a)</code>, and so on)."}], "tags": [], "owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "is_accepted": true, "score": 6, "last_activity_date": 1433657367, "last_edit_date": 1433657367, "creation_date": 1433592735, "answer_id": 30682688, "question_id": 30681954, "link": "https://stackoverflow.com/questions/30681954/out-of-the-box-haskell-plugin-system/30682688#30682688", "title": "Out of the box Haskell plugin system", "body": "<p>There is <a href=\"https://hackage.haskell.org/package/dynamic-loader\" rel=\"nofollow\">the dynamic-loader package</a>, which allows you to load extra object files or shared libraries into your process. (The version on Hackage doesn't work with 7.10, but the current <a href=\"https://github.com/ggreif/dynamic-loader\" rel=\"nofollow\">version on GitHub does</a>.)</p>\n\n<p>With this, you could do:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import System.Plugins.DynamicLoader\nimport System.Directory\n\nloadPlugins :: FilePath -&gt; IO [PluginInterface]\nloadPlugins path = do\n    files &lt;- getDirectoryContents path\n    mapM (\\plugin_path -&gt; do\n        m &lt;- loadModuleFromPath (path ++ \"/\" ++ plugin_path) (Just path)\n        resolveFunctions\n        plugin &lt;- loadFunction m \"getPlugin\"\n        return plugin) files\n</code></pre>\n\n<p>However, you have to keep in mind that the entire process is <strong>very unsafe</strong>: if you change your <code>PluginInterface</code> data type and try to load a plugin compiled with the old version, your application will crash. You have to hope that the <code>getPlugin</code> function has type <code>PluginInterface</code>, there's no check for that. Lastly, if the plugin comes from an untrusted source, it could execute anything, even though the function you try to call should be pure in Haskel.</p>\n"}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 1, "accepted_answer_id": 30682688, "answer_count": 1, "score": 8, "last_activity_date": 1433683811, "creation_date": 1433587981, "last_edit_date": 1592644375, "question_id": 30681954, "link": "https://stackoverflow.com/questions/30681954/out-of-the-box-haskell-plugin-system", "title": "Out of the box Haskell plugin system", "body": "<p>I've read about plugins in Haskell but I can't get a satisfactory way to my purposes (ideally to use in a production environment).</p>\n<p>My plugin system goals are:</p>\n<ol>\n<li>the production environment must to be out of the box (all precompiled).</li>\n<li>to load plugins is enabled reset app/service but ideally it would load and update plugins on the fly.</li>\n</ol>\n<p>One minimal example could be:</p>\n<p><strong>The app/service ~ plugins interface</strong></p>\n<pre><code>module SharedTypes (PluginInterface (..)) where\n\ndata PluginInterface =\n     PluginInterface { pluginName :: String\n                     , runPlugin  :: Int -&gt; Int }\n</code></pre>\n<p><strong>Some plugin list</strong></p>\n<pre><code>-- ~/plugins/plugin{Nth}.??   (with N=1..)\nmodule Plugin{Nth}( getPlugin ) where\n\nimport SharedTypes\n\ngetPlugin :: PluginInterface\ngetPlugin = PluginInterface &quot;{Nth}th plugin&quot; $ \\x -&gt; {Nth} * x\n</code></pre>\n<p><strong>App/service</strong></p>\n<pre><code>...\nloadPlugins :: FilePath -&gt; IO [PluginInterface]\nloadPlugins = undefined\n...\n</code></pre>\n<p>I think using dynamic <s>compilation</s> link library (compiling each <code>Plugin{Nth}</code> as shared library) could works (as FFI) but</p>\n<ol>\n<li><strong>How enumerate and load each shared library at runtime?</strong> (get every <code>getPlugin</code> function point)</li>\n<li>Exists some better way? (Eg. some <em>&quot;magic&quot;</em> process before run application/service)</li>\n</ol>\n<p>Thank you!</p>\n<p><strong>UPDATE</strong></p>\n<h1>Full running example</h1>\n<p>Following the great @xnyhps answer, a full running example using <code>ghc 7.10</code></p>\n<p><strong>SharedTypes.hs</strong></p>\n<pre><code>module SharedTypes (\n  PluginInterface (..)\n) where\n\ndata PluginInterface =\n     PluginInterface { pluginName :: String\n                     , runPlugin  :: Int -&gt; Int\n                     }\n</code></pre>\n<p><strong>Plugin1.hs</strong></p>\n<pre><code>module Plugin1 (\n  getPlugin\n) where\n\nimport SharedTypes\n\ngetPlugin :: PluginInterface\ngetPlugin = PluginInterface &quot;Plugin1&quot; $ \\x -&gt; 1 * x\n</code></pre>\n<p><strong>Plugin2.hs</strong></p>\n<pre><code>module Plugin2 (\n  getPlugin\n) where\n\nimport SharedTypes\n\ngetPlugin :: PluginInterface\ngetPlugin = PluginInterface &quot;Plugin2&quot; $ \\x -&gt; 2 * x\n</code></pre>\n<p><strong>app.hs</strong></p>\n<pre><code>import SharedTypes\nimport System.Plugins.DynamicLoader\nimport System.Directory\nimport Data.Maybe\nimport Control.Applicative\nimport Data.List\nimport System.FilePath\nimport Control.Monad\n\nloadPlugins :: FilePath -&gt; IO [PluginInterface]\nloadPlugins path = getDirectoryContents path &gt;&gt;= mapM loadPlugin . filter (&quot;.plugin&quot; `isSuffixOf`)\n  where loadPlugin file = do\n          m &lt;- loadModuleFromPath (combine path file)  -- absolute path\n                                  (Just path)          -- base of qualified name (or you'll get not found)\n          resolveFunctions\n          getPlugin &lt;- loadFunction m &quot;getPlugin&quot;\n          return getPlugin\n\nmain = do\n\n  -- and others used by plugins\n  addDLL &quot;/usr/lib/ghc-7.10.1/base_I5BErHzyOm07EBNpKBEeUv/libHSbase-4.8.0.0-I5BErHzyOm07EBNpKBEeUv-ghc7.10.1.so&quot;\n  loadModuleFromPath &quot;/srv/despierto/home/josejuan/Projects/Solveet/PluginSystem/SharedTypes.o&quot; Nothing\n\n  plugins &lt;- loadPlugins &quot;/srv/despierto/home/josejuan/Projects/Solveet/PluginSystem/plugins&quot;\n\n  forM_ plugins $ \\plugin -&gt; do\n    putStrLn $ &quot;Plugin name: &quot; ++ pluginName plugin\n    putStrLn $ &quot;     Run := &quot; ++ show (runPlugin plugin 34)\n</code></pre>\n<p><strong>Compilation and execution</strong></p>\n<pre><code>[josejuan@centella PluginSystem]$ ghc --make -dynamic -fPIC -O3 Plugin1.hs\n[1 of 2] Compiling SharedTypes      ( SharedTypes.hs, SharedTypes.o )\n[2 of 2] Compiling Plugin1          ( Plugin1.hs, Plugin1.o )\n[josejuan@centella PluginSystem]$ ghc --make -dynamic -fPIC -O3 Plugin2.hs\n[2 of 2] Compiling Plugin2          ( Plugin2.hs, Plugin2.o )\n[josejuan@centella PluginSystem]$ mv Plugin1.o plugins/Plugin1.plugin\n[josejuan@centella PluginSystem]$ mv Plugin2.o plugins/Plugin2.plugin\n[josejuan@centella PluginSystem]$ ghc --make -dynamic -fPIC -O3 app.hs\n[2 of 2] Compiling Main             ( app.hs, app.o )\nLinking app ...\n[josejuan@centella PluginSystem]$ ./app\nPlugin name: Plugin1\n     Run := 34\nPlugin name: Plugin2\n     Run := 68\n</code></pre>\n"}, {"tags": ["haskell", "leksah"], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1433576819, "post_id": 30680279, "comment_id": 49421379, "body": "Many thanks ! Is there a workaround ? Perhaps running a GHCi in a terminal ? Or just running the executable from a terminal ? Is there a conflict between running an external GHCi + Leksah on the same project ? Is that problematic in some way or does that (GHCi in terminal + Leksah) work on the same cabal project just fine ?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1433577619, "post_id": 30680279, "comment_id": 49421565, "body": "@jhegedus Have you actually tried doing that? I imagine firing up a terminal, running ghci and seeing if you get any issues has a quicker turnaround time than asking people on the internet."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433578344, "post_id": 30680279, "comment_id": 49421739, "body": "@Cubic I don&#39;t know for sure what works and conflicts with Leksah and what not. I could keep playing around with it for hours, or just get a simple answer from an expert. This answer can also help other people facing the same problem. I consider your comment unconstructive and  trolling."}, {"owner": {"reputation": 386, "user_id": 946152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900fe348fc542ba21bf84a69d552829b?s=128&d=identicon&r=PG", "display_name": "Hamish Mackenzie", "link": "https://stackoverflow.com/users/946152/hamish-mackenzie"}, "edited": false, "score": 0, "creation_date": 1433584131, "post_id": 30680279, "comment_id": 49423236, "body": "There are a couple of work arounds described in the answers to the question I linked to."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1433619396, "post_id": 30680279, "comment_id": 49433203, "body": "Thanks, I try, for now, I just use cabal repl. Seems to work fine, I hope it does not conflict with Leksah in some mysterious way behind the scenes."}], "tags": [], "owner": {"reputation": 386, "user_id": 946152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900fe348fc542ba21bf84a69d552829b?s=128&d=identicon&r=PG", "display_name": "Hamish Mackenzie", "link": "https://stackoverflow.com/users/946152/hamish-mackenzie"}, "is_accepted": true, "score": 3, "last_activity_date": 1433576570, "last_edit_date": 1495535411, "creation_date": 1433576570, "answer_id": 30680279, "question_id": 30680119, "link": "https://stackoverflow.com/questions/30680119/leksah-0-15-0-1-ghc-7-10-1-is-it-possible-to-pass-user-input-to-a-haskell-pro/30680279#30680279", "title": "Leksah 0.15.0.1, GHC 7.10.1 : Is it possible to pass user input to a Haskell program which is launched inside Leksah Haskell IDE? If yes, how?", "body": "<p>I am afraid little has changed since the <a href=\"https://stackoverflow.com/questions/7425184/using-leksah-debugger-with-programs-that-use-readln-and-similar\">last time this came up</a>.  You can now make a GHCJS app and run it in the Out pane.  It can include DOM input elements and handle DOM events.  StdIn input is still unsupported.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 1, "accepted_answer_id": 30680279, "answer_count": 1, "score": 1, "last_activity_date": 1433576570, "creation_date": 1433575357, "last_edit_date": 1433575945, "question_id": 30680119, "link": "https://stackoverflow.com/questions/30680119/leksah-0-15-0-1-ghc-7-10-1-is-it-possible-to-pass-user-input-to-a-haskell-pro", "title": "Leksah 0.15.0.1, GHC 7.10.1 : Is it possible to pass user input to a Haskell program which is launched inside Leksah Haskell IDE? If yes, how?", "body": "<p><strong>Question</strong> :</p>\n\n<p>Is it possible to run a program in Leksah and <strong>enter user input</strong> ? If yes, <strong>how</strong> ?</p>\n\n<p><strong>Reason for asking:</strong></p>\n\n<p>I tried <strong>two</strong> different ways to run a program in Leksah and enter user input and both ways <strong>failed</strong>:</p>\n\n<p><strong>First approach</strong> - running in normal mode (not GHCi) :</p>\n\n<p>Simply writing to console works fine :</p>\n\n<p><img src=\"https://i.stack.imgur.com/lsr4p.png\" alt=\"enter image description here\"></p>\n\n<p>However, Leksah hangs when I try to run the following program, asking for input :</p>\n\n<p><img src=\"https://i.stack.imgur.com/cltTp.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Second approach</strong> : using GHCi in Leksah.</p>\n\n<p>Evaluating <code>main2</code> works fine.\nEvaluating <code>main</code> hangs. It is not possible to enter input.</p>\n\n<p><img src=\"https://i.stack.imgur.com/3lYXA.png\" alt=\"enter image description here\"></p>\n\n<p>Any idea how one can enter user input when launching a program in Leksah ?</p>\n"}, {"tags": ["haskell", "configuration", "ghc", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1433565272, "post_id": 30677704, "comment_id": 49419170, "body": "A guess: perhaps they have <code>-j</code> or similar and you don&#39;t; or you have <code>-j1</code> or similar and they don&#39;t."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1433579890, "post_id": 30677704, "comment_id": 49422089, "body": "Probably they did the compile already and repeating it again ?"}, {"owner": {"reputation": 12771, "user_id": 83446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a534cad9b273de6c620b34687979e2a5?s=128&d=identicon&r=PG", "display_name": "Robert Massaioli", "link": "https://stackoverflow.com/users/83446/robert-massaioli"}, "edited": false, "score": 0, "creation_date": 1433595351, "post_id": 30677704, "comment_id": 49426275, "body": "This is doing a cabal clean first just like I have shown above. So no, this is not an issue of incremental compilation. The -j flag idea seems to be the most likely at the moment. It&#39;s a shame Tuesday is likely the first time I can get them to try again."}, {"owner": {"reputation": 12771, "user_id": 83446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a534cad9b273de6c620b34687979e2a5?s=128&d=identicon&r=PG", "display_name": "Robert Massaioli", "link": "https://stackoverflow.com/users/83446/robert-massaioli"}, "edited": false, "score": 0, "creation_date": 1433634157, "post_id": 30677704, "comment_id": 49436625, "body": "I&#39;m beginning to think that Daniel&#39;s suggestion is the right one. Will test out on Tuesday."}], "answers": [{"comments": [{"owner": {"reputation": 12771, "user_id": 83446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a534cad9b273de6c620b34687979e2a5?s=128&d=identicon&r=PG", "display_name": "Robert Massaioli", "link": "https://stackoverflow.com/users/83446/robert-massaioli"}, "edited": false, "score": 0, "creation_date": 1433595305, "post_id": 30681180, "comment_id": 49426265, "body": "Okay, I don&#39;t see the [X of Y] My.Module lines appearing in any of the log files in .cabal-sandbox/logs when I compile with -jx where x &gt;= 2. I see nothing appear in the app-name.log file and the builds.log file does not have much useful information either. Are you sure that the modules are logged to the log file when multi-processor compilation is on?"}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": false, "score": 3, "last_activity_date": 1433604688, "last_edit_date": 1433604688, "creation_date": 1433582967, "answer_id": 30681180, "question_id": 30677704, "link": "https://stackoverflow.com/questions/30677704/progress-messages-not-appearing-with-cabal-install-for-some-users/30681180#30681180", "title": "Progress messages not appearing with cabal install for some users", "body": "<p>When you run <code>cabal install</code> multithreaded (<code>-j2</code> and up), single file compilation does not appear on <code>stdout</code>, but should still be written to the log file.</p>\n"}, {"tags": [], "owner": {"reputation": 12771, "user_id": 83446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a534cad9b273de6c620b34687979e2a5?s=128&d=identicon&r=PG", "display_name": "Robert Massaioli", "link": "https://stackoverflow.com/users/83446/robert-massaioli"}, "is_accepted": true, "score": 1, "last_activity_date": 1433637937, "creation_date": 1433637937, "answer_id": 30688954, "question_id": 30677704, "link": "https://stackoverflow.com/questions/30677704/progress-messages-not-appearing-with-cabal-install-for-some-users/30688954#30688954", "title": "Progress messages not appearing with cabal install for some users", "body": "<p>Okay, I decided to just look at the source code and answer my own question. After diving through the cabal-install source code and ending up inside the GHC source I eventually found what I was looking for at the bottom of <a href=\"http://git.haskell.org/ghc.git/blob/HEAD:/compiler/main/HscMain.hs#l1710\" rel=\"nofollow\">compiler/main/HscMain.hs</a>:</p>\n\n<pre><code>showModuleIndex :: (Int, Int) -&gt; String\nshowModuleIndex (i,n) = \"[\" ++ padded ++ \" of \" ++ n_str ++ \"] \"\n  where\n    n_str = show n\n    i_str = show i\n    padded = replicate (length n_str - length i_str) ' ' ++ i_str\n</code></pre>\n\n<p>This is the method that prints the Module Index. It is used inside a function called <a href=\"http://git.haskell.org/ghc.git/blob/HEAD:/compiler/main/HscMain.hs#l708\" rel=\"nofollow\">batchMsg</a> which wraps it with a method called <a href=\"http://git.haskell.org/ghc.git/blob/HEAD:/compiler/main/ErrUtils.hs#l368\" rel=\"nofollow\">compilationProgressMessage</a>:</p>\n\n<pre><code>compilationProgressMsg :: DynFlags -&gt; String -&gt; IO ()\ncompilationProgressMsg dflags msg\n  = ifVerbose dflags 1 $\n    logOutput dflags defaultUserStyle (text msg)\n</code></pre>\n\n<p>As you can see this method only prints things to the log output filestream if the verbosity is one or higher.</p>\n\n<p>So I have just tried to do this in my terminal:</p>\n\n<pre><code>cabal install -j4 -v1\n</code></pre>\n\n<p>And then if I tail -f the .cabal-sandbox/logs/package-name.log file then I can see the module indexed compilation messages happening. I think that this solves this problem. Then, when the compilation finishes (or errors out) all of the module messages get printed to stdout. It seems that something is blocking print calls to stdout in parallel compilation in GHC. There is also something that sets the verbosity to 0 when you turn on parallel compilation. I think that both of these are bugs and should be fixed so I may go and try and raise feature requests now.</p>\n\n<p>At any rate I hope that this investigation helps somebody else too. Cheers and thanks for the pointers everybody!</p>\n"}], "owner": {"reputation": 12771, "user_id": 83446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a534cad9b273de6c620b34687979e2a5?s=128&d=identicon&r=PG", "display_name": "Robert Massaioli", "link": "https://stackoverflow.com/users/83446/robert-massaioli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 30688954, "answer_count": 2, "score": 3, "last_activity_date": 1433637937, "creation_date": 1433550716, "last_edit_date": 1433560211, "question_id": 30677704, "link": "https://stackoverflow.com/questions/30677704/progress-messages-not-appearing-with-cabal-install-for-some-users", "title": "Progress messages not appearing with cabal install for some users", "body": "<p>I'm working on a team project using Haskell and whenever I compile our project using 'cabal install' I start seeing the following:</p>\n\n<pre><code>$ cabal clean &amp;&amp; cabal install\ncleaning...\nResolving dependencies...\nConfiguring hackathon-0.1...\nBuilding hackathon-0.1...\nPreprocessing executable 'hackathon' for hackathon-0.1...\n[ 1 of 65] Compiling Data.MaybeUtil   ( src/Data/MaybeUtil.hs, dist/dist-sandbox-52369b17/build/hackathon/hackathon-tmp/Data/MaybeUtil.o )\n[ 2 of 65] Compiling Data.JQL         ( src/Data/JQL.hs, dist/dist-sandbox-52369b17/build/hackathon/hackathon-tmp/Data/JQL.o )\n[ 3 of 65] Compiling Data.Tuples      ( src/Data/Tuples.hs, dist/dist-sandbox-52369b17/build/hackathon/hackathon-tmp/Data/Tuples.o )\n...\n$\n</code></pre>\n\n<p>However, my team members see:</p>\n\n<pre><code>$ cabal clean &amp;&amp; cabal install\ncleaning...\nResolving dependencies...\nConfiguring hackathon-0.1...\nBuilding hackathon-0.1...\nInstalled hackathon-0.1\n</code></pre>\n\n<p>What is different in their configuration that they don't see all of the \"Progress\" messages that start with [X of N] My.Module?</p>\n\n<p>I would really like them to be able to see the progress of the compilation as it is happening as our project is quite large and currently has 65 modules and growing. Cheers!</p>\n"}, {"tags": ["json", "list", "object", "haskell", "aeson"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1433551685, "post_id": 30677563, "comment_id": 49416998, "body": "Let statements in Haskell require a body over which the let-binding will have scope. The syntax is <code>let &lt;var&gt; = &lt;expr&gt; in &lt;expr&gt;</code>, ie, the <code>in</code> is mandatory. Try <code>let newlist = ... in print newlist</code>."}, {"owner": {"reputation": 7, "user_id": 4884587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5629311f7ef9d462d004fe2463b491f1?s=128&d=identicon&r=PG&f=1", "display_name": "Julio Cesar", "link": "https://stackoverflow.com/users/4884587/julio-cesar"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433561168, "post_id": 30677563, "comment_id": 49418499, "body": "@user2407038 thanks, this solution worked. now i have to use this list to do a new consult in json with each element, there any way to make this list be global?"}], "owner": {"reputation": 7, "user_id": 4884587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5629311f7ef9d462d004fe2463b491f1?s=128&d=identicon&r=PG&f=1", "display_name": "Julio Cesar", "link": "https://stackoverflow.com/users/4884587/julio-cesar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1433549488, "creation_date": 1433549488, "question_id": 30677563, "link": "https://stackoverflow.com/questions/30677563/how-to-access-a-element-from-json-and-create-a-new-list-with-this-element-in-has", "title": "how to access a element from JSON and create a new list with this element in haskell", "body": "<p>I have this data structure to take the result from a JSON in Haskell, with aeson</p>\n\n<p>From this URL: <a href=\"http://fipeapi.appspot.com/api/1/carros/marcas.json\" rel=\"nofollow\">http://fipeapi.appspot.com/api/1/carros/marcas.json</a></p>\n\n<pre><code>data Marca =\n  Marca { keyM  :: String\n         , idM   :: Int\n         , fipe_nameM        :: String\n         , nameM :: String\n           } deriving Show\n\ninstance FromJSON Marca where \n    parseJSON (Object m) =\n        Marca &lt;$&gt; m .: \"key\"\n              &lt;*&gt; m .: \"id\"\n              &lt;*&gt; m .: \"fipe_name\"\n              &lt;*&gt; m .: \"name\"\n    parseJSON _= mzero\n</code></pre>\n\n<p>This is working fine and i stored the result in a list of \"Marca\" named \"ps\"</p>\n\n<pre><code>main :: IO ()\nmain = do\n    d &lt;- (eitherDecode &lt;$&gt; getJSON) :: IO (Either String [Marca])\n    case d of\n        Left err -&gt; putStrLn err \n        Right ps -&gt; print ps\n    return();\n</code></pre>\n\n<p>Now i have to create a list of Int from this \"ps\" with all \"idM\" from each \"Marca\", but i don't know how to do this, i try some things like:</p>\n\n<pre><code>Right ps -&gt; let newlist = [idM x | x &lt;- ps]\nRight ps -&gt; let newlist = [idM x | x &lt;- [Marca]]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>Right ps -&gt; let newlist = map (idM x) ps\nRight ps -&gt; let newlist = map (idM x) [Marca]\n</code></pre>\n\n<p>But it did not work.</p>\n"}, {"tags": ["haskell", "haskell-platform"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433551337, "post_id": 30677129, "comment_id": 49416942, "body": "Use the executable field of the cabal file? The <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html\" rel=\"nofollow noreferrer\">cabal user guide</a> is very good for this sort of information."}], "answers": [{"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": true, "score": 1, "last_activity_date": 1433733440, "creation_date": 1433733440, "answer_id": 30700797, "question_id": 30677129, "link": "https://stackoverflow.com/questions/30677129/how-to-package-a-haskell-application/30700797#30700797", "title": "How to package a Haskell application?", "body": "<p>Just run <code>cabal build</code>, it links statically by default.</p>\n"}], "owner": {"reputation": 450, "user_id": 1255211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8653afc9d08839cea2052f95fc8c006c?s=128&d=identicon&r=PG", "display_name": "Tombert", "link": "https://stackoverflow.com/users/1255211/tombert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 1, "accepted_answer_id": 30700797, "answer_count": 1, "score": 1, "last_activity_date": 1433733440, "creation_date": 1433545840, "question_id": 30677129, "link": "https://stackoverflow.com/questions/30677129/how-to-package-a-haskell-application", "title": "How to package a Haskell application?", "body": "<p>I have written a piece of code that I would like to create a binary and distribute to other folks without having them go through the rigmarole of setting up the Haskell platform and cabal.  Is there a way to statically link the binary in a <code>cabal build</code>?  </p>\n"}, {"tags": ["performance", "parsing", "haskell", "memory-leaks"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433545087, "post_id": 30676243, "comment_id": 49415608, "body": "&quot;36M obj file&quot; is not that helpful (are the coordinates like <code>1</code> or <code>0.0123456789</code>); roughly how many vertices, normals and faces do you have?"}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433545216, "post_id": 30676243, "comment_id": 49415644, "body": "@ReidBarton: 177277 vertices, 489750 normals, 127769 faces. All vertex coordinates/normals are specified as doubles - -45.440701 to pick a random example. Everything seems to have that precision."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 5, "creation_date": 1433547702, "post_id": 30676243, "comment_id": 49416264, "body": "So just accounting for the size of the data structure you want to build (10 words for a <code>V3 Double</code>, 23 words for a <code>V2 (V3 Int)</code>, ~3 words per element of a <code>Seq</code>), we&#39;re at around 96-122 MB (depending on how many of your faces are square), plus 76 MB for the input (since you&#39;re using Text), and so we&#39;ve accounted for over half the max residency already. A heap profile by closure description (<code>-hd</code>) might help you see if there&#39;s any unevaluated stuff lying around as well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433567624, "post_id": 30676243, "comment_id": 49419537, "body": "One approach that can work in some situations is to refrain from parsing the whole file as one value. This will probably only help if you have the means to use the lines incrementally, and if you have a way to deal with a parse failure should it occur after you&#39;ve already sent some lines on for further processing/action. I&#39;m not familiar with your particular problem domain."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1433600769, "post_id": 30676243, "comment_id": 49427814, "body": "This will likely have negligible effects, but what happens if you change <code>vertex &lt;|&gt; normal</code> into <code>(char &#39;v&#39; *&gt; (vertex &lt;|&gt; normal))</code> and the first lines of <code>vertex</code> and <code>normal</code> into <code>char &#39; &#39;</code> and <code>char &#39;n&#39;</code> respectively? It will avoid a small amout of backtraking when encountering a &quot;vn&quot;."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1433602273, "post_id": 30676243, "comment_id": 49428251, "body": "does <code>V3</code> have strict fields? It might also help to just use attoparsec for <code>parseLine</code> so you can stream input lines, and don&#39;t need to retain the whole file in memory for attoparsec&#39;s backtracking. And I&#39;m confused by your heap profile which mentions an <code>mappend</code> called in <code>parseLine.v3</code>"}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433619193, "post_id": 30676243, "comment_id": 49433154, "body": "@ReidBarton Something seems suspect there, because the original file <i>in ASCII</i> contains exactly the same information, yet that&#39;s 36mb! So somehow a more efficient binary encoding is triple the size... I&#39;m not sure what I&#39;m missing."}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433619590, "post_id": 30676243, "comment_id": 49433251, "body": "@ReidBarton Oh, I got it. We were interpreting as megabits, not megabytes. By my calculations <a href=\"http://www.wolframalpha.com/input/?i=177277+\" rel=\"nofollow noreferrer\">wolframalpha.com/input/?i=177277+</a>*+10+%2B+489750+*+10+%2B+12&zwnj;&#8203;7769+*+23+bytes+in+m&zwnj;&#8203;egabytes I should be use 9MB of space, so something is definitely going wrong!"}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1433620799, "post_id": 30676243, "comment_id": 49433579, "body": "@jberryman I&#39;m using this V3 definition: <a href=\"https://hackage.haskell.org/package/linear-1.18.1.1/docs/Linear-V3.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/linear-1.18.1.1/docs/Linear-V3.h&zwnj;&#8203;tml</a>. It&#39;s strict. I tried defining one specialised to Double and using {-# UNPACK #-} but it makes barely a dent."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433621752, "post_id": 30676243, "comment_id": 49433838, "body": "What more efficient binary encoding? :) I&#39;m counting in words (= 8 bytes), no bits anywhere. <code>Double#</code> is one word = 8 bytes which is not very much more efficient than ASCII <code>&quot;-45.440701 &quot;</code> = 11 bytes. Add in one <code>D#</code> constructor and one <code>V3</code> pointer field per <code>Double#</code> and a little more for the <code>Seq</code> structure and then you&#39;re in the ballpark of triple the input file size. Using a <code>data D3 = D3 !Double !Double !Double</code> should certainly help a lot if your goal is to reduce space usage..."}], "answers": [{"comments": [{"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 1, "creation_date": 1433795058, "post_id": 30710584, "comment_id": 49494361, "body": "This could work, and I need to try and benchmark it. For now, I&#39;ve dropped attoparsec entirely and just built a little State parser using bytestring-lexing, which parses in 500ms - vastly better than anything I could achieve with attoparsec. I&#39;ll see if the line based one is in the same ballpark, but I think the Double parser may be much slower."}], "tags": [], "owner": {"reputation": 897, "user_id": 1755520, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mqzKa.jpg?s=128&g=1", "display_name": "bartavelle", "link": "https://stackoverflow.com/users/1755520/bartavelle"}, "is_accepted": false, "score": 1, "last_activity_date": 1433770517, "creation_date": 1433770517, "answer_id": 30710584, "question_id": 30676243, "link": "https://stackoverflow.com/questions/30676243/what-is-causing-my-wavefront-obj-parser-to-consume-10x-more-memory-than-the-inpu/30710584#30710584", "title": "What is causing my Wavefront Obj parser to consume 10x more memory than the input?", "body": "<p>In my experience, the answer to line based formats parsing is to use <code>BS.lines</code> and <code>BS.words</code> from <code>Data.ByteString.Char8</code>. It isn't really pretty, but no parser combinator approach while be quite as fast or memory efficient. Something like :</p>\n\n<pre><code>parseLine :: BS.ByteString -&gt; [Either Xxx Obj]\nparseLine = map prs . BS.lines\n\nprs :: BS.ByteString -&gt; Either Xxx Obj\nprs l = case BS.words l of\n         [\"v\", x, y, z] -&gt; do\n             v &lt;- V3 &lt;$&gt; parseDouble x &lt;*&gt; parseDouble y &lt;*&gt; parseDouble z\n             return $ Obj (Seq.singleton v) mempty mempty\n         ...\n         _ -&gt; Left \"blah\"\n</code></pre>\n\n<p>That's for performance. For memory usage you'll probably want to use primitive vectors, and unpacked data types generally. It doesn't seem to be the case in your example, but you also need to check how the libraries you are using implement their data types. For example <code>UTCTime</code> from the <code>time</code> package uses a <em>lot</em> of memory.</p>\n\n<p>Final tip: I usually parameter my data types with the type of \"string\" that they use. My parser functions return <code>Foo ByteString</code>, and I convert to <code>Foo Text</code> the subset that I will keep in memory and manipulate.</p>\n"}, {"comments": [{"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 0, "creation_date": 1433795080, "post_id": 30713078, "comment_id": 49494372, "body": "Thanks, you could be on to something here! I&#39;ll try and get a new benchmark done with this approach, and will see what the difference is."}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 2, "last_activity_date": 1433776868, "creation_date": 1433776868, "answer_id": 30713078, "question_id": 30676243, "link": "https://stackoverflow.com/questions/30676243/what-is-causing-my-wavefront-obj-parser-to-consume-10x-more-memory-than-the-inpu/30713078#30713078", "title": "What is causing my Wavefront Obj parser to consume 10x more memory than the input?", "body": "<p>I believe your problem is in the definition of <code>Obj</code>:</p>\n\n<pre><code>data Obj =\n  Obj {objVertices :: !(Seq (V3 Double))\n      ,objNormals :: !(Seq (V3 Double))\n      ,objFaces :: !(Seq (V2 (V3 Int)))}\n  deriving (Show)\n</code></pre>\n\n<p>Within your parser you only ever use one of the three fields, but you evaluate to WHNF and allocate space for an empty sequence for each <code>Obj</code>  This will almost triple the space of an <code>Obj</code> in memory compared to its size in a flat text file.  You also always have a <code>Seq.singleton</code> instance (also evaluated to WHNF) for every element.  You are paying a price in time and memory for this.</p>\n\n<p>You may say, \"But all my time is spent in <code>v3</code>,\" and you would be correct.  However all that time is spent in the allocation of memory, which (I think?) includes the cost of running the garbage collector. Statistically you are most likely to catch GC cycles where you do the most allocation.</p>\n\n<p><strong>My suggestions:</strong></p>\n\n<ul>\n<li>See what happens if you take the strictness out of <code>Obj</code> it may not work as a complete solution, but it will show you if that is the problem for the cost of deleting three <code>!</code>.  If I'm wrong you've lost very little.</li>\n<li>Convert <code>Obj</code> to a sum type instead of a product type.</li>\n<li>Use a more conventional parser.  Parsec is awesome when it comes to clean express ability and the complexity of the grammars it can handle, but is just not in the same class perfromance-wise as other more limited parsing techniques.</li>\n</ul>\n\n<p><strong>Possible Sum Type for <code>Obj</code></strong>:</p>\n\n<pre><code>data Obj =\n    Empty \n  | Vertex (V3 Double)\n  | Normal (V3 Double)\n  | Face   (V2 (V3 Int))\n  | Obj {objVertices :: !(Seq (V3 Double))\n        ,objNormals  :: !(Seq (V3 Double))\n        ,objFaces    :: !(Seq (V2 (V3 Int)))}\n\nInstance Monoid Obj where\n  mempty = Empty\n  mappend Empty x = x\n  mappend x Empty = x\n  mappend (Face v) (obj@Obj{objFaces = vs}) = obj{objFaces = v&lt;|vs}\n  mappend (obj@Obj{objFaces = vs}) (Face v) = obj{objFaces = vs |&gt; v}\n  ...\n</code></pre>\n"}], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 4, "answer_count": 2, "score": 10, "last_activity_date": 1433776868, "creation_date": 1433540376, "question_id": 30676243, "link": "https://stackoverflow.com/questions/30676243/what-is-causing-my-wavefront-obj-parser-to-consume-10x-more-memory-than-the-inpu", "title": "What is causing my Wavefront Obj parser to consume 10x more memory than the input?", "body": "<p>I'm trying to write a parser for the <a href=\"https://en.wikipedia.org/wiki/Wavefront_.obj_file\">Wavefront <code>.obj</code> file format</a>, which is a really dumb line based format. Hopefully that wikipedia article should summarise how it works, but essentially you have lines that record entries in vertex, normal and other arrays. Finally, a face definition is a triple (or more) of indices into these separate arrays. </p>\n\n<p>My parser is</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n{-# LANGUAGE OverloadedStrings #-}\nmodule WavefrontObj where\n\nimport Control.Applicative\nimport Data.Attoparsec.Text\nimport Data.Foldable (toList)\nimport Data.List (foldl')\nimport Data.List.Split\nimport Data.Monoid\nimport Data.NonEmpty ((!:))\nimport Data.Sequence (Seq)\nimport Geometry\nimport Graphics.GL\nimport Linear\nimport Linear.Affine\nimport qualified Data.Sequence as Seq\n\ndata Obj =\n  Obj {objVertices :: !(Seq (V3 Double))\n      ,objNormals :: !(Seq (V3 Double))\n      ,objFaces :: !(Seq (V2 (V3 Int)))}\n  deriving (Show)\n\ninstance Monoid Obj where\n  mempty = Obj mempty mempty mempty\n  Obj a b c `mappend` Obj x y z =\n    Obj (a &lt;&gt; x)\n        (b &lt;&gt; y)\n        (c &lt;&gt; z)\n\nparseLine :: Parser Obj\nparseLine =\n  vertex &lt;|&gt; normal &lt;|&gt; face &lt;|&gt;\n  (mempty &lt;$ skipWhile (not . isEndOfLine))\n  where vertex =\n          do string \"v\"\n             skipSpace\n             v &lt;- v3\n             return $!\n               Obj (Seq.singleton v) mempty mempty\n        normal =\n          do string \"vn\"\n             skipSpace\n             v &lt;- v3\n             return $!\n               Obj mempty (Seq.singleton v) mempty\n        face =\n          do string \"f\"\n             skipSpace\n             let v =\n                   (,) &lt;$&gt; decimal &lt;* char '/' &lt;* decimal &lt;* char '/' &lt;*&gt; decimal\n             (v1,n1) &lt;- v\n             skipSpace\n             (v2,n2) &lt;- v\n             skipSpace\n             (v3,n3) &lt;- v\n             mv4 &lt;-\n               optional (do skipSpace\n                            v)\n             return $!\n               Obj mempty\n                   mempty\n                   (Seq.singleton\n                      (V2 (V3 v1 v2 v3)\n                          (V3 n1 n2 n3)) &lt;&gt;\n                    case mv4 of\n                      Just (v4,n4) -&gt;\n                        Seq.singleton\n                          (V2 (V3 v1 v3 v4)\n                              (V3 n1 n3 n4))\n                      Nothing -&gt; mempty)\n        v3 =\n          do x &lt;- double\n             skipSpace\n             y &lt;- double\n             skipSpace\n             z &lt;- double\n             return $! V3 x y z\n\nparseObj :: Parser Obj\nparseObj = go mempty\n  where go !acc =\n          do !l &lt;- parseLine\n             acc' &lt;- return $! acc &lt;&gt; l\n             endOfLine *&gt; go acc' &lt;|&gt; acc' &lt;$ endOfInput\n</code></pre>\n\n<p>Running this with a 36MB obj file parses sucessfully, but</p>\n\n<pre><code>  21,342,866,200 bytes allocated in the heap\n   1,263,590,520 bytes copied during GC\n     290,617,624 bytes maximum residency (10 sample(s))\n      56,958,112 bytes maximum slop\n             547 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     41177 colls,     0 par    0.711s   0.708s     0.0000s    0.0008s\n  Gen  1        10 colls,     0 par    0.241s   0.241s     0.0241s    0.1669s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    5.071s  (  5.077s elapsed)\n  GC      time    0.952s  (  0.949s elapsed)\n  RP      time    0.000s  (  0.000s elapsed)\n  PROF    time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.020s  (  0.020s elapsed)\n  Total   time    6.055s  (  6.046s elapsed)\n\n  %GC     time      15.7%  (15.7% elapsed)\n\n  Alloc rate    4,208,709,362 bytes per MUT second\n\n  Productivity  84.3% of total user, 84.4% of total elapsed\n</code></pre>\n\n<p>While the productivity is good, 6 seconds to open an <code>.obj</code> file with 547MB total memory usage seems excessive. I've uploaded a heap profile <a href=\"http://heap.ezyang.com/view/50abaafd809e47fd1e50b4f261b539099722c9ab\">here</a>. The <code>.prof</code> file is</p>\n\n<pre><code>    Fri Jun  5 22:36 2015 Time and Allocation Profiling Report  (Final)\n\n       Deferred +RTS -p -RTS\n\n    total time  =        5.17 secs   (5173 ticks @ 1000 us, 1 processor)\n    total alloc = 13,142,553,520 bytes  (excludes profiling overheads)\n\nCOST CENTRE      MODULE                %time %alloc\n\nparseLine.v3     WavefrontObj           69.8   69.5\nparseLine.face.v WavefrontObj            8.4   13.7\nparseLine.face   WavefrontObj            7.0    6.1\ntimeLog          Deferred                3.3    1.2\nparseLine        WavefrontObj            2.8    1.7\nparseLine.normal WavefrontObj            2.5    3.6\nreadTextDevice   Data.Text.Internal.IO   2.2    0.1\nparseLine.vertex WavefrontObj            1.7    2.6\nmappend          WavefrontObj            1.4    1.1\n\n\n                                                                           individual     inherited\nCOST CENTRE              MODULE                          no.     entries  %time %alloc   %time %alloc\n\nMAIN                     MAIN                             85           0    0.0    0.0   100.0  100.0\n main                    Deferred                        171           0    0.0    0.0   100.0  100.0\n  timeLog                Deferred                        173           0    3.3    1.2   100.0  100.0\n   parseObj              WavefrontObj                    178           0    0.0    0.0    94.4   98.7\n    parseObj.go          WavefrontObj                    179     1080806    0.6    0.5    94.4   98.7\n     parseLine           WavefrontObj                    181           0    2.8    1.7    93.8   98.2\n      parseLine.v3       WavefrontObj                    190           0   69.7   69.5    70.8   70.3\n       mappend           WavefrontObj                    191      667027    1.0    0.8     1.0    0.8\n      parseLine.face     WavefrontObj                    187           0    7.0    6.1    16.9   21.3\n       parseLine.face.v  WavefrontObj                    195           0    8.4   13.7     9.7   15.2\n        parseLine.normal WavefrontObj                    196           0    0.9    1.3     1.2    1.5\n         mappend         WavefrontObj                    197      127769    0.3    0.3     0.3    0.3\n       parseLine.normal  WavefrontObj                    193           0    0.0    0.0     0.0    0.0\n       mappend           WavefrontObj                    188      286011    0.1    0.0     0.1    0.0\n      parseLine.normal   WavefrontObj                    185           0    1.5    2.3     1.6    2.3\n       parseLine.v3      WavefrontObj                    192           0    0.1    0.0     0.1    0.0\n      parseLine.vertex   WavefrontObj                    183           0    1.7    2.6     1.7    2.6\n   readTextDevice        Data.Text.Internal.IO           174       18260    2.2    0.1     2.2    0.1\n CAF                     Deferred                        169           0    0.0    0.0     0.0    0.0\n  main                   Deferred                        170           1    0.0    0.0     0.0    0.0\n   timeLog               Deferred                        172           1    0.0    0.0     0.0    0.0\n CAF                     WavefrontObj                    166           0    0.0    0.0     0.0    0.0\n  parseLine              WavefrontObj                    180           1    0.0    0.0     0.0    0.0\n   parseLine.v3          WavefrontObj                    189           1    0.0    0.0     0.0    0.0\n   parseLine.face        WavefrontObj                    186           1    0.0    0.0     0.0    0.0\n    parseLine.face.v     WavefrontObj                    194           1    0.0    0.0     0.0    0.0\n   parseLine.normal      WavefrontObj                    184           1    0.0    0.0     0.0    0.0\n   parseLine.vertex      WavefrontObj                    182           1    0.0    0.0     0.0    0.0\n  mempty                 WavefrontObj                    176           1    0.0    0.0     0.0    0.0\n  parseObj               WavefrontObj                    175           1    0.0    0.0     0.0    0.0\n   parseObj.go           WavefrontObj                    177           1    0.0    0.0     0.0    0.0\n CAF                     Data.Attoparsec.Text.Internal   153           0    0.0    0.0     0.0    0.0\n CAF                     Data.Scientific                 152           0    0.0    0.0     0.0    0.0\n CAF                     Data.Text.Array                 150           0    0.0    0.0     0.0    0.0\n CAF                     Data.Text.Internal              148           0    0.0    0.0     0.0    0.0\n CAF                     GHC.Err                         135           0    0.0    0.0     0.0    0.0\n CAF                     GHC.IO.Handle.FD                132           0    0.0    0.0     0.0    0.0\n CAF                     GHC.IO.Handle.Internals         131           0    0.0    0.0     0.0    0.0\n CAF                     GHC.Conc.Signal                 125           0    0.0    0.0     0.0    0.0\n CAF                     GHC.IO.Encoding                 121           0    0.0    0.0     0.0    0.0\n CAF                     GHC.IO.FD                       120           0    0.0    0.0     0.0    0.0\n CAF                     GHC.Conc.Sync                   108           0    0.0    0.0     0.0    0.0\n CAF                     GHC.IO.Encoding.Iconv           106           0    0.0    0.0     0.0    0.0\n CAF                     GHC.Integer.Type                 92           0    0.0    0.0     0.0    0.0\n</code></pre>\n\n<p>I have a guess that seeing as my hotspot is the <code>v3</code> parser, this might just be something to do with using the <code>double</code> parser.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 8, "last_activity_date": 1433543376, "last_edit_date": 1433543376, "creation_date": 1433539137, "answer_id": 30675984, "question_id": 30675922, "link": "https://stackoverflow.com/questions/30675922/accessing-the-property-of-a-data-type/30675984#30675984", "title": "accessing the property of a data type", "body": "<p>Note that <code>name</code> is a function you get for free from Record syntax. You can see it's type in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; :t name\nname :: Person -&gt; String\n</code></pre>\n\n<p>You are getting an error because you are trying to apply <code>++</code> function to a function named <code>name</code> instead of a <code>String</code>. So your code should be like this:</p>\n\n<pre><code>greet :: Person -&gt; String -&gt; String\ngreet person lastName = \"Hi my name is \" ++ name person ++ \", last name: \" ++ lastName\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1433546135, "post_id": 30676682, "comment_id": 49415888, "body": "What is RecordWildCards?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1433600502, "post_id": 30676682, "comment_id": 49427735, "body": "@dopatraman It is what is known as a language extension. These are pieces of syntax or behavior in addition to the Haskell language specification. They are compiler specific, but GHC supports a fair number. Some of these assist in writing bindings to C libraries, some for more advanced type system features, and some for expanding syntax, such as the one above. For example, to allow for string literals to also act as <code>Text</code> or <code>ByteString</code>, you can use the <code>OverloadedStrings</code> extension. There are a lot of them out there that are fun and useful, but you&#39;ll come across them as you learn Haskell."}], "tags": [], "owner": {"reputation": 1003, "user_id": 218307, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71349c1b606c549215197f7ec55e2276?s=128&d=identicon&r=PG", "display_name": "jhickner", "link": "https://stackoverflow.com/users/218307/jhickner"}, "is_accepted": false, "score": 4, "last_activity_date": 1433542998, "creation_date": 1433542998, "answer_id": 30676682, "question_id": 30675922, "link": "https://stackoverflow.com/questions/30675922/accessing-the-property-of-a-data-type/30676682#30676682", "title": "accessing the property of a data type", "body": "<p>@Sibi's answer is correct, but with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#record-wildcards\" rel=\"nofollow\"><code>RecordWildCards</code></a> you can get close to your original:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n\ndata Person = Person {name :: String}\n\ngreet :: Person -&gt; String -&gt; String\ngreet Person{..} lastName = \n    \"Hi my name is \" ++ name ++ \", last name: \" ++ lastName\n</code></pre>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 30675984, "answer_count": 2, "score": 1, "last_activity_date": 1433543376, "creation_date": 1433538863, "question_id": 30675922, "link": "https://stackoverflow.com/questions/30675922/accessing-the-property-of-a-data-type", "title": "accessing the property of a data type", "body": "<p>Here is my code:</p>\n\n<pre><code>data Person = Person {name :: String}\n\ngreet :: Person -&gt; String -&gt; String\ngreet person lastName = \n  \"Hi my name is \" ++ name ++ \", last name: \" ++ lastName\n</code></pre>\n\n<p>This is my interpretation of what I've written here: There is a data type <code>Person</code> for which there exists a method <code>name</code> that returns a string.</p>\n\n<p>There also exists a function <code>greet</code> which takes in a <code>Person</code> and a <code>String</code> and returns a different <code>String</code>. However, the greet method calls the <code>name</code> method of the <code>Person</code> data type to concatenate this string. </p>\n\n<p>However when I compile this code, I get this error:</p>\n\n<pre><code>Couldn't match expected type `[Char]' with actual type `Person -&gt; String' \n</code></pre>\n\n<p>Why is this happening?</p>\n"}, {"tags": ["haskell", "io", "handle"], "answers": [{"comments": [{"owner": {"reputation": 1423, "user_id": 1176650, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/256809dae4d6852f34fefbc7981c1581?s=128&d=identicon&r=PG", "display_name": "Ein", "link": "https://stackoverflow.com/users/1176650/ein"}, "edited": false, "score": 0, "creation_date": 1433591292, "post_id": 30676124, "comment_id": 49425191, "body": "This is the solution I was hoping for.  It is worth noting for the &#39;frequent writes into a log file&#39; situation that <code>hSetFileSize hdl n</code> seems to be faster if <code>n</code> is small but not zero"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1433539769, "creation_date": 1433539769, "answer_id": 30676124, "question_id": 30675795, "link": "https://stackoverflow.com/questions/30675795/haskell-clear-file-contents-using-an-open-handle/30676124#30676124", "title": "Haskell: Clear file contents using an open handle", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#v:hSetFileSize\"><code>hSetFileSize</code></a> to truncate a file to a given size.</p>\n"}], "owner": {"reputation": 1423, "user_id": 1176650, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/256809dae4d6852f34fefbc7981c1581?s=128&d=identicon&r=PG", "display_name": "Ein", "link": "https://stackoverflow.com/users/1176650/ein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 30676124, "answer_count": 1, "score": 2, "last_activity_date": 1433539769, "creation_date": 1433538360, "last_edit_date": 1495542601, "question_id": 30675795, "link": "https://stackoverflow.com/questions/30675795/haskell-clear-file-contents-using-an-open-handle", "title": "Haskell: Clear file contents using an open handle", "body": "<p>In Haskell, how can one clear a file's contents when you already have an open file handle and do not wish to close it?  Is there some easy way that isn't apparent to me from the System.IO API?</p>\n\n<p>In a less restrictive situation, the easiest way to clear a file's contents is with <code>writeFile awesomefile.txt \"\"</code>.  If you already have an open file handle to <code>awesomefile.txt</code> though, then <code>writeFile</code> will fail with an exception (namely \"openFile: resource busy (file is locked)\").</p>\n\n<p>I thought perhaps using <code>hSeek</code> to set the handle back to the start position might have a similiar effect, but it doesn't.  After seeking the handle back to the start, the next <code>hPutStr</code> call will just overwrite as many bytes as necessary (which makes more logical sense anyway).</p>\n\n<p>The situation comes up in my program where I want to very frequently write information to a file for logging purposes.  Only the most recent log data is relevant (and gigantic files are very inconvenient), so the file is emptied before each write.  Because writes are so frequent, I would like to only open the file handle once.  </p>\n\n<p>only related question:<br>\n<a href=\"https://stackoverflow.com/questions/20062595/clear-file-contents-in-haskell-language\">Clear file contents in haskell language</a></p>\n"}, {"tags": ["haskell", "parallel-processing", "ghc"], "owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1433530441, "creation_date": 1433530441, "question_id": 30673814, "link": "https://stackoverflow.com/questions/30673814/understanding-result-of-parbuffer-based-strategy-run", "title": "Understanding result of parBuffer-based strategy run", "body": "<p>I want to understand Haskell Evaluation Strategies, and found the <code>parBuffer</code> concept very interesting. So I created a dumb slow function that calculates factorials, and tried to create a parallel version of it.</p>\n\n<p>Consider the code below</p>\n\n<pre><code>module Main where\n\nimport System.Environment\nimport Control.Parallel.Strategies\n\nfac :: Int -&gt; Int\nfac n\n    | n &lt;= 1 = 1\n    | otherwise = n * fac (n-1)\n\n-- sequential version\nfacsum :: Int -&gt; Int\nfacsum n = sum $ map fac [1..n]\n\nfacsum_par :: Int -&gt; Int\nfacsum_par n = sum lst  where\n    lst = (map fac [1..n]) `using` parBuffer 50 rseq\n\nmain :: IO ()\nmain = do args &lt;- getArgs \n          let (n:_) = args \n          print (facsum_par $ read n)\n</code></pre>\n\n<p>I would have expected, that the parBuffer would create bunches of 50 sparks, but the statistics for *n = 9000, and -N2 I get the output</p>\n\n<blockquote>\n  <p>SPARKS: 9000 (8277 converted, 688 overflowed, 0 dud, 1 GC'd, 34 fizzled)</p>\n</blockquote>\n\n<p>Why are there overflowed sparks? As far as I understand this only happens if the amount of sparks would be larger than the size of the spark pool, but should this be limited to 50?</p>\n\n<p>Why are there 34 fizzled sparks, is it only for the small, fast-calculating inputs?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433528374, "post_id": 30673231, "comment_id": 49408370, "body": "hmmm, it might be possible with template haskell, but really if you&#39;re going to derive all possible instances you&#39;d be better off just using a <code>type</code> alias instead."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1433528554, "post_id": 30673231, "comment_id": 49408487, "body": "If the data type is purely internal to your software... just add to the <code>deriving (...)</code> clause as needed."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1433528680, "post_id": 30673231, "comment_id": 49408558, "body": "@bheklilr I think <code>type</code> not prevent mix types. @rampion, yes but is a bit annoying (not much, really)."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433528844, "post_id": 30673231, "comment_id": 49408653, "body": "@josejuan If your <code>Foo</code> is identical to an <code>Int</code> in every way, except that it&#39;s wrapped in an additional constructor, then why do you need <code>Foo</code> to be separate?  What do you gain from making that distinction?   If you need to control what values are valid for <code>Foo</code>, then use a smart constructor and manually define the <code>Num</code> instance.  Otherwise the user won&#39;t know any difference between <code>doSomething 1 2</code> and <code>doSomething (Foo 1) (Foo 2)</code>, they&#39;ll behave the same."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1433529082, "post_id": 30673231, "comment_id": 49408775, "body": "@bheklilr <code>Adults</code> and <code>Children</code> are all equals except one are <code>Adults</code> and the other one <code>Children</code>. But I don&#39;t like mix <code>processBook children adults</code> (when is <code>processBook adults children</code>)."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433529428, "post_id": 30673231, "comment_id": 49408936, "body": "@josejuan then I think you&#39;re out of luck, you&#39;re going to have to specify all the instances you want, or define them manually for each type."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433537682, "post_id": 30673231, "comment_id": 49413088, "body": "Can you say exactly what differs between this question and the one you linked to?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433582834, "post_id": 30673231, "comment_id": 49422847, "body": "@DanielWagner he has not solution to their problem &quot;I&#39;d like to write deriving hiding (Special)&quot; I only wish some automatic way to derive all possible instances (instead write at hand)"}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1433528227, "creation_date": 1433528227, "last_edit_date": 1495542336, "question_id": 30673231, "link": "https://stackoverflow.com/questions/30673231/automatic-instance-derivation-using-newtype", "title": "Automatic instance derivation using newtype", "body": "<p>(Related question <a href=\"https://stackoverflow.com/questions/12665779/even-more-generalized-newtype-deriving\">Even more generalized newtype deriving</a>)</p>\n\n<p>I like wrap types</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\nnewtype Foo = Foo { unFoo :: Int } deriving (Eq, Ord, Enum, Real, Num, Read, Integral, Show)\nnewtype Var = Var { unVar :: Int } deriving (Eq, Ord, Enum, Real, Num, Read, Integral, Show)\n</code></pre>\n\n<p>to prevent</p>\n\n<pre><code>doSomething :: Int -&gt; Int -&gt; Int\ndoSomething someFoo otherVar\n</code></pre>\n\n<p><strong>Is possible derive automatically all possible instances?</strong></p>\n\n<p>(It's not recommended?, Exists a better way?)</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1433540364, "post_id": 30672098, "comment_id": 49414185, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/8041813/how-to-find-the-number-of-cores-at-runtime-in-haskell\">How to find the number of cores at runtime in Haskell</a>"}, {"owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1433663860, "post_id": 30672098, "comment_id": 49441496, "body": "@jberryman please see my edit above"}], "answers": [{"comments": [{"owner": {"reputation": 2413, "user_id": 4779472, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh5.googleusercontent.com/-918sSljPOLU/AAAAAAAAAAI/AAAAAAAAABA/JrpaeNI9JiM/photo.jpg?sz=128", "display_name": "Rohit Gupta", "link": "https://stackoverflow.com/users/4779472/rohit-gupta"}, "edited": false, "score": 0, "creation_date": 1434934558, "post_id": 30672155, "comment_id": 49973100, "body": "Whilst this may theoretically answer the question, <a href=\"//meta.stackoverflow.com/q/8259\">it would be preferable</a> to include the essential parts of the answer here, and provide the link for reference."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2413, "user_id": 4779472, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh5.googleusercontent.com/-918sSljPOLU/AAAAAAAAAAI/AAAAAAAAABA/JrpaeNI9JiM/photo.jpg?sz=128", "display_name": "Rohit Gupta", "link": "https://stackoverflow.com/users/4779472/rohit-gupta"}, "edited": false, "score": 0, "creation_date": 1434937122, "post_id": 30672155, "comment_id": 49973536, "body": "@RohitGupta This is the complete answer. What more are you hoping to see?"}, {"owner": {"reputation": 2413, "user_id": 4779472, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh5.googleusercontent.com/-918sSljPOLU/AAAAAAAAAAI/AAAAAAAAABA/JrpaeNI9JiM/photo.jpg?sz=128", "display_name": "Rohit Gupta", "link": "https://stackoverflow.com/users/4779472/rohit-gupta"}, "edited": false, "score": 0, "creation_date": 1434938588, "post_id": 30672155, "comment_id": 49973768, "body": "You have a high enough rep to know that this is a low quality answer.  You could for instance give a one line explanation for each of them.  I know what they are, but others may not.  If you want to get carried away, you could explain their arguments and the result they return."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2413, "user_id": 4779472, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh5.googleusercontent.com/-918sSljPOLU/AAAAAAAAAAI/AAAAAAAAABA/JrpaeNI9JiM/photo.jpg?sz=128", "display_name": "Rohit Gupta", "link": "https://stackoverflow.com/users/4779472/rohit-gupta"}, "edited": false, "score": 3, "creation_date": 1434947582, "post_id": 30672155, "comment_id": 49975677, "body": "@RohitGupta It has no arguments, and returns the answer asked for in the question. It would be stupid to say that. The other sentence is only there to flesh the thing out to the 30-character minimum. It&#39;s not a low-quality answer; it&#39;s just a very specific question for which the best answer is simple and short."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1433524111, "creation_date": 1433524111, "answer_id": 30672155, "question_id": 30672098, "link": "https://stackoverflow.com/questions/30672098/get-number-of-threads-hecs-at-runtime/30672155#30672155", "title": "Get number of threads (HECs) at runtime", "body": "<p>Use <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Concurrent.html#v:getNumCapabilities\" rel=\"nofollow\"><code>getNumCapabilities</code></a>. It also has a counterpart <code>setNumCapabilities</code> for changing the number of threads programmatically.</p>\n"}], "owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 30672155, "answer_count": 1, "score": 2, "last_activity_date": 1433663812, "creation_date": 1433523875, "last_edit_date": 1433663812, "question_id": 30672098, "link": "https://stackoverflow.com/questions/30672098/get-number-of-threads-hecs-at-runtime", "title": "Get number of threads (HECs) at runtime", "body": "<p>How do I get the number of threads / HECs (the -N parameter) of a Haskell program that was compiled with <em>-threaded</em> during its runtime?</p>\n\n<p>[Edit]\nMy question is about the number of HECs, not about the number of cores (even though the answer is related) - so the question is <strong>not</strong> a duplicate. </p>\n"}, {"tags": ["haskell", "recursion", "tree", "functional-programming", "binary-tree"], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 7, "last_activity_date": 1433513811, "creation_date": 1433513811, "answer_id": 30668836, "question_id": 30667522, "link": "https://stackoverflow.com/questions/30667522/using-diagrams-library-in-haskell-draw-binary-trees/30668836#30668836", "title": "Using Diagrams library in haskell (draw binary trees)", "body": "<p>I think the problem is you're naming giving the inner nodes the same names so <code>connectOutside</code> connects the first names it finds (which happen to be the last nodes in your tree). You can solve this by giving each node a unique name depending on its position:</p>\n\n<pre><code>diagTree :: Show s =&gt; Tree s -&gt; Diagram Rasterific\ndiagTree = go [] where\n  go nm Empty        = diagNode  \"Empty\" # named nm\n  go nm (Node x l r) = \n    connectOutside nm nmL .\n    connectOutside nm nmR $\n          nx\n          ===\n      (nl ||| nr) # centerX\n    where\n      (nmL, nmR) = ('L':nm, 'R':nm)\n      nx = diagNode (show x) # named nm \n      nl = go nmL l # named nmL\n      nr = go nmR r # named nmR\n</code></pre>\n\n<p>with</p>\n\n<pre><code>data Tree a = Empty\n            | Node { label :: a, left,right :: Tree a }\n  deriving Show\n\nleaf :: a -&gt; Tree a\nleaf a = Node a Empty Empty\n\ndiagNode :: String -&gt; Diagram Rasterific\ndiagNode txt = text txt # fontSizeL 0.4 &lt;&gt; circle 1 &amp; pad 2\n</code></pre>\n\n<p>I get <img src=\"https://i.stack.imgur.com/kveO0.png\" alt=\"tree\"></p>\n"}], "owner": {"reputation": 2196, "user_id": 3433232, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0170269937c80a352c776b4ed5e3c1f7?s=128&d=identicon&r=PG&f=1", "display_name": "basti12354", "link": "https://stackoverflow.com/users/3433232/basti12354"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 866, "favorite_count": 2, "accepted_answer_id": 30668836, "answer_count": 1, "score": 1, "last_activity_date": 1433513811, "creation_date": 1433510107, "question_id": 30667522, "link": "https://stackoverflow.com/questions/30667522/using-diagrams-library-in-haskell-draw-binary-trees", "title": "Using Diagrams library in haskell (draw binary trees)", "body": "<p>I am trying to use the Haskell Diagrams library for drawing binary trees.</p>\n\n<p>This is my tree type: </p>\n\n<pre><code>data Tree a = Empty\n            | Node { label :: a, left,right :: Tree a }\n\nleaf :: a -&gt; Tree a\nleaf a = Node a Empty Empty\n</code></pre>\n\n<p>This is a random tree:</p>\n\n<pre><code>t0 = Node 1 (Node 2 (leaf 3) (leaf 4))   (Node 5 (leaf 6) (leaf 7))\n</code></pre>\n\n<p>For drawing a circle with a char in the middle I am using this simple function (works fine):</p>\n\n<pre><code>diagNode :: String -&gt; Diag\n</code></pre>\n\n<p>Here is my code to draw the binary tree:</p>\n\n<pre><code>diagTree :: Show s =&gt; Tree s -&gt; Diag\ndiagTree Empty = diagNode \"Empty\"\n\ndiagTree (Node x Empty Empty) = connectOutside \"X\" \"L\" $\n                                connectOutside \"X\" \"R\" $\n          nx\n          ===\n      (nl ||| nr) # center\n  where\n    nx = named \"X\" ( diagNode (show x) )  \n    nl = named \"L\" (diagNode \"Empty\" )\n    nr = named \"R\" (diagNode \"Empty\" )  \n\ndiagTree (Node x left right) = connectOutside \"X\" \"L\" $\n                               connectOutside \"X\" \"R\" $\n          nx\n          ===\n      (nl ||| nr) # center\n  where\n    nx = named \"X\" ( diagNode (show x) ) \n    nl = named \"L\" (diagTree left )\n    nr = named \"R\" (diagTree right )\n</code></pre>\n\n<p><img src=\"https://i.stack.imgur.com/RBxF9.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>You can see my code works only for the last \"leafs\", but it doesn't connect the upper nodes with the nodes below.</strong> I think the problem is, that I am calling diagTree recursively. </p>\n\n<p>How can I fix this problem??</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433497203, "post_id": 30662852, "comment_id": 49388558, "body": "how about combination in column view"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1433496047, "creation_date": 1433496047, "answer_id": 30662852, "question_id": 30662811, "link": "https://stackoverflow.com/questions/30662811/how-to-do-combination-for-extra-column-view-with-maximum-value-2/30662852#30662852", "title": "how to do combination for extra column view with maximum value 2", "body": "<p>Use <code>max a b</code>, not <code>max (a,b)</code>. The former passes two arguments, the latter passes just one -- a pair <code>(a,b)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1433681763, "last_edit_date": 1433681763, "creation_date": 1433681433, "answer_id": 30693738, "question_id": 30662811, "link": "https://stackoverflow.com/questions/30662811/how-to-do-combination-for-extra-column-view-with-maximum-value-2/30693738#30693738", "title": "how to do combination for extra column view with maximum value 2", "body": "<p>as you asked me - you can get the <code>comb2</code> compiling with:</p>\n\n<pre><code>comb2 :: [(Int, Int, Int)] -&gt; [(Int, Int, Int)]\ncomb2 xs = do\n   (a,b,c) &lt;- xs\n   d &lt;- [0,1,2]\n   return (a, b, c+d)   \n</code></pre>\n\n<p>I don't know exactly what you are trying to do with the <code>fst</code> and <code>snd</code> stuff but it looks a bit like LISPs <code>car</code> &amp; <code>cdr</code> - but those would rather be <code>head</code> and <code>tail</code> and obvious only work for lists - not for tuples ;)</p>\n\n<p>btw: as you seem to know a bit F# - there you would do it in a similar faction - those <code>mutable</code> values are really anti-idiomatic F# ;)</p>\n\n<pre><code>&gt; let comb2 xs = seq {\n-    for (a,b,c) in xs do\n-    for d in 0..2 do\n-    yield (a,b,c+d) };;\n\nval comb2 : xs:seq&lt;'a * 'b * int&gt; -&gt; seq&lt;'a * 'b * int&gt;\n</code></pre>\n\n<p>as you can see instead of the <code>do</code> block you can just use an <code>seq</code> <em>expression</em></p>\n"}], "owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 30662852, "answer_count": 2, "score": 0, "last_activity_date": 1433681763, "creation_date": 1433495915, "last_edit_date": 1433575645, "question_id": 30662811, "link": "https://stackoverflow.com/questions/30662811/how-to-do-combination-for-extra-column-view-with-maximum-value-2", "title": "how to do combination for extra column view with maximum value 2", "body": "<p><strong>Update2</strong> : is it possible to have dynamic number of type in return of function for 3^2, 4^2, 5^2, ... 10^2, so far i have to hard code this, and even if add back this, \ni feel not a full combination</p>\n\n<pre><code>comb0 :: [(Int, Int, Int)]\ncomb0 = do\n   a &lt;- [0,1,2]\n   b &lt;- [0,1,2]\n   return (a, b, 2 - max a b)\n\ncomb :: [(Int, Int, Int, Int, Int, Int, Int, Int, Int)]\ncomb = do\n   a1 &lt;- [0]\n   a2 &lt;- [0,1]\n   a3 &lt;- [0]\n   a4 &lt;- [0,1] \n   a5 &lt;- [0,1]\n   a6 &lt;- [0]\n   a7 &lt;- [0]\n   a8 &lt;- [0]\n   a9 &lt;- [0]\n   return (a1,a2,a3,a4,a5,a6,a7,a8,a9)\n</code></pre>\n\n<p><strong>Update1</strong> : i thought a stupid way but may have full combination</p>\n\n<p>assume output is [0;1;0] input column 1 [0;0;1] input column 2[0;1;0]</p>\n\n<p>since input 1 and input 2 first row is 0, so do not care first 0 in output</p>\n\n<p>and then 2 minus [1;0] become [1;2] and then</p>\n\n<p>we see that there are two rows, so make two for loop</p>\n\n<p>for i in 0..1 do</p>\n\n<pre><code> for j in 0..2 do\n</code></pre>\n\n<p>combinations become [0;0] , [0;1], [0; 2],  [1;0] , [1; 1], [1; 2]</p>\n\n<p>add back to [1;0] become [1+0; 0+0], [1+0; 0+1], [1+0; 0+2], [1+1; 0+1]... etc then glue then back to the table</p>\n\n<p>how to write this in simple way in haskell? </p>\n\n<p><strong>Original question:</strong>\nif only return (a,b), the input is correct for logic table</p>\n\n<p>this problem is using value 2, you can say that it is 3 valued, \nwhen i calculated for 5 valued, my computer calculated is slow in c#\nwaiting for long time, still not finish, i expect to increase value \nas many as possible, hope haskell can be faster in this</p>\n\n<p>expect to add output column to this,\ni use ((a,b), max(a,b)) as the starting point, and then add one to third \ncolumn which is output until reach 2 and recursively run and save each combination in list written in F#, output 12 combinations outputs, but i feel that there is some\nmissing, not full combinations, expect to use haskell do the same things to see full combinations of this and save into text file and moreover counting how many combinations it have</p>\n\n<p>if except first row 0, 0 keep output 0 too</p>\n\n<pre><code>comb :: [(Int, Int, Int)]\ncomb = do\n   b &lt;- [0,1,2]\n   a &lt;- [0,1,2]\n   return (a,b, max a b)\n\ncomb2 :: [(Int, Int, Int)] -&gt; [(Int, Int, Int)]\ncomb2 x = do\n   c &lt;- [0,1,2]\n   return (fst x, fst snd x, c + snd snd x)\n</code></pre>\n\n<p>[1 of 1] Compiling Main             ( main.hs, main.o )</p>\n\n<pre><code>main.hs:67:19:\n    Couldn't match expected type `Int'\n                with actual type `(Int, Int) -&gt; (Int, Int)'\n    In the return type of a call of `max'\n    Probable cause: `max' is applied to too few arguments\n    In the expression: max (a, b)\n    In the first argument of `return', namely `((a, b), max (a, b))'\n\ncomb :: [((Int, Int), Int)]\ncomb = do\n   b &lt;- [0,1,2]\n   a &lt;- [0,1,2]\n   return ((a,b), max(a,b))\n\n  mapM_ print comb\n</code></pre>\n\n<p>F# code</p>\n\n<pre><code>let MakeColumn(input : List&lt;int&gt; , m1 : int , m2 : int, numberofvalue : int) : List&lt;int&gt;=\n    let mutable zero1 = 0\n    for i in 0..(m1-1) do\n        for j in 0..(m2-1) do\n            input.Add(zero1)\n        zero1 &lt;- zero1 + 1\n        if zero1 &gt;= numberofvalue then\n            zero1 &lt;- 0\n    input\n\nlet mutable col1_3 : List&lt;int&gt; = new List&lt;int&gt;()\nlet mutable col2_3 : List&lt;int&gt; = new List&lt;int&gt;()\nlet mutable col3_3 : List&lt;int&gt; = new List&lt;int&gt;()\nlet mutable col1_2 : List&lt;int&gt; = new List&lt;int&gt;()\nlet mutable col2_2 : List&lt;int&gt; = new List&lt;int&gt;()\nlet mutable col3_2 : List&lt;int&gt; = new List&lt;int&gt;()\nlet Radix = 3\nlet mutable totalrows = Convert.ToInt32(Math.Pow(float 2, float Radix))\ncol1_3 &lt;- MakeColumn(col1_3, totalrows, 1, 2)\ncol2_3 &lt;- MakeColumn(col2_3, totalrows/2, 2, 2)\ncol3_3 &lt;- MakeColumn(col3_3, totalrows/4, 4, 2)\ncol1_2 &lt;- MakeColumn(col1_2, totalrows/2, 1, 2)\ncol2_2 &lt;- MakeColumn(col2_2, totalrows/4, 2, 2)\nlet debugtotalrows = totalrows\nlet debugcol1_3 = col1_3\nlet debugcol2_3 = col2_3\nlet debugcol3_3 = col3_3\nlet debugcol1_2 = col1_2\nlet debugcol2_2 = col2_2\nlet debugcol3_2 = col3_2\nlet mutable col1_3a : List&lt;int&gt; = new List&lt;int&gt;()\nlet mutable col2_3a : List&lt;int&gt; = new List&lt;int&gt;()\nlet debugcol1_3a = MakeColumn(col1_3a, 9/3, 3, 3)\nlet debugcol2_3a = MakeColumn(col2_3a, 9, 1, 3)\nfor i in 0..(col1_3.Count-1) do\n    Console.WriteLine(col1_3.[i].ToString()+\",\"+col2_3.[i].ToString())\n\n\nlet MinimumCovering(col1 : List&lt;int&gt;, col2 : List&lt;int&gt;)=\n    let OutputBits = new List&lt;int&gt;()\n    for i in 0..(col1.Count-1) do\n        OutputBits.Add(Math.Max(col1.[i], col2.[i]))\n    OutputBits\n\nlet MinimumCoveringList(col1 : List&lt;int&gt;, col2 : List&lt;int&gt;)=\n    let mutable OutputBits = []\n    for i in 0..(col1.Count-1) do\n        OutputBits &lt;- Math.Max(col1.[i], col2.[i]) :: OutputBits\n    let finaloutput = List.rev OutputBits\n    finaloutput\n\nlet NumberOfNonMaximumForCovering(col1 : List&lt;int&gt;)=\n    let mutable count = 0\n    for i in 0..(col1.Count-1) do\n        if col1.[i] &lt;&gt; 2 then\n            count &lt;- count + 1\n    count\n\nlet rec AllCombinationOfBasicOutput(NumberOfNonMaximumValue : int, MinimumCoveringOutputParam : int list, numberofloops : int, maximumvalue : int, finaloutput : Dictionary&lt;int list, int list&gt; byref)=\n    let mutable newoutputs = new Dictionary&lt;int list, int list&gt;()\n    if numberofloops-1 &gt;= 0 then\n        newoutputs &lt;- new Dictionary&lt;int list, int list&gt;()\n    for i in 0..(NumberOfNonMaximumValue-1) do \n        let mutable newoutput = []\n        for j in 0..(MinimumCoveringOutputParam.Length-1) do //change one row at each time\n            if i = j then\n                if MinimumCoveringOutputParam.[j] + 1 &lt; maximumvalue then\n                    newoutput &lt;- MinimumCoveringOutputParam.[j] + 1 :: newoutput\n                else\n                    newoutput &lt;- MinimumCoveringOutputParam.[j] :: newoutput\n            else\n                newoutput &lt;- MinimumCoveringOutputParam.[j] :: newoutput\n        let newoutput5 = List.rev newoutput\n        if finaloutput.ContainsKey(newoutput5) = false then\n            finaloutput.Add(newoutput5, newoutput5)            \n        if numberofloops-1 &gt;= 0 then\n            finaloutput &lt;- AllCombinationOfBasicOutput(NumberOfNonMaximumValue, newoutput5, numberofloops - 1, maximumvalue, &amp;finaloutput)\n    finaloutput\n\nlet MinimumCoveringOutput = MinimumCovering(debugcol1_3a, debugcol2_3a)\nlet MinimumCoveringOutputList = MinimumCoveringList(debugcol1_3a, debugcol2_3a)         \nlet NumberOfNonMaximum = NumberOfNonMaximumForCovering(MinimumCoveringOutput)\nlet mutable newoutputs3 = new Dictionary&lt;int list, int list&gt;()   \nlet comboutputs = AllCombinationOfBasicOutput(NumberOfNonMaximum, MinimumCoveringOutputList, NumberOfNonMaximum, 3, &amp;newoutputs3)\nlet ChangeIntListToListInt(m : int list) : List&lt;int&gt; =\n    let result = new List&lt;int&gt;()\n    for i in 0..(m.Length-1) do\n        result.Add(m.[i])\n    result\n\nfor aa in comboutputs.Keys do\n    let newaa = ChangeIntListToListInt(aa)\n    WriteTableMultipleValuedLogic(debugcol1_3a, debugcol2_3a,newaa, \"E:/martintonic.txt\")\n    System.IO.File.AppendAllText(\"E:/martintonic.txt\", \"*****\\r\\n\")\n</code></pre>\n\n<p>expect to compare the output below to see whether below is full combinations</p>\n\n<pre><code>0,0=1\n0,1=1\n0,2=2\n1,0=1\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=2\n0,1=1\n0,2=2\n1,0=1\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=2\n0,1=2\n0,2=2\n1,0=1\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=2\n0,1=1\n0,2=2\n1,0=2\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=2\n0,1=2\n0,2=2\n1,0=2\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=1\n0,1=2\n0,2=2\n1,0=1\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=1\n0,1=2\n0,2=2\n1,0=2\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=1\n0,1=1\n0,2=2\n1,0=2\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=0\n0,1=2\n0,2=2\n1,0=1\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=0\n0,1=2\n0,2=2\n1,0=2\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=0\n0,1=1\n0,2=2\n1,0=1\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n0,0=0\n0,1=1\n0,2=2\n1,0=2\n1,1=1\n1,2=2\n2,0=2\n2,1=2\n2,2=2\n*****\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "ghc"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1433504617, "post_id": 30662563, "comment_id": 49393180, "body": "You can if you use <code>ViewPatterns</code> and <code>PatternSynonyms</code>."}], "answers": [{"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 12, "last_activity_date": 1433495322, "creation_date": 1433495322, "answer_id": 30662604, "question_id": 30662563, "link": "https://stackoverflow.com/questions/30662563/matching-positive-integer-with-haskell/30662604#30662604", "title": "Matching positive integer with haskell", "body": "<p>No, but you can do it with guard expressions.</p>\n\n<pre><code>fn :: Int -&gt; Int\nfn i | i &gt; 0 = (-i)\nfn i | otherwise = i\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1433520253, "post_id": 30663253, "comment_id": 49404044, "body": "It should be added that <code>PeanoInt</code> will see greatly inferior performance to <code>Int</code>."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 9, "last_activity_date": 1433497933, "last_edit_date": 1433497933, "creation_date": 1433497200, "answer_id": 30663253, "question_id": 30662563, "link": "https://stackoverflow.com/questions/30662563/matching-positive-integer-with-haskell/30663253#30663253", "title": "Matching positive integer with haskell", "body": "<p>Although @Sebastian response is correct, <strong>yes</strong> you can</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\nimport Prelude hiding (odd)\n\ndata Peano = Zero | Succ Peano deriving Show\ndata PeanoInt = Neg Peano | Pos Peano deriving Show\n\nodd :: PeanoInt -&gt; Bool\nodd (Neg Zero) = False\nodd (Pos Zero) = False\nodd (Neg (Succ (Succ x))) = odd $ Neg x\nodd (Pos (Succ (Succ x))) = odd $ Pos x\nodd _ = True\n\nzero = Zero\none = Succ zero\ntwo = Succ one\n\nf :: PeanoInt -&gt; String\nf (Neg (Succ (Succ Zero))) = \"-2 (then we can match all finite sets)\"\nf (Pos _)                  = \"Positives\"\nf (odd -&gt; True)            = \"Odd!\"\nf x                        = show x\n\nmain = do\n\n    print $ f (Neg two)\n    print $ f (Pos one)\n    print $ odd (Neg one)\n    print $ odd (Neg two)\n    print $ odd (Pos one)\n    print $ odd (Pos two)\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1259, "favorite_count": 0, "accepted_answer_id": 30663253, "answer_count": 2, "score": 5, "last_activity_date": 1433497933, "creation_date": 1433495238, "question_id": 30662563, "link": "https://stackoverflow.com/questions/30662563/matching-positive-integer-with-haskell", "title": "Matching positive integer with haskell", "body": "<p>Is it possible with pattern matching to match a range of values ? For example :</p>\n\n<ul>\n<li>the whole positive integers ? </li>\n<li>odd numbers ? </li>\n<li>a list of values ?</li>\n</ul>\n"}, {"tags": ["haskell", "typeclass", "overloading"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433486157, "post_id": 30659780, "comment_id": 49382123, "body": "Is this really what you want to do? But to the question: no I don&#39;t think it can be done this general."}, {"owner": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433486291, "post_id": 30659780, "comment_id": 49382183, "body": "@Carsten, I could live with having function <code>fooLen</code> and <code>fooStr</code>, but I think overloading is a lot more comfortable."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1433486296, "post_id": 30659780, "comment_id": 49382187, "body": "The problem is that maybe you export your function (<code>printFoo</code> or whatever) and then if someone uses it and adds an instance <code>instance Foo (String -&gt; Double)</code> he would be in trouble"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433486387, "post_id": 30659780, "comment_id": 49382222, "body": "Also this might be a case of YAGNI - don&#39;t introduce type-classes to quickly (just my 50cts. of course)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1433486892, "post_id": 30659780, "comment_id": 49382496, "body": "&quot;... provided that my list of instances is fixed, ...&quot; - but type classes are open - i.e. later you could add an instance in another module."}, {"owner": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433488534, "post_id": 30659780, "comment_id": 49383451, "body": "@Carsten, that&#39;s the point. Any possible solution would probably involve preventing the class from being extended."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1433494340, "post_id": 30662044, "comment_id": 49386725, "body": "+1 of course <i>doh</i> did not thing of this - nice <i>workaround</i> - of course I still think a class like <code>Foo</code> here is just a symptom for another problem ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433494621, "post_id": 30662044, "comment_id": 49386913, "body": "as as side note just constraining to <code>Num</code> and using <code>genericLength</code> should work too: <code>instance Num a =&gt; Foo (String -&gt; a) where foo = genericLength</code> maybe this is easier to understand as I think that <i>equality constraints</i> are not widely known (at least to beginners)"}, {"owner": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "edited": false, "score": 0, "creation_date": 1433529198, "post_id": 30662044, "comment_id": 49408834, "body": "Great. Though I had to add <i>IncoherentInstances</i> to get the second instance to work. Where can I read up why this works?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "edited": false, "score": 0, "creation_date": 1433536809, "post_id": 30662044, "comment_id": 49412676, "body": "@KarolisJuodel\u0117 You definitely shouldn&#39;t need incoherent instances, and shouldn&#39;t turn it on even if you think you need it. What is the second instance? The two you give in your question work just fine for me without incoherent instances."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "edited": false, "score": 0, "creation_date": 1433537158, "post_id": 30662044, "comment_id": 49412844, "body": "@KarolisJuodel\u0117 For &quot;why this works&quot;, I explain a little bit in <a href=\"http://stackoverflow.com/a/10777583/791604\">this answer</a>. GHC looks at instance heads (only!) when choosing which instance to use, then requires the context for that instance to hold. So anything that matches <code>String -&gt; a</code> uses that instance, then verifies <i>after</i> we know that we&#39;re using that instance that <code>a</code> is actually <code>Int</code>."}, {"owner": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "edited": false, "score": 0, "creation_date": 1433542089, "post_id": 30662044, "comment_id": 49414847, "body": "@DanielWagner, then I probably changed it wrong. I did <code>instance a ~ String =&gt; Foo a where foo = &quot;world&quot;</code>: <a href=\"http://ideone.com/MrJjMi\" rel=\"nofollow noreferrer\">A working version with incoherent instances</a>, <a href=\"http://ideone.com/YqujdK\" rel=\"nofollow noreferrer\">and the same code failing without it</a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "edited": false, "score": 0, "creation_date": 1433542900, "post_id": 30662044, "comment_id": 49415073, "body": "@KarolisJuodel\u0117 Yes, don&#39;t do that. Leave <code>instance Foo String</code> as-is. <a href=\"http://ideone.com/49124L\" rel=\"nofollow noreferrer\">A working version with no incoherent instances.</a>"}, {"owner": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "edited": false, "score": 0, "creation_date": 1433575758, "post_id": 30662044, "comment_id": 49421177, "body": "@DanielWagner, but your code explicitly states that foo should be <code>String</code>, rather than <code>String-&gt;Int</code>. I don&#39;t want that. I want it to figure out that only <code>String</code> is an instance of <code>Show</code>. What&#39;s so bad about IncoherentInstances anyway?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1433493689, "creation_date": 1433493689, "answer_id": 30662044, "question_id": 30659780, "link": "https://stackoverflow.com/questions/30659780/resolving-ambiguities-for-overloaded-functions/30662044#30662044", "title": "Resolving ambiguities for overloaded functions", "body": "<p>It is easy to do in this particular case. Simply:</p>\n\n<pre><code>instance a ~ Int =&gt; Foo (String -&gt; a) where foo = length\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1433496018, "post_id": 30662561, "comment_id": 49387804, "body": "I think the question was why this is needed ;) (and if you can make the compiler find it by itself)"}], "tags": [], "owner": {"reputation": 1765, "user_id": 2181660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bda83eedd4ccbae9799c1fab98aed7ff?s=128&d=identicon&r=PG", "display_name": "viorior", "link": "https://stackoverflow.com/users/2181660/viorior"}, "is_accepted": false, "score": 0, "last_activity_date": 1433495232, "creation_date": 1433495232, "answer_id": 30662561, "question_id": 30659780, "link": "https://stackoverflow.com/questions/30659780/resolving-ambiguities-for-overloaded-functions/30662561#30662561", "title": "Resolving ambiguities for overloaded functions", "body": "<p>In your case GHCI knows, that <code>foo :: String -&gt; ??</code></p>\n\n<p>We are going to change signature to <code>String -&gt; Int</code>:</p>\n\n<pre><code>print (foo \"hello\" :: Int)\n</code></pre>\n"}], "owner": {"reputation": 3608, "user_id": 971193, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/595080b1b9c49b099a65928e6589e703?s=128&d=identicon&r=PG", "display_name": "Karolis Juodel\u0117", "link": "https://stackoverflow.com/users/971193/karolis-juodel%c4%97"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 30662044, "answer_count": 2, "score": 4, "last_activity_date": 1433495232, "creation_date": 1433485786, "question_id": 30659780, "link": "https://stackoverflow.com/questions/30659780/resolving-ambiguities-for-overloaded-functions", "title": "Resolving ambiguities for overloaded functions", "body": "<p>I want to have an overloaded function in Haskell. </p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nclass Foo a where\n   foo :: a\n\ninstance Foo (String -&gt; Int) where\n   foo = length\n\ninstance Foo String where\n   foo = \"world\"\n</code></pre>\n\n<p>However such overloading deals very poorly with type ambiguities. <code>print $ foo \"hello\"</code> would result in an error, while <code>print $ length \"hello\"</code> works fine. However, provided that my list of instances is fixed, there shouldn't be a technical reason why Haskell can't realize that the only instance of <code>foo :: String -&gt; a</code> is <code>foo :: String -&gt; Int</code>. Can I have Haskell make this realization?</p>\n"}, {"tags": ["haskell", "leksah"], "comments": [{"owner": {"reputation": 4295, "user_id": 1916893, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/XTlc8.png?s=128&g=1", "display_name": "TobiMcNamobi", "link": "https://stackoverflow.com/users/1916893/tobimcnamobi"}, "edited": false, "score": 0, "creation_date": 1433493554, "post_id": 30659116, "comment_id": 49386260, "body": "Does it matter if you make a function declaration just above <code>prop_hello</code>? Something like <code>prop_hello :: String -&gt; Bool</code>."}, {"owner": {"reputation": 4295, "user_id": 1916893, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/XTlc8.png?s=128&g=1", "display_name": "TobiMcNamobi", "link": "https://stackoverflow.com/users/1916893/tobimcnamobi"}, "edited": false, "score": 0, "creation_date": 1433493992, "post_id": 30659116, "comment_id": 49386517, "body": "Probably related: <a href=\"http://stackoverflow.com/questions/28358575/quickcheckall-always-return-true\" title=\"quickcheckall always return true\">stackoverflow.com/questions/28358575/&hellip;</a> Or this might help: <a href=\"http://stackoverflow.com/questions/1694097/haskell-compiler-error-not-in-scope\" title=\"haskell compiler error not in scope\">stackoverflow.com/questions/1694097/&hellip;</a>"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1433483007, "creation_date": 1433483007, "question_id": 30659116, "link": "https://stackoverflow.com/questions/30659116/haskell-ghc-7-10-1-leksah-what-is-the-meaning-of-this-warning-name-found", "title": "Haskell/GHC 7.10.1/Leksah : What is the meaning of this Warning: &quot;name ... found in source file but was not in scope&quot;", "body": "<p>I am using the Leksah IDE 0.15.0.1 and I get a warning when compiling the example package: \"name ... found in source file but was not in scope\".</p>\n\n<p>What is the meaning of this Warning ?</p>\n\n<p>I googled for this text but found noting enlightening.</p>\n\n<p><img src=\"https://i.stack.imgur.com/xnWml.png\" alt=\"enter image description here\"></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1433470097, "post_id": 30657197, "comment_id": 49377048, "body": "What do you mean with <code>And</code> and <code>Or</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433487829, "post_id": 30658437, "comment_id": 49382992, "body": "You are really expert to show this useful idea with haskell. Only haskell can do this complicated task in simple code."}, {"owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433487964, "post_id": 30658437, "comment_id": 49383075, "body": "the power of haskell is quite shocking."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433490175, "post_id": 30658437, "comment_id": 49384383, "body": "thanks - but I&#39;m not quite an expert - I&#39;m most likely far further away from being an expert than your from whatever I am right now ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433490724, "post_id": 30658437, "comment_id": 49384686, "body": "By the way: if this answers your question you should accept it ;) - if not I will happily try to help you out further"}, {"owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "edited": false, "score": 0, "creation_date": 1433499322, "post_id": 30658437, "comment_id": 49389882, "body": "sorry for late tick it, as i am thinking another problem, for this problem, i think difficult to debug"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1433490670, "last_edit_date": 1433490670, "creation_date": 1433479047, "answer_id": 30658437, "question_id": 30657197, "link": "https://stackoverflow.com/questions/30657197/how-to-run-this-all-combination-of-tree/30658437#30658437", "title": "how to run this all combination of tree", "body": "<p>First of your code has a couple of issues - mainly missing parts (<code>comp</code>) and that you complicated the tree to much (in my opinion).\nFor example the <code>Null</code> part seems strange and you did not really include the operations (<code>Or</code>, <code>And</code>) either.</p>\n\n<p>But the idea with <code>splits</code> is promising!</p>\n\n<p>I allowed myself to change your design a bit but this idea is still present.</p>\n\n<p>First I changed the representation of those <code>And/Or</code>-Trees into:</p>\n\n<pre><code>data Operation\n  = And\n  | Or\n    deriving Show\n\ndata Tree x\n = Leaf x\n | Node (Tree x) Operation (Tree x)\n   deriving Show\n</code></pre>\n\n<p>As you can see it's a straight-forward rewrite - just included the operation instead of the element.</p>\n\n<p>I did not change your first pattern-matches in <code>getAllTrees</code> much:</p>\n\n<pre><code>getAllTrees :: [a] -&gt; [Tree a]\ngetAllTrees [] = []\ngetAllTrees [x] = return $ Leaf x\n</code></pre>\n\n<p>the empty list will just return the empty list, a single element list will yield a <code>Leaf</code>.</p>\n\n<p>Next we have to decide what to do with those empty parts in <code>split</code> (like <code>([],everything)</code>) - because it would not really yield a valid tree (and get us into <em>troubles</em>) - but as you started using the <strong>list-monad</strong> and as it has <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:guard\" rel=\"nofollow\"><code>guard</code></a> available we can make use of it:</p>\n\n<pre><code>getAllTrees xs = do\n  (left, right) &lt;- splits xs\n  guard $ not (null left) &amp;&amp; not (null right)\n</code></pre>\n\n<p>instead of using Applicatives-syntax I find it easier to continue in the monads <code>do</code> style and recursively pull trees out of <code>getAllTrees</code> (and operators out of <code>[And,Or]</code>):</p>\n\n<pre><code>leftT &lt;- getAllTrees left\nrightT &lt;- getAllTrees right\nop &lt;- [And, Or]\n</code></pre>\n\n<p>that leaves us with just returning the assembled `Node\u00b4 value:</p>\n\n<pre><code>return $ Node leftT op rightT\n</code></pre>\n\n<h3>why the <code>guard</code>?</h3>\n\n<p>the problems arise form splits of the form <code>(fullList, [])</code> </p>\n\n<p>If you look at the code you should see that you will call <code>getAllTrees</code> with the full-list over and over again recursively. </p>\n\n<p>So if the guard is not there you will get the first couple of answers till you get the <code>(fullList, [])</code> split and then the output stops and you enter an infinite loop.</p>\n\n<p>You might wonder why you don't see anything more - after all the recursive <code>getAllTrees</code> should reyield the ones you have already seen, and that is true - but then the <code>rightT &lt;- getAllTrees right</code> will not yield anything as <code>right == []</code> here.</p>\n\n<p>So of course</p>\n\n<pre><code>guard $ not (null right)\n</code></pre>\n\n<p>would be enough as it's no big deal if the left side is empty (as the very next line will deal with it, by pulling from an empty list) - but I liked the symmetry here.</p>\n\n<h2>complete source</h2>\n\n<pre><code>import Data.List (inits, tails)\nimport Control.Monad (guard)\n\ndata Operation\n  = And\n  | Or\n    deriving Show\n\ndata Tree x\n = Leaf x\n | Node (Tree x) Operation (Tree x)\n   deriving Show\n\nsplits :: [a] -&gt; [([a], [a])]\nsplits xs = zip (inits xs) (tails xs)\n\ngetAllTrees :: [a] -&gt; [Tree a]\ngetAllTrees [] = []\ngetAllTrees [x] = return $ Leaf x\ngetAllTrees xs = do\n  (left, right) &lt;- splits xs\n  guard $ not (null left) &amp;&amp; not (null right)\n  leftT &lt;- getAllTrees left\n  rightT &lt;- getAllTrees right\n  op &lt;- [And, Or]\n  return $ Node leftT op rightT\n</code></pre>\n\n<h3>example</h3>\n\n<p>this will return for example:</p>\n\n<pre><code>\u03bb&gt; getAllTrees [1..3]\n[Node (Leaf 1) And (Node (Leaf 2) And (Leaf 3))\n,Node (Leaf 1) Or (Node (Leaf 2) And (Leaf 3))\n,Node (Leaf 1) And (Node (Leaf 2) Or (Leaf 3))\n,Node (Leaf 1) Or (Node (Leaf 2) Or (Leaf 3))\n,Node (Node (Leaf 1) And (Leaf 2)) And (Leaf 3)\n,Node (Node (Leaf 1) And (Leaf 2)) Or (Leaf 3)\n,Node (Node (Leaf 1) Or (Leaf 2)) And (Leaf 3)\n,Node (Node (Leaf 1) Or (Leaf 2)) Or (Leaf 3)]\n</code></pre>\n\n<p>it should be easy to map this in any form you like</p>\n\n<h2>the obvious generalization</h2>\n\n<p>By the way there is a obvious way to make these trees generic over the <em>connector</em> (<code>And</code>, <code>Or</code>) as well:</p>\n\n<pre><code>data Tree x y\n = Leaf x\n | Node (Tree x y) y (Tree x y)\n   deriving Show\n\nsplits :: [a] -&gt; [([a], [a])]\nsplits xs = zip (inits xs) (tails xs)\n\ngetAllTrees :: [b] -&gt; [a] -&gt; [Tree a b]\ngetAllTrees _ [] = []\ngetAllTrees _ [x] = return $ Leaf x\ngetAllTrees ys xs = do\n  (left, right) &lt;- splits xs\n  guard $ not (null right)\n  leftT &lt;- getAllTrees ys left\n  rightT &lt;- getAllTrees ys right\n  y &lt;- ys\n  return $ Node leftT y rightT\n</code></pre>\n\n<p>where you then had to call:</p>\n\n<pre><code>getAllTrees [And,Or] [1..3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1433493586, "creation_date": 1433493586, "answer_id": 30662012, "question_id": 30657197, "link": "https://stackoverflow.com/questions/30657197/how-to-run-this-all-combination-of-tree/30662012#30662012", "title": "how to run this all combination of tree", "body": "<p>The other answer is quite in-depth. I would also like to give the minimal edit needed to make your code compile and run, so you can continue exploring on your own. There are only three things needed:</p>\n\n<ol>\n<li>Fix the type signature on <code>getAllTrees</code> -- it returns <code>[Tree a]</code>, not <code>Tree a</code>.</li>\n<li>Give a <code>Show</code> instance for trees. You can simply add <code>deriving Show</code> at the end of the declaration and GHC will write a suitable instance for you.</li>\n<li>Decide what to do about <code>comb</code> (which isn't in scope here). Simply deleting the line that mentions it works fine.</li>\n</ol>\n"}], "owner": {"reputation": 433, "user_id": 2331634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/LG1IK.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2331634/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 30658437, "answer_count": 2, "score": 1, "last_activity_date": 1433493586, "creation_date": 1433469846, "question_id": 30657197, "link": "https://stackoverflow.com/questions/30657197/how-to-run-this-all-combination-of-tree", "title": "how to run this all combination of tree", "body": "<p>would like to get all combinations of equations\nfor example , Or(And(A,B),C) , Or(A, And(B,C)) .... etc</p>\n\n<p>then i find an example of tree seems near this idea, but it has compile error</p>\n\n<pre><code>main.hs:78:23:\n    Couldn't match type `[]' with `Tree'\n    Expected type: Tree ([a], [a])\n      Actual type: [([a], [a])]\n    In the return type of a call of `splits'\n    In a stmt of a 'do' block: (left, x : right) &lt;- splits xs\n    In the expression:\n      do { (left, x : right) &lt;- splits xs;\n           Node &lt;$&gt; getAllTrees left &lt;*&gt; pure x &lt;*&gt; getAllTrees right }\n\nmain.hs:85:17:\n    Couldn't match expected type `[a0]' with actual type `Tree Integer'\n    In the return type of a call of `getAllTrees'\n    In the second argument of `($)', namely `getAllTrees [1 .. 12]'\n    In a stmt of a 'do' block: mapM_ print $ getAllTrees [1 .. 12]\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>module Main where\nimport Data.Foldable (toList)\nimport Data.List\nimport Data.Maybe\nimport Data.Map (Map)\nimport qualified Data.Map as Map\nimport Data.Sequence (Seq)\nimport qualified Data.Sequence as Seq\nimport Data.Set (Set)\nimport qualified Data.Set as Set\nimport Control.Applicative\n\ndata Tree x\n = Null\n | Leaf x\n | Node (Tree x) x (Tree x)\n\nsplits xs = zip (inits xs) (tails xs)\n\ngetAllTrees :: [a] -&gt; Tree a\ngetAllTrees [] = return Null\ngetAllTrees [x] = return $ Leaf x\ngetAllTrees xs = do\n (left, x : right) &lt;- splits xs\n Node &lt;$&gt; getAllTrees left &lt;*&gt; pure x &lt;*&gt; getAllTrees right\n\nmain :: IO()\nmain = do \n  mapM_ print $ splits [1..12]\n  mapM_ print comb\n  mapM_ print $ getAllTrees [1..12]\n</code></pre>\n"}, {"tags": ["haskell", "types", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1433463220, "post_id": 30656107, "comment_id": 49375273, "body": "Why doesn&#39;t the same reasoning apply to a potential <code>Num Char</code> instance though?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433463928, "post_id": 30656107, "comment_id": 49375466, "body": "@ReidBarton Good question! I&#39;m actually not sure about that. I would guess that during instance resolution, GHC refuses to delay finding evidence for monomorphic constraints; but that&#39;s just a guess."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1433467190, "post_id": 30656107, "comment_id": 49376329, "body": "You could define a <code>Num Char</code> instance based on the <code>Enum Char</code> instance. The same reasoning would apply, but the instance just isn&#39;t included here."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1433470056, "post_id": 30656107, "comment_id": 49377039, "body": "@DanielWagner, sounds plausible, and I guess the reason why it does not eagerly solve the constraint in the polymorphic case is not because you might define an instance <code>Num [a]</code> later (same is true for <code>Num Char</code>), but because (with FlexibleInstances) there might be some specific instances like <code>Num [Double]</code>, and then you could use <code>xs</code> at type <code>[[Double]]</code>. In other words, GHC doesn&#39;t know what constraint to try to solve yet."}, {"owner": {"reputation": 187, "user_id": 1703967, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/l0058.jpg?s=128&g=1", "display_name": "Cherish", "link": "https://stackoverflow.com/users/1703967/cherish"}, "edited": false, "score": 0, "creation_date": 1433481358, "post_id": 30656107, "comment_id": 49380084, "body": "This is kind of toooo deep for me, I am just a beginner in FP....takes time to digest your answer. Anyway, thanks a billion...."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1433463043, "last_edit_date": 1433463043, "creation_date": 1433461844, "answer_id": 30656107, "question_id": 30655941, "link": "https://stackoverflow.com/questions/30655941/haskell-list-of-list-type-error/30656107#30656107", "title": "Haskell List of List Type Error", "body": "<p><code>1</code> is a polymorphic value of type <code>Num a =&gt; a</code>. So in <code>[1, [2, 3]]</code>, we have <code>[2, 3] :: Num a =&gt; [a]</code>; since all list elements must have the same type, we conclude that we must have <code>1 :: Num a =&gt; [a]</code>. That's a bit weird -- it's odd to think of <code>1</code> as having a list type -- but can be perfectly valid if somebody creates a sufficiently weird instance of <code>Num</code>. Checking whether an instance exists is pushed off until you try to use the instance; this gives you a chance to define the instance after you've defined the value using the instance. So it doesn't complain until you try to actually do something with the list <code>[1, [2, 3]]</code>.</p>\n\n<p>Just to illustrate what I mean, one may write:</p>\n\n<pre><code>instance Num a =&gt; Num [a] where\n    fromInteger n = pure (fromInteger n)\n    (+) = liftA2 (+)\n    (-) = liftA2 (-)\n    (*) = liftA2 (*)\n    abs    = liftA abs\n    signum = liftA signum\n</code></pre>\n\n<p>(Indeed, this instance works for any <code>Applicative</code>, and is occasionally even useful.) Then, in ghci:</p>\n\n<pre><code>&gt; let xs = [1, [1, 1]]\n&gt; xs\n[[1],[1,1]]\n</code></pre>\n\n<p>See ma, no errors!</p>\n"}], "owner": {"reputation": 187, "user_id": 1703967, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/l0058.jpg?s=128&g=1", "display_name": "Cherish", "link": "https://stackoverflow.com/users/1703967/cherish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 30656107, "answer_count": 1, "score": 5, "last_activity_date": 1433463043, "creation_date": 1433460804, "question_id": 30655941, "link": "https://stackoverflow.com/questions/30655941/haskell-list-of-list-type-error", "title": "Haskell List of List Type Error", "body": "<p>In GHCi, i type</p>\n\n<pre><code>let xs = [1, 'a']\n</code></pre>\n\n<p>it complains the error immediately:</p>\n\n<pre><code>&lt;interactive&gt;:28:11:\nNo instance for (Num Char) arising from the literal \u20181\u2019\nIn the expression: 1\nIn the expression: [1, 'a']\nIn an equation for \u2018xs\u2019: xs = [1, 'a']\n</code></pre>\n\n<p>However, when I type</p>\n\n<pre><code>let xs = [1, [1, 1]]\n</code></pre>\n\n<p>It just passed. And it complains when I try to print xs:</p>\n\n<pre><code>&lt;interactive&gt;:5:1:\nNo instance for (Num [t0]) arising from a use of \u2018it\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I think Haskell is a static type language so any type error should be caught in compile time. I am wondering why the above 2 errors are caught at different time?</p>\n"}, {"tags": ["haskell", "automated-tests", "template-haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433462054, "post_id": 30655883, "comment_id": 49374959, "body": "Is it enough to just use <code>runQ :: Q a -&gt; IO a</code>? Then you can write any (decidable) predicate on <code>a</code> that you like, including alpha-equivalence to a known-good result from a previous run."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1433540096, "post_id": 30655883, "comment_id": 49414077, "body": "Maybe you could write a really obnoxious <code>equalModuloNames :: Dec -&gt; Dec -&gt; Bool</code> function that ignores names, and then do some unit tests with your generated code. Together that seems like it would provide decent coverage."}], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1433460467, "creation_date": 1433460467, "question_id": 30655883, "link": "https://stackoverflow.com/questions/30655883/how-can-i-automate-testing-a-template-haskell-function", "title": "How can I automate testing a Template Haskell function?", "body": "<p>I <a href=\"https://github.com/frerich/catamorphism/blob/master/src/Data/Morphism/Cata.hs#L138\" rel=\"nofollow\">defined a function</a> using Template Haskell which generates a function definition given some type. The type is basically</p>\n\n<pre><code>makeFunc :: Name -&gt; Q [Dec]\n</code></pre>\n\n<p>Right now, I use the <code>-ddump-splices</code> switch with GHC to see the generated splices. How can I automate this to verify that different types yield the expected splices?</p>\n\n<p>A basic approach might be to just redirect the generated splice to a file and then compare that, but the generated code may well be different since it involves various identifiers constructed via <a href=\"http://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/Language-Haskell-TH-Syntax.html#v:newName\" rel=\"nofollow\"><code>newName</code></a>.</p>\n"}, {"tags": ["haskell", "functional-programming", "lambda-calculus", "algebraic-data-types", "scott-encoding"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1433459623, "post_id": 30655680, "comment_id": 49374225, "body": "I am not sure, but I think it&#39;s encoded in the same way you would encode <code>data Tree a = Node a | Leaf a</code>, i.e. <code>node = (\u03bb x n l. n x)</code>, etc. After all, the list encoding didn&#39;t care about the recursive reference -- the encoding is the same as for <code>data List a = Cons a a | Nil</code>. Still, I am not familiar enough with SE to write an actual answer."}], "answers": [{"tags": [], "owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "is_accepted": true, "score": 4, "last_activity_date": 1433479620, "creation_date": 1433479620, "answer_id": 30658523, "question_id": 30655680, "link": "https://stackoverflow.com/questions/30655680/how-do-you-represent-nested-types-using-the-scott-encoding/30658523#30658523", "title": "How do you represent nested types using the Scott Encoding?", "body": "<p>If the <a href=\"http://en.wikipedia.org/wiki/Mogensen%E2%80%93Scott_encoding#Definition\" rel=\"nofollow\">Wikipedia article</a> is correct, then</p>\n\n<pre><code>data Tree a = Node (List (Tree a)) | Leaf a\n</code></pre>\n\n<p>has Scott encoding</p>\n\n<pre><code>node = \u03bb a . \u03bb node leaf . node a\nleaf = \u03bb a . \u03bb node leaf . leaf a\n</code></pre>\n\n<p>It looks like the Scott encoding is indifferent to (nested) types. All it's concerned with is delivering the correct number of parameters to the constructors.</p>\n"}, {"tags": [], "owner": {"reputation": 331, "user_id": 1698519, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a76c11c30e76d6b38abbdc845a436d61?s=128&d=identicon&r=PG", "display_name": "augur", "link": "https://stackoverflow.com/users/1698519/augur"}, "is_accepted": false, "score": 3, "last_activity_date": 1433511299, "creation_date": 1433511299, "answer_id": 30667929, "question_id": 30655680, "link": "https://stackoverflow.com/questions/30655680/how-do-you-represent-nested-types-using-the-scott-encoding/30667929#30667929", "title": "How do you represent nested types using the Scott Encoding?", "body": "<p>Scott encodings are basically representing a <code>T</code> by the type of its case expression. So for lists, we would define a case expression like so:</p>\n\n<pre><code>listCase :: List a -&gt; r -&gt; (a -&gt; List a -&gt; r) -&gt; r\nlistCase []     n c = n\nlistCase (x:xs) n c = c x xs\n</code></pre>\n\n<p>this gives us an analogy like so:</p>\n\n<pre><code>case xs of { [] -&gt; n ; (x:xs) -&gt; c }\n=\nlistCase xs n (\\x xs -&gt; c)\n</code></pre>\n\n<p>This gives a type</p>\n\n<pre><code>newtype List a = List { listCase :: r -&gt; (a -&gt; List a -&gt; r) -&gt; r }\n</code></pre>\n\n<p>The constructors are just the values that pick the appropriate branches:</p>\n\n<pre><code>nil :: List a\nnil = List $ \\n c -&gt; n\n\ncons :: a -&gt; List a -&gt; List a\ncons x xs = List $ \\n c -&gt; c x xs\n</code></pre>\n\n<p>We can work backwards then, from a boring case expression, to the case function, to the type, for your trees:</p>\n\n<pre><code>case t of { Leaf x -&gt; l ; Node xs -&gt; n }\n</code></pre>\n\n<p>which should be roughly like</p>\n\n<pre><code>treeCase t (\\x -&gt; l) (\\xs -&gt; n)\n</code></pre>\n\n<p>So we get</p>\n\n<pre><code>treeCase :: Tree a -&gt; (a -&gt; r) -&gt; (List (Tree a) -&gt; r) -&gt; r\ntreeCase (Leaf x)  l n = l x\ntreeCase (Node xs) l n = n xs\n\nnewtype Tree a = Tree { treeCase :: (a -&gt; r) -&gt; (List (Tree a) -&gt; r) -&gt; r }\n\nleaf :: a -&gt; Tree a\nleaf x = Tree $ \\l n -&gt; l x\n\nnode :: List (Tree a) -&gt; Tree a\nnode xs = Tree $ \\l n -&gt; n xs\n</code></pre>\n\n<p>Scott encodings are very easy tho, because they're <em>only</em> case. Church encodings are folds, which are notoriously hard for nested types.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 1, "accepted_answer_id": 30658523, "answer_count": 2, "score": 3, "last_activity_date": 1433511299, "creation_date": 1433459084, "question_id": 30655680, "link": "https://stackoverflow.com/questions/30655680/how-do-you-represent-nested-types-using-the-scott-encoding", "title": "How do you represent nested types using the Scott Encoding?", "body": "<p>An ADT can be represented using the Scott Encoding by replacing products by tuples and sums by matchers. For example:</p>\n\n<pre><code>data List a = Cons a (List a) | Nil\n</code></pre>\n\n<p>Can be encoded using the Scott Encoding as:</p>\n\n<pre><code>cons = (\u03bb h t c n . c h t)\nnil  = (\u03bb c n . n)\n</code></pre>\n\n<p>But I couldn't find how nested types can be encoded using SE:</p>\n\n<pre><code>data Tree a = Node (List (Tree a)) | Leaf a\n</code></pre>\n\n<p>How can it be done?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433459723, "post_id": 30655051, "comment_id": 49374259, "body": "Using a proof assistant would make your life much easier. <a href=\"https://gist.github.com/yuriy0/6be284048182000d8753\" rel=\"nofollow noreferrer\">Here is the proof in agda.</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433459443, "post_id": 30655591, "comment_id": 49374179, "body": "The induction hypothesis doesn&#39;t necessarily have to use <code>a</code> uniformly. Interestingly enough, this is much easier to prove if you take the induction hypotheses <code>flatten&#39; x (flatten&#39; y a) = concat (flatten x) (flatten&#39; y a)</code>."}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433486211, "post_id": 30655591, "comment_id": 49382145, "body": "@chi: Thanks for explaining the inductive hypotheses on binary trees."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433490964, "post_id": 30655591, "comment_id": 49384814, "body": "@user2407038 That&#39;s right - I now quantify <code>a</code> universally so that it doesn&#39;t have to be uniform."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1433490913, "last_edit_date": 1433490913, "creation_date": 1433458609, "answer_id": 30655591, "question_id": 30655051, "link": "https://stackoverflow.com/questions/30655051/inductive-step-of-proof-by-structural-induction/30655591#30655591", "title": "inductive step of proof by structural induction", "body": "<p>When inducting on lists, your induction hypothesis is that the wanted property holds on the list tail, and you have to prove that it also holds on the whole list.</p>\n\n<p>On trees, it's only slightly different: your induction hypothesis is that the wanted property holds on <em>both</em> subtrees, and you have to prove that is also holds on the whole tree.</p>\n\n<pre><code>Assume that:\n   forall a, flatten' x a = concat (flatten x) a         Ind. Hyp. 1\n   forall a, flatten' y a = concat (flatten y) a         Ind. Hyp. 2\n\nShow that:\n   forall a, flatten'(Node x y) a = concat (flatten (Node x y)) a\n</code></pre>\n\n<p>I think you can now guess how to proceed from here, so I won't spoil the fun. You might need to rely on some basic property of <code>concat</code> for some sub-step.</p>\n\n<p>Final note: in your base case, you mentioned <code>C.1</code> as a justification -- are you sure you actually used that?</p>\n"}], "owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 0, "accepted_answer_id": 30655591, "answer_count": 1, "score": 1, "last_activity_date": 1433490913, "creation_date": 1433455745, "last_edit_date": 1433486138, "question_id": 30655051, "link": "https://stackoverflow.com/questions/30655051/inductive-step-of-proof-by-structural-induction", "title": "inductive step of proof by structural induction", "body": "<p>I am given the following 2 versions of a tree-flattening program and i am asked to prove identical behaviour.</p>\n\n<pre><code>flatten::Tree-&gt;[Int]\nflatten (Leaf z)        =[z]                             F.1\nflatten (Node x y)      =concat (flatten x)(flatten y)   F.2\n\nflatten'::Tree-&gt;Int-&gt;[Int]\nflatten' (Leaf z) a     =concat [z] a                    P.1\nflatten' (Node x y) a   =flatten' x (flatten' y a)       P.2\n\nconcat-&gt;[a]-&gt;a-&gt;[a]\nconcat [] a             =a                               C.1\nconcat (h:t) a          =h:concat t a                    C.2\n</code></pre>\n\n<p>Prove that:</p>\n\n<pre><code>flatten' z a = concat (flatten z) a\n</code></pre>\n\n<p>Base Case:</p>\n\n<pre><code>LHS:\n    flatten' (Leaf z) a = concat [z] a                   By P.1\nRHS:\n    concat (flatten z) a = concat (flatten (Leaf z)) a\n                         = concat [z] a                  By F.1 and C.1\n\nLHS=RHS, hence base case holds\n</code></pre>\n\n<p>Inductive Case: </p>\n\n<blockquote>\n  <p>(Only possible thanks to the guy below who explained how induction on\n  binary trees works!)</p>\n</blockquote>\n\n<pre><code>Assume that:\n   flatten' x a = concat (flatten x) a                   Ind. Hyp1\n   flatten' y a = concat (flatten y) a                   Ind. Hyp2\n\nShow that:\n   flatten'(Node x y) a = concat (flatten (Node x y)) a\n\nLHS:\n   flatten' (Node x y) a = \n   flatten' x (flatten' y a)                             By P.2\n   flatten' x (concat (flatten y) a)                     By Ind. Hyp2\n   concat (flatten x) (concat (flatten y) a)             By Ind. Hyp1\n\nRHS:\n   concat (flatten (Node x y)) a =\n   concat (concat (flatten x) (flatten y)) a             By F.2\n   concat (flatten x) (concat (flatten y) a)             By C.2\n\n   LHS = RHS, hence inductive step holds. End of proof.\n</code></pre>\n"}, {"tags": ["haskell", "io", "monads", "yesod"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1433456488, "post_id": 30655045, "comment_id": 49373091, "body": "Looks like you need a <code>liftIO</code> here.  Try <code>liftIO (readFile &quot;test.txt&quot;) &gt;&gt;= \\x -&gt; ...</code>.  I haven&#39;t used Yesod or hamlet, but it appears that you have a <code>WidgetT</code> transformer on top of the <code>IO</code> monad, so you&#39;ll have to lift any <code>IO</code> action to be a <code>WidgetT</code> action using <code>liftIO</code> (the preferred way here)."}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433456951, "post_id": 30655045, "comment_id": 49373285, "body": "that does the trick. I haven&#39;t used <code>liftIO</code> before. if you submit as an answer I&#39;ll accept it. I&#39;m still wrapping my head around monad transformers so any additional explanation or pointers to relevant info would be much appreciated."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 1, "last_activity_date": 1433460784, "creation_date": 1433460784, "answer_id": 30655937, "question_id": 30655045, "link": "https://stackoverflow.com/questions/30655045/in-yesod-haskell-how-do-i-use-data-from-io-with-the-variable-interpolation-func/30655937#30655937", "title": "In Yesod/Haskell, how do I use data from IO with the variable interpolation functionality?", "body": "<p>When working with monad transformers, to convert from some monad <code>m</code> to a transformer <code>t m</code>, you have to use the <code>lift</code> function:</p>\n\n<pre><code>lift :: (MonadTrans t, Monad m) =&gt; m a -&gt; t m a\n</code></pre>\n\n<p>This is actually the defining method of the <code>MonadTrans</code> typeclass, so the implementation is specific to the transformer <code>t</code>.</p>\n\n<p>If you want to perform <code>IO</code> actions inside a transformer, you'll have to define an instance for <code>MonadIO</code>, which has the <code>liftIO</code> method:</p>\n\n<pre><code>liftIO :: (MonadIO m) =&gt; IO a -&gt; m a\n</code></pre>\n\n<p>an instance of <code>MonadIO</code> doesn't have to be a transformer, though, <code>IO</code> is an instance where <code>liftIO = id</code>.  These two functions are designed to let you \"pull\" actions up a transformer stack, for each level in the stack you would call <code>lift</code> or <code>liftIO</code> once.</p>\n\n<p>For your case, you have the stack <code>WidgetT App IO</code>, with the transformer <code>WidgetT App</code> and the base monad <code>IO</code>, so you only need one call to <code>liftIO</code> to pull an <code>IO</code> action up to be an action in the <code>WidgetT App IO</code> monad.  So you would just do</p>\n\n<pre><code>liftIO (readFile \"test.txt\") &gt;&gt;= \\x -&gt; makeContent x\n</code></pre>\n\n<p>A lot of developers (including myself) find <code>liftIO</code> a bit of a burden to type when you have a lot of <code>IO</code> actions, so it's not uncommon to see something like</p>\n\n<pre><code>io :: MonadIO io =&gt; IO a -&gt; io a\nio = liftIO\n\nputStrLnIO :: MonadIO io =&gt; String -&gt; io ()\nputStrLnIO = io . putStrLn\n\nprintIO :: (MonadIO io, Show a) =&gt; a -&gt; io ()\nprintIO = io . print\n\nreadFileIO :: MonadIO io =&gt; FilePath -&gt; io String\nreadFileIO = io . readFile\n</code></pre>\n\n<p>And so on.  If you find yourself using a lot of <code>liftIO</code>s in your code, this can help trim down on how many characters you need to type.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 30655937, "answer_count": 1, "score": 3, "last_activity_date": 1433460784, "creation_date": 1433455729, "last_edit_date": 1433456553, "question_id": 30655045, "link": "https://stackoverflow.com/questions/30655045/in-yesod-haskell-how-do-i-use-data-from-io-with-the-variable-interpolation-func", "title": "In Yesod/Haskell, how do I use data from IO with the variable interpolation functionality?", "body": "<p>How do I take values from an IO monad and interpolate into a yesod widget? </p>\n\n<p>For example, I want to interpolate the contents of a file into hamlet:</p>\n\n<pre><code>(readFile \"test.txt\") &gt;&gt;= \\x -&gt; toWidget $ [hamlet| &lt;p&gt; text: #{x} |]\n</code></pre>\n\n<p>or equivalently:</p>\n\n<pre><code>contents &lt;- (readFile \"test.txt\")\ntoWidget $ [hamlet| &lt;h2&gt; foo #{contents} |]\n</code></pre>\n\n<p>There's something basic I'm not grasping about how interpolation interacts with IO since neither of these type checks:</p>\n\n<pre><code>Couldn't match type \u2018IO\u2019 with \u2018WidgetT App IO\u2019 \u2026\n    Expected type: WidgetT App IO String\n      Actual type: IO String\n</code></pre>\n\n<p>These errors occur in a getHomeR route function.</p>\n\n<p>If I try to do something similar in GHCi with a predefined function, I get a different error. In the source file, I have a function:</p>\n\n<pre><code>makeContent body =\n    [hamlet|\n        &lt;h2&gt; foo\n        &lt;div&gt; #{body}\n    |]\n</code></pre>\n\n<p>in GHCi:</p>\n\n<pre><code>(readFile \"test.txt\") &gt;&gt;= \\x -&gt; makeContent x\n</code></pre>\n\n<p>And I get an error due to insufficient arguments (I think this is because of some template magic I don't understand yet):</p>\n\n<pre><code>&lt;interactive&gt;:139:33:\n    Couldn't match expected type \u2018IO b\u2019\n                with actual type \u2018t0 -&gt; Text.Blaze.Internal.MarkupM ()\u2019\n    Relevant bindings include it :: IO b (bound at &lt;interactive&gt;:139:1)\n    Probable cause: \u2018makeContent\u2019 is applied to too few arguments\n</code></pre>\n"}, {"tags": ["arrays", "haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433451173, "post_id": 30653727, "comment_id": 49370840, "body": "Have you tried to look at the types of <code>freeze</code> and <code>thaw</code>? Those kind of give a way why this doesn&#39;t work."}, {"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433451496, "post_id": 30653727, "comment_id": 49371017, "body": "Yes, I know that freeze gives me back an array wrapped in a monad."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433451846, "post_id": 30653727, "comment_id": 49371205, "body": "The point is really that <code>runSTArrray</code> already gives you back a frozen array. You can&#39;t freeze an immutable array."}, {"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433452348, "post_id": 30653727, "comment_id": 49371433, "body": "Oh, okay that&#39;s what I was asking. Thank you. Do you know why the mapM would be wrong?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433452595, "post_id": 30653727, "comment_id": 49371544, "body": "&quot;Reading and writing from an array&quot; is fundamentally at odds with &quot;immutable array&quot;. I claim that you do <i>not</i> want an immutable array, and your &quot;thaw, mutate, and then freeze again&quot; implementation -- which, by the way, is almost certain to cause problems -- agrees with me."}, {"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 0, "creation_date": 1433452901, "post_id": 30653727, "comment_id": 49371688, "body": "Im modifying the array infrequently relative to how often I read from the array. Shouldn&#39;t I prefer immutability to mutability whenever I can make that choice?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433453142, "post_id": 30653727, "comment_id": 49371801, "body": "@KiraGhandhi If you&#39;re not doing frequent modifications, why do you need an array at all?"}, {"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 0, "creation_date": 1433453224, "post_id": 30653727, "comment_id": 49371833, "body": "Because I&#39;m doing frequent reads. I don&#39;t <i>need</i> an array, but it&#39;s the data structure I thought would best fit (mostly because it can index on tuples)."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 0, "creation_date": 1433639197, "post_id": 30655910, "comment_id": 49437379, "body": "Thank you, that&#39;s what I ended up with."}], "tags": [], "owner": {"reputation": 1003, "user_id": 218307, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71349c1b606c549215197f7ec55e2276?s=128&d=identicon&r=PG", "display_name": "jhickner", "link": "https://stackoverflow.com/users/218307/jhickner"}, "is_accepted": true, "score": 4, "last_activity_date": 1433460610, "creation_date": 1433460610, "answer_id": 30655910, "question_id": 30653727, "link": "https://stackoverflow.com/questions/30653727/freezing-and-thawing-arrays-in-haskell/30655910#30655910", "title": "Freezing and Thawing arrays in Haskell", "body": "<p>It should work with a couple of changes:</p>\n\n<p>1.) Modify your thawed <code>a</code> instead of the unthawed <code>bd</code>.</p>\n\n<p>2.) No no need to re-freeze after <code>runSTArray</code>. The result you return is already frozen.</p>\n\n<pre><code>modifyBoard bd = mbd \n    where \n        t = view falling st\n        ps = extractLocs t\n        mbd = runSTArray $ do\n            a &lt;- thaw bd\n            mapM_ (\\xy -&gt; writeArray a xy (Filled t)) ps\n            return a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 2, "last_activity_date": 1433469135, "creation_date": 1433469135, "answer_id": 30657108, "question_id": 30653727, "link": "https://stackoverflow.com/questions/30653727/freezing-and-thawing-arrays-in-haskell/30657108#30657108", "title": "Freezing and Thawing arrays in Haskell", "body": "<p>jhickner's answer is correct, but it also seems like you've simply reinvented <a href=\"http://hackage.haskell.org/package/array-0.5.1.0/docs/Data-Array-IArray.html#v:-47--47-\" rel=\"nofollow\"><code>(//)</code></a> (which under the hood is implemented very much like how you've written it):</p>\n\n<pre><code>modifyBoard bd = bd // map (\\xy -&gt; (xy, Filled t)) ps\n    where t = ...\n          ps = ...\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 30655910, "answer_count": 2, "score": 2, "last_activity_date": 1433469135, "creation_date": 1433450399, "last_edit_date": 1433450593, "question_id": 30653727, "link": "https://stackoverflow.com/questions/30653727/freezing-and-thawing-arrays-in-haskell", "title": "Freezing and Thawing arrays in Haskell", "body": "<p>I'm working on a project involving reading and writing from an array in Haskell. I want to store the array in an immutable array type (because I want to avoid mutability as much as possible), so I'm working with the <code>freeze</code> and <code>thaw</code> functions for <a href=\"http://hackage.haskell.org/package/array-0.1.0.0/docs/Data-Array-MArray.html#t%3AMArray\" rel=\"nofollow\">MArray</a>s. I am confused about how I am supposed to use these functions though. This is what I have (that does not compile):</p>\n\n<pre><code>modifyBoard bd = freeze mbd \nwhere \n    t = view falling st\n    ps = extractLocs t\n    mbd = runSTArray $ do\n     a &lt;- thaw bd\n     mapM_ (\\xy -&gt; writeArray mbd xy (Filled t)) ps\n     return a\n</code></pre>\n\n<p>Should I not be using arrays this way or how can I fix this?</p>\n"}, {"tags": ["haskell", "leksah"], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1433440036, "creation_date": 1433440036, "question_id": 30650707, "link": "https://stackoverflow.com/questions/30650707/leksah-jump-to-definition-within-current-package-and-to-names-defined-in-packag", "title": "Leksah, jump to definition within current package and to names defined in packages installed in Sandbox", "body": "<p>I'm using Leksah 0.15.0.1 built with ghc 7.10.1. </p>\n\n<p>Here is the problem :</p>\n\n<p>If I ctrl+click on a function name which is from a system wide installed library then Leksah goes to the definition, just fine! </p>\n\n<p><strong>However</strong>, this (go to definition) does not work for </p>\n\n<p>1) functions defined within the currently edited package</p>\n\n<p>2) functions defined in packages that are located in a sandbox. </p>\n\n<p>For example in the picture below, I can jump to the definition of <code>SDL.QuitEvent</code> but not to the definition of <code>AppInput</code>. </p>\n\n<p>Which is strange because <code>AppInput</code> is defined in the same file that I am editing and <code>SDL.QuitEvent</code> is defined in a system wide installed cabal package.</p>\n\n<p>Any idea how to fix this? What might be going wrong ?'</p>\n\n<p><img src=\"https://i.stack.imgur.com/BQqpW.jpg\" alt=\"enter image description here\"></p>\n\n<p><img src=\"https://i.stack.imgur.com/61Q8h.jpg\" alt=\"enter image description here\"></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 0, "creation_date": 1433438568, "post_id": 30649930, "comment_id": 49363873, "body": "That&#39;s what I&#39;m hoping to avoid, if possible (see the last line of the question)."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 0, "creation_date": 1433439784, "post_id": 30649930, "comment_id": 49364629, "body": "@AlexR See <a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\" rel=\"nofollow noreferrer\">Real World Haskell</a> on how this is the current best solution.  It isn&#39;t pretty, I agree, but it&#39;s just how you have to do it with mtl."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 0, "creation_date": 1433440621, "post_id": 30649930, "comment_id": 49365112, "body": "@AlexR I saw the last line of the question. I practically quoted it, and on purpose."}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433440946, "post_id": 30649930, "comment_id": 49365300, "body": "@bheklilr, mtl and transformers are different packages (the former building upon the latter); I&#39;m hoping that between the extensions in GHC 7.10 and packages like monad-classes, there&#39;s something that I can piggy-back off of, even if I wouldn&#39;t want to use it in production code."}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 0, "creation_date": 1433441028, "post_id": 30649930, "comment_id": 49365344, "body": "@DanielWagner, :( I don&#39;t like your answer (but I did upvote it). I&#39;ll accept it if nothing more palatable comes up."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1433437338, "creation_date": 1433437338, "answer_id": 30649930, "question_id": 30649658, "link": "https://stackoverflow.com/questions/30649658/how-do-i-write-a-function-which-behaves-differently-depending-on-which-monad-is/30649930#30649930", "title": "How do I write a function which behaves differently depending on which monad is at the base of the transformer stack", "body": "<p>Write instances of <code>MonadDebug</code> for each transformer and each base monad that you are interested in supporting.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1433444743, "post_id": 30651515, "comment_id": 49367432, "body": "This sort of works, until you want to support something like <a href=\"http://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Free.html\" rel=\"nofollow noreferrer\"><code>Free</code></a> or <a href=\"http://hackage.haskell.org/package/MonadPrompt-1.0.0.5/docs/Control-Monad-Prompt.html\" rel=\"nofollow noreferrer\"><code>Prompt</code></a> that fit the shape of your last instance, but only by accident."}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433458939, "post_id": 30651515, "comment_id": 49374019, "body": "I don&#39;t see how those would break."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433460964, "post_id": 30651515, "comment_id": 49374592, "body": "They are not monad transformers (hence not instances of <code>MonadTrans</code>)."}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433465527, "post_id": 30651515, "comment_id": 49375946, "body": "The docs beg to differ (at least for <code>free</code>): <a href=\"http://hackage.haskell.org/package/free-4.12.1/docs/src/Control-Monad-Free.html#line-212\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433484753, "post_id": 30651515, "comment_id": 49381465, "body": "As mentioned in the docs, it is not a real monad transformer (it requires some equations to hold); and even if it were, <code>Free f</code> is a monad even when <code>f</code> isn&#39;t (and thus the <code>Monad (Free f)</code> constraint in your head wouldn&#39;t hold)."}], "tags": [], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "is_accepted": false, "score": 0, "last_activity_date": 1433442789, "creation_date": 1433442789, "answer_id": 30651515, "question_id": 30649658, "link": "https://stackoverflow.com/questions/30649658/how-do-i-write-a-function-which-behaves-differently-depending-on-which-monad-is/30651515#30651515", "title": "How do I write a function which behaves differently depending on which monad is at the base of the transformer stack", "body": "<p>Of course, as soon as I post to SO, I figure out how to get what I want.</p>\n\n<p>As far as I can tell, the following code solves my problem:</p>\n\n<pre><code>class (Monad m) =&gt; MonadDebug m where\n  runDebug :: IO () -&gt; m ()\n\ninstance MonadDebug Identity where\n  runDebug _ = return ()\n\ninstance MonadDebug IO where\n  runDebug m = m\n\ninstance (Monad (t m), MonadTrans t, MonadDebug m) =&gt; MonadDebug (t m) where\n  runDebug m = lift $ runDebug m\n</code></pre>\n"}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 30649930, "answer_count": 2, "score": 4, "last_activity_date": 1433442789, "creation_date": 1433436435, "question_id": 30649658, "link": "https://stackoverflow.com/questions/30649658/how-do-i-write-a-function-which-behaves-differently-depending-on-which-monad-is", "title": "How do I write a function which behaves differently depending on which monad is at the base of the transformer stack", "body": "<p>(At this point this is more of a puzzle I'd like know how to solve than a solution I expect to use in practice)</p>\n\n<p>I'm trying to write a function <code>runDebug</code> with the following specification: its argument has type <code>IO ()</code>; its return type is <code>(Monad m) =&gt; m ()</code>; depending on <code>m</code>, it behaves in one of two different ways; if <code>MonadIO m</code>, then <code>runDebug = liftIO</code>, and otherwise <code>runDebug = const (return ())</code>.</p>\n\n<p>The approaches I've tried relied on a type class like</p>\n\n<pre><code>class MonadDebug m where\n  runDebug :: IO () -&gt; m ()\n</code></pre>\n\n<p>I've tried using <code>MonadBase</code>, and I've tried using <code>MonadIO</code> with overlapping instances, but all of them have run into issues with ambiguity.</p>\n\n<p>I think I could get something that works by writing instances for each transformer, but I've been hoping to avoid that.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1433427562, "post_id": 30646251, "comment_id": 49356464, "body": "You have to have your template haskell function return a <code>Q [Dec]</code>, and since <code>Q</code> is a <code>Monad</code> you should be able to just <code>return [FunD p1 ...]</code> in your function definition.  Does that work for what you want to do?"}, {"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433438121, "post_id": 30646251, "comment_id": 49363609, "body": "thank you it work add the code corrected in the answers, i create this method only to exercise, the idea is that you can define the name to the function as a parameter"}, {"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433971059, "post_id": 30646251, "comment_id": 49587071, "body": "add the code corrected"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1433971001, "creation_date": 1433427226, "last_edit_date": 1433971001, "question_id": 30646251, "link": "https://stackoverflow.com/questions/30646251/error-define-a-template-haskell-function", "title": "error define a template haskell function", "body": "<p>I am beginning to learn Template haskell, so I want create a function that receive a String param that define the name to the function to generate</p>\n\n<pre><code>build_p5 :: String -&gt; [Dec]\nbuild_p5 name =\n[ FunD p1 \n         [ Clause [TupP [VarP a,VarP b]] (NormalB (AppE (VarE c) (VarE a))) [FunD c [Clause [VarP a] (NormalB (VarE a)) []]]\n         ]\n] where\n   p1 = mkName name\n   a = mkName \"a\"\n   b = mkName \"b\"\n   c = mkName \"ident\"\n</code></pre>\n\n<p>to run the definition :</p>\n\n<pre><code>$(build_p5 \"hola\")\n</code></pre>\n\n<p>but when I run the program get the following error</p>\n\n<blockquote>\n<pre><code>Couldn't match type \u2018[Dec]\u2019 with \u2018Q [Dec]\u2019\nExpected type: DecsQ\n  Actual type: [Dec]\nIn the expression: build_p5 \"hola\"\n</code></pre>\n</blockquote>\n\n<p>correct code</p>\n\n<pre><code>build_p2 :: Monad m =&gt; String -&gt; m [Dec]\nbuild_p2 name =\nreturn [ FunD p1 \n     [ Clause [TupP [VarP a,VarP b]] (NormalB (AppE (VarE c) (VarE a))) [FunD c [Clause [VarP a] (NormalB (VarE a)) []]]\n     ]\n  ] where\n  p1 = mkName name\n  a = mkName \"a\"\n  b = mkName \"b\"\n  c = mkName \"ident\"\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "edited": false, "score": 1, "creation_date": 1433432942, "post_id": 30647445, "comment_id": 49360500, "body": "I see, thank you so much for the clarification. I&#39;ll try to prepare and send a pull request. thanks again."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1433430149, "creation_date": 1433430149, "answer_id": 30647445, "question_id": 30645867, "link": "https://stackoverflow.com/questions/30645867/need-help-to-understand-the-usage-of-liftbase/30647445#30647445", "title": "Need help to understand the usage of `liftBase`", "body": "<p>I think I'm responsible for that. No, there's no purpose for it to be there, it can be removed. I think it was necessary before some refactoring. You could send a pull request and be part of an awesome library :)</p>\n"}, {"comments": [{"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "edited": false, "score": 1, "creation_date": 1433432872, "post_id": 30647482, "comment_id": 49360452, "body": "Thank you for the clarification!"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 4, "last_activity_date": 1433430225, "creation_date": 1433430225, "answer_id": 30647482, "question_id": 30645867, "link": "https://stackoverflow.com/questions/30645867/need-help-to-understand-the-usage-of-liftbase/30647482#30647482", "title": "Need help to understand the usage of `liftBase`", "body": "<p>It is a historical artifact. Initially there was only <code>withResource</code> function, and it <a href=\"https://hackage.haskell.org/package/resource-pool-0.2.0.4/docs/src/Data-Pool.html#withResource\" rel=\"nofollow\">used</a> <code>liftBase</code> because it lives in <code>MonadControlIO</code> class. Then the code was extracted to <code>takeResource</code>, but <code>liftBase</code> is still there.</p>\n"}], "owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 30647445, "answer_count": 2, "score": 2, "last_activity_date": 1433430225, "creation_date": 1433426346, "question_id": 30645867, "link": "https://stackoverflow.com/questions/30645867/need-help-to-understand-the-usage-of-liftbase", "title": "Need help to understand the usage of `liftBase`", "body": "<p>I am currently reading through (for self studying purpose) the source code of the Bryan O'Sullivan's popular <code>pool</code> <a href=\"https://github.com/bos/pool\" rel=\"nofollow\">library</a>.</p>\n\n<p>And I have a question in the function <code>takeResource</code>, which I would like to ask the Haskell experts here.\nThe function is defined as:</p>\n\n<pre><code>takeResource :: Pool a -&gt; IO (a, LocalPool a)\ntakeResource pool@Pool{..} = do\n  local@LocalPool{..} &lt;- getLocalPool pool\n  resource &lt;- liftBase . join . atomically $ do\n  ents &lt;- readTVar entries\n  case ents of\n    (Entry{..}:es) -&gt; writeTVar entries es &gt;&gt; return (return entry)\n    [] -&gt; do\n      used &lt;- readTVar inUse\n      when (used == maxResources) retry\n      writeTVar inUse $! used + 1\n      return $\n        create `onException` atomically (modifyTVar_ inUse (subtract 1))\n  return (resource, local)\n</code></pre>\n\n<p>The line I am having problem with is</p>\n\n<pre><code>...\nresource &lt;- liftBase . join . atomically $ do\n...\n</code></pre>\n\n<p>Why is here the usage of <code>liftBase</code> necessary? Can we also write instead</p>\n\n<pre><code>...\nresource &lt;- join . atomically $ do\n...\n</code></pre>\n\n<p>The compiler accepts both versions. Am I missing here something trivial or why is <code>liftBase</code> here necessary?</p>\n\n<p>Thank you in advance for the tips!</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433425311, "post_id": 30645328, "comment_id": 49354756, "body": "One approach is to use a terminal emulator with its own scrolling feature. What platform are you running?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1433425312, "post_id": 30645328, "comment_id": 49354759, "body": "Can&#39;t you just use your terminal&#39;s scroll bar or your mouse wheel?"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1433425851, "post_id": 30645328, "comment_id": 49355157, "body": "@sepp2k how to use mouse wheel on terminal? the terminal doesn&#39;t even show a mouse pointer."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1433425869, "post_id": 30645328, "comment_id": 49355171, "body": "btw: I don&#39;t think there is a <code>save</code> command in ghci - you are probably looking for <code>:edit</code> (will open you editor)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433425922, "post_id": 30645328, "comment_id": 49355200, "body": "what OS are you using?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433425952, "post_id": 30645328, "comment_id": 49355227, "body": "Usually a good way to scroll on a typical linux terminal is using <code>Shift+PgUp</code> and <code>Shift+PgDown</code>, do those work?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433425955, "post_id": 30645328, "comment_id": 49355230, "body": "anyways - you can see all <a href=\"https://downloads.haskell.org/~ghc/6.12.2/docs/html/users_guide/ghci-commands.html\" rel=\"nofollow noreferrer\">commands</a> here"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433426053, "post_id": 30645328, "comment_id": 49355297, "body": "@Carsten I wanted to save the commands I entered in the current ghci session to a file, but it seems ghci doesn&#39;t support it (poor me)"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1433426155, "post_id": 30645328, "comment_id": 49355363, "body": "@Carsten Which terminal are you using? Are you saying your mouse cursor disappears when you move it over the terminal window? That seems highly unusual (and unhelpful). Usually you can just use the mouse wheel by moving it while the window is focussed."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433426248, "post_id": 30645328, "comment_id": 49355427, "body": "@bheklilr the <code>Shift+PgUp</code> doesn&#39;t seem to work."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1433426468, "post_id": 30645328, "comment_id": 49355590, "body": "@mntk123 I don&#39;t believe GHCi has the ability to save a session.  You&#39;re probably wanting more IPython like functionality.  For that, all I can say is try out the IHaskell kernel for Jupyter.  Most languages don&#39;t ship with REPLs as feature rich as IPython (Python doesn&#39;t ship with it either!), and there just hasn&#39;t been much call for it for Haskell.  You can try the readline bindings for Haskell, though, I&#39;ve been able to use it to get the history into a variable, so if you can get that working then you could write your own GHCi command to do it."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433426831, "post_id": 30645328, "comment_id": 49355851, "body": "@bheklilr thanks, can you turn your comment into answer?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1433449731, "post_id": 30645328, "comment_id": 49370122, "body": "@mntk123 You can use <code>tee foo.txt | ghci</code> to save a session&#39;s commands to <code>foo.txt</code>."}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1433428097, "post_id": 30646122, "comment_id": 49356874, "body": "It works in bash. In zsh you need to wrap quotes around &quot;:?&quot; (because otherwise <code>?</code> is a special character)."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1433430081, "post_id": 30646122, "comment_id": 49358484, "body": "@sepp2k I have no idea what zsh is, other than the fact that it exists. I only use Bash. ;-)"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1433426920, "creation_date": 1433426920, "answer_id": 30646122, "question_id": 30645328, "link": "https://stackoverflow.com/questions/30645328/how-to-use-ghci-online-h-e-l-p-it-just-scrolls-fast/30646122#30646122", "title": "how to use ghci online- *h e l p*; it just scrolls fast?", "body": "<p>You could run GHCi from your shell and use shell redirection. This works for me on Windows:</p>\n\n<pre><code>echo :? | ghci &gt; help.txt\nmore help.txt\n</code></pre>\n\n<p>I would expect this to also work on Unix, although I can't actually try it.</p>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 30646122, "answer_count": 1, "score": 2, "last_activity_date": 1433426920, "creation_date": 1433425070, "question_id": 30645328, "link": "https://stackoverflow.com/questions/30645328/how-to-use-ghci-online-h-e-l-p-it-just-scrolls-fast", "title": "how to use ghci online- *h e l p*; it just scrolls fast?", "body": "<p>when I tried to save the current ghci session using :save command I got the error</p>\n\n<pre><code>Prelude&gt; :save\nunknown command ':save'\nuse :? for help.\nPrelude&gt; \n</code></pre>\n\n<p>then when i type :? I got a ton of output that zoomed past the screen; how to read it one page at a time? is there anything like Unix <code>less</code> command there in ghci?</p>\n"}, {"tags": ["haskell", "arrows"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433461117, "post_id": 30642527, "comment_id": 49374636, "body": "The simple solution is to get rid of the Show constraints. It will probably only make your life harder, regardless of what you are trying to do."}, {"owner": {"reputation": 43, "user_id": 4973303, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XYaBD6jNc4Q/AAAAAAAAAAI/AAAAAAAAAsg/gB9qk5i4Hk4/photo.jpg?sz=128", "display_name": "NCrashed", "link": "https://stackoverflow.com/users/4973303/ncrashed"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433535071, "post_id": 30642527, "comment_id": 49411786, "body": "The Show constraint is only an example. I want to inspect inner structure of input tuples of arrows and force input/output values to be serializable."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4973303, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XYaBD6jNc4Q/AAAAAAAAAAI/AAAAAAAAAsg/gB9qk5i4Hk4/photo.jpg?sz=128", "display_name": "NCrashed", "link": "https://stackoverflow.com/users/4973303/ncrashed"}, "edited": false, "score": 0, "creation_date": 1433692652, "post_id": 30676056, "comment_id": 49449238, "body": "Thank you for detailed explanation! My mistake was a simplifying the use case to much... Actually I was trying to distribute an arrow program across several nodes, thus I need a way to inspect arrow arguments (packed into tuples) and force them to be serializiable."}, {"owner": {"reputation": 43, "user_id": 4973303, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XYaBD6jNc4Q/AAAAAAAAAAI/AAAAAAAAAsg/gB9qk5i4Hk4/photo.jpg?sz=128", "display_name": "NCrashed", "link": "https://stackoverflow.com/users/4973303/ncrashed"}, "edited": false, "score": 0, "creation_date": 1433692795, "post_id": 30676056, "comment_id": 49449289, "body": "Thank you very much for crazy idea with Free monad, I am going to experiment with it further, perhaps it is more useful approach than defining free arrow and attaching it to some other arrow."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 2, "last_activity_date": 1433539455, "creation_date": 1433539455, "answer_id": 30676056, "question_id": 30642527, "link": "https://stackoverflow.com/questions/30642527/rebindable-syntax-for-arrow-with-constraint/30676056#30676056", "title": "Rebindable syntax for arrow with constraint", "body": "<h1>What the problem is</h1>\n\n<p>When you use Haskell's arrow notation, it does not naively desugar <code>proc v -&gt; x -&lt; y</code> into the <strong>literal</strong> text <code>arr (\\v -&gt; y) &gt;&gt;&gt; x</code> (using whatever <code>arr</code> and <code>&gt;&gt;&gt;</code> are in-scope) but rather it uses the <strong>true values</strong> that it is expecting, desugaring it into effectively:</p>\n\n<pre><code>Control.Arrow.arr (\\v -&gt; y) Control.Arrow.&gt;&gt;&gt; x\n</code></pre>\n\n<p>The problem is precisely that when you ran into a problem -- let's pretend that it's a house with a closed doorway -- you chose to build your own house right next door whose door you could open perfectly well (defining your own <code>Arrow</code> and <code>Category</code> instances), and now you're trying to drive a remote-control car which is hopelessly stuck in the other house, and you're confused because the doorways look very similar, so why isn't there an RC car upstairs in <em>this</em> house which all your commands are seamlessly rerouted to? The answer is, you'll need to build your own RC car and controller (Haskell source-to-source converter) to complete that approach.</p>\n\n<p>Clearly the easier way is to chuck all of this work and look instead for a doorknob to the other house.</p>\n\n<h1>How to fix your code</h1>\n\n<p>Let me summarize how the walls and doors that are Haskell type classes work. You're programming at an advanced enough level that this may be review, so I apologize if this is too brief. For the <code>Show</code> type class, for example, you construct this <code>Show</code> dictionary-of-functions (<code>show</code>, <code>showsPrec</code>, <code>showList</code>) for a type constructor, and those functions can use other functions coming from other constraints on the class's type-parameters. </p>\n\n<p>The compiler then stores a <code>Show</code> dictionary which takes the type constructor to a pair: first, the list of constraints on the type parameters, second, the actual dictionary that you've implemented, potentially using functions from the earlier constraints. When the compiler resolves <code>Show (MyType ParamA ParamB)</code> it therefore looks up <code>MyType</code> in the <code>Show</code> dictionary, finds an instance, verifies that <code>ParamA</code> and <code>ParamB</code> satisfy whatever constraints they have to satisfy (getting auxiliary dictionaries-of-functions for those classes), and forms the dictionary of <code>Show</code> functions. Hopefully that's mostly review; if not, go and study a tutorial on how Haskell type classes work.</p>\n\n<p>This means that you <strong>don't</strong> need <code>Show</code> in the constructors you're writing. They're constructors! They don't do anything but glue values together in a way that you can latter pattern-match apart -- they don't need the functions <code>show</code> or <code>showsPrec</code> to do those. Without them you can still write:</p>\n\n<pre><code>data FreeArrow a b where\n    LeafArrow :: FreeArrow a b\n    SeqArrow :: FreeArrow a t -&gt; FreeArrow t b -&gt; FreeArrow a b\n    ParArrow :: FreeArrow a1 b1 -&gt; FreeArrow a2 b2 -&gt; FreeArrow (a1, a2) (b1, b2)\nderiving instance Show (FreeArrow a b)\n\ninstance Category FreeArrow where id = LeafArrow; (.) = flip SeqArrow\n\ninstance Arrow FreeArrow where\n    arr = const LeafArrow\n    first = flip ParArrow id\n    second = ParArrow id\n    (***) = ParArrow\n</code></pre>\n\n<p>In fact you can now use <code>show</code> on an <strong>arbitrary</strong> arrow,</p>\n\n<pre><code>*Main&gt; show (LeafArrow :: FreeArrow () (IO String))\n\"LeafArrow\"\n</code></pre>\n\n<p>whereas with your code above you could not even create that value because the <code>LeafArrow</code> constructor demanded a <code>Show</code> instance for <code>IO String</code>, which can't provide it. And your intended code works easily:</p>\n\n<pre><code>*Main&gt; :set -XArrows\n*Main&gt; print $ proc v -&gt; (LeafArrow :: FreeArrow Double Double) -&lt; v\nSeqArrow LeafArrow (SeqArrow LeafArrow LeafArrow)\n</code></pre>\n\n<p>We can do all of this because your \"how it was constructed\" information does not actually use the <code>Show x</code> typeclass to define the <code>Show x</code> instance for any of its instances.</p>\n\n<h1>How to do what I think you were trying to do</h1>\n\n<p>The only reason I can \"fix\" the stuff above is that you're not introspecting deep into the parameters involved -- which is I think what you want out of the <code>Show</code> type class. In fact you need to define a wholly different type class to get this sort of type information available from the Haskell runtime (unless I'm totally mistaken):</p>\n\n<pre><code>class TypeOf t where\n    -- the integer here is 10 for type-constructor application, otherwise it is\n    -- the precedence of the enclosing type-construction-operator.\n    typePrec :: Int -&gt; t -&gt; String -&gt; String\n    typePrec _ t = (typeof t ++)\n    typeof :: t -&gt; String\n    typeof t = typePrec 0 t \"\" -- starts at 0 if we have no other info.\n\ninstance TypeOf Int where typeof _ = \"Int\"\n\ninstance (TypeOf x) =&gt; TypeOf [x] where\n    typeof list = \"[\" ++ typeof (head list) ++ \"]\"\ninstance (TypeOf x, TypeOf y) =&gt; TypeOf (x, y) where\n    typeof x = \"(\" ++ typeof (fst x) ++ \", \" ++ typeof (snd x) ++ \")\"\n\n-- Some helper functions for precedence parsing:\narg f x = typePrec 10 (f x)\npIf m n expr | m &lt;= n    = ('(' :) . expr . (')' :)\n             | otherwise = expr\na &lt;**&gt; b = a . (' ' :) . b\ninfixr 1 &lt;**&gt;\n\ninstance (TypeOf x) =&gt; TypeOf (IO x) where\n    typePrec n x = pIf 10 n $ (\"IO\" ++) &lt;**&gt; arg io x\n        where io = undefined :: IO x -&gt; x\n\ninstance (TypeOf x, TypeOf y) =&gt; TypeOf (Either x y) where\n    typePrec n x = pIf 10 n $ (\"Either\" ++) &lt;**&gt; arg left x &lt;**&gt; arg right x\n        where left  = undefined :: Either x y -&gt; x\n              right = undefined :: Either x y -&gt; y\n</code></pre>\n\n<p>First, there may be a way to write a C-based extension to Haskell which instead provides <code>typeof :: x -&gt; String</code> for all x to Haskell; then you could hypothetically get by with just adding a string parameter to your arrows. Let's skip this possibility.</p>\n\n<p>The biggest problem above is the <code>(.)</code> from <code>Control.Category</code>, which explicitly forbids access to the internal type <code>b</code> when composing <code>cat a b</code> with <code>cat b c</code>. Overcoming that is going to be very difficult. You can't thread any phantom-type data through <code>cat</code> unless you can protect <code>cat</code> from changing types. </p>\n\n<p>A secondary problem is that you're really trying to annotate an existing arrow with metadata rather than defining your own arrow to probe a structure. Along those lines you might look into this crazy pathway:</p>\n\n<pre><code>Prelude Control.Arrow Control.Monad.Free Control.Monad.Identity&gt; :set prompt \"ghci&gt; \"\nghci&gt; type MyArrow = Kleisli Identity\nghci&gt; let x = arr (3*) :: Kleisli (Free (ArrowMonad MyArrow)) Int Int\nghci&gt; :t x\nx :: Kleisli (Free (ArrowMonad MyArrow)) Int Int\n</code></pre>\n\n<p>Basically what we're looking for here is to use <code>typeof</code> to somehow \"walk\" the tree that is here embodied by the <code>Free</code> monad.</p>\n\n<p>There are obvious restrictions preventing us from saying \"this is only an arrow if both its input and its output implement <code>TypeOf</code>\" (namely, <code>arr</code> will not have the needed <code>TypeOf</code> constraint), so those types can't be hidden as a string in the constructor; they also can't be hidden in a phantom type because it says <code>cat b c -&gt; cat a b -&gt; cat a c</code>, which are the only two obvious ways to store the intermediary types). But there is not, as far as I can see, any obvious restriction to having a class which, at the end of constructing our values, is built of things which simultaneously implement <code>Arrow</code> and <code>TypeOf</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 4973303, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XYaBD6jNc4Q/AAAAAAAAAAI/AAAAAAAAAsg/gB9qk5i4Hk4/photo.jpg?sz=128", "display_name": "NCrashed", "link": "https://stackoverflow.com/users/4973303/ncrashed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 1, "accepted_answer_id": 30676056, "answer_count": 1, "score": 4, "last_activity_date": 1433539455, "creation_date": 1433416862, "question_id": 30642527, "link": "https://stackoverflow.com/questions/30642527/rebindable-syntax-for-arrow-with-constraint", "title": "Rebindable syntax for arrow with constraint", "body": "<p>Consider a free arrow which the only task is remember how it was constructed. And I want to put some constraint (e.x. Show) on arguments of the arrow: </p>\n\n<pre><code>data FreeArrow a b where \n  LeafArrow :: (Show a, Show b) =&gt; FreeArrow a b \n  SeqArrow :: (Show a, Show b, Show c) =&gt; FreeArrow a b -&gt; FreeArrow b c -&gt; FreeArrow a c\n  ParArrow :: (Show a1, Show b1, Show a2, Show b2) =&gt; FreeArrow a1 b1 -&gt; FreeArrow a2 b2 -&gt; FreeArrow (a1, a2) (b1, b2)\n\nderiving instance Show (FreeArrow a b)\n</code></pre>\n\n<p>To define Arrow instance for FreeArrow we need to define restricted versions of Category and Arrow:</p>\n\n<pre><code>class Category cat where\n    id :: Show a =&gt; cat a a\n    (.) :: (Show a, Show b, Show c) =&gt; cat b c -&gt; cat a b -&gt; cat a c\n\nclass Category a =&gt; Arrow a where\n    arr :: (Show b, Show c) =&gt; (b -&gt; c) -&gt; a b c\n    first :: (Show b, Show c, Show d) =&gt; a b c -&gt; a (b,d) (c,d)\n    second :: (Show b, Show c, Show d) =&gt; a b c -&gt; a (d,b) (d,c)\n    (***) :: (Show b, Show c, Show b', Show c') =&gt; a b c -&gt; a b' c' -&gt; a \n    (&amp;&amp;&amp;) :: (Show b, Show c, Show c') =&gt; a b c -&gt; a b c' -&gt; a b (c,c')\n</code></pre>\n\n<p>There are the instances:</p>\n\n<pre><code>instance Category FreeArrow where \n  id = LeafArrow\n  (.) = flip SeqArrow\n\ninstance Arrow FreeArrow where \n  arr _ = LeafArrow\n  first f = ParArrow f id\n  second f = ParArrow id f \n  (***) = ParArrow\n</code></pre>\n\n<p>The approach operates well for hand-written arrows:</p>\n\n<pre><code>myArrow :: FreeArrow Double Double\nmyArrow = (a &amp;&amp;&amp; a) &gt;&gt;&gt; arr (uncurry (+))\n  where a :: FreeArrow Double Double\n        a = LeafArrow\n\nmain :: IO ()\nmain = print myArrow\n</code></pre>\n\n<p>Will print: </p>\n\n<pre><code>SeqArrow (SeqArrow LeafArrow (ParArrow LeafArrow LeafArrow)) LeafArrow\n</code></pre>\n\n<p>But for arrow syntax (GHC 7.8.3):</p>\n\n<pre><code>myArrow :: FreeArrow Double Double\nmyArrow = proc v -&gt; a -&lt; v\n  where a :: FreeArrow Double Double\n        a = LeafArrow\n\nmain :: IO ()\nmain = print myArrow\n</code></pre>\n\n<p>I got errors like:</p>\n\n<pre><code>/home/ncrashed/dev/haskell/ArrowProblem.hs:54:11:\n    No instance for (Show c) arising from a use of \u2018arr\u2019\n    Possible fix:\n      add (Show c) to the context of\n        a type expected by the context: (b -&gt; c) -&gt; FreeArrow b c\n    In the expression: arr\n    When checking that \u2018arr\u2019 (needed by a syntactic construct)\n      has the required type: forall b1 c1. (b1 -&gt; c1) -&gt; FreeArrow b1 c1\n      arising from a proc expression\n      at /home/ncrashed/dev/haskell/ArrowProblem.hs:1:1\n    In the expression: proc v -&gt; a -&lt; v\n\n/home/ncrashed/dev/haskell/ArrowProblem.hs:54:11:\n    No instance for (Show c) arising from a use of \u2018&gt;&gt;&gt;\u2019\n    Possible fix:\n      add (Show c) to the context of\n        a type expected by the context:\n          FreeArrow a b -&gt; FreeArrow b c -&gt; FreeArrow a c\n    In the expression: (&gt;&gt;&gt;)\n    When checking that \u2018(&gt;&gt;&gt;)\u2019 (needed by a syntactic construct)\n      has the required type: forall a1 b1 c1.\n                             FreeArrow a1 b1 -&gt; FreeArrow b1 c1 -&gt; FreeArrow a1 c1\n      arising from a proc expression\n      at /home/ncrashed/dev/haskell/ArrowProblem.hs:1:1\n    In the expression: proc v -&gt; a -&lt; v\n\n/home/ncrashed/dev/haskell/ArrowProblem.hs:54:11:\n    No instance for (Show d) arising from a use of \u2018first\u2019\n    Possible fix:\n      add (Show d) to the context of\n        a type expected by the context:\n          FreeArrow b c -&gt; FreeArrow (b, d) (c, d)\n    In the expression: first\n    When checking that \u2018first\u2019 (needed by a syntactic construct)\n      has the required type: forall b1 c1 d1.\n                             FreeArrow b1 c1 -&gt; FreeArrow (b1, d1) (c1, d1)\n      arising from a proc expression\n      at /home/ncrashed/dev/haskell/ArrowProblem.hs:1:1\n</code></pre>\n\n<p>Is there any way to fix this? Is that a bug?</p>\n\n<p>Perhaps I should fall back to <a href=\"http://hackage.haskell.org/package/arrowp\" rel=\"nofollow\">arrowp</a> preprocessor...</p>\n\n<p>P.S. <a href=\"https://www.fpcomplete.com/user/NCrashed/arrow-syntax-problem\" rel=\"nofollow\">There</a> is a full sample of the code </p>\n"}, {"tags": ["haskell", "monads", "category-theory"], "comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1433433611, "post_id": 30641500, "comment_id": 49360953, "body": "<code>contrabind</code> is a transformation from the next value you have not seen yet to the previous value. It doesn&#39;t make sense - I wonder if it can be used for building reverse sequences where your data in the origin is manipulated based on what you later passed to it - but in a purely functional language it&#39;d make no way to extract it unless it&#39;s also a monad. Interesting question."}], "answers": [{"comments": [{"owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 0, "creation_date": 1433415672, "post_id": 30642002, "comment_id": 49348161, "body": "Your Monad definition is not full. You must add <code>fmap :: (a -&gt; b) -&gt; (m a -&gt; m b)</code>, which can be reversed."}, {"owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 0, "creation_date": 1433415821, "post_id": 30642002, "comment_id": 49348261, "body": "No, <code>pure</code> and <code>join</code> are not enough. If not convinced, try to implement <code>bind</code> in terms of only <code>pure</code> and <code>join</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 1, "creation_date": 1433416145, "post_id": 30642002, "comment_id": 49348512, "body": "@ZhekaKozlov: sure, I forgot writing the <code>Functor</code> superclass."}, {"owner": {"reputation": 3038, "user_id": 2725031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a052ac048fc2c1c0df69dd66100e9c06?s=128&d=identicon&r=PG&f=1", "display_name": "Marcin \u0141o\u015b", "link": "https://stackoverflow.com/users/2725031/marcin-%c5%81o%c5%9b"}, "reply_to_user": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 0, "creation_date": 1433416150, "post_id": 30642002, "comment_id": 49348519, "body": "@ZhekaKozlov hmm true - sorry."}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 4, "creation_date": 1452124253, "post_id": 30642002, "comment_id": 57035915, "body": "I believe ContraApp is Divisible, and it is very useful: <a href=\"https://hackage.haskell.org/package/contravariant-1.3.3/docs/Data-Functor-Contravariant-Divisible.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/contravariant-1.3.3/docs/&hellip;</a> - but it&#39;s a little different to what you&#39;ve got"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 17, "last_activity_date": 1433417261, "last_edit_date": 1433417261, "creation_date": 1433415368, "answer_id": 30642002, "question_id": 30641500, "link": "https://stackoverflow.com/questions/30641500/are-there-contravariant-monads/30642002#30642002", "title": "Are there contravariant monads?", "body": "<p>A contravariant functor is a functor from one category into its <a href=\"https://en.wikipedia.org/wiki/Opposite_category\">opposite category</a>, i.e. from one category into another (albeit closely related) one. OTOH, a monad is foremostly an <em>endofunctor</em> i.e. from one category into <em>itself</em>. So it can't be contravariant.</p>\n\n<p>This kind of stuff always tends to be a lot clearer when you consider the &ldquo;fundamental mathematical&rdquo; definition of monads:</p>\n\n<pre><code>class Functor m =&gt; Monad m where\n  pure :: a -&gt; m a\n  join :: m (m a) -&gt; m a\n</code></pre>\n\n<p>As you see there aren't really any arrows in there that you could turn around in the result, like you did with <code>contrabind</code>. Of course there is</p>\n\n<pre><code>class Functor n =&gt; Comonad n where\n  extract :: n a -&gt; a\n  duplicate :: n a -&gt; n (n a)\n</code></pre>\n\n<p>but comonads are still covariant functors.</p>\n\n<p>Unlike monads, applicatives (<a href=\"https://en.wikipedia.org/wiki/Monoidal_functor\">monoidal functors</a>) needn't be endofunctors, so I believe these <em>can</em> be turned around. Let's start from the &ldquo;fundamental&rdquo; definition:</p>\n\n<pre><code>class Functor f =&gt; Monoidal f where\n  pureUnit :: () -&gt; f ()\n  fzipWith :: ((a,b)-&gt;c) -&gt; (f a, f b)-&gt;f c  -- I avoid currying to make it clear what the arrows are.\n</code></pre>\n\n<p>(exercise: define a derived <code>Applicative</code> instance in terms of this, and vice versa)</p>\n\n<p>Turning it around</p>\n\n<pre><code>class Contravariant f =&gt; ContraApp f where\n  pureDisunit :: f () -&gt; ()\n  fcontraunzip :: ((a,b)-&gt;c) -&gt; f c-&gt;(f a, f b)\n                            -- I'm not sure, maybe this should\n                            -- be `f c -&gt; Either (f a) (f b)` instead.\n</code></pre>\n\n<p>No idea how useful that would be. <code>pureDisunit</code> is certainly not useful, because its only implementation is always <code>const ()</code>.</p>\n\n<p>Let's try writing the obvious instance:</p>\n\n<pre><code>newtype Opp a b = Opp { getOpp :: b -&gt; a }\n\ninstance Contravariant (Opp a) where\n  contramap f (Opp g) = Opp $ g . f\n\ninstance ContraApp (Opp a) where\n  pureDisunit = const ()\n  fcontraunzip z (Opp g)\n     = (Opp $ \\a -&gt; ???, Opp $ \\b -&gt; ???) -- `z` needs both `a` and `b`, can't get it!\n</code></pre>\n\n<p>I don't think this is useful, though you might be able to define it with something like clever knot-tying recursion.</p>\n\n<p>What might be more interesting is a <em>contravariant co-monoidal functor</em>, but this gets too weird for me right now.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1433417895, "post_id": 30642831, "comment_id": 49349677, "body": "Good point about the composition of two contravariants being covariant."}, {"owner": {"reputation": 123, "user_id": 3208518, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o7J0F.jpg?s=128&g=1", "display_name": "fosco", "link": "https://stackoverflow.com/users/3208518/fosco"}, "edited": false, "score": 0, "creation_date": 1539987072, "post_id": 30642831, "comment_id": 92713218, "body": "The correspondence sending a category to its category of presheaves is a monad, and it is contravariant (this is not 100% accurate, but it can be made accurate). I believe presheaves are pretty useful :-)"}], "tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": true, "score": 25, "last_activity_date": 1433417838, "creation_date": 1433417838, "answer_id": 30642831, "question_id": 30641500, "link": "https://stackoverflow.com/questions/30641500/are-there-contravariant-monads/30642831#30642831", "title": "Are there contravariant monads?", "body": "<p>Well, of course, it's possible to define it, but I doubt it would be of any use.</p>\n\n<p>There is a popular saying that \"monad is just a monoid in a category of endofunctors\". What it means is, first of all, that we have a category of endofunctors (meaning, (covariant) functors from some category to itself), and what's more, we have some multiplication on this endofunctors (in this case \u2014 composition). And then monad fits into some general framework that we don't have to worry about right now. The point is, there is no \"multiplication\" of contravariant functors. Composition of two covariant functors is again a covariant functor; but composition of two contravariant functors is not a contravariant functor (rather it's a covariant functor, so, a totally different beast).</p>\n\n<p>So, \"contravariant monads\" do not really make sense.</p>\n"}], "owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1800, "favorite_count": 4, "accepted_answer_id": 30642831, "answer_count": 2, "score": 21, "last_activity_date": 1433420066, "creation_date": 1433413979, "last_edit_date": 1433417481, "question_id": 30641500, "link": "https://stackoverflow.com/questions/30641500/are-there-contravariant-monads", "title": "Are there contravariant monads?", "body": "<p>Functors can be covariant and contravariant. Can this covariant/contravariant duality also be applied to monads?</p>\n\n<p>Something like:</p>\n\n<pre><code>class Monad m where\n  return :: a -&gt; m a\n  (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b    \n\nclass ContraMonad m where\n  return :: a -&gt; m a\n  contrabind :: m a -&gt; (b -&gt; m a) -&gt; m b\n</code></pre>\n\n<p>Does <code>ContraMonad</code> class make sense? Any examples?</p>\n"}, {"tags": ["haskell", "benchmarking", "criterion"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1433410995, "post_id": 30640295, "comment_id": 49345024, "body": "Does trying to query the length of the encoded ByteString help?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1433426806, "post_id": 30640295, "comment_id": 49355838, "body": "Try using <code>nf</code> instead of <code>whnf</code>.  There&#39;s a reason it&#39;s there!"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1433428195, "post_id": 30640295, "comment_id": 49356938, "body": "&quot;we end up getting \u03bcs-results&quot; is that faster or slower than what you expected? Both <code>whnf</code> and <code>nf</code> are useful things to measure. I would suggest that if you use <code>nf</code> on benchmarks in the low microseconds range that you also do a benchmark like <code>nf (\\x-&gt; x) outputOfEncodeAbove</code> which will give you an estimate of the overhead of the fully evaluating your (already fully-evaluated) data. I think criterion should try to account for this itself, but doesn&#39;t appear to."}], "owner": {"reputation": 2090, "user_id": 1610555, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3ab63b360643d119edf9347bac19492b?s=128&d=identicon&r=PG", "display_name": "Marc Juchli", "link": "https://stackoverflow.com/users/1610555/marc-juchli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 370, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1433410688, "creation_date": 1433410688, "question_id": 30640295, "link": "https://stackoverflow.com/questions/30640295/haskell-criterion-benchmark-on-lazy-encode", "title": "Haskell Criterion Benchmark on lazy encode", "body": "<p>We're trying to benchmark binary encoding with <a href=\"https://hackage.haskell.org/package/criterion-0.5.0.5\" rel=\"nofollow\">Criterion</a>.\nSince the data types are strict, we are perfectly able to benchmark the process of packing a Request. </p>\n\n<p>However, one step further by trying to benchmark the process of encode (Request to ByteString) using <a href=\"https://hackage.haskell.org/package/binary-0.5.0.1/docs/Data-Binary-Put.html\" rel=\"nofollow\">runPut</a> we end up getting \u03bcs-results. This is probably due to lazy bytestring evaluation.</p>\n\n<pre><code>encode = runPut . buildRqMessage\n\nmain = do\n\n  randBytes &lt;- getEntropy 1000000\n  let !topicA = stringToTopic \"performance-0\"\n  let !topicB = stringToTopic \"performance-1\"\n  let !clientId = stringToClientId \"benchmark-producer\"\n  let !bytes = [randBytes | x &lt;- [1..1]]\n  let !head = Head 0 0 clientId\n  let !prod = [ ToTopic topicA [ ToPart 0 bytes ] ]\n\n  defaultMain [\n      bgroup \"encode\" [\n             bench \"pack\" $ whnf (packPrRqMessage head) prod\n           , bench \"pack+build\" $ whnf encode (packPrRqMessage head prod)\n        ]\n    ]\n</code></pre>\n\n<p>Is there a way to benchmark the encode process appropriately?</p>\n"}, {"tags": ["haskell", "common-lisp", "typeclass"], "comments": [{"owner": {"reputation": 127093, "user_id": 69545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXXbv.jpg?s=128&g=1", "display_name": "Rainer Joswig", "link": "https://stackoverflow.com/users/69545/rainer-joswig"}, "edited": false, "score": 2, "creation_date": 1433404290, "post_id": 30637469, "comment_id": 49340616, "body": "Stackoverflow best for real actual programming problems, not so good for speculation if programming language A could support features of programming language B..."}, {"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "reply_to_user": {"reputation": 127093, "user_id": 69545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXXbv.jpg?s=128&g=1", "display_name": "Rainer Joswig", "link": "https://stackoverflow.com/users/69545/rainer-joswig"}, "edited": false, "score": 0, "creation_date": 1433463490, "post_id": 30637469, "comment_id": 49375344, "body": "I did hesitate to post here, thought it was really a question of not just whether, but also how such a feature could be implemented(which is a programming concern, no?). Anyway, I&#39;ll keep that in mind."}, {"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 2, "creation_date": 1435017613, "post_id": 30637469, "comment_id": 50013137, "body": "I want to know whether Lisp can do it. Even if whether Lisp can be like Haskell is not relevant, whether Lisp can do typeclasses is a legitimate question."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433411155, "post_id": 30639304, "comment_id": 49345127, "body": "Haskell&#39;s instance dictionaries are not particularly more static than C++&#39;s vtables. They specialize at compile time when possible, but otherwise they are indeed passed at runtime."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1433414065, "post_id": 30639304, "comment_id": 49347098, "body": "passed at runtime but there is no dynamic lookup because there&#39;s no dynamic dispatch because there is no subtype polymorphism aka (type) inheritance \u2014 have I missed something?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433424890, "post_id": 30639304, "comment_id": 49354440, "body": "I&#39;m not sure. It seems the terminology is a bit fuzzy. In the presence of polymorphic recursion (even in Haskell 98) or GADTs (in real Haskell), a specific type may not be knowable, and a specific instance may not quite exist, until runtime. Isn&#39;t that the essence of dynamic dispatch?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1433463885, "post_id": 30639304, "comment_id": 49375449, "body": "I&#39;m possibly not experienced enough: can you provide an example? I&#39;d like to learn. Also, if what you say is true, doesn&#39;t that mean Haskell has RTTI and not complete runtime type erasure?"}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 2, "last_activity_date": 1433414160, "last_edit_date": 1433414160, "creation_date": 1433408061, "answer_id": 30639304, "question_id": 30637469, "link": "https://stackoverflow.com/questions/30637469/typeclasses-in-common-lisp/30639304#30639304", "title": "Typeclasses in Common Lisp", "body": "<p>Type classes in Haskell are a means to statically look up implementations for \"interfaces\" in the form of dictionaries (similarly to how vtables in e.g. C++ are used but (almost) fully statically, unlike C++ which does dynamic dispatch at runtime). Common Lisp however is a dynamically typed language so such lookup would make no sense. However you can implement your own look up of \"type class\" implementations (instances) at runtime \u2014 a design not too hard to imagine in a language as expressive as Common Lisp. </p>\n\n<p>P.S. Python's Zope has an adaption mechanism with very similar charactetistics, if you feel like referring to an existing solution in a dynamic setting. </p>\n"}, {"tags": [], "owner": {"reputation": 4456, "user_id": 4127569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b728c7d6c1dce81f5a82249b7617756?s=128&d=identicon&r=PG&f=1", "display_name": "jch", "link": "https://stackoverflow.com/users/4127569/jch"}, "is_accepted": false, "score": -1, "last_activity_date": 1433465426, "last_edit_date": 1433465426, "creation_date": 1433465071, "answer_id": 30656560, "question_id": 30637469, "link": "https://stackoverflow.com/questions/30637469/typeclasses-in-common-lisp/30656560#30656560", "title": "Typeclasses in Common Lisp", "body": "<p>You cannot modify the class hierarchy in the way you envision, but you can achieve pretty much the same effect.</p>\n\n<p>Suppose that your definition of a <code>sequence</code> is that it has a method for the function <code>sequence-length</code>.</p>\n\n<pre><code>(defclass sequence ...)\n(defmethod sequence-length ((s sequence)) ...)\n</code></pre>\n\n<p>Then you can easily extend your <code>sequence-length</code> method to conses:</p>\n\n<pre><code>(defmethod sequence-length ((s cons))\n    (length s))\n</code></pre>\n\n<p>Did that create a new class that includes <code>cons</code>?  Not really.  You can express the type of things that have a <code>sequence-length</code> method by saying <code>(or sequence cons)</code>, but that's not really useful.</p>\n"}], "owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 689, "favorite_count": 1, "answer_count": 2, "score": 7, "last_activity_date": 1433465426, "creation_date": 1433402438, "last_edit_date": 1433403121, "question_id": 30637469, "link": "https://stackoverflow.com/questions/30637469/typeclasses-in-common-lisp", "title": "Typeclasses in Common Lisp", "body": "<p>I'm wondering if there's a way to emulate Haskell's <code>typeclasses</code> in Common Lisp. </p>\n\n<p>Generic functions allow <code>overloading</code>, and it's possible to define types using <code>deftype</code>(which could be defined by membership to some list of instances, for example).  </p>\n\n<p>But I can't <code>dispatch</code> on a type. Is there a way to make a class a subclass(and a subtype) of some other class after its definition(e.g. making the <code>cons</code> class a subclass of a <code>sequence</code> class, without redefining <code>cons</code>)?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "monads", "st"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1433401269, "post_id": 30636767, "comment_id": 49338908, "body": "You can&#39;t have 2 and 3 at the same time. <code>save</code> and <code>restore</code> are safe because they copy the underlying vector. Without copying nothing would prevent mutating a supposedly immutable value. Couldn&#39;t you just avoid saving and restoring by doing all (or most) of the work in a single ST scope or inside IO?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1433423637, "post_id": 30636767, "comment_id": 49353537, "body": "Alternatively, this might be a case where <code>unsafeInterleaveST</code> is a good choice for &quot;purifying&quot; incremental operations."}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1433462412, "creation_date": 1433462412, "answer_id": 30656187, "question_id": 30636767, "link": "https://stackoverflow.com/questions/30636767/how-to-store-st-monad-thing/30656187#30656187", "title": "How to store ST monad thing?", "body": "<p>You shouldn't try to manipulate the generator outside of the ST monad. Because of the type of <code>runST</code>, trying to use things which live \"inside\" the state thread \"outside\" of it is non-nonsensical. Imagine you had a function of the following type (which is the function you are trying to write): </p>\n\n<pre><code>something :: MWC.Gen s -&gt; Int\nsomething gen = runST ... \n</code></pre>\n\n<p>In order to generate random numbers, some stateful computations must be done with the data inside of the <code>Gen</code>. At which point will those computations be done? How many times will they be done, if at all? Most importantly - how can <code>something</code> be generating random numbers - it is a pure function, after all, so it must return the same value for the same input. </p>\n\n<p>Instead, you should thread the state along, and call <code>runST</code> at the end:</p>\n\n<pre><code>something :: MWC.Gen s -&gt; ST s Int \nsomething = MWC.uniformR (1,100) \n\nmain = mapM_ print $ runST $ do \n  w0 &lt;- initWorld \n  replicateM 100 (something $ randomGen w0)\n</code></pre>\n"}], "owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1433462412, "creation_date": 1433400288, "question_id": 30636767, "link": "https://stackoverflow.com/questions/30636767/how-to-store-st-monad-thing", "title": "How to store ST monad thing?", "body": "<p>I want to handle/store random generator(<code>Gen (ST {..}</code>) outside of <code>ST</code> monad, but I couldn't find how to do.</p>\n\n<h1>Background</h1>\n\n<p>I'm under working for some simulation which uses random heavily.\nWith profiling, I knew that make random numbers takes more than 50% of process time.</p>\n\n<p>To make random number, I use <a href=\"http://hackage.haskell.org/package/mwc-random\" rel=\"nofollow\">mwc-random</a> and <a href=\"http://hackage.haskell.org/package/sfmt\" rel=\"nofollow\">SFMT</a>.<br>\nBecause of speed issue, I mainly use <code>SFMT</code>.<br>\nHowever, comeparing with <code>SFMT</code>, <code>mwc-random</code> have richer interfaces that I need(like <code>normal</code>, <code>bernoulli</code>, ..).</p>\n\n<p>After benchmark and read codes, I understand that <code>mwc-random</code> is not too slow than <code>SFMT</code> when it is used on <code>ST</code> monad.<br>\n(<code>SFMT</code> on <code>IO</code> &lt; <code>MWC</code> on <code>ST</code> &lt;&lt; <code>MWC</code> on <code>IO</code> &lt; <code>SFMT</code> on <code>ST</code>)<br>\nSo, I want to make and handle <code>MWC</code> random generator on <code>ST</code> monad. \nHowever, I cannot take this generator out from <code>ST</code> monad as same as other <code>ST</code> things(e.g. <code>STRef</code>).</p>\n\n<h1>Problem</h1>\n\n<p>Is there any way to handle/store this random generator outside of <code>ST</code> monad <b>safely</b>?</p>\n\n<p>I tried to study from many packages/codes with <code>STRef</code> or something others, but I couldn't figure it out.</p>\n\n<h1>Example</h1>\n\n<p>I use random generator in the simulation like this way.</p>\n\n<pre><code>import qualified System.Random.MWC as MWC\nimport GHC.Prim\nimport Control.Monad\n\ndata World = World { randomGen :: MWC.Gen RealWorld }\n\ninitWorld = do gen &lt;- MWC.create\n               return $ World gen\n\nsomething gen = do num &lt;- MWC.uniformR (1,100) gen :: IO Int\n                   print num\n\nmain = do world &lt;- initWorld\n          replicateM_ 100 $ something (randomGen world)\n</code></pre>\n\n<p>But, this code does not works.</p>\n\n<pre><code>import qualified System.Random.MWC as MWC\nimport Control.Monad\nimport Control.Monad.Primitive\nimport Control.Monad.ST\n\ndata World s = World { randomGen :: MWC.Gen (PrimState (ST s))}\n\ninitWorld :: ST s (World s)\ninitWorld = do gen &lt;- MWC.create\n               return $ World gen\n\nsomething gen = do\n    let num :: Int\n        num = runST $ do num &lt;- MWC.uniformR (1,100) gen\n                         return num\n    print num\n\nmain = do let world = runST initWorld\n          replicateM_ 100 $ something (randomGen world)\n</code></pre>\n\n<p>I want rewrite this code to work with <code>something</code>.\nDo I need to define/rewrite data structure or do something other?\nIs there more smart way?</p>\n\n<h2>Points:</h2>\n\n<ol>\n<li>I need to handle a random generator (like <code>Gen (PrimState (ST s))</code>) to reproduce results.<br>\nSo, I do not want to produce ad-hoc random generator.</li>\n<li>I do not wants to save/restore seed. It has too big overhead.\n(save/restore seed takes x12~15 time more than generate one random number)<br>\nIt is slower than using on IO monad, so I do not need to do on <code>ST</code> monad.</li>\n<li>I do not want to use unsafe* functions.</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1433389590, "post_id": 30634449, "comment_id": 49334389, "body": "Why do you want to use <code>Data.Vector</code> for this? A more specific library is almost certainly the way to go. But if you want to try it with these vectors, you should 1. Switch to the &quot;unboxed&quot; versions for speed, and 2. look into vector slicing operations to skip a row/column."}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 3259459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd017478375b2a025df02e771397eaf1?s=128&d=identicon&r=PG", "display_name": "Felipe Jacob", "link": "https://stackoverflow.com/users/3259459/felipe-jacob"}, "edited": false, "score": 0, "creation_date": 1464213950, "post_id": 37404078, "comment_id": 62398635, "body": "Thanks! This is the kind of answer I was looking for. I think the foldl and map capture the essence of each vector operation, and I can imagine how this generalises to more complex algorithms."}], "tags": [], "owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "is_accepted": true, "score": 4, "last_activity_date": 1464061945, "creation_date": 1464061945, "answer_id": 37404078, "question_id": 30634449, "link": "https://stackoverflow.com/questions/30634449/idiomatic-vector-algebra-in-haskell/37404078#37404078", "title": "Idiomatic Vector Algebra in Haskell", "body": "<p>I'd start with a +1 for dfeuer; a more specific library will almost certainly be both cleaner and more efficient.</p>\n\n<p>However, if what you are looking for is a more idiomatic implementation of your <code>centroid</code> function, I like this one:</p>\n\n<pre><code>centroid' :: Simplex -&gt; Int -&gt; Node\ncentroid' s iz = let t = foldl1 (V.zipWith (+)) (V.drop iz s)\n                     n = fromIntegral (V.length t - 1)\n                 in V.map (/ n) t\n</code></pre>\n\n<p>One general comment on your version: it's very easy to create \"write-only\" Haskell code. There is so much going on in your first line that it is difficult to parse. Your <code>where</code> block is step in the right direction, but I'd go even further to break out the conceptual components.</p>\n\n<p>Also, <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">Hoogle</a>. I didn't know there existed a function <code>drop</code>, but I knew that if it existed, it took an <code>Int</code> and a <code>Vector</code> onto a new <code>Vector</code>. Hoogle doesn't index <code>Vector</code>, but the API for vector is very similar to the API for lists. I searched for \"[a] -> Int -> [a]\" and \"Int -> [a] -> [a]\" and found <code>drop</code>.</p>\n\n<p>(<a href=\"https://www.stackage.org/\" rel=\"nofollow\">Stackage</a> does index <code>Vector</code>, so search for \"Int -> Vector a -> Vector a\" works there)</p>\n"}], "owner": {"reputation": 173, "user_id": 3259459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd017478375b2a025df02e771397eaf1?s=128&d=identicon&r=PG", "display_name": "Felipe Jacob", "link": "https://stackoverflow.com/users/3259459/felipe-jacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 37404078, "answer_count": 1, "score": 12, "last_activity_date": 1464061945, "creation_date": 1433388484, "question_id": 30634449, "link": "https://stackoverflow.com/questions/30634449/idiomatic-vector-algebra-in-haskell", "title": "Idiomatic Vector Algebra in Haskell", "body": "<p>As a way to practice with the vector library in Haskell, I'm trying to rewrite a Nelder-Mead minimization algorithm I had previously written in C. \nSo far I've been having a bit of trouble translating some vector operations idiomatically. </p>\n\n<p>For instance, consider a function which finds the centroid of n vectors out of a list of n+1 (filtering away one index), </p>\n\n<p>In C, this can be written as</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>static void get_centroid(double **s, int n, int iz,\n                         double *C)\n{\n  for (int i = 0; i &lt; n+1; i++) {\n    if (i != iz) {\n      for (int j = 0; j &lt; n; j++)\n        C[j] += s[i][j];\n    }\n  }\n  for (int j = 0; j &lt; n; j++)\n    C[j] /= n;\n}\n</code></pre>\n\n<p>I tried translating this into Haskell, and ended up with the following</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import Data.Vector\nimport qualified Data.Vector as V\n\ntype Node = Vector Double\n\ntype Simplex = Vector Node\n\ncentroid :: Simplex -&gt; Int -&gt; Node\ncentroid s iz = V.map (/ (fromIntegral $ V.length s)) $ V.zipWith (-) v (s ! iz) \n    where v = V.foldl go V.empty s \n        where go a b = V.zipWith (+) a b\n</code></pre>\n\n<p>I find this code quite inelegant, as it doesn't capture the essence of the vector algebra that's happening (and is also more inefficient since I'm adding and subtracting S[iz]). </p>\n\n<p>One solution would be to implement some kind of vector space typeclass or use a more specific linear algebra library, but since those are such common operations I was wondering if there's a more idiomatic 'straight' solution.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1433403578, "post_id": 30633064, "comment_id": 49340229, "body": "Related: <a href=\"http://stackoverflow.com/questions/28389008/haskell-non-exhaustive-pattern-checking-if-list-is-ascending\" title=\"haskell non exhaustive pattern checking if list is ascending\">stackoverflow.com/questions/28389008/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 13, "creation_date": 1433378581, "post_id": 30633116, "comment_id": 49331823, "body": "A one line version: <code>checkList xs = and $ zipWith (&lt;=) xs $ drop 1 xs</code>. (hopefully that works, I typed it in on my phone)"}, {"owner": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "edited": false, "score": 0, "creation_date": 1433379070, "post_id": 30633116, "comment_id": 49331969, "body": "Thanks guys. That was a dumb mistake"}, {"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "reply_to_user": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "edited": false, "score": 1, "creation_date": 1433388775, "post_id": 30633116, "comment_id": 49334205, "body": "@Walle, Please, accept the answer, if it was helpful for you."}, {"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1433389092, "post_id": 30633116, "comment_id": 49334272, "body": "@bheklilr, Why not just <code>tail xs</code> instead of <code>drop 1 xs</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 0, "creation_date": 1433390713, "post_id": 30633116, "comment_id": 49334663, "body": "@soon tail is broken for empty lists. We want to return True when the argument is empty, but tail would throw an error."}, {"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433391051, "post_id": 30633116, "comment_id": 49334745, "body": "@bheklilr, Shouldn&#39;t <code>zip</code> just produce <code>[]</code>, if the first argument is empty, without evaluating the second element? <code>zip [] undefined</code> produces <code>[]</code> as well."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 4, "creation_date": 1433391732, "post_id": 30633116, "comment_id": 49334917, "body": "@soon I just avoid the tail function on principle, if I never use it then I won&#39;t ever be bitten by it. It would work in this case, but there are plenty of cases where it wouldn&#39;t work so well. It&#39;s like why we pattern match instead of using head and other partial functions."}], "tags": [], "owner": {"reputation": 8263, "user_id": 32878, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e44c79ea155b0bca0a4027d9a38b11d0?s=128&d=identicon&r=PG", "display_name": "Jay Kominek", "link": "https://stackoverflow.com/users/32878/jay-kominek"}, "is_accepted": true, "score": 11, "last_activity_date": 1433378201, "creation_date": 1433378201, "answer_id": 30633116, "question_id": 30633064, "link": "https://stackoverflow.com/questions/30633064/check-if-the-list-is-ascending-haskell/30633116#30633116", "title": "Check if the list is ascending (Haskell)", "body": "<p>You want:</p>\n\n<pre><code>checkList :: (Ord a) =&gt; [a] -&gt; Bool\ncheckList [] = True\ncheckList [x] = True\ncheckList (x:y:xs) = x &lt;= y &amp;&amp; checkList (y:xs)\n</code></pre>\n\n<p>When you tried to use <code>[ ]</code> in the final pattern, you were saying \"match against a list that contains <code>x:y:xs</code> (also a list!) as its sole element\". Which doesn't match the type <code>[a]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1456779347, "post_id": 30650296, "comment_id": 59095666, "body": "You also have a potential space leak, I believe, because you force only the pair constructor as you go, and not the <code>Bool</code> within it."}], "tags": [], "owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "is_accepted": false, "score": 2, "last_activity_date": 1433438584, "creation_date": 1433438584, "answer_id": 30650296, "question_id": 30633064, "link": "https://stackoverflow.com/questions/30633064/check-if-the-list-is-ascending-haskell/30650296#30650296", "title": "Check if the list is ascending (Haskell)", "body": "<p>A somewhat ugly one using <code>foldl'</code></p>\n\n<pre><code>checkList :: Ord a =&gt; [a] -&gt; Bool\ncheckList xs = fst $ foldl' (\\(b,x1) x2 -&gt; (b &amp;&amp; x1 &lt;= x2,x2)) (True,head xs) xs\n</code></pre>\n\n<p>Note: Using <code>head xs</code> is OK here because of lazy evaluation.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1456808928, "last_edit_date": 1456808928, "creation_date": 1456772393, "answer_id": 35707405, "question_id": 30633064, "link": "https://stackoverflow.com/questions/30633064/check-if-the-list-is-ascending-haskell/35707405#35707405", "title": "Check if the list is ascending (Haskell)", "body": "<p>The usual way to do this is to make your tree foldable:</p>\n\n<pre><code>data BST a = Node (BST a) a (BST a) | Leaf\n\n-- Use `deriving Foldable` or this instance\ninstance Foldable BST where\n  foldMap _ Leaf = mempty\n  foldMap f (Node l v r) =\n    foldMap f l &lt;&gt; (f v &lt;&gt; foldMap f r)\n</code></pre>\n\n<p>Then you can skip conversion to a list like this. This is similar to bmk's answer, but avoids <code>head</code>.</p>\n\n<pre><code>-- Is this increasing? If so, what is the maximum?\ndata Result a = Empty | NotInc | Inc a\n\nfinalInc :: Result a -&gt; Bool\nfinalInc NotInc = False\nfinalInc _ = True \n\nincreasing :: (Foldable f, Ord a) =&gt; f a -&gt; Bool\nincreasing = finalInc . foldl' go Empty where\n  go Empty y = Inc y\n  go NotInc _ = NotInc\n  go (Inc x) y\n    | x &lt;= y = Inc y\n    | otherwise = NotInc\n</code></pre>\n\n<h3>Warning! Warning!</h3>\n\n<p>The property this checks is weaker than the traditional binary search tree property, and weaker than the commonly accepted ways to <em>weaken</em> that property. In particular, you generally want to ensure, at least, that the root of each subtree is <em>strictly</em> greater than all elements of its left subtree, or that the root of each subtree is <em>strictly</em> less than all elements of its right subtree. These weak properties <em>cannot</em> be expressed in terms of the <code>Foldable</code> instance or conversion to a list; they must be checked directly. You can, however, use these techniques to verify the classical BST property by simply replacing <code>&lt;=</code> with <code>&lt;</code>.</p>\n\n<hr>\n\n<h3>A remark on space</h3>\n\n<p>All of the answers, including this one, have a somewhat unfortunate property: given a very left-heavy tree (e.g., <code>Node (Node (...) 2 Leaf) 1 Leaf</code>) they will use <code>O(n)</code> additional space to verify the search tree property. Is there some way to write this so it won't have any such bad cases? Unfortunately, the answer seems to be no. The classical BST property can be stated thus:</p>\n\n<blockquote>\n  <p>Each node must be greater than all elements of its left subtree and less than all elements of its right subtree. </p>\n</blockquote>\n\n<p>The trouble is that \"and\". If we decide to check the left subtree first, we have to <em>remember</em> to check the right subtree afterwards, and vice versa.</p>\n\n<p>Thus the <em>only</em> way to make verification efficient is to ensure that the tree is balanced.</p>\n"}], "owner": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4920, "favorite_count": 1, "accepted_answer_id": 30633116, "answer_count": 3, "score": 7, "last_activity_date": 1456808928, "creation_date": 1433377929, "last_edit_date": 1456744295, "question_id": 30633064, "link": "https://stackoverflow.com/questions/30633064/check-if-the-list-is-ascending-haskell", "title": "Check if the list is ascending (Haskell)", "body": "<p>I am writing a function to check if a tree if a BST. All I've tried is to print the tree in an in-order traversal to a list and then check if the list is increasing. However I am having this error:</p>\n\n<pre><code>Couldn't match expected type `a' against inferred type `[t]'\n  `a' is a rigid type variable bound by\n      the type signature for `checkList' at BST.hs:24:18\nIn the pattern: x : y : xs\nIn the pattern: [x : y : xs]\nIn the definition of `checkList':\n    checkList [x : y : xs] = x &lt;= y &amp;&amp; checkList (y : xs)\n</code></pre>\n\n<p>Here is what I have so far (only a checkList function).</p>\n\n<pre><code>checkList :: (Ord a) =&gt; [a] -&gt; Bool\ncheckList [] = True\ncheckList [x] = True\ncheckList [x:y:xs] = x &lt;= y &amp;&amp; checkList (y:xs)\n</code></pre>\n"}]