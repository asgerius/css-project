[{"tags": ["list", "haskell", "char", "command-line-arguments"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1709237"}, "is_accepted": false, "score": 0, "last_activity_date": 1445469778, "creation_date": 1445469778, "answer_id": 33270918, "question_id": 33270692, "link": "https://stackoverflow.com/questions/33270692/haskell-getargs-type-is-char-instead-of-char/33270918#33270918", "title": "Haskell getArgs type is `Char` instead of `[Char`]", "body": "<p>As it turns out, it is a simple matter of parsing, the following code works</p>\n\n<pre><code>args &lt;- getArgs\nlet incomming = head args\nhandle \u2190  openFile incomming ReadMode\n</code></pre>\n\n<p>you have to parse the argument.</p>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 7, "last_activity_date": 1445474109, "last_edit_date": 1445474109, "creation_date": 1445469978, "answer_id": 33270946, "question_id": 33270692, "link": "https://stackoverflow.com/questions/33270692/haskell-getargs-type-is-char-instead-of-char/33270946#33270946", "title": "Haskell getArgs type is `Char` instead of `[Char`]", "body": "<p><code>openFile :: FilePath -&gt; IOMode -&gt; IO Handle</code> takes a <code>FilePath</code> and an <code>IOMode</code> and gives an <code>IO Handle</code>.</p>\n\n<p>This means that</p>\n\n<pre><code>do\n  args &lt;- getArgs\n  handle &lt;- openFile args ReadMode\n  ...\n</code></pre>\n\n<p>is claiming that <code>args</code> has type <code>FilePath</code>. However, the type of <code>getArgs :: IO [String]</code> means that <code>args</code> is a <code>[String]</code>, not a <code>FilePath</code>. This means that you are calling <code>openFile</code> with a list of strings rather than a file path.</p>\n\n<p>To fix this, first we must know that <code>FilePath</code> is just a type synonym for <code>String</code>, which means that we must take an element of <code>args</code> rather than the whole list.</p>\n\n<p>Here is an example that does so using pattern matching:</p>\n\n<pre><code>do\n  [arg] &lt;- getArgs\n  handle &lt;- openFile arg ReadMode\n  ...\n</code></pre>\n\n<p>However, if the caller of your program provides the wrong number of arguments, this will cause an obscure runtime error (generated by <code>fail</code> from the pattern matching failure). A more robust program might handle these cases with more descriptive failure messages:</p>\n\n<pre><code>do\n  args &lt;- getArgs\n  case args of\n    [] -&gt; error \"must supply a file to open\"\n    [arg] -&gt; do handle &lt;- openFile arg ReadMode\n                ...\n    _ -&gt; error \"too many arguments\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1709237"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4359, "favorite_count": 2, "accepted_answer_id": 33270946, "answer_count": 2, "score": 2, "last_activity_date": 1588277667, "creation_date": 1445468524, "last_edit_date": 1588277667, "question_id": 33270692, "link": "https://stackoverflow.com/questions/33270692/haskell-getargs-type-is-char-instead-of-char", "title": "Haskell getArgs type is `Char` instead of `[Char`]", "body": "<p>I am trying to get command line arguments to work with Haskell.  I currently have </p>\n\n<pre><code>args \u2190 getArgs\n-- opens text file, uses handle for text\nhandle \u2190  openFile args ReadMode\n</code></pre>\n\n<p>However, when I compile I am told that args is of type <code>Char</code>, not <code>[Char]</code>, therefore, I cannot open the file. Is there another way to take in arguments in Haskell or am I taking mine in incorrectly?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 0, "last_activity_date": 1445468510, "creation_date": 1445468510, "answer_id": 33270688, "question_id": 33270496, "link": "https://stackoverflow.com/questions/33270496/adding-list-to-an-empty-bag/33270688#33270688", "title": "Adding list to an empty bag", "body": "<p>Sure you can:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Bags where\n\ntype Bag a = [a]\n\nemptyBag :: Bag a\nemptyBag = []\n\nlistToBag :: Bag a -&gt; [a] -&gt; Bag a\nlistToBag = foldr (:)\n\nbagInsert :: Bag a -&gt; a -&gt; Bag a\nbagInsert = flip (:)\n</code></pre>\n\n<p>The expression <code>listToBag emptyBag [2,1,5,4,3]</code> evaluates to the bag <code>[2,1,5,4,3]</code>.</p>\n"}], "owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 33270688, "answer_count": 1, "score": -1, "last_activity_date": 1445468510, "creation_date": 1445467346, "question_id": 33270496, "link": "https://stackoverflow.com/questions/33270496/adding-list-to-an-empty-bag", "title": "Adding list to an empty bag", "body": "<p>I am trying to add an unordered list such as <code>[2,1,5,4,3]</code> to a bag, which can be treated as an empty list.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>module Bags where\n\nimport Data.List\nimport Prelude\n\n-- | Bag datatype\ntype Bag a = [a]\n\n-- | Empty bag\nemptyBag :: Bag a\nemptyBag = []\n\n-- | Put all elements from a list into a bag.\nlistToBag :: Bag a -&gt; [a] -&gt; Bag a\nlistToBag xs = foldr (\\x bag -&gt; bagInsert bag x) emptyBag xs\n</code></pre>\n\n<p>The function which inserts the element into the list is shown below</p>\n\n<pre><code>-- | Add an element to a bag.\nbagInsert :: Bag a -&gt; a -&gt; Bag a\nbagInsert b = (insert (+) emptyBag)\n</code></pre>\n\n<p>However, the <code>insert</code> function is for ordered elements. Is there away I could add these elements without rearranging their elements' respective positions within the list?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1445566916, "creation_date": 1445566916, "answer_id": 33293858, "question_id": 33269870, "link": "https://stackoverflow.com/questions/33269870/how-come-effect-seals-only-two-in-flows-instead-of-all-the-flows/33293858#33293858", "title": "How come `Effect` seals only two in-flows, instead of all the flows?", "body": "<p>You <strong>can</strong> run <code>myMonad</code> from your example, by just taking the existing definition of <code>runEffect</code> and generalizing its type somewhat:</p>\n\n<pre><code>import Pipes (lift)\nimport Pipes.Core (closed)\nimport Pipes.Internal\n\ntype Effect' a b = Proxy X a b X\n\n-- Definition copied straight from Pipes.Core, type generalized to Effect'\nrunEffect' :: Monad m =&gt; Effect' a b m r -&gt; m r\nrunEffect' = go\n  where\n    go p = case p of\n        Request v _ -&gt; closed v\n        Respond v _ -&gt; closed v\n        M       m   -&gt; m &gt;&gt;= go\n        Pure    r   -&gt; return r\n\neff :: Effect' X X IO ()\neff = do\n    a &lt;- lift $ getLine\n    lift $ print a\n    return ()\n\nmain :: IO ()\nmain = runEffect' eff\n</code></pre>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 2, "answer_count": 1, "score": 7, "last_activity_date": 1445566916, "creation_date": 1445464141, "last_edit_date": 1445464661, "question_id": 33269870, "link": "https://stackoverflow.com/questions/33269870/how-come-effect-seals-only-two-in-flows-instead-of-all-the-flows", "title": "How come `Effect` seals only two in-flows, instead of all the flows?", "body": "<p>Here is the diagram of <code>Effect</code> provided in the official tutorial of <code>pipes</code> package.</p>\n\n<pre><code> type Effect = Proxy X () () X\n\n  Upstream | Downstream\n     +---------+\n     |         |\n X  &lt;==       &lt;== ()\n     |         |\n () ==&gt;       ==&gt; X\n     |    |    |\n     +----|----+\n          v\n          r\n</code></pre>\n\n<p>Since <code>Effect</code> doesn't have any flow of data, I was expecting it to be just <code>Proxy X X X X</code>, sealing all flows. But instead, it allows the two in-flows. Is there a particular reason for that? If I just write what a <code>Effect</code> normally does, with signature <code>Proxy X X X X</code>, it can pass the compiler perfectly fine:</p>\n\n<pre><code>myMonad :: Proxy X X X X IO ()\nmyMonad = do\n    a &lt;- lift $ getLine\n    lift $ print a\n    return ()\n</code></pre>\n\n<p>Why can't we <code>run</code> something like this?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1445530136, "last_edit_date": 1445530136, "creation_date": 1445461977, "answer_id": 33269348, "question_id": 33269219, "link": "https://stackoverflow.com/questions/33269219/sorting-a-string-by-character-frequency/33269348#33269348", "title": "Sorting a string by character frequency", "body": "<p>The most natural data structure to use for this purpose is probably a priority search queue. Using one of these (which you can get from Hackage), you can use characters as keys and frequency counts as priorities. Work through all the characters in the string, bumping up that character's priority, and then in the end pull everything out in priority order.</p>\n\n<p>Using the <code>psqueues</code> package,</p>\n\n<pre><code>import Data.IntPSQ\nimport Data.Foldable\n\nbuildPSQ :: (Foldable t, Ord p, Num p, Enum a) =&gt;\n            t a -&gt; IntPSQ p ()\nbuildPSQ = foldl'\n           (\\q x -&gt; snd $ PSQ.alter\n                          (maybe ((), Just (1,()))\n                                 (\\(p,_) -&gt; ((), Just (p+1,()))))\n                          (fromEnum x) q)\n           PSQ.empty\n\nfoldrPrio :: Ord p =&gt; (Int -&gt; p -&gt; v -&gt; b -&gt; b) -&gt; b -&gt; IntPSQ p v -&gt; b    \nfoldrPrio k n = maybe n (\\(c,p,v,r) -&gt; k c p v (foldrPrio k n r)) . PSQ.minView\n\nrebuild :: Enum a =&gt; IntPSQ Int t1 -&gt; [a]\nrebuild = foldrPrio (\\c p _ r -&gt; replicate p (toEnum c) ++ r) []\n\nsortFreq :: (Foldable f, Enum a) =&gt; f a -&gt; [a]\nsortFreq = rebuild . buildPSQ\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 477, "user_id": 4254033, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/bf1ada35cd0755b213121663b1140f91?s=128&d=identicon&r=PG&f=1", "display_name": "skulpt", "link": "https://stackoverflow.com/users/4254033/skulpt"}, "edited": false, "score": 0, "creation_date": 1445465438, "post_id": 33269499, "comment_id": 54341393, "body": "Thanks, I didn&#39;t even think of using functions from the standard library. However, I didn&#39;t do anything regarding functional composition yet - is there another way to do this? I especially don&#39;t really understand how you&#39;re using sortBy."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 477, "user_id": 4254033, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/bf1ada35cd0755b213121663b1140f91?s=128&d=identicon&r=PG&f=1", "display_name": "skulpt", "link": "https://stackoverflow.com/users/4254033/skulpt"}, "edited": false, "score": 1, "creation_date": 1445465955, "post_id": 33269499, "comment_id": 54341606, "body": "@skulpt, not sure if I understood you correctly: do you want to remove these dots? If so, you can write <code>f x = concat (sortBy (comparing length) (group (sort x)))</code>. Or without parentheses, but with <code>($)</code>. However it&#39;s really better to just use function composition."}, {"owner": {"reputation": 477, "user_id": 4254033, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/bf1ada35cd0755b213121663b1140f91?s=128&d=identicon&r=PG&f=1", "display_name": "skulpt", "link": "https://stackoverflow.com/users/4254033/skulpt"}, "edited": false, "score": 0, "creation_date": 1445466352, "post_id": 33269499, "comment_id": 54341754, "body": "Yeah, that was exactly what I needed. It appears that I&#39;ve just left out parentheses. Thanks!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 477, "user_id": 4254033, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/bf1ada35cd0755b213121663b1140f91?s=128&d=identicon&r=PG&f=1", "display_name": "skulpt", "link": "https://stackoverflow.com/users/4254033/skulpt"}, "edited": false, "score": 0, "creation_date": 1445466499, "post_id": 33269499, "comment_id": 54341809, "body": "@skulpt, what do you not understand about <code>sortBy</code>? It receives a function, that decides how to order elements. <code>comparing</code> constructs such function, here is the definition: <code>comparing p x y = compare (p x) (p y)</code>. In this case <code>x</code> and <code>y</code> are lists, <code>p</code> is <code>length</code>, so we compare lists by their length."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 4, "last_activity_date": 1445462542, "creation_date": 1445462542, "answer_id": 33269499, "question_id": 33269219, "link": "https://stackoverflow.com/questions/33269219/sorting-a-string-by-character-frequency/33269499#33269499", "title": "Sorting a string by character frequency", "body": "<p>All these functions already exist in the standard library. The simplest thing you can do is</p>\n\n<pre><code>import Data.Ord\nimport Data.List\n\nf = concat . sortBy (comparing length) . group . sort\n</code></pre>\n\n<p>Or, since <code>length</code> is O(n), here is a more efficient way:</p>\n\n<pre><code>import Data.Ord\nimport Data.List\nimport Control.Arrow\n\nf = concatMap snd . sortBy (comparing fst) . map (length &amp;&amp;&amp; id) . group . sort\n</code></pre>\n\n<p>Also, <code>String</code> is the same thing as <code>[Char]</code>.</p>\n\n<p>You can't compare <code>x</code> to <code>[]</code> here</p>\n\n<pre><code>listify :: String -&gt; [Char]\nlistify (x:xs)\n        | x == [] = []\n        | x == \"\" = \"\"\n</code></pre>\n\n<p>because <code>x</code> has type <code>Char</code>, which is not a list.</p>\n"}], "owner": {"reputation": 477, "user_id": 4254033, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/bf1ada35cd0755b213121663b1140f91?s=128&d=identicon&r=PG&f=1", "display_name": "skulpt", "link": "https://stackoverflow.com/users/4254033/skulpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 693, "favorite_count": 0, "accepted_answer_id": 33269499, "answer_count": 2, "score": 2, "last_activity_date": 1445530136, "creation_date": 1445461392, "last_edit_date": 1445462501, "question_id": 33269219, "link": "https://stackoverflow.com/questions/33269219/sorting-a-string-by-character-frequency", "title": "Sorting a string by character frequency", "body": "<p>I'm just starting out on using Haskell and I'm having the following problem:\nI want to sort a String in a particular way. All the characters should be next to each other, and their general position in the resulting String should depend on how often they were present in the original String. For example:</p>\n\n<p>\"aabcbb\" should return \"caabbb\"</p>\n\n<p>The first idea I had was something like generally sorting the String first, then grouping the chars into lists of lists, comparing the lengths of said lists and trying to sort them in some way. \nHowever, I'm stuck at trying to convert a String to a list of lists of chars. I've managed my first sorting: </p>\n\n<pre><code>listify :: String -&gt; [Char]\nlistify [] = []\nlistify (x:xs) = [x] ++ listify isInRest ++ listify notInRest\n         where\n          isInRest = [y | y &lt;-xs, y==x]\n          notInRest = [z | z &lt;-xs, z/=x]\n</code></pre>\n\n<p>Which obviously returns a sorted list, but in order of appearance (would be \"aabbbc\" in my upper example). I don't really get how to proceed further.</p>\n\n<p>Also, in general, I don't really understand why I can't handle the first option of my funcition in another way. I tried</p>\n\n<pre><code>listify :: String -&gt; [Char]\nlistify (x:xs)\n        | x == [] = []\n        | x == \"\" = \"\"\n</code></pre>\n\n<p>I don't use both options at the same time, but I am not really sure how to handle an empty list if it's in this style since I'm getting the following errors and I'm not sure how to handle those:</p>\n\n<p><a href=\"https://i.stack.imgur.com/lIDXA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/lIDXA.png\" alt=\"enter image description here\"></a></p>\n\n<p>Any help will be appreciated.</p>\n"}, {"tags": ["haskell", "refactoring", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445458362, "post_id": 33268280, "comment_id": 54337799, "body": "You could probably do this sort of thing with some TH horrors, but have you checked out <code>lifted-base</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 7, "creation_date": 1445458443, "post_id": 33268280, "comment_id": 54337839, "body": "I don&#39;t think this can&#39;t be achieved since monad transformers are not generally invertible (You can&#39;t go from <code>IO (Maybe a)</code> to <code>Maybe (IO a)</code>, for example). On the other hand, <code>do { liftIO k; liftIO k&#39; }</code> is equivalent to <code>liftIO $ do { k ; k&#39; }</code> so some simplification is possible, and you can make your IO actions into <code>MonadIO</code> actions (see <code>lifted-base</code> per @dfeuer) so that the lifting is already applied and <code>liftIO</code> isn&#39;t needed at the use site."}, {"owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "edited": false, "score": 0, "creation_date": 1445458700, "post_id": 33268280, "comment_id": 54337962, "body": "Perhaps a silly suggestion, but you could try mixing in <code>Maybe</code> with a <code>Just $ do $ ...</code> to indicate going ahead with a lifted operation, and <code>Nothing</code> to indicate an unlifted <code>mzero</code>."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1445513775, "post_id": 33268280, "comment_id": 54360464, "body": "Why not write code using monad type classes? With <code>MonadError ()</code> and <code>MonadIO</code> it will be: <code>do { ioAction1; ioAction2; if ... then throwError () else pure () }</code>?"}, {"owner": {"reputation": 4517, "user_id": 125421, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4b385fddccf1b5305dbf5c7f6f4d0ecc?s=128&d=identicon&r=PG", "display_name": "Nathan Howell", "link": "https://stackoverflow.com/users/125421/nathan-howell"}, "edited": false, "score": 1, "creation_date": 1445524387, "post_id": 33268280, "comment_id": 54367314, "body": "If you have multiple <code>liftIO</code> calls in a row they can be combined into a single block: <code>liftIO x; liftIO y; liftIO z;</code> can be written as <code>liftIO $ do { x; y; z; }</code>. Depending on the current monad instance it can also change (typically improving) performance."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1445551127, "post_id": 33268280, "comment_id": 54383210, "body": "how would effects (e.g. the PureScript ones) deal with this situatiom?"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 413, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1445461022, "creation_date": 1445458011, "last_edit_date": 1445461022, "question_id": 33268280, "link": "https://stackoverflow.com/questions/33268280/is-there-a-way-to-use-an-unlift-style-when-writing-in-a-monad-transformer-do-b", "title": "Is there a way to use an &quot;unlift&quot; style when writing in a monad transformer do block?", "body": "<p>Many monad transformers in Haskell only add one single function to the base monad, for example:</p>\n\n<pre><code>MaybeT     adds   mzero\nExceptT    adds   throwE\nProducer   adds   yield\nConsumer   adds   await\n</code></pre>\n\n<p>So in a <code>IO</code>-heavy or complicated-nested monad, I would usually end up writing a <code>do</code>-block like this</p>\n\n<pre><code>do\n    liftIO $ ...\n    liftIO $ ...\n    if ...\n      then\n        liftIO $ ...\n      else\n        mzero\n    liftIO $ ...\n    liftIO $ ...\n    liftIO $ ...\n</code></pre>\n\n<p>which is very unnecessary considering I'm probably just using <code>mzero</code> for that one particular statement. Wouldn't it be nice if I could instead only \"unlift\" when necessary and write the rest of the block normally? Imagine I could write</p>\n\n<pre><code>lift $ do\n    ...\n    ...\n    if ...\n      then\n        ...\n      else\n        unlift $ mzero\n    ...\n    ...\n    ...\n</code></pre>\n\n<p>I know the above code wouldn't make sense because the <code>do</code>-block being lifted is going to be a normal monad and the special effects will not be there, but is there a way to achieve something to a similar effect in Haskell?</p>\n"}, {"tags": ["performance", "haskell", "ghc"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1445457968, "post_id": 33268177, "comment_id": 54337585, "body": "I&#39;m not sure what partial evaluation would buy you. <code>y&#39;</code> will already be shared. Do you want memoization? You&#39;ll need to add memoization yourself. What sort of rule would you want to write?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445458094, "post_id": 33268177, "comment_id": 54337655, "body": "What happens if you use a custom <code>flip</code>? <code>flip&#39; f x = \\ y -&gt; inline f y x</code>"}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1445458255, "post_id": 33268177, "comment_id": 54337734, "body": "@ReinHenrichs Will <code>y&#39;</code> already be shared? If so then my understanding is pretty broken and I would love to accept an answer explaining how. If I do <code>fmap (*~ y) someLongList</code> won&#39;t it be recomputed each time?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1445458929, "post_id": 33268177, "comment_id": 54338091, "body": "I was referring to <code>y&#39;</code> within the definition of <code>(*~)</code>, but I see what sort of sharing you want now and I think it depends on exactly how GHC desugars sections in a non-obvious way, so I don&#39;t know whether it will or not. You could always try to read the core and find out."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1445462993, "post_id": 33268177, "comment_id": 54340297, "body": "do I understand you correctly in that <code>seq y $ fmap (*~ y) someLongList</code> would not be satisfactory because you want the 2nd arg of the operator to <i>always</i> be strict regardless of where the operator is invoked? and the problem is that it&#39;s not the 1st argument so currying doesn&#39;t help? how about switching the arg order and renaming to <code>~*</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1445464069, "post_id": 33268177, "comment_id": 54340807, "body": "@ErikAllik I believe the issue is that it is not <code>y</code> which must be shared but the result of some intermediate computation performed <i>on</i> <code>y</code> by <code>(*~)</code>."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1445469929, "post_id": 33268177, "comment_id": 54342896, "body": "It&#39;s both of those issues. Splitting the intermediate out would help but would expose users to that currently-hidden and fairly strange implementation detail. I could flip it around and the currying would fix my issue, but it would make the resulting client code read in a very unnatural way."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1445518051, "post_id": 33268177, "comment_id": 54363119, "body": "@DougMcClean: by any chance, could you shed a bit more light into what your actual <code>*~</code> is doing? you&#39;ve only provided pseudocode."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1445519463, "post_id": 33268177, "comment_id": 54364008, "body": "Sure, good question. The left operand is a numerical value and the right operand is a unit. The result is a quantity tagged with the same dimension as the unit had. The expensive (not in absolute terms, but relatively) part is combining all the units on the right hand side, extracting the numerical value, checking if it is exactly 1, and determining if we can get away with <code>coerce</code>. But now that I read Nikita Volkov&#39;s comment, I am finding a way. Because the unit combination part should be shared anyway (trying to determine a test to verify that), and I can make a function..."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1445519526, "post_id": 33268177, "comment_id": 54364045, "body": "...that logically is equivalent to <code>fmap (*~ u)</code> that only does the check in that case. That&#39;s actually even better, because then you aren&#39;t doing it in the case when you are only converting a single value."}], "answers": [{"comments": [{"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 1, "creation_date": 1445474669, "post_id": 33269635, "comment_id": 54344187, "body": "This is a good point and would solve the problem. But the result type of <code>expensive</code> is currently a hidden implementation detail because it is really of no interest to users of the library that exposes <code>(*~)</code>."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 2, "creation_date": 1445477995, "post_id": 33269635, "comment_id": 54345114, "body": "Actually, it would not be a hidden implementation detail in your case either, you&#39;d just be exposing it differently. You&#39;d also be obfuscating your intent and hiding this from the type system, and hence would have to otherwise inform the user of how your special function is supposed to be used. This wouldn&#39;t possibly be good from the usability standpoint. And, again, it&#39;d go against separation of concerns. You have a list of indications of your approach being incorrect already, so better think twice."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 5, "last_activity_date": 1445463117, "creation_date": 1445463117, "answer_id": 33269635, "question_id": 33268177, "link": "https://stackoverflow.com/questions/33268177/partially-evaluating-right-handed-operator-sections/33269635#33269635", "title": "Partially evaluating right-handed operator sections", "body": "<p>To trigger such an optimization you need to make sure that your function gets inlined. Place the <code>{-# INLINE (*~) #-}</code> pragma before the declaration of the <code>(*~)</code> function. I can't guarantee you that it'll solve your problem, but it's the only way I see it being approached. I'd examine the generated Core code with a tool like <a href=\"https://hackage.haskell.org/package/ghc-core\">\"ghc-core\"</a> afterwards to make sure.</p>\n\n<p>However, your problem actually is just an indication of improper code composition. Your function is doing multiple unrelated things. <code>expensive y</code> should simply be factored out of it, then your problem will be erased as such. I.e., the usage pattern should be <code>x *~ expensive y</code> instead of <code>x *~ y</code>.</p>\n"}], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 1, "accepted_answer_id": 33269635, "answer_count": 1, "score": 14, "last_activity_date": 1445463117, "creation_date": 1445457623, "question_id": 33268177, "link": "https://stackoverflow.com/questions/33268177/partially-evaluating-right-handed-operator-sections", "title": "Partially evaluating right-handed operator sections", "body": "<p>I have a function <code>(*~)</code>. Most of the cost of evaluating <code>x *~ y</code> comes from inspecting the second argument, roughly along these lines:</p>\n\n<pre><code>(*~) :: a -&gt; b d -&gt; c d a\nx *~ y = case y' of\n           Bar -&gt; cheapFunction y' x\n           Baz -&gt; cheapFunction2 y' x\n           Quux -&gt; cheapFunction3 y' x\n  where\n    y' = expensive y\n</code></pre>\n\n<p>Is there some way to convince GHC to partially evaluate operator sections like <code>(*~ y)</code>?</p>\n\n<p>I tried rewriting it like:</p>\n\n<pre><code>(*~) = flip go\n  where\n    go y = let y' = expensive y\n            in case y' of\n                 Bar -&gt; cheapFunction y'\n                 Baz -&gt; cheapFunction2 y'\n                 Quux -&gt; cheapFunction3 y'\n</code></pre>\n\n<p>but it didn't seem to help. I think this might be because <code>flip</code> requires all it's arguments before it does the flipping?</p>\n\n<p>One way would just be to flip the operator itself, but it reads much more naturally when the expensive operand is on the right hand side, because it lines up with an existing notation.</p>\n\n<p>Can a properly crafted <code>{-# RULE #-}</code> bail me out here? If so, what should it say? (I'm unclear on how far the sectioning syntax will have been desugared before rules look for matches, among other things.)</p>\n"}, {"tags": ["haskell", "ffi"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445456284, "post_id": 33267496, "comment_id": 54336732, "body": "Why do you think the freed memory should get changed? Note that the Haskell runtime doesn&#39;t use malloc/free to manage memory."}], "answers": [{"comments": [{"owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 0, "creation_date": 1445456172, "post_id": 33267708, "comment_id": 54336670, "body": "Yeah but shouldn&#39;t there be a random chance for that undefined behavior? Every time I run the program I get the same output. If the behavior was undefined (as it should) wouldn&#39;t the output be different every time?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 2, "creation_date": 1445456268, "post_id": 33267708, "comment_id": 54336723, "body": "@TheCrafter No, there is no guarantee. Try to do the same in C. After <code>free</code> you might (consistently!) see the same data. Or not. Everything is possible. Undefined does not mean random, it means that the runtime can do whatever it wants."}, {"owner": {"reputation": 435402, "user_id": 179910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8962238339d771f0348967be6f97b1b?s=128&d=identicon&r=PG", "display_name": "Jerry Coffin", "link": "https://stackoverflow.com/users/179910/jerry-coffin"}, "reply_to_user": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 3, "creation_date": 1445457028, "post_id": 33267708, "comment_id": 54337118, "body": "@TheCrafter: There may be a random chance of the UB being visible--but it may be a very small chance, so you&#39;d have to re-run the program many millions of times before you saw it. Or, you could demo it for an investor, which would pretty much guarantee the worst case immediately showing up (like the computer going up in smoke, instead of just printing out random garbage)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 1, "creation_date": 1445457743, "post_id": 33267708, "comment_id": 54337468, "body": "@TheCrafter Instead of answering your question directly, I pose a puzzle to you: by what mechanism are you imagining the computer getting entropy to use when deciding whether to output garbage or to output the last writes to memory? (Perhaps if we can understand <i>why</i> you think the computer can do truly random -- as opposed to arbitrary! -- things, we can cure you of this misconception.)"}, {"owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 0, "creation_date": 1445458132, "post_id": 33267708, "comment_id": 54337678, "body": "@DanielWagner &quot;Freeing&quot; an address means that this address is again available for allocation, it doesn&#39;t mean that something will write on it. My guess is that if I free an address and try to access it later I will find what there was there before unless something else is written there. Am I close enough?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 1, "creation_date": 1445458479, "post_id": 33267708, "comment_id": 54337860, "body": "@TheCrafter That pretty much matches my intuition of what will happen in most extant implementations, yup! With that expectation in mind: modern machines have gigabytes of memory, so expecting a particular six bytes to change in the course of a few cycles is pretty unreasonable, especially considering the way allocators typically reserve a &quot;small chunks&quot; pool of memory that is never returned to the OS -- hence smaller chunks are unlikely to be walked on by other processes -- and the way OS&#39;s typically reassign memory FIFO-style -- hence recently freed memory will take a while to be reassigned."}, {"owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 1, "creation_date": 1445458991, "post_id": 33267708, "comment_id": 54338129, "body": "@DanielWagner Okay I got it. But hey wanna hear something weird I didn&#39;t mention on my post? What actually confused me in the first place was that when I wrote the program it actually printed random values on 1st, 3rd and 4th elements. Then, after a few hours it printed the correct values every time. I didn&#39;t mention it because I didn&#39;t want people to believe I&#39;m on drugs while coding!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 0, "creation_date": 1445461847, "post_id": 33267708, "comment_id": 54339684, "body": "@TheCrafter Despite my intuitions, anything is allowed with use-after-free!"}, {"owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "edited": false, "score": 0, "creation_date": 1445462647, "post_id": 33267708, "comment_id": 54340101, "body": "@DanielWagner Yeah like you said...undefined behavior! Thanks for your help :)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1445455980, "creation_date": 1445455980, "answer_id": 33267708, "question_id": 33267496, "link": "https://stackoverflow.com/questions/33267496/function-free-on-haskells-ffi-doesnt-seem-to-work/33267708#33267708", "title": "function &#39;free&#39; on Haskell&#39;s FFI doesn&#39;t seem to work", "body": "<p>Reading memory after you've freed it is undefined behavior. Anything is allowed -- including returning random data, summoning nasal demons, or even, in the boringest of possible worlds, returning the data that was in that memory before it was freed.</p>\n"}], "owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 33267708, "answer_count": 1, "score": 2, "last_activity_date": 1445455980, "creation_date": 1445455167, "question_id": 33267496, "link": "https://stackoverflow.com/questions/33267496/function-free-on-haskells-ffi-doesnt-seem-to-work", "title": "function &#39;free&#39; on Haskell&#39;s FFI doesn&#39;t seem to work", "body": "<p>I'm trying to get familiar with Haskell's FFI so I wrote this small example:</p>\n\n<p>Main.hs:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nimport Foreign.C.Types\nimport Foreign.Ptr (Ptr)\nimport Foreign.Marshal.Array (peekArray)\nimport Foreign.Marshal.Alloc (free)\n\nforeign import ccall \"test.h test\"\n  test :: CInt -&gt; Ptr CInt\n\nmain = do\n  let rval = test 6\n\n  -- print the array\n  list &lt;- peekArray 6 rval &gt;&gt;= return . map toInteger\n  putStrLn $ show list\n\n  free rval\n\n  -- print it again (it should okay)\n  putStrLn $ show list\n\n  -- try to retrieve it AGAIN after I used free. Should print random values\n  peekArray 6 rval &gt;&gt;= return . map toInteger &gt;&gt;= putStrLn . show\n</code></pre>\n\n<p>test.h</p>\n\n<pre><code>#ifndef TEST_H\n#define TEST_H\n\nint* test(int a);\n\n#endif\n</code></pre>\n\n<p>test.c</p>\n\n<pre><code>#include \"test.h\"\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint* test(int a)\n{\n    int* r_val = (int*)malloc(a * sizeof(int));\n    r_val[0] = 1;\n    r_val[1] = 2;\n    r_val[2] = 3;\n    r_val[3] = 4;\n    r_val[4] = 5;\n    r_val[5] = 6;\n    return r_val;\n}\n</code></pre>\n\n<p>The output I get when I compile and run <code>Main.hs</code> is:</p>\n\n<pre><code>D:\\Code\\Haskell\\Projects\\Dev\\TestFFI&gt;cabal build\nBuilding TestFFI-0.1.0.0...\nPreprocessing executable 'TestFFI' for TestFFI-0.1.0.0...\n[1 of 1] Compiling Main             ( src\\Main.hs, dist\\build\\TestFFI\\TestFFI-tmp\\Main.o )\nLinking dist\\build\\TestFFI\\TestFFI.exe ...\n\nD:\\Code\\Haskell\\Projects\\Dev\\TestFFI&gt;\nD:\\Code\\Haskell\\Projects\\Dev\\TestFFI&gt;dist\\build\\TestFFI\\TestFFI.exe\n[1,2,3,4,5,6]\n[1,2,3,4,5,6]\n[1,2,3,4,5,6]\n</code></pre>\n\n<p>That doesn't seem to make any sense to me. The 3rd time I printed the array I was expecting something like:</p>\n\n<pre><code>[69128391783,2083719073,934857983457,98374293874,0239823947,2390847289347]\n</code></pre>\n\n<p>random data!</p>\n\n<p>Am I doing something wrong? Have I missed something?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1467, "user_id": 3029422, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/13887984efe106e46fbeb35bcb56f134?s=128&d=identicon&r=PG&f=1", "display_name": "Ionut", "link": "https://stackoverflow.com/users/3029422/ionut"}, "edited": false, "score": 0, "creation_date": 1445460629, "post_id": 33266991, "comment_id": 54339009, "body": "Thanks for your complete response"}, {"owner": {"reputation": 1467, "user_id": 3029422, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/13887984efe106e46fbeb35bcb56f134?s=128&d=identicon&r=PG&f=1", "display_name": "Ionut", "link": "https://stackoverflow.com/users/3029422/ionut"}, "edited": false, "score": 0, "creation_date": 1445460891, "post_id": 33266991, "comment_id": 54339159, "body": "Is there a way to pass a <code>custom exception</code> instead of <code>Exception</code>? Like this <code>data CustomException= MyException deriving (Show, Typeable) instance Exception CustomException</code>. When I try it I get the error: <code>No instance for (Eq CustomException)</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1467, "user_id": 3029422, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/13887984efe106e46fbeb35bcb56f134?s=128&d=identicon&r=PG&f=1", "display_name": "Ionut", "link": "https://stackoverflow.com/users/3029422/ionut"}, "edited": false, "score": 0, "creation_date": 1445464735, "post_id": 33266991, "comment_id": 54341120, "body": "Just add/derive an Eq instance for your CustomException - there&#39;s only one value in that type. DivideByZero has type ArithException and there are 3 other possible ArithExceptions - that&#39;s why you need the equality test."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1445453438, "creation_date": 1445453438, "answer_id": 33266991, "question_id": 33263970, "link": "https://stackoverflow.com/questions/33263970/testcase-assertexception/33266991#33266991", "title": "Testcase assertException", "body": "<p>Here's one way to do it:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Exception\nimport Control.Monad\nimport Test.HUnit\nimport GHC.Natural\n\nassertException4 :: (Exception e, Eq e) =&gt; String -&gt; e -&gt; IO a -&gt; IO ()\nassertException4 preface expected action = do\n  r &lt;- catches\n          (action &gt;&gt; return (Just \"no exception thrown\"))\n          [ Handler (\\e -&gt; return $ if e == expected\n                                       then Nothing\n                                       else Just (\"wrong exception thrown, expected \" ++ show expected ++ \", got: \" ++ show e))\n          -- see the comments below about these two handlers:\n          , Handler (\\e -&gt; throw (e :: AsyncException))\n          , Handler (\\(e::SomeException) -&gt; return $ Just (\"some other exception thrown: \" ++ show e))\n          ]\n  case r of\n    Nothing  -&gt; return ()\n    Just msg -&gt; assertFailure (preface ++ \": \" ++ msg)\n\ntest1 = TestCase $ assertException4 \"Test1\" DivideByZero (evaluate $ 5 `div` 0)\ntest2 = TestCase $ assertException4 \"Test2\" DivideByZero (evaluate $ 5 `div` 1)\ntest3 = TestCase $ assertException4 \"Test3\" DivideByZero (evaluate $ [1,2,3] !! 4)\ntest4 = TestCase $ assertException4 \"Test4\" DivideByZero (evaluate $ (fromInteger (0 - 3) :: Natural) )\n\nmain = runTestTT $ TestList [ test1, test2, test3, test4 ]\n</code></pre>\n\n<p>The four test cases are:</p>\n\n<ol>\n<li>DivideByZero exception thrown - test should pass</li>\n<li>No exception thrown - test should fail</li>\n<li>Wrong exception thrown (of a different type) - test should fail</li>\n<li>Wrong exception thrown (of the same type) - test should fail</li>\n</ol>\n\n<p>Note that you have to have a different catch handler for exceptions which are not of the same type as the target exception.</p>\n\n<p>Also, I re-throw any AsyncException since that is what HUnit does in <code>performTestCase</code> <a href=\"https://github.com/hspec/HUnit/blob/master/Test/HUnit/Lang.hs#L80-92\" rel=\"nofollow\">(link)</a>\nHitting Control-C will cause an AsyncException, for instance.</p>\n\n<p>Note that uncaught exceptions will be reported as Errors by HUnit, and the exception will be printed out. You can test this out by removing the handlers for AsyncException and SomeException.</p>\n"}], "owner": {"reputation": 1467, "user_id": 3029422, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/13887984efe106e46fbeb35bcb56f134?s=128&d=identicon&r=PG&f=1", "display_name": "Ionut", "link": "https://stackoverflow.com/users/3029422/ionut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 33266991, "answer_count": 1, "score": 1, "last_activity_date": 1445453438, "creation_date": 1445443103, "last_edit_date": 1592644375, "question_id": 33263970, "link": "https://stackoverflow.com/questions/33263970/testcase-assertexception", "title": "Testcase assertException", "body": "<p>I'm trying to test if a function throws a certain exception.<br />\nI found <a href=\"https://stackoverflow.com/a/6147930/3029422\">this</a> answer witch does this:</p>\n<pre><code>import Control.Exception\nimport Control.Monad\nimport Test.HUnit\n\nassertException :: (Exception e, Eq e) =&gt; String -&gt; e -&gt; IO a -&gt; IO ()\nassertException preface expected action =\n    handleJust isWanted (const $ return ()) $ do\n        action\n        assertFailure msg \n  where\n    isWanted = guard . (== expected)\n    msg = preface ++ &quot;\\nexpected exception: &quot; ++ show expected\n\ntestPasses = TestCase $ assertException &quot;Test1&quot; DivideByZero (evaluate $ 5 `div` 0)\ntestFails  = TestCase $ assertException &quot;Test2&quot; DivideByZero (evaluate $ 5 `div` 1)\n\nmain = runTestTT $ TestList [ testPasses, testFails ]\n</code></pre>\n<p>witch, when run, shows:</p>\n<pre><code>### Failure in: 1\nTest2\nexpected exception: divide by zero\nCases: 2  Tried: 2  Errors: 0  Failures: 1\n</code></pre>\n<p>but <code>assertException</code> does not show the actual exception or if there isn't one</p>\n<p>Is there a way to be able to show the actual exception or the absence?<br />\nI tried wrapping action with <code>catch</code> but I don't know how to pass the actual exception to <code>msg</code>.</p>\n"}, {"tags": ["haskell", "imperative-programming"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 5, "creation_date": 1445442659, "post_id": 33263635, "comment_id": 54328826, "body": "imperative really? ... wow you got a naughty teacher there ... anywyay I think it&#39;s easier for you if you add another <i>variable</i> - use two: an <i>accumulator</i> where you multiply up the result and a <i>index</i> that you count up to <code>n</code> (simulate a <code>for</code> loop with the <code>while</code>)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1445446556, "post_id": 33263635, "comment_id": 54331224, "body": "@Carsten Actually, I find this to be a nice exercise to check if someone knows how to use <code>IORef</code>s and understands <code>IO</code>. Sure, the produced code is expected to be hard to read, and quite unidiomatic. This is definitely not an exercise about elegance ;-)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445447144, "post_id": 33263635, "comment_id": 54331573, "body": "hey whatever helps you learn ... ;)"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445454580, "post_id": 33265507, "comment_id": 54335808, "body": "And the answer is, of course, &quot;basically the same as the usual version, but much more complicated for no reason&quot;."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445455002, "post_id": 33265507, "comment_id": 54336029, "body": "@ReinHenrichs ? right now I really have no clue what you are getting at - but I have the feeling I did something wrong !(?)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445455276, "post_id": 33265507, "comment_id": 54336181, "body": "No, your solution seems fine (given the constraints), it&#39;s just that it&#39;s a ridiculous problem statement. I don&#39;t understand why someone would think that this is a good exercise."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1445456893, "post_id": 33265507, "comment_id": 54337044, "body": "So this is imperative Haskell code... it makes me glad that I switched to Haskell."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445458991, "post_id": 33265507, "comment_id": 54338130, "body": "I wasn&#39;t! I was just trying to point out that <i>any</i> answer would necessarily be convoluted because the question asks for a convoluted answer. It&#39;s basically &quot;write a factorial function but add in a lot of indirection by using IORefs for no reason&quot;."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445459607, "post_id": 33265507, "comment_id": 54338486, "body": "I&#39;m just kidding ... and I understand perfectly well ... I was just reacting to AJ&#39;s comment ... and I probably should just shut up - and so I will ;)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445466926, "post_id": 33265507, "comment_id": 54341982, "body": "@ReinHenrichs I do think this <i>is</i> a good exercise, if the point is learning how <code>IORef</code>s work -- even if the solution is horrible, especially when compared with pure ones. It&#39;s a matter of personal taste though."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445468954, "post_id": 33265507, "comment_id": 54342626, "body": "@chi It might use IORefs, but I don&#39;t think it motivates them at all, which for me is an essential part of an effective exercise."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1445457222, "last_edit_date": 1445457222, "creation_date": 1445448054, "answer_id": 33265507, "question_id": 33263635, "link": "https://stackoverflow.com/questions/33263635/factorial-using-imperative-style-programming/33265507#33265507", "title": "Factorial using imperative-style programming", "body": "<p>I think maybe it's time to give you some working version:</p>\n\n<pre><code>fact :: Integer -&gt; IO (Integer, Integer)\nfact n = do\n  i &lt;- newIORef 1\n  acc &lt;- newIORef 1\n  while (lessOrEqualN i) (step i acc)\n  acc' &lt;- readIORef acc\n  return $ (n, acc')\n  where\n     lessOrEqualN iRef = do\n       i' &lt;- readIORef iRef\n       return $ i' &lt;= n\n     step iRef accRef = do\n       i' &lt;- readIORef iRef\n       acc' &lt;- readIORef accRef\n       writeIORef accRef (acc' * i')\n       writeIORef iRef (i'+1)\n</code></pre>\n\n<p>as you can see I used an <em>loop</em> reference <code>i</code> and an <em>accumulator</em> reference <code>acc</code> always reading, writing the changing values.</p>\n\n<p>To make this (hopefully) a <em>bit</em> more readable I extracted the <code>test</code> and the <code>body</code> of the <code>while</code> into <code>lessOrEqualN</code> and <code>step</code>.</p>\n\n<hr>\n\n<p>Of course there are easier ways to do this (<code>modifyIORef</code>) but I guess you have to use those.</p>\n\n<hr>\n\n<p>PS: you play with it a bit - maybe you want to handle negative values differently or whatever</p>\n\n<hr>\n\n<p>this might be a bit cleaner (putting both <em>mutables</em> into the same ref):</p>\n\n<pre><code>fact :: Integer -&gt; IO (Integer, Integer)\nfact n = do\n  ref &lt;- newIORef (1,1)\n  while (lessOrEqualN ref) (step ref)\n  (_,acc) &lt;- readIORef ref\n  return $ (n, acc)\n  where\n     lessOrEqualN ref = do\n       (i,_) &lt;- readIORef ref\n       return $ i &lt;= n\n     step ref = do\n       (i,acc) &lt;- readIORef ref\n       writeIORef ref (i+1, acc * i)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1445537065, "creation_date": 1445537065, "answer_id": 33287674, "question_id": 33263635, "link": "https://stackoverflow.com/questions/33263635/factorial-using-imperative-style-programming/33287674#33287674", "title": "Factorial using imperative-style programming", "body": "<p>I think Carsten's answer can be made a bit cleaner like this:</p>\n\n<pre><code>{-# LANGUAGE TupleSections #-}\n\nimport Control.Monad\nimport Data.IORef\n\nfact :: Integer -&gt; IO (Integer, Integer)\nfact n = do\n  counter &lt;- newIORef 1\n  result &lt;- newIORef 1\n  while (fmap (&lt;=n) (readIORef counter)) $ do\n    i &lt;- postIncrement counter\n    modifyIORef result (*i)\n  fmap (n,) (readIORef result)\n\nwhile :: IO Bool -&gt; IO () -&gt; IO ()\nwhile test body =\n  do b &lt;- test\n     if b\n       then do {body ; while test body}  -- same-line syntax for do\n       else return ()\n\npostIncrement :: Enum a =&gt; IORef a -&gt; IO a\npostIncrement ref = do\n  result &lt;- readIORef ref\n  modifyIORef ref succ\n  return result\n</code></pre>\n\n<p>What I'm doing here is:</p>\n\n<ol>\n<li>Using <code>modifyIORef</code> to cut down on the number of paired <code>readIORef</code>/<code>writeIORef</code> calls.</li>\n<li>Using <code>fmap</code> to reduce the need for auxiliary functions to test the contents of an <code>IORef</code>.</li>\n<li>Write a generic, reusable <code>postIncrement</code> function and use that to shorten <code>fact</code> further.</li>\n</ol>\n\n<p>But frankly, I think your instructor's insistence that you use this <code>while</code> function is a bit silly.  It doesn't make for clean code.  If I was told to write an imperative factorial with <code>IORef</code> I'd first write this, just using the <code>forM_</code> loop from the library:</p>\n\n<pre><code>factorial :: Integer -&gt; IO (Integer, Integer)\nfactorial n = do\n  result &lt;- newIORef 1\n  forM_ [2..n] $ \\i -&gt; do\n    modifyIORef result (*i)\n  fmap (n,) (readIORef result)\n</code></pre>\n\n<p>And that's because I was too dumb to remember <code>replicateM_ :: Monad m =&gt; Int -&gt; m a -&gt; m ()</code> right away...</p>\n"}], "owner": {"reputation": 99, "user_id": 3055141, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a1214f2f78a71c96e8dbc28c503a73cf?s=128&d=identicon&r=PG&f=1", "display_name": "user3055141", "link": "https://stackoverflow.com/users/3055141/user3055141"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 33265507, "answer_count": 2, "score": 3, "last_activity_date": 1445537065, "creation_date": 1445442223, "last_edit_date": 1445443641, "question_id": 33263635, "link": "https://stackoverflow.com/questions/33263635/factorial-using-imperative-style-programming", "title": "Factorial using imperative-style programming", "body": "<p>I have the following code:</p>\n\n<pre><code>while :: IO Bool -&gt; IO () -&gt; IO ()\nwhile test body =\n  do b &lt;- test\n     if b\n       then do {body ; while test body}  -- same-line syntax for do\n       else return ()\n</code></pre>\n\n<p>I need to implement the factorial function using imperative-style programming. what I have to do is to create and initialize variables using <code>newIORef</code>, modify their values using a while loop with <code>readIORef</code> and <code>writeIORef</code>, then have the <code>IO</code> action return a pair consisting of the input <code>n</code> and the final result.</p>\n\n<p>This is what I have done so far:</p>\n\n<pre><code>fact :: Integer -&gt; IO (Integer, Integer)\nfact n = do r &lt;- newIORef n --initialize variable\n            while\n              (do {v &lt;- readIORef n; n})\n              (do {v &lt;- readIORef r; writeIORef (...)) --modify the value (?)\n            readIORef r\n</code></pre>\n\n<p>This is my attempt to write the factorial function. This is obviously does not work. Any help would be appreciated.</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1445441612, "last_edit_date": 1445441612, "creation_date": 1445441280, "answer_id": 33263315, "question_id": 33263134, "link": "https://stackoverflow.com/questions/33263134/confused-about-workings-of-a-haskell-list-comprehension/33263315#33263315", "title": "Confused about workings of a Haskell list comprehension", "body": "<p>I would pronounce that comprehension</p>\n\n<blockquote>\n  <p>The list of all <code>x</code> such that <code>(y, x)</code> is drawn from <code>b</code> and <code>a == y</code>.</p>\n</blockquote>\n\n<p>Another way to read it, more sequentially:</p>\n\n<blockquote>\n  <p>Draw pairs <code>(y, x)</code> from <code>b</code>. For each such pair, check whether <code>a == y</code>. If so, produce <code>x</code>; otherwise, move on to the next one.</p>\n</blockquote>\n\n<p>I should also note that the variable names are a bit confusing. It's idiomatic in Haskell to give lists or other containers plural names. So something more like</p>\n\n<pre><code>find a abs = [x | (y, x) &lt;- abs, a == y]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 3, "last_activity_date": 1445441708, "creation_date": 1445441708, "answer_id": 33263470, "question_id": 33263134, "link": "https://stackoverflow.com/questions/33263134/confused-about-workings-of-a-haskell-list-comprehension/33263470#33263470", "title": "Confused about workings of a Haskell list comprehension", "body": "<p>You seem to view \"<code>x|x</code>\" as a thing. Rather, list comprehensions work like this:</p>\n\n<blockquote>\n  <p><code>[</code> expression to return <code>|</code> stuff to iterate over <code>]</code></p>\n</blockquote>\n\n<p>What your example basically says is \"draw <code>(x, y)</code> from <code>b</code>, throw away anything which doesn't satisfy <code>a == y</code>, and then return <code>x</code>\".</p>\n"}, {"tags": [], "owner": {"reputation": 548, "user_id": 4646232, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/PXxeo.jpg?s=128&g=1", "display_name": "Kristiyan Tsvetanov", "link": "https://stackoverflow.com/users/4646232/kristiyan-tsvetanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1445449478, "last_edit_date": 1445449478, "creation_date": 1445449282, "answer_id": 33265866, "question_id": 33263134, "link": "https://stackoverflow.com/questions/33263134/confused-about-workings-of-a-haskell-list-comprehension/33265866#33265866", "title": "Confused about workings of a Haskell list comprehension", "body": "<p>Lets give you an example in order to visualize it:</p>\n\n<pre><code>find a b = [x|(y,x) &lt;- b, a==y]\n</code></pre>\n\n<p>Let <code>a=2</code>, <code>b=[(1,3),(2,4),(3,5),(2,7)]</code></p>\n\n<p><code>(y,x)</code> will get each of <code>(1,3),(2,4),(3,5),(2,7)</code> as a couple and check if the first element equals <code>2</code> (we said that <code>a</code> equals <code>2</code>). If True, the function will return the second element of that couple - <code>x</code>, and put it in a list with the rest of the answers.</p>\n\n<p>So the output for that function would be <code>[4,7]</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5472204"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1445449478, "creation_date": 1445440744, "last_edit_date": 1445447996, "question_id": 33263134, "link": "https://stackoverflow.com/questions/33263134/confused-about-workings-of-a-haskell-list-comprehension", "title": "Confused about workings of a Haskell list comprehension", "body": "<p>I'm a new programmer and using Haskell. I've found a line of code called find that matches up a String with its corresponding pair in a list. Like so</p>\n\n<pre><code>find a b = [x|(y,x) &lt;- b, a==y]\n</code></pre>\n\n<p>I don't understand fully what this program is saying, for the list comprehension, as I've never seen the <code>x|(y,x)</code> used in such a way before, I've mainly seen it used as <code>x|x</code> or <code>x|x^2</code>. So, does this mean that find the string <code>A</code>, from your input list <code>B</code> = a list comprehension of <code>x</code>, where <code>x</code> is a pair of <code>(String, Char)</code> from your <code>B</code>, and for which the <code>y</code> equals your inputted <code>a</code>? A little confused here.</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1445442087, "creation_date": 1445442087, "answer_id": 33263596, "question_id": 33263029, "link": "https://stackoverflow.com/questions/33263029/turtle-prompting-for-input-without-a-trailing-newline/33263596#33263596", "title": "Turtle: Prompting for input, without a trailing newline", "body": "<p>You can import from the <a href=\"https://hackage.haskell.org/package/text\" rel=\"noreferrer\"><code>text</code></a> package and use many functions which aren't exported from <code>turtle</code>. In this case:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.Text.IO as Text\n\nmain = Text.putStr \"Input something: \" -- doesn't print newline\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": false, "score": 2, "last_activity_date": 1454090443, "creation_date": 1454090443, "answer_id": 35091053, "question_id": 33263029, "link": "https://stackoverflow.com/questions/33263029/turtle-prompting-for-input-without-a-trailing-newline/35091053#35091053", "title": "Turtle: Prompting for input, without a trailing newline", "body": "<p>I also want to mention that <code>turtle</code> has a newly added <code>printf</code> function which outputs a formatted string without the trailing newline, so another solution is:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Turtle\n\nmain = printf \"Input something: \"\n</code></pre>\n"}], "owner": {"reputation": 1217, "user_id": 147072, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ekwiH.jpg?s=128&g=1", "display_name": "Mariano", "link": "https://stackoverflow.com/users/147072/mariano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 33263596, "answer_count": 2, "score": 3, "last_activity_date": 1454090443, "creation_date": 1445440447, "question_id": 33263029, "link": "https://stackoverflow.com/questions/33263029/turtle-prompting-for-input-without-a-trailing-newline", "title": "Turtle: Prompting for input, without a trailing newline", "body": "<p>I'm writing a console application that needs to prompt the user for several things. I'm using the <a href=\"http://hackage.haskell.org/package/turtle-1.0.0\" rel=\"nofollow\">turtle</a> library.</p>\n\n<p>My function looks like this:</p>\n\n<pre><code>askInput :: IO (Maybe Text)\naskInput = do\n    echo \"Input something: \"\n    s &lt;- readline\n    return s\n</code></pre>\n\n<p>But <code>echo</code> is <a href=\"http://hackage.haskell.org/package/turtle-1.0.0/docs/src/Turtle-Prelude.html#echo\" rel=\"nofollow\">implemented</a> using <code>putStrLn</code> and as a result, will print its argument with a trailing newline.</p>\n\n<p>Is there an input function in the turtle library similar to Python's <code>raw_input</code>, that combines prompting followed by reading the user input?</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming", "lambda-calculus"], "comments": [{"owner": {"reputation": 46273, "user_id": 574479, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/79f682361ccbe900f8846a1098d13921?s=128&d=identicon&r=PG", "display_name": "biziclop", "link": "https://stackoverflow.com/users/574479/biziclop"}, "edited": false, "score": 4, "creation_date": 1445424946, "post_id": 33257360, "comment_id": 54315942, "body": "Conversion from unary to any other base is complicated by the fact that none of the target digits can be determined without reading the entire number first."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 9, "creation_date": 1445425903, "post_id": 33257360, "comment_id": 54316598, "body": "To make the question accessible to non-Haskellers, I&#39;d add this equivalent problem. If we have a very long linked list, can we compute its length <code>N</code> in time <code>O(N)</code>? Note that addition is <i>not</i> considered a constant time operation here, so the trivial approach would only provide <code>O(N log N)</code>. (This last part is crucial to the problem, IMHO.)"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 5, "creation_date": 1445429692, "post_id": 33257360, "comment_id": 54319163, "body": "Incrementing by 1 has amortized complexity O(1), doesn&#39;t it? (Each increment changes an average of 2 digits.)  So just repeating the naive ripple carry increment for each unary digit should have amortized complexity O(N)."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 7, "creation_date": 1445436009, "post_id": 33257360, "comment_id": 54323721, "body": "@Carsten Only if you&#39;re stupid enough to use a big-endian representation. :)  The LSB should be first, of course.  You can always reverse it at the end of counting digits if you like."}], "answers": [{"tags": [], "owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "is_accepted": false, "score": 5, "last_activity_date": 1445432583, "creation_date": 1445432583, "answer_id": 33260096, "question_id": 33257360, "link": "https://stackoverflow.com/questions/33257360/is-there-any-efficient-way-to-convert-an-unary-number-to-a-binary-number/33260096#33260096", "title": "Is there any efficient way to convert an unary number to a binary number?", "body": "<p>If we have a function to increment a <code>BNat</code>, we can do this quite easily by running along the <code>UNat</code>, incrementing a <code>BNat</code> at each step:</p>\n\n<pre><code>toBNat :: UNat -&gt; BNat\ntoBNat = toBNat' End\n    where\n    toBNat' :: BNat -&gt; UNat -&gt; BNat\n    toBNat' c Zero     = c\n    toBNat' c (Succ n) = toBNat' (increment c) n\n</code></pre>\n\n<p>Now, this is <code>O(NM)</code> where <code>M</code> is the worst case for <code>increment</code>. So if we can do <code>increment</code> in O(1), then the answer is yes.</p>\n\n<p>Here's my attempt at implementing <code>increment</code>:</p>\n\n<pre><code>increment :: BNat -&gt; BNat\nincrement = (reverse End) . inc' . (reverse End)\n    where\n    inc' :: BNat -&gt; BNat\n    inc' End      = One End\n    inc' (Zero n) = One n\n    inc' (One n)  = Zero (inc' n)\n\n    reverse :: BNat -&gt; BNat -&gt; BNat\n    reverse c End = c\n    reverse c (One n) = reverse (One c) n\n</code></pre>\n\n<p>This implementation is <code>O(N)</code> because you have to <code>reverse</code> the <code>BNat</code> to look at the least significant bits, which gives you <code>O(N)</code> overall. If we consider the <code>BNat</code> type to represent reversed binary numbers, we don't need to reverse the <code>BNat</code>, and, as @augustss says, we have O(1), which gives you O(N) overall.</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445948297, "post_id": 33260216, "comment_id": 54530029, "body": "@Daniel Wagner also has a very simple explanation on why the complexity can be linear below."}], "tags": [], "owner": {"reputation": 716, "user_id": 427670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0efd6bb55e1006d2091bf46586808723?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/427670/marc"}, "is_accepted": true, "score": 5, "last_activity_date": 1446023936, "last_edit_date": 1446023936, "creation_date": 1445432883, "answer_id": 33260216, "question_id": 33257360, "link": "https://stackoverflow.com/questions/33257360/is-there-any-efficient-way-to-convert-an-unary-number-to-a-binary-number/33260216#33260216", "title": "Is there any efficient way to convert an unary number to a binary number?", "body": "<p>To increment a binary digit, you have to flip the first zero at the end of your number and all the ones preceding it. The cost of this operation is proportional to the number of 1 at the end of your input (for this your should represent number as right-to-left list, eg. the list [1;0;1;1] codes for 13).</p>\n\n<p>Let a(n) be the number of 1 at the end of n:</p>\n\n<pre><code>a(n) = 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0, 4, ...\n</code></pre>\n\n<p>and let </p>\n\n<pre><code>s(k) = a(2^k) + a(2^k+1) + ... + a(2^(k+1)-1) \n</code></pre>\n\n<p>be the sum of elements between two powers of 2. You should be able to convince yourself that s(k+1)=2*s(k) + 1 (with s(0) = 1) by noticing that </p>\n\n<pre><code>    a(2^(k+1)) ..., a(2^(k+2) - 1) \n</code></pre>\n\n<p>is obtained by concatenating </p>\n\n<pre><code>    a(2^k) + 1, ..., a(2^(k+1) - 1) and   a(2^k), ..., a(2^(k+1) - 1)\n</code></pre>\n\n<p>And therefore, as a geometric series, s(k) = 2^k - 1.</p>\n\n<p>Now the cost of incrementing N times a number should be proportional to </p>\n\n<pre><code>    a(0) + a(1) + ... + a(N)\n  = s(0) + s(1) + s(2)  + ... + s(log(N)) \n  = 2^0 - 1 + 2^1 -1 + 2^2-1 + ... + 2^log(N) - 1\n  = 2^0 + 2^1 + 2^2 + ... + 2^log(N) - log(N) - 1\n  = 2^(log(N) + 1) - 1 - log(N) - 1 = 2N - log(N) - 2\n</code></pre>\n\n<p>Therefore, if you take care of representing your numbers from right-to-left, then the naive algorithm is linear (note that you can perform to list reversal and stay linear if you really need your numbers the other way around).</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445465087, "post_id": 33268063, "comment_id": 54341256, "body": "I love that approach because only now it makes sense why the constant would be <code>2c</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445465818, "post_id": 33268063, "comment_id": 54341545, "body": "Can you just stop yelling at me, though?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445467201, "post_id": 33268063, "comment_id": 54342067, "body": "@Viclib Yelling at you? What do you mean?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445471528, "post_id": 33268063, "comment_id": 54343394, "body": "@Viclib Oh, hahaha! In that case, you can shut me up by mousing over my image at <a href=\"http://dmwit.com\" rel=\"nofollow noreferrer\">dmwit.com</a>. =D"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445481797, "post_id": 33268063, "comment_id": 54346077, "body": "Okay... not sure how I feel about this. Looks like you are eating my mouse, does."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 10, "last_activity_date": 1445457984, "last_edit_date": 1445457984, "creation_date": 1445457226, "answer_id": 33268063, "question_id": 33257360, "link": "https://stackoverflow.com/questions/33257360/is-there-any-efficient-way-to-convert-an-unary-number-to-a-binary-number/33268063#33268063", "title": "Is there any efficient way to convert an unary number to a binary number?", "body": "<p>I like the other answers, but I find their asymptotic analyses complicated. I therefore propose another answer that has a very simple asymptotic analysis. The basic idea is to implement <code>divMod 2</code> for unary numbers. Thus:</p>\n\n<pre><code>data UNat = Succ UNat | Zero\ndata Bit = I | O\n\ndivMod2 :: UNat -&gt; (UNat, Bit)\ndivMod2 Zero = (Zero, O)\ndivMod2 (Succ Zero) = (Zero, I)\ndivMod2 (Succ (Succ n)) = case divMod2 n of\n    ~(div, mod) -&gt; (Succ div, mod)\n</code></pre>\n\n<p>Now we can convert to binary by iterating <code>divMod</code>.</p>\n\n<pre><code>toBinary :: UNat -&gt; [Bit]\ntoBinary Zero = []\ntoBinary n = case divMod2 n of\n    ~(div, mod) -&gt; mod : toBinary div\n</code></pre>\n\n<p>The asymptotic analysis is now pretty simple. Given a number <code>n</code> in unary notation, <code>divMod2</code> takes O(n) time to produce a number half as big -- say, it takes at most <code>c*n</code> time for large enough <code>n</code>. Iterating this procedure therefore takes this much time:</p>\n\n<pre><code>c*(n + n/2 + n/4 + n/8 + ...)\n</code></pre>\n\n<p>As we all know, this series converges to <code>c*(2*n)</code>, so <code>toBinary</code> is also in O(n) with witness constant <code>2*c</code>.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3525, "favorite_count": 3, "accepted_answer_id": 33260216, "answer_count": 3, "score": 9, "last_activity_date": 1446023936, "creation_date": 1445424602, "question_id": 33257360, "link": "https://stackoverflow.com/questions/33257360/is-there-any-efficient-way-to-convert-an-unary-number-to-a-binary-number", "title": "Is there any efficient way to convert an unary number to a binary number?", "body": "<p>Let those datatypes represent unary and binary natural numbers, respectively:</p>\n\n<pre><code>data UNat = Succ UNat | Zero\ndata BNat = One BNat | Zero BNat | End\n\nu0 = Zero\nu1 = Succ Zero\nu2 = Succ (Succ Zero)\nu3 = Succ (Succ (Succ Zero))\nu4 = Succ (Succ (Succ (Succ Zero)))\n\nb0 = End                   //   0\nb1 = One End               //   1\nb2 = One (Zero End)        //  10\nb3 = One (One End)         //  11\nb4 = One (Zero (Zero End)) // 100\n\n(Alternatively, one could use `Zero End` as b1, `One End` as b2, `Zero (Zero End)` as b3...)\n</code></pre>\n\n<p>My question is: is there any way to implement the function:</p>\n\n<pre><code>toBNat :: UNat -&gt; BNat\n</code></pre>\n\n<p>That works in <code>O(N)</code>, doing only one pass through UNat?  </p>\n"}, {"tags": ["haskell", "unicode", "rdf", "unicode-literals"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1445396783, "post_id": 33250184, "comment_id": 54302342, "body": "Can you show me an equivalent example of <i>reading a file</i> in C or Java and having <code>\\u0073</code> converted to <code>c</code>? I would be incredibly surprised if any language \u2013 including C, Java, or Haskell \u2013 interpreted an &quot;\\&quot; as an escape character <i>when reading a file</i>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445397046, "post_id": 33250184, "comment_id": 54302407, "body": "On the other hand, a literal &quot;<a href=\"http://a.example/\" rel=\"nofollow noreferrer\">a.example</a>\\x0073&quot; <i>is</i> the same as  &quot;<a href=\"http://a.example/s\" rel=\"nofollow noreferrer\">a.example/s</a>&quot; (using <code>OverloadedStrings</code>). The only difference is that Haskell uses &quot;\\x&quot; as the prefix of a numeric escape for a  hexadecimal character."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1445397088, "post_id": 33250184, "comment_id": 54302418, "body": "The string literal &quot;s&quot; is equal to &quot;\\x0073&quot;, not &quot;\\\\u0073&quot;; the latter is simply the characters <code>\\ u 0 0 7 3</code>. If you want this functionality, you need to implement it yourself, although it looks like you want to parse some sort of markup language, for which there are a multitude of libraries."}, {"owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445397386, "post_id": 33250184, "comment_id": 54302493, "body": "@user2407038 so the W3C unit tests are all written for languages that encode the unicode character <code>s</code> as \\u0073 (according to <a href=\"http://www.fileformat.info/info/unicode/char/0073/index.htm\" rel=\"nofollow noreferrer\">fileformat.info/info/unicode/char/0073/index.htm</a> ). That&#39;d be quite alarming, given that the W3C units tests are exactly for the purpose of bringing multiple parsers into line."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445397673, "post_id": 33250184, "comment_id": 54302569, "body": "I don&#39;t see what relevance the W3C unit tests have to how numeric character escapes work in Haskell, or why you expect <code>readFile</code> to conform to them. For that matter, you haven&#39;t shown that reading a file in C or Java conforms to them either."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1445397818, "post_id": 33250184, "comment_id": 54302594, "body": "<code>Data.Text.IO.readFile</code> doesn&#39;t do any parsing, it simply attempts to read a file as a unicode encoded text file, and returns the contents. I can&#39;t imagine why anyone would think this function would perform the logic of parsing a markup language."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1455147944, "post_id": 33250184, "comment_id": 58364929, "body": "Note that <code>unescapeJava</code> doesn&#39;t translate <code>\\\\u0073</code> to <code>\\u0073</code>, so that it displays as <code>s</code>. It&#39;s not &quot;removing a backslash&quot; or anything like that. The 6 character sequence <code>\\u0073</code> is (one) way of <i>representing</i> the character <code>s</code> <b>in Java source code</b>. Whereas <code>\\\\u0073</code> is a 7 character sequence for representing the 6 character sequence <code>\\u0073</code> <b>in Java source code</b>. So <code>unesacpeJava</code> translates the 6 characters <code>\\u0073</code> to <code>s</code>, and then there&#39;s no need for any special handling to display it as <code>s</code>."}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 0, "creation_date": 1445400263, "post_id": 33250493, "comment_id": 54303226, "body": "Even your edit confuses <i>reading a file</i> with a Text or String <i>literal</i>."}, {"owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 0, "creation_date": 1445440307, "post_id": 33250493, "comment_id": 54327125, "body": "Thanks again. I&#39;ve since tried to separate in the question the distinction between what is consumed from the file and what I&#39;d like to do with the consumed string. I&#39;ve since given a Java example in the question, which demonstrates what I&#39;d like to achieve in Haskell. That is, an equivalent to the <code>unescapeJava(..)</code> method from the apache commons lang Java package."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 6, "last_activity_date": 1445399012, "last_edit_date": 1445399012, "creation_date": 1445398613, "answer_id": 33250493, "question_id": 33250184, "link": "https://stackoverflow.com/questions/33250184/unescaping-unicode-literals-found-in-haskell-strings/33250493#33250493", "title": "Unescaping unicode literals found in Haskell Strings", "body": "<p>In your example, <code>a</code> and <code>b</code> are not equal because the contents of the files that produced them are not equal.</p>\n\n<p><code>readFile</code> reads the literal contents of a file using \"the runtime system's locale, character set encoding, and line ending conversion settings.\" <code>readFile</code> will not parse numeric or other character escapes in W3C-compatible (or any other) form. The character \"\\\" in a file will always be read as a literal \"\\\", and never as the beginning of an escape sequence. I'm not sure why you expect this to behave otherwise, as I don't know of any language whose standard library automatically attempts to parse literal \"\\\"s into escape sequences when reading the contents of files.</p>\n\n<p>If you want to <em>parse</em> the literal text \"\\u0073\" (That's the characters <code>\\</code>, <code>u</code>, <code>0</code>, <code>0</code>, <code>7</code>, <code>3</code>, which would be displayed by Haskell as \"\\\\u0073\") as a numeric escape for the character <code>s</code>, you will need to write a parser or use one that someone else has written. <a href=\"https://hackage.haskell.org/package/base-4.7.0.1/docs/Data-Char.html#v:readLitChar\"><code>readLitChar</code></a> is such a parser, but it uses the Haskell convention, which is different from what W3C defines. However, you can see the underlying construction of <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Text.Read.Lex.html#lexChar\"><code>lexCharE</code></a>, which may help you write your own.</p>\n"}], "owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1197, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1455074442, "creation_date": 1445396273, "last_edit_date": 1455074442, "question_id": 33250184, "link": "https://stackoverflow.com/questions/33250184/unescaping-unicode-literals-found-in-haskell-strings", "title": "Unescaping unicode literals found in Haskell Strings", "body": "<p>The unicode for lower case <code>s</code> is U+0073 , which <a href=\"http://www.fileformat.info/info/unicode/char/0073/index.htm\" rel=\"nofollow\">this website</a> says is <code>\\u0073</code> in C and Java.</p>\n\n<p>Given a file: <code>a.txt</code> containing:</p>\n\n<pre><code>http://www.example.com/\\u0073\n</code></pre>\n\n<p>Let's read this with Java, and unescape the <code>\\</code> and see what we get:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>import java.io.IOException;\nimport java.nio.file.Files;\nimport java.nio.file.Paths;\nimport org.apache.commons.lang3.StringEscapeUtils;\n\npublic class Main {\n  public static void main(String[] args) throws IOException {\n    String s2 = new String(Files.readAllBytes(Paths.get(\"a.txt\")));\n    System.out.println(s2); // prints http://www.example.com/\\u0073\n\n    String s3 = org.apache.commons.lang3.StringEscapeUtils.unescapeJava(s2);\n    System.out.println(s3); // prints http://www.example.com/s\n  }\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>$ java -cp ./commons-lang3-3.4.jar:. Main\nhttp://www.example.com/\\u0073\nhttp://www.example.com/s\n</code></pre>\n\n<p>The <code>unescapeJava(s2)</code> method call takes the <code>\\\\u0073</code> from the file and unescapes to <code>\\u0073</code>, which then printed becomes \"s\".</p>\n\n<p>Can we do the same in Haskell?</p>\n\n<p>Let's consume these two files with the text library:</p>\n\n<pre><code>Prelude &gt; a &lt;- Data.Text.IO.readFile \"a.txt\"\nPrelude &gt; a\n\"http://www.example.com/\\\\u0073\\n\"\n</code></pre>\n\n<p>Any expectation of automatic translation from <code>\\u0073</code> to <code>s</code> in Haskell could be confused by the <code>\\x</code> rather than <code>\\u</code> prefix for carrying out such expectations:</p>\n\n<pre><code>Prelude&gt; \"\\x0073\"\n\"s\"\n</code></pre>\n\n<p>So how do I take <code>unescapeJava(..)</code> method in apace-common-lang, and replicate its functionality in Haskell to go from <code>\\\\u0073</code> to <code>\\u0073</code>, and to print this as \"s\"?</p>\n"}, {"tags": ["haskell", "yesod", "keter"], "comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1445461778, "post_id": 33246310, "comment_id": 54339656, "body": "I forget the exact details, but I think that <code>yesod keter</code>&#39;s functionality is covered by another package. Maybe that has more configuration options?"}], "answers": [{"tags": [], "owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "is_accepted": true, "score": 2, "last_activity_date": 1445402950, "last_edit_date": 1445402950, "creation_date": 1445402516, "answer_id": 33251080, "question_id": 33246310, "link": "https://stackoverflow.com/questions/33246310/including-extra-directories-with-keter/33251080#33251080", "title": "Including extra directories with Keter", "body": "<p>All the <code>yesod keter</code> command does is create a <code>.tar.gz</code> compressed archive file with the <code>.keter</code> extension containing the following subdirectories:</p>\n\n<ul>\n<li><code>config</code>: an exact copy of the identically named directory in your source tree</li>\n<li><code>dist</code>: contains a subdirectory <code>bin</code> containing your app's binary</li>\n<li><code>static</code>: an exact copy of the identically named directory in your source tree</li>\n</ul>\n\n<p>Note that the path to your app's binary is set in <code>config/keter.yml</code> via the <code>exec</code> setting while the path to your static files is set via the <code>root</code> setting. The exact set of files included by the <code>yesod keter</code> command is specified in the <a href=\"https://github.com/yesodweb/yesod/blob/master/yesod-bin/Keter.hs#L58\" rel=\"nofollow\"><code>findFiles</code></a> function if you want to take a look at the source code.</p>\n\n<p>If you want to customize the contents of your <code>.keter</code> file it is probably most straightforward to write a shell script to create the archive. With this script you can add arbitrary extra directories to the archive.</p>\n\n<p>The bare minimum bash script you'd need to emulate the behaviour of <code>yesod keter</code> is as follows:</p>\n\n<pre><code>#!/bin/bash\ntar cvf myapp.keter config/ dist/bin/ static/\n</code></pre>\n\n<p>You can customize this however you want to produce the correct content. Adding <code>download/</code> to the end of this command line should do the trick.</p>\n"}], "owner": {"reputation": 3418, "user_id": 738762, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0ef9a1ef193431ba6a0e2fc5c71ab22d?s=128&d=identicon&r=PG", "display_name": "nomen", "link": "https://stackoverflow.com/users/738762/nomen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 33251080, "answer_count": 1, "score": 2, "last_activity_date": 1445402950, "creation_date": 1445373188, "last_edit_date": 1445402249, "question_id": 33246310, "link": "https://stackoverflow.com/questions/33246310/including-extra-directories-with-keter", "title": "Including extra directories with Keter", "body": "<p>I have a Yesod site and have created a handler for handling downloads and enforcing constraints.  My Yesod project directory has a subdirectory called <code>downloads</code>, and it contains files I want the user to be able to download if they are logged in.  The handler works great in my development and staging boxes, but breaks when I transfer to production.  I tracked the problem down to <code>yesod keter</code> not archiving the files when it builds its bundle.</p>\n\n<p>How do I convince <code>keter</code> to include the directory?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1445372671, "post_id": 33246126, "comment_id": 54294512, "body": "Maybe you wanted <code>type ListT a = [(a, String)]</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1445372944, "post_id": 33246126, "comment_id": 54294643, "body": "To avoid confusion you might want to choose a different name -  <b>ListT</b> is used in the Haskell community for the monad transformer for the List type."}, {"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 1, "creation_date": 1445373538, "post_id": 33246126, "comment_id": 54294939, "body": "okay, thanks i&#39;ll change it"}], "answers": [{"tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 7, "last_activity_date": 1445372732, "creation_date": 1445372732, "answer_id": 33246195, "question_id": 33246126, "link": "https://stackoverflow.com/questions/33246126/data-definition-error-haskell/33246195#33246195", "title": "Data definition error haskell", "body": "<p>It means that you forgot to provide the name for the value constructor. You need to change your code to the following:</p>\n\n<pre><code>data ListT a = ListT [(a,String)]\n</code></pre>\n\n<p>BTW, it is not a proper implementation of List Transformer.</p>\n"}], "owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1262, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1445372732, "creation_date": 1445372493, "question_id": 33246126, "link": "https://stackoverflow.com/questions/33246126/data-definition-error-haskell", "title": "Data definition error haskell", "body": "<p>I'm trying to define a polymorphic list of tuples without using any imports.\ni have <code>data ListT a = [(a,String)]\n        deriving (Eq,Ord,Read,Show)</code>\nbut it keeps giving the error \"cannot parse data constructor in a data/newtype declaration: [(a,String)]\"</p>\n\n<p>What does this error mean, and how do I prevent it.\nThanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1445372825, "post_id": 33245996, "comment_id": 54294584, "body": "the problem is that <b>GHCi</b> does not know the type of <code>e0</code> so you have to tell: <code>try (print x) :: IO (Either ArithException ())</code> - the reason is that at compile time there are quite a few possible instances (for the different exceptions: <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception\" rel=\"nofollow noreferrer\">see here</a> - and GHCi cannot choose)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1445372887, "post_id": 33245996, "comment_id": 54294617, "body": "(of course you can always use <code>SomeException</code> too)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445388458, "post_id": 33245996, "comment_id": 54300332, "body": "@Carsten That looks like an answer to me!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445400743, "post_id": 33245996, "comment_id": 54303368, "body": "@DanielWagner done - thanks"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 6, "last_activity_date": 1445400725, "creation_date": 1445400725, "answer_id": 33250817, "question_id": 33245996, "link": "https://stackoverflow.com/questions/33245996/exception-type-error/33250817#33250817", "title": "Exception type error", "body": "<p>the problem is that Haskell/<em>GHCi</em> does not know the type of <code>e0</code> so you have to annotate it: </p>\n\n<pre><code>try (print x) :: IO (Either ArithException ()) \n</code></pre>\n\n<p>the reason is that at compile time there are quite a few possible instances (for the different exceptions): <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception\">see here for a description</a> - and <em>GHCi</em> cannot choose</p>\n\n<p>You can get GHCi to tell you so if you look a bit deeper into the expressions (more or less don't directly force <em>GHCi</em> to <code>show</code> it):</p>\n\n<pre><code>Prelude Control.Exception&gt; e &lt;- try (print x)\n\n&lt;interactive&gt;:5:6:\n    No instance for (Exception e0) arising from a use of `try'\n    The type variable `e0' is ambiguous\n    Note: there are several potential instances:\n      instance Exception NestedAtomically\n        -- Defined in `Control.Exception.Base'\n      instance Exception NoMethodError\n        -- Defined in `Control.Exception.Base'\n      instance Exception NonTermination\n        -- Defined in `Control.Exception.Base'\n      ...plus 7 others\n    In the first argument of `GHC.GHCi.ghciStepIO ::\n                                IO a_a18N -&gt; IO a_a18N', namely\n      `try (print x)'\n    In a stmt of an interactive GHCi command:\n      e &lt;- GHC.GHCi.ghciStepIO :: IO a_a18N -&gt; IO a_a18N (try (print x))\n</code></pre>\n\n<hr>\n\n<p>of course you don't have to <em>guess</em> the right exception (as <strong>I</strong> did with <code>ArithException</code>) - instead you can use <code>SomeException</code> to <em>catch</em> all too:</p>\n\n<pre><code>Prelude Control.Exception&gt; try (print x) :: IO (Either SomeException ())\nLeft divide by zero\n</code></pre>\n"}], "owner": {"reputation": 1467, "user_id": 3029422, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/13887984efe106e46fbeb35bcb56f134?s=128&d=identicon&r=PG&f=1", "display_name": "Ionut", "link": "https://stackoverflow.com/users/3029422/ionut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 33250817, "answer_count": 1, "score": 2, "last_activity_date": 1445402384, "creation_date": 1445372051, "last_edit_date": 1445402384, "question_id": 33245996, "link": "https://stackoverflow.com/questions/33245996/exception-type-error", "title": "Exception type error", "body": "<p>I'm learning how exceptions work in Haskell.<br>\nWhen trying to replicate <a href=\"http://book.realworldhaskell.org/read/error-handling.html#errors.exceptions.firststeps\" rel=\"nofollow\">this</a> simple example in Prelude I get:</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :m Control.Exception\nPrelude Control.Exception&gt; let x = 5 `div` 0\nPrelude Control.Exception&gt; let y = 5 `div` 1\nPrelude Control.Exception&gt; print x\n*** Exception: divide by zero\nPrelude Control.Exception&gt; print y\n5\nPrelude Control.Exception&gt; try (print x)\n\n&lt;interactive&gt;:16:1:\n    No instance for (Show (IO (Either e0 ())))\n      arising from a use of `print'\n    In a stmt of an interactive GHCi command: print it\nPrelude Control.Exception&gt;\n</code></pre>\n\n<p>Why do I get the <strong>no instance error</strong> on <code>try(print x)</code>, when previously I got an exception?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1445372298, "post_id": 33245912, "comment_id": 54294324, "body": "first you can exchange <code>f(a)</code> with the value <code>f 0</code> and <code>g(a)</code> with the value <code>g 1</code>here - and then yes it is possible, for example you can use <code>foldr</code> to do so - maybe you&#39;ll want to have a look at it before we spoil it?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1445372454, "post_id": 33245912, "comment_id": 54294406, "body": "hint: the idea is to fold up the list into a tuple <code>(na,nb,xs)</code> where <code>na</code> is the number of <i>seen</i> <code>a</code>s,  <code>nb</code> is the same for <code>b</code>s and <code>xs</code> is the mapped list you did here with <code>map h</code> (look for a way to express <code>map</code> using <code>foldr</code> first - additional hint: use <code>(:)</code> and <code>[]</code> ;)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1445373165, "post_id": 33245912, "comment_id": 54294743, "body": "<code>mapAccumR</code> can also be of help, since it combines a fold with a map."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445373975, "post_id": 33245912, "comment_id": 54295170, "body": "@chi, why not <code>mapAccumL</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445374154, "post_id": 33245912, "comment_id": 54295252, "body": "@user3237465 because the above looks like a <code>foldr</code>-style recursion."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445374626, "post_id": 33245912, "comment_id": 54295502, "body": "@chi, it&#39;s the mapping part is <code>foldr</code>-style recursion \u2014 that part both the <code>mapAccum</code>s have, since both are defined in terms of <code>traverse</code>. However it seems more natural to sum <code>Int</code>s from left to right."}, {"owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "edited": false, "score": 0, "creation_date": 1445377820, "post_id": 33245912, "comment_id": 54297178, "body": "I think I have solved it, thanks everyone!"}], "answers": [{"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1445375086, "last_edit_date": 1445375086, "creation_date": 1445373721, "answer_id": 33246424, "question_id": 33245912, "link": "https://stackoverflow.com/questions/33245912/do-recursion-and-counting-numbers-at-the-same-time-in-haskell/33246424#33246424", "title": "Do recursion and counting numbers at the same time in Haskell", "body": "<p>This is not an answer you are looking for, but there is a nice abstract structure behind your function, so I'll leave it here:</p>\n\n<pre><code>import Data.Monoid\nimport Data.Functor\nimport Data.Traversable\nimport Control.Arrow\nimport Control.Monad.Trans.Writer\n\nwr :: Int -&gt; Writer (Sum Int, Sum Int) Int\nwr 0 = tell (Sum 1, Sum 0) $&gt; f 0\nwr 1 = tell (Sum 0, Sum 1) $&gt; g 1\nwr n = return $ h n\n\ncollect :: [Int] -&gt; ([Int], (Int, Int))\ncollect = second (getSum *** getSum) . runWriter . traverse wr\n</code></pre>\n\n<p>Summing is a monoid, double summing is a monoid, the <code>Writer</code> monad handles monoids, <code>traverse</code> maps a list with an effectful function and performs all effects.</p>\n\n<p>This:</p>\n\n<pre><code>f = (+ 1)\ng = (+ 2)\nh = (+ 3)\n\nmain = print $ collect [0, 1, 2, 3, 0, 0, 0, 4, 1]\n</code></pre>\n\n<p>prints <code>([1,3,5,6,1,1,1,7,3],(4,2))</code> \u2014 four zeros and two ones.</p>\n"}], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1445375086, "creation_date": 1445371711, "last_edit_date": 1445372030, "question_id": 33245912, "link": "https://stackoverflow.com/questions/33245912/do-recursion-and-counting-numbers-at-the-same-time-in-haskell", "title": "Do recursion and counting numbers at the same time in Haskell", "body": "<p>If I had a known list <code>A :: [Int]</code>, and wanted to get a new list <code>B = newList A</code> with <code>newList</code> defined as the following:</p>\n\n<pre><code>newList :: [Int] -&gt; [Int]\nnewList [] = []\nnewList (a:as) | a==0      = f(a) : newList (as)\n               | a==1      = g(a) : newList (as)\n               | otherwise = h(a) : newList (as)\n</code></pre>\n\n<p>where <code>f, g, h :: Int -&gt; Int</code> are unimportant functions.</p>\n\n<p>Other than <code>B</code>, I also wanted to know how many <code>0, 1</code> are there in <code>A</code> respectively.</p>\n\n<p>But since when producing <code>B</code> recursively, it has already checked whether <code>a== (0 or 1)</code> for each elements in <code>A</code>, so it's a redundancy to check it again separably. </p>\n\n<p>Is it possible to get <code>B</code> but at the same time get how many <code>0, 1</code> are there in <code>A</code> with checking only once?</p>\n"}, {"tags": ["haskell", "ghc", "derived-instances"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445373809, "post_id": 33245788, "comment_id": 54295073, "body": "I&#39;m not at my computer right now, but you might try standalone deriving. If that doesn&#39;t work, you can build it manually using coercions if you need the efficiency boost."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445373987, "post_id": 33245788, "comment_id": 54295177, "body": "@dfeuer I am using <code>StandaloneDeriving</code>, see the language pragmas. I&#39;m not concerned about efficiency per se, really just expediency."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445374713, "post_id": 33245788, "comment_id": 54295550, "body": "Oh, sorry, I didn&#39;t look closely enough. No, you can&#39;t really tell <code>deriving</code> what to do the way you&#39;re trying to, and <code>MPTC</code> is throwing a wrench into the machine. I don&#39;t know if a functional dependency would help anything even if one were acceptable to you."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1445377131, "post_id": 33245788, "comment_id": 54296823, "body": "I reckon fundeps wouldn&#39;t help either, at least I have run into error messages along the lines \u201ccan&#39;t derive instance with associated type, not even with cunning generalized deriving\u201d. \u2014 No, I really don&#39;t think it&#39;s possible to derive instances like this, at all. Should be a pretty tractable job for TH or even CPP, though."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1445396671, "post_id": 33249044, "comment_id": 54302314, "body": "There are no tickets because it is not a bug. The only way to do this without ambiguity would be to allow the programmer to specify which instance to derive from."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1445388262, "last_edit_date": 1445388262, "creation_date": 1445387551, "answer_id": 33249044, "question_id": 33245788, "link": "https://stackoverflow.com/questions/33245788/using-xgeneralizednewtypederiving-with-xmultiparamtypeclasses/33249044#33249044", "title": "Using -XGeneralizedNewtypeDeriving with -XMultiParamTypeClasses", "body": "<p>Unfortunately, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#generalized-newtype-deriving\" rel=\"nofollow\"><code>GeneralizedNewtypeDeriving</code></a> only works on the <em>last</em> parameter of a multi-parameter typeclass. Even with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#stand-alone-deriving\" rel=\"nofollow\">standalone deriving</a>:</p>\n\n<blockquote>\n  <ul>\n  <li><p>The stand-alone syntax is generalised for newtypes in exactly the same way that ordinary <code>deriving</code> clauses are generalised (<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#newtype-deriving\" rel=\"nofollow\">Section 7.5.5, \u201cGeneralised derived instances for newtypes\u201d</a>). For example: </p>\n\n<pre><code>newtype Foo a = MkFoo (State Int a)\nderiving instance MonadState Int Foo\n</code></pre>\n  \n  <p>GHC always treats the <em>last</em> parameter of the instance (<code>Foo</code> in this example) as the type whose instance is being derived. </p></li>\n  </ul>\n</blockquote>\n\n<p>(BTW, I tried searching for any relevant GHC trac bug report or feature request, but couldn't find any.)</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 33249044, "answer_count": 1, "score": 2, "last_activity_date": 1445388262, "creation_date": 1445371248, "last_edit_date": 1445375220, "question_id": 33245788, "link": "https://stackoverflow.com/questions/33245788/using-xgeneralizednewtypederiving-with-xmultiparamtypeclasses", "title": "Using -XGeneralizedNewtypeDeriving with -XMultiParamTypeClasses", "body": "<p>The following code results in an error:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving, MultiParamTypeClasses, StandaloneDeriving #-}\n\nclass Module a b where\n    (*&gt;) :: a -&gt; b -&gt; b\n\ndata D\nnewtype DWrapper = DW D    \ninstance Module D D    \nderiving instance Module DWrapper DWrapper\n</code></pre>\n\n<p>The error:</p>\n\n<pre><code>No instance for (Module DWrapper D) arising from a use of \u2018Main.*&gt;\u2019\nIn the first argument of \u2018GHC.Prim.coerce\u2019, namely\n  \u2018(Main.*&gt;) :: DWrapper -&gt; D -&gt; D\u2019\nIn the expression:\n    GHC.Prim.coerce ((Main.*&gt;) :: DWrapper -&gt; D -&gt; D) ::\n      DWrapper -&gt; DWrapper -&gt; DWrapper\nIn an equation for \u2018*&gt;\u2019:\n    (*&gt;)\n      = GHC.Prim.coerce ((Main.*&gt;) :: DWrapper -&gt; D -&gt; D) ::\n          DWrapper -&gt; DWrapper -&gt; DWrapper\nWhen typechecking the code for  \u2018Main.*&gt;\u2019\n  in a derived instance for \u2018Module DWrapper DWrapper\u2019:\n  To see the code I am typechecking, use -ddump-deriv\n</code></pre>\n\n<p>So GHC is looking for a <code>Module DWrapper D</code> instance to derive the requested <code>Module D D</code> instance. This is reasonable I guess, but not what I intended. Is there a way to tell GHC which instance to derive from? How does GNTD work on MPTCs?</p>\n"}, {"tags": ["haskell", "plot", "charts"], "answers": [{"comments": [{"owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "edited": false, "score": 0, "creation_date": 1445359472, "post_id": 33242179, "comment_id": 54286940, "body": "Thanks! Perfect solution."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1445359609, "last_edit_date": 1445359609, "creation_date": 1445359338, "answer_id": 33242179, "question_id": 33241799, "link": "https://stackoverflow.com/questions/33241799/chart-gtk-rendering-failed/33242179#33242179", "title": "Chart Gtk Rendering failed", "body": "<p><code>renderableToWindow</code> has type...</p>\n\n<pre><code>renderableToWindow :: Renderable a -&gt; Int -&gt; Int -&gt; IO ()\n</code></pre>\n\n<p>... and so it doesn't take the <code>EC</code> computation you are trying to pass as the last argument. I believe the easiest solution is using <a href=\"https://hackage.haskell.org/package/Chart-gtk-1.5.1/docs/Graphics-Rendering-Chart-Gtk.html#v:toWindow\" rel=\"nofollow\"><code>toWindow</code></a>, which will run the <code>EC</code> computation with the default state, convert its result to a <code>Renderable</code> and pass it to <code>renderableToWindow</code>:</p>\n\n<blockquote>\n  <p><code>toWindow :: (Default r, ToRenderable r) =&gt; Int -&gt; Int -&gt; EC r () -&gt; IO ()</code> </p>\n</blockquote>\n\n<pre><code>main = toWindow 300 300 $ do\n    layout_title .= \"Amplitude Modulation\"\n    setColors [opaque blue, opaque red]\n    plot (line \"am\" [signal [0,(0.5)..400]])\n    plot (points \"am points\" (signal [0,7..400]))\n</code></pre>\n"}], "owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 33242179, "answer_count": 1, "score": 1, "last_activity_date": 1445359609, "creation_date": 1445358096, "last_edit_date": 1445359373, "question_id": 33241799, "link": "https://stackoverflow.com/questions/33241799/chart-gtk-rendering-failed", "title": "Chart Gtk Rendering failed", "body": "<p>I'm on <code>Haskell</code> and using the <code>Chart</code> module.\nThere is no documentation for rendering in active <code>GTK</code> window. So I tryed by my own:</p>\n\n<pre><code>import Graphics.Rendering.Chart.Easy\nimport Graphics.Rendering.Chart.Gtk\n\nsignal :: [Double] -&gt; [(Double,Double)]\nsignal xs = [ (x,(sin (x*3.14159/45) + 1) / 2 * (sin (x*3.14159/5))) | x &lt;- xs ]\n\nmain = renderableToWindow def 300 300 $ do\n    layout_title .= \"Amplitude Modulation\"\n    setColors [opaque blue, opaque red]\n    plot (line \"am\" [signal [0,(0.5)..400]])\n    plot (points \"am points\" (signal [0,7..400]))\n</code></pre>\n\n<p>But this is not correct, cause <code>ghc -o main main.hs</code> returns:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( main.hs, main.o )\n\nmain.hs:7:8:\n    Couldn't match expected type \u2018Control.Monad.Trans.State.Lazy.StateT\n                                    (Layout Double Double)\n                                    (Control.Monad.Trans.State.Lazy.State CState)\n                                    ()\n                                  -&gt; t\u2019\n                with actual type \u2018IO ()\u2019\n    Relevant bindings include main :: t (bound at main.hs:7:1)\n    The first argument of ($) takes one argument,\n    but its type \u2018IO ()\u2019 has none\n    In the expression:\n      renderableToWindow def 300 300\n      $ do { layout_title .= \"Amplitude Modulation\";\n             setColors [opaque blue, opaque red];\n             plot (line \"am\" [signal [0, (0.5) .. 400]]);\n             plot (points \"am points\" (signal [0, 7 .. 400])) }\n    In an equation for \u2018main\u2019:\n        main\n          = renderableToWindow def 300 300\n            $ do { layout_title .= \"Amplitude Modulation\";\n                   setColors [opaque blue, ....];\n                   plot (line \"am\" [signal ...]);\n                   .... }\n</code></pre>\n\n<p>So now my question: How to make a correct GTK rendering?</p>\n"}, {"tags": ["haskell", "frp", "reactive-banana"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1445422438, "post_id": 33238862, "comment_id": 54314395, "body": "just curious: is this a real or hobby project?"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1445436532, "post_id": 33238862, "comment_id": 54324133, "body": "It&#39;s real, but not a game qua game. It&#39;s a game serving a purpose other than being just a game."}], "answers": [{"comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1445361944, "post_id": 33242692, "comment_id": 54288384, "body": "I&#39;ve tried that but then other bindings fall out of scope. I&#39;m thinking I need to add RecursiveDo to prevent that."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1445362148, "post_id": 33242692, "comment_id": 54288502, "body": "@MichaelLitchard Indeed -- the changes mean you will need <code>MonadFix</code>/<code>RecursiveDo</code> in some form for mutually recursive definitions involving behaviours defined with <code>acummB</code>/<code>stepper</code>."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1445437012, "post_id": 33242692, "comment_id": 54324550, "body": "For future haskellers - the key is to use mdo instead of do. Syntactic sugar for rec and fix."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1445360923, "creation_date": 1445360923, "answer_id": 33242692, "question_id": 33238862, "link": "https://stackoverflow.com/questions/33238862/reactive-banana-1-0-0-why-is-this-old-code-breaking/33242692#33242692", "title": "Reactive Banana 1.0.0 - Why is this old code breaking?", "body": "<p>Adjusting your code to fit the new type of <code>accumB</code> should only take using a monadic bind rather than a <code>let</code> expression to define <code>bResourceMap</code>:</p>\n\n<pre><code>bResourceMap &lt;- accumB initRmap (adjustMarket &lt;$&gt; bMarketRolls &lt;@ eTick)\n</code></pre>\n\n<p>The type error you quote seems unrelated. My guess would be that <code>initRmap</code> was accidentally changed from being a <code>ResourceMap</code> to a <code>Behavior ResourceMap</code>, leading to the the type mismatch.</p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 33242692, "answer_count": 1, "score": 6, "last_activity_date": 1445360923, "creation_date": 1445349804, "question_id": 33238862, "link": "https://stackoverflow.com/questions/33238862/reactive-banana-1-0-0-why-is-this-old-code-breaking", "title": "Reactive Banana 1.0.0 - Why is this old code breaking?", "body": "<p>Here's code that used to work (truncated appropriately I hope)</p>\n\n<pre><code>makeNetworkDescription :: forall t . Frameworks t =&gt; Parameters -&gt; Moment t ()\nmakeNetworkDescription params = do\n  eInput &lt;- fromAddHandler (input params)\n  eTick &lt;- fromAddHandler (tick params)\n  ..\nlet\n    bResourceMap :: Behavior t ResourceMap\n    bResourceMap = accumB initRmap $\n      adjustMarket &lt;$&gt;\n      bMarketRolls &lt;@\n      eTick\n</code></pre>\n\n<p>But now the types have changed.<br>\nwe have:<br>\n    <code>makeNetworkDescription :: Parameters -&gt; MomentIO ()</code>\nand\n    <code>accumB :: MonadMoment m =&gt; a -&gt; Event (a -&gt; a) -&gt; m (Behavior a)</code></p>\n\n<p>say I change the definition of <code>bResourceMap</code> to</p>\n\n<pre><code>bResourceMap :: Behavior ResourceMap\nbResourceMap = accumB initRmap $\n               adjustMarket   &lt;$&gt;\n               bMarketRolls   &lt;@\n               eTick\n</code></pre>\n\n<p>slightly off from the <code>accumB</code> definition, but let's see what happens.</p>\n\n<p><code>ghc</code> gives an error</p>\n\n<pre><code>Couldn't match type \u2018Behavior ResourceMap\u2019 with \u2018ResourceMap\u2019\nExpected type: Behavior ResourceMap\n  Actual type: Behavior (Behavior ResourceMap)\n</code></pre>\n\n<p>Right, because of the type of <code>accumB</code> the behavior needs to be within the context of a <code>MonadMoment</code>. Having a look at <code>MonadMoment</code> I find two instances</p>\n\n<pre><code>instance MonadMoment Moment where liftMoment = id\ninstance MonadMoment MomentIO where liftMoment = MIO . unM\n</code></pre>\n\n<p>So why did the actual type resolve to <code>Behavior (Behavior ResourceMap)</code>, the outer type has to be a <code>MonadMoment</code>, which doesn't match.</p>\n\n<p>I'd like advice on how to resolve this type of problem, it happens with all my <code>Behavior</code> definitions.</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 17066, "user_id": 1135948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5edf3c92c5e52ed83cbd5ebd98f4c18d?s=128&d=identicon&r=PG", "display_name": "lmm", "link": "https://stackoverflow.com/users/1135948/lmm"}, "edited": false, "score": 0, "creation_date": 1445356542, "post_id": 33238435, "comment_id": 54285149, "body": "I need a version in terms of recursion-schemes because my actual case is not <code>List</code> but a recursion-schemes style structure. AIUI the recursion-schemes <code>para</code> is <code>para :: Foldable t =&gt; (Base t (t, a) -&gt; a) -&gt; t -&gt; a</code> which doesn&#39;t have the <code>b</code> parameter from your example. Can you give a version in terms of this <code>para</code> (or other recursion-schemes code) that is <code>tails</code> if we call it with <code>t f a = Maybe (a, f)</code> (in the sense that <code>Base t</code> is then isomorphic to <code>List</code>, unless I&#39;m mistaken) but can also be called with other <code>t</code>?"}, {"owner": {"reputation": 17066, "user_id": 1135948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5edf3c92c5e52ed83cbd5ebd98f4c18d?s=128&d=identicon&r=PG", "display_name": "lmm", "link": "https://stackoverflow.com/users/1135948/lmm"}, "edited": false, "score": 0, "creation_date": 1445468850, "post_id": 33238435, "comment_id": 54342594, "body": "<code>Prim</code> seems to be a <code>List</code>-specific thing, whereas I want a version that works for non-list data structures, and I don&#39;t think I necessarily could always define a <code>Base t ~ Prim [a]</code>? The function I&#39;m thinking of shouldn&#39;t need any additional constraints - I&#39;ve updated the question with an implementation that I think would be valid (but which I&#39;d expect to be a standard function, or at least more concise than my version)."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 10, "last_activity_date": 1445361085, "last_edit_date": 1445361085, "creation_date": 1445348796, "answer_id": 33238435, "question_id": 33237460, "link": "https://stackoverflow.com/questions/33237460/recursion-schemes-generalization-of-tails/33238435#33238435", "title": "Recursion-schemes generalization of `tails`", "body": "<p>I don't see any issue with <code>para</code>. Just cons back the head and the tail at each <code>Cons</code> step:</p>\n\n<pre><code>import Data.Functor.Foldable\n\ntails :: [a] -&gt; [[a]]\ntails = para (\\case Nil -&gt; [[]]; Cons a (as, res) -&gt; (a : as) : res)\n</code></pre>\n\n<p>For clarity, specialized to lists and without <code>recursion-schemes</code>:</p>\n\n<pre><code>para :: (a -&gt; [a] -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\npara f z []     = z\npara f z (a:as) = f a as (para f z as)\n\ntails :: [a] -&gt; [[a]]\ntails = para (\\a as res -&gt; (a : as) : res) [[]]\n</code></pre>\n\n<p>However, if you'd like to be more general, the less nice <code>para</code> formulation comes handy:</p>\n\n<pre><code>import qualified Data.Functor.Foldable as Rec (Foldable)\n\ntails :: (Rec.Foldable t, Base t ~ Prim [a]) =&gt; t -&gt; [t]\ntails as = as : para (\\case Nil -&gt; []; Cons a (as, res) -&gt; as : res) as\n</code></pre>\n\n<p>This works for lists as usual, but you can also give <code>type instance Base t = Prim [a]</code> for other <code>t</code>-s, along with the <code>Foldable</code> instance, and use them as well. </p>\n\n<p>Alternatively, we can keep the first <code>tails</code> definition at the cost of introducing an <code>Unfoldable</code> constraint:</p>\n\n<pre><code>tails' :: (Unfoldable t, Rec.Foldable t, Base t ~ Prim [a]) =&gt; t -&gt; [t]\ntails' = para (\\case Nil -&gt; [embed Nil]; Cons a (as, res) -&gt; embed (Cons a as) : res)\n</code></pre>\n\n<p>This isn't too bad, since for each <code>project</code> there should be an inverse <code>embed</code> for fixpoints of functors anyway, so the <code>Foldable</code> and <code>Unfoldable</code> instances naturally come in pairs. </p>\n"}, {"comments": [{"owner": {"reputation": 17066, "user_id": 1135948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5edf3c92c5e52ed83cbd5ebd98f4c18d?s=128&d=identicon&r=PG", "display_name": "lmm", "link": "https://stackoverflow.com/users/1135948/lmm"}, "edited": false, "score": 0, "creation_date": 1445764429, "post_id": 33306183, "comment_id": 54453083, "body": "Is this the preferred style when using <code>para</code> then? I thought of doing the recursion this way around, but I don&#39;t like the <code>m :</code> any more than I like the <code>fmap fst</code> - either way it feels like slightly the wrong abstraction."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1445614219, "creation_date": 1445614219, "answer_id": 33306183, "question_id": 33237460, "link": "https://stackoverflow.com/questions/33237460/recursion-schemes-generalization-of-tails/33306183#33306183", "title": "Recursion-schemes generalization of `tails`", "body": "<p><code>para</code> is indeed the right function to use here. I have put everything in a <a href=\"https://gist.github.com/gallais/4b0671fee50923320cbf\" rel=\"nofollow\">self-contained gist</a> augmented with examples if you want to play with it.</p>\n\n<p>We start with the definition of the fixpoint <code>Mu</code> and the usual <code>fold</code> and <code>para</code>.</p>\n\n<pre><code>module Tails where\n\nimport Data.Function\n\nnewtype Mu f = In { out :: f (Mu f) }\n\nfold :: Functor f =&gt; (f a -&gt; a) -&gt; Mu f -&gt; a\nfold alg = alg . fmap (fold alg) . out\n\npara :: Functor f =&gt; (f (a, Mu f) -&gt; a) -&gt; Mu f -&gt; a\npara alg = alg . fmap (\\m -&gt; (para alg m, m)). out\n</code></pre>\n\n<p>We can then implement <code>tails</code> using <code>para</code> and an additional <code>Foldable</code> constraint allowing us to use <code>foldMap</code> to collect the intermediate result in the list monoid:</p>\n\n<pre><code>tails :: (Functor f, Foldable f) =&gt; Mu f -&gt; [Mu f]\ntails m = m : para (foldMap $ uncurry $ flip (:)) m\n</code></pre>\n"}], "owner": {"reputation": 17066, "user_id": 1135948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5edf3c92c5e52ed83cbd5ebd98f4c18d?s=128&d=identicon&r=PG", "display_name": "lmm", "link": "https://stackoverflow.com/users/1135948/lmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1445614219, "creation_date": 1445346298, "last_edit_date": 1445468808, "question_id": 33237460, "link": "https://stackoverflow.com/questions/33237460/recursion-schemes-generalization-of-tails", "title": "Recursion-schemes generalization of `tails`", "body": "<p>I've got a recursion-schemes style structure and I'd like to obtain a list of all substructures including the full structure - i.e. the equivalent of what the <code>tails</code> function does on a <code>List</code>. I think it would be possible to implement this by calling <code>para</code>, mapping back to the original structure at each step, and then sticking the original structure on the front separately, but that seems very cumbersome: (untested, apologies if the Haskell is incorrect; written in terms of <code>Mu</code> as I haven't really understood the <code>Base</code> construct yet)</p>\n\n<pre><code>gtails :: Functor f =&gt; Mu f -&gt; [Mu f]\ngtails = para (\\a -&gt; (fmap fst a) : (foldMap snd a))\n</code></pre>\n\n<p>(i.e. in the case <code>f=Prim</code> this is <code>tails</code>, for other <code>f</code> it's a generalization)</p>\n\n<p>Is there a nicer way? I realise this isn't so bad, but the <code>fmap fst a</code> to recover the \"original\" structure at that step feels quite cumbersome, and the <code>foldMap snd a</code> is something I find myself repeating a lot when using <code>para</code> (likewise <code>fold a</code> when using <code>cata</code> which again feels like it should be unnecessary).</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "tuples"], "comments": [{"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1445346198, "post_id": 33237405, "comment_id": 54277582, "body": "My idea is that you go through the list checkign"}, {"owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "edited": false, "score": 0, "creation_date": 1445346418, "post_id": 33237405, "comment_id": 54277730, "body": "Could you explain what you mean by &#39;returning true if they compare the same elements otherwise return false&#39;? Do you mean that it should return true if they contain exactly the same elements, regardless of order? Or the same elements in the same order? Or if there is at least one element in common between the lists? Please be precise."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445390463, "post_id": 33237405, "comment_id": 54300772, "body": "It sounds like you want <code>listCheck = (==)</code> or <code>listCheck = Data.List.isPrefixOf</code>"}], "answers": [{"tags": [], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "is_accepted": false, "score": 2, "last_activity_date": 1445346918, "creation_date": 1445346918, "answer_id": 33237686, "question_id": 33237405, "link": "https://stackoverflow.com/questions/33237405/comparing-a-list-of-tuples-in-haskell/33237686#33237686", "title": "Comparing a List of tuples in haskell", "body": "<p>I think it is reasonable to take the head of the list and create an equality function using it. The use <code>any</code> or <code>all</code> from the <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/Data-List.html\" rel=\"nofollow\">List library</a> to compare with the tail.</p>\n\n<p>As this is a college exercise I guess you don't want the answer given to you ;-)</p>\n"}, {"tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": false, "score": 0, "last_activity_date": 1445350648, "creation_date": 1445350648, "answer_id": 33239156, "question_id": 33237405, "link": "https://stackoverflow.com/questions/33237405/comparing-a-list-of-tuples-in-haskell/33239156#33239156", "title": "Comparing a List of tuples in haskell", "body": "<pre><code>listCheck l1 l2 = sort l1 == sort l2\n</code></pre>\n\n<p>will work fine if list elements are totally ordered, which they will be in the usual case of Strings, numbers etc (and naturally tuples of such elements).</p>\n\n<p>If your elements don't have an ordering things get a lot more difficult, but I don't think you'll encounter that situation often.</p>\n"}, {"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445390123, "post_id": 33248376, "comment_id": 54300675, "body": "Don&#39;t use <code>head</code> and <code>tail</code> when you can do pattern matching. Partial functions should be avoided, especially by beginners."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445390221, "post_id": 33248376, "comment_id": 54300702, "body": "\u2026especially if this lures you into using them onto lists that could be empty."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445390611, "post_id": 33248376, "comment_id": 54300799, "body": "As I said, this is not the best way to do things, but seemed the closest to the approach laid out in the question. If I were going to just reimplement this function from scratch it would be quite different: something like <code>listCheck = (and .) . zipWith (==)</code>, or <code>listCheck = (==)</code> if the short-circuiting behavior is not desired."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": -1, "last_activity_date": 1445382697, "creation_date": 1445382697, "answer_id": 33248376, "question_id": 33237405, "link": "https://stackoverflow.com/questions/33237405/comparing-a-list-of-tuples-in-haskell/33248376#33248376", "title": "Comparing a List of tuples in haskell", "body": "<p>If your goal is to compare the nth element of each list, you are quite close already. The only problem is that you are pattern-matching to pull the two lists apart into head/tail, and then acting as if you hadn't, calling <code>head</code> and <code>tail</code> again:</p>\n\n<pre><code>listCheck :: (Eq a, Eq b) =&gt; [(a,b)] -&gt; [(a,b)] -&gt; Bool\nlistCheck xs ys\n    | xs == [] = True\n    | fst (head xs) /= fst (head ys) = False\n    | snd (head xs) /= snd (head ys) = False\n    | otherwise = listCheck (tail xs) (tail ys)\n</code></pre>\n\n<p>This is far from the most elegant way of doing things, but it is the closest I could find to what you seemed to be trying to write.</p>\n"}, {"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445390369, "post_id": 33249217, "comment_id": 54300749, "body": "You probably meant <code>and</code>, not <code>all</code>? Though <code>all pred</code> is of course favoured over <code>and . map pred</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445390404, "post_id": 33249217, "comment_id": 54300756, "body": "Is there a parenthesis mistake in <code>listCheck</code> in your last snippet?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445450909, "post_id": 33249217, "comment_id": 54333746, "body": "@Bergi: oops, yeah, I did mean <code>and</code>.  I don&#39;t see any parenthesis mistakes though."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1445451056, "post_id": 33249217, "comment_id": 54333833, "body": "Ah, yeah, that&#39;s the same thing. I had expected something like <code>all (\u2026 checkOne) xs</code> (with the closing parens shifted), but in that case the <code>map</code> is misplaced."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 0, "last_activity_date": 1445450830, "last_edit_date": 1445450830, "creation_date": 1445388963, "answer_id": 33249217, "question_id": 33237405, "link": "https://stackoverflow.com/questions/33237405/comparing-a-list-of-tuples-in-haskell/33249217#33249217", "title": "Comparing a List of tuples in haskell", "body": "<p>The way I always recommend newcomers approach this problem is this: </p>\n\n<ol>\n<li>Look for ways to solve the problem by using standard library functions.</li>\n<li>When you've succeeded at that, write your own version of every library functions you used.</li>\n</ol>\n\n<p>In this case, your description of what you're thinking can be finessed into a #1-style solution.  Let's quote it:</p>\n\n<blockquote>\n  <p>So far I'm thinking of taking the first element from list one and comparing it to all the elements in list 2 and do that for all the elements and then return true or false.</p>\n</blockquote>\n\n<p>Here, instead of thinking of doing that just with the first element, picture doing the same thing to <em>all</em> the elements as one step to the solution.  There's a standard function that captures this pattern:</p>\n\n<pre><code>-- The `map` function applies the function given as the first argument\n-- to all of the elements of the second argument.  The result is a list\n-- of all the individual results.\n--\n-- Example:\n--\n-- &gt;&gt;&gt; map (+10) [1, 2, 3, 4]\n-- [11, 12, 13, 14]\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>So if you can write a function that tests for <em>one</em> value whether it exists in the second list, you can use <code>map</code> to apply that function to <em>all</em> elements of the first list:</p>\n\n<pre><code>step1 :: Eq a =&gt; [a] -&gt; [a] -&gt; [Bool]\nstep1 xs ys = map checkOne xs\n  where checkOne x = _fillInTheBlank\n</code></pre>\n\n<p>(The <code>_fillInTheBlank</code> bit is called a \"hole\"\u2014you're supposed to actually write the correct code in there!)</p>\n\n<p>The second step would be to check the <code>[Bool]</code> to see whether all of the elements are <code>True</code>.  You return <code>True</code> if they are, and <code>False</code> if at least one is false.  There is a standard function for that as well:</p>\n\n<pre><code>-- Returns `False` if any element of the list is `False`, `True` otherwise.\nand :: [Bool] -&gt; Bool\n</code></pre>\n\n<p>And now:</p>\n\n<pre><code>listCheck :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nlistCheck xs ys = and (map checkOne xs)\n  where checkOne x = _fillInTheBlank\n\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n-- Write your own version of `map`\n\n\nand :: [Bool] -&gt; Bool\n-- Write your own version of `and`\n</code></pre>\n\n<p>Note what I've done: I've split the problem into smaller parts, each of which I can solve with functions like <code>map</code> and <code>and</code> that will be useful in many other cases.  That's what you should be shooting for.</p>\n"}], "owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4126, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1445450830, "creation_date": 1445346166, "last_edit_date": 1445352392, "question_id": 33237405, "link": "https://stackoverflow.com/questions/33237405/comparing-a-list-of-tuples-in-haskell", "title": "Comparing a List of tuples in haskell", "body": "<p>Ok, I'm extremely new to Haskell as in I started learning this morning, and have been tasked with taking 2 lists of tuples [(\"s\",1)..] and returning true if they have all the same elements otherwise return false.\nSo far I'm thinking of taking the first element from list one and comparing it to all the elements in list 2 and do that for all the elements and then return true or false. I don't know how to keep track of all the booleans, its easy for if there is a false</p>\n\n<pre><code>|head list1 =/ elementList2 = False\n</code></pre>\n\n<p>but i'm just confusing my self, so far i have, I have already defined List </p>\n\n<pre><code>listCheck :: List-&gt;List -&gt; Bool\nlistCheck (h1:t1) (h1:t1)\n    | h1 == [] = True\n    | fst (head h1) /= fst (head h2) = False\n    | snd (head h1) /= snd (head h2) = False\n    | otherwise = listCheck (t1) (t2)\n</code></pre>\n\n<p>Any suggestions?\nThe lists can be in any order, so [(\"a\",1),(\"b\",1)] and [(\"b\",1),(\"a\",1)] are equal. the order of the lists can't be changed.</p>\n"}, {"tags": ["haskell", "types", "aeson"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1445361671, "post_id": 33235365, "comment_id": 54288226, "body": "Why wouldn&#39;t you use proper datatypes rather than these large tuples?"}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1445377084, "post_id": 33235365, "comment_id": 54296799, "body": "@kosmikus Well it started small and then the type grew. So now I&#39;ll probably make the change. I just wanted to resolve the instancing issue before continuing!"}], "answers": [{"comments": [{"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1445357570, "post_id": 33236613, "comment_id": 54285798, "body": "Ok, thanks, now it&#39;s clearer. But how did you know to check <code>fromString</code>? I looked into Aeson documentation and didn&#39;t find something like that."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 2, "creation_date": 1445362913, "post_id": 33236613, "comment_id": 54288950, "body": "@rubik This is a gotcha for many uses of <code>OverloadedStrings</code>, not just Aeson."}], "tags": [], "owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "is_accepted": true, "score": 4, "last_activity_date": 1445343862, "creation_date": 1445343862, "answer_id": 33236613, "question_id": 33235365, "link": "https://stackoverflow.com/questions/33235365/compile-errors-when-declaring-tojson-instances/33236613#33236613", "title": "Compile errors when declaring ToJSON instances", "body": "<p>Compare the signatures:</p>\n\n<pre><code>fromString :: IsString a =&gt; String -&gt; a\ntoJSON :: ToJSON a =&gt; a -&gt; Value\n</code></pre>\n\n<p>Technically, to serialize a string literal, your custom instance uses their superposition:</p>\n\n<pre><code>toJSON . fromString :: (IsString a, ToJSON a) =&gt; String -&gt; Value\n</code></pre>\n\n<p>Note how the type variable disappears from the signature, so the ambiguity arises. For example, <code>\"error\"</code> can happily be <code>String</code>, <code>Value</code> or <code>Text</code>, all of which have both <code>IsString</code> and <code>ToJSON</code> instances.</p>\n\n<p>A quick workaround is to resolve the ambiguity manually, by providing the explicit type signature:</p>\n\n<pre><code>    toJSON (p, Left err) = object [ \"path\"    .= p\n                                  , \"type\"    .= (\"error\" :: String)\n</code></pre>\n"}], "owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 33236613, "answer_count": 1, "score": 2, "last_activity_date": 1445343862, "creation_date": 1445340242, "last_edit_date": 1445340562, "question_id": 33235365, "link": "https://stackoverflow.com/questions/33235365/compile-errors-when-declaring-tojson-instances", "title": "Compile errors when declaring ToJSON instances", "body": "<p>I'm having trouble declaring <code>ToJSON</code> instances of my type (synonyms):</p>\n\n<pre><code>{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Argon.Types (ComplexityBlock, AnalysisResult, ResultsOptions(..)\n                   , OutputMode(..))\n    where\n\nimport Data.Aeson\nimport qualified Data.ByteString.Lazy.Char8 as BL\n\n\n-- | Hold the data associated to a function binding:\n--   (line number, column, function name, complexity)\ntype ComplexityBlock = (Int, Int, String, Int)\n\ninstance ToJSON ComplexityBlock where\n    toJSON (l, c, func, cc) = object [ \"lineno\"     .= l\n                                     , \"col\"        .= c\n                                     , \"name\"       .= func\n                                     , \"complexity\" .= cc\n                                     ]\n\n-- | Represent the result of the analysis of one file.\n--   It can either be an error message or a list of\n--   'ComplexityBlock's.\ntype AnalysisResult = Either String [ComplexityBlock]\n\ninstance ToJSON (FilePath, AnalysisResult) where\n    toJSON (p, Left err) = object [ \"path\"    .= p\n                                  , \"type\"    .= \"error\"\n                                  , \"message\" .= err\n                                  ]\n    toJSON (p, Right rs) = object [ \"path\"   .= p\n                                  , \"type\"   .= \"result\"\n                                  , \"blocks\" .= rs\n                                  ]\n</code></pre>\n\n<p>Having imported the bytestring package and enabled the <code>OverloadedStrings</code> extension I thought it could work, but it does not:</p>\n\n<pre><code>/home/miki/exp/argon/src/Argon/Types.hs:31:47:\n    No instance for (ToJSON a0) arising from a use of \u2018.=\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance ToJSON (FilePath, AnalysisResult)\n        -- Defined at src/Argon/Types.hs:29:10\n      instance ToJSON ComplexityBlock\n        -- Defined at src/Argon/Types.hs:17:10\n    In the expression: type .= error\n    In the first argument of \u2018object\u2019, namely\n      \u2018[path .= p, type .= error, message .= err]\u2019\n    In the expression:\n      object [path .= p, type .= error, message .= err]\n\n/home/miki/exp/argon/src/Argon/Types.hs:31:50:\n    No instance for (Data.String.IsString a0)\n      arising from the literal \u2018error\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Data.String.IsString Value\n        -- Defined in \u2018aeson-0.8.0.2:Data.Aeson.Types.Internal\u2019\n      instance (a ~ Data.ByteString.Internal.ByteString) =&gt;\n               Data.String.IsString\n                 (attoparsec-0.12.1.6:Data.Attoparsec.ByteString.Internal.Parser a)\n        -- Defined in \u2018attoparsec-0.12.1.6:Data.Attoparsec.ByteString.Char8\u2019\n      instance Data.String.IsString\n                 Data.ByteString.Builder.Internal.Builder\n        -- Defined in \u2018Data.ByteString.Builder\u2019\n      ...plus four others\n    In the second argument of \u2018(.=)\u2019, namely \u2018error\u2019\n    In the expression: type .= error\n    In the first argument of \u2018object\u2019, namely\n      \u2018[path .= p, type .= error, message .= err]\u2019\n\n/home/miki/exp/argon/src/Argon/Types.hs:35:46:\n    No instance for (ToJSON a1) arising from a use of \u2018.=\u2019\n    The type variable \u2018a1\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance ToJSON (FilePath, AnalysisResult)\n        -- Defined at src/Argon/Types.hs:29:10\n      instance ToJSON ComplexityBlock\n        -- Defined at src/Argon/Types.hs:17:10\n    In the expression: type .= result\n    In the first argument of \u2018object\u2019, namely\n      \u2018[path .= p, type .= result, blocks .= rs]\u2019\n    In the expression:\n      object [path .= p, type .= result, blocks .= rs]\n\n/home/miki/exp/argon/src/Argon/Types.hs:35:49:\n    No instance for (Data.String.IsString a1)\n      arising from the literal \u2018result\u2019\n    The type variable \u2018a1\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Data.String.IsString Value\n        -- Defined in \u2018aeson-0.8.0.2:Data.Aeson.Types.Internal\u2019\n      instance (a ~ Data.ByteString.Internal.ByteString) =&gt;\n               Data.String.IsString\n                 (attoparsec-0.12.1.6:Data.Attoparsec.ByteString.Internal.Parser a)\n        -- Defined in \u2018attoparsec-0.12.1.6:Data.Attoparsec.ByteString.Char8\u2019\n      instance Data.String.IsString\n                 Data.ByteString.Builder.Internal.Builder\n        -- Defined in \u2018Data.ByteString.Builder\u2019\n      ...plus four others\n    In the second argument of \u2018(.=)\u2019, namely \u2018result\u2019\n    In the expression: type .= result\n    In the first argument of \u2018object\u2019, namely\n      \u2018[path .= p, type .= result, blocks .= rs]\u2019\n</code></pre>\n\n<p>I don't understand why the type variables are ambiguous.</p>\n"}, {"tags": ["haskell", "types", "hoogle", "hayoo"], "comments": [{"owner": {"reputation": 874, "user_id": 3842022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d9729ff4035657e7d6366611c28614?s=128&d=identicon&r=PG&f=1", "display_name": "C. Quilley", "link": "https://stackoverflow.com/users/3842022/c-quilley"}, "edited": false, "score": 2, "creation_date": 1445339729, "post_id": 33234878, "comment_id": 54273257, "body": "It matches if you use the prefix tuple constructor: <code>(,) b c -&gt; (,) b&#39; c&#39; -&gt; (,) (b, b&#39;) (c, c&#39;)</code>."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 874, "user_id": 3842022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d9729ff4035657e7d6366611c28614?s=128&d=identicon&r=PG&f=1", "display_name": "C. Quilley", "link": "https://stackoverflow.com/users/3842022/c-quilley"}, "edited": false, "score": 1, "creation_date": 1445342470, "post_id": 33234878, "comment_id": 54275093, "body": "@C.Quilley: hold on... <code>b -&gt; c</code> is not at all the same as <code>(,) b c</code> \u2014 so what do you mean? Your signature is of a function that takes 2 pairs and combines those into a pair of pairs."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 874, "user_id": 3842022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d9729ff4035657e7d6366611c28614?s=128&d=identicon&r=PG&f=1", "display_name": "C. Quilley", "link": "https://stackoverflow.com/users/3842022/c-quilley"}, "edited": false, "score": 2, "creation_date": 1445342788, "post_id": 33234878, "comment_id": 54275301, "body": "...and just for the record: even if what you meant was <code>((-&gt;) b c) -&gt; ((-&gt;) b&#39; c&#39;) -&gt; ((-&gt;) (b, b&#39;) (c, c&#39;))</code> \u2014 which is what I&#39;m asking about \u2014 that still doesn&#39;t yield any results neither on Hayoo nor on Hoogle."}, {"owner": {"reputation": 874, "user_id": 3842022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d9729ff4035657e7d6366611c28614?s=128&d=identicon&r=PG&f=1", "display_name": "C. Quilley", "link": "https://stackoverflow.com/users/3842022/c-quilley"}, "edited": false, "score": 0, "creation_date": 1445343895, "post_id": 33234878, "comment_id": 54276005, "body": "Sorry, I completely misread your post. I&#39;m now as mystified as you are."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1445363539, "creation_date": 1445363539, "answer_id": 33243481, "question_id": 33234878, "link": "https://stackoverflow.com/questions/33234878/hayoo-hoogle-not-matching-monomorphic-less-polymorphic-signatures-with-polymorph/33243481#33243481", "title": "Hayoo/Hoogle not matching monomorphic/less polymorphic signatures with polymorphic ones", "body": "<p>With Hoogle, it seems to be a consequence of how <code>-&gt;</code> is handled. <a href=\"https://github.com/ndmitchell/hoogle/issues/64\" rel=\"nofollow\">Issue #64 in the GitHub tracker</a>, which is very similar to what we are discussing here, includes this comment by Neil Mitchell:</p>\n\n<blockquote>\n  <p>Currently I quickly split out the result type from the arguments. I guess one approach would be to find instances for <code>-&gt;</code> and pregenerate a version with <code>-&gt;</code> substituted in.</p>\n</blockquote>\n"}], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 2, "answer_count": 1, "score": 9, "last_activity_date": 1445363539, "creation_date": 1445338871, "question_id": 33234878, "link": "https://stackoverflow.com/questions/33234878/hayoo-hoogle-not-matching-monomorphic-less-polymorphic-signatures-with-polymorph", "title": "Hayoo/Hoogle not matching monomorphic/less polymorphic signatures with polymorphic ones", "body": "\n\n<p>I'm trying to understand if there's a fundamental reason for why Hoogle and Hayoo aren't matching, for instance</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(b -&gt; c) -&gt; (b' -&gt; c') -&gt;   (b, b') -&gt; (c, c')\n</code></pre>\n\n<p>to</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>a b c    -&gt; a b' c'    -&gt;   a (b, b') (c, c')\n</code></pre>\n\n<p>which happens to be the type of <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Arrow.html#v:-42--42--42-\"><code>Control.Arrow.***</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(***) :: a b c -&gt; a b' c' -&gt; a (b, b') (c, c')\n</code></pre>\n\n<p>\u2014 is this likely just something that's as-of-yet unimplemented, or is there something fundamental that is preventing this sort of type based search from ever being implemented?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1445324885, "post_id": 33230138, "comment_id": 54264167, "body": "It seems like your questions got interrupted at some"}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1445324928, "post_id": 33230138, "comment_id": 54264185, "body": "@Zeta Yes, I accidently hit the return key on my keyboard. ^^"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1445326475, "post_id": 33230138, "comment_id": 54265027, "body": "I think there would be some issues with what is seen as &quot;erroneous values&quot; (I think you mean some kind of error/empty-condition) for all monads - can you come up with some definition/laws that are different from those of <code>MonadPlus</code>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445326521, "post_id": 33230138, "comment_id": 54265054, "body": "To make a stupid example: what should such a condition be for the <code>Identity</code> monad?"}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445326711, "post_id": 33230138, "comment_id": 54265164, "body": "@Carsten I would not create an instance for the Identity monad. That is what I would do. I just thought about an additional layer featuring those laws. If the standard libraries provide such a layer I would use it and write it on my own otherwise."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445326925, "post_id": 33230138, "comment_id": 54265286, "body": "well maybe I missunderstood you - I somehow interpreted it as you wanting a way that works for <i>all</i> monads ... sorry"}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445327083, "post_id": 33230138, "comment_id": 54265389, "body": "@Carsten Don&#39;t worry. Maybe just I wasn&#39;t that clear in my question as I thought I was."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 5, "last_activity_date": 1445327370, "last_edit_date": 1445327370, "creation_date": 1445326324, "answer_id": 33230588, "question_id": 33230138, "link": "https://stackoverflow.com/questions/33230138/haskell-check-if-a-value-in-monad-exists/33230588#33230588", "title": "Haskell check if a value in monad exists", "body": "<p>I cannot on the spot remember any simple function that works for all the monads <code>Maybe</code>,  <code>Either e</code>, <code>MaybeT m</code> and <code>ExceptT e m</code>, which are the main monads I can think of that have \"erroneous values\".</p>\n\n<p>Since GHC 7.10, <code>null</code> actually has been generalized (to <code>Foldable</code>), so it works on the first two.</p>\n\n<p>For the last three (<code>Either e</code> works with both methods) and transformed versions of them, you can probably use the <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Error-Class.html#v:catchError\" rel=\"nofollow\"><code>catchError</code></a> function.</p>\n\n<p>(Although the last two <em>have</em> <code>Foldable</code> instances, their <code>null</code> does the wrong thing.)</p>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1445326614, "post_id": 33230638, "comment_id": 54265109, "body": "I&#39;m afraid you don&#39;t get backward compatibility, because <code>null</code> wasn&#39;t generalized to <code>Foldable</code> at all until GHC 7.10."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1445326675, "post_id": 33230638, "comment_id": 54265136, "body": "@&#216;rjanJohansen Whoops. I didn&#39;t notice I was on my GHC 7.10 PC."}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "edited": false, "score": 1, "creation_date": 1445326832, "post_id": 33230638, "comment_id": 54265235, "body": "@Zeta Don&#39;t worry, I&#39;m using 7.10 too. Thanks for pointing me out to the Foldable type class. That&#39;s exactly what I&#39;m looking for. :)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1445326858, "post_id": 33230638, "comment_id": 54265249, "body": "<code>Foldable</code> did, however, contain enough methods that you could <i>define</i> the generalized <code>null</code>, e.g. as <code>null . F.toList</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 4, "creation_date": 1445327081, "post_id": 33230638, "comment_id": 54265388, "body": "@&#216;rjanJohansen Or <code>F.foldr (\\_ _ -&gt; False) True</code> (I think that&#39;s the default implementation in <code>foldr</code>). One could also use <code>data IsEmpty = Empty | NonEmpty</code> with a proper <code>Monoid</code> instance and <code>foldMap</code>. I guess there are many ways to implement <code>Data.Foldable.null</code> :D."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1445332859, "post_id": 33230638, "comment_id": 54268809, "body": "@Zeta: The <code>Monoid</code> you are looking for is <code>Any</code>."}, {"owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "edited": false, "score": 0, "creation_date": 1445339798, "post_id": 33230638, "comment_id": 54273296, "body": "There is a type class for Empty - <a href=\"https://hackage.haskell.org/package/lens-4.13/docs/Control-Lens-Empty.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lens-4.13/docs/&hellip;</a> - but in my opinion it is not the correct generalisation for the OP if he&#39;s working with monads which can fail."}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "edited": false, "score": 0, "creation_date": 1445351300, "post_id": 33230638, "comment_id": 54281491, "body": "@drquicksilver I went with <code>Foldable</code>. I can live with the fact that only GHC 7.10+ is supported. <code>Empty</code> seems to be quite nice but I guess <code>Foldable</code> applies better in case of monads. But thanks for pointing me out!"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 12, "last_activity_date": 1447492797, "last_edit_date": 1447492797, "creation_date": 1445326490, "answer_id": 33230638, "question_id": 33230138, "link": "https://stackoverflow.com/questions/33230138/haskell-check-if-a-value-in-monad-exists/33230638#33230638", "title": "Haskell check if a value in monad exists", "body": "<p>The notion \"contains a value\" isn't captured by the <code>Monad</code> typeclass. After all, a <code>Monad</code> only gives you something to sequence (<code>&gt;&gt;=</code>) actions (bind the previous result). And <code>MonadPlus</code> gives you a way to \"shortcut\" a computation with <code>mzero</code> (have a look at the laws and <code>mplus</code>).</p>\n\n<p>However, being able to contain one or many values usually goes hand in hand with being able to fold all those values together into something. And indeed, <code>Data.Foldable</code> contains a function conveniently also called <code>null</code>:</p>\n\n<pre><code>&gt; import qualified Data.Foldable as F\n&gt; \n&gt; showAndTell :: (Show (t a), Foldable t) =&gt; t a -&gt; IO ()\n&gt; showAndTell k =\n&gt;   putStrLn $ \"  F.null (\" ++ show k ++ \") is \" ++ show (F.null k)\n\n&gt; main = do\n&gt;   putStrLn \"Using F.null on 'empty' things:\"\n&gt;   showAndTell $ (Left \"Error\" :: Either String Int)\n&gt;   showAndTell $ (Nothing :: Maybe Integer)\n&gt;   showAndTell $ ([]      :: [Double])\n&gt; \n&gt;   putStrLn \"\"\n&gt;   putStrLn \"Using F.null on 'filled' things:\"\n&gt;   showAndTell $ (Right 123 :: Either String Integer)\n&gt;   showAndTell $ (Just  123 :: Maybe Integer)\n&gt;   showAndTell $ ([1,2,3] :: [Int])\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Using F.null on 'empty' things:\n  F.null (Left \"Error\") is True\n  F.null (Nothing) is True\n  F.null ([]) is True\n\nUsing F.null on 'filled' things:\n  F.null (Right 123) is False\n  F.null (Just 123) is False\n  F.null ([1,2,3]) is False\n</code></pre>\n\n<p>So what you're looking for is part of <code>Foldable</code>, not <code>Monad</code>. This will only work on GHC 7.10 or higher, since <code>Data.Foldable.null</code> was introduces in base 4.8.0.0. If you're stuck with an older version of GHC, you can use </p>\n\n<pre><code>&gt; isEmpty :: F.Foldable t =&gt; t a -&gt; Bool\n&gt; isEmpty = F.foldr (\\_ _ -&gt; False) True\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "edited": false, "score": 0, "creation_date": 1445351111, "post_id": 33231103, "comment_id": 54281333, "body": "<code>Foldable</code> was completely sufficient. I did not know that null has been generalized with GHC 7.10 and I did not want to implement something like <code>Foldable</code> if there is a type class that is sufficient."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 5, "last_activity_date": 1445327928, "creation_date": 1445327928, "answer_id": 33231103, "question_id": 33230138, "link": "https://stackoverflow.com/questions/33230138/haskell-check-if-a-value-in-monad-exists/33231103#33231103", "title": "Haskell check if a value in monad exists", "body": "<p>Definitely not from outside the monad. If you're searching for something like <code>nonEmpty :: MonadPlus m =&gt; m a -&gt; Bool</code> then it's impossible.</p>\n\n<p>You'd need to actually run the monadic computation to find out whether it's \"empty\". But the monad might need some sort of input to run (e.g. things like <code>State</code> or even just <code>Reader</code>), and in the extreme case of <code>IO</code> you can't run the monad at all from outside. Now those examples aren't <code>MonadPlus</code> on their own AFAICR, but augment them with failure (e.g. <code>MaybeT</code>) and suddenly there's an obvious definition of what it means for them to be \"empty\", but the same restrictions still apply. Since an unknown monad could be one of those, you can't get any information out.</p>\n\n<p>A possible signature might be <code>nonEmpty :: MonadPlus m =&gt; m a -&gt; m Bool</code> (although I'm not sure that that has a sensible implementation either). But I don't think that's what you're after, since it doesn't actually generalise <code>null</code>; you'd end up retiring <code>[False]</code> or <code>[True]</code> for lists (or possibly even <code>[True, True, True, ...]</code> with the same number of elements as the input), which is a bit weird.</p>\n\n<p>I think monads are on the wrong \"axis of generalisation\" for <code>null</code>; you want an abstraction that better characterises containers than <code>Monad</code> does (lots of monads <em>are</em> containers, but so are lots of other things that are very different, so code that works on arbitrary monads can't assume container-like properties). Generalising to <code>Foladable</code> as happened in GHC-7.10 seems a pretty good bet. You could probably make a <code>CanBeEmpty</code> type class that admits a few more things than <code>Foldable</code>; I don't know that such a thing exists already though.</p>\n"}, {"tags": [], "owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "is_accepted": false, "score": 2, "last_activity_date": 1445339735, "creation_date": 1445339735, "answer_id": 33235202, "question_id": 33230138, "link": "https://stackoverflow.com/questions/33230138/haskell-check-if-a-value-in-monad-exists/33235202#33235202", "title": "Haskell check if a value in monad exists", "body": "<p>The idiomatic thing to do is not to try to detect the zero directly, but to provide the behaviour you want in case of zero.</p>\n\n<p>This is what <code>mplus</code> or equivalently (in recent Preludes) <code>&lt;|&gt;</code> do; it chains an action to run in the case that the first action fails. This is the same as <code>catchError</code> on those Monads which <code>catchError</code> supports. It is analogous to the common idiom in shell or perl programming <code>foo || bar</code> meaning run foo and then run bar if foo failed.</p>\n\n<p>Beware in the list monad that it will run all the options though because that is how the list monad is designed to work, modelling 'multiple possibilities'.</p>\n\n<p>I frequently use <code>&lt;|&gt;</code> on <code>MaybeT</code> or <code>EitherT</code> to model left-biased choice, i.e. \"try all of these alternatives in turn until one succeeds\".</p>\n\n<p>Beware that using <code>&lt;|&gt;</code> for <code>EitherT</code> does discard the error message (because it turns a failing computation into a succeeding one); if you want to save the error message and process it somehow it is, again, <code>catchError</code> you wanted.</p>\n"}], "owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 861, "favorite_count": 2, "accepted_answer_id": 33230638, "answer_count": 4, "score": 9, "last_activity_date": 1447492797, "creation_date": 1445324822, "last_edit_date": 1445324903, "question_id": 33230138, "link": "https://stackoverflow.com/questions/33230138/haskell-check-if-a-value-in-monad-exists", "title": "Haskell check if a value in monad exists", "body": "<p>I'm wondering if there is an equivalent or something for <code>null</code> from lists generalized for monads. At the moment I'm trying to find erroneous values with <code>== mzero</code>. But this kind of check provokes false positives since <code>mzero /= Left \"foo\"</code> applies.</p>\n\n<p>Is there an elegant way to express what I want in standard libraries?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 1260, "user_id": 4420129, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Am8Sj.jpg?s=128&g=1", "display_name": "isopach", "link": "https://stackoverflow.com/users/4420129/isopach"}, "edited": false, "score": 0, "creation_date": 1445327043, "post_id": 33229816, "comment_id": 54265360, "body": "Thanks for this! I have figured out a method similar to Zeta&#39;s answer, but mine was short of the last line."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1445323739, "creation_date": 1445323739, "answer_id": 33229816, "question_id": 33229724, "link": "https://stackoverflow.com/questions/33229724/without-using-drop-how-to-take-and-print-alternate-lines-odd-or-even-in-a-lis/33229816#33229816", "title": "Without using drop, how to take and print alternate lines (odd or even) in a list?", "body": "<p>Hint: replace the <code>x:xs</code> pattern with a <code>[x]</code> pattern and an <code>x1 : x2 : xs</code> pattern.</p>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 8, "last_activity_date": 1445323935, "creation_date": 1445323935, "answer_id": 33229874, "question_id": 33229724, "link": "https://stackoverflow.com/questions/33229724/without-using-drop-how-to-take-and-print-alternate-lines-odd-or-even-in-a-lis/33229874#33229874", "title": "Without using drop, how to take and print alternate lines (odd or even) in a list?", "body": "<pre><code>oddL :: [a] -&gt; [a]\noddL (x:_:xs) = x : oddL xs -- \"forget\" the even element\noddL [x]      = [x]\noddL  _       = [ ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1445370451, "creation_date": 1445370451, "answer_id": 33245569, "question_id": 33229724, "link": "https://stackoverflow.com/questions/33229724/without-using-drop-how-to-take-and-print-alternate-lines-odd-or-even-in-a-lis/33245569#33245569", "title": "Without using drop, how to take and print alternate lines (odd or even) in a list?", "body": "<p>You can also reuse <a href=\"http://hackage.haskell.org/package/split\" rel=\"nofollow\">library</a> code for this, as in</p>\n\n<pre><code>import Data.List.Split\noddL = map head . chunksOf 2\n</code></pre>\n"}], "owner": {"reputation": 1260, "user_id": 4420129, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Am8Sj.jpg?s=128&g=1", "display_name": "isopach", "link": "https://stackoverflow.com/users/4420129/isopach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 2, "accepted_answer_id": 33229874, "answer_count": 3, "score": 1, "last_activity_date": 1445370451, "creation_date": 1445323433, "question_id": 33229724, "link": "https://stackoverflow.com/questions/33229724/without-using-drop-how-to-take-and-print-alternate-lines-odd-or-even-in-a-lis", "title": "Without using drop, how to take and print alternate lines (odd or even) in a list?", "body": "<p>I have written a working version using drop here:</p>\n\n<pre><code>main = do cs &lt;- getContents\n          putStr $ unlines $ oddL $ lines cs\n\noddL :: [a] -&gt; [a]\noddL [] = []\noddL (x:xs) = x : (oddL $ drop 1 xs)\n</code></pre>\n\n<p>but I was wondering if there is a way to do it without drop? Even if it is not as efficient.</p>\n"}, {"tags": ["sorting", "haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1445315876, "post_id": 33228010, "comment_id": 54260429, "body": "While Haskell allows it, it&#39;s extremely unusual and difficult to read code with the <code>|</code> that begins a guard clause at the end of a line."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1445316150, "post_id": 33228010, "comment_id": 54260521, "body": "Try <code>&quot;3412&quot;</code>. What does your function return?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1445317443, "post_id": 33228010, "comment_id": 54260977, "body": "Your <code>sortOnce</code> function is wrong. Note: <code>sort_once &quot;3412&quot; = &quot;3412&quot;</code>, but this number isn&#39;t sorted. In the last pattern of <code>sort_once</code>, the recursive call is made on the list <code>xy</code>. But there could still be a valid swap in the list <code>x:xy</code> or <code>y:xy</code>, depending on which list is actually constructed. As an aside, your code is written quite awkwardly, perhaps write the function <code>bubblesort :: Ord a =&gt; [a] -&gt; [a]</code> instead."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1445323399, "post_id": 33228010, "comment_id": 54263392, "body": "@ReinHenrichs, I am occasionally astonished by a bit of Haskell code that almost magically turns out to be syntactically valid. I firmly believe that Haskell&#39;s indentation rules are a poor match for the way human brains tend to work. Yes, I can almost always do it right, but that&#39;s largely by being very conservative about how I format my code."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1445318170, "creation_date": 1445318170, "answer_id": 33228500, "question_id": 33228010, "link": "https://stackoverflow.com/questions/33228010/haskell-bubblesort-stops-at-first-step/33228500#33228500", "title": "haskell bubblesort stops at first step", "body": "<p><code>sort_once</code> doesn't implement a bubblesort iteration. Remember the overall idea of bubblesort: you want to \"bubble the greatest element all the way up\".</p>\n\n<p>However, let's say you have the greatest element at the start, and some arbitrary element after, like <code>\"321\"</code>. What happens in <code>sort_once</code>?</p>\n\n<pre><code>sort_once \"321\" = sort_two '3' '2' ++ sort_once \"1\"\n                = sort_two '3' '2' ++ \"1\"\n                = ['2', '3']       ++ sort_once \"1\"\n                = \"231\"\n</code></pre>\n\n<p>This isn't correct if <code>sort_once</code> should reflect a full bubblesort iteration. After all, the greatest element is now stuck at the second position instead of the last. And the next use of <code>sort_once</code> won't change that:</p>\n\n<pre><code>sort_once \"231\" = sort_two '2' '3' ++ sort_once \"1\"\n                = sort_two '2' '3' ++ \"1\"\n                = ['2', '3']  ++ sort_once \"1\"\n                = \"231\"\n</code></pre>\n\n<p>Therefore, your \"sort\" stops after a single iteration. How does one fix this, you might ask. Well, in your recursive call of <code>sort_once</code>, you need to account the greater element:</p>\n\n<pre><code>sort_once (x:y:xy) = \n   let [lesser, greater] = sort_two x y\n   in lesser : (sort_once (greater : xy))\n   --                      ^^^^^^^\n   --  still look at the greater element\n</code></pre>\n\n<p>By the way, this should encourage you to change the type of <code>sort_two</code> to <code>Char -&gt; Char -&gt; (Char, Char)</code>. After all, the list returned by <code>sort_two</code> should always have exactly two elements.</p>\n\n<h3>Exercises</h3>\n\n<ul>\n<li>At the moment, your code uses an intermediate <code>Int</code> to compare two characters. However, you can compare characters with <code>&lt;</code> and <code>&gt;</code>. Try to implement <code>sort_two</code> without <code>digitToInt</code>.</li>\n<li>Now that you've used <code>&lt;</code> or <code>&gt;</code> in <code>sort_two</code>, generalize <code>sort_once</code> and <code>sort</code> so that you can sort <code>[Int]</code>, <code>[Integer]</code>, or any other thing that can be compared. Hint: look at the type of <code>(&lt;)</code>.</li>\n</ul>\n"}], "owner": {"reputation": 113, "user_id": 5461826, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/BmyKw.jpg?s=128&g=1", "display_name": "Jaroslaw Weber", "link": "https://stackoverflow.com/users/5461826/jaroslaw-weber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 1, "accepted_answer_id": 33228500, "answer_count": 1, "score": 1, "last_activity_date": 1445320469, "creation_date": 1445315281, "last_edit_date": 1445320469, "question_id": 33228010, "link": "https://stackoverflow.com/questions/33228010/haskell-bubblesort-stops-at-first-step", "title": "haskell bubblesort stops at first step", "body": "<p>Why this code sort only once? It should go recursion right?\nI tried copy and use function few times but same result</p>\n\n<pre><code>import Data.Char(digitToInt)\nmain = do\n    let input = \"014191633811200332532482200388402372212502263534033843815342500002960238365203448225037732492472423604003650332739521403775274133234120141613263263284258349238980000299142823491385101303491002740220381422901923619346834530150013398923221429717193717\"\n    print $ bubblesort input\n\nbubblesort input \n   | input == sorted = sorted \n   | otherwise       = bubblesort sorted\n  where \n     sorted = sort_once input\n\nsort_once::String-&gt;String\nsort_once [] = []\nsort_once (x:[]) = x:[]\nsort_once (x:y:[]) = sort_two x y\nsort_once input@(x:y:xy) = (sort_two x y)++(sort_once xy)\n\n\n--sort_two::String=&gt;Char-&gt;Char\nsort_two aa bb |\n a&lt;b = aa:bb:[]::String |\n otherwise = bb:aa:[]::String\n  where \n   a=digitToInt aa::Int\n   b=digitToInt bb::Int\n</code></pre>\n\n<p>If anyone interested i fixed the code using your tips below, thank all for your answers:</p>\n\n<pre><code>import Data.Char(digitToInt)\nmain = do\n    let input = \"014191633811200332532482200388402372212502263534033843815342500002960238365203448225037732492472423604003650332739521403775274133234120141613263263284258349238980000299142823491385101303491002740220381422901923619346834530150013398923221429717193717\"\n    let result = bubblesort (string_to_int_arr input) ::[Int]\n    print result\n\nbubblesort::[Int]-&gt;[Int]\nbubblesort input \n |\u3000(input == sorted) = sorted \n |\u3000otherwise = bubblesort sorted\n  where \n   sorted = sort_once input\n\nstring_to_int_arr :: String-&gt;[Int]\nstring_to_int_arr input = map (read . (:\"\")) input :: [Int]\n\nsort_once::[Int]-&gt;[Int]\nsort_once [] = []\nsort_once (x:[]) = x:[]\nsort_once (x:y:[]) = (lesser x y):(greater x y):[]\nsort_once (x:y:xy) = (lesser x y):(sort_once $ (greater x y):xy)\n\n\ngreater::Int-&gt;Int-&gt;Int\ngreater a b\n | a&gt;b=a \n | otherwise=b\n\nlesser::Int-&gt;Int-&gt;Int\nlesser a b\n | a&lt;b=a \n | otherwise=b\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1445314410, "post_id": 33227706, "comment_id": 54259993, "body": "I did not find it in any <i>common</i> packages as well - but <a href=\"http://hayoo.fh-wedel.de/?query=Monad+m+%3D%3E+Int+-%3E+%28a+-%3E+m+a%29+-%3E+a+-%3E+m+a\" rel=\"nofollow noreferrer\">Hayoo</a> at least knows 2 places - in this case I would <i>replicate</i> it I guess (maybe <code>chainM</code> is a better name though - <code>replicate</code> is <i>given</i>)"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1445316221, "post_id": 33227706, "comment_id": 54260541, "body": "Does <code>replicateM</code> feed in the previous result?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445316319, "post_id": 33227706, "comment_id": 54260577, "body": "no it does not - but if I read repeat or replicate I think on different things (just for this reason) - it&#39;s really only a comment on the naming - sorry if it caused a missunderstanding"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445316469, "post_id": 33227706, "comment_id": 54260629, "body": "@Carsten, you inspired my answer with that comment though."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445316563, "post_id": 33227706, "comment_id": 54260661, "body": "@dfeuer yeah ;) - btw: that&#39;s almost the solution one of the implementations hayoo found choose"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445316904, "post_id": 33227706, "comment_id": 54260786, "body": "@Carsten, that one that looks almost like mine is a bit backwards. I wonder if it&#39;s specially designed for oddball monads like lazy state, or maybe reader. I&#39;m not sure just what&#39;s lazy enough to make that make sense."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445317035, "post_id": 33227706, "comment_id": 54260827, "body": "@dfeuer I have no clue - I just searched for the signature and had a quick glance - I quite like yours ;)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445319100, "post_id": 33227706, "comment_id": 54261545, "body": "@Carsten the docs say that <code>iterateM</code> doesn&#39;t terminate - wouldn&#39;t that be a problem?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445325759, "post_id": 33227706, "comment_id": 54264647, "body": "@ErikR maybe - I have no time to check this at the moment, so to be sure I&#39;ll remove the comment - thanks for the hint"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1445383076, "post_id": 33227706, "comment_id": 54299071, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/9364379/is-this-a-case-for-foldm\">Is this a case for foldM?</a> - the question originally asks about foldM, but the desired signature and implementation are identical."}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1445391470, "post_id": 33227706, "comment_id": 54301009, "body": "@amalloy Two unrelated questions can have identical answers"}], "answers": [{"comments": [{"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1445317031, "post_id": 33227851, "comment_id": 54260826, "body": "That is clear enough! Better than writing three lines"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 10, "last_activity_date": 1445314255, "creation_date": 1445314255, "answer_id": 33227851, "question_id": 33227706, "link": "https://stackoverflow.com/questions/33227706/is-there-a-chain-monad-function-in-haskell/33227851#33227851", "title": "Is there a &quot;chain&quot; monad function in Haskell?", "body": "<p>You can use <code>foldM</code>, e.g.:</p>\n\n<pre><code>import Control.Monad\n\nf a = do print a; return (a+2)\n\nrepeatM n f a0 = foldM (\\a _ -&gt; f a) a0 [1..n]\n\ntest = repeatM 5 f 3\n  -- output: 3 5 7 9 11\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 9, "last_activity_date": 1445344858, "last_edit_date": 1495541862, "creation_date": 1445315475, "answer_id": 33228042, "question_id": 33227706, "link": "https://stackoverflow.com/questions/33227706/is-there-a-chain-monad-function-in-haskell/33228042#33228042", "title": "Is there a &quot;chain&quot; monad function in Haskell?", "body": "<p>Carsten <a href=\"https://stackoverflow.com/questions/33227706/is-there-a-chain-monad-function-in-haskell#comment54259993_33227706\">mentioned</a> <code>replicate</code>, and that's not a bad thought.</p>\n\n<pre><code>import Control.Monad\nrepeatM n f = foldr (&gt;=&gt;) pure (replicate n f)\n</code></pre>\n\n<p>The idea behind this is that for any monad <code>m</code>, the functions of type <code>a -&gt; m b</code> form the Kleisli category of <code>m</code>, with identity arrows</p>\n\n<pre><code>pure :: a -&gt; m a\n</code></pre>\n\n<p>(also called <code>return</code>)</p>\n\n<p>and composition operator</p>\n\n<pre><code>(&lt;=&lt;) :: (b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c\nf &lt;=&lt; g = \\a -&gt; f =&lt;&lt; g a\n</code></pre>\n\n<p>Since were actually dealing with a function of type <code>a -&gt; m a</code>, we're really looking at one monoid of the Kleisli category, so we can think about folding <em>lists</em> of these arrows.</p>\n\n<p>What the code above does is fold the composition operator, flipped, into a list of <code>n</code> copies of <code>f</code>, finishing off with an identity as usual. Flipping the composition operator actually puts us into the dual category; for many common monads, <code>x &gt;=&gt; y &gt;=&gt; z &gt;=&gt; w</code> is more efficient than <code>w &lt;=&lt; z &lt;=&lt; y &lt;=&lt; x</code>; since all the arrows are the <em>same</em> in this case, it seems we might as well. Note that for the lazy state monad and likely also the reader monad, it may be better to use the unflipped <code>&lt;=&lt;</code> operator; <code>&gt;=&gt;</code> will generally be better for <code>IO</code>, <code>ST s</code>, and the usual strict state.</p>\n\n<p>Notice: I am no category theorist, so there may be errors in the explanation above.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445345462, "post_id": 33235607, "comment_id": 54277050, "body": "This is very similar to my answer. The monadic interface of <code>StateT</code> is overkill, since you never look at the results. Suppose you take <code>newtype StateM s m = StateM {runStateM :: s -&gt; m s}</code> . Then <code>instance Monad m =&gt; Monoid (StateM s) where {mempty = pure; mappend (StateM f) (StateM g) = StateM (f &gt;=&gt; g)}</code>. Now you can <code>foldMap StateM</code> to string together a bunch of <code>s -&gt; m s</code> functions!"}, {"owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1445346524, "post_id": 33235607, "comment_id": 54277818, "body": "Absolutely. There are monoids everywhere. <code>f ()</code> is a monoid under <code>*&gt;</code>, <code>s -&gt; m s</code> is a monoid under <code>&gt;=&gt;</code>, and so on. The point of my answer was simply to relate the question to the standard library function <code>replicateM</code> because at first glance it seems to be applicable, and then it isn&#39;t. The observation being &quot;Well, it is <code>replicateM</code> - just for a slightly different Monad&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445346964, "post_id": 33235607, "comment_id": 54278148, "body": "Yes, that makes sense."}], "tags": [], "owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "is_accepted": false, "score": 2, "last_activity_date": 1445341062, "creation_date": 1445341062, "answer_id": 33235607, "question_id": 33227706, "link": "https://stackoverflow.com/questions/33227706/is-there-a-chain-monad-function-in-haskell/33235607#33235607", "title": "Is there a &quot;chain&quot; monad function in Haskell?", "body": "<p>I find myself wanting this function often, I wish it had a standard name. That name however would not be <code>repeatM</code> - that would be for an infinite repeat, like <code>forever</code> if it existed, just for consistency with other libraries (and <code>repeatM</code> is defined in some libraries that way).</p>\n\n<p>Just as another perspective from the answers already given, I point out that <code>(s -&gt; m s)</code> looks a bit like an action in a State monad with state type <code>s</code>.</p>\n\n<p>In fact, it is isomorphic to <code>StateT s m ()</code> - an action which returns no value, because all the work it does is encapsulated in the way it changes the state. In this monad, the function you wanted really is <code>replicateM</code>. You can write it this way in haskell although it probably looks uglier than just writing it directly.</p>\n\n<p>First convert <code>s -&gt; m s</code> to the equivalent form which <code>StateT</code> uses, adding the information-free <code>()</code>, using <code>liftM</code> to map a function over the return type.</p>\n\n<pre><code>&gt; :t \\f -&gt; liftM (\\x -&gt; ((),x)) . f\n\\f -&gt; liftM (\\x -&gt; ((),x)) . f :: Monad m =&gt; (a -&gt; m t) -&gt; a -&gt; m ((), t)\n</code></pre>\n\n<p>(could have used <code>fmap</code> but the Monad constraint seems clearer here; could have used <code>TupleSections</code> if you like; if you find do notation easier to read it is simply <code>\\f s -&gt; do x &lt;- f s; return ((),s)</code> ).</p>\n\n<p>Now this has the right type to wrap up with StateT:</p>\n\n<pre><code>&gt; :t StateT . \\f -&gt; liftM (\\x -&gt; ((),x)) . f\nStateT . \\f -&gt; liftM (\\x -&gt; ((),x)) . f :: Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()\n</code></pre>\n\n<p>and then you can replicate it n times, using the <code>replicateM_</code> version because the returned list <code>[()]</code> from <code>replicateM</code> would not be interesting:</p>\n\n<pre><code>&gt; :t \\n -&gt; replicateM_ n . StateT . \\f -&gt; liftM (\\x -&gt; ((),x)) . f\n\\n -&gt; replicateM_ n . StateT . \\f -&gt; liftM (\\x -&gt; ((),x)) . f :: Monad m =&gt; Int -&gt; (s -&gt; m s) -&gt; StateT s m ()\n</code></pre>\n\n<p>and finally you can use <code>execStateT</code> to go back to the Monad you were originally working in:</p>\n\n<pre><code>runNTimes :: Monad m =&gt; Int -&gt; (s -&gt; m s) -&gt; s -&gt; m s\nrunNTimes n act =\n  execStateT . replicateM_ n . StateT . (\\f -&gt; liftM (\\x -&gt; ((),x)) . f) $ act\n</code></pre>\n"}], "owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2742, "favorite_count": 3, "accepted_answer_id": 33227851, "answer_count": 3, "score": 10, "last_activity_date": 1445395979, "creation_date": 1445313328, "last_edit_date": 1495540947, "question_id": 33227706, "link": "https://stackoverflow.com/questions/33227706/is-there-a-chain-monad-function-in-haskell", "title": "Is there a &quot;chain&quot; monad function in Haskell?", "body": "<h1>Explain about a \"duplicate\"</h1>\n\n<p>Someone point to <a href=\"https://stackoverflow.com/questions/9364379\">Is this a case for foldM?</a> as a possible duplicate. Now, I have a strong opinion that, two questions that can be answered with identical answers are not necessarily duplicates! \"What is 1 - 2\" and \"What is i^2\" both yields \"-1\", but no, they are not duplicate questions. My question (which is already answered, kind of) was about \"whether the function <code>iterateM</code> exists in Haskell standard library\", not \"How to implement a chained monad action\".</p>\n\n<h1>The question</h1>\n\n<p>When I write some projects, I found myself writing this combinator:</p>\n\n<pre><code>repeatM :: Monad m =&gt; Int -&gt; (a -&gt; m a) -&gt; a -&gt; m a\nrepeatM 0 _ a = return a\nrepeatM n f a = (repeatM (n-1) f) =&lt;&lt; f a\n</code></pre>\n\n<p>It just performs a monadic action <code>n</code> times, feeding the previous result into the next action. I tried some <code>hoogle</code> search and some Google search, and did not find anything that comes with the \"standard\" Haskell. Is there such a formal function that is predefined?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445313090, "post_id": 33227289, "comment_id": 54259658, "body": "Here&#39;s a really twisted/ingenious example of using numeric literals as data constructors: <a href=\"http://augustss.blogspot.com/2009/02/more-basic-not-that-anybody-should-care.html\" rel=\"nofollow noreferrer\">augustss.blogspot.com/2009/02/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445311879, "post_id": 33227499, "comment_id": 54259372, "body": "Don&#39;t forget the <code>Eq</code> instance for number-style pattern matching."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445312962, "post_id": 33227499, "comment_id": 54259626, "body": "I just noticed the OP already has specified <code>deriving (Bounded, Eq, Show, Enum)</code> but I added a comment about perhaps using my Enum definition"}, {"owner": {"reputation": 193, "user_id": 5463444, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lPzwisp-ft0/AAAAAAAAAAI/AAAAAAAAABQ/ta_crd5F46g/photo.jpg?sz=128", "display_name": "Wung Hugh", "link": "https://stackoverflow.com/users/5463444/wung-hugh"}, "edited": false, "score": 0, "creation_date": 1445314158, "post_id": 33227499, "comment_id": 54259929, "body": "Fantastic! Works like a charm!"}, {"owner": {"reputation": 193, "user_id": 5463444, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lPzwisp-ft0/AAAAAAAAAAI/AAAAAAAAABQ/ta_crd5F46g/photo.jpg?sz=128", "display_name": "Wung Hugh", "link": "https://stackoverflow.com/users/5463444/wung-hugh"}, "edited": false, "score": 1, "creation_date": 1445316563, "post_id": 33227499, "comment_id": 54260662, "body": "Oh, I finally understand, according to this page <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#rebindable-syntax\" rel=\"nofollow noreferrer\">link</a>, the literal &quot;1&quot; means &quot;Prelude.fromInteger 1&quot;. So every time I use &quot;1&quot;,  <code>Prelude.fromInteger 1</code> is called, which gives whatever type belongs to Num."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1445312848, "last_edit_date": 1445312848, "creation_date": 1445311732, "answer_id": 33227499, "question_id": 33227289, "link": "https://stackoverflow.com/questions/33227289/literal-number-as-data-constructor-in-haskell/33227499#33227499", "title": "literal number as data constructor in Haskell", "body": "<p>Just create a <code>Num</code> instance for your <code>MyBool</code> type and define:</p>\n\n<pre><code>fromInteger 0 = Zero\nfromInteger 1 = One\n</code></pre>\n\n<p>or perhaps:</p>\n\n<pre><code>fromInteger n = if even n then Zero else One\n</code></pre>\n\n<p>so that it isn't partial.</p>\n\n<p>And in that case you can write <code>myAnd 0 1</code> - you won't need the <code>::MyBool</code> type annotations.</p>\n\n<p>The instance definition can be as short as:</p>\n\n<pre><code>instance Num MyBool where\n    fromInteger n = if even n then Zero else One\n</code></pre>\n\n<p>You'll get warnings about missing implementations, but if you don't use those operations on your <code>MyBool</code> values you'll be okay. If you want a complete Num instance I would probably go this route:</p>\n\n<pre><code>instance Enum MyBool where\n  fromEnum Zero = 0\n  fromEnum One  = 1\n  toEnum n      = if even n then Zero else One\n\ninstance Num MyBool where\n  fromInteger   = toEnum . fromInteger\n  a + b         = toEnum (fromEnum a + fromEnum b)\n  a * b         = toEnum (fromEnum a * fromEnum b)\n  negate a      = a\n  abs a         = a\n  signum        = toEnum . signum . fromEnum\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>I see that you already have derived <code>Enum</code> and <code>Eq</code>, but you probably will want to use the Enum instance I gave since it handles integer values outside of the range [0..1] and it's useful in defining the Num instance.</p>\n"}], "owner": {"reputation": 193, "user_id": 5463444, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lPzwisp-ft0/AAAAAAAAAAI/AAAAAAAAABQ/ta_crd5F46g/photo.jpg?sz=128", "display_name": "Wung Hugh", "link": "https://stackoverflow.com/users/5463444/wung-hugh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 1, "accepted_answer_id": 33227499, "answer_count": 1, "score": 1, "last_activity_date": 1445312848, "creation_date": 1445310410, "last_edit_date": 1445310726, "question_id": 33227289, "link": "https://stackoverflow.com/questions/33227289/literal-number-as-data-constructor-in-haskell", "title": "literal number as data constructor in Haskell", "body": "<p>I am learning Haskell recently. And I keep wondering if I can use literal number as data constructor, like Integer,Int, Word do.\nFor example, for the following code,</p>\n\n<pre><code>data MyBool = Zero | One\n         deriving(Bounded, Eq, Show, Enum)\ntoBool Zero = False\ntoBool One = True\nfromBool False = Zero\nfromBool True = One\nmyAnd = ff (&amp;&amp;) toBool fromBool\nmyOr = ff (||) toBool fromBool\n\nff pp fp pf x y= pf $ pp (fp x) (fp y)\n</code></pre>\n\n<p>what I want to do is replace Zero with 0, One with 1, so that I can use something like : <code>myAnd (1::MyBool) (0::MyBool)</code>.\nI did look into the source code of ghc, I find something like:</p>\n\n<pre><code>data Int = GHC.Types.I# GHC.Prim.Int#\ndata Word = GHC.Types.W# GHC.Prim.Word# \n</code></pre>\n\n<p>And as I researched <code>Int#</code> is 'unbox type', which must be the key that enabled them to use literal number as data constructor.\nSo how could I make my type use literal number as data constructor like Int and Word do?\n(Don't hesitate to ask if the question's ambiguous.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 12923, "user_id": 1530508, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fG8z0.png?s=128&g=1", "display_name": "ApproachingDarknessFish", "link": "https://stackoverflow.com/users/1530508/approachingdarknessfish"}, "edited": false, "score": 2, "creation_date": 1445309324, "post_id": 33226832, "comment_id": 54258727, "body": "Your first lambda is egregiously over-complicated. It can be be written simply as <code>(\\list -&gt; (length list) &gt; a)</code>, or eliminated entirely using <code>((&gt; a) . length)</code>, although many may find the latter difficult to read."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1445333328, "post_id": 33226832, "comment_id": 54269116, "body": "<code>seq</code> is a highly inappropriate and confusing name for a user-defined function: it also exists as a primitive function/operator to force the evaluation of otherwise lazy thunks. also, don&#39;t use <code>sequence</code> because sequencing has a specific but widespread meaning, too."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 5, "last_activity_date": 1445308086, "last_edit_date": 1445308086, "creation_date": 1445307530, "answer_id": 33226924, "question_id": 33226832, "link": "https://stackoverflow.com/questions/33226832/haskell-simulate-1-n-with-until-function/33226924#33226924", "title": "Haskell simulate [1 .. n] with &quot;until&quot; function", "body": "<p>I think a nice solution for this one is to not try to recover \"how many steps we still need to do\" from the list getting constructed, but instead, to use <code>until</code> on a pair of the list and the number of remaining elements to be added:</p>\n\n<pre><code>                      (5, []) -&gt; \n(4, 5:[])           = (4, [5]) -&gt;\n(3, 4:[5])          = (3, [4, 5]) -&gt; \n(2, 3:[4, 5])       = (2, [3, 4, 5]) -&gt; \n(1, 2:[3, 4, 5])    = (1, [2, 3, 4, 5]) -&gt; \n(0, 1:[2, 3, 4, 5]) = (0, [1, 2, 3, 4, 5])\n</code></pre>\n\n<p>Note that when the number of remaining elements is 0, that exactly means that the list we have constructed is the one we are after.</p>\n\n<p>So we can implement this idea by making an <code>until</code> over a pair, and checking if the first element of the pair is equal to 0 to decide if we've finished:</p>\n\n<pre><code>seq0 :: Int -&gt; (Int, [Int])\nseq0 n = until (\\(i, is) -&gt; i == 0) (\\(i, is) -&gt; (i-1, i:is)) (n, [])\n</code></pre>\n\n<p>Of course, this will return the full pair <code>(0, [1..n])</code>, so we need to keep only the second element of the pair:</p>\n\n<pre><code>seq :: Int -&gt; [Int]\nseq n = snd (seq0 n)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1445311008, "post_id": 33227047, "comment_id": 54259147, "body": "Dr. &quot;Cactus&quot; Erdi&#39;s approach is both simpler and much more efficient. You should study it and think about why."}], "tags": [], "owner": {"reputation": 3, "user_id": 5465164, "user_type": "registered", "profile_image": "https://graph.facebook.com/10156141392260075/picture?type=large", "display_name": "Luis Lamadrid", "link": "https://stackoverflow.com/users/5465164/luis-lamadrid"}, "is_accepted": false, "score": 0, "last_activity_date": 1445308551, "creation_date": 1445308551, "answer_id": 33227047, "question_id": 33226832, "link": "https://stackoverflow.com/questions/33226832/haskell-simulate-1-n-with-until-function/33227047#33227047", "title": "Haskell simulate [1 .. n] with &quot;until&quot; function", "body": "<p>Thanks for the replies. I found out another way of solving it:</p>\n\n<pre><code>seq :: Int -&gt; [Int]    \nseq a = until (\\l -&gt; (length l) &gt;= a) (\\x -&gt; x ++ [((last x) + 1)]) [1]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5465164, "user_type": "registered", "profile_image": "https://graph.facebook.com/10156141392260075/picture?type=large", "display_name": "Luis Lamadrid", "link": "https://stackoverflow.com/users/5465164/luis-lamadrid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 33226924, "answer_count": 2, "score": 0, "last_activity_date": 1445308551, "creation_date": 1445306766, "last_edit_date": 1445307626, "question_id": 33226832, "link": "https://stackoverflow.com/questions/33226832/haskell-simulate-1-n-with-until-function", "title": "Haskell simulate [1 .. n] with &quot;until&quot; function", "body": "<p>I want to simulate the <code>[1 .. n]</code> functionality in Haskell but using the <code>until</code> function. I want to do something like this:</p>\n\n<pre><code>seq :: Int -&gt; [Int]\nseq a = until (\\list -&gt; if (length list) &gt; a then True else False) (\\x -&gt;  x ++ ((tail x) + 1) ) [1]\n</code></pre>\n\n<p>And by calling <code>seq 5</code> it should return <code>[1, 2, 3, 4, 5]</code>. I HAVE to use the <code>until</code> function. It is a constraint if you may.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445302101, "post_id": 33225837, "comment_id": 54256957, "body": "What semantics do you want this function to have? What if the process writes the characters &quot;ABC&quot; to <code>out</code> and then your program calls <code>hGetLineNonBlocking</code>, reading the characters &quot;ABC&quot;, but unable to return  <code>Just</code> something, because a newline hasn&#39;t been read yet; and it can&#39;t block until there are more characters like <code>hGetLine</code> (obviously). Do you throw away that partial line? This is almost certainly wrong. I suspect that in this case you <i>do</i> want to block, waiting for the rest of the line. If so, just check if the handle is empty with <code>hReady</code> before reading it with <code>hGetLine</code>."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445302722, "post_id": 33225837, "comment_id": 54257122, "body": "@user2407038 Sorry but I do not understand your comment, since doing <code>timeout 1 $ hGetLine ...</code> always returns <code>Just</code> something if there is a full line to be read, otherwise it returns <code>Nothing</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445303180, "post_id": 33225837, "comment_id": 54257240, "body": "In order for <code>hGetLine</code> to read a line, it must read characters sequentially until it reaches a newline character, at which point it returns. However, if <code>hGetLine</code> reads a bunch of characters, but no newline character, the line isn&#39;t finished - so hGetLine will block until there are more characters. If your function is sensible, it won&#39;t read characters from a buffer and discard them, but it can&#39;t block - what does it do with the characters that are already read? Does it return the partial line, which <i>isn&#39;t</i> terminated by a newline?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1445303743, "post_id": 33225837, "comment_id": 54257399, "body": "In general, you don&#39;t not block. Instead, you spawn a thread and just go ahead and let it block. See also <a href=\"http://stackoverflow.com/q/11744527/791604\">How can I watch multiple files/socket to become readable/writable in Haskell?</a>. If that addresses your question, I&#39;d be happy to mark it as a duplicate; what do you think?"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445336501, "post_id": 33225837, "comment_id": 54271197, "body": "@DanielWagner My question is better addressed by the very detailed answer of ErikR (see below). Nevertheless, thanks for the link to the other question."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445336772, "post_id": 33225837, "comment_id": 54271342, "body": "@user2407038 Are you saying that doing <code>timeout 1 $ hGetLine</code> can return an half read line? I don&#39;t think it will, but instead it will return <code>Nothing</code>. However, I really do not know what happens to the output channel in the case that <code>hGetLine</code> just sees some characters and hangs until it sees a newline, and in the meantime the timeout occurs. Will the characters still be there in the channel the next time I try <code>hGetLine</code>? (I have not tested this)."}], "answers": [{"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1445336346, "post_id": 33231412, "comment_id": 54271116, "body": "Thanks a lot for your thorough answer: that&#39;s a really good example. Just a few questions: don&#39;t you need to <code>hClose outp</code>? Also, you are not doing <code>terminateProcess phandle</code>, is this because <code>hClose inp</code> is expected to shutdown the external process? If the spawned process hangs, how does your solution will force it to stop?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1445328914, "creation_date": 1445328914, "answer_id": 33231412, "question_id": 33225837, "link": "https://stackoverflow.com/questions/33225837/how-to-retrieve-output-from-a-process-without-blocking-the-thread-in-haskell/33231412#33231412", "title": "How to retrieve output from a process without blocking the thread in Haskell", "body": "<p>Here are some examples of how to interact with a spawned process in a fashion mentioned by @jberryman.</p>\n\n<p>The program interacts with a script <code>./compute</code> which simply reads lines from stdin in the form <code>&lt;x&gt; &lt;y&gt;</code> and returns <em>x+1</em> after a delay of <em>y</em> seconds. More details at <a href=\"https://gist.github.com/erantapaa/ebbcd56d1bccf3e57c75\" rel=\"noreferrer\">this gist</a>.</p>\n\n<p>There are many caveats when interacting with spawned processes. In order to avoid \"suffering from buffering\" you need to flush the outgoing pipe whenever you send input and the spawned process needs to flush stdout every time it sends a response. Interacting with the process via a pseudo-tty is an alternative if you find that stdout is not flushed promptly enough.</p>\n\n<p>Also, the examples assume that closing the input pipe will lead to termination of the spawn process. If this is not the case you will have to send it a signal to ensure termination.</p>\n\n<p>Here is the example code - see the <code>main</code> routine at the end for sample invocations.</p>\n\n<pre><code>import System.Environment\nimport System.Timeout (timeout)\nimport Control.Concurrent\nimport Control.Concurrent (forkIO, threadDelay, killThread)\nimport Control.Concurrent.MVar (newEmptyMVar, putMVar, takeMVar)\n\nimport System.Process\nimport System.IO\n\n-- blocking IO\nmain1 cmd tmicros = do\n  r &lt;- createProcess (proc \"./compute\" []) { std_out = CreatePipe, std_in = CreatePipe }\n  let (Just inp, Just outp, _, phandle) = r\n\n  hSetBuffering inp NoBuffering\n  hPutStrLn inp cmd     -- send a command\n\n  -- block until the response is received\n  contents &lt;- hGetLine outp\n  putStrLn $ \"got: \" ++ contents\n\n  hClose inp            -- and close the pipe\n  putStrLn \"waiting for process to terminate\"\n  waitForProcess phandle\n\n-- non-blocking IO, send one line, wait the timeout period for a response\nmain2 cmd tmicros = do\n  r &lt;- createProcess (proc \"./compute\" []) { std_out = CreatePipe, std_in = CreatePipe }\n  let (Just inp, Just outp, _, phandle) = r\n\n  hSetBuffering inp NoBuffering\n  hPutStrLn inp cmd   -- send a command, will respond after 4 seconds\n\n  mvar &lt;- newEmptyMVar\n  tid  &lt;- forkIO $ hGetLine outp &gt;&gt;= putMVar mvar\n\n  -- wait the timeout period for the response\n  result &lt;- timeout tmicros (takeMVar mvar)\n  killThread tid\n\n  case result of\n    Nothing -&gt; putStrLn \"timed out\"\n    Just x  -&gt; putStrLn $ \"got: \" ++ x\n\n  hClose inp            -- and close the pipe\n  putStrLn \"waiting for process to terminate\"\n  waitForProcess phandle\n\n-- non-block IO, send one line, report progress every timeout period\nmain3 cmd tmicros = do\n  r &lt;- createProcess (proc \"./compute\" []) { std_out = CreatePipe, std_in = CreatePipe }\n  let (Just inp, Just outp, _, phandle) = r\n\n  hSetBuffering inp NoBuffering\n  hPutStrLn inp cmd   -- send command\n\n  mvar &lt;- newEmptyMVar\n  tid  &lt;- forkIO $ hGetLine outp &gt;&gt;= putMVar mvar\n\n  -- loop until response received; report progress every timeout period\n  let loop = do result &lt;- timeout tmicros (takeMVar mvar)\n                case result of\n                  Nothing -&gt; putStrLn  \"still waiting...\" &gt;&gt; loop\n                  Just x  -&gt; return x\n  x &lt;- loop\n  killThread tid\n\n  putStrLn $ \"got: \" ++ x\n\n  hClose inp            -- and close the pipe\n  putStrLn \"waiting for process to terminate\"\n  waitForProcess phandle\n\n{-\n\nUsage: ./prog which delay timeout\n\n  where\n    which   = main routine to run: 1, 2 or 3\n    delay   = delay in seconds to send to compute script\n    timeout = timeout in seconds to wait for response\n\nE.g.:\n\n  ./prog 1 4 3   -- note: timeout is ignored for main1\n  ./prog 2 2 3   -- should timeout\n  ./prog 2 4 3   -- should get response\n  ./prog 3 4 1   -- should see \"still waiting...\" a couple of times\n\n-}\n\nmain = do\n  (which : vtime : tout : _) &lt;- fmap (map read) getArgs\n  let cmd = \"10 \" ++ show vtime\n      tmicros = 1000000*tout :: Int\n  case which of\n    1 -&gt; main1 cmd tmicros\n    2 -&gt; main2 cmd tmicros\n    3 -&gt; main3 cmd tmicros\n    _   -&gt; error \"huh?\"\n</code></pre>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 1, "accepted_answer_id": 33231412, "answer_count": 1, "score": 2, "last_activity_date": 1521507162, "creation_date": 1445298847, "last_edit_date": 1521507162, "question_id": 33225837, "link": "https://stackoverflow.com/questions/33225837/how-to-retrieve-output-from-a-process-without-blocking-the-thread-in-haskell", "title": "How to retrieve output from a process without blocking the thread in Haskell", "body": "<p>What is the best way to write to the stdin and read from the stdout of a subprocess without blocking?</p>\n\n<p>The subprocess was created via <code>System.IO.createProcess</code> which returns handles for writing to and reading from the subprocess. The writing and reading is done in text format.</p>\n\n<p>For example, my best attempt at doing non-blocking read is <code>timeout 1 $ hGetLine out</code> which returns a <code>Just \"some line\"</code> or <code>Nothing</code> if no line exists to be read. However, this seems an hack to me, so I am looking for a more \"standard\" way.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1445298577, "post_id": 33225573, "comment_id": 54256075, "body": "It is impossible to make a <code>Monad</code> instance for <code>ExitCode</code> because <code>ExitCode</code> has kind <code>*</code> and the <code>Monad</code> type class requires a type with kind <code>* -&gt; *</code> (a type that has a type argument)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1445306793, "post_id": 33225573, "comment_id": 54258211, "body": "You might like <a href=\"http://stackoverflow.com/q/33005903/791604\">How do I deal with many levels of indentation?</a>."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1445300632, "last_edit_date": 1445300632, "creation_date": 1445298841, "answer_id": 33225836, "question_id": 33225573, "link": "https://stackoverflow.com/questions/33225573/composing-exitcodes-in-turtle-why-is-there-no-monad-monad-transformer-instance/33225836#33225836", "title": "Composing ExitCodes in Turtle. Why is there no Monad/Monad Transformer instance?", "body": "<p><code>ExitCode</code> is not a monad, and is not a monad transformer. A monad needs to take a type argument, and a monad transformer needs to take two. <code>ExitCode</code> takes none. Now suppose we ignore that not-so-little problem for a bit. Can you come up with a meaningful interpretation of</p>\n\n<pre><code>join :: ExitCode (ExitCode a) -&gt; ExitCode a\n</code></pre>\n\n<p>Yeah, I can't either. You could argue reasonably that <code>shell</code> should instead produce <code>Either FailureCode ()</code>, or perhaps work in <code>ExceptT FailureCode IO</code>, but the library authors may have thought that too confusing or inflexible for the job.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1445300921, "creation_date": 1445300921, "answer_id": 33226094, "question_id": 33225573, "link": "https://stackoverflow.com/questions/33225573/composing-exitcodes-in-turtle-why-is-there-no-monad-monad-transformer-instance/33226094#33226094", "title": "Composing ExitCodes in Turtle. Why is there no Monad/Monad Transformer instance?", "body": "<p>You can use <code>MaybeT</code> to avoid staircasing this way:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Turtle\nimport Control.Monad.Trans\nimport Control.Monad.Trans.Maybe\n\ncheck io = do ec &lt;- lift io\n              MaybeT $ case ec of\n                         ExitSuccess -&gt; return (Just True)\n                         _           -&gt; return Nothing\n\ncheckShell a b = check (shell a b)\n\nmain = do\n  dostuff\n  putStrLn \"cleaning up\"\n\ndostuff = runMaybeT $ do\n  checkShell \"date\" empty\n  checkShell \"/usr/bin/false\" empty\n  checkShell \"pwd\" empty\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1446228446, "last_edit_date": 1592644375, "creation_date": 1445308528, "answer_id": 33227044, "question_id": 33225573, "link": "https://stackoverflow.com/questions/33225573/composing-exitcodes-in-turtle-why-is-there-no-monad-monad-transformer-instance/33227044#33227044", "title": "Composing ExitCodes in Turtle. Why is there no Monad/Monad Transformer instance?", "body": "<p>One alternative is using <a href=\"https://hackage.haskell.org/package/turtle-1.2.2/docs/Turtle-Prelude.html#v:.-38--38-.\" rel=\"nofollow noreferrer\"><code>(.&amp;&amp;.)</code> and <code>(.||.)</code> from <code>Turtle.Prelude</code></a>.</p>\n<blockquote>\n<p><code>(.&amp;&amp;.) :: Monad m =&gt; m ExitCode -&gt; m ExitCode -&gt; m ExitCode</code></p>\n<p>Analogous to <code>&amp;&amp;</code> in Bash</p>\n<p>Runs the second command only if the first one returns <code>ExitSuccess</code></p>\n</blockquote>\n\n<blockquote>\n<p><code>(.||.) :: Monad m =&gt; m ExitCode -&gt; m ExitCode -&gt; m ExitCode</code></p>\n<p>Analogous to <code>||</code> in Bash</p>\n<p>Run the second command only if the first one returns <code>ExitFailure</code></p>\n</blockquote>\n<p>They allow you to chain your commands like this (note that everything involved must return an <code>ExitCode</code>, including the cleanup):</p>\n<pre><code>(command1 .&amp;&amp;. command2) .||. cleanup\n</code></pre>\n<p>Or, if you need different cleanup actions in each case:</p>\n<pre><code>(command1 .||. cleanup1) .&amp;&amp;. (command2 .||. cleanup2)\n</code></pre>\n<p>By the way, it is worth noting that <code>ExitCode</code> is not defined by <em>turtle</em> <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/System-Exit.html\" rel=\"nofollow noreferrer\">but rather by <em>base</em>, in the <code>System.Exit</code> module</a>.</p>\n"}], "owner": {"reputation": 5885, "user_id": 1436026, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/Saodx.jpg?s=128&g=1", "display_name": "DJG", "link": "https://stackoverflow.com/users/1436026/djg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 33227044, "answer_count": 3, "score": 6, "last_activity_date": 1446228446, "creation_date": 1445297004, "question_id": 33225573, "link": "https://stackoverflow.com/questions/33225573/composing-exitcodes-in-turtle-why-is-there-no-monad-monad-transformer-instance", "title": "Composing ExitCodes in Turtle. Why is there no Monad/Monad Transformer instance?", "body": "<p>I am writing a shell script in Haskell using <a href=\"https://hackage.haskell.org/package/turtle-1.2.2\" rel=\"noreferrer\"><code>turtle</code></a> and would like to know best practices on composing commands that could fail.</p>\n\n<p>Now I have a case expression staircase, like so: </p>\n\n<pre><code>runRemote :: MonadIO io =&gt; Text -&gt; Text -&gt; io ()\nrunRemote oldVersion' newVersion' = sh $ do\n  mkdir \"out\"\n  e1 &lt;- shell (\"command \" &lt;&gt; oldVersion') empty\n  case e1 of\n    ExitFailure n -&gt; cleanup \n    ExitSuccess -&gt; do\n      e2 &lt;- shell (\"command \" &lt;&gt; newVersion') empty\n      case e2 of\n        ExitFailure n -&gt; cleanup \n        ExitSuccess -&gt; do\n          curDir &lt;- pwd\n          cd (curDir &lt;.&gt; oldVersion')\n          e3 &lt;- shell (\"command something else\") empty\n          case e3 of\n           -- ...\n           -- And so on...\n</code></pre>\n\n<p>If the <code>case</code> expression was expanding on a <code>Maybe</code> type, the solution would be to derive a <code>Monad</code> instance. </p>\n\n<p>Is there a special reason the library author didn't already derive a <code>Monad</code> instance for <code>ExitCode</code> or is there a better way to do error handling for Haskell shell code? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1445289934, "post_id": 33223989, "comment_id": 54252963, "body": "As far as figuring this out on your own, you should have gotten a warning with this code in the form of <code>No explicit implementation for either &#39;showsPrec&#39; or &#39;Prelude.show&#39;</code> which is something that should tip you off.  And there are many tutorials and non-interactive resources including yet another haskell tutorial, A Gental Introduction, Learn you a Haskell, a dozen books, etc."}, {"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1445290280, "post_id": 33223989, "comment_id": 54253136, "body": "I will look for them, but it is really difficult to learn this stuff when the person who gives you this stuff simply throws it at you and doesn&#39;t explain anything about it, which is what is happening now. They gave us this, they told us nothing, and now somehow we&#39;re supposed to figure it out."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1445291813, "post_id": 33223989, "comment_id": 54253765, "body": "So is this a class?  If so I recommend you talk to the instructor.  Also, hang out on #haskell at irc.freenode.net."}, {"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1445292493, "post_id": 33223989, "comment_id": 54254075, "body": "I&#39;m not exactly sure, I&#39;m guessing that what he did was to override the current Matrix type that exists for Haskell along with those methods. Now what he wants us to do is to display the matrix row by row. Normally I&#39;d say that&#39;s not so difficult to do, but there&#39;s an issue I&#39;m not sure about which is how is the matrix built, whether that is with a vector or a 2D array. If I knew I could solve this easily, I&#39;ve already done it with a 2D array but yeah, he never explained anything."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1445293219, "post_id": 33223989, "comment_id": 54254341, "body": "@Argus To play Devil&#39;s Avocado: you&#39;re confused about whether the matrix is represented by &quot;a vector or a 2D array&quot;. Are you certain that those are the <i>only</i> two ways a matrix can be represented? Have a careful read of the code your instructor has supplied to you. <code>newtype Matrix a = Mat ((Int,Int), (Int,Int) -&gt; a)</code> doesn&#39;t look like a 2D array to me..."}, {"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1445293499, "post_id": 33223989, "comment_id": 54254443, "body": "I&#39;m sure what I&#39;m thinking is probably not the only way to represent a matrix, but then I;m new to haskell. From what I understood about that constructor is that a Matrix has a number of columns and rows. I&#39;m guessing here, but maybe the way this is represented is through ordered pairs"}, {"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1445294266, "post_id": 33223989, "comment_id": 54254716, "body": "Yeah, definitely receiving an ordered pair, thanks for making me look real close at that."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1445289371, "creation_date": 1445289371, "answer_id": 33224066, "question_id": 33223989, "link": "https://stackoverflow.com/questions/33223989/using-show-on-a-custom-type/33224066#33224066", "title": "Using show on a custom type", "body": "<p>The problem is with your indentation. The definition of <code>show</code> needs to be indented relative to the <code>instance show a =&gt; Show (Matrix a)</code>. As it is, it appears that you are trying to define a new function called <code>show</code>, unrelated to the <code>Show</code> class, which you can't do.</p>\n"}, {"comments": [{"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1445296301, "post_id": 33225245, "comment_id": 54255431, "body": "I understand what you mean, usually I do investigate this sorts of things but Haskell is uncharted territory for me, I did search for tutorials and stuff, but I had a lot of trouble doing the most basic of things. Thanks for the help, I found out that this is being implemented through ordered pairs. I think I can come up with something here to print this thing. Thanks again."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1445296680, "post_id": 33225245, "comment_id": 54255530, "body": "I can recommend <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">Learn You A Haskell</a> as an introductory study guide to help you get used to the language. It&#39;s one of my favourite programming books."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445312375, "post_id": 33225245, "comment_id": 54259487, "body": "Would it be easier to remember that my name is David Feuer? Or \u05d3\u05d5\u05d3 \u05e4\u05d5\u05d9\u05d9\u05e8? Perhaps I should have called myself treeowl here as I do on GitHub...."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445327377, "post_id": 33225245, "comment_id": 54265553, "body": "@dfeuer For some reason I always want to add an E between the D and the F. I have no idea why I find it so difficult, especially when it&#39;s written down right in front of me :S"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 2, "last_activity_date": 1445296361, "last_edit_date": 1445296361, "creation_date": 1445294968, "answer_id": 33225245, "question_id": 33223989, "link": "https://stackoverflow.com/questions/33223989/using-show-on-a-custom-type/33225245#33225245", "title": "Using show on a custom type", "body": "<p>@dfeuer, whose name I continue to have trouble spelling, has given you the direct answer - Haskell is sensitive to layout - but I'm going to try to help you with the underlying question that you've alluded to in the comments, without giving you the full answer.</p>\n\n<p>You mentioned that you were confused about how matrices are represented. <a href=\"http://blog.codinghorror.com/learn-to-read-the-source-luke/\" rel=\"nofollow\">Read the source, Luke</a>:</p>\n\n<pre><code>newtype Matrix a = Mat ((Int,Int), (Int,Int) -&gt; a)\n</code></pre>\n\n<p>This <code>newtype</code> declaration tells you that a <code>Matrix</code> is formed from a pair <code>((Int,Int), (Int,Int) -&gt; a)</code>. If you split up the tuple, that's an <code>(Int, Int)</code> pair and a function of type <code>(Int, Int) -&gt; a</code> (a function with two integer arguments which returns something of arbitrary type <code>a</code>). This suggests to me that the first part of the tuple represents the <em>size</em> of the matrix, and the second part is a function mapping <em>coordinates</em> onto <em>elements</em>. This hypothesis seems to be confirmed by some of the example code your professor has given you - have a look at <code>at</code> or <code>mtranspose</code>, for example.</p>\n\n<p>So, the question is - given the width and height of the matrix, and a function which will give you the element at a given coordinate, how do we give a string showing the items in the matrix?</p>\n\n<p>The first thing we need to do is enumerate all the possible coordinates for the given width and height of the matrix. Haskell provides some useful syntactic constructs for this sort of operation - we can write <code>[x .. y]</code> to enumerate all the values between <code>x</code> and <code>y</code>, and use a list comprehension to unpack those enumerations in a nested loop.</p>\n\n<pre><code>coords :: (Int, Int)  -- (width, height)\n          -&gt; [(Int, Int)]  -- (x, y) pairs\ncoords (w, h) = [(x, y) | x &lt;- [0 .. w], y &lt;- [0 .. h]]\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>ghci&gt; coords (2, 4)\n[(0,0),(0,1),(0,2),(0,3),(0,4),(1,0),(1,1),(1,2),(1,3),(1,4),(2,0),(2,1),(2,2),(2,3),(2,4)]\n</code></pre>\n\n<p>Now that we've worked out how to list all the possible coordinates in a matrix, how do we turn coordinates into elements of type <code>a</code>? Well, the <code>Mat</code> constructor contains a function <code>(Int, Int) -&gt; a</code> which gives you the element associated with a single coordinate. We need to apply that function to each of the coordinates in the list which we just enumerated. This is what <code>map</code> does.</p>\n\n<pre><code>elems :: Matrix a -&gt; [a]\nelems (Mat (size, f)) = map f $ coords size\n</code></pre>\n\n<p>So, there's the code to enumerate the elements of a matrix. Can you figure out how to modify this code so that a) it shows the elements as a string and b) it shows them in a row-by-row fashion? You'll probably need to adjust both of these functions.</p>\n\n<hr>\n\n<p>I suppose the broader point I'd like to make is that even though it feels like your professor has thrown you into the deep end, it's always possible to do a little detective work and figure out for yourself what something means. Many - most? - of the people answering questions on this site are self-taught programmers, myself included. We persevered!</p>\n\n<p>After all, it's just code. If a computer's going to understand it then it must be written down on the page, and that means that you can understand it, too.</p>\n"}], "owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 1, "accepted_answer_id": 33225245, "answer_count": 2, "score": 0, "last_activity_date": 1445306036, "creation_date": 1445289016, "last_edit_date": 1445306036, "question_id": 33223989, "link": "https://stackoverflow.com/questions/33223989/using-show-on-a-custom-type", "title": "Using show on a custom type", "body": "<p>I'm having trouble printing contents of a custom matrix type I made. When I try to do it tells me </p>\n\n<pre><code> Ambiguous occurrence `show'\n It could refer to either `MatrixShow.show',\n                          defined at Matrices.hs:6:9\n                       or `Prelude.show',\n                          imported from `Prelude' at Matrices.hs:1:8-17\n</code></pre>\n\n<p>Here is the module I'm importing: </p>\n\n<pre><code>module Matrix (Matrix(..), fillWith, fromRule, numRows, numColumns, at, mtranspose, mmap) where\nnewtype Matrix a = Mat ((Int,Int), (Int,Int) -&gt; a)\n\nfillWith :: (Int,Int) -&gt; a -&gt; (Matrix a)\nfillWith (n,m) k = Mat ((n,m), (\\(_,_) -&gt; k))\n\nfromRule :: (Int,Int) -&gt; ((Int,Int) -&gt; a) -&gt; (Matrix a)\nfromRule (n,m) f = Mat ((n,m), f)\n\nnumRows :: (Matrix a) -&gt; Int\nnumRows (Mat ((n,_),_)) = n\n\nnumColumns :: (Matrix a) -&gt; Int\nnumColumns (Mat ((_,m),_)) = m\n\nat :: (Matrix a) -&gt; (Int, Int) -&gt; a\nat (Mat ((n,m), f)) (i,j)| (i &gt; 0) &amp;&amp; (j &gt; 0) || (i &lt;= n) &amp;&amp; (j &lt;= m) = f (i,j)\n\nmtranspose :: (Matrix a) -&gt; (Matrix a)\nmtranspose (Mat ((n,m),f)) = (Mat ((m,n),\\(j,i) -&gt; f (i,j)))\n\nmmap :: (a -&gt; b) -&gt; (Matrix a) -&gt; (Matrix b)\nmmap h (Mat ((n,m),f)) = (Mat ((n,m), h.f))\n</code></pre>\n\n<p>This is my module:</p>\n\n<pre><code>module MatrixShow where\n    import Matrix\n\n\n    instance (Show a) =&gt; Show (Matrix a) where \n    show (Mat ((x,y),f)) = show f\n</code></pre>\n\n<p>Also is there some place where I can figure this out on my own, some link with instructions or some tutorial or something to learn how to do this.</p>\n"}, {"tags": ["haskell", "matrix"], "answers": [{"comments": [{"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1445285487, "post_id": 33221706, "comment_id": 54250623, "body": "I changed it, but its still telling me &quot;Not in scope: data constructor &#39;Mat&quot;&#39;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1445289665, "post_id": 33221706, "comment_id": 54252832, "body": "@Argus Check whether you recompiled the module after the change. GHCi should also pick up the change without explicitly recompiling."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1445280526, "creation_date": 1445280526, "answer_id": 33221706, "question_id": 33221663, "link": "https://stackoverflow.com/questions/33221663/calling-a-newtype-constructor/33221706#33221706", "title": "Calling a newtype constructor", "body": "<p>Export the constructor:</p>\n\n<pre><code>module Matrix (Matrix(..), fillWith, fromRule, -- etc.\n                --   ^^^^\n</code></pre>\n\n<p>By default, only the type is exported, preventing the other modules to access the constructor.</p>\n\n<p>The line</p>\n\n<pre><code>instance Matrix (Show a) =&gt; Show (Matrix a) where\n</code></pre>\n\n<p>looks wrong to me. Is there some <code>Matrix</code> class around? More likely, it should read</p>\n\n<pre><code>instance (Show a) =&gt; Show (Matrix a) where\n</code></pre>\n\n<p>Also, the line</p>\n\n<pre><code>show Mat ((x,y),(a,b)) = show 1\n</code></pre>\n\n<p>is wrong. Its left hand side should look like</p>\n\n<pre><code>show (Mat ((x,y), f)) = ...\n</code></pre>\n"}], "owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 33221706, "answer_count": 1, "score": 2, "last_activity_date": 1445306081, "creation_date": 1445280323, "last_edit_date": 1445306081, "question_id": 33221663, "link": "https://stackoverflow.com/questions/33221663/calling-a-newtype-constructor", "title": "Calling a newtype constructor", "body": "<p>I'm not really getting how to work with modules in Haskell, I'm really new to this language and so far I only know the most basic of things, such as creating a function and that sort of stuff. Right now I'm getting an error that says </p>\n\n<pre><code>Not in scope: data constructor 'Mat'\n</code></pre>\n\n<p>This is supposed to be the constructor for a newtype definition of a matrix. This is the module: </p>\n\n<pre><code>module Matrix (Matrix, fillWith, fromRule, numRows, numColumns, at, mtranspose, mmap) where\nnewtype Matrix a = Mat ((Int,Int), (Int,Int) -&gt; a)\n\nfillWith :: (Int,Int) -&gt; a -&gt; (Matrix a)\nfillWith (n,m) k = Mat ((n,m), (\\(_,_) -&gt; k))\n\nfromRule :: (Int,Int) -&gt; ((Int,Int) -&gt; a) -&gt; (Matrix a)\nfromRule (n,m) f = Mat ((n,m), f)\n\nnumRows :: (Matrix a) -&gt; Int\nnumRows (Mat ((n,_),_)) = n\n\nnumColumns :: (Matrix a) -&gt; Int\nnumColumns (Mat ((_,m),_)) = m\n\nat :: (Matrix a) -&gt; (Int, Int) -&gt; a\nat (Mat ((n,m), f)) (i,j)| (i &gt; 0) &amp;&amp; (j &gt; 0) || (i &lt;= n) &amp;&amp; (j &lt;= m) = f (i,j)\n\nmtranspose :: (Matrix a) -&gt; (Matrix a)\nmtranspose (Mat ((n,m),f)) = (Mat ((m,n),\\(j,i) -&gt; f (i,j)))\n\nmmap :: (a -&gt; b) -&gt; (Matrix a) -&gt; (Matrix b)\nmmap h (Mat ((n,m),f)) = (Mat ((n,m), h.f))\n</code></pre>\n\n<p>I'm calling it on my own module in this way: </p>\n\n<pre><code>module MatrixShow where\n    import Matrix\n\n\n    instance Matrix (Show a) =&gt; Show (Matrix a) where \n        show Mat ((x,y),(a,b)) = show 1\n</code></pre>\n\n<p>The show 1 is just a test. I'm not even sure what that </p>\n\n<p><code>instance Matrix (Show a) =&gt; Show (Matrix a)</code> means at all, they just gave us this code and then told us to figure it out without explaining what is happening in any of these things. </p>\n\n<p>If anyone can help me I'd appreciate. I'm guessing that printing the contents of a matrix is very basic in Haskell, and I'm sure I'm making it more difficult than it should be, but still as a newcomer to this language I'm not really sure what I'm doing sometimes.  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 2, "creation_date": 1445275630, "post_id": 33220368, "comment_id": 54245159, "body": "<code>foldr</code> here refers to <code>Data.Map.foldr</code> and not <code>Prelude.foldr</code>."}, {"owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1445276272, "post_id": 33220368, "comment_id": 54245452, "body": "When I first attempted this project, I received an ambiguous error and was suggested to use either <code>Prelude.foldr</code> or <code>Data.Map.foldr</code>. The <code>Prelude.foldr</code> eliminated the ambiguity but the other didn&#39;t. @Mephy"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 0, "creation_date": 1445275892, "post_id": 33220410, "comment_id": 54245274, "body": "Yes. I&#39;m using <code>Data.Map</code> for  <code>foldr</code> @BartekBanachewicz"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 2, "creation_date": 1445275929, "post_id": 33220410, "comment_id": 54245294, "body": "@skg22 and you&#39;re trying to use it on a list."}, {"owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 0, "creation_date": 1445276321, "post_id": 33220410, "comment_id": 54245489, "body": "I tried using <code>foldr</code> from  <code>Data.List</code> but that didn&#39;t worked either :( @bartekbanachewicz"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 1, "creation_date": 1445277479, "post_id": 33220410, "comment_id": 54246129, "body": "@skg22 Perhaps you could open a question with some details on what went wrong with <code>Data.List.foldr</code>. (When I try, it works fine.)"}, {"owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445283506, "post_id": 33220410, "comment_id": 54249543, "body": "I tested your method where I have <code>import Data.List hiding (foldr)</code>. I received an ambiguous occurrence <code>&#39;foldr\u2019</code>. The program that I use, that is Haskell for Mac, indicates that it could refer to either <code>Prelude.foldr</code> or <code>Data.Map.foldr</code>. The <code>Prelude.foldr</code> eliminated the error but the other didn&#39;t @DanielWagner"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 1, "creation_date": 1445283545, "post_id": 33220410, "comment_id": 54249559, "body": "@skg22 <code>import Data.Map hiding (map, foldr)</code>"}, {"owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 0, "creation_date": 1445284280, "post_id": 33220410, "comment_id": 54249975, "body": "That solved the problem. However, previously, I tried <code>import Data.Map hiding (foldr)</code> but that failed. Why didn&#39;t this work when it does the same purpose? Correct me if I&#39;m wrong @BartekBanachewicz"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 0, "creation_date": 1445284320, "post_id": 33220410, "comment_id": 54249994, "body": "@skg22 because there are more conflicting functions in those two modules than just <code>foldr</code>."}, {"owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "edited": false, "score": 0, "creation_date": 1445284561, "post_id": 33220410, "comment_id": 54250136, "body": "Understood. Appreciate your aid @BartekBanachewicz"}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 5, "last_activity_date": 1445276011, "last_edit_date": 1445276011, "creation_date": 1445275628, "answer_id": 33220410, "question_id": 33220368, "link": "https://stackoverflow.com/questions/33220368/couldnt-match-expected-type-map-k0-a/33220410#33220410", "title": "Couldn&#39;t match expected type \u2018Map k0 a\u2019", "body": "<blockquote>\n  <p>I cannot seem to spot the source of the error.</p>\n</blockquote>\n\n<p><code>xs</code> is <code>[a]</code>, right? And <em>which</em> <code>foldr</code> are you trying to use? The <code>Data.List</code> one or <code>Data.Map</code> one?</p>\n\n<hr>\n\n<p>My suggestion would be to update the compiler to 7.10 and use folds from <code>Foldable</code>.</p>\n"}], "owner": {"reputation": 37, "user_id": 4595035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/76e671f7535b23239301fdc55baac14b?s=128&d=identicon&r=PG&f=1", "display_name": "skg22", "link": "https://stackoverflow.com/users/4595035/skg22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 33220410, "answer_count": 1, "score": 2, "last_activity_date": 1445276011, "creation_date": 1445275440, "question_id": 33220368, "link": "https://stackoverflow.com/questions/33220368/couldnt-match-expected-type-map-k0-a", "title": "Couldn&#39;t match expected type \u2018Map k0 a\u2019", "body": "<p>Below is my code:</p>\n\n<pre><code>module Data.Bag where\n\nimport Data.Map hiding (map)\nimport Prelude hiding (foldr)\n\n-- | Type of bags\nnewtype Bag a = Bag {fm :: Map a Int} deriving Eq\n\n-- | Empty bag\nemptyBag :: Bag a\nemptyBag = Bag empty\n\n-- | Add an element to a bag.\nbagInsert :: Ord a =&gt; Bag a -&gt; a -&gt; Bag a\nbagInsert Bag{ fm=bag } a\n  = Bag (insertWith (+) a 1 bag)\n\n-- | Put all elements from a list into a bag.\nlistToBag :: Ord a =&gt; [a] -&gt; Bag a\nlistToBag xs \n   = foldr (\\x bag -&gt; bagInsert bag x) emptyBag xs\n</code></pre>\n\n<p>I'm getting an error from the last function and the error statement is</p>\n\n<pre><code>Couldn't match expected type \u2018Map k0 a\u2019 with actual type \u2018[a]\u2019\nRelevant bindings include\n  xs :: [a]\n    (bound at /Users/.../Bags.hsproj/Bags.hs:20:11)\n  listToBag :: [a] -&gt; Bag a\n    (bound at /Users/.../Bags.hsproj/Bags.hs:20:1)\nIn the third argument of \u2018foldr\u2019, namely \u2018xs\u2019\nIn the expression: foldr (\\ x bag -&gt; bagInsert bag x) emptyBag xs\n</code></pre>\n\n<p>I cannot seem to spot the source of the error. I referred to other posts made by users here that encountered similar issues but still, I am unable to understand the error <code>\u2018Map k0 a\u2019</code>. So, how do I go around this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1445275842, "post_id": 33220139, "comment_id": 54245255, "body": "Related: <a href=\"http://stackoverflow.com/questions/33092864/what-is-predicativity\" title=\"what is predicativity\">stackoverflow.com/questions/33092864/what-is-predicativity</a>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1445278202, "post_id": 33220139, "comment_id": 54246520, "body": "A function of type <code>a -&gt; Bool</code> can&#39;t do anything useful that a value of type <code>Bool</code> can&#39;t, so I&#39;m not sure why you want to do this."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445278853, "post_id": 33220139, "comment_id": 54246838, "body": "Specifically, it has to work uniformly for all choices of <code>a</code> (parametricity), so the only (defined) inhabitants are <code>const True</code> and <code>const False</code>."}, {"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445279777, "post_id": 33220139, "comment_id": 54247359, "body": "@ReinHenrichs it&#39;s a simplified program which reproduces error. In real-world usage, that function looks a bit different and has few type-class constraints which let you examine input-argument in many more ways."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 8, "last_activity_date": 1445275754, "creation_date": 1445275754, "answer_id": 33220450, "question_id": 33220139, "link": "https://stackoverflow.com/questions/33220139/ability-to-get-a-polymorphic-function-from-monadic-action-in-haskell/33220450#33220450", "title": "Ability to get a polymorphic function from monadic action in Haskell", "body": "<p>Haskell does not allow you to use a polymorphic argument to a type constructor other than <code>-&gt;</code>. You need to use a <code>newtype</code> to make use of that special exemption.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nnewtype ToBool = ToBool {getToBool :: forall a . a -&gt; Bool}\n\nf :: ToBool\nf = ToBool (const True)\n\ngetFIO :: IO ToBool\ngetFIO = return f\n</code></pre>\n\n<p>You'll need to apply <code>getToBool</code> each time you want to use <code>f</code>, but that's okay.</p>\n"}, {"tags": [], "owner": {"reputation": 1178, "user_id": 1940209, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/247799acb8cb63c48d278c09eb455283?s=128&d=identicon&r=PG", "display_name": "aavogt", "link": "https://stackoverflow.com/users/1940209/aavogt"}, "is_accepted": false, "score": 4, "last_activity_date": 1445275939, "creation_date": 1445275939, "answer_id": 33220493, "question_id": 33220139, "link": "https://stackoverflow.com/questions/33220139/ability-to-get-a-polymorphic-function-from-monadic-action-in-haskell/33220493#33220493", "title": "Ability to get a polymorphic function from monadic action in Haskell", "body": "<p>You can make it \"work\" with <code>RankNTypes</code>, but then you need a newtype wrapper:</p>\n\n<pre><code>-- might as well be Bool\nnewtype Pointless = Pointless (forall a. a -&gt; Bool)\n\ngetFIO_ :: IO Pointless\ngetFIO_ = return (Pointless f)\n\nmain = do\n    Pointless f'' &lt;- getFIO_\n    print (f'' (10::Int))\n    print (f'' \"asd\")\n</code></pre>\n\n<p>So you might be better off rearranging your program to not use that extension, by changing <code>getFIO :: IO Blah</code>, defining a <code>applyBlah :: Blah -&gt; a -&gt; Bool</code>, and then using <code>applyBlah f''</code> where you previously had <code>f''</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1445280032, "creation_date": 1445280032, "answer_id": 33221582, "question_id": 33220139, "link": "https://stackoverflow.com/questions/33220139/ability-to-get-a-polymorphic-function-from-monadic-action-in-haskell/33221582#33221582", "title": "Ability to get a polymorphic function from monadic action in Haskell", "body": "<p>To complement the other answers, I'd note that</p>\n\n<pre><code>f :: IO (a -&gt; Bool)\n</code></pre>\n\n<p>actually means</p>\n\n<pre><code>f :: forall a. IO (a -&gt; Bool)\n</code></pre>\n\n<p>which describes the following contract between caller and callee:</p>\n\n<ol>\n<li>The caller chooses a type <code>a</code></li>\n<li>Then, <code>f</code> does some <code>IO</code></li>\n<li>Finally, <code>f</code> returns a value of type <code>a -&gt; Bool</code></li>\n</ol>\n\n<p>Note that <code>a</code> is chosen before the IO, hence the last function is monomorphic.</p>\n\n<p>Instead, we need the following type</p>\n\n<pre><code>f :: IO (forall a. a -&gt; Bool)\n</code></pre>\n\n<p>which postpones the choice of <code>a</code> after the IO is done. The above type requires the <code>ImpredicativeTypes</code> extension (which does not really work at the moment in GHC), or using a <code>newtype</code> wrapper as done in the other answers.</p>\n"}], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 33220450, "answer_count": 3, "score": 3, "last_activity_date": 1445280032, "creation_date": 1445274607, "question_id": 33220139, "link": "https://stackoverflow.com/questions/33220139/ability-to-get-a-polymorphic-function-from-monadic-action-in-haskell", "title": "Ability to get a polymorphic function from monadic action in Haskell", "body": "<p>I would like to be able to write an IO-action, which would return a polymorphic function, which could be used for different values, but it seems I can't. Can anyone help me doing that please?</p>\n\n<pre><code>f :: a -&gt; Bool\nf _ = True\n\ngetF :: Int -&gt; (a -&gt; Bool)\ngetF _ = f\n\ngetFIO :: IO (a -&gt; Bool)\ngetFIO = return f\n\nmain :: IO ()\nmain = do\n    -- this works\n    print ((f :: Int -&gt; Bool) (10::Int))\n    print ((f :: String -&gt; Bool) \"asd\")\n\n    -- this works\n    let f' = getF 10\n    print (f' (10::Int))\n    print (f' \"asd\")\n\n    -- this doesn't\n    f'' &lt;- getFIO\n    print (f'' (10::Int))\n    print (f'' \"asd\")\n\n    -- but this does\n    f''' &lt;- getFIO\n    print (f''' (10::Int))\n    f'''' &lt;- getFIO\n    print (f'''' \"asd\")\n\n    return ()\n</code></pre>\n"}, {"tags": ["haskell", "idris"], "answers": [{"comments": [{"owner": {"reputation": 1073, "user_id": 570693, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/116541a9a982bab83135291c70eb914b?s=128&d=identicon&r=PG&f=1", "display_name": "Karl", "link": "https://stackoverflow.com/users/570693/karl"}, "edited": false, "score": 1, "creation_date": 1445284962, "post_id": 33220069, "comment_id": 54250347, "body": "Perfect answer, exactly what I needed.  I guess I need to spend a bit more time with Applicative.  Thanks."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1445287575, "post_id": 33220069, "comment_id": 54251764, "body": "What is the type of <code>someFunction</code>? Is its return type monadic?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 21, "last_activity_date": 1445288629, "last_edit_date": 1445288629, "creation_date": 1445274359, "answer_id": 33220069, "question_id": 33219871, "link": "https://stackoverflow.com/questions/33219871/haskell-version-of-idris-notation-bang-notation/33220069#33220069", "title": "Haskell version of Idris !-notation (bang notation)", "body": "<p>Since every monad is an <code>Applicative</code> (with GHC >= 7.10) we can write</p>\n\n<pre><code>someFunction &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c\n</code></pre>\n\n<p>Note that if <code>someFunction</code> returns a monadic value of type <code>m T</code>, the above will return <code>m (m T)</code>, which is likely not what we want (as @pigworker points out below). We can however <code>join</code> the two layers together:</p>\n\n<pre><code>join $ someFunction &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 6, "last_activity_date": 1445324348, "creation_date": 1445324348, "answer_id": 33229995, "question_id": 33219871, "link": "https://stackoverflow.com/questions/33219871/haskell-version-of-idris-notation-bang-notation/33229995#33229995", "title": "Haskell version of Idris !-notation (bang notation)", "body": "<p>An alternative to @chi's answer is <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html\"><code>liftA3 someFunction a b c</code></a> (with <code>join</code> if needed).</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1445340551, "creation_date": 1445340551, "answer_id": 33235448, "question_id": 33219871, "link": "https://stackoverflow.com/questions/33219871/haskell-version-of-idris-notation-bang-notation/33235448#33235448", "title": "Haskell version of Idris !-notation (bang notation)", "body": "<p>Speaking of arrows...</p>\n\n<pre><code>import Control.Arrow\n\na' = Kleisli $ const a\nb' = Kleisli $ const b\nc' = Kleisli $ const c\n\nfoo = (`runKleisli`()) $\n  (a' &amp;&amp;&amp; b') &amp;&amp;&amp; c' &gt;&gt;&gt; uncurry (uncurry someFunction)\n</code></pre>\n\n<p>Not that I recommend this.</p>\n"}], "owner": {"reputation": 1073, "user_id": 570693, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/116541a9a982bab83135291c70eb914b?s=128&d=identicon&r=PG&f=1", "display_name": "Karl", "link": "https://stackoverflow.com/users/570693/karl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 523, "favorite_count": 3, "accepted_answer_id": 33220069, "answer_count": 3, "score": 12, "last_activity_date": 1445340551, "creation_date": 1445273680, "last_edit_date": 1445305789, "question_id": 33219871, "link": "https://stackoverflow.com/questions/33219871/haskell-version-of-idris-notation-bang-notation", "title": "Haskell version of Idris !-notation (bang notation)", "body": "<p>I've had the luxury of learning a bit of Idris lately and one thing I've found extremely convenient is the !-notation, which let's me shorten monadic code inside a do block such as</p>\n\n<pre><code>a' &lt;- a\nb' &lt;- b\nc' &lt;- c\nsomeFunction a' b' c'\n</code></pre>\n\n<p>to the much nicer</p>\n\n<pre><code>someFunction !a !b !c\n</code></pre>\n\n<p>Now when I write code in Haskell, I'm looking for something similar but as far as I can tell it doesn't exist (and the bang character is obviously already used for  strict pattern matching). Is there any way to avoid having a bunch of trivial left arrows inside a do block?  Perhaps an extension that adds a rewriting rule, or something to that effect?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445286674, "post_id": 33219838, "comment_id": 54251289, "body": "It matches the value produced by the expression on the RHS against the pattern on the LHS."}, {"owner": {"reputation": 41, "user_id": 5463777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfa8913608da33f758e99961a37c4b83?s=128&d=identicon&r=PG&f=1", "display_name": "WL_Law", "link": "https://stackoverflow.com/users/5463777/wl-law"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445404645, "post_id": 33219838, "comment_id": 54304458, "body": "yeah actually its an assign expression, its not a function."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1445274605, "creation_date": 1445274605, "answer_id": 33220136, "question_id": 33219838, "link": "https://stackoverflow.com/questions/33219838/does-the-pattern-match-in-a-where-clause-not-only-match-the-lhs-part-of-the-patt/33220136#33220136", "title": "Does the pattern match in a where clause not only match the LHS part of the pattern expr., but also match the RHS part of the expr.?", "body": "<p>The pattern:</p>\n\n<pre><code>where (f:_) = firstname\n</code></pre>\n\n<p>is equivalent to <code>f = head firstname</code>. In particular, it will throw an exception if <code>firstname</code> is the empty list.</p>\n\n<p>So the two patterns in the where clause are equivalent to:</p>\n\n<pre><code>where f = head firstname\n      l = head lastname\n</code></pre>\n\n<p>The function could also have been written this way:</p>\n\n<pre><code>initials (f:_) (l:_) = [f] ++ \". \" ++ [l] ++ \".\"\n</code></pre>\n\n<p>and that might make it clearer that <code>initials</code> will fail unless both the first and last names are not empty.</p>\n"}], "owner": {"reputation": 41, "user_id": 5463777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfa8913608da33f758e99961a37c4b83?s=128&d=identicon&r=PG&f=1", "display_name": "WL_Law", "link": "https://stackoverflow.com/users/5463777/wl-law"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1445274605, "creation_date": 1445273582, "question_id": 33219838, "link": "https://stackoverflow.com/questions/33219838/does-the-pattern-match-in-a-where-clause-not-only-match-the-lhs-part-of-the-patt", "title": "Does the pattern match in a where clause not only match the LHS part of the pattern expr., but also match the RHS part of the expr.?", "body": "<p>I see these code in a tutorial(<a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow\">http://learnyouahaskell.com/syntax-in-functions</a>)</p>\n\n<pre><code>initials :: String -&gt; String -&gt; String  \ninitials firstname lastname = [f] ++ \". \" ++ [l] ++ \".\"  \n    where (f:_) = firstname  \n          (l:_) = lastname    \n</code></pre>\n\n<p>but I'm confused with here.</p>\n\n<pre><code> where (f:_) = firstname  \n       (l:_) = lastname   \n</code></pre>\n\n<p>where the 2 patterns are totally same, the only difference between them is the RHS of the equation, one is firstname and the other one is lastname.</p>\n\n<p>So does the pattern match in a where clause not only match the LHS  part of the pattern expr., but also match the RHS part of the expr.?</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming", "lambda-calculus"], "comments": [{"owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 1, "creation_date": 1445273802, "post_id": 33219820, "comment_id": 54244157, "body": "Do you mean untyped lambda calculus?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1445274142, "post_id": 33219820, "comment_id": 54244349, "body": "The usual approach is rather the other way around: build up a structured representation of the lambda, and only turn it into a (Haskell) lambda at the last second. e.g. you might like to read about <a href=\"https://en.wikipedia.org/wiki/Higher-order_abstract_syntax\" rel=\"nofollow noreferrer\">HOAS</a>, with which you might write <code>Lambda (\\f -&gt; Lambda (\\x -&gt; f :# (f :# (f :# x))))</code> with a suitable data definition."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1445274392, "post_id": 33219820, "comment_id": 54244474, "body": "I don&#39;t think you can do this in Haskell, as functions do not have any runtime representation (in contrast to JS, where they&#39;re objects). I guess there&#39;s a good reason that there is no <code>Show</code> instance for functions either."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1445287412, "post_id": 33219820, "comment_id": 54251680, "body": "Not every untyped LC term can be assigned a Haskell type. Even if you could write a function like <code>LambdaTerm a =&gt; a -&gt; String</code>, where <code>LambdaTerm a</code> indicates that <code>a</code> is a type whose terms are valid terms in the untyped LC, this function would still be partial with respect to the domain of untyped LC terms, ie, there are terms you would not be able to reify because they cannot be written as a haskell function. This is especially unfortunate since the overwhelming majority of untyped LC terms cannot be assigned a Haskell type."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445345535, "post_id": 33221105, "comment_id": 54277107, "body": "That&#39;s awesome. Thanks."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1446043550, "post_id": 33221105, "comment_id": 54579596, "body": "Hmm I&#39;m sorry, but I think this doesn&#39;t get the normal form of a term. <a href=\"http://lpaste.net/144108\" rel=\"nofollow noreferrer\">See here</a>..."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1446046529, "post_id": 33221105, "comment_id": 54581827, "body": "@Viclib, it&#39;s <code>two = Lam $ \\ f -&gt; Lam $ \\ x -&gt; f # (f # x)</code>. Or  if you want to keep your definition, then you need to define a function, that replaces every <code>App</code> with <code>#</code> in a term."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1446182988, "post_id": 33221105, "comment_id": 54647032, "body": "Hey, that was obvious. I&#39;m sorry for missing that out. Thank you!"}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 5, "last_activity_date": 1445296098, "last_edit_date": 1445296098, "creation_date": 1445278216, "answer_id": 33221105, "question_id": 33219820, "link": "https://stackoverflow.com/questions/33219820/is-it-possible-to-infer-the-normalized-source-of-a-pure-%ce%bb-function-on-haskell/33221105#33221105", "title": "Is it possible to infer the normalized source of a pure \u03bb function on Haskell?", "body": "<p>Yes, you <a href=\"http://okmij.org/ftp/tagless-final/course/TDPE.hs\" rel=\"nofollow\">can</a>, but you need to provide the spine of the type of your function, so it doesn't work for ULC. See also the whole <a href=\"http://okmij.org/ftp/tagless-final/course/\" rel=\"nofollow\">lecture notes</a>.</p>\n\n<p>But as <strong>Daniel Wagner</strong> says you can just use HOAS.</p>\n\n<p>There is also another opportunity: here is <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/fooling/Jigger.agda\" rel=\"nofollow\">something</a> that looks like HOAS, but is FOAS actually, and all you need is suitable normalization by evaluation (<a href=\"http://fplab.bitbucket.org/posts/2008-04-13-the-shortest-betanormaliz.html\" rel=\"nofollow\">in terms of quote</a>, <a href=\"http://www.diku.dk/OLD/undervisning/2005e/224/papers/DybjerFilinski-NaPE.pdf\" rel=\"nofollow\">in terms of reify &amp; reflect</a>). <strong>pigworker</strong> also wrote a Haskell version of the Jigger, but I can't find it.</p>\n\n<p>We can also do this type-safely in type theory: one way is to use <a href=\"https://github.com/effectfully/random-stuff/blob/master/Normalization/Liftable.agda\" rel=\"nofollow\">liftable terms</a> (which requires a postulate), or we can <a href=\"https://github.com/effectfully/random-stuff/blob/master/Normalization/PHOAS.agda\" rel=\"nofollow\">reify</a> lambda terms into their PHOAS representation and then convert <a href=\"http://adam.chlipala.net/cpdt/html/Intensional.html\" rel=\"nofollow\">PHOAS to FOAS</a> (which is very complicated).</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Here is some HOAS-related code:</p>\n\n<pre><code>{-# LANGUAGE GADTs, FlexibleInstances #-}\n\ninfixl 5 #\n\ndata Term a = Pure a | Lam (Term a -&gt; Term a) | App (Term a) (Term a)\n\n(#) :: Term a -&gt; Term a -&gt; Term a\nLam f # x = f x\nf     # x = App f x\n\ninstance Show (Term String) where\n    show = go names where\n        names = map (:[]) ['a'..'z'] ++ map (++ ['\\'']) names\n\n        go :: [String] -&gt; Term String -&gt; String\n        go  ns    (Pure n)  = n\n        go (n:ns) (Lam f)   = concat [\"\\\\\", n, \" -&gt; \", go ns (f (Pure n))]\n        go  ns    (App f x) = concat [go ns f, \"(\", go ns x, \")\"]\n\nk :: Term a\nk = Lam $ \\x -&gt; Lam $ \\y -&gt; x\n\ns :: Term a\ns = Lam $ \\f -&gt; Lam $ \\g -&gt; Lam $ \\x -&gt; f # x # (g # x)\n\nomega :: Term a\nomega = (Lam $ \\f -&gt; f # f) # (Lam $ \\f -&gt; f # f)\n\nrun t = t :: Term String\n\nmain = do\n    print $ run $ s         -- \\a -&gt; \\b -&gt; \\c -&gt; a(c)(b(c))\n    print $ run $ s # k # k -- \\a -&gt; a\n    -- print $ run $ omega  -- bad idea\n</code></pre>\n\n<p>Also, instead of writing this <code>Lam</code>s, <code>#</code>s and stuff, you can parse string representations of lambda terms to HOAS \u2014 that's not harder than printing HOAS terms.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 2, "accepted_answer_id": 33221105, "answer_count": 1, "score": 8, "last_activity_date": 1445296098, "creation_date": 1445273530, "last_edit_date": 1445273940, "question_id": 33219820, "link": "https://stackoverflow.com/questions/33219820/is-it-possible-to-infer-the-normalized-source-of-a-pure-%ce%bb-function-on-haskell", "title": "Is it possible to infer the normalized source of a pure \u03bb function on Haskell?", "body": "<p>Let a pure \u03bb function be a term with nothing but abstractions and applications. On JavaScript, it is possible to infer the source code of a pure function by applying all abstractions to variadic functions that collect their argument list. That is, this is possible:</p>\n\n<pre><code>lambdaSource(function(x){return x(x)}) == \"\u03bbx.(x x)\"\n</code></pre>\n\n<p>See the code for <a href=\"https://gist.github.com/MaiaVictor/1f0afbdb0ef173620c95\">lambdaSource</a> on this gist. That function became particularly useful for my interests since it allows me to use existing JS engines to normalize untyped lambda calculus expressions much faster than any naive evaluator I could code by myself. Moreover, I know \u03bb-calculus functions can be expressed in Haskell with help of <code>unsafeCoerce</code>:</p>\n\n<pre><code>(let (#) = unsafeCoerce in (\\ f x -&gt; (f # (f # (f # x)))))\n</code></pre>\n\n<p>I do not know how to implement <code>lambdaSource</code> in Haskell because of the lack of variadic functions. Is it possible to infer the normalized source of a pure \u03bb function on Haskell, such that:</p>\n\n<pre><code>lambdaSource (\\ f x -&gt; f # (f # (f # x))) == \"\u03bb f x . f (f (f x))\"\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1445288914, "creation_date": 1445288914, "answer_id": 33223960, "question_id": 33217911, "link": "https://stackoverflow.com/questions/33217911/stack-how-can-i-use-a-multi-package-dependency-in-setup-hs/33223960#33223960", "title": "Stack: How can I use a multi-package dependency in `Setup.hs`?", "body": "<p>I don't think it is possible to declare package dependencies for Setup.hs itself.</p>\n\n<p>Some ideas:</p>\n\n<ul>\n<li><p>Require that the dependent packages have already been installed.</p></li>\n<li><p>Have <code>Setup.hs</code> shell out to an external command to perform the zipping, and just require that the external command has to exist.</p></li>\n<li><p>Make the installer program an additional exe target in the cabal file. Before proceeding with the build of the library, Setup.hs can build the installer program target, then build the library, then use the built installer exe to install the library.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 5, "last_activity_date": 1445311078, "creation_date": 1445311078, "answer_id": 33227388, "question_id": 33217911, "link": "https://stackoverflow.com/questions/33217911/stack-how-can-i-use-a-multi-package-dependency-in-setup-hs/33227388#33227388", "title": "Stack: How can I use a multi-package dependency in `Setup.hs`?", "body": "<p>It looks like you need to set the <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/yaml_configuration.md#explicit-setup-deps\" rel=\"noreferrer\">explicit-setup-deps</a> setting to true for that package. It's unfortunate that Stack can't handle this situation automatically, but without dependency information in .cabal files, there seems to be no alternative.</p>\n\n<p>See the linked issues from the documentation if you're interested in the history here.</p>\n"}], "owner": {"reputation": 538, "user_id": 500511, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/99duf.png?s=128&g=1", "display_name": "helpwithhaskell", "link": "https://stackoverflow.com/users/500511/helpwithhaskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "accepted_answer_id": 33227388, "answer_count": 2, "score": 5, "last_activity_date": 1445311078, "creation_date": 1445267350, "last_edit_date": 1445308745, "question_id": 33217911, "link": "https://stackoverflow.com/questions/33217911/stack-how-can-i-use-a-multi-package-dependency-in-setup-hs", "title": "Stack: How can I use a multi-package dependency in `Setup.hs`?", "body": "<p>I have a <code>stack</code> multi-package project where the \"multi-package\" is <code>zip-conduit-0.2.2.2</code> (I needed to tweak some dependency versions to get it to compile with <code>nightly-2015-10-12</code>).</p>\n\n<p>I use <code>zip-conduit</code> in the main package and I also want to in <code>Setup.hs</code> in order to be able to package up zip files.</p>\n\n<p>I have <code>build-type: Custom</code> in my cabal file and <code>stack build</code> attempts to build <code>Setup.hs</code>. The problem is that building <code>Setup.hs</code> cannot find the dependency <code>zip-conduit-0.2.2.2</code>.</p>\n\n<p>Can I use a multi-package dependency in <code>Setup.hs</code>? If so how? and if not, what is my alternative?</p>\n\n<p>Note: I have seen this reference <a href=\"https://github.com/commercialhaskell/stack/pull/899\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/pull/899</a>, but I don't understand it. </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445269858, "post_id": 33217519, "comment_id": 54241809, "body": "This question doesn&#39;t have enough concrete details to get good answers. What exactly are you trying to <i>do</i> with this type?"}], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1445266519, "post_id": 33217563, "comment_id": 54239449, "body": "When I do that it gives the error, Expecting one more argument to &#39;ListTup&#39;"}, {"owner": {"reputation": 874, "user_id": 3842022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d9729ff4035657e7d6366611c28614?s=128&d=identicon&r=PG&f=1", "display_name": "C. Quilley", "link": "https://stackoverflow.com/users/3842022/c-quilley"}, "reply_to_user": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 1, "creation_date": 1445267167, "post_id": 33217563, "comment_id": 54239924, "body": "@NeoStreets What are you trying to do? I can copy and paste that code into my GHCi without complaint."}, {"owner": {"reputation": 874, "user_id": 3842022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d9729ff4035657e7d6366611c28614?s=128&d=identicon&r=PG&f=1", "display_name": "C. Quilley", "link": "https://stackoverflow.com/users/3842022/c-quilley"}, "reply_to_user": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 2, "creation_date": 1445267273, "post_id": 33217563, "comment_id": 54239995, "body": "@NeoStreets You should remember to provide the variable when using it, so a function that was <code>f :: ListTup -&gt; Int</code> (for example) now becomes <code>f :: ListTup Char -&gt; Int</code>."}], "tags": [], "owner": {"reputation": 874, "user_id": 3842022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d9729ff4035657e7d6366611c28614?s=128&d=identicon&r=PG&f=1", "display_name": "C. Quilley", "link": "https://stackoverflow.com/users/3842022/c-quilley"}, "is_accepted": false, "score": 8, "last_activity_date": 1445266347, "creation_date": 1445266347, "answer_id": 33217563, "question_id": 33217519, "link": "https://stackoverflow.com/questions/33217519/making-a-type-polymorphic/33217563#33217563", "title": "Making a type polymorphic", "body": "<p>You can include type variables when defining type synonyms, like so:</p>\n\n<p><code>type ListTup a = [(a, String)]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1587, "user_id": 3271946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/446c713f3dc5528707d32819146a9789?s=128&d=identicon&r=PG&f=1", "display_name": "ArunasR", "link": "https://stackoverflow.com/users/3271946/arunasr"}, "is_accepted": false, "score": 0, "last_activity_date": 1445342308, "creation_date": 1445342308, "answer_id": 33236057, "question_id": 33217519, "link": "https://stackoverflow.com/questions/33217519/making-a-type-polymorphic/33236057#33236057", "title": "Making a type polymorphic", "body": "<p>It depends on what you want to do. If you want different lists each of which will have the same type in the tuple's first element, you can parametrise the type constructor, like C.Quilley suggested above.</p>\n\n<p>If you want each of your lists to be able to have different types, you can box all required types in an algebraic type (discriminated union):</p>\n\n<pre><code>data MyKey = MyCharKey Char | MyStringKey String | MyIntKey Int\ntype ListTup = [(MyKey, String)]\n</code></pre>\n\n<p>You cannot have \"whatever\", because the types need to be decidable at compilation time.</p>\n"}], "owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1445342308, "creation_date": 1445266232, "last_edit_date": 1445269876, "question_id": 33217519, "link": "https://stackoverflow.com/questions/33217519/making-a-type-polymorphic", "title": "Making a type polymorphic", "body": "<p>So i'm defining a type which a list of tuples basically and I can't work out how to make it polymorphic.\nso far i've got</p>\n\n<pre><code>module ListTup where\ntype ListTup = [(Char, String)]\n</code></pre>\n\n<p>and I was wondering if it was possible to make it so that the Char part could be anything e.i String, int what ever.\nIs it possible?\nI tried to use the Maybe Type but it throw a ton of errors my way</p>\n"}, {"tags": ["regex", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445271022, "post_id": 33218801, "comment_id": 54242547, "body": "A callback allows you to make the replacement text a function of what was matched."}, {"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1445271862, "post_id": 33218801, "comment_id": 54243077, "body": "The <code>(String -&gt; String)</code> part of the function signature is the callback. This is a function that takes the match and returns the replacement. Another viable callback function might be <code>(RegexMatch -&gt; String)</code> where <code>RegexMatch</code> is the type representing the matched string."}, {"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1445275147, "post_id": 33218801, "comment_id": 54244911, "body": "<code>subRegex</code> is very close to what I want. Instead of a constant <code>String</code> as the replacement value, I want to be able to compute the replacement value as a function of the matched value. I&#39;ll also need it to access some outside state (hence the &quot;Update&quot; to my original question)."}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": false, "score": 0, "last_activity_date": 1445269922, "creation_date": 1445269922, "answer_id": 33218801, "question_id": 33217343, "link": "https://stackoverflow.com/questions/33217343/regular-expression-replace-with-callback/33218801#33218801", "title": "Regular expression replace with callback", "body": "<p>You have <a href=\"https://hackage.haskell.org/package/regex-compat-0.95.1\" rel=\"nofollow\" title=\"regex-compat\">Text.Regex</a>, which contains <code>subRegex</code>. I'm not sure what a callback is in PHP, but I don't think you can translate that into Haskell directly.</p>\n"}, {"comments": [{"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1445275084, "post_id": 33219868, "comment_id": 54244877, "body": "I don&#39;t see any replacement or substitution functions in this library."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 1, "creation_date": 1445276145, "post_id": 33219868, "comment_id": 54245393, "body": "@RichardCook, those aren&#39;t needed! The <code>Applicative</code> instance gives you all the power you need."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1445277073, "post_id": 33219868, "comment_id": 54245897, "body": "@RichardCook <code>match</code> <i>is</i> the replacement and substitution function."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 1, "creation_date": 1445281783, "post_id": 33219868, "comment_id": 54248567, "body": "@RichardCook I have amended my answer to discuss the use of <code>IO</code> during replacement."}, {"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1445622743, "post_id": 33219868, "comment_id": 54415942, "body": "@DanielWagner: I&#39;ve updated the original question with an implementation based on regex-applicative. Thanks!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1445281737, "last_edit_date": 1445281737, "creation_date": 1445273672, "answer_id": 33219868, "question_id": 33217343, "link": "https://stackoverflow.com/questions/33217343/regular-expression-replace-with-callback/33219868#33219868", "title": "Regular expression replace with callback", "body": "<p>You may like <a href=\"http://hackage.haskell.org/package/regex-applicative\" rel=\"nofollow\">regex-applicative</a>, which offers:</p>\n\n<pre><code>match :: RE Char String -&gt; String -&gt; Maybe String\n</code></pre>\n\n<p>You can replace specific parts of the match in the code that builds the value of type <code>RE Char String</code>. For example, here is a function which finds a string of <code>a</code> and <code>b</code> characters and reverses them:</p>\n\n<pre><code>import Text.Regex.Applicative\nasAndBs   = many (psym (   `elem` \"ab\"))\nnoAsAndBs = many (psym (`notElem` \"ab\"))\ntransformation = concat &lt;$&gt; sequenceA [noAsAndBs, reverse &lt;$&gt; asAndBs, noAsAndBs]\n</code></pre>\n\n<p>Some example runs in ghci:</p>\n\n<pre><code>&gt; match transformation \"ntoheuuaaababbboenuth\"\nJust \"ntoheuubbbabaaaoenuth\"\n&gt; match transformation \"aoesnuthaosneut\"\nNothing\n</code></pre>\n\n<p>To handle your updated question: here is a transformation which looks for a string of <code>a</code> and <code>b</code> characters and asks the user what to replace them with. It reuses <code>asAndBs</code> and <code>noAsAndBs</code> from before, only modifying the transformation applied to them. I also include an example driver of <code>queryTransform</code> just to show how it might be used. The basic idea is to build up, rather than a flat replacement string, an <code>IO</code> action which produces the replacement string. It is then the job of the consumer who calls <code>match</code> to execute that <code>IO</code> action as appropriate.</p>\n\n<pre><code>import Data.Functor.Compose\nqueryTransform = getCompose . (concat &lt;$&gt;) . sequenceA . map Compose $\n    [ pure &lt;$&gt; noAsAndBs\n    , getLine &lt;$ asAndBs\n    , pure &lt;$&gt; noAsAndBs\n    ]\nrunQueryTransform = getLine &gt;&gt;= sequenceA . match queryTransform\n</code></pre>\n\n<p>I hope you recognize the parallels between the <code>queryTransform</code> structure and the <code>transformation</code> structure from before (in particular note that the <code>(concat &lt;$&gt;) . sequenceA</code> construct is just like before). Here's some examples in ghci:</p>\n\n<pre><code>&gt; runQueryTransform\noeunthaaabbbaboenuth\nreplacement\nJust \"oeunthreplacementoenuth\"\n&gt; runQueryTransform\naoeunthaoeunth\nNothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 0, "last_activity_date": 1567779091, "creation_date": 1567779091, "answer_id": 57823698, "question_id": 33217343, "link": "https://stackoverflow.com/questions/33217343/regular-expression-replace-with-callback/57823698#57823698", "title": "Regular expression replace with callback", "body": "<p>If you want to perform search and replace in Haskell, then consider\npattern matching with\n<a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\"><code>megaparsec</code></a>\nparsers instead of regular expressions. With that\nyou can use\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:streamEdit\" rel=\"nofollow noreferrer\"><code>streamEdit</code></a>,\nwhich has exactly the signature of your mythical <code>regexReplace</code> function, or\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:streamEditT\" rel=\"nofollow noreferrer\"><code>streamEditT</code></a>, which allows the callback to be run inside <code>IO</code>.</p>\n\n<p>Here is a parser variant of your elegant <code>regex-applicative</code> solution which doesn't\nrequire the <code>queryTransform</code> or <code>runQueryTransform</code> functions.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>:set -XRecordWildCards\n:set -XTypeFamilies\nimport Replace.Megaparsec\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport System.Environment\nimport Data.Char\nimport Data.Maybe\n\ndata EnvMatch = EnvMatch\n    { envMatchName    :: String\n    , envMatchDefault :: String\n    }\n\n-- Matches pattern \"_env:SOME_NAME:SOME_DEFAULT_VALUE\"\nenvPattern = EnvMatch\n    &lt;$ string \"_env:\"\n    &lt;*&gt; tokes\n    &lt;* string \":\"\n    &lt;*&gt; tokes\n  where\n    tokes = many $ satisfy (\\c -&gt; isAlphaNum c || c == '_')\n\nexpandEnv :: EnvMatch -&gt; IO String\nexpandEnv EnvMatch{..} = fmap (fromMaybe envMatchDefault) (lookupEnv envMatchName)\n\nstreamEditT envPattern expandEnv \"hello\\\"_env:HOME:default_home_dir\\\"world\"\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\"hello\\\"/home/user\\\"world\"\n</code></pre>\n"}], "owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1013, "favorite_count": 1, "accepted_answer_id": 33219868, "answer_count": 3, "score": 2, "last_activity_date": 1567779091, "creation_date": 1445265722, "last_edit_date": 1445622553, "question_id": 33217343, "link": "https://stackoverflow.com/questions/33217343/regular-expression-replace-with-callback", "title": "Regular expression replace with callback", "body": "<p>I would like to perform string search and replace with regular expressions but have been unable to find a function that does what I need. I'm looking for something similar to my mythical <code>regexReplace</code> whose potential signatures I give below:</p>\n\n<pre><code>regexReplace :: Regex -&gt; (String -&gt; String) -&gt; String -&gt; String\n</code></pre>\n\n<p>or</p>\n\n<pre><code>regexReplace :: Regex -&gt; (RegexMatch -&gt; String) -&gt; String -&gt; String\n</code></pre>\n\n<p>This is roughly equivalent to <code>preg_replace_callback</code> in PHP. It takes a compiled regular expression represented by <code>Regex</code>, a replacement function (whose parameter would either be <code>String</code> or some match type <code>RegexMatch</code>), a source string and returns the result.</p>\n\n<p>What would be the closest match to this behaviour among the many Haskell regular expression libraries that are out there?</p>\n\n<p>Update:</p>\n\n<p>I may need the callback to run inside <code>IO</code>, so I may end up needing the following function signature:</p>\n\n<pre><code>regexReplace :: Monad m =&gt; Regex -&gt; (RegexMatch -&gt; m String) -&gt; String -&gt; m String\n</code></pre>\n\n<p>This is obviously turning into a far more general problem than the original problem statement. I may end up using Parsec or similar.</p>\n\n<p>Basically, I have the following program and haven't been able to figure out how to fill in the blank:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n\nmodule Main where\n\nimport Data.Maybe\nimport System.Environment\n\ndata Regex = Regex {\n  regexPattern :: String\n}\ndata RegexMatch = RegexMatch {\n  regexGroups :: [String]\n}\n\nregexReplace :: Monad m =&gt; Regex -&gt; (RegexMatch -&gt; m String) -&gt; String -&gt; m String\nregexReplace Regex{..} f source =\n  -- What do I put here?\n  undefined\n\nreplacementValue :: [String] -&gt; IO String\nreplacementValue groups =\n  case groups of\n    whole : name : defaultValue : [] -&gt; do\n      lookupResult &lt;- lookupEnv name\n      let value = fromMaybe defaultValue lookupResult\n      return value\n    otherwise -&gt; error \"Unexpected groups\"\n\nmain :: IO ()\nmain = do\n  replaceResult &lt;- regexReplace\n    (Regex \"ENV:([A-Za-z_][A-Za-z_0-9]*):([A-Za-z_][A-Za-z_0-9]*)\")\n    (\\RegexMatch{..} -&gt; replacementValue regexGroups)\n    \"some input containing ENV:foo:bar replacement expressions\"\n  putStrLn replaceResult\n</code></pre>\n\n<p>Conclusion:</p>\n\n<p>Using <code>regex-applicative</code> as suggested by @DanielWagner, I came up with the solution below which is quite elegant:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n\nmodule Main (main) where\n\nimport Data.Char\nimport Data.Functor.Compose\nimport Data.Maybe\nimport System.Environment\nimport Text.Regex.Applicative\n\ndata EnvMatch = EnvMatch {\n    envMatchName :: String\n  , envMatchDefault :: String\n}\n\n-- Matches pattern \"_env:SOME_NAME:SOME_DEFAULT_VALUE\"\nenvPattern :: RE Char EnvMatch\nenvPattern = EnvMatch\n    &lt;$ string \"_env:\"\n    &lt;*&gt; token\n    &lt;* string \":\"\n    &lt;*&gt; token\n    where\n        token :: RE Char String\n        token = many (psym $ \\c -&gt; isAlphaNum c || c == '_')\n\nexpandEnv :: EnvMatch -&gt; IO String\nexpandEnv EnvMatch{..} = fmap (fromMaybe envMatchDefault) (lookupEnv envMatchName)\n\nqueryTransform :: RE Char (IO String)\nqueryTransform = getCompose . (concat &lt;$&gt;) . sequenceA . map Compose $\n    [\n        pure &lt;$&gt; many anySym\n      , expandEnv &lt;$&gt; envPattern\n      , pure &lt;$&gt; many anySym\n    ]\n\nrunQueryTransform :: String -&gt; IO (Maybe String)\nrunQueryTransform = sequenceA . match queryTransform\n\nmain :: IO ()\nmain = do\n  result &lt;- runQueryTransform \"hello\\\"_env:HOME:default_home_dir\\\"world\"\n  print result\n  -- Yields: Just \"hello\\\"/home/user\\\"world\"\n</code></pre>\n\n<p>Thanks, @DanielWagner!</p>\n"}, {"tags": ["haskell", "vim", "cabal", "ghc-mod"], "comments": [{"owner": {"reputation": 5271, "user_id": 1658042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e79284efb4639584574a5fc46c9e4?s=128&d=identicon&r=PG", "display_name": "lcd047", "link": "https://stackoverflow.com/users/1658042/lcd047"}, "edited": false, "score": 5, "creation_date": 1445266803, "post_id": 33217217, "comment_id": 54239650, "body": "Because <code>ghc-mod</code> 5.4.0 insists to be <a href=\"https://hackage.haskell.org/package/ghc-mod-5.4.0.0/changelog\" rel=\"nofollow noreferrer\">run from the project&#39;s root directory</a>.  It isn&#39;t that it doesn&#39;t know how to find the root directory and <code>chdir()</code> to it: it specifically wants you to do it beforehand.  Some day, <code>ghc-mod</code> authors might begin to grasp the concept of backwards compatibility, and why some people make such a big fuss about it.  That day seem pretty far away for now."}, {"owner": {"reputation": 5271, "user_id": 1658042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e79284efb4639584574a5fc46c9e4?s=128&d=identicon&r=PG", "display_name": "lcd047", "link": "https://stackoverflow.com/users/1658042/lcd047"}, "edited": false, "score": 1, "creation_date": 1445267239, "post_id": 33217217, "comment_id": 54239973, "body": "Upgrading <code>neco-ghc</code> <a href=\"https://github.com/eagletmt/neco-ghc/pull/56\" rel=\"nofollow noreferrer\">should help</a>."}, {"owner": {"reputation": 1719, "user_id": 4523477, "user_type": "registered", "accept_rate": 84, "profile_image": "https://lh4.googleusercontent.com/-w3FDa9MFDfo/AAAAAAAAAAI/AAAAAAAACKM/6aLKRIznz1w/photo.jpg?sz=128", "display_name": "June", "link": "https://stackoverflow.com/users/4523477/june"}, "reply_to_user": {"reputation": 5271, "user_id": 1658042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e79284efb4639584574a5fc46c9e4?s=128&d=identicon&r=PG", "display_name": "lcd047", "link": "https://stackoverflow.com/users/1658042/lcd047"}, "edited": false, "score": 0, "creation_date": 1445267646, "post_id": 33217217, "comment_id": 54240256, "body": "@lcd047 Jesus you are my life saver! Why don&#39;t you leave those comments as an answer so that I can accept it?"}], "answers": [{"tags": [], "owner": {"reputation": 5271, "user_id": 1658042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e79284efb4639584574a5fc46c9e4?s=128&d=identicon&r=PG", "display_name": "lcd047", "link": "https://stackoverflow.com/users/1658042/lcd047"}, "is_accepted": true, "score": 4, "last_activity_date": 1445268017, "creation_date": 1445268017, "answer_id": 33218146, "question_id": 33217217, "link": "https://stackoverflow.com/questions/33217217/why-does-ghc-mod-powered-neco-ghc-only-works-on-project-root-directory/33218146#33218146", "title": "why does ghc-mod powered neco-ghc only works on project root directory?", "body": "<p>Posting an answer as requested: <code>ghc-mod</code> 5.4.0 insists to be <a href=\"https://hackage.haskell.org/package/ghc-mod-5.4.0.0/changelog\" rel=\"nofollow\">run from the project's root directory</a>.  This breaks various third-party programs that depend on <code>ghc-mod</code>.  The <code>neco-ghc</code> plugin has been <a href=\"https://github.com/eagletmt/neco-ghc/pull/56\" rel=\"nofollow\">updated</a> to cope with that, other programs are <a href=\"https://github.com/scrooloose/syntastic/issues/1576\" rel=\"nofollow\">dropping support for <code>ghc-mod</code></a>.</p>\n"}], "owner": {"reputation": 1719, "user_id": 4523477, "user_type": "registered", "accept_rate": 84, "profile_image": "https://lh4.googleusercontent.com/-w3FDa9MFDfo/AAAAAAAAAAI/AAAAAAAACKM/6aLKRIznz1w/photo.jpg?sz=128", "display_name": "June", "link": "https://stackoverflow.com/users/4523477/june"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 911, "favorite_count": 1, "accepted_answer_id": 33218146, "answer_count": 1, "score": 1, "last_activity_date": 1445268017, "creation_date": 1445265359, "last_edit_date": 1445265660, "question_id": 33217217, "link": "https://stackoverflow.com/questions/33217217/why-does-ghc-mod-powered-neco-ghc-only-works-on-project-root-directory", "title": "why does ghc-mod powered neco-ghc only works on project root directory?", "body": "<p>I'm new to haskell so I don't have deep understanding about how <code>ghc-mod</code> works and how <code>cabal-install</code>-like build tools of haskell worlds move under the hood.</p>\n\n<p>But I somehow found vim haskell plugins from github, including <a href=\"https://github.com/eagletmt/neco-ghc\" rel=\"nofollow\">neco-ghc</a> auto completion plugin powered by <code>ghc-mod</code> which seemed very attractive to me.</p>\n\n<p>The problem was that it only works on project-level haskell source codes of <code>cabal-install</code> initialized projects while it doesn't work at all on <code>stack</code>-initialized projects.</p>\n\n<p>My directory structure is generated by following commands:</p>\n\n<pre><code>~ $ mkdir my_project &amp;&amp; cd my_project\n~/my_project $ cabal init\n~/my_project $ cabal sandbox init\n</code></pre>\n\n<p>which yields</p>\n\n<pre><code>my_project  \n|-- Setup.hs  \n|-- cabal.sandbox.config  \n|-- src / Lib.hs\n</code></pre>\n\n<p>Autocompletion works (it suggests Prelude module's keywords) when I edit <code>Setup.hs</code> but I suggests nothing when I try edit <code>src/Lib.hs</code>.</p>\n\n<p>My <code>:NecoGhcDiagnotics</code> command outputs</p>\n\n<pre><code>Current filetype: haskell                                                                                                                                                                                                    \nghc-mod is executable: 1                                                                                                                                                                                                     \nomnifunc: necoghc#omnifunc                                                                                                                                                                                                   \nneocomplete.vim: 0                                                                                                                                                                                                           \nneocomplcache.vim: 2                                                                                                                                                                                                         \nYouCompleteMe: 0                                                                                                                                                                                                             \nvimproc.vim: 900                                                                                                                                                                                                             \nghc-mod: 5.4.0.0                                                                                                                                                                                                             \nImported modules: Prelude                                                                                                                                                                                                    \nNumber of symbols in Prelude: 0     \n</code></pre>\n\n<p>when I edit <code>src/Lib.hs</code> while</p>\n\n<pre><code>Current filetype: haskell                                                                                                                                                                                                    \nghc-mod is executable: 1                                                                                                                                                                                                     \nomnifunc: necoghc#omnifunc                                                                                                                                                                                                   \nneocomplete.vim: 0                                                                                                                                                                                                           \nneocomplcache.vim: 2                                                                                                                                                                                                         \nYouCompleteMe: 0                                                                                                                                                                                                             \nvimproc.vim: 900                                                                                                                                                                                                             \nghc-mod: 5.4.0.0                                                                                                                                                                                                             \nImported modules: Distribution.Simple, Prelude                                                                                                                                                                               \nNumber of symbols in Prelude: 235   \n</code></pre>\n\n<p>is the output of the command when I'm editing <code>Setup.hs</code>.</p>\n\n<p>It clearly looks like <code>ghc-mod</code> is not detecting any symbols when I'm editing <code>src/Lib.hs</code>.. why is this happening?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1445263285, "post_id": 33216402, "comment_id": 54236827, "body": "Any problem with <code>myOtherFunction = undefined</code> or just commenting it out?"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1445263494, "post_id": 33216402, "comment_id": 54236979, "body": "If you are in the middle of a big modification and have too many functions with already much code, that is unworkable"}, {"owner": {"reputation": 579, "user_id": 1073250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7663625d6f418e806571f558ba5b73cf?s=128&d=identicon&r=PG", "display_name": "lortabac", "link": "https://stackoverflow.com/users/1073250/lortabac"}, "edited": false, "score": 7, "creation_date": 1445264120, "post_id": 33216402, "comment_id": 54237447, "body": "Is <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/defer-type-errors.html\" rel=\"nofollow noreferrer\">this</a> useful?"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 579, "user_id": 1073250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7663625d6f418e806571f558ba5b73cf?s=128&d=identicon&r=PG", "display_name": "lortabac", "link": "https://stackoverflow.com/users/1073250/lortabac"}, "edited": false, "score": 0, "creation_date": 1445268550, "post_id": 33216402, "comment_id": 54240871, "body": "@lortabac Yep, that is very useful! Is there any way to configure GHCi to launch with the flag <code>-fdefer-type-errors</code> turned on by default?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445274775, "post_id": 33216402, "comment_id": 54244703, "body": "@mljrg You can add a line containing <code>:set -fdefer-type-errors</code> to <code>~&#47;.ghci</code> (or to a project-specific <code>.ghci</code> if that&#39;s preferred)."}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "closed_date": 1445274728, "answer_count": 0, "score": 3, "last_activity_date": 1445263093, "creation_date": 1445263093, "question_id": 33216402, "link": "https://stackoverflow.com/questions/33216402/make-ghci-load-a-source-file-in-any-state-and-just-throw-errors-at-runtime", "closed_reason": "Duplicate", "title": "Make GHCi load a source file in any state, and just throw errors at runtime", "body": "<p>When I am modifying an Haskell file, I find myself many times wanting to test a function that I finished, while others are yet to be completed or broken. </p>\n\n<p>However, when I try to load in GHCi, it forces me to fix the other functions too, and this is too much annoying.</p>\n\n<p>How can I tell GHCi to load any file, and just throw errors at runtime?</p>\n\n<p>What I would like is a way to ajdust the \"rigidity\" of error checking.</p>\n\n<p>This would be very useful for interative development.</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "shuffle", "sample", "random-sample"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 6, "creation_date": 1445261839, "post_id": 33215411, "comment_id": 54235698, "body": "It depends. AFAIK the Haskell standard doesn&#39;t prescribe any specific shuffle or sampling algorithm, so it completely depends on the implementation.  In any case lazyness does <b>not</b> mean that the computer will do as few computations as possible to produce the output. It simply means that it avoids &quot;obviously useless computations&quot; for the given output. In other words <code>head $ shuffle something</code> may well do some operation used to shuffle elements other than the first, depending on the implementation. Lazyness simply tells you that when the first element is produced other steps are avoided."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445262700, "post_id": 33215411, "comment_id": 54236351, "body": "maybe you can have a look and tell us [which <code>shuffle</code>](hayoo.fh-wedel.de/?query=shuffle) you want to use ;)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1445274525, "post_id": 33215411, "comment_id": 54244552, "body": "It can be written to behave that way, using the decorate-sort-undecorate pattern: first label each element in your list with a random number; sort by the labels; throw away the labels; and take the first element. The standard implementation of <code>sort</code> will make this an O(n) operation, just like sampling would be. Not sure if there are any packages that offer this out of the box, and of course the manually written version of the algorithm may have better constants."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1458456803, "post_id": 33215411, "comment_id": 59863543, "body": "@DanielWagner you should make that comment an answer :-)"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1459240023, "post_id": 33215411, "comment_id": 60184496, "body": "@DanielWagner: I&#39;ve added your answer as Community Wiki"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1459240002, "creation_date": 1459240002, "answer_id": 36279095, "question_id": 33215411, "link": "https://stackoverflow.com/questions/33215411/shuffle-and-take-first-vs-sampling-in-haskell/36279095#36279095", "title": "shuffle and take first vs sampling in haskell", "body": "<p>It can be written to behave that way, using the <em>decorate-sort-undecorate</em> pattern: first label each element in your list with a random number; sort by the labels; throw away the labels; and take the first element. The standard implementation of <code>sort</code> will make this an <em>O(n)</em> operation, just like sampling would be. Not sure if there are any packages that offer this out of the box, and of course the manually written version of the algorithm may have better constants.</p>\n"}], "owner": {"reputation": 1497, "user_id": 2148851, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b7558f5365a89314a0d569edba74dbcc?s=128&d=identicon&r=PG&f=1", "display_name": "k4vin", "link": "https://stackoverflow.com/users/2148851/k4vin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1459240002, "creation_date": 1445260495, "last_edit_date": 1445261072, "question_id": 33215411, "link": "https://stackoverflow.com/questions/33215411/shuffle-and-take-first-vs-sampling-in-haskell", "title": "shuffle and take first vs sampling in haskell", "body": "<p>In Ruby Programming language <code>myList.shuffle.first</code> is slower than <code>myList.sample</code> since it completely shuffle the list and pick the first element. If something similar (shuffle and take first) is done in Haskell, will that be as fast as the later (sampling the array)? I am assuming that the list will be shuffled lazily so picking the first element or taking the sample will be virtually same.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445264908, "post_id": 33214163, "comment_id": 54238129, "body": "Can you show your partial solution? I coded up something at <a href=\"http://lpaste.net/143362\" rel=\"nofollow noreferrer\">lpaste.net/143362</a> which doesn&#39;t do chaining or repeated prefixes - it just tries to get the priorities right."}, {"owner": {"reputation": 1583, "user_id": 2274140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1f23d1e4442f8de475f1eec047515a84?s=128&d=identicon&r=PG", "display_name": "BartBog", "link": "https://stackoverflow.com/users/2274140/bartbog"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445265159, "post_id": 33214163, "comment_id": 54238319, "body": "I have two partial solutions acutally. One of them looks a lot like your coding and ignores the repeated prefixes. The other does the chaining, but gets the priorities wrong. (they are on their way)"}, {"owner": {"reputation": 1583, "user_id": 2274140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1f23d1e4442f8de475f1eec047515a84?s=128&d=identicon&r=PG", "display_name": "BartBog", "link": "https://stackoverflow.com/users/2274140/bartbog"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445265464, "post_id": 33214163, "comment_id": 54238589, "body": "I added the partial solutions. To be precise, I recuperated one of yours and started from that one to get the other..."}], "answers": [{"comments": [{"owner": {"reputation": 1583, "user_id": 2274140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1f23d1e4442f8de475f1eec047515a84?s=128&d=identicon&r=PG", "display_name": "BartBog", "link": "https://stackoverflow.com/users/2274140/bartbog"}, "edited": false, "score": 0, "creation_date": 1445342813, "post_id": 33217888, "comment_id": 54275321, "body": "Thanks a lot for the effort. However, there are still two problems with this solution:  1. It does not parse expressions of the form <code>! ~ ! a</code>  2. It parses <code>~ a &amp; b</code> wrong (parses it as <code>~ (a &amp; b)</code> instead of <code>(~a) &amp; b</code>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1445267262, "creation_date": 1445267262, "answer_id": 33217888, "question_id": 33214163, "link": "https://stackoverflow.com/questions/33214163/parsec-expr-repeated-prefix-with-different-priority/33217888#33217888", "title": "Parsec.Expr repeated Prefix with different priority", "body": "<p>One problem with my partial solution at <a href=\"http://lpaste.net/143362\" rel=\"nofollow\">http://lpaste.net/143362</a> is that it doesn't recognize <code>~ ! a</code>.</p>\n\n<p>However, if you change the operator table to:</p>\n\n<pre><code>table   = [ [ Prefix tilde ]\n          , [ Infix amper AssocLeft ]\n          , [ Prefix bang ]\n          , [ Prefix tilde ]\n          ]\n</code></pre>\n\n<p>it can parse that expression as well as <code>! ~a &amp; b</code>, <code>~ ! a &amp; b</code> correctly. Code at: <a href=\"http://lpaste.net/143370\" rel=\"nofollow\">http://lpaste.net/143370</a></p>\n\n<p>So now combine this idea with your chaining and try:</p>\n\n<pre><code>table   = [ [ Prefix (chained tilde) ]\n          , [ Infix amper AssocLeft ]\n          , [ Prefix (chained bang) ]\n          , [ Prefix (chained tilde) ]\n          ]\n\nchained  p = chainl1 p $ return (.)\n</code></pre>\n\n<p>Code at: <a href=\"http://lpaste.net/143371\" rel=\"nofollow\">http://lpaste.net/143371</a></p>\n"}, {"comments": [{"owner": {"reputation": 1583, "user_id": 2274140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1f23d1e4442f8de475f1eec047515a84?s=128&d=identicon&r=PG", "display_name": "BartBog", "link": "https://stackoverflow.com/users/2274140/bartbog"}, "edited": false, "score": 0, "creation_date": 1445412805, "post_id": 33244887, "comment_id": 54308383, "body": "Thanks a lot. This is a very useful answer. This solution parses things as I wish. I notice that you&#39;re now basically doing all the parsing manually (no longer using BuildExpressionParser). I will still have to see whether I can integrate this in my actual example (which is a lot more complicated, with many more binary and unary operators -&gt; this is the reason why I was trying to avoid building an expression parser myself)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1583, "user_id": 2274140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1f23d1e4442f8de475f1eec047515a84?s=128&d=identicon&r=PG", "display_name": "BartBog", "link": "https://stackoverflow.com/users/2274140/bartbog"}, "edited": false, "score": 0, "creation_date": 1445416144, "post_id": 33244887, "comment_id": 54310212, "body": "My feeling is that you can&#39;t use buildExpressionParser to do this. The parser it generates is very hierarchical and it doesn&#39;t perform any lookahead. For each precedence level it generates a parser where the terms are what the parser for the previous level recognizes and the operators are those for the current precedence level. Reading the code might be enlightening - it&#39;s actually a pretty simple idea: <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/src/Text-Parsec-Expr.html#buildExpressionParser\" rel=\"nofollow noreferrer\">(link)</a>. Any, good luck, and I&#39;d be interested to know what you come up with."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1445368005, "creation_date": 1445368005, "answer_id": 33244887, "question_id": 33214163, "link": "https://stackoverflow.com/questions/33214163/parsec-expr-repeated-prefix-with-different-priority/33244887#33244887", "title": "Parsec.Expr repeated Prefix with different priority", "body": "<p>A new answer...</p>\n\n<p>Have you thought of the associativity of the <strong>&amp;</strong> operator?</p>\n\n<p>Here is another idea I came up with assuming that <strong>&amp;</strong> is right associative.</p>\n\n<ol>\n<li>Collect the sequence of prefix operators preceding a term.</li>\n<li>Parse the term (either an ident or a paren expression)</li>\n<li>Fix up the term by shifting over <strong>~</strong> operators from the sequence collected in step 1.</li>\n<li>If the next token is an <strong>&amp;</strong>, the LHS of the amper operator is the fixed up term. The remaining operators are applied to amper expression.</li>\n<li>Otherwise the result is just the prefix operators applied to the term.</li>\n</ol>\n\n<p>I believe associativity of the <strong>&amp;</strong> matters, e.g. do we have:</p>\n\n<pre><code>a &amp; ! b &amp; c  --&gt;   a &amp; (! b &amp; c)  --&gt; a &amp; ! (b &amp; c)\n</code></pre>\n\n<p>or </p>\n\n<pre><code>a &amp; ! b &amp; c  --&gt;   (a &amp; (! b)) &amp; c\n</code></pre>\n\n<p>Another case to think about is <code>! a &amp; ! b &amp; c</code> - how do you want that parsed?</p>\n\n<p>An implementation:</p>\n\n<pre><code> {-# LANGUAGE NoMonomorphismRestriction, FlexibleContexts #-}\n\n import Text.Parsec\n import Control.Monad\n import Text.ParserCombinators.Parsec hiding (runParser, try)\n import Text.Parsec.Char\n\n data Sentence = Ident String | Bang Sentence | Tilde Sentence | Amper Sentence Sentence\n   deriving (Show)\n\n lexer p = do x &lt;- p; spaces; return x\n ident = lexer (many1 letter)\n sym ch  = lexer (char ch)\n\n tilde = sym '~'\n bang  = sym '!'\n amper = sym '&amp;'\n\n parens p = between (sym '(') (sym ')') p\n\n term    =  parens expr \n          &lt;|&gt; (fmap Ident ident)\n          &lt;?&gt; \"simple expression\"\n\n prefixOps = many (try tilde &lt;|&gt; bang)\n\n expr = do\n   ops &lt;- fmap reverse prefixOps\n   lhs &lt;- term\n\n   let (ops', lhs') = popTildes ops lhs\n       pre = mkPrefixNode ops'\n\n   mrhs &lt;- try (fmap Just (amper &gt;&gt; expr)) &lt;|&gt; (return Nothing)\n\n   case mrhs of\n     Nothing  -&gt; return $ pre lhs'\n     Just rhs -&gt; return $ pre (Amper lhs' rhs)\n\n popTildes :: [Char] -&gt; Sentence -&gt; ([Char], Sentence)\n popTildes ('~':rest) s = popTildes rest (Tilde s)\n popTildes ops s        = (ops, s)\n\n mkPrefixNode :: [Char] -&gt; (Sentence -&gt; Sentence)\n mkPrefixNode [] = id\n mkPrefixNode ('~':rest) = mkPrefixNode rest . Tilde\n mkPrefixNode ('!':rest) = mkPrefixNode rest . Bang \n mkPrefixNode _          = error \"can't happen\"\n\n check :: String -&gt; IO ()\n check input = do\n   let padded = input ++ (replicate (15-length input) ' ')\n   case parse expr \"-\" input of\n     Left e  -&gt; do putStrLn $ \"FAILED: \" ++ input\n                   putStrLn $ \"  \" ++ show e\n     Right x -&gt; do putStrLn $ \"OK: \" ++ padded ++ \" -&gt; \" ++ show x\n\n inputs = [ \"a\", \"! a\", \"~ a\", \"a &amp; b\", \"! a &amp; b\", \"~ a &amp; b\", \"! ~ a &amp; b\"\n          ,  \"~ ! a\", \"! ~a &amp; b\", \"~ ! a &amp; b \", \"! ~ ! a 2\"\n          ]\n\n main = mapM_ check inputs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1583, "user_id": 2274140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1f23d1e4442f8de475f1eec047515a84?s=128&d=identicon&r=PG", "display_name": "BartBog", "link": "https://stackoverflow.com/users/2274140/bartbog"}, "edited": false, "score": 0, "creation_date": 1446548135, "post_id": 33493961, "comment_id": 54778351, "body": "This really looks like what I was looking for.  Especially the buildExpressionParser method seems good."}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 2, "last_activity_date": 1446537672, "last_edit_date": 1446537672, "creation_date": 1446537269, "answer_id": 33493961, "question_id": 33214163, "link": "https://stackoverflow.com/questions/33214163/parsec-expr-repeated-prefix-with-different-priority/33493961#33493961", "title": "Parsec.Expr repeated Prefix with different priority", "body": "<p>The left-factored grammar for the parser you want is:</p>\n\n<pre><code>sentence : '!' sentence\n         | sentence1\n\nsentence1 : sentence2 '&amp;' sentence1\n          | sentence2\n\nsentence2 : '~' sentence2\n          | term\n\nterm : '!' sentence\n     | ident\n</code></pre>\n\n<p>Which can be rewritten in EBNF as:</p>\n\n<pre><code>sentence : '!'* sentence1\n\nsentence1 : sentence2 ('&amp;' sentence2)*\n\nsentence2 : '~'* term\n\nterm : '!' sentence\n     | ident\n</code></pre>\n\n<p>The parser generated by <code>buildExpressionParser</code> using chained prefix operators almost generates this parser, except that it doesn't include the <code>!</code> rule in the term parser; hence the parse error when a <code>!</code> is encountered after a <code>~</code>.  </p>\n\n<p>Given the following:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\nmodule Main where\n\nimport Control.Monad\nimport Text.Parsec\nimport Text.Parsec.Expr\nimport Text.Parsec.Char\nimport Control.Applicative ( (&lt;*), (*&gt;), (&lt;*&gt;), (&lt;$), (&lt;$&gt;) )\n\ndata Sentence = Tilde Sentence\n              | Bang Sentence\n              | Amper Sentence Sentence\n              | Ident String\n  deriving ( Eq, Ord, Show )\n\nbangP  = Bang  &lt;$ lexeme (char '!')\namperP = Amper &lt;$ lexeme (char '&amp;')\ntildeP = Tilde &lt;$ lexeme (char '~')\nidentP = Ident &lt;$&gt; lexeme (many1 alphaNum)\n\nlexeme = (&lt;* spaces)\n\nparser = spaces *&gt; sentence &lt;* eof\n\nmain = do\n  let inputs = [ \"a\", \"! a\", \"~ a\", \"a &amp; b\", \"! a &amp; b\"\n               , \"~ a &amp; b\", \"! ~ a &amp; b\", \"~ ! a &amp; b\", \"! ~ ! a\"\n               , \"~ a &amp; b\", \"a &amp; ! b &amp; c &amp; d\"\n               ]\n  forM_ inputs $ \\input -&gt; do\n    putStr input\n    putStr \" -&gt; \"\n    parseTest parser input\n</code></pre>\n\n<p>We can define the <code>sentence</code> parser by hand:</p>\n\n<pre><code>sentence = sentence0 where\n  sentence0 = chainl bangP (return (.)) id &lt;*&gt; sentence1\n  sentence1 = chainl1 sentence2 amperP\n  sentence2 = chainl tildeP (return (.)) id &lt;*&gt; term\n  term = (bangP &lt;*&gt; sentence0) &lt;|&gt; identP\n</code></pre>\n\n<p>or we can use <code>buildExpressionParser</code> if we add the <code>!</code> rule into the <code>term</code> parser:</p>\n\n<pre><code>sentence = buildExpressionParser table term where\n  table = [ [prefix tildeP]\n          , [Infix amperP AssocLeft]\n          , [prefix bangP]\n          ]\n  term = (bangP &lt;*&gt; sentence) &lt;|&gt; identP\n  prefix  p = Prefix . chainl1 p $ return (.)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1446823476, "post_id": 33534426, "comment_id": 54918111, "body": "Note that this does not (yet) detect the use of left and right associative operators at the same precedence, or handle non associative operators.  If your grammar does not include such operators then you should be good to go!"}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 4, "last_activity_date": 1446701854, "last_edit_date": 1446701854, "creation_date": 1446681819, "answer_id": 33534426, "question_id": 33214163, "link": "https://stackoverflow.com/questions/33214163/parsec-expr-repeated-prefix-with-different-priority/33534426#33534426", "title": "Parsec.Expr repeated Prefix with different priority", "body": "<p>I wasn't satisfied with my original answer since it doesn't solve the general case of prefix and postfix operators at various precedences, and it requires the programmer to have to think about the grammar instead of just relying on <code>buildExpressionParser</code> to do the right thing.</p>\n\n<p>I hunted around online and discovered the <a href=\"http://journal.stuffwithstuff.com/2011/03/19/pratt-parsers-expression-parsing-made-easy/\" rel=\"nofollow\">Pratt method for recursive descent parsing of expressions</a>.  I was able to implement a compact Haskell version that replaces <code>buildExpressionParser</code>.  It has exactly the same interface as <code>buildExpressionParser</code>, but doesn't require you to use the chained prefix combinators or muck around with the term parser.  I played around with your grammar, changing the associativity of <code>&amp;</code>, and switching the prefix operators to postfix operators, and it all seems to work...</p>\n\n<pre><code>buildPrattParser table termP = parser precs where\n\n  precs = reverse table\n\n  prefixP = choice prefixPs &lt;|&gt; termP where\n    prefixPs = do\n      precsR@(ops:_) &lt;- tails precs \n      Prefix opP &lt;- ops\n      return $ opP &lt;*&gt; parser precsR\n\n  infixP precs lhs = choice infixPs &lt;|&gt; pure lhs where\n    infixPs = do\n      precsR@(ops:precsL) &lt;- tails precs\n      op &lt;- ops\n      p &lt;- case op of\n        Infix opP assoc -&gt; do\n          let p precs = opP &lt;*&gt; pure lhs &lt;*&gt; parser precs\n          return $ case assoc of\n            AssocNone  -&gt; error \"Non associative operators are not supported\"\n            AssocLeft  -&gt; p precsL\n            AssocRight -&gt; p precsR\n        Postfix opP -&gt;\n          return $ opP &lt;*&gt; pure lhs\n        Prefix _ -&gt; mzero\n      return $ p &gt;&gt;= infixP precs\n\n  parser precs = prefixP &gt;&gt;= infixP precs\n</code></pre>\n"}], "owner": {"reputation": 1583, "user_id": 2274140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1f23d1e4442f8de475f1eec047515a84?s=128&d=identicon&r=PG", "display_name": "BartBog", "link": "https://stackoverflow.com/users/2274140/bartbog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 33534426, "answer_count": 4, "score": 6, "last_activity_date": 1446790196, "creation_date": 1445256967, "last_edit_date": 1495541233, "question_id": 33214163, "link": "https://stackoverflow.com/questions/33214163/parsec-expr-repeated-prefix-with-different-priority", "title": "Parsec.Expr repeated Prefix with different priority", "body": "<p>The documentation for Parsec.Expr.buildExpressionParser says:</p>\n\n<blockquote>\n  <p>Prefix and postfix operators of the same precedence can only occur once   (i.e. --2 is not allowed if - is prefix negate).</p>\n</blockquote>\n\n<p>However, I would like to parse such strings. </p>\n\n<p>Concretely, consider the following grammar:</p>\n\n<pre><code>sentence: \n    | identifier\n    | \"~\" sentence\n    | sentence &amp; sentence\n    | \"!\" sentence\n</code></pre>\n\n<p>Where operator precedence is: <code>\"~\"</code> binds stronger than <code>\"&amp;\"</code> binds stronger than <code>\"!\"</code> </p>\n\n<p>For example, I would like the sentence </p>\n\n<pre><code>! ~a &amp; b\n</code></pre>\n\n<p>to be parsed as </p>\n\n<pre><code>! ( (~a) &amp; b )\n</code></pre>\n\n<p>And the sentence </p>\n\n<pre><code>~ ! a &amp; b \n</code></pre>\n\n<p>as </p>\n\n<pre><code>~( ! ( a &amp; b) )\n</code></pre>\n\n<p>Parsec allows me to do this (and specify the operator precedence), however, I would like to be able to chain prefixes, e.g. <code>~ ~ ! ~ a</code>. \nParsec does not allow this. \nI have found the solution <a href=\"https://stackoverflow.com/questions/10475337/parsec-expr-repeated-prefix-postfix-operator-not-supported\">for chaining prefixes</a>, but this solution does not allow me to specify a different operator priority for the different prefix operators (either both \"~\" and \"!\" bind stronger than \"&amp;\", or none of them does)</p>\n\n<p>Does anyone have a solution for this? </p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Partial solution that gets the operator bindings correct, but allows no chaining:\n<a href=\"http://lpaste.net/143362\" rel=\"nofollow noreferrer\">http://lpaste.net/143362</a></p>\n\n<p>Partial solution with chaining but that has a wrong binding for the \"~\" operator:\n<a href=\"http://lpaste.net/143364\" rel=\"nofollow noreferrer\">http://lpaste.net/143364</a></p>\n\n<p><strong>Edit:</strong> Some more clarifications related to the <a href=\"https://stackoverflow.com/questions/33214163/parsec-expr-repeated-prefix-with-different-priority/33244887#33244887\">latest answer</a>. </p>\n\n<p>I actually want <code>&amp;</code> to be associative. Left or right does not matter. Left vs right associativity only matters between operators of the same precedence. \nFor your examples, it is all resolved by noting that <code>&amp;</code> binds stronger than <code>!</code> (<code>&amp;</code> has greater operator precedence) </p>\n\n<p>Hence, the expression you were worried about:</p>\n\n<p><code>a &amp; ! b &amp; c</code> should become:\n(first bind <code>&amp;</code> where possible)\n<code>a &amp; ! (b &amp; c)</code></p>\n\n<p>Similarly, <code>! a &amp; ! b &amp; c</code> should be parsed \n(first bind &amp;)\n<code>! a &amp; ! (b &amp; c)</code>, thus <code>! a &amp; (! (b &amp; c))</code>, thus <code>! (a &amp; (! (b &amp; c)))</code></p>\n"}, {"tags": ["haskell", "int"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445254570, "post_id": 33213215, "comment_id": 54230735, "body": "<a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:round\" rel=\"nofollow noreferrer\"><code>round</code>, <code>ceiling</code> or <code>floor</code></a> ;) (or use <code>div</code> instead of <code>(&#47;)</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "edited": false, "score": 0, "creation_date": 1445255073, "post_id": 33213448, "comment_id": 54231039, "body": "Im not quite sure how to implement either of these to my scenario, basically I want to input three int values, calculate the average of them and use guards to determine how many of the values are higher than their average (can either be two or one), and I&#39;m using the local definition avg = (a + b + c) / 3 to try and calculate said average and use it in the guards."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "edited": false, "score": 1, "creation_date": 1445255812, "post_id": 33213448, "comment_id": 54231527, "body": "sorry my bad ... you have to use <code>avg = round (fromIntegral (a+b+c) &#47; 3)</code> in this case"}, {"owner": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "edited": false, "score": 0, "creation_date": 1445255849, "post_id": 33213448, "comment_id": 54231557, "body": "That makes sense! Thanks a lot :)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1445255893, "last_edit_date": 1445255893, "creation_date": 1445254821, "answer_id": 33213448, "question_id": 33213215, "link": "https://stackoverflow.com/questions/33213215/haskell-converting-float-to-int-mean-average/33213448#33213448", "title": "Haskell: Converting Float to Int (mean average)", "body": "<p>as I commented you can use either <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:round\" rel=\"nofollow\"><code>round</code>, <code>ceiling</code> or <code>floor</code></a> like this:</p>\n\n<pre><code>avg :: Integral a =&gt; a -&gt; a -&gt; a -&gt; Int\navg a b c = round $ fromIntegral (a+b+c) / 3\n</code></pre>\n\n<p>or you can use <code>div</code> instead (which will truncate towards negative infinity ...):</p>\n\n<pre><code>avg' :: Integral a =&gt; a -&gt; a -&gt; a -&gt; a\navg' a b c = (a+b+c) `div` 3\n</code></pre>\n\n<p>if you want different input types than you might have to use some other conversions too but I cannot tell from your question.</p>\n"}], "owner": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1121, "favorite_count": 1, "accepted_answer_id": 33213448, "answer_count": 1, "score": 0, "last_activity_date": 1445255893, "creation_date": 1445254042, "question_id": 33213215, "link": "https://stackoverflow.com/questions/33213215/haskell-converting-float-to-int-mean-average", "title": "Haskell: Converting Float to Int (mean average)", "body": "<p>I have a function which must return an Int, however I need to use a local definition to find the average of three parameters; such that:</p>\n\n<pre><code>avg = (a + b + c) / 3\n</code></pre>\n\n<p>However this of course returns a float, how do I convert the result into an int (or more specifically round it up or down)?</p>\n"}, {"tags": ["python", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 50468, "user_id": 1331451, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/4ZPmj.png?s=128&g=1", "display_name": "simbabque", "link": "https://stackoverflow.com/users/1331451/simbabque"}, "edited": false, "score": 3, "creation_date": 1445252387, "post_id": 33212631, "comment_id": 54229348, "body": "What programming language is this question about? Perl, Python or Haskell? Please remove the language tags that do not apply."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1445252605, "post_id": 33212631, "comment_id": 54229466, "body": "min/max/count - would go in one fold where the folding function consists of the used functions, the average would not go in one fold - as the division operation of sum and len cannot fit in the fold - but it can be easily done afterwards"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1445252928, "post_id": 33212631, "comment_id": 54229679, "body": "but I recommend starting with a simple - doing every step after the other programm - &lt;strike&gt;see&lt;/strike&gt; measure if it is fast enough (if you&#39;re using haskell I&#39;d recommend &#39;criterion&#39;), and only if it is not - then start writing a composed folding function - and document what it does and why you have chosen to do so (e.g. for performance reasons)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445254286, "post_id": 33212631, "comment_id": 54230562, "body": "You want to write a &quot;combined&quot; version of several functions so that you can compute it with only one loop/fold over the list. This may or may not be feasible depending on which functions you want to combine. Further, the question is not so clear: what should &quot;without modification&quot; require? Maybe you just want to write <code>combine(fun1,fun2,...)</code> and have a single-fold function being crafted automatically. I don&#39;t think this can be done easily unless <code>fun1,..</code> have some special form."}, {"owner": {"reputation": 2232, "user_id": 210946, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/abc199670bac44287acd2218cdd378f4?s=128&d=identicon&r=PG", "display_name": "Nyan", "link": "https://stackoverflow.com/users/210946/nyan"}, "reply_to_user": {"reputation": 50468, "user_id": 1331451, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/4ZPmj.png?s=128&g=1", "display_name": "simbabque", "link": "https://stackoverflow.com/users/1331451/simbabque"}, "edited": false, "score": 0, "creation_date": 1445254683, "post_id": 33212631, "comment_id": 54230812, "body": "@simbabque  it doesn&#39;t matter which programming language. it&#39;s not a programming language specific question."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1445281908, "last_edit_date": 1445281908, "creation_date": 1445267116, "answer_id": 33217838, "question_id": 33212631, "link": "https://stackoverflow.com/questions/33212631/multiple-functions-over-a-list/33217838#33217838", "title": "Multiple functions over a list", "body": "<p>In Haskell, the easy way is to use Gabriel Gonzalez's <a href=\"https://hackage.haskell.org/package/foldl\" rel=\"nofollow\"><code>foldl</code></a> package. This package supports a <code>Fold</code> type expressing all the computations you want to perform as you fold over a <code>Foldable</code> container, and how you want to combine/transform the results of those computations. You can write something like</p>\n\n<pre><code>import Control.Foldl as L\n\navg :: (Foldable f, Fractional n) =&gt; f n -&gt; n\navg = L.fold $ (/) &lt;$&gt; L.sum &lt;*&gt; (fromIntegral &lt;$&gt; L.length)\n</code></pre>\n\n<p>to produce a function that calculates the mean of the elements of a container. The package is \"batteries included\", providing a fairly large number of basic operations to use as building blocks, but you can also write your own <code>Fold</code>s if you need to. It's also pretty easy to write functions to apply <code>Fold</code>s to streaming sources rather than foldable containers if your application demands that.</p>\n"}], "owner": {"reputation": 2232, "user_id": 210946, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/abc199670bac44287acd2218cdd378f4?s=128&d=identicon&r=PG", "display_name": "Nyan", "link": "https://stackoverflow.com/users/210946/nyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1445281908, "creation_date": 1445252237, "last_edit_date": 1445252397, "question_id": 33212631, "link": "https://stackoverflow.com/questions/33212631/multiple-functions-over-a-list", "title": "Multiple functions over a list", "body": "<p>I have a list of records/tuple. and a couple of functions that process on list. like max_min that takes a list and return min,max pair. \nIs there any way to combine these functions without modification?\nEach function will not do any modification to original list.\nBut might do reduce, map, filter.</p>\n\n<pre><code>    stream ---&gt; Process1 ----&gt; Process2\n\n    [ (x:4,y:2,value:10) , (x:3,y:1,value:2), ... ]\n\n    function min_max (list) = .... a function that takes a list and return (min,max) pair\n\n    function count(list) = .... count occurrences and return [(item, times)]\n    function average(list) = ....\n</code></pre>\n\n<p>In imperative way, I could just use a big for loop and include all logics of each function inside.\nIs there any elegant way to do this?</p>\n\n<p>In python, generator send could send each list element to all functions. I think that might work.\nHow would one abstract this in functional way? monad? fold?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1445249854, "post_id": 33211819, "comment_id": 54227859, "body": "Your function as written won&#39;t even parse: function identifiers must begin with a lower-case letter. Please make sure that you are showing us your code <i>exactly</i> as it is written."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 0, "last_activity_date": 1445250225, "creation_date": 1445250225, "answer_id": 33212018, "question_id": 33211819, "link": "https://stackoverflow.com/questions/33211819/head-function-throwing-type-match-errors-haskell/33212018#33212018", "title": "Head function throwing type match errors Haskell", "body": "<p>When you wrote:</p>\n\n<pre><code>TList head [a] [] = ...\n</code></pre>\n\n<p>You've shadowed the original <code>head</code> function. Thus in this context:</p>\n\n<pre><code>[(head [a],1)]\n</code></pre>\n\n<p>It tries to evaluate it. I've no idea why haven'y you just used <code>a</code> here, the code is very unclear and it won't compile with that name (uppercase <code>TList</code>), but this is the source of this type mismatch.</p>\n"}, {"tags": [], "owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "is_accepted": false, "score": 4, "last_activity_date": 1445250932, "last_edit_date": 1445250932, "creation_date": 1445250452, "answer_id": 33212102, "question_id": 33211819, "link": "https://stackoverflow.com/questions/33211819/head-function-throwing-type-match-errors-haskell/33212102#33212102", "title": "Head function throwing type match errors Haskell", "body": "<p>So, this is not a full answer to your question because I'm not sure what exactly you're trying to achieve. But there's a few things wrong with the code and I suggest you start by fixing them and then seeing how it goes:</p>\n\n<ol>\n<li><p>Function names need to begin with a lower-case letter. Therefore, <code>TList</code> is not a legal name for a function. (Types and type constructors have upper case names). So maybe you want <code>tList</code>?</p></li>\n<li><p>You are naming one of the parameters <code>head</code>. But <code>head</code> is also a <code>Prelude</code> function and you actually seem to use the <code>head</code> function (<code>head [a]</code>). But your parameter <code>head</code> will shadow the head function. Also <code>head</code> seems like an odd name for a proper list.</p></li>\n<li><p><code>head [a]</code> seems odd as <code>head [a] == a</code>. So the head of a list with just one element is always just that element.</p></li>\n<li><p>I'm guessing you're trying to use <code>drop 1 [a]</code> (if so, you're missing parenthesis). That's odd too because <code>drop 1 [a] == []</code>. <code>drop 1</code> of a list with just one element is always the empty list.</p></li>\n<li><p>You're pattern matching the second parameter (type <code>a</code>) with <code>[a]</code> and that can't work because <code>[a]</code> only works with list types <code>[t]</code>.</p></li>\n<li><p><code>a' == take 1</code> doesn't really make sense. <code>take 1</code> needs a list as the second argument <code>take 1 [1, 2, 3] = [1]</code>. So you're comparing something (<code>a</code>) of type <code>a</code> with another thing of type <code>[a] -&gt; [a]</code> (<code>take 1 :: [a] -&gt; [a]</code>).</p></li>\n</ol>\n"}], "owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1445250932, "creation_date": 1445249544, "last_edit_date": 1445250384, "question_id": 33211819, "link": "https://stackoverflow.com/questions/33211819/head-function-throwing-type-match-errors-haskell", "title": "Head function throwing type match errors Haskell", "body": "<p>So basically i'm taking a list of items and adding to a list of tuples to make it more efficient way to store/view the data. My code is</p>\n\n<pre><code>TList :: [a] -&gt; a -&gt; [(a,Int)] -&gt; [(a,Int)]\nTList head [a] [] = [(head [a],1)]\nTList head [a] ((a',i):xa)\n    |a' == take 1 = (head 1,i+1):xa\n    |otherwise = (a',i) : TList drop 1 [a] xa\n</code></pre>\n\n<p>so my logic is that I take the first item in the list, checks to see if its already in the tuple list, if it is add one to the int. the call the function again but without the first list item\nbut it keeps giving the error</p>\n\n<pre><code>Couldn't match expected type '[t1] -&gt; a' with actual type '[a]'\n</code></pre>\n\n<p>it gives this error 5 times, one for each line.</p>\n"}, {"tags": ["list", "haskell", "scalar", "oz"], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 2, "last_activity_date": 1445250607, "creation_date": 1445250607, "answer_id": 33212148, "question_id": 33211484, "link": "https://stackoverflow.com/questions/33211484/how-can-an-oz-program-tell-the-difference-between-a-list-and-a-non-list/33212148#33212148", "title": "How can an Oz program tell the difference between a list and a non-list?", "body": "<blockquote>\n  <p>How can an Oz program tell the difference between a value which is of type List and one which is a non-list such as simple scalar value 1 or string 'Hello'?</p>\n</blockquote>\n\n<p><a href=\"http://mozart.github.io/mozart-v1/doc-1.4.0/base/list.html#section.records.lists\" rel=\"nofollow\"><code>List.is</code></a>.</p>\n\n<blockquote>\n  <p>(Like Haskell, does Oz treat a string as a list of characters?)</p>\n</blockquote>\n\n<p>That's explained on the page you linked: </p>\n\n<blockquote>\n  <blockquote>\n    <p>Further notational variant is allowed for lists whose elements correspond to character codes. Lists written in this notation are called strings</p>\n  </blockquote>\n</blockquote>\n\n<p>See also </p>\n\n<blockquote>\n  <blockquote>\n    <p><a href=\"http://mozart.github.io/mozart-v1/doc-1.4.0/base/node9.html#chapter.text\" rel=\"nofollow\">This chapter describes modules for handling data encoding textual information. Characters are encoded as integers. Strings are lists of characters. Virtual Strings are atoms, strings, byte strings, integers, and floats closed under virtual concatenation encoded by tuples with label '#'.</a> </p>\n  </blockquote>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 3662, "user_id": 2174693, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c620cfea6f4ddeebda17b99d21973fba?s=128&d=identicon&r=PG", "display_name": "francoisr", "link": "https://stackoverflow.com/users/2174693/francoisr"}, "is_accepted": false, "score": 2, "last_activity_date": 1445521278, "last_edit_date": 1445521278, "creation_date": 1445250990, "answer_id": 33212269, "question_id": 33211484, "link": "https://stackoverflow.com/questions/33211484/how-can-an-oz-program-tell-the-difference-between-a-list-and-a-non-list/33212269#33212269", "title": "How can an Oz program tell the difference between a list and a non-list?", "body": "<p>Here is a possible implementation of the <code>List.is</code>function mentioned by Alexey in his answer. </p>\n\n<pre><code>fun {IsList Xs}\n   case Xs of nil then true\n   []\u00a0_|Xr then {IsList Xr}\n   else false\n   end\nend\n</code></pre>\n"}], "owner": {"reputation": 25370, "user_id": 107158, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/05243b2e0495d108111d1bb6711b1377?s=128&d=identicon&r=PG", "display_name": "Derek Mahar", "link": "https://stackoverflow.com/users/107158/derek-mahar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 33212148, "answer_count": 2, "score": 0, "last_activity_date": 1445521278, "creation_date": 1445248418, "question_id": 33211484, "link": "https://stackoverflow.com/questions/33211484/how-can-an-oz-program-tell-the-difference-between-a-list-and-a-non-list", "title": "How can an Oz program tell the difference between a list and a non-list?", "body": "<p>How can an <a href=\"https://en.wikipedia.org/wiki/Oz_(programming_language)\" rel=\"nofollow\">Oz</a> program tell the difference between a value which is of type <a href=\"http://mozart.github.io/mozart-v1/doc-1.4.0/tutorial/node3.html#label21\" rel=\"nofollow\">List</a> and one which is a non-list such as simple scalar value <code>1</code> or string <code>'Hello'</code>?  (Like <a href=\"https://en.wikipedia.org/wiki/Haskell_(programming_language)\" rel=\"nofollow\">Haskell</a>, does Oz treat a string as a list of characters?) </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1445247134, "post_id": 33211011, "comment_id": 54226284, "body": "is this a exercise or why do you have to use list-comprehensions? the ususal way is just <code>diff xs ys =  zipWith (-) xs ys</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445247257, "post_id": 33211011, "comment_id": 54226357, "body": "also your last part looks like you just want to add <code>diff (x:xs) (y:ys) = ...</code> as the last case ... this should be really easy for you to do (no list comprehension needed - recursion might be a good idea though)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1445247276, "post_id": 33211011, "comment_id": 54226367, "body": "Probably the intended solution starts with <code>zip xs ys</code> and continues with a list comprehension to achieve the same effect of <code>zipWith</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445247846, "post_id": 33211011, "comment_id": 54226702, "body": "are you allowed to use <code>zip</code>, are you supposed to implement the function with pattern matching (the part you started last)"}, {"owner": {"reputation": 15, "user_id": 4168576, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RH0pr.jpg?s=128&g=1", "display_name": "michaeladrian39", "link": "https://stackoverflow.com/users/4168576/michaeladrian39"}, "edited": false, "score": 0, "creation_date": 1445248055, "post_id": 33211011, "comment_id": 54226820, "body": "i can use zip... I&#39;m planning to use the pattern matching but I need to use list comprehension so I don&#39;t think I can use the pattern matching code i made..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445248142, "post_id": 33211011, "comment_id": 54226867, "body": "go with the hint @chi gave you then ;) (<code>diff xs ys = [ x-y | ? &lt;- zip ? ? ]</code>)"}, {"owner": {"reputation": 15, "user_id": 4168576, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RH0pr.jpg?s=128&g=1", "display_name": "michaeladrian39", "link": "https://stackoverflow.com/users/4168576/michaeladrian39"}, "edited": false, "score": 0, "creation_date": 1445248531, "post_id": 33211011, "comment_id": 54227099, "body": "<code>diff xs ys [x-y | (x,y) &lt;- zip xs ys]</code> worked! Thank you!"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1445248873, "post_id": 33211011, "comment_id": 54227298, "body": "If you enable the parallel list comprehensions extension, you can write <code>[x-y | x &lt;- xs | y &lt;- ys]</code>. This is just a syntactic sugar for the <code>zip</code> thing."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445251973, "post_id": 33211011, "comment_id": 54229087, "body": "maybe you should wait with this till you understand the <i>vanilla</i> comprehensions better ;)"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1445251914, "post_id": 33211628, "comment_id": 54229050, "body": "it&#39;s just a compressed version of yours"}], "tags": [], "owner": {"reputation": 352, "user_id": 1738119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/196a088cbe1f14e69851e3257f0a19c6?s=128&d=identicon&r=PG", "display_name": "koki", "link": "https://stackoverflow.com/users/1738119/koki"}, "is_accepted": false, "score": 1, "last_activity_date": 1445252965, "last_edit_date": 1445252965, "creation_date": 1445248907, "answer_id": 33211628, "question_id": 33211011, "link": "https://stackoverflow.com/questions/33211011/differences-between-values-within-two-lists-in-haskell-with-list-comprehension/33211628#33211628", "title": "Differences between values within two lists in Haskell with List Comprehension", "body": "<pre><code>diff :: [Int] -&gt; [Int] -&gt; [Int]\ndiff a b = map (\\(p, q) -&gt; p - q) $ zip a b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "is_accepted": false, "score": 2, "last_activity_date": 1445252423, "creation_date": 1445252423, "answer_id": 33212687, "question_id": 33211011, "link": "https://stackoverflow.com/questions/33211011/differences-between-values-within-two-lists-in-haskell-with-list-comprehension/33212687#33212687", "title": "Differences between values within two lists in Haskell with List Comprehension", "body": "<p>If you like list comprehensions, you can use <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/list-comprehension-extensions\" rel=\"nofollow\">an extension</a>:</p>\n\n<pre><code>{-# LANGUAGE ParallelListComp #-}\n\ndiff a b = [p - q | p &lt;- a | q &lt;- b]\n</code></pre>\n\n<p>which is internally translated into <code>zip</code>.</p>\n"}], "owner": {"reputation": 15, "user_id": 4168576, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RH0pr.jpg?s=128&g=1", "display_name": "michaeladrian39", "link": "https://stackoverflow.com/users/4168576/michaeladrian39"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2011, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1445252965, "creation_date": 1445246971, "question_id": 33211011, "link": "https://stackoverflow.com/questions/33211011/differences-between-values-within-two-lists-in-haskell-with-list-comprehension", "title": "Differences between values within two lists in Haskell with List Comprehension", "body": "<p>I'm making a function in Haskell to compute the differences between values in two lists.</p>\n\n<p>For example, I have two lists:</p>\n\n<pre><code>    List A = [1,2,3]\n    List B = [2,3,4]\n</code></pre>\n\n<p>Subtract the first element of A with the first element of B, subtract the second element of A with the second element of B, and so on. The result should be like this:</p>\n\n<pre><code>    Result = [-1,-1,-1]\n</code></pre>\n\n<p>How to make this function? I tried using this but failed:</p>\n\n<pre><code>diff xs ys = [i-j | i &lt;- xs, j &lt;- ys, length xs == length ys]\n</code></pre>\n\n<p>And the result of using that wrong function is (I used list A and list B, look above):</p>\n\n<pre><code>    [-1,-2,-3,0,-1,-2,1,0,-1]\n</code></pre>\n\n<p>Someone told me that i &lt;- xs, j &lt;- ys means cross-joining the elements of xs and ys, so the result is like this:</p>\n\n<pre><code>    [(1-2),(1-3),(1-4),(2-2),(2-3),(2-4),(3-2),(3-3),(3-4)\n</code></pre>\n\n<p>Using list comprehension, and without using <code>i &lt;- xs, j &lt;- ys</code>, complete this function:</p>\n\n<pre><code>diff :: [Int] -&gt; [Int] -&gt; [Int]\ndiff [] [] = []\ndiff xs [] = []\ndiff [] ys = []\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1445305572, "post_id": 33210528, "comment_id": 54257901, "body": "Be aware that the word <a href=\"https://hackage.haskell.org/package/void-0.7.1/docs/Data-Void.html\" rel=\"nofollow noreferrer\">void</a> has a technical meaning in this <i>domain</i> (pun intended), and is not the same as the unit type <code>()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 0, "creation_date": 1445246284, "post_id": 33210673, "comment_id": 54225740, "body": "usually when function get called, the parameters are calculated first (some maybe like generator/lazy list stuff not get a full result). I&#39;m stucked with why the &quot;m ()&quot; not &quot;calculated/called\u201c first as usual."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 2, "creation_date": 1445246419, "post_id": 33210673, "comment_id": 54225827, "body": "the <code>()</code> in <code>m ()</code> is not a function argument - it a type-argument (in this case it might be unfortunate that the <i>only</i> value of the unit type is written the same as the type: <code>() :: ()</code>) but really <code>()</code> here is the unit type - see a Monad <code>m</code> is not a type it is something you have to give another type to produce a type (we say it has kind <code>* -&gt; *</code>) - and the way you do it is just as with functions - with a <i>space</i> - so <code>IO</code> is not a type but <code>IO ()</code> and <code>IO String</code> are"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1445246516, "post_id": 33210673, "comment_id": 54225891, "body": "Why do you write <code>putStrLn &quot;Hello&quot; :: IO String</code>? It should be <code>putStrLn &quot;Hello&quot; :: IO ()</code>."}, {"owner": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 0, "creation_date": 1445247260, "post_id": 33210673, "comment_id": 54226359, "body": "@Carsten, okay I understand that printStrLn is a compuation. then how the compuation is &quot;called&quot;?  Why the &quot;then s&quot; syntax will call the compuation instead of just return the compuation?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 0, "creation_date": 1445247440, "post_id": 33210673, "comment_id": 54226458, "body": "@arsane The computation is not &quot;called&quot;. The function <code>when</code> takes a computation and returns one. Depending on the outcome of the <code>Bool</code>, the returned computation is either identical to the computation you passed in, or it is a computation that does nothing (i.e., <code>return ()</code>)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445247454, "post_id": 33210673, "comment_id": 54226469, "body": "it actually will return it (the other branch returns a computation that does nothing) ..."}, {"owner": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 0, "creation_date": 1445248290, "post_id": 33210673, "comment_id": 54226956, "body": "@Carsten, my question might be: why &quot;putStr str&quot; isn&#39;t called before when? I guess this is becoz of laziness?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445248523, "post_id": 33210673, "comment_id": 54227094, "body": "well it would not actually evaluate this branch to get the computation-value  because of lazyness yes - but in this case even if it would you would not see any text on the screen, because you will only see it when the computation is run"}, {"owner": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 0, "creation_date": 1445249867, "post_id": 33210673, "comment_id": 54227870, "body": "@Carsten so the &quot;then s&quot; part will &quot;run&quot; the computation, How this is done?  Is it related with haskell&#39;s evaluation model?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1445251729, "post_id": 33210673, "comment_id": 54228948, "body": "well you can think of it like this: the <code>main</code> function of your programm has type <code>IO ()</code> and you chain all computations in there together - the computation <code>main</code> itself will then be run when you execute your program!   That is the only place where anything will run - all else is just composing computations"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1445251872, "post_id": 33210673, "comment_id": 54229032, "body": "for other monads you will eventually run the computation with some function provided with it - for example you will run <code>State</code> computations when you call <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-State-Lazy.html#v:evalState\" rel=\"nofollow noreferrer\"><code>evalState</code></a> (or some other function there) - you can recognize those functions easily: they will have the monad on the left/input side but not on the right/output side ;)"}, {"owner": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 0, "creation_date": 1445253517, "post_id": 33210673, "comment_id": 54230054, "body": "@Carsten thanks, I think this execution model is the key of my confusion."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 6, "last_activity_date": 1445305577, "last_edit_date": 1445305577, "creation_date": 1445246006, "answer_id": 33210673, "question_id": 33210528, "link": "https://stackoverflow.com/questions/33210528/how-to-understand-m-is-a-monadic-computation/33210673#33210673", "title": "How to understand &quot;m ()&quot; is a monadic computation", "body": "<p>Laziness has no part in it.</p>\n\n<p>The <code>m</code>/Monad part is often called <em>computation</em>.</p>\n\n<p>The best example might be <code>m = IO</code>:</p>\n\n<p>Look at <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:putStrLn\" rel=\"nofollow\"><code>putStrLn \"Hello\" :: IO ()</code></a> - This is a computation that, when run, will print <code>\"Hello\"</code> to your screen. </p>\n\n<p>This computation has no result - so the return type is <code>()</code></p>\n\n<p>Now when you write</p>\n\n<pre><code>hello :: Bool -&gt; IO ()\nhello sayIt =\n   when sayIt (putStrLn \"Hello\")\n</code></pre>\n\n<p>then <code>hello True</code> is a computation that, when run, will print <code>\"Hello\"</code>; while <code>hello False</code> is a computation that when run will do nothing at all.</p>\n\n<hr>\n\n<p>Now  compare it to <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:getLine\" rel=\"nofollow\"><code>getLine :: IO String</code></a> - this is a computation that, when run, will prompt you for an input and will return the input as a <code>String</code> - that's why the return type is <code>String</code>.</p>\n\n<p>Does this help?</p>\n"}, {"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 2, "last_activity_date": 1445247567, "last_edit_date": 1445247567, "creation_date": 1445246077, "answer_id": 33210699, "question_id": 33210528, "link": "https://stackoverflow.com/questions/33210528/how-to-understand-m-is-a-monadic-computation/33210699#33210699", "title": "How to understand &quot;m ()&quot; is a monadic computation", "body": "<blockquote>\n  <p>for me \"m ()\" is some \"void\" data</p>\n</blockquote>\n\n<p>And that kinda makes sense, in that a computation <em>is</em> a special kind of data. It has nothing to do with laziness - it's associated with context.</p>\n\n<p>Let's take <code>State</code> as an example. A function of type, say, <code>s -&gt; ()</code> in Haskell can only produce one value. However, a function of type <code>s -&gt; ((), s)</code> is a regular function doing some transformation on <code>s</code>. The problem you're having is that you're only looking at the <code>()</code> part, while the <code>s -&gt; s</code> part stays hidden. That's the point of <code>State</code> - to hide the state passing.</p>\n\n<p>Hence <code>State s ()</code> is trivially convertible to <code>s -&gt; ((), s)</code> and back, and it still is a <code>Monad</code> (a computation) that produces a value of... <code>()</code>. </p>\n\n<p>If we look at practical use, now:</p>\n\n<pre><code>(flip runState 10) $ do\n    modify (+1)\n</code></pre>\n\n<p>This expression produces a tuple of <code>((), Int)</code>; the <code>Int</code> part is hidden</p>\n\n<p>It will modify the state, adding 1 to it. It produces the intermediate value of <code>()</code>, though, which fits your <code>when</code>: </p>\n\n<pre><code>when (5 &gt; 3) $ modify (+1)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "edited": false, "score": 0, "creation_date": 1445305462, "post_id": 33221907, "comment_id": 54257873, "body": "@Lius Casillas, I really like your answer, it clear up concept. Also, I think the document mentioned &quot;Perform&quot; the compuation which maybe not correct, the when only return &quot;m ()&quot;, the &quot;perform of the computation&quot; is done by outside by either call monad function or like IO monad will be called through main entry."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 2, "last_activity_date": 1445281798, "last_edit_date": 1445281798, "creation_date": 1445281273, "answer_id": 33221907, "question_id": 33210528, "link": "https://stackoverflow.com/questions/33210528/how-to-understand-m-is-a-monadic-computation/33221907#33221907", "title": "How to understand &quot;m ()&quot; is a monadic computation", "body": "<p>Monads are notably abstract and mathematical, so intuitive statements about them are often made in language that is rather vague.  So values of a monadic type are often informally labeled as \"computations,\" \"actions\" or (less often) \"commands\" because it's an analogy that sometimes help us reason about them.  But when you dig deeper, these turn out to be empty words when used this way; ultimately what they mean is \"some value of a type that provides the <code>Monad</code> interface.\"</p>\n\n<p>I like the word \"action\" better for this, so let me go with that.  The intuition for the use for that word in Haskell is this: the language makes a distinction between <strong>functions</strong> and <strong>actions</strong>:</p>\n\n<ol>\n<li>Functions can't have any side effects, and their types look like <code>a -&gt; b</code>.</li>\n<li>Actions may have side effects, and their types look like <code>IO a</code>.\n\n<ul>\n<li>A consequence of this: an action of type <code>IO ()</code> produces an uninteresting result value, and therefore it's either a no-op (<code>return ()</code>) or an action that is only interesting because of its side effects.</li>\n</ul></li>\n</ol>\n\n<p><code>Monad</code> then is the interface that allows you to glue actions together into complex actions.</p>\n\n<p>This is all very intuitive, but it's an analogy that becomes rather stretched when you try to apply it to many monads other than the <code>IO</code> type.  For example, lists are a monad:</p>\n\n<pre><code>instance Monad [] where\n  return a = [a]\n  as &gt;&gt;= f = concatMap f as\n</code></pre>\n\n<p>The \"actions\" or \"computations\" of the list monad are... lists.  How is a list an \"action\" or a \"computation\"?  The analogy is rather weak in this case, isn't it?</p>\n\n<p>So I'd say that this is the best advice:</p>\n\n<ol>\n<li>Understand that \"action\" and \"computation\" are analogies.  There's no strict definition.</li>\n<li>Understand that these analogies are stronger for some monad instances, and weak for others.</li>\n<li>The ultimate barometer of how things work are the <code>Monad</code> laws and the definitions of the various functions that work with <code>Monad</code>.</li>\n</ol>\n"}], "owner": {"reputation": 36477, "user_id": 75501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f1164e56ce1dbdc12395e0a36c60dcd?s=128&d=identicon&r=PG", "display_name": "Sam Liao", "link": "https://stackoverflow.com/users/75501/sam-liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 2, "accepted_answer_id": 33210673, "answer_count": 3, "score": 2, "last_activity_date": 1445305577, "creation_date": 1445245527, "last_edit_date": 1445305461, "question_id": 33210528, "link": "https://stackoverflow.com/questions/33210528/how-to-understand-m-is-a-monadic-computation", "title": "How to understand &quot;m ()&quot; is a monadic computation", "body": "<p>From the <a href=\"https://wiki.haskell.org/All_About_Monads#Conditional_monadic_computations\" rel=\"nofollow\">document</a>:</p>\n\n<pre><code>when :: (Monad m) =&gt; Bool -&gt; m () -&gt; m ()\nwhen p s = if p then s else return ()\n</code></pre>\n\n<p>The <code>when</code> function takes a boolean argument and a monadic computation with unit <code>()</code> type and performs the computation only when the boolean argument is <code>True</code>. </p>\n\n<p>===</p>\n\n<p>As a Haskell newbie, my problem is that for me <code>m ()</code> is some \"void\" data, but here the document mentions it as computation. Is it because of the laziness of Haskell?</p>\n"}, {"tags": ["haskell", "anonymous-function"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1445233606, "post_id": 33207284, "comment_id": 54219210, "body": "If you want to use a block of code (with or without parameters, in Haskell or in another language) several times without repeating it, you generally need to give it a name."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 4, "creation_date": 1445233737, "post_id": 33207284, "comment_id": 54219258, "body": "You can just lift the repeated code into a <code>let</code>, i.e. you can turn <code>x = case y of P1 -&gt; f largeCodeBlock foo; P2 -&gt; g bar largeCodeBlock</code> into <code>x = let lcb = largeCodeBlock in case y of P1 -&gt; f lcb foo; P2 -&gt; g bar lcb</code>. Is this what you&#39;re after? (I&#39;m happy to post this as an answer if yes.)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 10, "creation_date": 1445234050, "post_id": 33207284, "comment_id": 54219355, "body": "to give you a short answer: functions without parameters are called <i>values</i> ;)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1445236717, "post_id": 33207284, "comment_id": 54220477, "body": "Can you show us this code? It may depend on context."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1445238142, "post_id": 33207284, "comment_id": 54221257, "body": "Its really unclear what you are asking. Can you be more specific? Are you sure you know what &quot;anonymous function&quot; means?"}, {"owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1445239330, "post_id": 33207284, "comment_id": 54221855, "body": "@Cactus, the let statement is a fine solution for this case. I try to use the where statement. But it turns out to be wrong."}, {"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 3, "creation_date": 1445240477, "post_id": 33207284, "comment_id": 54222488, "body": "@highfly22 what&#39;s wrong with <code>where</code>? Did you place it at the proper scope level? If not it may be in scope only for one of the case branches (its indentation must be the same as the word &quot;case&quot;)"}, {"owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "reply_to_user": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 0, "creation_date": 1445242665, "post_id": 33207284, "comment_id": 54223685, "body": "@sinelaw, you are right. I added more spaces before where."}], "answers": [{"comments": [{"owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "edited": false, "score": 0, "creation_date": 1445306653, "post_id": 33211542, "comment_id": 54258188, "body": "The second example gives &quot;Not in scope: : \u2018time\u2019&quot;."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "edited": false, "score": 0, "creation_date": 1445330453, "post_id": 33211542, "comment_id": 54267252, "body": "I see. So the anonymous function you&#39;ve wanted doesn&#39;t even have zero parameters..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1445330384, "last_edit_date": 1445330384, "creation_date": 1445248632, "answer_id": 33211542, "question_id": 33207284, "link": "https://stackoverflow.com/questions/33207284/anonymous-function-without-parameter-in-haskell/33211542#33211542", "title": "Anonymous function without parameter in Haskell", "body": "<p>There is no such thing as a function without parameters (anonymous or otherwise). That's just a <em>value</em> (and in Haskell, <em>actions</em> like <code>main :: IO ()</code> are also just values).</p>\n\n<p>For sure, a value can be defined anywhere (like a function); however if you want to reuse it in more than one place you should <em>not</em> make it anonymous but give it a (locally scoped) name:</p>\n\n<pre><code>f event d1 d2 d3 d4 =\n  case event of\n    (Modified file time) -&gt; do\n       defaultAction time\n    (Added file time) -&gt; do\n       defaultAction time\n    _ -&gt; return ()\n where defaultAction time = do\n           codeBlock file time d1 d2 d3 d4\n</code></pre>\n\n<p>BTW, <code>do</code> blocks with only a single statement are <a href=\"https://wiki.haskell.org/Monad_laws\" rel=\"nofollow\">equivalent</a> to just that statement alone, i.e. you could also write</p>\n\n<pre><code>f event d1 d2 d3 d4 =\n  case event of\n    (Modified file time) -&gt; defaultAction time\n    (Added file time) -&gt; defaultAction time\n    _ -&gt; return ()\n where defaultAction time = codeBlock file time d1 d2 d3 d4\n</code></pre>\n"}], "owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1076, "favorite_count": 1, "accepted_answer_id": 33211542, "answer_count": 1, "score": 0, "last_activity_date": 1445330384, "creation_date": 1445233010, "last_edit_date": 1445239664, "question_id": 33207284, "link": "https://stackoverflow.com/questions/33207284/anonymous-function-without-parameter-in-haskell", "title": "Anonymous function without parameter in Haskell", "body": "<p>Could I define an anonymous function without parameter in Haskell?</p>\n\n<p>I have a block of code repeated in several branches. Those code refer to several values outside.</p>\n\n<p>Purpose 0: Define a function do the job in the codeBlock.</p>\n\n<p>Purpose 1: Don't repeat codeBlock twice.</p>\n\n<p>Purpose 2: Don't pass d1..d4 to the function. Avoid passing file and time even better.</p>\n\n<pre><code>f event d1 d2 d3 d4 =\n  case event of\n    (Modified file time) -&gt; do\n       codeBlock file time d1 d2 d3 d4 \n    (Added file time) -&gt; do\n       codeBlock file time d1 d2 d3 d44\n    _ -&gt; return ()\n</code></pre>\n"}, {"tags": ["haskell", "haskell-cmdargs"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1445211609, "post_id": 33203217, "comment_id": 54213789, "body": "That error is due to an expression, but you haven&#39;t showed us the context in which the expression was used, so it&#39;s impossible to determine what you&#39;ve done wrong."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1445211985, "creation_date": 1445211985, "answer_id": 33204551, "question_id": 33203217, "link": "https://stackoverflow.com/questions/33203217/ordered-arguments-with-values-in-cmdargs/33204551#33204551", "title": "Ordered arguments with values in cmdargs", "body": "<p>You probably will have to use the lower-level <code>Explicit</code> api to do this.</p>\n\n<p>Here is an example which shows how to use the Explicit api to:</p>\n\n<ul>\n<li>handle <strong>--help</strong></li>\n<li>collect multiple <strong>-w ...</strong> options</li>\n<li>validate a flag's parameter</li>\n<li>collect all unnamed arguments</li>\n</ul>\n\n<p>Usage examples:</p>\n\n<pre><code>prog --help\nprog -i=456\nprog -w this -w is -w a -w test\nprog -i=xyz\n</code></pre>\n\n<p>Program:</p>\n\n<pre><code>import System.Console.CmdArgs.Explicit\nimport Data.Char\n\ndata MyOptions = Opts { _help    :: Bool\n                      , _words   :: [String]\n                      , _opt1    :: String\n                      , _opt2    :: Int\n                      , _unnamed :: [ String ]\n                      }\n  deriving (Show)\n\nmyMode :: Mode MyOptions\nmyMode = mode \"programName\" initialOpts  description unnamedArg convertFlags\n  where\n    initialOpts = Opts False [] \"abc\" 3 []\n    description = \"This program does it all.\"\n\n    unnamedArg = Arg { argValue = updateUnnamed, argType = \"&lt;FILE&gt;\", argRequire = False }\n        where updateUnnamed str opts = Right $ opts { _unnamed = (str : _unnamed opts) }\n\n    updateWord str opts = Right $ opts { _words = (str: _words opts) }\n    updateA    str opts = Right $ opts { _opt1 = str }\n    updateNum  str opts \n      | not (null str) &amp;&amp; all isDigit str = Right $ opts { _opt2 = read str }\n      | otherwise                         = Left $ \"-i option is not a number: \" ++ str\n\n    convertFlags =\n       [ flagReq     [\"w\",\"word\"] updateWord \"&lt;WORD&gt;\"   \"add a word\"\n       , flagReq     [\"a\", \"bc\"]  updateA    \"&lt;STRING&gt;\" \"a string option\"\n       , flagOpt \"0\" [\"i\" ]       updateNum  \"&lt;NUMBER&gt;\" \"a numeric option\"\n       , flagHelpSimple (\\opts -&gt; opts { _help = True })\n       ]\n\nmain = do\n   opts &lt;- processArgs myMode\n   print opts\n   if _help opts then\n       print $ helpText [] HelpFormatDefault myMode\n    else\n       print opts\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 33204551, "answer_count": 1, "score": 0, "last_activity_date": 1445211985, "creation_date": 1445202145, "last_edit_date": 1495540100, "question_id": 33203217, "link": "https://stackoverflow.com/questions/33203217/ordered-arguments-with-values-in-cmdargs", "title": "Ordered arguments with values in cmdargs", "body": "<p>This question is an extension of the topic : <a href=\"https://stackoverflow.com/questions/32288777/ordered-arguments-with-cmdargs\">Ordered arguments with cmdargs</a></p>\n\n<p>I managed to have a list of argument of the same type. But nom, I would like to have a list of options with values. like this : </p>\n\n<pre><code>runhaskell ~/testargs.hs -a 5,6 -b 8,9 -c 4,2 -a 9,3\n</code></pre>\n\n<p>I tried to declare my data with </p>\n\n<pre><code>data Act = \n    ActA (Double,Double)\n  | ActB (Double,Double)\n  | ActC (Double,Double)\n  deriving (Show, Typeable,  Data, Eq)\n</code></pre>\n\n<p>but I get the following error : </p>\n\n<pre><code>Couldn't match expected type `Act'\n    with actual type `(Double, Double) -&gt; Act'\nIn the expression: ActA\n</code></pre>\n\n<p><strong>Is it possible to retrieve a list of argument with values ?</strong> </p>\n"}, {"tags": ["haskell", "haskell-cmdargs"], "answers": [{"comments": [{"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1605855146, "post_id": 33201012, "comment_id": 114785392, "body": "This seems to mostly do the trick, except you have to be careful since the help can be laid out in multiple lines. In that case you might end up with stray lines in the output. This should really be supported by cmdargs.."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1445189443, "creation_date": 1445189443, "answer_id": 33201012, "question_id": 33199324, "link": "https://stackoverflow.com/questions/33199324/hidden-arguments-with-cmdargs/33201012#33201012", "title": "hidden arguments with cmdargs", "body": "<p>The idea here is to intercept the <code>--help</code> processing and edit the\nhelp text to remove any references to hidden options before displaying it.\nOptions we wish to hide can be marked with special help text (e.g. <code>&amp;= help \"HIDDEN OPTION\"</code>)\nand those lines can be removed from the help output.</p>\n\n<p>Consider this simple main program:</p>\n\n<pre><code>main = cmdArgs sampleArgs &gt;&gt;= print\n</code></pre>\n\n<p>The path taken when <code>--help</code> is present is as follows:</p>\n\n<pre><code>cmdArgs = cmdArgsRun . cmdArgsMode\n\ncmdArgs m = cmdArgsApply =&lt;&lt; processArgs m\n\ncmdArgsApply :: CmdArgs a -&gt; IO a\ncmdArgsApply CmdArgs{..}\n    | Just x &lt;- cmdArgsHelp = do putStr x; exitSuccess\n    | Just x &lt;- cmdArgsVersion = ...\n    | otherwise =  ...\n</code></pre>\n\n<p>To intercept help processing we can write our <code>main</code> like this:</p>\n\n<pre><code>main = do\n  b &lt;- processArgs (cmdArgsMode sampleArgs)\n  a &lt;- myApply b\n  print a\n</code></pre>\n\n<p>where <code>myApply</code> is a version of <code>cmdArgsApply</code> which emits the edited\nversion of the help text.</p>\n\n<p>Here is working example. The options <code>-s</code> and <code>--secret</code> will not be shown in the help text. Try it with these arguments:</p>\n\n<pre><code>prog\nprog --help\nprog --version\nprog -s1234\n</code></pre>\n\n<p>Program:</p>\n\n<pre><code> {-# LANGUAGE DeriveDataTypeable, RecordWildCards #-}\n\n import Data.List                       (isInfixOf)\n import System.Console.CmdArgs\n import System.Console.CmdArgs.Explicit (processArgs)\n import System.Exit                     (exitSuccess)\n\n data MyArgs = MyArgs { file :: String, dest :: String, secret :: String }\n   deriving (Show, Data)\n\n sample  = MyArgs { file = \"input.txt\"  &amp;= help \"the input file\" &amp;= opt \"input\"\n                  , dest = \"output.txt\" &amp;= help \"the output file\"\n                  , secret = \"3l33t\"    &amp;= help \"HIDDEN OPTION\"  &amp;= opt \"someflag\" \n                  }\n\n main = do\n   b &lt;- processArgs (cmdArgsMode sample)\n   a &lt;- myApply b\n   putStrLn $ \"running program with \" ++ show a\n\n myApply :: CmdArgs a -&gt; IO a\n myApply b@CmdArgs{..}\n   | Just x &lt;- cmdArgsHelp = do putStr (fixupHelp x); exitSuccess\n   | otherwise             = cmdArgsApply b\n\n fixupHelp = unlines\n               . filter (not . (\"HIDDEN OPTION\" `isInfixOf`))\n               . lines\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 5459759, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3cbbdd3ca3da640706b554b4e3483d81?s=128&d=identicon&r=PG&f=1", "display_name": "Vigo", "link": "https://stackoverflow.com/users/5459759/vigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 33201012, "answer_count": 1, "score": 2, "last_activity_date": 1445189443, "creation_date": 1445179688, "question_id": 33199324, "link": "https://stackoverflow.com/questions/33199324/hidden-arguments-with-cmdargs", "title": "hidden arguments with cmdargs", "body": "<p>I would like to use cmdargs to pass arguments to my Haskell program. For some reasons, I would like some options to be hidden (not shown but usable) in the cmdargs help message.</p>\n\n<p>Is there a way to do to that?</p>\n\n<p>I'm using cmdargs 0.10.9.</p>\n"}, {"tags": ["haskell", "syntax", "types", "polymorphism"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1445179786, "post_id": 33199180, "comment_id": 54203446, "body": "This <a href=\"http://stackoverflow.com/a/32980202/828361\">stackoverflow.com/a/32980202/828361</a> answer of mine may help a little."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445181271, "post_id": 33199180, "comment_id": 54203946, "body": "The most confusing part is that the <code>forall</code> is very often optional; GHC will <i>implicitly</i> insert enough <code>forall</code>s in type signatures to bind all the type variables one way or another. It&#39;s only mandatory for higher-rank types and when you want a type variable to be in scope in some inner binding."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445185567, "post_id": 33199180, "comment_id": 54205337, "body": "@dfeuer: What&#39;s a &quot;higher-rank type&quot;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445187858, "post_id": 33199180, "comment_id": 54206105, "body": "Rank 2 polymorphism is where a function takes an argument that is itself required to be polymorphic. Rank 3 polymorphism is where a function takes a function as an argument that itself requires its argument to be polymorphic."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445188960, "post_id": 33199180, "comment_id": 54206534, "body": "@dfeuer: So: <code>(forall a. a -&gt; a) -&gt; ...</code> vs. <code>forall a. ((a -&gt; a) -&gt; ...)</code>: the former is mandatory, because specifies a function that must itself be polymorphic? In other words, it is required when it is to the left of the <code>-&gt;</code>, but not when it is &quot;above&quot; it (in the syntax tree) ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445190076, "post_id": 33199180, "comment_id": 54206911, "body": "Yes, that&#39;s correct."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1445210465, "post_id": 33199180, "comment_id": 54213546, "body": "@pigworker: Yes, that helps a lot, for <code>forall</code>; but I&#39;m still not clear on how it interacts with <code>=&gt;</code>."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1445238320, "post_id": 33199180, "comment_id": 54221328, "body": "There is no special interaction between <code>forall</code> and <code>=&gt;</code>. The only interaction is the same as that between <code>forall</code> and <code>-&gt;</code>, namely that the type-level variable bound by <code>forall</code> can be used by type-level things (e.g. constraints left of <code>=&gt;</code>) in its scope. The <code>=&gt;</code> is a lot like <code>-&gt;</code> in that it stands for a type of functions, to which arguments get passed at run time. However, the thing left of <code>=&gt;</code> has kind <code>Constraint</code>, not <code>*</code>, and in source Haskell, the lambdas and applications for constraints are kept invisible. A <code>Constraint</code> is a type for an invisible record."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1445347322, "post_id": 33199180, "comment_id": 54278409, "body": "@pigworker: So in effect <code>A =&gt; ...</code> parallels <code>x -&gt; ...</code> in that it specifies an argument. In the former case, this argument (1) is <i>not</i> supplied visibly by the user, but invisibly by the compiler itself and (2) must be a <code>Constraint</code>. This leaves me with a few things I don&#39;t understand though: (a) What exactly is a <code>Constraint</code>? I hear &quot;dictionary&quot; sometimes, but that doesn&#39;t clear things up. Is it a list of functions? (b) Doesn&#39;t <code>forall</code> also behave as in  (1), so that <code>forall a. Num a =&gt;</code> results in <i>two</i> invisible, compiler-supplied arguments?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1445367115, "post_id": 33199180, "comment_id": 54291407, "body": "Yes, that&#39;s right. A thing of kind <code>Constraint</code> is the &#39;type&#39; of a dictionary. A type <code>class</code> declaration introduces new things of kind <code>Constraint</code> and specifies the <i>methods</i> contained in the dictionaries which will instantiate the &#39;constraint&#39;. The dictionary is the invisible argument, a record of method definitions, supplied by the compiler on the basis of the types involved. E.g., if the constraint says <code>Eq a</code>, the corresponding dictionary contains the relevant definition of <code>(==) :: a -&gt; a -&gt; Bool</code>, which is what your code will actually call when equality testing is needed."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1445370768, "post_id": 33199180, "comment_id": 54293501, "body": "Cool. So if I looked what was &quot;in Core&quot; for, say, <code>f :: forall a. Eq a =&gt; ...</code> it would have <code>f (some type) (some dictionary) ... </code>. And if my definition of <code>f</code> had <code>==</code> in it, the compiler would look up <code>==</code> in <code>some dictionary</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1445186747, "post_id": 33199488, "comment_id": 54205737, "body": "I wouldn&#39;t call <code>\u2200 a</code> a type-level lambda. Haskell has <code>\u2200 a</code> in types, but does not have type-level lambdas e.g. <code>F (\\t -&gt; Maybe (t,t))</code> is illegal in Haskell, but allowed in Agda. <code>\u2200 a</code> is however a binder in types like <code>\\a</code> is in terms."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445187196, "post_id": 33199488, "comment_id": 54205888, "body": "@chi GHC represents <code>forall</code>s as type level lambdas in Core and GHC Haskell <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeApplication\" rel=\"nofollow noreferrer\">will allow direct access to this fact soon</a>. What you are talking about is more general, though and is a bit different. Because of this difference (I think), GHC Core <code>forall</code> lambdas are written as uppercase lambdas."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 5, "creation_date": 1445188118, "post_id": 33199488, "comment_id": 54206191, "body": "@DavidYoung I disagree. In GHC Core, foralls are written <code>forall</code> in <i>types</i>. In <i>terms</i>, these forall-types are introduced by <code>\\ @x -&gt; ...</code> which are analogous to System F uppercase lambdas, or &quot;type lambdas&quot;. These are term-level lambdas which bind types, to provide &quot;terms which depend on types&quot; as in System F. Still, there are no lambdas inside types, hence no type-level lambdas. (I do see that it&#39;s only a matter of terminology, not semantics. Still, in my limited experience a &quot;type-level lambda&quot; means another thing. I might be wrong on this, though :-) )"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445193843, "post_id": 33199488, "comment_id": 54208243, "body": "Pi is not lambda \u2014 it&#39;s pi. I think, if <code>F (\\t -&gt; Maybe (t,t))</code> would be allowed in Haskell, then it would be a type-level lambda, but in Agda it&#39;s just an ordinary term and hence plain old [value-level] lambda."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1445194531, "post_id": 33199488, "comment_id": 54208489, "body": "<code>forall</code> is not really the same thing as Pi in dependent type theory: it&#39;s parametric, so it behaves more like an <i>intersection</i> than a <i>product</i>. An inhabitant of a <code>forall a. t</code> type, given by some <code>&#47;\\a. b</code>, amounts to a <i>single</i> mechanism which works to deliver <code>t</code>, whatever <code>a</code> is given (relying on what they have in common). An inhabitant of a type <code>pi a. t</code> represents a bunch (like in a product) of potentially different mechanisms for computing a <code>t</code> for each possible <code>a</code>. Haskell doesn&#39;t have <code>pi</code> yet, but it&#39;s coming. Agda and Idris have <code>pi</code>, but could really do with <code>forall</code>, too."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1445197971, "post_id": 33199488, "comment_id": 54209751, "body": "@pigworker, but isn&#39;t <code>Pi (A : Set) ...</code> being parametric (I know, these two parametricities are different, but nevertheless) is basically the same as Haskell&#39;s <code>forall</code> (only for <code>Set</code> of course)?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445210341, "post_id": 33199488, "comment_id": 54213517, "body": "Calling <code>=&gt;</code> an &quot;implicit function&quot; isn&#39;t clarifying things for me. Why does that mean \u2014 &quot;is an instance of&quot;?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445246441, "post_id": 33199488, "comment_id": 54225850, "body": "@raxacoricofallapatorius The caller has to &quot;prove&quot; that the chosen <code>a</code> is an instance of the class by providing its methods as hidden arguments: this is done by the compiler under the hood. E.g. <code>f :: forall a. Show a =&gt; ...</code> is handled, roughly, as if it were <code>f :: (a-&gt;String) -&gt; ...</code>. In this way, when the code of <code>f</code> uses <code>show</code>, the compiler can simply invoke it through the implicit <code>a-&gt;String</code> argument. On calls to <code>f</code>, the compiler will add a suitable argument for the programmer, according to the available instances."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1445249280, "post_id": 33199488, "comment_id": 54227538, "body": "If you&#39;re going to use non-Haskell syntax in your answers (\u2200), then I at least suggest you explicitly state that you are and that when you say &quot;\u2200&quot; it should be read as &quot;forall&quot;. Or just don&#39;t do it and use the Haskell syntax to answer a Haskell question :)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 1, "creation_date": 1445255451, "post_id": 33199488, "comment_id": 54231270, "body": "@ChristopherArmstrong: <code>\u2200</code> isn&#39;t Haskell syntax any less than <code>forall</code>, both are enabled with GHC extensions. It just needs <code>-XUnicodeSyntax</code> in addition to <code>-XRankNTypes</code>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445347824, "post_id": 33199488, "comment_id": 54278780, "body": "@chi: <a href=\"http://www.haskellforall.com/2015/10/polymorphism-for-dummies.html\" rel=\"nofollow noreferrer\">I gather</a> that under the hood, <code>f :: forall a . a -&gt; a ...;  f x = ..</code> is something like <code>f @a x = ..</code>; but what about <code>f :: forall a. Show a =&gt; ...</code>? If that&#39;s handled roughly, as if it were <code>f :: (a-&gt;String) -&gt; ...</code>, where did the <code>forall</code> argument go? Shouldn&#39;t there be <i>two</i> additional hidden arguments:  a type for <code>forall</code> and a <code>Constraint</code> (or dictionary or list of functions?) for <code>=&gt;</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445348648, "post_id": 33199488, "comment_id": 54279414, "body": "@raxacoricofallapatorius Yes, precisely. In Core it&#39;s something like <code>f @a showMethod ... = ...</code>. Note that at runtime the <code>@a</code> argument is not really present. So, only a pointer to <code>showMethod :: a-&gt;String</code> is actually passed."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1445360677, "post_id": 33199488, "comment_id": 54287639, "body": "So conceptually (setting aside what&#39;a present at runtime), <code>forall</code> says that the function needs an argument that specifies type, and <code>=&gt;</code> says that a suitable collection of functions \u2014 <i>which presumably must be functions provided by some typeclass of which that type is an instance</i> \u2014 is <i>additionally</i> required? And these are not provided by the caller, but by GHC (based on context, especially what <i>is</i> provided by the caller, as conventional <code>-&gt;</code> arguments)?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1445181663, "last_edit_date": 1445181663, "creation_date": 1445180642, "answer_id": 33199488, "question_id": 33199180, "link": "https://stackoverflow.com/questions/33199180/relationship-between-haskells-forall-and/33199488#33199488", "title": "Relationship between Haskell&#39;s &#39;forall&#39; and &#39;=&gt;&#39;", "body": "<p>I suppose it helps if we add the implied parentheses:</p>\n\n<pre><code>(+) :: \u2200 a . ( Num a =&gt; (a -&gt; (a -&gt; a)) )\nid :: \u2200 a . ( a -&gt; a )\n</code></pre>\n\n<p>The <code>\u2200</code> always goes together with a <code>.</code>. It's basically special syntax meaning &ldquo;anything between <code>\u2200</code> and <code>.</code> are type variables that I want to introduce into the following scope&rdquo;<sup>&dagger;</sup></p>\n\n<p><code>=&gt;</code> denotes what Idris calls an implicit function: <code>Num a</code> is a <em>dictionary</em> for the <code>instance Num a</code>, and such a dictionary is implicitly needed whenever you're adding numbers. But whether <code>a</code> is a type variable here that was previously introduced by some <code>\u2200</code>, or a fixed type, doesn't really matter. You could also have</p>\n\n<pre><code>(+) :: Num Int =&gt; Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>That's just superfluous, because the compiler <em>knows</em> that <code>Int</code> is a <code>Num</code> instance and hence automatically (implicitly!) chooses the right dictionary.</p>\n\n<p>Really, there's no particular relationship between <code>\u2200</code> and <code>=&gt;</code>, they just happen to be used often together.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Actually this is a <em>type-level lambda</em>. The type expression <code>\u2200 a . b</code> behaves analogously to the value level expression <code>\\a -&gt; b</code>.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1445347895, "post_id": 33205024, "comment_id": 54278824, "body": "Can you say a bit more about what a &quot;dictionary&quot; is? Is that a list of functions (&quot;methods&quot;) with certain required type signatures?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1445348025, "post_id": 33205024, "comment_id": 54278921, "body": "And: aren&#39;t they&#39;re <i>two</i> <i>two</i> two hidden arguments in the example : a <a href=\"http://www.haskellforall.com/2015/10/polymorphism-for-dummies.html\" rel=\"nofollow noreferrer\">type for <code>formal</code></a>, a <code>Constraint</code> (or dictionary or list of functions?) for <code>=&gt;</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445355427, "post_id": 33205024, "comment_id": 54284400, "body": "@raxacoricofallapatorius, yes, there is a hidden type argument. I was talking about the arguments (potentially) passed at runtime; type applications don&#39;t survive compilation. A dictionary is a record containing (potentially) dictionaries for superclasses and (potentially) each class method. An <code>Applicative</code> dictionary might look something like <code>data ApplicativeDict f = ApplicativeDict {functorDict :: FunctorDict t, app :: forall a b . f (a -&gt; b) -&gt; f a -&gt; f b, pur :: forall a . a -&gt; f a, ...}</code>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1445360472, "post_id": 33205024, "comment_id": 54287532, "body": "So conceptually (setting aside what actually survives), <code>forall</code> says that the function needs an argument that specifies a type, and <code>=&gt;</code> says that a suitable collection of functions is <i>additionally</i> required? And these are not provided by the caller, but by GHC (based on context, especially what <i>is</i> provided by the caller, as conventional <code>-&gt;</code> arguments)?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445372338, "post_id": 33205024, "comment_id": 54294349, "body": "@raxacoricofallapatorus, the &quot;conventional&quot; arguments do constrain/guide the type checker, but they don&#39;t themselves &quot;carry&quot; dictionary information (except in the case of GADTs and existentials, which can). The dictionaries flow implicitly through the contexts. Simon Peyton Jones gave an excellent talk about the process at Microsoft a few years ago, and the video is online somewhere. BTW, see my edits."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1445372048, "last_edit_date": 1445372048, "creation_date": 1445216036, "answer_id": 33205024, "question_id": 33199180, "link": "https://stackoverflow.com/questions/33199180/relationship-between-haskells-forall-and/33205024#33205024", "title": "Relationship between Haskell&#39;s &#39;forall&#39; and &#39;=&gt;&#39;", "body": "<p>As the <code>forall</code> matter appears to be settled, I'll attempt to explain the <code>=&gt;</code> a bit. The things to the left of the <code>=&gt;</code> are arguments, much like ones to the left of a <code>-&gt;</code>. But you don't apply these arguments manually, and they can only have specific types.</p>\n\n<pre><code>f :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>is a function that takes two arguments:</p>\n\n<ol>\n<li>A <code>Num a</code> dictionary.</li>\n<li>An <code>a</code>.</li>\n</ol>\n\n<p>When you apply <code>f</code>, you just provide the <code>a</code>. GHC has to provide the <code>Num a</code>. If it's applied to a specific concrete type like <code>Int</code>, GHC knows <code>Num Int</code> and can supply it at the call site. Otherwise, it checks that <code>Num a</code> is provided by some outer context and uses that one. The great thing about Haskell's typeclass system is that it ensures that any two <code>Num a</code> dictionaries, however they are found, will be identical. So it doesn't matter where the dictionary comes from&mdash;it is sure to be the right one.</p>\n\n<h3>Further discussion</h3>\n\n<p>A lot of these things we're talking about aren't exactly part of Haskell so much as they're part of the way GHC interprets Haskell by translation to GHC core, AKA System FC, an extension of the very well-studied System F, AKA the Girard-Reynolds calculus. System FC is an explicitly typed polymorphic lambda calculus with algebraic datatypes, etc., but no type inference, no instance resolution, etc. After GHC checks the types in your Haskell code, it translates that code to System FC by a thoroughly mechanical process. It can do this confidently because the type checker \"decorates\" the code with all the information the desugarer needs to plumb all the dictionaries around. If you have a Haskell function that looks like</p>\n\n<pre><code>foo :: forall a . Num a =&gt; a -&gt; a -&gt; a\nfoo x y= x + y\n</code></pre>\n\n<p>then that will translate to something that looks like</p>\n\n<pre><code>foo :: forall a . Num a -&gt; a -&gt; a -&gt; a\nfoo = /\\ (a :: *) -&gt; \\ (d :: Num a) -&gt; \\ (x :: a) -&gt; \\ (y :: a) -&gt; (+) @a d x y\n</code></pre>\n\n<p>The <code>/\\</code> is a type lambda&mdash;it's just line a normal lambda except it takes a type variable. The <code>@</code> represents application of a type to a function that takes one. The <code>+</code> is really just a record selector. It chooses the right field from the dictionary it's passed.</p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1445348145, "post_id": 33205345, "comment_id": 54279014, "body": "How does this map to the <a href=\"http://www.haskellforall.com/2015/10/polymorphism-for-dummies.html\" rel=\"nofollow noreferrer\">hidden compiler-supplied arguments</a> that <code>forall</code> creates? Does <code>=&gt;</code> add another, or change the form of the one that  <code>forall</code> creates?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445392013, "post_id": 33205345, "comment_id": 54301140, "body": "Those are different things, so yes there will be &quot;extra arguments&quot; for the <code>forall</code>ed variables and for each type class dictionary. But they&#39;re also completely different kinds of &quot;implicit argument&quot;. A type variables introduced by <code>forall</code> is an &quot;implicit argument&quot; that is totally resolved at compile time, with zero presence or overhead at runtime (even without optimizations). It&#39;s also only an argument to the <i>type</i>, not to the actual function; that explanation is trying to get across that <code>forall a. a -&gt; a</code> should be seen as an infinite family of types, parameterised by the choice of <code>a</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445392232, "post_id": 33205345, "comment_id": 54301202, "body": "@raxacoricofallapatorius Type class dictionaries on the other hand are <i>genuinely</i> arguments at runtime; they have to be created and passed around between functions. <b>HOWEVER</b> I would strongly discourage you from trying to understand <code>forall</code> and <code>=&gt;</code> this way. The &quot;implicit arguments&quot; (either at type level in GHC&#39;s intermediate output, or at value level at runtime) are the <i>implementation strategy</i> for parametric polymorphism and type class constraints; not what they <i>mean</i>. There are alternative possible implementations."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445392508, "post_id": 33205345, "comment_id": 54301282, "body": "IMHO trying to explain type class constraints by talking about implicit dictionary passing is like trying to explain classes in Java by talking about vtables."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1445433745, "post_id": 33205345, "comment_id": 54322059, "body": "I agree; but once dictionaries (which I&#39;d never heard of before in this context) and &quot;what the compiler does&quot; were unleashed, they had to be run to ground; and the process, IMV, ended up being illuminating. Though you&#39;re correct that that all covers just one possible approach to realizing the meaning of <code>forall</code> and <code>=&gt;</code>, having one concrete example of how that meaning is made made the meaning clearer."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 5, "last_activity_date": 1445218826, "creation_date": 1445218826, "answer_id": 33205345, "question_id": 33199180, "link": "https://stackoverflow.com/questions/33199180/relationship-between-haskells-forall-and/33205345#33205345", "title": "Relationship between Haskell&#39;s &#39;forall&#39; and &#39;=&gt;&#39;", "body": "<p>(As another perspective, without invoking the \"implicit dictionary passing\" implementation of type classes):</p>\n\n<hr>\n\n<p><code>forall a.</code> in Haskell means \"for every type <code>a</code>\".<sup>1</sup> It's introducing a type variable, and declaring that the rest of the type expression has to be valid <em>whatever</em> choice is made for <code>a</code>.</p>\n\n<p>You usually don't see it in basic Haskell (without turning on any extensions in GHC), because it's not necessary; you just use type variables in your type signature, and GHC automatically assumes there are <code>forall</code>s introducing those variables at the start of the expression.</p>\n\n<p>For example:</p>\n\n<pre><code>zip :: forall a. ( forall b. ( [a] -&gt; [b] -&gt; [(a, b)] ))\nzip :: forall a. forall b. [a] -&gt; [b] -&gt; [(a, b)]\nzip :: forall a b. [a] -&gt; [b] -&gt; [(a, b)]\nzip :: [a] -&gt; [b] -&gt; [(a, b)]\n</code></pre>\n\n<p>The above are all the same; they just tell us that <code>zip</code> can be a way of zipping a list of <code>a</code> together with a list of <code>b</code> to make a list of <code>(a, b)</code> pairs, <em>whatever choice we feel like making for <code>a</code> and <code>b</code></em>.</p>\n\n<p><code>forall</code> mainly comes into play with extensions, because then you can introduce type variables with scopes <em>other</em> than the default ones assumed by GHC if you don't explicitly write them.</p>\n\n<hr>\n\n<p>Now, the <code>constraints =&gt; type</code> syntax can be read roughly as \"these constraints imply this type\", or \"provided these constraints hold, you can use this type\". It's used all the time, even in vanilla Haskell with no extensions, so it's important to understand what it means and how it works and not just copy and paste and hope.</p>\n\n<p>The <code>=&gt;</code> arrow allows us to state a set of constraints on the variables in the rest of the type expression; it lets us put limitations on what choices can be made to introduce the type variable. You should read it first by ignoring everything left of the <code>=&gt;</code> arrow, and reading the the right part on its own. This gives you the \"shape\" of the type. The stuff to the left of the <code>=&gt;</code> arrow tells you what kind of types you can use the rest of the type with.</p>\n\n<p>An example:</p>\n\n<pre><code>(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>This means that <code>(+)</code> is exactly the same kind of thing as anything with a simpler type like <code>a -&gt; a -&gt; a</code>, <em>except</em> the <code>Num a =&gt;</code> is telling us that we're not free to choose <strong>any</strong> type <code>a</code>. We can only choose a type for <code>a</code> when we know that it is a member of the <code>Num</code> type class (another slightly more precise way of saying \"<code>a</code> is a member of <code>Num</code> is \"the constraint <code>Num a</code> holds\").</p>\n\n<p>Note that GHC is still assuming that there's an implicit <code>forall a</code> to introduce the type variable <code>a</code> here, so it really looks like:</p>\n\n<pre><code>(+) :: forall a. Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>In which case you can read this off moderately easily as an English sentence once you know what <code>forall a.</code> and <code>Num a =&gt;</code> means: \"For every type <code>a</code>, provided <code>Num a</code> holds, plus has the type <code>a -&gt; a -&gt; a</code>\".</p>\n\n<hr>\n\n<p><sup>1</sup> If you're familiar with formal logic at all, it's just an ASCII-friendly way of writing \u2200a, a \"universally quantified variable\".</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 1, "accepted_answer_id": 33205345, "answer_count": 3, "score": 2, "last_activity_date": 1445372048, "creation_date": 1445178866, "question_id": 33199180, "link": "https://stackoverflow.com/questions/33199180/relationship-between-haskells-forall-and", "title": "Relationship between Haskell&#39;s &#39;forall&#39; and &#39;=&gt;&#39;", "body": "<p>I'm having trouble wrapping my mind around the relationship (and interactions) between Haskell's <code>forall</code> and <code>=&gt;</code> (and for that matter the <code>.</code> that often connects them).</p>\n\n<p>For example</p>\n\n<pre><code>\u03bb&gt; :t (+)\n\u03bb&gt; :t id\n</code></pre>\n\n<p>give</p>\n\n<pre><code>(+) :: forall a. Num a =&gt; a -&gt; a -&gt; a\nid :: forall a. a -&gt; a\n</code></pre>\n\n<p>and while I understand how these work in these specific cases, I'm not comfortable parsing the expressions (signatures?) <code>forall a. Num a =&gt;</code> or <code>forall a.</code> themselves into something meaningful, or that I can generally understand in more complex contexts.</p>\n\n<p>What do <code>forall a. Num a =&gt;</code> and <code>forall a.</code> mean? Specifically, what is the roles played in each by <code>forall</code>, <code>=&gt;</code> and <code>a</code>?</p>\n"}, {"tags": ["haskell", "yesod", "persist"], "answers": [{"comments": [{"owner": {"reputation": 759, "user_id": 572095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2778778df631702fe3b322265564f743?s=128&d=identicon&r=PG", "display_name": "patrick_corrigan", "link": "https://stackoverflow.com/users/572095/patrick-corrigan"}, "edited": false, "score": 0, "creation_date": 1445260541, "post_id": 33211541, "comment_id": 54234745, "body": "Thank you very much @madjar. I think I&#39;ve gotten close. Still not quite there."}, {"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "reply_to_user": {"reputation": 759, "user_id": 572095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2778778df631702fe3b322265564f743?s=128&d=identicon&r=PG", "display_name": "patrick_corrigan", "link": "https://stackoverflow.com/users/572095/patrick-corrigan"}, "edited": false, "score": 0, "creation_date": 1445262013, "post_id": 33211541, "comment_id": 54235825, "body": "The error you added with your edit doesn&#39;t look like a problem with the function. Maybe there&#39;s a problem with your route definition: it should be of the form <code>&#47;something&#47;#Int64</code>, not <code>&#47;something&#47;#MusicaUserId</code>, since the route functions takes an Int64."}, {"owner": {"reputation": 759, "user_id": 572095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2778778df631702fe3b322265564f743?s=128&d=identicon&r=PG", "display_name": "patrick_corrigan", "link": "https://stackoverflow.com/users/572095/patrick-corrigan"}, "edited": false, "score": 0, "creation_date": 1445263834, "post_id": 33211541, "comment_id": 54237234, "body": "Thank you very much!!!!! Incredible that routes are type safe. Would it be a good idea to create a new type using Int64 to make a facebookId type?"}, {"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "reply_to_user": {"reputation": 759, "user_id": 572095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2778778df631702fe3b322265564f743?s=128&d=identicon&r=PG", "display_name": "patrick_corrigan", "link": "https://stackoverflow.com/users/572095/patrick-corrigan"}, "edited": false, "score": 0, "creation_date": 1445267993, "post_id": 33211541, "comment_id": 54240508, "body": "A type alias (<code>type FacebookId = Int64</code>) could indeed increase the readability, but I feel more than that would be overkill."}, {"owner": {"reputation": 759, "user_id": 572095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2778778df631702fe3b322265564f743?s=128&d=identicon&r=PG", "display_name": "patrick_corrigan", "link": "https://stackoverflow.com/users/572095/patrick-corrigan"}, "edited": false, "score": 0, "creation_date": 1445295396, "post_id": 33211541, "comment_id": 54255125, "body": "Thank you. I&#39;ll do that. What file would be the best place to put that definition in? I&#39;ve taken 2 Haskell courses but this is my first time actually building something that isn&#39;t a data structure or numerical problem using Haskell. Thanks for the advice."}, {"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "reply_to_user": {"reputation": 759, "user_id": 572095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2778778df631702fe3b322265564f743?s=128&d=identicon&r=PG", "display_name": "patrick_corrigan", "link": "https://stackoverflow.com/users/572095/patrick-corrigan"}, "edited": false, "score": 0, "creation_date": 1445331165, "post_id": 33211541, "comment_id": 54267736, "body": "It very much depends on how your application is structured. I&#39;d put it near the routes definitions so that the <code>&#47;something&#47;#FacebookId</code> makes immediate sense."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 1, "last_activity_date": 1445248632, "creation_date": 1445248632, "answer_id": 33211541, "question_id": 33197918, "link": "https://stackoverflow.com/questions/33197918/getby404-vs-get404/33211541#33211541", "title": "getBy404 vs get404", "body": "<p>When you look at <a href=\"http://hackage.haskell.org/package/persistent-1.1.0/docs/Database-Persist-Store.html#t%3AEntity\" rel=\"nofollow\">the definition of Entity</a>, you can see that it is just a container for an entity and it's key. You can use the two functions <code>entityKey</code> and <code>entityVal</code> to extract the key and the value from the return value of <code>getBy404</code>.</p>\n"}], "owner": {"reputation": 759, "user_id": 572095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2778778df631702fe3b322265564f743?s=128&d=identicon&r=PG", "display_name": "patrick_corrigan", "link": "https://stackoverflow.com/users/572095/patrick-corrigan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 33211541, "answer_count": 1, "score": 1, "last_activity_date": 1445263948, "creation_date": 1445171262, "last_edit_date": 1495542216, "question_id": 33197918, "link": "https://stackoverflow.com/questions/33197918/getby404-vs-get404", "title": "getBy404 vs get404", "body": "<p>I'm trying to build a rest service using the Yesod web framework. I can get entries by Id but I cannot get them by unique key. It's because the types signature of getBy404 is different to get404. getBy404 returns the value wrapped in a Entity and get404 returns the pure value.</p>\n\n<pre><code>module Handler.MusicaUser where\nimport Import\n\ngetMusicaUserR :: MusicaUserId -&gt; Handler Value\ngetMusicaUserR pid = do\npost &lt;- runDB $ get404 pid\n\n    return $ object [\"user\" .= (Entity pid post)]\n\nputMusicaUserR :: MusicaUserId -&gt; Handler Value\nputMusicaUserR pid = do\n    post &lt;- requireJsonBody :: Handler MusicaUser\n\n    runDB $ replace pid post\n\n    sendResponseStatus status200 (\"UPDATED\" :: Text)\n\ndeleteMusicaUserR :: MusicaUserId -&gt; Handler Value\ndeleteMusicaUserR pid = do\n    runDB $ delete pid\n\n    sendResponseStatus status200 (\"DELETED\" :: Text)\n</code></pre>\n\n<p>I have tried modifying my code using this example</p>\n\n<p><a href=\"https://stackoverflow.com/questions/13793336/why-does-this-code-work-with-yesod-persists-get404-but-not-getby404\">Why does this code work with Yesod.Persist&#39;s get404 but not getBy404?</a></p>\n\n<p>Thank. I appreciate your help.</p>\n\n<p>EDIT</p>\n\n<p>I think I'm getting closer</p>\n\n<pre><code>getMusicaUserR :: Int64 -&gt; Handler Value\ngetMusicaUserR facebookId = do\n   user &lt;- runDB $ getBy404 (UniqueFacebookId facebookId)\n   return $ object [\"user\" .= (user)]\n</code></pre>\n\n<p>The error I get now is </p>\n\n<pre><code>Application.hs:41:1:\n    Couldn't match type \u2018Int64\u2019 with \u2018Key MusicaUser\u2019\n    Expected type: MusicaUserId\n      Actual type: Int64\n    In the first argument of \u2018MusicaUserR\u2019, namely \u2018dyn_al6K\u2019\n    In the first argument of \u2018Just\u2019, namely \u2018MusicaUserR dyn_al6K\u2019\n</code></pre>\n\n<p>Is Int64 the correct type for my function. The reason I used it is because that is how facebookId is defined in my model. I have also tried using UniqueFacebookId.</p>\n\n<p>To fix the above error I needed to change my routes definitions to </p>\n\n<p>/users/#Int64 instead of /users/MusicaUserId</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1445165120, "post_id": 33195628, "comment_id": 54199183, "body": "Interesting. For my daily work I assume that the way builder -&gt; lazy ByteString -&gt; strict Bytestring only pays off when building a large string from a large number of short ones. I usually do pack . show for converting from numbers to strict bs... don&#39;t know if it is good. Could you post some code that can be used for measuring performance? This looks like an interesting issue."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1445166907, "post_id": 33195628, "comment_id": 54199688, "body": "There are two branches of the &quot;postgresql-binary&quot; project, which implement the encoders using the two mentioned different strategies. Both come with benchmarks of encoding performance. Here&#39;s <a href=\"https://github.com/nikita-volkov/postgresql-binary/tree/911a32110cfd618e2f7d377f4acc4c8f593f9acc\" rel=\"nofollow noreferrer\">a tree, in which the encoders are implemented using direct <code>ByteString</code> construction</a>, here&#39;s <a href=\"https://github.com/nikita-volkov/postgresql-binary/tree/2fb6954968763621cbbdb8ba8505434ec2961b9e\" rel=\"nofollow noreferrer\">the one revolving around <code>Builder</code></a>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1445187210, "post_id": 33195628, "comment_id": 54205894, "body": "I think the trouble is <code>Builder</code> doesn&#39;t maintain a count of bytes required to write the resulting bytestring out, even though when you&#39;re not doing lazy streaming this is either statically-known (O(1)) or O(n)-but-probably-worth-it. You might check out <code>buffer-builder</code> and see if it does what you need. See discussion here:  <a href=\"https://github.com/chadaustin/buffer-builder/issues/7\" rel=\"nofollow noreferrer\">github.com/chadaustin/buffer-builder/issues/7</a>"}, {"owner": {"reputation": 707, "user_id": 646408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62561db40e46118628b31cba87840d6?s=128&d=identicon&r=PG", "display_name": "lpsmith", "link": "https://stackoverflow.com/users/646408/lpsmith"}, "edited": false, "score": 0, "creation_date": 1446027229, "post_id": 33195628, "comment_id": 54568513, "body": "Have you tried tweaking the allocation strategy?   Constructing a small bytestring using builder defaults to allocating a large bytestring,  then allocating a small bytestring of the correct length.    Also,  <code>blaze-builder</code> has a <code>writeToByteString</code> that might make using prims considerably more efficient (there&#39;s a function to turn prims into writes); it could be even better if you implement a <code>primFixedToByteString</code> and/or a <code>primBoundedToBytestring</code>."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 707, "user_id": 646408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62561db40e46118628b31cba87840d6?s=128&d=identicon&r=PG", "display_name": "lpsmith", "link": "https://stackoverflow.com/users/646408/lpsmith"}, "edited": false, "score": 0, "creation_date": 1446030567, "post_id": 33195628, "comment_id": 54570621, "body": "@lpsmith Thanks. I&#39;ll consider that."}], "answers": [{"comments": [{"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1445295876, "post_id": 33197417, "comment_id": 54255297, "body": "Thanks! You mention &quot;better ways&quot;. What do you imply? Are there any libraries you would suggest?"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1445336047, "post_id": 33197417, "comment_id": 54270901, "body": "@NikitaVolkov I meant better for performance ad-hoc ways, like <code>unfoldrN</code>. I don&#39;t know any specific library that makes life easier, and I usually use bytestring builder when performance is not critical."}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 0, "creation_date": 1457520297, "post_id": 33197417, "comment_id": 59439699, "body": "What about concatenating small strict bytestrings? Is it most efficient to just use <code>append</code> and/or <code>concat</code>?"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 7, "last_activity_date": 1445167644, "creation_date": 1445167644, "answer_id": 33197417, "question_id": 33195628, "link": "https://stackoverflow.com/questions/33195628/efficiently-creating-strict-bytestrings/33197417#33197417", "title": "Efficiently creating strict ByteStrings", "body": "<p>Builder is not a zero-cost abstraction, it is optimized for large lazy strings. From the builder <a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Builder.html\">docs</a>:</p>\n\n<blockquote>\n  <p>The current implementation is tuned for an average chunk size between 4kb and 32kb</p>\n</blockquote>\n\n<p>In your case, builder allocates whole 4k chunk just to produce 8 bytes.</p>\n\n<p>Compare with <code>pack</code>, which calculates necessary buffer size, allocates it and then fills it in a loop. The only source of inefficiency is a list of 8 <code>Word8</code> allocated upfront. Probably <a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString.html#v:unfoldrN\"><code>unfoldrN</code></a> will be even more efficient.</p>\n\n<p>Using builder to construct small strict bytestrings is sometimes convenient, but there are better ways.</p>\n"}, {"tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": false, "score": 3, "last_activity_date": 1446043381, "last_edit_date": 1446043381, "creation_date": 1446042648, "answer_id": 33393827, "question_id": 33195628, "link": "https://stackoverflow.com/questions/33195628/efficiently-creating-strict-bytestrings/33393827#33393827", "title": "Efficiently creating strict ByteStrings", "body": "<p>Try using <code>toLazyByteStringWith</code> from <code>Data.ByteString.Builder.Extra</code> to tune your <code>ByteString</code> construction.  This takes an <code>AllocationStrategy</code> that lets you tune the buffer size and growth rate.</p>\n"}], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 1, "accepted_answer_id": 33197417, "answer_count": 2, "score": 12, "last_activity_date": 1446043381, "creation_date": 1445155219, "question_id": 33195628, "link": "https://stackoverflow.com/questions/33195628/efficiently-creating-strict-bytestrings", "title": "Efficiently creating strict ByteStrings", "body": "<p>Recently after running benchmarks on my project I've discovered that direct construction of strict bytestrings can be an order of magnitude faster than the one involving a builder.</p>\n\n<p>E.g., an encoder implementation, which uses a builder:</p>\n\n<pre><code>encoder :: Int64 -&gt; Data.ByteString.ByteString\nencoder =\n  Data.ByteString.Lazy.toStrict .\n  Data.ByteString.Builder.toLazyByteString .\n  Data.ByteString.Builder.int64BE\n</code></pre>\n\n<p>performs like 10 times worse than the one, which constructs the bytestring directly, and has several possibilities for further optimization:</p>\n\n<pre><code>encoder :: Int64 -&gt; Data.ByteString.ByteString\nencoder =\n  unpackIntBySize 8\n\nunpackIntBySize :: (Bits a, Integral a) =&gt; Int -&gt; a -&gt; Data.ByteString.ByteString\nunpackIntBySize n x =\n  Data.ByteString.pack $ map f $ reverse [0..n - 1]\n  where\n    f s =\n      fromIntegral $ shiftR x (8 * s)\n</code></pre>\n\n<p>So my question is a two-fold:</p>\n\n<ol>\n<li><p>Why is there no direct conversion from <code>Builder</code> to strict <code>ByteString</code>? It's annoying, because I often have to import <code>Data.ByteString.Lazy</code> just to use its <code>toStrict</code> function, because <code>Data.ByteString.Builder</code> exposes only <code>toLazyByteString</code>.</p></li>\n<li><p>The mentioned experience however made me wonder, if it's not there for a reason. With the reason being that I'm applying an incorrect pattern of usage altogether. So, is it indeed incorrect and is there a better alternative? BTW, I know about <code>Data.ByteString.Builder.Prim</code>, but I doubt that using it in a case as above, would make much difference.</p></li>\n</ol>\n"}, {"tags": ["haskell", "state-monad"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1445143138, "last_edit_date": 1445143138, "creation_date": 1445142705, "answer_id": 33194314, "question_id": 33194267, "link": "https://stackoverflow.com/questions/33194267/haskell-state-monad/33194314#33194314", "title": "Haskell State Monad", "body": "<p>There's nothing magical about <code>State</code>. You could implement it like this:</p>\n\n<pre><code>newtype State s a = State {runState :: s -&gt; (a, s)}\n</code></pre>\n\n<p>That is, a <code>State s a</code> (which we think of as a computation that uses a state of type <code>s</code> to produce a result of type <code>a</code>) is just a function that takes a state and returns a result and a new state. You should attempt to write out the <code>Monad</code> instance and definitions of <code>get</code> and <code>put</code> for this definition. The real definition is more general:</p>\n\n<pre><code>type State s = StateT s Identity\nnewtype Identity a = Identity a\nnewtype StateT s m a = StateT {runStateT :: s -&gt; m (a, s)}\n</code></pre>\n\n<p>This allows state to be added to other monadic computations. It's also possible to define state transformers as \"operational monads\". Apfelmus has a tutorial on those somewhere.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1445242844, "creation_date": 1445242844, "answer_id": 33209721, "question_id": 33194267, "link": "https://stackoverflow.com/questions/33194267/haskell-state-monad/33209721#33209721", "title": "Haskell State Monad", "body": "<p>First, the state isn't \"global\" as such; you could have several different copies of the state monad running, each with its own independent state, and they won't interfere with each other. (Indeed, that's arguably the whole point.) If you wanted the state to be global to the entire program, you'd have to put the entire program into a single state monad.</p>\n\n<p>Second, calling <code>put</code> changes the result that subsequent calls to <code>get</code> will return. That's all. It doesn't \"change\" the actual value itself. Like, if you call <code>get</code> and put the result into a variable somewhere, and then call <code>put</code>, your variable won't change. Even if the state is a dictionary or something, if you were to add a new key and <code>put</code> that, anybody still looking at the old copy of the dictionary will still see the old dictionary. This isn't special to the state monad; it's just how Haskell works.</p>\n"}, {"tags": [], "owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "is_accepted": true, "score": 6, "last_activity_date": 1445268644, "creation_date": 1445268644, "answer_id": 33218370, "question_id": 33194267, "link": "https://stackoverflow.com/questions/33194267/haskell-state-monad/33218370#33218370", "title": "Haskell State Monad", "body": "<p>The answer is in the types.  </p>\n\n\n\n<pre><code>newtype State s a = State {runState :: s -&gt; (a, s)}\n</code></pre>\n\n<p>Thus, a state is essentially a function that takes one parameter, 's' (which we call the state), and returns a tuple (value, state).  The monad is implemented like below</p>\n\n\n\n<pre><code>instance Monad (State s) where\n  return a = State $ \\s -&gt; (a,s)\n  (State f) &gt;&gt;= h = State $ \\s -&gt; let (a,s') =  f s\n                                  in (runState h a) s'\n</code></pre>\n\n<p>Thus, you have a function that operates on the initial state and spits out a value-state tuple to be processed by the next function in the composition.</p>\n\n<p>Now, <code>put</code> is the following function.</p>\n\n<pre><code>put newState = State $ \\s -&gt; ((),newState)\n</code></pre>\n\n<p>This essentially sets the state that will be passed to the next function in the composition and the downstream function will see the modified state.  </p>\n\n<p>In fact, the State monad is completely pure (that is, nothing is being set); only what is passed downstream changes.  In other words, the State monad saves you the trouble of carrying around a state explicitly in a pure language like Haskell.  In other words, State monad just provides an interface that hides the details of state threading (that's what is called in the WikiBooks and or Learn you a Haskell, I think).</p>\n\n<p>The following shows this in action.  You have get, which sets the value field to be the same as the state field (Note that, when I mean setting, I mean the output, not a variable).  <code>put</code> gets the state via the value passed to it, increments it and sets the state with this new value.</p>\n\n<pre><code>-- execState :: State s a -&gt; s -&gt; s\nlet x =  get &gt;&gt;= \\x -&gt; put (x+10)\nexecState x 10\n</code></pre>\n\n<p>The above outputs 20.</p>\n\n<p>Now, let's do the following.</p>\n\n<pre><code>execState (x &gt;&gt; x) 10\n</code></pre>\n\n<p>This will give an output of 30.  The first <code>x</code> sets the state to 20 via the put.  This is now used by the second <code>x</code>.  The <code>get</code> at this point sets the state passed it to the value field, which is now 20.  Now, our put will get this value, increment it by 10 and set this as the new state.</p>\n\n<p>Thus, you have states in a pure context.  Hope this helps.</p>\n"}], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1233, "favorite_count": 0, "accepted_answer_id": 33218370, "answer_count": 3, "score": 5, "last_activity_date": 1583767651, "creation_date": 1445141983, "last_edit_date": 1583767651, "question_id": 33194267, "link": "https://stackoverflow.com/questions/33194267/haskell-state-monad", "title": "Haskell State Monad", "body": "<p>Does the <code>put</code> function of the State Monad update the actual state or does it just return a new state with the new value? My question is, can the State Monad be used like a \"global variable\" in an imperative setting? And does <code>put</code> modify the \"global variable\"?</p>\n\n<p>My understanding was NO it does NOT modify the initial state, but using the monadic interface we can just pass around the new states b/w computations, leaving the initial state \"intact\". Is this correct? if not, please correct me. </p>\n"}, {"tags": ["haskell", "data-structures", "grid", "zipper"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1445128013, "post_id": 33193052, "comment_id": 54191859, "body": "Do you mean like a 2-dimensional grid? Related SO discussion: <a href=\"http://stackoverflow.com/questions/8905030/two-dimensional-zipper\" title=\"two dimensional zipper\">stackoverflow.com/questions/8905030/two-dimensional-zipper</a>"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1445128335, "post_id": 33193052, "comment_id": 54191919, "body": "OK, I understand one can not build a bidimensional zipper as defined. But does that mean it is simply impossible to efficiently walk through a 2d grid? I find that hard to believe..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1445134396, "post_id": 33193052, "comment_id": 54192940, "body": "@Viclib Actually, I don&#39;t think anybody is claiming it&#39;s impossible. As far as I know, it&#39;s an open question whether it&#39;s possible."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1445138344, "post_id": 33193052, "comment_id": 54193566, "body": "Suppose you have a completely filled quadtree with a specific depth. That forms a grid. Isn&#39;t it possible to walk from any tile to any neighbor in amortized constant time?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 3, "creation_date": 1445142915, "post_id": 33193052, "comment_id": 54194234, "body": "Quick googling gave me <a href=\"http://pastebin.com/f55d96074\" rel=\"nofollow noreferrer\">this</a>. tl;dr though."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1445165569, "post_id": 33193052, "comment_id": 54199321, "body": "How sparsely is this grid populated? Would you be better off using grid coordintes as keys in a map of some sort?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1445165662, "post_id": 33193052, "comment_id": 54199347, "body": "I think so, maybe. It is densely packed as it is a map for a game."}, {"owner": {"reputation": 775, "user_id": 3286185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a141681120ffb0004d8d60bb191f89b8?s=128&d=identicon&r=PG", "display_name": "gelisam", "link": "https://stackoverflow.com/users/3286185/gelisam"}, "edited": false, "score": 2, "creation_date": 1445166412, "post_id": 33193052, "comment_id": 54199553, "body": "To &quot;Isn&#39;t it possible to walk from any tile to any neighbor in amortized constant time?&quot;: In log time, not constant time, since you could walk back and forth between two tiles which require going up and down several levels."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1445169701, "post_id": 33193052, "comment_id": 54200382, "body": "Key question: are the map data fixed up front, or do they mutate over the course of execution. Laziness makes it easy (if you know how) to cook up read-only graph structures with constant-time navigation. But mutating structures with more than tree-like pointer inconnection is inevitably a bad show for purely functional programming."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1445174812, "post_id": 33193052, "comment_id": 54201805, "body": "Gelisam but sometimes it takes just two movements. Roughly 50% of the tiles take 2 movements to to a neighbor. 25% take 4. And so on. It is very rare for it to take log(n). Isn&#39;t the average constant?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1445200636, "post_id": 33193052, "comment_id": 54210658, "body": "But it&#39;s fixed <i>which</i> cells have higher costs, so a pathologic series of moves can force you to pay log(n) all the time. It&#39;s only amortized constant if you make assumptions about the moves you&#39;ll have to do that forbids the pathological cases."}, {"owner": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "edited": false, "score": 0, "creation_date": 1467067598, "post_id": 33193052, "comment_id": 63567629, "body": "@Viclib I&#39;d also like to try to make a simple 2D game (~ HOMM3) with dynamic maps, using immutable/functional structures if possible. Have you found an answer?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "edited": false, "score": 0, "creation_date": 1467114923, "post_id": 33193052, "comment_id": 63587565, "body": "Nothing really satisfactory, @samboosalis."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1445137702, "post_id": 33193785, "comment_id": 54193485, "body": "The pattern is random because the problem is implementing a map for a game where creatures will walk through..."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 6, "last_activity_date": 1445136504, "creation_date": 1445136504, "answer_id": 33193785, "question_id": 33193052, "link": "https://stackoverflow.com/questions/33193052/how-do-you-zip-through-a-bidimensional-grid-purely-functionally/33193785#33193785", "title": "How do you zip through a bidimensional grid purely functionally?", "body": "<p>The real question is, what do you want to walk through a 2D grid to do?</p>\n\n<p>Is it random access, or some pattern?  Dynamic programming problems are often\nmodeled as traversing a 2D grid, but it's not random access, it's quite\npatterned. And patterns we can work with.</p>\n\n<hr>\n\n<p>For example, consider the problem finding the edit distance between two strings, where we're given:</p>\n\n<pre><code>-- the cost of replacing one character with another\ncharEditCost :: Char -&gt; Char -&gt; Int\n\n-- the cost of inserting a character\ncharInsertCost :: Char -&gt; Int\n</code></pre>\n\n<p>We can give the following recurrence for determining the edit distance between two strings:</p>\n\n<pre><code>editDistance [] [] = 0\neditDistance (a:as) [] = editDistance as [] + charInsertCost a\neditDistance [] (b:bs) = editDistance [] bs + charInsertCost b\neditDistance (a:as) (b:bs) = minimum\n  [ editDistance as bs + charEditCost a b\n  , editDistance (a:as) bs + charInsertCost b\n  , editDistance as (b:bs) + charInsertCost a\n  ]\n</code></pre>\n\n<p>But that's really inefficient - note how in the fourth equation, <code>editDistance as bs</code> would be calculated three times - once directly,\nonce by <code>editDistance (a:as) bs</code>, and once by <code>editDistance as (b:bs)</code>.</p>\n\n<p>The dynamic programming technique tells us to introduce the two-dimensional grid to cache results:</p>\n\n<pre><code>editDistance as bs = last . last $ grid where \n  firstRow j = grid !! 0 !! (j-1) + charInsertCost (as!!j)\n  firstCol i = grid !! (i-1) !! 0 + charInsertCost (bs!!i)\n  innerCel i j = minimum\n    [ grid !! (i-1) !! (j-1) + charEditCost (as!!j) (bs!!i)\n    , grid !! i !! (j-1) + charInsertCost (as!!j)\n    , grid !! (i-1) !! j + charInsertCost (bs!!j)\n    ]\n  grid = (          0 : [ firstRow j   | j &lt;- [1..length as] ] ) : \n       [ ( firstCol i : [ innerCel i j | j &lt;- [1..length as] ] ) | i &lt;- [1..length bs ]\n</code></pre>\n\n<p>This still gives horrible asymptotics since <code>!!</code> is O(n). But we can improve on this by noting we don't need random access; we know exactly which cells we need to compute each cell of the grid. So all we need to do is provide those cells when needed.</p>\n\n<p>So much like the classic <code>fibs = 1 : 1 : zipWith (+) fibs (tail fibs)</code> provides <code>fibs!!(i-1)</code> and <code>fibs!!(i-2)</code> just in time to calculate <code>fibs!!i</code>,\nwe can do the same here.</p>\n\n<pre><code>editDistance as bs = last . last $ grid where\n  firstRow = scanl (+) 0 $ map charInsertCost as\n  firstCol = scanl (+) 0 $ map charInsertCost bs\n  grid = ( 0 : firstRow ) : zipWith3 mkRow bs firstCol grid\n  mkRow b firstCel lastRow = let thisRow = firstCel : zipWith4 (mkCel b) as thisRow lastRow (tail lastRow) in thisRow\n  mkCel b a leftCel aboveLeftCel aboveCel = minimum\n    [ aboveLeftCel + charEditCost b a\n    , aboveCel + charInsertCost b\n    , leftCel + charInsertCost a\n    ]\n</code></pre>\n\n<hr>\n\n<p>Not every problem on a 2D grid is amenable to this kind of knot-tying, but it does work for some.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1445138065, "creation_date": 1445127859, "last_edit_date": 1445138065, "question_id": 33193052, "link": "https://stackoverflow.com/questions/33193052/how-do-you-zip-through-a-bidimensional-grid-purely-functionally", "title": "How do you zip through a bidimensional grid purely functionally?", "body": "<p>Using the list zipper, for example, one is able to walk through a unidimensional space. Is there any similarly elegant and efficient way to encode the notion of walking (with no pattern) through a bidimensional grid?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1445120733, "post_id": 33192048, "comment_id": 54190249, "body": "The assumption &quot;their sequential execution will not be affected by other <code>IO</code>s&quot; can not be relied upon by &quot;safe&quot; routines, since we can always pass some <code>IO</code> action which violates said assumption. So, you really need some &quot;unsafe&quot; primitive at a certain point."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1445122373, "post_id": 33192048, "comment_id": 54190621, "body": "Are you triple double sure that their executions will not be affected by other <code>IO</code>s? For example, the obvious way to write your <code>getLine</code> example is <code>allLines = do { x &lt;- unsafeInterleaveIO getLine; xs &lt;- unsafeInterleaveIO allLines; return (x:xs) }</code>, yet this is subtly different from <code>allLines&#39; = lines &lt;$&gt; getContents</code>. Can you see why?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1445153437, "post_id": 33192048, "comment_id": 54196155, "body": "Doesn&#39;t Rein Heinrich&#39;s answer in the linked thread already answer this one?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1445203807, "post_id": 33192048, "comment_id": 54211672, "body": "@ErikAllik If the problem isn&#39;t sequentially reading a handle or similar, but interleaving effects for some arbitrary IO action, then probably not. They probably want <code>unsafeInterleaveIO</code> somewhere, depending on what specifically they are doing. Or they want to reformulate the problem in terms of something that <i>can</i> be solved using iteratees."}], "answers": [{"tags": [], "owner": {"reputation": 1587, "user_id": 3271946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/446c713f3dc5528707d32819146a9789?s=128&d=identicon&r=PG&f=1", "display_name": "ArunasR", "link": "https://stackoverflow.com/users/3271946/arunasr"}, "is_accepted": false, "score": 0, "last_activity_date": 1445292372, "creation_date": 1445292372, "answer_id": 33224763, "question_id": 33192048, "link": "https://stackoverflow.com/questions/33192048/is-it-possible-to-have-a-lazy-version-of-sequence-without-using-unsafeios/33224763#33224763", "title": "Is it possible to have a lazy version of `sequence` without using `unsafeIO`s?", "body": "<p>Maybe you are looking for this?</p>\n\n<pre><code>main = do\n  let inputs = repeat getLine\n  mapM_ (&gt;&gt;=putStrLn) inputs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1458366501, "creation_date": 1458366501, "answer_id": 36098358, "question_id": 33192048, "link": "https://stackoverflow.com/questions/33192048/is-it-possible-to-have-a-lazy-version-of-sequence-without-using-unsafeios/36098358#36098358", "title": "Is it possible to have a lazy version of `sequence` without using `unsafeIO`s?", "body": "<p>Just to bell the cat: <em>No</em>.</p>\n\n<p>If you have something of type <code>IO a</code>, there is no way to get <em>any</em> information out of that <code>a</code> without fully executing that <code>IO</code> block. Conceptually, that <code>act :: IO a</code> could be defined as an arbitrary complicated set of actions, followed by then just producing a result dependent on a call to the system random number generator.</p>\n\n<p>The entire purpose of <code>unsafeInterleaveIO</code> is perform what you're asking, and it can't be done without it.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1458366501, "creation_date": 1445119336, "last_edit_date": 1495540772, "question_id": 33192048, "link": "https://stackoverflow.com/questions/33192048/is-it-possible-to-have-a-lazy-version-of-sequence-without-using-unsafeios", "title": "Is it possible to have a lazy version of `sequence` without using `unsafeIO`s?", "body": "<p>If I have a possibly infinite list of <code>IO</code>-monads, and I am guaranteed that their sequential execution will not be affected by other <code>IO</code>s, can I somehow make it lazily sequenced (evaluated)?</p>\n\n<p>To clarify my point, here is some pseudo-Haskell code demonstrating what I had in mind:</p>\n\n<pre><code>main = do\n    inputs &lt;- sequence . repeat $ getLine -- we are forever stuck here\n    mapM_ putStrLn inputs -- not going to run\n</code></pre>\n\n<p>Now, I know that in the particular example above, we can just use <code>getContents</code> to get the effect I want</p>\n\n<pre><code>main = do\n    inputs &lt;- return . lines =&lt;&lt; getContents\n    mapM_ putStrLn inputs\n</code></pre>\n\n<p>but in my application the <code>IO</code> monads are not <code>getLine</code> but an external function <code>get1 :: IO (Maybe Record)</code>. However, this actually brings my point, because apparently <code>getContents</code> internally uses <code>unsafeIO</code>s to achieve this lazy-effect. My question is, is that necessary? (If you are interested in what exactly I want to do, please refer to <a href=\"https://stackoverflow.com/questions/33182492/how-do-i-separate-a-stream-of-1s-and-2s-into-groups\">this question</a>.)</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1445117900, "post_id": 33191828, "comment_id": 54189457, "body": "The only problem I see is that <code>put x</code> should be <code>put newX</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1445118396, "post_id": 33191828, "comment_id": 54189590, "body": "To test that code you need to define an instance. Define a standard <code>State</code> monad (or any other monad having some state inside), first providing only <code>get,put</code> and test the derived <code>modify</code>. Then, define only <code>modify</code> in the instance, and test the derived <code>get,put</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1445119152, "post_id": 33191828, "comment_id": 54189826, "body": "and maybe it is just here at stackoverflow but I think your <code>modify</code> has incorrect indentation after the <code>do</code>."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1445258566, "post_id": 33191828, "comment_id": 54233344, "body": "<code>modify :: m ()</code>, <code>\\_ -&gt; s == const s</code>"}], "owner": {"reputation": 137, "user_id": 4628687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1ee61a2e40c9cacd5f65490be4578b3?s=128&d=identicon&r=PG&f=1", "display_name": "Enzo", "link": "https://stackoverflow.com/users/4628687/enzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1450755783, "creation_date": 1445117694, "last_edit_date": 1450755783, "question_id": 33191828, "link": "https://stackoverflow.com/questions/33191828/define-get-and-put", "title": "define Get and put", "body": "<p>For a school programming exercise i'm asked to implement <code>get</code> and <code>put</code> in terms of <code>modify</code> and <code>modify</code> in terms of <code>get</code> and <code>put</code>. So I've been puzzling with a few stack overflow posts and other material to put the pieces together. this is what i have thus far  </p>\n\n<pre><code>class Monad m =&gt; MonadState m s | m -&gt; s where\n\n    get :: m s\n    get  =  modify id -- (\\s -&gt; s)\n\n    put :: s -&gt; m ()\n    put s = do\n        modify (\\_ -&gt; s)\n        return ()\n\n\n    modify :: (s -&gt; s) -&gt; m s\n    modify f = do\n        x &lt;- get\n        let newX = f x\n        put x\n        return newX\n</code></pre>\n\n<p>I already figured that its not functioning properly, so my question is how do i test this code in ghci? and maybe push me in the right direction.</p>\n\n<p>Edit: \nThe whole monad idea is a bit overwhelming and I honestly have no idea how I could test it or see it at work.</p>\n"}, {"tags": ["haskell", "tree", "label"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1445112912, "post_id": 33190902, "comment_id": 54188161, "body": "Hint: what does <code>n &lt;- get</code> do? Does it matter which line it goes on?"}, {"owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1445113765, "post_id": 33190902, "comment_id": 54188378, "body": "Thank you, that was all I needed :)"}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "edited": false, "score": 0, "creation_date": 1445194557, "post_id": 33191891, "comment_id": 54208495, "body": "Just to avoid confusion, it wasn&#39;t MY question, I just had the same question. Very interesting read on your solution and very elegant use of some of haskell&#39;s properties."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 1, "last_activity_date": 1445196586, "last_edit_date": 1495535228, "creation_date": 1445118083, "answer_id": 33191891, "question_id": 33190902, "link": "https://stackoverflow.com/questions/33190902/labeling-a-tree-depth-first-in-order-in-haskell/33191891#33191891", "title": "Labeling a tree depth-first in-order in haskell", "body": "<p>I just answered the older question <a href=\"https://stackoverflow.com/a/33191820/828361\">here</a>. Sorry for mistakenly attributing to to you. The point is that when you wrote your type, you also told Haskell how to <code>traverse</code> your data structure in a way that ensures the <code>get</code> happens in the middle.</p>\n\n<p>The program that you locally wrote incorrectly yourself is a program you already wrote correctly just by defining your type, had you only known.</p>\n"}], "owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 33191891, "answer_count": 1, "score": 1, "last_activity_date": 1445196586, "creation_date": 1445111348, "last_edit_date": 1495535228, "question_id": 33190902, "link": "https://stackoverflow.com/questions/33190902/labeling-a-tree-depth-first-in-order-in-haskell", "title": "Labeling a tree depth-first in-order in haskell", "body": "<p>I basicly have the same question as asked here: <a href=\"https://stackoverflow.com/q/26401264/5355979\">Haskell label a binary tree through depht-first in-order traversel</a> but the answer there was never actually given and I can't comment there due to lack of reputation.</p>\n\n<p>Right now i have a function <code>label</code>:</p>\n\n<pre><code>label :: MonadState m Int =&gt; Tree a -&gt; m (Tree (Int, a))\nlabel Leaf = return Leaf\nlabel (Branch leftTree a rightTree) = do n &lt;- get\n                                         modify (+1)      \n                                         l' &lt;- label leftTree\n                                         r' &lt;- label rightTree\n                                         return (Branch l' (n,a) r')\n</code></pre>\n\n<p>where <code>Tree a = Leaf | Branch (Tree a) a (Tree a)</code>.</p>\n\n<p>Now this labels the tree breadth-first. Now I want to label the <code>leftTree</code> first, then the <code>Branch</code> itself and then the <code>rightTree</code>, but I don't see how to achieve this and the other thread doesn't help me further.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1445105081, "post_id": 33189695, "comment_id": 54185511, "body": "Possibly related : <a href=\"http://stackoverflow.com/questions/25618803/functions-as-arguments-to-be-used-in-template-haskell-quote\" title=\"functions as arguments to be used in template haskell quote\">stackoverflow.com/questions/25618803/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1445212106, "post_id": 33197517, "comment_id": 54213906, "body": "<code>&#39;&#39;Int</code> is not pattern syntax, so naturally the compiler will complain if it appears in a pattern."}], "tags": [], "owner": {"reputation": 775, "user_id": 3286185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a141681120ffb0004d8d60bb191f89b8?s=128&d=identicon&r=PG", "display_name": "gelisam", "link": "https://stackoverflow.com/users/3286185/gelisam"}, "is_accepted": false, "score": 2, "last_activity_date": 1445168340, "creation_date": 1445168340, "answer_id": 33197517, "question_id": 33189695, "link": "https://stackoverflow.com/questions/33189695/how-to-create-a-pattern-match-for-int-in-a-function-taking-a-type/33197517#33197517", "title": "How to create a pattern match for Int in a function taking a Type?", "body": "<blockquote>\n<pre><code>typeToMyType :: Type -&gt; MyType\ntypeToMyType (ConT $(''Int)) = NumberT \n</code></pre>\n</blockquote>\n\n<p>You don't need the <code>$(...)</code>, since <code>''Int</code> already has type <code>Name</code>.</p>\n\n<pre><code>typeToMyType :: Type -&gt; MyType\ntypeToMyType (ConT t) | t == ''Int  = IntT\n                      | t == ''Bool = BoolT\ntypeToMyType _ = OtherT\n</code></pre>\n\n<p>For some reason GHC doesn't like the <code>''Int</code> syntax in the pattern, so I had to move it to a pattern guard.</p>\n"}], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1445168340, "creation_date": 1445103940, "last_edit_date": 1445105609, "question_id": 33189695, "link": "https://stackoverflow.com/questions/33189695/how-to-create-a-pattern-match-for-int-in-a-function-taking-a-type", "title": "How to create a pattern match for Int in a function taking a Type?", "body": "<p>I have a function that takes a <code>Type</code>:</p>\n\n<pre><code>data MyType = IntT | BoolT | OtherT\n\ntypeToMyType :: Type -&gt; MyType\n</code></pre>\n\n<p>How can I write a pattern that would state I want to match on the type of <code>Int</code>?</p>\n\n<h2>What have I tried?</h2>\n\n<h3>1</h3>\n\n<p><code>[t| GHC.Types.Int |]</code> will create a value of type <code>Q Type</code>, but despite hours of struggling I was unable to force into a pattern match splice.</p>\n\n<p>I've tried to use it in a guard as well:</p>\n\n<pre><code>| $( do tI &lt;- [t| GHC.Types.Int |]; [| t == tI |] ) = ...\n</code></pre>\n\n<p>But that complains about:</p>\n\n<pre><code>No instance for (Language.Haskell.TH.Syntax.Lift Type)\n  arising from a use of `Language.Haskell.TH.Syntax.lift'\nIn the expression: Language.Haskell.TH.Syntax.lift tI\nIn a stmt of a 'do' block:\n  [| t == tI |]\n  pending(rn) [tI]\nIn the expression:\n  do { tI &lt;- [t| Int |];\n       [| t == tI |]\n       pending(rn) [tI] }\n</code></pre>\n\n<h3>2</h3>\n\n<p>A perhaps simpler approach would be to:</p>\n\n<pre><code>typeToMyType :: Type -&gt; MyType\ntypeToMyType (ConT $(''Int)) = NumberT \n</code></pre>\n\n<p>But then:</p>\n\n<pre><code>Couldn't match type `Name' with `Q Pat'\nExpected type: PatQ\n  Actual type: Name\nIn the expression: ''Int\nIn the splice: $(''Int)\n</code></pre>\n\n<p>I have no idea what that means.</p>\n\n<h2>What do I (even) need it for?</h2>\n\n<p>I want to \"parse\" a function signature to create a <code>Q Dec</code>. I've used <code>String</code> for a prototype:</p>\n\n<pre><code>    gen [\"Int\", \"Int\"] \"luaOpMinus\" '-\n  ======&gt;\n    Eval.hs:24:3-38\n    luaOpMinus [Number x_a98F, Number x_a98G]\n      = (return $ [Number ((-) x_a98F x_a98G)])\n</code></pre>\n\n<p>As you can see, it turns a function <code>Int -&gt; Int -&gt; Int</code>, annotated with a value <code>[\"Int\", \"Int\"]</code> (I've omitted the return type for now), into a function <code>[LuaValue] -&gt; LuaValue</code> - so that it can be called from Lua easily. Typing signatures by hand is tedious, though, so I wanted to extract that from <code>reify</code>.</p>\n\n<p>The problem is that while I can read what <code>reify</code> gives me perfectly clearly:</p>\n\n<pre><code>Prelude Language.Haskell.TH Data.Bits&gt; $(reify 'bit &gt;&gt;= stringE . show)\n\"ClassOpI Data.Bits.bit (ForallT [PlainTV a_1627400821] [ClassP Data.Bits.Bits [VarT a_1627400821]] (AppT (AppT\nArrowT (ConT GHC.Types.Int)) (VarT a_1627400821))) Data.Bits.Bits (Fixity 9 InfixL)\"\n</code></pre>\n\n<p>I can't write the <strong><code>(ConT GHC.Types.Int)</code></strong> pattern.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 14, "creation_date": 1445101001, "post_id": 33189135, "comment_id": 54184114, "body": "I believe you just empirically discovered that monads don&#39;t compose. This is why we have monad transformers."}, {"owner": {"reputation": 878, "user_id": 1655480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/39c0e81573717c00f8f89f3525f00e46?s=128&d=identicon&r=PG", "display_name": "Lykos", "link": "https://stackoverflow.com/users/1655480/lykos"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1445104679, "post_id": 33189135, "comment_id": 54185372, "body": "I see. I slightly weakened the question. Now it should be possible."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1445104793, "post_id": 33189135, "comment_id": 54185410, "body": "Read the linked question above: its accepted answer contains some discussion for this as well. That is, if a suitable commutativity condition between <code>n</code> and <code>m</code> holds, you do have composition."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1445105976, "post_id": 33189135, "comment_id": 54185832, "body": "I found <a href=\"http://stackoverflow.com/questions/29453915/composing-monads-v-applicative-functors\">another question</a>, whose answer has an intriguing comment that it might work if the inner monad is a <code>Traversable</code>. (That allows you to create a <code>join</code> of the right <i>type</i>, not sure about the monad laws.) I&#39;m a bit out of time right now, but I think I&#39;ll reopen this question."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1445106472, "post_id": 33189135, "comment_id": 54186011, "body": "By which I mean, I think this question is not quite a duplicate and that <code>Traversable</code> viewpoint gives a possible way of answering it."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1445106807, "post_id": 33189135, "comment_id": 54186137, "body": "Reopening seemed to remove <a href=\"http://stackoverflow.com/questions/7040844/applicatives-compose-monads-dont\">the link to the related question</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1445119146, "post_id": 33189135, "comment_id": 54189825, "body": "@&#216;rjanJohansen <code>sequence</code> will provide a solution in cases where the commutativity condition referenced by chi holds. This condition requires a uniformity to the &quot;shape&quot; of the monad structures that cannot be captured by the Haskell type system. For example, Richard Bird&#39;s sudoku solution uses this uniformity of structure to commute a grid of choices (<code>[[]] . []</code>) into a choice of grids (<code>[] . [[]]</code>), which depends on the grid being rectangular (no ragged inner lists)."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 7, "last_activity_date": 1445129083, "last_edit_date": 1495540316, "creation_date": 1445128766, "answer_id": 33193136, "question_id": 33189135, "link": "https://stackoverflow.com/questions/33189135/compose-nested-monads-in-haskell/33193136#33193136", "title": "Compose nested Monads in Haskell", "body": "<p>Expanding on the comments: As the <a href=\"https://stackoverflow.com/questions/7040844/applicatives-compose-monads-dont\">linked</a> <a href=\"https://stackoverflow.com/questions/29453915/composing-monads-v-applicative-functors\">questions</a> show, it is necessary to have some function <code>n (m a) -&gt; m (n a)</code> to even have a chance to make the composition a monad.</p>\n\n<p>If your inner monad is a <code>Traversable</code>, then <code>sequence</code> provides such a function, and the following will have the right <em>type</em>:</p>\n\n<pre><code>(&gt;&gt;&gt;=) :: (Monad m, Monad n, Traversable n) =&gt; m (n a) -&gt; (a -&gt; m (n b)) -&gt; m (n b)\nm &gt;&gt;&gt;= k = do\n    a &lt;- m\n    b &lt;- sequence (map k a)\n    return (join b)\n</code></pre>\n\n<p>Several well-known transformers are in fact simple newtype wrappers over something equivalent to this (although mostly defining things with pattern matching instead of literally using the inner monads' <code>Monad</code> and <code>Traversable</code> instances):</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Maybe.html\" rel=\"nofollow noreferrer\"><code>MaybeT</code></a> based on <code>Maybe</code></li>\n<li><a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Except.html\" rel=\"nofollow noreferrer\"><code>ExceptT</code></a> based on <code>Either</code></li>\n<li><a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Writer-Lazy.html\" rel=\"nofollow noreferrer\"><code>WriterT</code></a> based on <code>(,)</code> (<code>(,)</code> doesn't normally have its <code>Monad</code> instance defined, <em>and</em> <code>WriterT</code> is using the wrong tuple order to make use of it if it had - but in spirit it could have).</li>\n<li><a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-List.html\" rel=\"nofollow noreferrer\"><code>ListT</code></a> based on <code>[]</code>. Oh, <em>whoops</em>...</li>\n</ul>\n\n<p>The last one is in fact notorious for <em>not</em> being a monad unless the lifted monad is \"commutative\" - otherwise, expressions that should be equal by the monad laws can give different order of effects. My hunch is that this comes essentially from lists being able to contain more than one value, unlike the other, reliably working examples.</p>\n\n<p>So, although the above definition will be correctly <em>typed</em>, it can still break the monad laws.</p>\n\n<p>Also as an afterthought, one other transformer is such a nested monad, but in a completely different way: <code>ReaderT</code>, based on using <code>(-&gt;)</code> as the <em>outer</em> monad.</p>\n"}], "owner": {"reputation": 878, "user_id": 1655480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/39c0e81573717c00f8f89f3525f00e46?s=128&d=identicon&r=PG", "display_name": "Lykos", "link": "https://stackoverflow.com/users/1655480/lykos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 643, "favorite_count": 0, "accepted_answer_id": 33193136, "answer_count": 1, "score": 6, "last_activity_date": 1445129083, "creation_date": 1445100763, "last_edit_date": 1445104650, "question_id": 33189135, "link": "https://stackoverflow.com/questions/33189135/compose-nested-monads-in-haskell", "title": "Compose nested Monads in Haskell", "body": "<p>Is there a way to implement bind for nested monads? What I want is the following signature:</p>\n\n<pre><code>(&gt;&gt;&gt;=) :: (Monad m, Monad n) =&gt; m (n a) -&gt; (a -&gt; m (n b)) -&gt; m (n b)\n</code></pre>\n\n<p>It looks like it should be a trivial task, but I somehow just can't wrap my head around it. In my program, I use this pattern for several different combinations of monads and for each combination, I can implement it. But for the general case, I just don't understand it.</p>\n\n<p>Edit: It seems that it is not possible in the general case. But it is certainly possible in some special cases. E.g. if the inner Monad is a Maybe. Since it IS possible for all the Monads I want to use, having additional constraints seems fine for me. So I change the question a bit:</p>\n\n<p>What additional constraints do I need on n such that the following is possible?</p>\n\n<pre><code>(&gt;&gt;&gt;=) :: (Monad m, Monad n, ?? n) =&gt; m (n a) -&gt; (a -&gt; m (n b)) -&gt; m (n b)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1445100725, "post_id": 33188801, "comment_id": 54184018, "body": "Google &quot;dynamic programming coin change&quot; for some ideas on how to approach the problem."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 5457469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4b48d310bd4f8ca7a45ad050746f24?s=128&d=identicon&r=PG&f=1", "display_name": "Mannso", "link": "https://stackoverflow.com/users/5457469/mannso"}, "edited": false, "score": 0, "creation_date": 1445106379, "post_id": 33189313, "comment_id": 54185970, "body": "Thanks for the answer. But this function is not working properly. * Demo&gt; count Change 7 [2,3,7] - 4 ways, not 1, [2,2,3] [2,3,2] [3,2,2] [7] 1 Some people say that this problem can be implemented in 2 lines. I&#39;m trying to figure out how to but still do not have any ideas."}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": false, "score": 0, "last_activity_date": 1445101870, "creation_date": 1445101870, "answer_id": 33189313, "question_id": 33188801, "link": "https://stackoverflow.com/questions/33188801/haskell-optimization-program/33189313#33189313", "title": "Haskell optimization program", "body": "<p>You're doing a lot of filtering, <code>elem</code>ing and so on, and placing a lot of constraints on the data types.\nThink of this more as a dynamic problem, that you constantly need to figure out how many ways there are to return change for a <code>total</code> amount.</p>\n\n<p>Once you have found the amount of possibilities for a specific coin, you can remove it from the list.</p>\n\n<p>Here is my proposed solution wrapped up in one function.\nIn the list comprehension, note that I assign values to the <code>remaining</code> variable, and that these values range from [0,total], with jumps every <code>x</code>, where <code>x</code> is the denomination.\nFor example, if you had to calculate how many times $0.25 goes into a $2 total, that list comprehension ends up doing:\n<code>[countChange 2, countChange 1.75,countChange 1.5, countChange 1.25,...]</code>, but also these next iterations of <code>countChange</code> don't include the 0.25 coin - because we just \"tested\" that.</p>\n\n<pre><code>-- Amount to return -&gt; List of Coin denominations available\ncountChange :: Integer -&gt; [Integer] -&gt; Integer\ncountChange _ [] = 0 -- No coins at all, so no change can be given\ncountChange 0 _ = 1 -- Only one way to return 0 change\ncountChange total (x:xs) = sum [countChange (total-remaining) xs | remaining &lt;- [0,x..total]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 5457469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4b48d310bd4f8ca7a45ad050746f24?s=128&d=identicon&r=PG&f=1", "display_name": "Mannso", "link": "https://stackoverflow.com/users/5457469/mannso"}, "edited": false, "score": 0, "creation_date": 1445279710, "post_id": 33212406, "comment_id": 54247315, "body": "but iw is not correct.  change 7 [[2,2,3],[2,3,2],[3,2,2],[7]] -- your solution show [[3,2,2],[7]]"}, {"owner": {"reputation": 352, "user_id": 1738119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/196a088cbe1f14e69851e3257f0a19c6?s=128&d=identicon&r=PG", "display_name": "koki", "link": "https://stackoverflow.com/users/1738119/koki"}, "reply_to_user": {"reputation": 3, "user_id": 5457469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4b48d310bd4f8ca7a45ad050746f24?s=128&d=identicon&r=PG&f=1", "display_name": "Mannso", "link": "https://stackoverflow.com/users/5457469/mannso"}, "edited": false, "score": 0, "creation_date": 1445280489, "post_id": 33212406, "comment_id": 54247786, "body": "if you wanna get all permutation of it, pls. replace... &quot;else if x &lt; (head xs) then [] else return (x:xs)&quot; to &quot;else return (x:xs)&quot;"}, {"owner": {"reputation": 352, "user_id": 1738119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/196a088cbe1f14e69851e3257f0a19c6?s=128&d=identicon&r=PG", "display_name": "koki", "link": "https://stackoverflow.com/users/1738119/koki"}, "reply_to_user": {"reputation": 3, "user_id": 5457469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4b48d310bd4f8ca7a45ad050746f24?s=128&d=identicon&r=PG&f=1", "display_name": "Mannso", "link": "https://stackoverflow.com/users/5457469/mannso"}, "edited": false, "score": 0, "creation_date": 1445281052, "post_id": 33212406, "comment_id": 54248154, "body": "&quot;if (null xs) ...&quot; also not need. I edit above source code."}], "tags": [], "owner": {"reputation": 352, "user_id": 1738119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/196a088cbe1f14e69851e3257f0a19c6?s=128&d=identicon&r=PG", "display_name": "koki", "link": "https://stackoverflow.com/users/1738119/koki"}, "is_accepted": true, "score": 1, "last_activity_date": 1445281217, "last_edit_date": 1445281217, "creation_date": 1445251482, "answer_id": 33212406, "question_id": 33188801, "link": "https://stackoverflow.com/questions/33188801/haskell-optimization-program/33212406#33212406", "title": "Haskell optimization program", "body": "<pre><code>import Data.List\n\nchange :: [Int] -&gt; Int -&gt; [[Int]]\nchange _ 0 = []\nchange coins n = do\n  x &lt;- [c | c &lt;- coins, c &lt;= n]\n  if x == n\n    then return [x]\n    else do\n      xs &lt;- change coins (n - x)\n--    if (null xs)\n--      then return [x]\n--      else if x &lt; (head xs)\n--        then []\n--        else return (x:xs)\n      return (x:xs)\n\nchange' :: Int -&gt; [[Int]]\nchange' = change [2,3,7]\n\ntest7 = change' 7\ntest6 = change' 6\ntest5 = change' 5\ntest4 = change' 4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 352, "user_id": 1738119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/196a088cbe1f14e69851e3257f0a19c6?s=128&d=identicon&r=PG", "display_name": "koki", "link": "https://stackoverflow.com/users/1738119/koki"}, "is_accepted": false, "score": 0, "last_activity_date": 1445281284, "last_edit_date": 1445281284, "creation_date": 1445255144, "answer_id": 33213560, "question_id": 33188801, "link": "https://stackoverflow.com/questions/33188801/haskell-optimization-program/33213560#33213560", "title": "Haskell optimization program", "body": "<p>Use MemoCombinators. This is fast ! Pls. try change 100</p>\n\n<pre><code>import Data.List\nimport qualified Data.MemoCombinators as Memo\n\ncoins :: [Int]\ncoins = [2,3,7]\n\nchange :: Int -&gt; [[Int]]\nchange = Memo.integral change'\nchange' 0 = []\nchange' n = do\n  x &lt;- [c | c &lt;- coins, c &lt;= n]\n  if x == n\n    then return [x]\n    else do\n      xs &lt;- change (n - x)\n--    if (null xs)\n--      then return [x]\n--      else if x &lt; (head xs)\n--        then []\n--        else return (x:xs)\n      return (x:xs)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5457469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4b48d310bd4f8ca7a45ad050746f24?s=128&d=identicon&r=PG&f=1", "display_name": "Mannso", "link": "https://stackoverflow.com/users/5457469/mannso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 33212406, "answer_count": 3, "score": 0, "last_activity_date": 1445281284, "creation_date": 1445098635, "question_id": 33188801, "link": "https://stackoverflow.com/questions/33188801/haskell-optimization-program", "title": "Haskell optimization program", "body": "<p>Have the task\nI need to implement the function Change, which will take the value and split it into the possible combinations from list of coins(random list)\nExample:</p>\n\n<pre><code>coins = [2,3,7]\nGHCi&gt; change 7\n[[2,2,3],[2,3,2],[3,2,2],[7]]\n</code></pre>\n\n<p>That's what I did:</p>\n\n<pre><code>coins :: Num a =&gt; [a] \ncoins = [2, 3, 7]\n\nchange :: (Ord a, Num a) =&gt; a -&gt; [[a]]\nchange n =  uniqEl (filter (\\x -&gt; sum x == n) take ()(subsequences (replic' n coins coins)))\n\nreplic' n x y | n == 1 = y\n              | otherwise = replic' (n-1) x (y ++ x) \n\nuniqEl :: Eq a =&gt; [a] -&gt; [a]\nuniqEl [] = []\nuniqEl (x:xs) = if (x `elem` xs) then uniqEl xs else x : (uniqEl xs)\n</code></pre>\n\n<p>But this code is very slow. Help to make this program more quickly. As part of the job it is said that this task is easily done with the help of generators lists and recursion. Thank you in advance for your help.</p>\n"}, {"tags": ["haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1445098150, "post_id": 33188305, "comment_id": 54183203, "body": "The argument order was just an example, that works great, thanks!"}, {"owner": {"reputation": 2801, "user_id": 2877058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fMUyx.jpg?s=128&g=1", "display_name": "WhiteViking", "link": "https://stackoverflow.com/users/2877058/whiteviking"}, "reply_to_user": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1445099108, "post_id": 33188305, "comment_id": 54183494, "body": "@Thomas Aside: in case you don&#39;t know it already, this is fun for discovering existing functions based on their (approximate) type signature: <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">haskell.org/hoogle</a>"}, {"owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1445108226, "post_id": 33188305, "comment_id": 54186694, "body": "Oh I didn&#39;t know you could search on hoogle for type signatures, that&#39;s very useful to know!"}, {"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 0, "creation_date": 1450705830, "post_id": 33188305, "comment_id": 56535560, "body": "Wow thank you !! Is there an equivalent function to lookup from <code>b</code> ?"}], "tags": [], "owner": {"reputation": 2801, "user_id": 2877058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fMUyx.jpg?s=128&g=1", "display_name": "WhiteViking", "link": "https://stackoverflow.com/users/2877058/whiteviking"}, "is_accepted": true, "score": 3, "last_activity_date": 1445096282, "last_edit_date": 1445096282, "creation_date": 1445095734, "answer_id": 33188305, "question_id": 33188258, "link": "https://stackoverflow.com/questions/33188258/haskell-find-tuple-with-first-element-x-in-list-of-tuples/33188305#33188305", "title": "Haskell: Find tuple with first element x in list of tuples", "body": "<p>There's a</p>\n\n<pre><code>lookup :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b\n</code></pre>\n\n<p>in the Prelude. It returns a <code>Maybe</code> because the item you're looking up might not be in the list. </p>\n\n<p>But you didn't ask for safety and the argument order is different from what you asked, so it doesn't answer your question <em>exactly</em>.</p>\n"}, {"tags": [], "owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "is_accepted": false, "score": 1, "last_activity_date": 1445096782, "creation_date": 1445096782, "answer_id": 33188504, "question_id": 33188258, "link": "https://stackoverflow.com/questions/33188258/haskell-find-tuple-with-first-element-x-in-list-of-tuples/33188504#33188504", "title": "Haskell: Find tuple with first element x in list of tuples", "body": "<p>As the other answer says, you may wish to use <code>lookup :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b</code> (<a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.List.html#lookup\" rel=\"nofollow\">source-code</a>). You may implement it in point-free style as <code>lookup key = fmap snd . safeHead . filter ((== key) . fst)</code>.</p>\n\n<p>To drop the safety when the key is not present on the list, just swap <code>safeHead :: [a] -&gt; Maybe a</code> with <code>head :: [a] -&gt; a</code>, and to change the parameter order simply <code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</code>.</p>\n\n<p>Therefore, to find your initial specification we could have:</p>\n\n<pre><code>myLookup :: Eq a =&gt; [(a, b)] -&gt; a -&gt; b\nmyLookup = flip myLookup'\n    where myLookup' key = snd . head . filter ((== key) . fst)\n</code></pre>\n"}], "owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1120, "favorite_count": 0, "accepted_answer_id": 33188305, "answer_count": 2, "score": 1, "last_activity_date": 1445096782, "creation_date": 1445095478, "question_id": 33188258, "link": "https://stackoverflow.com/questions/33188258/haskell-find-tuple-with-first-element-x-in-list-of-tuples", "title": "Haskell: Find tuple with first element x in list of tuples", "body": "<p>Allow me to explain if my question is not clear. Let's say I have <code>tuples :: [(a, Int)]</code>. I have created this using <code>zip</code>. Now, I want to find a corresponding <code>Int</code> value for my <code>a</code> element. I'm trying to figure out how I do this.</p>\n\n<p><code>f :: [(a, Int)] -&gt; a -&gt; Int</code></p>\n\n<p>Above is the type of the function I need.</p>\n\n<p>Or how it needs to be used in ghci:</p>\n\n<p><code>let tuples = zip ['a','b','c'] [1..]</code></p>\n\n<p><code>f tuples 'a'</code></p>\n\n<p>returns: <code>1</code></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 2452478, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9513d83317afff7bc0c51bef363d2ed0?s=128&d=identicon&r=PG", "display_name": "user2452478", "link": "https://stackoverflow.com/users/2452478/user2452478"}, "edited": false, "score": 0, "creation_date": 1445097544, "post_id": 33188509, "comment_id": 54182994, "body": "Oh I see, I had assumed that matching the first element being an empty list is the same as matching the entire input being an empty list"}, {"owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "reply_to_user": {"reputation": 83, "user_id": 2452478, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9513d83317afff7bc0c51bef363d2ed0?s=128&d=identicon&r=PG", "display_name": "user2452478", "link": "https://stackoverflow.com/users/2452478/user2452478"}, "edited": false, "score": 0, "creation_date": 1445097861, "post_id": 33188509, "comment_id": 54183097, "body": "An empty  list has no first element,  but <code>[[]]</code> <i>does</i> have an empty list as it s first element. So for the compiler, your <code>ps</code> works on lists of lists, and hence returns lists of lists of lists. When you sum these, you are treating lists of lists as if they were numbers, which is (in ordinary English) what the error messeage says."}], "tags": [], "owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "is_accepted": true, "score": 1, "last_activity_date": 1445097312, "last_edit_date": 1445097312, "creation_date": 1445096790, "answer_id": 33188509, "question_id": 33188228, "link": "https://stackoverflow.com/questions/33188228/haskell-error-no-instance-for-num-a0-arising-from-a-use-of-it/33188509#33188509", "title": "Haskell Error: No instance for (Num [[a0]] arising from a use of `it`", "body": "<p>I find it difficult to fathom what your function (and the helper <code>ps</code>)  is supposed to do (this usually helps to get better answers... :-) but it looks like you are confusing two idioms in your definition of <code>ps</code></p>\n\n<p>You can write</p>\n\n<pre><code>ps y = case y of\n  [] -&gt; [[]]\n  (x:xs) -&gt; ps xs ++ map (x:) (ps xs)\n</code></pre>\n\n<p>or just</p>\n\n<pre><code>ps [] = [[]]\nps (x:xs) = ps xs ++ map (x:) (ps xs)\n</code></pre>\n\n<p>but as it stands now, the definition of <code>ps</code> is missing a base case (what is <code>ps []</code>?)</p>\n\n<p>With this out of the way, the definition compiles, and <code>maxWeight 5 10 (\\i -&gt; i + 1)</code> yields <code>9</code> </p>\n"}], "owner": {"reputation": 83, "user_id": 2452478, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9513d83317afff7bc0c51bef363d2ed0?s=128&d=identicon&r=PG", "display_name": "user2452478", "link": "https://stackoverflow.com/users/2452478/user2452478"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 33188509, "answer_count": 1, "score": 0, "last_activity_date": 1445133291, "creation_date": 1445095258, "last_edit_date": 1445133291, "question_id": 33188228, "link": "https://stackoverflow.com/questions/33188228/haskell-error-no-instance-for-num-a0-arising-from-a-use-of-it", "title": "Haskell Error: No instance for (Num [[a0]] arising from a use of `it`", "body": "<p>I'm stuck on an error which is given when I test this function:</p>\n\n<pre><code>maxWeight n wc f =\nlet ps (x:xs) = case x of \n    [] -&gt; [[]]\n    otherwise -&gt; ps xs ++ map (x:) (ps xs)\nin maximum $ filter (&lt;wc) $ map sum $ ps $ map f [1..n]\n</code></pre>\n\n<p>This is the full error:</p>\n\n<pre><code>No instance for (Num [[a0]]) arising from a use of `it`\nIn a statement of an interactive GHCi command: print it\n</code></pre>\n\n<p>I'm testing the function by calling it in GHCi with</p>\n\n<pre><code>maxWeight 5 10 (\\i -&gt; i + 1)\n</code></pre>\n"}, {"tags": ["performance", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 7, "creation_date": 1445091296, "post_id": 33187523, "comment_id": 54181035, "body": "I think the general idea is to use a different algorithm, i.e. not brute force.  It&#39;s not the list comprehension at fault for this being slow, this is a classic example of a brute force algorithm of nested for loops.  The complexity of this algorithm is somewhere around <code>O(n^3)</code>, not a good complexity to have as <code>n</code> grows larger."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1445092290, "post_id": 33187523, "comment_id": 54181329, "body": "Right, this is an algorithms/math problem not a Haskell/performance problem. How interested are you in solving this particular problem of finding right triangles with prescribed perimeter? The efficient way is to use the parameterization of Pythagorean triples and start by factoring <code>p</code>..."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1445097645, "post_id": 33187523, "comment_id": 54183038, "body": "@ReidBarton: Yes, good points, which partially answer the question: The constraints are not applied to the domain specifications. For example all values of <code>(a, b, c)</code> for ` c &lt;- [1..(quot p 2)]<code>, </code>b &lt;- [1..c]<code>, and </code>a &lt;- [1..b]` will be examined, and <i>then</i> then constraints are applied (in contrast, to say, limiting <code>a</code> to values equal to <code>p-c-b</code>. That was the Haskell-y question I was asking."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1445122551, "post_id": 33188279, "comment_id": 54190659, "body": "Thanks. This is exactly what I was looking for: I wanted to stick with a list comprehension, but don&#39;t want to to be <i>O(n&#179;)</i>. I also wanted to confirm what I was wondering: that the constraints after <code>|</code> are not &quot;solved&quot; in any way (as you have done &quot;by hand&quot; above)."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 6, "last_activity_date": 1445095617, "creation_date": 1445095617, "answer_id": 33188279, "question_id": 33187523, "link": "https://stackoverflow.com/questions/33187523/efficient-alternatives-to-qualified-haskell-list-comprehensions/33188279#33188279", "title": "Efficient alternatives to qualified Haskell list comprehensions", "body": "<p>The comments make the good point that what you really need is a better algorithm.</p>\n\n<p>But let's try something different, and see what optimizations we can make to the current code:</p>\n\n<pre><code>let rightTrianglesCubic p = [ (a,b,c) | c &lt;- [1..quot p 2], b &lt;- [1..c], a &lt;- [1..b], a^2 + b^2 == c^2, a + b + c == p]\n</code></pre>\n\n<p>First, note how we're looping over all the values of <code>[1..b]</code> until we find one where <code>a + b + c == p</code>. But the only value where that holds is <code>a = p - b - c</code>, so we can skip the loop altogether, and make this into a quadratic algorithm:</p>\n\n<pre><code>let rightTrianglesQuadraticA p = [ (a,b,c) | c &lt;- [1..quot p 2], b &lt;- [1..c], let a = p - b - c, a^2 + b^2 == c^2]\n</code></pre>\n\n<p>There's a slight problem with this approach:</p>\n\n<pre><code>\u03bb rightTrianglesCubic 120\n[(30,40,50),(24,45,51),(20,48,52)]\n\u03bb rightTrianglesQuadraticA 120\n[(40,30,50),(30,40,50),(45,24,51),(24,45,51),(48,20,52),(20,48,52),(0,60,60)]\n</code></pre>\n\n<p>We get some extra results! This is because we ignored the implicit conditions made by <code>a &lt;- [1..b]</code>, namely <code>1 &lt;= a</code> and <code>a &lt;= b</code>. So let's add those back in.</p>\n\n<pre><code>let rightTrianglesQuadraticB p = [ (a,b,c) | c &lt;- [1..quot p 2], b &lt;- [1..c], let a = p - b - c, a^2 + b^2 == c^2, 1 &lt;= a, a &lt;= b]\n</code></pre>\n\n<p>And now we get the right answer:</p>\n\n<pre><code>\u03bb rightTrianglesQuadraticB 120\n[(30,40,50),(24,45,51),(20,48,52)]\n</code></pre>\n\n<p>Since each value of <code>b</code> has a unique <code>a</code>, the conditions <code>1 &lt;= a</code> and <code>a &lt;= b</code>\ncan be phrased as conditions on <code>b</code>. <code>1 &lt;= a</code> is the same as <code>1 &lt;= p - b - c</code> or\n<code>b &lt;= p - c - 1</code>. <code>a &lt;= b</code> is the same as <code>p - b - c &lt;= b</code> or <code>p - c &lt;= 2*b</code> or\n<code>div (p - c + 1) 2 &lt;= b</code>.</p>\n\n<p>This lets us shrink the bounds on the loop <code>b &lt;- [1..c]</code>:</p>\n\n<pre><code>let rightTrianglesQuadraticC p = [ (a,b,c) | c &lt;- [1..quot p 2], b &lt;- [max 1 (div (p - c + 1) 2) .. min c (p - c - 1) ], let a = p - b - c, a^2 + b^2 == c^2]\n</code></pre>\n\n<p>We can even shrink the bounds on <code>c &lt;- [1..quot p 2]</code> by noting that in order for <code>a &lt; b &lt; c</code> with <code>a+b+c == p</code>, we must have <code>c &gt; p/3</code>:</p>\n\n<pre><code>let rightTrianglesQuadraticD p = [ (a,b,c) | c &lt;- [1 + quot p 3..quot p 2], b &lt;- [max 1 (div (p - c + 1) 2) .. min c (p - c - 1) ], let a = p - b - c, a^2 + b^2 == c^2]\n</code></pre>\n\n<p>This is about as far as optimizing this particular code can go. For further performance improvement, we'll need to switch algorithms altogether.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 1, "accepted_answer_id": 33188279, "answer_count": 1, "score": 2, "last_activity_date": 1445095617, "creation_date": 1445090738, "question_id": 33187523, "link": "https://stackoverflow.com/questions/33187523/efficient-alternatives-to-qualified-haskell-list-comprehensions", "title": "Efficient alternatives to qualified Haskell list comprehensions", "body": "<p>As an illustration of qualified list comprehensions in Haskell, the <a href=\"http://learnyouahaskell.com/starting-out#tuples\" rel=\"nofollow\">Learn You a Haskell</a> tutorial provides an example of list comprehension that suggests a general approach to finding the right triangles with a given perimeter <code>p</code>, expressed as a tuple:</p>\n\n<pre><code>\u03bb&gt; let rightTriangles p = [ (a,b,c) | c &lt;- [1..(quot p 2)], b &lt;- [1..c], a &lt;- [1..b], a^2 + b^2 == c^2, a + b + c == p] \n</code></pre>\n\n<p>But this approach becomes <em>very</em> slow as <code>p</code> gets large.</p>\n\n<p>Is there a generally faster yet idiomatic Haskell way to accomplish the same thing for large <code>p</code>?</p>\n"}, {"tags": ["python", "haskell", "cartesian-product"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1445087117, "post_id": 33186838, "comment_id": 54179713, "body": "I don&#39;t see how lazy evaluation can help here.   In order to shuffle a sequence you must evaluate all the &quot;spine&quot; of the sequence to generate a true random sequence (otherwise you&#39;d be limited to random sampling of a prefix), so you have a problem with the space in any case.   The  only way I can think of would be to &quot;number&quot; all possible permutations. Then instead of shuffling you generate a random number between <code>1</code> and <code>n!</code>. And have a function that given the permutation number and an index retrieves the element from that permutation. However retrieving becomes inefficient."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445088183, "post_id": 33186838, "comment_id": 54180029, "body": "What value of <code>size</code> do you want to use? And do you need the entire list?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1445104690, "post_id": 33186838, "comment_id": 54185375, "body": "You can avoid allocating the initial list, by using the function @Bakuriu suggests. But what I don&#39;t think you can avoid is the fact that to produce the next element in the shuffle of <code>n</code> elements, you must <i>somehow</i> remember which elements you have already seen, which takes <code>n</code> bits by the &quot;obvious&quot; method, and optimally only a handful less when you&#39;re about halfway in the list."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1445108694, "post_id": 33186838, "comment_id": 54186872, "body": "Besides: lazy evaluation is not magical (if it were your problem would be solved trivially in some way...). What you don&#39;t pay in time (e.g. avoid evalution of something) you pay it in space (e.g. big thunks). But this is a general rule in complexity: you often can use more space to reduce the time taken, or save in space by using more time. In this case either you use O(n) space to shuffle or you can use O(logn) space but you increase time to something like O(n^2) (like O(n) for each access in general)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1445131156, "post_id": 33186838, "comment_id": 54192444, "body": "@Bakuriu Oh you <i>can</i> use O(log n) space? Hm now that I think about it, a logspace version of <code>sort . zip (randoms g)</code> should work..."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1445187342, "post_id": 33186838, "comment_id": 54205929, "body": "@Bakuriu Alas, that idea was O(n^3) time. Now I also see how to do it in O(log n) space and O(n^2) time, to look up a single element you run Fisher-Yates backwards on the whole list, ignoring what happens to any elements except the one you&#39;re looking up..."}], "owner": {"reputation": 165, "user_id": 5456966, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8dc04bf934c404853fcf447efe2dd6a?s=128&d=identicon&r=PG&f=1", "display_name": "ols", "link": "https://stackoverflow.com/users/5456966/ols"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1445086281, "creation_date": 1445086281, "question_id": 33186838, "link": "https://stackoverflow.com/questions/33186838/iterate-on-shuffled-cartesian-product-in-haskell", "title": "Iterate on shuffled cartesian product in Haskell", "body": "<p>I would like to iterate on a shuffled cartesian product.</p>\n\n<p>In python, I can do:</p>\n\n<pre><code>import itertools\nimport random\n\nsize = 10\npts = [pt for pt in itertools.product(range(size), range(size), range(size))]\nrandom.shuffle(pts)\nprint pts\n</code></pre>\n\n<p>If size increase or if I need higher dimension, this approach can consume too much memory.</p>\n\n<p>In Haskell, do you know if it is possible to do this by using lazy evaluation or some other magical stuff ?</p>\n\n<p>Thanks for your help</p>\n\n<p>Olivier</p>\n"}, {"tags": ["haskell", "recursion", "name-matching"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445088676, "post_id": 33186832, "comment_id": 54180200, "body": "Do the <code>&#47;&#47;</code> comments work for you???"}, {"owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1445088902, "post_id": 33186832, "comment_id": 54180268, "body": "@ErikR Oh, I just added them here in C# style. Edited."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1445089018, "creation_date": 1445089018, "answer_id": 33187259, "question_id": 33186832, "link": "https://stackoverflow.com/questions/33186832/how-to-properly-match-file-names-in-subdirectories/33187259#33187259", "title": "How to properly match file names in subdirectories?", "body": "<p>Here's an issue:</p>\n\n<pre><code>              contents &lt;- getDirectoryContents dirName\n              subDirs &lt;- filterM doesDirectoryExist contents\n</code></pre>\n\n<p><code>getDirectoryContents</code> only returns the leaf names of the directories, so you have to prepend <code>dirName</code> (along with a <code>/</code>) to the elements of <code>contents</code> before calling <code>doesDirectoryExist</code>.</p>\n"}], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 33187259, "answer_count": 1, "score": 0, "last_activity_date": 1445089116, "creation_date": 1445086242, "last_edit_date": 1445089116, "question_id": 33186832, "link": "https://stackoverflow.com/questions/33186832/how-to-properly-match-file-names-in-subdirectories", "title": "How to properly match file names in subdirectories?", "body": "<p>I am currently going through the book <em>Real World Haskell</em> and one exercise from this book asks the reader to implement file name matching with the use of <code>**</code>, which is the same as <code>*</code>, but also looks in subdirectories all the way down in the file system. Below is a fragment of my code with comments (there is a lot of duplication at the moment) and further down you can find additional info about the code. I think that the posted code is sufficient for the problem and there is no need to list the whole program here.</p>\n\n<pre><code>case splitFileName pat of\n        (\"\", baseName) -&gt; do -- just the file name passed\n            curDir &lt;- getCurrentDirectory\n            if searchSubDirs baseName -- check if file name has `**` in it\n              then do \n                  contents &lt;- getDirectoryContents curDir\n                  subDirs &lt;- filterM doesDirectoryExist contents\n                  let properSubDirs = filter (`notElem` [\".\", \"..\"]) subDirs\n                  subDirsNames &lt;- forM properSubDirs $ \\dir -&gt; do\n                                      namesMatching (curDir &lt;/&gt; dir &lt;/&gt; baseName) -- call the function recursively on subdirectories\n                  curDirNames &lt;- listMatches curDir baseName -- list matches in the current directory\n                  return (curDirNames ++ (concat subDirsNames)) -- concatenate results into a single list\n              else listMatches curDir baseName\n        (dirName, baseName) -&gt; do // full path passed\n            if searchSubDirs baseName\n              then do\n                  contents &lt;- getDirectoryContents dirName\n                  subDirs &lt;- filterM doesDirectoryExist contents\n                  let properSubDirs = filter (`notElem` [\".\", \"..\"]) subDirs\n                  subDirsNames &lt;- forM properSubDirs $ \\dir -&gt; do\n                                      namesMatching (dirName &lt;/&gt; dir &lt;/&gt; baseName) -- call the function recursively on subdirectories\n                  curDirNames &lt;- listMatches dirName baseName -- list matches in the passed directory\n                  return (curDirNames ++ (concat subDirsNames)) -- concatenate results into a single list\n</code></pre>\n\n<h2>Additional information:</h2>\n\n<p><code>pat</code> is the pattern I'm looking for (e.g. <code>*.txt</code> or <code>C:\\\\A\\[a-z].*</code>).</p>\n\n<p><code>splitFileName</code> is a function which splits a file path into the directory path and the file name. The first element of the tuple will be empty if we specify just a file name in <code>pat</code>.</p>\n\n<p><code>searchSubDirs</code> returns <code>True</code> if the file name has <code>**</code> in it.</p>\n\n<p><code>listMatches</code> returns a list of file names that match the pattern in the directory, substituting <code>**</code> for <code>*</code>.</p>\n\n<p><code>namesMatching</code> is the name of the function whose excerpt I posted.</p>\n\n<h2>Why doesn't it work?</h2>\n\n<p>When I pass just the file name, the program searches for it only in the current directory and first level of subdirectories. When I pass a full path, it searches only in the specified directory. It looks like case <code>(dirName, baseName)</code> doesn't properly recurse. I've been looking at the code for some time now and I can't figure out where the problem is.</p>\n\n<h2>Note</h2>\n\n<p>If any more information is needed, please let me know in the comments and I'll add whatever is necessary to the question.</p>\n"}, {"tags": ["haskell", "svg", "haskell-diagrams"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445078559, "post_id": 33185458, "comment_id": 54177221, "body": "Can&#39;t reproduce, both the dashing and fill work for me. What SVG viewer do you use? They&#39;re hardly consistent unfortunately, perhaps try outputting pdf instead. \u2014 Also, it might be useful to say what version of <code>diagrams</code> this is."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445105645, "post_id": 33185458, "comment_id": 54185718, "body": "Interesting, in firefox I don&#39;t see anything at all! Inkscape has no problems, though (and you can also examine the svg file itself \u2013 it&#39;s an XML text format after all \u2013 and see the circle and dashing is there)."}, {"owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445331608, "post_id": 33185458, "comment_id": 54268010, "body": "Please could you be more specific on how you solved the problem in Firefox by &#39;scaling it up&#39;?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445332155, "post_id": 33185458, "comment_id": 54268362, "body": "You can modify SVG while viewing it in Firefox, by pressing ctrl+shift+c. But, for the SVG you&#39;ve posted I indeed get the same problem you reported, so it&#39;s no use. Seems to be indeed a bug in the SVG Diagrams backend."}, {"owner": {"reputation": 4230, "user_id": 4592, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/5d8d81116011a01424b4dbe952846c25?s=128&d=identicon&r=PG", "display_name": "fryguybob", "link": "https://stackoverflow.com/users/4592/fryguybob"}, "edited": false, "score": 0, "creation_date": 1445950294, "post_id": 33185458, "comment_id": 54531419, "body": "I can&#39;t reproduce your issue.  I get different SVG output that looks correct: <a href=\"http://lpaste.net/144030\" rel=\"nofollow noreferrer\">lpaste.net/144030</a>"}, {"owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "edited": false, "score": 0, "creation_date": 1445954174, "post_id": 33185458, "comment_id": 54534314, "body": "I also can&#39;t reproduce.  I get a different SVG than the one you posted.  Can you explain the specific steps you used to produce the SVG?"}, {"owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "edited": false, "score": 0, "creation_date": 1446546348, "post_id": 33185458, "comment_id": 54777144, "body": "The steps are as follows: I compile with &quot;cabal install -j&quot; (I&#39;m running in a sandbox) and then run with &quot;dist\\build\\MyDiagrams\\MyDiagrams -o circle.svg -w 400&quot;."}], "owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1459240147, "creation_date": 1445077385, "last_edit_date": 1459240147, "question_id": 33185458, "link": "https://stackoverflow.com/questions/33185458/haskell-diagrams-program-draws-circle-but-does-not-fill-circle-with-colour", "title": "Haskell Diagrams program draws circle but does not fill circle with colour", "body": "<p>I have written the following program:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs #-}\nimport Diagrams.Prelude\nimport Diagrams.Backend.SVG.CmdLine\n\nmain = mainWith (my_diagram :: Diagram B)\n\nmy_diagram = circle 1 # fc blue\n                      # lw veryThick\n                      # lc purple\n                      # dashingG [0.2, 0.05] 0\n</code></pre>\n\n<p>But the program produces a white circle with black outline - no colour or dashing. Any one know what might be wrong?</p>\n\n<p>I'm running in a sandbox on Haskell Platform 7.10.2 (Windows 8)</p>\n\n<p>P.S. The diagrams version is 1.3 and the program generates the following SVG file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n    \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"&gt;\n&lt;svg xmlns=\"http://www.w3.org/2000/svg\" height=\"400.0000\" stroke-opacity=\"1\" viewBox=\"0 0 400 400\" font-size=\"1\" width=\"400.0000\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" stroke=\"rgb(0,0,0)\" version=\"1.1\"&gt;\n  &lt;defs&gt;\n  &lt;/defs&gt;\n  &lt;defs&gt;\n  &lt;/defs&gt;\n  &lt;g stroke-linejoin=\"miter\" stroke-opacity=\"1.0\" fill-opacity=\"0.0\" stroke=\"rgb(0,0,0)\" stroke-width=\"1.6\" fill=\"rgb(0,0,0)\" stroke-linecap=\"butt\" stroke-miterlimit=\"10.0\"&gt;\n    &lt;path d=\"M 400.0000,200.0000 c 0.0000,-110.4569 -89.5431,-200.0000 -200.0000 -200.0000c -110.4569,-0.0000 -200.0000,89.5431 -200.0000 200.0000c -0.0000,110.4569 89.5431,200.0000 200.0000 200.0000c 110.4569,0.0000 200.0000,-89.5431 200.0000 -200.0000Z\"/&gt;\n  &lt;/g&gt;\n&lt;/svg&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 2, "creation_date": 1445076369, "post_id": 33185222, "comment_id": 54176659, "body": "You may want to have a look at <a href=\"https://en.wikibooks.org/wiki/Haskell/GADT\" rel=\"nofollow noreferrer\">GADTs</a>. Since both <code>Id</code> and <code>Lit</code> are based on <code>String</code> now you might want to parametrize the type with something extra to distinguish between the two (perhaps a phantom type variable)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1445079327, "post_id": 33185222, "comment_id": 54177430, "body": "I don&#39;t think <code>data Value = ValueId Identifier | ValueLit Literal</code> is unelegant. What do you not like about it? \u2014 BTW, note that normally we prefer to write <code>newtype Identifier = Id String</code>, rather than the <code>data</code> equivalent. It&#39;s a bit more efficient (<code>data</code> always makes an additional layer of thunk indirection)."}], "answers": [{"tags": [], "owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "is_accepted": true, "score": 0, "last_activity_date": 1445511394, "creation_date": 1445511394, "answer_id": 33279368, "question_id": 33185222, "link": "https://stackoverflow.com/questions/33185222/make-a-type-be-either-one-type-or-another/33279368#33279368", "title": "Make a type be either one type or another", "body": "<p>I first tried to restructure my types so that I would be able to do it with GADTs, but in the end the simpler solution was to go leftroundabout's suggestion. I guess it's not that \"unelegant\" anyways.</p>\n"}], "owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "accepted_answer_id": 33279368, "answer_count": 1, "score": 2, "last_activity_date": 1445511394, "creation_date": 1445075834, "question_id": 33185222, "link": "https://stackoverflow.com/questions/33185222/make-a-type-be-either-one-type-or-another", "title": "Make a type be either one type or another", "body": "<p>I'm a beginner in Haskell playing around with parsing and building an AST. I wonder how one would go about defining types like the following:</p>\n\n<p>A <code>Value</code> can either be an <code>Identifier</code> or a <code>Literal</code>. Right now, I simply have a type <code>Value</code> with two constructors (taking the name of the identifier and the value of the string literal respectively):</p>\n\n<pre><code>data Value = Id String\n           | Lit String\n</code></pre>\n\n<p>However, then I wanted to create a type representing an assignment in an AST, so I need something like</p>\n\n<pre><code>data Assignment = Asgn Value Value\n</code></pre>\n\n<p>But clearly, I always want the first part of an <code>Assignment</code> to always be an <code>Identifier</code>! So I guess I should make <code>Identifier</code> and <code>Literal</code> separate types to better distinguish things:</p>\n\n<pre><code>data Identifier = Id String\ndata Literal = Lit String\n</code></pre>\n\n<p>But how do I define <code>Value</code> now? I thaught of something like this:</p>\n\n<pre><code>-- this doesn't actually work...\ndata Value = (Id String)  -- How to make Value be either an Identifier\n           | (Lit String) -- or a Literal?\n</code></pre>\n\n<p>I know I can simply do</p>\n\n<pre><code>data Value = ValueId Identifier\n           | ValueLit Literal\n</code></pre>\n\n<p>but this struck me as sort of unelegant and got me wondering if there was a better solution?</p>\n"}, {"tags": ["haskell", "overloading"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1445082443, "post_id": 33185207, "comment_id": 54178379, "body": "Why do you want this anyway? Just because <a href=\"http://www.parallelnetz.de/ScriptingHater.html\" rel=\"nofollow noreferrer\">Matlab allows multiplying anything you throw at it doesn&#39;t mean this is a good idea</a>. Check out <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\">vector-space</a> for properly dealing with multidimensional-multiplications. Alternatively, if you don&#39;t care so much for mathematical elegance, you can use <a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow noreferrer\">hmatrix</a> (which is in fact a lot like Matlab/Octave in Haskell), or <a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\">linear</a>."}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445082803, "post_id": 33185207, "comment_id": 54178497, "body": "@leftaroundabout Thanks for your link. Do you mean it is not a good idea  this kind of polymorphism (Not only matlab allows it)? Is it a bad idea &quot;in general&quot; or in Haskell?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1445083165, "post_id": 33185207, "comment_id": 54178593, "body": "Well, I think it&#39;s a bad idea in general, and really unnecessary in Haskell because you can just write <code>map (*x) ys</code> or <code>zipWith (*) xs ys</code> to make you intent explicit. This of course doesn&#39;t work for polymorphic code that&#39;s supposed to handle both scalars and vectors \u2013 however, writing such code to just deal with scalars or lists of any length is rather asking for trouble. It&#39;s awkward to specify which list needs to have a length matching which other list and what length the result will be etc.. This is where <code>vector-space</code> or <code>linear</code> shine, because they check dimensions at compile time."}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1445083446, "post_id": 33185207, "comment_id": 54178670, "body": "@leftaroundabout Thanks for your help."}], "answers": [{"comments": [{"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "edited": false, "score": 0, "creation_date": 1445082437, "post_id": 33185750, "comment_id": 54178375, "body": "I think you got wrong that I want somebody to correct &quot;my code&quot;. I just want the general solution (if any) to the question. Forget the code. My note was only to show that I&#39;m not just waiting for anyone do the job. Thanks for your answer. Gonna try it."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 1, "last_activity_date": 1445079171, "creation_date": 1445079171, "answer_id": 33185750, "question_id": 33185207, "link": "https://stackoverflow.com/questions/33185207/how-to-overload-a-function-for-multiplying-double-in-haskell-ad-hoc-polymorph/33185750#33185750", "title": "How to overload a function for multiplying [Double] in Haskell (ad-hoc polymorphism)?", "body": "<p>As always, statements like \"I'm trying (with no success) this\" are not quite as useful as you would like: it's good that you included your code, but if you are getting an error message from the compiler, <em>tell us</em> what it is! They're very instructive, and are printed for a reason.</p>\n\n<p>I just tried what you wrote, and this is in fact the error message you are (probably) getting:</p>\n\n<pre><code>*Multiplication&gt; mul 1 [2]\n\nNon type-variable argument\n  in the constraint: Multipliable ta [t] tc\n(Use FlexibleContexts to permit this)\nWhen checking that \u2018it\u2019 has the inferred type\n  it :: forall ta tc t. (Num ta, Num t, Multipliable ta [t] tc) =&gt; tc\n</code></pre>\n\n<p>Now, you could try just turning on FlexibleContexts, but that doesn't seem to solve the problem. But, as is often the case when the compiler is telling you it's having trouble inferring types, you should try adding some explicit types and see if that helps:</p>\n\n<pre><code>*Multiplication&gt; mul (1::Double) [2 :: Double]\n[2.0]\n</code></pre>\n\n<p>Basically, the compiler can't be sure which overload of <code>mul</code> you want: <code>1</code> and <code>2</code> are polymorphic and could be any numeric type, and while there is only one suitable overload for <code>mul</code> <em>now</em>, the compiler doesn't make such an inference unless it can prove no other overload could ever exist in this context. Fully specifying the argument types is enough to resolve the problem.</p>\n\n<p>An alternative approach to this particular problem is to use a typeclass for each argument, to convert it into the canonical type <code>[Double]</code>, rather than a typeclass for the arguments as a whole. This is a more specific solution than general ad hoc polymorphism, and not all problems will fit, but for something like treating a single number like a list of numbers it should be fine:</p>\n\n<pre><code>module Multiplication where\nimport Control.Monad (liftM2)\n\nclass AsDoubles a where\n  doubles :: a -&gt; [Double]\n\ninstance AsDoubles Double where\n  doubles = return\n\ninstance AsDoubles [Double] where\n  doubles = id\n\nmult :: (AsDoubles a, AsDoubles b) =&gt; a -&gt; b -&gt; [Double]\nmult x y = liftM2 (*) (doubles x) (doubles y)\n\n*Multiplication&gt; mult [(1 :: Double)..5] [(1 :: Double)..3]\n[1.0,2.0,3.0,      -- whitespace added for readability\n 2.0,4.0,6.0,\n 3.0,6.0,9.0,\n 4.0,8.0,12.0,\n 5.0,10.0,15.0]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "is_accepted": true, "score": 1, "last_activity_date": 1445084228, "last_edit_date": 1445084228, "creation_date": 1445083792, "answer_id": 33186464, "question_id": 33185207, "link": "https://stackoverflow.com/questions/33185207/how-to-overload-a-function-for-multiplying-double-in-haskell-ad-hoc-polymorph/33186464#33186464", "title": "How to overload a function for multiplying [Double] in Haskell (ad-hoc polymorphism)?", "body": "<p>I've managed to do it this way. Certainly not very nice.</p>\n\n<p>I think anyone should consider the comments and critics by leftaroundaobut to the question, that I quote below for convenience and relevance.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies, FlexibleInstances #-}\n\nclass Multipliable ta tb tc | ta tb -&gt; tc where\n      mul :: ta -&gt; tb -&gt; tc\n\ninstance Multipliable [Double] Double [Double] where\n          mul p k = map (*k) p --mul p k = map (\\a -&gt; k * a) p\n\ninstance Multipliable Double [Double] [Double] where\n          mul k p = map (*k) p --mul p k = map (\\a -&gt; k * a) p\n\ninstance Multipliable [Double] [Double] [Double] where\n         mul p q = p  -- dummy implementation\n\n\nr = [1.0, 2.0, 3.0]  :: [Double]\n\n\nr1 = (mul :: [Double] -&gt; Double -&gt; [Double]) r 2.0 \n\nr2 = (mul :: Double -&gt; [Double] -&gt; [Double]) 2.0 r\n\nr3 = (mul :: [Double] -&gt; [Double] -&gt; [Double]) r1 r2\n\n\nmain = do\n     print r1\n     print r2\n     print r3\n</code></pre>\n\n<blockquote>\n  <p>Why do you want this anyway? Just because Matlab allows multiplying\n  anything you throw at it doesn't mean this is a good idea. Check out\n  vector-space for properly dealing with\n  multidimensional-multiplications. Alternatively, if you don't care so\n  much for mathematical elegance, you can use hmatrix (which is in fact\n  a lot like Matlab/Octave in Haskell), or linear. </p>\n  \n  <p>I think it's a bad idea in general, and really unnecessary in Haskell because you can just write <code>map (*x) ys</code> or <code>zipWith (*) xs ys</code>\n  to make you intent explicit. This of course doesn't work for\n  polymorphic code that's supposed to handle both scalars and vectors \u2013\n  however, writing such code to just deal with scalars or lists of any\n  length is rather asking for trouble. It's awkward to specify which\n  list needs to have a length matching which other list and what length\n  the result will be etc.. This is where vector-space or linear shine,\n  because they check dimensions at compile time.</p>\n</blockquote>\n"}], "owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 33186464, "answer_count": 2, "score": 1, "last_activity_date": 1445084228, "creation_date": 1445075687, "last_edit_date": 1495540114, "question_id": 33185207, "link": "https://stackoverflow.com/questions/33185207/how-to-overload-a-function-for-multiplying-double-in-haskell-ad-hoc-polymorph", "title": "How to overload a function for multiplying [Double] in Haskell (ad-hoc polymorphism)?", "body": "<p>The way to have ad-hoc polymorphism (function overloading) in Haskell is through type classes (see answers to <a href=\"https://stackoverflow.com/questions/33177019/why-has-haskell-troubles-resolving-overloaded-operators\">this</a>, <a href=\"https://stackoverflow.com/questions/30039135/haskell-ad-hoc-polymorphism\">this</a> and <a href=\"https://stackoverflow.com/questions/3944756/best-way-to-implement-ad-hoc-polymorphism-in-haskell\">this</a> question, among others).</p>\n\n<p>But I'm struggling to define an overloaded <code>mult</code> (product) function for the following cases:</p>\n\n<pre><code>mult: [Double] -&gt; Double -&gt; [Double]\nmult: Double -&gt; [Double] -&gt; [Double]\nmult: [Double] -&gt; [Double] -&gt; [Double]\n</code></pre>\n\n<p>Thanks</p>\n\n<p>(At least, case 1 <code>[Double]*Double</code> and case 3 <code>[Double]*[Double]</code> would be necessary).</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1445084063, "creation_date": 1445084063, "answer_id": 33186509, "question_id": 33185060, "link": "https://stackoverflow.com/questions/33185060/parallelism-in-simple-prime-search-function/33186509#33186509", "title": "Parallelism in simple prime search function", "body": "<p>This answer is also available as a .lhs file at <a href=\"http://lpaste.net/143207\" rel=\"nofollow\">http://lpaste.net/143207</a></p>\n\n<p>The basic idea is that whenever you have an expression like:</p>\n\n<pre><code>map f xs\n</code></pre>\n\n<p>you can replace it with:</p>\n\n<pre><code>parMap strat f xs\n</code></pre>\n\n<p>to spawn off the map computation as sparks so that it will\nbe executed in parallel in the threaded runtime.\nA typical choice for <code>strat</code> is <code>rdeepseq</code> - see <a href=\"http://hackage.haskell.org/package/parallel-3.2.0.6/docs/Control-Parallel-Strategies.html#g:4\" rel=\"nofollow\">Basic Strategies</a> for other options.</p>\n\n<p>The problem is that spawning every single call to <code>f</code> as\na spark may not be cost effective. To realize any speedup\nyou may have to organize the work so that a spark is responsible\nfor calling <code>f</code> on a range of elements of the list.</p>\n\n<p>Let's write <code>isPrime</code> like this:</p>\n\n<pre><code>-- original version\nisPrime0 n = and $ map notfactor [2..limit]\n  where limit = div n 2\n        notfactor f = mod n f /= 0\n</code></pre>\n\n<p>(I've purposely extended the factor testing range so we don't\nhave to use large prime numbers for our tests.)</p>\n\n<p>The first idea would be to simply change the <code>map</code> into <code>parMap rdeepseq</code>:</p>\n\n<pre><code>-- spawn each call to notfactor as a spark\nisPrime1 n = and $ parMap rdeepseq notfactor [2..limit]\n  where limit = div n 2\n        notfactor f = mod n f /= 0\n</code></pre>\n\n<p>If you benchmark this, however, you'll find\nout this runs a lot slower than the sequential version.</p>\n\n<p>The next idea is to break up the range <code>[2..limit]</code> into\na small number of chunks like this:</p>\n\n<pre><code>-- evaluate the notfactor calls in ranges -- not parallized\nisPrime2 n = and $ map (\\r -&gt; all notfactor r) ranges\n  where limit = div n 2 -- ceiling $ sqrt $ fromIntegral n\n        notfactor f = mod n f /= 0\n        ranges = chunks 3 limit 10\n</code></pre>\n\n<p>Here <code>chunks a b k</code> is a function which splits the\nlist <code>[a..b]</code> into <code>k</code> equal sized ranges.</p>\n\n<p>To get a parallized version, we change the <code>map</code> call\ninto <code>parMap rdeepseq</code>:</p>\n\n<pre><code>-- evaluate the notfacto calls in ranges - parallelized\nisPrime3 n = and $ parMap rdeepseq (\\r -&gt; all notfactor r) ranges\n  where limit = div n 2\n        notfactor f = mod n f /= 0\n        ranges = chunks 3 limit 10\n</code></pre>\n\n<p>Some rough timings (in seconds) for the prime 15485863 and\nRTS option <code>-N1</code> vs. <code>-N2</code>:</p>\n\n<pre><code>              -N1      -N2\nisPrime0    0.624    0.673\nisPrime1   12.---   12.---\nisPrime2    0.573    0.603\nisPrime3    0.563    0.365\n</code></pre>\n\n<p>As you can see, <code>isPrime3</code> does exhibit some speedup. The timing for <code>isPrime1</code> is due to the fact that it is creating several million sparks compared to <code>isPrime3</code> which only creates 10 sparks.</p>\n\n<p>For completeness, here's the code for <code>chunks</code> and the\nprogram driver.</p>\n\n<pre><code>-- divide a range into equal size chunks\nchunks :: Integer -&gt; Integer -&gt; Integer -&gt; [[Integer]]\nchunks a b k = \n  let (q,r) = divMod (b - a) k\n      sizes = replicate (fromIntegral r) (q+1) ++ replicate (fromIntegral (k-r)) q\n      go x [] = []\n      go x (y:ys) = [x..x+y-1] : go (x+y) ys\n  in go a sizes\n\nmain :: IO ()\nmain = do\n  ( which : ps : _ ) &lt;- getArgs\n  let p = read ps\n  case which of\n    \"0\" -&gt; print $ isPrime0 p\n    \"1\" -&gt; print $ isPrime1 p\n    \"2\" -&gt; print $ isPrime2 p\n    \"3\" -&gt; print $ isPrime3 p\n</code></pre>\n"}], "owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 33186509, "answer_count": 1, "score": 0, "last_activity_date": 1445084063, "creation_date": 1445074705, "question_id": 33185060, "link": "https://stackoverflow.com/questions/33185060/parallelism-in-simple-prime-search-function", "title": "Parallelism in simple prime search function", "body": "<p>I am trying to learn concurrency and parallelism in Haskell.\nAnd I just started Simon Marlow's book. Not everything is clear though.\nAnd there aren't many (if any) simple examples on the internet.</p>\n\n<p>This is just a simple prime search function for learning purposes.\nCan this be parallelised? And if yes, can someone show an example with this function.</p>\n\n<pre><code>main = mapM_ print [x | x &lt;- [2..], isPrime x]\n\nisPrime :: Integer -&gt; Bool\nisPrime n = odd n &amp;&amp; all (\\ f -&gt; n `mod` f /= 0) [3..(ceiling $ sqrt $ fromIntegral n)]\n</code></pre>\n\n<p>I understand that I can use Strategies to map through a list in parallel.\nHow, for instance, would I test factors in the list in batches of 8, doing 8 tests in parallel? \nI would love an example please.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 2, "creation_date": 1445072188, "post_id": 33184706, "comment_id": 54175605, "body": "And what is the error?"}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1445072264, "post_id": 33184706, "comment_id": 54175632, "body": "I trust you only got a warning. Can you post the entire error please? Also, what is your function supposed to be doing?"}, {"owner": {"reputation": 33, "user_id": 4707157, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10203890572732403/picture?type=large", "display_name": "Javier Bertom&#233;u Mu&#241;oz", "link": "https://stackoverflow.com/users/4707157/javier-bertom%c3%a9u-mu%c3%b1oz"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1445072304, "post_id": 33184706, "comment_id": 54175639, "body": "*** Exception: Practica1.hs:(49,1)-(52,33): Non-exhaustive patterns in function ordena. It takes 3 numbers and order."}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 3, "creation_date": 1445072411, "post_id": 33184706, "comment_id": 54175666, "body": "You have an unhandled case... For example, what if x,y and z are all the same? You have to define these cases. See <a href=\"http://learnyouahaskell.com/syntax-in-functions#guards-guards\" rel=\"nofollow noreferrer\">learnyouahaskell.com/syntax-in-functions#guards-guards</a> for an example"}, {"owner": {"reputation": 33, "user_id": 4707157, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10203890572732403/picture?type=large", "display_name": "Javier Bertom&#233;u Mu&#241;oz", "link": "https://stackoverflow.com/users/4707157/javier-bertom%c3%a9u-mu%c3%b1oz"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1445072497, "post_id": 33184706, "comment_id": 54175681, "body": "Okay, just solved this problem. Thank u dude."}], "answers": [{"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 1, "last_activity_date": 1445075656, "creation_date": 1445075656, "answer_id": 33185203, "question_id": 33184706, "link": "https://stackoverflow.com/questions/33184706/non-exhaustive-patterns-in-function/33185203#33185203", "title": "Non-exhaustive patterns in function?", "body": "<p>You're not handling all of the possible cases:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let ordena :: (Ord a) =&gt; (a,a,a) -&gt; (a,a,a)\nPrelude|     ordena (x,y,z) | x &gt; y     =  ordena (y,x,z)\nPrelude|                    | x &gt; z     =  ordena (z,y,x)\nPrelude|                    | y &gt; z     =  ordena (x,z,y)\nPrelude| :}\nPrelude&gt; \nPrelude&gt; ordena 0 0 0\n\n&lt;interactive&gt;:22:1:\n    Couldn't match expected type \u2018Integer -&gt; Integer -&gt; t\u2019\n                with actual type \u2018(a0, a0, a0)\u2019\n    Relevant bindings include it :: t (bound at &lt;interactive&gt;:22:1)\n    The function \u2018ordena\u2019 is applied to three arguments,\n    but its type \u2018(a0, a0, a0) -&gt; (a0, a0, a0)\u2019 has only one\n    In the expression: ordena 0 0 0\n    In an equation for \u2018it\u2019: it = ordena 0 0 0\n</code></pre>\n\n<p>You need to add at least catch-all case to the pattern match:</p>\n\n<pre><code>ordena :: (Ord a) =&gt; (a,a,a) -&gt; (a,a,a)\nordena (x,y,z) | x &gt; y     =  ordena (y,x,z)\n               | x &gt; z     =  ordena (z,y,x)\n               | y &gt; z     =  ordena (x,z,y)\n               | otherwise =  ...\n</code></pre>\n\n<p>Alternatively, you might want to split the <code>otherwise</code> case into 2 or more more specific cases, but I can't tell you what those are because I don't know what <code>ordena</code> is supposed to stand for.</p>\n\n<hr>\n\n<p>In general though, you really should include the error message in the question. Right now, we can only guess that it's a runtime error and not a compile error, but sometimes that's not at all obvious, but even when it is, you should include the error.</p>\n"}], "owner": {"reputation": 33, "user_id": 4707157, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10203890572732403/picture?type=large", "display_name": "Javier Bertom&#233;u Mu&#241;oz", "link": "https://stackoverflow.com/users/4707157/javier-bertom%c3%a9u-mu%c3%b1oz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1445075656, "creation_date": 1445072075, "last_edit_date": 1445072146, "question_id": 33184706, "link": "https://stackoverflow.com/questions/33184706/non-exhaustive-patterns-in-function", "title": "Non-exhaustive patterns in function?", "body": "<p>I have an error in this code:</p>\n\n<pre><code>ordena :: (Ord a) =&gt; (a,a,a) -&gt; (a,a,a)\nordena (x,y,z)\n  | x &gt; y     =  ordena (y,x,z)\n  | x &gt; z     =  ordena (z,y,x)\n  | y &gt; z     =  ordena (x,z,y)\n</code></pre>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1445069872, "last_edit_date": 1445069872, "creation_date": 1445069396, "answer_id": 33184362, "question_id": 33183703, "link": "https://stackoverflow.com/questions/33183703/aeson-how-do-i-parse-an-object-with-an-element-that-is-a-stringified-object/33184362#33184362", "title": "Aeson: how do I parse an object with an element that is a stringified object?", "body": "<p>You can get more insight into what's going on by using:</p>\n\n<pre><code>main = print (eitherDecode testData :: Either String Foo)\n</code></pre>\n\n<p>which displays: <code>Left \"Error in $: expected Bar, encountered String\"</code></p>\n\n<p>In this code:</p>\n\n<pre><code> parseJSON (Object o) = do bar &lt;- (o .: \"bar\")\n                           Foo &lt;$&gt; o .: \"a\" &lt;*&gt; parseJSON bar\n</code></pre>\n\n<p><code>bar</code> is <code>String ...</code> value.</p>\n\n<p>To accomplish what you want to do, you could add a case to the FromJSON instance for Bar to catch this:</p>\n\n<pre><code>instance FromJSON Bar where\n  ...\n  parseJSON (String text) =\n    case eitherDecode (textToLBS text) of\n      Left  e -&gt; fail $ \"while decoding a Bar: \" ++ e\n      Right b -&gt; return b\n  ...\n</code></pre>\n\n<p>Or you could put this code in the parseJSON definition for Foo.</p>\n\n<p>Here <code>textToLBS</code> converts strict Text to lazy ByteStrings:</p>\n\n<pre><code>import qualified Data.Text as T\nimport qualified Data.ByteString.Lazy as LBS\nimport qualified Data.Text.Encoding as TE\n\ntextToLBS :: T.Text -&gt; LBS.ByteString\ntextToLBS t = LBS.fromStrict (TE.encodeUtf8 t)\n</code></pre>\n\n<p>Code available at: <a href=\"http://lpaste.net/143183\" rel=\"nofollow\">http://lpaste.net/143183</a></p>\n"}], "owner": {"reputation": 538, "user_id": 500511, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/99duf.png?s=128&g=1", "display_name": "helpwithhaskell", "link": "https://stackoverflow.com/users/500511/helpwithhaskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 33184362, "answer_count": 1, "score": 3, "last_activity_date": 1445069872, "creation_date": 1445064293, "question_id": 33183703, "link": "https://stackoverflow.com/questions/33183703/aeson-how-do-i-parse-an-object-with-an-element-that-is-a-stringified-object", "title": "Aeson: how do I parse an object with an element that is a stringified object?", "body": "<p>I need to parse an object that has a string element where the string itself is a stringified object:</p>\n\n<pre><code>{ \n  \"a\"   : \"apples\",\n  \"bar\" : \"{\\\"b\\\":\\\"bananas\\\"}\"\n}\n</code></pre>\n\n<p>I would like to parse this into <code>Just ( Foo { fooA = \"apples\", fooBar = Bar { barB = \"bananas\" } } )</code> so if parsing of <code>bar</code> returns <code>Nothing</code> then the parsing of the whole object returns <code>Nothing</code>, ie the result is as though the <code>bar</code> element of the object was not stringified.</p>\n\n<p>Here is my attempt in which the parsing of <code>testData</code> returns <code>Nothing</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Data.Aeson  \nimport Data.Aeson.Types\n\ndata Foo = Foo { fooA :: String\n               , fooBar :: Bar\n               } deriving (Show)\n\ninstance FromJSON Foo where\n  parseJSON (Object o) = do bar &lt;- (o .: \"bar\")\n                            Foo &lt;$&gt; o .: \"a\" &lt;*&gt; parseJSON bar\n  parseJSON x          = typeMismatch \"Foo\" x\n\ndata Bar = Bar { barB :: String\n               } deriving (Show)\n\ninstance FromJSON Bar where\n  parseJSON (Object o) = Bar &lt;$&gt; o .: \"b\"\n  parseJSON x          = typeMismatch \"Bar\" x\n\ntestData = \"{ \\\"a\\\":\\\"apples\\\", \\\"bar\\\":\\\"{\\\\\\\"b\\\\\\\":\\\\\\\"bananas\\\\\\\"}\\\" }\"\n\nmain :: IO ()\nmain = putStrLn $ show d\n  where d :: Maybe Foo\n        d = decode testData\n</code></pre>\n\n<p>How can I modify the above code to perform closer to what I need?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1445068963, "post_id": 33182803, "comment_id": 54174880, "body": "Thanks for the answer. However, I need a solution which can deal with effectively infinite stream of records, using only constant memory, and do the processing as soon as each group is detected. I added the transcript of what my example code would look like when run."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1445081345, "post_id": 33182803, "comment_id": 54178018, "body": "@trVoldemort, the program in this answer does that."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1445101330, "post_id": 33182803, "comment_id": 54184240, "body": "@trVoldemory as Reid said, this is streaming and can operate in constant space.  Why would you think otherwise?  It send to her that you are reaching for more complex tools too quickly."}, {"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1445117024, "post_id": 33182803, "comment_id": 54189234, "body": "My apologies Thomas, I didn&#39;t realize <code>getContents</code> reads the input lazily. Now I agree that your answer is correct to my particularly framed question. However that&#39;s not quite what I want because of the actual form of my input -- instead of <code>stdin</code> (or a file), it only exposes it self with a function <code>get1 :: IO (Maybe Record)</code>, which with each call returns one record <code>Just record</code> unless the data is depleted, in which case it returns <code>Nothing</code>.  ( @ReidBarton )"}, {"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1445119755, "post_id": 33182803, "comment_id": 54189988, "body": "Thomas, per your suggestions, I framed my questions to better suit my needs and made it clearer. Thanks for the advice. And if you are interested, I have isolated out the above <a href=\"http://stackoverflow.com/questions/33192048/is-it-possible-to-have-a-lazy-version-of-sequence-without-using-unsafeios\">question here</a>. ( @ReidBarton )"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1445203283, "post_id": 33182803, "comment_id": 54211498, "body": "Well, it isn&#39;t obvious that <code>getContents</code> is lazy unless you know that it is implemented using <code>unsafeInterleaveIO</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1445056724, "creation_date": 1445056724, "answer_id": 33182803, "question_id": 33182492, "link": "https://stackoverflow.com/questions/33182492/how-do-i-separate-a-stream-of-1s-and-2s-into-groups/33182803#33182803", "title": "How do I separate a stream of `1`s and `2`s into groups?", "body": "<p>First off, I didn't bother to decipher your code - so this is likely not quite what you need but hopefully close.  A better question should net a better answer.  Namely, if you describe clearly what you are trying to solve and your difficulty solving it in the most straight-forward manner rather than show the attempt you arrived at before giving up it might help.</p>\n\n<p>So you want to read stdin and group the data by some computation on each line then run computations on the groups?  That English sentence almost directly translates to the needed Haskell:</p>\n\n<pre><code>import Data.List\nimport Data.Function\n\nmain :: IO ()\nmain = do\n  do input &lt;- getContents\n     print $ map computation (groupBy ((==) `on` grouper) (lines input))\n\ngrouper = id\n\ncomputation = (\"I see a block of stuff of length: \" ++) . show . length\n</code></pre>\n\n<p>With the input/output:</p>\n\n<pre><code>1\n1\n1\n1\n1\n1\n2\n2\n2\n2\n2\n2\n2\n2\n2\n1\n[\"I see a block of stuff of length: 6\",\"I see a block of stuff of length: 9\",\"I see a block of stuff of length: 1\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 1, "creation_date": 1445117153, "post_id": 33182897, "comment_id": 54189277, "body": "Thanks for the detailed answer. I&#39;m looking into this package."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 4, "last_activity_date": 1445057775, "creation_date": 1445057775, "answer_id": 33182897, "question_id": 33182492, "link": "https://stackoverflow.com/questions/33182492/how-do-i-separate-a-stream-of-1s-and-2s-into-groups/33182897#33182897", "title": "How do I separate a stream of `1`s and `2`s into groups?", "body": "<p>Collecting lines of input in a streamlined way usually involves an iteratee-style library like pipes or conduit. I'll use pipes out of familiarity but something similar could probably be accomplished with conduit.</p>\n\n<p>First, there's the matter of grouping. Pipes handles this with a low-level library called <code>pipes-group</code> that manages grouping into substreams without collecting elements into memory. (It is the basis of similar functionality in the <code>pipes-bytestring</code> and <code>pipes-text</code> libraries.)</p>\n\n<p>pipes-group accomplishes this by splitting the input into multiple Producers delimited using <code>FreeT</code>. FreeT essentially allows for the construction of a \"linked list\" of producers.</p>\n\n<pre><code>import Control.Lens\nimport Pipes\nimport Pipes.Group\nimport qualified Pipes.Prelude as P\n\nmain = runEffect $ (concats . view groups) P.stdinLn &gt;-&gt; P.stdoutLn\n</code></pre>\n\n<p>This will group input lines (by <code>(==)</code>) but then immediately concatenate them back together, which is not very useful. To demonstrate that the grouping is really happening, we can use <code>intercalates</code>:</p>\n\n<pre><code>import Control.Lens\nimport Pipes\nimport Pipes.Group\nimport qualified Pipes.Prelude as P\n\nmain = runEffect $\n         (intercalates (yield \"!\") . view groups) P.stdinLn &gt;-&gt; P.stdoutLn\n</code></pre>\n\n<p>This will output a \"!\" in between each group, which at least shows that the grouping is working properly. To collect the elements of the group together, we use the built-in support for the <code>foldl</code> library's streaming folds:</p>\n\n<pre><code>import Control.Lens\nimport Pipes\nimport Pipes.Group\nimport qualified Pipes.Prelude as P\n\nmain = runEffect $\n         (folds (++) [] id . view groups) P.stdinLn &gt;-&gt; P.stdoutLn\n</code></pre>\n\n<p>Note that while stdin will be streamed in constant space, this will collect the entire groups into memory in the resulting lists, but of course there's no way to avoid that.</p>\n\n<p>For more info, see the <a href=\"https://hackage.haskell.org/package/pipes-group-1.0.2/docs/Pipes-Group-Tutorial.html\" rel=\"nofollow\">pipes-group tutorial</a> and the <a href=\"https://hackage.haskell.org/package/foldl\" rel=\"nofollow\">foldl package</a>.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 33182897, "answer_count": 2, "score": 1, "last_activity_date": 1445117883, "creation_date": 1445053374, "last_edit_date": 1445117883, "question_id": 33182492, "link": "https://stackoverflow.com/questions/33182492/how-do-i-separate-a-stream-of-1s-and-2s-into-groups", "title": "How do I separate a stream of `1`s and `2`s into groups?", "body": "<p>Imagine I have a <em>really</em> long file like this:</p>\n\n<pre><code>1\n1\n1\n1\n2\n2\n2\n2\n1\n1\n1\n1\n2\n2\n1\n1\n2\n2\n...\n</code></pre>\n\n<p>I'm interested in separating and performing computation on each group of consecutive <code>1</code>s along with the consecutive <code>2</code>s that come immediately after it.</p>\n\n<p><em>However</em>, the problem is somewhat more complicated in reality. First, the records are not simply <code>1</code>s and <code>2</code>s but something larger, let's say individual <code>Record</code>s, and it requires some computation to determine whether a <code>Record</code> is <code>1</code> or <code>2</code>; second, instead of exposed as a file, the data source only exposes it self with a retrieving function, let's say <code>get1 :: IO (Maybe Record)</code>. This function returns one record <code>Just record</code> with each call, and returns <code>Nothing</code> when the data is depleted; and finally, the file is large (effectively infinite), I have to do it in a stream-lined way with constant memory usage.</p>\n\n<p>Here is a supposed transcript demonstrating how I want it to behave: (the <code>1</code>s and <code>2</code>s are the <code>Record</code>s retrieved from <code>get1</code> calls, and the <code>(,)</code>s represent computations happened immediately after each detection of group)</p>\n\n<pre><code>1\n1\n1\n2\n2\n1\n([\"1\",\"1\",\"1\"],[\"2\",\"2\"])\n2\n1\n([\"1\"],[\"2\"])\n1\n1\n1\n2\n2\n2\n2\n1\n([\"1\",\"1\",\"1\",\"1\"],[\"2\",\"2\",\"2\",\"2\"])\n</code></pre>\n"}, {"tags": ["haskell", "type-kinds"], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1445090642, "post_id": 33182676, "comment_id": 54180822, "body": "Note, <code>iso</code> and probably <code>Wrapped</code> in the <code>lens</code> package allows to do similar things."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 10, "last_activity_date": 1445058311, "last_edit_date": 1445058311, "creation_date": 1445055406, "answer_id": 33182676, "question_id": 33182461, "link": "https://stackoverflow.com/questions/33182461/using-an-fmap-like-function-on-types-of-kind/33182676#33182676", "title": "Using an &#39;fmap-like&#39; function on types of kind *", "body": "<p>I don't think there's a good generic solution for the second half of the question, but I can at least answer the first half.</p>\n\n<p>This is the purpose of the <a href=\"https://hackage.haskell.org/package/mono-traversable\">mono-traversable</a> package, which provides a <a href=\"https://hackage.haskell.org/package/mono-traversable-0.10.0/docs/Data-MonoTraversable.html#t:MonoFunctor\"><code>MonoFunctor</code></a> typeclass. The instance for <code>A'</code> would be:</p>\n\n<pre><code>type instance Element A' = Int\n\ninstance MonoFunctor a' where\n  omap f (A' i) = A' (f i)\n</code></pre>\n\n<p>YMMV on how useful this is versus a simple <code>a'map :: (Int -&gt; Int) -&gt; A' -&gt; A'</code> function or a lens.</p>\n"}], "owner": {"reputation": 945, "user_id": 4610065, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/BTON9.jpg?s=128&g=1", "display_name": "Michael T", "link": "https://stackoverflow.com/users/4610065/michael-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1445058311, "creation_date": 1445053013, "last_edit_date": 1445055270, "question_id": 33182461, "link": "https://stackoverflow.com/questions/33182461/using-an-fmap-like-function-on-types-of-kind", "title": "Using an &#39;fmap-like&#39; function on types of kind *", "body": "<p>Say we have a data type defined as</p>\n\n<pre><code>data A a = A' a deriving Show \n</code></pre>\n\n<p>We have</p>\n\n<pre><code>A :: * -&gt; *\n</code></pre>\n\n<p>We can then make A an instance of <code>Functor</code>:</p>\n\n<pre><code>instance Functor A where fmap f (A' x) = A' (f x)\n</code></pre>\n\n<p>This allows us to make a value of type <code>A</code> and use <code>fmap</code> to apply a function to the wrapped value</p>\n\n<pre><code>Prelude&gt; let x = A' 1\nPrelude&gt; fmap (+1) x\nA' 2\n</code></pre>\n\n<p>Now, if we defined <code>A</code> as</p>\n\n<pre><code>data A = A' Int deriving Show\n</code></pre>\n\n<p>The kind of <code>A</code> is</p>\n\n<pre><code>A :: *\n</code></pre>\n\n<p>Consequently, we can not make <code>A</code> an instance of Functor -</p>\n\n<pre><code>instance Functor A where fmap f (A' x) = A' (f x)\n\n&lt;interactive&gt;:4:18:\n    Kind mis-match\n    The first argument of `Functor' should have kind `* -&gt; *',\n    but `A' has kind `*'\n    In the instance declaration for `Functor A'\n</code></pre>\n\n<p>My question is, is there a generic way to apply a function to the wrap value for data types of kind <code>*</code> with a data constructor that only takes one parameter (i.e., something analogous to <code>fmap</code>)? It's fairly easy to write custom function:</p>\n\n<pre><code>Prelude&gt; let myFmap f (A' x) = A' (f x)\nPrelude&gt; let x = A' 1\nPrelude&gt; myFmap (+1) x\nA' 2\n</code></pre>\n\n<p>It's also possible to make <code>A</code> an instance of <code>Num</code>:</p>\n\n<pre><code>instance Num A where (+) (A' x) (A' y) = A' (x + y) -- Ignoring the warnings\nPrelude&gt; A' 1 + A' 1 \nA' 2\n</code></pre>\n\n<p>Both of these approaches work but is there a better way that I am missing?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1445048914, "post_id": 33182072, "comment_id": 54171114, "body": "Yes I have. In fact the <code>runGet</code> and <code>getWord32be</code> are from that package. I mean it&#39;s always possible to parse a file using &quot;binary&quot;, but I miss the <code>many</code>, <code>choice</code>, <code>*&gt;</code> and <code>&lt;|&gt;</code> etc in &quot;attoparsec&quot;, which makes constructing complex parsing logic much more pleasant."}, {"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1445049041, "post_id": 33182072, "comment_id": 54171130, "body": "Now I think about it, maybe I&#39;m asking for too much."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 1, "creation_date": 1445049086, "post_id": 33182072, "comment_id": 54171139, "body": "Do you really need to backtrack? Usually binary formats are designed so you don&#39;t have to."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1445048482, "creation_date": 1445048482, "answer_id": 33182072, "question_id": 33182003, "link": "https://stackoverflow.com/questions/33182003/is-there-a-binary-parsing-package-that-is-higher-level-than-attoparsec/33182072#33182072", "title": "Is there a binary parsing package that is higher level than attoparsec?", "body": "<p>Have you looked at the <a href=\"https://hackage.haskell.org/package/binary-0.7.6.1/docs/Data-Binary-Get.html\" rel=\"nofollow\"><strong>binary</strong></a> package?</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1445048482, "creation_date": 1445047822, "last_edit_date": 1445048125, "question_id": 33182003, "link": "https://stackoverflow.com/questions/33182003/is-there-a-binary-parsing-package-that-is-higher-level-than-attoparsec", "title": "Is there a binary parsing package that is higher level than attoparsec?", "body": "<p>I'm trying to parse a binary file that has a specific structure. I'm currently looking into the \"attoparsec\" package, but I feel the level is too low for this application.</p>\n\n<p>For example, in order to read in an <code>Int32</code> I have to do this:</p>\n\n<pre><code>return\n    . (fromIntegral :: Word32 -&gt; Int32)\n    . runGet getWord32le\n    . BS.fromStrict\n    =&lt;&lt; A.take 4\n</code></pre>\n\n<p>I think this is way too complicated for just one <code>Int32</code>! However, I really like the framework provided by the <code>parsec</code>-style parsing, so that I can define the syntax in a style similar the grammar itself.</p>\n\n<p>Is there a higher-level parsing solution for binary files? Ideally it's a package that's based on attoparsec, and has helper functions to read in various types of values, like <code>Char</code>, <code>Int</code>, <code>Float</code>, etc.</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445040717, "post_id": 33181063, "comment_id": 54169711, "body": "I <a href=\"http://ideone.com/hQu1ut\" rel=\"nofollow noreferrer\">can&#39;t</a> reproduce. Are you compiling with <code>-O2</code>? You can make <code>go</code> safely stricter by removing only the first irrefutable pattern in <code>plus</code>, thus saying &quot;I need <code>seq</code>, but not <code>deepseq</code>&quot;. BTW, <code>foldr mplus mzero</code> is <code>msum</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445050899, "post_id": 33181063, "comment_id": 54171454, "body": "@user3237465 I am compiling with optimizations. I can reproduce the problem with exactly the module you linked. Removing only the first irrefutable pattern has no effect. What version of ghc are you using? Perhaps I should include the results of profiling on my machine in the question."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1445070058, "post_id": 33181063, "comment_id": 54175160, "body": "@user2407038 what ghc versions are <i>you</i> using. When you post a question <i>you</i> should make sure that other people can reproduce the results and thus find a solution. So it&#39;s <i>your</i> version of ghc that is important in order to answer your question."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445086769, "post_id": 33181063, "comment_id": 54179616, "body": "The version with a space leak runs in <code>188</code> MB with my configuration (GHC version 7.8.3). Changing <code>plus</code> to <code>plus (m0, !l0) ~(m1, l1) = (mplus m0 m1, l0 ++ l1)</code> results in <code>75</code> MB. After forcing the entire <code>l0</code> in <code>plus</code>, I get <code>34</code> MB, but that doesn&#39;t work for trees with childs that have infinite number of childs."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1445110162, "post_id": 33181063, "comment_id": 54187335, "body": "@Bakuriu I tested on several versions, because I had run into issues before where a certain version of GHC had some performance issue in some edge cases. The problem was found on every version I tested, so I didn&#39;t feel it would be relevant. Anyways, I&#39;ll include those versions in the question."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445110484, "post_id": 33181063, "comment_id": 54187431, "body": "@user3237465 It seems there are actually two spaces leaks. One due to the irrefutable pattern on the first tuple. The other due to the list being too lazy... perhaps a different data structure is needed?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445111115, "post_id": 33181063, "comment_id": 54187623, "body": "@user3237465 It seems that <code>++</code> is part of the problem.. it requires the entire first list to be traversed, which never happens for infinite lists. Replacing <code>l0 ++ l1</code> with <code>fairMerge l0 l1</code>, (<a href=\"https://gist.github.com/yuriy0/69064a8b549e0b50b3e2\" rel=\"nofollow noreferrer\">fairMerge</a>) reduces residency on my machine by a factor of 10, from 300MB to 30MB! This still isn&#39;t perfect (30MB &gt;&gt; 2MB)  but still a step in the right direction. Thank you for the help."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445116268, "post_id": 33181063, "comment_id": 54189017, "body": "For <code>tree0</code> <code>l0</code> is always finite: the version with <code>plus (m0, l0) ~(m1, l1) | seq (foldl const () l0) True = (mplus m0 m1, l0 ++ l1)</code> runs in <code>18</code> MB on my machine. As well as the version with <code>fairMerge</code> and a bang pattern before <code>l0</code>. The version with <code>fairMerge</code> consumes less memory, because <code>fairMerge</code> forces both lists, not just the first as <code>(++)</code>: <code>(+++)</code> works equally well (<code>xs +++ [] = xs; [] +++ ys = ys; (x:xs) +++ ys = x : (xs +++ ys)</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445202791, "post_id": 33198499, "comment_id": 54211336, "body": "&quot;If you want to just cut off the branches that are too deep&quot; - I don&#39;t, this is a different function altogether which would not suit my needs. Your earlier statement &quot;Which is essentially breadth-first search, going by cu levels in each pass&quot; was correct - this is exactly what I want. Also, I used <code>MonadPlus</code> because I use <code>return</code>."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445282643, "post_id": 33198499, "comment_id": 54249054, "body": "@user2407038 I see, so you don&#39;t want to cut off the branches that are too deep, you just want to traverse them later. I&#39;ll have another look then. Is there a particular reason why you want to do this leveled approach, and not just plain breadth-first search, which would be simpler?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1445282785, "post_id": 33198499, "comment_id": 54249132, "body": "@user2407038 You don&#39;t need to use <code>return</code>, it&#39;s role is replaced by <code>a -&gt; m</code> for a monoid <code>m</code>. You could simplify even more, as your structure is a functor, you could only concentrate to cases where your structure containd monoid elements <code>(Monoid m) =&gt; SearchTree m -&gt; ...</code> and use <code>fmap</code> before evaluating it. It&#39;s just as <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html#v:foldMap\" rel=\"nofollow noreferrer\"><code>fmap</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html#v:fold\" rel=\"nofollow noreferrer\"><code>fold</code></a>. For folding, <code>Monoid</code> is enough, for traversing, <code>Applicative</code> is enough."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1445404433, "post_id": 33198499, "comment_id": 54304381, "body": "@Petr Pudl&#225;k, <a href=\"http://okmij.org/ftp/continuations/Searches.hs\" rel=\"nofollow noreferrer\">the leveled approach</a> can be much more efficient, if you turn off memoization. I guess, combining <code>iter_deepening</code> with DFS can give you the best of  two worlds."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 1, "last_activity_date": 1445175137, "creation_date": 1445175137, "answer_id": 33198499, "question_id": 33181063, "link": "https://stackoverflow.com/questions/33181063/how-to-fix-space-leak-caused-by-laziness-when-your-algorithm-relies-on-laziness/33198499#33198499", "title": "How to fix space leak caused by laziness when your algorithm relies on laziness", "body": "<p>It seems to me that the reason for the memory leak is actually a bug in the implementation. Your <code>cutoff</code> function mixes together cutting off too deep branches with evaluating the upper part. And then in <code>cutoffEval</code>, you go deeper to the bottom, cut branches, and continue to explore them recursively. Which is essentially breadth-first search, going by <code>cu</code> levels in each pass. This means that the whole tree will eventually be constructed and retained in memory until the end! (Unlike the case of a depth-first search, where visited subtrees can be reclaimed by the GC.)</p>\n\n<p>If you want to just cut off the branches that are too deep, getting the first part of the result of <code>cutoff</code> is what you want.</p>\n\n<p>In any case I'd suggest to separate the evaluator and the cut-off part (see below). In such a case you can just use the original evaluator on the cut-off version of the tree.</p>\n\n<p>One additional remark, from the <code>MonadPlus</code> constraint you use just the monoidal part - <code>mzero</code> and <code>mplus</code>. It'd be cleaner and more generic to use just <code>Monoid</code>. There are more monoids than monads (for example <code>Sum</code> to just count solutoins, or <code>Last</code> to find the last solution).</p>\n\n<pre><code>simpleEval :: (Monoid m) =&gt; (a -&gt; m) -&gt; SearchTree a -&gt; m\nsimpleEval f = go\n  where\n    go (Solution a) = f a\n    go Contradiction = mempty\n    go (Search ps) = mconcat $ map go ps \n\ncutoff :: Int -&gt; SearchTree a -&gt; SearchTree a\ncutoff cu = go cu\n  where \n    go 0 _             = Contradiction -- too deep branches are just failures\n    go d (Search ps)   = Search $ map (go (d - 1)) ps\n    go _ x             = x\n\ncutoffEval :: (Monoid m) =&gt; Int -&gt; (a -&gt; m) -&gt; SearchTree a -&gt; m\ncutoffEval cu f = simpleEval f . cutoff cu\n</code></pre>\n"}], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1445175137, "creation_date": 1445038698, "last_edit_date": 1445110208, "question_id": 33181063, "link": "https://stackoverflow.com/questions/33181063/how-to-fix-space-leak-caused-by-laziness-when-your-algorithm-relies-on-laziness", "title": "How to fix space leak caused by laziness when your algorithm relies on laziness", "body": "<p>I have some algorithm which generates a search tree:</p>\n\n<pre><code>data SearchTree a = Solution a | Contradiction | Search [ SearchTree a ]\n  deriving (Show, Functor)\n</code></pre>\n\n<p>The algorithm generates this tree lazily. I also defined a simple evaluator, which is really just depth first search.</p>\n\n<pre><code>simpleEval :: MonadPlus m =&gt; SearchTree a -&gt; m a\nsimpleEval (Solution a) = return a \nsimpleEval Contradiction = mzero \nsimpleEval (Search ps) = foldr mplus mzero $ map simpleEval ps \n</code></pre>\n\n<p>I noticed that many of the solutions that my algorithm produces look something like the following search tree:</p>\n\n<pre><code>nest :: Int -&gt; SearchTree a -&gt; SearchTree a \nnest 0 = id \nnest n = nest (n-1) . Search . (:[]) \n\ntree0 = Search ts where \n  ts = cycle $ t0 : replicate 100 t1 ++ [t2]\n  t0 = nest 100 $ Solution 'a' \n  t1 = nest 1000 $ Contradiction \n  t2 = nest 4 $ Solution 'b' \n</code></pre>\n\n<p>Namely, they have a lot of very deep branches with no solutions, a few deep branches with a solution, and very few shallow branches with a solution. On this basis, I decided I wanted another evaluator, one which will 'give up' on branches that are too deep. Call it <code>cutoffEval</code>. <code>cutoffEval 5 tree0</code> should find only <code>b</code>s because it there are infinitely many branches of depth less than 5 to consider, and they only contain <code>b</code>s. I implemented it like so:</p>\n\n<pre><code>cutoff :: (MonadPlus m) =&gt; Int -&gt; SearchTree a -&gt; (m a, [SearchTree a])\ncutoff cu = go cu where \n  plus ~(m0, l0) ~(m1, l1) = (mplus m0 m1, l0 ++ l1)\n  zero = (mzero, [])\n\n  go 0 x             = (mzero, [x])\n  go _ Contradiction = zero\n  go _ (Solution a)  = (return a, [])\n  go d (Search ps)   = foldr plus zero $ map (go $ d-1) ps\n\ncutoffEval :: MonadPlus m =&gt; Int -&gt; SearchTree a -&gt; m a\ncutoffEval cu = go where \n  go t = case cutoff cu t of (r,ts) -&gt; foldr mplus mzero $ r : map go ts \n</code></pre>\n\n<p>But this function produces a huge space leak, as compared to <code>simpleEval</code>:</p>\n\n<pre><code>putStrLn $ take 4000 $ simpleEval tree0  -- 2MB residency\nputStrLn $ take 4000 $ cutoffEval 10 tree0  -- 600MB residency\n</code></pre>\n\n<p>Profiling reveals that almost all allocation occurs in <code>cutoff.go</code>; and the majority of allocation is due something mysterious called <code>main:Tree.sat_s5jg</code> and the <code>(,)</code> constructor. This seems to me due to the irrefutable patterns, the tuple constructors are being built up as thunks instead of being forced by <code>plus</code>; and normally the solution to a space leak is to make your function stricter, but here removing the irrefutable patterns causes <code>cutoff</code> to hang, so I cannot do it. </p>\n\n<p>I tested this with GHC 7.6, 7.8 and 7.10. The problem was found in each one. </p>\n\n<p>So my questions are: Can <code>cutoffEval</code> be written to run in constant space like <code>simpleEval</code>? And more generally, how do I fix a space leak, if I can't make my implementation stricter because the algorithm depends on it? </p>\n"}, {"tags": ["multithreading", "haskell", "memory", "concurrency"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1445035456, "post_id": 33179735, "comment_id": 54168381, "body": "Have you tried to minimize the example? How small of a program can you make that still exhibits this &quot;more threads = less memory&quot; behavior?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1445039411, "post_id": 33179735, "comment_id": 54169425, "body": "Have you verified that your program is correct? Maybe some threads are getting deadlocked or throwing an exception and so end up doing less work than when run with <code>-N1</code>. <code>async</code> is a thin library that propagates  exceptions for you among other nice things"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1445040835, "post_id": 33179735, "comment_id": 54169737, "body": "the only output I get from your program compiled with <code>ghc-7.10.1 --make -O2 -rtsopts -threaded</code> is <code>Start main\\nStart Scheduler</code> and then it hangs. I tried <code>mapM_ (\\thID -&gt; forkIO $ putStrLn &quot;I never see this&quot; &gt;&gt; aThread ic thID c us clk msg fin) thIDs</code> and don&#39;t ever get that output even though we&#39;re mapping over a non-empty list, which I don&#39;t understand at all."}, {"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1445056537, "post_id": 33179735, "comment_id": 54172434, "body": "@jberryman Yes, I tested this program, and it works well. However, as like as I wrote in comment, this program does not work with optimisation option. I couldn&#39;t understand this problem. I tested this in (OS X, ghc-7.10.1) and (Linux ghc 7.8.4), and without optimisation option, it works. and with optimisation option, it hangs. The optimisation problem is next problem."}, {"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445061625, "post_id": 33179735, "comment_id": 54173348, "body": "@DanielWagner Yes, I tried another example (specifically, previous versions of this program) and smaller schedules. All of those codes shows that same results. To study more, I may try another subject."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445102214, "post_id": 33179735, "comment_id": 54184538, "body": "@QuietJoon This program does not look very small. I would encourage you to try again to make the smallest program you can that exhibits the behavior. I bet you can get it down under 15 lines of code. This will certainly make the question more attractive to experts here, and has a chance of making the answer apparent to you, as well."}, {"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445631614, "post_id": 33179735, "comment_id": 54420441, "body": "@DanielWagner Thanks for your advice. I didn&#39;t understand your meaning before."}], "owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1445637607, "creation_date": 1445030462, "last_edit_date": 1445637607, "question_id": 33179735, "link": "https://stackoverflow.com/questions/33179735/why-threaded-program-allocated-less-heap-in-this-case", "title": "Why threaded program allocated less heap (in this case)?", "body": "<p>I just started to study concurrent programming.<br>\nIn this case, the threaded case uses more memory (Of course).  </p>\n\n<p><strong>However, the threaded case allocates less heap</strong> then not-threaded program.<br>\nIs this not not particular case?<br>\nOr using <code>-N1</code> option is not good with a program compiled with <code>-threaded</code> option?</p>\n\n<p><strong>I can't understand that why a threaded case allocated less heap</strong>.\nIn my guess, switching threads produces this situation.</p>\n\n<p>Could you explain me about this situation?</p>\n\n<p>I think this program is nothing special, and have tiny input(schedules).</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Monad\nimport System.IO\n\n{-\n  This code hangs when \"Start scheduler\" when compile with option \"-O*\" without `hFlush stdout`.\n    This problem is described as another question\n    (http://stackoverflow.com/questions/33311980).\n  In this code, the problem isn't fixed to weight processing load.\n  Please do not compile this code with optimize option.\n-}\n\nmain = do\n  count &lt;- newMVar 0\n  clock &lt;- newMVar 0\n  finished &lt;- newMVar 0\n  out &lt;- newMVar ()\n  mapM_ (\\thID -&gt; forkIO $ aThread thID count out clock finished) [0..(length schedules - 1)]\n  wmPutStrLn out \"Start Scheduler\"\n  scheduler out count clock finished (length schedules)\n  where\n    scheduler out c clk fin thNum = loop\n      where loop = do\n              finished &lt;- readMVar fin\n              if finished == thNum\n                then do\n                  return ()\n                else do\n                  now &lt;- readMVar c\n                  when (now == thNum - finished) $ do\n                    _ &lt;- swapMVar c 0 -- I don't like this.\n                    modifyMVar_ clk (return .(+1))\n                    nClk &lt;- readMVar clk\n                    wmPutStrLn out $ \"Clock up: \" ++ show nClk\n                  loop\n\n-- A thread, I think you don't care about this. Just a processing load.\naThread thID c out clk fin = do\n  wmPutStrLn out \"A thread is initialized\"\n  loop (schedules !! thID) 0\n  where\n    loop aSch pClk =\n      if null aSch\n        then do\n          modifyMVar_ fin (return . (+1))\n          return ()\n        else do\n          now &lt;- readMVar clk\n          if pClk == now\n            then do\n              modifyMVar_ c (return . (+1))\n              let (t,aMsg) = head $ aSch\n              if now == t\n                then do\n                  wmPutStrLn out aMsg\n                  loop (tail aSch) (pClk+1)\n                else do\n                  loop aSch (pClk+1)\n            else loop aSch pClk\n\nschedules :: [[(Int,String)]]\nschedules =\n    [ [(1,\"A1\"),(2,\"A2\")]\n    , [(0,\"B0\"),(3,\"B3\")]\n    , [(1,\"C1\"),(2,\"C2\"),(3,\"C3\")]\n    , [(0,\"D0\"),(2,\"D2\")]\n    , [(0,\"E0\"),(1,\"E1\"),(2,\"E2\")]\n    , [(5,\"F5\")]\n    , []\n    , [(4,\"H4\"),(6,\"H6\"),(8,\"H8\")]]\n\nwmPutStrLn mv str = withMVar mv $ \\_ -&gt; putStrLn str\n</code></pre>\n\n<p>Compare these outputs:</p>\n\n<pre><code>$ ./Scheduler04.toAsk  +RTS -s -N1 &gt; /dev/null\n   3,446,295,648 bytes allocated in the heap\n       4,112,880 bytes copied during GC\n          56,776 bytes maximum residency (2 sample(s))\n          21,048 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      6636 colls,     0 par    0.020s   0.024s     0.0000s    0.0007s\n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N1)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    1.246s  (  1.266s elapsed)\n  GC      time    0.020s  (  0.024s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    1.267s  (  1.291s elapsed)\n\n  Alloc rate    2,766,218,149 bytes per MUT second\n\n  Productivity  98.4% of total user, 96.5% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n\n\n$ ./Scheduler04.toAsk  +RTS -s -N2 &gt; /dev/null\n   1,027,098,440 bytes allocated in the heap\n       1,070,584 bytes copied during GC\n          70,000 bytes maximum residency (2 sample(s))\n          34,568 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      1048 colls,  1048 par    0.060s   0.005s     0.0000s    0.0001s\n  Gen  1         2 colls,     1 par    0.000s   0.000s     0.0001s    0.0001s\n\n  Parallel GC work balance: 22.49% (serial 0%, perfect 100%)\n\n  TASKS: 6 (1 bound, 5 peak workers (5 total), using -N2)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.494s  (  0.285s elapsed)\n  GC      time    0.060s  (  0.005s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.555s  (  0.291s elapsed)\n\n  Alloc rate    2,079,458,137 bytes per MUT second\n\n  Productivity  89.2% of total user, 170.2% of total elapsed\n\ngc_alloc_block_sync: 20\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n\n\n$ ./Scheduler04.toAsk  +RTS -s -N4 &gt; /dev/null\n     277,518,568 bytes allocated in the heap\n         597,480 bytes copied during GC\n          96,400 bytes maximum residency (2 sample(s))\n          47,648 bytes maximum slop\n               3 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0       297 colls,   297 par    0.247s   0.002s     0.0000s    0.0001s\n  Gen  1         2 colls,     1 par    0.000s   0.000s     0.0001s    0.0002s\n\n  Parallel GC work balance: 34.57% (serial 0%, perfect 100%)\n\n  TASKS: 10 (1 bound, 9 peak workers (9 total), using -N4)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    0.178s  (  0.109s elapsed)\n  GC      time    0.247s  (  0.002s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.427s  (  0.112s elapsed)\n\n  Alloc rate    1,561,830,669 bytes per MUT second\n\n  Productivity  41.9% of total user, 159.5% of total elapsed\n\ngc_alloc_block_sync: 106\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 1\n</code></pre>\n"}, {"tags": ["haskell", "haskell-cmdargs"], "comments": [{"owner": {"reputation": 19318, "user_id": 371834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a378ed2410bdabed82883f2615f6b61?s=128&d=identicon&r=PG", "display_name": "Mihai Maruseac", "link": "https://stackoverflow.com/users/371834/mihai-maruseac"}, "edited": false, "score": 0, "creation_date": 1445029551, "post_id": 33178303, "comment_id": 54166316, "body": "I don&#39;t think it&#39;s possible. It&#39;s the way command line arguments work. How about trying <code>--test 5 --test 6</code>?"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1445024068, "creation_date": 1445024068, "question_id": 33178303, "link": "https://stackoverflow.com/questions/33178303/modify-argument-separator-with-cmdargs", "title": "Modify argument separator with cmdargs", "body": "<p>I'm using cmdargs and I need to pass several values after an optionnal argument.</p>\n\n<p>I declared my <code>test</code> option to be a tuple of int : </p>\n\n<pre><code>data Options =\n    Mode1   { input :: [FilePath]\n            , test::(Int,Int)\n            }\n\nmode1 = \n  Mode1 { \n            input   = []  &amp;= name \"file\" &amp;= help \"input file\"    \n          , test = (2,5)  &amp;= explicit\n        }\n</code></pre>\n\n<p>I can use my program with</p>\n\n<pre><code>./prog mode1 --test 5,6 --file \"test_file.txt\"\n</code></pre>\n\n<p>but I would like to have this syntax </p>\n\n<pre><code>./prog mode1 --test 5 6 --file \"test_file.txt\"\n</code></pre>\n\n<p><strong>Is it possible to modify the field separator to use spaces or another character instead of a comma?</strong></p>\n"}, {"tags": ["haskell", "types", "structure"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1445023754, "post_id": 33178143, "comment_id": 54163494, "body": "What&#39;s the actual error message?"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 0, "creation_date": 1445023797, "post_id": 33178143, "comment_id": 54163523, "body": "related: <a href=\"http://stackoverflow.com/q/9336385/124319\">stackoverflow.com/q/9336385/124319</a>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1445023958, "post_id": 33178143, "comment_id": 54163600, "body": "GHC should not, and it <a href=\"http://ideone.com/Vbiz9w\" rel=\"nofollow noreferrer\">does not</a>. What compiler are you using? Any pragmas or compiler flags?"}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 5455329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3100b4fea8c924a3d29f0075cde0ebcc?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/5455329/jesse"}, "is_accepted": false, "score": 1, "last_activity_date": 1445027199, "creation_date": 1445027199, "answer_id": 33179006, "question_id": 33178143, "link": "https://stackoverflow.com/questions/33178143/how-to-check-desired-data-type-in-haskell-program/33179006#33179006", "title": "How to check desired data type in haskell program?", "body": "<p>This example may help:</p>\n\n<pre><code>data Test = Int' Int \n          | Bool' Bool \n          | Other\n    deriving (Eq, Show)\n\ncheckType :: Test -&gt; Bool\ncheckType (Int' _) = True\ncheckType (Bool' b) = b\ncheckType _ = False\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 5367539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/416bbbc5c0b2c32247a1f4992fd5c456?s=128&d=identicon&r=PG&f=1", "display_name": "paul", "link": "https://stackoverflow.com/users/5367539/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "closed_date": 1446363388, "answer_count": 1, "score": -3, "last_activity_date": 1445164939, "creation_date": 1445023366, "last_edit_date": 1445164939, "question_id": 33178143, "link": "https://stackoverflow.com/questions/33178143/how-to-check-desired-data-type-in-haskell-program", "closed_reason": "Not suitable for this site", "title": "How to check desired data type in haskell program?", "body": "<pre><code>data Type1 = My1 Int |Your1 Int | Your Char |My Char deriving (Show , Eq)   \n</code></pre>\n\n<p>I have a <code>[Type1]</code>.</p>\n\n<p>In my program I am traversing through <code>[Type1]</code>. I want to check whether my next element is a <code>My1 Int</code> (e.g.  <code>My1 25</code>) or not.</p>\n\n<p>How should I write a function that returns this in <code>Bool</code>?</p>\n\n<p>I thought of </p>\n\n<pre><code>isMy1 (My1 _)= True\nisMy1 _ = False \n</code></pre>\n\n<p>but this returns pattern matches overlap error.</p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 7, "creation_date": 1445023172, "post_id": 33177681, "comment_id": 54163194, "body": "<code>:sprint</code> lets you look behind the scenes at the actual data structures that represent your data. There&#39;s no requirement that semantically equivalent definitions are displayed the same by <code>:sprint</code>. (In fact the whole point of <code>:sprint</code> is to change as a value becomes more evaluated, yet the value itself does not change in the process!) So there&#39;s no contradiction with the Report. But I can&#39;t say off-hand why ghci appears to build pre-constructed data for <code>y</code> but not <code>x</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1445023593, "post_id": 33177681, "comment_id": 54163403, "body": "That said, in your <code>y = &quot;Ab*** Exception: Prelude.undefined</code> example it seems that <code>:sprint</code> behaves poorly. It shouldn&#39;t be evaluating the elements of the string here."}, {"owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1445023809, "post_id": 33177681, "comment_id": 54163526, "body": "@ReidBarton Yes, that\u2019s a good point about <code>:sprint</code> and Haskell Report. And it seems that it evaluates elements only in the case <code>Char</code>s (I have added another example to the question)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445024435, "post_id": 33177681, "comment_id": 54163858, "body": "You might consider filing a bug against GHCi. This seems off."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1445025605, "post_id": 33177681, "comment_id": 54164403, "body": "Yeah, it seems like there is a special case for displaying strings in the form <code>&quot;abc&quot;</code> rather than <code>&#39;a&#39; : &#39;b&#39; : &#39;c&#39; : []</code> but the logic for when to do so isn&#39;t quite right."}], "answers": [{"comments": [{"owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "edited": false, "score": 1, "creation_date": 1445023511, "post_id": 33178004, "comment_id": 54163363, "body": "Well, looks like you are half-right. This evaluation thing happens only to lists of <code>Char</code>s, but <code>:sprint</code> with square brackets still behaves kind of strange. I\u2019ll update my question in a moment, showing this."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 3, "last_activity_date": 1445022816, "creation_date": 1445022816, "answer_id": 33178004, "question_id": 33177681, "link": "https://stackoverflow.com/questions/33177681/strictness-of-square-brackets/33178004#33178004", "title": "\u201cStrictness\u201d of square brackets", "body": "<p>This seems to be just limited to <code>sprint</code>. If you write a simple program like</p>\n\n<pre><code>import Control.Exception\n\nx, y :: String\nx = 'a' : 'b' : undefined : []\ny = ['a', 'b', undefined]\n\nmain :: IO ()\nmain = do\n    evaluate x\n    evaluate y\n    putStrLn \"Done\"\n</code></pre>\n\n<p>then <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#v:evaluate\" rel=\"nofollow\">evaluating</a> both to <a href=\"https://wiki.haskell.org/Weak_head_normal_form\" rel=\"nofollow\">WHNF</a> proceeds without touching <code>undefined</code>.</p>\n\n<p>My guess is that for some strange reason GHCi decides to print <code>x</code> as a list, but <code>y</code> as a string, which is the thing that forces the evaluation of the whole <code>y</code>, not the <code>seq</code>/<code>evaluate</code> calls.</p>\n"}], "owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 33178004, "answer_count": 1, "score": 15, "last_activity_date": 1445026792, "creation_date": 1445021577, "last_edit_date": 1445026792, "question_id": 33177681, "link": "https://stackoverflow.com/questions/33177681/strictness-of-square-brackets", "title": "\u201cStrictness\u201d of square brackets", "body": "<p>I put these definitions in a file:</p>\n\n<pre><code>x = 'a' : 'b' : 'c' : []\ny = ['a', 'b', 'c']\n</code></pre>\n\n<p>(It is important to define those in a file, not in GHCi, because in the latter case things become way more weird, but that\u2019s another question.)</p>\n\n<p>Now, I load this file in GHCi and:</p>\n\n<pre><code>\u03bb&gt; :sprint x\nx = _\n\u03bb&gt; :sprint y\ny = _\n\u03bb&gt; seq x ()\n()\n\u03bb&gt; seq y ()\n()\n\u03bb&gt; :sprint x\nx = 'a' : _\n\u03bb&gt; :sprint y\ny = \"abc\"\n</code></pre>\n\n<p>What is going on here? I understand what happens in the case of <code>x</code>, that\u2019s exactly what I expected. But what about <code>y</code>?</p>\n\n<p>What I see seems to contradict <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-340003.7\">section 3.7</a> of the Report, which says:</p>\n\n<blockquote>\n  <p><strong>Translation:</strong> The following identity holds:</p>\n\n<pre><code>[e1, \u2026, ek] = e1 : (e2 : ( \u2026 (ek : [])))\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Furthermore:</p>\n\n<pre><code>y = [toUpper 'a', 'b', undefined]\n</code></pre>\n\n\n\n<pre><code>\u03bb&gt; seq y ()\n()\n\u03bb&gt; :sprint y\ny = \"Ab*** Exception: Prelude.undefined\n\u03bb&gt; :sprint y\n*** Exception: Prelude.undefined\n</code></pre>\n\n<hr>\n\n<p>With lists of <code>Char</code>s even actual evaluation is forced, but with other types things are still strange:</p>\n\n<pre><code>x = True : False : id False : []\ny = [True, False, id False]\n</code></pre>\n\n\n\n<pre><code>\u03bb&gt; seq x ()\n()\n\u03bb&gt; seq y ()\n()\n\u03bb&gt; :sprint x\nx = True : _\n\u03bb&gt; :sprint y\ny = [True,False,_]\n</code></pre>\n"}, {"tags": ["haskell", "operator-overloading"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1445020532, "post_id": 33177019, "comment_id": 54161791, "body": "you could hint to the compiler with <code>s = r * 2.0 where (*) = (Main.*)</code> and <code>(*) as k = map (\\a -&gt; a*k) as where (*) = (Prelude.*)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "edited": false, "score": 0, "creation_date": 1445023788, "post_id": 33177168, "comment_id": 54163517, "body": "It&#39;s strange that what is not a problem elsewhere, it is at Haskell. Thanks for your answer."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1445036161, "post_id": 33177168, "comment_id": 54168573, "body": "it seems that the statement is also true the other way around. Many problems that occur elsewhere, are none in haskell."}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "edited": false, "score": 0, "creation_date": 1445071503, "post_id": 33177168, "comment_id": 54175450, "body": "Yes, but that is not a justification for not allowing ad-hoc polymorphism in Haskell."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "edited": false, "score": 0, "creation_date": 1445115098, "post_id": 33177168, "comment_id": 54188705, "body": "@cibercitizen1 Did you read the paper I linked? It discusses some limitations of ad-hoc polymorphism, especially in Hindley-Milner systems."}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "edited": false, "score": 0, "creation_date": 1445153704, "post_id": 33177168, "comment_id": 54196216, "body": "@ReinHenrichs Yes I did. Thanks. Well, I understand the limitations, but it seems (to me) that they are limitations more  for the compiler than actual limitations. Other languages do allow ad-hoc polymorphism, so I conclude that the reason not to have it in Haskell is a design decision (like I was for ruling out operator overloading in Java)."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "edited": false, "score": 1, "creation_date": 1445192343, "post_id": 33177168, "comment_id": 54207714, "body": "@cibercitizen1 It is a design decision, and I think it&#39;s a reasonable one given the options. While your question and comments seem to suggest that Haskell simply chose not to implement ad hoc polymorphism per se, ad hoc polymorphism isn&#39;t free: it is in tension with other language design goals. Other languages have made different choices here (or, in some cases, don&#39;t have a choice to make, because they can&#39;t implement the feature they are giving up anyway). For example, I would prefer type inference to ad hoc polymorphism every time. I couldn&#39;t imagine writing Haskell without it."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 6, "last_activity_date": 1445019734, "creation_date": 1445019734, "answer_id": 33177168, "question_id": 33177019, "link": "https://stackoverflow.com/questions/33177019/why-has-haskell-troubles-resolving-overloaded-operators/33177168#33177168", "title": "Why has Haskell troubles resolving &quot;overloaded&quot; operators?", "body": "<p>Allowing the compiler to choose the correct implementation of a function based on its type is the purpose of typeclasses. It is not possible without them.</p>\n\n<p>For a justification of this approach, you might read the paper that introduced them: <a href=\"http://202.3.77.10/users/karkare/courses/2010/cs653/Papers/ad-hoc-polymorphism.pdf\" rel=\"noreferrer\"><em>How to make ad-hoc polymorphism less ad hoc</em></a> [PDF].</p>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 1, "last_activity_date": 1445063020, "creation_date": 1445063020, "answer_id": 33183532, "question_id": 33177019, "link": "https://stackoverflow.com/questions/33177019/why-has-haskell-troubles-resolving-overloaded-operators/33183532#33183532", "title": "Why has Haskell troubles resolving &quot;overloaded&quot; operators?", "body": "<p>It is a design decision, not a theoretical problem, not to include this in Haskell. As you say, many other languages use types to disambiguate between terms on an ad-hoc way. But type classes have similar functionality and additionally allow abstraction over things that are overloaded. Type-directed name resolution does not.</p>\n\n<p>Nevertheless, forms of type-directed name resolution have been discussed for Haskell (for example in the context of resolving record field selectors) and are supported by some languages similar to Haskell such as Agda (for data constructors) or Idris (more generally). </p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1445077534, "creation_date": 1445077534, "answer_id": 33185489, "question_id": 33177019, "link": "https://stackoverflow.com/questions/33177019/why-has-haskell-troubles-resolving-overloaded-operators/33185489#33185489", "title": "Why has Haskell troubles resolving &quot;overloaded&quot; operators?", "body": "<p>Really, the reason is this: <em>in Haskell, there is not necessarily a clear association &ldquo;variable <code>x</code> has type <code>T</code>&rdquo;</em>.</p>\n\n<p>Haskell is almost as flexible as dynamic languages, in the sense that any type can be a <em>type variable</em>, i.e. can have polymorphic type. But whereas in dynamic languages (and also e.g. OO polymorphism or C++ templates), the types of such type-variables are basically just extra information attached to the value-variables in your code (so an overloaded operator can see: argument is an <code>Int</code>->do this, is a <code>String</code>->do that), in Haskell the type variables live in a completely seperate scope in <em>the type language</em>. This gives you many advantages, for instance higher-kinded polymorphism is pretty much impossible without such a system. However, it also means it's harder to reason about how overloaded functions should be resolved. If Haskell allowed you to just write overloads and assume the compiler does its best guess at resolving  the ambiguity, you'd often end up with strange error messages in unexpected places. (Actually, this can easily happen with overloads even if you have <em>no</em> Hindley-Milner type system. C++ is notorious for it.)</p>\n\n<p>Instead, Haskell chooses to force overloads to be explicit. You must first define a type class before you can overload methods, and though this can't completely preclude confusing compilation errors it makes them much easier to avoid. Also, it lets you express polymorphic methods with type resolution that couldn't be expressed with traditional overloading, in particular <em>polymorphic results</em> (which is great for writing very easily reusable code).</p>\n"}], "owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 1, "accepted_answer_id": 33183532, "answer_count": 3, "score": 3, "last_activity_date": 1445077534, "creation_date": 1445019227, "last_edit_date": 1495541029, "question_id": 33177019, "link": "https://stackoverflow.com/questions/33177019/why-has-haskell-troubles-resolving-overloaded-operators", "title": "Why has Haskell troubles resolving &quot;overloaded&quot; operators?", "body": "<p><a href=\"https://stackoverflow.com/questions/18372060/overload-built-in-function-in-haskell?rq=1\">This post</a> poses the question for the case of <code>!!</code> . The accepted answer tell us that what you are actually doing is creating a new function <code>!!</code> and then you should avoid importing the standard one.</p>\n\n<p>But, why to do so if the new function is to be applied to different types than the standard one? Is not the compiler able to choose the right one according to its parameters?\nIs there any compiler flag to allow this?</p>\n\n<p>For instance, if <code>*</code> is not defined for <code>[Float] * Float</code></p>\n\n<p>Why the compiler cries </p>\n\n<pre>\n>  Ambiguous occurrence *\n>  It could refer to either `Main.*', defined at Vec.hs:4:1\n>                          or `Prelude.*',\n</pre>\n\n<p>for this code:</p>\n\n<pre><code>(*) :: [Float] -&gt; Float -&gt; [Float]\n(*) as k = map (\\a -&gt; a*k) as  -- here: clearly Float*Float\n\n\nr = [1.0, 2.0, 3.0] :: [Float]\n\ns = r * 2.0 -- here: clearly [Float] * Float\n\nmain = do\n     print r\n     print s\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 3, "creation_date": 1541185751, "post_id": 33176906, "comment_id": 93143739, "body": "Is this still the current best approach?"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1549730774, "post_id": 33176906, "comment_id": 96011684, "body": "What else is the path_packagename exporting? I cannot find any documentation as it is an automatically generated package. I would appreciate a link!"}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 2, "creation_date": 1568199411, "post_id": 33176906, "comment_id": 102197069, "body": "One small notice: change <code>&lt;packagename&gt;</code> to your real package name.  E.g. if your package name is <code>&#39;my-awesome-package&#39;</code> you should <code>import Paths_my_awesome_package</code>"}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": true, "score": 14, "last_activity_date": 1445018870, "creation_date": 1445018870, "answer_id": 33176906, "question_id": 33176905, "link": "https://stackoverflow.com/questions/33176905/is-there-a-way-to-get-version-of-cabal-package-in-source-code-of-the-package/33176906#33176906", "title": "Is there a way to get version of Cabal package in source code of the package?", "body": "<p>Indeed Cabal allows to access information from <code>.cabal</code> file in your\nprogram. <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#accessing-data-files-from-package-code\">According to Cabal documentation</a>,\nyou can import special module that exists during building of your package,\nlike this:</p>\n\n<pre><code>import Paths_packagename (version)\nimport Data.Version (showVersion)\n\nmyVersion :: String\nmyVersion = showVersion version\n</code></pre>\n\n<p>The module <code>Paths_packagename</code> provides <code>version</code> of type\n<a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Version.html\">Version</a>.</p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 737, "favorite_count": 2, "accepted_answer_id": 33176906, "answer_count": 1, "score": 15, "last_activity_date": 1445018870, "creation_date": 1445018870, "question_id": 33176905, "link": "https://stackoverflow.com/questions/33176905/is-there-a-way-to-get-version-of-cabal-package-in-source-code-of-the-package", "title": "Is there a way to get version of Cabal package in source code of the package?", "body": "<p>Say I have a console program that has an option to display its\nversion. Currently whenever I update version in <code>.cabal</code> file I need to go\nto source code and update constant \u2014 string representation of current\nversion number as well. This feels against DRY principle and now I'm\nwondering, is it possible to get version of my project as defined in\n<code>.cabal</code> file from source code? Maybe Cabal defines some CPP macro or\nsomething else?</p>\n"}, {"tags": ["haskell", "haddock"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1445030999, "post_id": 33176636, "comment_id": 54166939, "body": "can&#39;t you instead of reexporting the function , just redefine it ? I mean import <code>Internal</code> qualified and define <code>someType = Internal.someType</code>. That should allow you to add you own documentation."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1445031468, "post_id": 33176636, "comment_id": 54167118, "body": "mb14: seems like a good idea. redefining types seems problematic though."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1445085409, "post_id": 33176636, "comment_id": 54179235, "body": "You are right, I didn&#39;t realize you were also asking about Type."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1445254074, "post_id": 33176636, "comment_id": 54230437, "body": "mb14: I&#39;d still toss an upvote your way if you made that into an answer."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 3, "last_activity_date": 1445019935, "creation_date": 1445019935, "answer_id": 33177225, "question_id": 33176636, "link": "https://stackoverflow.com/questions/33176636/changing-the-documentation-for-re-exported-types-and-values/33177225#33177225", "title": "Changing the documentation for re-exported types and values", "body": "<p>Ok, here's a hack that I can live with.</p>\n\n<p>Haddock allows you to insert <a href=\"https://www.haskell.org/haddock/doc/html/ch03s05.html\" rel=\"nofollow noreferrer\">named chunks of documentation</a>, which are shown in the order they're defined. These named chunks are only shown for the module they're in, not in any file that re-exports values or types from that module.</p>\n\n<p>So in the internal module, I can insert named chunks containing the internal documentation right after the public API documentation:</p>\n\n<pre><code>-- | Have you welcomed internal modules into your life?\nmodule Public.Private where\n\n-- | Here's the public API information for 'SomeType'\ntype SomeType = ()\n-- $\n-- Here's the internal information about 'SomeType': it's really just a stand-in\n-- for San Francisco\n\n-- | Here's the public API information for 'someValue'\nsomeValue :: SomeType\n-- $ Here's the internal information about 'someValue': it loves cheese.\nsomeValue = ()\n</code></pre>\n\n<p>and then export the types and values as normal</p>\n\n<pre><code>-- | This is a very serious public API\nmodule Public ( SomeType, someValue) where\nimport Public.Private ( SomeType , someValue)\n</code></pre>\n\n<p>Now the generated documentation for <code>Public.Private</code> shows the internal documentation right after the public documentation:</p>\n\n<p><a href=\"https://i.stack.imgur.com/3FOPx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3FOPx.png\" alt=\"Generated HTML documentation for Public.Private\"></a></p>\n\n<p>While the <code>Public</code> documentation for the exported items doesn't show the internal documentation:</p>\n\n<p><a href=\"https://i.stack.imgur.com/yjIyE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yjIyE.png\" alt=\"Generated HTML documentation for Public\"></a></p>\n\n<p>This only allows me to append private documentation, but that's better than nothing.</p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 2, "accepted_answer_id": 33177225, "answer_count": 1, "score": 4, "last_activity_date": 1445019935, "creation_date": 1445017909, "last_edit_date": 1445018398, "question_id": 33176636, "link": "https://stackoverflow.com/questions/33176636/changing-the-documentation-for-re-exported-types-and-values", "title": "Changing the documentation for re-exported types and values", "body": "<p>Suppose I have a module which re-exports a value from an internal module:</p>\n\n<pre><code>module My.Cool.Module (SomeType, someValue) where\nimport My.Cool.Module.Internal (SomeType, someValue)\n</code></pre>\n\n<p>I'd like to show different documentation for <code>SomeType</code> and <code>someValue</code> in <code>My-Cool-Module.html</code> and <code>My-Cool-Module-Internal.html</code>, so the former can discuss the public API and the latter can discuss how they relate to the rest of internals.</p>\n\n<p>Is there a way to do this with haddock?</p>\n\n<p>I tried:</p>\n\n<pre><code>module My.Cool.Module (SomeType, someValue) where\nimport My.Cool.Module.Internal\n  ( SomeType -- ^ a serious type for serious people\n  , someValue -- ^ a serious value for serious people\n  )\n</code></pre>\n\n<p>But haddock gave me a parse error:</p>\n\n<pre><code>parse error on input \u2018-- ^ a serious type for serious people\u2019\n</code></pre>\n"}, {"tags": ["haskell", "tree", "monads"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445017277, "post_id": 33176375, "comment_id": 54160161, "body": "Please use proper block-markdown for code blocks (as I edited it now). The easiest way to do this is to select the code blocks and press <code>ctrl+k</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445017529, "post_id": 33176375, "comment_id": 54160284, "body": "There is in general not <i>one right way</i> to define a monad instance. It depends on what behaviour you want / how you plan to use these trees. Your ideas aren&#39;t \u201ccompletely off\u201d, but whether they&#39;re right I can&#39;t say without further information."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1445017915, "post_id": 33176375, "comment_id": 54160499, "body": "If I&#39;m looking at it correctly, <code>DecisionTree</code> is isomorphic to <code>Free []</code> (that is, <a href=\"http://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Free.html\" rel=\"nofollow noreferrer\"><code>Control.Monad.Free</code></a> from the <code>free</code> package). In that case, what <code>(&gt;&gt;=)</code> does is to substitute each <code>Result</code> in the decision tree with a whole new tree constructed from the result&#39;s value. See this other question: <a href=\"http://stackoverflow.com/questions/32413797/implementing-mymonad-free-f\" title=\"implementing mymonad free f\">stackoverflow.com/questions/32413797/&hellip;</a>"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1445018655, "post_id": 33176375, "comment_id": 54160848, "body": "It looks to me like if your if <code>f</code> produces a <code>Decision [DecisionTree a]</code> you can also build that kind of substructure. What is the problem exactly? Are you not sure if the monad laws are fulfilled, do you get errors, are the results not what you expected?"}, {"owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "edited": false, "score": 0, "creation_date": 1445020341, "post_id": 33176375, "comment_id": 54161700, "body": "I decided to check what was not functioning properly by just plugging in some values and see what the results are and they were what I wanted. So I decided to go on and use it in my next function to simulate tossing a coin and rolling a dice and apparantly it does function the way I intended. Thanks for the added information, I think it helped me understand more what I was doing."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "edited": false, "score": 0, "creation_date": 1445020440, "post_id": 33177054, "comment_id": 54161748, "body": "Accepting this, since this combined with the comments made me find the solution (which was in fact what I had already, but somehow it gave some problems)."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 4, "last_activity_date": 1445045913, "last_edit_date": 1445045913, "creation_date": 1445019327, "answer_id": 33177054, "question_id": 33176375, "link": "https://stackoverflow.com/questions/33176375/decision-tree-in-haskell-defining-and-return/33177054#33177054", "title": "Decision Tree in haskell defining &gt;&gt;= and return", "body": "<p>This is the <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Free.html\" rel=\"nofollow\">free monad</a> for <code>[]</code>. As such, while there may be multiple ways to define a monad instance (per @leftroundabout), there is one canonical way to define a free monad instance, which is the one you have chosen. (You can compare your implementation to that of <code>Free</code> and see that they are equivalent. The only difference is that you fix the choice of <code>f</code> to <code>[]</code>.)</p>\n\n<blockquote>\n  <p>but this only builds <code>Result a</code> and no <code>Decision [DecisionTree a]</code>.</p>\n</blockquote>\n\n<p>I'm not sure what this means, but an arrow <code>a -&gt; DecisionTree b</code> that produces a <code>Decision</code> will produce a <code>Decision</code>. <code>return</code> will always produce a <code>Result</code>, but that is expected.</p>\n"}], "owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 0, "accepted_answer_id": 33177054, "answer_count": 1, "score": 1, "last_activity_date": 1445045913, "creation_date": 1445017032, "last_edit_date": 1445017169, "question_id": 33176375, "link": "https://stackoverflow.com/questions/33176375/decision-tree-in-haskell-defining-and-return", "title": "Decision Tree in haskell defining &gt;&gt;= and return", "body": "<p>I'm trying to make a Decision Tree for a game and I have:</p>\n\n<pre><code>data DecisionTree a\n   = Result a\n   | Decision [DecisionTree a]\n   deriving (Eq,Show)`\n</code></pre>\n\n<p>furthermore, I have</p>\n\n<pre><code>instance Functor DecisionTree where\n    fmap = liftM\n</code></pre>\n\n<p>now I have to define </p>\n\n<pre><code>instance Monad DecisionTree where\n-- return :: a -&gt; DecisionTree a\n   return = ...\n-- (&gt;&gt;=) :: DecisionTree a -&gt; (a -&gt; DecisionTree b) -&gt; DecisionTree b\n   (&gt;&gt;=) = ...\n</code></pre>\n\n<p>Now I'm kinda confused how to fill in the definitions.</p>\n\n<p>To define <code>&gt;&gt;=</code> I tried splitting the definition into two cases:</p>\n\n<pre><code>(&gt;&gt;=) (Result a) f    = f a\n(&gt;&gt;=) (Decision ys) f = Decision (fmap (&gt;&gt;= f) ys)\n</code></pre>\n\n<p>As for <code>return</code> I thought at least something like</p>\n\n<pre><code>return = Result\n</code></pre>\n\n<p>but this only builds <code>Result a</code> and no <code>Decision [DecisionTree a]</code>.</p>\n\n<p>Am I completely off or am I close?</p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1445012209, "post_id": 33174873, "comment_id": 54157542, "body": "From the code you&#39;ve posted, the only place that <code>read</code> is called is for the <i>first</i> line of input -- unless <code>build</code> calls <code>read</code> somewhere? (You don&#39;t seem to indicate where <code>build</code> comes from.)"}, {"owner": {"reputation": 531, "user_id": 2026722, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67b13fd6c59bbcdf99f8d6cbb221ef09?s=128&d=identicon&r=PG", "display_name": "te7", "link": "https://stackoverflow.com/users/2026722/te7"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1445012772, "post_id": 33174873, "comment_id": 54157859, "body": "The second getLine isn&#39;t supposed to be used for now. &quot;r&quot; for &quot;build r&quot; is supposed to be hard coded for now. Maybe I&#39;ve not declared &quot;r&quot; correctly or it has to be &quot;read&quot; somehow. &quot;build&quot; is defined earlier on and I thought it was too much to post. &quot;Build&quot; takes a &quot;Reg&quot; input and outputs an &quot;Nfa Int&quot;."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1445014058, "post_id": 33174873, "comment_id": 54158561, "body": "There is nothing in what you posted that would give a parse error with the kind of input you&#39;re describing. The error must be elsewhere."}, {"owner": {"reputation": 531, "user_id": 2026722, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67b13fd6c59bbcdf99f8d6cbb221ef09?s=128&d=identicon&r=PG", "display_name": "te7", "link": "https://stackoverflow.com/users/2026722/te7"}, "edited": false, "score": 0, "creation_date": 1445021050, "post_id": 33174873, "comment_id": 54162060, "body": "Thanks for the reply. I&#39;ll look elsewhere."}, {"owner": {"reputation": 531, "user_id": 2026722, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67b13fd6c59bbcdf99f8d6cbb221ef09?s=128&d=identicon&r=PG", "display_name": "te7", "link": "https://stackoverflow.com/users/2026722/te7"}, "edited": false, "score": 0, "creation_date": 1445093234, "post_id": 33174873, "comment_id": 54181585, "body": "I got it. I was entering the first input on the same line as the .exe. You have to: exe, enter, 1st input, enter, 2nd input, enter. Silly I know. But I&#39;m coming from Visual Studio."}], "owner": {"reputation": 531, "user_id": 2026722, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67b13fd6c59bbcdf99f8d6cbb221ef09?s=128&d=identicon&r=PG", "display_name": "te7", "link": "https://stackoverflow.com/users/2026722/te7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1445011461, "creation_date": 1445011461, "question_id": 33174873, "link": "https://stackoverflow.com/questions/33174873/no-parseread-error-when-running-app", "title": "&quot;No parse:read&quot; error when running app", "body": "<p>I'm new to Haskell and this is only my second app, so forgive me if the answer to my question is obvious.</p>\n\n<p>I'm trying to implement Thompson's RegExp code to implement an NFA for regular expressions. My app has 2 inputs so far: 1) First line - the number of expressions to implement (converted to Int), and 2) Second line - the regular expression to implement. Later on I'll be have a 3rd input on the same line as the regular expression to implement. This means that I'll need to learn how to parse the second input string to get a string and an integer. But I couldn't find how to parse the IO String yet. I guess that's another question for later, or maybe someone can provide a link on how to do it. Input will look like this:</p>\n\n<pre><code>(int input)\nregex1 (int input) \nregex2 (int input) \nregex3 (int input) \n</code></pre>\n\n<p>Here's the pertinent code...there's a lot more, but only showing the relevant. The error I'm getting now is a \"no parse:read\" when I just enter anything for the second input (second line). The second input isn't used for now since I've temporarily hard coded for the second input. I'm in Leksah and the code configures and compiles. Could someone tell me why I'm getting the parse error when I run the app?</p>\n\n<pre><code>data Reg = Epsilon |\n           Literal Char |\n           Or Reg Reg |\n           Then Reg Reg |\n           Star Reg\n           deriving Eq\n\n\n-------------------------------------------------------------------------- \n--                                  --\n--  ImplementNfa.hs     \n--\n-------------------------------------------------------------------------- \n\ntrans :: Ord a =&gt; Nfa a -&gt; String -&gt; Set a\n\ntrans mach str = foldl step startset str\n         where\n         step set ch = onetrans mach ch set\n         startset = closure mach (sing (startstate mach))\n\n-------------------------------------------------------------------------- \n--  Turn the result of trans into printable form.           --\n-------------------------------------------------------------------------- \n\nprint_trans :: Nfa Int -&gt; String -&gt; [Char]\n\nprint_trans mach str = show (flatten (trans mach str))\n\n\nbuildRE::String -&gt; Reg\nbuildRE r = regexp2  -- will build regex from \"re\" \n                     -- hard coded for now until I\n                     -- learn how to parse a string\n\nre = \"(ab|ba)\" -- Hard coded for now until I can\n               -- learn how to parse an input string\n\na = Literal 'a'\nb = Literal 'b'\n\nregexp2 = Or (Then a b) (Then b a)\n\nmain::IO()\nmain = do input1 &lt;- getLine\n          let t = (read input1::Int)\n          let t1 = t -1\n          -- Maybe I need a loop here for \"t\" but I don't know how\n          if (t1 == -1)\n              then return()\n              else\n                   do input &lt;- getLine\n                      -- Need to figure out how to parse input\n                      -- to get string 're' and an Int\n                      let r = buildRE re\n                      let nfa1 = build r\n                      putStrLn $ (print_trans nfa1 re);\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1445014047, "post_id": 33173168, "comment_id": 54158554, "body": "Sounds like you&#39;re not really interested in halving numbers, but in <i>obtaining pivot values between two elements</i>? That&#39;s quite reaonable. I think you should keep it completely seperate from these numerical classes then (because this might also make sense for e.g. characters)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1445015283, "post_id": 33173168, "comment_id": 54159199, "body": "Would it hurt too much to tell us what your actual ultimate objective is? We might well be able to help you more effectively if we knew what you were <i>really</i> trying to do."}, {"owner": {"reputation": 1587, "user_id": 3271946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/446c713f3dc5528707d32819146a9789?s=128&d=identicon&r=PG&f=1", "display_name": "ArunasR", "link": "https://stackoverflow.com/users/3271946/arunasr"}, "edited": false, "score": 0, "creation_date": 1445289261, "post_id": 33173168, "comment_id": 54252620, "body": "Type constraints are not enough to decide the instances. What if someone defines a type with instances of both Integral and Fractional? You need distinctive type constructors, like @daniel-wagner suggested below"}], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 31, "user_id": 5454217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71268fdd4458e734a1ede5eba68d0a4b?s=128&d=identicon&r=PG&f=1", "display_name": "CNJ", "link": "https://stackoverflow.com/users/5454217/cnj"}, "edited": false, "score": 0, "creation_date": 1445009467, "post_id": 33174000, "comment_id": 54155925, "body": "@CNJ Yes, but in this case you actually want to use the conflict in the ambiguity. If you remove all references of <code>Integral</code> and <code>Fractional</code> from your code you don&#39;t get any error using the <code>Hell</code> datatype, which is equivalent to what you are saying about imports and conflicting names. Problem is: you are back to using the boilerplate code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 31, "user_id": 5454217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71268fdd4458e734a1ede5eba68d0a4b?s=128&d=identicon&r=PG&f=1", "display_name": "CNJ", "link": "https://stackoverflow.com/users/5454217/cnj"}, "edited": false, "score": 0, "creation_date": 1445009855, "post_id": 33174000, "comment_id": 54156160, "body": "@CNJ, once you throw in multi-parameter type classes, functional dependencies, flexible contexts, flexible instances, undecidable instances, and equality constraints (all of which are essential to modern Haskell programming), Haskell&#39;s class system pretty much reaches the limit of programmers&#39; ability to use and reason about. There&#39;s a limit to how complex a system can get before it stops being useful."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 4, "last_activity_date": 1445008717, "creation_date": 1445008717, "answer_id": 33174000, "question_id": 33173168, "link": "https://stackoverflow.com/questions/33173168/defining-a-function-that-behaves-differently-according-to-whether-the-argument-i/33174000#33174000", "title": "Defining a function that behaves differently according to whether the argument is Integral or Fractional", "body": "<p>You can't:</p>\n\n<pre><code>data Hell = YouCantDoThat\n\ninstance Integral Hell\n\ninstance Fractional Hell\n</code></pre>\n\n<p>There is no rule saying that an <code>Integral</code> cannot be a <code>Fractional</code> or viceversa. And if that's the case how do you choose?\nThis is exactly what the error is telling you.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 31, "user_id": 5454217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71268fdd4458e734a1ede5eba68d0a4b?s=128&d=identicon&r=PG&f=1", "display_name": "CNJ", "link": "https://stackoverflow.com/users/5454217/cnj"}, "edited": false, "score": 0, "creation_date": 1445010154, "post_id": 33174062, "comment_id": 54156343, "body": "@CNJ, either that way or outside the class system altogether."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 31, "user_id": 5454217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71268fdd4458e734a1ede5eba68d0a4b?s=128&d=identicon&r=PG&f=1", "display_name": "CNJ", "link": "https://stackoverflow.com/users/5454217/cnj"}, "edited": false, "score": 1, "creation_date": 1445011269, "post_id": 33174062, "comment_id": 54156990, "body": "@CNJ, no, it&#39;s not. But I have the feeling you might be able to restructure your code to push this distinction to a higher level (the one that leads to the invariant that integral arguments will be even, perhaps). As it is, this just doesn&#39;t <i>feel</i> like an appropriate use for a class. Haskell classes should really represent specific, well-behaved <i>ideas</i>, not just convenient overloading."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1445008892, "creation_date": 1445008892, "answer_id": 33174062, "question_id": 33173168, "link": "https://stackoverflow.com/questions/33173168/defining-a-function-that-behaves-differently-according-to-whether-the-argument-i/33174062#33174062", "title": "Defining a function that behaves differently according to whether the argument is Integral or Fractional", "body": "<p>What you're asking for is pretty much horrible. What is the <em>meaning</em> of this class? It's also impossible to do it with significantly less boilerplate than your working partial solution. The problem is that GHC, even with overlapping or incoherent (<em>barf</em>) instances will always commit to an instance based on the part of the instance head to the right of the <code>=&gt;</code>.</p>\n\n<p>GHC <em>never</em> acts on the belief that a type is <em>not</em> an instance of a class except to produce an error message.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1445012590, "creation_date": 1445012590, "answer_id": 33175216, "question_id": 33173168, "link": "https://stackoverflow.com/questions/33173168/defining-a-function-that-behaves-differently-according-to-whether-the-argument-i/33175216#33175216", "title": "Defining a function that behaves differently according to whether the argument is Integral or Fractional", "body": "<p>Try making the function to halve a value be a specific input to your code.</p>\n\n<pre><code>foobar :: (Ord x) =&gt; (x -&gt; x) -&gt; x -&gt; x -&gt; ...\nfoobar halve x1 x2 = ...\n</code></pre>\n\n<p>It's kind of annoying, but hopefully you only have to specify this once, at the very top of your algorithm. Any child functions can just receive the parameter passed on.</p>\n\n<p>Another alternative would be to do something like</p>\n\n<pre><code>data Halvable x = Halvable {value :: x, halve :: x -&gt; y}\n\nhalfInt :: Integral x =&gt; x -&gt; Halvable x\nhalfInt x = Halvable x (`div` 2)\n\nhalfFrac :: Fractional x =&gt; x -&gt; Halvable x\nhalfFrac x = Halvable x (/ 2)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1445016205, "creation_date": 1445016205, "answer_id": 33176175, "question_id": 33173168, "link": "https://stackoverflow.com/questions/33173168/defining-a-function-that-behaves-differently-according-to-whether-the-argument-i/33176175#33176175", "title": "Defining a function that behaves differently according to whether the argument is Integral or Fractional", "body": "<p>One lightweight way would be to define two new types, thus:</p>\n\n<pre><code>newtype FracWrap a = F a deriving Fractional\nnewtype IntWrap  a = I a deriving Integral\n\ninstance Fractional a =&gt; Halve (FracWrap a) where halve = (/2)\ninstance Integral   a =&gt; Halve (IntWrap  a) where halve = (`div`2)\n</code></pre>\n\n<p>Then, for <code>foo</code> which takes a <code>Halve</code>-constrained argument, one has the relatively lightweight <code>foo.F</code> and <code>foo.I</code> to indicate whether one wants to use the <code>Fractional</code> or <code>Integral</code> version of <code>foo</code>.</p>\n\n<p>This is relatively nice in terms of API design, as the API designer need not offer two version of everything; just one <code>Halve</code>-specific version of everything, and two adapters.</p>\n"}], "owner": {"reputation": 31, "user_id": 5454217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71268fdd4458e734a1ede5eba68d0a4b?s=128&d=identicon&r=PG&f=1", "display_name": "CNJ", "link": "https://stackoverflow.com/users/5454217/cnj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 4, "score": 3, "last_activity_date": 1445023132, "creation_date": 1445006333, "last_edit_date": 1445023132, "question_id": 33173168, "link": "https://stackoverflow.com/questions/33173168/defining-a-function-that-behaves-differently-according-to-whether-the-argument-i", "title": "Defining a function that behaves differently according to whether the argument is Integral or Fractional", "body": "<p>A sort-of solution is to write out a bunch of instances by hand,</p>\n\n<pre><code>class Halve a where\n  halve :: a -&gt; a\n\ninstance Halve Int where\n  halve = (`div` 2)\ninstance Halve Integer where\n  halve = (`div` 2)\ninstance Halve Float where\n  halve = (/ 2)\ninstance Halve Double where\n  halve = (/ 2)\n-- ... etc.\n</code></pre>\n\n<p>However some instances will inevitably be missed, such as user-defined ones. My attempted real solution is this non-working code:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n\nclass Halve a where\n  halve :: a -&gt; a\n\ninstance Integral a =&gt; Halve a where\n  halve = (`div` 2)\ninstance Fractional a =&gt; Halve a where\n  halve = (/ 2)\n</code></pre>\n\n<p>which gives the error</p>\n\n<pre><code>Duplicate instance declarations:\n  instance Integral a =&gt; Halve a\n    -- Defined at ...\n  instance Fractional a =&gt; Halve a\n    -- Defined at ...\n</code></pre>\n\n<p>I haven't found how to express this correctly, if it can be done.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1445016572, "post_id": 33172321, "comment_id": 54159819, "body": "You may find it interesting to know that one thing type theorists typically prove about their systems is that beta reduction respects typing; that is, if <code>(\\x -&gt; e) e&#39;</code> can be given type <code>t</code>, then <code>e[e&#39;&#47;x]</code> (the term where we replace <code>x</code> with <code>e&#39;</code> everywhere in <code>e</code>) can also be given type <code>t</code>. However, the reverse is generally not true: <code>e[e&#39;&#47;x]</code> may have more types than <code>(\\x -&gt; e) e&#39;</code>. In particular when <code>e&#39;</code> is polymorphic -- as <code>3</code> is in your example -- but is forced to be monomorphic by function application."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1445005724, "post_id": 33172611, "comment_id": 54153343, "body": "Last sentence is true only if you write a type signature for <code>nP</code> (or disable the monomorphism restriction)."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1445005798, "post_id": 33172611, "comment_id": 54153393, "body": "@ReidBarton I guess monomorphism restriction was set up precisely to avoid doing that accidentally."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445011061, "post_id": 33172611, "comment_id": 54156871, "body": "This answers the question, but doesn&#39;t seem to get at the various problems with this code, such as the fact that using non-integral numbers in ranges is rather shady."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1445011275, "post_id": 33172611, "comment_id": 54156993, "body": "@dfeuer True. I can&#39;t expand it right now but will try in the future. I encourage you to write your own answer, though; I admit I only focused on the &quot;what&quot;, no the &quot;why&quot; part,"}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 3, "last_activity_date": 1445005062, "last_edit_date": 1445005062, "creation_date": 1445004714, "answer_id": 33172611, "question_id": 33172321, "link": "https://stackoverflow.com/questions/33172321/substitute-n-in-xx-1-n/33172611#33172611", "title": "Substitute n in [x|x&lt;-[1..n]]", "body": "<p>When you typed <code>n</code>, you forced it to become <code>Int</code> with your expressions. Thus, <code>b</code> and <code>a</code> became <code>Int</code>s, which became problematic in <code>a/b</code>.</p>\n\n<p>When you wrote <code>3</code>, the literal being polymorphic allowed some expressions to use <code>Int</code>, and some to use some other <code>Fractional a =&gt; a</code>. The <code>3</code>s used across that function are simply different values.</p>\n\n<p>Creating a different value such as <code>nP = fromIntegral n</code> <a href=\"http://coliru.stacked-crooked.com/a/93fd1ffffc72eb06\" rel=\"nofollow\">should allow you to use n in every context</a>, because <code>nP</code> shouldn't become rigidized by any expression.</p>\n"}], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 33172611, "answer_count": 1, "score": 1, "last_activity_date": 1445005868, "creation_date": 1445003906, "last_edit_date": 1445005868, "question_id": 33172321, "link": "https://stackoverflow.com/questions/33172321/substitute-n-in-xx-1-n", "title": "Substitute n in [x|x&lt;-[1..n]]", "body": "<pre><code>test n = (sum s)*4+2*(n-1)*((l')^2)-2*(n-1)*(l')\n    where \n      p =sort $[ m | a&lt;-[1..(n-1)],b&lt;-[1..(n-1)],let m= (b/a), (a^2+b^2&lt; (n^2))]\n      l'= length p\n      s = (product a) : next a (group p)\n        where \n          a = [(n-1),2*(l')+(n-2)] \n          next [x,y] (z:z':zs) = case (null zs) of\n            False -&gt; (x')*(y')*l : next [x',y'] (z':zs)\n            True -&gt; (x')*(y')*l :[]\n            where \n              l  = length z\n              x' = x+l\n              y' = y-length z'\n</code></pre>\n\n<p>Why does the above code give the following error:</p>\n\n<blockquote>\n  <p>No instance for (Fractional Int) arising from a use of \u2018/\u2019\n     In the expression: (b / a)</p>\n  \n  <p>In an equation for \u2018m\u2019: m = (b / a)</p>\n  \n  <p>In the second argument of \u2018($)\u2019, namely</p>\n\n<pre><code> \u2018[m |\n    a &lt;- [1 .. (n - 1)],\n     b &lt;- [1 .. (n - 1)],\n     let m = (b / a),\n    (a ^ 2 + b ^ 2 &lt; (n ^ 2))]\u2019\n</code></pre>\n</blockquote>\n\n<p>But when I substituted <code>n=3</code> in the code by hand:</p>\n\n<pre><code>test' = (sum s)*4+2*(3-1)*((l')^2)-2*(3-1)*(l')\n    where \n      p = sort $[ m | a&lt;-[1..(3-1)],b&lt;-[1..(3-1)],let m= (b/a), (a^2+b^2&lt; (3^2))]\n      l'= length p\n      s = (product a) : next a (group p)\n        where \n          a = [(3-1),2*(l')+(3-2)] \n          next [x,y] (z:z':zs) = case (null zs) of\n            False -&gt; (x')*(y')*l : next [x',y'] (z':zs)\n            True -&gt; (x')*(y')*l :[]\n            where \n              l  = length z\n              x' = x+l\n              y' = y-length z'\n</code></pre>\n\n<p>Then it can be run in GHCi; what is happening?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1445001644, "post_id": 33170644, "comment_id": 54150633, "body": "<code>programName (&gt;) 4 [1,2,4,2,5]</code>, and it should return: <code>[1,2,3]</code>. Where&#39;s that <code>3</code> coming from?"}, {"owner": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1445008337, "post_id": 33170644, "comment_id": 54155171, "body": "my bad, what i ment was: [1,2,2]"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1445008388, "post_id": 33170644, "comment_id": 54155200, "body": "So what you want is essentially <code>filter</code>? <code>filter (&lt; 4) [1, 2, 4, 2, 5] == [1,2,2]</code>"}, {"owner": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1445008495, "post_id": 33170644, "comment_id": 54155282, "body": "but i want the (&lt;) operation to be seperatly from the number like in my example."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1445008740, "post_id": 33170644, "comment_id": 54155471, "body": "Soooo.... <code>filter2 op x = filter (op x)</code> and then <code>filter2 (&lt;) 4 [1,2,4,2,5] == [1,2,2]</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "edited": false, "score": 0, "creation_date": 1445003569, "post_id": 33170777, "comment_id": 54151857, "body": "Yeah, I got it this far but it&#39;s the if statement Im mostly confused with could you give me some more help please ? :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1444999294, "creation_date": 1444999294, "answer_id": 33170777, "question_id": 33170644, "link": "https://stackoverflow.com/questions/33170644/function-in-a-function-testing-prog/33170777#33170777", "title": "Function in a function testing prog", "body": "<p>You can adapt your previous program by adding a function argument. Here's a hint:</p>\n\n<pre><code>programEqual :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [a] -&gt; [a]\nprogramEqual f e [] = []\nprogramEqual f e (x:xs) = if ....\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "edited": false, "score": 0, "creation_date": 1445006974, "post_id": 33171622, "comment_id": 54154211, "body": "have in mind that i alredy have the &quot;takeEqual&quot;. I want my new part to do:   select :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [a] -&gt; [a]   select f e [] = []   select f e (x:xs) = if (f == (==) something) then e : takeEqual e xs else takeEqual e xs   else if ( f == (&gt;) something) then e : takeWhile  e xs else.... etc   I&#39;m used to Java so Haskell is very confusing to me. :S"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "edited": false, "score": 0, "creation_date": 1445007020, "post_id": 33171622, "comment_id": 54154250, "body": "@KalleJohansson can you add the definition of <code>takeEqual</code> to your queston?"}, {"owner": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "edited": false, "score": 0, "creation_date": 1445007101, "post_id": 33171622, "comment_id": 54154318, "body": "Do I have to define the (&lt;) function or is it not allredy defined in haskell :S"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "edited": false, "score": 0, "creation_date": 1445007165, "post_id": 33171622, "comment_id": 54154355, "body": "@KalleJohansson It is already defined as a part of <code>Ord</code>. Did you notice my previous comment?"}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 1, "last_activity_date": 1445008883, "last_edit_date": 1592644375, "creation_date": 1445001759, "answer_id": 33171622, "question_id": 33170644, "link": "https://stackoverflow.com/questions/33170644/function-in-a-function-testing-prog/33171622#33171622", "title": "Function in a function testing prog", "body": "<h3>If you want to implement that the easiest way possible</h3>\n<p>Just use <code>filter</code>:</p>\n<pre><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n\nfilter (&lt; 4) [1, 2, 4, 2, 5] == [1, 2, 2]\n</code></pre>\n<p>If you want to pass the operator and the operand separately:</p>\n<pre><code>filter' op x = filter (op x)\n</code></pre>\n<p>and then</p>\n<pre><code>filter' (&lt;) 4 [1,2,4,2,5] == [1,2,2]\n</code></pre>\n<hr />\n<h3>If you want to tinker</h3>\n<p>There's a very useful function defined in <code>Data.List</code>:</p>\n<pre><code>takeWhile :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n<p>Its signature should be rather helpful for you.</p>\n<hr />\n<p>Here's a hint:</p>\n<pre><code>(&gt;)   :: Int -&gt; Int -&gt; Bool     -- simplified from Eq a =&gt; ..\n(&gt; 4) ::        Int -&gt; Bool\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5453691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba906b43c4b7421a170607434980a46c?s=128&d=identicon&r=PG&f=1", "display_name": "KalleJohansson", "link": "https://stackoverflow.com/users/5453691/kallejohansson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1445008883, "creation_date": 1444998858, "last_edit_date": 1445001411, "question_id": 33170644, "link": "https://stackoverflow.com/questions/33170644/function-in-a-function-testing-prog", "title": "Function in a function testing prog", "body": "<p>I have a question about a selecting process.<br>\nI want to make a program where you type in a operation, a value and a list.</p>\n\n<p>For example: <code>programName (&gt;) 4 [1,2,4,2,5]</code>, and it should return: <code>[1,2,3]</code>.</p>\n\n<p>I know how to make a program that make the function take takes whats equal in a list and make a new list like this:</p>\n\n<pre><code>programEqual :: Eq a =&gt; a -&gt; [a] -&gt; [a]\nprogramEqual e [] = []\nprogramEqual e (x:xs) = if (e == x) then e : takeEqual e xs else takeEqual e xs\n</code></pre>\n\n<p>I also understand that that you need two functions for this, but I can't understand how I should get the <code>(tester)</code> stuff in there.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1444989757, "post_id": 33167426, "comment_id": 54143272, "body": "1) You can&#39;t. Types don&#39;t exist at runtime. \u2014 2) that should be possible, I suppose. But in what form would you want that \u201cvariable\u201c to be? A  <a href=\"http://hackage.haskell.org/package/base/docs/Data-Typeable-Internal.html#t:TypeRep\" rel=\"nofollow noreferrer\"><code>TypeRep</code></a>, or rather just something like <code>type Bla = {-# TYPEOF f #-}</code>?"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1444990048, "post_id": 33167426, "comment_id": 54143481, "body": "@leftaroundabout See my update in the question&#39;s text."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 4, "creation_date": 1444990223, "post_id": 33167426, "comment_id": 54143586, "body": "What do you want this <i>for</i>? Maybe there&#39;s some other way to achieve your goal."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1444995376, "post_id": 33167426, "comment_id": 54146618, "body": "@MathematicalOrchid See my comment to &quot;soupi&quot; below for the reasons I want this."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1444995996, "post_id": 33167426, "comment_id": 54146983, "body": "@mljrg You should probably edit that into the question. Knowing that you&#39;re trying to grade exam submissions makes this question a lot more sensible than it otherwise appears."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1444996239, "post_id": 33167426, "comment_id": 54147135, "body": "@MathematicalOrchid Did so. What do you mean by &quot;a lot more sensible&quot;?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1444998779, "post_id": 33167426, "comment_id": 54148737, "body": "@mljrg: actually I think if you based your question title on what you wrote in <b>UPDATE 2</b>, you&#39;d get more and better attention."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1445002009, "post_id": 33167426, "comment_id": 54150887, "body": "@mljrg Asking &quot;how can I dynamically check that my code has the right type?&quot; sounds a bit bizarre. If you wrote it, how can you not know it&#39;s type? And why isn&#39;t manually asking GHCi sufficient? Asking &quot;how can I check that a student&#39;s code has the right type&quot; makes much more sense."}], "answers": [{"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1444995050, "post_id": 33167813, "comment_id": 54146428, "body": "The reason I want this is to check if a function named <code>g</code> in a file has some type. The goal is to automatically score students&#39; responses to an exercise in which they are asked to give definitions for several functions given some type. My idea is to load the students&#39; files and for each function verify if it has the expected type. This must be done automatically because there are many many students."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445016906, "post_id": 33167813, "comment_id": 54159977, "body": "...but beware that this only checks that the student&#39;s term <i>can be given</i> the appropriate type, not that it has <i>identically that type</i>. For example, a module filled with <code>g = undefined</code> everywhere will pass this test."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1445018261, "post_id": 33167813, "comment_id": 54160674, "body": "@DanielWagner Right! That&#39;s why the best solution I have found is to parse the output of a controlled GHCi session. Unfortunately, it seems that Haskell falls short on metaprogramming capabilities :-("}], "tags": [], "owner": {"reputation": 974, "user_id": 3829232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?s=128&d=identicon&r=PG", "display_name": "soupi", "link": "https://stackoverflow.com/users/3829232/soupi"}, "is_accepted": false, "score": 9, "last_activity_date": 1445002168, "last_edit_date": 1445002168, "creation_date": 1444990080, "answer_id": 33167813, "question_id": 33167426, "link": "https://stackoverflow.com/questions/33167426/how-to-introspect-an-haskell-file-to-get-the-types-of-its-definitions/33167813#33167813", "title": "How to introspect an Haskell file to get the types of its definitions", "body": "<p>Haskell does not save type information at runtime. In Haskell, types are used for pre-runtime type checking at the static analysis phase and are later erased. You can read more about Haskell's type system <a href=\"http://www.well-typed.com/blog/2014/04/haskell-gets-static-typing-right/\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Is there a reason you want to know the type of a function at runtime? maybe we can help with the problem itself :)</p>\n\n<p><strong>Edit based on your 2nd edit:</strong></p>\n\n<p>I don't have a good solution for you, but here is one idea that might work:</p>\n\n<p>Run a script that for each student module will:</p>\n\n<ol>\n<li>Take the name of the module and produce a file <code>Test.hs</code>:</li>\n</ol>\n\n<pre><code>\n    module Test where\n\n    import [module-name]\n\n    test :: a -> b -> [(b,a)]\n    test = g\n</code></pre>\n\n<ol start=\"2\">\n<li>run <code>ghc -fno-code Test.hs</code></li>\n<li>check the output does not contain type errors</li>\n<li>write results into a log file</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1444995274, "post_id": 33169046, "comment_id": 54146557, "body": "I have already done <code>typeOf g</code> where <code>g</code> has type <code>a -&gt; b -&gt; [(b, a)]</code> and it fails. It seems that <code>typeOf</code> works only for non-polymorphic types."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1444993824, "creation_date": 1444993824, "answer_id": 33169046, "question_id": 33167426, "link": "https://stackoverflow.com/questions/33167426/how-to-introspect-an-haskell-file-to-get-the-types-of-its-definitions/33169046#33169046", "title": "How to introspect an Haskell file to get the types of its definitions", "body": "<p>The closest Haskell feature to that is <code>Data.Typeable.typeOf</code>. Here's a GHCi session:</p>\n\n<pre><code>&gt; import Data.Typeable\n&gt; typeOf (undefined :: Int -&gt; Char)\nInt -&gt; Char\n&gt; typeOf (undefined :: Int -&gt; [Char])\nInt -&gt; [Char]\n&gt; typeOf (undefined :: Int -&gt; Maybe [Char])\nInt -&gt; Maybe [Char]\n&gt; :t typeOf\ntypeOf :: Typeable a =&gt; a -&gt; TypeRep\n</code></pre>\n\n<p>Under the hood, the <code>Typeable a</code> constraint forces Haskell to retain some type tags until runtime, so that they can be retrieved by <code>typeOf</code>. Normally, no such tags exist at runtime. The <code>TypeRep</code> type above is the type for such tags.</p>\n\n<p>That being said, having such information is almost never needed in Haskell. If you are using <code>typeOf</code> to implement something, you are likely doing it wrong.</p>\n\n<p>If you are using that to defer type checks to run time, when they could have been performed at compile time, e.g. using a <code>Dynamic</code>-like type for everything, then you are definitely doing it wrong.</p>\n"}, {"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1445019205, "post_id": 33169692, "comment_id": 54161090, "body": "Thanks for the links. I was expecting much better documentation of GHC API, but I suppose this is ongoing work."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1445074901, "post_id": 33169692, "comment_id": 54176299, "body": "I think with the help of <code>ghc-mod</code>, <code>stack-ide</code>, Leksah or FP Complete, you could possibly find your way through the GHC API with trial and error where the documentation is lacking. And I guess peeking at the source code of GHCJS (and possibly Haste?) and Stack IDE backend and similar projects might help, too."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1445077574, "post_id": 33169692, "comment_id": 54176971, "body": "Sure, but the effort is huge. Anyway, in this <a href=\"http://www.well-typed.com/blog/2014/04/haskell-gets-static-typing-right/\" rel=\"nofollow noreferrer\">interesting page</a> the author says &quot;Haskell gives you various degrees of selective run-time typing. If you really need it in places, you can explicitly attach run-time type information to values and then make type-based decisions. But you say where and when, making a conscious choice that you gain flexibility at the cost of safety.&quot;, which I believe it is what I am looking for. Can you give an example of this, or a link to an example? Thanks"}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 5, "last_activity_date": 1444995880, "last_edit_date": 1495541033, "creation_date": 1444995880, "answer_id": 33169692, "question_id": 33167426, "link": "https://stackoverflow.com/questions/33167426/how-to-introspect-an-haskell-file-to-get-the-types-of-its-definitions/33169692#33169692", "title": "How to introspect an Haskell file to get the types of its definitions", "body": "<p>I think if you have a dynamically determined number of <code>.hs</code> files, which you need to load, parse and introspect, you could/should use the GHC API instead.</p>\n\n<p>See for example:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/28059669/using-ghc-api-to-compile-haskell-sources-to-core-and-core-to-binary\">Using GHC API to compile Haskell sources to CORE and CORE to binary</a></li>\n<li><a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2009-April/060705.html\" rel=\"nofollow noreferrer\">https://mail.haskell.org/pipermail/haskell-cafe/2009-April/060705.html</a></li>\n</ul>\n\n<p>These might not be something you can use directly \u2014 and I haven't done anything like this myself so far either \u2014 but these should get you started.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://wiki.haskell.org/GHC/As_a_library\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/GHC/As_a_library</a></li>\n<li><a href=\"https://hackage.haskell.org/package/hint\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/hint</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1445018315, "post_id": 33171679, "comment_id": 54160704, "body": "I cannot do that because I do not know the semantics of the functions, only the type they should have. Also, the GHC API is extremely poorly documented, unfortunately."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1445001927, "creation_date": 1445001927, "answer_id": 33171679, "question_id": 33167426, "link": "https://stackoverflow.com/questions/33167426/how-to-introspect-an-haskell-file-to-get-the-types-of-its-definitions/33171679#33171679", "title": "How to introspect an Haskell file to get the types of its definitions", "body": "<p>If the function is supposed to be exported with a specific name, I think probably the easiest way would be to just write a test script that calls the functions and checks they return the right results. If the test script doesn't compile, the student's submission is incorrect.</p>\n\n<p>The alternative is to use either the GHC API (kinda hard), or play with Template Haskell (simpler, but still not that simple).</p>\n"}, {"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1445080089, "post_id": 33185840, "comment_id": 54177649, "body": "I don&#39;t think it&#39;s bad: it&#39;s a useful warning. Anyway, I found a <a href=\"http://www.well-typed.com/blog/2014/04/haskell-gets-static-typing-right/\" rel=\"nofollow noreferrer\">blog page</a> where the author says that it is possible to get type information at run-time: &quot;Haskell gives you various degrees of selective run-time typing ...&quot;. I wonder if anyone here can give an example."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1445165066, "post_id": 33185840, "comment_id": 54199169, "body": "@mljrg I think they&#39;re talking about <code>Typable</code> and <code>Dynamic</code>. Take a look at <code>Data.Typable</code> and <code>Data.Dynamic</code>, respectively. As you already discovered, this only works for monomorphic values."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1445079782, "creation_date": 1445079782, "answer_id": 33185840, "question_id": 33167426, "link": "https://stackoverflow.com/questions/33167426/how-to-introspect-an-haskell-file-to-get-the-types-of-its-definitions/33185840#33185840", "title": "How to introspect an Haskell file to get the types of its definitions", "body": "<p>Yet another possibility is to load the student's code into GHCi and use the <code>:browse</code> command to dump out everything that's exported. You can then grep for the term you're interested in. That should be quite easy to automate.</p>\n\n<p>There's a catch, however: <code>foo :: x -&gt; x</code> and <code>foo :: a -&gt; a</code> are <em>the same type</em>, even though textually they don't match at all. You might contemplate trying to normalise the variable names, but it's worse: <code>foo :: Int -&gt; Int</code> and <code>foo :: Num x =&gt; x -&gt; x</code> don't look remotely the same, yet one type is an instance of the other.</p>\n\n<p>...which I guess means I'm saying that my answer is bad? :-(</p>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "answer_count": 5, "score": 3, "last_activity_date": 1445079782, "creation_date": 1444989056, "last_edit_date": 1445008392, "question_id": 33167426, "link": "https://stackoverflow.com/questions/33167426/how-to-introspect-an-haskell-file-to-get-the-types-of-its-definitions", "title": "How to introspect an Haskell file to get the types of its definitions", "body": "<p>I have many files that must be processed automatically. Each file holds the response of one student to an exercise which asks the student to give definitions for some functions given a type for each function.</p>\n\n<p>My idea is to have an Haskell script that loads each student file, and verifies if each function has the expected type.</p>\n\n<p>A constraint is that the student files are not defined as modules.</p>\n\n<p>How can I do this?</p>\n\n<p>My best alternative so far is to spawn a GHCi process that will read stdin from a \"test file\" with GHCi commands, for example:</p>\n\n<pre><code>:load student1.hs\n:t g\n... and so on ...\n</code></pre>\n\n<p>then parse the returned output from GHCi to find the types of the functions in the student file.</p>\n\n<p>Is there another clean way to load an arbitrary Haskell file and introspect its code?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "parallel-processing", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1444987386, "post_id": 33166511, "comment_id": 54141761, "body": "Well, as it says, your monad is not an instance of <code>MonadParallel</code>. Either define that instance yourself, or switch to a monad that has such an instance."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 3, "creation_date": 1444987435, "post_id": 33166511, "comment_id": 54141785, "body": "Can you post the error?  What Monad are you trying to use?"}, {"owner": {"reputation": 21, "user_id": 4259524, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MBfd203kO8E/AAAAAAAAAAI/AAAAAAAAAFE/ZLAxpomWPiM/photo.jpg?sz=128", "display_name": "Sean Liu", "link": "https://stackoverflow.com/users/4259524/sean-liu"}, "edited": false, "score": 0, "creation_date": 1445213984, "post_id": 33166511, "comment_id": 54214325, "body": "To leftaroundabout, could you please tell me some kind of definition of a MonadParallel instance?"}], "owner": {"reputation": 21, "user_id": 4259524, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MBfd203kO8E/AAAAAAAAAAI/AAAAAAAAAFE/ZLAxpomWPiM/photo.jpg?sz=128", "display_name": "Sean Liu", "link": "https://stackoverflow.com/users/4259524/sean-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1444998251, "creation_date": 1444986496, "last_edit_date": 1444998251, "question_id": 33166511, "link": "https://stackoverflow.com/questions/33166511/convert-monad-to-monadparallel", "title": "Convert monad to monadparallel", "body": "<p>I want to convert the <code>liftM2</code> function in <code>Control.Monad</code> to <code>liftM2</code> function in <code>Control.Monad.Parallel</code>. I tried just change the import package from <code>Control.Monad</code> to <code>Control.Monad.Parallel</code>, then GHC output the error like \"no instance for <code>MonadParallel</code>\".</p>\n\n<p>Could you help me or give some sort of hint on how to convert the monad to <code>MonadParallel</code> type?</p>\n\n<p>A sample code illustrates as below:</p>\n\n<pre><code>MoPar.liftM2 (,) (randNum (0, maxX) gen) (randNum (0, maxY) gen) &gt;&gt;= do\n        visit gen visited rWalls bWalls\n    MoPar.liftM2 Maze (freeze rWalls) (freeze bWalls)\n</code></pre>\n\n<p><code>MoPar</code> means <code>Monad.Parallel</code> package, which occurs errors. If I change it to <code>Mon</code> which is <code>Control.Monad</code> and will pass the compile. Do I miss something on the around <code>liftM2</code> function in source code? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1444982847, "post_id": 33165243, "comment_id": 54139311, "body": "Where is <code>Gen</code> imported from?"}], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 2155965, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/uOvZI.jpg?s=128&g=1", "display_name": "Hakim Marley", "link": "https://stackoverflow.com/users/2155965/hakim-marley"}, "edited": false, "score": 0, "creation_date": 1444983842, "post_id": 33165570, "comment_id": 54139788, "body": "So that means its always going to be 11 elements generated? @kosmikus. And if i would like to pick any of the returned 11 elems, would be logical to call head $ sample genExpr&#39;?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 169, "user_id": 2155965, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/uOvZI.jpg?s=128&g=1", "display_name": "Hakim Marley", "link": "https://stackoverflow.com/users/2155965/hakim-marley"}, "edited": false, "score": 0, "creation_date": 1444984035, "post_id": 33165570, "comment_id": 54139896, "body": "The function <code>sample</code> is just there for debugging purposes. Yes, it will always generate and print 11 elements. If you use the generator normally within QuickCheck, then QuickCheck will use it to generate as many elements as needed."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 4, "last_activity_date": 1444983297, "creation_date": 1444983297, "answer_id": 33165570, "question_id": 33165243, "link": "https://stackoverflow.com/questions/33165243/cant-understand-connection-between-results-and-function/33165570#33165570", "title": "Can&#39;t understand connection between results and Function", "body": "<p>[For context, I'm assuming you mean <code>Gen</code> as defined in the <code>QuickCheck</code> library.]</p>\n\n<p>The output you're seeing has as much to do with <code>sample</code> than with the generator you have written.</p>\n\n<p>The definition of <code>sample</code> is:</p>\n\n<pre><code>-- | Generates some example values and prints them to 'stdout'.\nsample :: Show a =&gt; Gen a -&gt; IO ()\nsample g =\n  do cases &lt;- sample' g\n     mapM_ print cases\n\n-- | Generates some example values.\nsample' :: Gen a -&gt; IO [a]\nsample' g =\n  generate (sequence [ resize n g | n &lt;- [0,2..20] ])\n</code></pre>\n\n<p>So <code>sample</code> takes a generator, runs the helper function <code>sample'</code> on it, and then prints all the results of <code>sample'</code> on screen.</p>\n\n<p>The function <code>sample</code> takes a generator, and uses <code>generate</code> to \"call\" it a number of times at different sizes (using <code>resize</code>). How many times is determined by the list comprehension. The list comprehension is using the input sizes <code>[0,2..20]</code>, which is a list expanding to 11 elements. This is why you're ultimately seeing 11 results.</p>\n\n<p>So you're ultimately getting to see 11 random values, generated using your generator.</p>\n"}], "owner": {"reputation": 169, "user_id": 2155965, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/uOvZI.jpg?s=128&g=1", "display_name": "Hakim Marley", "link": "https://stackoverflow.com/users/2155965/hakim-marley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "accepted_answer_id": 33165570, "answer_count": 1, "score": 1, "last_activity_date": 1444983297, "creation_date": 1444981994, "question_id": 33165243, "link": "https://stackoverflow.com/questions/33165243/cant-understand-connection-between-results-and-function", "title": "Can&#39;t understand connection between results and Function", "body": "<p>I really can't understand the connection between the Function and the results it creates. I have the following Haskell code</p>\n\n<pre><code>data Expr = Num Integer | Add Expr Expr | Mul Expr Expr\n\ngenExpr' :: Gen Expr\ngenExpr' = frequency\n    [ (1,  do n &lt;- arbitrary\n              return (Num n)\n      )\n    , (1,  do a &lt;- genExpr (1 `div` 2)\n              b &lt;- genExpr (1 `div` 2)\n              return (Add a b)\n      )\n    , (1,  do a &lt;- genExpr (1 `div` 2)\n              b &lt;- genExpr (1 `div` 2)\n              return (Mul a b)\n      )\n    ]\n</code></pre>\n\n<p>It generates the following results in the console when i run \"sample genExpr'\"</p>\n\n<pre><code>0*0\n-2\n-1\n1*-3\n-1+-6\n-7*1\n9*10\n10+3\n-8+15\n2*-3\n-13\n</code></pre>\n\n<p>And what makes the results to be 11 in total??</p>\n"}, {"tags": ["haskell", "linker", "cabal", "hunit"], "answers": [{"comments": [{"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1445068209, "post_id": 33169852, "comment_id": 54174687, "body": "You were right, it was that setting that tripped me up!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1444996370, "creation_date": 1444996370, "answer_id": 33169852, "question_id": 33164881, "link": "https://stackoverflow.com/questions/33164881/problems-while-integrating-hunit-with-cabal/33169852#33169852", "title": "Problems while integrating HUnit with Cabal", "body": "<p>You should add the additional modules to the <code>other-modules</code> field. If you build with Stack, it should give you a warning about which modules need to be specified.</p>\n"}], "owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 33169852, "answer_count": 1, "score": 0, "last_activity_date": 1444996370, "creation_date": 1444980748, "last_edit_date": 1444981179, "question_id": 33164881, "link": "https://stackoverflow.com/questions/33164881/problems-while-integrating-hunit-with-cabal", "title": "Problems while integrating HUnit with Cabal", "body": "<p>The command <code>cabal install</code> works fine, as does <code>cabal configure --enable-tests</code>. However, when I run <code>cabal build -j</code> it does not compile:</p>\n\n<pre><code>Building MoodleLatex-0.1.0.0...\nPreprocessing executable 'moddlelat' for MoodleLatex-0.1.0.0...\nPreprocessing test suite 'Moodle-Tests' for MoodleLatex-0.1.0.0...\nIn-place registering Moodle-Tests-0.1.0.0...\n[1 of 1] Compiling Main             ( dist/build/Moodle-TestsStub/Moodle-TestsStub-tmp/Moodle-TestsStub.hs, dist/build/Moodle-TestsStub/Moodle-TestsStub-tmp/Main.o )\nLinking dist/build/Moodle-TestsStub/Moodle-TestsStub ...\n/home/miki/exp/moodle/dist/build/libMoodle-Tests.a(Moodle.o):(.text+0x26): undefined reference to `MoodlzuHFs0eta1wVtKnH9dbfcoDT_MoodleziTypes_zdfShowMoodleVal_closure'\n/home/miki/exp/moodle/dist/build/libMoodle-Tests.a(Moodle.o):(.text+0xd9): undefined reference to `MoodlzuHFs0eta1wVtKnH9dbfcoDT_MoodleziTypes_zdfShowMoodleVal_closure'\n/home/miki/exp/moodle/dist/build/libMoodle-Tests.a(Moodle.o):(.text+0xeba): undefined reference to `MoodlzuHFs0eta1wVtKnH9dbfcoDT_MoodleziParser_parseExpr2_closure'\n[..snip..]\n/home/miki/exp/moodle/dist/build/libMoodle-Tests.a(Moodle.o):(.data+0x570): undefined reference to `MoodlzuHFs0eta1wVtKnH9dbfcoDT_MoodleziParser_parseExpr2_closure'\n/home/miki/exp/moodle/dist/build/libMoodle-Tests.a(Moodle.o):(.data+0x578): undefined reference to `MoodlzuHFs0eta1wVtKnH9dbfcoDT_MoodleziParser_parseExpr9_closure'\n/home/miki/exp/moodle/dist/build/libMoodle-Tests.a(Moodle.o):(.data+0x580): undefined reference to `MoodlzuHFs0eta1wVtKnH9dbfcoDT_MoodleziParser_zdwa1_closure'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>This is the structure of the source directory:</p>\n\n<pre><code>src\n\u251c\u2500\u2500 Main.hs\n\u251c\u2500\u2500 Moodle\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Parser.hs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Translator.hs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Types.hs\n\u2514\u2500\u2500 Test\n    \u2514\u2500\u2500 Moodle.hs\n</code></pre>\n\n<p>And this is my Cabal file (relevant lines only):</p>\n\n<pre><code>name:                MoodleLatex\nversion:             0.1.0.0\ncategory:            Text\nbuild-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\nexecutable moddlelat\n  main-is:             Main.hs\n  -- other-modules:\n  other-extensions:    OverloadedStrings\n  build-depends: base       &gt;=4.8  &amp;&amp; &lt;4.9\n               , scientific &gt;=0.3  &amp;&amp; &lt;0.4\n               , text       &gt;=1.2  &amp;&amp; &lt;1.3\n               , attoparsec &gt;=0.13 &amp;&amp; &lt;0.14\n  hs-source-dirs:      src\n  default-language:    Haskell2010\n\nTest-Suite Moodle-Tests\n  type:          detailed-0.9\n  test-module:   Test.Moodle\n  build-depends: base       &gt;=4.8  &amp;&amp; &lt;4.9\n               , scientific &gt;=0.3  &amp;&amp; &lt;0.4\n               , text       &gt;=1.2  &amp;&amp; &lt;1.3\n               , attoparsec &gt;=0.13 &amp;&amp; &lt;0.14\n               , Cabal\n               , HUnit\n               , cabal-test-hunit\n  hs-source-dirs:      src\n  default-language:    Haskell2010\n</code></pre>\n\n<p>I followed the steps in the <a href=\"https://github.com/pbrisbin/cabal-test-hunit\" rel=\"nofollow\">cabal-test-hunit README</a>. I also wonder, is it even necessary to declare the dependencies two times?! It's not very DRY.</p>\n\n<p><strong>EDIT</strong>: It seems that it cannot find my modules. However, if I add <code>MoodleLatex</code> to <code>build-depends</code> I run into another error:</p>\n\n<pre><code>Building MoodleLatex-0.1.0.0...\nPreprocessing executable 'moddlelat' for MoodleLatex-0.1.0.0...\nPreprocessing test suite 'Moodle-Tests' for MoodleLatex-0.1.0.0...\n&lt;command line&gt;: cannot satisfy -package-id MoodleLatex-0.1.0.0-inplace\n</code></pre>\n"}, {"tags": ["haskell", "matrix"], "answers": [{"comments": [{"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1445005316, "post_id": 33165689, "comment_id": 54153089, "body": "Interesting, I was planning to use numRows to do something else, but I figure as I&#39;m new its probably better to do that in order to understand what&#39;s really going on and then do something more comolex. From what I saw in other matrix implementations, they&#39;re basically collections of vectors. I wonder if this one is too."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1444983740, "creation_date": 1444983740, "answer_id": 33165689, "question_id": 33163458, "link": "https://stackoverflow.com/questions/33163458/cant-figure-out-what-this-matrix-datatype-module-means-need-to-display-its-con/33165689#33165689", "title": "Can&#39;t figure out what this matrix datatype module means, need to display its contents", "body": "<p>It seems that <code>Matrix</code> consists of a size, and a function that takes a coordinate and returns the value at that coordinate.</p>\n\n<p>Presumably <code>fillWith</code> creates a matrix where <em>all</em> the elements are the same. That's why the lambda function ignores the coordinates (that's what the underscores are for) and always returns <code>k</code> (the value that the array is going filled with).</p>\n\n<p>You can see that the <code>at</code> function returns the element at a given pair of coordinates. (But it checks the coordinates are valid first.) By constructing a loop that calls <code>at</code> to get each element, you should be able to print out the matrix contents.</p>\n"}], "owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1444983740, "creation_date": 1444975145, "question_id": 33163458, "link": "https://stackoverflow.com/questions/33163458/cant-figure-out-what-this-matrix-datatype-module-means-need-to-display-its-con", "title": "Can&#39;t figure out what this matrix datatype module means, need to display its contents", "body": "<p>Alright, so I'm supposed to create a show method for a matrix module, in order to display matrix row by row. Now they've given me a module to start with, but I have no clue what it means, and the person who sent it didn't really explain it. I'm new to Haskell, and I've also never programmed with a functional language before. If anyone can give my some clarification as to how this module works, I'd appreciate it. </p>\n\n<p>Here's the matrix module I'm supposed to work with: </p>\n\n<pre><code>module Matrix (Matrix, fillWith, fromRule, numRows, numColumns, at, mtranspose, mmap) where\nnewtype Matrix a = Mat ((Int,Int), (Int,Int) -&gt; a)\n\nfillWith :: (Int,Int) -&gt; a -&gt; (Matrix a)\nfillWith (n,m) k = Mat ((n,m), (\\(_,_) -&gt; k))\n\nfromRule :: (Int,Int) -&gt; ((Int,Int) -&gt; a) -&gt; (Matrix a)\nfromRule (n,m) f = Mat ((n,m), f)\n\nnumRows :: (Matrix a) -&gt; Int\nnumRows (Mat ((n,_),_)) = n\n\nnumColumns :: (Matrix a) -&gt; Int\nnumColumns (Mat ((_,m),_)) = m\n\nat :: (Matrix a) -&gt; (Int, Int) -&gt; a\nat (Mat ((n,m), f)) (i,j)| (i &gt; 0) &amp;&amp; (j &gt; 0) || (i &lt;= n) &amp;&amp; (j &lt;= m) = f (i,j)\n\nmtranspose :: (Matrix a) -&gt; (Matrix a)\nmtranspose (Mat ((n,m),f)) = (Mat ((m,n),\\(j,i) -&gt; f (i,j)))\n\nmmap :: (a -&gt; b) -&gt; (Matrix a) -&gt; (Matrix b)\nmmap h (Mat ((n,m),f)) = (Mat ((n,m), h.f))\n</code></pre>\n\n<p>Now I think, but I don't know about this, that the fillWith functions creates the matrix, however. I'm also thinking that <code>Mat ((Int,Int,), (Int,Int) -&gt; a</code> takes a pair of values, most likely number of rows and columns. I'm not sure what the second pair of values is or what the a does. I'm also not sure about what this does <code>fillWith (n,m) k = Mat ((n,m), (\\(_,_) -&gt; k))</code> except for the fact that it is saying that fillWith's result is equal to the Mat constructor, but then whats <code>(\\(_,_) -&gt; k))</code> this for. All I know is that the lambda is to define an anonymuous function, but why are those spaces empty, and why is k being referenced as the function. I really want to learn haskell, if anyone also knows of any tutorials I'd appreciate it. </p>\n\n<p>Basically, if I find out what Matrix is composed of, I can figure out a way to print its contents. I'm assuming Matrix is basically a multidimensional array, but I really have no way of knowing to be honest. </p>\n"}, {"tags": ["haskell", "recursion", "matrix"], "comments": [{"owner": {"reputation": 174, "user_id": 2439506, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KWGNd.jpg?s=128&g=1", "display_name": "lsbbo", "link": "https://stackoverflow.com/users/2439506/lsbbo"}, "edited": false, "score": 0, "creation_date": 1444969823, "post_id": 33162272, "comment_id": 54133845, "body": "matToString [[]] = &quot;&quot; change to matToString [] = &quot;&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1444969509, "post_id": 33162492, "comment_id": 54133767, "body": "That&#39;s a very useful tool, thanks. Look forward to learning more about haskell, they say its very useful for what it does, even though I&#39;ve heard some people say no one uses it for anything."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1444970672, "post_id": 33162492, "comment_id": 54134092, "body": "@Argus, those people are wrong. It&#39;s not exactly big in industry, but it&#39;s around, and seems to be growing in popularity."}, {"owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "edited": false, "score": 0, "creation_date": 1444970890, "post_id": 33162492, "comment_id": 54134155, "body": "Yes, and an example  I&#39;ve heard of is using haskell as a server side language, which I thought was pretty interesting."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1444969044, "creation_date": 1444969044, "answer_id": 33162492, "question_id": 33162272, "link": "https://stackoverflow.com/questions/33162272/non-exhaustive-pattern-while-iterating-matrix/33162492#33162492", "title": "Non-exhaustive pattern while iterating matrix", "body": "<p>Your recursive case covers every list with at least two arguments, so that's cool. The problem is your base case&mdash;it only covers the case of a list with exactly one element, itself the empty list.</p>\n\n<p>Add this to the very top of your file: <code>{-# OPTIONS_GHC -Wall #-}</code>. That should give you a detailed compiler warning indicating which pattern(s) is/are missing.</p>\n"}], "owner": {"reputation": 871, "user_id": 2801144, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61db655ceeced28d6a33b55e10c547e6?s=128&d=identicon&r=PG&f=1", "display_name": "Argus", "link": "https://stackoverflow.com/users/2801144/argus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 33162492, "answer_count": 1, "score": 1, "last_activity_date": 1444969044, "creation_date": 1444967427, "question_id": 33162272, "link": "https://stackoverflow.com/questions/33162272/non-exhaustive-pattern-while-iterating-matrix", "title": "Non-exhaustive pattern while iterating matrix", "body": "<p>So I'm very new to haskell, and I'm not very sure how to deal with this error when iterating over a matrix. I'm guessing there's a case I'm not considering, but I can't figure out what it is. I've got two functions, one that turns a list into a string and another that turns a matrix into a string. These are my two functions: </p>\n\n<pre><code>listToString :: [Int] -&gt; String \nlistToString [] = \"\\n\"\nlistToString (x:xs) = show x ++ \" \" ++ listToString xs \n\nmatToString :: [[Int]] -&gt; String \nmatToString [[]] = \"\"\nmatToString (y:x:xs)) = listToString y ++  matToString (x:xs)\n</code></pre>\n\n<p>listToString works fine but matToString does not. I was wondering if someone could help me out with this. I've been having a hard time understanding Haskell, since I've never programmed in a functional programming language before, or well at least not one that is purely functional. </p>\n"}, {"tags": ["haskell", "floating-point"], "comments": [{"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "edited": false, "score": 0, "creation_date": 1444962387, "post_id": 33161504, "comment_id": 54131874, "body": "Yes, the binary64 product of the binary64 number represented as <code>0.2</code> by itself is the binary64 number represented as <code>4.000000000000001e-2</code>. This <b>is</b> calculating floating-point numbers. What do you expect the result of 1 / 3 * 3 will be if Haskell does have something like BigDecimal?"}, {"owner": {"reputation": 41485, "user_id": 2521214, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nd58V.jpg?s=128&g=1", "display_name": "Spektre", "link": "https://stackoverflow.com/users/2521214/spektre"}, "edited": false, "score": 0, "creation_date": 1445252038, "post_id": 33161504, "comment_id": 54229127, "body": "the easiest thing you can do is round numbers while printing converting <code>0.00123999999???</code> to <code>0.00124</code> and comparing with difference. If you need exact form of number then use arbitrary precision string based big decimal numbers library (or write one yourself)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1444964427, "post_id": 33161583, "comment_id": 54132392, "body": "Is there a nice function somewhere for converting rationals to their closest n-digit or n-digit-after-decimal or whatever representation? Or would that have to be done by hand?"}, {"owner": {"reputation": 51, "user_id": 5430197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rPZIl.png?s=128&g=1", "display_name": "rere", "link": "https://stackoverflow.com/users/5430197/rere"}, "edited": false, "score": 0, "creation_date": 1445273821, "post_id": 33161583, "comment_id": 54244168, "body": "Is there any functions to convert RealFloat to String with n-dgit format?"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 4, "last_activity_date": 1444963111, "last_edit_date": 1495540718, "creation_date": 1444962350, "answer_id": 33161583, "question_id": 33161504, "link": "https://stackoverflow.com/questions/33161504/how-to-calculate-floating-point-numbers-in-haskell/33161583#33161583", "title": "How to calculate floating point numbers in Haskell?", "body": "<p>This is how floating point arithmetic works (in any language, not just Haskell) so you don't want floating point. See, for example, <a href=\"https://stackoverflow.com/questions/588004/is-floating-point-math-broken\">this question</a>.</p>\n\n<p>You can use <code>Rational</code> from <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Ratio.html\" rel=\"nofollow noreferrer\">Data.Ratio</a> for working with exact rational numbers:</p>\n\n<pre><code>ghci&gt; import Data.Ratio\nghci&gt; 0.2 :: Rational\n1 % 5\nghci&gt; 0.2 * 0.2 :: Rational\n1 % 25\n</code></pre>\n\n<p>If you want to convert it back to floating point (which could potentially result in floating point errors as well, due to the nature of floating point), you can use <code>fromRat</code> from <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Numeric.html\" rel=\"nofollow noreferrer\"><code>Numeric</code></a>:</p>\n\n<pre><code>ghci&gt; import Numeric\nghci&gt; fromRat ((0.2 * 0.2) :: Rational)\n4.0e-2\n</code></pre>\n\n<h2>A side note about Haskell's numeric literals</h2>\n\n<p>This isn't casting (Haskell doesn't have casting, at least not in this sense). Numeric literals are overloaded, so they can take on any type that is an instance of the <code>Num</code> type class. It isn't necessary to understand this fully right now, but it is good to know and look into at some point.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1444965427, "post_id": 33161916, "comment_id": 54132634, "body": "That&#39;s a lovely list of resources. I don&#39;t see a place it fits on SO, sadly :-/"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1444964865, "creation_date": 1444964865, "answer_id": 33161916, "question_id": 33161504, "link": "https://stackoverflow.com/questions/33161504/how-to-calculate-floating-point-numbers-in-haskell/33161916#33161916", "title": "How to calculate floating point numbers in Haskell?", "body": "<p>In addition to the <strong>Rational</strong> type, you might have a look at the <a href=\"https://hackage.haskell.org/package/numbers\" rel=\"nofollow\"><strong>numbers</strong></a> package.</p>\n\n<p>In particular, two types might be of interest:</p>\n\n<ul>\n<li>a <strong>BigFloat</strong> type - allows you to select the precision</li>\n<li>a <strong>Fixed</strong> type - allows you to select the number of decimals</li>\n<li>a <strong>CReal</strong> type for exact representations of constructible real numbers</li>\n</ul>\n\n<p>Other packages to investigate:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/FixedPoint-simple\" rel=\"nofollow\"><strong>FixedPoint-simple</strong></a></li>\n<li><a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Fixed.html\" rel=\"nofollow\"><strong>Data.Fixed</strong></a> in base</li>\n<li><a href=\"https://hackage.haskell.org/package/cyclotomic\" rel=\"nofollow\"><strong>cyclotomic</strong></a></li>\n</ul>\n"}], "owner": {"reputation": 51, "user_id": 5430197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rPZIl.png?s=128&g=1", "display_name": "rere", "link": "https://stackoverflow.com/users/5430197/rere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "closed_date": 1444965165, "answer_count": 2, "score": 0, "last_activity_date": 1445248942, "creation_date": 1444961848, "last_edit_date": 1445248942, "question_id": 33161504, "link": "https://stackoverflow.com/questions/33161504/how-to-calculate-floating-point-numbers-in-haskell", "closed_reason": "Duplicate", "title": "How to calculate floating point numbers in Haskell?", "body": "<p>I want to calculate <code>0.2 * 0.2</code> but the result would not be <code>0.04</code>.</p>\n\n<pre><code>&gt;0.2 * 0.2\n4.000000000000001e-2\n</code></pre>\n\n<p>I know this happened in any programing languages.\nI wonder what wulod be the most common way to calculate floating point numbers in Haskell?</p>\n\n<p>Like BigDecimal in Java,</p>\n\n<pre><code>BigDecimal result = new BigDecimal(\"0.2\").multiply(new BigDecimal(\"0.2\"));\ndouble value = result.doubleValue();\n</code></pre>\n\n<p>does Haskell have any functions or tricks like this? </p>\n"}]