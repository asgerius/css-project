[{"tags": ["haskell", "parsec", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1508431987, "post_id": 46821125, "comment_id": 80617685, "body": "As mentioned by @danidiaz, this is essentially using the <code>Applicative</code> and <code>Alternative</code> instances for <code>Compose Parser IO</code>. One could either use that type directly, or use it as further guidance for writing such code in larger developments."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1508372663, "last_edit_date": 1508372663, "creation_date": 1508372228, "answer_id": 46821125, "question_id": 46820379, "link": "https://stackoverflow.com/questions/46820379/how-to-use-parsers-from-aeson-with-io/46821125#46821125", "title": "How to use Parsers from Aeson with IO", "body": "<p>Well, I don't know if it's a good idea, and juggling the extra <code>IO</code> layer will certainly get frustrating as heck for larger developments, but the following type-checks:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE OverloadedStrings #-}\nimport Control.Applicative\nimport Data.Aeson\nimport System.Random\n\ndata Example = Example { a :: Int, b :: Int } deriving (Eq, Ord, Read, Show)\n\ninstance FromJSON (IO Example) where\n    parseJSON = withObject \"Example\" $ \\v -&gt; liftA2 Example\n        &lt;$&gt; ((pure &lt;$&gt; (v .: \"a\")) &lt;|&gt; pure (randomRIO (3, 4)))\n        &lt;*&gt; ((pure &lt;$&gt; (v .: \"b\")) &lt;|&gt; pure (randomRIO (5, 6)))\n</code></pre>\n\n<p>In each of the last two lines, the first <code>pure</code> is <code>Int -&gt; IO Int</code>, and the second is <code>IO Int -&gt; Parser (IO Int)</code>. In ghci:</p>\n\n<pre><code>&gt; sequence (decode \"{}\") :: IO (Maybe Example)\nJust (Example {a = 4, b = 6})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1508393567, "post_id": 46821214, "comment_id": 80594762, "body": "<code>the ParseJSON monad is not a transformer or based on IO</code>. But it&#39;s an <code>Applicative</code> though, and <code>Applicative</code>s compose. Perhaps a solution based on <code>Data.Functor.Compose IO Parser</code> could work."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1508425678, "post_id": 46821214, "comment_id": 80613706, "body": "Sure, I&#39;d love to see that answer too."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1508431886, "post_id": 46821214, "comment_id": 80617630, "body": "@danidiaz In fact in my answer I use only <code>Applicative</code> combinators, and am essentially using the <code>Compose</code> instances (but without the <code>Compose</code> newtype wrapper). But I didn&#39;t realize it until you pointed it out, so that&#39;s a nice insight and guide for writing the code in a larger development!"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1508373005, "creation_date": 1508373005, "answer_id": 46821214, "question_id": 46820379, "link": "https://stackoverflow.com/questions/46820379/how-to-use-parsers-from-aeson-with-io/46821214#46821214", "title": "How to use Parsers from Aeson with IO", "body": "<p>I don't know of a good strategy to get where you want to be since the ParseJSON monad is not a transformer or based on IO.  What you can more easily do is decode into one type then translate into the second as done in a prior question '<a href=\"https://stackoverflow.com/questions/46810998/give-a-default-value-for-fields-not-available-in-json-using-aeson\">Give a default value for fields not available in json using aeson</a>'.</p>\n\n<p>Since large structures can be cumbersome to reproduce you could make the structure parameterized and instantiate it with either <code>IO Int</code> or <code>Int</code>.  For example, let's say you wanted field <code>a</code> from the wire but <code>b</code> as random from the IO monad:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveTraversable #-}\n\nimport Data.Aeson\nimport System.Random\nimport Data.ByteString.Lazy (ByteString)\n\ndata Example' a =\n        Example { a :: Int\n                , b :: a\n                } deriving (Show,Functor,Foldable,Traversable)\n\ntype Partial = Example' (IO Int)\n\ntype Example = Example' Int\n\ninstance FromJSON Partial where\n    parseJSON (Object o) =\n        Example &lt;$&gt; o .: \"a\"\n                &lt;*&gt; pure (randomRIO (1,10))\n\nloadExample :: Partial -&gt; IO Example\nloadExample = mapM id\n\nparseExample :: ByteString -&gt; IO (Maybe Example)\nparseExample = maybe (pure Nothing) (fmap Just . loadExample) . decode\n</code></pre>\n\n<p>Notice how <code>loadExample</code> uses our <code>traverse</code> instance to execute the IO actions inside the structure.  Here is an example use:</p>\n\n<pre><code>Main&gt; parseExample \"{ \\\"a\\\" : 1111 }\"\nJust (Example {a = 1111, b = 5})\n</code></pre>\n\n<p><strong>Advanced</strong></p>\n\n<p>If you had more than one type of field for which you wanted an IO action you could either</p>\n\n<ol>\n<li><p>Make one data type for all of them.  Instead of <code>b</code> being type <code>IO Int</code> you might make it <code>IO MyComplexRecord</code>.  This is the easy solution.</p></li>\n<li><p>The more complex and fun solution is to use a higher kind type parameter.</p></li>\n</ol>\n\n<p>For option 2, consider:</p>\n\n<pre><code> data Example' f = Example { a :: Int\n                           , b :: f Int\n                           , c :: f String }\n</code></pre>\n\n<p>You could then use <code>Proxy</code> and <code>Control.Monad.Identity</code> instead of values like <code>IO Int</code> and <code>Int</code> used previously.  You'll need to write your own traversal since you can't derive <code>Traverse</code> for this class (which is what gives us the <code>mapM</code> used above).  We could make a traversal class with kind <code>(* -&gt; *) -&gt; *</code> using a few extensions (RankNTypes among them) but unless this is done often, and we get some sort of deriving support or TH, I don't think that is worthwhile.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1508376215, "post_id": 46821449, "comment_id": 80590505, "body": "re: &quot;I believe this is the more verbose implementation of @DanielWagner&#39;s solution&quot;, I think our approaches are slightly different (though both interesting); you do some <code>IO</code> to generate a parser, while I do some parsing to generate an <code>IO</code> action."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1508428060, "post_id": 46821449, "comment_id": 80615371, "body": "That&#39;s an interesting way to break it down. We have three answers that boil down to &quot;Parse and generate an IO action needed executed&quot;, &quot;Execute IO to generate a parser&quot;, and &quot;Parse to generate an object with embedded IO actions for execution&quot;."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1508375247, "creation_date": 1508375247, "answer_id": 46821449, "question_id": 46820379, "link": "https://stackoverflow.com/questions/46820379/how-to-use-parsers-from-aeson-with-io/46821449#46821449", "title": "How to use Parsers from Aeson with IO", "body": "<p>Here is another solution, it involves a bit more manual labour, but the approach is quite straightforward - generate a random <code>IO Example</code> use it to generate a random \"parser\". Decoding into JSON is done with the usual <code>decode</code> function.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Test where\n\nimport Data.Aeson\nimport Data.Aeson.Types\nimport System.Random\n\ndata Example = Example {_a :: Int, _b :: Int} deriving (Show, Ord, Eq)\n\ngetExample :: IO (Value -&gt; Maybe Example)\ngetExample = do\n ex &lt;- randomRIO (Example 1 1, Example 10 100)\n let ex' = withObject \"Example\" $ \\o -&gt;\n             do a &lt;- o .:? \"a\" .!= _a ex\n                b &lt;- o .:? \"b\" .!= _b ex\n                return $ Example a b\n return (parseMaybe ex')\n\ninstance Random Example where\n    randomRIO (low,hi) = Example &lt;$&gt; randomRIO (_a low,_a hi)\n                                 &lt;*&gt; randomRIO (_b low,_b hi)\n...\n\nmain :: IO ()\nmain = do\n    getExample' &lt;- getExample\n    let example = getExample' =&lt;&lt; decode \"{\\\"a\\\": 20}\"\n    print example\n</code></pre>\n\n<p>I am not sure but I believe this is the more verbose implementation of @DanielWagner's solution.</p>\n"}], "owner": {"reputation": 115, "user_id": 3537183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dca53f55c0774cbd11d7071ac6bc8422?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Klinkhammer", "link": "https://stackoverflow.com/users/3537183/eric-klinkhammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 455, "favorite_count": 1, "accepted_answer_id": 46821125, "answer_count": 3, "score": 4, "last_activity_date": 1508375247, "creation_date": 1508366807, "question_id": 46820379, "link": "https://stackoverflow.com/questions/46820379/how-to-use-parsers-from-aeson-with-io", "title": "How to use Parsers from Aeson with IO", "body": "<p>I have data types with many fields that, if not being manually specified by a JSON configuration file, should be randomly set. I am using Aeson to parse the config file. What is the best way to do this?</p>\n\n<p>Currently, I am setting values equal to some impossible value, and then later checking for said value to edit.</p>\n\n<pre><code>data Example = Example { a :: Int, b :: Int }\ndefault = Example 1 2\ninstance FromJSON Example where\n    parseJSON = withObject \"Example\" $ \\v -&gt; Example\n      &lt;$&gt; (v .: \"a\" &lt;|&gt; return (a default)) \n      &lt;*&gt; (v .: \"b\" &lt;|&gt; return (b default))\n\ninitExample :: Range -&gt; Example -&gt; IO Example\ninitExample range (Example x y) = do\n   a' &lt;- if x == (a default) then randomIO range else return x\n   b' &lt;- if y == (b default) then randomIO range else return y\n   return $ Example a' b'\n</code></pre>\n\n<p>What I would like is something along the lines of:</p>\n\n<pre><code>parseJSON = withObject \"Example\" $ \\v -&gt; Example\n      &lt;$&gt; (v .: \"a\" &lt;|&gt; return (randomRIO (1,10))\n</code></pre>\n\n<p>Is it possible to define Parsers in the IO Monad or thread along some random generator, ideally using Aeson?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 7, "creation_date": 1508360279, "post_id": 46819060, "comment_id": 80585579, "body": "Have you tried following the advice? :)   Add <code>{-# LANGUAGE RankNTypes #-}</code> to the top of the file."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1508362232, "post_id": 46819060, "comment_id": 80586577, "body": "For this specific case, you can simply remove <code>forall a. </code>. Enabling the <code>ScopedTypeVariables</code> also works. (There are other errors, though, like using <code>&#47;2</code> on an <code>Int</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1508421561, "creation_date": 1508421561, "answer_id": 46831708, "question_id": 46819060, "link": "https://stackoverflow.com/questions/46819060/haskell-forall-error-illegal-symbol/46831708#46831708", "title": "Haskell Forall error illegal symbol", "body": "<p>Standard Haskell doesn't support the <code>forall</code> syntax you're trying to use.  In order to use it, you need to enable a language extension, such as <code>RankNTypes</code>.  There are several ways to enable these extensions, but the most straightforward is to add a line at the top of a source file like this:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n</code></pre>\n\n<p>In GHCi at the interactive prompt, you can do:</p>\n\n<pre><code>&gt; set -XRankNTypes\n</code></pre>\n\n<p>In this case, however, I'm not sure why you've written:</p>\n\n<pre><code>complementar :: forall a. Eq a =&gt; Int -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>since it's equivalent to writing:</p>\n\n<pre><code>complementar :: Eq a =&gt; Int -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>which is standard Haskell syntax and doesn't require any extension.</p>\n\n<p>The other issue with your program is that the check for whether <code>x</code> is even or not (i.e., the <code>(x / 2) == div x 2</code> expression) won't work in Haskell.  The division operator \"<code>/</code>\" doesn't work with integers, so you'd have to convert the <code>x</code> to a floating point first.</p>\n\n<p>That would work in this case, but generally tests based on equality of floating point numbers are tricky and best avoided.  A more standard way of checking if one integer is divisible by another is to see if the remainder after integer division is zero, which you can do using the <code>rem</code> function:</p>\n\n<pre><code>&gt; 10 `rem` 2 == 0\nTrue\n&gt; 7 `rem` 2 == 0\nFalse\n&gt;\n</code></pre>\n\n<p>(If you have to deal with negative numbers, you might need to look into the difference between <code>rem</code> and <code>mod</code>, though.)</p>\n\n<p>In this particular case, there's a library function you can use:</p>\n\n<pre><code>&gt; even 10\nTrue\n&gt; even 7\nFalse\n&gt;\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 7386052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0899ad471e46cce7f5ebc7af5d715175?s=128&d=identicon&r=PG&f=1", "display_name": "PedroCastro", "link": "https://stackoverflow.com/users/7386052/pedrocastro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 775, "favorite_count": 0, "accepted_answer_id": 46831708, "answer_count": 1, "score": 2, "last_activity_date": 1512803099, "creation_date": 1508360014, "last_edit_date": 1512803099, "question_id": 46819060, "link": "https://stackoverflow.com/questions/46819060/haskell-forall-error-illegal-symbol", "title": "Haskell Forall error illegal symbol", "body": "<p>I have been getting this error in my program:</p>\n\n<pre><code>Illegal symbol '.' in type\n    Perhaps you intended to use RankNTypes or a similar language\n    extension to enable explicit-forall syntax: forall &lt;tvs&gt;. &lt;type&gt;\n</code></pre>\n\n<p>My program is:</p>\n\n<pre><code>ex31 :: Eq a =&gt; [a] -&gt; [a]\nex31 [] = []\nex31 (h:t) = complementar 0 (h:t)\n\ncomplementar :: forall a. Eq a =&gt; Int -&gt; [a] -&gt; [a]\ncomplementar _ [] = []\ncomplementar x (h:t) = if (x / 2) == div x 2\n                       then complementar (x+1) t\n                       else h : complementar (x+1) t\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1508360338, "post_id": 46819051, "comment_id": 80585605, "body": "Why would that make a difference? If you have <code>[1,2]</code> and <code>3</code>, then you can not simply use <code>split</code> to obtain 3 tuples..."}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 1, "creation_date": 1508360638, "post_id": 46819051, "comment_id": 80585750, "body": "I assume the two double are the lower/upper bound. Then it is possible to compute <code>n</code> equal output ranges. But w/o further information one can only assume what the actual question is."}, {"owner": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508360828, "post_id": 46819051, "comment_id": 80585836, "body": "yes, let&#39;s say I get a range of a, b, and n = 4, I want that in the end to yield 4 tuples containing each interval"}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508361761, "post_id": 46819448, "comment_id": 80586345, "body": "thanks ! Like you said :Build a list of length n containing the values l+0*w, l+1*w, l+2*w , how do i make the condition to stop on this case ?"}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "reply_to_user": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508362188, "post_id": 46819448, "comment_id": 80586552, "body": "Write a recursive function that has an integer argument that starts with <code>n</code> and gets decremented in each recursion step. If 0 is reached stop, otherwise do your work and continue the recursion."}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 1, "last_activity_date": 1508361654, "creation_date": 1508361654, "answer_id": 46819448, "question_id": 46819051, "link": "https://stackoverflow.com/questions/46819051/split-a-tuple-into-n-parts/46819448#46819448", "title": "Split a tuple into n parts", "body": "<p>A rough sketch, probably not the most elegant solution:</p>\n\n<ul>\n<li>Take the two input doubles (I call them <code>l</code> and <code>u</code>) and compute the width of the input range/interval.</li>\n<li>You want to compute <code>n</code> output ranges of equal width <code>w</code>. Compute this <code>w</code> by dividing the input width by <code>n</code>.</li>\n<li>Build a list of length <code>n</code> containing the values <code>l+0*w</code>, <code>l+1*w</code>, <code>l+2*w</code>, ...</li>\n<li>Build the list of output tuples by combining the first two items in the list into a tuple. Drop one element of the list. Continue until only one element remains.</li>\n<li>Try to catch all possible errors</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508420501, "post_id": 46822282, "comment_id": 80610011, "body": "thanks ! Just a question, and if instead of giving : Int -&gt; (Double,Double) -&gt; [(Double,Double)] , (Double,Double) -&gt; Int -&gt; (Double,Double) ?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508420848, "post_id": 46822282, "comment_id": 80610287, "body": "I&#39;m not sure what a function with this alternative signature (returning only one tuple) is supposed to do.  Can you given an example of how it would be called and what it should return?"}, {"owner": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508421100, "post_id": 46822282, "comment_id": 80610474, "body": "lets say : intervls :: (Double,double)  - &gt; Int -&gt; [(Double,Double)]"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508421717, "post_id": 46822282, "comment_id": 80610948, "body": "In that case, all you need to do is write <code>intervals (a,b) n</code> instead of <code>intervals n (a,b)</code> at the beginning of the definition."}, {"owner": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508421832, "post_id": 46822282, "comment_id": 80611037, "body": "I know,but when i do it,in the solution that you gave me,it does not work."}, {"owner": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "edited": false, "score": 0, "creation_date": 1508421971, "post_id": 46822282, "comment_id": 80611129, "body": "At the begginning i was using the last exemple you gave, with zip,but it was not nothing,thanks again for this."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1508382541, "creation_date": 1508382541, "answer_id": 46822282, "question_id": 46819051, "link": "https://stackoverflow.com/questions/46819051/split-a-tuple-into-n-parts/46822282#46822282", "title": "Split a tuple into n parts", "body": "<p>This is similar to @mschmidt's answer, but I think a list comprehension is probably clearest:</p>\n\n<pre><code>intervals :: Int -&gt; (Double,Double) -&gt; [(Double,Double)]\nintervals n (a,b) =\n  let n' = fromIntegral n\n      d = (b - a) / n'\n  in [(a + i*d, a + (i+1)*d) | i &lt;- [0..n'-1]]\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; intervals 4 (1,10)\n[(1.0,3.25),(3.25,5.5),(5.5,7.75),(7.75,10.0)]\n&gt; \n</code></pre>\n\n<p>If the duplicate calculation of the endpoint offends you, you could write:</p>\n\n<pre><code>intervals' :: Int -&gt; (Double,Double) -&gt; [(Double,Double)]\nintervals' n (a,b) =\n  let n' = fromIntegral n\n      d = (b - a) / n'\n      x = [a + i*d | i &lt;- [0..n']]\n  in zip x (tail x)\n</code></pre>\n\n<p>Note that <code>zip x (tail x)</code> is a pretty standard way to get tuples of consecutive pairs of a list:</p>\n\n<pre><code>&gt; let x = [1,2,3,4] in zip x (tail x)\n[(1,2),(2,3),(3,4)]\n&gt;\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 8077394, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e547ed41ce104877f55cfae87619f5af?s=128&d=identicon&r=PG&f=1", "display_name": "JohnTeiMir", "link": "https://stackoverflow.com/users/8077394/johnteimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 0, "accepted_answer_id": 46822282, "answer_count": 2, "score": -1, "last_activity_date": 1508382541, "creation_date": 1508359962, "question_id": 46819051, "link": "https://stackoverflow.com/questions/46819051/split-a-tuple-into-n-parts", "title": "Split a tuple into n parts", "body": "<p>I am trying to create a function that receives a range of doubles (Double, Double) and an n (Int), where I divide this interval into n equal parts. I know that if it was a list, I did a Split in the list, but being in tuples and getting Doubles, I'm not sure what to do.\nThank you for any help</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1508354273, "post_id": 46817575, "comment_id": 80582579, "body": "The <code>where</code> line should be indented as far as the <code>|</code> block above. I would suggest starting a newline before the first <code>|</code> to avoid that huge block of whitespace."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 2, "creation_date": 1508354450, "post_id": 46817575, "comment_id": 80582680, "body": "@cdk That is not the cause of the problem: guards do not participate in layout. (I tested this in a file myself: having a <code>where</code> block indented more than a function definition but less than its guards is perfectly fine.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1508354499, "post_id": 46817575, "comment_id": 80582704, "body": "Please copy and paste the source code itself; an image does not allow us to reproduce your error ourselves and test our proposed fixes. Also include enough code that we can load it into ghci ourselves, and test yourself that the code you post gives the error you claim. SO also has some <a href=\"https://stackoverflow.com/help/mcve\">hints on developing an MVCE</a>."}, {"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 0, "creation_date": 1508355404, "post_id": 46817575, "comment_id": 80583139, "body": "Why are there votes to close this? This <i>is</i> a perfectly valid question."}, {"owner": {"reputation": 49, "user_id": 7759374, "user_type": "registered", "profile_image": "https://graph.facebook.com/587280678132828/picture?type=large", "display_name": "Jo&#227;o Pimentel", "link": "https://stackoverflow.com/users/7759374/jo%c3%a3o-pimentel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1508355496, "post_id": 46817575, "comment_id": 80583181, "body": "@DanielWagner Done it. btw I&#39;m sorry, i&#39;m new to stackOverflow tbh"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 0, "creation_date": 1508355610, "post_id": 46817575, "comment_id": 80583238, "body": "@vikingsteve I am the lone close vote; and I wrote a comment detailing my reasoning. The question has changed since then."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1508359302, "post_id": 46817575, "comment_id": 80585116, "body": "I have voted to close because, as state in the vote, the example does not show the problem, instead having indentation issues with declarations and missing types."}, {"owner": {"reputation": 549, "user_id": 1524453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ed2un.png?s=128&g=1", "display_name": "Federico Sawady", "link": "https://stackoverflow.com/users/1524453/federico-sawady"}, "edited": false, "score": 0, "creation_date": 1511294886, "post_id": 46817575, "comment_id": 81797946, "body": "Check this <a href=\"https://stackoverflow.com/questions/47354723/parse-errors-when-using-partial-functions-in-where-statments-haskell/47355251#47355251\">answer</a>. It&#39;s about white space and tabs relation."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1508355717, "creation_date": 1508355717, "answer_id": 46817999, "question_id": 46817575, "link": "https://stackoverflow.com/questions/46817575/haskell-parse-error-on-where/46817999#46817999", "title": "Haskell -&gt; Parse error on &#39;where&#39;", "body": "<p>The only parse error I see is that <code>posi</code> and the type declaration for <code>tipo</code> are indented more than anything else. Once I fix that, this file parses just fine (though there are other errors).</p>\n"}], "owner": {"reputation": 49, "user_id": 7759374, "user_type": "registered", "profile_image": "https://graph.facebook.com/587280678132828/picture?type=large", "display_name": "Jo&#227;o Pimentel", "link": "https://stackoverflow.com/users/7759374/jo%c3%a3o-pimentel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1508355717, "creation_date": 1508353989, "last_edit_date": 1508355184, "question_id": 46817575, "link": "https://stackoverflow.com/questions/46817575/haskell-parse-error-on-where", "title": "Haskell -&gt; Parse error on &#39;where&#39;", "body": "<p>Can anyone help me understand why I'm getting this error?\ntar2.hs:40:41: error: parse error on input \u2018c\u2019</p>\n\n<p>I've tried to move the where but i get the same error...</p>\n\n<p>The function 'avancar' receives a position and an orientation and gives the new position, according to that same orientation</p>\n\n<pre><code>type Caminho = [Passo]\ndata Passo \n  = Avanca\n  | Sobe\n  | Desce \n  | CurvaEsq\n  | CurvaDir\n  deriving (Eq,Read,Show)\n\ndata Mapa = Mapa (Posicao,Orientacao) Tabuleiro\n  deriving (Eq,Read,Show)\n\ntype Tabuleiro = [[Peca]]\n\ndata Peca = Peca Tipo Altura\n  deriving (Eq,Read,Show) \n\ndata Tipo = Rampa Orientacao | Curva Orientacao | Recta | Lava\n  deriving (Eq,Read,Show)\n\ntype Posicao  = (Int,Int)\ntype Dimensao = (Int,Int)\ntype Altura = Int \n\n\n    posi :: Tabuleiro -&gt; Posicao -&gt; Orientacao -&gt; Peca\n    posi t (x,y) orientacao = (t !! y) !! x \n\n    tipo :: Peca -&gt; Tipo\n\ntipo (Peca a h) = a\n\n\nnew_pos :: Mapa -&gt; Mapa\nnew_pos (Mapa ((x,y), orientacao) []) = Mapa ((x,y),orientacao) []\nnew_pos (Mapa ((x,y), orientacao) (h:t)) | e == Recta = Mapa (b, orientacao) (h:t)\n                                         | e == Curva Norte &amp;&amp; orientacao == Norte = Mapa (d, Este) (h:t)\n                                         | e == Curva Norte &amp;&amp; orientacao == Oeste = Mapa (c, Sul) (h:t)\n                                         | e == Curva Sul &amp;&amp; orientacao == Sul = Mapa (d, Oeste) (h:t)\n                                         | e == Curva Sul &amp;&amp; orientacao == Este = Mapa (c, Norte) (h:t)\n                                         | e == Curva Este &amp;&amp; orientacao == Este = Mapa (d, Sul) (h:t)\n                                         | e == Curva Este &amp;&amp; orientacao == Norte = Mapa (c, Oeste) (h:t)\n                                         | e == Curva Oeste &amp;&amp; orientacao == Oeste = Mapa (d, Norte) (h:t)\n                                         | e == Curva Oeste &amp;&amp; orientacao == Sul = Mapa (c, Este) (h:t)\n                                         | e == Rampa Norte &amp;&amp; orientacao == Norte = Mapa (b, orientacao) (h:t)\n                                         | e == Rampa Sul &amp;&amp; orientacao == Norte = Mapa (b, orientacao) (h:t)\n                                         | e == Rampa Este &amp;&amp; orientacao == Este = Mapa (b, orientacao) (h:t)\n                                         | e == Rampa Oeste &amp;&amp; orientacao == Este = Mapa (b, orientacao) (h:t)\n                                         | e == Rampa Sul &amp;&amp; orientacao == Sul = Mapa (b, orientacao) (h:t)\n                                         | e == Rampa Norte &amp;&amp; orientacao == Sul = Mapa (b, orientacao) (h:t)\n                                         | e == Rampa Oeste &amp;&amp; orientacao == Oeste = Mapa (b, orientacao) (h:t)\n                                         | e == Rampa Este &amp;&amp; orientacao == Oeste = Mapa (b, orientacao) (h:t) \n                                       where \n                                        b = avancar (x,y) orientacao\n                                        c = avancar (x,y) (muda_esq orientacao)\n                                        d = avancar (x,y) (muda_dir orientacao)\n                                        e = tipo (posi (h:t) (x,y) orientacao)\n\navancar :: Posicao -&gt; Orientacao -&gt; Posicao\navancar (x,y) orientacao = if (orientacao == Norte) then (x,y - 1)\n    else if (orientacao == Sul) then (x,y + 1)\n        else if (orientacao == Este) then (x + 1,y)\n            else (x - 1,y) \n</code></pre>\n"}, {"tags": ["haskell", "intellij-idea", "mouse", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "edited": false, "score": 0, "creation_date": 1508405330, "post_id": 46817851, "comment_id": 80600926, "body": "Thanks, will try that. I saw <code>liftX</code>, but did not manage to make proper use of it with <code>UpdatePointer</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "edited": false, "score": 0, "creation_date": 1508431817, "post_id": 46817851, "comment_id": 80617596, "body": "@Dmitriusan Feel free to open a fresh question with the details of what you tried and what went wrong."}, {"owner": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "edited": false, "score": 0, "creation_date": 1508954266, "post_id": 46817851, "comment_id": 80825317, "body": "looks like the code you proposed compiles, but <code>banish UpperLeft</code> does not get executed (cursor does not move) when manage hook is triggered. Do you have any idea of what may be wrong, or I should open a new question?"}, {"owner": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "edited": false, "score": 0, "creation_date": 1508954638, "post_id": 46817851, "comment_id": 80825514, "body": "here are different variants of what I tried <a href=\"https://pastebin.com/CNvM0Hb2\" rel=\"nofollow noreferrer\">pastebin.com/CNvM0Hb2</a>"}, {"owner": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "edited": false, "score": 0, "creation_date": 1509016203, "post_id": 46817851, "comment_id": 80852423, "body": "Nevermind, I found a related discussion of Idea settings to accomplish that another way"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1508355136, "creation_date": 1508355136, "answer_id": 46817851, "question_id": 46816620, "link": "https://stackoverflow.com/questions/46816620/xmonad-how-do-i-move-mouse-pointer-as-part-of-managehook/46817851#46817851", "title": "Xmonad - How do I move mouse pointer as part of ManageHook?", "body": "<p>You can use <code>liftX</code> to turn an <code>X</code> action into a <code>Query</code> action. You probably want to use <code>XMonad.Actions.Warp</code> instead of <code>X.A.UpdatePointer</code> instead, though; the latter looks like it might do a bit too much magic to sensibly fire during a manage hook. Anyway you should be able to try that out yourself once you see how to lift <code>X</code> actions.</p>\n\n<p>So, for <code>banish</code>, you could use <code>liftX</code> like this:</p>\n\n<pre><code>... --&gt; (liftX (banish UpperLeft) &gt;&gt; doIgnore)\n</code></pre>\n\n<p>Other <code>X</code> actions can be lifted and sequenced with <code>doIgnore</code> similarly.</p>\n"}], "owner": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 0, "accepted_answer_id": 46817851, "answer_count": 1, "score": 1, "last_activity_date": 1509016386, "creation_date": 1508350353, "last_edit_date": 1509016386, "question_id": 46816620, "link": "https://stackoverflow.com/questions/46816620/xmonad-how-do-i-move-mouse-pointer-as-part-of-managehook", "title": "Xmonad - How do I move mouse pointer as part of ManageHook?", "body": "<p>Given this sample <code>myManageHook</code>. How can I call <a href=\"https://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Actions-UpdatePointer.html\" rel=\"nofollow noreferrer\">UpdatePointer</a> after <code>doIgnore</code>? All my tries resulted in type incompatibilities.</p>\n\n<pre><code>myManageHook = composeAll . concat $\n    [\n      -- IntelliJ idea Tweaks\n      -- Manage idea completion window\n      , [ appName =? \"sun-awt-X11-XWindowPeer\" &lt;&amp;&amp;&gt; className =? \"jetbrains-idea\" --&gt; doIgnore ]\n      , [ (className ~=? \"jetbrains-\") &lt;&amp;&amp;&gt; (title ~=? \"Changes in\") --&gt;  unfloat ]\n    ]\n    where\n      unfloat = ask &gt;&gt;= doF . W.sink\n</code></pre>\n\n<p>My problem is that IntelliJ Idea popup window loses focus during typing if my mouse pointer is located over suggestions dropbox. That's why I'm trying to move the mouse to an upper part of the screen when this window appears.</p>\n\n<p><a href=\"https://i.stack.imgur.com/vjzfn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vjzfn.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>UPD</strong> Found related thread with workarounds for Idea <a href=\"https://youtrack.jetbrains.com/issue/IDEA-112015#comment=27-2362253\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/IDEA-112015#comment=27-2362253</a></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8796884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f88ef73271b1363103b85defb8d40c69?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Costa", "link": "https://stackoverflow.com/users/8796884/pedro-costa"}, "edited": false, "score": 0, "creation_date": 1508453548, "post_id": 46815536, "comment_id": 80627855, "body": "That&#39;s the change to just fix it I needed, thanks, as I said above, still a beginner, gotta get used to the prelude and the package modules funcions!"}], "tags": [], "owner": {"reputation": 81067, "user_id": 4435, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/cd52560a83dfb236fe2d37773383cab5?s=128&d=identicon&r=PG&f=1", "display_name": "Jimmy", "link": "https://stackoverflow.com/users/4435/jimmy"}, "is_accepted": false, "score": 2, "last_activity_date": 1508346482, "last_edit_date": 1508346482, "creation_date": 1508346146, "answer_id": 46815536, "question_id": 46815316, "link": "https://stackoverflow.com/questions/46815316/error-on-the-resulting-list-of-my-elemindices-function/46815536#46815536", "title": "Error on the resulting list of my elemIndices function", "body": "<p>You're reversing the list every time you find an element. The minimal change here would be to use <code>myElemIndices x (init l) ++ [n]</code> instead of <code>myReverse (n : myelemIndices x (init l))</code></p>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 8796884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f88ef73271b1363103b85defb8d40c69?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Costa", "link": "https://stackoverflow.com/users/8796884/pedro-costa"}, "edited": false, "score": 0, "creation_date": 1508453500, "post_id": 46817090, "comment_id": 80627839, "body": "Thanks a lot for the perfect answer. Although I&#39;m only starting in haskell, it is 100% understandable and indeed a very interesting (and optimal) way to do it, will definitely read it a few times and understand how it goes."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1508352086, "creation_date": 1508352086, "answer_id": 46817090, "question_id": 46815316, "link": "https://stackoverflow.com/questions/46815316/error-on-the-resulting-list-of-my-elemindices-function/46817090#46817090", "title": "Error on the resulting list of my elemIndices function", "body": "<p>A first anti-pattern in your code is that you use <code>length</code>. <code>length</code> will usually run in <em>O(n)</em> (with <em>n</em> the number of elements in the list), but furthermore it is troublesome since the list can have infinite length. In that case <code>length</code> will never terminate. In functional programming it is sometimes seen as a sign that something is probably not right.</p>\n\n<p>So the first question is: do we need <code>length</code>. What your code needs to do is return the indices. But say you for instance need to know on what pages in a phone book the name \"John\" is listed, then you do not need to know in advance how many pages the phone book has: you can simply take a look at the first page. In case it has a person with first name John, then you say that is on page 1, and regardless of that, you move further.</p>\n\n<p>We can use the same approach here. The only thing we need is a <em>parameter</em> that keeps track of the page we are currently looking at. We can introduce this parameter by defining a <em>new</em> function that will do most of the work. So:</p>\n\n<pre><code>myElemIndices :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\nmyElemIndices x l = go 0 l\n    where go = ...\n</code></pre>\n\n<p>So we defined a function <code>go</code>, and the first parameter will keep track of the page number. We will need to update that number in case we do recursion. But now of course we still need to define the <code>go</code> function.</p>\n\n<p>The base case is easy: in case we reached the end of the list (phone book), we can say we will not find any occurences anymore. So we can write:</p>\n\n<pre><code>go _ [] = []\n</code></pre>\n\n<p>This thus means that, regardless of the page number (<code>_</code>), in case there are no pages anymore (<code>[]</code>), we return an empty list as match <code>[]</code>.</p>\n\n<p>In case we did not reach the end of the phone book, we can fetch the head <code>h</code>, and the tail <code>t</code>. We will have to check if the head <code>h</code> matches with the queried element <code>x</code>. In case it does, we return the page number, otherwise we don not. Regardless of that, we keep searching for more pages. So we can write:</p>\n\n<pre><code>go i (h:t) | x == h = i : &lt;next-matches&gt;\n           | otherwise = &lt;next-matches&gt;\n</code></pre>\n\n<p>the <code>&lt;next-matches&gt;</code> simply is a recursive call where we update the page number (<code>i+1</code>), and we continue with the tail of the list, so:</p>\n\n<pre><code>go i (h:t) | x == h = i : tl\n           | otherwise = tl\n    where tl = go (i+1) t\n</code></pre>\n\n<p>Now we can put that all together into:</p>\n\n<pre><code>myElemIndices :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\nmyElemIndices x l = go 0 l\n    where go _ [] = []\n          go i (h:t) | x == h = i : tl\n                     | otherwise = tl\n              where tl = go (i+1) t\n</code></pre>\n\n<p>We can still improve the code a bit. First of all, we do not have to write:</p>\n\n<pre><code>myElemIndices x l = go 0 l\n</code></pre>\n\n<p>Notice that both the head and the body end with <code>l</code>. We can omit this, and turn it into:</p>\n\n<pre><code>myElemIndices x = go 0\n</code></pre>\n\n<p>Furthermore we do not need the result to be <code>Int</code>s as well. As long as these are <code>Num</code>s, we are fine. So we can generalize this to:</p>\n\n<pre><code>myElemIndices :: (Eq a, Num n) =&gt; a -&gt; [a] -&gt; [n]\nmyElemIndices x l = go 0 l\n    where go _ [] = []\n          go i (h:t) | x == h = i : tl\n                     | otherwise = tl\n              where tl = go (i+1) t\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8796884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f88ef73271b1363103b85defb8d40c69?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Costa", "link": "https://stackoverflow.com/users/8796884/pedro-costa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1508352086, "creation_date": 1508345374, "question_id": 46815316, "link": "https://stackoverflow.com/questions/46815316/error-on-the-resulting-list-of-my-elemindices-function", "title": "Error on the resulting list of my elemIndices function", "body": "<p>The function actually works but the list it returns, if the first element is equal to x, won't be in the correct order.</p>\n\n<p>The function:</p>\n\n<pre><code> myelemIndices :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\n myelemIndices x [] = [] \n myelemIndices x l =  if posic n l == x \n                         then myReverse (n : myelemIndices x (init l)) \n                             else myelemIndices x (init l)\n         where n = length l - 1\n</code></pre>\n\n<p>Will return something like: </p>\n\n<pre><code>myelemIndices 1 [1,2,1,2,1]\n[2,0,4]\n</code></pre>\n\n<p>Posic funtion is equal to :</p>\n\n<pre><code>posic :: Int -&gt; [a] -&gt; a\nposic 0 (h:t) = h\nposic x (a:b) = posic (x-1) b \n</code></pre>\n\n<p>And myReverse does exactly the same as reverse. I'm not looking for a different funtion that works, just a correction on mine. Thanks in advance!</p>\n"}, {"tags": ["haskell", "list-comprehension", "idioms"], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1508416166, "post_id": 46814878, "comment_id": 80607049, "body": "And <code>sequence (replicate 4 die)</code> is <code>replicateM 4 die</code>"}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 11, "last_activity_date": 1508416126, "last_edit_date": 1508416126, "creation_date": 1508343861, "answer_id": 46814878, "question_id": 46814606, "link": "https://stackoverflow.com/questions/46814606/idiomatic-way-to-have-many-of-the-same-generators-in-a-list-comprehension/46814878#46814878", "title": "Idiomatic way to have many of the same generators in a list comprehension", "body": "<p>If your concern is the <code>[1..6]</code> repetition (the ability for the range to vary independently), you could use:</p>\n\n<pre><code>let die = [1..6] in [ (d1,d2,d3,d4) | d1 &lt;- die, d2 &lt;- die\n                                    , d3 &lt;- die, d4 &lt;- die\n                                    , (d1 + d2 + d3 + d4) == 10 ]\n</code></pre>\n\n<p>Overall, to remove the explicit die naming, while this isn't exactly the same since it will be lists instead of tuples:</p>\n\n<pre><code>let die = [1..6] in [dice | dice &lt;- sequence (replicate 4 die), sum dice == 10]\n</code></pre>\n\n<p>To recover the tuples you could pattern match, but that might introduce difficult to trace bugs if the input expression changes as pattern match failure will simply exclude the element:</p>\n\n<pre><code>let die = [1..6] in\n  [ (d1,d2,d3,d4) | dice@[d1,d2,d3,d4] &lt;- sequence (replicate 4 die)\n                  , sum dice == 10 ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 9, "last_activity_date": 1508343883, "creation_date": 1508343883, "answer_id": 46814884, "question_id": 46814606, "link": "https://stackoverflow.com/questions/46814606/idiomatic-way-to-have-many-of-the-same-generators-in-a-list-comprehension/46814884#46814884", "title": "Idiomatic way to have many of the same generators in a list comprehension", "body": "<p>If you want to stick to <code>4-Tuples</code>, i.e. <code>(1,1,3,5)</code>, this is not really elegant, but if you are willing to use lists instead you can manage quite elegantly</p>\n\n<pre><code>import Control.Monad\nlistSum10 = filter ((==10) . sum) $ replicateM 4 [1..6]\n          = [dice | dice &lt;- replicateM 4 [1..6], sum dice == 10]\n</code></pre>\n\n<p>or using <code>do</code>-notation</p>\n\n<pre><code>listSum10 = do x &lt;- replicateM 4 [1..6]\n               guard $ sum x == 10\n               return x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1508349678, "post_id": 46815866, "comment_id": 80580087, "body": "So, is this approach, like, more efficient... or just more difficult to understand?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1508352206, "post_id": 46815866, "comment_id": 80581456, "body": "It might work, but I really don&#39;t think there is anything idiomatic about this."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1508508762, "post_id": 46815866, "comment_id": 80649391, "body": "the above comments refer to an earlier version of this post which was since re-worked, making it much clearer IMO. moreover, another, <i>idiomatic</i> code was added after <i>that</i>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1508772712, "post_id": 46815866, "comment_id": 80733462, "body": "I liked this approach. At the meantime I would like to know your opinion on my solution below. Wouldn&#39;t it be reasonable and very efficient to use an n-ary tree..?"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1508773858, "last_edit_date": 1508773858, "creation_date": 1508347423, "answer_id": 46815866, "question_id": 46814606, "link": "https://stackoverflow.com/questions/46814606/idiomatic-way-to-have-many-of-the-same-generators-in-a-list-comprehension/46815866#46815866", "title": "Idiomatic way to have many of the same generators in a list comprehension", "body": "<p><em>edit2:</em> The <em>idiomatic</em> way to constrain the search while it is being performed is to test early, -- as early as possible, -- in order to reduce the search space as much as possible:</p>\n\n<pre><code>  let die = [1..6] in [ (d1,d2,d3,d4) | d1 &lt;- die, d2 &lt;- die, \n                         s2 &lt;- [d1 + d2], s2 &lt;= 8, d3 &lt;- die, \n                         s3 &lt;- [s2 + d3], s3 &lt;= 9, s3 &gt;= 4, d4 &lt;- [10 - s3]]\n</code></pre>\n\n<hr>\n\n<p>The following is a different approach to this problem.</p>\n\n<p>The idea here is to create some kind of network of data processors and multipliers to achieve the goal, taking opportunities to improve efficiency as well. Using duplication of data to avoid the duplication of effort, we arrange for a <em>logarithmic</em> height of the processors chain / data-paths graph, instead of a <em>linear</em> height.</p>\n\n<pre><code>import qualified Data.List.Ordered as O          -- from the data-ordlist package\nimport Data.Ord \n\nlim = 10                                                       -- the target score\n\n(\u2297) :: [(Int, a)] -&gt; [(Int, b)] -&gt; [(Int, (a, b))]            -- cross-product in\nxs \u2297 ys = takeWhile ((&lt;= lim).fst) $                          -- ascending order:\n            O.foldt' (O.mergeBy $ comparing fst) []            --   merge all via a\n              [ [(p+q, (a,b)) | (q,b) &lt;- ys] | (p,a) &lt;- xs]    --   balanced tree\n                                       -- combine the points while tracking the score\ng2 ys = ys \u2297 ys                -- the doubling combinator\nys = [ (x,x) | x &lt;- [1..6]]     -- six sides to a die\n\nr2 = g2 ys           -- results from rolling the dice twice,\nr3 = ys \u2297 r2        -- three times, \nr4 = g2 r2           -- 4,      /less efficiently: (ys \u2297 (ys \u2297 (ys \u2297 ys)))/\nr5 = ys \u2297 r4        -- 5,\nr6 = g2 r3           -- 6       /less efficiently: (ys \u2297 (ys \u2297 ... (ys \u2297 ys) ...))/\n\nfoo rn = map snd $ dropWhile ((&lt; lim).fst) rn\n</code></pre>\n\n<p>To make a proper function out of all these bits and pieces, what's left is to figure out the general way of creating the <code>rn</code> out of <code>n</code> -- by using its binary representation, or by repeated halving or something.</p>\n\n<p>For now,</p>\n\n<blockquote>\n  <p>~> foo r2 <br />\n  [(4,6),(5,5),(6,4)] <br />\n  <br />\n  ~> take 10 $ foo r4 <br />\n  [((1,1),(2,6)),((1,1),(3,5)),((1,1),(4,4)),((1,1),(5,3)),((1,1),(6,2)),((1,2),(1\n  ,6)),((1,2),(2,5)),((1,2),(3,4)),((1,2),(4,3)),((1,2),(5,2))] <br />\n   <br />\n  ~> take 10 $ foo r6 <br />\n  [((1,(1,1)),(1,(1,5))),((1,(1,1)),(1,(2,4))),((1,(1,1)),(1,(3,3))),((1,(1,1)),(1\n  ,(4,2))),((1,(1,1)),(1,(5,1))),((1,(1,1)),(2,(1,4))),((1,(1,1)),(2,(2,3))),((1,(\n  1,1)),(2,(3,2))),((1,(1,1)),(2,(4,1))),((1,(1,1)),(3,(1,3)))]</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1508778600, "post_id": 46893039, "comment_id": 80736877, "body": "great idea! <i>&quot;roll n dice for m times&quot;</i> not clear what you mean. We roll 1 dice n times, yes? <code>rollDices (0,0,0) (n+1) n</code> should be <code>[]</code> but isn&#39;t. Cheers!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1508837731, "post_id": 46893039, "comment_id": 80760649, "body": "of course the tree itself is a minimal representation of the solution, but after we trace it to present the results to the user it becomes <i>the same</i> amount of work overall <i>as</i> with the list comprehension, when more tests are injected between the stages comparable to what I have with the <code>s3</code> tests."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1508839558, "post_id": 46893039, "comment_id": 80761948, "body": "@Will Ness First of all thanks for the editing result to show the list interpretation. Yet as it also shows that the above solution is (was) wrong. (Where is [1,1,2,6]) This is due to the wrong calculation of the bottom limit <code>bl</code> value. I believe i have now corrected it. As per your comment though... may be we don&#39;t ever have to present the result to the user in a list form. The Data.Tree package has beautiful 2D tree presentations."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1508841471, "post_id": 46893039, "comment_id": 80763256, "body": "yes, agree, just wanted to point that fact out. looks like the total number of results is more than are held in the tree by a factor of about <i>0.5n</i> where <i>n</i> is the number of dice rolls. So, twice more for 4 rolls; 3x for 6 rolls, etc. But OTOH this means that the tree must be held in memory in full, while the lists can be fully ephemeral, garbage collected as they are produced (keeping only <i>n-1</i> values in memory at each point in time). So if we do anything with the results other than printing them, the tree is better. Otherwise, the two are equivalent."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1508841833, "post_id": 46893039, "comment_id": 80763492, "body": "@Will Ness Have you taken into account that this tree has no redundant data so no need to filter out anything? I guess you compare this with a similar list with no redundant data. Tree should represent the whole possibilities in a much perfectly accessible fashion too. Say if you need 4 random dice to sum to 10 it&#39;s just a walk of 4 steps in this data structure. This becomes more efficient when the number of the dice is more. <i>the total number of results is more than are held in the tree by a factor of about 0.5n where n is the number of dice rolls</i> Hmm.. why?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1508848112, "post_id": 46893039, "comment_id": 80767712, "body": "A balanced, fully populated binary tree <i>n</i> levels deep has <i>k=2^(n-1)</i> bottom nodes and <i>2^n - 1 ~= 2k</i> nodes overall. If we print the <i>k</i> paths from the top to each bottom node we&#39;ve printed <i>nk</i> numbers. Yes, this ignores all the skipped over numbers, but the more values are skipped, the less populated is the tree, and the less savings there are. To print the tree&#39;s paths we need to hold the whole tree in memory. For a list comprhns to print these paths (with the appropriate tests/constraints between the stages) it only needs to keep in memory the values of <i>n-1</i> nodes on the current path."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1508839790, "last_edit_date": 1508839790, "creation_date": 1508772358, "answer_id": 46893039, "question_id": 46814606, "link": "https://stackoverflow.com/questions/46814606/idiomatic-way-to-have-many-of-the-same-generators-in-a-list-comprehension/46893039#46893039", "title": "Idiomatic way to have many of the same generators in a list comprehension", "body": "<p>I believe that in Haskell, an <em>idiomatic</em> way could be achieved by finding the most suitable data type for this dice rolling process.</p>\n\n<p>So what is it..? we will roll <code>n</code> dice for <code>m</code> times. This algorithm cries for a rose tree (N-ary tree) data type. Such as</p>\n\n<pre><code>data Rolls = Dice :&lt; [Rolls] deriving Show\n</code></pre>\n\n<p>Well you already have this in <code>Data.Tree</code> package but for the sake of expressing the logic in simpler terms i will try to use the above data very simplified N-ary tree type. It's trivial to implement this with standard Data.Tree package by unfolding.</p>\n\n<p>Also this is very efficient since we eliminate the impossible routes before they happen. So no inefficient combinatorics and filtering here.</p>\n\n<pre><code>type Count = Int\ntype Total = Int\ntype Value = Int\ntype Dice  = (Count, Total, Value)\ndata Rolls = Dice :&lt; [Rolls] deriving Show\n\nrollDices :: Dice -&gt; Int -&gt; Int -&gt; Rolls\nrollDices (c,t,v) tc tt | c &lt;= tc-2 = let bl = (\\x -&gt; if x &lt; 1 then 1 else x) ((tt-t)-(tc-c-1)*6)  -- bottom limit\n                                          tl = (tt-t)-(tc-c)+1                                     -- top limit\n                                          bs = if bl &lt;= 6 then if tl &lt;= 6 then [bl..tl]            -- branches\n                                                                          else [bl..6]\n                                                          else []\n                                      in  (c,t,v) :&lt; map (\\n -&gt; rollDices (c+1, t+n, n) tc tt) bs\n                        | otherwise = (c,t,v) :&lt; [(c+1,tt, tt-t) :&lt; []]\n\nmain :: IO String\nmain = do\n  putStr \"How many dice are to be rolled..?   :\"\n  tc &lt;- (read :: String -&gt; Int) &lt;$&gt; getLine\n  putStr \"To what sum do you want to reach..? :\"\n  tt &lt;- (read :: String -&gt; Int) &lt;$&gt; getLine\n  return . show $ rollDices (0,0,0) tc tt\n</code></pre>\n\n<p>This will calculate an N-ary tree with m levels and each path will hold the dice values except the root (seed) which is 0. So let's see it for 4 dices with a target sum of 10.</p>\n\n<pre><code>*Main&gt; main\nHow many dice are to be rolled..?   :4\nTo what sum do you want to reach..? :10\n\"(0,0,0) :&lt; [(1,1,1) :&lt; [(2,2,1) :&lt; [(3,4,2) :&lt; [(4,10,6) :&lt; []],(3,5,3) :&lt; [(4,10,5) :&lt; []],(3,6,4) :&lt; [(4,10,4) :&lt; []],(3,7,5) :&lt; [(4,10,3) :&lt; []],(3,8,6) :&lt; [(4,10,2) :&lt; []]],(2,3,2) :&lt; [(3,4,1) :&lt; [(4,10,6) :&lt; []],(3,5,2) :&lt; [(4,10,5) :&lt; []],(3,6,3) :&lt; [(4,10,4) :&lt; []],(3,7,4) :&lt; [(4,10,3) :&lt; []],(3,8,5) :&lt; [(4,10,2) :&lt; []],(3,9,6) :&lt; [(4,10,1) :&lt; []]],(2,4,3) :&lt; [(3,5,1) :&lt; [(4,10,5) :&lt; []],(3,6,2) :&lt; [(4,10,4) :&lt; []],(3,7,3) :&lt; [(4,10,3) :&lt; []],(3,8,4) :&lt; [(4,10,2) :&lt; []],(3,9,5) :&lt; [(4,10,1) :&lt; []]],(2,5,4) :&lt; [(3,6,1) :&lt; [(4,10,4) :&lt; []],(3,7,2) :&lt; [(4,10,3) :&lt; []],(3,8,3) :&lt; [(4,10,2) :&lt; []],(3,9,4) :&lt; [(4,10,1) :&lt; []]],(2,6,5) :&lt; [(3,7,1) :&lt; [(4,10,3) :&lt; []],(3,8,2) :&lt; [(4,10,2) :&lt; []],(3,9,3) :&lt; [(4,10,1) :&lt; []]],(2,7,6) :&lt; [(3,8,1) :&lt; [(4,10,2) :&lt; []],(3,9,2) :&lt; [(4,10,1) :&lt; []]]],(1,2,2) :&lt; [(2,3,1) :&lt; [(3,4,1) :&lt; [(4,10,6) :&lt; []],(3,5,2) :&lt; [(4,10,5) :&lt; []],(3,6,3) :&lt; [(4,10,4) :&lt; []],(3,7,4) :&lt; [(4,10,3) :&lt; []],(3,8,5) :&lt; [(4,10,2) :&lt; []],(3,9,6) :&lt; [(4,10,1) :&lt; []]],(2,4,2) :&lt; [(3,5,1) :&lt; [(4,10,5) :&lt; []],(3,6,2) :&lt; [(4,10,4) :&lt; []],(3,7,3) :&lt; [(4,10,3) :&lt; []],(3,8,4) :&lt; [(4,10,2) :&lt; []],(3,9,5) :&lt; [(4,10,1) :&lt; []]],(2,5,3) :&lt; [(3,6,1) :&lt; [(4,10,4) :&lt; []],(3,7,2) :&lt; [(4,10,3) :&lt; []],(3,8,3) :&lt; [(4,10,2) :&lt; []],(3,9,4) :&lt; [(4,10,1) :&lt; []]],(2,6,4) :&lt; [(3,7,1) :&lt; [(4,10,3) :&lt; []],(3,8,2) :&lt; [(4,10,2) :&lt; []],(3,9,3) :&lt; [(4,10,1) :&lt; []]],(2,7,5) :&lt; [(3,8,1) :&lt; [(4,10,2) :&lt; []],(3,9,2) :&lt; [(4,10,1) :&lt; []]],(2,8,6) :&lt; [(3,9,1) :&lt; [(4,10,1) :&lt; []]]],(1,3,3) :&lt; [(2,4,1) :&lt; [(3,5,1) :&lt; [(4,10,5) :&lt; []],(3,6,2) :&lt; [(4,10,4) :&lt; []],(3,7,3) :&lt; [(4,10,3) :&lt; []],(3,8,4) :&lt; [(4,10,2) :&lt; []],(3,9,5) :&lt; [(4,10,1) :&lt; []]],(2,5,2) :&lt; [(3,6,1) :&lt; [(4,10,4) :&lt; []],(3,7,2) :&lt; [(4,10,3) :&lt; []],(3,8,3) :&lt; [(4,10,2) :&lt; []],(3,9,4) :&lt; [(4,10,1) :&lt; []]],(2,6,3) :&lt; [(3,7,1) :&lt; [(4,10,3) :&lt; []],(3,8,2) :&lt; [(4,10,2) :&lt; []],(3,9,3) :&lt; [(4,10,1) :&lt; []]],(2,7,4) :&lt; [(3,8,1) :&lt; [(4,10,2) :&lt; []],(3,9,2) :&lt; [(4,10,1) :&lt; []]],(2,8,5) :&lt; [(3,9,1) :&lt; [(4,10,1) :&lt; []]]],(1,4,4) :&lt; [(2,5,1) :&lt; [(3,6,1) :&lt; [(4,10,4) :&lt; []],(3,7,2) :&lt; [(4,10,3) :&lt; []],(3,8,3) :&lt; [(4,10,2) :&lt; []],(3,9,4) :&lt; [(4,10,1) :&lt; []]],(2,6,2) :&lt; [(3,7,1) :&lt; [(4,10,3) :&lt; []],(3,8,2) :&lt; [(4,10,2) :&lt; []],(3,9,3) :&lt; [(4,10,1) :&lt; []]],(2,7,3) :&lt; [(3,8,1) :&lt; [(4,10,2) :&lt; []],(3,9,2) :&lt; [(4,10,1) :&lt; []]],(2,8,4) :&lt; [(3,9,1) :&lt; [(4,10,1) :&lt; []]]],(1,5,5) :&lt; [(2,6,1) :&lt; [(3,7,1) :&lt; [(4,10,3) :&lt; []],(3,8,2) :&lt; [(4,10,2) :&lt; []],(3,9,3) :&lt; [(4,10,1) :&lt; []]],(2,7,2) :&lt; [(3,8,1) :&lt; [(4,10,2) :&lt; []],(3,9,2) :&lt; [(4,10,1) :&lt; []]],(2,8,3) :&lt; [(3,9,1) :&lt; [(4,10,1) :&lt; []]]],(1,6,6) :&lt; [(2,7,1) :&lt; [(3,8,1) :&lt; [(4,10,2) :&lt; []],(3,9,2) :&lt; [(4,10,1) :&lt; []]],(2,8,2) :&lt; [(3,9,1) :&lt; [(4,10,1) :&lt; []]]]]\"\n</code></pre>\n\n<p>So above we have the tree representation. I will write a <code>toList</code> function once i have some time.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4531029"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 2, "accepted_answer_id": 46814878, "answer_count": 4, "score": 8, "last_activity_date": 1508839790, "creation_date": 1508342927, "question_id": 46814606, "link": "https://stackoverflow.com/questions/46814606/idiomatic-way-to-have-many-of-the-same-generators-in-a-list-comprehension", "title": "Idiomatic way to have many of the same generators in a list comprehension", "body": "<p>In Statistics class, my teacher showed us a probability model of all of the possible rolls of two dice that add to 4. Remembering that Haskell list comprehensions are pretty awesome, I decided to take it to the next step and write this code to find <strong>all possible rolls of 4 dice that add to 10</strong>:</p>\n\n<p><code>[(d1,d2,d3,d4) | d1 &lt;- [1..6], d2 &lt;- [1..6], d3 &lt;- [1..6], d4 &lt;- [1..6], (d1 + d2 + d3 + d4) == 10]</code></p>\n\n<p>This works as expected, giving me the output of </p>\n\n<blockquote>\n  <p>[(1,1,2,6),(1,1,3,5),(1,1,4,4),(1,1,5,3),(1,1,6,2),(1,2,1,6),(1,2,2,5),(1,2,3,4),(1,2,4,3),(1,2,5,2),(1,2,6,1),(1,3,1,5),(1,3,2,4),(1,3,3,3),(1,3,4,2),(1,3,5,1),(1,4,1,4),(1,4,2,3),(1,4,3,2),(1,4,4,1),(1,5,1,3),(1,5,2,2),(1,5,3,1),(1,6,1,2),(1,6,2,1),(2,1,1,6),(2,1,2,5),(2,1,3,4),(2,1,4,3),(2,1,5,2),(2,1,6,1),(2,2,1,5),(2,2,2,4),(2,2,3,3),(2,2,4,2),(2,2,5,1),(2,3,1,4),(2,3,2,3),(2,3,3,2),(2,3,4,1),(2,4,1,3),(2,4,2,2),(2,4,3,1),(2,5,1,2),(2,5,2,1),(2,6,1,1),(3,1,1,5),(3,1,2,4),(3,1,3,3),(3,1,4,2),(3,1,5,1),(3,2,1,4),(3,2,2,3),(3,2,3,2),(3,2,4,1),(3,3,1,3),(3,3,2,2),(3,3,3,1),(3,4,1,2),(3,4,2,1),(3,5,1,1),(4,1,1,4),(4,1,2,3),(4,1,3,2),(4,1,4,1),(4,2,1,3),(4,2,2,2),(4,2,3,1),(4,3,1,2),(4,3,2,1),(4,4,1,1),(5,1,1,3),(5,1,2,2),(5,1,3,1),(5,2,1,2),(5,2,2,1),(5,3,1,1),(6,1,1,2),(6,1,2,1),(6,2,1,1)]</p>\n</blockquote>\n\n<p>This is where my question comes in. Ruby is a big part of my background, so I'm very big on the <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" rel=\"noreferrer\">DRY</a> principle. Having <code>d1 &lt;- [1..6], d2 &lt;- [1..6], d3 &lt;- [1..6], d4 &lt;- [1..6]</code> in my code seems unnecessary, and I want to believe there's a better way to do this.</p>\n\n<p>As I understand, my current method functions by running 4 nested loops behind the scenes -- one for each generator. Is there a way to have the one <code>&lt;- [1..6]</code> generator work for all of the variables, effectively creating 4 nested loops? If not, is there a less redundant or idiomatic way of writing this code to achieve the same result? </p>\n\n<p><em>Note: I'm quite new to the language, so I apologize if this is something that should be obvious. If you use any words/concepts that wouldn't be familiar to a novice imperative/object oriented programmer, please try to explain them for me.</em></p>\n"}, {"tags": ["haskell", "data-structures", "tying-the-knot"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1508342031, "post_id": 46813868, "comment_id": 80575960, "body": "When you <code>set val True</code>, you&#39;re not modifying in place, but creating a copy. <code>makeGrid</code> constructs a grid where everything is <code>False</code>, including <code>center -&gt; right -&gt; left</code>. When you <code>set val True</code> on the center, you&#39;re creating a copy <code>center&#39;</code> where <code>val center&#39; == True</code>, but <code>_right center&#39; == _right center</code>, and therefore <code>_left $ _right center&#39; == _left $ _right center == False</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1508342080, "post_id": 46813868, "comment_id": 80575987, "body": "@FyodorSoikin That deserves to be the answer; it&#39;s what I was just starting to write."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1508342206, "post_id": 46813868, "comment_id": 80576061, "body": "@cirdec I didn&#39;t feel like it answered the question, since the question was &quot;how do you do it&quot;, not &quot;why didn&#39;t my attempt work&quot;. But seeing how you&#39;ve deleted your answer, I&#39;ll make my comment into one. :-)"}], "answers": [{"comments": [{"owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1508378578, "post_id": 46814471, "comment_id": 80591039, "body": "Is there a way to do this correctly by also updating the neighbors appropriately, or something like that?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1508391497, "post_id": 46814471, "comment_id": 80594121, "body": "@Agnishom If you update the neighbours, then you&#39;ll have the same problem again with the neighbours of the neighbours further out, and so on. Data structures with &quot;back references&quot; like this are a pain with immutable types, for exactly this reason. You might be able to get this to work with laziness, at the cost of piling up thunks in <i>every</i> cell as you make modifications, but it&#39;s just a pain to work with. We generally use different techniques."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 3, "last_activity_date": 1508342442, "creation_date": 1508342442, "answer_id": 46814471, "question_id": 46813868, "link": "https://stackoverflow.com/questions/46813868/how-do-you-build-an-infinite-grid-like-data-structure-in-haskell/46814471#46814471", "title": "How do you build an infinite grid like data structure in Haskell?", "body": "<p>The key insight is: when you <code>set val True</code>, you're not modifying in place, but creating a copy. </p>\n\n<p><code>makeGrid</code> constructs a grid where everything is <code>False</code>, including <code>_left $ _right center</code>. When you <code>set val True</code> on the <code>center</code>, you're creating a copy <code>center'</code> where <code>val center' == True</code>. However, this copy still points to the same <code>_right</code>, which in turn still points to the same <code>_left</code>, in other words:</p>\n\n<pre><code>_right center' == _right center\n</code></pre>\n\n<p>and therefore:</p>\n\n<pre><code>_left $ _right center' == _left $ _right center == center\n</code></pre>\n\n<p>so that:</p>\n\n<pre><code>_val . _left $ _right center' == _val . _left $ _right center == False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 7, "last_activity_date": 1508350629, "creation_date": 1508350629, "answer_id": 46816711, "question_id": 46813868, "link": "https://stackoverflow.com/questions/46813868/how-do-you-build-an-infinite-grid-like-data-structure-in-haskell/46816711#46816711", "title": "How do you build an infinite grid like data structure in Haskell?", "body": "<p>@Fyodor's answer explains why your current approach won't work.</p>\n\n<p>One common way of accomplishing this in functional languages is using\n<a href=\"https://en.wikipedia.org/wiki/Zipper_(data_structure)\" rel=\"noreferrer\">zippers</a>\n(not to be confused with <code>zip</code> or related functions).</p>\n\n<p>The idea is that the zipper is a representation of the data structure\nfocused on a particular portion (e.g., a cell in the grid).  You can\napply transformations to the zipper to \"move\" this focus around, and\nyou can apply different transformations to query or \"mutate\" the data structure\nrelative to the focus.  Both types of transformations are purely\nfunctional -- they act on an immutable zipper and just\ncreate a new copy.</p>\n\n<p>Here, you can start with a zipper for an infinite list with position\ninformation:</p>\n\n<pre><code>data Zipper a = Zipper [a] a Int [a] deriving (Functor)\n  -- Zipper ls x n rs represents the doubly-infinite list (reverse ls ++\n  -- [x] ++ rs) viewed at offset n\ninstance (Show a) =&gt; Show (Zipper a) where\n  show (Zipper ls x n rs) =\n    show (reverse (take 3 ls)) ++ \" \" ++ show (x,n) ++ \" \" ++ show (take 3 rs)\n</code></pre>\n\n<p>This <code>Zipper</code> is intended to be a representation of a doubly infinite\nlist (i.e., a list that's infinite in both directions).  An example\nwould be:</p>\n\n<pre><code>&gt; Zipper [-10,-20..] 0 0 [10,20..]\n[-30,-20,-10] (0,0) [10,20,30]\n</code></pre>\n\n<p>This is intended to represent the list of all (positive and negative)\ninteger multiples of ten focused at value <code>0</code>, position <code>0</code> and it actually uses two Haskell infinite lists, one for each direction.</p>\n\n<p>You can\ndefine functions to move the focus forward or back:</p>\n\n<pre><code>back, forth :: Zipper a -&gt; Zipper a\nback (Zipper (l:ls) x n rs)  = Zipper ls l (n-1) (x:rs)\nforth (Zipper ls x n (r:rs)) = Zipper (x:ls) r (n+1) rs\n</code></pre>\n\n<p>so that:</p>\n\n<pre><code>&gt; forth $ Zipper [-10,-20..] 0 0 [10,20..]\n[-20,-10,0] (10,1) [20,30,40]\n&gt; back $ back $ Zipper [-10,-20..] 0 0 [10,20..]\n[-50,-40,-30] (-20,-2) [-10,0,10]\n&gt;\n</code></pre>\n\n<p>Now, a <code>Grid</code> can be represented as a zipper of rows, with each row a\nzipper of values:</p>\n\n<pre><code>newtype Grid a = Grid (Zipper (Zipper a)) deriving (Functor)\ninstance Show a =&gt; Show (Grid a) where\n  show (Grid (Zipper ls x n rs)) =\n    unlines $ zipWith (\\a b -&gt; a ++ \" \" ++ b)\n              (map show [n-3..n+3])\n              (map show (reverse (take 3 ls) ++ [x] ++ (take 3 rs)))\n</code></pre>\n\n<p>together with a set of focus-moving functions:</p>\n\n<pre><code>up, down, right, left :: Grid a -&gt; Grid a\nup (Grid g) = Grid (back g)\ndown (Grid g) = Grid (forth g)\nleft (Grid g) = Grid (fmap back g)\nright (Grid g) = Grid (fmap forth g)\n</code></pre>\n\n<p>You can define a getter and setter for the focused element:</p>\n\n<pre><code>set :: a -&gt; Grid a -&gt; Grid a\nset y (Grid (Zipper ls row n rs)) = (Grid (Zipper ls (set' row) n rs))\n  where set' (Zipper ls' x m rs') = Zipper ls' y m rs'\n\nget :: Grid a -&gt; a\nget (Grid (Zipper _ (Zipper _ x _ _) _ _)) = x\n</code></pre>\n\n<p>and it may be convenient to add a function that moves the focus back\nto the origin for display purposes:</p>\n\n<pre><code>recenter :: Grid a -&gt; Grid a\nrecenter g@(Grid (Zipper _ (Zipper _ _ m _) n _))\n  | n &gt; 0 = recenter (up g)\n  | n &lt; 0 = recenter (down g)\n  | m &gt; 0 = recenter (left g)\n  | m &lt; 0 = recenter (right g)\n  | otherwise = g\n</code></pre>\n\n<p>Finally, with a function that creates an all-<code>False</code> grid:</p>\n\n<pre><code>falseGrid :: Grid Bool\nfalseGrid =\n  let falseRow = Zipper falses False 0 falses\n      falses = repeat False\n      falseRows = repeat falseRow\n  in  Grid (Zipper falseRows falseRow 0 falseRows)\n</code></pre>\n\n<p>you can do things like:</p>\n\n<pre><code>&gt; let (&amp;) = flip ($)\n&gt; let testGrid = falseGrid &amp; set True &amp; right &amp; set True &amp; recenter\n&gt; testGrid\n-3 [False,False,False] (False,0) [False,False,False]\n-2 [False,False,False] (False,0) [False,False,False]\n-1 [False,False,False] (False,0) [False,False,False]\n0 [False,False,False] (True,0) [True,False,False]\n1 [False,False,False] (False,0) [False,False,False]\n2 [False,False,False] (False,0) [False,False,False]\n3 [False,False,False] (False,0) [False,False,False]\n\n&gt; testGrid &amp; right &amp; left &amp; get\nTrue\n&gt; testGrid &amp; left &amp; right &amp; get\nTrue\n&gt; testGrid &amp; get\nTrue\n&gt;\n</code></pre>\n\n<p>The full example:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\nmodule Grid where\n\ndata Zipper a = Zipper [a] a Int [a] deriving (Functor)\n  -- Zipper ls x n rs represents the doubly-infinite list (reverse ls ++\n  -- [x] ++ rs) viewed at offset n\ninstance (Show a) =&gt; Show (Zipper a) where\n  show (Zipper ls x n rs) =\n    show (reverse (take 3 ls)) ++ \" \" ++ show (x,n) ++ \" \" ++ show (take 3 rs)\n\nback, forth :: Zipper a -&gt; Zipper a\nback (Zipper (l:ls) x n rs)  = Zipper ls l (n-1) (x:rs)\nforth (Zipper ls x n (r:rs)) = Zipper (x:ls) r (n+1) rs\n\nnewtype Grid a = Grid (Zipper (Zipper a)) deriving (Functor)\ninstance Show a =&gt; Show (Grid a) where\n  show (Grid (Zipper ls x n rs)) =\n    unlines $ zipWith (\\a b -&gt; a ++ \" \" ++ b)\n              (map show [n-3..n+3])\n              (map show (reverse (take 3 ls) ++ [x] ++ (take 3 rs)))\n\nup, down, right, left :: Grid a -&gt; Grid a\nup (Grid g) = Grid (back g)\ndown (Grid g) = Grid (forth g)\nleft (Grid g) = Grid (fmap back g)\nright (Grid g) = Grid (fmap forth g)\n\nset :: a -&gt; Grid a -&gt; Grid a\nset y (Grid (Zipper ls row n rs)) = (Grid (Zipper ls (set' row) n rs))\n  where set' (Zipper ls' x m rs') = Zipper ls' y m rs'\n\nget :: Grid a -&gt; a\nget (Grid (Zipper _ (Zipper _ x _ _) _ _)) = x\n\nrecenter :: Grid a -&gt; Grid a\nrecenter g@(Grid (Zipper _ (Zipper _ _ m _) n _))\n  | n &gt; 0 = recenter (up g)\n  | n &lt; 0 = recenter (down g)\n  | m &gt; 0 = recenter (left g)\n  | m &lt; 0 = recenter (right g)\n  | otherwise = g\n\nfalseGrid :: Grid Bool\nfalseGrid =\n  let falseRow = Zipper falses False 0 falses\n      falses = repeat False\n      falseRows = repeat falseRow\n  in  Grid (Zipper falseRows falseRow 0 falseRows)\n\n(&amp;) = flip ($)\n\ntestGrid :: Grid Bool\ntestGrid = falseGrid &amp; set True &amp; right &amp; set True &amp; recenter\n\nmain = do\n  print $ testGrid &amp; get\n  print $ testGrid &amp; left &amp; get\n  print $ testGrid &amp; left &amp; right &amp; get\n  print $ testGrid &amp; right &amp; left &amp; get\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1508350629, "creation_date": 1508340466, "question_id": 46813868, "link": "https://stackoverflow.com/questions/46813868/how-do-you-build-an-infinite-grid-like-data-structure-in-haskell", "title": "How do you build an infinite grid like data structure in Haskell?", "body": "<p>I am trying to form an infinite grid like data structure by tying the knot.</p>\n\n<p>This is my approach:</p>\n\n<pre><code>import Control.Lens\n\ndata Grid a = Grid {_val :: a,\n                    _left :: Grid a,\n                    _right :: Grid a,\n                    _down :: Grid a,\n                    _up :: Grid a}\n\nmakeLenses ''Grid\n\nmakeGrid :: Grid Bool -- a grid with all Falses\nmakeGrid = formGrid Nothing Nothing Nothing Nothing\n\nformGrid :: Maybe (Grid Bool) -&gt; Maybe (Grid Bool) -&gt; Maybe (Grid Bool) -&gt; Maybe (Grid Bool) -&gt; Grid Bool\nformGrid ls rs ds us = center\n  where\n    center = Grid False leftCell rightCell downCell upCell\n    leftCell = case ls of\n                Nothing -&gt; formGrid Nothing (Just center) Nothing Nothing\n                Just l -&gt;  l\n    rightCell = case rs of\n                Nothing -&gt; formGrid (Just center) Nothing Nothing Nothing\n                Just r -&gt;  r\n    upCell = case us of\n                Nothing -&gt; formGrid Nothing Nothing (Just center) Nothing\n                Just u -&gt;  u\n    downCell = case ds of\n                Nothing -&gt; formGrid Nothing Nothing Nothing (Just center)\n                Just d -&gt;  d\n</code></pre>\n\n<p>For some reason, this is not working. As seen here:</p>\n\n<pre><code>*Main&gt; let testGrid = (set val True) . (set (right . val) True) $ makeGrid\n*Main&gt; _val $ _right $ _left testGrid\nFalse\n*Main&gt; _val $ _left $ _right testGrid\nFalse\n*Main&gt; _val $ testGrid\nTrue\n</code></pre>\n\n<p>Where am I going wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 6, "creation_date": 1508333721, "post_id": 46811248, "comment_id": 80570024, "body": "This is silly code that parses strings at compile-time within the type system. If you&#39;re a beginner, I&#39;d recommend ignoring this example for now."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1508334892, "post_id": 46811248, "comment_id": 80570893, "body": "This solution abuses the type system so to compute the required function at the type level. It does not produce a working program. It does produce some definitions such that, if one asks GHCi <i>the type</i> of a carefully crafted expression (without evaluating it!), the resulting <i>type</i> will include the wanted answer in some format. Basically, it is a hack to force the type inference engine to do the job we want. It is more like a joke than an intended solution. If you are learning Haskell, this is a clever hack that you should ignore."}, {"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "edited": false, "score": 0, "creation_date": 1508338123, "post_id": 46811248, "comment_id": 80573137, "body": "I see it now. It&#39;s really a clever hack. I will find something else to learn. Thank you for advice."}], "answers": [{"comments": [{"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "edited": false, "score": 0, "creation_date": 1508337367, "post_id": 46811882, "comment_id": 80572590, "body": "Oh! So the constraint is the predicate BuildTree str t. And Haskell&#39;s type inference will calculate the type. And the answer is in the type. I see. Thx!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1508336050, "last_edit_date": 1508336050, "creation_date": 1508334890, "answer_id": 46811882, "question_id": 46811248, "link": "https://stackoverflow.com/questions/46811248/tree-construction-from-a-node-string-cant-understand-this-haskell-code/46811882#46811882", "title": "Tree construction from a node string (Can&#39;t understand this Haskell code)", "body": "<p>First, I agree with the comments:  don't try to understand this \"solution\" until you've been using Haskell for a few years.  For the sake of completeness, though, here's how to use it...</p>\n\n<p>This solution is implemented as a \"type-level computation\" that takes place at compile time.  I'm a little surprised the author didn't provide an explanation of how to use it, since it's far from obvious.</p>\n\n<p>There may be a better way, but here's one that works.  First:</p>\n\n<ul>\n<li>Add <code>TypeOperator</code> to the list of extensions -- I couldn't get it to compile under GHC 8.0.2 without that.</li>\n<li>Add an <code>import Data.Proxy</code></li>\n</ul>\n\n<p>Then, at the bottom, add:</p>\n\n<pre><code>data Nodes = A | B | C | D | E\nu = (Proxy :: BuildTree str (Node A [Node B '[], Node C '[]]) =&gt; Proxy str)\n</code></pre>\n\n<p>This defines some constructors for node labels that get lifted to types by the <code>DataKinds</code> extension.  We then define the symbol <code>u</code> as a value of type <code>str</code> subject to a constraint based on the \"predicate\" <code>BuildTree str t</code> where <code>t</code> is the tree.  Note that the <em>value</em> of <code>u</code> isn't important (and in fact it's the boring value \"<code>Proxy</code>\"); it's <code>u</code>'s <em>type</em> that's important...</p>\n\n<p>Haskell's type inference will calculate the type of <code>str</code> which we can display in GHCi like so:</p>\n\n<pre><code>&gt; :t u\nu :: Proxy '['Down 'A, 'Down 'B, 'Up, 'Down 'C, 'Up, 'Up]\n&gt;\n</code></pre>\n\n<p>Similarly, adding:</p>\n\n<pre><code>v = (Proxy :: BuildTree (['Down 'A, 'Down 'B, 'Up, 'Down 'C, 'Up, 'Up]) t \n    =&gt; Proxy t)\n</code></pre>\n\n<p>at the bottom gives us the reverse transformation:</p>\n\n<pre><code>&gt; :t v\nv :: Proxy ('Node 'A '['Node 'B '[], 'Node 'C '[]])\n&gt;\n</code></pre>\n\n<p>Note that the <code>Proxy</code> is used here just to allow us to assign the type to an object.  Without the proxy, we're trying to assign <code>u</code> and <code>v</code> to types with a kind other than <code>*</code> (i.e., the kind of concrete types), and that isn't allowed.</p>\n"}], "owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 46811882, "answer_count": 1, "score": 1, "last_activity_date": 1508336050, "creation_date": 1508332993, "question_id": 46811248, "link": "https://stackoverflow.com/questions/46811248/tree-construction-from-a-node-string-cant-understand-this-haskell-code", "title": "Tree construction from a node string (Can&#39;t understand this Haskell code)", "body": "<p>I was trying to learn Haskell by 99 Haskell problems and bumped into \"4 Problem 70\". It's about \"Tree construction from a node string\". (the description is <a href=\"https://wiki.haskell.org/99_questions/70B_to_73\" rel=\"nofollow noreferrer\">here</a>)</p>\n\n<p>And I just don't understand the last solution <a href=\"https://wiki.haskell.org/99_questions/Solutions/70\" rel=\"nofollow noreferrer\">there</a>.</p>\n\n<blockquote>\n  <p>The exercise was really designed for Prolog, and calls for a bidirectional predicate. The closest thing to that, in Haskell, is a class! This is really a parsing/pretty-printing solution, with the names to match. Rather than trying to work with strings and a special \"up\" character (which won't really work at the type level), we use lists of explicit instructions. The requested predicate is BuildTree.</p>\n</blockquote>\n\n<pre><code>{-# language MultiParamTypeClasses, FunctionalDependencies,\n         FlexibleContexts, FlexibleInstances, UndecidableInstances,\n         DataKinds, PolyKinds #-}\n\nimport Data.Tree\ndata Instr c = Up | Down c\n\nclass ParseTree str t '[]\n  =&gt; BuildTree (str :: [Instr c]) (t :: Tree c) | str -&gt; t, t -&gt; str\ninstance ParseTree str t '[]\n     =&gt; BuildTree str t\n</code></pre>\n\n<blockquote>\n  <p>We use two helpers to implement it:</p>\n</blockquote>\n\n<pre><code>class ParseTree (str :: [Instr c]) (t :: Tree c) (rem :: [Instr c])\n            | str -&gt; t rem, t rem -&gt; str\nclass ParseForest (str :: [Instr c]) (ts :: [Tree c]) (rem :: [Instr c])\n            | str -&gt; ts rem, ts rem -&gt; str\n\ninstance ParseTree ('Down c ': 'Up ': r) ('Node c '[]) r\ninstance ParseForest ('Down d ': is) (t ': ts) r\n     =&gt; ParseTree ('Down c ': 'Down d ': is) ('Node c (t ': ts)) r\n\ninstance ParseForest ('Up ': is) '[] is\ninstance ( ParseTree ('Down c ': is) t r\n     , ParseForest r ts r')\n     =&gt; ParseForest ('Down c ': is) (t ': ts) r'\n</code></pre>\n\n<p>And I ghci this code and can't find a function ready to use.</p>\n\n<blockquote>\n  <p>The requested predicate is BuildTree.</p>\n</blockquote>\n\n<p>Does that mean I have to write this predicate?</p>\n\n<p>Thank you for help!</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1508332719, "post_id": 46810998, "comment_id": 80569341, "body": "Where <i>is</i> that information supposed to come from, if not from the JSON input?"}, {"owner": {"reputation": 193, "user_id": 1332954, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b63170221f0bbfdf2fc99be3e12b7623?s=128&d=identicon&r=PG", "display_name": "blackwolf123333", "link": "https://stackoverflow.com/users/1332954/blackwolf123333"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1508332789, "post_id": 46810998, "comment_id": 80569373, "body": "The picture is loaded later, after reading the json, and at that time the loaded field will be set as well. I guess a loaded could be false by default, but the question remains how to do that."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1508332967, "post_id": 46810998, "comment_id": 80569484, "body": "But then what should the value of <code>res</code> be, when the picture is not loaded? Since this isn&#39;t java it can&#39;t be <code>null</code>, it has to be a picture. If want it to be able to be <code>null</code> you have to change the type to <code>Maybe Picture</code>."}, {"owner": {"reputation": 193, "user_id": 1332954, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b63170221f0bbfdf2fc99be3e12b7623?s=128&d=identicon&r=PG", "display_name": "blackwolf123333", "link": "https://stackoverflow.com/users/1332954/blackwolf123333"}, "edited": false, "score": 0, "creation_date": 1508333103, "post_id": 46810998, "comment_id": 80569576, "body": "I guess I could try that, same for loaded. Make them both Maybe"}, {"owner": {"reputation": 193, "user_id": 1332954, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b63170221f0bbfdf2fc99be3e12b7623?s=128&d=identicon&r=PG", "display_name": "blackwolf123333", "link": "https://stackoverflow.com/users/1332954/blackwolf123333"}, "edited": false, "score": 0, "creation_date": 1508333240, "post_id": 46810998, "comment_id": 80569671, "body": "Defining res as Maybe Picture still gives an error: No instance for (FromJSON Picture)"}], "answers": [{"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1508335190, "post_id": 46811944, "comment_id": 80571127, "body": "Just 33 seconds before I wrote basically the same answer :)"}, {"owner": {"reputation": 193, "user_id": 1332954, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b63170221f0bbfdf2fc99be3e12b7623?s=128&d=identicon&r=PG", "display_name": "blackwolf123333", "link": "https://stackoverflow.com/users/1332954/blackwolf123333"}, "edited": false, "score": 0, "creation_date": 1508335745, "post_id": 46811944, "comment_id": 80571489, "body": "Thanks, I pretty much ended up doing something like this indeed"}, {"owner": {"reputation": 193, "user_id": 1332954, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b63170221f0bbfdf2fc99be3e12b7623?s=128&d=identicon&r=PG", "display_name": "blackwolf123333", "link": "https://stackoverflow.com/users/1332954/blackwolf123333"}, "edited": false, "score": 0, "creation_date": 1508336079, "post_id": 46811944, "comment_id": 80571699, "body": "Could I ask a follow up question though? Because currently how I read the file contents is a mess because the regular readFile doesn&#39;t output a ByteString. How could I fix that?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1508335076, "creation_date": 1508335076, "answer_id": 46811944, "question_id": 46810998, "link": "https://stackoverflow.com/questions/46810998/give-a-default-value-for-fields-not-available-in-json-using-aeson/46811944#46811944", "title": "Give a default value for fields not available in json using aeson", "body": "<p>If you can't load that structure from JSON, then don't define it this way! Make it</p>\n\n<pre><code>data ResourceRef = ResRef\n                { name :: String\n                , file :: FilePath\n                } deriving (Generic, Show)\n</code></pre>\n\n<p>That can be easily loaded from JSON. You can then have an additional</p>\n\n<pre><code>data Resource = Res\n                { resName :: String\n                , resFile :: FilePath\n                , res :: Picture\n                } deriving (Generic, Show)\n</code></pre>\n\n<p>...which never gets in contact with JSON. And implement</p>\n\n<pre><code>loadResource :: ResourceRef -&gt; IO Resource\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 1332954, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b63170221f0bbfdf2fc99be3e12b7623?s=128&d=identicon&r=PG", "display_name": "blackwolf123333", "link": "https://stackoverflow.com/users/1332954/blackwolf123333"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 46811944, "answer_count": 1, "score": 1, "last_activity_date": 1508335110, "creation_date": 1508332231, "question_id": 46810998, "link": "https://stackoverflow.com/questions/46810998/give-a-default-value-for-fields-not-available-in-json-using-aeson", "title": "Give a default value for fields not available in json using aeson", "body": "<p>I am trying to load json using the Aeson library. The thing is that the datastructure that I want to load it into contains more fields than the json.</p>\n\n<pre><code>data Resource = Res {\n                  name :: String,\n                  file :: FilePath,\n                  res :: Picture,\n                  loaded :: Bool\n                } deriving (Generic, Show)\n</code></pre>\n\n<p>Where only the name and the file fields are available in the json. Picture is a gloss Picture so that can't really be loaded from json.</p>\n\n<p>I can't figure out how to leave out res and loaded out of the FromJSON instance.</p>\n"}, {"tags": ["haskell", "constraints", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 4, "last_activity_date": 1508323600, "creation_date": 1508323600, "answer_id": 46808390, "question_id": 46806981, "link": "https://stackoverflow.com/questions/46806981/getting-derivations-out-of-typeclass-resolution/46808390#46808390", "title": "getting derivations out of typeclass resolution", "body": "<p>There isn't a way to get the derivation of an arbitrary constraint as a Haskell value.</p>\n\n<p>The closest thing I can think of, if you want to check whether the derivation is what you think it is, is to look at the desugarer output.</p>\n\n<pre><code>ghc -ddump-ds -ddump-to-file A.hs\n</code></pre>\n\n<p>The relevant part looks like this:</p>\n\n<pre><code>-- RHS size: {terms: 2, types: 1, coercions: 0, joins: 0/0}\nirred :: Show [Int]\n[LclId]\nirred = GHC.Show.$fShow[] @ Int GHC.Show.$fShowInt\n\n-- RHS size: {terms: 2, types: 3, coercions: 0, joins: 0/0}\nproof :: Dict (Show [Int])\n[LclIdX]\nproof = Cns.Dict @ (Show [Int]) irred\n</code></pre>\n\n<p>Another one is to write custom typeclasses instrumented to reflect the  derivation, either in types or in values, but of course this doesn't apply to preexisting type classes.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, ConstraintKinds, GADTs, DataKinds,\n   FlexibleInstances, KindSignatures, MultiParamTypeClasses, RankNTypes,\n   ScopedTypeVariables, TypeApplications, TypeOperators,\n   UndecidableInstances #-}\n\nimport Data.Typeable\nimport Data.Kind\n\ndata (c :: [Type]) :=&gt; (d :: Type -&gt; Constraint)\n\nclass MyShow a d where\n  myshow :: a -&gt; String\n\ninstance (d ~ ('[] :=&gt; MyShow Int)) =&gt; MyShow Int d where\n\ninstance (MyShow a da, d ~ ('[da] :=&gt; MyShow [a])) =&gt; MyShow [a] d where\n\nmyshowInstance :: forall a d. (Typeable d, MyShow a d) =&gt; TypeRep\nmyshowInstance = typeRep @_ @d Proxy\n\nmain = print (myshowInstance @[Int])\n</code></pre>\n\n<p>The output could be made to look better, e.g., via a singleton with a proper rendering method instead of <code>TypeRep</code>, but I hope you get the main idea.</p>\n\n<pre><code>:=&gt; (': * (:=&gt; ('[] *) (MyShow Int)) ('[] *)) (MyShow [Int])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1508393598, "post_id": 46818105, "comment_id": 80594775, "body": "That would be a fun exercice indeed !"}], "tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": 1, "last_activity_date": 1508357634, "last_edit_date": 1508357634, "creation_date": 1508356194, "answer_id": 46818105, "question_id": 46806981, "link": "https://stackoverflow.com/questions/46806981/getting-derivations-out-of-typeclass-resolution/46818105#46818105", "title": "getting derivations out of typeclass resolution", "body": "<p>This may be what you're after, or at least enough to give you a general idea. I can't think of a way to have GHC provide this automatically, but you can manually construct the chain of entailments that proves the constraint using the <code>constraints</code> package.</p>\n\n<p>For whatever reason, there is no <code>instance () :=&gt; Show Int</code>, so I've used <code>Char</code> instead. This is likely an oversight, I've opened a pull request to add the missing instances.</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n\nimport Data.Constraints\n\nderivation :: () :- Show [Char]\nderivation = trans showList showChar\n    where showList :: Show a :- Show [a]\n          showList = ins\n\n          showChar :: () :- Show Char\n          showChar = ins\n</code></pre>\n\n<p>Unfortunately printing this value doesn't show the inner derivations, just <code>\"Sub Dict\"</code>. </p>\n\n<p>A fun exercise could be to try to write <code>derivation</code> with explicit <code>TypeApplications</code> using <code>Data.Constraint.Forall</code>. You'll need a couple extra steps to prove <code>Show a :- Forall Show</code> and <code>ForallF Show [] :- Show [a]</code>.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1508357634, "creation_date": 1508319111, "question_id": 46806981, "link": "https://stackoverflow.com/questions/46806981/getting-derivations-out-of-typeclass-resolution", "title": "getting derivations out of typeclass resolution", "body": "<p>We can get a value level proof that <code>[Int]</code> has a Show instance using a  <code>Dict</code> </p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds, GADTs #-}\ndata Dict (p :: Constraint) where\n  Dict :: p =&gt; Dict p\n</code></pre>\n\n<p>and </p>\n\n<pre><code>proof = Dict :: Dict (Show [Int])\n</code></pre>\n\n<p>Is there a way to get a value level derivation, that is, the entire proof tree ?</p>\n\n<pre><code>derivation = Apply@Int(Lam a.(Show a) :=&gt; Show [a])) (Apply(() :=&gt; Show Int)()) \n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "edited": false, "score": 0, "creation_date": 1508309007, "post_id": 46804058, "comment_id": 80555157, "body": "Wow this is great, thanks. I&#39;ll work through it properly tonight. I should have linked to the current Github source actually... I&#39;ll do that now."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 8, "last_activity_date": 1508340572, "last_edit_date": 1508340572, "creation_date": 1508308334, "answer_id": 46804058, "question_id": 46803597, "link": "https://stackoverflow.com/questions/46803597/monadrandom-state-and-monad-transformers/46804058#46804058", "title": "MonadRandom, State and monad transformers", "body": "<p>Well how about an example to help you out.  Since you didn't post a full working code snippet I'll just replace a lot of your operations and show how the monads can be evaluated:</p>\n\n<pre><code>import Control.Monad.Trans.State\nimport Control.Monad.Random\nimport System.Random.TF\n\nbidOnRound :: (RandomGen g) =&gt; Int -&gt; RandT g (State ([Int], Int)) ()\nbidOnRound i =\n do rand &lt;- getRandomR (10,20)\n    s &lt;- lift $ get\n    lift $ put ([], i + rand + snd s)\n\nmain :: IO ()\nmain =\n do g &lt;- newTFGen\n    print $ flip execState ([],1000) $ evalRandT (bidOnRound 100) g\n</code></pre>\n\n<p>The thing to note here is you \"unwrap\" the outer monad first.  So if you have <code>RandT (StateT Reader ...) ...</code> then you run RandT (ex via <code>evalRandT</code> or similar) then the state then the reader.  Secondly, you must <code>lift</code> from the outer monad to use operations on the inner monad.  This might seem clumsy and that is because it is horribly clumsy.</p>\n\n<p>The best developers I know - those whose code I enjoy looking at and working with - extract monad operations and provide an API with all the primitives complete so I don't need to think about the structure of the monad while I'm thinking about the structure of the logic I'm writing.</p>\n\n<p>In this case (it will be slightly contrived since I wrote the above without any application domain, rhyme or reason) you could write:</p>\n\n<pre><code>type MyMonad a = RandT TFGen (State ([Int],Int)) a\n\nrunMyMonad :: MyMonad () -&gt; IO Int\nrunMyMonad f =\n do g &lt;- newTFGen\n    pure $ snd $ flip execState ([],1000) $ evalRandT f g\n</code></pre>\n\n<p>With the Monad defined as a simple alias and execution operation the basic functions are easier:</p>\n\n<pre><code>flipCoin ::  MyMonad Int\nflipCoin = getRandomR (10,20)\n\ngetBaseValue :: MyMonad Int\ngetBaseValue = snd &lt;$&gt; lift get\n\nsetBaseValue :: Int -&gt; MyMonad ()\nsetBaseValue v = lift $ state $ \\s -&gt; ((),(fst s, v))\n</code></pre>\n\n<p>With that leg-work out of the way, which is usually a minor part of making a real application, the domain specific logic is easier to write and certainly easier to read:</p>\n\n<pre><code>bidOnRound2 :: Int -&gt; MyMonad ()\nbidOnRound2 i =\n do rand &lt;- flipCoin\n    old  &lt;- getBaseValue\n    setBaseValue (i + rand + old)\n\nmain2 :: IO ()\nmain2 = print =&lt;&lt; runMyMonad (bidOnRound2 100)\n</code></pre>\n"}], "owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 46804058, "answer_count": 1, "score": 4, "last_activity_date": 1508340572, "creation_date": 1508305881, "last_edit_date": 1508309201, "question_id": 46803597, "link": "https://stackoverflow.com/questions/46803597/monadrandom-state-and-monad-transformers", "title": "MonadRandom, State and monad transformers", "body": "<p>I'm writing some code (around card-playing strategies) that uses <code>State</code> and recursion together. Perhaps this part doesn't need to actually (it already feels clumsy to me, even as a relative beginner), but there are other parts that probably do so my general question stands...</p>\n\n<p>My initial naive implementation is entirely deterministic (the choice of bid is simply the first option provided by the function <code>validBids</code>):</p>\n\n<pre><code>bidOnRound :: (DealerRules d) =&gt; d -&gt; NumCards -&gt; State ([Player], PlayerBids) ()\nbidOnRound dealerRules cardsThisRound = do\n  (players, bidsSoFar) &lt;- get\n  unless (List.null players) $ do\n     let options = validBids dealerRules cardsThisRound bidsSoFar\n     let newBid = List.head $ Set.toList options\n     let p : ps = players\n     put (ps, bidsSoFar ++ [(p, newBid)])\n     bidOnRound dealerRules cardsThisRound\n</code></pre>\n\n<p>And I call it from:</p>\n\n<pre><code>playGame :: (DealerRules d, ScorerRules s) =&gt; d -&gt; s -&gt; StateT Results IO ()\n  ...\nlet (_, bidResults) = execState (bidOnRound dealerRules cardsThisRound) (NonEmpty.toList players, [])\n</code></pre>\n\n<p>Now I'm aware that I need to bring randomness into this and several other parts of the code. Not wanting to litter <code>IO</code> everywhere, nor pass round random seeds manually all the time, I feel I should be using <a href=\"http://hackage.haskell.org/package/MonadRandom-0.5.1/docs/Control-Monad-Random-Lazy.html\" rel=\"nofollow noreferrer\">MonadRandom</a> <em>or something</em>. A library I'm using uses it to good effect. Is this a wise choice?</p>\n\n<p>Here's what I tried:</p>\n\n<pre><code>bidOnRound :: (DealerRules d, RandomGen g) =&gt; d -&gt; NumCards -&gt; RandT g (State ([Player], PlayerBids)) ()\nbidOnRound dealerRules cardsThisRound = do\n  (players, bidsSoFar) &lt;- get\n  unless (List.null players) $ do\n     let options = Set.toList $ validBids dealerRules cardsThisRound bidsSoFar\n     rnd &lt;- getRandomR (0 :: Int, len options - 1)\n     let newBid = options List.!! rnd\n     let p : ps = players\n     put (ps, bidsSoFar ++ [(p, newBid)])\n     bidOnRound dealerRules cardsThisRound\n</code></pre>\n\n<p>but I'm uncomfortable already, plus can't work out how to call this, e.g. using <code>evalRand</code> in combination with <code>execState</code> etc. The more I read on <code>MonadRandom</code>, <code>RandGen</code> and <code>mtl</code> vs others, the less sure I am of what I'm doing...</p>\n\n<p>How should I neatly combine Randomness and <code>State</code> and how do I call these properly?</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: for reference, <a href=\"https://github.com/declension/gp-sandbox\" rel=\"nofollow noreferrer\">full current source on Github</a>.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 4, "creation_date": 1508305490, "post_id": 46803506, "comment_id": 80553676, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/46720233/haskell-recursion-functions-and-syntax\">Haskell recursion functions and syntax</a>"}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 8793788, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-1GF-TK3Z-hU/AAAAAAAAAAI/AAAAAAAAHjU/rg0JpaFThNo/photo.jpg?sz=128", "display_name": "lou tej", "link": "https://stackoverflow.com/users/8793788/lou-tej"}, "edited": false, "score": 0, "creation_date": 1508306470, "post_id": 46803620, "comment_id": 80554049, "body": "Yeah, that is my code for the first problem that I had. What I posted was that I need to do it for the previous number in the list now, which is where I get lost. I even posted that  same code up top so everyone can see what I have so far in terms of doing it for the next number because that one I understand"}, {"owner": {"reputation": 834, "user_id": 1395722, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/4fc4325896e0c19e7f276d5659cd0694?s=128&d=identicon&r=PG", "display_name": "a.l.", "link": "https://stackoverflow.com/users/1395722/a-l"}, "reply_to_user": {"reputation": 27, "user_id": 8793788, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-1GF-TK3Z-hU/AAAAAAAAAAI/AAAAAAAAHjU/rg0JpaFThNo/photo.jpg?sz=128", "display_name": "lou tej", "link": "https://stackoverflow.com/users/8793788/lou-tej"}, "edited": false, "score": 0, "creation_date": 1508422433, "post_id": 46803620, "comment_id": 80611448, "body": "Sorry, @loutej. I forgot to change the function&#39;s name. It might make you confused, however this code works exactly like what you want..."}], "tags": [], "owner": {"reputation": 834, "user_id": 1395722, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/4fc4325896e0c19e7f276d5659cd0694?s=128&d=identicon&r=PG", "display_name": "a.l.", "link": "https://stackoverflow.com/users/1395722/a-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1508406739, "last_edit_date": 1508406739, "creation_date": 1508306044, "answer_id": 46803620, "question_id": 46803506, "link": "https://stackoverflow.com/questions/46803506/haskell-recursion-with-lists/46803620#46803620", "title": "Haskell recursion with lists", "body": "<pre><code>findPrev :: Int -&gt; [Int] -&gt; Int\nfindPrev _ [] = -1\nfindPrev n (x:xs)\n    | xs == [] = -1\n    | n == head xs = x\n    | otherwise = findPrev n xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1508326592, "post_id": 46807122, "comment_id": 80565472, "body": "This should be renamed to <code>findPrev</code>. Apart from that, it looks OK."}], "tags": [], "owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "is_accepted": false, "score": 4, "last_activity_date": 1508327693, "last_edit_date": 1508327693, "creation_date": 1508319518, "answer_id": 46807122, "question_id": 46803506, "link": "https://stackoverflow.com/questions/46803506/haskell-recursion-with-lists/46807122#46807122", "title": "Haskell recursion with lists", "body": "<p>You can use pattern matching to get the previous value. Just define your pattern for the matching case as <code>x:y:xs</code> to match a list with at least two elements. The cases for empty and singleton lists can be spelled out explicitly in other cases:</p>\n\n<pre><code>findPrev :: Int -&gt; [Int] -&gt; Int\nfindPrev _ [] = -1\nfindPrev _ [_] = -1\nfindPrev n (x:y:xs) = if n == y then x else findPrev n (y:xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1508327788, "creation_date": 1508327788, "answer_id": 46809621, "question_id": 46803506, "link": "https://stackoverflow.com/questions/46803506/haskell-recursion-with-lists/46809621#46809621", "title": "Haskell recursion with lists", "body": "<p>Outside-the-box (but inefficient) answer: use <code>findNext</code> on the reversal of the list.</p>\n\n<pre><code>findPrev x xs = findNext x (reverse xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 8799546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9341911dec0743bfd61be1973b6ca99?s=128&d=identicon&r=PG&f=1", "display_name": "DMJ", "link": "https://stackoverflow.com/users/8799546/dmj"}, "is_accepted": false, "score": 0, "last_activity_date": 1508452881, "creation_date": 1508452881, "answer_id": 46839928, "question_id": 46803506, "link": "https://stackoverflow.com/questions/46803506/haskell-recursion-with-lists/46839928#46839928", "title": "Haskell recursion with lists", "body": "<p>Assuming the list is ordered:</p>\n\n<pre><code>module FindPrevious where\n\nfindPrevious n xs \n    | n `elem` xs = last $ takeWhile (&lt;n) xs\n    | otherwise = (-1)\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 8793788, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-1GF-TK3Z-hU/AAAAAAAAAAI/AAAAAAAAHjU/rg0JpaFThNo/photo.jpg?sz=128", "display_name": "lou tej", "link": "https://stackoverflow.com/users/8793788/lou-tej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2119, "favorite_count": 0, "answer_count": 4, "score": -1, "last_activity_date": 1581310148, "creation_date": 1508305414, "last_edit_date": 1581310148, "question_id": 46803506, "link": "https://stackoverflow.com/questions/46803506/haskell-recursion-with-lists", "title": "Haskell recursion with lists", "body": "<p>Implement a search algorithm that searches through a list for Int n and returns the value in the list before n. If there is no value, or the list is empty, return -1. e.g., <code>findPrev 5 [1,2,3,4,5,6]</code> should return 4, while <code>findPrev 5 [0, 10, 20, 30]</code> returns -1.</p>\n\n<p>I got this for the find the number, but have no idea how to get the previous number. Can someone help and explain this one to me? Here is how I did the first one: </p>\n\n<pre><code>findNext :: Int -&gt; [Int] -&gt; Int\nfindNext _ [] = -1\nfindNext n (x:xs)\n    | n == x = head xs\n    | otherwise = findNext n xs\n</code></pre>\n"}, {"tags": ["list", "haskell", "tree", "nodes"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1508283514, "post_id": 46800699, "comment_id": 80548268, "body": "what have you tried? where are you stuck? could you implement the algorithm in another language or would this be also a problem?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1508284962, "post_id": 46800699, "comment_id": 80548615, "body": "Also note that the type you have defined is not a tree."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 1, "creation_date": 1508287152, "post_id": 46800699, "comment_id": 80549094, "body": "@moondaisy At least the type in the question is a legal type! Yours doesn&#39;t give enough type arguments to <code>Tree</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1508294238, "post_id": 46800699, "comment_id": 80550684, "body": "You probably wanted <code>data Tree t = Leaf | Branch (Tree t) t (Tree t)</code>. With <code>data Tree t = Leaf | Branch (Tree t) (Tree t)</code> your question doesn&#39;t really work (unless you meant get a list of elements, all of which are equally deep at maximum depth)."}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1508297100, "post_id": 46802074, "comment_id": 80551309, "body": "[SPOILER] Once you&#39;ve solved this version, you should be able to improve performance by keeping track of the lists&#39; lengths yourself."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 4, "last_activity_date": 1508295106, "creation_date": 1508295106, "answer_id": 46802074, "question_id": 46800699, "link": "https://stackoverflow.com/questions/46800699/larger-branch-of-a-tree/46802074#46802074", "title": "Larger branch of a tree", "body": "<p><a href=\"https://stackoverflow.com/questions/46800699/larger-branch-of-a-tree#comment80548615_46800699\">As amalloy noted</a> the type you currently have in your question is not a tree:</p>\n\n<pre><code>data Tree t = Leaf | Branch t t\n</code></pre>\n\n<p>This is isomorphic to <code>Maybe (t,t)</code> - it either contains two <code>t</code> values, or nothing.</p>\n\n<p>The two most common binary trees that people define either have values at the branches:</p>\n\n<pre><code>       A\n     /   \\\n    B     C\n   / \\   / \\\n  D   * *   E\n / \\       / \\\n*   F     *   G\n   / \\       / \\\n  *   *     *   *\n</code></pre>\n\n<p>Or at the leaves:</p>\n\n<pre><code>       *\n     /   \\\n    *     *\n   / \\   / \\\n  *   3 4   *\n / \\       / \\\n0   *     5   *\n   / \\       / \\\n  1   2     6   7\n</code></pre>\n\n<p>Since you're looking for something that \"contains all the values of the nodes\nof the longest branch from the root to [a] leaf\", I'm assuming you're looking\nfor the former.</p>\n\n<p>This datatype can be defined as:</p>\n\n<pre><code>data Tree t = Leaf | Branch (Tree t) t (Tree t)\n</code></pre>\n\n<p>A <code>Leaf</code> is a height-0 tree. A <code>Branch</code> contains two subtrees and a value.</p>\n\n<p>Now, looking at the type of the desired function</p>\n\n<pre><code>longestBranch :: Tree a -&gt; [a]\n</code></pre>\n\n<p>We can break it down into two cases by the type:</p>\n\n<pre><code>longestBranch Leaf = _\nlongestBranch (Branch left value right) = \n  let longestLeft = longestBranch left\n      longestRight = longestBranch right\n  in _\n</code></pre>\n\n<p>Now for some leading questions:</p>\n\n<ul>\n<li><p>What is the longest branch starting at a <code>Leaf</code>?</p></li>\n<li><p>Given that <code>longestLeft</code> is the longest branch for the <code>left</code> subtree, and\nthat <code>longestRight</code> is the longest branch for the <code>right</code> subtree, can you\ndetermine what the longest branch for <code>Branch left value right</code> is?</p></li>\n</ul>\n"}], "owner": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508295106, "creation_date": 1508283073, "question_id": 46800699, "link": "https://stackoverflow.com/questions/46800699/larger-branch-of-a-tree", "title": "Larger branch of a tree", "body": "<p>If I have the data type:</p>\n\n<pre><code>data Tree t = Leaf | Branch t t\n</code></pre>\n\n<p>How can I make a function to get the longest branch of a tree? I want to get the answer in a list, that contains all the values of the nodes of the longest branch, from the root, to the leaf. Something like this:</p>\n\n<pre><code>longestBranch :: (Tree a) -&gt; [a]\n</code></pre>\n\n<p>Any suggestion?\nThanks.</p>\n"}, {"tags": ["list", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1508283379, "post_id": 46800638, "comment_id": 80548228, "body": "Use <code>pack = filter snd</code>"}, {"owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1508283536, "post_id": 46800638, "comment_id": 80548274, "body": "@4castle I would love to use that, but I am trying to do this without using any built in Haskell functions"}], "answers": [{"tags": [], "owner": {"reputation": 585, "user_id": 5086091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fnP9k.jpg?s=128&g=1", "display_name": "Cyril Cressent", "link": "https://stackoverflow.com/users/5086091/cyril-cressent"}, "is_accepted": false, "score": 2, "last_activity_date": 1508344950, "last_edit_date": 1508344950, "creation_date": 1508284770, "answer_id": 46800898, "question_id": 46800638, "link": "https://stackoverflow.com/questions/46800638/tuples-pattern-matching-list-haskell/46800898#46800898", "title": "Tuples Pattern Matching list Haskell", "body": "<p>I'm going to use the description of what you are trying to implement to show you what my steps towards a solution would be. Hopefully that helps you converge on your own solutions in the future. </p>\n\n<p>If I rephrase it, you want a function with the following signature:</p>\n\n<p><code>pack :: [(String, Bool)] -&gt; [(String, Bool)]</code></p>\n\n<p>That is, you have a list of 2-tuples (the first element being a <code>String</code>, the second element being a <code>Bool</code>) and you want to end up with a list of the same type.</p>\n\n<p>You want to <em>filter</em> all the tuples of this list and only keep the ones with a <code>True</code> value. The prelude happens to have a function just for that:</p>\n\n<p><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code></p>\n\n<p>The first argument of <code>filter</code>, a function <code>a -&gt; Bool</code> called a <em>predicate</em>, lets you define what you want to keep in the second argument (the first <code>[a]</code>).</p>\n\n<p>Note that <code>a</code> can be any type at all, so we could replace <code>a</code> with <code>(String, Bool)</code> and <code>filter</code> would have the following type:</p>\n\n<p><code>filter :: ((String, Bool) -&gt; Bool) -&gt; [(String, Bool)] -&gt; [(String, Bool)]</code></p>\n\n<p>It's starting to look closer and closer to our target signature for <code>pack</code>! What we are missing is the predicate <code>(String, Bool) -&gt; Bool</code> that will tell <code>filter</code> what we want to keep:</p>\n\n<pre><code>isTrue :: (String, Bool) -&gt; Bool\nisTrue (_, True)  = True\nisTrue (_, False) = False\n</code></pre>\n\n<p>Finally, we can implement <code>pack</code> in term of <code>filter</code> and <code>isTrue</code>:</p>\n\n<pre><code>pack :: [(String, Bool)] -&gt; [(String, Bool)]\npack = filter onlyTrue\n</code></pre>\n\n<p>You've mentioned in a comment that you do not want to use any \"built-in\" function. Let's get rid of <code>filter</code> then, and write <code>pack</code> closer to the original style you've posted:</p>\n\n<pre><code>pack [] = []\npack (x:xs)\n    | isTrue x  = x : pack xs\n    | otherwise = pack xs\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1508344950, "creation_date": 1508282561, "question_id": 46800638, "link": "https://stackoverflow.com/questions/46800638/tuples-pattern-matching-list-haskell", "title": "Tuples Pattern Matching list Haskell", "body": "<p>I am trying to implement a function where I have a list of 2-tuples and it returns the tuples that correspond to True. The first character is a String and the second character is a Boolean. This is what I want:</p>\n\n<pre><code>pack  [ (\"a\", True), (\"b\", False), (\"c\", False), (\"d\", True) ]\n       returns [ (\"a\", True), (\"d\", True)  ]\n</code></pre>\n\n<p>Here is my code:</p>\n\n<pre><code>pack :: [String] -&gt; [Bool] -&gt; [(String, Bool)]\npack [] [] = []\npack (x:xs) [] = []\npack [] (y:ys) = []\npack (x:xs) (True:ys) = (x, True) : pack xs ys\npack (x:xs) (False:ys) = pack xs ys\n</code></pre>\n\n<p>I can only get { returns [(\"a\", True), (\"d\", True)] } only by typing in</p>\n\n<pre><code>pack [\"a\", \"b\", \"c\", \"d\"] [True, False, False, True]\n</code></pre>\n\n<p>and this is not what I want and am confused how to approach this. Any help, guidance, or link would be much appreciated.</p>\n"}, {"tags": ["c", "haskell", "binding", "ffi", "storable"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1508276189, "post_id": 46799237, "comment_id": 80546086, "body": "Maybe you should first define the C type you are expecting to use as the counterpart of your Haskell <code>MyType a</code>. Your <code>sizeOf</code> seems to be a bit optimistic to me. Your C type will probably need an int/enum/whatever tag that helps you discriminate between the three Haskell constructors; the size of that tag should be added to all the sizes."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1508321183, "post_id": 46799237, "comment_id": 80562250, "body": "It&#39;s worth noting that <code>sizeOf</code> has, for historical reasons, the wrong signature. It should actually be <a href=\"http://hackage.haskell.org/package/tagged-0.8.5/docs/Data-Tagged.html#t:Tagged\" rel=\"nofollow noreferrer\"><code>Tagged a Int</code></a> (or <code>proxy a -&gt; Int</code>) rather than <code>a -&gt; Int</code>. That would make it clear that this can&#39;t actually <i>depend on individual values</i>, but should be the same for <i>all</i> value of a given type. (<a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Foreign-Storable.html#v:sizeOf\" rel=\"nofollow noreferrer\">The documentation</a> does say this, though.)"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1508334054, "post_id": 46799237, "comment_id": 80570266, "body": "@leftaroundabout even that signature is now historical. With <code>TypeApplications</code> and <code>AllowAmbigousTypes</code> it should <i>really</i> be <code>sizeOf :: Storable a =&gt; Int</code>, usable via <code>sizeOf @a</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1508334363, "post_id": 46799237, "comment_id": 80570505, "body": "@HTNW well, yeah, but that&#39;s a very recent kind of \u201chistorical\u201d. And it can&#39;t be made backwards-compatible with old GHC, let alone other Haskell implementations, so this isn&#39;t very practical yet for such a low-level feature."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 7, "last_activity_date": 1508276191, "creation_date": 1508276191, "answer_id": 46799613, "question_id": 46799237, "link": "https://stackoverflow.com/questions/46799237/how-do-i-create-a-storable-instance-for-a-recursive-type/46799613#46799613", "title": "How do I create a Storable instance for a recursive type?", "body": "<p>You can\u2019t have a <code>Storable</code> for this. These datatypes need to have a fixed size, just like  C <code>struct</code>s. Also, note that <code>sizeof</code> isn\u2019t supposed to inspect the value you give it. It\u2019s just a proxy/carrier for the type argument, so you can write e.g. <code>sizeof (undefined::Int)</code>. Maybe take a look at <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Foreign-Marshal-Array.html\" rel=\"noreferrer\"><code>Foreign.Marshal.Array</code></a></p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 46799613, "answer_count": 1, "score": 2, "last_activity_date": 1508321570, "creation_date": 1508274454, "last_edit_date": 1508321570, "question_id": 46799237, "link": "https://stackoverflow.com/questions/46799237/how-do-i-create-a-storable-instance-for-a-recursive-type", "title": "How do I create a Storable instance for a recursive type?", "body": "<p>I have the following data type in a Haskell module and I would like to write a Storable instace to use it with C via FFI : </p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data MyType a =\n        TypeDouble Double\n      | TypeLst [a] \n      | TypeAdd (MyType a) (MyType a) \n</code></pre>\n\n<p>I began by defining the <code>sizeOf</code> function : </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Storable a =&gt; Storable (MyType a)  where\n  sizeOf (TypeDouble _) = sizeOf (0 :: Double)\n  sizeOf (TypeLst lst)  = sum $ map sizeOf lst\n  sizeOf (TypeAdd a b)  = sizeOf a + sizeOf b\n</code></pre>\n\n<p>It compile well, but I don't know how to implement the <code>peek</code> and <code>poke</code> functions. I thought implementing  these functions the same way as in <a href=\"https://stackoverflow.com/a/30550050/3595992\">this answer</a> but this implementation work only if all the elements in the list have the same size which is not the case here.</p>\n\n<p><strong>What is the correct way to implement <code>peek</code> and <code>poke</code> functions for a recursive type where elements have a floating size ?</strong></p>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 4, "creation_date": 1508270426, "post_id": 46798211, "comment_id": 80543350, "body": "<code>?</code> isn&#39;t in that code. Can you please create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1508270746, "post_id": 46798211, "comment_id": 80543498, "body": "By the way, there&#39;s a <a href=\"https://en.wikipedia.org/wiki/1_%2B_2_%2B_3_%2B_4_%2B_%E2%8B%AF#Partial_sums\" rel=\"nofollow noreferrer\">more efficient algorithm for that</a>."}, {"owner": {"reputation": 15, "user_id": 4381900, "user_type": "registered", "profile_image": "https://graph.facebook.com/1407894642/picture?type=large", "display_name": "Santiago Aguilar", "link": "https://stackoverflow.com/users/4381900/santiago-aguilar"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1508270753, "post_id": 46798211, "comment_id": 80543500, "body": "thats all i&#39;ve written, &#39;?&#39; does not appear anywhere in the file"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1508270993, "post_id": 46798211, "comment_id": 80543634, "body": "It <a href=\"https://ideone.com/1aAz8B\" rel=\"nofollow noreferrer\">compiles fine for me</a>, so I&#39;m not sure what&#39;s causing that error. Could you try to isolate the problem some more until the problem goes away? Then post the code which produces the error."}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1508271000, "post_id": 46798211, "comment_id": 80543636, "body": "you&#39;ll face <code>Non-exhaustive patterns</code> exception for values <code>&lt; 1</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1508275778, "post_id": 46798211, "comment_id": 80545944, "body": "The error message references line 13; you&#39;ve only shown 4 lines of code. What else is in the file?"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 4381900, "user_type": "registered", "profile_image": "https://graph.facebook.com/1407894642/picture?type=large", "display_name": "Santiago Aguilar", "link": "https://stackoverflow.com/users/4381900/santiago-aguilar"}, "edited": false, "score": 0, "creation_date": 1508271029, "post_id": 46798342, "comment_id": 80543647, "body": "Thanks a lot! the original file was in spanish so it read sumatoria everywhere, i&#39;ve translated it to summation for posting it here and forgot to change that one. I like your approach, but i still want to understand why mine did no work."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 15, "user_id": 4381900, "user_type": "registered", "profile_image": "https://graph.facebook.com/1407894642/picture?type=large", "display_name": "Santiago Aguilar", "link": "https://stackoverflow.com/users/4381900/santiago-aguilar"}, "edited": false, "score": 0, "creation_date": 1508271092, "post_id": 46798342, "comment_id": 80543683, "body": "@SantiagoAguilar: somewhere your source code contains a question mark <code>?</code> between two variables. But we can not see that."}, {"owner": {"reputation": 15, "user_id": 4381900, "user_type": "registered", "profile_image": "https://graph.facebook.com/1407894642/picture?type=large", "display_name": "Santiago Aguilar", "link": "https://stackoverflow.com/users/4381900/santiago-aguilar"}, "edited": false, "score": 0, "creation_date": 1508271797, "post_id": 46798342, "comment_id": 80544040, "body": "i don&#39;t see &#39;?&#39; anywhere. I&#39;ve uploaded pictures of the file and output. thank you!!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1508270775, "creation_date": 1508270775, "answer_id": 46798342, "question_id": 46798211, "link": "https://stackoverflow.com/questions/46798211/summation-in-haskell-functional-programing/46798342#46798342", "title": "Summation in Haskell - functional programing", "body": "<p>It looks to me that there are two problems here:</p>\n\n<ol>\n<li>your recursive call calls <code>sumatoria</code> whereas your function is <code>summation</code>;</li>\n<li>you check for <code>n &gt; 1</code> and <code>n == 1</code> which is rather unsafe.</li>\n</ol>\n\n<p>We can resolve the problems by subsituting <code>sumatoria</code> by <code>summation</code>, and make the guards more safe:</p>\n\n<pre><code>summation :: Integer -&gt; Integer\nsummation n\n  | n &gt;= 1 = n + <b>summation</b> (n-1)\n  | <b>otherwise</b> = 0</code></pre>\n\n<p>Now it should work. We use <code>otherwise = 0</code> such that if we enter <code>0</code> or a negative number, we obtain <code>0</code>.</p>\n\n<p>Nevertheless we can still improve this function. First of all, we should not restrict ourselves to only <code>Integer</code>s. We can use any kind of <code>Num</code>eric type <code>a</code> that is <code>Ord</code>erable. So we can rewrite it to:</p>\n\n<pre><code>summation :: <b>(Num a, Ord a) =&gt; a</b> -&gt; <b>a</b>\nsummation n\n  | n &gt; 1 = n + <b>summation</b> (n-1)\n  | <b>otherwise</b> = 0</code></pre>\n\n<p>And furthermore the sum of <code>1..n</code> or <code>0..n</code> can be calculated by using:</p>\n\n<pre>n\n---\n\\         n * (n+1)\n/    i  = ---------\n---           2\ni=1</pre>\n\n<p>So we can write it as:</p>\n\n<pre><code>summation :: Integral a =&gt; a -&gt; a\nsummation n = div (n * (n+1)) 2\n</code></pre>\n\n<p>The <code>div :: Integral a =&gt; a -&gt; a -&gt; a</code> requires <code>a</code> to be <code>Integral</code>. In case the multiplication, increment, and division are all <em>O(1)</em> operations, this is an <em>O(1)</em> function now.</p>\n\n<p>Finally note that besides using recursion, you can also use functions like <code>sum</code>. In that case you could have used:</p>\n\n<pre><code>summation :: (Enum a, Num a) =&gt; a -&gt; a\nsummation n = sum [1..n]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 4381900, "user_type": "registered", "profile_image": "https://graph.facebook.com/1407894642/picture?type=large", "display_name": "Santiago Aguilar", "link": "https://stackoverflow.com/users/4381900/santiago-aguilar"}, "edited": false, "score": 0, "creation_date": 1508272049, "post_id": 46798535, "comment_id": 80544163, "body": "That was it!!! changing the character worked, i still don&#39;t know how i tipped it and why when i paste the code here it became a minus sign, but i don&#39;t think that is very important. thanks a lot!!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 10, "last_activity_date": 1508271574, "creation_date": 1508271574, "answer_id": 46798535, "question_id": 46798211, "link": "https://stackoverflow.com/questions/46798211/summation-in-haskell-functional-programing/46798535#46798535", "title": "Summation in Haskell - functional programing", "body": "<p>In your source file <code>clase4.hs</code>, the character you <em>think</em> is a standard ASCII minus sign in the expression <code>n-1</code> isn't.  Instead, you've probably used some other unicode character, like an \"en dash\" or something that only <em>looks</em> like a minus sign (perhaps because you've edited the file in something weird like Microsoft Word or copied and pasted the code from some source that was messing with the characters).</p>\n\n<p>Haskell is printing the invalid character as a \"?\" because, as far as it can tell, your output terminal doesn't support the encoding necessary to display the bad character.  (This is a common problem when running Haskell in a Windows environment, though it might happen on other platforms if things were set up strangely.)</p>\n\n<p>Open the source file with a proper text editor, highlight the \"minus sign\" and re-type it on your keyboard.  On a Spanish keyboard, this should be the key to the left of the bottom-right shift key; on a US keyboard, it's to the right of the zero key.</p>\n\n<p>If that fails, try copying and pasting your own program above from Stack Overflow into a brand new text file and compile that -- copying and pasting from your question is working fine for the rest of us.</p>\n"}], "owner": {"reputation": 15, "user_id": 4381900, "user_type": "registered", "profile_image": "https://graph.facebook.com/1407894642/picture?type=large", "display_name": "Santiago Aguilar", "link": "https://stackoverflow.com/users/4381900/santiago-aguilar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "closed_date": 1508359576, "accepted_answer_id": 46798535, "answer_count": 2, "score": 1, "last_activity_date": 1508290312, "creation_date": 1508270234, "last_edit_date": 1508290312, "question_id": 46798211, "link": "https://stackoverflow.com/questions/46798211/summation-in-haskell-functional-programing", "closed_reason": "Not suitable for this site", "title": "Summation in Haskell - functional programing", "body": "<p>I'm having trouble writing a simple function in Haskell... It is meant to calculate the sum of numbers from 1 to n. I'm not allowed to use if statements because my teacher want us to focus on functional programing. Any help would be appreciated. Thanks!</p>\n\n<pre><code>summation :: Integer -&gt; Integer\nsummation n\n  | n &gt; 1 = n + summation(n-1)\n  | n == 1 = 1\n</code></pre>\n\n<p>This is the output from GHCi:</p>\n\n<pre><code>clase4.hs:13:28: error:\n    Variable not in scope: (?) :: Integer -&gt; Integer -&gt; Integer\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Line 13 is:   </p>\n\n<pre><code>     | n &gt; 1 = n + summation(n-1)\n</code></pre>\n\n<p>I've commented everything else in the file and I still get that error. I cannot see '?' anywhere. These are the screen captures:</p>\n\n<p><img src=\"https://i.stack.imgur.com/q5nsR.png\" alt=\"File\"></p>\n\n<p><img src=\"https://i.stack.imgur.com/xw8Jc.png\" alt=\"GHCi output\"></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 7, "creation_date": 1508266493, "post_id": 46797262, "comment_id": 80541245, "body": "Where is your <code>else</code>?"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1508266592, "post_id": 46797262, "comment_id": 80541305, "body": "In Haskell, an &quot;if&quot; statement must &quot;return&quot; a value along <b>both</b> branches - without this property, it doesn&#39;t really make sense in a functional sense. The <code>if ... then ... else ...</code> expression is what you need, and it does require that <code>else</code>."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 7299999, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89356d13edb456935f7f2b45ba10dc57?s=128&d=identicon&r=PG&f=1", "display_name": "s4342re41", "link": "https://stackoverflow.com/users/7299999/s4342re41"}, "edited": false, "score": 0, "creation_date": 1508267001, "post_id": 46797315, "comment_id": 80541510, "body": "Ah thanks a lot, I wasn&#39;t aware that all branches need an else branch and that I don&#39;t need to always use = do when defining a function. Thanks!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 103, "user_id": 7299999, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89356d13edb456935f7f2b45ba10dc57?s=128&d=identicon&r=PG&f=1", "display_name": "s4342re41", "link": "https://stackoverflow.com/users/7299999/s4342re41"}, "edited": false, "score": 0, "creation_date": 1508271572, "post_id": 46797315, "comment_id": 80543919, "body": "@skacesmith Don&#39;t think of them as &#39;branches&#39;. Haskell&#39;s <code>if a then b else c</code> is the ternary operator (think <code>a ? b : c</code>), not a control flow mechanism (except in the case of using monads)."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1508266560, "creation_date": 1508266560, "answer_id": 46797315, "question_id": 46797262, "link": "https://stackoverflow.com/questions/46797262/parse-error-possibly-incorrect-indentation/46797315#46797315", "title": "Parse Error (Possibly Incorrect Indentation...)", "body": "<p>Your <code>if</code> needs an <code>else</code> (what do you want the value to be when <code>x</code> isn't 1?).</p>\n\n<p>Furthermore <code>do</code> notation is used when working with monads and doesn't make sense in this function.</p>\n"}], "owner": {"reputation": 103, "user_id": 7299999, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89356d13edb456935f7f2b45ba10dc57?s=128&d=identicon&r=PG&f=1", "display_name": "s4342re41", "link": "https://stackoverflow.com/users/7299999/s4342re41"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 46797315, "answer_count": 1, "score": 1, "last_activity_date": 1508266560, "creation_date": 1508266373, "question_id": 46797262, "link": "https://stackoverflow.com/questions/46797262/parse-error-possibly-incorrect-indentation", "title": "Parse Error (Possibly Incorrect Indentation...)", "body": "<p>When I run this code: </p>\n\n<pre><code>test1 :: Int -&gt; String\ntest1 x = do\n    if x == 1\n        then \"Hello\"\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>test-if.hs:4:21: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>I am not sure why this is as I am not using any brackets and I am using 4 spaces as my tabs. Adding brackets doesn't seem to help. What could be the issue?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "monads", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1508281142, "post_id": 46800267, "comment_id": 80547691, "body": "<code>&gt;&gt;=</code> is not associative in general, because its type <code>m a -&gt; (a -&gt; m b) -&gt; m b</code> isn&#39;t symmetric. <code>(a &gt;&gt;= b) &gt;&gt;= c</code> will type check as long as <code>a ~ b</code>, but <code>a &gt;&gt;= (b &gt;&gt;= c)</code> would require something along the lines of <code>m c ~ a -&gt; m b</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1508286051, "post_id": 46800267, "comment_id": 80548842, "body": "<code>m &gt;&gt;= (\\x -&gt; k x &gt;&gt;= h)  =  (m &gt;&gt;= k) &gt;&gt;= h</code> <i>is</i> the associative law from the Kleisli category with arrows <code>a -&gt; m b</code>, it&#39;s just written poorly. <code>a &gt;=&gt; (b &gt;=&gt; c) = (a &gt;=&gt; b) &gt;=&gt; c</code>"}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1508354797, "post_id": 46800267, "comment_id": 80582848, "body": "This is very helpful. (There is a small typo in your second definition of <code>&lt;*&gt;</code>: you write <code>=&gt;&gt;</code> twice where you mean <code>&gt;&gt;=</code>.)"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1508359307, "last_edit_date": 1508359307, "creation_date": 1508279926, "answer_id": 46800267, "question_id": 46796222, "link": "https://stackoverflow.com/questions/46796222/monad-laws-for-an-applicative-based-formulation/46800267#46800267", "title": "Monad laws for an applicative-based formulation", "body": "<p>The identity law is much easier to write</p>\n\n<pre><code>join . fmap pure = join . pure = id\n</code></pre>\n\n<p>The traditional monad right identity law follows immediately from the definition of <code>&gt;&gt;=</code>. The left identity law uses an <code>Applicative</code> law</p>\n\n<pre><code>m &gt;&gt;= k = join (fmap k m)\n\n-- proof for right identity\nm &gt;&gt;= return       = m\njoin (fmap pure m) = m  -- definition of &gt;&gt;=\nid m               = m  -- identity\nm                  = m  -- definition of id\n\n-- proof for left identity\nreturn a &gt;&gt;= f         = f a\njoin (fmap f (pure a)) = f a  -- definitions of &gt;&gt;= and return\njoin (pure (f a))      = f a  -- fmap f . pure = pure . f\nid (f a)               = f a  -- identity\nf a                    = f a  -- definition of id\n</code></pre>\n\n<p>The interesting law for a relationship between <code>Applicative</code> and <code>Monad</code> is</p>\n\n<pre><code>(&lt;*&gt;) = ap\n-- or\nm1 &lt;*&gt; m2 = m1 &gt;&gt;= (\\x1 -&gt; m2 &gt;&gt;= \\x2 -&gt; return (x1 x2)) -- definition of ap\n</code></pre>\n\n<p>In terms of <code>Applicative</code> and <code>join</code> this is</p>\n\n<pre><code>m1 &lt;*&gt; m2 = join (fmap (\\x1 -&gt; fmap x1 m2) m1)\n-- proof\nm1 &lt;*&gt; m2 = join (fmap (\\x1 -&gt; m2 &gt;&gt;= \\x2 -&gt; return (x1 x2)) m1)            -- definition of ap\nm1 &lt;*&gt; m2 = join (fmap (\\x1 -&gt; join (fmap (\\x2 -&gt; return (x1 x2)) m2)) m1)  -- definition of &gt;&gt;=\nm1 &lt;*&gt; m2 = join (fmap (\\x1 -&gt; join (fmap (\\x2 -&gt; pure (x1 x2)) m2)) m1)    -- return = pure\nm1 &lt;*&gt; m2 = join (fmap (\\x1 -&gt; join (fmap (pure . x1) m2)) m1)                 \nm1 &lt;*&gt; m2 = join (fmap (\\x1 -&gt; join (fmap pure (fmap x1 m2))) m1)           -- fmap (f . g) = fmap f . fmap g\nm1 &lt;*&gt; m2 = join (fmap (\\x1 -&gt; fmap x1 m2) m1)                              -- identity\n</code></pre>\n\n<p>There might be a more elegant way to write this.</p>\n\n<p>I haven't found a way to show that the <code>Monad</code> is associative based on</p>\n\n<ul>\n<li><code>Functor</code> and <code>Applicative</code> laws - particularly composition of <code>&lt;*&gt;</code></li>\n<li>The identities <code>join . fmap pure = join . pure = id</code></li>\n<li><code>(&lt;*&gt;) = ap</code></li>\n</ul>\n\n<p>and I'm not sure if it's true. I think you need the associative law <code>join . join = join . fmap join</code></p>\n"}], "owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1508359307, "creation_date": 1508262650, "question_id": 46796222, "link": "https://stackoverflow.com/questions/46796222/monad-laws-for-an-applicative-based-formulation", "title": "Monad laws for an applicative-based formulation", "body": "<p>Normally in Haskell we define <code>Monad</code>s in terms of <code>return</code> and <code>&gt;&gt;=</code>. Sometimes it's convenient to decompose <code>&gt;&gt;=</code> into <code>fmap</code> and <code>join</code>. The <code>Monad</code> laws for these two formulations are well known and fairly intuitive, once you get used to them.</p>\n\n<p>There's another way to define monads, in terms of an <code>Applicative</code> functor:</p>\n\n<pre><code>class Applicative f =&gt; MyMonad f where\n    myJoin :: f (f a) -&gt; f a\n</code></pre>\n\n<p>I'm wondering about the laws for this kind of formulation. Obviously, we <em>could</em> just adapt the <code>fmap</code> + <code>join</code> laws, as follows (I am not sure the names are particularly apt, but oh well):</p>\n\n<pre><code>myJoin . myJoin = myJoin . (pure myJoin &lt;*&gt;)       ('Associativity')\nmyJoin . pure   = myJoin . (pure pure   &lt;*&gt;) = id  ('Identity')\n</code></pre>\n\n<p>Clearly these conditions are sufficient for <code>pure</code>, <code>(&lt;*&gt;)</code>, and <code>myJoin</code> to form a monad (in the sense that they guarantee that <code>m `myBind` f = myJoin (pure f &lt;*&gt; m)</code> will be a well-behaved <code>&gt;&gt;=</code>). <strong>But are they necessary as well?</strong> It seems at least possible that the additional structure that <code>Applicative</code> supports above and beyond <code>Functor</code> might allow us to simplify these laws -- in other words, that some feature of the above laws might be otiose given that it is known that <code>pure</code> and <code>(&lt;*&gt;)</code> already satisfy the <code>Applicative</code> laws.</p>\n\n<p>(In case you're wondering why we'd even go to the trouble of bothering with this formulation given either of the two standard possibilities: I'm not sure it's all that useful or perspicuous in programming contexts, but it turns out to be so when you use <code>Monad</code>s to <a href=\"https://arxiv.org/abs/cs/0205026\" rel=\"noreferrer\">do natural langauge semantics</a>.)</p>\n"}, {"tags": ["macos", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1508262689, "post_id": 46796205, "comment_id": 80539113, "body": "Haskell expects an entry point to your program, in the form of a <code>main</code> function. If you want to load an interactive REPL, try <code>ghci test.hs</code> instead."}, {"owner": {"reputation": 475, "user_id": 3235560, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/d5mR4.jpg?s=128&g=1", "display_name": "exrezzo", "link": "https://stackoverflow.com/users/3235560/exrezzo"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1508263376, "post_id": 46796205, "comment_id": 80539525, "body": "thank you very much, that is what i was looking for."}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1508263613, "post_id": 46796205, "comment_id": 80539655, "body": "Since installing Haskell succeeded, the recommended next step would be to learn some Haskell. A good tutorial is available <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">here</a>."}], "answers": [{"comments": [{"owner": {"reputation": 475, "user_id": 3235560, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/d5mR4.jpg?s=128&g=1", "display_name": "exrezzo", "link": "https://stackoverflow.com/users/3235560/exrezzo"}, "edited": false, "score": 0, "creation_date": 1508263121, "post_id": 46796275, "comment_id": 80539359, "body": "Oh yes very nice! That is what I was looking for, because at the University I used to write a simple function in a .hs file, than after clicking it an interactive shell was opened (we use Windows machines). So that was what I was looking for, the command ghci. Thank you very much!"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1508277066, "post_id": 46796275, "comment_id": 80546461, "body": "I prefer <code>print (f 2)</code> since it avoids raising the question of what the <code>$</code> sigil means. Also I don&#39;t think there&#39;s much use in saying that <code>main</code> is a monadic function: &quot;monadic&quot; is confusing to a beginner, and &quot;function&quot; stands out as incorrect to an expert. I&#39;d rather just say that &quot;<code>main</code> is the IO action that is performed...&quot;, or even simpler than that &quot;<code>main</code> is the entry point to the rest of your program.&quot;"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1508340763, "last_edit_date": 1508340763, "creation_date": 1508262844, "answer_id": 46796275, "question_id": 46796205, "link": "https://stackoverflow.com/questions/46796205/haskell-first-steps-compile-error/46796275#46796275", "title": "Haskell first steps compile error", "body": "<p>With your program you <strong>have not instructed Haskell what the program should do</strong>. You only have <strong>defined a function</strong>. That does not mean that Haskell will automagically call that function.</p>\n\n<p>You need to define a function with a special name <code>main</code> (<code>ghc</code> has an option to specify another name, but let us ignore this for now). <code>main</code> is a function of the type <code>IO a</code>. It is a function that describes an action (<code>IO</code>) that is called when you execute the program.</p>\n\n<p>Since you only defined a single function <code>f</code>, you probably want to test <code>f</code>.</p>\n\n<p>So we can write a <code>main</code>:</p>\n\n<pre><code>main :: IO ()\nmain = print (f 2)\n</code></pre>\n\n<p>Now if add this to the program. The compiler will generate an executable that will execute <code>main</code>. Here <code>main</code> is quite simple: we instruct it to <code>print</code> the result of <code>f 2</code>. So it will print <code>4</code>. We call <code>main</code> the <em>entry point</em> of the program.</p>\n\n<p>You can also decide to run an <em>interactive</em> session instead. In that case you do not need an <em>entry point</em>, since you can decide in the interactive session what functions you will call.</p>\n\n<p>You can for instance use <code>ghci file.hs</code> to start an interactive sesion, and run:</p>\n\n<pre><code>$ ghci testprogram.hs \nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( testprogram.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; f 2\n4\n</code></pre>\n\n<p>So now we have called <code>f 2</code>, and the interactive session automatically prints the result <code>4</code>.</p>\n"}], "owner": {"reputation": 475, "user_id": 3235560, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/d5mR4.jpg?s=128&g=1", "display_name": "exrezzo", "link": "https://stackoverflow.com/users/3235560/exrezzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2503, "favorite_count": 0, "accepted_answer_id": 46796275, "answer_count": 1, "score": 6, "last_activity_date": 1508340763, "creation_date": 1508262575, "last_edit_date": 1592644375, "question_id": 46796205, "link": "https://stackoverflow.com/questions/46796205/haskell-first-steps-compile-error", "title": "Haskell first steps compile error", "body": "<p>I've just installed Haskell platform full with the installer from here <a href=\"https://www.haskell.org/platform/mac.html\" rel=\"noreferrer\">https://www.haskell.org/platform/mac.html</a></p>\n<p>Now, as the noob I am,  i created a very simple program, just to see if it works:</p>\n<pre><code>f :: Int -&gt; Int\nf x = x + 2\n</code></pre>\n<p>but when i execute</p>\n<pre><code>runhaskell test.hs\n</code></pre>\n<p>it returns</p>\n<blockquote>\n<p>test.hs:0:53: error:</p>\n<p>\u2022 Variable not in scope: main :: IO a0</p>\n<p>\u2022 Perhaps you meant \u2018min\u2019 (imported from Prelude)</p>\n</blockquote>\n<p>if i run</p>\n<pre><code>ghc test.hs\n</code></pre>\n<p>it returns</p>\n<blockquote>\n<p>The IO action \u2018main\u2019 is not defined in module \u2018Main\u2019</p>\n</blockquote>\n<p>indicating just the first char of the first line &quot;f&quot;</p>\n"}, {"tags": ["haskell", "cabal", "servant"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1508266436, "post_id": 46795895, "comment_id": 80541213, "body": "It could be that a more recent version of Cabal-install is required. Invoke <code>cabal update</code> followed by <code>cabal install cabal-install</code> to (hopefully) get the latest version, or get it from here <a href=\"https://www.haskell.org/cabal/download.html\" rel=\"nofollow noreferrer\">haskell.org/cabal/download.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": true, "score": 3, "last_activity_date": 1524466428, "last_edit_date": 1524466428, "creation_date": 1508270421, "answer_id": 46798262, "question_id": 46795895, "link": "https://stackoverflow.com/questions/46795895/cabal-error-unknown-fields-build-tool-depends-trying-to-follow-the-servant-tu/46798262#46798262", "title": "Cabal error `Unknown fields: build-tool-depends` trying to follow the servant tutorial", "body": "<p><code>build-tool-depends</code> is a new field of cabal 2.0. See <a href=\"http://coldwa.st/e/blog/2017-09-09-Cabal-2-0.html\" rel=\"nofollow noreferrer\">What's new in Cabal/cabal-install 2.0</a></p>\n\n<blockquote>\n  <p>New <code>build-tool-depends</code> field that replaces <code>build-tools</code> and has a better defined semantics (<a href=\"https://github.com/haskell/cabal/issues/3708\" rel=\"nofollow noreferrer\">#3708</a>, <a href=\"https://github.com/haskell/cabal/issues/1541\" rel=\"nofollow noreferrer\">#1541</a>). cabal-install will now install required build tools and add them to PATH automatically.</p>\n</blockquote>\n"}], "owner": {"reputation": 2434, "user_id": 1539208, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/9caf308063ca2a230238dabbcc99dcbb?s=128&d=identicon&r=PG", "display_name": "L42", "link": "https://stackoverflow.com/users/1539208/l42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 46798262, "answer_count": 1, "score": 0, "last_activity_date": 1524466428, "creation_date": 1508261434, "question_id": 46795895, "link": "https://stackoverflow.com/questions/46795895/cabal-error-unknown-fields-build-tool-depends-trying-to-follow-the-servant-tu", "title": "Cabal error `Unknown fields: build-tool-depends` trying to follow the servant tutorial", "body": "<p>I'm trying to follow <a href=\"http://haskell-servant.readthedocs.io/en/stable/tutorial/Server.html\" rel=\"nofollow noreferrer\">the servant tutorial</a> and I'm running into the Cabal error <code>Unknown fields: build-tool-depends</code>. This is my <code>tutorial.cabal</code> file (I got this from <a href=\"https://github.com/haskell-servant/servant/tree/master/doc/tutorial\" rel=\"nofollow noreferrer\">servant's github repo</a>):</p>\n\n<pre><code>name:                tutorial\nversion:             0.10\nsynopsis:            The servant tutorial\nhomepage:            http://haskell-servant.readthedocs.org/\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Servant Contributors\nmaintainer:          haskell-servant-maintainers@googlegroups.com\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nlibrary\n  exposed-modules:     Server\n  build-depends:       base == 4.*\n                     , base-compat\n                     , text\n                     , aeson\n                     , aeson-compat\n                     , blaze-html\n                     , directory\n                     , blaze-markup\n                     , containers\n                     , servant == 0.11.*\n                     , servant-server == 0.11.*\n                     , servant-client == 0.11.*\n                     , servant-docs == 0.11.*\n                     , servant-js &gt;= 0.9 &amp;&amp; &lt;0.10\n                     , warp\n                     , http-api-data\n                     , http-media\n                     , lucid\n                     , time\n                     , string-conversions\n                     , bytestring\n                     , attoparsec\n                     , mtl\n                     , random\n                     , js-jquery\n                     , wai\n                     , http-types\n                     , transformers\n                     , markdown-unlit &gt;= 0.4\n                     , http-client\n  default-language:    Haskell2010\n  ghc-options:         -Wall -pgmL markdown-unlit\n  build-tool-depends: markdown-unlit:markdown-unlit\n\ntest-suite spec\n  type: exitcode-stdio-1.0\n  ghc-options: -Wall\n  default-language: Haskell2010\n  hs-source-dirs: test\n  main-is: Spec.hs\n  other-modules: JavascriptSpec\n  build-depends: base == 4.*\n               , tutorial\n               , hspec\n               , hspec-wai\n               , string-conversions\n</code></pre>\n\n<p>Should <code>cabal build</code> be able to build this? This is the output I get:</p>\n\n<pre><code>\u279c  servant cabal build\nPackage has never been configured. Configuring with default flags. If this\nfails, please run configure manually.\nWarning: tutorial.cabal: Unknown fields: build-tool-depends (line 46)\nFields allowed in this section:\n...\n</code></pre>\n\n<p><code>cabal --version</code> gives:</p>\n\n<pre><code>cabal-install version 1.24.0.2\ncompiled using version 1.24.2.0 of the Cabal library\n</code></pre>\n\n<p>I don't think my <code>ApiType.hs</code> file matters for this error, but here it is just in case:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule Server where\n\nimport Prelude ()\nimport Prelude.Compat\n\nimport Control.Monad.Except\nimport Control.Monad.Reader\nimport Data.Aeson.Compat\nimport Data.Aeson.Types\nimport Data.Attoparsec.ByteString\nimport Data.ByteString (ByteString)\nimport Data.List\nimport Data.Maybe\nimport Data.String.Conversions\nimport Data.Time.Calendar\nimport GHC.Generics\nimport Lucid\nimport Network.HTTP.Media ((//), (/:))\nimport Network.Wai\nimport Network.Wai.Handler.Warp\nimport Servant\nimport System.Directory\nimport Text.Blaze\nimport Text.Blaze.Html.Renderer.Utf8\nimport qualified Data.Aeson.Parser\nimport qualified Text.Blaze.Html\n\ntype UserAPI =\n       \"users\" :&gt; Get '[JSON] [User]\n--  :&lt;|&gt; \"user\" :&gt; Capture \"id\" Integer :&gt; Get '[JSON] User\n--  :&lt;|&gt; \"user\" :&gt; ReqBody '[JSON] User :&gt; Post '[JSON] User\n\ndata User = User {\n  id :: Int,\n  name :: String,\n  age :: Int,\n  email :: String,\n  registration_date :: UTCTime\n}\n\ninstance ToJSON User\n\nusers1 :: [User]\nusers1 =\n  [ User 1 \"Isaac Newton\" 372 \"isaac@newton.co.uk\" (fromGregorian 1683 3 1)\n  , User 2 \"Albert Einstein\" 136 \"ae@mc2.org\" (fromGregorian 1905 12 1)\n  ]\n\nserver1 :: Server UserAPI\nserver1 = return users1\n\nuserAPI :: Proxy UserAPI\nuserAPI = Proxy\n\napp1 :: Application\napp1 = serve userAPI server1\n\nmain :: IO ()\nmain = run 8081 app1\n</code></pre>\n\n<p>Any help is very welcome!</p>\n"}, {"tags": ["haskell", "environment-variables", "cgi", "hugs"], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 2, "last_activity_date": 1508266102, "creation_date": 1508266102, "answer_id": 46797190, "question_id": 46795698, "link": "https://stackoverflow.com/questions/46795698/fetch-environment-variables-in-a-cgi-with-haskell-hugs-without-a-package/46797190#46797190", "title": "fetch environment variables in a cgi with haskell/hugs without a package", "body": "<p>Try <code>import System.Environment (getEnv)</code>. </p>\n"}], "owner": {"reputation": 319, "user_id": 7661188, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-msXBf4I0Obo/AAAAAAAAAAI/AAAAAAAAAMk/kLVJCnnUjas/photo.jpg?sz=128", "display_name": "azbc", "link": "https://stackoverflow.com/users/7661188/azbc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 46797190, "answer_count": 1, "score": 0, "last_activity_date": 1508266463, "creation_date": 1508260674, "last_edit_date": 1508266463, "question_id": 46795698, "link": "https://stackoverflow.com/questions/46795698/fetch-environment-variables-in-a-cgi-with-haskell-hugs-without-a-package", "title": "fetch environment variables in a cgi with haskell/hugs without a package", "body": "<p>I am writing a cgi-script in Haskell.\nI am restricted to use only hugs/runhugs.</p>\n\n<pre><code>#!/opt/local/bin/runhugs\n\nmodule Main where\n\nmain = do\n        putStrLn (\"content-type: text/plain\\n\")\n        putStrLn (\"Hello, Server!\")\n</code></pre>\n\n<p>So far so good.\nBut now I want to get the server's environment variables.\nFor example the \"SCRIPT_NAME\" environment variable.</p>\n\n<p>With bash I can do:</p>\n\n<pre><code>#!/bin/bash\n\necho \"content-type: text/plain;\"\necho \"\"\n\necho $SCRIPT_NAME\n</code></pre>\n\n<p>With the result: <code>/path/to/script.cgi</code> in the browser-window.</p>\n\n<p>For Haskell I found something alike: <code>script &lt;- getEnv \"SCRIPT_NAME\"</code>,\nbut</p>\n\n<pre><code>#!/opt/local/bin/runhugs\n\nmodule Main where\n\nmain = do\n        putStrLn (\"content-type: text/plain\\n\")\n        scriptname &lt;- getEnv \"SCRIPT_NAME\"\n        putStrLn scriptname\n</code></pre>\n\n<p>doesn't work.</p>\n\n<p>Is it possible to do it in a way sort of like that ?</p>\n\n<ol>\n<li>plain without an import, or</li>\n<li>with an import possible in hugs</li>\n</ol>\n"}, {"tags": ["haskell", "printing", "tree"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1508260021, "post_id": 46795487, "comment_id": 80537633, "body": "<code>(ejC x) ++ &quot;|-&quot; ++ y ++ &quot;-|&quot; ++ (ejC z)</code> should be <code>(ejC x) ++ &quot;|-&quot; ++ show y ++ &quot;-|&quot; ++ (ejC z)</code>"}, {"owner": {"reputation": 670, "user_id": 6877607, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/329d14d8a7a5ee78262458d53c198e95?s=128&d=identicon&r=PG", "display_name": "Carlos V&#225;zquez Losada", "link": "https://stackoverflow.com/users/6877607/carlos-v%c3%a1zquez-losada"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1508260361, "post_id": 46795487, "comment_id": 80537820, "body": "Your solution worked. So so so so and so thankful."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1508260716, "creation_date": 1508260716, "answer_id": 46795708, "question_id": 46795487, "link": "https://stackoverflow.com/questions/46795487/couldnt-match-expected-type-char-with-actual-type-a/46795708#46795708", "title": "Couldn&#39;t match expected type `[Char]&#39; with actual type `a&#39;", "body": "<p>GHC is telling you an awful lot here. It seems to be saying something about <code>y</code>, right? And about <code>(++)</code>? So, what are the types of those things?</p>\n\n<pre><code>y :: a\n(++) :: [t] -&gt; [t] -&gt; [t]\n</code></pre>\n\n<p>Well, since <code>y</code> is an argument to <code>(++)</code> it must be the case that <code>a</code> is the same type as <code>[t]</code>. And since <code>(\"-|\" ++ (ejC z))</code>, a String, is the other argument to <code>(++)</code>, that type must be String:</p>\n\n<pre><code>a ~ [t] ~ String\n</code></pre>\n\n<p>But your type signature says it works for any type <code>a</code> at all, not just String. Hence the error.</p>\n\n<p>You could fix this a couple ways. You could change your type signature to restrict <code>a</code> to be String:</p>\n\n<pre><code>ejC:: BinTree String -&gt; String\nejC = -- ...\n</code></pre>\n\n<p>It won't work on any type of tree, just String trees, but maybe that's what you wanted.</p>\n\n<p>Or, you could try to turn the <code>a</code> values in the tree into Strings somehow. There's one common way to turn a thing into a String, which is by using the <code>show</code> function, but it requires that the type have an instance of Show. So, add that constraint to your function signature, and call <code>show</code> in the function's body:</p>\n\n<pre><code>ejC:: Show a =&gt; BinTree a -&gt; String\nejC ET = \"\"\nejC (Branch x y z) = (ejC x) ++ \"|-\" ++ show y ++ \"-|\" ++ (ejC z)\n</code></pre>\n"}], "owner": {"reputation": 670, "user_id": 6877607, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/329d14d8a7a5ee78262458d53c198e95?s=128&d=identicon&r=PG", "display_name": "Carlos V&#225;zquez Losada", "link": "https://stackoverflow.com/users/6877607/carlos-v%c3%a1zquez-losada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 893, "favorite_count": 0, "accepted_answer_id": 46795708, "answer_count": 1, "score": 1, "last_activity_date": 1508260716, "creation_date": 1508259865, "question_id": 46795487, "link": "https://stackoverflow.com/questions/46795487/couldnt-match-expected-type-char-with-actual-type-a", "title": "Couldn&#39;t match expected type `[Char]&#39; with actual type `a&#39;", "body": "<p><strong><em>I've never seen this concrete question before in Stackoverflow and other questions didn't help me (I've tried before open this ask).</em></strong></p>\n\n<p>When I try to print a Binary Tree following this way:</p>\n\n<pre><code>data BinTree a = ET | Branch (BinTree a) a (BinTree a) deriving Show\n\nejC:: BinTree a -&gt; String\nejC ET = \"\"\nejC (Branch x y z) = (ejC x) ++ \"|-\" ++ y ++ \"-|\" ++ (ejC z)\n</code></pre>\n\n<p>The module gives this error:</p>\n\n<pre><code>Couldn't match expected type `[Char]' with actual type `a'\n`a' is a rigid type variable bound by\nthe type signature for ejC :: BinTree a -&gt; String at Types2.hs:24:7\nRelevant bindings include\nz :: BinTree a (bound at Types2.hs:26:17)\ny :: a (bound at Types2.hs:26:15)\nx :: BinTree a (bound at Types2.hs:26:13)\nejC :: BinTree a -&gt; String (bound at Types2.hs:25:1)\nIn the first argument of `(++)', namely `y'\nIn the second argument of `(++)', namely `y ++ \"-|\" ++ (ejC z)'\n</code></pre>\n\n<p>Thank you all.</p>\n"}, {"tags": ["list", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508261642, "post_id": 46795354, "comment_id": 80538504, "body": "You need to test whether <code>y</code> is true: if so, you return <code>x</code> followed by the list given by the recursive call; otherwise, you just return the list given by the recursive call."}, {"owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "edited": false, "score": 0, "creation_date": 1508274092, "post_id": 46795354, "comment_id": 80545222, "body": "<code>pickIt x y = [a | (a,b) &lt;- zip x y, b] :: [a] -&gt; [Bool] -&gt; [a]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1508262324, "last_edit_date": 1508262324, "creation_date": 1508260796, "answer_id": 46795739, "question_id": 46795354, "link": "https://stackoverflow.com/questions/46795354/compare-two-lists-with-pattern-matching-in-haskell/46795739#46795739", "title": "Compare two lists with pattern matching in Haskell", "body": "<p>Your type is wrong, you said you have a list of bools (in English) then your type said you have a single Bool.  Use <code>[Bool]</code> instead of <code>Bool</code>.</p>\n\n<p>You said (by example) that you want a list of the element from the first list, so <code>[a]</code>, as a result.  Then your code return tuples of <code>(a,Bool)</code> (i.e. see your <code>(x,y)</code> value).  Instead test if <code>y</code> is true and only if so cons on <code>x</code> via <code>x:</code>.</p>\n"}], "owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 46795739, "answer_count": 1, "score": -1, "last_activity_date": 1508262324, "creation_date": 1508259342, "question_id": 46795354, "link": "https://stackoverflow.com/questions/46795354/compare-two-lists-with-pattern-matching-in-haskell", "title": "Compare two lists with pattern matching in Haskell", "body": "<p>I am trying to implement a function where I have two lists, the first is of any type and the second is a Boolean, and I want it to return just the first list if it is equal to true. For example:</p>\n\n<pre><code>pickIt [1, 2, 3] [True, False, True]  returns [1, 3]\n</code></pre>\n\n<p>Here is my code:</p>\n\n<pre><code>pickIt :: [a] -&gt; Bool -&gt; [a]\npickIt (x:xs) (y:ys) = (x, y) : pickIt xs ys\npickIt _ _ = []\n</code></pre>\n\n<p>I think my type is wrong, but I am completely stumped on how to approach this. Any help, guidance, or a link to go in the right direction would be helpful.</p>\n"}, {"tags": ["haskell", "types", "printf", "type-signature", "hindley-milner"], "answers": [{"comments": [{"owner": {"reputation": 631, "user_id": 6514691, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ee33b08c26c153742e975d043ab892f?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Majpruz", "link": "https://stackoverflow.com/users/6514691/rick-majpruz"}, "edited": false, "score": 2, "creation_date": 1508259190, "post_id": 46794912, "comment_id": 80537148, "body": "Good clarification. So in a nutshell, code in Prelude is privileged. And one effect of ExtendedDefaultRules is the granting of extra privileges to my external code."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 12, "last_activity_date": 1508257647, "creation_date": 1508257647, "answer_id": 46794912, "question_id": 46793849, "link": "https://stackoverflow.com/questions/46793849/why-does-haskell-require-numbers-to-be-disambiguated-for-printf-but-not-for-show/46794912#46794912", "title": "why does Haskell require numbers to be disambiguated for printf but not for show?", "body": "<p>This is a quirk of the defaulting rules, which explicitly say that you may default a typeclass-polymorphic value to something monomorphic only when there are a fixed set of classes in the context:</p>\n\n<blockquote>\n  <p>In situations where an ambiguous type is discovered, an ambiguous type variable, <code>v</code>, is defaultable if:</p>\n  \n  <ul>\n  <li><code>v</code> appears only in constraints of the form <code>C v</code>, where <code>C</code> is a class, and</li>\n  <li>at least one of these classes is a numeric class, (that is, <code>Num</code> or a subclass of <code>Num</code>), and</li>\n  <li>all of these classes are defined in the <code>Prelude</code> or a standard library (Figures 6.2\u20136.3 show the numeric classes, and Figure 6.1 shows the classes defined in the <code>Prelude</code>.)</li>\n  </ul>\n  \n  <p>Each defaultable variable is replaced by the first type in the default list that is an instance of all the ambiguous variable\u2019s classes. It is a static error if no such type is found.</p>\n</blockquote>\n\n<p>(<a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3\" rel=\"noreferrer\">Section 4.3.4</a> of the Report.) The troubling one here is bullet point 3, because the <code>PrintfArg a</code> constraint on the type of <code>3 :: (Num a, PrintfArg a) =&gt; a</code> mentions the class <code>PrintfArg</code> which is not in the <code>Prelude</code>.</p>\n\n<p>GHC offers the <code>ExtendedDefaultRules</code> pragma to relax these rules, as described in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#ghc-flag--XExtendedDefaultRules\" rel=\"noreferrer\">the manual</a>:</p>\n\n<blockquote>\n  <p>Find all the unsolved constraints. Then:</p>\n  \n  <ul>\n  <li>Find those that are of form <code>(C a)</code> where <code>a</code> is a type variable, and partition those constraints into groups that share a common type variable <code>a</code>.</li>\n  <li>Keep only the groups in which at least one of the classes is an interactive class (defined below).</li>\n  <li>Now, for each remaining group G, try each type <em>ty</em> from the default-type list in turn; if setting <code>a</code> = <em>ty</em> would allow the constraints in G to be completely solved. If so, default <code>a</code> to <em>ty</em>.</li>\n  <li>The unit type <code>()</code> and the list type <code>[]</code> are added to the start of the standard list of types which are tried when doing type defaulting.</li>\n  </ul>\n  \n  <p>Note that any multi-parameter constraints <code>(D a b)</code> or <code>(D [a] Int)</code> do not participate in the process (either to help or to hinder); but they must of course be soluble once the defaulting process is complete.</p>\n</blockquote>\n\n<p>And indeed, turning on this pragma makes your file work:</p>\n\n<pre><code>{-# LANGUAGE ExtendedDefaultRules #-}\nimport Text.Printf\nmain = printf \"%d\\n\" 3\n</code></pre>\n"}], "owner": {"reputation": 631, "user_id": 6514691, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ee33b08c26c153742e975d043ab892f?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Majpruz", "link": "https://stackoverflow.com/users/6514691/rick-majpruz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 1, "accepted_answer_id": 46794912, "answer_count": 1, "score": 6, "last_activity_date": 1508257647, "creation_date": 1508254224, "question_id": 46793849, "link": "https://stackoverflow.com/questions/46793849/why-does-haskell-require-numbers-to-be-disambiguated-for-printf-but-not-for-show", "title": "why does Haskell require numbers to be disambiguated for printf but not for show?", "body": "<p>Why is <code>printf \"%d\\n\" 3</code> ambiguous but not <code>show 3</code>? Could the <code>printf</code> module be rewritten to provide automatic disambiguation? Presumably something like <code>show</code> must be done at the lower levels of <code>printf</code> ... or is there some crucial difference between <code>printf</code> and <code>show</code> that requires the disambiguation of numbers?</p>\n\n<p>If <code>printf</code> <strong>can</strong> be rewritten to automatically handle numbers without explicit disambiguation, then what is <code>show</code> doing right? How does <code>show</code> turn numbers into strings without the <code>:: Int</code> disambiguation of <code>printf</code>?</p>\n\n<p>Here is the correct operation of <code>show</code> (without any disambiguation) and also the correct operation of <code>printf</code> (with the disambiguation):</p>\n\n<pre><code>$ cat printStrLnShow3\nimport Text.Printf\nmain = putStrLn (show 3)\n$ runghc printStrLnShow3\n3\n$ cat printfWithInt3\nimport Text.Printf\nmain = printf \"%d\\n\" (3 :: Int)\n$ runghc printfWithInt3\n3\n</code></pre>\n\n<p>Here is the <em>ambiguous variable</em> error when <code>printf</code> does <strong>not</strong> disambiguate the number:</p>\n\n<pre><code>$ cat printfWithAmbiguous3\nimport Text.Printf\nmain = printf \"%d\\n\" 3\n$ runghc printfWithAmbiguous3\n\nprintfWithAmbiguous3:2:8:\n    No instance for (PrintfArg a0) arising from a use of `printf'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance [safe] PrintfArg Char -- Defined in `Text.Printf'\n      instance [safe] PrintfArg Double -- Defined in `Text.Printf'\n      instance [safe] PrintfArg Float -- Defined in `Text.Printf'\n      ...plus 12 others\n    In the expression: printf \"%d\" 3\n    In an equation for `main': main = printf \"%d\" 3\n\nprintfWithAmbiguous3:2:22:\n    No instance for (Num a0) arising from the literal `3'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance Num Double -- Defined in `GHC.Float'\n      instance Num Float -- Defined in `GHC.Float'\n      instance Integral a =&gt; Num (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      ...plus 11 others\n    In the second argument of `printf', namely `3'\n    In the expression: printf \"%d\" 3\n    In an equation for `main': main = printf \"%d\" 3\n</code></pre>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"tags": [], "owner": {"reputation": 3654, "user_id": 10354, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2ec80122197b474e2971705447ab1ed5?s=128&d=identicon&r=PG", "display_name": "MattoxBeckman", "link": "https://stackoverflow.com/users/10354/mattoxbeckman"}, "is_accepted": false, "score": 0, "last_activity_date": 1508260465, "creation_date": 1508260465, "answer_id": 46795638, "question_id": 46793721, "link": "https://stackoverflow.com/questions/46793721/using-haskell-turtles-filepath-with-readfile/46795638#46795638", "title": "Using Haskell Turtle&#39;s FilePath with readFile", "body": "<p>I did happen to find something that worked from <a href=\"https://bollu.github.io/teleport/\" rel=\"nofollow noreferrer\">this blog</a>.</p>\n\n<pre><code>import Filesystem.Path.CurrentOS as Path\n\nfilePathToString :: FilePath -&gt; String\nfilePathToString = Path.encodeString\n</code></pre>\n\n<p>Now I can call</p>\n\n<pre><code>csvData &lt;- BL.readFile $ filePathToString fname\n</code></pre>\n\n<p>and it works.  If anyone knows a more idomatic way of doing this, please comment!</p>\n"}, {"tags": [], "owner": {"reputation": 1817, "user_id": 1231408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/664df5610226a9aa6a239aaa4f2de4b9?s=128&d=identicon&r=PG", "display_name": "cydparser", "link": "https://stackoverflow.com/users/1231408/cydparser"}, "is_accepted": true, "score": 2, "last_activity_date": 1508967591, "creation_date": 1508967591, "answer_id": 46942486, "question_id": 46793721, "link": "https://stackoverflow.com/questions/46793721/using-haskell-turtles-filepath-with-readfile/46942486#46942486", "title": "Using Haskell Turtle&#39;s FilePath with readFile", "body": "<p>The conversion can also be performed without directly using <code>system-filepath</code>:</p>\n\n<pre><code>import qualified Data.Text as T\n\nfilePathToString :: FilePath -&gt; String\nfilePathToString = T.unpack . format fp\n</code></pre>\n"}], "owner": {"reputation": 3654, "user_id": 10354, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2ec80122197b474e2971705447ab1ed5?s=128&d=identicon&r=PG", "display_name": "MattoxBeckman", "link": "https://stackoverflow.com/users/10354/mattoxbeckman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 46942486, "answer_count": 2, "score": 0, "last_activity_date": 1508967591, "creation_date": 1508253805, "question_id": 46793721, "link": "https://stackoverflow.com/questions/46793721/using-haskell-turtles-filepath-with-readfile", "title": "Using Haskell Turtle&#39;s FilePath with readFile", "body": "<p>I am trying to use Haskell Turtle to do some CSV file processing, but I'm having trouble working with the <code>Turtle.FilePath</code> from the option parser.\nHere's an exampple:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Lib\n\nimport Control.Applicative\nimport qualified Data.ByteString.Lazy as BL\nimport Turtle\n\ndata Args = Args Turtle.FilePath\n  deriving Show\n\ntfpToStr :: Turtle.FilePath -&gt; String\ntfpToStr fpath = show fpath\n\ntfpToPfp :: Turtle.FilePath -&gt; Prelude.FilePath\ntfpToPfp fpath = show fpath\n\nparser :: Parser Args\nparser = Args &lt;$&gt; (argPath \"fname\" \"The file containing the data\")\n\nsname :: String\nsname = \"salaries.csv\"\n\nmain :: IO ()\nmain = do\n    Args fname &lt;- options \"Salary Printer\" parser\n    csvData &lt;- BL.readFile (tfpToStr fname)\n    -- csvData &lt;- BL.readFile sname\n    putStrLn $ show csvData\n</code></pre>\n\n<p>I have a file <code>salaries.csv</code> in the same directory.  If I run this, I get back <code>FilePath \"salaries.csv\": openBinaryFile: does not exist (No such file or directory)</code>.  Using <code>tfpToPfp</code> yields the same result.  If I comment out the first <code>readFile</code> and uncomment the other one that calls <code>BL.readFile sname</code> then it works perfectly.   I've also tried <code>csvData &lt;- BL.readFile $ fromString (tfpToStr fname)</code>, that also throws an error.</p>\n\n<p>Unfortunately, <code>BL.readFile</code> does not take a <code>Turtle.FilePath</code> directly; it complains that it didn't get a <code>Prelude.FilePath</code>.</p>\n\n<p>So how is one supposed to get a <code>Turtle.FilePath</code> into <code>BL.readFile</code>?</p>\n\n<p>I'm using stack resolver LTS-9.9 if that makes a difference.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1508252203, "post_id": 46791466, "comment_id": 80532970, "body": "I think you want to define <code>randItem&#39; :: SomeClass m =&gt; [a] -&gt; m a</code>, where <code>SomeClass</code> provides a function to use in place of <code>randomRIO</code>. Then, if you define an appropriate instance of <code>SomeClass</code> for <code>IO</code>, you can use <code>randItem&#39; [1..10] :: IO</code> to get a random value, or <code>randItem&#39; [1..10] :: SomeTestMonad</code> which provides an alternate, deterministic implementation of the <code>randomRIO</code> replacement for testing."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1508252258, "post_id": 46791466, "comment_id": 80533014, "body": "<code>randItem :: [a] -&gt; IO a</code> would then just be a specialization of <code>randItem&#39;</code> to the <code>IO</code> type."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1508252505, "post_id": 46791466, "comment_id": 80533209, "body": "@chepner Why define a new type class? What&#39;s wrong with <code>RandomGen</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1508252830, "post_id": 46791466, "comment_id": 80533421, "body": "@MarkSeemann Probably nothing; my Haskell skills aren&#39;t up actually implementing my suggestion, at least not quickly. (I tried using <code>RandomGen</code>, but couldn&#39;t put the pieces together correctly, so just posted the vague suggestion instead of an actual answer.)"}], "answers": [{"comments": [{"owner": {"reputation": 904, "user_id": 1842491, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/72068df07dd0dc2319fb2606661c4096?s=128&d=identicon&r=PG", "display_name": "Shay", "link": "https://stackoverflow.com/users/1842491/shay"}, "edited": false, "score": 0, "creation_date": 1508252817, "post_id": 46791854, "comment_id": 80533414, "body": "I&#39;m missing something with QuickCheck. Still can&#39;t see how to accomplish elem (IO Int) [Int]. Here&#39;s what I tried quickCheck ((\\list -&gt; elem (randItem list) list) :: [Int] -&gt; Bool) Very new to Haskell. I&#39;ll implement your second suggestion (randomR). Thank you."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 904, "user_id": 1842491, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/72068df07dd0dc2319fb2606661c4096?s=128&d=identicon&r=PG", "display_name": "Shay", "link": "https://stackoverflow.com/users/1842491/shay"}, "edited": false, "score": 1, "creation_date": 1508253192, "post_id": 46791854, "comment_id": 80533658, "body": "@Shay Try to write a function with the type <code>RandomGen g =&gt; g -&gt; Int -&gt; [a] -&gt; [a]</code>. I&#39;m away from my development environment for the next many hours, so that suggestion may contain a typo or two (I&#39;m writing this on my phone), but hopefully it should give you an idea on how to proceed."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1508261980, "post_id": 46791854, "comment_id": 80538717, "body": "&quot;All elements in the returned list should be elements of the list of candidates.&quot; -- I think this it is a consequence of the free theorem. If so, no need to test for that! :-)"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 7, "last_activity_date": 1531151585, "last_edit_date": 1531151585, "creation_date": 1508248281, "answer_id": 46791854, "question_id": 46791466, "link": "https://stackoverflow.com/questions/46791466/unit-testing-io-int-and-similar-in-haskell/46791854#46791854", "title": "Unit testing IO Int and similar in Haskell", "body": "<p>There's a couple of things you can do. If you're using QuickCheck, you could write the following properties:</p>\n\n<ul>\n<li>The length of the returned list should be equal to the input length.</li>\n<li>All elements in the returned list should be elements of the list of candidates.</li>\n</ul>\n\n<p>Apart from that, the beauty of Haskell's Random library is that (as most other Haskell code) it's deterministic. If, instead of basing your implementation on <code>randomRIO</code>, you could base it on <code>randomR</code> or <code>randomRs</code>. This would enable you to pass some known <code>RandomGen</code> values to some deterministic unit test cases (not QuickCheck). These could serve as regression tests.</p>\n\n<hr>\n\n<p>I've now published <a href=\"http://blog.ploeh.dk/2018/07/09/typing-and-testing-problem-23\" rel=\"nofollow noreferrer\">an article about the above approach</a>, complete with <a href=\"https://github.com/ploeh/HasProblem23\" rel=\"nofollow noreferrer\">source code</a>.</p>\n"}], "owner": {"reputation": 904, "user_id": 1842491, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/72068df07dd0dc2319fb2606661c4096?s=128&d=identicon&r=PG", "display_name": "Shay", "link": "https://stackoverflow.com/users/1842491/shay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 2, "accepted_answer_id": 46791854, "answer_count": 1, "score": 8, "last_activity_date": 1531151585, "creation_date": 1508247129, "last_edit_date": 1508252514, "question_id": 46791466, "link": "https://stackoverflow.com/questions/46791466/unit-testing-io-int-and-similar-in-haskell", "title": "Unit testing IO Int and similar in Haskell", "body": "<p>From <a href=\"https://wiki.haskell.org/H-99:_Ninety-Nine_Haskell_Problems\" rel=\"noreferrer\">Ninety-Nine Haskell Problems</a>:</p>\n\n<p><a href=\"https://wiki.haskell.org/99_questions/21_to_28\" rel=\"noreferrer\">Question 23</a>: <em>Extract a given number of randomly selected elements from a list.</em></p>\n\n<p>This is a partial solution. For simplicity, this code just selects one element from a list.</p>\n\n<pre><code>import System.Random (randomRIO)\n\nrandItem :: [a] -&gt; IO a\nrandItem xs = do\n    i &lt;- randomRIO (0,length xs - 1)\n    return $ xs !! i\n</code></pre>\n\n<p>so <code>randItem [1..10]</code> would return an <code>IO Int</code> that corresponds to (but does not equal) some Int from 1 through 10.</p>\n\n<p>So far, so good. But what kind of tests can I write for my randItem function? What relationship--if any--can I confirm between the input and output?</p>\n\n<p>I can use the same logic as the above function to produce <code>m Bool</code>, but I cannot figure out how to test for <code>m Bool</code>. Thank you.</p>\n"}, {"tags": ["scala", "haskell", "monads", "applicative"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1508242803, "post_id": 46789807, "comment_id": 80526222, "body": "Read <a href=\"https://stackoverflow.com/a/17673690/1048572\">this answer</a> on what &quot;more powerful&quot; means and what it doesn&#39;t."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1508242929, "post_id": 46789807, "comment_id": 80526321, "body": "&quot;<i>can I represent the ap function in terms of the bind function?</i>&quot; - Yes. Every monad is an applicative (you might need <code>of</code> + <code>bind</code>). &quot;<i>can I represent parallel execution with Monads?</i>&quot; Maybe, but unlikely. Not every applicative is a monad. &quot;<i>In other words...</i>&quot; - Nope, those are two very different questions."}, {"owner": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1508243513, "post_id": 46789807, "comment_id": 80526725, "body": "<i>&quot;Every monad is an applicative&quot;</i> &amp; <i>&quot;Applicatives are useful to represent parallel execution&quot; = _&quot;I can represent execution with Monads&quot;</i>... right?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1508243927, "post_id": 46789807, "comment_id": 80526995, "body": "No. Your representation of parallel execution (which you haven&#39;t posted unfortunately) may fulfill the applicative laws, but the monad laws might not hold for it. If it&#39;s not a monad in the first place, it doesn&#39;t help that every monad is an applicative."}, {"owner": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1509094289, "post_id": 46789807, "comment_id": 80889386, "body": "If I have two monadic values <code>mf: m(a-&gt;b)</code> and <code>ma: m a</code>, and the combine them with <code>ap</code>, I would assume that it represents two parallel computations that are eventually combined. Unlike <code>bind</code>,that takes a monadic value and a function returning a monadic value, effectively representing sequential execution. But if <code>ap</code> is represented using <code>bind</code> the power of parallelization is lost."}, {"owner": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1509094426, "post_id": 46789807, "comment_id": 80889478, "body": "Just like it happens with Monix <code>Task</code>s (unlike scala <code>Future</code>s), if I don&#39;t use gather or something to explicitly parallelise, they will execute sequentially. So I&#39;m starting to think that the real power of <code>ap</code> cannot be expressed with <code>bind</code>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1509095997, "post_id": 46789807, "comment_id": 80890525, "body": "I&#39;m starting to think that you are just looking for something with a similar type to <code>ap</code> that does something entirely different :-) Yes, parallelism usually would be explicit, unless its seen purely as an implementation optimisation that is not reasoned about."}], "answers": [{"comments": [{"owner": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "edited": false, "score": 0, "creation_date": 1508243116, "post_id": 46790058, "comment_id": 80526452, "body": "Would it actually be executed in parallel?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "edited": false, "score": 1, "creation_date": 1508243228, "post_id": 46790058, "comment_id": 80526522, "body": "@caeus That would depend on the type, but as <i>Bergi</i> wrote, while all monads are applicative, not all applicatives are monads."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1508256967, "post_id": 46790058, "comment_id": 80535956, "body": "<a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Monad.html#t:Monad\" rel=\"nofollow noreferrer\">The <code>Monad</code> laws</a> say that <code>&lt;*&gt;</code> should be the same as <code>ap</code>, so <i>technically</i> a type with a monadic interface shouldn&#39;t override <code>&lt;*&gt;</code> to do parallel computation. In practice you see people bending the rules (eg <a href=\"https://github.com/facebook/Haxl\" rel=\"nofollow noreferrer\">Haxl</a>) by defining a <code>&lt;*&gt;</code> which is <i>morally</i> equivalent to <code>ap</code>, even though it may actually behave slightly differently. (In Haxl&#39;s case, <code>&lt;*&gt;</code> runs computations in parallel whereas <code>ap</code> runs them sequentially.)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1508258273, "post_id": 46790058, "comment_id": 80536661, "body": "I decided to write that out as an <a href=\"https://stackoverflow.com/a/46795027/1523776\">answer</a>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1508242976, "creation_date": 1508242976, "answer_id": 46790058, "question_id": 46789807, "link": "https://stackoverflow.com/questions/46789807/can-i-represent-non-sequential-parallel-execution-with-monads/46790058#46790058", "title": "Can I represent non-sequential/parallel execution with Monads?", "body": "<p>You can implement <code>&lt;*&gt;</code>, and therefore also <code>ap</code>, from <code>Functor</code> and <code>Monad</code>:</p>\n\n<pre><code>class Functor m =&gt; Monad m where\n  join :: m (m a) -&gt; m a\n  return :: a -&gt; m a\n\n(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\nm &gt;&gt;= f = join $ fmap f m\n\n(&lt;*&gt;) :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\nfs &lt;*&gt; xs = fs &gt;&gt;= \\f -&gt; xs &gt;&gt;= \\x -&gt; return (f x)\n\nap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\nap = (&lt;*&gt;)\n</code></pre>\n\n<p>This examples hides Haskell's standard <code>Monad</code> definition, and instead defines <code>Monad</code> in terms of <code>join</code> and <code>return</code>, but you can also define <code>join</code> from <code>(&gt;&gt;=)</code>; both ways work.</p>\n"}, {"comments": [{"owner": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "edited": false, "score": 0, "creation_date": 1508243928, "post_id": 46790066, "comment_id": 80526996, "body": "Indeed, what if I&#39;m using Monix tasks or cats IO monad? (which are more referentially transparent than futures)?"}, {"owner": {"reputation": 14006, "user_id": 3798102, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100002464470905/picture?type=large", "display_name": "pamu", "link": "https://stackoverflow.com/users/3798102/pamu"}, "reply_to_user": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "edited": false, "score": 0, "creation_date": 1508244302, "post_id": 46790066, "comment_id": 80527215, "body": "I depends on implementation mostly."}, {"owner": {"reputation": 14006, "user_id": 3798102, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100002464470905/picture?type=large", "display_name": "pamu", "link": "https://stackoverflow.com/users/3798102/pamu"}, "reply_to_user": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "edited": false, "score": 0, "creation_date": 1508244356, "post_id": 46790066, "comment_id": 80527255, "body": "But if there is no data dependence, if implementation cares about speed and performance then It makes sense to go parallel even in case of monads"}], "tags": [], "owner": {"reputation": 14006, "user_id": 3798102, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100002464470905/picture?type=large", "display_name": "pamu", "link": "https://stackoverflow.com/users/3798102/pamu"}, "is_accepted": false, "score": 0, "last_activity_date": 1508243313, "last_edit_date": 1508243313, "creation_date": 1508242988, "answer_id": 46790066, "question_id": 46789807, "link": "https://stackoverflow.com/questions/46789807/can-i-represent-non-sequential-parallel-execution-with-monads/46790066#46790066", "title": "Can I represent non-sequential/parallel execution with Monads?", "body": "<p>Consider a case: Lets say we have two futures.</p>\n\n<pre><code>val future1 = Future {\n  //some long running computation\n  1\n}\n\nval future2 = Future {\n // some othe long running computation\n 2\n}\n\nfuture1.flatMap(_ =&gt; future2)\n</code></pre>\n\n<p>In the above case, <code>future1</code> and <code>future2</code> run parallelly provided enough threads are there in the execution pool.</p>\n\n<p>We are able to run the futures parallelly. So, what does this mean?</p>\n\n<p>Monads come into picture when there is data dependence between previous and current tasks (monads). But, if there is no data dependence when they can be run parallelly (at least in case of futures).</p>\n\n<p>Now consider a case:</p>\n\n<pre><code>val future1 = Future {\n // long running task\n 1\n}\n\ndef compute(value: Int) = Future { value + 1}\n\nfuture1.flatMap(value =&gt; compute(value))\n</code></pre>\n\n<p>Now one future runs after the completion of others. Now execution has to be serial because of data dependency. Second future depends on the value of first future.</p>\n"}, {"comments": [{"owner": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "edited": false, "score": 1, "creation_date": 1508258748, "post_id": 46795027, "comment_id": 80536902, "body": "Wait! ap and &lt;*&gt; are diferent?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "edited": false, "score": 0, "creation_date": 1508258804, "post_id": 46795027, "comment_id": 80536931, "body": "Usually, no. In Haxl&#39;s case, yes, but they&#39;re bending the rules."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1508281347, "post_id": 46795027, "comment_id": 80547747, "body": "My understanding is that the equalities in laws are usually interpreted as <b>extensional</b> equalities. And so if <code>&lt;*&gt;</code> always returns the same the same results as <code>ap</code>, then it doesn&#39;t matter if it&#39;s implemented differently. And in particular if it&#39;s able to use parallel execution and always get the same result as it would from sequential executing (which isn&#39;t possible for all monads), then that would be allowed. Is that not correct?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1508281702, "post_id": 46795027, "comment_id": 80547828, "body": "@Ben <code>&lt;*&gt;</code> is a pure function whose return value is a <i>computation</i> <code>m a</code>. A computation which runs in parallel is different to a computation that runs sequentially, even if the <code>a</code> it returns ends up being the same. If you can catch two computations behaving differently, eg by using a database profiler to see queries happening in parallel, they must be different computations! <code>forkIO foo</code> is a different computation than <code>foo</code>, and you should be suspicious of any formulation of algebraic laws which ask you to consider them the same!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1508281921, "post_id": 46795027, "comment_id": 80547889, "body": "That said, I do agree that your point does apply to eg <code>parSeq</code>, which takes a pure computation and parallelises it. There\u2019s no way to observe a computation written with <code>parSeq</code> <i>behaving</i> differently to one written without. (It might compute a value faster, but it always returns the same value.)"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1508287169, "post_id": 46795027, "comment_id": 80549098, "body": "That&#39;s the point I&#39;m making. There are plenty of types for which <code>x &lt;*&gt; y</code> and <code>m ``ap`` y</code> produce the same value, and you&#39;d never be able to tell if <code>&lt;*&gt;</code> used <code>parSeq</code> internally. So the sequential bind-based code for <code>ap</code> plus the requirement that <code>(&lt;*&gt;) = ap</code> don&#39;t add up to a general conclusion that <code>&lt;*&gt;</code> must be sequential for all monads. For some <b>particular</b> monads where the difference would be observable, it <i>is</i> a requirement, but that&#39;s not what your answer says."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1508287410, "post_id": 46795027, "comment_id": 80549150, "body": "And &quot;<code>m a</code> is a computation&quot; is just an interpretation, and I don&#39;t think that you can validly infer that an <code>m a</code> that&#39;s produced sequentially is different from one that was produced in parallel, for all monads. Monad/Applicative includes things like <code>Maybe</code>, so your <code>m a</code> &quot;computation&quot; could be <code>Just 7</code>. Is a <code>Just 7</code> I produced by evaluating <code>Just (+1)</code> and <code>Just 6</code> in parallel and then combining them different from one I produced by first evaluating the <code>Just (+1)</code> and then the <code>Just 6</code> and then combining them? &quot;Monads are computations&quot; isn&#39;t any more accurate than &quot;monads are containers&quot;."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1508287980, "post_id": 46795027, "comment_id": 80549279, "body": "I think we\u2019re talking past each other. I agree with you that <code>&lt;*&gt;</code> can be implemented lawfully using <code>parSeq</code> even though <code>ap</code> doesn&#39;t use it. One should draw a distinction between the evaluation strategy used to produce a value and the computational process that is denoted by that value; the former is not observable directly, whereas the latter is. The sense in which Haxl bends the rules is that <code>f &lt;*&gt; x</code> denotes a <i>different effect</i> than <code>ap f x</code>. Namely, <code>f &lt;*&gt; x</code> denotes a process which performs concurrent IO, but <code>ap f x</code> denotes a process performing sequential IO."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1508258427, "last_edit_date": 1508258427, "creation_date": 1508258031, "answer_id": 46795027, "question_id": 46789807, "link": "https://stackoverflow.com/questions/46789807/can-i-represent-non-sequential-parallel-execution-with-monads/46795027#46795027", "title": "Can I represent non-sequential/parallel execution with Monads?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Monad.html#t:Monad\" rel=\"nofollow noreferrer\">The <code>Monad</code> laws</a> have something to say about this:</p>\n\n<blockquote>\n  <p>Furthermore, the Monad and Applicative operations should relate as\n  follows:</p>\n\n<pre><code>pure = return\n(&lt;*&gt;) = ap\n</code></pre>\n</blockquote>\n\n<p>Given that <code>ap</code> is <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.Base.html#ap\" rel=\"nofollow noreferrer\">defined</a> to compose computations sequentially,</p>\n\n<pre><code>ap mf mx = do\n    f &lt;- mf\n    x &lt;- mx\n    return (f x)\n</code></pre>\n\n<p>there's only one way to read that law: a type which exposes a monadic interface <em>cannot</em> use <code>Applicative</code> to do parallel computation. You could provide a <code>newtype</code> wrapper for your monad which has a parallel <code>Applicative</code> instance and <em>no</em> <code>Monad</code> instance, but you can't do both at the same time.</p>\n\n<hr>\n\n<p>In theory, theory and practice are the same, but in practice, they are not. In the real world you do in fact see people bending these rules and interpreting the above law to mean that <code>(&lt;*&gt;)</code> should be <em>morally</em> equivalent to <code>ap</code>, even if it's not <em>exactly</em> equivalent.</p>\n\n<p>The best example of this that I know happens to be the one which directly addresses your question. <a href=\"https://github.com/facebook/Haxl\" rel=\"nofollow noreferrer\">Haxl</a> is a library implementing a domain-specific language for concurrent IO. The <code>GenHaxl</code> monad's <code>&lt;*&gt;</code> automatically parallelises two computations where possible, whereas its <code>&gt;&gt;=</code> runs them in sequence (because it has to). This clearly goes against the letter of the law, but since Haxl is meant to be used for database <em>reads</em> which don't mutate anything (rather than <em>writes</em>, which do) you can kinda get away with it and the world doesn't explode.</p>\n"}], "owner": {"reputation": 1510, "user_id": 2142728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b3ca006aaf7a1160f11d133c2762e75f?s=128&d=identicon&r=PG", "display_name": "Alejandro Navas", "link": "https://stackoverflow.com/users/2142728/alejandro-navas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1508258427, "creation_date": 1508242197, "last_edit_date": 1508244555, "question_id": 46789807, "link": "https://stackoverflow.com/questions/46789807/can-i-represent-non-sequential-parallel-execution-with-monads", "title": "Can I represent non-sequential/parallel execution with Monads?", "body": "<p>So I've finally understood why Applicatives are very useful to represent parallel execution, while Monads very useful to represent sequential execution.</p>\n\n<p>That being said, I've also understood that Monads are more powerful than Applicatives, so can I represent the <code>ap</code> function in terms of the <code>bind</code> function?</p>\n\n<p>In other words... can I represent parallel execution with Monads?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1508242814, "post_id": 46789241, "comment_id": 80526231, "body": "Personally, I don&#39;t think this is good practice. The POST itself should return the data (with ids etc. filled in by the server). Otherwise you force the client to do one more HTTP request for no good reason."}, {"owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1508250197, "post_id": 46789241, "comment_id": 80531473, "body": "If I do that the browser will show an alert about a form resend if I click refresh after the form has been submitted and the create action has returned the new html content."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1508250533, "post_id": 46789241, "comment_id": 80531700, "body": "Ah yes, I can see how this makes sense for a form-based HTML API.... I was thinking JSON."}], "answers": [{"comments": [{"owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "edited": false, "score": 0, "creation_date": 1508247304, "post_id": 46789834, "comment_id": 80529416, "body": "Thanks! I think that would be a great addition to Servant."}], "tags": [], "owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "is_accepted": true, "score": 14, "last_activity_date": 1508242274, "creation_date": 1508242274, "answer_id": 46789834, "question_id": 46789241, "link": "https://stackoverflow.com/questions/46789241/redirections-in-servant/46789834#46789834", "title": "Redirections in Servant", "body": "<p>There is one simple (but slightly hacky) answer, and a lead for making the first option obsolete (EDIT: and a third, better option, actually).</p>\n\n<p>The current typical solution for this is to simply use the fact that the <code>Handler</code> monad has a <code>MonadError ServantErr</code> instance, and that <code>ServantErr</code> is a very general \"response type\" that can indeed describe the HTTP response for an application error, but also a redirect or many other things really. So you can do something like <code>throwError $ err301 { errHeaders = [(\"Location\", \"https://haskell.org/\")] }</code>. It's ugly because we hijack the \"erroring out\" bit for some successful workflow. But it works, and is a single line of code.</p>\n\n<p>I have explored alternative approaches, that let you mix type-safe links with redirects to easily redirect to other endpoints/pages of your app. This is outdated now but could probably be made to work without toooo much trouble.</p>\n\n<p>And upon seeing this question, I just now thought of a third option. Took a bit of time to experiment with it and looks like it works! You can see the code with an example of using it in <a href=\"https://gist.github.com/alpmestan/757094ecf9401f85c5ba367ca20b8900\" rel=\"noreferrer\">this gist</a>. Let me know if you have any question. We might want to add some of this to servant. Feel free to bring it up on the issue tracker if you think this is good enough. The gist of this approach is to define a custom <code>PostRedirect</code> that has the right shape (no response body, a Location header with a type of your choice, and parametrized by the status code that you want your redirect to use), and a little function that wraps the location appropriately before returning.</p>\n"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 968, "favorite_count": 3, "accepted_answer_id": 46789834, "answer_count": 1, "score": 11, "last_activity_date": 1508242274, "creation_date": 1508240308, "question_id": 46789241, "link": "https://stackoverflow.com/questions/46789241/redirections-in-servant", "title": "Redirections in Servant", "body": "<p>What's the appropriate way to make a Servant handler respond with a redirection? I am working in a navigation REST app and I would like to respond to POST requests that create resources with a redirection to the corresponding GET resource list paths. So for instance <strong>POST /foos</strong> should redirect to <strong>GET /foos</strong> after creating a foo. I could not find a clear way to do that in the documentation.</p>\n"}, {"tags": ["list", "haskell", "permutation", "combinatorics"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1508228161, "post_id": 46785290, "comment_id": 80517273, "body": "You can look at the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/src/Data.OldList.html#permutations\" rel=\"nofollow noreferrer\">implementation in base</a> which has a good discussion in <a href=\"https://stackoverflow.com/questions/24484348\">this question and answer</a>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 9, "last_activity_date": 1508228746, "creation_date": 1508228746, "answer_id": 46785702, "question_id": 46785290, "link": "https://stackoverflow.com/questions/46785290/permutation-implementation-in-haskell/46785702#46785702", "title": "Permutation implementation in Haskell", "body": "<p>Avoid <code>!!,head,tail</code> in favor of pattern matching. Such functions are partial, and can crash your program when the list is too short. Pattern matching (when exhaustive) has no such issues.</p>\n\n<p><code>length, take, drop</code> are often better left unused.</p>\n\n<p>Instead, let us consider the simple recursion:</p>\n\n<pre><code>perms :: [a] -&gt; [[a]]\nperms []     = [[]]\nperms (x:xs) = doSomething x (perms xs)\n</code></pre>\n\n<p>How to turn <code>perms xs</code> into <code>perms (x:xs)</code>? In each permutation <code>p</code> of <code>xs</code>, we need to insert <code>x</code> at any possible point of <code>p</code>. We get</p>\n\n<pre><code>perms :: [a] -&gt; [[a]]\nperms []     = [[]]\nperms (x:xs) = [ p' | p &lt;- perms xs, (use insert here) ]\n</code></pre>\n\n<p>where inserting at all points is done as follows</p>\n\n<pre><code>insert :: a -&gt; [a] -&gt; [[a]]\ninsert x [] = [[x]]\ninsert x (y:ys) = ... -- todo\n</code></pre>\n\n<p>I'll leave to you to complete the code.</p>\n"}, {"comments": [{"owner": {"reputation": 419, "user_id": 4278306, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wRZQS.jpg?s=128&g=1", "display_name": "Be Wake Pandey", "link": "https://stackoverflow.com/users/4278306/be-wake-pandey"}, "edited": false, "score": 0, "creation_date": 1508243035, "post_id": 46788491, "comment_id": 80526392, "body": "Thanks!! I should have thought about this."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1508449978, "last_edit_date": 1508449978, "creation_date": 1508237861, "answer_id": 46788491, "question_id": 46785290, "link": "https://stackoverflow.com/questions/46785290/permutation-implementation-in-haskell/46788491#46788491", "title": "Permutation implementation in Haskell", "body": "<p>With </p>\n\n<pre><code>picks :: [t] -&gt; [([t], t)]\npicks [] = []\n-- picks [x] = [([],x)]\npicks (x:xs) = [(xs,x)] ++ [(x:ys,y) | (ys,y) &lt;- picks xs]\n</code></pre>\n\n<p>it is, straightforwardly,</p>\n\n<pre><code>perms :: [t] -&gt; [[t]]\nperms [] = [[]]\nperms xs =         -- [(x:zs) | (ys,x) &lt;- picks xs, zs &lt;- perms ys]  \n  do                     \n    (ys,x) &lt;- picks xs        -- pick an element, any element\n    zs     &lt;- perms ys        -- permute what's left\n    return (x:zs)             -- and put them together     \n</code></pre>\n\n<hr>\n\n<p><em>edit:</em> The repetitive pattern of creating and passing around the updated domain suggests that we can do better, i.e. make it so that the correct domains are passed around automatically behind the scenes for us, as a part of this specific computational model's <em>\"pipeline\"</em>, as it were. </p>\n\n<p>Right now we have to worry about making a mistake, to name the interim domains explicitly, and to be extra careful to pass the correct variable around as the domain to be used. It's good to have these worries taken care of automatically for us.</p>\n\n<p>Specific <a href=\"https://dl.acm.org/citation.cfm?id=116984\" rel=\"nofollow noreferrer\">notions of computation</a> are captured with a specific instance of a <code>Monad</code> type class.</p>\n\n<p>With the help of <a href=\"https://stackoverflow.com/a/9831493/849891\">\"unique selection\" monad</a> from an answer by <a href=\"https://stackoverflow.com/users/869736/louis-wasserman\">Louis Wasserman</a>, </p>\n\n<pre><code>newtype UniqueSel t a = UniqueSel {runUS :: [t]  -&gt;  [ ([t],  a) ] }\n--                                       domain   updated_dom, result\ninstance Functor (UniqueSel t) where\n    fmap = liftM\ninstance Applicative (UniqueSel t) where\n    pure a = UniqueSel (\\ choices -&gt; [(choices, a)])    -- unchanged domain\n    (&lt;*&gt;)  = ap \ninstance Monad (UniqueSel t) where\n    return  = pure\n    m &gt;&gt;= k = UniqueSel (\\ choices -&gt; [ r | (cs, a) &lt;- runUS m choices,\n                                            r       &lt;- runUS (k a) cs ])\n</code></pre>\n\n<p>we could re-write the above <em>list-based</em> <code>do</code> code as <em><code>UniqueSel</code>-based</em> <code>do</code> code, </p>\n\n<pre><code>perm = do { x &lt;- UniqueSel picks ; xs &lt;- perm ; return (x:xs) }\n</code></pre>\n\n<p>where all the interim domain tracking variables have just disappeared! The nature of what we're doing here has become much clearer and more apparent. There's no distractions anymore.</p>\n\n<p>This last code snippet won't work though, as we don't guard against making a selection from an empty domain, which <em>will</em> happen and <em>will</em> effectively abort all computations, producing just <code>[]</code> in the end. We need to <em>return</em> an <code>[]</code> as the result for the empty domains, ourselves. </p>\n\n<p>We could introduce new <em>\"primitive\"</em> action in our little <em>uniquely-selecting computations</em> language, to bring the hidden choices into <em>our</em> universe, with <code>choices = UniqueSel (\\cs -&gt; [(cs, cs)])</code>; and branch on the empty domain, like</p>\n\n<pre><code>perm = do { cs &lt;- choices ; if (null cs) then return [] else\n            do {  x &lt;- UniqueSel picks ; xs &lt;- perm ; return (x:xs) } }\n</code></pre>\n\n<p>and run this <em>computation description</em> that we've built, by using <code>perms = map snd . runUS perm</code>;  but this pattern is already captured for us in the standard library, in the module  <code>Control.Monad</code>, as the function <code>sequence</code>; so we can just define</p>\n\n<pre><code>perms :: [t] -&gt; [[t]]\nperms = map snd . (runUS =&lt;&lt; sequence . (UniqueSel picks &lt;$))\n\n-- perms xs = map snd $ runUs (sequence [UniqueSel picks | _ &lt;- xs]) xs\n--          = .....           (replicateM (length xs) (UniqueSel picks)) xs\n</code></pre>\n\n<p>This runs the input through the sequence of picks of the same length as the input.</p>\n\n<p>Indeed, to permute an <code>n</code>-long list is to make <code>n</code> arbitrary selections from the ever shrinking pool of possible choices.</p>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 1824967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hfA7z.jpg?s=128&g=1", "display_name": "Aleks Sidorenko", "link": "https://stackoverflow.com/users/1824967/aleks-sidorenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1592991227, "creation_date": 1592991227, "answer_id": 62551952, "question_id": 46785290, "link": "https://stackoverflow.com/questions/46785290/permutation-implementation-in-haskell/62551952#62551952", "title": "Permutation implementation in Haskell", "body": "<p>Recursion version, having the implementation of permutations for <code>N - 1</code>, in order to get the implementation for <code>N</code> you need just to take <code>N-th</code> element and insert it into every possible position of permutations for <code>N - 1</code></p>\n<pre><code>permutations :: [a] -&gt; [[a]]\npermutations [] = [[]]\npermutations [a] = [[a]]\npermutations (x:xs) =  (&gt;&gt;=) (permutations xs)  (merge x)\n    where\n        insertAt :: Int -&gt; a-&gt; [a] -&gt; [a] \n        insertAt z y xs = as ++ (y:bs)\n                  where (as,bs) = splitAt z xs\n        merge :: a -&gt; [a] -&gt; [[a]]\n        merge x p = map (\\i -&gt; insertAt i x p) [0..length p]\n</code></pre>\n"}], "owner": {"reputation": 419, "user_id": 4278306, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wRZQS.jpg?s=128&g=1", "display_name": "Be Wake Pandey", "link": "https://stackoverflow.com/users/4278306/be-wake-pandey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2303, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1592991227, "creation_date": 1508227257, "last_edit_date": 1555574975, "question_id": 46785290, "link": "https://stackoverflow.com/questions/46785290/permutation-implementation-in-haskell", "title": "Permutation implementation in Haskell", "body": "<p>I was trying to implement permutation of a list in Haskell. The idea for permutations is this: </p>\n\n<p>The base cases are when list length is 0 and 1 which is the list itself, and when size is 2, the permutation gives the list itself along with swapped elements.  </p>\n\n<p>Now, given a list [a,b,c,d] we permute [b,c,d] and append with a. and we change our list to have b in the first like [b,a,c,d] and permute [a,c,d] and so on, recursively. </p>\n\n<p>So far, I have done the following code in Haskell. Which perfectly works. But I am not satisfied with the level of 'haskell-ness' that this contains. I would like to have some hints on how to make this more readable and efficient in haskell. Thanks in advance. The code is below:  </p>\n\n<pre><code>-- swap the first element of a list with the element at the index\nswapFirstWith index l | index == 0 = l\n                      | otherwise =  [l!!index]\n                        ++ (take (index-1) (tail l))\n                        ++ [head l]\n                        ++ (drop (index+1) l)\n\n\npermutations :: [a] -&gt; [[a]]\npermutations [] = [[]]\npermutations [a] = [[a]]\npermutations [a,b] = [[a,b], [b,a]]\npermutations lst = foldl (++) [] (map (\\x-&gt; miniperms x) swappedList)\n    where miniperms l = map (\\x-&gt; (head l): x) $ permutations (tail l)\n          swappedList = map (\\(i, x) -&gt; swapFirstWith i lst) (zip [0..] lst)\n\n\nmain = do\n    putStrLn $ show $ perms\n    putStrLn $ show $ length perms\n    where lst = [1,2,3,4,5,6,7,8,9]\n          perms =  permutations lst\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1508218364, "post_id": 46783028, "comment_id": 80512456, "body": "I&#39;m voting to close this question as off-topic because SO is not a replacement for a tutorial or introductory textbook when taking the first steps toward learning a new language."}], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 4, "last_activity_date": 1508219709, "last_edit_date": 1508219709, "creation_date": 1508219402, "answer_id": 46783293, "question_id": 46783028, "link": "https://stackoverflow.com/questions/46783028/how-to-use-data-types-in-haskell-after-you-defined-them/46783293#46783293", "title": "How to use data types in Haskell after you defined them?", "body": "<p>I'm going to add a few derived instances to your types.</p>\n\n<pre><code>data Suit = Club | Diamond | Heart | Spade\n  deriving (Bounded, Enum, Eq, Ord, Show)\n\ndata Value\n  = Two | Three | Four | Five | Six | Seven | Eight\n  | Nine | Ten | Jack | Queen | King | Ace\n  deriving (Bounded, Enum, Eq, Ord, Show)\n\ntype Card = (Suit, Value)\n\ntype Deck = [Card]\n</code></pre>\n\n<p>Here are some decks.</p>\n\n<pre><code>royalFlush :: Deck\nroyalFlush = [ (Spade, v) | v &lt;- [Ten .. Ace] ]\n\ncompleteDeck :: Deck\ncompleteDeck =\n  [ (s, v) | v &lt;- [minBound .. maxBound], s &lt;- [minBound .. maxBound] ]\n</code></pre>\n\n<p>Here's a function to find all the clubs in a deck.</p>\n\n<pre><code>filterClubs :: Deck -&gt; Deck\nfilterClubs = filter (\\(s, v) -&gt; s == Club)\n</code></pre>\n\n<p>With the help of the <a href=\"https://hackage.haskell.org/package/random\" rel=\"nofollow noreferrer\"><code>random</code></a> package, we can pick a random card:</p>\n\n<pre><code>import System.Random\n\nrandomCard :: IO Card\nrandomCard =\n  let r xs = (xs !!) &lt;$&gt; randomRIO (0, length xs - 1)\n  in  (,) &lt;$&gt; r [minBound .. maxBound] &lt;*&gt; r [minBound .. maxBound]\n</code></pre>\n\n<p>Better yet, let's use the <a href=\"https://hackage.haskell.org/package/random-shuffle\" rel=\"nofollow noreferrer\"><code>random-shuffle</code></a> package, and now we can shuffle a deck:</p>\n\n<pre><code>import System.Random.Shuffle\n\nshuffleDeck :: Deck -&gt; IO Deck\nshuffleDeck = shuffleM\n</code></pre>\n\n<p>Here's a function that tells you how many points each trick is worth for an undoubled bet in <a href=\"https://en.wikipedia.org/wiki/Bridge_scoring#Contract_points\" rel=\"nofollow noreferrer\">bridge</a>.</p>\n\n<pre><code>import Numeric.Natural\n\npoints :: Suit -&gt; Natural\npoints Heart   = 30\npoints Spade   = 30\npoints Club    = 20\npoints Diamond = 20\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 5315175, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/296dc19f4ed9e20d6aad9039b8af8d86?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Johnny Sotoparra", "link": "https://stackoverflow.com/users/5315175/christian-johnny-sotoparra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "closed_date": 1508221555, "answer_count": 1, "score": 0, "last_activity_date": 1508219709, "creation_date": 1508218001, "last_edit_date": 1508218250, "question_id": 46783028, "link": "https://stackoverflow.com/questions/46783028/how-to-use-data-types-in-haskell-after-you-defined-them", "closed_reason": "Not suitable for this site", "title": "How to use data types in Haskell after you defined them?", "body": "<p>I defined a data <code>Suit</code> and a data <code>Value</code> for a deck of cards.  I also defined the type <code>Card</code> and type <code>Deck</code>.  But I have no idea how to use them.</p>\n\n<pre><code>data Suit = Club | Diamond | Heart | Spade\n\ndata Value = Two | Three | Four | Five | Six | Seven | Eight | Nine | Ten | \n  Jack | Queen | King | Ace\n\ntype Card = (Suit, Value)\n\ntype Deck = [Card]\n</code></pre>\n\n<p>Can someone give me an example of how to use the these?</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1508226047, "post_id": 46782331, "comment_id": 80516080, "body": "Turning on warnings with the <code>-Wall</code> flag makes GHC warn about the missed cases at compile time. Recommended."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1508216081, "post_id": 46782659, "comment_id": 80511714, "body": "And, as a cute trick, you could consider <code>sum&#39;&#39; (x:xs) (y:ys) = ...; sum _ _ = ...</code> if your <code>[] []</code>, <code>(x:xs) []</code>, and <code>[] (y:ys)]</code> clauses all return the same thing."}, {"owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "edited": false, "score": 0, "creation_date": 1508217709, "post_id": 46782659, "comment_id": 80512231, "body": "@Fyodor Soikin Thank you for the help, but I am still confused as to how do the second part of the question. sum&#39;&#39; [1,2] [4,5,6] returns only [5,7] and drops the 6 in the second list"}, {"owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1508219034, "post_id": 46782659, "comment_id": 80512734, "body": "@DanielWagner Would you happen to know how do the second part of the question. sum&#39;&#39; [1,2] [4,5,6] returns only [5,7] and drops the 6 in the second list. Not literally do it, but any guidance is appreciated. I tried doing this : sum _ _ = ... if your [] [], (x:xs) [], and [] (y:ys)], but it only gave me an error. All the clauses return the same thing."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "reply_to_user": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "edited": false, "score": 0, "creation_date": 1508219660, "post_id": 46782659, "comment_id": 80512974, "body": "@legoniko If one of the lists is shorter, the recursion will ultimately reach the case where one is empty and the other one isn&#39;t. You need to define what the result is in those two cases in order to get what you want."}, {"owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1508219939, "post_id": 46782659, "comment_id": 80513082, "body": "@molbdnilo Thank you! I made a grammatical error and that is why it was not working. It is nice to know the reasoning behind the code. Thank you again!"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 4, "last_activity_date": 1508215676, "creation_date": 1508215676, "answer_id": 46782659, "question_id": 46782331, "link": "https://stackoverflow.com/questions/46782331/adding-contents-of-two-different-size-lists-haskell/46782659#46782659", "title": "Adding contents of two different size lists haskell", "body": "<p>When defining <code>sum''</code>, you have defined what it means for two empty lists, and for two non-empty lists, but you haven't defined what it means for two lists, only one of which is empty. This is what the compiler is telling you via that error message.</p>\n\n<p>Simply add definitions of what <code>sum''</code> means whenever left list is empty and the right list is not, and vice versa:</p>\n\n<pre><code>sum'' (x:xs) [] = ...\nsum'' [] (y:ys) = ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1508270169, "last_edit_date": 1508270169, "creation_date": 1508269855, "answer_id": 46798106, "question_id": 46782331, "link": "https://stackoverflow.com/questions/46782331/adding-contents-of-two-different-size-lists-haskell/46798106#46798106", "title": "Adding contents of two different size lists haskell", "body": "<p>Well in Haskell, actually for what you need there is the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\"><code>ZipList</code></a> type and you may use it to simply do as follows;</p>\n\n<pre><code>import Control.Applicative\n\naddLists :: Num a =&gt; [a] -&gt; [a] -&gt; [a]\naddLists xs ys = getZipList $ (+) &lt;$&gt; ZipList xs &lt;*&gt; ZipList ys\n\n*Main&gt; addLists [3] [1,2,3]\n[4]\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 46782659, "answer_count": 2, "score": 2, "last_activity_date": 1508270169, "creation_date": 1508213391, "last_edit_date": 1508257674, "question_id": 46782331, "link": "https://stackoverflow.com/questions/46782331/adding-contents-of-two-different-size-lists-haskell", "title": "Adding contents of two different size lists haskell", "body": "<p>I am trying to implement a function that sums the contents of two lists. Here is my code:</p>\n\n<pre><code>sum'' :: Num a =&gt; [a] -&gt; [a] -&gt; [a]\nsum'' [] [] = []\nsum'' (x:xs) (y:ys) = (x + y) : sum'' xs ys\n</code></pre>\n\n<p>If I type in:</p>\n\n<pre><code>sum'' [1,2,3] [4,5,6]\n</code></pre>\n\n<p>I get <code>[5,7,9]</code>, which is what I want. What I am having trouble with is different list sizes. If I type in:</p>\n\n<pre><code>sum'' [] [1,2,3]\n</code></pre>\n\n<p>I want it to return <code>[]</code>. Or</p>\n\n<pre><code>sum'' [1,2] [4,5,6]\n</code></pre>\n\n<p>I want it to return <code>[5,7]</code>. I am getting this error and do not know why: <code>Non-exhaustive patterns in function sum''</code>.</p>\n\n<p>Any help would be much appreciated.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "edited": false, "score": 2, "creation_date": 1508207291, "post_id": 46781587, "comment_id": 80509455, "body": "Why do you omit the first element by _?"}, {"owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "reply_to_user": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "edited": false, "score": 0, "creation_date": 1508207447, "post_id": 46781587, "comment_id": 80509492, "body": "@qxg I did not know their was a difference between _ and using the variable x."}, {"owner": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "edited": false, "score": 0, "creation_date": 1508207753, "post_id": 46781587, "comment_id": 80509577, "body": "_ means unused variable."}, {"owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "reply_to_user": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "edited": false, "score": 0, "creation_date": 1508207826, "post_id": 46781587, "comment_id": 80509595, "body": "@qxg Gotcha. That makes more sense now. Both ways work perfectly. Thank you so much!"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1508212191, "post_id": 46781587, "comment_id": 80510644, "body": "There is no particular difference between using <code>_</code> and using <code>x</code> in your provided implementation. <code>_</code> does formally require that the parameter be unused, but renaming it to <code>x</code> won&#39;t cause it to be used if you don&#39;t refer to it!"}, {"owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1508212314, "post_id": 46781587, "comment_id": 80510678, "body": "@amalloy That makes sense now and is clearer going into the future. Thank you for the explanations!"}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1508211580, "post_id": 46781639, "comment_id": 80510504, "body": "That second equation isn&#39;t quite right. The product of an empty collection is <code>1</code>, just like its sum is <code>0</code>, because they are identities. You don&#39;t handle that case."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1508212246, "post_id": 46781639, "comment_id": 80510658, "body": "I was actually thinking about just pointing the first equation to <code>product&#39; xs = foldl (*) 1 xs</code>, but that works too."}], "tags": [], "owner": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "is_accepted": true, "score": 2, "last_activity_date": 1508212158, "last_edit_date": 1508212158, "creation_date": 1508207576, "answer_id": 46781639, "question_id": 46781587, "link": "https://stackoverflow.com/questions/46781587/multiplying-contents-of-list-in-haskell/46781639#46781639", "title": "Multiplying Contents of list in Haskell", "body": "<p>Just write</p>\n\n<pre><code>product' :: Num a =&gt; [a] -&gt; a\nproduct' = foldl (*) 1\n</code></pre>\n\n<p>or</p>\n\n<pre><code>product' :: Num a =&gt; [a] -&gt; a\nproduct' [] = 1\nproduct' (x:xs) = foldl (*) x xs\n</code></pre>\n\n<p>if you wish to keep parameter.</p>\n"}], "owner": {"reputation": 93, "user_id": 8645908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ac0060648db103008eb6511095b26837?s=128&d=identicon&r=PG&f=1", "display_name": "legoniko", "link": "https://stackoverflow.com/users/8645908/legoniko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 46781639, "answer_count": 1, "score": 0, "last_activity_date": 1508212158, "creation_date": 1508207133, "last_edit_date": 1508209067, "question_id": 46781587, "link": "https://stackoverflow.com/questions/46781587/multiplying-contents-of-list-in-haskell", "title": "Multiplying Contents of list in Haskell", "body": "<p>I am a beginner in Haskell and am trying to implement a function that returns the contents of a list multiplied together. Here is my code:</p>\n\n<pre><code>product' :: Num a =&gt; [a] -&gt; a\nproduct' [] = 1\nproduct' (_:xs) = foldl (*) 1 xs\n</code></pre>\n\n<p>In the command line, I type product in:</p>\n\n<pre><code>product' [2,3,4]\n</code></pre>\n\n<p>and I get 12 instead of 24. I know it has to do with the first element of the list not being read, but I cannot figure it out. Any help or guidance would be much appreciated.</p>\n"}, {"tags": ["haskell", "types", "printf", "ghci"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1508222084, "post_id": 46781579, "comment_id": 80514001, "body": "You know the putStr is not needed?"}, {"owner": {"reputation": 631, "user_id": 6514691, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ee33b08c26c153742e975d043ab892f?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Majpruz", "link": "https://stackoverflow.com/users/6514691/rick-majpruz"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1508252329, "post_id": 46781579, "comment_id": 80533070, "body": "Thank @augustss. I did not realize this. I just tried out your tip. Of course, dropping the <code>putStr</code> doesn&#39;t remove the <i>literal 3 ambiguous</i> error. But now the correct expression reduces to just <code>main = printf &quot;abc%d\\n&quot; (3 :: Int)</code>. ... The mathematical succinctness of Haskell is one of its most beautiful features because it helps to illuminate the essence of an algorithm, especially with the strong use of Hindley-Milner although the number can&#39;t be disambiguated in this situation."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 4, "last_activity_date": 1508209059, "creation_date": 1508209059, "answer_id": 46781808, "question_id": 46781579, "link": "https://stackoverflow.com/questions/46781579/why-must-the-number-type-be-declared-in-printf-when-used-with-putstr-for-a-scr/46781808#46781808", "title": "Why must the number type be declared in printf (when used with putStr) for a script but not for ghci?", "body": "<p>GHCi simply has relaxed defaulting rules enabled by default (so that literal <code>5</code> defaults to <code>Integer</code>), just to make your life easier.</p>\n\n<p>You can achieve a similar effect in GHC by enabling <code>ExtendedDefaultRules</code>.</p>\n\n<p>See <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">GCHi docs</a> for a more elaborate discussion of this.</p>\n"}], "owner": {"reputation": 631, "user_id": 6514691, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ee33b08c26c153742e975d043ab892f?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Majpruz", "link": "https://stackoverflow.com/users/6514691/rick-majpruz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 46781808, "answer_count": 1, "score": 1, "last_activity_date": 1508214039, "creation_date": 1508207061, "last_edit_date": 1508214039, "question_id": 46781579, "link": "https://stackoverflow.com/questions/46781579/why-must-the-number-type-be-declared-in-printf-when-used-with-putstr-for-a-scr", "title": "Why must the number type be declared in printf (when used with putStr) for a script but not for ghci?", "body": "<p>Why is the <code>3</code> ambiguous in <code>putStr (printf \"abc%d\\n\" 3)</code> when running as a script but then <strong>not</strong> ambiguous when running in ghci? That is, why must I declare the type of <code>3</code> in the script but not ghci?</p>\n\n<p>Here is operation within <code>ghci</code>:</p>\n\n<pre><code>$ ghci\nGHCi, version 7.6.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; putStr \"abc3\\n\"\nabc3\nPrelude&gt; import Text.Printf\nPrelude Text.Printf&gt; printf \"abc%d\\n\" 3\nabc3\nPrelude Text.Printf&gt; let main = putStr (printf \"abc%d\\n\" 3)\nPrelude Text.Printf&gt; main\nabc3\nPrelude Text.Printf&gt; let main = printf \"abc%d\\n\" 3 :: String\nPrelude Text.Printf&gt; main\n\"abc3\\n\"\nPrelude Text.Printf&gt; :quit\nLeaving GHCi.\n</code></pre>\n\n<p>Here is correct operation of the <code>script</code> when declaring as <code>Int</code>:</p>\n\n<pre><code>$ cat runmain-good\n#!/usr/bin/env runghc\nimport Text.Printf\nmain = putStr (printf \"abc%d\\n\" (3 :: Int))\n$ ./runmain-good\nabc3\n</code></pre>\n\n<p>Here is erroneous operation of the <code>script</code> with when the type of <code>3</code> is ambiguous ... with the typical user-friendly Haskell error:</p>\n\n<pre><code>$ cat runmain-bad\n#!/usr/bin/env runghc\nimport Text.Printf\nmain = putStr (printf \"abc%d\\n\" 3)\n$ ./runmain-bad\n\nrunmain-bad:3:16:\n    No instance for (PrintfArg a0) arising from a use of `printf'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance [safe] PrintfArg Char -- Defined in `Text.Printf'\n      instance [safe] PrintfArg Double -- Defined in `Text.Printf'\n      instance [safe] PrintfArg Float -- Defined in `Text.Printf'\n      ...plus 12 others\n    In the first argument of `putStr', namely `(printf \"abc%d\" 3)'\n    In the expression: putStr (printf \"abc%d\" 3)\n    In an equation for `main': main = putStr (printf \"abc%d\" 3)\n\nrunmain-bad:3:33:\n    No instance for (Num a0) arising from the literal `3'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance Num Double -- Defined in `GHC.Float'\n      instance Num Float -- Defined in `GHC.Float'\n      instance Integral a =&gt; Num (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      ...plus 11 others\n    In the second argument of `printf', namely `3'\n    In the first argument of `putStr', namely `(printf \"abc%d\" 3)'\n    In the expression: putStr (printf \"abc%d\" 3)\n</code></pre>\n"}, {"tags": ["c", "haskell", "exception", "binding", "ffi"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1508212132, "post_id": 46781376, "comment_id": 80510632, "body": "You can use <code>&lt;!-- lanuage: blah --&gt;</code> comments before code blocks to make them highlight properly, and getting things to indent properly in lists requires moving in 4 spaces (I think; I just slap spacebar until it works.). Anyway, I found <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Foreign-C-Error.html\" rel=\"nofollow noreferrer\">this</a>, if it helps any (not an answer because I just Googled it and I have never used FFI)."}, {"owner": {"reputation": 81, "user_id": 12302537, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n4lgPjclylk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5stjaCA1yaJmEfPz6FQFLSSMi4w/photo.jpg?sz=128", "display_name": "\u9c8d\u51ef\u6587", "link": "https://stackoverflow.com/users/12302537/%e9%b2%8d%e5%87%af%e6%96%87"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1508213014, "post_id": 46781376, "comment_id": 80510855, "body": "Thanks, I knew I was doing something wrong with the code sections. Also thanks for the link, can&#39;t believe I missed that. Unfortunately that module seems to be for use with system errno&#39;s; I&#39;m more asking about &quot;internal&quot; errno&#39;s, e.g. In here: <a href=\"https://github.com/LuaDist/gsl/blob/master/err/gsl_errno.h\" rel=\"nofollow noreferrer\">github.com/LuaDist/gsl/blob/master/err/gsl_errno.h</a> (just googled for whatever). That, and of course, return values reserved for communicating failure."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1508395836, "post_id": 46781376, "comment_id": 80595626, "body": "This is kind of an opinion-based question, but it it relevant to the part of the code handling the exception that it\u2019s an exception propagated from C? Does that affect the handler that tries to recover from the operation, or is that just a detail of some other code it interacts with? Does this kind of exception need to contain different information?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1508396451, "post_id": 46781376, "comment_id": 80595909, "body": "Also, and perhaps more relevant to your specific alternatives: is recovering from the exception going to require <code>IO</code> actions or not? Will data inside the exception need to be bound to <code>IO</code> operations?"}, {"owner": {"reputation": 81, "user_id": 12302537, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n4lgPjclylk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5stjaCA1yaJmEfPz6FQFLSSMi4w/photo.jpg?sz=128", "display_name": "\u9c8d\u51ef\u6587", "link": "https://stackoverflow.com/users/12302537/%e9%b2%8d%e5%87%af%e6%96%87"}, "edited": false, "score": 0, "creation_date": 1508445769, "post_id": 46781376, "comment_id": 80624854, "body": "I hate to say this, but I think it just depends. For the particular thing I&#39;m working on right now, the C-side exceptions all have to do with I/O (e.g. invalid block address, file not found), so I guess recovering from that inevitably will have to be in <code>IO</code>. I can imagine other situations, though, like in <a href=\"https://hackage.haskell.org/package/hmatrix-gsl-0.18.0.1/docs/Numeric-GSL-Integration.html\" rel=\"nofollow noreferrer\">here</a>. If the max iterations is exceeded, then an IO exception (via <code>error</code>) is thrown, but I think having an <code>Either</code> type exception might also make sense, if the integration routine is pure..."}, {"owner": {"reputation": 81, "user_id": 12302537, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n4lgPjclylk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5stjaCA1yaJmEfPz6FQFLSSMi4w/photo.jpg?sz=128", "display_name": "\u9c8d\u51ef\u6587", "link": "https://stackoverflow.com/users/12302537/%e9%b2%8d%e5%87%af%e6%96%87"}, "edited": false, "score": 0, "creation_date": 1508445878, "post_id": 46781376, "comment_id": 80624903, "body": "...because then upon catching a <code>Left MaxIterExceeded</code> or something, someone might want to try a different method. In that case no <code>IO</code> is required. Just my opinion, though."}, {"owner": {"reputation": 81, "user_id": 12302537, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n4lgPjclylk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5stjaCA1yaJmEfPz6FQFLSSMi4w/photo.jpg?sz=128", "display_name": "\u9c8d\u51ef\u6587", "link": "https://stackoverflow.com/users/12302537/%e9%b2%8d%e5%87%af%e6%96%87"}, "edited": false, "score": 0, "creation_date": 1508446469, "post_id": 46781376, "comment_id": 80625192, "body": "Oops; I shouldn&#39;t say that <code>error</code> throws an IO exception; rather, that what it throws can only be handled in <code>IO</code>."}, {"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 1, "creation_date": 1508532905, "post_id": 46781376, "comment_id": 80662009, "body": "If the bound C function is in IO, throw exceptions. If it is a pure function, return Either/ErrorT. On top, wrap the result in Maybe if it can be a null pointer."}], "owner": {"reputation": 81, "user_id": 12302537, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n4lgPjclylk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5stjaCA1yaJmEfPz6FQFLSSMi4w/photo.jpg?sz=128", "display_name": "\u9c8d\u51ef\u6587", "link": "https://stackoverflow.com/users/12302537/%e9%b2%8d%e5%87%af%e6%96%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1508211908, "creation_date": 1508205315, "last_edit_date": 1508211908, "question_id": 46781376, "link": "https://stackoverflow.com/questions/46781376/propagating-c-return-codes-to-haskell", "title": "Propagating C return codes to Haskell", "body": "<p>This might be more of a design question; not sure how to tag this.  Also, just to be safe: I'm asking about exceptions, as in exceptional but recoverable circumstances.</p>\n\n<p>If I'm writing bindings to a C library and some functions return (library-specific) error codes, set <code>errno</code>, etc. like this:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>ssize_t read_a_book() {\n  if (i_cant_read)\n    return -1;\n  ...\n  return numBytesRead;\n}\n</code></pre>\n\n<p>What's the sanest way to propagate that to the Haskell realm? I can only think of:</p>\n\n<ul>\n<li><p>Make a new exception type to wrap C error stuff, and throw an <code>IO</code> exception whenever something horrible happens.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data CSideException = CSideException String\n  deriving (Show)\n\ninstance Exception CSideException\n\nthrowCSideException :: CSideException -&gt; IO ()\nthrowCSideException = throwIO\n</code></pre></li>\n<li><p>Same thing, but instead of an <code>IO</code> exception, use <code>Either</code>/<code>ErrorT</code>/whatever</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Part of the binding code/thin layer on top of C call that actually notices the error\nreadABook :: ErrorT CSideException IO Int\nreadABook = do retval &lt;- c_read_a_book\n               if (retval == -1) then throwError $ CSideException \"Stuff happens\"\n                                 else return retval\n\n-- User of the haskell binding\nlrn2read = goToLibrary `catchError` \\e -&gt; liftIO (print e) &gt;&gt; return 0\n  where goToLibrary = sum &lt;$&gt; replicateM 10 readABook\n</code></pre>\n\n<p>...or something like that.</p></li>\n<li><p>Bury your head in the sand</p></li>\n</ul>\n\n<p>I'm semi-sure that existing Haskell libraries that bind to C code will have addressed this question; if anyone knows any good ones, that info would also be appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1508205223, "post_id": 46781331, "comment_id": 80508940, "body": "You can not do this because values are immutable.  You have declared <code>tuple</code> equals <code>(1,2,3,4,5)</code> and it will forever be so.  Notice your type is wrong, it should actually be <code>tuple :: (Int,Int,Int,Int,Int)</code>.  If you wanted a list then that&#39;s different."}, {"owner": {"reputation": 137, "user_id": 8383476, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66893da737c29fad8518f5fed5827587?s=128&d=identicon&r=PG&f=1", "display_name": "ProPall", "link": "https://stackoverflow.com/users/8383476/propall"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1508205451, "post_id": 46781331, "comment_id": 80508990, "body": "But can I extract them ? Create a variable which will be equal the first element of the Tuple?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1508207790, "post_id": 46781331, "comment_id": 80509585, "body": "Sure, pattern matching is your friend here. Large tuples are typically avoided since they&#39;re clumsy and rather generic when a data declaration is usually appropriate."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 8383476, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66893da737c29fad8518f5fed5827587?s=128&d=identicon&r=PG&f=1", "display_name": "ProPall", "link": "https://stackoverflow.com/users/8383476/propall"}, "edited": false, "score": 0, "creation_date": 1508424744, "post_id": 46783454, "comment_id": 80613096, "body": "Thanks for your answer it&#39;s really useful.  However, I need to create a function which takes a tuple with 4 integers . I would love to use lists but I can&#39;t :("}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1508220112, "creation_date": 1508220112, "answer_id": 46783454, "question_id": 46781331, "link": "https://stackoverflow.com/questions/46781331/how-can-i-get-an-int-from-the-tuple-in-haskell/46783454#46783454", "title": "How can I get an Int from the tuple in Haskell", "body": "<p>As defined in the OP, the type of <code>tuple</code> is this:</p>\n\n<pre><code>Prelude&gt; tuple = (1,2,3,4,5)\nPrelude&gt; :t tuple\ntuple\n  :: (Num t4, Num t3, Num t2, Num t1, Num t) =&gt; (t4, t3, t2, t1, t)\n</code></pre>\n\n<p>There's no type <code>(Int)</code>. Instead, the type is <code>(t4, t3, t2, t1, t)</code>, where each of those five types has to be a <code>Num</code> instance. There's more than a single type to chose from, and since all five types can vary independently of each other, the type <em>could</em> be <code>(Int, Word, Float, Integer, Int)</code>.</p>\n\n<p>The reason for this is that each literal in the definition (<code>1</code>, <code>2</code>, etc.) could be interpreted as any of those types, and when you write an expression like that, the compiler keeps your options open.</p>\n\n<p>If you want it to be a tuple exclusively made up of <code>Int</code> values, you can declare that:</p>\n\n<pre><code>tuple :: (Int, Int, Int, Int, Int)\ntuple = (1,2,3,4,5)\n</code></pre>\n\n<p>If you want the first element of the tuple, you can use <em>pattern matching</em> to extract that information:</p>\n\n<pre><code>Prelude&gt; (x, _, _, _, _) = tuple\nPrelude&gt; x\n1\n</code></pre>\n\n<p>The above expression uses <em>wildcards</em> to ignore the other four elements of the tuple, but if you need one or more of those, you can bind to named values as well:</p>\n\n<pre><code>Prelude&gt; (x, _, z, _, _) = tuple\nPrelude&gt; z\n3\n</code></pre>\n\n<p>As Thomas M. DuBuisson points out in a comment to the OP, however, you'd probably be better off with other language constructs than large tuples.</p>\n\n<p>If I may venture a guess, I suppose the OP is actually about <em>lists</em>, not tuples. Certain languages (particularly dynamic languages) don't make much of a distinction between lists and tuples. This makes some sense in a dynamic language where types are unknown at compile-time.</p>\n\n<p>Haskell, however, is a statically typed language, and lists and tuples are different.</p>\n\n<ul>\n<li>A tuple is a data structure with a fixed length, but where you can flexibly choose the type of each individual element.</li>\n<li>A list is a data structure with a fixed element type, but where you can vary the length.</li>\n</ul>\n\n<p>Perhaps you're looking for a list of integers:</p>\n\n<pre><code>list :: [Int]\nlist = [1,2,3,4,5]\n</code></pre>\n\n<p>Given such a list, you can, for instance, use the <code>!!</code> operator to extract the first element:</p>\n\n<pre><code>Prelude&gt; list !! 0\n1\n</code></pre>\n\n<p>Do note, however, that <code>!!</code> is unsafe, because if you give it an out-of-range index, it's going to throw an exception.</p>\n"}, {"tags": [], "owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "is_accepted": false, "score": 1, "last_activity_date": 1508251978, "last_edit_date": 1508251978, "creation_date": 1508251650, "answer_id": 46792989, "question_id": 46781331, "link": "https://stackoverflow.com/questions/46781331/how-can-i-get-an-int-from-the-tuple-in-haskell/46792989#46792989", "title": "How can I get an Int from the tuple in Haskell", "body": "<p>You can use the <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> library:</p>\n\n<pre><code>tuple :: (Int, Int, Int, Int, Int)\ntuple = (1,2,3,4,5)\n\nsecondElement = tuple ^. _2 -- One indexed\n</code></pre>\n\n<p>For tuples with exactly 2 elements you can use <code>fst</code> and <code>snd</code> from Prelude to get the first and second element respectively</p>\n"}], "owner": {"reputation": 137, "user_id": 8383476, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66893da737c29fad8518f5fed5827587?s=128&d=identicon&r=PG&f=1", "display_name": "ProPall", "link": "https://stackoverflow.com/users/8383476/propall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1019, "favorite_count": 0, "accepted_answer_id": 46783454, "answer_count": 2, "score": 1, "last_activity_date": 1508251978, "creation_date": 1508204973, "last_edit_date": 1508220186, "question_id": 46781331, "link": "https://stackoverflow.com/questions/46781331/how-can-i-get-an-int-from-the-tuple-in-haskell", "title": "How can I get an Int from the tuple in Haskell", "body": "<p>I am new to Haskell, and currently looking for a way to extract or delete the first <code>Int</code> in a tuple. Is there a built-in Haskell function to do that? \nFor instance:</p>\n\n<pre><code>tuple :: (Int)\ntuple = (1,2,3,4,5)\n\ntuple !! 0 = \n</code></pre>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 1, "creation_date": 1508204831, "post_id": 46781238, "comment_id": 80508846, "body": "AFAIK, <code>?i:a</code> is not a valid regular expression in POSIX. do you have any source ?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 0, "last_activity_date": 1508264483, "creation_date": 1508264483, "answer_id": 46796735, "question_id": 46781238, "link": "https://stackoverflow.com/questions/46781238/how-to-match-string-that-ignore-upper-or-lower-case-when-using-text-regex-posix/46796735#46796735", "title": "How to match string that ignore upper or lower case when using Text.Regex.Posix in haskell?", "body": "<p>Using a <code>?i:</code> prefix to indicate a case-insensitive regular expression isn't part of the POSIX standard for regular expressions, and it isn't supported by <code>Text.Regex.Posix</code>.  Instead, you need to specify a flag when the regular expression is compiled.  This means you can't use the <code>=~</code> operator, because that operator always uses default compilation flags.</p>\n\n<p>Instead, you'll probably want to define a helper function:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Data.Bits\nimport Text.Regex.Posix\n\n-- | Compile a case-insensitive regular expression.\nmakeIRegex :: RegexMaker Regex CompOption ExecOption source =&gt; source -&gt; Regex\nmakeIRegex = makeRegexOpts (defaultCompOpt .|. compIgnoreCase) defaultExecOpt\n</code></pre>\n\n<p>and then you can write:</p>\n\n<pre><code>&gt; match (makeIRegex \"a\") \"a\" :: Bool\nTrue\n&gt; match (makeIRegex \"a\") \"A\" :: Bool\nTrue\n&gt; \n</code></pre>\n"}], "owner": {"reputation": 1277, "user_id": 7254635, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/280e5fa5140a804fcd8fd9dfe3198542?s=128&d=identicon&r=PG&f=1", "display_name": "wang kai", "link": "https://stackoverflow.com/users/7254635/wang-kai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 46796735, "answer_count": 1, "score": 0, "last_activity_date": 1508264483, "creation_date": 1508204251, "last_edit_date": 1508220285, "question_id": 46781238, "link": "https://stackoverflow.com/questions/46781238/how-to-match-string-that-ignore-upper-or-lower-case-when-using-text-regex-posix", "title": "How to match string that ignore upper or lower case when using Text.Regex.Posix in haskell?", "body": "<p>I know posix regex use ?i to ignore upper or lower case</p>\n\n<p>but when I test it:</p>\n\n<pre><code>\"a\" =~ \"?i:a\" :: Bool\n</code></pre>\n\n<p>I got a error.</p>\n\n<p>How to write it right?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1508200387, "post_id": 46780677, "comment_id": 80507770, "body": "in this case I wouldn&#39;t use the generic json parser, instead I would write it on my own using the combinators from aeson!"}, {"owner": {"reputation": 1281, "user_id": 5962, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d84b7c1c639638cf3f424e182d1b7f80?s=128&d=identicon&r=PG", "display_name": "dsvensson", "link": "https://stackoverflow.com/users/5962/dsvensson"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1508217240, "post_id": 46780677, "comment_id": 80512090, "body": "Are you saying that this is impossible / unfeasible with the generic json parser, or you just don&#39;t know how to do it and thus recommend the combinators in a comment rather than an answer? Do you have any reading material to suggest that explores somewhat similar in-data as I have, using the combinators you mention?"}, {"owner": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 0, "creation_date": 1508232861, "post_id": 46780677, "comment_id": 80520146, "body": "try Maybe [ResultRow] instead of [Maybe ResultRow]"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1508233705, "creation_date": 1508233705, "answer_id": 46787258, "question_id": 46780677, "link": "https://stackoverflow.com/questions/46780677/aeson-with-arrays-of-arrays-of-which-some-are-empty/46787258#46787258", "title": "Aeson with arrays of arrays, of which some are empty", "body": "<p>Like <em>dsvensson</em>, I'm puzzled that this doesn't 'just work' out of the box, since both <code>[a]</code> and <code>Maybe a</code> are <code>FromJSON</code> instances when <code>a</code> is. Since I already ended up spending way too much time on this, I can't offer an <em>explanation</em>, but I can offer a workaround. Hopefully someone more knowledgeable can give a better answer.</p>\n\n<p>Instead of defining <code>f_data</code> as a <code>[Maybe ResultRow]</code>, you can define a <code>newtype</code> that wraps <code>Maybe ResultRow</code>:</p>\n\n<pre><code>newtype MaybeResultRow = MaybeResultRow (Maybe ResultRow) deriving (Show, Generic)\n</code></pre>\n\n<p>You can give this type special <code>FromJSON</code> behaviour:</p>\n\n<pre><code>instance FromJSON MaybeResultRow where\n  parseJSON v =\n    case fromJSON v of\n      Success rr -&gt; return $ MaybeResultRow $ Just rr\n      _          -&gt; return $ MaybeResultRow Nothing\n</code></pre>\n\n<p>This, obviously, implies a change of <code>ResultSet</code>:</p>\n\n<pre><code>data ResultSet =\n  ResultSet { f_name :: Text\n            , f_data :: [MaybeResultRow] } deriving (Show, Generic)\n</code></pre>\n\n<p>In order to test, I defined this JSON document:</p>\n\n<pre><code>myJson :: ByteString\nmyJson =\n  \"{\\\n     \\\\\"name\\\": \\\"foo\\\",\\\n     \\\\\"data\\\": [\\\n        \\[],\\\n        \\[\\\"a\\\", \\\"b\\\", \\\"c\\\", 1],\\\n        \\[\\\"d\\\", \\\"e\\\", \\\"f\\\", 2]\\\n     \\]\\\n   \\}\"\n</code></pre>\n\n<p>Loading it all into GHCi, it looks like it's working:</p>\n\n<pre><code>*Lib Lib&gt; decode myJson :: Maybe ResultSet\nJust (ResultSet {\n          f_name = \"foo\"\n        , f_data = [\n                     MaybeResultRow Nothing,\n                     MaybeResultRow (Just (ResultRow \"a\" \"b\" \"c\" 1)),\n                     MaybeResultRow (Just (ResultRow \"d\" \"e\" \"f\" 2))]})\n</code></pre>\n\n<p>Here, I've taken the liberty to format the output from GHCi in order to enhance readability.</p>\n\n<p>I trust that you can figure out how to unwrap and filter the list of <code>MaybeResultRow</code> values...</p>\n\n<p>I stole the solution of using <code>fromJSON</code> and matching on <code>Success</code> from <a href=\"https://stackoverflow.com/a/33913449/126014\">this answer</a>.</p>\n"}], "owner": {"reputation": 1281, "user_id": 5962, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d84b7c1c639638cf3f424e182d1b7f80?s=128&d=identicon&r=PG", "display_name": "dsvensson", "link": "https://stackoverflow.com/users/5962/dsvensson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 46787258, "answer_count": 1, "score": 1, "last_activity_date": 1508233705, "creation_date": 1508199006, "last_edit_date": 1508222805, "question_id": 46780677, "link": "https://stackoverflow.com/questions/46780677/aeson-with-arrays-of-arrays-of-which-some-are-empty", "title": "Aeson with arrays of arrays, of which some are empty", "body": "<p>I have the unfortunate data to work with:</p>\n\n<pre><code>{ \"name\": \"foo\"\n, \"data\": [ []\n          , [\"a\", \"b\", \"c\", 1]\n          , [\"d\", \"e\", \"f\", 2] ] }\n</code></pre>\n\n<p>The data entries are allowed to be either empty array, or an array of size four.</p>\n\n<p>That I want to parse into:</p>\n\n<pre><code>data ResultRow = ResultRow Text Text Text Int deriving (Show, Generic)\n\ndata ResultSet =\n  ResultSet { f_name :: Text\n            , f_data :: [Maybe ResultRow] } deriving (Show, Generic)\n</code></pre>\n\n<p>The following however does not accept the empty arrays:</p>\n\n<pre><code>customOptions = defaultOptions { fieldLabelModifier = drop 2 }\n\ninstance FromJSON ResultRow where\n  parseJSON = genericParseJSON customOptions\ninstance FromJSON ResultSet where\n  parseJSON = genericParseJSON customOptions\n</code></pre>\n\n<p>The error message is:</p>\n\n<pre><code>Left \"Error in $[1].data[0]: When expecting a product of 4 values, encountered an Array of 0 elements instead\"\n</code></pre>\n\n<p>I've also tried putting an extra type around <code>[Maybe ResultRow]</code> and have that convert the sub-arrays to lists and pattern match on <code>[]</code>, and dispatch the non-empty case to the <code>ResultRow</code> parser but I simply couldn't get it to compile and got lost in the error messages.</p>\n\n<p>Ideally I would like to have some way of skipping the empty arrays as they're just noise in the data. I have no control of the producer of the data.</p>\n"}, {"tags": ["algorithm", "haskell", "statistics"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1508185702, "post_id": 46778479, "comment_id": 80502953, "body": "I find it rather weird that you put <i>average</i> in the same list as the percentages. I would use a 2-tuple with average the first, and percentages the second element."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1508188297, "post_id": 46778479, "comment_id": 80504141, "body": "I think there are some loose ends in the algorithm. Are the thresholds and their percentages related by the thresholds&#39; quantity or value..?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1508195985, "post_id": 46778479, "comment_id": 80506701, "body": "Are the lists always ordered? You can do much better than <code>O(d*t)</code> if so."}], "answers": [{"comments": [{"owner": {"reputation": 901, "user_id": 2923406, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/931b6aa5e3f49c2dd804b74c5bee964f?s=128&d=identicon&r=PG&f=1", "display_name": "Rolf", "link": "https://stackoverflow.com/users/2923406/rolf"}, "edited": false, "score": 0, "creation_date": 1508266303, "post_id": 46794539, "comment_id": 80541147, "body": "Thanks! Is it true that the ideomatic Haskell version loops over depths for every threshold and is thus slower or is the compiler able to do any magic here?"}, {"owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "reply_to_user": {"reputation": 901, "user_id": 2923406, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/931b6aa5e3f49c2dd804b74c5bee964f?s=128&d=identicon&r=PG&f=1", "display_name": "Rolf", "link": "https://stackoverflow.com/users/2923406/rolf"}, "edited": false, "score": 0, "creation_date": 1508270916, "post_id": 46794539, "comment_id": 80543596, "body": "@Rolf No, it is only conceptually true. The compiler is arcane, and ideomatic haskell often outperforms C. In this particular case the ideomatic haskell code is orders of magnitude faster than the imperative one! (I tested both functions with 10000 depths and 10000 thresholds, the imperative one finished in <code>91.88s</code>, ideomatic haskell in <code>0.43s</code>)"}, {"owner": {"reputation": 901, "user_id": 2923406, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/931b6aa5e3f49c2dd804b74c5bee964f?s=128&d=identicon&r=PG&f=1", "display_name": "Rolf", "link": "https://stackoverflow.com/users/2923406/rolf"}, "edited": false, "score": 0, "creation_date": 1508414427, "post_id": 46794539, "comment_id": 80606038, "body": "Ah, thanks again! I also realize that it is conceptually the same to to loop over all thresholds for every depth or the other way around (in terms of Big O)."}], "tags": [], "owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "is_accepted": true, "score": 1, "last_activity_date": 1508261670, "last_edit_date": 1508261670, "creation_date": 1508256394, "answer_id": 46794539, "question_id": 46778479, "link": "https://stackoverflow.com/questions/46778479/calculate-multiple-cutoff-percentages-for-an-int-list-in-haskell/46794539#46794539", "title": "Calculate multiple cutoff percentages for an Int list in Haskell?", "body": "<h3>How should this code be indented?</h3>\n\n<p>That is subjective- personally I prefer this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getMeanAndPercents :: [Int] -&gt; [Int] -&gt; [Float]\ngetMeanAndPercents thresholds depths\n  = let depths2 = map f depths\n        counts  = foldl1 (zipWith (+)) depths2\n        len     = fromIntegral $ length depths\n    in fromIntegral (head counts) / len : map (\\c -&gt; fromIntegral c / len) (tail counts)\n where f d = d : map (\\t -&gt; if d &gt;= t then 1 else 0) thresholds\n</code></pre>\n\n<h3>How often Haskell will loop over depths? I would assume once for length and once for foldl1 &amp; map.</h3>\n\n<p>Lists in Haskell are not actually lists, but rather lazy streams of data, like a generator in an imperative language like python.</p>\n\n<p>Because the computation depends on the length of the stream, we have to go trough it once to see how long it is, which also forces you to load the entire list into memory.</p>\n\n<p>You loop trough the depth list once for each item in the threshold list, and another time to get the sum, so this is <code>O(2d+dt)</code>.</p>\n\n<p>If you actually know the length of the list you should pass it in to the function, or you could use another datatype like <code>Array</code> where the length is already known.</p>\n\n<h3>What would be a better (w.r.t. performance and/or readability) implementation in Haskell? (I assume one needs to do at least O(d*t), i.e. loop over all thresholds for all depths)</h3>\n\n<p>I would have written your implementation like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getMeanAndPercents :: [Int] -&gt; [Int] -&gt; (Float, [Float])\ngetMeanAndPercents thresholds depths\n  | len    &lt;- fi $ length depths\n  , (c:cs) &lt;- foldl1 (zipWith (+)) $ f &lt;$&gt; depths\n  = (fi c / len, (/len).fi &lt;$&gt; cs)\n where f d = d : map (\\t -&gt; if d &gt;= t then 1 else 0) thresholds\n       fi  = fromIntegral\n</code></pre>\n\n<p>This is closer to your imperative code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getMeanAndPercents thresholds depths\n  | ((sum, len), ts) &lt;- mapAccumL\n      ( \\(sum, len) d -&gt; ( (sum+d, len+1)\n                         , map (\\t -&gt; if d&gt;=t then 1 else 0) thresholds\n                         )\n      ) (0,0) depths\n  = (/len) &lt;$&gt; (sum:foldl1(zipWith(+))ts)\n</code></pre>\n\n<p>This is more readable/ideomatic haskell:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getMeanAndPercents :: [Int] -&gt; [Int] -&gt; (Float, [Float])\ngetMeanAndPercents thresholds depths\n  | len &lt;- length depths\n  = ( sum depths / len\n    , [ length (filter (&gt;=t) depths) / len | t &lt;- thresholds ]\n    )\n</code></pre>\n"}], "owner": {"reputation": 901, "user_id": 2923406, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/931b6aa5e3f49c2dd804b74c5bee964f?s=128&d=identicon&r=PG&f=1", "display_name": "Rolf", "link": "https://stackoverflow.com/users/2923406/rolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 46794539, "answer_count": 1, "score": 0, "last_activity_date": 1508265215, "creation_date": 1508185255, "last_edit_date": 1508265215, "question_id": 46778479, "link": "https://stackoverflow.com/questions/46778479/calculate-multiple-cutoff-percentages-for-an-int-list-in-haskell", "title": "Calculate multiple cutoff percentages for an Int list in Haskell?", "body": "<p>I would like to write a Haskell function for the following problem: Given two list of Integers (\"depths\" and \"thresholds\"), return the mean depth and the fractional of depths greater or equal for each threshold.\nAs an example, given the depths <code>[10,10,10,15,15,20]</code> and the tresholds <code>[10,15,20]</code>, the expected result should be <code>[13.333333,1.0,0.5,0.16666667]</code> (mean depth is 13.3, 100% of depths >= 10, 50% of depths >= 15 &amp; 17% of depths >=20).</p>\n\n<p>An imperative pseudo code solution could look like this:</p>\n\n<pre><code>-- getMeanAndPercents (thresholds, depths):\n--  sum = 0\n--  threshold_counts = [0 for t in thresholds]\n--  len = 0\n--  for d in depths:\n--   sum += d\n--   len += 1\n--   for t in thresholds:\n--    if d &gt;= t: tresholds_counts[t] += 1\n--  for t in tresholds\n--   threshold_percents[t] = thresholds_counts[t] / len\n--  return = [sum / len] + [threshold_percents]\n</code></pre>\n\n<p>My Haskell solution looks like this:</p>\n\n<pre><code>getMeanAndPercents :: [Int] -&gt; [Int] -&gt; [Float]\ngetMeanAndPercents thresholds depths = let\n    depths2 = map f depths -- replace each depth d with [d, 1, 0, 1, 0, 1, 0, 0, ...]\n    counts = foldl1 (zipWith (+)) depths2 -- sum the inner lists\n    len = fromIntegral $ length depths -- get total depth length\n                                       in fromIntegral (head counts) / len : map (\\c -&gt; fromIntegral c / len) (tail counts)\n    where\n        f d = d : map (\\t -&gt; if d &gt;= t then 1 else 0) thresholds\n</code></pre>\n\n<p>Questions:</p>\n\n<p>1) How should this code be indented (I'm unsure how to mix <code>let ... in</code> with <code>where</code>)?</p>\n\n<p>2) How often Haskell will loop over <code>depths</code>? I would assume once for <code>length</code> and once for <code>foldl1 &amp; map</code>.</p>\n\n<p>3) What would be a better (w.r.t. performance and/or readability)  implementation in Haskell? (I assume one needs to do at least <code>O(d*t)</code>, i.e. loop over all thresholds for all depths)</p>\n\n<p><strong>EDIT:</strong> The depths are not ordered, the thresholds could be ordered by the function. Thus, one could skip <code>&gt;=</code> once the first threshold fails the test.</p>\n"}, {"tags": ["haskell", "optimization", "encoding"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1508185966, "post_id": 46778355, "comment_id": 80503076, "body": "There are 2^24 <code>(Word8, Word8, Word8)</code> triples. So unless your input texts are 3*2^24 <code>Word8</code>s long or longer (48MiB!), precomputing the lookup table will probably be more expensive than normal-computing one element for every third position in the text. Laziness helps a little bit here, but I strongly encourage you to double-check that this refactor actually helps once you&#39;ve got it implemented."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1508186018, "post_id": 46778355, "comment_id": 80503103, "body": "Since this is a micro-optimization (in other words, there are no asymptotic gains), try it and <i>profile</i>!  In this area, abstract knowledge only goes so far."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1508197163, "post_id": 46778355, "comment_id": 80507019, "body": "there exists <a href=\"https://hackage.haskell.org/package/base64-bytestring\" rel=\"nofollow noreferrer\"><code>base64-bytestring</code></a> written by brian o&#39;sullivan, his packages are know for being fast - so maybe you can look at his implementation and add other encodings or at least make sure you  measure your implementation against his!"}], "owner": {"reputation": 23, "user_id": 8528262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/976c2e54309ef7a50e17241d4a743163?s=128&d=identicon&r=PG&f=1", "display_name": "Hopeful_O", "link": "https://stackoverflow.com/users/8528262/hopeful-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1508184753, "creation_date": 1508184753, "question_id": 46778355, "link": "https://stackoverflow.com/questions/46778355/are-immutable-lookup-arrays-a-good-choice-in-a-base-encoding-algorithm", "title": "Are immutable &quot;lookup&quot; arrays a good choice in a base encoding algorithm?", "body": "<p>context: I am making a haskell program that implements  base 2 4 8 16 32 64 and 128 encodings of ByteString terms, It could be used very often in network context so I want it to be as fast and reliable as possible.</p>\n\n<p>problem : My first implementation did encoding by performing recursive operations on each byte of data, this doesn't seem optimal at all to me so in my next try I wanted to use n dimensional arrays (maybe Judy arrays?) where each block of n Word8 terms is an index to its encoded version.\nexample : in base 64 encoding, each block of 3 Word8 values are an index to 4 Word8 values.</p>\n\n<p>question: Is using immutable arrays in this context the best choice in regards to speed?</p>\n"}, {"tags": ["haskell", "typeclass", "constraint-kinds"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1508183182, "post_id": 46777725, "comment_id": 80501662, "body": "This isn&#39;t a <code>constraints</code> related issue. This is an issue with the magic behind <code>static</code>. As its name suggests, <code>static</code> needs to take something whose value can be computed statically. That means it either needs to be a top-level binding, or something derived from top-level bindings. This simply isn&#39;t possible."}], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1508201960, "creation_date": 1508182120, "last_edit_date": 1508201960, "question_id": 46777725, "link": "https://stackoverflow.com/questions/46777725/resolving-super-class-constraints-in-a-static-form", "title": "Resolving super-class constraints in a static form", "body": "<p>I want to write a typeclass for types that have a static pointer to a dictionary that can discharge the super class constraints. In this contrived example the super-constraint is <code>Typeable</code>, since modern GHC versions automatically provides the instance for all types.</p>\n\n<p>In reality, the super-constraints are non-trivial and instances of <code>Static a</code> allow the dictionaries of those constraints to be serialized, since <code>forall a. StaticPtr a</code> can be serialized.</p>\n\n<p>First, the following code compiles without issue,</p>\n\n<pre><code>{-# LANGUAGE StaticPointers #-}\n{-# LANGUAGE ScopedTypeVariables, TypeApplications #-}\n{-# LANGUAGE FlexibleContexts, FlexibleInstances #-}\n{-# LANGUAGE UndecideableInstances, MultiParamTypeClasses #-}\n\nimport GHC.StaticPtr\nimport Data.Constraint\nimport Data.Constraint.Lifting\nimport Data.Typeable (Typeable)\n\nclass Typeable a =&gt; Static a where\n    sdict :: Dict (Static a)\n\n-- The 'Typeable f' constraint should be trivial, but typechecking \n-- fails without it. Is it possible to get rid of it, if not then why?\ninstance (Typeable f, Lifting Static f, Static a) =&gt; Static (f a) where\n    sdict = Dict \\\\ lifting @Static @f @a\n</code></pre>\n\n<p>But when I write the class in the desired way using static pointers,</p>\n\n<pre><code>class Typeable a =&gt; Static a where\n    sdict :: StaticPtr (Dict (Static a))\n\ninstance (Typeable f, Lifting Static f, Static a) =&gt; Static (f a) where\n    sdict = static (Dict \\\\ lifting @Static @f @a)\n</code></pre>\n\n<p>GHC complains about type applications in the body of a static form:</p>\n\n<pre><code>Only identifiers of top-level bindings can appear in the body of the static form:\n  static (Dict \\\\ lifting @Static @f @a)\nbut the following identifiers were found instead: f a\n</code></pre>\n\n<p>Then I tried to let GHC resolve the instances entirely on its own, without using <code>Lifting</code> to guide the typechecker</p>\n\n<pre><code>instance (Typeable f, Static a) =&gt; Static (f a) where sdict = static Dict\n</code></pre>\n\n<p>But this fails as well,</p>\n\n<pre><code>\u2022 No instance for (Static a) arising from a use of \u2018Dict\u2019                                    \n\u2022 In the body of a static form: Dict                                                                 \n  In the expression: static Dict\n  In an equation for \u2018sdict\u2019: sdict = static Dict                                                    \n</code></pre>\n\n<p>A more monomorphic instance also fails with a very similar error: <code>No instance for (Static a)</code>,</p>\n\n<pre><code>instance Static a =&gt; Static [a] where sdict = static Dict\n</code></pre>\n\n<p>This led me to learn more about how GHC's typeclass instance resolution works: a class's super-constraints are not applied until after the instance is actually resolved. But GHC was able to satisfy <code>Dict :: Static a =&gt; Dict (Static a)</code> in the first example, which clearly requires a <code>Static a</code> instance to be in scope.</p>\n\n<p>Any suggestions how to write this, if it's even possible? Hopefully someone with more experience with the <a href=\"https://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint.html\" rel=\"nofollow noreferrer\">constraints</a> package can provide the right contortions to satisfy the typechecker.</p>\n"}, {"tags": ["multithreading", "haskell", "asynchronous", "concurrency"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1508195012, "post_id": 46776954, "comment_id": 80506476, "body": "Curious: what&#39;s your use case? It sounds like you&#39;re trying to build an Erlang-esque supervision model, for which you might be better served by an actor library like <a href=\"https://hackage.haskell.org/package/pipes-concurrency\" rel=\"nofollow noreferrer\"><code>pipes-concurrency</code></a>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1508347539, "post_id": 46776954, "comment_id": 80578966, "body": "@BenjaminHodgson the use-case is to spawn a job-queue when my webapp starts. The job-queue internally spawns a job-polling thread and a job-listen/notify thread. If either of those threads die, they need to be re-spawned. If the app thread is killed, then the job-queue needs to be killed."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1508195958, "last_edit_date": 1508195958, "creation_date": 1508183979, "answer_id": 46778153, "question_id": 46776954, "link": "https://stackoverflow.com/questions/46776954/how-to-link-parent-async-with-multiple-children-asyncs/46778153#46778153", "title": "How to link parent async with multiple children asyncs", "body": "<p>It seems that we need two functions: one that starts all the async tasks and another that watches them and restarts them whenever they die.</p>\n\n<p>The first one could be written like this:</p>\n\n<pre><code>withAsyncMany :: [IO t] -&gt; ([Async t] -&gt; IO b) -&gt; IO b\nwithAsyncMany []     f = f []\nwithAsyncMany (t:ts) f = withAsync t $ \\a -&gt; withAsyncMany ts (f . (a:))\n</code></pre>\n\n<p>If we were using the <a href=\"http://hackage.haskell.org/package/managed-1.0.5/docs/Control-Monad-Managed.html\" rel=\"nofollow noreferrer\">managed</a> package, we could also write it like this:</p>\n\n<pre><code>import Control.Monad.Managed (with,managed)\n\nwithAsyncMany' :: [IO t] -&gt; ([Async t] -&gt; IO b) -&gt; IO b\nwithAsyncMany' = with . traverse (\\t -&gt; managed (withAsync t))\n</code></pre>\n\n<p>The restart function would loop the list of asyncs, polling for their status and renewing them when they fail:</p>\n\n<pre><code>{-# language NumDecimals #-}\nimport Control.Concurrent (threadDelay)\n\nresurrect :: IO t -&gt; [Async t] -&gt; IO ()\nresurrect restartAction = go []\n    where\n    go ts [] = do\n        threadDelay 1e6    -- wait a little before the next round of polling\n        go [] (reverse ts)\n    go past (a:pending) = do\n        status &lt;- poll a   -- has the task died, or finished?\n        case status of\n            Nothing -&gt; go (a:past) pending\n            Just _  -&gt; withAsync restartAction $ \\a' -&gt; go (a':past) pending\n</code></pre>\n\n<p>I'm worried however about the possibility of many nested <code>withAsyncs</code> causing some type of resource leak (because some kind of exception handler must be installed with each <code>withAsync</code> to notify the child in case the parent thread dies). </p>\n\n<p>So perhaps in this case it would be better to spawn workers with plain <code>async</code>s, store the collection of <code>Async</code>s into some kind of mutable reference and install a single exception handler in the monitor thread, which would traverse the container terminating each task.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1508263439, "creation_date": 1508263439, "answer_id": 46796435, "question_id": 46776954, "link": "https://stackoverflow.com/questions/46776954/how-to-link-parent-async-with-multiple-children-asyncs/46796435#46796435", "title": "How to link parent async with multiple children asyncs", "body": "<p>Here's another answer, that uses <code>async</code> instead of <code>withAsync</code>. The main function is</p>\n\n<pre><code>monitor :: Int -&gt; IO () -&gt; IO ()\nmonitor count task =\n    bracket (do asyncs &lt;- replicateM count (async task)\n                newIORef asyncs)\n            (\\ref -&gt; forever (do\n                threadDelay 1e6\n                asyncs &lt;- readIORef ref\n                vivify task (writeIORef ref) asyncs))\n            (\\ref -&gt; do\n                asyncs &lt;- readIORef ref\n                mapM_ uninterruptibleCancel asyncs)\n</code></pre>\n\n<p>it uses an auxiliary <code>vivify</code> function that traverses a list of <code>Async</code>s, reviving dead ones and writing back the updated list to an <code>IORef</code>:</p>\n\n<pre><code>vivify :: IO () -&gt; ([Async ()] -&gt; IO ()) -&gt; [Async ()] -&gt; IO ()\nvivify task write asyncs = go [] asyncs\n    where\n    go _    [] = do\n        return ()\n    go past (a:pending) = do\n        status &lt;- poll a\n        case status of\n            Nothing -&gt; do\n                go (a:past) pending\n            Just _  -&gt; do\n                past' &lt;- mask_ $ do\n                    a' &lt;- async task\n                    write (reverse (a':past) ++ pending)\n                    return (a':past)\n                go past' pending\n</code></pre>\n\n<p>We mask asynchronous exceptions in the interval between creating a new <code>Async</code> and \"persisting\" it in the <code>IOref</code>, because otherwise if an asynchronous exception arrived inbetween and killed the monitor thread, that <code>Async</code> would remain dangling. </p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1508263439, "creation_date": 1508178987, "question_id": 46776954, "link": "https://stackoverflow.com/questions/46776954/how-to-link-parent-async-with-multiple-children-asyncs", "title": "How to link parent async with multiple children asyncs", "body": "<p>The documentation of the <a href=\"https://www.stackage.org/haddock/lts-9.0/async-2.1.1.1/Control-Concurrent-Async.html\" rel=\"nofollow noreferrer\"><code>async</code> package</a> describes the <code>withAsync</code> function as:</p>\n\n<blockquote>\n  <p>Spawn an asynchronous action in a separate thread, and pass its Async\n  handle to the supplied function. When the function returns or throws\n  an exception, uninterruptibleCancel is called on the Async. This is a\n  useful variant of async that ensures an Async is never left running\n  unintentionally.</p>\n</blockquote>\n\n<p>I've been staring at that for the past 2 hours and haven't been able to figure out how to start a monitor thread, that spawns multiple worker threads, such that:</p>\n\n<ul>\n<li>If the monitor thread dies, all worker threads should be killed,</li>\n<li><strong>But,</strong> if any worker thread dies, <strong>none of the other worker threads should be affected.</strong> The monitor should be notified and it should be able to restart the worker thread.</li>\n</ul>\n"}, {"tags": ["node.js", "haskell", "centos", "centos6", "elm"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1508178270, "post_id": 46776672, "comment_id": 80499072, "body": "Can you tell us the ghc version you have and maybe reinstall it - if libgmp is missing maybe there is also a path issue that could be fixed by a reinstall"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1508178346, "post_id": 46776672, "comment_id": 80499111, "body": "Alternatively you can install stack and install haskell using <code>stack setup</code>, then you can install el by cloning the git repos and using stack/ghc  to build"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1508178601, "post_id": 46776672, "comment_id": 80499229, "body": "I can post a working stack.yaml when I am at home"}, {"owner": {"reputation": 2858, "user_id": 527472, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/6VmZD.jpg?s=128&g=1", "display_name": "Kurt Mueller", "link": "https://stackoverflow.com/users/527472/kurt-mueller"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1508178811, "post_id": 46776672, "comment_id": 80499340, "body": "Unfortunately, <code>stack setup</code> did not work. I&#39;ll read up about this command."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1508179246, "post_id": 46776672, "comment_id": 80499572, "body": "I managed to install stack without any problems a few months ago on a centos machine just follow <a href=\"https://docs.haskellstack.org/en/stable/README/#how-to-install\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README/#how-to-install</a>"}, {"owner": {"reputation": 2858, "user_id": 527472, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/6VmZD.jpg?s=128&g=1", "display_name": "Kurt Mueller", "link": "https://stackoverflow.com/users/527472/kurt-mueller"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1508179322, "post_id": 46776672, "comment_id": 80499610, "body": "Sorry, I should have been more explicit. I installed <code>stack</code> and ran <code>stack setup</code> successfully. I reinstalled <code>elm</code> afterwards. However, still no dice when running <code>elm -v</code>."}, {"owner": {"reputation": 11736, "user_id": 1987838, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2tIuS.jpg?s=128&g=1", "display_name": "Hackerman", "link": "https://stackoverflow.com/users/1987838/hackerman"}, "edited": false, "score": 0, "creation_date": 1508183861, "post_id": 46776672, "comment_id": 80502034, "body": "You can always try building it from the source <a href=\"https://github.com/elm-lang/elm-platform\" rel=\"nofollow noreferrer\">github.com/elm-lang/elm-platform</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1508280626, "post_id": 46776672, "comment_id": 80547580, "body": "@KurtMueller did my instructions work? if not I&#39;ll get myself a docker container and try to make elm on centos work!"}, {"owner": {"reputation": 2858, "user_id": 527472, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/6VmZD.jpg?s=128&g=1", "display_name": "Kurt Mueller", "link": "https://stackoverflow.com/users/527472/kurt-mueller"}, "edited": false, "score": 0, "creation_date": 1508290218, "post_id": 46776672, "comment_id": 80549775, "body": "Hi epsilon. I really appreciate your help and should have responded to you sooner. I&#39;m sorry I did not. I actually moved my app to RHEL 7 (since my organization has a cluster of those vms) and use the <code>haskell-platform</code> package on that."}], "answers": [{"comments": [{"owner": {"reputation": 2858, "user_id": 527472, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/6VmZD.jpg?s=128&g=1", "display_name": "Kurt Mueller", "link": "https://stackoverflow.com/users/527472/kurt-mueller"}, "edited": false, "score": 0, "creation_date": 1508290271, "post_id": 46780345, "comment_id": 80549786, "body": "Hi epsilon, thank you for my help. See my above comment. If you test this this and it works, I&#39;ll mark this as answered. Thank you again for taking time to help a fellow dev out."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1508195911, "creation_date": 1508195911, "answer_id": 46780345, "question_id": 46776672, "link": "https://stackoverflow.com/questions/46776672/installing-elm-on-centos-6-9/46780345#46780345", "title": "Installing Elm on Centos 6.9", "body": "<p>Here is a list of instructions to (hopefully) reliably install elm on CentOS</p>\n\n<ol>\n<li>remove all previous installations of elm and ghc (we will install a newer ghc)</li>\n<li>install stack by following the <a href=\"https://docs.haskellstack.org/en/stable/README/#how-to-install\" rel=\"nofollow noreferrer\">installation instructions</a></li>\n<li><p>clone the elm sources:</p>\n\n<pre><code>mkdir elm &amp;&amp; cd elm\ngit clone https://github.com/elm-lang/elm-compiler\ngit clone https://github.com/elm-lang/elm-make\ngit clone https://github.com/elm-lang/elm-package\ngit clone https://github.com/elm-lang/elm-reactor\ngit clone https://github.com/elm-lang/elm-repl\n</code></pre></li>\n<li><p>put the following <code>stack.yaml</code> in the newly created <code>elm</code> directory</p>\n\n<pre><code>resolver: lts-9.9\n\npackages:\n- elm-compiler/\n- elm-make/\n- elm-package/\n- elm-compiler/profiling/\n- elm-reactor/\n- elm-repl/\n# Dependency packages to be pulled from upstream that are not in the resolver\n# (e.g., acme-missiles-0.3)\nextra-deps:\n- aeson-pretty-0.7.2\n- binary-0.7.6.1\n- ghc-time-alloc-prof-0.1.0\n- http-client-0.4.31.2\n- http-client-tls-0.2.4.1\n- http-types-0.8.6\n- vector-0.11.0.0\n- primitive-0.6.1.0\n- websockets-0.9.8.2\n\n# Override default flag values for local packages and extra-deps\nflags: {}\n\n# Extra package databases containing global packages\nextra-package-dbs: []\n</code></pre></li>\n<li><code>stack setup</code> (might take some time)</li>\n<li><code>stack build</code> (see above - grab a coffee)</li>\n<li><code>stack install</code> (do not forget to add the install location (usually <code>~/.local/bin</code>) to your <code>$PATH</code></li>\n<li><code>elm -v</code> should work now</li>\n</ol>\n"}], "owner": {"reputation": 2858, "user_id": 527472, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/6VmZD.jpg?s=128&g=1", "display_name": "Kurt Mueller", "link": "https://stackoverflow.com/users/527472/kurt-mueller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508195911, "creation_date": 1508177866, "last_edit_date": 1508181696, "question_id": 46776672, "link": "https://stackoverflow.com/questions/46776672/installing-elm-on-centos-6-9", "title": "Installing Elm on Centos 6.9", "body": "<p>I installed <code>Elm</code> via <code>yarn global add elm</code>. However, whenever I run <code>elm -v</code>, I get the following error:</p>\n\n<pre><code>/usr/local/share/.config/yarn/global/node_modules/elm/Elm-Platform/0.18.0/.cabal-sandbox/bin/elm: error while loading shared libraries: libgmp.so.10: cannot open shared object file: No such file or directory\n</code></pre>\n\n<p>I've installed via <code>yum</code>, the <code>haskell-platform</code> package and the <code>gmp</code> package. Unfortunately, I still receive the same error.</p>\n\n<p>Any help in diagnosing this error would greatly be appreciated. Thank you.</p>\n\n<hr>\n\n<p><strong>EDIT #1</strong></p>\n\n<p>Checking <code>ghc</code>, I see that the version is <code>7.0.4</code>. Apparently this is a very old version of <code>ghc</code>. I'll see if I can update ghc.</p>\n\n<p><strong>EDIT #2</strong></p>\n\n<p>Seems like because I'm on <code>Centos 6.9</code>, I'm sol. The <code>haskell-platform</code> repo is from 2011. I'll have to find otherwise of building the platform.</p>\n"}, {"tags": ["haskell", "shelly"], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 0, "last_activity_date": 1508178941, "creation_date": 1508178941, "answer_id": 46776943, "question_id": 46776578, "link": "https://stackoverflow.com/questions/46776578/how-can-i-handle-multiple-lines-of-output-when-running-external-processes-with-s/46776943#46776943", "title": "How can I handle multiple lines of output when running external processes with Shelly?", "body": "<p><a href=\"https://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text.html#v:lines\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text.html#v:lines</a></p>\n\n<pre><code>main :: IO ()\nmain = do\n  v &lt;- shelly example\n  print $ Data.Text.lines v\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 46776943, "answer_count": 1, "score": 0, "last_activity_date": 1508178941, "creation_date": 1508177503, "question_id": 46776578, "link": "https://stackoverflow.com/questions/46776578/how-can-i-handle-multiple-lines-of-output-when-running-external-processes-with-s", "title": "How can I handle multiple lines of output when running external processes with Shelly?", "body": "<p>I'm looking for a function of type <code>Text -&gt; [Text]</code>, essentially that would split text based by newlines. However I can't just split on <code>\\n</code> as this could be escaped for example as in <code>\\\\n</code>, I'm not sure what other complications exist.</p>\n\n<p><strong>Main.hs</strong></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Text (Text)\nimport Data.Text.IO\nimport Shelly\n\nexample :: Sh Text\nexample = run \"./example.sh\" []\n\nmain :: IO ()\nmain = do\n  v &lt;- shelly example\n  Data.Text.IO.putStrLn v\n</code></pre>\n\n<p><strong>example.sh</strong></p>\n\n<pre><code>echo \"test1\\\\n\"\necho \"test2\"\necho \"test3\"\n</code></pre>\n\n<p>Output of <code>./example.sh</code>:</p>\n\n<pre><code>test1\\n\ntest2\ntest3\n</code></pre>\n\n<p>So this is output of 3 lines.</p>\n\n<p>Does Shelly support some functionality to handle the above? Or maybe some other Haskell library to parse the output? I guess it would look something like <code>putStrLn</code> but instead of being output to <code>IO ()</code> it would be output to <code>[Text]</code>?</p>\n"}, {"tags": ["haskell", "if-statement"], "comments": [{"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 1, "creation_date": 1508170486, "post_id": 46774680, "comment_id": 80494981, "body": "&quot;Yes&quot; Furthermore, those nested if statements can be flattened."}, {"owner": {"reputation": 123, "user_id": 7066862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1d70972b971aef9aab1a5351bbeb7a75?s=128&d=identicon&r=PG&f=1", "display_name": "David Andvett", "link": "https://stackoverflow.com/users/7066862/david-andvett"}, "reply_to_user": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 0, "creation_date": 1508170885, "post_id": 46774680, "comment_id": 80495224, "body": "what do you mean flattened?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1508171126, "post_id": 46774680, "comment_id": 80495342, "body": "Haskell doesn&#39;t really have if statements. It has if expressions. What makes you doubt their ability to nest?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1508171171, "post_id": 46774680, "comment_id": 80495366, "body": "What have you tried? Where are you having trouble?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1508175207, "post_id": 46774680, "comment_id": 80497394, "body": "What went wrong when you tried that? Other than a minor typo (<code>Lt</code> for <code>LT</code>) that code works just fine when I try it."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1508177785, "post_id": 46774680, "comment_id": 80498821, "body": "Note that your <code>impCMP</code> function is just <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:compare\" rel=\"nofollow noreferrer\"><code>compare</code></a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1508201346, "post_id": 46774680, "comment_id": 80507994, "body": "See also the <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions#multiwayif\" rel=\"nofollow noreferrer\"><code>MultiWayIf</code> extension</a>"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1508180897, "post_id": 46774907, "comment_id": 80500507, "body": "I don&#39;t understand what you&#39;re trying to say about being syntactic sugar for an <code>if</code> function. There is no such function, of course, and cannot be because <code>if</code> is a reserved token. You might say that it&#39;s a syntactic alternative to <code>Data.Bool.bool :: a -&gt; a -&gt; Bool -&gt; a</code>, although of course the arguments are in a different order."}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1508186539, "post_id": 46774907, "comment_id": 80503348, "body": "@amalloy Thank you, I&#39;ll change the wording. I am sorry if that sounds confusing. What I mean is that <code>if</code> is not something magical and <i>can be thought of</i> as a function <code>if :: Bool -&gt; a -&gt; a -&gt; a</code>. Of course, there is not, and cannot be such a function, you are right. Still, one can just name it differently, effectively implementing the <code>if</code> operator in a function."}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 8, "last_activity_date": 1508221411, "last_edit_date": 1508221411, "creation_date": 1508171202, "answer_id": 46774907, "question_id": 46774680, "link": "https://stackoverflow.com/questions/46774680/is-it-possible-to-do-nested-if-statements-in-haskell/46774907#46774907", "title": "Is it possible to do nested if statements in Haskell?", "body": "<p>This trick is that in Haskell <code>if</code> is not a statement, but an expression. It <em>returnes</em> a value from one of the branches, not executes the code there. In fact, <code>if</code> can be though to be just a syntactic sugar to a function <code>if :: Bool -&gt; a -&gt; a -&gt; a</code> <em>(of course, no such function can exist, because <code>if</code> is a keyword; still, one can trivially implement such a function, if it is named differently, <a href=\"https://ideone.com/p5Tqpf\" rel=\"nofollow noreferrer\">like this</a>)</em>.</p>\n\n<p>So, yes, nested <code>if</code> statements are possible, just as any expression, like in </p>\n\n<pre><code>max x y z = if x &lt; y then (if y &lt; z then z else y) else (if x &lt; z then z else x)\n</code></pre>\n\n<p>However, this is not directly applicable to your case, since you cannot do <code>swap</code> that easy: all values are immutable in Haskell. So, if you don't want to use monads or something like that, a solution may be to return the sorted list:</p>\n\n<pre><code>sort [x,y,z] =\n    if x &lt; y then\n        (if y &lt; z then\n            [x,y,z]\n        else\n            (if x &lt; z then\n                [x,z,y]\n                    else\n                [z,x,y]\n            )\n        )\n    else\n        undefined -- implement other cases here\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1508176903, "creation_date": 1508176903, "answer_id": 46776413, "question_id": 46774680, "link": "https://stackoverflow.com/questions/46774680/is-it-possible-to-do-nested-if-statements-in-haskell/46776413#46776413", "title": "Is it possible to do nested if statements in Haskell?", "body": "<p>As lisyarus said, you can do this. However, <code>if</code> is usually a bit awkward in Haskell; usually, pattern matching is a better option \u2014 this avoids the boolean bottleneck and allows you to directly deconstruct meaningful values. In your case, the most obvious thing would be to replace the ugly <code>== LT</code> checks with <code>case</code> expressions:</p>\n\n<pre><code>sort3 cmp [a,b,c] = case cmp a b of\n      LT -&gt; case cmp a c of\n         LT -&gt; ...\n</code></pre>\n\n<p>Since you always check all three anyway though, there's not really a need to nest the checks; you might as well check them all once:</p>\n\n<pre><code>sort3 cmp [a,b,c] = case (cmp a b, cmp a c, cmp b c) of\n       (GT, _ , GT) -&gt; [c,b,a]\n       (GT, LT, _ ) -&gt; [b,a,c]\n       (_ , LT, GT) -&gt; [a,c,b]\n       (_ , GT, _ ) -&gt; [c,a,b]\n       (GT, _ , _ ) -&gt; [b,c,a]\n       _            -&gt; [a,b,c]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1508180564, "creation_date": 1508180564, "answer_id": 46777357, "question_id": 46774680, "link": "https://stackoverflow.com/questions/46774680/is-it-possible-to-do-nested-if-statements-in-haskell/46777357#46777357", "title": "Is it possible to do nested if statements in Haskell?", "body": "<p>For three elements, it doesn't matter, but once you get to four, it really helps to have a notion of swapping, although I wouldn't go with your swapping regime. You can do this by giving each phase of computation its own function.</p>\n\n<pre><code>data Triple a = Triple a a a\nsort3, sort3', sort3''\n  :: Ord a =&gt; Triple a -&gt; Triple a\n\nsort3 t@(Triple x y z)\n  | x &lt;= y = sort3' t\n  | otherwise = sort3' (Triple y x z)\n\n-- Precondition : the first two elements are in order\nsort3' t@(Triple x y z)\n  | x &lt;= z = sort3'' t\n  | otherwise = Triple z x y\n\n-- Precondition: The smallest element is first\nsort3'' t@(Triple x y z)\n  | y &lt;= z = t\n  | otherwise = Triple x z y\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 7066862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1d70972b971aef9aab1a5351bbeb7a75?s=128&d=identicon&r=PG&f=1", "display_name": "David Andvett", "link": "https://stackoverflow.com/users/7066862/david-andvett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3991, "favorite_count": 0, "accepted_answer_id": 46774907, "answer_count": 3, "score": 2, "last_activity_date": 1508221411, "creation_date": 1508170413, "last_edit_date": 1508172710, "question_id": 46774680, "link": "https://stackoverflow.com/questions/46774680/is-it-possible-to-do-nested-if-statements-in-haskell", "title": "Is it possible to do nested if statements in Haskell?", "body": "<p>I'm trying to sort 3 elements in a list.  But i\"m having trouble translating it to haskell.  Is it possible to do nested if statements in haskell?  I've been trying pattern matching, but it is taking me forever.</p>\n\n<pre><code>if (x &lt; y) {\n    if (z &lt; x) swap(x,z);\n} else {\n   if (y &lt; z) swap(x,y);\nelse swap(x,z);\n} \n  if(z&lt;y) swap(y,z);\n</code></pre>\n\n<p>this is what I have tried</p>\n\n<pre><code>intCMP :: Int -&gt; Int -&gt; Ordering\nintCMP a b | a == b =EQ\n           | a &lt; b = LT\n           | otherwise = GT\n\nsort3 :: Ord a =&gt; (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\nsort3 cmp [a,b,c] = if cmp a b == LT then\n                   if cmp a c == Lt then\n                      if cmp b c == LT then\n                         [a,b,c]\n                      else\n                         [a,c,b]\n                   else\n                      [c,a,b]\n                else if cmp b c == LT then\n                        if cmp a c == LT then\n                             [b,a,c]\n                        else\n                             [b,c,a]\n                else\n                     [c,b,a]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1508161707, "post_id": 46771719, "comment_id": 80489327, "body": "What happened when you tried?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1508162110, "post_id": 46771719, "comment_id": 80489632, "body": "<code>Sum (Value 3) (Value 5)</code> will <i>always</i>, by definition, be a distinct value of type <code>Expr</code>; you can&#39;t reduce it to <code>8</code>, because <code>8</code> is not a constructor for <code>Expr</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1508162154, "last_edit_date": 1508162154, "creation_date": 1508161762, "answer_id": 46771957, "question_id": 46771719, "link": "https://stackoverflow.com/questions/46771719/haskell-arithmetic-operations-with-datatypes/46771957#46771957", "title": "Haskell - arithmetic operations with datatypes", "body": "<p>You need to define <code>sum</code> appropriately for each combination of data constructors.</p>\n\n<pre><code>sum :: Expr -&gt; Expr -&gt; Int\nsum (Value x) (Value y) = x + y\nsum (Sum a b) (Sum c d) = sum a b + sum c d\nsum (Value x) (Sub a b) = x + sum a b\nsum (Sum a b) (Value y) = sum a b + y\n</code></pre>\n\n<p>This can be simplified; one way is with a helper function that reduces a single <code>Expr</code> to an integer value first.</p>\n\n<pre><code>value :: Expr -&gt; Int\nvalue (Value x) = x\nvalue (Sum x y) = (value x) + (value y)\n\nsum :: Expr -&gt; Expr -&gt; Int\nsum x y = value x + value y    \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 4, "last_activity_date": 1508163034, "creation_date": 1508163034, "answer_id": 46772376, "question_id": 46771719, "link": "https://stackoverflow.com/questions/46771719/haskell-arithmetic-operations-with-datatypes/46772376#46772376", "title": "Haskell - arithmetic operations with datatypes", "body": "<p>Typically, in this sort of situation, you write an \"evaluator\" or \"interpreter\" -- a single function that accepts an <code>Expr</code> and evaluates it to a value:</p>\n\n<pre><code>eval :: Expr -&gt; Int\n</code></pre>\n\n<p>Then, you can write:</p>\n\n<pre><code>&gt; eval (Sum (Value 3) (Value 5))\n8\n&gt;\n</code></pre>\n\n<p>Haskell's pattern matching for function definitions makes this very elegant:</p>\n\n<pre><code>eval (Value x) = ...\neval (Sum e1 e2) = ...you'll need to use eval recursively here...\n</code></pre>\n\n<p>So, instead of writing multiple functions, one for each component of your <code>Expr</code>, you write a single function with one pattern-based <em>definition</em> for each component.</p>\n\n<p>If this was homework, you might want to stop here and try to figure the details out for yourself.  If it wasn't, then the following should work:</p>\n\n<pre><code>eval :: Expr -&gt; Int\neval (Value x) = x\neval (Sum e1 e2) = eval e1 + eval e2\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8597573, "user_type": "registered", "profile_image": "https://graph.facebook.com/1417513548302465/picture?type=large", "display_name": "Vin&#237;cius Azevedo", "link": "https://stackoverflow.com/users/8597573/vin%c3%adcius-azevedo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1508165512, "creation_date": 1508161080, "last_edit_date": 1508165512, "question_id": 46771719, "link": "https://stackoverflow.com/questions/46771719/haskell-arithmetic-operations-with-datatypes", "title": "Haskell - arithmetic operations with datatypes", "body": "<p>I was writing my own haskell datatype to resolve a sum operation with integers, but i dont know how to make the semantic .</p>\n\n<pre><code>data Expr = Value Int\n    | Sum Expr Expr\n</code></pre>\n\n<p>I was trying to do:</p>\n\n<pre><code>sum:: Expr -&gt; Expr -&gt; Int\nsum a b = b + a\nval:: Int -&gt; Int\nval a = a\n</code></pre>\n\n<p>I want to write like:</p>\n\n<pre><code>Sum (Value 3) (Value 5)\n</code></pre>\n\n<p>And get 8 as return, any ideas?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1508155971, "post_id": 46769716, "comment_id": 80485321, "body": "I think you create your new <code>MVar</code> with a value - you need to extract that value before you put one into it!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1508156395, "post_id": 46769716, "comment_id": 80485632, "body": "This is intended: the semantics of <code>MVar</code> is the one of a 1-position queue protected with a mutex. You create a full queue containing <code>&quot;&quot;</code>. You can&#39;t queue anything else until you empty the queue first with <code>takeMVar</code>. Otherwise <code>putMVar</code> will wait for someone else to empty the queue first. In your case, GHC notices that noone can empty the queue, and triggers the exception instead of getting stuck forever (the runtime is trying to be kind, here, reporting the bug)."}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 6, "last_activity_date": 1508157071, "last_edit_date": 1508157071, "creation_date": 1508156169, "answer_id": 46770127, "question_id": 46769716, "link": "https://stackoverflow.com/questions/46769716/updating-mvar-throws-exception/46770127#46770127", "title": "Updating MVar Throws Exception", "body": "<p>Let's look up the documentation:</p>\n\n<blockquote>\n<pre><code>data MVar a\n</code></pre>\n  \n  <p>An MVar (pronounced \"em-var\") is a synchronising variable, used for\n  communication between concurrent threads. It can be thought of as a a\n  box, which may be empty or full.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n<pre><code>newMVar :: a -&gt; IO (MVar a)\n</code></pre>\n  \n  <p>Create an MVar which contains the supplied value.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n<pre><code>putMVar :: MVar a -&gt; a -&gt; IO ()\n</code></pre>\n  \n  <p>Put a value into an MVar. If the MVar is currently full, putMVar will\n  wait until it becomes empty.</p>\n  \n  <p>There are two further important properties of putMVar:</p>\n  \n  <p>putMVar is single-wakeup. That is, if there are multiple threads\n  blocked in putMVar, and the MVar becomes empty, only one thread will\n  be woken up. The runtime guarantees that the woken thread completes\n  its putMVar operation. When multiple threads are blocked on an MVar,\n  they are woken up in FIFO order. This is useful for providing fairness\n  properties of abstractions built using MVars.</p>\n</blockquote>\n\n<p>melpomene's answer contains the correct explanation. I let my answer remain here for the cited documentation.</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 6, "last_activity_date": 1508156371, "creation_date": 1508156371, "answer_id": 46770180, "question_id": 46769716, "link": "https://stackoverflow.com/questions/46769716/updating-mvar-throws-exception/46770180#46770180", "title": "Updating MVar Throws Exception", "body": "<p><code>x</code> is not an <code>MVar</code>. It is an action that creates an <code>MVar</code>, i.e. it's another name for <code>newMVar \"\"</code>.</p>\n\n<p><code>x &gt;&gt;= \\y -&gt; putMVar y \"foo\"</code> is an action that creates an <code>MVar</code> and names it <code>y</code>. It then tries to put <code>\"foo\"</code> in the <code>MVar</code>. However, <code>y</code> already contains <code>\"\"</code>, so <code>putMVar</code> blocks. It doesn't simply block forever because <code>y</code> is a local variable in this action, meaning no one else has access to it and no readers exist. <code>putMVar</code> detects this situation (deadlock) and throws an exception instead.</p>\n\n<p>What you should do instead is start with:</p>\n\n<pre><code>x &lt;- newMVar \"\"\n</code></pre>\n\n<p>This makes <code>x</code> an <code>MVar</code>.</p>\n\n<p>Then you can take the old value (<code>\"\"</code>) out:</p>\n\n<pre><code>takeMVar x\n</code></pre>\n\n<p>And put a new value in</p>\n\n<pre><code>putMVar x \"foo\"\n</code></pre>\n\n<p>(<code>MVar</code> doesn't support replacing the existing value in one step; you first have to take it out, then put a new value in.)</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 46770180, "answer_count": 2, "score": 1, "last_activity_date": 1508157071, "creation_date": 1508154851, "question_id": 46769716, "link": "https://stackoverflow.com/questions/46769716/updating-mvar-throws-exception", "title": "Updating MVar Throws Exception", "body": "<p>Given:</p>\n\n<pre><code>\u03bb: &gt;let x = Control.Concurrent.MVar.newMVar \"\"\n\u03bb: &gt;:t x\nx :: IO (MVar [Char])\n</code></pre>\n\n<p>I tried to call <code>putMVar</code>:</p>\n\n<pre><code>\u03bb: &gt;:t putMVar\nputMVar :: MVar a -&gt; a -&gt; IO ()\n\n\u03bb: &gt;:t x\nx :: IO (MVar [Char])\n</code></pre>\n\n<p>yet it failed</p>\n\n<pre><code>\u03bb: &gt;x &gt;&gt;= \\y -&gt; putMVar y \"foo\"\n:^?^?\n\n*** Exception: thread blocked indefinitely in an MVar operation\n</code></pre>\n\n<p>Why did it fail and how can I update <code>x</code> with <code>\"foo\"</code> rather than <code>\"\"</code>?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1508151550, "post_id": 46768523, "comment_id": 80482559, "body": "You can also just use <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:sortOn\" rel=\"nofollow noreferrer\"><code>sortOn</code></a>: <code>sortOnGetting g = sortOn (view g)</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1508151647, "post_id": 46768523, "comment_id": 80482620, "body": "@jpath thx - for some reason I always forget that this function exists!"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 4, "last_activity_date": 1508150908, "creation_date": 1508150908, "answer_id": 46768523, "question_id": 46766656, "link": "https://stackoverflow.com/questions/46766656/pass-a-lens-into-a-function/46768523#46768523", "title": "Pass a lens into a function", "body": "<p>You can implement your <code>sortByLens</code> - or rather <code>sortByGetting</code> function. Starting with your definitions</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nmodule Test where\n\nimport Control.Lens\nimport Data.Function (on)\nimport Data.List (compare, sortBy)\n\ndata Rectangle = Rectangle { _height :: Int, _width :: Int }\n$(makeLenses ''Rectangle)\n</code></pre>\n\n<p>we will start to create your desired function in ghci:</p>\n\n<pre><code>stack ghci test.hs --package lens\n\n&gt; import Control.Lens\n&gt; import Data.Function\n&gt; import Data.List\n&gt; :t sortBy\nsortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n&gt; :t on\non :: (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c\n&gt; :t compare\ncompare :: Ord a =&gt; a -&gt; a -&gt; Ordering\n</code></pre>\n\n<p>putting these together with your approach</p>\n\n<pre><code>&gt;:t sortBy (compare `on` (view height))\nsortBy (compare `on` (view height)) :: [Rectangle] -&gt; [Rectangle]\n</code></pre>\n\n<p>to get this a bit more general we do the following</p>\n\n<pre><code>&gt;:t \\lens -&gt; sortBy (compare `on` (view lens))\n\\lens -&gt; sortBy (compare `on` (view lens)) :: Ord a =&gt; Getting a s a -&gt; [s] -&gt; [s]\n</code></pre>\n\n<p>and so we can define</p>\n\n<pre><code>sortByGetting :: Ord a =&gt; Getting a s a -&gt; [s] -&gt; [s]\nsortByGetting g = sortBy (compare `on` view g)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1508150921, "creation_date": 1508150921, "answer_id": 46768529, "question_id": 46766656, "link": "https://stackoverflow.com/questions/46766656/pass-a-lens-into-a-function/46768529#46768529", "title": "Pass a lens into a function", "body": "<p>Aside from typos, your code actually works pretty much as it is \u2013 the only things that obviously needed is that <code>b</code> be in fact comparable. The following works:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, RankNTypes #-}\nimport Control.Lens\nimport Control.Lens.TH\nimport Data.List\n\ndata Rectangle = Rectangle { _height :: Int, _width :: Int }\n  deriving (Show)\nmakeLenses ''Rectangle\n\nlensSort :: Ord b =&gt; Lens' a b -&gt; a -&gt; a -&gt; Ordering\nlensSort lens x y | x ^. lens &gt; y ^. lens = GT\n                    | x ^. lens &lt; y ^. lens = LT\n                    | otherwise = GT\n\nfoo :: [Rectangle]\nfoo = [Rectangle 1 2, Rectangle 2 1]\n\nmain = print $ sortBy (lensSort height) foo\n-- [Rectangle {_height = 1, _width = 2},Rectangle {_height = 2, _width = 1}]\n</code></pre>\n\n<p>Note that there is not really a need to pass around an actual lens, because you only use it as a getter (\u2245function) anyway. So you can just do</p>\n\n<pre><code>import Data.Ord (comparing)\nmain = print $ sortBy (comparing (^.height))\n</code></pre>\n\n<p>...without any extra definitions.</p>\n"}], "owner": {"reputation": 7598, "user_id": 2068327, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/mUStx.jpg?s=128&g=1", "display_name": "eddiec", "link": "https://stackoverflow.com/users/2068327/eddiec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 46768529, "answer_count": 2, "score": 4, "last_activity_date": 1508150921, "creation_date": 1508144894, "question_id": 46766656, "link": "https://stackoverflow.com/questions/46766656/pass-a-lens-into-a-function", "title": "Pass a lens into a function", "body": "<p>I'd like to perform a sort based on a specific value within a record. As such I was thinking of passing a lens into a <code>lensSort</code> function but I've been unable to make it work.</p>\n\n<p>Ideally I could do something like this</p>\n\n<pre><code>lensSort :: HasLens a =&gt; Lens' a b -&gt; a -&gt; a -&gt; -&gt; Ordering\nlensSort lens x y | x ^. lens &gt; y ^. lens = GT\n                    | x ^. lens &lt; y ^. lens = LT\n                    | otherwise = GT\n</code></pre>\n\n<p>And be able to call it with something like</p>\n\n<pre><code>data Rectangle = Rectangle { _height :: Int, _width :: Int }\nmakeLenses'' Rectangle\n\nlet foo = [Rectangle 1 2, Rectangle 2 1]\nsortBy (lensSort height) foo\n</code></pre>\n\n<p>I'm failing to get this to work, and concerned I might be barking up the wrong tree completely, I'm still new to Haskell.</p>\n"}, {"tags": ["parsing", "haskell", "custom-type"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1508134396, "post_id": 46763889, "comment_id": 80473025, "body": "Why do you not want to use a parser library?"}, {"owner": {"reputation": 101, "user_id": 7219174, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/933696786762072/picture?type=large", "display_name": "Andrei M\u0103d\u0103lin Oanc\u0103", "link": "https://stackoverflow.com/users/7219174/andrei-m%c4%83d%c4%83lin-oanc%c4%83"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1508134598, "post_id": 46763889, "comment_id": 80473087, "body": "Because I am not allowed to use it."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1508134832, "post_id": 46763889, "comment_id": 80473180, "body": "What are the constraints of this homework exercise?"}, {"owner": {"reputation": 101, "user_id": 7219174, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/933696786762072/picture?type=large", "display_name": "Andrei M\u0103d\u0103lin Oanc\u0103", "link": "https://stackoverflow.com/users/7219174/andrei-m%c4%83d%c4%83lin-oanc%c4%83"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1508135308, "post_id": 46763889, "comment_id": 80473385, "body": "This is the only one.I have this customType Expr that has for example the following form Val 2 :*: Var &quot;a&quot; :+: Var &quot;b&quot;. But now I a required to make as imple string like 2*a+b to Val 2 :*: Var &quot;a&quot; :+: Var &quot;b&quot; and use it afterwards . My problem is that I succeded in obtaining &quot; Val 2 :*: Var &quot;a&quot; :+: Var &quot;b&quot; &quot; from the input but now I am stuck as that thing is a string .I just need to find a way to escape &quot; &quot; and use it as a declaration for Expr str . And I am not allowed to use any parser from any library that haskell has."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1508140452, "post_id": 46763889, "comment_id": 80476009, "body": "At this point you&#39;re asking &quot;how to write a Parser&quot;, which might be too broad for a SO question."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1508140728, "post_id": 46763889, "comment_id": 80476174, "body": "Surely your course has taught you something that would indicate roughly what direction to proceed in? Otherwise, this question is much too broad."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1508140828, "post_id": 46763889, "comment_id": 80476225, "body": "What have you tried so far? Where are you having trouble?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508147485, "post_id": 46763889, "comment_id": 80480091, "body": "For this specific expression language, I think you can implement your own parser as a <a href=\"https://en.wikipedia.org/wiki/Operator-precedence_parser\" rel=\"nofollow noreferrer\">operator-precedence parser</a>. You can use a list for your stack. Still, if this is homework, your course should have suggested a specific way to tackle this, and you should follow that suggestion. I can&#39;t believe some instructor assigned a parsing problem without covering the basic techniques first, or at least providing some direction."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1508234508, "post_id": 46763889, "comment_id": 80521130, "body": "A basic partial solution is to add <code>deriving (Read)</code> to <code>Expr</code> and then call <code>read</code> on the result of your \u201cparsing\u201d function. By default it won\u2019t handle precedence; you can implement that by replacing <code>+</code> with <code>)) :+: ((</code> and <code>*</code> with <code>) :*: (</code>\u2014fewer parentheses for higher precedence\u2014and wrapping with <code>((</code>\u2026<code>))</code>. But it won\u2019t handle associativity, so <code>&quot;Val 1 :+: (Val 2 :+: Val 3)&quot;</code> and <code>&quot;(Val 1 :+: Val 2) :+: Val 3&quot;</code> will read correctly, but <code>&quot;Val 1 :+: Val 2 :+: Val 3&quot;</code> will raise an exception. So at this point you should learn how to write a parser, an example of which is in jpath\u2019s answer."}], "answers": [{"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 1, "last_activity_date": 1508149508, "creation_date": 1508149508, "answer_id": 46768072, "question_id": 46763889, "link": "https://stackoverflow.com/questions/46763889/convert-string-to-custom-data-type-haskell/46768072#46768072", "title": "Convert string to custom data type Haskell", "body": "<pre><code>import Control.Applicative (Alternative (empty, many, some, (&lt;|&gt;)), (&lt;**&gt;))\nimport Data.Char           (isSpace, isDigit)\nimport Data.Maybe          (listToMaybe)\n</code></pre>\n\n<p>Writing a basic, inefficient parsing library is actually not that hard and can be done in under 50 lines of code. The core type looks like this:</p>\n\n<pre><code>newtype Parser a = Parser (String -&gt; [(a, String)])\n\nparse :: Parser a -&gt; String -&gt; Maybe a\nparse (Parser p) s = listToMaybe $ fst &lt;$&gt; p s\n</code></pre>\n\n<p>This parser partially consumes a string and returns a parsed result <code>a</code> along with the remainder string. But there may be many parsing alternatives, which is why it returns a list of results and remainders.</p>\n\n<p>For working with this type we need a few more utilities. I left the <code>_</code>s for you to implement.</p>\n\n<pre><code>instance Functor Parser where\n   fmap (Parser p) = _\n\ninstance Applicative Parser where\n   pure a = Parser $ \\s -&gt; (a, s) -- Consumes nothing and returns a\n   Parser pf &lt;*&gt; Parser pa = _    -- Parse pf, then parse pa and apply the result\n                                  -- of pf to that of pa.\n\ninstance Alternative Parser where\n   empty = Parser $ \\s -&gt; []   -- Matches nothing\n   Parser p1 &lt;|&gt; Parser p2 = _ -- Matches either p1 or if that fails p2.\n\nsatisfy :: (Char -&gt; Bool) -&gt; Parser Char\nsatisfy = _\n\nspace :: Parser ()\nspace = () &lt;$ satisfy isSpace\n\nspaces :: Parser ()\nspaces = () &lt;$ many space\n\nchar :: Char -&gt; Parser Char\nchar c = satisfy (c ==)\n\n-- | Detects the end of file.\neof :: Parser ()\neof = _\n\n-- | Succeeds when at the end of a word, without consuming any input\neow :: Parser ()\neow = _\n</code></pre>\n\n<p>Now we can go ahead and use this parser like any recursive descent parser:</p>\n\n<pre><code>data Expr = Val Integer\n          | Expr :*: Expr\n          | Expr :+: Expr\n  deriving Show\n\nparseVal :: Parser Expr\nparseVal =\n  char '(' *&gt; parseAdd &lt;* char ')' &lt;|&gt;\n  Val . read &lt;$&gt; some (satisfy isDigit) &lt;* eow\n\nparseMul :: Parser Expr\nparseMul = _\n\nparseAdd :: Parser Expr\nparseAdd = _\n\nparseExpr :: Parser Expr\nparseExpr = parseAdd &lt;* eof\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 7219174, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/933696786762072/picture?type=large", "display_name": "Andrei M\u0103d\u0103lin Oanc\u0103", "link": "https://stackoverflow.com/users/7219174/andrei-m%c4%83d%c4%83lin-oanc%c4%83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1288, "favorite_count": 0, "closed_date": 1508151260, "answer_count": 1, "score": -1, "last_activity_date": 1508149508, "creation_date": 1508134083, "question_id": 46763889, "link": "https://stackoverflow.com/questions/46763889/convert-string-to-custom-data-type-haskell", "closed_reason": "Needs more focus", "title": "Convert string to custom data type Haskell", "body": "<p>I've created a custom datatype Expr</p>\n\n<pre><code>type Name = String\ntype Domain = [Integer]\ndata Expr = Val Integer\n | Var Name\n | Expr :+: Expr\n | Expr :-: Expr\n | Expr :*: Expr\n | Expr :/: Expr\n | Expr :%: Expr\n    deriving Eq\n</code></pre>\n\n<p>I need to create a parser that creates a datatype Expr from an string without using a parser library in Haskell.</p>\n\n<p>I've created the parser for the initial string that accepts a string of the form \"2*a+b\" and converts it to the form \"Val 2 :*: Var  \"a\"  :+: Var \"b\" \" that is accepted by the Expr but this is where I don't know that to do in order to go further. My problem is that I don't know how to create an Expr from a such a string without a parser library.</p>\n"}, {"tags": ["haskell", "optimization"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1508107301, "post_id": 46760668, "comment_id": 80466792, "body": "What is <code>stdMult3</code>?"}, {"owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1508109715, "post_id": 46760668, "comment_id": 80467250, "body": "It is <code>stdMult</code>. I corrected, thanks."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1508111596, "post_id": 46760668, "comment_id": 80467612, "body": "What happens when you add <code>{-# INLINABLE stdMult #-}</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1508111800, "post_id": 46760668, "comment_id": 80467648, "body": "Separately, you should generally use <code>Criterion</code> for microbenchmarks, rather than trying to roll your own. There are lots of ways to accidentally measure something other than what you think you&#39;re measuring."}, {"owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1508137860, "post_id": 46760668, "comment_id": 80474657, "body": "@dfeuer thanks for good advice!"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508147691, "post_id": 46761301, "comment_id": 80480228, "body": "Perhaps &quot;instead of once per import&quot; could be made more precise as &quot;instead of once per imported use&quot; or something like that. If <code>stdMult</code> is used 10 times, it will be inlined 10 times, I think, so it can be more that &quot;once per import&quot; (which is still a reasonable rough guess, as you state above)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508169667, "post_id": 46761301, "comment_id": 80494542, "body": "@chi, that&#39;s not likely true. The specializer works across modules too, and <i>should</i> create just one specialization per module per type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1508176026, "post_id": 46761301, "comment_id": 80497833, "body": "@dfeuer Interesting. I was perhaps thinking too much about inlining. Thanks."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508176457, "post_id": 46761301, "comment_id": 80498049, "body": "@chi, of course, as usual, the best way to be sure is to actually inspect the compiled core. I don&#39;t have time to play with that today."}], "tags": [], "owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "is_accepted": true, "score": 10, "last_activity_date": 1508112617, "creation_date": 1508112617, "answer_id": 46761301, "question_id": 46760668, "link": "https://stackoverflow.com/questions/46760668/haskell-module-optimization/46761301#46761301", "title": "Haskell module optimization", "body": "<p>(You need the <code>clock</code> and <code>formatting</code> packages from Hackage to compile the code.)</p>\n\n<p>I can reproduce the 10x slowdown when <code>stdMult</code> is in a different module.  Luckily a fix is easy: in the module where <code>stdMult</code> is defined, add an <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#inlinable-pragma\" rel=\"noreferrer\"><code>INLINABLE</code></a> pragma:</p>\n\n<pre><code>{-# INLINABLE stdMult #-}\n</code></pre>\n\n<p>It adds the definition to the interface file (<code>.hi</code>) which allows inlining in the modules that uses it, which in turn allows it to be specialized to fast machine <code>Int</code> instead of slow abstract <code>Ix</code> and <code>Num</code> polymorphic code.  (If it's in the same module GHC can inline and specialize at will, and things aren't <code>INLINABLE</code> by default because it can cause executable code bloat and slower compilation.)</p>\n\n<p>Alternatively to <code>INLINABLE</code>, you can manually <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#specialize-pragma\" rel=\"noreferrer\"><code>SPECIALIZE</code></a> to the types you want optimized implementations for.  This is a bit more verbose, but should be faster to compile in big projects (it will be specialized once per export, instead of once per import, at a rough guess).</p>\n\n<pre><code>{-# SPECIALIZE stdMult :: Array (Int, Int) Int -&gt; Array (Int, Int) Int -&gt; Array (Int, Int) Int #-}\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 46761301, "answer_count": 1, "score": 6, "last_activity_date": 1508112788, "creation_date": 1508106800, "last_edit_date": 1508112788, "question_id": 46760668, "link": "https://stackoverflow.com/questions/46760668/haskell-module-optimization", "title": "Haskell module optimization", "body": "<p>I have a problem with Haskell module optimization.</p>\n\n<p>There is Main module.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Control.DeepSeq\nimport Formatting\nimport Formatting.Clock\nimport System.Clock\n\nimport Data.Array\n\nsize :: Int\nsize = 200 :: Int\n\nstdMult     :: (Ix a, Ix b, Ix c, Num d) =&gt;\n               Array (a,b) d -&gt; Array (b,c) d -&gt; Array (a,c) d\nstdMult x y =  array resultBounds\n                 [((i,j), sum [ x!(i,k) * y!(k,j) | k &lt;- range (lj,uj)])\n                                   | i &lt;- range (li,ui),\n                                     j &lt;- range (lj',uj') ]\n    where ((li,lj),(ui,uj))     = bounds x\n          ((li',lj'),(ui',uj')) = bounds y\n          resultBounds\n            | (lj,uj)==(li',ui') = ((li,lj'),(ui,uj'))\n            | otherwise = error \"error\"\n\n\nmain :: IO ()\nmain = do\n  let a = array ((1,1),(size, size)) [((i,j), 2*i-j) |\n                                  i &lt;- range (1,size),\n                                  j &lt;- range (1,size)]\n  let b = array ((1,1),(size, size)) [((i,j), 2*i+3*j) |\n                                  i &lt;- range (1,size)`,\n                                  j &lt;- range (1,size)]\n\n  start &lt;- getTime ProcessCPUTime\n  let\n    c = stdMult a b\n  end &lt;- c `deepseq` getTime ProcessCPUTime\n  fprint (timeSpecs % \"\\n\") start end\n  return()\n</code></pre>\n\n<p>When <code>stdMult</code> in Main module, everything works ok. I replace <code>stdMult</code> to another module.\nWhen I don't use ghc optimization, execution time is the same.\nWhen I use ghc options -O3, when <code>stdMult</code> in Main module time execution decreases, but when <code>stdMult</code> in another module, execution time is almost unchanged!\nFor example, when <code>stdMult</code> in Main I have time 3 seconds, and when <code>stdMult</code> not in Main I have time 30 seconds, for matrix 500x500.</p>\n\n<p>It is very strange!</p>\n"}, {"tags": ["c", "haskell", "ffi"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1508104664, "post_id": 46760015, "comment_id": 80466138, "body": "How do you expect to read these values out on the C side? Now, write out a Haskell data type that sort of matches the C one, and make a <code>Storable</code> instance for it. Voila. You can mention that type in your <code>foreign export</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1508202542, "post_id": 46760015, "comment_id": 80508284, "body": "<code>Ptr a</code> is allowed in foreign declarations for any <code>a</code>, and in particular <code>Ptr (MyType a)</code> is therefore allowed. Of course the data will be opaque on the C side -- you will need to provide an API for observing facts about these pointers -- but that&#39;s SOP for complicated C libraries anyway."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1508435267, "creation_date": 1508435267, "answer_id": 46835956, "question_id": 46760015, "link": "https://stackoverflow.com/questions/46760015/haskell-ffi-using-data-types-in-a-c-program/46835956#46835956", "title": "Haskell FFI : Using data types in a C program", "body": "<p>The short answer to your question is:</p>\n\n<ul>\n<li>As has been suggested here and in the comments to your related question, start by fully designing your C API, including the C data representations and C functions you expect to be able to use from C code.  This is not a trivial step.  The design decisions you make here will influence the approach you take to exporting (AKA marshaling) these Haskell types out to C and back.</li>\n<li>Use a \"C-to-Haskell\" helper to automate the nuts and bolts of sizing, alignment, and structure member access.  Either <code>hsc2hs</code> or <code>c2hs</code> or both may be helpful.  These tools aren't design for <em>exporting</em> Haskell functions to C, but they are still useful.</li>\n<li>Expect to spend a lot of time reading up on the whole FFI subsystem, studying the generated output from the aforementioned tools, and writing lots of C glue.  Any non-trivial language binding is complex, and the fact that you're trying to expose a library written in a \"high level\" language through bindings in a \"low level\" language makes it all the more challenging.</li>\n</ul>\n\n<p>Now, here's a (very, very) long answer to your question that will actually give you something to work with.  First some needed imports:</p>\n\n<pre><code>-- file: MyLib1.hs\nmodule MyLib1 where\n\nimport Control.Exception.Base\nimport Foreign\nimport Foreign.C\n</code></pre>\n\n<h2>Binding for an Enum</h2>\n\n<p>Let's start with your first data type, a simple sum type with 0-ary constructors:</p>\n\n<pre><code>data OrdSymb = SEQ | SLT | SGT deriving (Show, Eq)\n</code></pre>\n\n<p>To be concrete, let's assume we also have some symbols:</p>\n\n<pre><code>newtype Symbol = Symbol String\n</code></pre>\n\n<p>and we'd like to expose Haskell functions with the following signatures:</p>\n\n<pre><code>compareSymb :: Symbol -&gt; Symbol -&gt; OrdSymb\ncompareSymb (Symbol x) (Symbol y) =\n  case compare x y of { EQ -&gt; SEQ; LT -&gt; SLT; GT -&gt; SGT }\n\ncheckSymb :: Symbol -&gt; OrdSymb -&gt; Symbol -&gt; Bool\ncheckSymb x ord y = compareSymb x y == ord\n</code></pre>\n\n<p>Admittedly, <code>checkSymb</code> is stupid, but I wanted to show examples of functions that both produce <code>OrdSymb</code> results and accept <code>OrdSymb</code> arguments.</p>\n\n<p>Here's the C interface we'd like to have for these data types and functions.  A natural C representation for a sum type with 0-ary constructors is an enum, so we get something like the following:</p>\n\n<pre><code>enum ord_symb {\n        SLT = -1,\n        SEQ = 0,\n        SGT = 1\n};\n</code></pre>\n\n<p>Symbols can just be represented by pointers to NUL-terminated C strings:</p>\n\n<pre><code>typedef char* symbol;\n</code></pre>\n\n<p>and the signatures for the exported functions will look something like:</p>\n\n<pre><code>enum ord_symb compare_symb(symbol x, symbol y);\nbool check_symb(symbol x, enum ord_symb ord, symbol y);\n</code></pre>\n\n<p>Here's how to create the C language binding completely manually, with no C-to-Haskell helper.  It's a little tedious, but seeing it will help you understand what's going on under the hood.</p>\n\n<p>We'll need an explicit mapping, for the <code>OrdSymb</code> type, between the Haskell constructor representation (<code>SLT</code>, <code>SEQ</code>, and <code>SGT</code>) and the C representation as an integer (-1, 0, or 1).  You could do this with a couple of plain functions (e.g., <code>toOrdSymb</code> and <code>fromOrdSymb</code>), though Haskell provides an <code>Enum</code> class with some functions that fit this description:</p>\n\n<pre><code>instance Enum OrdSymb where\n\n  toEnum (-1) = SLT\n  toEnum 0    = SEQ\n  toEnum 1    = SGT\n\n  fromEnum SLT = -1\n  fromEnum SEQ = 0\n  fromEnum SGT = 1\n</code></pre>\n\n<p>For documentation purposes, it's also helpful to define a type to represent the C-side type <code>enum ord_symb</code>.  The C standard says that enums have the same representation as <code>int</code>s, so we'll write:</p>\n\n<pre><code>type C_OrdSymb = CInt\n</code></pre>\n\n<p>Now, because <code>OrdSymb</code> is a simple type, it <em>might</em> make sense to create a <code>Storable</code> instance that can marshal its values to and from a C <code>enum ord_symb</code> in preallocated memory.  That would look like this:</p>\n\n<pre><code>instance Storable OrdSymb where\n  sizeOf _ = sizeOf (undefined :: C_OrdSymb)\n  alignment _ = alignment (undefined :: C_OrdSymb)\n  peek ptr = genToEnum &lt;$&gt; peek (castPtr ptr :: Ptr C_OrdSymb)\n  poke ptr val = poke (castPtr ptr :: Ptr C_OrdSymb) (genFromEnum val)\n</code></pre>\n\n<p>where we've used the helper functions:</p>\n\n<pre><code>genToEnum :: (Integral a, Enum b) =&gt; a -&gt; b\ngenToEnum = toEnum . fromIntegral\n\ngenFromEnum :: (Integral a, Enum b) =&gt; b -&gt; a\ngenFromEnum = fromIntegral . fromEnum\n</code></pre>\n\n<p>The <code>peek</code> and <code>poke</code> here just wrap the corresponding methods for plain <code>CInt</code>s, and they use the <code>toEnum</code> and <code>fromEnum</code> methods defined above to perform the actual transformation.</p>\n\n<p>Note that this <code>Storable</code> instance isn't technically required.  We can marshal <code>OrdSymb</code>s in and out of C <code>enum ord_symb</code>s without such an instance, and in fact in the examples below, that's what we'll do.  However, the <code>Storable</code> could come in handy if we later have to work with a C structure that contains an <code>enum ord_symb</code> member, or if we find we're marshaling arrays of <code>enum ord_symb</code>s or something.</p>\n\n<p>However, it's worth bearing in mind that -- generally speaking -- objects that are marshaled to and from C don't <em>need</em> to be <code>Storable</code>, and making something <code>Storable</code> doesn't magically take care of all the details of marshaling.  In particular, if we tried to write a <code>Storable</code> instance for <code>Symbol</code>, we'd run into trouble.  <code>Storable</code>s are supposed to be of predetermined length, so <code>sizeOf</code> isn't supposed to inspect it's argument.  However, a <code>Symbol</code>'s size depends on the underlying string, so unless we decide to implement a maximum string length and store all <code>Symbol</code>s that way, we shouldn't use a <code>Storable</code> instance here.  Instead, let's write some marshaling functions for <code>Symbol</code>s without the benefit of the <code>Storable</code> class:</p>\n\n<pre><code>peekSymbol :: Ptr Symbol -&gt; IO Symbol\npeekSymbol ptr = Symbol &lt;$&gt; peekCString (castPtr ptr)\n\nnewSymbol :: Symbol -&gt; IO (Ptr Symbol)\nnewSymbol (Symbol str) = castPtr &lt;$&gt; newCString str\n\nfreeSymbol :: Ptr Symbol -&gt; IO ()\nfreeSymbol = free\n</code></pre>\n\n<p>Note that we don't \"poke\" symbols, because we don't normally have a pre-allocated buffer of the correct size into which we're writing the symbol.  Instead, when we want to marshal a <code>Symbol</code> out to C, we'll need to allocate a new C string for it, and that's what <code>newSymbol</code> does.  To avoid a memory leak, we'll need to call <code>freeSymbol</code> (or just <code>free</code>) on symbols once we're done with them (or let the user of our C bindings know that they are responsible for calling the C function <code>free</code> on the pointer).  This also means it may be helpful to write a helper that can be used to wrap a computation that uses a marshalled symbol without leaking the memory.  Again, this is something we won't actually use in this example, but it's a helpful sort of thing to define:</p>\n\n<pre><code>withSymbol :: Symbol -&gt; (Ptr Symbol -&gt; IO a) -&gt; IO a\nwithSymbol sym = bracket (newSymbol sym) freeSymbol\n</code></pre>\n\n<p>Now, we can export our Haskell functions by writing wrappers that perform the marshaling:</p>\n\n<pre><code>mylib_compare_symb :: Ptr Symbol -&gt; Ptr Symbol -&gt; IO C_OrdSymb\nmylib_compare_symb px py = do\n  x &lt;- peekSymbol px\n  y &lt;- peekSymbol py\n  return $ genFromEnum (compareSymb x y)\n\nmylib_check_symb :: Ptr Symbol -&gt; C_OrdSymb -&gt; Ptr Symbol -&gt; IO CInt\nmylib_check_symb px ord py = do\n  x &lt;- peekSymbol px\n  y &lt;- peekSymbol py\n  return $ genFromEnum (checkSymb x (genToEnum ord) y)\n</code></pre>\n\n<p>Note that the <code>genFromEnum</code> in the last line is for the <code>Enum</code> instance for Haskell's <code>Bool</code> type, to turn false/true into 0/1.</p>\n\n<p>Also, it's maybe worth noting that, for these wrappers, we didn't use any <code>Storable</code> instances at all!</p>\n\n<p>Finally, we can export the wrapper functions to C.</p>\n\n<pre><code>foreign export ccall mylib_compare_symb\n  :: Ptr Symbol -&gt; Ptr Symbol -&gt; IO C_OrdSymb\nforeign export ccall mylib_check_symb\n  :: Ptr Symbol -&gt; C_OrdSymb -&gt; Ptr Symbol -&gt; IO CInt\n</code></pre>\n\n<p>If you put all of the above Haskell code into <code>MyLib1.hs</code>, create\n<code>mylib.h</code>, <code>example1.c</code>, and <code>ffitypes.cabal</code> with contents as follows:</p>\n\n<pre><code>// file: mylib.h\n#ifndef MYLIB_H\n#define MYLIB_H\n\nenum ord_symb {\n        SLT = -1,\n        SEQ = 0,\n        SGT = 1\n};\ntypedef char* symbol;   // NUL-terminated string\n\n// don't need these signatures -- they'll be autogenerated into\n// MyLib1_stub.h\n//enum ord_symb compare_symb(symbol x, symbol y);\n//bool check_symb(symbol x, enum ord_symb ord, symbol y);\n\n#endif\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>// file: example1.c\n#include &lt;HsFFI.h&gt;\n#include \"MyLib1_stub.h\"\n#include &lt;stdio.h&gt;\n\n#include \"mylib.h\"\n\nint main(int argc, char *argv[])\n{\n    hs_init(&amp;argc, &amp;argv);\n\n    symbol foo = \"foo\";\n    symbol bar = \"bar\";\n\n    printf(\"%s\\n\", mylib_compare_symb(foo, bar) == SGT ? \"pass\" : \"fail\");\n    printf(\"%s\\n\", mylib_check_symb(foo, SGT, bar) ? \"pass\" : \"fail\");\n    printf(\"%s\\n\", mylib_check_symb(foo, SEQ, bar) ? \"fail\" : \"pass\");\n\n    hs_exit();\n    return 0;\n}\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>-- file: ffitypes.cabal\nname:                 ffitypes\nversion:              0.1.0.0\ncabal-version:        &gt;= 1.22\nbuild-type:           Simple\n\nexecutable example1\n  main-is:            example1.c\n  other-modules:      MyLib1\n  include-dirs:       .\n  includes:           mylib.h\n  build-depends:      base\n  default-language:   Haskell2010\n  cc-options:         -Wall -O\n  ghc-options:        -Wall -Wno-incomplete-patterns -O\n</code></pre>\n\n<p>and put everything in a fresh <code>ffitypes</code> directory.  Then, from that directory:</p>\n\n<pre><code>$ stack init\n$ stack build\n$ stack exec example1\n</code></pre>\n\n<p>should work to run the example.</p>\n\n<h2>Marshaling a Parameterized, Recursive Type</h2>\n\n<p>Now, let's turn to your more complicated <code>MyType</code>.  I've changed the <code>Int</code> to an <code>Int32</code> so it'll match a <code>CInt</code> on typical platforms.  </p>\n\n<pre><code>data MyType a =\n        TypeDouble Double\n      | TypeInt Int32\n      | TypeVar a \n      | TypeAdd (MyType a) (MyType a)\n</code></pre>\n\n<p>This is a sum type with unary and binary constructors, an arbitrary type parameter <code>a</code>, and recursive structure, so pretty complicated. Again, it's important to begin by specifying a concrete C implementation.  A C union can be used to store a complicated sum type, but we'll also want to \"tag\" the union with a enum to indicate which constructor the union is representing, so the C type will look something like this:</p>\n\n<pre><code>typedef struct mytype_s {\n        enum mytype_cons_e {\n                TYPEDOUBLE,\n                TYPEINT,\n                TYPEVAR,\n                TYPEADD\n        } mytype_cons;\n        union {\n                double type_double;\n                int type_int;\n                void* type_var;\n                struct {\n                        struct mytype_s *left;\n                        struct mytype_s *right;\n                } type_add;\n        } mytype_value;\n} mytype;\n</code></pre>\n\n<p>Note that, to allow the C bindings to work with <code>MyType a</code>s with multiple possible parameters <code>a</code>, we need to use a <code>void*</code> for the <code>type_var</code> union member.</p>\n\n<p>Writing the marshalling functions for <code>MyType</code> entirely manually is very painful and error prone.  There are a lot of details about the exact size, alignment, and layout of C structures that you'd need to get right.  Instead, we'll use the <code>c2hs</code> helper package.  We'll start with a little preamble at the top of a new <code>MyLib2.chs</code>:</p>\n\n<pre><code>-- file: MyLib2.chs\nmodule MyLib2 where\n\nimport Foreign\nimport Foreign.C\n\n#include \"mylib.h\"\n</code></pre>\n\n<p>The <code>c2hs</code> package is great for working with enums.  For example, creating marshalling infrastructure for the <code>enum mytype_cons_e</code> tag with this package looks like this:</p>\n\n<pre><code>-- file: MyLib2.chs\n{#enum mytype_cons_e as MyTypeCons {}#}\n</code></pre>\n\n<p>Note that this <em>automatically</em> retrieves the definition from the C header <code>mylib.h</code>, creates a Haskell definition equivalent to:</p>\n\n<pre><code>-- data MyTypeCons = TYPEDOUBLE | TYPEINT | etc.\n</code></pre>\n\n<p>and defines the needed <code>Enum</code> instance to map the Haskell constructors to and from the integer values on the C side.  It'll be useful to have our generalized <code>toEnum</code> and <code>fromEnum</code> helpers here, too:</p>\n\n<pre><code>genToEnum :: (Integral a, Enum b) =&gt; a -&gt; b\ngenToEnum = toEnum . fromIntegral\n\ngenFromEnum :: (Integral a, Enum b) =&gt; b -&gt; a\ngenFromEnum = fromIntegral . fromEnum\n</code></pre>\n\n<p>Now, let's look at marshalling your data type:</p>\n\n<pre><code>data MyType a =\n  TypeDouble Double\n  | TypeInt Int32\n  | TypeVar a \n  | TypeAdd (MyType a) (MyType a)\n</code></pre>\n\n<p>to and from a <code>struct mytype_s</code>.  One warning: these implementations assume that the recursive constructor <code>TypeAdd</code> and its C analogue <code>type_add</code> are never used to create \"cycles\" on the C or Haskell side.  Handling data structures that are recursive in the sense that <code>let x = 0:x</code> is recursive would require a different approach.</p>\n\n<p>Because <code>struct mytype_s</code> is a fixed-length structure, you might think it would be a good candidate for a <code>Storable</code> instance, but that turns out not to be the case.  Because of the embedded pointer in the <code>type_var</code> union member and the recursive pointers in the <code>type_add</code> member, it's not possible to write a reasonable <code>Storable</code> instance for <code>MyType</code>.  We <em>could</em> write one for:</p>\n\n<pre><code>data C_MyType a =\n  C_TypeDouble Double\n  | C_TypeInt Int32\n  | C_TypeVar (Ptr a)\n  | C_TypeAdd (Ptr (MyType a)) (Ptr (MyType a))\n</code></pre>\n\n<p>where the pointers have been made explicit.  When we marshall this, we'll assume we've already marshalled the \"child\" nodes and have pointers to them that we can marshall out to the structure.  For the <code>C_TypeAdd</code> constructor, I could have written this instead:</p>\n\n<pre><code>  -- C_TypeAdd (Ptr (C_MyType a)) (Ptr (C_MyType a))\n</code></pre>\n\n<p>It doesn't really matter, since we'll be freely casting <code>Ptr</code>s back and forth between <code>MyType</code>s and <code>C_MyType</code>s .  I decided to use my definition because it got rid of two <code>castPtr</code> calls.</p>\n\n<p>The <code>Storable</code> instance for <code>C_MyType</code> looks like this.  Note how <code>c2hs</code> allows us to look up sizes, alignments, and offsets automatically.  We'd have to calculate these all manually otherwise.</p>\n\n<pre><code>instance Storable (C_MyType a) where\n  sizeOf _ = {#sizeof mytype_s#}\n  alignment _ = {#alignof mytype_s#}\n  peek p = do\n    typ &lt;- genToEnum &lt;$&gt; {#get struct mytype_s-&gt;mytype_cons#} p\n    case typ of\n      TYPEDOUBLE -&gt;\n        C_TypeDouble . (\\(CDouble x) -&gt; x)\n        &lt;$&gt; {#get struct mytype_s-&gt;mytype_value.type_double#} p\n      TYPEINT    -&gt;\n        C_TypeInt    . (\\(CInt    x) -&gt; x)\n        &lt;$&gt; {#get struct mytype_s-&gt;mytype_value.type_int   #} p\n      TYPEVAR    -&gt;\n        C_TypeVar . castPtr &lt;$&gt; {#get struct mytype_s-&gt;mytype_value.type_var#} p\n      TYPEADD    -&gt; do\n        q1 &lt;- {#get struct mytype_s-&gt;mytype_value.type_add.left#} p\n        q2 &lt;- {#get struct mytype_s-&gt;mytype_value.type_add.right#} p\n        return $ C_TypeAdd (castPtr q1) (castPtr q2)\n  poke p t = case t of\n    C_TypeDouble x -&gt; do\n      tag TYPEDOUBLE\n      {#set struct mytype_s-&gt;mytype_value.type_double#} p (CDouble x)\n    C_TypeInt x    -&gt; do\n      tag TYPEINT\n      {#set struct mytype_s-&gt;mytype_value.type_int   #} p (CInt    x)\n    C_TypeVar q    -&gt; do\n      tag TYPEVAR\n      {#set struct mytype_s-&gt;mytype_value.type_var   #} p (castPtr q)\n    C_TypeAdd q1 q2 -&gt; do\n      tag TYPEADD\n      {#set struct mytype_s-&gt;mytype_value.type_add.left #} p (castPtr q1)\n      {#set struct mytype_s-&gt;mytype_value.type_add.right#} p (castPtr q2)\n\n    where\n      tag = {#set struct mytype_s-&gt;mytype_cons#} p . genFromEnum\n</code></pre>\n\n<p>With the <code>Storable</code> instance for <code>C_MyType</code> out of the way, the marshalling functions for a <em>real</em> <code>MyType</code> look pretty clean:</p>\n\n<pre><code>peekMyType :: (Ptr a -&gt; IO a) -&gt; Ptr (MyType a) -&gt; IO (MyType a)\npeekMyType peekA p = do\n  ct &lt;- peek (castPtr p)\n  case ct of\n    C_TypeDouble x -&gt; return $ TypeDouble x\n    C_TypeInt    x -&gt; return $ TypeInt    x\n    C_TypeVar    q -&gt; TypeVar &lt;$&gt; peekA q\n    C_TypeAdd q1 q2 -&gt; do\n      t1 &lt;- peekMyType peekA q1\n      t2 &lt;- peekMyType peekA q2\n      return $ TypeAdd t1 t2\n\nnewMyType :: (a -&gt; IO (Ptr a)) -&gt; MyType a -&gt; IO (Ptr (MyType a))\nnewMyType newA t = do\n  p &lt;- malloc\n  case t of\n    TypeDouble x  -&gt; poke p (C_TypeDouble x)\n    TypeInt    x  -&gt; poke p (C_TypeInt    x)\n    TypeVar    v  -&gt; poke p . C_TypeVar =&lt;&lt; newA v\n    TypeAdd t1 t2 -&gt; do\n      q1 &lt;- newMyType newA t1\n      q2 &lt;- newMyType newA t2\n      poke p (C_TypeAdd q1 q2)\n  return (castPtr p)  -- case from Ptr C_MyType to Ptr MyType\n\nfreeMyType :: (Ptr a -&gt; IO ()) -&gt; Ptr (MyType a) -&gt; IO ()\nfreeMyType freeA p = do\n  ct &lt;- peek (castPtr p)\n  case ct of\n    C_TypeVar q -&gt; freeA q\n    C_TypeAdd q1 q2 -&gt; do\n      freeMyType freeA q1\n      freeMyType freeA q2\n    _ -&gt; return ()  -- no children to free\n  free p\n</code></pre>\n\n<p>Note how we need to use helpers for the <code>a</code> type.  Whenever we want to make a <code>newMyType</code> for a <code>MyType a</code>, we'll need to provide a tailored <code>newA</code> for the <code>a</code> type.  It would be possible to make this into a typeclass and even create an instance for all <code>Storable a</code>, but I haven't done that here.</p>\n\n<p>Now, suppose we have a Haskell function that uses all these data types that we'd like to export to C:</p>\n\n<pre><code>replaceSymbols :: OrdSymb -&gt; Symbol -&gt; Symbol -&gt; MyType Symbol -&gt; MyType Symbol\nreplaceSymbols ord sym1 sym2 = go\n  where\n    go (TypeVar s) | checkSymb s ord sym1 = TypeVar sym2\n    go (TypeAdd t1 t2) = TypeAdd (go t1) (go t2)\n    go rest = rest\n</code></pre>\n\n<p>with the helper functions previously defined:</p>\n\n<pre><code>compareSymb :: Symbol -&gt; Symbol -&gt; OrdSymb\ncompareSymb (Symbol x) (Symbol y) =\n  case compare x y of { EQ -&gt; SEQ; LT -&gt; SLT; GT -&gt; SGT }\n\ncheckSymb :: Symbol -&gt; OrdSymb -&gt; Symbol -&gt; Bool\ncheckSymb x ord y = compareSymb x y == ord\n</code></pre>\n\n<p>We'll need a few other things in <code>MyLib2.chs</code>.  First, we'll use <code>c2hs</code> to define the <code>OrdSymb</code> type (again, this automatically generates the associated <code>data OrdSymb</code>):</p>\n\n<pre><code>{#enum ord_symb as OrdSymb {} deriving (Show, Eq)#}\ntype C_OrdSymb = CInt\n</code></pre>\n\n<p>and the symbol-marshalling code copied from <code>MyLib1.hs</code>:</p>\n\n<pre><code>newtype Symbol = Symbol String\n\npeekSymbol :: Ptr Symbol -&gt; IO Symbol\npeekSymbol ptr = Symbol &lt;$&gt; peekCString (castPtr ptr)\n\nnewSymbol :: Symbol -&gt; IO (Ptr Symbol)\nnewSymbol (Symbol str) = castPtr &lt;$&gt; newCString str\n\nfreeSymbol :: Ptr Symbol -&gt; IO ()\nfreeSymbol = free\n</code></pre>\n\n<p>Then, we can write the following C wrapper:</p>\n\n<pre><code>mylib_replace_symbols :: C_OrdSymb -&gt; Ptr Symbol -&gt; Ptr Symbol\n    -&gt; Ptr (MyType Symbol) -&gt; IO (Ptr (MyType Symbol))\nmylib_replace_symbols ord psym1 psym2 pt = do\n  sym1 &lt;- peekSymbol psym1\n  sym2 &lt;- peekSymbol psym2\n  t &lt;- peekMyType peekSymbol pt\n  let t' = replaceSymbols (genToEnum ord) sym1 sym2 t\n  newMyType newSymbol t'\n</code></pre>\n\n<p>Given that this returns a malloced data structure, it's helpful to also provide an exported function to free it:</p>\n\n<pre><code>mylib_free_mytype_symbol :: Ptr (MyType Symbol) -&gt; IO ()\nmylib_free_mytype_symbol = freeMyType freeSymbol\n</code></pre>\n\n<p>And let's export them:</p>\n\n<pre><code>foreign export ccall mylib_replace_symbols\n  :: C_OrdSymb -&gt; Ptr Symbol -&gt; Ptr Symbol\n       -&gt; Ptr (MyType Symbol) -&gt; IO (Ptr (MyType Symbol))\nforeign export ccall mylib_free_mytype_symbol\n  :: Ptr (MyType Symbol) -&gt; IO ()\n</code></pre>\n\n<p>If you take all the Haskell code in this section, starting with the <code>module MyLib2</code> line and put it in <code>MyLib2.chs</code>, then create/modify the following files:</p>\n\n<pre><code>// file: mylib.h\n#ifndef MYLIB_H\n#define MYLIB_H\n\nenum ord_symb {\n    SLT = -1,\n    SEQ = 0,\n    SGT = 1\n};\ntypedef char* symbol;   // NUL-terminated string\n\ntypedef struct mytype_s {\n    enum mytype_cons_e {\n        TYPEDOUBLE,\n        TYPEINT,\n        TYPEVAR,\n        TYPEADD\n    } mytype_cons;\n    union {\n        double type_double;\n        int type_int;\n        void* type_var;\n        struct {\n            struct mytype_s *left;\n            struct mytype_s *right;\n        } type_add;\n    } mytype_value;\n} mytype;\n\n#endif\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>// file: example2.c\n#include &lt;HsFFI.h&gt;\n#include \"MyLib2_stub.h\"\n#include &lt;stdio.h&gt;\n\n#include \"mylib.h\"\n\n// AST for:   1.0 + foo\nmytype node1 = { TYPEDOUBLE, {type_double: 1.0} };\nmytype node2 = { TYPEVAR,    {type_var: \"foo\"} };\nmytype root  = { TYPEADD,    {type_add: {&amp;node1, &amp;node2} } };\n\nint main(int argc, char *argv[])\n{\n    hs_init(&amp;argc, &amp;argv);\n\n    mytype *p1 = mylib_replace_symbols(SEQ, \"foo\", \"bar\", &amp;root);\n    printf(\"%s\\n\",  // should print \"bar\"\n       (char*) p1-&gt;mytype_value.type_add.right-&gt;mytype_value.type_var);\n    mytype *p2 = mylib_replace_symbols(SEQ, \"quux\", \"bar\", &amp;root);\n    printf(\"%s\\n\",  // unchanged -- should still be \"foo\"\n       (char*) p2-&gt;mytype_value.type_add.right-&gt;mytype_value.type_var);\n\n    mylib_free_mytype_symbol(p1);\n    mylib_free_mytype_symbol(p2);\n\n    hs_exit();\n    return 0;\n}\n</code></pre>\n\n<p>and add the <code>executable example2</code> clause to your Cabal file:</p>\n\n<pre><code>-- file: ffitypes.cabal\nname:                 ffitypes\nversion:              0.1.0.0\ncabal-version:        &gt;= 1.22\nbuild-type:           Simple\n\nexecutable example1\n  main-is:            example1.c\n  other-modules:      MyLib1\n  include-dirs:       .\n  includes:           mylib.h\n  build-depends:      base\n  default-language:   Haskell2010\n  cc-options:         -Wall -O\n  ghc-options:        -Wall -Wno-incomplete-patterns -O\n\nexecutable example2\n  main-is:            example2.c\n  other-modules:      MyLib2\n  include-dirs:       .\n  includes:           mylib.h\n  build-depends:      base\n  build-tools:        c2hs\n  default-language:   Haskell2010\n  cc-options:         -Wall -O\n  ghc-options:        -Wall -Wno-incomplete-patterns -O\n</code></pre>\n\n<p>and stick them all in the <code>ffitypes</code> directory, then you should be able to <code>stack build</code> and <code>stack exec example2</code>.</p>\n\n<h2>Language Bindings are Hard!</h2>\n\n<p>As you can perhaps tell from the code above, it takes a lot of work to create even simple C bindings for Haskell libraries.  If it's any consolation, creating Haskell bindings for C libraries is only a little bit easier.  Best of luck!</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 1, "accepted_answer_id": 46835956, "answer_count": 1, "score": 1, "last_activity_date": 1508435267, "creation_date": 1508101727, "question_id": 46760015, "link": "https://stackoverflow.com/questions/46760015/haskell-ffi-using-data-types-in-a-c-program", "title": "Haskell FFI : Using data types in a C program", "body": "<p>I wrote a library with Haskell and I would like it to be used in C programs. I have read some documentation about using the <code>foreign export ccall</code> command and the <code>Foreign</code> module. </p>\n\n<p>I have seen some example such as <a href=\"https://en.wikibooks.org/wiki/Haskell/FFI#Calling_Haskell_from_C\" rel=\"nofollow noreferrer\">this one</a> but these examples use common C types like <code>Int</code> or <code>Double</code>.</p>\n\n<p>In my library, I created some data types like : </p>\n\n<pre><code>data OrdSymb = SEQ\n             | SLT\n             | SGT\n</code></pre>\n\n<p>or recursives with a supplied type  :</p>\n\n<pre><code>data MyType a =\n        TypeDouble Double\n      | TypeInt Int\n      | TypeVar a \n      | TypeAdd (MyType a) (MyType a) \n</code></pre>\n\n<p>But I didn't find how to use/export these types with the FFI.</p>\n\n<p><strong>How can I export my own data types to C and use them in the <code>foreign</code> declarations to export my functions ?</strong></p>\n"}, {"tags": ["haskell", "io", "monads"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1508089000, "post_id": 46757938, "comment_id": 80461189, "body": "&quot;If I understand correctly the do statement is supposed to pull the String out of the Monad.&quot; Not quite. Have you done any IO in Haskell before?"}, {"owner": {"reputation": 11, "user_id": 3838173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05bddfba1ac305026767b6ffae2bb647?s=128&d=identicon&r=PG&f=1", "display_name": "Doyc", "link": "https://stackoverflow.com/users/3838173/doyc"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1508089397, "post_id": 46757938, "comment_id": 80461337, "body": "No, this is my first time dealing with IO and Monads. I have been working from the examples at <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a>. And I have read through the book."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1508093455, "post_id": 46757938, "comment_id": 80462866, "body": "Very roughly, <code>do x &lt;- action ; ...</code> does pull <code>x</code> out of the IO <code>action</code>, but <i>only</i> if the subsequent <code>...</code> are still working inside IO, so that the final return type is of the form <code>IO something</code>. There is no way to just &quot;remove IO&quot; -- this is because, by design, we want <code>IO</code> to show up in the return type of any function which does IO. That&#39;s the whole point! You could read <a href=\"http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html\" rel=\"nofollow noreferrer\">monads in picutres</a> for more examples."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1508091059, "creation_date": 1508091059, "answer_id": 46758363, "question_id": 46757938, "link": "https://stackoverflow.com/questions/46757938/how-to-use-readfile/46758363#46758363", "title": "How to use readFile", "body": "<p>Let's look at your first function with explicit types:</p>\n\n<pre><code>readLevelFile f = do\n    (fileContent :: String) &lt;-\n                  (readFile :: String -&gt; IO String) (f :: String) :: IO String\n</code></pre>\n\n<p><code>fileContent</code> is indeed of type <code>String</code> but is only available within the execution of the IO Monad under which we are evaluating.  Now what?</p>\n\n<pre><code>    (map lineToFallingRegion (lines fileContent))  :: [String]\n</code></pre>\n\n<p>Now you are suddenly using an expression that is not an <code>IO</code> monad but instead is a list value - since lists are also a type of monad the type check tries to unify <code>IO</code> with <code>[]</code>.  What you actually wanted is to return this value:</p>\n\n<pre><code>return (map lineToFallingRegion (lines fileContent)) :: IO [String]\n</code></pre>\n\n<p>Now recalling that we can't ever \"exit\" the IO monad your <code>readLevelFile</code> type must be IO - an honest admission that it interacts with the outside world:</p>\n\n<pre><code>readLevelFile :: FilePath -&gt; IO [FallingRegion]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1508151456, "post_id": 46758367, "comment_id": 80482515, "body": "I don&#39;t think <code>do { fileContent &lt;- readFile f; map ... }</code> should work; it needs a <code>return</code> around the <code>map</code> or some similar change."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1508152892, "post_id": 46758367, "comment_id": 80483385, "body": "@DanielWagner Yes, you&#39;re correct. Thank you for the correction. I admit that I didn&#39;t try to compile the code, because the code in the OP is incomplete."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1508152815, "last_edit_date": 1508152815, "creation_date": 1508091076, "answer_id": 46758367, "question_id": 46757938, "link": "https://stackoverflow.com/questions/46757938/how-to-use-readfile/46758367#46758367", "title": "How to use readFile", "body": "<p>You can't pull things out of <code>IO</code>. You can think of <code>IO</code> as a container (in fact, some interpretations of <code>IO</code> liken it to the box containing Schr\u00f6dinger's cat). You can't see what's in the container, but if you <em>step into</em> the container, values become visible.</p>\n\n<p>So this should work:</p>\n\n<pre><code>readLevelFile f = do\n    fileContent &lt;-  readFile f\n    return (map lineToFallingRegion (lines fileContent))\n</code></pre>\n\n<p>It does not, however, have the type given in the OP. Inside the <code>do</code> block, <code>fileContent</code> is a <code>String</code> value, but the entire block is still inside the <code>IO</code> container.</p>\n\n<p>This means that the return type of the function isn't <code>[FallingRegion]</code>, but <code>IO [FallingRegion]</code>. So if you change the type annotation for <code>readLevelFile</code> to</p>\n\n<pre><code>readLevelFile :: FilePath -&gt; IO [FallingRegion]\n</code></pre>\n\n<p>you should be able to get past the first hurdle.</p>\n"}], "owner": {"reputation": 11, "user_id": 3838173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05bddfba1ac305026767b6ffae2bb647?s=128&d=identicon&r=PG&f=1", "display_name": "Doyc", "link": "https://stackoverflow.com/users/3838173/doyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 791, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1508152815, "creation_date": 1508088631, "last_edit_date": 1508091312, "question_id": 46757938, "link": "https://stackoverflow.com/questions/46757938/how-to-use-readfile", "title": "How to use readFile", "body": "<p>I am having trouble reading in a level file in Haskell. The goal is to read in a simple txt file with two numbers seperated by a space and then commas. The problem I keep getting is this: Couldn't match type <code>`IO' with `[]'</code></p>\n\n<p>If I understand correctly the do statement is supposed to pull the String out of the Monad.</p>\n\n<pre><code>readLevelFile :: FilePath -&gt; [FallingRegion]\nreadLevelFile f = do\n        fileContent &lt;-  readFile f\n        (map lineToFallingRegion (lines fileContent))\n\nlineToFallingRegion :: String -&gt; FallingRegion\nlineToFallingRegion s = map textShapeToFallingShape (splitOn' (==',') s) \n\ntextShapeToFallingShape :: String -&gt; FallingShape\ntextShapeToFallingShape s = FallingShape (read $ head numbers) (read $ head \n$ tail numbers)\n                      where numbers = splitOn' (==' ') s\n</code></pre>\n"}, {"tags": ["haskell", "io", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1508092876, "creation_date": 1508092876, "answer_id": 46758671, "question_id": 46757896, "link": "https://stackoverflow.com/questions/46757896/haskell-io-program-that-calculates-mean-and-highest-value/46758671#46758671", "title": "Haskell IO program that calculates mean and highest value", "body": "<p>While not optimal, your program is almost working. Here's some minor fixes and cleanups. I tried to keep your original code when possible, even if there might be better solutions.</p>\n\n<p>First, you are using <code>cAverage</code> which is not defined. This error can be easily fixed.</p>\n\n<p>The <code>average2</code> parameter is pointless, since it is unused -- let's remove it.</p>\n\n<p>Some <code>let</code>s can be moved to the branches where we actually use those variables.</p>\n\n<p>We can also perform a minor refactoring and compute the new <code>bigger</code> value using a conditional, instead of using a conditional to perform two different recursive calls. (It would be even better to use the <code>max</code> function, though.)</p>\n\n<p>Consider to rename \"bigger\" to \"biggest\", or \"greatest\", or \"maximum\". It sounds better to me.</p>\n\n<pre><code>a6 :: Int -&gt; Int -&gt; Int -&gt; IO()\na6 bigger oldSum count = do\n c &lt;- getLine\n let digit = read c :: Int\n if digit &lt;= 0\n     then let average = fromIntegral oldSum / fromIntegral count :: Double\n          in putStrLn (\"Bigger: \" ++ show bigger ++ \", average: \" ++ show average)\n     else let newBigger = if digit &gt; bigger then digit else bigger\n              newSum = oldSum + digit\n          in a6 newBigger newSum (count+1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 2, "last_activity_date": 1508111539, "creation_date": 1508111539, "answer_id": 46761205, "question_id": 46757896, "link": "https://stackoverflow.com/questions/46757896/haskell-io-program-that-calculates-mean-and-highest-value/46761205#46761205", "title": "Haskell IO program that calculates mean and highest value", "body": "<p>Although a little off topic, I thought I would comment on separation of concerns and modularity.</p>\n\n<p>Usually, we try to keep the pure parts of the program separate from the impure (<code>IO</code>) parts.</p>\n\n<p>We can read a list of <code>Int</code>s with impure code, and then process it with a pure function to find the max, sum, and length in order to compute the average.</p>\n\n<p>Below, <code>readInts</code> reads <code>Int</code>s from stdin until it reads a non-positive value, returning the positive <code>Int</code>s in a list (in <code>IO</code>).  <code>maxSumLength</code> takes the current maximum, sum, and length of the elements processed so far\nas a tuple, and the next element to process, and returns a new tuple with the next element folded in.  Finally, <code>main</code> reads the list of <code>Int</code>s, and applies a strict left fold (<code>foldl'</code>) using <code>maxSumLength</code> and an initial state of <code>(0, 0, 0)</code> to compute the final maximum, sum, and length.   It then prints the maximum and the average from the sum and length.</p>\n\n<pre><code>module Main where\n\nimport Data.List ( foldl' )\n\nreadInts :: IO [Int]\nreadInts = do\n  i &lt;- read &lt;$&gt; getLine\n  if i &lt;= 0\n    then return []\n    else (i:) &lt;$&gt; readInts\n\nmaxSumLength :: (Int, Int, Int) -&gt; Int -&gt; (Int, Int, Int)\nmaxSumLength (m, s, l) x = (max m x, s+x, l+1)\n\nmain :: IO ()\nmain = do\n  (m, s, l) &lt;- foldl' maxSumLength (0, 0, 0) &lt;$&gt; readInts\n  putStrLn $ \"max=\" ++ show m ++ \", avg=\" ++ show (fromIntegral s / fromIntegral l)\n</code></pre>\n\n<p>This code is more modular than before.  We could reuse <code>readInts</code> in other programs that need a list of <code>Int</code>s.  Also, the pure part of the algorithm no longer cares where the list of <code>Int</code>s comes from.  However, there is a problem with this code.  When written this way, the entire list has to be buffered in memory before the pure code can start processing it, even though the processing code can consume the input as it arrives.</p>\n\n<p>This is where the <code>conduit</code> package can help.  The <code>conduit</code> package allows a stream to be produced by an impure <code>Source</code> and connected to a pure <code>Consumer</code>, and allows the pure code to be interleaved with the impure code.  The <code>conduit-combinators</code> package provides combinators that allow streams to be treated much like lists (in particular, <code>foldlC</code> allows us to perform a strict left fold over a conduit stream instead of a list).</p>\n\n<p>In the code below, the <code>readInts</code> function is now a <code>Source</code> of <code>Int</code>s that runs in the <code>IO</code> monad.  It uses the <code>repeatWhileMC</code> combinator to perform the looping and the termination test.  The pure <code>maxSumLength</code> is unchanged; however, in <code>main</code>, rather than use <code>foldl'</code>, we use <code>foldlC</code> to fold over the conduit stream.</p>\n\n<pre><code>module Main where\n\nimport Conduit\n\nreadInts :: Source IO Int\nreadInts = repeatWhileMC (read &lt;$&gt; getLine) (&gt; 0)\n\nmaxSumLength :: (Int, Int, Int) -&gt; Int -&gt; (Int, Int, Int)\nmaxSumLength (m, s, l) x = (max m x, s+x, l+1)\n\nmain :: IO ()\nmain = do\n  (m, s, n) &lt;- runConduit (readInts =$= foldlC maxSumLength (0, 0, 0))\n  putStrLn $ \"max=\" ++ show m ++ \", avg=\" ++ show (fromIntegral s / fromIntegral n)\n</code></pre>\n\n<p>This code will interleave pure <code>maxSumLength</code> with the impure <code>readInts</code> so that the <code>Int</code>s are consumed as they are created, but without sacrificing modularity.  The <code>readInts</code> stream can be used in other programs that need a stream of <code>Int</code>s, and the pure code still no longer cares where the <code>Int</code>s are coming from.</p>\n"}], "owner": {"reputation": 45, "user_id": 7911018, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-fSR51zuPf-Q/AAAAAAAAAAI/AAAAAAAAKBw/vUTGGHZoDQw/photo.jpg?sz=128", "display_name": "Caique Fortunato", "link": "https://stackoverflow.com/users/7911018/caique-fortunato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 46761205, "answer_count": 2, "score": 0, "last_activity_date": 1508111539, "creation_date": 1508088387, "question_id": 46757896, "link": "https://stackoverflow.com/questions/46757896/haskell-io-program-that-calculates-mean-and-highest-value", "title": "Haskell IO program that calculates mean and highest value", "body": "<p>I have doubts to do this exercise. I have the solution (which is apparently wrong) but I could not understand:</p>\n\n<p>Write a program that reads integers from the default input device, one per line, to a negative or zero universe, and prints an average and the largest of the read values.</p>\n\n<p>My code:</p>\n\n<pre><code>a6 ::Int -&gt; Float -&gt;Int-&gt;Int-&gt; IO()\na6 cBigger average2 sum2 cCount = do\n c &lt;- getLine\n let digit = read c :: Int\n let sum = sum2 + digit\n let average = fromIntegral sum2/ fromIntegral cCount\n if (digit &lt;=0)\n     then putStrLn(\"Bigger :\" ++show(cBigger)++ \"average \"++show(cAverage))\n     else\n     if digit &gt; cBigger\n          then a6 digit average sum (cCount+1)\n           else a6 cBigger average sum (cCount+1)\n</code></pre>\n\n<p>As I do not understand much Haskell I have doubts of how to do.</p>\n"}, {"tags": ["xml", "haskell", "streaming", "xml-conduit"], "answers": [{"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": false, "score": 1, "last_activity_date": 1521380299, "creation_date": 1521380299, "answer_id": 49348498, "question_id": 46757226, "link": "https://stackoverflow.com/questions/46757226/using-xml-conduit-how-to-parse-mediawiki-dump-files/49348498#49348498", "title": "Using xml-conduit how to parse mediawiki dump files", "body": "<p>You should use the \"Applicative\" pattern to combine via <code>(,) &lt;$&gt; parserOne &lt;*&gt; parserTwo</code>. Here's a complete example which I wrote yesterday:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE DeriveAnyClass #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule Main where\n\n--import Text.Groom\nimport Control.Monad.Trans.Resource\nimport Data.Conduit (ConduitT, (.|), runConduit)\nimport Data.Foldable\nimport qualified Data.HashMap.Strict as H\nimport Data.HashMap.Strict (HashMap)\nimport qualified Data.HashSet as HS\nimport Data.Hashable\nimport Data.Maybe\nimport Data.Semigroup\nimport qualified Data.String.Class as S\nimport Data.Text (Text)\nimport Data.XML.Types (Event)\nimport GHC.Generics (Generic)\nimport Safe\nimport System.Environment\nimport Text.XML\nimport Text.XML.Stream.Parse\n\ndata Mistake = Mistake\n  { startPar :: Int\n  , startOff :: Int\n  , endPar :: Int\n  , endOff :: Int\n  , mistakeType :: Text\n  , correction :: Maybe Text\n  } deriving (Show, Eq, Generic, Hashable)\n\ntype TeacherId = Int\n\ndata Annotation = Annotation\n  { teacherId :: TeacherId\n  , mistakes :: [Mistake]\n  } deriving (Show, Eq)\n\ntype Nid = Text\n\ndata Doc = Doc\n  { nid :: Nid\n  , annotations :: [Annotation]\n  } deriving (Show, Eq)\n\n-- | We compare mistakes per documents\ntype PerTeacherMistakes = HashMap TeacherId (HS.HashSet (Nid, Mistake))\n\nparseMistake :: MonadThrow m =&gt; ConduitT Event o m (Maybe Mistake)\nparseMistake =\n  tag'\n    \"MISTAKE\"\n    ((,,,) &lt;$&gt; requireAttr \"start_par\" &lt;*&gt; requireAttr \"start_off\" &lt;*&gt;\n     requireAttr \"end_par\" &lt;*&gt;\n     requireAttr \"end_off\") $ \\(sp, so, ep, eo) -&gt; do\n    startPar &lt;- pread sp\n    startOff &lt;- pread so\n    endPar &lt;- pread ep\n    endOff &lt;- pread eo\n    mistakeType &lt;- fromMaybe \"\" &lt;$&gt; tagNoAttr \"TYPE\" content\n    correction &lt;- fromMaybe Nothing &lt;$&gt; tagNoAttr \"CORRECTION\" contentMaybe\n    _comment &lt;- ignoreTreeContent \"COMMENT\"\n    return (Mistake {..})\n\npread :: (Read a, S.ConvString s, Monad m) =&gt; s -&gt; m a\npread x =\n  maybe\n    (fail (\"Couldn't read: \" ++ (S.toString x)))\n    return\n    (readMay (S.toString x))\n\nparseAnnotation :: MonadThrow m =&gt; ConduitT Event o m (Maybe Annotation)\nparseAnnotation =\n  tag' \"ANNOTATION\" (requireAttr \"teacher_id\") $ \\ti -&gt; do\n    teacherId &lt;- pread ti\n    mistakes &lt;- many parseMistake\n    return $ Annotation {..}\n\nparseDoc :: MonadThrow m =&gt; ConduitT Event o m (Maybe Doc)\nparseDoc =\n  tag' \"DOC\" (requireAttr \"nid\") $ \\nid -&gt; do\n    _ &lt;- ignoreTreeContent \"TEXT\"\n    anns &lt;- many parseAnnotation\n    return (Doc nid anns)\n\n-- parseDocs :: MonadThrow m =&gt; ConduitT Event o m (Maybe [Doc])\n-- parseDocs = tagNoAttr \"DOCUMENTS\" $ many parseDoc\n\nperTeacherMistakes :: [Doc] -&gt; PerTeacherMistakes\nperTeacherMistakes docs = H.fromListWith (&lt;&gt;) (concatMap fromDoc docs)\n  where\n    fromDoc Doc {..} = concatMap (fromAnnotation nid) annotations\n    fromAnnotation nid Annotation {..} =\n      map (fromMistake teacherId nid) mistakes\n    fromMistake ::\n         TeacherId -&gt; Nid -&gt; Mistake -&gt; (TeacherId, HS.HashSet (Nid, Mistake))\n    fromMistake teacherId nid mistake = (teacherId, HS.singleton (nid, mistake))\n  --   fromAnnotation Doc{..} Annotation {..} = (teacherId, HS.fromList mistakes)\n\nmain :: IO ()\nmain = do\n  args &lt;- getArgs\n  case args of\n    [fpath] -&gt; do\n      docs &lt;-\n        runResourceT $\n        runConduit $ parseFile def fpath .| force \"documents required\" (fmap Just (many parseDoc))\n      print (length docs)\n      let mistakes = perTeacherMistakes docs\n      -- putStrLn $ groom mistakes\n      let keys = H.keys mistakes\n      putStrLn $ \"Found teachers: \" &lt;&gt; show (length keys)\n      putStrLn $\n        \"Found overall mistakes: \" &lt;&gt;\n        show (length (concatMap HS.toList mistakes))\n      let mistakesIntersection = fold (H.elems mistakes)\n      putStrLn $\n        \"Mistake annotations which intersect upon all teachers: \" ++\n        show (length mistakesIntersection)\n    _ -&gt;\n      putStrLn\n        \"Usage: stack exec -- extract-conll2014 /path/to/official-2014.1.sgml\"\n</code></pre>\n\n<p>Here's an example xml:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;DOCUMENTS&gt;\n   &lt;DOC nid=\"1\"&gt;\n      &lt;TEXT&gt;\n         &lt;TITLE&gt;Keeping the Secret of Genetic Testing&lt;/TITLE&gt;\n         &lt;P&gt;What is genetic risk? Genetic risk refers more to your chance of inheriting a disorder or disease. People get certain disease because of genetic changes. How much a genetic change tells us about your chance of developing a disorder is not always clear. If your genetic results indicate that you have gene changes associated with an increased risk of heart disease, it does not mean that you definitely will develop heart disease. The opposite is also true. If your genetic results show that you do not have changes associated with an increased risk of heart disease, it is still possible that you develop heart disease. However for some rare diseases, people who have certain gene changes are guaranteed to develop the disease. When we are diagonosed out with certain genetic disease, are we suppose to disclose this result to our relatives? My answer is no.&lt;/P&gt;\n         &lt;P&gt;On one hand, we do not want this potential danger causing firghtenning affects in our families' later lives. When people around us know that we got certain disease, their altitudes will be easily changed, whether caring us too much or keeping away from us. And both are not what we want since most of us just want to live as normal people. Surrounded by such concerns, it is very likely that we are distracted to worry about these problems. It is a concern that will be with us during our whole life, because we will never know when the ''potential bomb'' will explode.&lt;/P&gt;\n         &lt;P&gt;On the other hand, if there are ways can help us to control or cure the disease, we can going through thses process from the scope of the whole family. For an example, if exercising is helpful for family potential disease, we can always look for more chances for the family to go exercise. And we keep track of all family members health conditions. At the same time, we are prepared to know when there are other members got this disease.&lt;/P&gt;\n         &lt;P&gt;Here I want to share Forest'view on this issue. Although some people feel that an individual who is found to carry a dominant gene for Huntington's disease has an ethical obligation to disclose that fact to his or her siblings, there currently is no legal requirement to do so. In fact, requiring someone to communicate his or her own genetic risk to family members who are therefore also at risk is considered by many to be ethically dubious.\"&lt;/P&gt;\n         &lt;P&gt;Nothing is absolute right or wrong. If certain disease genetic test is very accurate and it is unavoidable and necessary to get treatment and known by others, it is OK to disclose the result. Above all, life is more important than secret.&lt;/P&gt;\n      &lt;/TEXT&gt;\n      &lt;ANNOTATION teacher_id=\"8\"&gt;\n         &lt;MISTAKE start_par=\"1\" start_off=\"42\" end_par=\"1\" end_off=\"46\"&gt;\n            &lt;TYPE&gt;ArtOrDet&lt;/TYPE&gt;\n            &lt;CORRECTION /&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"1\" start_off=\"118\" end_par=\"1\" end_off=\"125\"&gt;\n            &lt;TYPE&gt;Nn&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;diseases&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"1\" start_off=\"620\" end_par=\"1\" end_off=\"627\"&gt;\n            &lt;TYPE&gt;Trans&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;However,&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"1\" start_off=\"740\" end_par=\"1\" end_off=\"751\"&gt;\n            &lt;TYPE&gt;Mec&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;diagnosed&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"1\" start_off=\"751\" end_par=\"1\" end_off=\"754\"&gt;\n            &lt;TYPE&gt;Prep&lt;/TYPE&gt;\n            &lt;CORRECTION /&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"1\" start_off=\"776\" end_par=\"1\" end_off=\"783\"&gt;\n            &lt;TYPE&gt;Nn&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;diseases&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"50\" end_par=\"2\" end_off=\"58\"&gt;\n            &lt;TYPE&gt;Wci&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;having&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"58\" end_par=\"2\" end_off=\"70\"&gt;\n            &lt;TYPE&gt;Mec&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;frightening&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"71\" end_par=\"2\" end_off=\"78\"&gt;\n            &lt;TYPE&gt;Wform&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;effects&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"144\" end_par=\"2\" end_off=\"147\"&gt;\n            &lt;TYPE&gt;Wci&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;have&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"156\" end_par=\"2\" end_off=\"163\"&gt;\n            &lt;TYPE&gt;Nn&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;diseases&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"171\" end_par=\"2\" end_off=\"180\"&gt;\n            &lt;TYPE&gt;Mec&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;attitude&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"186\" end_par=\"2\" end_off=\"203\"&gt;\n            &lt;TYPE&gt;Vform&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;easily change&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"213\" end_par=\"2\" end_off=\"219\"&gt;\n            &lt;TYPE&gt;Prep&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;caring for&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"410\" end_par=\"2\" end_off=\"412\"&gt;\n            &lt;TYPE&gt;Trans&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;and&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"2\" start_off=\"512\" end_par=\"2\" end_off=\"516\"&gt;\n            &lt;TYPE&gt;Vt&lt;/TYPE&gt;\n            &lt;CORRECTION /&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"32\" end_par=\"3\" end_off=\"36\"&gt;\n            &lt;TYPE&gt;Ssub&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;ways that&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"88\" end_par=\"3\" end_off=\"93\"&gt;\n            &lt;TYPE&gt;Vform&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;go&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"102\" end_par=\"3\" end_off=\"107\"&gt;\n            &lt;TYPE&gt;Mec&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;these&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"108\" end_par=\"3\" end_off=\"115\"&gt;\n            &lt;TYPE&gt;Nn&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;processes&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"156\" end_par=\"3\" end_off=\"158\"&gt;\n            &lt;TYPE&gt;Rloc-&lt;/TYPE&gt;\n            &lt;CORRECTION /&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"193\" end_par=\"3\" end_off=\"196\"&gt;\n            &lt;TYPE&gt;V0&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;reducing&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"277\" end_par=\"3\" end_off=\"279\"&gt;\n            &lt;TYPE&gt;Wci&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;do&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"288\" end_par=\"3\" end_off=\"290\"&gt;\n            &lt;TYPE&gt;Rloc-&lt;/TYPE&gt;\n            &lt;CORRECTION /&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"290\" end_par=\"3\" end_off=\"293\"&gt;\n            &lt;TYPE&gt;Trans&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;so&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"3\" start_off=\"420\" end_par=\"3\" end_off=\"423\"&gt;\n            &lt;TYPE&gt;Ssub&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;who have got&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"4\" start_off=\"21\" end_par=\"4\" end_off=\"28\"&gt;\n            &lt;TYPE&gt;Npos&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;Forests's&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"5\" start_off=\"11\" end_par=\"5\" end_off=\"19\"&gt;\n            &lt;TYPE&gt;Wform&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;absolutely&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"5\" start_off=\"39\" end_par=\"5\" end_off=\"46\"&gt;\n            &lt;TYPE&gt;ArtOrDet&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;a certain&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"5\" start_off=\"47\" end_par=\"5\" end_off=\"54\"&gt;\n            &lt;TYPE&gt;Rloc-&lt;/TYPE&gt;\n            &lt;CORRECTION /&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"5\" start_off=\"142\" end_par=\"5\" end_off=\"147\"&gt;\n            &lt;TYPE&gt;Wci&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;tell&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"5\" start_off=\"148\" end_par=\"5\" end_off=\"150\"&gt;\n            &lt;TYPE&gt;Prep&lt;/TYPE&gt;\n            &lt;CORRECTION /&gt;\n         &lt;/MISTAKE&gt;\n         &lt;MISTAKE start_par=\"5\" start_off=\"231\" end_par=\"5\" end_off=\"237\"&gt;\n            &lt;TYPE&gt;Nn&lt;/TYPE&gt;\n            &lt;CORRECTION&gt;secrets&lt;/CORRECTION&gt;\n         &lt;/MISTAKE&gt;\n      &lt;/ANNOTATION&gt;\n   &lt;/DOC&gt;\n&lt;/DOCUMENTS&gt;\n</code></pre>\n"}], "owner": {"reputation": 535, "user_id": 1460910, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/723823b0e09ecdc7664d1b9ecdb42de7?s=128&d=identicon&r=PG", "display_name": "Pranaya Behera", "link": "https://stackoverflow.com/users/1460910/pranaya-behera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521380299, "creation_date": 1508084400, "question_id": 46757226, "link": "https://stackoverflow.com/questions/46757226/using-xml-conduit-how-to-parse-mediawiki-dump-files", "title": "Using xml-conduit how to parse mediawiki dump files", "body": "<p>I am trying to parse mediawiki dump files using xml-conduit.\nThere are two tags that I am interested in, SiteInfo and Page.\nHere is a sample xml: <a href=\"https://gist.github.com/shadow-fox/7ff8df7a953e0ca9534bef45700686fe\" rel=\"nofollow noreferrer\">https://gist.github.com/shadow-fox/7ff8df7a953e0ca9534bef45700686fe</a></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport           Control.Monad.Trans.Resource (runResourceT, MonadThrow)\nimport           Data.Conduit                 (Consumer, ($$))\nimport           Data.Text                    (Text, pack, unpack)\nimport           Data.Text.Read               (decimal)\nimport           Data.XML.Types               (Event)\nimport           Text.XML.Stream.Parse\n\ndata SiteInfo = SiteInfo {\n    name :: Text,\n    dbname :: Text,\n    base :: Text,\n    generator :: Text,\n    isCaseSensitive :: Bool,\n    namespaces :: [NameSpace]\n} deriving (Show, Read)\n\ndata NameSpace = NameSpace {\n    keyns :: Int,\n    casens :: Text,\n    value :: Text\n} deriving (Show, Read)\n\ndata WikiDoc = WikiDoc {\n    title :: Text,\n    namespace :: Text,\n    pageId :: Text,\n    revision :: Revision\n} deriving (Show, Read)\n\ndata Revision = Revision {\n    id :: Int,\n    parentId :: Int,\n    timestamp :: Text,\n    comment :: Text,\n    model :: Text,\n    format :: Text,\n    text :: Text,\n    sha :: Text\n} deriving (Show, Read)\n\nparseSiteInfo :: MonadThrow m =&gt; Consumer Event m SiteInfo\nparseSiteInfo = force \"siteinfo tag missing\" $ do\n    n &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}sitename\" content\n    db &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}dbname\" content\n    b &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}base\" content\n    g &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}generator\" content\n    c &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}case\" content\n    ns &lt;- tag' \"{http://www.mediawiki.org/xml/export-0.10/}namespaces\" $ many parseNamespace\n    return SiteInfo { name = n, dbname = db, base = b, generator = g, isCaseSensitive = c, namespaces = ns }\n\nparseNamespace :: MonadThrow m =&gt; Consumer Event m NameSpace\nparseNamespace = do\n    tag' \"{http://www.mediawiki.org/xml/export-0.10/}namespace\" (requireAttr \"key\") $ \\key -&gt; do\n        v &lt;- content\n        return $ NameSpace { key = read $ unpack key, value = v}\n\nparseRevision :: MonadThrow m =&gt; Consumer Event m Revision\nparseRevision = force \"revision tag missing\" $ do\n    tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}id\" content\n    pid &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}parentid\" content\n    ts &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}timestamp\" content\n    con &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}contributor\" content\n    un &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}username\" content\n    revid &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}id\" content\n    com &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}comment\" content\n    m &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}model\" content\n    f &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}format\" content\n    t &lt;- tagIgnoreAttrs \"{http://www.mediawiki.org/xml/export-0.10/}text\" content\n    s &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}sha1\" content\n    return Revision {id = revid, parentId = pid, timestamp = ts, comment = com, model = m, format = f, text = t, sha = s}\n\nparsePage :: MonadThrow m =&gt; Consumer Event m WikiDoc\nparsePage = force \"page tag missing\" $\n        t &lt;- force \"title tag missing\" $ tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}title\" content\n        ns &lt;- force \"ns tag missing\" $ tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}ns\" content\n        id &lt;- force \"id tag missing\" $ tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}id\" content\n        _ &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}restrictions\" content\n        rev &lt;- tagNoAttr \"{http://www.mediawiki.org/xml/export-0.10/}revision\" $ parseRevision\n        return $ WikiDoc {title = t, namespace = ns, pageId = id, revision = rev}\n\n\nmain :: IO ()\nmain = do\n    wikiPages &lt;- parseFile def \"sample.xml\" $$ parseXml\n    print wikiPages\n</code></pre>\n\n<p>I have the bits and pieces but don't know how to tie it all together and get the desire result.\nI don't know how to get if there is more than 1 attribute in a tag example in the namespace tag : <code>&lt;namespace key=\"-2\" case=\"case-sensitive\"&gt;Media&lt;/namespace&gt;</code></p>\n\n<p>I want the result at the end to hold both the siteinfo and wikidoc.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1508084505, "post_id": 46757216, "comment_id": 80459731, "body": "What types do you think these functions should be?"}, {"owner": {"reputation": 124, "user_id": 5913386, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49636bde7f92d0e68b29396a8b650ebf?s=128&d=identicon&r=PG&f=1", "display_name": "dace", "link": "https://stackoverflow.com/users/5913386/dace"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1508084961, "post_id": 46757216, "comment_id": 80459869, "body": "@AJFarmar I think that the type should depend on the type of given parameters"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1508085096, "post_id": 46757216, "comment_id": 80459932, "body": "Yes, that&#39;s clear, but what should the type signature of  <code>find_all_values</code> be? Use type variables."}, {"owner": {"reputation": 124, "user_id": 5913386, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49636bde7f92d0e68b29396a8b650ebf?s=128&d=identicon&r=PG&f=1", "display_name": "dace", "link": "https://stackoverflow.com/users/5913386/dace"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1508085105, "post_id": 46757216, "comment_id": 80459934, "body": "@AJFarmar But I wrote other functions in haskell, and they do work fine with both chars and numbers."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1508085159, "post_id": 46757216, "comment_id": 80459952, "body": "I didn&#39;t ask about other functions; I know that Haskell can use polymorphism too. What type would <code>find_all_values</code> be? If you try this, you may find out what the issue here is."}, {"owner": {"reputation": 124, "user_id": 5913386, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49636bde7f92d0e68b29396a8b650ebf?s=128&d=identicon&r=PG&f=1", "display_name": "dace", "link": "https://stackoverflow.com/users/5913386/dace"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1508085320, "post_id": 46757216, "comment_id": 80460003, "body": "@AJFarmar It should be list, for example, <code>find_all_values [&quot;a&quot;, &quot;b&quot;] [(&quot;a&quot;, &quot;aa&quot;), (&quot;b&quot;, &quot;bb&quot;), (&quot;c&quot;, &quot;cc&quot;)]</code> should return <code>[&quot;aa&quot;, &quot;bb&quot;]</code> and <code>find_all_values [1, 2] [(1, 11), (2, 22), (3, 33)]</code> should return <code>[11, 22]</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1508085385, "post_id": 46757216, "comment_id": 80460029, "body": "That&#39;s the type of <code>find_all_values [&quot;a&quot;,&quot;b&quot;] [(&quot;a&quot;, &quot;aa&quot;), (&quot;b&quot;,&quot;bb)]</code>, not the type of <code>find_all_value</code>. What would the type of <code>find_all_values</code> be?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1508085878, "post_id": 46757216, "comment_id": 80460204, "body": "Look at the inferred type of <code>lookup1</code>; if it gets an empty list, it tries to return an empty list of some type. Otherwise, it might return an <code>Int</code> or a <code>Char</code>, or whatever type the second element of a tuple has. There is also the problem  that when you give it a bunch of values of type <code>Num a =&gt; a</code>, it can&#39;t seem to figure out which instance of <code>Eq</code> to use to do the comparisons."}, {"owner": {"reputation": 124, "user_id": 5913386, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49636bde7f92d0e68b29396a8b650ebf?s=128&d=identicon&r=PG&f=1", "display_name": "dace", "link": "https://stackoverflow.com/users/5913386/dace"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1508086429, "post_id": 46757216, "comment_id": 80460376, "body": "@chepner And what would be a solution to that?"}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1508148700, "post_id": 46757605, "comment_id": 80480828, "body": "In the first <code>lookup1</code> you have, you should return <code>Just v</code> in the successful branch."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1508155594, "post_id": 46757605, "comment_id": 80485054, "body": "Huh, thought I remembered fixing that. Apparently I didn&#39;t."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1508156139, "last_edit_date": 1508156139, "creation_date": 1508086785, "answer_id": 46757605, "question_id": 46757216, "link": "https://stackoverflow.com/questions/46757216/haskell-function-works-with-char-type-but-is-not-working-with-number-type/46757605#46757605", "title": "Haskell function works with char type but is not working with number type", "body": "<p>Your first problem is that you don't return a correct value from <code>lookup1</code> when an item isn't found. You can't just return an empty list, because you aren't necessarily returning a list in the other cases (it depends on the type of value found in the tuples). Instead, you need to return a value of some <code>Maybe</code> type:</p>\n\n<pre><code>lookup1 :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b\nlookup1 x [] = Nothing\nlookup1 x ((k,v):t) | x == k = Just v\n                    | otherwise = lookup1 x t\n</code></pre>\n\n<p>Alternatively, you <em>could</em> guarantee that list is returned, one containing zero or one values. This isn't ideal, though, since the type doesn't guarantee only an empty or singleton value is returned.</p>\n\n<pre><code>lookup1 :: Eq a =&gt; a -&gt; [(a, b)] -&gt; [b]\n    lookup1 x [] = []\n    lookup1 x ((k,v):t) | x == k = [v]\n                        | otherwise = lookup1 x t\n</code></pre>\n\n<p>The reason your code worked for <code>lookup1 \"b\" [(\"a\", \"aa\"), (\"b\", \"bb\"), (\"c\", \"cc\")]</code> is that you were using <code>String</code> values, and <code>String</code> is just an alias for <code>[Char]</code>; <code>[]</code> was a valid base case in that instance.</p>\n"}, {"comments": [{"owner": {"reputation": 124, "user_id": 5913386, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49636bde7f92d0e68b29396a8b650ebf?s=128&d=identicon&r=PG&f=1", "display_name": "dace", "link": "https://stackoverflow.com/users/5913386/dace"}, "edited": false, "score": 0, "creation_date": 1508172679, "post_id": 46757828, "comment_id": 80496068, "body": "Wow, thank you very much for brief explanation. Actually, now I do remember trying to write lookup1 function with` Maybe<code>s but I got really confused about </code>Just`s in results but now I see how to get rid of them. Thank you very much again."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 3, "last_activity_date": 1508088061, "creation_date": 1508088061, "answer_id": 46757828, "question_id": 46757216, "link": "https://stackoverflow.com/questions/46757216/haskell-function-works-with-char-type-but-is-not-working-with-number-type/46757828#46757828", "title": "Haskell function works with char type but is not working with number type", "body": "<p>Look at</p>\n\n<pre><code>lookup1 x [] = []\nlookup1 x (h:t) = if x == fst h then snd h else lookup1 x t\n</code></pre>\n\n<p>What's its type? The first equation says that we're taking two arguments, where the first is of unknown type, and the second is a list of unknown type, and we're returning another list of unknown type:</p>\n\n<pre><code>lookup1 :: _a -&gt; [_b] -&gt; [_c] -- Not fully solved\n</code></pre>\n\n<p>In the second equation, when you use <code>fst</code> and <code>snd</code> on the head of your second argument, you force that second argument to be a list of pairs</p>\n\n<pre><code>lookup1 :: _a -&gt; [(_b, _d)] -&gt; [_c]\n</code></pre>\n\n<p>and since your function can evaluate to <code>snd h</code>, we know that <code>_d</code> must be <code>[_c]</code>.</p>\n\n<pre><code>lookup1 :: _a -&gt; [(_b, [_c])] -&gt; [_c]\n</code></pre>\n\n<p>and since you check <code>(==)</code> between the first argument and <code>fst h</code>, we know that <code>_a ~ _b</code> and <code>Eq _a</code></p>\n\n<pre><code>lookup1 :: Eq _a =&gt; _a -&gt; [(_a, [_c])] -&gt; [_c]\n</code></pre>\n\n<p>That's all the information we have, so we say we've totally solved this type and replace all the remaining variables with universally quantified types:</p>\n\n<pre><code>lookup1 :: Eq a =&gt; a -&gt; [(a, [b])] -&gt; [b]\n</code></pre>\n\n<p>and if you ask <code>:type lookup1</code> in GHCi it'll tell you the same. This is wrong, because you can only ever use this to look up <em>lists</em> of things, when you should be able to look up whatever you want! Specifically, this function will either look up the target list, or, if it can't find it, evaluate to <code>[]</code> instead. Also, you say it works fine for <code>Char</code>, and give the example</p>\n\n<pre><code>lookup1 \"b\" [(\"a\", \"aa\"), (\"b\", \"bb\"), (\"c\", \"cc\")]\n</code></pre>\n\n<p>But that isn't <code>Char</code>! That's <code>[Char]</code> (aka <code>String</code>)! <code>String</code>s are zero or more characters enclosed in <code>\"\"</code>; <code>Char</code>s are exactly one character enclosed in <code>''</code>.</p>\n\n<p>Also, if you tried</p>\n\n<pre><code>lookup1 'b' [('a', \"a\")]\n</code></pre>\n\n<p>you'd get <code>\"\"</code>, and that's not really a sensible output, because you don't know if <code>\"b\"</code> was found and just happened to point to <code>\"\"</code>, or it wasn't there at all and we just defaulted.</p>\n\n<p>When you try</p>\n\n<pre><code>lookup1 2 [(1, 11), (2, 22), (3, 33)]\n</code></pre>\n\n<p>each numeric literal starts with type <code>Num _a =&gt; _a</code> (Haskell numeric literals are polymorphic). The type of <code>lookup1</code> forces the second element of every pair to also be a list of something, so <code>11</code>, <code>22</code>, and <code>33</code> take on the type <code>Num [a] =&gt; [a]</code>, which is not allowed without the <code>FlexibleContexts</code> language extension (and is nonsense regardless).</p>\n\n<p>The <em>correct</em> type for this is</p>\n\n<pre><code>lookup1 :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b\nlookup1 _ []     = _ -- Exercise for reader\nlookup1 x (e:es) = _\n</code></pre>\n\n<p>Now, <code>lookupDuplicates</code> (camel case is the convention) should have the type</p>\n\n<pre><code>lookupDuplicates :: Eq a =&gt; a -&gt; [(a, b)] -&gt; [b]\n</code></pre>\n\n<p>which is true for what you wrote, but now <code>lookup1</code> is bad:</p>\n\n<pre><code>lookup1 x (h:t) = let (a:b) = lookupDuplicates x (h:t) in a\n</code></pre>\n\n<p>What happens if you give it an empty list? You will try to match it to <code>h:t</code>, which will fail. Worse, you only take the list apart to put it back again. It should just be</p>\n\n<pre><code>lookup1 x es = head $ lookupDuplicates x es\n-- Read: First result of looking up x in es\n</code></pre>\n\n<p>Yet, this is still undesirable. If you don't find your entry anywhere, you throw a runtime error (which you cannot catch unless you're in the <code>IO</code> monad). You want to use another monad, probably <code>Maybe</code>, for this:</p>\n\n<pre><code>lookup1 :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b\nlookup1 x es = case lookupDuplicates x es of\n                    []    -&gt; _ -- Exercise for reader\n                    (e:_) -&gt; _\n</code></pre>\n\n<p>The <code>listsafe</code> library provides versions of list functions that work in <code>Maybe</code> instead of being partial, so if you had that installed you could say</p>\n\n<pre><code>import qualified Data.List.Safe as LS\nlookup1 x es = LS.head $ lookupDuplicates x es\n</code></pre>\n\n<p>Now, onto <code>findAllValues</code></p>\n\n<pre><code>findAllValues [] (h:t) = []\nfindAllValues (g:a) (h:t) = let found = (lookup1 g (h:t))\n                            in if found == []\n                                  then findAllValues a (h:t)\n                                  else found:(findAllValues a (h:t))\n</code></pre>\n\n<p>You can write this much more clearly:</p>\n\n<pre><code>import Data.Maybe\nfindAllValues :: Eq a =&gt; [a] -&gt; [(a, b)] -&gt; [b]\nfindAllValues keys dict = catMaybes $ flip lookup1 dict &lt;$&gt; keys\n-- Go over the list of keys with (flip lookup1 dict), then remove the Maybes\n-- (flip lookup1 dict) is a function that takes a key and looks it up in dict\n-- (&lt;$&gt;) is the infix version of fmap which is the general version of map\n-- catMaybes :: [Maybe a] -&gt; [a]\n-- Nothings stop existing and the Just wrappings evaporate\n</code></pre>\n\n<p>If you used the</p>\n\n<pre><code>import qualified Data.List.Safe as LS\nlookup1 x es = LS.head $ lookupDuplicates x es\n</code></pre>\n\n<p>version above, then the most general type of <code>lookup</code> is actually <code>(MonadThrow m, Eq a) =&gt; a -&gt; [(a, b)] -&gt; m b</code>, which means <code>findAllValues</code> simplifies to:</p>\n\n<pre><code>findAllValues keys dict = concat $ flip lookup1 dict &lt;$&gt; keys\n</code></pre>\n\n<p>because <code>MonadThrow []</code>. (A failed <code>lookup1</code> \"magically\" returns <code>Nothing</code> in some cases and <code>[]</code> in others and <code>Left (SomeException EmptyListException)</code> in yet others, all depending on type.)</p>\n\n<p>Final note: always think of your type signatures first and write them down (at least for top level definitions). It really helps you get a handle on what you should do.</p>\n"}], "owner": {"reputation": 124, "user_id": 5913386, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49636bde7f92d0e68b29396a8b650ebf?s=128&d=identicon&r=PG&f=1", "display_name": "dace", "link": "https://stackoverflow.com/users/5913386/dace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 758, "favorite_count": 0, "accepted_answer_id": 46757828, "answer_count": 2, "score": 0, "last_activity_date": 1508156139, "creation_date": 1508084359, "question_id": 46757216, "link": "https://stackoverflow.com/questions/46757216/haskell-function-works-with-char-type-but-is-not-working-with-number-type", "title": "Haskell function works with char type but is not working with number type", "body": "<p>I'm really new to Haskell and functional programming in general, and I can't figure out why I keep getting \"Non type-variable argument in the constraint: Num [a] (Use FlexibleContexts to permit this)\" errors.</p>\n\n<p>I have this function for looking up value in dictionary by key:</p>\n\n<pre><code>lookup1 x [] = []\nlookup1 x (h:t) = if x == fst h then snd h else lookup1 x t\n</code></pre>\n\n<p>and it is working fine with char type, for example, <code>lookup1 \"b\" [(\"a\", \"aa\"), (\"b\", \"bb\"), (\"c\", \"cc\")]</code> returns \"bb\". But when I try the same with number type, for example <code>lookup1 2 [(1, 11), (2, 22), (3, 33)]</code> I get this:</p>\n\n<pre><code>* Non type-variable argument in the constraint: Num [a]\n  (Use FlexibleContexts to permit this)\n* When checking the inferred type\n    it :: forall a. Num [a] =&gt; [a]\n</code></pre>\n\n<p>Weird thing is that if I define the same function in <code>ghci</code> it works with both chars and numbers. </p>\n\n<p>As I also need function for returning all values from dictionary where dictionary can contain duplicate keys, I tried this workaround:</p>\n\n<pre><code>    lookup_duplicates x [] = []\n    lookup_duplicates x (h:t) = if x == fst h then (snd h):(lookup_duplicates x t) else lookup_duplicates x t \n    lookup1 x (h:t) = let (a:b) = lookup_duplicates x (h:t) in a\n</code></pre>\n\n<p>which takes first value from <code>lookup_duplicates</code> and it did work fine. But now I have this function that finds all values for given keys in dictionary:</p>\n\n<pre><code>    find_all_values [] (h:t) = []\n    find_all_values (g:a) (h:t) = let found = (lookup1 g (h:t)) in (if found == [] then find_all_values a (h:t) else found:(find_all_values a (h:t)))\n</code></pre>\n\n<p>which also works very good with char types but with number types I get this:</p>\n\n<pre><code>* Non type-variable argument in the constraint: Num [a1]\n  (Use FlexibleContexts to permit this)\n* When checking the inferred type\n    it :: forall a1. (Num [a1], Eq a1) =&gt; [[a1]]\n</code></pre>\n\n<p>Can anyone please guide me to the right direction?</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1508085680, "post_id": 46757089, "comment_id": 80460137, "body": "Please show a full use case and what bothers you about it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1508087827, "post_id": 46757089, "comment_id": 80460784, "body": "If the proof is inlined, the compiler might be able to optimize it away. Anyway, it&#39;s a O(1) match, so even without optimization it does not cost a lot. (Be careful, though, since by coercing your proofs you can easily violate type safety.)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1508094375, "post_id": 46757089, "comment_id": 80463163, "body": "I think the standard trick for optimizing proofs is to actually do the proof (so don&#39;t have <code>unsafeCoerce Refl</code> as the body of the <code>proof</code>), but then add a rewrite <code>RULE</code> to optimize <code>proof x y</code> into <code>unsafeCoerce Refl</code>. That way, you can &quot;run&quot; your proofs when your code is compiled without optimizations, and not run them when your code is compiled with optimizations."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1508095649, "post_id": 46757089, "comment_id": 80463581, "body": "Reference (at least, this is where I first heard about it) for @Alec&#39;s suggestion: <a href=\"https://typesandkinds.wordpress.com/2016/07/24/dependent-types-in-haskell-progress-report/\" rel=\"nofollow noreferrer\">typesandkinds.wordpress.com/2016/07/24/&hellip;</a>"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1508148998, "post_id": 46757089, "comment_id": 80481006, "body": "What are the imports / definitions your code relies upon? Please post a <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>. As for &quot;free&quot; coercions, look into introducing <a href=\"https://www.youtube.com/watch?v=GgD0KUxMaQs#t=40m\" rel=\"nofollow noreferrer\">type classes whose sole purpose is to add equality constraints</a>"}], "owner": {"reputation": 69, "user_id": 8742124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a39412ec132fb6c2b59778a46838af?s=128&d=identicon&r=PG&f=1", "display_name": "russoulmc", "link": "https://stackoverflow.com/users/8742124/russoulmc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1508086493, "creation_date": 1508083634, "last_edit_date": 1508086493, "question_id": 46757089, "link": "https://stackoverflow.com/questions/46757089/provide-compiler-with-a-proof-without-pattern-matching", "title": "Provide compiler with a proof without pattern matching", "body": "<p>Let's say I have a proof:</p>\n\n<pre><code>-- (pseudocode) m and n are natural numbers\nproof :: forall m n. (1 &lt;= m, m &lt; n) =&gt; SNat n -&gt; SNat m -&gt; (1 &lt;= n - 1)\nproof _ _ = unsafeCoerce Refl\n</code></pre>\n\n<p>If I were to use it elsewhere in my code I would have to pattern match on <code>proof</code> like so:</p>\n\n<pre><code>...\ncase proof n m of\n  Refl -&gt; ...\n...\n</code></pre>\n\n<p>But <code>proof</code> holds for any <code>n</code> and <code>m</code> so unnecessary pattern matching that always matches is done during runtime. How to avoid this ?</p>\n\n<p><strong>EDIT</strong> Use case:</p>\n\n<pre><code>--                  0 1 2 3 4 ... n-1\n--returns Vec n a : 1 0 0 0 0 ... 0\nhelper :: (UVec a, Num a) =&gt; SNat n -&gt; Vec n a\nhelper n = case isZero n of\n  NonZero -&gt; 1 `vcons` vpreplicate (sPred n) 0\n  Zero -&gt; vnil\n\nproof1 :: forall n m . (CmpNat n m ~ GT) =&gt; SNat n -&gt; SNat m -&gt; ((CmpNat (n :- 1) (m :- 1)) :~: GT)\nproof1 n m = unsafeCoerce Refl\n\nproof2 :: forall n m . (1 &lt;= m, (CmpNat n m) ~ GT) =&gt; SNat n -&gt; SNat m -&gt; ((1 &lt;=? (n :- 1)) :~: True)\nproof2 n m = unsafeCoerce Refl\n\n--                  0 1 2 ... m . . . . . . n-1\n--returns Vec n a : 0 0 0 ... 1 0 0 0 0 ... 0\nhelper2 :: forall a m n.(UVec a, Num a, 1 &lt;= n, (CmpNat n m) ~ GT) =&gt; SNat n -&gt; SNat m -&gt; Vec n a\nhelper2 size m = case (isZero m, proof1 size m) of\n  (NonZero, Refl) -&gt;\n    case (proof2 size m) of\n      Refl -&gt; (0 :: a) `vcons` helper2 (sPred size) (sPred m)\n\n  (Zero,_) -&gt; helper size\n</code></pre>\n\n<p>If <code>helper2</code> is assumed to be used very often extra pattern matching adds overhead.</p>\n"}, {"tags": ["haskell", "functional-programming", "typeclass"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1508075069, "post_id": 46755613, "comment_id": 80456707, "body": "If you type your function definition (<i>without</i> the type) into GHCi (use <code>:{</code> to enter multiline mode; paste it in; use <code>:}</code> to exit), then you can say <code>:type checkPalindrome</code> (or just <code>:t</code>) to see what GHC thinks your type should be. You can also put <code>_</code>s in types, like <code>checkPalindrome :: _ =&gt; [a] -&gt; Bool</code>, and if <code>-XPartialTypeSignatures</code> is <i>off</i> (it is by default), you&#39;ll get an error where GHC tells you how it filled in the blank."}], "answers": [{"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": false, "score": 6, "last_activity_date": 1508074833, "creation_date": 1508074833, "answer_id": 46755654, "question_id": 46755613, "link": "https://stackoverflow.com/questions/46755613/how-do-i-fix-eq-a-has-kind-ghc-prim-constraint-error-in-haskell/46755654#46755654", "title": "How do I fix \u2018Eq a\u2019 has kind \u2018GHC.Prim.Constraint\u2019 error in haskell?", "body": "<p>Unless Haskell adopted a new syntax, your type signature should be:</p>\n\n<pre><code>checkPalindrome :: Eq a =&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>Declare the constraint on the left hand side of a fat-arrow, then use it on the right hand side. </p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1508081923, "last_edit_date": 1508081923, "creation_date": 1508081138, "answer_id": 46756680, "question_id": 46755613, "link": "https://stackoverflow.com/questions/46755613/how-do-i-fix-eq-a-has-kind-ghc-prim-constraint-error-in-haskell/46756680#46756680", "title": "How do I fix \u2018Eq a\u2019 has kind \u2018GHC.Prim.Constraint\u2019 error in haskell?", "body": "<p>Unlike OO languages, Haskell makes a quite fundamental distinction between </p>\n\n<ul>\n<li><strong>Constraints</strong> \u2013 typeclasses like <code>Eq</code>.</li>\n<li><strong>Types</strong> \u2013 concrete types like <code>Bool</code> or lists of some type.</li>\n</ul>\n\n<p>In OO languages, both of these would be represented by <a href=\"https://en.wikipedia.org/w/index.php?title=Class_(object-oriented_programming)\" rel=\"nofollow noreferrer\">classes</a><sup>\u2020</sup>, but a <a href=\"https://en.wikipedia.org/wiki/Type_class\" rel=\"nofollow noreferrer\">Haskell type class</a> is completely different. You never have \u201cvalues of class <code>C</code>\u201d, only \u201c<em>types</em> of class <code>C</code>\u201d. (These concrete types may then contain values, but the classes don't.)</p>\n\n<p>This distinction may seem pedantic, but it's actually very useful. What you wrote, <code>[Eq a] -&gt; Bool</code>, would supposedly mean: each element of the list must be comparable... but <em>comparable to what</em>? You could have elements of different type in the list, how do you know that these elements are comparable <em>to each other</em>? In Haskell, that's no issue, because whenever the function is used you first settle on one type <code>a</code>. This type must be in the <code>Eq</code> class. The list then must have all elements from the same type <code>a</code>. This way you ensure that each element of the list is comparable to all of the others, not just, like, <em>comparable to itself</em>. Hence the signature</p>\n\n<pre><code>checkPalindrome :: Eq a =&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>This is the usual distinction on the syntax level: <strong>constraints must always<sup>\u2021</sup> be written on the left of an <code>=&gt;</code> (implication arrow)</strong>.</p>\n\n<p>The constraints before the <code>=&gt;</code> are \u201cimplicit arguments\u201d: you don't explicitly \u201cpass <code>Eq a</code> to the function\u201d when you call it, instead you just pass the stuff after the <code>=&gt;</code>, i.e. in your example a list of some concrete type. The compiler will then look at the type and automatically look up its <code>Eq</code> typeclass instance (or raise a compile-time error if the type does <em>not</em> have such an instance). Hence,</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; let palin :: Eq a =&gt; [a] -&gt; Bool; palin l = l==reverse l\nPrelude&gt; palin [1,2,3,2,1]\nTrue\nPrelude&gt; palin [1,2,3,4,5]\nFalse\nPrelude&gt; palin [sin, cos, tan]\n\n&lt;interactive&gt;:5:1:\n    No instance for (Eq (a0 -&gt; a0))\n      (maybe you haven't applied enough arguments to a function?)\n      arising from a use of \u2018palin\u2019\n    In the expression: palin [sin, cos, tan]\n    In an equation for \u2018it\u2019: it = palin [sin, cos, tan]\n</code></pre>\n\n<p>...because functions can't be equality-compared.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Constraints may in OO also be <em>interfaces</em> / abstract base classes, which aren't \u201cquite proper classes\u201d but are still in many ways treated the same way as OO value-classes. Most modern OO languages now also support Haskell-style parametric polymorphism in addition to \u201celement-wise\u201d/covariant/existential polymorphism, but they require somewhat awkward <code>extends</code> trait-mechanisms because this was only implemented as an afterthought.</sub></p>\n\n<p><sup>\u2021</sup><sub>There are also functions which have \u201cconstraints in the arguments\u201d, but that's a more advanced concept called <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#arbitrary-rank-polymorphism\" rel=\"nofollow noreferrer\">rank-<em>n</em> polymorphism</a>.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1508089646, "last_edit_date": 1508089646, "creation_date": 1508083024, "answer_id": 46756992, "question_id": 46755613, "link": "https://stackoverflow.com/questions/46755613/how-do-i-fix-eq-a-has-kind-ghc-prim-constraint-error-in-haskell/46756992#46756992", "title": "How do I fix \u2018Eq a\u2019 has kind \u2018GHC.Prim.Constraint\u2019 error in haskell?", "body": "<p>This is really an extended comment. Aside from your little type error, your function has another problem: it's extremely inefficient. The main problem is your definition of <code>reverse</code>.</p>\n\n<pre><code>reverse :: [a] -&gt; [a]\nreverse xs\n  | null xs = []\n  | otherwise = (last xs) : reverse newxs\n      where\n        before = (length xs) - 1\n        newxs = take before xs\n</code></pre>\n\n<p><code>last</code> is O(n), where n is the length of the list. <code>length</code> is also O(n), where n is the length of the list. And <code>take</code> is O(k), where k is the length of the result. So your <code>reverse</code> will end up taking O(n^2) time. One fix is to just use the standard <code>reverse</code> function instead of writing your own. Another is to build up the result recursively, accumulating the result as you go:</p>\n\n<pre><code>reverse :: [a] -&gt; [a]\nreverse xs0 = go [] xs0\n  go acc [] = acc\n  go acc (x : xs) = go (x : acc) xs\n</code></pre>\n\n<p>This version is O(n).</p>\n\n<p>There's another source of inefficiency in your implementation:</p>\n\n<pre><code>checkPalindrome l = (l == reverse l)\n</code></pre>\n\n<p>This isn't nearly as bad, but let's look at what it does. Suppose we have the string <code>\"abcdefedcba\"</code>. Then we test whether <code>\"abcdefedcba\" == \"abcdefedcba\"</code>. By the time we've checked half the list, we already know the answer. So we'd like to stop there! There are several ways to accomplish this. The simplest efficient one is probably to calculate the length of the list as part of the process of reversing it so we know how much we'll need to check:</p>\n\n<pre><code>reverseCount :: [a] -&gt; (Int, [a])\nreverseCount xs0 = go 0 [] xs0 where\n  go len acc [] = (len, acc)\n  go len acc (x : xs) = len `seq`\n                        go (len + 1) (x : acc) xs\n</code></pre>\n\n<p>Don't worry about the <code>len `seq`</code> bit too much; that's just a bit of defensive programming to make sure laziness doesn't make things inefficient; it's probably not even necessary if optimizations are enabled. Now you can write a version of <code>==</code> that only looks at the first <code>n</code> elements of the lists:</p>\n\n<pre><code>eqTo :: Eq a =&gt; Int -&gt; [a] -&gt; [a] -&gt; Bool\neqTo 0 _ _ = True\neqTo _ [] [] = True\neqTo n (x : xs) (y : ys) =\n  x == y &amp;&amp; eqTo (n - 1) xs ys\neqTo _ _ _ = False\n</code></pre>\n\n<p>So now</p>\n\n<pre><code>isPalindrome xs = eqTo ((len + 1) `quot` 2) xs rev_xs\n  where\n    (len, rev_xs) = reverseCount xs\n</code></pre>\n\n<hr>\n\n<p>Here's another way, that's more efficient and arguably more elegant, but a bit tricky. We don't actually need to reverse the whole list; we only need to reverse half of it. This saves memory allocation. We can use a tortoise and hare trick:</p>\n\n<pre><code>splitReverse ::\n  [a] -&gt;\n  ( [a] -- the first half, reversed\n  , Maybe a -- the middle element\n  , [a] ) -- the second half, in order\nsplitReverse xs0 = go [] xs0 xs0 where\n  go front rear [] = (front, Nothing, rear)\n  go front (r : rs) [_] = (front, Just r, rs)\n  go front (r : rs) (_ : _ : xs) =\n    go (r : front) rs xs\n</code></pre>\n\n<p>Now</p>\n\n<pre><code>isPalindrome xs = front == rear\n  where\n    (front, _, rear) = splitReverse xs\n</code></pre>\n\n<hr>\n\n<p>Now for some numbers, using the test case</p>\n\n<pre><code>somePalindrome :: [Int]\nsomePalindrome = [1..10000] ++ [10000,9999..1]\n</code></pre>\n\n<p>Your original implementation takes 7.523s (2.316 mutator; 5.204 GC) and allocates 11 <em>gigabytes</em> to build the test list and check if it's a palindrome. My counting implementation takes less than 0.01s and allocates 2.3 <em>megabytes</em>. My tortoise and hare implementation takes less than 0.01s and allocates 1.7 megabytes.</p>\n"}], "owner": {"reputation": 1, "user_id": 8354429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bab33560b9bd62aeb55b4c5fb74f1a5?s=128&d=identicon&r=PG&f=1", "display_name": "Darius B", "link": "https://stackoverflow.com/users/8354429/darius-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 555, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1508089646, "creation_date": 1508074656, "question_id": 46755613, "link": "https://stackoverflow.com/questions/46755613/how-do-i-fix-eq-a-has-kind-ghc-prim-constraint-error-in-haskell", "title": "How do I fix \u2018Eq a\u2019 has kind \u2018GHC.Prim.Constraint\u2019 error in haskell?", "body": "<p>I am writing a small function in Haskell to check if a list is a palindrome by comparing it with it's reverse.</p>\n\n<pre><code>checkPalindrome :: [Eq a] -&gt; Bool\ncheckPalindrome l = (l == reverse l)\n                    where\n                        reverse :: [a] -&gt; [a]\n                        reverse xs\n                            | null xs = []\n                            | otherwise = (last xs) : reverse newxs\n                                  where\n                                      before = (length xs) - 1\n                                      newxs = take before xs\n</code></pre>\n\n<p>I understand that I should use [Eq a] in the function definition because I use the equality operator later on, but I get this error when I compile:</p>\n\n<pre><code>Expected kind \u2018*\u2019, but \u2018Eq a\u2019 has kind \u2018GHC.Prim.Constraint\u2019\nIn the type signature for \u2018checkPalindrome\u2019:\n  checkPalindrome :: [Eq a] -&gt; Bool\n</code></pre>\n\n<p>P.s Feel free to correct me if I am doing something wrong with my indentation, I'm very new to the language.</p>\n"}, {"tags": ["haskell", "cabal", "nix", "nixos", "ghcjs"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1508079216, "post_id": 46754193, "comment_id": 80457990, "body": "What version of stack you are using ? Try using the latest version if you aren&#39;t using that already.."}, {"owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1508090586, "post_id": 46754193, "comment_id": 80461785, "body": "I&#39;m using 1.5.1, which is the latest."}, {"owner": {"reputation": 14006, "user_id": 3798102, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100002464470905/picture?type=large", "display_name": "pamu", "link": "https://stackoverflow.com/users/3798102/pamu"}, "edited": false, "score": 0, "creation_date": 1515002333, "post_id": 46754193, "comment_id": 83139835, "body": "<a href=\"https://www.reddit.com/r/haskell/comments/7h53s3/haskell_gui_advice/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/7h53s3/haskell_gui_advice</a>"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1508064567, "creation_date": 1508064567, "question_id": 46754193, "link": "https://stackoverflow.com/questions/46754193/error-booting-ghcjs-in-nixos-from-a-stack-project", "title": "Error booting ghcjs in nixos from a stack project", "body": "<p>I'm encountering an error running the boot stage of GHCJS in Nixos. GHCJS is being installed by stack with:</p>\n\n<pre><code>stack setup\n</code></pre>\n\n<p>And it fails during \"installing stage 0\" with:</p>\n\n<pre><code>solver must be one of: modular\n</code></pre>\n\n<p>My stack.yaml looks like:</p>\n\n<pre><code>resolver: lts-7.19\ncompiler: ghcjs-0.2.1.9007019_ghc-8.0.1\ncompiler-check: match-exact\n\n(...)\n\nsetup-info:\n  ghcjs:\n    source:\n      ghcjs-0.2.1.9007019_ghc-8.0.1:\n        url: http://ghcjs.tolysz.org/ghc-8.0-2017-02-05-lts-7.19-9007019.tar.gz\n        sha1: d2cfc25f9cda32a25a87d9af68891b2186ee52f9\n</code></pre>\n\n<p>I've read that this was due to an <a href=\"https://github.com/NixOS/nixpkgs/pull/28098\" rel=\"nofollow noreferrer\">incompatibility between cabal-install 2.0 and GHCJS</a>. Even though I've been unable to find a way to fix it. Is there any way to make it build?</p>\n"}, {"tags": ["arrays", "sorting", "haskell"], "comments": [{"owner": {"reputation": 107, "user_id": 2296133, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bdf9c39adeda0dad75919f40df4dbb4e?s=128&d=identicon&r=PG", "display_name": "Triostrong", "link": "https://stackoverflow.com/users/2296133/triostrong"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508063811, "post_id": 46752435, "comment_id": 80453857, "body": "Thanks for response! I&#39;ve tried even just counting instances of each string (without length):      freqMap =  M.fromListWith (+) [(c, 1) | c &lt;- subs]  But it looks like performance is still the same with group.sort version. Profiling also showed that most of time is spent in sorting or freqMap evaluation."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 3, "creation_date": 1508067459, "post_id": 46752435, "comment_id": 80454717, "body": "Have you tried using <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.8.0/docs/Data-HashMap-Lazy.html#t:HashMap\" rel=\"nofollow noreferrer\"><code>Data.HashMap</code></a> instead? Could speed things up."}, {"owner": {"reputation": 107, "user_id": 2296133, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bdf9c39adeda0dad75919f40df4dbb4e?s=128&d=identicon&r=PG", "display_name": "Triostrong", "link": "https://stackoverflow.com/users/2296133/triostrong"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1508093048, "post_id": 46752435, "comment_id": 80462703, "body": "Thanks! HashMap worked significantly better, than other variants. Though it&#39;s still not unboxed array, but a tree, but I guess, it will take too much memory to index each of possible hash values into indexes."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1508094591, "post_id": 46752435, "comment_id": 80463240, "body": "You may be interested in <a href=\"https://hackage.haskell.org/package/hashtables\" rel=\"nofollow noreferrer\"><code>hashtables</code></a>."}, {"owner": {"reputation": 107, "user_id": 2296133, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bdf9c39adeda0dad75919f40df4dbb4e?s=128&d=identicon&r=PG", "display_name": "Triostrong", "link": "https://stackoverflow.com/users/2296133/triostrong"}, "edited": false, "score": 0, "creation_date": 1508099104, "post_id": 46752435, "comment_id": 80464693, "body": "Yes, but how do I count with hashtable? I don&#39;t see any fromListWith or something..."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 2296133, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bdf9c39adeda0dad75919f40df4dbb4e?s=128&d=identicon&r=PG", "display_name": "Triostrong", "link": "https://stackoverflow.com/users/2296133/triostrong"}, "edited": false, "score": 0, "creation_date": 1508133451, "post_id": 46760411, "comment_id": 80472678, "body": "Thanks for advice, now sorting is not my bottleneck. I&#39;ve got approximately 50% improvement in counting phase."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 1, "last_activity_date": 1508104617, "creation_date": 1508104617, "answer_id": 46760411, "question_id": 46752435, "link": "https://stackoverflow.com/questions/46752435/haskell-array-from-list-of-strings/46760411#46760411", "title": "Haskell array from list of strings", "body": "<p><a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.8.0/docs/Data-HashMap-Lazy.html#t:HashMap\" rel=\"nofollow noreferrer\"><code>Data.HashMap</code></a> (lazy/strict) is a faster version of the vanilla haskell maps - using them may speed up your operations if the bottleneck is primarily the update/lookup speed.</p>\n\n<p>And the best part is that you can keep the nice clean approach you've already written, and not have to write (usually uglier) code that interacts with arrays.</p>\n"}], "owner": {"reputation": 107, "user_id": 2296133, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bdf9c39adeda0dad75919f40df4dbb4e?s=128&d=identicon&r=PG", "display_name": "Triostrong", "link": "https://stackoverflow.com/users/2296133/triostrong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 46760411, "answer_count": 1, "score": 1, "last_activity_date": 1508104617, "creation_date": 1508049828, "last_edit_date": 1508063777, "question_id": 46752435, "link": "https://stackoverflow.com/questions/46752435/haskell-array-from-list-of-strings", "title": "Haskell array from list of strings", "body": "<p>So I have a list of strings and the task is to count how many times each string can be met in that list. \nI used maps: </p>\n\n<pre><code>freqMap =  M.fromListWith (+) [(c, 1) | c &lt;- subs]\n</code></pre>\n\n<p>and just sorting:</p>\n\n<pre><code>frequency list = map (\\l -&gt; (length l, head l)) $ group (sort list)\n</code></pre>\n\n<p>but it's all too slow for my task - the original list is very large.\nI've heard, that using unboxed arrays can be very fast. Like for list of integers:</p>\n\n<pre><code>histogram bounds xs = accumArray (+) 0 bounds [(x, 1) | x &lt;- xs]\n</code></pre>\n\n<p>As String is not a member of Ix class, the question is: is it possible to build an array from list of strings?</p>\n"}, {"tags": ["haskell", "types", "ghc", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1508051748, "post_id": 46752504, "comment_id": 80451004, "body": "Thanks. When I add the extensions and then call <code>(topFn @C1) &quot;abc&quot;</code> I get two errors <code>Pattern syntax in expression context: top@C1</code> and <code>Did you mean to enable TypeApplications?</code> I did add the <code>TypeApplications</code> extension and the rest of them.."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1508052126, "post_id": 46752504, "comment_id": 80451089, "body": "Did you enable <code>TypeApplications</code> where you are <i>calling</i> the function? Possibly GHCi?"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1508052576, "post_id": 46752504, "comment_id": 80451184, "body": "It&#39;s all in one file with this line at the top: <code>{-# LANGUAGE TypeApplications, AllowAmbiguousTypes, ExplicitForAll, ScopedTypeVariables #-}</code> Then I do <code>&gt; topFn @C1 &quot;abc&quot;</code>. It doesn&#39;t help to do <code>&gt; {-# LANGUAGE TypeApplications, AllowAmbiguousTypes, ExplicitForAll, ScopedTypeVariables #-}</code> first."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1508052917, "post_id": 46752504, "comment_id": 80451263, "body": "Assuming <code>&gt; {-# LANGUAGE TypeApplications, AllowAmbiguousTypes, ExplicitForAll, ScopedTypeVariables #-}</code> is entered in GHCi, it won&#39;t work. From within GHCi, you can do <code>&gt; :set -XTypeApplications</code> instead."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1508054973, "post_id": 46752504, "comment_id": 80451713, "body": "Aha! That did it!"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1508055162, "post_id": 46752504, "comment_id": 80451767, "body": "Is it possible to pass the type as an argument to the function call?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1508055674, "post_id": 46752504, "comment_id": 80451894, "body": "Actually, <code>TypeApplications</code> is doing exactly that: passing in the type as an argument to the function call. If you are looking for a way to pass the type as a <i>regular</i> argument to the function call, then no. That requires full-blown dependent types. Note that this is actually exactly what Idris does."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1508050503, "creation_date": 1508050503, "answer_id": 46752504, "question_id": 46752411, "link": "https://stackoverflow.com/questions/46752411/ambiguous-intermediate-result/46752504#46752504", "title": "Ambiguous intermediate result", "body": "<p>Yes, use the <code>TypeApplications</code>, <code>AllowAmbiguousTypes</code>, <code>ExplicitForall</code>, and <code>ScopedTypeVariables</code> extensions. Then, modify <code>topFn</code> to be</p>\n\n<pre><code>topFn :: forall a. C a =&gt; String -&gt; String \ntopFn = showC . newC @a\n</code></pre>\n\n<p>Then, you can call <code>topFn</code> using an explicit type-application: <code>topFn @C1 \"calling the C1 variant\"</code> and <code>topFn @C2 \"calling the C2 variant\"</code>. If you want, you can define:</p>\n\n<pre><code>topFn1 = topFn @C1\ntopFn2 = topFn @C2\n</code></pre>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 46752504, "answer_count": 1, "score": 1, "last_activity_date": 1508086372, "creation_date": 1508049630, "last_edit_date": 1508086372, "question_id": 46752411, "link": "https://stackoverflow.com/questions/46752411/ambiguous-intermediate-result", "title": "Ambiguous intermediate result", "body": "<p>Suppose I have a typeclass, two instances, and a function defined as follows.</p>\n\n<pre><code>class C c where\n  newC :: String -&gt; c\n  showC :: c -&gt; String\n\ndata C1 = C1 String  \n\ninstance C C1 where\n  newC string = C1 string  \n  showC (C1 string) = string\n\ndata C2 = C2 String  \n\ninstance C C2 where\n  newC string = C2 string  \n  showC (C2 string) = string\n\n\ntopFn :: String -&gt; String \ntopFn = showC . newC\n</code></pre>\n\n<p>When loaded, GHC produces an \"Ambiguous type\" error,</p>\n\n<pre><code>Ambiguous type variable \u2018c0\u2019 arising from a use of \u2018showC\u2019\nprevents the constraint \u2018(C c0)\u2019 from being solved.\nProbable fix: use a type annotation to specify what \u2018c0\u2019 should be.\nThese potential instances exist:\n   instance C C1 -- Defined at ambigType.hs:8:10\n   instance C C2 -- Defined at ambigType.hs:14:10\n</code></pre>\n\n<p>I understand that the intermediate value could be either <code>C1</code> or <code>C2</code> and that without further information GHC has no way to determine which it should be.</p>\n\n<p>Writing two versions of <code>topFn</code> solves the problem.</p>\n\n<pre><code>topFn1 :: String -&gt; String \ntopFn1 = showC . (newC :: String -&gt; C1)\n\ntopFn2 :: String -&gt; String \ntopFn2 = showC . (newC :: String -&gt; C2)\n</code></pre>\n\n<p>But since these are essentially identical functions, this seems like an ugly solution. Is there a better way?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "exception"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1508037944, "post_id": 46751324, "comment_id": 80448634, "body": "Find the docs for a function that you&#39;re familiar with that throws an error, click the Source button, and have a look at what they do. One example would be <code>!!</code>"}, {"owner": {"reputation": 87, "user_id": 6054529, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2b8000b90a650b4ec5fa36b9b270fb64?s=128&d=identicon&r=PG&f=1", "display_name": "Darkhail", "link": "https://stackoverflow.com/users/6054529/darkhail"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1508038093, "post_id": 46751324, "comment_id": 80448654, "body": "I don&#39;t have one that I&#39;m familiar with since this is my first experience with haskell"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1509564888, "post_id": 46751324, "comment_id": 81072697, "body": "to see about (!!), click <a href=\"http://hoogle.haskell.org/?hoogle=(!!)\" rel=\"nofollow noreferrer\">here</a>. then <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:-33--33-\" rel=\"nofollow noreferrer\">here</a>, and <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.List.html#%21%21\" rel=\"nofollow noreferrer\">here</a>. and <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.List.html#negIndex\" rel=\"nofollow noreferrer\">here</a>. to read more about your subject, try <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">this</a> and search for &quot;guards&quot; there."}], "answers": [{"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1508043396, "post_id": 46751607, "comment_id": 80449455, "body": "Further minor improvement: use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:null\" rel=\"nofollow noreferrer\"><code>null</code></a> instead of <code>(== [])</code>.  Shorter and doesn&#39;t incur an <code>Eq</code> constraint :-)"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 6, "last_activity_date": 1508043558, "last_edit_date": 1508043558, "creation_date": 1508040692, "answer_id": 46751607, "question_id": 46751324, "link": "https://stackoverflow.com/questions/46751324/throwing-an-exception-in-haskell-when-the-object-being-returned-is-not-a-string/46751607#46751607", "title": "Throwing an exception in Haskell when the object being returned is not a string.", "body": "<p>By default, if no equation for a function matches the given arguments, you get a runtime error:</p>\n\n<pre><code>fromJust :: Maybe a -&gt; a\nfromJust (Just a) = a\n-- No case for Nothing\n-- fromJust Nothing throws error at runtime\n</code></pre>\n\n<p>However, this doesn't work for numbers. Instead, guards will do a similar thing:</p>\n\n<pre><code>assertOver0 :: Int -&gt; ()\nassertOver0 n | n &gt; 0 = ()\n-- No case for n &lt;= 0\n-- assertOver0 (-1) throws error at runtime\n</code></pre>\n\n<p>While this is the default behavior, it is bad style to have incomplete patterns/guards. Instead, explicitly cause an error with <code>error</code> or <code>undefined</code>:</p>\n\n<pre><code>pr n | n &gt;= 0    = filter (null . getter) [2..] !! n\n     | otherwise = error \"Table flip\"\n-- undefined is just like error, except that error lets you give an error message\n-- and undefined doesn't (undefined is more useful when you know it will never\n-- be evaluated, and you don't need to give an error message)\n-- undefined :: a; error :: String -&gt; a\n-- That is, they can take on any type you want them to have, because whatever code\n-- is after them will never be executed anyway\n-- I took liberties with your definition of pr. Your filtering function didn't use\n-- x, so I wrote what I think you meant. I also made it 0-indexed.\n-- Prelude.null checks for [], but doesn't incur an Eq constraint, so I replaced\n-- (== []) with it.\n-- Parens are not needed around the filter, because function application has\n-- the highest precedence.\n</code></pre>\n\n<p>Haskell also has a more sophisticated exception mechanism in <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Exception.html\" rel=\"nofollow noreferrer\"><code>Control.Exception</code></a>, but you probably don't need that here. In general, exceptions and partial functions are looked down upon, (because you can only handle them in <code>IO</code>) and you should strive for monads like <code>Maybe</code> or <code>Either</code> instead.</p>\n\n<pre><code>import Control.Monad\npr n = do guard $ n &gt;= 0 -- guard True = Just (); guard False = Nothing (in this case)\n          return $ filter (null . getter) [2..] !! n\npr 2 = Just 5\npr (-1) = Nothing\n</code></pre>\n\n<p>All this is unnecessary, though. <code>(!!)</code> already errors on negative indices</p>\n\n<pre><code>ghci&gt; \"abc\" !! -1\n*** Exception: Prelude.!!: negative index\n</code></pre>\n\n<p>So we're back to where we started:</p>\n\n<pre><code>pr n = filter (null . getter) [2..] !! n\n</code></pre>\n\n<p>There's also <a href=\"https://hackage.haskell.org/package/listsafe-0.1.0.0/candidate/docs/Data-List-Safe.html\" rel=\"nofollow noreferrer\">a library</a> that redefines list operations (including <code>(!!)</code>) to be monadic instead of partial.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 0, "last_activity_date": 1508074062, "last_edit_date": 1508074062, "creation_date": 1508067320, "answer_id": 46754578, "question_id": 46751324, "link": "https://stackoverflow.com/questions/46751324/throwing-an-exception-in-haskell-when-the-object-being-returned-is-not-a-string/46754578#46754578", "title": "Throwing an exception in Haskell when the object being returned is not a string.", "body": "<p>In Haskell, basically everything is just a library function. As such it can easily be found with online search engines. That includes error handling. Thus you may <a href=\"https://hayoo.fh-wedel.de/?query=error\" rel=\"nofollow noreferrer\">ask Hayoo for <code>error</code></a>, or <a href=\"https://hayoo.fh-wedel.de/?query=raise\" rel=\"nofollow noreferrer\">for <code>raise</code></a>, or <a href=\"https://hayoo.fh-wedel.de/?query=throw\" rel=\"nofollow noreferrer\">for <code>throw</code></a>. All three exist \u2013 but <code>raise</code> only in different flavours, specialised to particular libraries, whereas <a href=\"http://hackage.haskell.org/package/base/docs/Control-Exception-Base.html#v:throw\" rel=\"nofollow noreferrer\"><code>throw</code></a> and <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#v:error\" rel=\"nofollow noreferrer\"><code>error</code></a> are part of <code>base</code> and thus of \u201cHaskell itself\u201d.</p>\n\n<ul>\n<li><code>throw</code> can be used to produce properly typed exceptions and is suitable if you may at some point, in your program itself, want to <em>catch</em> / analyse the errors.</li>\n<li><code>error</code> is mostly useful to just <em>crash the program</em> while producing a (hopefully) useful diagnostic message on the terminal, which seems to be what you want here.</li>\n</ul>\n\n<p>The type of <code>error</code> is<sup>\u2020</sup>, as of GHC-8,</p>\n\n<pre><code>error :: HasCallStack =&gt; String -&gt; a\n</code></pre>\n\n<p>The <code>HasCallStack</code> is a recent addition which allows the program to tell you <em>where</em> in your code the error occured. This doesn't change the way you use the function though; in older versions of GHC the type was simply</p>\n\n<pre><code>error :: String -&gt; a\n</code></pre>\n\n<p>That means, you just give <code>error</code> some <em>error message</em> and then use it as \u201cthe result\u201d of any function, no matter what the result type of that function is actually supposed to be. In your case,</p>\n\n<pre><code>pr n | n &gt;= 0     = ...\n     | otherwise  = error \"Table flip\"\n</code></pre>\n\n<p>If you give this function a negative number, it will then not give any actual result but crash the program with the message <code>Table flip</code> and, in GHC>=8, also tell you that this error happened within <code>pr</code>.</p>\n\n<p>You'll probably want to also know <em>where <code>pr</code> was called</em>, to actually debug the problem. You can yourself use the GHC call-stack simulation for this:</p>\n\n<pre><code>import GHC.Stack\n\npr :: HasCallStack =&gt; Int -&gt; Int\npr n | n &gt;= 0     = ...\n     | otherwise  = error \"Table flip\"\n</code></pre>\n\n<p>Note that I didn't need to change the implementation in any way, I just added the <code>HasCallStack</code> constraint.</p>\n\n<p><hr>\n<sup>\u2020</sup>\n<sub>\nIf you look in <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:error\" rel=\"nofollow noreferrer\">the documentation, as of GHC-8.2</a>, you'll be shown a rather scarier signature</p>\n\n<pre><code>error :: forall (r :: RuntimeRep). forall (a :: TYPE r). HasCallStack =&gt; [Char] -&gt; a\n</code></pre>\n\n<p>...don't worry about that, these are just implementation details raising of meanigful errors throwing is in fact not so naturally supported by the Haskell language.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1508131492, "creation_date": 1508131492, "answer_id": 46763439, "question_id": 46751324, "link": "https://stackoverflow.com/questions/46751324/throwing-an-exception-in-haskell-when-the-object-being-returned-is-not-a-string/46763439#46763439", "title": "Throwing an exception in Haskell when the object being returned is not a string.", "body": "<p><strong>Administrivia</strong>\nOther answers have given you some good text so I'm going to be code-heavy and explanation light here.  If something still isn't clear then please do comment and I'll try to fill it in (or any of you regular S.O. answerers can beat me to it).</p>\n\n<p><strong>The Answer</strong></p>\n\n<p>You presented a problem where the input of <code>n &lt;= 0</code> is invalid:</p>\n\n<pre><code>pr :: Int -&gt; Int\npr n = (filter(\\x -&gt; (getter) == []) [2..]) !! (n-1)\n</code></pre>\n\n<p>The easy solution is to match with a pattern or guard and manually throw an exception:</p>\n\n<pre><code>pr :: Int -&gt; Int\npr n | n &lt;= 0    = error \"NO!\"\n     | otherwise = ...\n</code></pre>\n\n<p>But sometimes you want a non-string exception in which case you probably want <code>Control.Exception</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveAnyClass #-}\n-- ^^^ This is not just a comment, enables a language extension\nimport Control.Exception as X\n\ndata MyException = ZeroOrNegative\n    deriving (Exception,Show,Eq,Ord)\n              -- ^^ N.B. you should derive 'Exception' for\n              --    types you want to 'throw'\n\npr n | n &lt;= 0    = X.throw ZeroOrNegative\n     | otherwise = ...\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 6054529, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2b8000b90a650b4ec5fa36b9b270fb64?s=128&d=identicon&r=PG&f=1", "display_name": "Darkhail", "link": "https://stackoverflow.com/users/6054529/darkhail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1508131492, "creation_date": 1508037132, "question_id": 46751324, "link": "https://stackoverflow.com/questions/46751324/throwing-an-exception-in-haskell-when-the-object-being-returned-is-not-a-string", "title": "Throwing an exception in Haskell when the object being returned is not a string.", "body": "<p>So I'm writing a program in Haskell that receives a number n telling it to return the nth prime number starting at 2 being the 1st prime number. That part of the program works however what I don't understand is how to also have the program throw an exception when the number is 0 or less. </p>\n\n<pre><code>pr :: Int -&gt; Int\npr n = (filter(\\x -&gt; (getter) == []) [2..]) !! (n-1)\n</code></pre>\n\n<p>The getter references another method I wrote that is solving the prime problem. It is working fine. </p>\n"}, {"tags": ["haskell", "types", "ghc", "dependent-type"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1508035549, "creation_date": 1508035549, "answer_id": 46751209, "question_id": 46751129, "link": "https://stackoverflow.com/questions/46751129/getting-a-regular-list-from-a-type-list/46751209#46751209", "title": "Getting a regular List from a Type List", "body": "<p>The answer is to make something like <code>KnownNat</code> but for type level lists of <code>Nat</code>. We proceed by induction on the type-level list, using a type class. This typeclass, through its superclass constraints, will check that all elements of you list satisfy <code>KnownNat</code> and then it will use that fact to reconstruct a term-level list.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, KindSignatures #-}\n\n-- Similar to `KnownNat (n :: Nat)`\nclass KnownNatList (ns :: [Nat]) where\n   natListVal :: proxy ns -&gt; [Integer]\n\n-- Base case\ninstance KnownNatList '[] where\n  natListVal _ = []\n\n-- Inductive step\ninstance (KnownNat n, KnownNatList ns) =&gt; KnownNatList (n ': ns) where\n  natListVal _ = natVal (Proxy :: Proxy n) : natListVal (Proxy :: Proxy ns)\n</code></pre>\n\n<p>Then, <code>fromListNat</code> takes the same shape as <code>fromNat</code>:</p>\n\n<pre><code>fromListNat :: KnownNatList ns =&gt; Proxy ns -&gt; IO ()\nfromListNat proxy = do\n  let (listNum :: [Integer]) = natListVal proxy\n  putStrLn $ \"Some list of num: \" &lt;&gt; show listNum\n</code></pre>\n\n<p>Splicing in these changes to your initial code, I get the expected output:</p>\n\n<pre><code>$ ghc Main.hs\n$ ./Main\nSome num: 5\nSome list of num: [2,3,10]\n</code></pre>\n"}], "owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 46751209, "answer_count": 1, "score": 3, "last_activity_date": 1508035748, "creation_date": 1508034546, "last_edit_date": 1508035748, "question_id": 46751129, "link": "https://stackoverflow.com/questions/46751129/getting-a-regular-list-from-a-type-list", "title": "Getting a regular List from a Type List", "body": "<p>I've found a way to convert a <code>Nat</code> into an <code>Integer</code> using <code>Proxy</code> and <code>natVal</code> as you can see in the code below:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Main where\n\nimport Data.Proxy (Proxy)\nimport Data.Monoid ((&lt;&gt;))\nimport GHC.TypeLits\n\nmain :: IO ()\nmain = do\n  fromNat (undefined :: Proxy 5)\n\nfromNat :: KnownNat n =&gt; Proxy n -&gt; IO ()\nfromNat proxy = do\n  let (num :: Integer) = natVal proxy -- converting a Nat to an Integer\n  putStrLn $ \"Some num: \" &lt;&gt; show num\n</code></pre>\n\n<p>But I'm not able to think a straightforward way to convert a type List into a regular list, the code below doesn't even type check:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Main where\n\nimport Data.Proxy (Proxy)\nimport Data.Monoid ((&lt;&gt;))\nimport GHC.TypeLits\n\nmain :: IO ()\nmain = do\n  fromNat     (undefined :: Proxy 5)\n  fromListNat (undefined :: Proxy '[2,3,10])\n\nfromNat :: KnownNat n =&gt; Proxy n -&gt; IO ()\nfromNat proxy = do\n  let (num :: Integer) = natVal proxy -- converting a Nat to an Integer\n  putStrLn $ \"Some num: \" &lt;&gt; show num\n\nfromListNat :: Proxy [Nat] -&gt; IO ()\nfromListNat = undefined\n</code></pre>\n\n<p>How can I convert a type list into a regular list?</p>\n"}, {"tags": ["haskell", "types", "ghc", "dependent-type", "singleton-type"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1508038798, "post_id": 46750999, "comment_id": 80448763, "body": "I&#39;m confused.  Do you want <code>playingWithTypes (-2)</code> to <i>succeed</i>?"}, {"owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1508074037, "post_id": 46750999, "comment_id": 80456407, "body": "@luqui Well <code>playingWithTypes</code> receives an Integer, and this Integer could be either natural or negative, therefore I wold expect it doesn&#39;t just dies at runtime if I send it the wrong value. Is for this reason that I would prefer using <code>someNatVal</code> over <code>toSing</code>, <code>someNatVal</code> is more explicit about its impossibility in converting all <code>Integer</code>s into <code>Nat</code>s while I need to add some non-obvious code <code>toSing</code> to not let it die suddenly."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1508073992, "post_id": 46751460, "comment_id": 80456398, "body": "How does <code>SingI</code> help with induction? For induction, Peano naturals (whether from <code>singletons</code> or not) work more naturally than <code>TypeLits</code> ones. For the latter, you can fake up an eliminator <code>elimNat :: f 0 -&gt; (forall k. SingI k =&gt; f k -&gt; f (k + 1)) -&gt; Sing n -&gt; f n</code> using <code>unsafeCoerce</code>, but everything is awkward."}, {"owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1508074475, "post_id": 46751460, "comment_id": 80456522, "body": "@dfeuer Wait, aren&#39;t <code>Nat</code>s from <code>singletons</code> and from <code>TypeLits</code> the same? Do <code>singletons</code> support <code>Nat</code>s and &quot;peano Nats&quot;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "edited": false, "score": 0, "creation_date": 1508076820, "post_id": 46751460, "comment_id": 80457269, "body": "@helq, yes, those are the same. Sorry, got confused. I meant <code>singleton-nats</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1508113741, "post_id": 46751460, "comment_id": 80468072, "body": "Not <i>every</i> <code>n :: Nat</code> has <code>KnownNat</code> instance.  An empty <code>type family A :: Nat</code> will give you a &quot;nonstandard&quot; natural at the type level."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1508113998, "last_edit_date": 1508113998, "creation_date": 1508039104, "answer_id": 46751460, "question_id": 46750999, "link": "https://stackoverflow.com/questions/46750999/typelits-or-singletons-promoting-an-integer-to-knownnat-nat-at-runtime/46751460#46751460", "title": "TypeLits or Singletons: Promoting an `Integer` to `KnownNat` (`Nat`) at Runtime", "body": "<blockquote>\n  <p><code>Nat</code> (or <code>KnownNat</code>, I don't get the distintion yet)</p>\n</blockquote>\n\n<p><code>Nat</code> is the kind of type-level natural numbers. It has no term-level inhabitants. The idea is that GHC promotes any natural number into the type-level, and gives it kind <code>Nat</code>.</p>\n\n<p><code>KnownNat</code> is a constraint, on something of kind <code>Nat</code>, whose implementation witnesses how to convert the thing of kind <code>Nat</code> to a term-level <code>Integer</code>. GHC automagically creates instances of <code>KnownNat</code> for <em>all</em> type-level inhabitants of the kind <code>Nat</code><sup>1</sup>.</p>\n\n<p>That said, even if every <code>n :: Nat</code> (read type <code>n</code> of kind <code>Nat</code>) has a <code>KnownNat</code> instance on it<sup>1</sup>, you still need to write out the constraint.</p>\n\n<blockquote>\n  <p>I've found two ways to promote an <code>Integer</code> to a <code>Nat</code></p>\n</blockquote>\n\n<p>Have you really? At the end of the day, <code>Nat</code> in today's GHC is simply magical. <code>singletons</code> taps into that same magic. Under the hood, it <a href=\"https://github.com/goldfirere/singletons/blob/fe370c4a26088cac370a14dc6be342194103f131/src/Data/Singletons/TypeLits/Internal.hs#L66-L70\" rel=\"nofollow noreferrer\">uses <code>someNatVal</code></a>.</p>\n\n<blockquote>\n  <p>So, what is the \"standard\" way to promote an <code>Integer</code> to a <code>Nat</code>? Or what is the best approach to promote, using <code>GHC.TypeLits</code> and <code>Proxy</code>, or singletons?</p>\n</blockquote>\n\n<p>There is no standard way. My take is: use <code>singletons</code> when you can afford its dependency footprint and <code>GHC.TypeLits</code> otherwise. The advantage of <code>singletons</code> is that the <code>SingI</code> type class makes it convenient to do induction based analysis while still also relying on GHC's special <code>Nat</code> type.</p>\n\n<hr>\n\n<p><sup>1</sup> As pointed out in the comments, not <em>every</em> inhabitant of the <code>Nat</code> kind has a <code>KnownNat</code> instance. For example, <code>Any Nat :: Nat</code> where <code>Any</code> is the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/GHC-Exts.html#t:Any\" rel=\"nofollow noreferrer\">one from <code>GHC.Exts</code></a>. Only the inhabitants <code>0</code>, <code>1</code>, <code>2</code>, ... have <code>KnownNat</code> instances.</p>\n"}], "owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 823, "favorite_count": 1, "accepted_answer_id": 46751460, "answer_count": 1, "score": 6, "last_activity_date": 1508113998, "creation_date": 1508032753, "last_edit_date": 1508039250, "question_id": 46750999, "link": "https://stackoverflow.com/questions/46750999/typelits-or-singletons-promoting-an-integer-to-knownnat-nat-at-runtime", "title": "TypeLits or Singletons: Promoting an `Integer` to `KnownNat` (`Nat`) at Runtime", "body": "<p>I've found two ways to promote an Integer to a Nat (or KnownNat, I don't get the distintion yet) at runtime, either using TypeLits and Proxy (Data.Proxy and GHC.TypeLits), or Singletons (Data.Singletons). In the code below you can see how each of the two approaches is used:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n\nmodule Main where\n\nimport Prelude hiding (replicate)\nimport Data.Proxy (Proxy(Proxy))\nimport Data.Monoid ((&lt;&gt;))\nimport Data.Singletons (SomeSing(..), toSing)\nimport GHC.TypeLits\nimport Data.Singletons.TypeLits\nimport Data.Vector.Sized (Vector, replicate)\n\nmain :: IO ()\nmain = playingWithTypes 8\n\nplayingWithTypes :: Integer -&gt; IO ()\nplayingWithTypes nn = do\n\n  case someNatVal nn of\n    Just (SomeNat (proxy :: Proxy n)) -&gt; do\n--      let (num :: Integer) = natVal proxy\n--      putStrLn $ \"Some num: \" &lt;&gt; show num\n      putStrLn $ \"Some vector: \" &lt;&gt; show (replicate 5 :: Vector n Int)\n    Nothing -&gt; putStrLn \"There's no number, the integer was not a natural number\"\n\n  case (toSing nn :: SomeSing Nat) of\n    SomeSing (SNat :: Sing n) -&gt; do\n--      let (num :: Integer) = natVal (Proxy :: Proxy n)\n--      putStrLn $ \"Some num: \" &lt;&gt; show num\n      putStrLn $ \"Some vector: \" &lt;&gt; show (replicate 5 :: Vector n Int)\n</code></pre>\n\n<p>The documentation for <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/GHC-TypeLits.html\" rel=\"noreferrer\">TypeLits</a> indicates that it shouldn't be used by developers, but Singletons don't capture the case in which the given Integer is not a natural number (i.e., running <code>playingWithTypes 8</code> runs without errors, but <code>playingWithTypes (-2)</code> fails when we try to create a Singleton from the non-natural number).</p>\n\n<p>So, what is the \"standard\" way to promote an <code>Integer</code> to a <code>Nat</code>? Or what is the best approach to promote, using TypeLits and Proxy, or Singletons?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1508032131, "creation_date": 1508032131, "answer_id": 46750957, "question_id": 46750924, "link": "https://stackoverflow.com/questions/46750924/padding-an-empty-string-to-text/46750957#46750957", "title": "Padding an empty string to text", "body": "<p>Since strings are lists of characters, you can use:</p>\n\n<pre><code>replicate :: Int -&gt; a -&gt; [a]\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>replicate 5 'x' == \"xxxxx\"\n</code></pre>\n\n<p>You can find utility functions like this yourself by searching for a plausible type signature with Hoogle; <code>replicate</code> happens to be the first result in a <a href=\"https://www.haskell.org/hoogle/?hoogle=Int+-%3E+a+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">Hoogle search for <code>Int -&gt; a -&gt; [a]</code></a>.</p>\n\n<p>If you\u2019re using <code>Text</code> instead of <code>String</code>, there is an equivalent function in <code>Data.Text</code>:</p>\n\n<pre><code>replicate :: Int -&gt; Text -&gt; Text\n\nreplicate 5 (pack \"x\") == pack \"xxxxx\"\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 1574335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/746e3779afca8d97aeab9841086d3dec?s=128&d=identicon&r=PG", "display_name": "pip", "link": "https://stackoverflow.com/users/1574335/pip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 46750957, "answer_count": 1, "score": 0, "last_activity_date": 1508032131, "creation_date": 1508031552, "question_id": 46750924, "link": "https://stackoverflow.com/questions/46750924/padding-an-empty-string-to-text", "title": "Padding an empty string to text", "body": "<p>I am do a crypto exercise that I need to pad an input text to have length of multiple of 16 bytes (AES), and I find that in python I can create a empty (i.e. string of space) with:</p>\n\n<blockquote>\n  <blockquote>\n    <p>' ' * n # whatever integer n is</p>\n  </blockquote>\n</blockquote>\n\n<p>Is there an equivalent way in haskell? I can do it with simple function using recursion, but just curious is there a way that is even shorter than the python snip.</p>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"comments": [{"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 0, "creation_date": 1509816649, "post_id": 47065901, "comment_id": 81176824, "body": "\u201c\u2009\u2018field\u2019 always treats the field as existant in the case where the field name matches\u201d \u2013 bless your soul for actually explaining this. Thank you!"}], "tags": [], "owner": {"reputation": 1070, "user_id": 1461430, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a5f25d8b93603aece2130069a2c759ec?s=128&d=identicon&r=PG", "display_name": "rlpowell", "link": "https://stackoverflow.com/users/1461430/rlpowell"}, "is_accepted": true, "score": 3, "last_activity_date": 1509583912, "creation_date": 1509583912, "answer_id": 47065901, "question_id": 46750357, "link": "https://stackoverflow.com/questions/46750357/conditionally-including-a-field-in-the-context-based-on-each-page-s-metadata/47065901#47065901", "title": "Conditionally including a field in the context based on each page\u2019s metadata", "body": "<p>You need to return Control.Applicative's \"empty\" to have a field be entirely non-existant.  An example from my own code:</p>\n\n<pre><code>-- What we're trying to do is produce a field that *doesn't* match\n-- key in the case where the metadata \"header\" is not set to \"no\" or\n-- \"false\"; matching it and returning false or whatever\n-- (makeHeaderField above) isn't working, so any call to \"field\" is\n-- guaranteed to not work\nmakeHeaderField :: String -&gt; Context a\nmakeHeaderField key = Context $ \\k _ i -&gt; do\n    if key == k then do\n      value &lt;- getMetadataField (itemIdentifier i) \"header\"\n      if isJust value then\n        if elem (fromJust value) [ \"no\", \"No\", \"false\", \"False\" ] then\n          -- Compiler is an instance of Alternative from\n          -- Control.Applicative ; see Hakyll/Core/Compiler/Internal.hs\n          CA.empty\n        else\n          return $ StringField $ fromJust value\n      else\n        return $ StringField \"yes makeheader\"\n    else\n      CA.empty\n</code></pre>\n\n<p>Oh, I forgot: as my code comments specify above, you can't use the hakyll \"field\" function in this case, because \"field\" always treats the field as existant in the case where the field name matches.  You have to copy the code from \"field\" to get your own on CA.empty returns in the places you want them, as I've done above (CA is Control.Applicative).</p>\n"}, {"tags": [], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "is_accepted": false, "score": 1, "last_activity_date": 1509816729, "creation_date": 1509816729, "answer_id": 47113525, "question_id": 46750357, "link": "https://stackoverflow.com/questions/46750357/conditionally-including-a-field-in-the-context-based-on-each-page-s-metadata/47113525#47113525", "title": "Conditionally including a field in the context based on each page\u2019s metadata", "body": "<p>For posterity, here is the function I ended up with thanks to @rlpowell\u2019s answer.</p>\n\n<pre><code>-- | Creates a new field based on the item's metadata. If the metadata\n-- field is not present then no field will actually be created.\n-- Otherwise, the value will be passed to the given function and the\n-- result of that function will be used as the field's value.\ntransformedMetadataField :: String -&gt; String -&gt; (String -&gt; String) -&gt; Context a\ntransformedMetadataField newKey originalKey f = Context $ \\k _ i -&gt; do\n    if k == newKey\n       then do\n           value &lt;- getMetadataField (itemIdentifier i) originalKey\n           maybe empty (return . StringField . f) value\n       else empty\n</code></pre>\n"}], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 47065901, "answer_count": 2, "score": 2, "last_activity_date": 1509816729, "creation_date": 1508024491, "last_edit_date": 1509312639, "question_id": 46750357, "link": "https://stackoverflow.com/questions/46750357/conditionally-including-a-field-in-the-context-based-on-each-page-s-metadata", "title": "Conditionally including a field in the context based on each page\u2019s metadata", "body": "<p>I\u2019d like to add a field to my Hakyll site\u2019s context. If a certain key is present in the metadata then I\u2019d like to transform the corresponding value and include that in the context. If the key is not present in the metadata then nothing should be added to the context.</p>\n\n<p>I wrote this function that <em>should</em> do what I described:</p>\n\n<pre><code>-- | Creates a new field based on the item's metadata. If the metadata field is\n-- not present then no field will actually be created. Otherwise, the value will\n-- be passed to the given function and the result of that function will be used\n-- as the field's value.\ntransformedMetadataField :: String -&gt; String -&gt; (String -&gt; String) -&gt; Context a\ntransformedMetadataField key itemName f = field key $ \\item -&gt; do\n    fieldValue &lt;- getMetadataField (itemIdentifier item) itemName\n    return $ maybe (fail $ \"Value of \" ++ itemName ++ \" is missing\") f fieldValue\n</code></pre>\n\n<p>However, if the metadata field is not present then this will still insert a field into the context with the empty string as its value. For example, I have this line in my context:</p>\n\n<pre><code>transformedMetadataField \"meta_description\" \"meta_description\" escapeHtml\n</code></pre>\n\n<p>and I have this template:</p>\n\n<pre><code>$if(meta_description)$\n    &lt;meta name=\"description\" content=\"$meta_description$\"/&gt;\n$endif$\n</code></pre>\n\n<p>On pages with no <code>meta_description</code> in their metadata, the following HTML is produced:</p>\n\n<pre><code>    &lt;meta name=\"description\" content=\"\"/&gt;\n</code></pre>\n\n<p>whereas what I want is for no tag to be produced at all.</p>\n\n<p>What have I done wrong in my <code>transformedMetadataField</code> function?</p>\n"}, {"tags": ["haskell", "typeclass", "functor"], "answers": [{"comments": [{"owner": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "edited": false, "score": 0, "creation_date": 1508067568, "post_id": 46750332, "comment_id": 80454744, "body": "thank you, that works and provides a way to other problems I was facing. But I think the class <code>OF</code> is wrong (HNil doesn&#39;t have kind <code>[*]</code>). I am a bit unsure how to fix the class."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "edited": false, "score": 0, "creation_date": 1508069759, "post_id": 46750332, "comment_id": 80455266, "body": "@Leander Fixed the last snippet."}, {"owner": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "edited": false, "score": 0, "creation_date": 1508070983, "post_id": 46750332, "comment_id": 80455609, "body": "thank you. I didn&#39;t call onlyFun, which was my problem. Hmm needing to call onlyFun is making this technique hard to generalize."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "edited": false, "score": 0, "creation_date": 1508074417, "post_id": 46750332, "comment_id": 80456510, "body": "@Leander The user of <code>mapHsimple</code> does not have to call it, though."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1508069700, "last_edit_date": 1508069700, "creation_date": 1508024130, "answer_id": 46750332, "question_id": 46750123, "link": "https://stackoverflow.com/questions/46750123/mapping-operation-for-heterogenous-list/46750332#46750332", "title": "mapping operation for heterogenous List", "body": "<p>You need to prove that <code>mappings</code> only has functions inside. This can be made with an additional GADT.</p>\n\n<pre><code>data OnlyFunctions (ts :: [*]) where\n   FNil :: OnlyFunctions '[]\n   FCons :: OnlyFunctions ts -&gt; OnlyFunctions ((a-&gt;b) ': ts)\n\nmapH :: forall mappings input output.\n    (input ~ ToDomain mappings, output ~ ToCoDomain mappings)\n    =&gt; OnlyFunctions mappings -&gt; HList mappings -&gt; HList input -&gt; HList output\nmapH FNil HNil HNil = HNil\nmapH (FCons h) (f :&amp;: maps) (x :&amp;: ins) = (f x) :&amp;: mapH h maps ins\n</code></pre>\n\n<p>The issue is that <code>ToDomain '[Int,Bool]</code> is a valid type -- even if <code>ToDomain</code> does not simplify in such case. Hence GHC can not assume that the <code>mappings</code> list of types is made of functions, only.</p>\n\n<p>You can remove the additional argument through a custom type class, if needed.</p>\n\n<pre><code>class OF (ts :: [*]) where\n   onlyFun :: OnlyFunctions ts\ninstance OF '[] where\n   onlyFun = FNil\ninstance OF ts =&gt; OF ((a -&gt; b) ': ts) where\n   onlyFun = FCons onlyFun\n\nmapHsimple :: forall mappings input output.\n    (input ~ ToDomain mappings, output ~ ToCoDomain mappings, OF mappings)\n    =&gt; HList mappings -&gt; HList input -&gt; HList output\nmapHsimple = mapH onlyFun\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1508032784, "last_edit_date": 1508032784, "creation_date": 1508028688, "answer_id": 46750700, "question_id": 46750123, "link": "https://stackoverflow.com/questions/46750123/mapping-operation-for-heterogenous-list/46750700#46750700", "title": "mapping operation for heterogenous List", "body": "<p>If you want mapping operations, you're almost certainly better off defining</p>\n\n<pre><code>data Rec (f :: k -&gt; *) (ts :: [k]) where\n  RNil :: Rec f '[]\n  (:&amp;:) :: f t -&gt; Rec f ts -&gt; Rec f (t ': ts)\n\ninfixr 5 :&amp;:\n</code></pre>\n\n<p>Now you can define a general</p>\n\n<pre><code>rmap :: (forall a. f a -&gt; g a) -&gt; Rec f ts -&gt; Rec g ts\n</code></pre>\n\n<p>and</p>\n\n<pre><code>rzipWith :: (forall a. f a -&gt; g a -&gt; h a) -&gt; Rec f ts -&gt; Rec g ts -&gt; Rec h ts\n</code></pre>\n\n<p>This generally makes things rather easier. In this case, you could use</p>\n\n<pre><code>data Fun :: * -&gt; * where\n  Fun :: (a -&gt; b) -&gt; Fun (a -&gt; b)\n\ndata Dom :: * -&gt; * where\n  Dom :: a -&gt; Dom (a -&gt; b)\n\ndata Cod :: * -&gt; * where\n  Cod :: b -&gt; Cod (a -&gt; b)\n</code></pre>\n\n<p>Now you can write</p>\n\n<pre><code>zoop :: Rec Fun fs -&gt; Rec Dom fs -&gt; Rec Cod fs\nzoop = rzipWith (\\(Fun f) (Dom x) -&gt; Cod (f x))\n</code></pre>\n\n<p>In fact, some of this is slight overkill; you should be able to get away with a newtype wrapping a type family for <code>Dom</code>. You could even do so for <code>Cod</code>, but that might make the result less usable.</p>\n"}], "owner": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 46750332, "answer_count": 2, "score": 1, "last_activity_date": 1508069700, "creation_date": 1508021793, "question_id": 46750123, "link": "https://stackoverflow.com/questions/46750123/mapping-operation-for-heterogenous-list", "title": "mapping operation for heterogenous List", "body": "<p>I have a simple heterogenous List</p>\n\n<pre><code>data HList (ts :: [Type]) where\n    HNil :: HList '[]\n    (:&amp;:) :: t -&gt; HList ts -&gt; HList (t ': ts)\n\ninfixr 5 :&amp;:\n</code></pre>\n\n<p>and am trying to define a heterogeneous map:</p>\n\n<pre><code>type family ToDomain (xs :: [Type]) :: [Type] where\n    ToDomain '[] = '[];\n    ToDomain ((a -&gt; b) ': r) = a ': ToDomain r\n\ntype family ToCoDomain (xs :: [Type]) :: [Type] where\n    ToCoDomain '[] = '[];\n    ToCoDomain ((a -&gt; b) ': r) = b ': ToCoDomain r\n\nmapH :: forall mappings input output.\n    (input ~ ToDomain mappings, output ~ ToCoDomain mappings)\n    =&gt; HList mappings -&gt; HList input -&gt; HList output\nmapH HNil HNil = HNil\nmapH (f :&amp;: maps) (x :&amp;: ins) = (f x) :&amp;: mapH maps ins\n</code></pre>\n\n<p>this does not compile (i would be really surprised if this would actually work) since GHC can't infer the correctness of the recursion. I am unsure how to convince GHC of the correctness.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1508017960, "post_id": 46749678, "comment_id": 80445427, "body": "(1) You probably want to define <code>data CellType = Wall | Path | Start | End</code> then <code>data Cell = Cell CellType Point</code>. (2) You can use <code>lens</code> to write <code>a^.point.x</code> (assuming you have the right lenses defined)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1508019029, "post_id": 46749678, "comment_id": 80445649, "body": "Again, <code>data Point = Point Int Int</code> would be sufficient, as would <code>data Cell = Wall Point | Path Point | Start Point | End Point</code>."}], "answers": [{"comments": [{"owner": {"reputation": 376, "user_id": 7271772, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eef9b3cffd3ca044729a43c23f7232d9?s=128&d=identicon&r=PG&f=1", "display_name": "George Morris", "link": "https://stackoverflow.com/users/7271772/george-morris"}, "edited": false, "score": 0, "creation_date": 1508021648, "post_id": 46749820, "comment_id": 80446189, "body": "I tried that and it seems it worked but I am still having trouble referring to the point of the Wall instance.  data Wall = Wall { point :: Point }. let w = Wall (Point 1 2) and when I type point . x w I get an error."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 376, "user_id": 7271772, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eef9b3cffd3ca044729a43c23f7232d9?s=128&d=identicon&r=PG&f=1", "display_name": "George Morris", "link": "https://stackoverflow.com/users/7271772/george-morris"}, "edited": false, "score": 0, "creation_date": 1508031582, "post_id": 46749820, "comment_id": 80447719, "body": "@GeorgeMorris <code>(.)</code> is a normal function, not special syntax, so you&#39;ll need to at least inspect its type (e.g. in ghci with <code>:t (.)</code>), and possibly look at the implementation to understand how to use it. For now do <code>point (x w)</code>. (and then pick up a haskell book)"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 4, "last_activity_date": 1508019054, "creation_date": 1508019054, "answer_id": 46749820, "question_id": 46749678, "link": "https://stackoverflow.com/questions/46749678/haskell-getter-of-data-type/46749820#46749820", "title": "Haskell getter of data type", "body": "<p>First, I think you're confused about <code>data</code> declaration syntax:</p>\n\n<pre><code>data Point = Point(Int, Int)\n</code></pre>\n\n<p>This is a data constructor that takes a single tuple argument, i.e. you think the parens are some kind of syntax for application. We can ask ghci:</p>\n\n<pre><code>Prelude&gt; data Point = Point(Int, Int)\nPrelude&gt; :t Point\nPoint :: (Int, Int) -&gt; Point\n</code></pre>\n\n<p>What you actually want is:</p>\n\n<pre><code>Prelude&gt; data Point = Point Int Int\nPrelude&gt; :t Point\nPoint :: Int -&gt; Int -&gt; Point\n</code></pre>\n\n<p>The second piece you're missing is called <em>record syntax</em>, which allows you to name the two <code>Int</code> fields above.</p>\n\n<pre><code>data Point = Point { x :: Int, y :: Int }\n</code></pre>\n\n<p>This brings into scope two functions <code>x</code> and <code>y</code> that can extract the piece of data you're interested in:</p>\n\n<pre><code>Prelude&gt; data Point = Point { x :: Int, y :: Int }\nPrelude&gt; let p = Point 2 3\nPrelude&gt; :t x\nx :: Point -&gt; Int\nPrelude&gt; x p\n2\nPrelude&gt; y p\n3\n</code></pre>\n\n<p>You can do the same for <code>Wall</code> and then <code>point . x</code> will get you the function <code>Wall -&gt; Int</code> you're looking for.</p>\n\n<p>\"lenses\" are about making this sort of thing first-class, and are something I'd suggest not exploring right now. Definitely pick up a good haskell book and work through the first chapters carefully though.</p>\n"}], "owner": {"reputation": 376, "user_id": 7271772, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eef9b3cffd3ca044729a43c23f7232d9?s=128&d=identicon&r=PG&f=1", "display_name": "George Morris", "link": "https://stackoverflow.com/users/7271772/george-morris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1017, "favorite_count": 0, "accepted_answer_id": 46749820, "answer_count": 1, "score": 0, "last_activity_date": 1508066128, "creation_date": 1508017780, "question_id": 46749678, "link": "https://stackoverflow.com/questions/46749678/haskell-getter-of-data-type", "title": "Haskell getter of data type", "body": "<p>Basically, I have 2 different structures - Point and Cell. Since there is an aggregation between them, I would like to somehow get the value of the Point just by having the cell - let's say at a moment, I only have a cell but I wish to get its location.\nLike this <code>a = Wall(Point(1,2)</code>. Can I somehow get it? Like <code>a.point</code>? And if so, can I get <code>x</code> and <code>y</code> somehow like this?  <code>a.point.x</code>.</p>\n\n<pre><code>data Point = Point(Int, Int) -- y, x\ninstance Show Point where\n  show (Point(x, y)) = \"(\" ++ show x ++ \",\" ++ show y ++ \")\"\n\ndata Cell = Wall(Point) | Path(Point) | Start(Point) | End(Point)\ninstance Show Cell where\n  show (Wall(Point(x, y))) = \"X\"\n  show (Path(Point(x, y))) = \"(\"++show x ++ \",\" ++ show y ++ \")\"\n  show (Start(Point(x, y))) = \"S\"\n  show (End(Point(x, y))) = \"E\"\n</code></pre>\n"}, {"tags": ["haskell", "binary"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1508015536, "post_id": 46748773, "comment_id": 80444784, "body": "Use bytestring for packed binary data.  There is already base16, base58 and base64.  A generalized <code>baseN</code> with customizable alphabet would be a great package to build and contribute to the community."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1508071759, "post_id": 46755135, "comment_id": 80455832, "body": "It&#39;s good that you answer your own question and also ok to use information from a comment, but if you do that please make sure it actually answers the original question. I.e., write out briefly what your solution is now."}], "tags": [], "owner": {"reputation": 23, "user_id": 8528262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/976c2e54309ef7a50e17241d4a743163?s=128&d=identicon&r=PG&f=1", "display_name": "Hopeful_O", "link": "https://stackoverflow.com/users/8528262/hopeful-o"}, "is_accepted": true, "score": 0, "last_activity_date": 1508076916, "last_edit_date": 1508076916, "creation_date": 1508071166, "answer_id": 46755135, "question_id": 46748773, "link": "https://stackoverflow.com/questions/46748773/what-is-the-optimized-way-to-handle-base-encodings-in-haskell/46755135#46755135", "title": "What is the optimized way to handle base encodings in Haskell?", "body": "<p>All right @Thomas M DuBuisson gave a good answer. I am going to use the ByteString type, which is more efficient for this type of program and will allow me to perform precise bitwise operations on Word8 terms if needed.</p>\n"}], "owner": {"reputation": 23, "user_id": 8528262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/976c2e54309ef7a50e17241d4a743163?s=128&d=identicon&r=PG&f=1", "display_name": "Hopeful_O", "link": "https://stackoverflow.com/users/8528262/hopeful-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 46755135, "answer_count": 1, "score": 0, "last_activity_date": 1508076916, "creation_date": 1508010942, "question_id": 46748773, "link": "https://stackoverflow.com/questions/46748773/what-is-the-optimized-way-to-handle-base-encodings-in-haskell", "title": "What is the optimized way to handle base encodings in Haskell?", "body": "<p>context : I'm currently using Haskell to develop functions that handle multiple base encodings (base2,base8... up to base64) with a lot of different options (pad/nopad, upper/lower, different versions of base encodings) It could potentially be used to encode data transmitted through a p2p network so it should be optimized and easy to maintain )</p>\n\n<p>problem: my functions handle the actual encoding with lists of 0 or 1 Ints that are a subsitute for binary data ( [0,1,0,0,1]  represents 01001).</p>\n\n<p>So the code works but using lists of ints like that seems awfully clunky and \"shortcutty\" to me.</p>\n\n<p>question: Using Haskell, when dealing with precise handling of binary data (specifically in the base encoding context) is there a better and faster type to use than the one stated above?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 5, "last_activity_date": 1508010132, "creation_date": 1508010132, "answer_id": 46748635, "question_id": 46748559, "link": "https://stackoverflow.com/questions/46748559/i-need-help-haskell-inhabitant-for-the-type/46748635#46748635", "title": "I need help (haskell) inhabitant for the type", "body": "<p>\"Inhabitant of a type\" means an expression which has some given type. For instance, <code>2</code> is an inhabitant of <code>Int</code>, and <code>[\"Foo\",\"Bar\"]</code> is an inhabitant of <code>[String]</code>.</p>\n\n<p>In other words, your teacher is asking you to write something that has a type <code>(a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</code>.</p>\n\n<p>I won't solve this for you since it's homework, but if you're having trouble writing such a function, your first step would be to write out all the arguments and their types, then try to use them together to complete it.</p>\n"}], "owner": {"reputation": 19, "user_id": 8777115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50a546c81c122e58448ae2a5e34fb6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Manuel", "link": "https://stackoverflow.com/users/8777115/jose-manuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1508012707, "creation_date": 1508009579, "last_edit_date": 1508012707, "question_id": 46748559, "link": "https://stackoverflow.com/questions/46748559/i-need-help-haskell-inhabitant-for-the-type", "title": "I need help (haskell) inhabitant for the type", "body": "<p>Last Friday my teacher give me this problem:</p>\n\n<p>Give an inhabitant for the type</p>\n\n<pre><code>(a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\n</code></pre>\n\n<p>and i do not understand exactly what it asks for</p>\n\n<p>EDIT:Exercise completed. The given type corresponds with the default haskell flip function. Thank you for your answers.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1508007763, "post_id": 46748121, "comment_id": 80442606, "body": "You may consider looking into <code>Data.List.Unique.unique</code> functionality as well. It will keep the last word and will remove the previous dupes."}], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 7624973, "user_type": "registered", "profile_image": "https://graph.facebook.com/1009054249203980/picture?type=large", "display_name": "\u0412\u0438\u0442\u0430\u043b\u0438\u0439 \u041c\u0443\u0434\u0440\u044b\u0439", "link": "https://stackoverflow.com/users/7624973/%d0%92%d0%b8%d1%82%d0%b0%d0%bb%d0%b8%d0%b9-%d0%9c%d1%83%d0%b4%d1%80%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1508011677, "post_id": 46748215, "comment_id": 80443754, "body": "I add this. But I have problem. I have to read the file whose name is set on the command line. If there is no file then I have to read the content from stdin. But when I do the Enter in the console, I get the result, but it should return only after Ctrl C. Maybe you know how to solve the problem?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 191, "user_id": 7624973, "user_type": "registered", "profile_image": "https://graph.facebook.com/1009054249203980/picture?type=large", "display_name": "\u0412\u0438\u0442\u0430\u043b\u0438\u0439 \u041c\u0443\u0434\u0440\u044b\u0439", "link": "https://stackoverflow.com/users/7624973/%d0%92%d0%b8%d1%82%d0%b0%d0%bb%d0%b8%d0%b9-%d0%9c%d1%83%d0%b4%d1%80%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1508012424, "post_id": 46748215, "comment_id": 80443950, "body": "&quot;when I do the Enter in the console, I get the result, but it should return only after Ctrl C&quot; Ctrl-C will kill your program. Perhaps you mean an end-of-file indicator like Ctrl-D or Ctrl-Z. Why do you want this unusual behaviour? Your program is a typical line-oriented filter and works like one (compare with <code>grep</code> or <code>tr</code>)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 191, "user_id": 7624973, "user_type": "registered", "profile_image": "https://graph.facebook.com/1009054249203980/picture?type=large", "display_name": "\u0412\u0438\u0442\u0430\u043b\u0438\u0439 \u041c\u0443\u0434\u0440\u044b\u0439", "link": "https://stackoverflow.com/users/7624973/%d0%92%d0%b8%d1%82%d0%b0%d0%bb%d0%b8%d0%b9-%d0%9c%d1%83%d0%b4%d1%80%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1508012769, "post_id": 46748215, "comment_id": 80444044, "body": "Anyway the easiest way to delay printing would be to force evaluation of input (or output) string length and then ignore it, e.g. instead of <code>s</code> use <code>(seq (length s) s)</code>."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 1, "last_activity_date": 1508007350, "creation_date": 1508007350, "answer_id": 46748215, "question_id": 46748121, "link": "https://stackoverflow.com/questions/46748121/how-to-convert-list-to-string/46748215#46748215", "title": "How to convert list to string?", "body": "<p>Use the <code>unwords</code> function to undo the effect of <code>words</code>.\u00a0You may also want to replace <code>show</code> with <code>unlines</code>.</p>\n\n<pre><code>seqWord s = unlines (map (unwords . filterWord . words) (lines s))\n</code></pre>\n"}], "owner": {"reputation": 191, "user_id": 7624973, "user_type": "registered", "profile_image": "https://graph.facebook.com/1009054249203980/picture?type=large", "display_name": "\u0412\u0438\u0442\u0430\u043b\u0438\u0439 \u041c\u0443\u0434\u0440\u044b\u0439", "link": "https://stackoverflow.com/users/7624973/%d0%92%d0%b8%d1%82%d0%b0%d0%bb%d0%b8%d0%b9-%d0%9c%d1%83%d0%b4%d1%80%d1%8b%d0%b9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1772, "favorite_count": 0, "accepted_answer_id": 46748215, "answer_count": 1, "score": 0, "last_activity_date": 1508007350, "creation_date": 1508006640, "question_id": 46748121, "link": "https://stackoverflow.com/questions/46748121/how-to-convert-list-to-string", "title": "How to convert list to string?", "body": "<p>I make a function which read file and removes in every line all the words that were encountered earlier in the same line.</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\nmodule Main where\nimport System.Environment\nimport System.IO()\n\nmain :: IO ()\nmain = do args &lt;- getArgs \n          if (length args &gt; 0) then do\n            f &lt;- get args\n            putStrLn (seqWord $ head f)\n          else do\n            f &lt;- getContents\n            putStrLn (seqWord f)\n\nget :: [String] -&gt; IO[String]\nget [] = return []\nget (file:xs) = do\n  contents &lt;- readFile file\n  fs &lt;- get xs\n  return (contents:fs)\n\nseqWord :: String -&gt; String\nseqWord s = show (map (filterWord . words) (lines s))\n\nfilterWord :: [String] -&gt; [String]\nfilterWord [] = []\nfilterWord (x:xs) = x : filterWord (filter(/=x) xs)\n</code></pre>\n\n<p>In answer I have list of lists, like this</p>\n\n<pre><code>[[\"1\",\"12\",\"5\",\"8\",\"13\",\"145\",\"85\"],[\"546\",\"822\",\"1\",\"12\",\"58\",\"8\",\"9\"]]\n</code></pre>\n\n<p>Please, help me fix this problem. Thank you</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1508002575, "creation_date": 1508002575, "answer_id": 46747435, "question_id": 46747212, "link": "https://stackoverflow.com/questions/46747212/how-to-define-a-class-with-a-type-family/46747435#46747435", "title": "how to define a class with a type family", "body": "<p><strong>The goal is to include an instance of the Note type family in some data structure b, and use noteOf b to extract it</strong></p>\n\n<p>That's not how type families work.  All you've really said is that you can map one type, represented by variable <code>a</code> into another type via the type function <code>Note</code>.  It doesn't mean values of type <code>a</code> contain a value of type <code>Note b</code> at all.  It is the type class that rather strongly implies the <code>Note a</code> type is within or computable from the <code>a</code> type.</p>\n\n<p>The code is along the lines of:</p>\n\n<pre><code>type family Note a\ntype instance Note String = String\nclass SomeNote a where\n    noteOf :: a -&gt; Note a\n</code></pre>\n\n<p>Even better, consider using an associated type:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nclass SomeNote a where\n    type Note a :: *\n    noteOf :: a -&gt; Note a\n\ninstance SomeNote String where\n    type Note String = String\n    noteOf = id\n</code></pre>\n"}], "owner": {"reputation": 1415, "user_id": 474491, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ba21053d650c48ca674e577b38a976aa?s=128&d=identicon&r=PG", "display_name": "Pierre Carbonnelle", "link": "https://stackoverflow.com/users/474491/pierre-carbonnelle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "closed_date": 1556594593, "answer_count": 1, "score": 1, "last_activity_date": 1508048011, "creation_date": 1508001012, "question_id": 46747212, "link": "https://stackoverflow.com/questions/46747212/how-to-define-a-class-with-a-type-family", "closed_reason": "Duplicate", "title": "how to define a class with a type family", "body": "<p><a href=\"https://repl.it/MdIP/2\" rel=\"nofollow noreferrer\">The following code</a> generates an \"Expected a constraint\" error :</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\ntype family Note a\ntype instance Note String = String\n\ndata SomeNote = forall a. Note a =&gt; SomeNote a\n\nclass HasNote b where\n  noteOf :: b -&gt; SomeNote\n</code></pre>\n\n<p>The error is <code>Expected a constraint, but 'Note a' has kind '*', in the definition of SomeNote</code>.  Why ?  How can I fix it ?</p>\n\n<p>The goal is to include an instance of the Note type family in some data structure b, and use noteOf b to extract it, whatever the instance is.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "edited": false, "score": 0, "creation_date": 1507999200, "post_id": 46746870, "comment_id": 80439800, "body": "What do you mean by &quot;string array of numbers&quot;, given that the Point constructor takes two numbers? How are they separated?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507999300, "post_id": 46746870, "comment_id": 80439839, "body": "<code>Point</code> doesn&#39;t have a <code>Monad</code> instance, so <code>do</code> notation can&#39;t be used. Also, your <code>Point</code> type is doubly wrapping the coordinates. There&#39;s no need to encapsulate the two points in a tuple; they can simply be wrapped by the <code>Point</code> constructor itself: <code>data Point = Point Int Int</code>."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1507999689, "post_id": 46746870, "comment_id": 80439971, "body": "Are you learning Haskell based on a tutorial? Because the <code>gimmePoints</code> function, to be blunt, doesn&#39;t make much sense. It&#39;s not clear what it&#39;s supposed to be doing at all, let alone what it actually does. I suggest slowing down and trying a simpler task, perhaps more in line with a beginner&#39;s Haskell guide such as <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">LYAH</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1507999739, "post_id": 46746870, "comment_id": 80439984, "body": "Please show an intended <i>call</i> of <code>gimmePoints</code>.\\"}], "answers": [{"comments": [{"owner": {"reputation": 376, "user_id": 7271772, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eef9b3cffd3ca044729a43c23f7232d9?s=128&d=identicon&r=PG&f=1", "display_name": "George Morris", "link": "https://stackoverflow.com/users/7271772/george-morris"}, "edited": false, "score": 0, "creation_date": 1508000053, "post_id": 46747004, "comment_id": 80440075, "body": "Thank you for your explanation. Worked."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1507999798, "creation_date": 1507999798, "answer_id": 46747004, "question_id": 46746870, "link": "https://stackoverflow.com/questions/46746870/haskell-return-custom-datatype/46747004#46747004", "title": "Haskell return custom datatype", "body": "<p>If your function has signature <code>... -&gt; Point</code>, that means the result should be a point. Nothing else. So you can certainly write</p>\n\n<pre><code>gimmePoints :: String -&gt; Point                       \ngimmePoints (x:xs) = Point(1,2)\n</code></pre>\n\n<p>That means of course only the first character in the string will be processed. In fact, since you don't actually <em>use</em> that character or anything else in the string in any way, you might as well write this as</p>\n\n<pre><code>gimmePoints _ = Point(1,2)\n</code></pre>\n\n<p>I don't suppose that's what you want.</p>\n\n<p><code>do</code> syntax at any rate doesn't make any sense here, that is for <em>monadic</em> (\u201cside-effectful\u201d) <em>actions</em>. For instance, if you want for each character the point to be printed to the screen, you could do</p>\n\n<pre><code>gimmePoints' (_:xs) = do\n      print $ Point(1,2)\n      gimmePoints' xs\n</code></pre>\n\n<p>In this case, the result of <code>gimmePoints</code> would not be <code>Point</code> at all, but rather an IO action with no result (because the \u201cresults\u201d are sent to the screen instead)</p>\n\n<pre><code>gimmePoints' :: String -&gt; IO ()\n</code></pre>\n\n<p>A more sensible, or at least more functional-programming-ish version you could actually want is</p>\n\n<pre><code>gimmePoints'' :: String -&gt; [Point]\ngimmePoints'' [] = []\ngimmePoints'' (_:xs) = Point (1,2) : gimmePoints'' xs\n</code></pre>\n\n<p>i.e. for each character in the string, <em>you yield one point in the result</em>. This would actually better be written</p>\n\n<pre><code>gimmePoints'' = map (const $ Point (1,2))\n</code></pre>\n"}], "owner": {"reputation": 376, "user_id": 7271772, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eef9b3cffd3ca044729a43c23f7232d9?s=128&d=identicon&r=PG&f=1", "display_name": "George Morris", "link": "https://stackoverflow.com/users/7271772/george-morris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 0, "accepted_answer_id": 46747004, "answer_count": 1, "score": 1, "last_activity_date": 1507999798, "creation_date": 1507998963, "question_id": 46746870, "link": "https://stackoverflow.com/questions/46746870/haskell-return-custom-datatype", "title": "Haskell return custom datatype", "body": "<p>I can not get this method working at all. Getting errors all the time. Where am I making a mistake? It is supposed to accept string array of numbers, take the head, create a point. However, I think the problem is in the recursion call.</p>\n\n<pre><code>data Point = Point(Int, Int) -- y, x\ninstance Show Point where\n  show (Point(y, x)) = \"(\" ++ show x ++ \",\" ++ show y ++ \")\"\n\ngimmePoints :: String -&gt; Point                       \ngimmePoints (x:xs) = do Point(1,2)\n                        gimmePoints xs\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "edited": false, "score": 0, "creation_date": 1507998849, "post_id": 46746820, "comment_id": 80439687, "body": "What types do the pair consist of?"}, {"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1507999334, "post_id": 46746820, "comment_id": 80439852, "body": "primeiros :: [(a,b)] -&gt; [a]"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1507999880, "post_id": 46746820, "comment_id": 80440032, "body": "From the <code>primeiros :: [(a,b)] -&gt; [a]</code> type signature I guess all you need to do is <code>primeiros = map fst</code>"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1507999453, "creation_date": 1507999453, "answer_id": 46746946, "question_id": 46746820, "link": "https://stackoverflow.com/questions/46746820/how-to-do-lists-of-pairs/46746946#46746946", "title": "How to do lists of pairs?", "body": "<h1>Pairs</h1>\n\n<p>You can create a pair like this:</p>\n\n<pre><code>Prelude&gt; (42, \"Foo\")\n(42,\"Foo\")\n</code></pre>\n\n<p>This is a pair where the first element is a number, and the second element is a <code>String</code>.</p>\n\n<p>That pair is a both a pair of values, but you can also think of it as a single value.</p>\n\n<h1>List</h1>\n\n<p>One way to write a list of values is like this:</p>\n\n<pre><code>Prelude&gt; [1,5,2,7,1337]\n[1,5,2,7,1337]\n</code></pre>\n\n<p>This is a list of five numbers.</p>\n\n<p>Another way to write the same list is like this:</p>\n\n<pre><code>Prelude&gt; 1:5:2:7:1337:[]\n[1,5,2,7,1337]\n</code></pre>\n\n<hr>\n\n<p>Now that you know how to write a pair as a single element, and how to write a list of elements, I'm sure you can figure out how to write a list of pairs.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507999815, "post_id": 46746986, "comment_id": 80440005, "body": "That&#39;s horribly inefficient."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507999917, "post_id": 46746986, "comment_id": 80440042, "body": "Would the <code>map</code> version be more efficient?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507999997, "post_id": 46746986, "comment_id": 80440058, "body": "<i>Far</i> more efficient, if you use it correctly--you don&#39;t compose them; <code>fst</code> is the <i>argument</i> of <code>map</code>. And your understanding of why someone might down vote the question really isn&#39;t necessary for this answer."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1508000239, "post_id": 46746986, "comment_id": 80440138, "body": "I don&#39;t think there should be a composition operator at <code>primeiros = map . first</code> since you are not feeding the result of <code>fst</code> to <code>map</code> as first parameter."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1508001224, "post_id": 46746986, "comment_id": 80440452, "body": "In general <code>[e] ++ t</code> is best written as <code>e : t</code>. Both have O(1) complexity, but the second one does not create an additional list. Also, in the first solution, you need <code>primeiros [] = []</code> for the empty case. The <code>map fst</code> solution is more idiomatic, though."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508001307, "post_id": 46746986, "comment_id": 80440477, "body": "@chi Thanks, I&#39;ll keep that in mind. I just saw thought that my first code snippet looked like what the OP tried to do."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "is_accepted": false, "score": 2, "last_activity_date": 1508000281, "last_edit_date": 1508000281, "creation_date": 1507999659, "answer_id": 46746986, "question_id": 46746820, "link": "https://stackoverflow.com/questions/46746820/how-to-do-lists-of-pairs/46746986#46746986", "title": "How to do lists of pairs?", "body": "<p>You create a list with the first element like so:</p>\n\n<pre><code>primeiros :: [(a,b)] -&gt; [a]\nprimeiros (x:xs) = [fst x] ++ primeiros xs\n</code></pre>\n\n<p><code>fst</code> returns the first element of a pair, and you can also use <code>map</code>:</p>\n\n<pre><code>primeiros :: [(a,b)] -&gt; [a]\nprimerios = map fst\n</code></pre>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1508361498, "creation_date": 1507998680, "last_edit_date": 1508361498, "question_id": 46746820, "link": "https://stackoverflow.com/questions/46746820/how-to-do-lists-of-pairs", "title": "How to do lists of pairs?", "body": "<p>So im suposed to do a function that receives a list of pairs and gives the firsts elements of the pair , the problem is that i only know how to write a list of pair if it is only 1 pair</p>\n\n<pre><code>primeiros :: [(a,b)] -&gt; [a] \nprimeiros (a,b) = undefined\n</code></pre>\n\n<p>but the problem is that i dont know how to write if is more than 1 pair , i tried this :</p>\n\n<pre><code>primeiros [(a,b),(as,bs)] = undefined\n</code></pre>\n\n<p>but this obvious wont work because it will only do something if the list has 2 pairs , i want something that works for whatever pairs.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1507996667, "post_id": 46746383, "comment_id": 80439025, "body": "you can not throw an exception for that, since that is checked at compile time."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1507997213, "post_id": 46746383, "comment_id": 80439185, "body": "Each function in Haskell takes exactly one argument, thanks to currying. The function above, for instance, takes <code>a</code> and returns a function <code>[a]-&gt;[a]</code>. There is no way to detect whether &quot;too few&quot; arguments have been passed. Even if the language allowed that, that would horribly break partial application. Further, in your example, you seem to want to handle the case where the &quot;first&quot; argument is not passed but the &quot;second&quot; one is, which is even prevented by the application syntax."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 2, "creation_date": 1507997497, "post_id": 46746383, "comment_id": 80439264, "body": "This is good practice in Java but not something you do in Haskell. Supplying less arguments than required is totally fine, thanks to currying you just get a new function that you can supply with the remaining arguments later. You also don&#39;t need to check for <code>null</code> or equivalent, because Haskell doesn&#39;t allow <code>null</code> in place of actual values."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1507997607, "post_id": 46746383, "comment_id": 80439304, "body": "In another sense, type checking already catches this for you. If <code>foo :: [a] -&gt; b</code>, and you try to call <code>foo (showListConditional 3)</code>, the type checker will complain that <code>showListConditional 3 :: [a] -&gt; [a]</code> does not match <code>[a]</code> expected by <code>foo</code>."}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": true, "score": 0, "last_activity_date": 1508082254, "creation_date": 1508082254, "answer_id": 46756882, "question_id": 46746383, "link": "https://stackoverflow.com/questions/46746383/haskell-how-to-throw-an-error-for-too-few-arguments-supplied-to-a-function/46756882#46756882", "title": "Haskell: How to throw an error for too few arguments supplied to a function?", "body": "<p>As the commenters have stated, this is not really done in Haskell (because partial application is useful!) but if I wouldn't want a function to be called with 'insufficient' arguments, I would make the argument a tuple. For simplicity, suppose I want to make a function that adds three numbers</p>\n\n<pre><code>addThree :: (Int, Int, Int) -&gt; Int\naddThree (a, b, c) = a + b + c\n</code></pre>\n\n<p>If I try to call <strong>addThree</strong> with less than 3 arguments, the compiler will give me an error.</p>\n"}], "owner": {"reputation": 35, "user_id": 6683535, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153372728107920/picture?type=large", "display_name": "Arms Wide Open", "link": "https://stackoverflow.com/users/6683535/arms-wide-open"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 46756882, "answer_count": 1, "score": 0, "last_activity_date": 1508082254, "creation_date": 1507996088, "last_edit_date": 1507996682, "question_id": 46746383, "link": "https://stackoverflow.com/questions/46746383/haskell-how-to-throw-an-error-for-too-few-arguments-supplied-to-a-function", "title": "Haskell: How to throw an error for too few arguments supplied to a function?", "body": "<p>A newbie question. I would like to throw an elegant error when too few arguments are supplied to a function. You can see, I would like modify the part that's commented out below. Thanks</p>\n\n<pre><code>showListConditional :: (Integral a) =&gt; a -&gt; [a] -&gt; [a]\n\n--showListConditional undefined y = error \"Please specify number of transformation steps as the first argument, before the list!\"\n\nshowListConditional z y = map head (filter isLong (map chain y))\n        where isLong q = fromIntegral (length q) &gt; z\n</code></pre>\n"}, {"tags": ["haskell", "io", "internationalization"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1507995820, "post_id": 46746212, "comment_id": 80438742, "body": "<code>let a = &quot;H\\949\\921\\921\\959 \\964h\\949r\\949!&quot; in putStrLn a</code> works fine for me in several ghc versions. Not sure what the issue could be"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507995949, "post_id": 46746212, "comment_id": 80438790, "body": "I suspect this might be a platform issue... what operating system are you using? Haskell Platform or Stack? Which GHC?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1507995966, "post_id": 46746212, "comment_id": 80438799, "body": "Let me guess. Is this on windows?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507996016, "post_id": 46746212, "comment_id": 80438819, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21365317/ghc-display-of-unicode-characters\">GHC: Display of unicode characters</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1507996300, "post_id": 46746212, "comment_id": 80438913, "body": "Note that if you <code>print</code> a string, you will get non-ASCII chars escaped, and some ASCII quoted as well -- this is intentional. <code>putStrLn</code> should print the string as it is."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1508012342, "post_id": 46746212, "comment_id": 80443930, "body": "@chi Yes, it&#39;s Windows."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1508012365, "post_id": 46746212, "comment_id": 80443938, "body": "@jberryman No, It&#39;s not"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1508018469, "post_id": 46746212, "comment_id": 80445529, "body": "On windows you need to 1) enable utf8 by running <code>chcp 65001</code> before you start <code>ghci</code>, and 2) use a console that actually has the Unicode fonts you need -- the default one likely does not. I used ConEmu with some success."}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 235, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507995082, "creation_date": 1507995082, "question_id": 46746212, "link": "https://stackoverflow.com/questions/46746212/does-putstrln-support-international-characters", "title": "Does &quot;putStrLn&quot; support international characters?", "body": "<p>I've recently tried a function that converts some characters to greek characters to obscure text to software. However, the results are either printed out as \"\\###\" or, in this case (putStrLn) not at all.</p>\n\n<pre><code>*Main&gt; a\n\"H\\949\\921\\921\\959 \\964h\\949r\\949!\"\n*Main&gt; print a\n\"H\\949\\921\\921\\959 \\964h\\949r\\949!\"\n*Main&gt; putStrLn a\nH*** Exception: &lt;stdout&gt;: hPutChar: invalid argument (invalid character)\n*Main&gt; :t a\na :: [Char]\n*Main&gt; putStrLn \"Hello there!\"\nHello there!\n</code></pre>\n"}, {"tags": ["haskell", "concurrency", "signals", "monad-transformers", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 7387538, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207502264703363/picture?type=large", "display_name": "ttylec", "link": "https://stackoverflow.com/users/7387538/ttylec"}, "edited": false, "score": 0, "creation_date": 1508007029, "post_id": 46746232, "comment_id": 80442401, "body": "Indeed, that do the trick. I just realized that the simple example does not illustrate exact problem I have. In real code, <code>waitCatch</code> does not return. I try to reproduce it in simpler example and update the question."}, {"owner": {"reputation": 183, "user_id": 7387538, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207502264703363/picture?type=large", "display_name": "ttylec", "link": "https://stackoverflow.com/users/7387538/ttylec"}, "edited": false, "score": 0, "creation_date": 1508010763, "post_id": 46746232, "comment_id": 80443489, "body": "Ok, it solves my original question, not the original problem. But the latter seems to be related to <a href=\"https://github.com/gibiansky/jupyter-haskell\" rel=\"nofollow noreferrer\">jupyter library</a>. For interested, I leave a reference to <a href=\"https://github.com/gibiansky/jupyter-haskell/issues/2\" rel=\"nofollow noreferrer\">issue</a> I submitted there."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 183, "user_id": 7387538, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207502264703363/picture?type=large", "display_name": "ttylec", "link": "https://stackoverflow.com/users/7387538/ttylec"}, "edited": false, "score": 1, "creation_date": 1508013181, "post_id": 46746232, "comment_id": 80444169, "body": "Then it means that someone masked async exceptions. Check masking state: <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Exception.html#v:getMaskingState\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.0.0/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 2, "last_activity_date": 1507995195, "creation_date": 1507995195, "answer_id": 46746232, "question_id": 46745871, "link": "https://stackoverflow.com/questions/46745871/interrupting-lengthy-pure-computation-in-monadstate/46746232#46746232", "title": "Interrupting lengthy pure computation in MonadState", "body": "<p>The computation seems to be blocked on <code>putStrLn $ show r</code>, i.e. outside the <code>interruptable</code> function. Note that <code>stateFib</code> doesn't force the result, so the <code>async</code> exits almost immediately. The whole work is delayed until <code>putStrLn</code> tries to print the result. Try to force the computation earlier:</p>\n\n<pre><code>stateFib :: (MonadState St m, MonadIO m) =&gt; Integer -&gt; m Integer\nstateFib n = do\n  let f = slowFib n\n  modify $ \\st -&gt; st{x=f}\n  f `seq` return f\n</code></pre>\n"}], "owner": {"reputation": 183, "user_id": 7387538, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207502264703363/picture?type=large", "display_name": "ttylec", "link": "https://stackoverflow.com/users/7387538/ttylec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 3, "accepted_answer_id": 46746232, "answer_count": 1, "score": 6, "last_activity_date": 1507995195, "creation_date": 1507992892, "question_id": 46745871, "link": "https://stackoverflow.com/questions/46745871/interrupting-lengthy-pure-computation-in-monadstate", "title": "Interrupting lengthy pure computation in MonadState", "body": "<p>I can't grasp the correct way of interrupting lengthy pure computation on SIGINT signal. </p>\n\n<p>In the simple example below, I have <code>slowFib</code> function that simulates lengthy computation. When it is run just in <code>IO</code> monad I can terminate it with C-c (using async to spawn worker). </p>\n\n<p>However, when I put computation inside <code>MonadState, MonadIO</code> stack it no longer work... On the other hand, simple <code>threadDelay</code> in the same stack still can be terminated.</p>\n\n<p>The code is following: </p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nmodule Main where\n\nimport Data.Monoid\n\nimport Control.DeepSeq\nimport Control.Concurrent\nimport Control.Concurrent.Async\n\nimport Control.Monad.State\n-- import Control.Monad.State.Strict\n\nimport System.Posix.Signals\n\nslowFib :: Integer -&gt; Integer\nslowFib 0 = 0\nslowFib 1 = 1\nslowFib n = slowFib (n - 2 ) + slowFib (n - 1)\n\ndata St = St { x :: Integer } deriving (Show)\n\nstateFib :: (MonadState St m, MonadIO m) =&gt; Integer -&gt; m Integer\nstateFib n = do\n  let f = slowFib n\n  modify $ \\st -&gt; st{x=f}\n  return f\n\nstateWait :: (MonadState St m, MonadIO m) =&gt; Integer -&gt; m Integer\nstateWait n = do\n  liftIO $ threadDelay 5000000\n  return 41\n\ninterruptable n act = do\n  putStrLn $ \"STARTING EVALUATION: \" &lt;&gt; n\n  e &lt;- async act\n  installHandler sigINT (Catch (cancel e)) Nothing\n  putStrLn \"WAITING FOR RESULT\"\n  waitCatch e\n\nmain = do\n  let s0 = St 0\n\n  r &lt;- interruptable \"slowFib\" $ do\n    let f = slowFib 41\n    f `deepseq` return ()\n    return f\n\n  r &lt;- interruptable \"threadDelay in StateT\" $ runStateT (stateWait 41) s0\n  putStrLn $ show r\n\n  r &lt;- interruptable \"slowFib in StateT\" $ runStateT (stateFib 41) s0\n  putStrLn $ show r\n</code></pre>\n\n<p>I suspected that it has something to do with lazy evaluation. I already figured out that in the first example (with just the <code>IO</code> monad) I have to force the result. Otherwise async computation just returns a thunk.</p>\n\n<p>However all my attempts to do something analogous in MonadState failed. Anyway, it seems to be more complicated, since async thread does not return immediately. It waits until the result is computed. For some reason I just cannot terminate it when the pure computation is \"blocking\".</p>\n\n<p>Any clues?</p>\n\n<p>PS. My use case is too add ability to abort computation in custom Jupyter kernel made using <a href=\"https://hackage.haskell.org/package/jupyter-0.9.0\" rel=\"noreferrer\">jupyter</a> package. Functions evaluating user input are exactly in <code>MonadState</code> and <code>MonadIO</code>.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": true, "score": 2, "last_activity_date": 1507996980, "last_edit_date": 1507996980, "creation_date": 1507993248, "answer_id": 46745924, "question_id": 46745455, "link": "https://stackoverflow.com/questions/46745455/strange-behaviour-parsing-an-imperative-language-using-parsec/46745924#46745924", "title": "Strange behaviour parsing an imperative language using Parsec", "body": "<p>Looks for me that your parser <code>genericStatementP</code> parses <em>any</em> character until a dot appears (you are using <code>P.anyChar</code>). Hence it doesn't recognize the reserved keywords for your lexer.</p>\n\n<p>I think you must define:</p>\n\n<pre><code>type Args = [String]\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>argsP :: S.Parser [String]\nargsP = P.manyTill identifier (P.try (P.lookAhead dot))\n\ngenericStatementP :: S.Parser String\ngenericStatementP = identifier\n</code></pre>\n\n<p>With these changes I get the following result:</p>\n\n<pre><code>Right (Form \"foo\" [\"arg1\",\"arg2\",\"arg2\"] [Form \"bar\" [\"arg1\"] []])\n</code></pre>\n"}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 46745924, "answer_count": 1, "score": 3, "last_activity_date": 1507996980, "creation_date": 1507990010, "question_id": 46745455, "link": "https://stackoverflow.com/questions/46745455/strange-behaviour-parsing-an-imperative-language-using-parsec", "title": "Strange behaviour parsing an imperative language using Parsec", "body": "<p>I'm trying to parse a fragment of the Abap language with Parsec in haskell. The statements in Abap are delimited by dots. The syntax for function definition is:</p>\n\n<pre><code>FORM &lt;name&gt; &lt;arguments&gt;.\n    &lt;statements&gt;.\nENDFORM.\n</code></pre>\n\n<p>I will use it as a minimal example.\nHere is my attempt at writing the corresponding type in haskell and the parser. The <code>GenStatement</code>-Constructor is for all other statements except function definition as described above. </p>\n\n<pre><code>module Main where\n\nimport Control.Applicative\nimport Data.Functor.Identity\n\nimport qualified Text.Parsec as P\nimport qualified Text.Parsec.String as S\nimport Text.Parsec.Language\nimport qualified Text.Parsec.Token as T\n\ntype Args = String\ntype Name = String\n\ndata AbapExpr -- ABAP Program\n   = Form Name Args [AbapExpr]\n   | GenStatement String [AbapExpr]\n   deriving (Show, Read)\n\nlexer :: T.TokenParser ()\nlexer = T.makeTokenParser style\n  where\n    caseSensitive = False\n    keys = [\"form\", \"endform\"]\n    style = emptyDef\n        { T.reservedNames = keys\n        , T.identStart = P.alphaNum &lt;|&gt; P.char '_'\n        , T.identLetter = P.alphaNum &lt;|&gt; P.char '_'\n        }\n\ndot :: S.Parser String\ndot = T.dot lexer\n\nreserved :: String -&gt; S.Parser ()\nreserved = T.reserved lexer\n\nidentifier :: S.Parser String\nidentifier = T.identifier lexer\n\nargsP :: S.Parser String\nargsP = P.manyTill P.anyChar (P.try (P.lookAhead dot))\n\ngenericStatementP :: S.Parser String\ngenericStatementP = P.manyTill P.anyChar (P.try dot)\n\nabapExprP = P.try (P.between (reserved \"form\")\n                             (reserved \"endform\" &gt;&gt; dot)\n                             abapFormP)\n    &lt;|&gt; abapStmtP\n  where\n    abapFormP = Form &lt;$&gt; identifier &lt;*&gt; argsP &lt;* dot &lt;*&gt; many abapExprP\n    abapStmtP = GenStatement &lt;$&gt; genericStatementP &lt;*&gt; many abapExprP\n</code></pre>\n\n<p>Testing the parser with the following input results in a strange behaviour.</p>\n\n<pre><code>-- a wrapper for convenience\nparse :: S.Parser a -&gt; String -&gt; Either P.ParseError a\nparse = flip P.parse \"Test\"\n\ntestParse1 = parse abapExprP \"form foo arg1 arg2 arg2. form bar arg1. endform. endform.\"\n</code></pre>\n\n<p>results in</p>\n\n<pre><code>Right (GenStatement \"form foo arg1 arg2 arg2\" [GenStatement \"form bar arg1\" [GenStatement \"endform\" [GenStatement \"endform\" []]]])\n</code></pre>\n\n<p>so it seems the first brach always fails and only the second generic branch is successful. However if the second branch (parsing generic statements) is commented parsing forms suddenly succeeds:</p>\n\n<pre><code>abapExprP = P.try (P.between (reserved \"form\")\n                             (reserved \"endform\" &gt;&gt; dot)\n                             abapFormP)\n    --    &lt;|&gt; abapStmtP\n  where\n    abapFormP = Form &lt;$&gt; identifier &lt;*&gt; argsP &lt;* dot &lt;*&gt; many abapExprP\n    -- abapStmtP = GenStatement &lt;$&gt; genericStatementP &lt;*&gt; many abapExprP\n</code></pre>\n\n<p>Now we get</p>\n\n<pre><code> Right (Form \"foo\" \"arg1 arg2 arg2\" [Form \"bar\" \"arg1\" []])\n</code></pre>\n\n<p>How is this possible? It seems that the first branch succeeds so why doesn't it work in the first example - what am I missing?</p>\n\n<p>Many thanks in advance!</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "edited": false, "score": 0, "creation_date": 1527757310, "post_id": 46758950, "comment_id": 88250643, "body": "Doesn&#39;t seem to be working for me: &quot;Module \u2018Turtle\u2019 does not export \u2018shellStrictWithErr\u2019&quot;. Any ideas?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "edited": false, "score": 0, "creation_date": 1527769005, "post_id": 46758950, "comment_id": 88257985, "body": "Perhaps a older / newer version of Turtle?"}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 1, "last_activity_date": 1508094659, "creation_date": 1508094659, "answer_id": 46758950, "question_id": 46745290, "link": "https://stackoverflow.com/questions/46745290/how-can-i-capture-stdout-and-stderr-output-from-a-process-with-haskell-turtle/46758950#46758950", "title": "How can I capture stdout and stderr output from a process with Haskell turtle?", "body": "<p>This is possible with <a href=\"https://hackage.haskell.org/package/turtle-1.4.4/docs/Turtle-Prelude.html#v:shellStrictWithErr\" rel=\"nofollow noreferrer\">shellStrictWithErr</a>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Turtle (empty, shellStrictWithErr, ExitCode)\nimport Data.Text (Text)\n\nrunSh :: Text -&gt; IO (ExitCode, Text, Text)\nrunSh x' = shellStrictWithErr x' empty\n\nmain :: IO ()\nmain = do\n  (e, v, v') &lt;- runSh \"ls\"\n  print e\n  print v\n  print v'\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "accepted_answer_id": 46758950, "answer_count": 1, "score": 1, "last_activity_date": 1583912862, "creation_date": 1507988944, "last_edit_date": 1583912862, "question_id": 46745290, "link": "https://stackoverflow.com/questions/46745290/how-can-i-capture-stdout-and-stderr-output-from-a-process-with-haskell-turtle", "title": "How can I capture stdout and stderr output from a process with Haskell turtle?", "body": "<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Turtle\n\nrunSh :: Text -&gt; IO ()\nrunSh x = view $ inshell x empty\n\nmain :: IO ()\nmain = do\n  runSh \"echo 'abcxyz'\"\n</code></pre>\n\n<p>I've got the above program which outputs:</p>\n\n<pre><code>Line \"abcxyz\"\n</code></pre>\n\n<p>Is there a way I can capture this text without being output to the shell's stdout?</p>\n\n<p>Essentially, I'd like to run the process and get a <code>[Line]</code> value rather then a <code>()</code> value from the <code>IO</code> action.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1507989859, "post_id": 46745033, "comment_id": 80436794, "body": "<a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.Word.html#line-157\" rel=\"nofollow noreferrer\">Here</a> you have the implementation of  <code>Word8</code> type. Just make a new type <code>Word4</code> with modified instances for 4 bits."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1507990031, "post_id": 46745033, "comment_id": 80436839, "body": "I do not really get why you want to implement a <code>Word4</code>. A computer has a &quot;word size&quot;: the number of bits that are stored in the same &quot;row&quot; in memory. Anything smaller can only be fetched by fetching the full row, and then masking some bits. Usually it is not a good idea to work with smaller items, since it only introduces more overhead: masking away the noise surrounding it. You can implement a <code>Word4</code> to make the masking transparent (and to boost efficiency of some operations). But <code>Word4</code> thus will probably be less efficient than <code>Word8</code>."}, {"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1507995548, "post_id": 46745033, "comment_id": 80438636, "body": "@WillemVanOnsem, Mainly because the program I&#39;m making works with 4 bit units at some points so I would like a data type for it."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 1, "last_activity_date": 1507993070, "creation_date": 1507993070, "answer_id": 46745899, "question_id": 46745033, "link": "https://stackoverflow.com/questions/46745033/is-it-possible-to-make-custom-wordn-integers/46745899#46745899", "title": "Is it possible to make custom WordN integers?", "body": "<p><a href=\"https://hackage.haskell.org/package/sbv\" rel=\"nofollow noreferrer\">SBV</a> package has an example for it: <a href=\"https://hackage.haskell.org/package/sbv-7.3/docs/src/Data.SBV.Examples.Misc.Word4.html\" rel=\"nofollow noreferrer\">Data.SBV.Examples.Misc.Word4</a>.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507993070, "creation_date": 1507987224, "question_id": 46745033, "link": "https://stackoverflow.com/questions/46745033/is-it-possible-to-make-custom-wordn-integers", "title": "Is it possible to make custom WordN integers?", "body": "<p>In the <code>Data.Word</code> module, it provides types like Word8, Word16, etc. </p>\n\n<p>Is there a way to implement my own Word type, such as Word4 (efficiently)?</p>\n"}, {"tags": ["pointers", "haskell", "null", "bytestring"], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 4, "last_activity_date": 1507980526, "creation_date": 1507980526, "answer_id": 46744014, "question_id": 46743945, "link": "https://stackoverflow.com/questions/46743945/how-to-create-a-ptr-word8-for-bytestring/46744014#46744014", "title": "How to create a Ptr Word8 for ByteString", "body": "<p>No, <code>create</code> gives you a pointer to a memory to fill:</p>\n\n<pre><code>create :: Int -&gt; (Ptr Word8 -&gt; IO ()) -&gt; IO ByteString\n</code></pre>\n\n<p>The first argument is the length of bytestring to create, the second is a function, that fills the bytestring. Basically <code>create</code> allocates memory buffer of the specified size, then calls the function with the pointer to the buffer. Usage example:</p>\n\n<pre><code>&gt; create 5 $ \\ptr -&gt; pokeArray ptr [65, 66, 67, 68, 69]\n\"ABCDE\"\n</code></pre>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 46744014, "answer_count": 1, "score": 1, "last_activity_date": 1507980526, "creation_date": 1507980066, "question_id": 46743945, "link": "https://stackoverflow.com/questions/46743945/how-to-create-a-ptr-word8-for-bytestring", "title": "How to create a Ptr Word8 for ByteString", "body": "<p><a href=\"https://github.com/haskell/bytestring/blob/master/Data/ByteString/Internal.hs#L39\" rel=\"nofollow noreferrer\">create</a>, from Data.ByteString.Internal, states that it needs a <code>Ptr Word8</code> in order to create a ByteString. I'm guessing this is like a reference to the head of the bytestring or something. However, I'm not sure what I should use to create a new pointer - I'm fairly sure it's not done properly with <a href=\"https://www.stackage.org/haddock/lts-9.6/base-4.9.1.0/Foreign-Ptr.html#v:nullPtr\" rel=\"nofollow noreferrer\">nullPtr</a>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507977448, "post_id": 46743523, "comment_id": 80433152, "body": "<code>h:(head ts)</code> does not make much sense, since both <code>h</code> and <code>head ts</code> are elements of the list."}, {"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507977827, "post_id": 46743523, "comment_id": 80433254, "body": "but it shouldnt work?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507977914, "post_id": 46743523, "comment_id": 80433280, "body": "Well <code>(:)</code> expects a head <code>a</code> and a tail <code>[a]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 1, "creation_date": 1507978229, "post_id": 46743604, "comment_id": 80433377, "body": "thx very much, i keep forgetting that : asks for a head and a tail"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1507978233, "last_edit_date": 1507978233, "creation_date": 1507977880, "answer_id": 46743604, "question_id": 46743523, "link": "https://stackoverflow.com/questions/46743523/why-it-shows-this-error-couldnt-match-expected-type-a-with-actual-type-a/46743604#46743604", "title": "why it shows this error: Couldn&#39;t match expected type `[a]&#39; with actual type `a&#39;?", "body": "<p>You write:</p>\n\n<pre><code>h:(head ts)\n</code></pre>\n\n<p>Now the \"cons\" <code>(:) :: a -&gt; [a] -&gt; [a]</code> takes an element (the \"head\"), and a list of elements (the \"tail\") and creates a list that starts with the head followed by the tail. But since <code>h</code> is an element of the list, and <code>head ts</code> is an element of the same list, they both have type <code>a</code>.</p>\n\n<p>In case you want to construct a 2-item list, you can use:</p>\n\n<pre><code>[h, head ts]\n</code></pre>\n\n<p>instead. But that being said, this code is not correct and quite unsafe, because:</p>\n\n<ul>\n<li>it is not guaranteed that <code>ts</code> has a head: it can be the empty list <code>[]</code>;</li>\n<li>it is possible that there are three equal elements in the list.</li>\n</ul>\n\n<p>A fix to solve the above issues is:</p>\n\n<pre><code>agrupa :: Eq a =&gt; [a] -&gt; [[a]]\nagrupa [] = []\nagrupa [x] = [[x]]\nagrupa (x1:xs@(x2:_)) | x1 == x2 = (x1:y1) : yt\n                      | otherwise = [x1] : ys\n                      where ys@(y1:yt) = agrupa xs\n</code></pre>\n\n<p>The code works as follows: the first two cases are trivial: if we group an empty list, we obtain an empty list, and if we group a single element, we get a group with that single element.</p>\n\n<p>The recursive cases is more complex. Here we inspect the first two items of the list <code>x1</code> and <code>x2</code>. In case the two are not equal (second guard), we thus construct a singleton group <code>[x1]</code> followed by grouping the rest of the list <code>agrupa xs</code>.</p>\n\n<p>In case the two elements <em>are</em> equal, we again first perform recursion on the remaining of the list <code>(y1:yt) = agrupa xs</code> we know however that the first group <code>y1</code>, is the same group to which the <code>x1</code> value belongs, since otherwise <code>x1</code> should not be equal to <code>x2</code>. So we modify the first group by prepending <code>x1</code> to it. Returning <code>(x1:y1) : yt</code>.</p>\n\n<p>This function produces:</p>\n\n<pre><code>*Main&gt; agrupa [1,1,2,1,1,4,4,4,5]\n[[1,1],[2],[1,1],[4,4,4],[5]]\n</code></pre>\n\n<p>This function can however still be improved, but I leave this as an exercise.</p>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 46743604, "answer_count": 1, "score": 1, "last_activity_date": 1507978233, "creation_date": 1507977363, "question_id": 46743523, "link": "https://stackoverflow.com/questions/46743523/why-it-shows-this-error-couldnt-match-expected-type-a-with-actual-type-a", "title": "why it shows this error: Couldn&#39;t match expected type `[a]&#39; with actual type `a&#39;?", "body": "<pre><code> agrupa::Eq a =&gt; [a] -&gt; [[a]]\n\n agrupa [] = []\n agrupa (h:ts) =    if h== (head ts) then [[h:(head ts)]]\n                    else []\n</code></pre>\n\n<hr>\n\n<p>Error:   </p>\n\n<hr>\n\n<p>it says * Couldn't match expected type <code>[a]' with actual type</code>a' in head ts</p>\n\n<p>what i dont get is that he is assuming head ts is [[a]] when its not , [h:(head ts ) ] = [a] </p>\n\n<pre><code>    7 |  if h== (head ts) then [[h:(head ts)]]\n</code></pre>\n\n<hr>\n\n<p>Note:\nIgnore the else , just putted there [] to have something there</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507941103, "post_id": 46739312, "comment_id": 80426088, "body": "Why not use <code>compare</code> rather than a custom <code>intCMP</code>?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507955009, "post_id": 46739312, "comment_id": 80428108, "body": "You don&#39;t need to use <code>cmp</code>, you could just write <code>if a &lt; b then</code>"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 7066862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1d70972b971aef9aab1a5351bbeb7a75?s=128&d=identicon&r=PG&f=1", "display_name": "David Andvett", "link": "https://stackoverflow.com/users/7066862/david-andvett"}, "edited": false, "score": 0, "creation_date": 1507938396, "post_id": 46739370, "comment_id": 80425604, "body": "I&#39;ve been staring at this for 2 hours, thanks for the catch"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 4, "last_activity_date": 1507938302, "creation_date": 1507938302, "answer_id": 46739370, "question_id": 46739312, "link": "https://stackoverflow.com/questions/46739312/how-to-sort-3-items-in-a-list-in-haskell/46739370#46739370", "title": "How to sort 3 items in a list in Haskell?", "body": "<p>What you thought was your last clause is actually a new function named <code>sort</code> (rather than <code>sort3</code>). Turning on <code>-Wall</code> will help you notice this kind of error.</p>\n"}], "owner": {"reputation": 123, "user_id": 7066862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1d70972b971aef9aab1a5351bbeb7a75?s=128&d=identicon&r=PG&f=1", "display_name": "David Andvett", "link": "https://stackoverflow.com/users/7066862/david-andvett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507938302, "creation_date": 1507937752, "question_id": 46739312, "link": "https://stackoverflow.com/questions/46739312/how-to-sort-3-items-in-a-list-in-haskell", "title": "How to sort 3 items in a list in Haskell?", "body": "<p>I'm trying to make a sort function that sorts a list of 3 or less elements, but pattern matching is confusing me.</p>\n\n<pre><code>intCMP :: Int -&gt; Int -&gt; Ordering\nintCMP a b | a == b =EQ\n           | a &lt; b = LT\n           | otherwise = GT\n\n sort3 :: Ord a =&gt; (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n sort3 _ [] = []\n sort3 _ [a] = [a]\n sort3 cmp [a,b] = if cmp a b == LT then\n                    [a,b]\n                   else\n                   [b,a]\n sort cmp [a,b,c] = [a,b,c]\n</code></pre>\n\n<p>but i keep getting this error</p>\n\n<p>*Main> sort3 intCMP [1,1,1]</p>\n\n<p>*** Exception: fun.hs:(7,1)-(12,23): Non-exhaustive patterns in function sort3</p>\n"}, {"tags": ["haskell", "types", "ghc", "existential-type"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1507948969, "post_id": 46738728, "comment_id": 80427242, "body": "All of your <code>Proxy</code> based woes are avoidable via <code>TypeApplication</code>. You <i>can</i> extract elements of a tuple of types: use equality constraints: <code>v ~ (t1, t2, t3, t4)</code>. Backpack and existential types don&#39;t make any sense here. This question would be a bit clearer if you added an example of your types with many type variables and how you are using them. I reckon there is probably something off - 9 type variable types are not exactly common... In fact, that post by Oleg is the only such real life example I&#39;ve seen."}, {"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507964496, "post_id": 46738728, "comment_id": 80429891, "body": "I&#39;ll need to get GHC 8.0 working on my computer to test this, but it looks like you still need to write down 5 variables to extract a component of a 4-tuple, meaning there&#39;s no abstraction over the number of variables needed, which defeats the point of using a tuple. Why doesn&#39;t Backpack make sense here? To me it seems like the most promising approach so far. Anyway, I&#39;ve added several pargraphs explaining why I care about this problem."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1507967556, "post_id": 46738728, "comment_id": 80430618, "body": "Perhaps the Trees that Grow approach could help: <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/trees-that-grow.pdf\" rel=\"nofollow noreferrer\">microsoft.com/en-us/research/wp-content/uploads/2016/11/&hellip;</a>"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1507967696, "post_id": 46738728, "comment_id": 80430654, "body": "Just put your type variables in a record. If you\u2019re unsure how, I can make an answer with an example."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507969980, "post_id": 46738728, "comment_id": 80431195, "body": "After your edit: (1) and (2) ought both add a type variable (for (2), I recommend you wrap recursive ASTs with an <code>m</code> type constructor over which your parametrize. Then, you can let <code>m ~ IORef</code> to make everything mutable, or <code>m ~ Identity</code> to keep it immutable), but (3) sounds like it might be better solved otherwise (without type variables). I might take a look tomorrow. In any case, it still sounds like you should list out your type variables manually."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1507982695, "post_id": 46738728, "comment_id": 80434704, "body": "I don&#39;t understand the objections you make to the first two solutions. In practice functions will take some <code>AST v</code> and that&#39;s how <code>v</code> will be inferred. +1 for trees that grow."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1507986593, "post_id": 46738728, "comment_id": 80435822, "body": "@augustss I would like to know about the record solution."}, {"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "edited": false, "score": 0, "creation_date": 1507990675, "post_id": 46738728, "comment_id": 80437047, "body": "I also want to see the record solution. I had Googled around for type records in Haskell and tried some things, but had been left with the impression that GHC doesn&#39;t support type-level records."}, {"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1507998554, "post_id": 46738728, "comment_id": 80439604, "body": "@Li-yaoXia: The short version is: The type inference doesn&#39;t work."}, {"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507998669, "post_id": 46738728, "comment_id": 80439632, "body": "@Alec: Does explicit type application help when you have a type class where not every method mentions every type variable? I can&#39;t find anything on this. If that&#39;s not the case, then no, explicit type applications don&#39;t solve all my Proxy woes."}], "answers": [{"comments": [{"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "edited": false, "score": 1, "creation_date": 1508011952, "post_id": 46744953, "comment_id": 80443820, "body": "Thank you, danidiaz. Both this and augustss&#39;s answers have a similar flavor. They look appealing, but we know all kinds of problems crop up when trying to do higher-order type-level programming. I&#39;ll report back once I&#39;ve tried them."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1507991283, "last_edit_date": 1507991283, "creation_date": 1507986552, "answer_id": 46744953, "question_id": 46738728, "link": "https://stackoverflow.com/questions/46738728/preventing-type-variable-proliferation-in-haskell/46744953#46744953", "title": "Preventing type-variable proliferation in Haskell", "body": "<p>This answer was inspired by the <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/trees-that-grow.pdf\" rel=\"nofollow noreferrer\">Trees That Grow</a> paper. It assumes that there exist only a limited number of \"variants\" of the data type, that only a small subset of all possible instantiations of <strong>N</strong> parameters are used.</p>\n\n<pre><code>{-# language DataKinds #-}\n{-# language TypeFamilies #-}\n{-# language KindSignatures #-}\n{-# language PolyKinds #-}\n{-# language FlexibleContexts #-}\n</code></pre>\n\n<p>We define our data type like this </p>\n\n<pre><code>data MyType (v::Variant) = MyType (Xa v) (Xb v) (Xc v) Int\n\ndata Variant = V1 | V2\n\ntype family Xa (v::Variant) :: * where\n    Xa V1 = Int\n    Xa V2 = Bool\n\ntype family Xb (v::Variant) :: * where\n    Xb V1 = Bool\n    Xb V2 = Char\n\ntype family Xc (v::Variant) :: * where\n    Xc V1 = String\n    Xc V2 = Maybe Int\n</code></pre>\n\n<p>There are two \"variants\" of the data type. Each changing field has its own (admittedly boilerplatery) type family which maps a variant to the actual type of the field in that variant.</p>\n\n<p>Here's a simple function which works for all variants of the data type:</p>\n\n<pre><code>getInt :: MyType (v :: Variant) -&gt; Int\ngetInt (MyType _ _ _ i) = i\n</code></pre>\n\n<p>With <code>-XConstraintKinds</code> we can define a constraint shared by all fields:</p>\n\n<pre><code>{-# language ConstraintKinds #-}\nimport GHC.Exts (Constraint)\ntype MyForAll (p :: * -&gt; Constraint) (v::Variant) = (p (Xa v),p (Xb v),p (Xc v))\n</code></pre>\n\n<p>We can use it to define functions like</p>\n\n<pre><code>myShow :: MyForAll Show (v :: Variant) =&gt; MyType v -&gt; String\nmyShow (MyType a b c i) = show a ++ show b ++ show c ++ show i\n</code></pre>\n\n<p>We can also enable <code>-XTypeApplications</code> to specify the variant:</p>\n\n<pre><code>\u03bb :t MyType\nMyType :: forall {v :: Variant}. Xa v -&gt; Xb v -&gt; Xc v -&gt; Int -&gt; MyType v\n\u03bb :set -XTypeApplications\n\u03bb :t MyType @V1\nMyType @V1 :: Int -&gt; Bool -&gt; String -&gt; Int -&gt; MyType 'V1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "edited": false, "score": 1, "creation_date": 1508011937, "post_id": 46748050, "comment_id": 80443816, "body": "Thank you, augustss. Both this and dandiaz&#39;s answers have a similar flavor. They look appealing, but we know all kinds of problems crop up when trying to do higher-order type-level programming. I&#39;ll report back once I&#39;ve tried them."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1508013645, "post_id": 46748050, "comment_id": 80444294, "body": "Relative to my answer, in this approach it&#39;s easier to write functions that change a type independently of the others."}], "tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": false, "score": 2, "last_activity_date": 1508006249, "creation_date": 1508006249, "answer_id": 46748050, "question_id": 46738728, "link": "https://stackoverflow.com/questions/46738728/preventing-type-variable-proliferation-in-haskell/46748050#46748050", "title": "Preventing type-variable proliferation in Haskell", "body": "<p>If you want to group a number of type variables together you can do that.\nOn the value level you would just use a record, and you can do that on the type level too.  Create a record type, and then the lifted version of that can be used to group types.  Record access gets a bit clunky since the value level record selector syntax does not lift.</p>\n\n<p>Here's an example that should clarify what I mean.</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving, TypeInType, UndecidableInstances #-}\nmodule RecordTyVars where\nimport Data.Kind\n\n-- The normal way, with 3 type variables.\ndata OExpr sym lit op = OVar sym | OLit lit | OPrimOp op [OExpr sym lit op]\n     deriving (Show)\n\noe :: OExpr String Integer Op\noe = OPrimOp Add [OVar \"x\", OLit 1]\n\ndata Op = Add | Sub\n     deriving (Show)\n\n--------\n\n-- Record that when lifted will contain the types.\ndata ExprTypes = Types Type Type Type\n\n-- Record access functions, since the record syntax doesn't lift.\ntype family SymType (r :: ExprTypes) :: * where\n    SymType ('Types sym lit op) = sym\ntype family LitType (r :: ExprTypes) :: * where\n    LitType ('Types sym lit op) = lit\ntype family OpType (r :: ExprTypes) :: * where\n    OpType  ('Types sym lit op) = op\n\n-- Using the record of types\ndata Expr r = Var (SymType r) | Lit (LitType r) | PrimOp (OpType r) [Expr r]\n\n-- Must use standalone deriving when thing the going gets tough.\nderiving instance (Show (SymType r), Show (LitType r), Show (OpType r)) =&gt;\n                  Show (Expr r)\n\ne :: Expr ('Types String Integer Op)\ne = PrimOp Add [Var \"x\", Lit 1]\n</code></pre>\n"}], "owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1508006249, "creation_date": 1507932988, "last_edit_date": 1507998718, "question_id": 46738728, "link": "https://stackoverflow.com/questions/46738728/preventing-type-variable-proliferation-in-haskell", "title": "Preventing type-variable proliferation in Haskell", "body": "<p>Parameterizing out type variables is nice, but it doesn't scale. As an example of what can happen, <a href=\"http://oleg.fi/gists/posts/2017-04-26-indexed-poptics.html\" rel=\"nofollow noreferrer\">http://oleg.fi/gists/posts/2017-04-26-indexed-poptics.html</a> gives an abstraction containing 9 type variables. I have been working on a framework for program transformations which are parameterized by the programming language, and could quite conceivable have dozens or hundreds of parameters in the future.</p>\n\n<p>So here's the basic question: <strong>I have a datatype T which is parameterized over N types. How can I write a function over T, without writing down N type variables every time I use it?</strong></p>\n\n<p>Here are some approaches I've looked at, none of which are satisfiable:</p>\n\n<p><strong>Parameterize over type variables of kind <code>* -&gt; *</code></strong></p>\n\n<pre><code>data V = Var1 | Var2 | Var3 | Var4\n\nmyfunc :: forall (v :: V -&gt; *). Constraints v =&gt; v Var1 -&gt; v Var2\nmyfunc = ...\n</code></pre>\n\n<p>So, now, instead of parameterizing over 4 type variables <code>Var1, Var2, Var3, Var4</code>, I need only parameterize over one type variable of kind <code>V -&gt; *</code>.</p>\n\n<p>This works, except that, in this example, <code>myfunc</code> can't be called because <code>v</code> can't be inferred. You would need to change it to <code>Proxy v -&gt; v Var1 -&gt; v Var2</code>. And then, every time you want to use <code>myfunc</code> with difference variables, you would need to define a separate GADT, with its own boilerplate. Something like this:</p>\n\n<pre><code>data MyV a where\n  MyVar1 :: Int -&gt; MyV Var1\n  MyVar2 :: String -&gt; MyV Var2\n  MyVar3 :: Bool -&gt; MyV Var3\n  MyVar4 :: [Int] -&gt; MyV Var4\n</code></pre>\n\n<p>Needless to say, this is very unsatisfying.</p>\n\n<p>This approach is exactly the one taken by the multi-sorted parts of the <a href=\"https://hackage.haskell.org/package/compdata\" rel=\"nofollow noreferrer\">compdata library</a>. It's quite nice there, because this boilerplate lines up exactly with the normal datatype you'd be writing anyway. </p>\n\n<p><strong>Parameterize over type variable of kind <code>(*,*,*,...)</code> or a record kind</strong></p>\n\n<pre><code>{-# LANGUAGE TypeInType #-}\nimport Data.Kind\n\ntype Vars = (*,*,*,*)\n\nmyfunc :: forall (v :: Vars). ...\nmyfunc = ...\n</code></pre>\n\n<p>This doesn't work, because, as far as I can tell, there's no way to destruct a type variable <code>v</code> of kind <code>(*,*,*,*)</code> . I can create an instance <code>(Int, String, Bool, [Int])</code>, but I can't actually extract the components Int, String, etc. The best I can do is write a type family:</p>\n\n<pre><code>type family Fst (v :: Vars) where\n  Fst '(a,b,c,d) = a\ntype family Snd ....\n\nmyfunc :: forall (v :: Vars). Fst Vars -&gt; Snd Vars\n</code></pre>\n\n<p>However, this has the same problem as the previous solution: it can't infer <code>v</code> unless you pass in a <code>Proxy v</code> separately. I also tried adding a constraint <code>type Extensional v = (v ~ '(Fst v, Snd v, Third v, Fourth v))</code>, but it didn't help.</p>\n\n<p><strong>Using existentially-quantified variables</strong></p>\n\n<pre><code>data HasFourTypeVariables a b c d = ....\ndata IOnlyCareAboutTwo a b = forall c d. IOnlyCareAboutTwo (HasFourTypeVariables a b c d)\n</code></pre>\n\n<p>This doesn't work. Here's what it looks like when you tried to use it:</p>\n\n<pre><code>update :: IOnlyCareAboutTwo a b -&gt; IOnlyCareAboutTwo a b\nupdate = ...\n\nuseUpdate :: HasFourTypeVariables a b c d -&gt; HasFourTypeVariables a b c d\nuseUpdate x = case update (IOnlyCareAboutTwo x) of\n                IOnlyCareAboutTwo y -&gt; y\n</code></pre>\n\n<p>This doesn't typecheck, because the typechecker doesn't know that the input and output of <code>update</code> have the same existential witnesses.</p>\n\n<p><strong>Use Backpack</strong></p>\n\n<p>Backpack looks like the best contender so far. Depending on a module signature with 5 types and associated operations/constraints is kinda like having 5 universally-quantified constrained type variables in every operation, except you don't need to write them down.</p>\n\n<p>Backpack is still fairly new, and not yet integrated with Stack; I don't yet have any experience with it. Also, it seems to be built for parameterizing over entire packages rather than smaller units of functionality; I'm under the impression that it has poor support for the kind of explicit instantiation that would be required here.</p>\n\n<p><strong>Have a long list of type variables, and put up with it</strong></p>\n\n<p>Solution I'm considering doing. :(</p>\n\n<hr>\n\n<p><strong>Some Background</strong></p>\n\n<p>This problem is threatening to arise in my work on multi-language program transformation, extending <a href=\"https://arxiv.org/pdf/1707.04600.pdf\" rel=\"nofollow noreferrer\">https://arxiv.org/pdf/1707.04600.pdf</a> .</p>\n\n<p>In my system, a term in a programming language has a type <code>Term f l</code>, where <code>f</code> is a signature for a programming language (of kind <code>(*-&gt;*)-&gt;(*-&gt;*)</code> -- see <a href=\"https://pdfs.semanticscholar.org/4c78/1b880cdda553301777bad192d2e6928e957a.pdf\" rel=\"nofollow noreferrer\">the CDTs paper</a> for explanation), and <code>l</code> is a sort. So, a statement in C may have type <code>Term CSig StmtL</code>, while a Java expression may have type <code>Term Java ExpL</code>.</p>\n\n<p>So far, this is just two type variables. But, as I push the system into more generality and the ability to abstract over deeper and deeper semantic properties, the number of type variables may explode. Here are some examples of how:</p>\n\n<ol>\n<li><p>I want to store annotations on AST nodes. Some, like a node label and its source origin, are decent ideas to have on every tree, but others, like symbol resolution, or mark of whether that subtree has been modified, are desirable in some trees but not others. I'd hence like my representations to be able to flexibly add annotations in some representations but not others, and to be able to write operators that only care whether a subset of these annotations are present. How to do this? One or many type variables for annotations, along with a lot of \"HasSymbolResolutionAnnotation a\" constraints.</p></li>\n<li><p>After a lot of experience, and many hours of reflection, I've decided that mutable ASTs are actually a pretty good idea. I'd then like to be able to write operators that can work on both pure and mutable ASTs. I haven't yet figured out how best to do this, but you can bet it will add at least one type variable to my type.</p></li>\n<li><p>Within that <code>CSig</code> or <code>JavaSig</code> signature, there may be many language-generic nodes, like \"Add.\" For many simple analyses and transformations, it's enough just to say \"this language has addition\" and stick in a generic Add node. But for more complicated ones, it may matter whether addition in your language can overflow and how, whether the (+) operator is a primitive or can be overridden like in C++ or Haskell, and what constraints it places on the surrounding types. Now, instead of an \"Add\" node, your language may have an <code>Add MonomorphicAddition NonOverridable OverflowWrapsToNegative</code> node, and your analysis-of-signs defines transfer functions for languages with an <code>Add a b OverflowWrapsToNegative</code> node. There is no limit on the number of variations of an operator you can encode like this. And as long as there are many useful things you can say about such a parameterized operator that only reference a couple of its parameters, it will be desirable to treat them this way.</p></li>\n</ol>\n\n<p>I hope this helps explain why this is a problem.</p>\n"}, {"tags": ["haskell", "monads", "purescript", "state-monad", "reader-monad"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1507930603, "post_id": 46738184, "comment_id": 80423602, "body": "<code>Reader a b</code> is a wrapper around <code>a -&gt; b</code>. So, <code>ask :: forall a. Reader a a</code> is ultimately just a value of type <code>forall a. a -&gt; a</code>, with a wrapper around it."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1507931077, "post_id": 46738360, "comment_id": 80423760, "body": "Upvoted. Probably worth nothing that the way to summon such an <code>r -&gt; r</code> function from thin air is to utter the incantation <code>id</code>. (And <code>id</code> is the <i>only</i> such function, thanks to parametricity.)"}, {"owner": {"reputation": 10749, "user_id": 294657, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bf6a123b877d32265e37c0fb592d5965?s=128&d=identicon&r=PG", "display_name": "kaqqao", "link": "https://stackoverflow.com/users/294657/kaqqao"}, "edited": false, "score": 0, "creation_date": 1507931187, "post_id": 46738360, "comment_id": 80423797, "body": "Ok, so in my case the Reader is a wrapper around Permissions -&gt; Maybe User. When I run <code>runReader createUser permissions</code>, how does <code>ask</code> in the body of <code>createUser</code> know to return the same <code>permissions</code> I passed to <code>runReader</code>? I&#39;m sure the question is downright nonsensical as I&#39;m looking at this all wrong... But please try helping me unbend my brain."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 10749, "user_id": 294657, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bf6a123b877d32265e37c0fb592d5965?s=128&d=identicon&r=PG", "display_name": "kaqqao", "link": "https://stackoverflow.com/users/294657/kaqqao"}, "edited": false, "score": 1, "creation_date": 1507931505, "post_id": 46738360, "comment_id": 80423931, "body": "@kaqqao The type <code>Reader Permissions (Maybe User)</code> is just a &#39;wrapper&#39; over <code>Permissions -&gt; (Maybe User)</code>, so your entire <code>createUser</code> &#39;value&#39; is really a function (but functions are values, so that&#39;s cool). When you call <code>runReader</code>, you must pass not only <code>createUser</code>, but also a value for <code>r</code> - in this case a <code>Permissions</code> value. <code>runReader</code> then calls the wrapped function with the <code>Permissions</code> value you passed it. HTH."}, {"owner": {"reputation": 10749, "user_id": 294657, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bf6a123b877d32265e37c0fb592d5965?s=128&d=identicon&r=PG", "display_name": "kaqqao", "link": "https://stackoverflow.com/users/294657/kaqqao"}, "edited": false, "score": 0, "creation_date": 1507936967, "post_id": 46738360, "comment_id": 80425320, "body": "@MarkSeemann Aah, I see. <code>runReader</code> effectively sets the state/environment on the Reader instance before invoking the function inside it. (Not sure how good is my terminology) It finally makes sense. Thanks a bunch!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1508067742, "post_id": 46738360, "comment_id": 80454781, "body": "Why should someone disguise the information flow within a composition of pure functions with the monad machinery? Only to abstract from some arguments? Isn&#39;t that too high a price?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1508069483, "post_id": 46738360, "comment_id": 80455194, "body": "@ftor I don&#39;t think the point of the <code>Reader</code> monad is to <i>disguise</i> anything. The <code>Reader</code> monad exists, mathematically, so it might as well also exist in the Haskell/TypeScript API. This enables you to use a reader (i.e. a pure function) with all functions that operate on monads. (e.g. <code>mapM</code>, <code>sequence</code>, and so on...). The motivation isn&#39;t to hide anything, but to give you <i>options</i> for composition."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 13, "last_activity_date": 1507930675, "creation_date": 1507930675, "answer_id": 46738360, "question_id": 46738184, "link": "https://stackoverflow.com/questions/46738184/understanding-the-reader-monad/46738360#46738360", "title": "Understanding the Reader monad", "body": "<p>I don't have a PureScript environment around currently, so I'll try to answer from a Haskell perspective, and hope it helps.</p>\n\n<p>A <em>Reader</em> is really only a 'wrapper' around a function, so when you get a <code>Reader r r</code>, you really only get a reader from <code>r</code> to <code>r</code>; in other words, a function <code>r -&gt; r</code>.</p>\n\n<p>You <em>can</em> summon functions out of thin air, because, if you're a Platonist, I suppose they always exist...</p>\n\n<p>When you use <code>do</code> notation, you're 'inside the monad', so the context <code>r</code> is implicit. In other words, you call a function that returns the <code>r</code> value, and when you use the <code>&lt;-</code> arrow, you simply get that context.</p>\n"}, {"tags": [], "owner": {"reputation": 931, "user_id": 2631185, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75f07727c65d676aa81eeb97b794cfa7?s=128&d=identicon&r=PG", "display_name": "Regis Kuckaertz", "link": "https://stackoverflow.com/users/2631185/regis-kuckaertz"}, "is_accepted": false, "score": 3, "last_activity_date": 1519468974, "creation_date": 1519468974, "answer_id": 48961912, "question_id": 46738184, "link": "https://stackoverflow.com/questions/46738184/understanding-the-reader-monad/48961912#48961912", "title": "Understanding the Reader monad", "body": "<p>You can convince yourself that it works by performing a few substitutions. First look at the signature of <code>createUser</code>. Let's \"unroll\" the definition of <code>Reader</code>:</p>\n\n<pre><code>createUser :: Reader Permissions (Maybe User)\n{- definition of Reader -}\ncreateUser :: ReaderT Permissions Identity (Maybe User)\n</code></pre>\n\n<p>The <code>ReaderT</code> type only has one data constructor: <code>ReaderT (r -&gt; m a)</code>, which means <code>createUser</code> is a term that evaluates to a value of type <code>ReaderT (Permissions -&gt; Identity (Maybe User))</code>. As you can see, it is just a function tagged with <code>ReaderT</code>. It does not have to create anything out of thin air, but will receive the value of type <code>Permissions</code> when that function is called.</p>\n\n<p>Now let's look at the line you are having trouble with. You know that the <code>do</code> notation is just syntactic sugar, and the expression:</p>\n\n<pre><code>do permissions &lt;- ask\n   if hasPermission \"admin\" permissions\n     then map Just newUser\n     else pure Nothing\n</code></pre>\n\n<p>desugars to</p>\n\n<pre><code>ask &gt;&gt;= \\permissions -&gt; \n  if hasPermission \"admin\" permissions\n  then map Just newUser\n  else pure Nothing\n</code></pre>\n\n<p>To understand what this does, you will have to lookup the definition of <code>ask</code>, <code>&gt;&gt;=</code> and <code>pure</code> for <code>ReaderT</code>. Let's perform another round of substitutions:</p>\n\n<pre><code>ask &gt;&gt;= \\permissions -&gt; ...\n{- definition of ask for ReaderT -}\nReaderT pure &gt;&gt;= \\permissions -&gt; ...\n{- definition of &gt;&gt;= for ReaderT -}\nReaderT \\r -&gt;\n  pure r &gt;&gt;= \\a -&gt; case (\\permissions -&gt; ...) a of ReaderT f -&gt; f r\n{- function application -}\nReaderT \\r -&gt;\n  pure r &gt;&gt;= \\a -&gt; \n    case (if hasPermission \"admin\" a\n          then map Just newUser\n          else pure Nothing) of ReaderT f -&gt; f r\n{- definition of pure for Identity -}\nReaderT \\r -&gt;\n  Identity r &gt;&gt;= \\a -&gt; \n    case (if hasPermission \"admin\" a\n          then map Just newUser\n          else pure Nothing) of ReaderT f -&gt; f r\n{- definition of &gt;&gt;= for Identity -}\nReaderT \\r -&gt;\n  (\\a -&gt; \n    case (if hasPermission \"admin\" a\n          then map Just newUser\n          else pure Nothing) of ReaderT f -&gt; f r) r\n{- function application -}\nReaderT \\r -&gt;\n  case (if hasPermission \"admin\" r\n        then map Just newUser\n        else pure Nothing) of ReaderT f -&gt; f r\n</code></pre>\n\n<p>As you can see, <code>createUser</code> is clearly just a function wrapped by <code>ReaderT</code> that threads a value (the \"environment\") through your expressions. <code>runReader</code> unwraps the function and calls it with the provided argument:</p>\n\n<pre><code>runReader :: forall r a. Reader r a -&gt; r -&gt; a\nrunReader (ReaderT f) r = f r\n</code></pre>\n"}], "owner": {"reputation": 10749, "user_id": 294657, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bf6a123b877d32265e37c0fb592d5965?s=128&d=identicon&r=PG", "display_name": "kaqqao", "link": "https://stackoverflow.com/users/294657/kaqqao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1193, "favorite_count": 0, "accepted_answer_id": 46738360, "answer_count": 2, "score": 13, "last_activity_date": 1579981191, "creation_date": 1507929629, "last_edit_date": 1579981191, "question_id": 46738184, "link": "https://stackoverflow.com/questions/46738184/understanding-the-reader-monad", "title": "Understanding the Reader monad", "body": "<p>I'm reading <em>PureScript by Example</em> and got to the part introducing the Reader monad. The example goes like this:</p>\n\n<pre><code>createUser :: Reader Permissions (Maybe User)\ncreateUser = do\n  permissions &lt;- ask\n  if hasPermission \"admin\" permissions\n    then map Just newUser\n    else pure Nothing\n</code></pre>\n\n<p>The confusing part for me is the <code>ask</code> function. The signature is:</p>\n\n<pre><code>ask   :: forall r. Reader r r\n</code></pre>\n\n<p>It appears as if it creates a Reader out of thin air \ud83d\ude10</p>\n\n<p>When I was reading about the <code>State</code> monad, it had the same concept with its <code>get</code> function. And the text explained:</p>\n\n<p><em>the state is implemented as a function argument hidden by the State monad\u2019s data constructor, so there is no explicit reference to pass around.</em></p>\n\n<p>I'm guessing this is the key, and the same thing is happening here with the Reader, but I don't understand how it works...</p>\n\n<p>When the above example is run via <code>runReader</code>, how does the provided value suddenly appear as a result of <code>ask</code>? The Haskell docs for <code>ask</code> say: <em>Retrieves the monad environment.</em> But my confusion is <em>from where</em>? The way I see it, a value gets passed to <code>runReader</code>, gets stored <em>somewhere</em>, and to get it - you call <code>ask</code>... but that makes no sense.</p>\n\n<p>While the example is PureScript, I'm guessing any Haskell-literate person would also be able to answer, hence the Haskell tag.</p>\n"}, {"tags": ["haskell", "xmonad", "xmobar"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1507927322, "creation_date": 1507927322, "answer_id": 46737717, "question_id": 46736192, "link": "https://stackoverflow.com/questions/46736192/how-to-put-an-instance-of-xmobar-on-each-screen-in-xmonad/46737717#46737717", "title": "How to put an instance of XMobar on each screen in XMonad?", "body": "<p>Use the <a href=\"https://hackage.haskell.org/package/xmonad-0.13/docs/XMonad-Core.html#v:startupHook\" rel=\"nofollow noreferrer\"><code>startupHook</code></a> to run an <code>X</code> action on every invocation of xmonad. For example,</p>\n\n<pre><code>main = xmonad $ desktopConfig\n    { startupHook = do\n        rects &lt;- xdisplays\n        {- spawn xmobar -}\n    }\n</code></pre>\n\n<p>You might also like <a href=\"https://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Layout-IndependentScreens.html#v:countScreens\" rel=\"nofollow noreferrer\"><code>countScreens</code></a> if all you actually care about is how many screens there are and <a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Util-SpawnOnce.html\" rel=\"nofollow noreferrer\"><code>spawnOnce</code></a> so that you don't get an extra copy of xmobar on each restart of xmonad.</p>\n"}], "owner": {"reputation": 55, "user_id": 4930352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98f8a5e7e47657651f63380ab30d5211?s=128&d=identicon&r=PG&f=1", "display_name": "ljw", "link": "https://stackoverflow.com/users/4930352/ljw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2371, "favorite_count": 0, "accepted_answer_id": 46737717, "answer_count": 1, "score": 1, "last_activity_date": 1507927322, "creation_date": 1507920027, "question_id": 46736192, "link": "https://stackoverflow.com/questions/46736192/how-to-put-an-instance-of-xmobar-on-each-screen-in-xmonad", "title": "How to put an instance of XMobar on each screen in XMonad?", "body": "<p>I'm running XMonad on a laptop that I sometimes, but not always, have an additional monitor attached. I'd like to detect the number of screens in my <code>xmonad.hs</code> have a instance of XMobar per screen.</p>\n\n<p>I've seen <a href=\"https://stackoverflow.com/questions/5607326/finding-the-number-of-x11-screens-from-haskell\">this question and answer</a>, but I've not really got my head around monad transformers and how to make use of a value of type <code>X [Rectangle]</code>.</p>\n\n<p>Right now, I have, roughly, this:</p>\n\n<pre><code>import XMonad\nimport XMonad.Config.Desktop\nimport XMonad.Hooks.DynamicLog\nimport XMonad.Hooks.ManageDocks\nimport XMonad.Util.Run(spawnPipe)\nimport XMonad.Core (X ,withDisplay ,io)\nimport Graphics.X11.Xinerama (getScreenInfo)\nimport Graphics.X11.Xlib.Types (Rectangle)\nimport System.IO\n\nxdisplays :: X [Rectangle]\nxdisplays = withDisplay $ io . getScreenInfo\n\nmain = do\n    xmproc &lt;- spawnPipe \"/usr/bin/xmobar /home/liam/.xmobarrc\"\n    xmonad $ desktopConfig\n        { layoutHook = avoidStruts $ layoutHook defaultConfig,\n          manageHook = manageHook defaultConfig &lt;+&gt; manageDocks,\n          logHook = dynamicLogWithPP xmobarPP\n            { ppOutput = hPutStrLn xmproc\n            }\n        }\n</code></pre>\n\n<p>Naively, I'd like to put <code>rects &lt;- xdisplays</code> at the start of my do block, then spawn xmobar instances appropriately, but obviously this doesn't work because the type is <code>X [Rectangle]</code> not <code>IO [Rectangle]</code>. I wondered if I need to use <a href=\"https://hackage.haskell.org/package/xmonad-0.13/docs/XMonad-Core.html#v:runX\" rel=\"nofollow noreferrer\">runX</a> somehow?</p>\n"}, {"tags": ["macos", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1507914731, "post_id": 46734646, "comment_id": 80416389, "body": "Get started like this: <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started</a>"}, {"owner": {"reputation": 2635, "user_id": 841721, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b0cd544b1c60eb5fb4dde29332be9de7?s=128&d=identicon&r=PG", "display_name": "PandemoniumSyndicate", "link": "https://stackoverflow.com/users/841721/pandemoniumsyndicate"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1507919497, "post_id": 46734646, "comment_id": 80418756, "body": "Thanks @Sibi I tried that and got this linker error"}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1508267481, "post_id": 46734646, "comment_id": 80541753, "body": "Just to be sure that the correct commandline-tools are used. In Terminal.app do <code>sudo xcode-select -s &#47;Applications&#47;Xcode.app</code> (I assume Xcode is installed in the default location)."}], "owner": {"reputation": 2635, "user_id": 841721, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b0cd544b1c60eb5fb4dde29332be9de7?s=128&d=identicon&r=PG", "display_name": "PandemoniumSyndicate", "link": "https://stackoverflow.com/users/841721/pandemoniumsyndicate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 595, "favorite_count": 0, "answer_count": 0, "score": 8, "last_activity_date": 1517907786, "creation_date": 1507913672, "last_edit_date": 1517907786, "question_id": 46734646, "link": "https://stackoverflow.com/questions/46734646/haskell-stack-doesnt-work-correctly-on-osx-sierra", "title": "Haskell Stack doesnt work correctly on OSX Sierra", "body": "<p>I can't get haskell's stack to work on my Mac. </p>\n\n<p>I installed haskell by:\n<code>brew cask install haskell-platform</code> </p>\n\n<p>Which is specified here: <a href=\"https://www.haskell.org/platform/mac.html#osx-homebrewcask\" rel=\"noreferrer\">https://www.haskell.org/platform/mac.html#osx-homebrewcask</a></p>\n\n<p>I've also tried installing via the downloadable package at the same site. </p>\n\n<p>I do the following commands:\n<code>\nstack new my-project\ncd my-project\nstack setup\nstack build\nstack exec my-project-exe\n</code></p>\n\n<p>Per the documentation here:\n<a href=\"https://docs.haskellstack.org/en/stable/README/#quick-start-guide\" rel=\"noreferrer\">https://docs.haskellstack.org/en/stable/README/#quick-start-guide</a></p>\n\n<p>And I immediately see this:\n<code>[1]    43017 killed     stack exec my-project-exe</code> </p>\n\n<p>I've also tried many other ways of installing haskell. I've actually been able to get something compiled and executed just using <code>cabal</code>, but I can't then get <code>hlint</code>, <code>hindent</code>, or <code>ghc-mod</code> to work, they all return a similar message to the one above. I'd love to be able to work with HaskForce in IntelliJ on my Mac, but I've never had luck getting haskell to work. </p>\n\n<h3>System Specs</h3>\n\n<ul>\n<li>macOS 10.12.6 (16G29) (Sierra) </li>\n<li>Fresh uninstall/reinstall of XCode (accepted terms)</li>\n<li>brew as package manager</li>\n</ul>\n\n<p>Here's a gif of what happens as well: <a href=\"https://imgur.com/gallery/afYym7m\" rel=\"noreferrer\">https://imgur.com/gallery/afYym7m</a></p>\n\n<h1>UPDATE</h1>\n\n<p>I blew away all stuff related to ghc, stack, and cabal and then installed this way\n<a href=\"https://haskell-lang.org/get-started\" rel=\"noreferrer\">https://haskell-lang.org/get-started</a></p>\n\n<p>Writing the little HelloWorld.hs script worked fine and showed <code>Hello, World</code></p>\n\n<p>However, doing</p>\n\n<p><code>\nstack new someproj\ncd someproj\nstack build\n</code></p>\n\n<p>Resulted in this:</p>\n\n<pre><code>\u279c  someproj stack build\n[1 of 2] Compiling Main             ( /Users/trevord2/.stack/setup-exe-src/setup-mPHDZzAJ.hs, /Users/trevord2/.stack/setup-exe-src/setup-mPHDZzAJ.o )\n[2 of 2] Compiling StackSetupShim   ( /Users/trevord2/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs, /Users/trevord2/.stack/setup-exe-src/setup-shim-mPHDZzAJ.o )\nLinking /Users/trevord2/.stack/setup-exe-cache/x86_64-osx/tmp-Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 ...\nsomeproj-0.1.0.0: configure (lib + exe)\nConfiguring someproj-0.1.0.0...\nsomeproj-0.1.0.0: build (lib + exe)\nPreprocessing library someproj-0.1.0.0...\n[1 of 1] Compiling Lib              ( src/Lib.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/Lib.o )\nPreprocessing executable 'someproj-exe' for someproj-0.1.0.0...\n[1 of 1] Compiling Main             ( app/Main.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/someproj-exe/someproj-exe-tmp/Main.o )\nLinking .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/someproj-exe/someproj-exe ...\nld: warning: ignoring file /Users/trevord2/someproj/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/libHSsomeproj-0.1.0.0-6corWoTDCA69pE1sqNF8Id.a, file was built for archive which is not the architecture being linked (x86_64): /Users/trevord2/someproj/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/libHSsomeproj-0.1.0.0-6corWoTDCA69pE1sqNF8Id.a\nUndefined symbols for architecture x86_64:\n  \"_someprojzm0zi1zi0zi0zm6corWoTDCA69pE1sqNF8Id_Lib_someFunc1_closure\", referenced from:\n      _Main_main1_info in Main.o\n      _S39Z_srt in Main.o\n  \"_someprojzm0zi1zi0zi0zm6corWoTDCA69pE1sqNF8Id_Lib_someFunc1_info\", referenced from:\n      _Main_main_info in Main.o\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n`gcc' failed in phase `Linker'. (Exit code: 1)\n\n--  While building package someproj-0.1.0.0 using:\n      /Users/trevord2/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.24.2.0 build lib:someproj exe:someproj-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>Which I've seen before and was actually one of my initial problems</p>\n\n<h2>UPDATE 2: Created GitHub Issue</h2>\n\n<p>Here's the issue: <a href=\"https://github.com/commercialhaskell/stack/issues/3487\" rel=\"noreferrer\">https://github.com/commercialhaskell/stack/issues/3487</a></p>\n\n<p>After talking with folks on #haskell IRC they recommended I create an issue as this is very peculiar behaviour from what I understand. I'll try make sure whatever we find out here is pushed up there too. </p>\n"}, {"tags": ["performance", "haskell", "ghc", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1507915003, "creation_date": 1507915003, "answer_id": 46734970, "question_id": 46734591, "link": "https://stackoverflow.com/questions/46734591/haskellghc-specialization-tour-efficient-typefamilies/46734970#46734970", "title": "Haskell(GHC) specialization tour &amp; efficient TypeFamilies", "body": "<p>As you say, we can't pattern match on <code>UVec a</code> without knowing what <code>a</code> is.\nOne option is to use another typeclass that extends your vector class with a custom function.</p>\n\n<pre><code>class UVec a =&gt; UVecSum a where\n   sum :: UVec a -&gt; a\n\ninstance UVecSum Float where\n   sum = ... -- use pattern match here\n</code></pre>\n\n<p>If, later on, we use <code>sum v</code> where <code>v :: UVec Float</code>, the <code>Float</code>-specific code we defined in the instance will be called.</p>\n"}, {"comments": [{"owner": {"reputation": 69, "user_id": 8742124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a39412ec132fb6c2b59778a46838af?s=128&d=identicon&r=PG&f=1", "display_name": "russoulmc", "link": "https://stackoverflow.com/users/8742124/russoulmc"}, "edited": false, "score": 1, "creation_date": 1507922693, "post_id": 46735011, "comment_id": 80420309, "body": "About runtime length info : haskell does not have full dependent types. Haskell has distinction between runtime values and types. So the length of the Vec is guaranteed to be erased (as the length is a type (or kind) not runtime value but haskell does not allow types to be preserved at runtime) ."}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 0, "last_activity_date": 1507915157, "creation_date": 1507915157, "answer_id": 46735011, "question_id": 46734591, "link": "https://stackoverflow.com/questions/46734591/haskellghc-specialization-tour-efficient-typefamilies/46735011#46735011", "title": "Haskell(GHC) specialization tour &amp; efficient TypeFamilies", "body": "<p>Partial answer, but perhaps it might help.</p>\n\n<blockquote>\n  <p>As far as I understand, one way it is done is specialization - basically extra code generation(manual or by compiler), correct ?</p>\n</blockquote>\n\n<p>Yes, this is similar to code instantiation in C++ templates.</p>\n\n<blockquote>\n  <p>Now if haskell compiler can determine at compile time that we call sum on two Floats, it is going to use specialized version of it. No heap allocations, right ?</p>\n</blockquote>\n\n<p>Yes the compiler calls the specialised version whenever possible. Not sure what you mean regarding the heap allocations.</p>\n\n<p>Regarding the dependently types vectors: usually (I know this from Idris) the length of the vector is eliminated by the compiler when possible. It is intended for stronger type checking. At runtime the length information is useless and can be dropped.</p>\n"}], "owner": {"reputation": 69, "user_id": 8742124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a39412ec132fb6c2b59778a46838af?s=128&d=identicon&r=PG&f=1", "display_name": "russoulmc", "link": "https://stackoverflow.com/users/8742124/russoulmc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1507915157, "creation_date": 1507913431, "question_id": 46734591, "link": "https://stackoverflow.com/questions/46734591/haskellghc-specialization-tour-efficient-typefamilies", "title": "Haskell(GHC) specialization tour &amp; efficient TypeFamilies", "body": "<p>Haskell is all about abstraction. But abstraction costs us extra CPU cycles and extra memory usage due to common representation of all abstract (polymorphic) data - pointer on heap. There are some ways to make abstract code play better with high performance demands. As far as I understand, one way it is done is specialization - basically extra code generation(manual or by compiler), correct ?</p>\n\n<p>Let's assume that all code below is <strong>Strict</strong>(which helps compiler perform more optimizations ?)</p>\n\n<p>If we have a function <code>sum</code>:</p>\n\n<pre><code>sum :: (Num a) =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>We can generate specialized version of it using <code>specialize</code> pragma:</p>\n\n<pre><code>{-#SPECIALIZE sum :: Float -&gt; Float -&gt; Float#-}\n</code></pre>\n\n<p>Now if haskell compiler can determine at compile time that we call <code>sum</code> on two <code>Float</code>s, it is going to use specialized version of it. No heap allocations, right ?</p>\n\n<p>Functions - done. Same pragma can be applied to class instances. Logic does not change here, does it ?</p>\n\n<p>But what about data types ?\nI suspect that <code>TypeFamilies</code> are in charge here ?</p>\n\n<p>Let's try to specialize dependent length-indexed list.</p>\n\n<pre><code>--UVec for unboxed vector\nclass UVec a where\n   data Vec (n :: Nat) a :: *\n\ninstance UVec Float where\n   data Vec n Float where\n     VNilFloat :: Vec 0 Float\n     VConsFloat :: {-#UNPACK#-}Float -&gt;\n                   Vec n Float -&gt; \n                   Vec (N :+ 1) Float\n</code></pre>\n\n<p>But <code>Vec</code> has a problem. We can't pattern match on its constructors as\neach instance of <code>UVec</code> does not have to provide <code>Vec</code> with identical constructors. This forces us to implement each function on <code>Vec</code> for each instance of <code>Vec</code> (as lack of pattern matching implies that it can't be polymorphic on <code>Vec</code>). What is the best practice in such case ?</p>\n"}, {"tags": ["windows", "haskell", "cabal"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 3, "creation_date": 1507913310, "post_id": 46734375, "comment_id": 80415670, "body": "<a href=\"https://github.com/haskell/cabal/issues/4747#issuecomment-327888643\" rel=\"nofollow noreferrer\">Cabal issue #4747</a> has some suggested workarounds, including <code>cabal --http-transport=plain-http update</code> and &quot;Adding wget or curl to Path&quot;"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1508001864, "post_id": 46734375, "comment_id": 80440651, "body": "You can also try getting started with Stack instead. There are instructions for that at <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started</a>. In theory, your Haskell Platform installation should contain a valid Stack installation already."}, {"owner": {"reputation": 178, "user_id": 3165353, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e092a82487f028c427a76e8f4712279f?s=128&d=identicon&r=PG&f=1", "display_name": "bcvery1", "link": "https://stackoverflow.com/users/3165353/bcvery1"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1508315357, "post_id": 46734375, "comment_id": 80558668, "body": "@thatotherguy that workaround worked for me - did you want to add it as an answer and I will accept it?"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1517002117, "creation_date": 1517002117, "answer_id": 48469807, "question_id": 46734375, "link": "https://stackoverflow.com/questions/46734375/new-cabal-install-repeating-error/48469807#48469807", "title": "New cabal install repeating error", "body": "<p>Reposting the correct answer as communitywiki for posterity:</p>\n\n<p><a href=\"https://github.com/haskell/cabal/issues/4747#issuecomment-327888643\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/issues/4747#issuecomment-327888643</a> has some suggested workarounds, including <code>cabal --http-transport=plain-http update</code> and \"Adding wget or curl to Path\"</p>\n"}], "owner": {"reputation": 178, "user_id": 3165353, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e092a82487f028c427a76e8f4712279f?s=128&d=identicon&r=PG&f=1", "display_name": "bcvery1", "link": "https://stackoverflow.com/users/3165353/bcvery1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 0, "accepted_answer_id": 48469807, "answer_count": 1, "score": 0, "last_activity_date": 1517002117, "creation_date": 1507912565, "question_id": 46734375, "link": "https://stackoverflow.com/questions/46734375/new-cabal-install-repeating-error", "title": "New cabal install repeating error", "body": "<p>I've just install the full Haskell platform from <a href=\"https://www.haskell.org/platform/windows.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/windows.html</a> onto a 64-bit Windows 7 machine. I have followed step 3 from this page.</p>\n\n<p>I had to uninstall 8.0.2 before installing this version, 8.2.1</p>\n\n<p>Whatever command I run with cabal now it gives the same error.  Please see the below sequence of commands and errors.  This was done in an empty directory:</p>\n\n<pre><code>D:\\test&gt;cabal init\ndieVerbatim: user error (cabal: Failed to download\nhttp://objects-us-west-1.dream.io/hackage-mirror/root.json : No Status Code\ncould be parsed from response: --17:29:30--\nhttp://objects-us-west-1.dream.io/hackage-mirror/root.json\n=&gt; `C:\\Users\\BEN~1.CRA\\AppData\\Local\\Temp\\transportAdapterGet570528145'\nConnecting to objects-us-west-1.dream.io:80... connected!\nHTTP request sent, awaiting response... 200 OK\n2 Content-Length: 3850\n3 Accept-Ranges: bytes\n4 Last-Modified: Mon, 12 Sep 2016 12:14:29 GMT\n5 ETag: \"c5688ef68afb3f6186d35162423bd8c6\"\n6 x-amz-request-id: tx0000000000000003f6055-0059e0e9ea-19c1b67c-default\n7 Content-Type: application/json\n8 Date: Fri, 13 Oct 2017 16:29:30 GMT\n9 Connection: keep-alive\n10\n\n0K ... 100% @ 3.67 MB/s\n\n17:29:30 (3.67 MB/s) -\n`C:\\Users\\BEN~1.CRA\\AppData\\Local\\Temp\\transportAdapterGet570528145' saved\n[3850/3850]\n\n\nFINISHED --17:29:30--\nDownloaded: 3,850 bytes in 1 files\n)\nD:\\test&gt;cabal configure\ndieVerbatim: user error (cabal: Failed to download\nhttp://objects-us-west-1.dream.io/hackage-mirror/root.json : No Status Code\ncould be parsed from response: --17:29:35--\nhttp://objects-us-west-1.dream.io/hackage-mirror/root.json\n=&gt; `C:\\Users\\BEN~1.CRA\\AppData\\Local\\Temp\\transportAdapterGet570528145'\nConnecting to objects-us-west-1.dream.io:80... connected!\nHTTP request sent, awaiting response... 200 OK\n2 Content-Length: 3850\n3 Accept-Ranges: bytes\n4 Last-Modified: Mon, 12 Sep 2016 12:14:29 GMT\n5 ETag: \"c5688ef68afb3f6186d35162423bd8c6\"\n6 x-amz-request-id: tx0000000000000001249f3-0059e0e9f0-19c8c27c-default\n7 Content-Type: application/json\n8 Date: Fri, 13 Oct 2017 16:29:36 GMT\n9 Connection: keep-alive\n10\n\n0K ... 100% @ 3.67 MB/s\n\n17:29:36 (3.67 MB/s) -\n`C:\\Users\\BEN~1.CRA\\AppData\\Local\\Temp\\transportAdapterGet570528145' saved\n[3850/3850]\n\n\nFINISHED --17:29:36--\nDownloaded: 3,850 bytes in 1 files\n)\nD:\\test&gt;cabal install cabal-install\ndieVerbatim: user error (cabal: Failed to download\nhttp://objects-us-west-1.dream.io/hackage-mirror/root.json : No Status Code\ncould be parsed from response: --17:29:45--\nhttp://objects-us-west-1.dream.io/hackage-mirror/root.json\n=&gt; `C:\\Users\\BEN~1.CRA\\AppData\\Local\\Temp\\transportAdapterGet299511942'\nConnecting to objects-us-west-1.dream.io:80... connected!\nHTTP request sent, awaiting response... 200 OK\n2 Content-Length: 3850\n3 Accept-Ranges: bytes\n4 Last-Modified: Mon, 12 Sep 2016 12:14:29 GMT\n5 ETag: \"c5688ef68afb3f6186d35162423bd8c6\"\n6 x-amz-request-id: tx0000000000000003f626b-0059e0e9f9-19c1b67c-default\n7 Content-Type: application/json\n8 Date: Fri, 13 Oct 2017 16:29:45 GMT\n9 Connection: keep-alive\n10\n\n0K ... 100% @ 3.67 MB/s\n\n17:29:45 (3.67 MB/s) -\n`C:\\Users\\BEN~1.CRA\\AppData\\Local\\Temp\\transportAdapterGet299511942' saved\n[3850/3850]\n\n\nFINISHED --17:29:45--\nDownloaded: 3,850 bytes in 1 files\n)\n</code></pre>\n\n<p>The temporary file(s) it is referring to does not exist.  I am able to access the <a href=\"http://objects-us-west-1.dream.io/hackage-mirror/root.json\" rel=\"nofollow noreferrer\">dream.io</a> from my machine using Chrome.</p>\n\n<p>I am new to Haskell/cabal development, so apologies if I'm missing something obvious.</p>\n"}, {"tags": ["haskell", "testing", "quickcheck"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1507908648, "last_edit_date": 1507908648, "creation_date": 1507894088, "answer_id": 46728870, "question_id": 46728553, "link": "https://stackoverflow.com/questions/46728553/arbitrary-string-generator-in-haskell-test-quickcheck-gen/46728870#46728870", "title": "Arbitrary String generator in Haskell (Test.QuickCheck.Gen)", "body": "<p>Don't define a new <code>Arbitrary</code> type class, import <code>Test.QuickCheck</code> instead. It defines most of these instances for you. Also be careful about the version of quickcheck, RWH assumes version 1.</p>\n\n<p>The resulting full implementation will be:</p>\n\n<pre><code>-- file: ch11/Arbitrary.hs\n\nimport Test.QuickCheck\nimport Prettify2\nimport Control.Monad( liftM, liftM2 )\n\ndata Ternary = Yes\n             | No\n             | Unknown\n             deriving(Eq, Show)\n\ninstance Arbitrary Ternary where\n    arbitrary = do\n        n &lt;- choose (0, 2) :: Gen Int\n        return $ case n of\n                      0 -&gt; Yes\n                      1 -&gt; No\n                      _ -&gt; Unknown\n\n\ninstance Arbitrary Doc where\n    arbitrary =\n        oneof [ return Empty\n              , liftM Char arbitrary\n              , liftM Text arbitrary\n              , return Line\n              , liftM2 Concat arbitrary arbitrary\n              , liftM2 Union arbitrary arbitrary ]\n</code></pre>\n"}], "owner": {"reputation": 2260, "user_id": 5687152, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/J754G.jpg?s=128&g=1", "display_name": "mabe02", "link": "https://stackoverflow.com/users/5687152/mabe02"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 1, "accepted_answer_id": 46728870, "answer_count": 1, "score": 3, "last_activity_date": 1507908648, "creation_date": 1507893026, "question_id": 46728553, "link": "https://stackoverflow.com/questions/46728553/arbitrary-string-generator-in-haskell-test-quickcheck-gen", "title": "Arbitrary String generator in Haskell (Test.QuickCheck.Gen)", "body": "<p>I am struggling on <a href=\"http://book.realworldhaskell.org/read/testing-and-quality-assurance.html#quickcheck.indepth\" rel=\"nofollow noreferrer\">Real World Haskell Chapter 11</a> <code>quickCheck</code> generator implementation for a an algebraic data type.</p>\n\n<p>Following the book implementation (which was published in 2008), I came up with the following:</p>\n\n<pre><code>-- file: ch11/Prettify2.hs\nmodule Prettify2(\n    Doc(..)\n) where\n\ndata Doc = Empty\n         | Char Char\n         | Text String\n         | Line\n         | Concat Doc Doc\n         | Union Doc Doc\n         deriving (Show, Eq)\n</code></pre>\n\n<p>And my Arbitrary implementation:</p>\n\n<pre><code>-- file: ch11/Arbitrary.hs\n\nimport System.Random\nimport Test.QuickCheck.Gen\nimport qualified Test.QuickCheck.Arbitrary\n\n\nclass Arbitrary a where\n    arbitrary :: Gen a\n    -- elements' :: [a] =&gt; Gen a {- Expected a constraint, but \u2018[a]\u2019 has kind \u2018*\u2019 -}\n    -- choose' :: Random a =&gt; (a, a) -&gt; Gen a\n    -- oneof' :: [Gen a] -&gt; a\n\ndata Ternary = Yes\n             | No\n             | Unknown\n             deriving(Eq, Show)\n\ninstance Arbitrary Ternary where\n    arbitrary = do\n        n &lt;- choose (0, 2) :: Gen Int\n        return $ case n of\n                      0 -&gt; Yes\n                      1 -&gt; No\n                      _ -&gt; Unknown\n\ninstance (Arbitrary a, Arbitrary b) =&gt; Arbitrary (a, b) where\n  arbitrary = do\n      x &lt;- arbitrary\n      y &lt;- arbitrary\n      return (x, y)\n\ninstance Arbitrary Char where\n    arbitrary = elements (['A'..'Z'] ++ ['a' .. 'z'] ++ \" ~!@#$%^&amp;*()\")\n</code></pre>\n\n<p>I tried the two following implementation with no success:</p>\n\n<pre><code>import Prettify2\nimport Control.Monad( liftM, liftM2 )\n\ninstance Arbitrary Doc where\n    arbitrary = do\n        n &lt;- choose (1,6) :: Gen Int\n        case n of\n            1 -&gt; return Empty\n            2 -&gt; do x &lt;- arbitrary\n                    return (Char x)\n            3 -&gt; do x &lt;- arbitrary\n                    return (Text x)\n            4 -&gt; return Line\n            5 -&gt; do x &lt;- arbitrary\n                    y &lt;- arbitrary\n                    return (Concat x y)\n            6 -&gt; do x &lt;- arbitrary\n                    y &lt;- arbitrary\n                    return (Union x y)\n\ninstance Arbitrary Doc where\n    arbitrary =\n        oneof [ return Empty\n              , liftM Char arbitrary\n              , liftM Text arbitrary\n              , return Line\n              , liftM2 Concat arbitrary arbitrary\n              , liftM2 Union arbitrary arbitrary ]\n</code></pre>\n\n<p>But it doesn't compile since <code>No instance for (Arbitrary String)</code></p>\n\n<p>I tried then to implement the instance for <code>Arbitrary String</code> in the following ways:</p>\n\n<ul>\n<li><code>import qualified Test.QuickCheck.Arbitrary</code> but it does not implement <code>Arbitrary String</code> neither</li>\n<li><p>installing <code>Test.RandomStrings</code> <a href=\"https://hackage.haskell.org/package/random-strings-0.1.1.0/docs/Test-RandomStrings.html\" rel=\"nofollow noreferrer\">hackage link</a> </p>\n\n<p>instance Arbitrary String where\n    arbitrary = do\n        n &lt;- choose (8, 16) :: Gen Int\n        return $ randomWord randomASCII n :: Gen String</p></li>\n</ul>\n\n<p>With the following backtrace:</p>\n\n<pre><code>$ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :l Arbitrary.hs\n[1 of 2] Compiling Prettify2        ( Prettify2.hs, interpreted )\n[2 of 2] Compiling Main             ( Arbitrary.hs, interpreted )\n\nArbitrary.hs:76:9:\n    The last statement in a 'do' block must be an expression\n      return &lt;- randomWord randomASCII n :: Gen String\nFailed, modules loaded: Prettify2\n</code></pre>\n\n<p>Would you have any good suggestion about how to implement this particular generator and - more in general - how to proceed in these cases?</p>\n\n<p>Thank you in advance</p>\n"}, {"tags": ["haskell", "type-kinds"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1507890495, "post_id": 46727540, "comment_id": 80401541, "body": "I wonder if it\u2019s a type checker bug to do with the way kind variables are passed around implicitly. What happens if you say <code>Wrap @k @a Refl</code>?"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1507892907, "post_id": 46727540, "comment_id": 80402903, "body": "Oh, wow. That works. <code>Wrap @_ @a Refl</code> also works in case the <code>Kind</code> you want to use is long and you don&#39;t feel like writing it down. Do you mind posting this as an answer?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1507892985, "post_id": 46727540, "comment_id": 80402953, "body": "Lucky guess! :) I&#39;ll post an answer, but I think it should probably also be reported as a GHC bug."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1507894582, "post_id": 46727540, "comment_id": 80403992, "body": "I&#39;ll report it now. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1507901912, "post_id": 46728603, "comment_id": 80408632, "body": "Apparently this is <a href=\"http://ghc.haskell.org/trac/ghc/ticket/14348#comment:1\" rel=\"nofollow noreferrer\">the expected behaviour</a>. To not have this you have to leave the kind annotation <code>(a :: k)</code> out when defining <code>Wrap</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1507902050, "post_id": 46728603, "comment_id": 80408720, "body": "@gallais Interesting! Thanks for the link. I for one have a general mistrust of <code>TypeApplications</code> and surprising behaviours like that aren&#39;t doing much to convince me otherwise \ud83d\ude1b"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1507902307, "post_id": 46728603, "comment_id": 80408887, "body": "It&#39;s indeed a shame that you <i>have to</i> leave documentation out of your code to get the behaviour you want. I guess a solution would be to make a distinction between user-written and user-introduced (e.g. <code>Wrap (k :: Kind) (a :: k)</code> vs. <code>Wrap (a :: k)</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507902403, "post_id": 46728603, "comment_id": 80408950, "body": "Well, running <code>:t Wrap</code> in GHCi does print <code>Wrap :: forall k (a :: k). EQ a a -&gt; Wrap a</code>, so it should be reasonably clear that both <code>k</code> and <code>a</code> must be passed. It would make sense to pass only the type arguments, and not the kind ones, but if we ask to be explicit, we need to be explicit about everything. It feels a bit like Coq or Agda when we need to pass everything to satisfy a dependently-typed function."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1507902693, "post_id": 46728603, "comment_id": 80409144, "body": "@gallais Why do you say that &quot;you have to leave documentation out&quot;? I don&#39;t understand."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507902824, "post_id": 46728603, "comment_id": 80409232, "body": "@chi: <a href=\"https://github.com/gallais/potpourri/commit/9b04cb49aeb91db61272878c5ae1cad0904c24b4#diff-45d21eaa70370a2acf5767454a2f4e74L47\" rel=\"nofollow noreferrer\">My use case</a>. Consider <code>cong :: forall (f : Function k l -&gt; *) a b. a == b -&gt; Apply f a == Apply f b</code> versus <code>cong :: forall f a b. a == b -&gt; Apply f a == Apply f b</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1507903129, "post_id": 46728603, "comment_id": 80409427, "body": "@gallais I&#39;d write that as <code>cong :: forall k l (f : Function k l -&gt; *) a b. ...</code> and pay the <code>@_</code> price. (That works, right?) If that is too much for your use case, then I think I understand now."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1507901014, "last_edit_date": 1507901014, "creation_date": 1507893191, "answer_id": 46728603, "question_id": 46727540, "link": "https://stackoverflow.com/questions/46727540/application-of-type-level-arguments-of-kind-other-than-type/46728603#46728603", "title": "Application of type-level arguments of Kind other than Type", "body": "<p>I think you\u2019ve found a type checker bug.</p>\n\n<p>The way kind variables are implemented, GHC passes around an extra type parameter behind the scenes. This type parameter is supposed to be implicit and filled in by unification, but sometimes it shows up. (That's why you sometimes see extra type parameters in Haddocks, eg in <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Proxy.html\" rel=\"nofollow noreferrer\"><code>Proxy</code>'s instance list</a>.)</p>\n\n<p>This appears to be one of those situations: the type checker thinks you\u2019re passing the <code>k</code> parameter. Luckily it seems like you can work around it by passing the kind variable explicitly.</p>\n\n<pre><code>wrap :: forall (a :: k). Wrap a\nwrap = Wrap @k @a Refl\n</code></pre>\n"}], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 1, "accepted_answer_id": 46728603, "answer_count": 1, "score": 7, "last_activity_date": 1507901014, "creation_date": 1507889606, "question_id": 46727540, "link": "https://stackoverflow.com/questions/46727540/application-of-type-level-arguments-of-kind-other-than-type", "title": "Application of type-level arguments of Kind other than Type", "body": "<p>I would like to be able to explicitly apply an argument of kind other than <code>Type</code> to a dummy constructor purely for documentation purposes. However <code>TypeApplications</code> does not seem to support this scenario:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, PolyKinds, ScopedTypeVariables, TypeApplications #-}\n\ndata EQ :: k -&gt; k -&gt; * where\n  Refl :: EQ a a\n\ndata Wrap (a :: k) = Wrap (EQ a a)\n\nwrap :: forall (a :: k). Wrap a\nwrap = Wrap @a Refl\n</code></pre>\n\n<p>leads to the error</p>\n\n<pre><code>ProxyApply.hs:9:14: error:\n    \u2022 Expected a type, but \u2018a\u2019 has kind \u2018k\u2019\n    \u2022 In the type \u2018a\u2019\n      In the expression: Wrap @a Refl\n      In an equation for \u2018wrap\u2019: wrap = Wrap @a Refl\n    \u2022 Relevant bindings include\n        wrap :: Wrap a (bound at ProxyApply.hs:9:1)\n</code></pre>\n\n<p>Is there a way to do this?</p>\n"}, {"tags": ["list", "haskell", "fold"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 8, "creation_date": 1507888614, "post_id": 46727155, "comment_id": 80400440, "body": "But this is not a folding job. Why don&#39;t you just do like <code>reverse . map reverse $ [[1,2,3],[3,4,5]]</code>"}, {"owner": {"reputation": 670, "user_id": 6877607, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/329d14d8a7a5ee78262458d53c198e95?s=128&d=identicon&r=PG", "display_name": "Carlos V&#225;zquez Losada", "link": "https://stackoverflow.com/users/6877607/carlos-v%c3%a1zquez-losada"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507889248, "post_id": 46727155, "comment_id": 80400844, "body": "I&#39;m a novice in Haskell programming. There is a way to use recursion to solve my problem instead of your solution?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1507891442, "post_id": 46727155, "comment_id": 80402038, "body": "It&#39;s a fine exercise if you want to learn Haskell, and how recursion works, but then if that&#39;s your motivation, you shouldn&#39;t be using <code>foldr</code>, which abstracts the recursion away."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 5, "creation_date": 1507891542, "post_id": 46727155, "comment_id": 80402087, "body": "Try to first write a recursive version of <code>reverse</code>, and, likewise, a recursive version of <code>map</code>. If you can do that, you should be able to compose them as @Redu suggests."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1507967978, "post_id": 46727155, "comment_id": 80430720, "body": "First, write reverse in terms of foldr, then write map, then combine."}], "answers": [{"comments": [{"owner": {"reputation": 670, "user_id": 6877607, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/329d14d8a7a5ee78262458d53c198e95?s=128&d=identicon&r=PG", "display_name": "Carlos V&#225;zquez Losada", "link": "https://stackoverflow.com/users/6877607/carlos-v%c3%a1zquez-losada"}, "edited": false, "score": 1, "creation_date": 1507979272, "post_id": 46742092, "comment_id": 80433663, "body": "Wow dude, thank you so much! I&#39;ve learned how folding and recursion work in this case!"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 670, "user_id": 6877607, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/329d14d8a7a5ee78262458d53c198e95?s=128&d=identicon&r=PG", "display_name": "Carlos V&#225;zquez Losada", "link": "https://stackoverflow.com/users/6877607/carlos-v%c3%a1zquez-losada"}, "edited": false, "score": 0, "creation_date": 1507979824, "post_id": 46742092, "comment_id": 80433816, "body": "Not a dude, but I&#39;m glad it helped"}], "tags": [], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "is_accepted": true, "score": 2, "last_activity_date": 1507969777, "last_edit_date": 1507969777, "creation_date": 1507966579, "answer_id": 46742092, "question_id": 46727155, "link": "https://stackoverflow.com/questions/46727155/reverse-list-of-lists-using-foldr-haskell/46742092#46742092", "title": "Reverse list of lists using foldr Haskell", "body": "<p>To analyse your current solution, I've broken down your one-liner into some helper functions, with their type deduced based on their composition:</p>\n\n<pre><code>reverse'':: [[a]] -&gt; [[a]]\nreverse'' x = foldr f [[]] x\n    where\n        f :: [a] -&gt; a -&gt; [a]\n        f n acum = acum : reverse n\n\n        reverse :: [a] -&gt; [a]\n        reverse n = foldr append [] n\n\n        append :: a -&gt; [a] -&gt; [a]\n        append m acum = acum ++ [m]\n</code></pre>\n\n<p>When I try to compile the above, ghc complains with the following error for the type signature of <code>reverse''</code>:</p>\n\n<pre><code>Expected type: [[a]] -&gt; [[a]] -&gt; [[a]]\n  Actual type: [[a]] -&gt;  [a]  -&gt; [[a]]\n</code></pre>\n\n<p>I did some digging, and in order for <code>reverse''</code> to have the type <code>[[a]] -&gt; [[a]]</code>, the function <code>f</code> needs to have the type <code>[a] -&gt; [[a]] -&gt; [[a]]</code>. However the current <code>f</code> has type <code>[a] -&gt; a -&gt; [a]</code>, or in this case <code>[[a]] -&gt; [a] -&gt; [[a]]</code>.</p>\n\n<p>The following has the correct type, but inserts an extra <code>[]</code> value into the start of the array, due to the starting value of the accumulator:</p>\n\n<pre><code>reverse'':: [[a]] -&gt; [[a]]\nreverse'' x = foldr f [[]] x\n    where\n        f :: [a] -&gt; [[a]] -&gt; [[a]]\n        f n acum = acum ++ [reverse n]\n\n        reverse :: [a] -&gt; [a]\n        reverse n = foldr append [] n\n\n        append :: a -&gt; [a] -&gt; [a]\n        append m acum = acum ++ [m]\n</code></pre>\n\n<h2>The final solution</h2>\n\n<p>By changing the initial accumulator value to the empty list <code>[]</code>, as opposed to a list of an empty list <code>[[]]</code>, we end up at a working solution:</p>\n\n<pre><code>reverse'':: [[a]] -&gt; [[a]]\nreverse'' x = foldr f [] x\n    where\n        f :: a -&gt; [a] -&gt; [a]\n        f n acum = acum ++ [reverse n]\n\n        reverse :: [a] -&gt; [a]\n        reverse n = foldr append [] n\n\n        append :: a -&gt; [a] -&gt; [a]\n        append m acum = acum ++ [m]\n</code></pre>\n\n<h2>As a single line</h2>\n\n<p>If you really want this as a one-liner, here it is:</p>\n\n<pre><code>reverse'' :: [[a]] -&gt; [[a]]\nreverse'' = foldr (\\n acum -&gt; acum ++ [foldr (\\m acum1 -&gt; acum1 ++ [m]) [] n]) []\n</code></pre>\n\n<p>With working:</p>\n\n<pre><code>append m acum = acum ++ [m]\nappend = \\m acum1 -&gt; acum1 ++ [m]\n\nreverse n = foldr append [] n\nreverse = \\n -&gt; foldr append [] n\nreverse = foldr append []\nreverse = foldr (\\m acum1 -&gt; acum1 ++ [m]) []\n\nf n acum = acum ++ [reverse n]\nf = \\n acum -&gt; acum ++ [reverse n]\nf = \\n acum -&gt; acum ++ [foldr (\\m acum1 -&gt; acum1 ++ [m]) [] n]\n\nreverse'':: [[a]] -&gt; [[a]]\nreverse'' x = foldr f [] x\nreverse'' x = foldr (\\n acum -&gt; acum ++ [foldr (\\m acum1 -&gt; acum1 ++ [m]) [] n]) [] x\nreverse'' = foldr (\\n acum -&gt; acum ++ [foldr (\\m acum1 -&gt; acum1 ++ [m]) [] n]) []\n</code></pre>\n\n<h2>Appendix: An explicitly recursive solution</h2>\n\n<p>Here is an explicitly recursive solution (i.e. not using a <code>fold</code>), with definitons of <code>map</code> and <code>reverse</code> provided.</p>\n\n<pre><code>reverse :: [a] -&gt; [a]\nreverse (x:xs) = reverse xs ++ [x]\nreverse []     = []\n\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f (x:xs) = f x : map f xs\nmap _ [] = []\n\nreverse'' :: [[a]] -&gt; [[a]]\nreverse'' ls = reverse $ map reverse ls\n</code></pre>\n"}], "owner": {"reputation": 670, "user_id": 6877607, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/329d14d8a7a5ee78262458d53c198e95?s=128&d=identicon&r=PG", "display_name": "Carlos V&#225;zquez Losada", "link": "https://stackoverflow.com/users/6877607/carlos-v%c3%a1zquez-losada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1005, "favorite_count": 0, "accepted_answer_id": 46742092, "answer_count": 1, "score": 1, "last_activity_date": 1507969777, "creation_date": 1507888312, "question_id": 46727155, "link": "https://stackoverflow.com/questions/46727155/reverse-list-of-lists-using-foldr-haskell", "title": "Reverse list of lists using foldr Haskell", "body": "<p>I'm trying to reverse list of lists in Haskell by using foldr. There is an example of what I want to do:</p>\n\n<pre><code>&gt; reverse'' [[1,2,3],[3,4,5]]\n[[5,4,3],[3,2,1]]\n</code></pre>\n\n<p>And my code (it is not working):</p>\n\n<pre><code>reverse'':: [[a]]-&gt;[[a]]\nreverse'' x = foldr (\\n acum -&gt; acum:(foldr(\\m acum1 -&gt; acum1++[m])) [] n) [[]] x\n</code></pre>\n\n<p>My IDE reports me an error at the start of the second foldr.</p>\n"}, {"tags": ["haskell", "arguments"], "comments": [{"owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "edited": false, "score": 0, "creation_date": 1507875208, "post_id": 46723414, "comment_id": 80393344, "body": "Could you please share the exact output of running your program, and a unified view of the source code?"}, {"owner": {"reputation": 105, "user_id": 7139430, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5adb3f1c8c14c9aba3e6b3cf6e4a4bcb?s=128&d=identicon&r=PG&f=1", "display_name": "christian", "link": "https://stackoverflow.com/users/7139430/christian"}, "reply_to_user": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "edited": false, "score": 0, "creation_date": 1507875348, "post_id": 46723414, "comment_id": 80393395, "body": "That&#39;s all I have as the source code, just the function and the list defined. but i&#39;ll show you the error."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507894215, "post_id": 46723414, "comment_id": 80403755, "body": "There is (or should be) a difference between <code>intCMP (head xs) 1</code> and <code>intCMP head(xs) 1</code>."}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1507875397, "creation_date": 1507875397, "answer_id": 46723602, "question_id": 46723414, "link": "https://stackoverflow.com/questions/46723414/how-do-i-pass-headxs-as-one-arguement-into-another-function/46723602#46723602", "title": "How do I pass head(xs) as one arguement into another function?", "body": "<p>You have to set the parentheses differently</p>\n\n<pre><code> intCMP (head xs) (head $ tail xs)\n</code></pre>\n\n<p>Because in haskell function application is just white space.</p>\n\n<p>Your expression is parsed as <code>intCMP head xs head (tail xs)</code> which is not what you intended.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1507875476, "creation_date": 1507875476, "answer_id": 46723620, "question_id": 46723414, "link": "https://stackoverflow.com/questions/46723414/how-do-i-pass-headxs-as-one-arguement-into-another-function/46723620#46723620", "title": "How do I pass head(xs) as one arguement into another function?", "body": "<p>In Haskell, functions are called by typing the name of the function, followed by each argument. The arguments are separated by space.</p>\n\n<p>In other languages, particularly the descendants of C, you call methods by passing arguments in brackets, but not in Haskell. The brackets don't indicate a function call, they're used entirely to modify the normal operator precedence.</p>\n\n<p>It's like in basic arithmetic, where you have a normal order of operator precedence. For example, <code>1 + 2 * 3</code> is the same as <code>1 + (2 * 3)</code>, so you normally don't write the latter. If, however, you wish to evaluate the addition before the multiplication, you use brackets to indicate a deviation from the norm: <code>(1 + 2) * 3</code>.</p>\n\n<p>It's the same in Haskell. You need to pass two values to <code>intCMP</code>, which you can do like this:</p>\n\n<pre><code>Prelude&gt; intCMP (head xs) (head (tail xs))\nLT\n</code></pre>\n\n<p>Basically, you only need to move the brackets around a bit.</p>\n"}, {"tags": [], "owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "is_accepted": true, "score": 2, "last_activity_date": 1507886147, "last_edit_date": 1507886147, "creation_date": 1507876221, "answer_id": 46723778, "question_id": 46723414, "link": "https://stackoverflow.com/questions/46723414/how-do-i-pass-headxs-as-one-arguement-into-another-function/46723778#46723778", "title": "How do I pass head(xs) as one arguement into another function?", "body": "<p>The error is not about having too many arguments, it's about the type of your list elements being <code>Integer</code> instead of the expected <code>Int</code>.</p>\n\n<p>You have two choices here:</p>\n\n<p>First: Make your function more general by allowing all <code>Ord</code> (Orderable) types to be accepted (note that this function is available in Prelude as <code>compare</code>)</p>\n\n<pre><code>intCMP :: (Ord a) =&gt; a -&gt; a -&gt; Ordering\nintCMP a b | a == b =EQ\n           | a &lt; b = LT\n           | otherwise = GT\n</code></pre>\n\n<p>Second, cast your list element's type to the one required using <code>fromIntegral</code>:</p>\n\n<pre><code>intCMP (fromIntegral $ head intxs) 1\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7139430, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5adb3f1c8c14c9aba3e6b3cf6e4a4bcb?s=128&d=identicon&r=PG&f=1", "display_name": "christian", "link": "https://stackoverflow.com/users/7139430/christian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 46723778, "answer_count": 3, "score": 1, "last_activity_date": 1507886147, "creation_date": 1507874401, "last_edit_date": 1507875731, "question_id": 46723414, "link": "https://stackoverflow.com/questions/46723414/how-do-i-pass-headxs-as-one-arguement-into-another-function", "title": "How do I pass head(xs) as one arguement into another function?", "body": "<p>So i have this function</p>\n\n<pre><code>intCMP :: Int -&gt; Int -&gt; Ordering\nintCMP a b | a == b =EQ\n           | a &lt; b = LT\n           | otherwise = GT\n</code></pre>\n\n<p>and this list defined</p>\n\n<pre><code>xs = [1,2,3]\n</code></pre>\n\n<p>I'm trying to find information about the list but I'm having troouble passing elements into intCMP</p>\n\n<p>This is what I'm trying to do</p>\n\n<pre><code>intCMP head(xs) 1\n</code></pre>\n\n<p>But this give me and error saying it has too many arguements.  </p>\n\n<pre><code>&lt;interactive&gt;:2:9: error:\n       \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018Integer\u2019\n       \u2022 In the first argument of \u2018intCMP\u2019, namely \u2018(head xs)\u2019\n         In the expression: intCMP (head xs) 1\n         In an equation for \u2018it\u2019: it = intCMP (head xs) 1\n</code></pre>\n"}, {"tags": ["sorting", "haskell", "arguments"], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 7139430, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5adb3f1c8c14c9aba3e6b3cf6e4a4bcb?s=128&d=identicon&r=PG&f=1", "display_name": "christian", "link": "https://stackoverflow.com/users/7139430/christian"}, "edited": false, "score": 0, "creation_date": 1507872076, "post_id": 46722831, "comment_id": 80392185, "body": "Oh okay, i see what you&#39;re saying.  Thanks for the simple and quick to the point answer"}], "tags": [], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "is_accepted": true, "score": 2, "last_activity_date": 1507870892, "creation_date": 1507870892, "answer_id": 46722831, "question_id": 46722620, "link": "https://stackoverflow.com/questions/46722620/can-someone-explain-in-detail-the-signature-for-this-haskell-function/46722831#46722831", "title": "Can someone explain in detail the signature for this haskell function?", "body": "<p>There are two arguments to this function:</p>\n\n<pre><code>sort3 :: Ord a =&gt; (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>The first argument is itself a <code>function</code> that takes two arguments: an orderable thing and an orderable thing (these are anything which is in the typeclass <code>Ord</code>) and it returns something of type <code>Ordering</code>.</p>\n\n<p>The second argument is a <code>list</code> of these things, all of which are the exact same orderable thing that the first argument (itself a function) would take two of.</p>\n\n<p>Finally, the <code>sort3</code> function returns a list of that same orderable thing.</p>\n\n<p>Now, GHCI is telling you that it expects the first argument to be what your signature says it should be (a function that itself takes two arguments and returns an <code>Ordering</code>), but you passed it an empty list instead:</p>\n\n<pre><code>Couldn't match expected type \u2018a -&gt; a -&gt; Ordering\u2019\n\nwith actual type \u2018[t0]\u2019\n\n\u2022 In the first argument of \u2018sort3\u2019, namely \u2018[]\u2019\n  In the expression: sort3 []\n</code></pre>\n\n<p>In other words: \"you told me your first argument would be <code>(a -&gt; a -&gt; Ordering)</code>, but instead you've invoked the function like this <code>sort3 []</code> and I can't interpret <code>[]</code> as function with this signature: <code>(a -&gt; a -&gt; Ordering)</code>.</p>\n"}], "owner": {"reputation": 105, "user_id": 7139430, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5adb3f1c8c14c9aba3e6b3cf6e4a4bcb?s=128&d=identicon&r=PG&f=1", "display_name": "christian", "link": "https://stackoverflow.com/users/7139430/christian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 46722831, "answer_count": 1, "score": 0, "last_activity_date": 1507870892, "creation_date": 1507869517, "question_id": 46722620, "link": "https://stackoverflow.com/questions/46722620/can-someone-explain-in-detail-the-signature-for-this-haskell-function", "title": "Can someone explain in detail the signature for this haskell function?", "body": "<p>The signature for this function is confusing me and all information online is confusing me.  Can someone explain to me the signature of the function and maybe give me an example?</p>\n\n<pre><code>sort3 :: Ord a =&gt; (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\nsort3 cmp xs | length(xs) &lt; 1 = xs\n</code></pre>\n\n<p>This is the error I'm getting.  </p>\n\n<pre><code>Couldn't match expected type \u2018a -&gt; a -&gt; Ordering\u2019\n\nwith actual type \u2018[t0]\u2019\n\n\u2022 In the first argument of \u2018sort3\u2019, namely \u2018[]\u2019\n  In the expression: sort3 []\n  In an equation for \u2018it\u2019: it = sort3 []\n\u2022 Relevant bindings include\n    it :: [a] -&gt; [a] (bound at &lt;interactive&gt;:2:1)\n</code></pre>\n"}, {"tags": ["multithreading", "haskell", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507868335, "post_id": 46722135, "comment_id": 80391246, "body": "Why do you doubt the answer on the linked question? (&quot;The library simply doesn&#39;t give you anything to get the <code>ThreadId</code>s of all (still running) threads or any other facility to work on any threads which doesn&#39;t belong to you.&quot;)"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507872370, "post_id": 46722135, "comment_id": 80392279, "body": "Not expecting the library to give me anything. Expecting some &quot;hidden feature&quot; in the RTS or GHCi."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507872500, "post_id": 46722135, "comment_id": 80392316, "body": "The library is the collection of user-visible RTS features."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1507868366, "creation_date": 1507868366, "answer_id": 46722468, "question_id": 46722135, "link": "https://stackoverflow.com/questions/46722135/how-to-get-a-list-of-threads-in-ghci/46722468#46722468", "title": "How to get a list of threads in GHCi", "body": "<p>No. If you want the <code>ThreadId</code>s of running threads, it is your responsibility to keep track of them when you <code>forkIO</code>.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507868366, "creation_date": 1507865735, "question_id": 46722135, "link": "https://stackoverflow.com/questions/46722135/how-to-get-a-list-of-threads-in-ghci", "title": "How to get a list of threads in GHCi", "body": "<p>Is there any command that will list all background threads in a GHCi session? And next question is, how to kill one (or all) of them?</p>\n\n<p>Related:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/24999636/is-there-a-way-to-kill-all-forked-threads-in-a-ghci-session-without-restarting-i\">Is there a way to kill all forked threads in a GHCi session without restarting it?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/46722102/how-to-be-certain-that-all-threads-have-been-killed-upon-pressing-ctrlc\">How to be certain that all threads have been killed upon pressing Ctrl+C</a></li>\n</ul>\n"}, {"tags": ["multithreading", "haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1507868885, "creation_date": 1507868885, "answer_id": 46722548, "question_id": 46722102, "link": "https://stackoverflow.com/questions/46722102/how-to-be-certain-that-all-threads-have-been-killed-upon-pressing-ctrlc/46722548#46722548", "title": "How to be certain that all threads have been killed upon pressing Ctrl+C", "body": "<blockquote>\n  <p>Is this behaviour only because I'm in GHCi? If I compiled a binary, ran it, and then pressed Ctrl+C on it, would the background-thread still keep running?</p>\n</blockquote>\n\n<p>In a compiled binary, if ^C causes the <code>main</code> thread to end, then the process will end and all threads will also be (abruptly) ended as a side effect. It is not a given that ^C causes the <code>main</code> thread to end; see the discussion of signal handling below.</p>\n\n<blockquote>\n  <p>How do I solve for this properly?</p>\n</blockquote>\n\n<p>Probably you can catch the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Exception.html#v:UserInterrupt\" rel=\"nofollow noreferrer\"><code>UserInterrupt</code></a> exception to notice when ^C has been hit and shut down any threads you spawned in the exception handler.</p>\n\n<p>I say \"probably\" because ^C handling is a bit complicated, and it's feasible that servant has installed custom handlers. In that case you may need to look into <a href=\"http://hackage.haskell.org/package/unix-2.7.2.2/docs/System-Posix-Signals.html\" rel=\"nofollow noreferrer\">signal handling</a> via the <code>unix</code> package. (Dunno what the equivalent is for Windows systems.)</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1507868885, "creation_date": 1507865466, "question_id": 46722102, "link": "https://stackoverflow.com/questions/46722102/how-to-be-certain-that-all-threads-have-been-killed-upon-pressing-ctrlc", "title": "How to be certain that all threads have been killed upon pressing Ctrl+C", "body": "<p>I'm running a servant server and another background thread (via <code>async</code>) in <strong>gchi</strong>. When I press <code>Ctrl+c</code> on the GHCi prompt, the servant server shuts down properly, but my background thread keeps running. Only quitting the entire GHCi session seems to really terminate it. </p>\n\n<p>Two questions:</p>\n\n<ul>\n<li>Is this behaviour only because I'm in GHCi? If I compiled a binary, ran it, and then pressed Ctrl+C on it, would the background-thread still keep running?</li>\n<li>How do I solve for this properly?</li>\n</ul>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 15683, "user_id": 6523163, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/qUURJ.jpg?s=128&g=1", "display_name": "aircraft", "link": "https://stackoverflow.com/users/6523163/aircraft"}, "edited": false, "score": 2, "creation_date": 1507863927, "post_id": 46721860, "comment_id": 80390312, "body": "Please post code replace of snapshot."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1507863936, "post_id": 46721860, "comment_id": 80390316, "body": "<code>Text.Regex.Posix</code> is backed by the C POSIX API. What are you using to give Windows POSIX functionality? Cygwin?"}, {"owner": {"reputation": 1277, "user_id": 7254635, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/280e5fa5140a804fcd8fd9dfe3198542?s=128&d=identicon&r=PG&f=1", "display_name": "wang kai", "link": "https://stackoverflow.com/users/7254635/wang-kai"}, "edited": false, "score": 0, "creation_date": 1507864173, "post_id": 46721860, "comment_id": 80390353, "body": "but I can got right result on windows:Prelude&gt; :m +Text.Regex.Posix Prelude Text.Regex.Posix&gt; &quot;abc&quot;=~&quot;a[a-z]+&quot;::Bool True"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1507872449, "post_id": 46721860, "comment_id": 80392299, "body": "The voting on this question seems unusually harsh. Sure the code snippets are images instead of text, but they&#39;re so short it almost doesn&#39;t matter. And the question content follows all the usual rules: there&#39;s a minimal reproducing example with clear effort made to make the issue as small as possible, a clear, objective, answerable question attached... I don&#39;t really understand all the downvotes."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1507875954, "post_id": 46721860, "comment_id": 80393662, "body": "It is most probably due to the <code>+</code> quantifier: on Ubuntu, it seems that the POSIX syntax used is ERE, and on Windows, it looks like BRE. Try <code>&quot;a\\\\s\\\\+&quot;</code> on Windows. If it does not work, then the reason is that the regex library on Windows is a kind of a BSD grep that does not support <code>+</code> quantifier at all and is a very limited regex library. So, the <code>&quot;a\\\\s\\\\s*&quot;</code> pattern should work the same on both platforms."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1507913871, "post_id": 46721860, "comment_id": 80415963, "body": "@WiktorStribi\u017cew the OP said that <code>&quot;abc&quot;=~&quot;a[a-z]+&quot;::Bool</code> works on Windows, so the <code>+</code> quantifier must be working.  Maybe the <code>\\s</code> is not recognizing the space?  Try to match a single space with a pattern of <code>\\s</code> and no quantifiers."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1507916495, "post_id": 46721860, "comment_id": 80417247, "body": "@pat I agree I might not have understood what was not working, Windows or Linux version. If the problem is with <code>\\s</code>, and it can, then <code>[[:blank:]]</code> or <code>[[:space:]]</code> should be used instead of <code>\\s</code>. And I&#39;d rather use <code>&quot;abc&quot;=~&quot;a[[:space:]][[:space:]]*&quot;::Bool</code> to play it safe. If <code>&quot;abc&quot;=~&quot;a[[:space:]]+&quot;::Bool</code> works, cool."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1608556272, "post_id": 46721860, "comment_id": 115611737, "body": "Glad it worked for you. Please also <a href=\"https://stackoverflow.com/help/someone-answers\">consider upvoting</a> if my answer proved helpful to you."}], "answers": [{"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 0, "last_activity_date": 1508318461, "creation_date": 1508318461, "answer_id": 46806766, "question_id": 46721860, "link": "https://stackoverflow.com/questions/46721860/why-regex-match-result-diffrent-when-using-text-regex-posix-on-ubuntu-and-window/46806766#46806766", "title": "Why regex match result diffrent when using Text.Regex.Posix on ubuntu and windows,is that a bug?", "body": "<p>In a POSIX regex flavor, to match any whitespace chars, use <code>[[:space:]]</code> bracket expression with a <em>space</em> POSIX character class inside it:</p>\n\n<pre><code>Prelude Text.Regex.Posix&gt; \"a \"=~\"a[[:space:]]+\" :: String\n\"a \"\n</code></pre>\n\n<p>The <code>\\s</code> shorthand character class comes from Perl, and you may use your pattern with the <a href=\"https://hackage.haskell.org/package/regex-pcre-0.94.4/docs/Text-Regex-PCRE.html\" rel=\"nofollow noreferrer\"><em>Text.Regex.PCRE</em></a> library.</p>\n"}], "owner": {"reputation": 1277, "user_id": 7254635, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/280e5fa5140a804fcd8fd9dfe3198542?s=128&d=identicon&r=PG&f=1", "display_name": "wang kai", "link": "https://stackoverflow.com/users/7254635/wang-kai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 46806766, "answer_count": 1, "score": 3, "last_activity_date": 1508318461, "creation_date": 1507863645, "last_edit_date": 1507912064, "question_id": 46721860, "link": "https://stackoverflow.com/questions/46721860/why-regex-match-result-diffrent-when-using-text-regex-posix-on-ubuntu-and-window", "title": "Why regex match result diffrent when using Text.Regex.Posix on ubuntu and windows,is that a bug?", "body": "<p><a href=\"https://i.stack.imgur.com/sDY94.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sDY94.png\" alt=\"enter image description here\"></a></p>\n\n<p>I write code above: left run on 32 bit ubuntu 16 in a virtualbox machine, right run on 64bit windows winghci.</p>\n\n<p>The code is same, the result is different. Is that a bug?</p>\n"}, {"tags": ["haskell", "data-kinds"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1507860678, "post_id": 46720859, "comment_id": 80389604, "body": "What do you mean by &quot;in a way that types make sense&quot;? Everything seems to be working already... The one thing I would do is make <code>Input</code> a GADT so that the <code>kind :: InputKind</code> is <code>A</code> for <code>InputA</code>, <code>B</code> for <code>InputB</code>, and <code>C</code> for <code>InputC</code>."}, {"owner": {"reputation": 1282, "user_id": 807631, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3120b244b19cab8e1c52845139b3fc23?s=128&d=identicon&r=PG&f=1", "display_name": "Misguided", "link": "https://stackoverflow.com/users/807631/misguided"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507861501, "post_id": 46720859, "comment_id": 80389771, "body": "The <code>parse</code> type signature is not valid haskell (at least not without some other extension, which the compiler does not tell)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507861559, "post_id": 46720859, "comment_id": 80389787, "body": "Are you looking for <code>parse :: formal (kind :: InputKind). Parser (Either SomeError (Input kind))</code>?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1507862474, "post_id": 46720859, "comment_id": 80389991, "body": "The <code>parse</code> signature you give compiles fine w/ GHC versions 8.0.2 and 7.10.3, and the only needed extensions are the ones you list (DataKinds and KindSignatures). What GHC version are you using, and what error are you getting?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1507884158, "post_id": 46720859, "comment_id": 80397811, "body": "Keep in mind that if <code>foo :: Parser (Something (Input kind))</code>, then <code>kind</code> is chosen by the caller. Do you want <code>kind</code> to be chosen by the caller or by the parser? If the former, you probably need a singleton additional argument. If the latter, you need an existential type wrapper. In both cases, this might be the wrong approach to solve your actual problem -- it starts getting so complex that you might have an XY problem."}, {"owner": {"reputation": 1282, "user_id": 807631, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3120b244b19cab8e1c52845139b3fc23?s=128&d=identicon&r=PG&f=1", "display_name": "Misguided", "link": "https://stackoverflow.com/users/807631/misguided"}, "edited": false, "score": 0, "creation_date": 1507898545, "post_id": 46720859, "comment_id": 80406402, "body": "Thanks everyone. I need the kind to be chosen by the parser (it realizes something is of which kind when parsing). Indeed, it seems like it may be the wrong approach to solving the problem."}], "owner": {"reputation": 1282, "user_id": 807631, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3120b244b19cab8e1c52845139b3fc23?s=128&d=identicon&r=PG&f=1", "display_name": "Misguided", "link": "https://stackoverflow.com/users/807631/misguided"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507897571, "creation_date": 1507855081, "last_edit_date": 1507897571, "question_id": 46720859, "link": "https://stackoverflow.com/questions/46720859/returning-phantom-typed-value-with-data-kinds", "title": "Returning phantom typed value with data kinds", "body": "<p>I am parsing some input, for which I have something similar to this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DataKinds, KindSignatures #-}\ndata InputKind = A | B | C\ndata Input (kind :: InputKind) =\n    InputA Char\n  | InputB Double String\n  | InputC Int String\n</code></pre>\n\n<p>And then I have my parsing functions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parseA :: Parser (Either SomeError (Input 'A))\nparseB :: Parser (Either SomeError (Input 'B))\nparseC :: Parser (Either SomeError (Input 'C))\n</code></pre>\n\n<p>So, I am now interested in writing something that looks like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parse :: Parser (Either SomeError (Input (kind :: InputKind)))\n</code></pre>\n\n<p>Is there any way to write this in a way that types make sense?</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1507850303, "post_id": 46720233, "comment_id": 80387170, "body": "What&#39;s <code>findNext&#39;</code>?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1507851148, "post_id": 46720233, "comment_id": 80387408, "body": "Tough to say where your issues were since you didn&#39;t list the error message, but I guarantee your &quot;Variable is not in scope&quot; is from that <code>findNext&#39;</code> typo. N.B. also that <code>y = (head listail)</code> is assignment. You want <code>y == (head listail)</code> (though <code>listail</code> appears to be defined wrong.)"}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 5932985, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b5e649739640c02df1c12ef3069affbd?s=128&d=identicon&r=PG&f=1", "display_name": "STRAN", "link": "https://stackoverflow.com/users/5932985/stran"}, "edited": false, "score": 0, "creation_date": 1507851215, "post_id": 46720298, "comment_id": 80387422, "body": "I am currently using an online ide for haskell due to limitations at school and I still gave me a &quot;Variable not in scope error&quot; as well as  a &quot;Couldn&#39;t match type \u2018Int\u2019 with \u2018[Int] -&gt; Int&quot; message. Is this just an error b/c of my ide and if it is what would my original code do?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 71, "user_id": 5932985, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b5e649739640c02df1c12ef3069affbd?s=128&d=identicon&r=PG&f=1", "display_name": "STRAN", "link": "https://stackoverflow.com/users/5932985/stran"}, "edited": false, "score": 0, "creation_date": 1507851252, "post_id": 46720298, "comment_id": 80387437, "body": "@STRAN impossible to tell without knowing what variable you&#39;re talking about, what IDE you&#39;re using, and what code is running (and how)."}, {"owner": {"reputation": 71, "user_id": 5932985, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b5e649739640c02df1c12ef3069affbd?s=128&d=identicon&r=PG&f=1", "display_name": "STRAN", "link": "https://stackoverflow.com/users/5932985/stran"}, "edited": false, "score": 0, "creation_date": 1507851632, "post_id": 46720298, "comment_id": 80387540, "body": "Im using repl.it and I tried to run your code, Ill edit the error message into the post"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 71, "user_id": 5932985, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b5e649739640c02df1c12ef3069affbd?s=128&d=identicon&r=PG&f=1", "display_name": "STRAN", "link": "https://stackoverflow.com/users/5932985/stran"}, "edited": false, "score": 0, "creation_date": 1507852634, "post_id": 46720298, "comment_id": 80387797, "body": "@STRAN ahh, I had misplaced parentheses, sorry. It was trying to do <code>(fn y x2):xs</code> instead of <code>fn y (x2:xs)</code>, and was complaining because <code>x2</code> is not of type <code>[Int]</code>. Fixed now."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1507898277, "post_id": 46720298, "comment_id": 80406245, "body": "You may want to discuss corner cases like <code>fn 1 [1,1,2]</code>, return a <code>Maybe Int</code> rather than an <code>Int</code> or even observe that the function can be given a more polymorphic type <code>Eq a =&gt; a -&gt; [a] -&gt; Maybe a</code>."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1507917491, "post_id": 46720298, "comment_id": 80417733, "body": "is <code>fn 1 [1,1,2]</code> a corner case? I agree <code>Maybe Int</code> is a more natural return value, but I&#39;m not sure it&#39;s relevant to this question since OP had already specified the expected failure result."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 3, "last_activity_date": 1507919736, "last_edit_date": 1507919736, "creation_date": 1507850515, "answer_id": 46720298, "question_id": 46720233, "link": "https://stackoverflow.com/questions/46720233/haskell-recursion-functions-and-syntax/46720298#46720298", "title": "Haskell recursion functions and syntax", "body": "<p>You can use pattern matching to grab out two values from the list and compare them.</p>\n\n<pre><code>fn :: Int -&gt; [Int] -&gt; Int\nfn y (x1:x2:xs) | y == x2 = x1\n                | otherwise = fn y (x2:xs)\nfn _ _ = -1\n</code></pre>\n\n<p>Note my last case -- this is the fail case, when you can't match the pattern <code>(x1:x2:xs)</code>.</p>\n\n<p>Alternatively: <code>(x1:x2:xs)</code> could also be spelled <code>(x1:xs@(x2:_))</code>. The latter pattern is more complicated to read, but lets you do:</p>\n\n<pre><code>fn :: Int -&gt; [Int] -&gt; Int\nfn y (x1:xs@(x2:_)) | y == x2 = x1\n                    | otherwise = fn y xs\nfn _ _ = -1\n</code></pre>\n\n<p>rather than re-joining <code>x2</code> and <code>xs</code> to recurse.</p>\n\n<p><a href=\"https://tio.run/##y0gszk7Nyfn/Py1PwcpKwTOvREHXTiEaSMeCGECaCyhTqaBRYWhVUeygUWFkFa@pqVADFLK1VagwUgAShlwKWECNQn5JRmpReWZxKlAR2JCKYpBh8UBoq6BryMWVm5iZB2QWlJYElxT55CmoKBRn5JcDKaAqU4VoQx0jHWMdEx3T2P//AQ\" rel=\"nofollow noreferrer\" title=\"Haskell \u2013 Try It Online\">Try it online!</a></p>\n\n<hr>\n\n<p>As gallais points out in the comments:</p>\n\n<p>Note that this function can take the more polymorphic form <code>Eq a =&gt; a -&gt; [a] -&gt; a</code>. This is just a change to the type signature</p>\n\n<pre><code>fn :: Eq a =&gt; a -&gt; [a] -&gt; a\n</code></pre>\n\n<p>This lets you use <code>fn</code> with other useful types, i.e. <code>fn '#' \"I'm #1!\"</code> gives <code>'1'</code></p>\n\n<p>Also a better return value here might be a <code>Maybe Int</code> (or a <code>Maybe a</code> in the polymorphic form), since you'll have some lists that don't contain the search term.</p>\n\n<pre><code>fn :: Eq a =&gt; a -&gt; [a] -&gt; Maybe a\nfn y (x1:xs@(x2:_)) | y == x2 = Just x1\n                    | otherwise = fn y xs\nfn _ _ = Nothing\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 5932985, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b5e649739640c02df1c12ef3069affbd?s=128&d=identicon&r=PG&f=1", "display_name": "STRAN", "link": "https://stackoverflow.com/users/5932985/stran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 46720298, "answer_count": 1, "score": 1, "last_activity_date": 1507919736, "creation_date": 1507850049, "last_edit_date": 1507852261, "question_id": 46720233, "link": "https://stackoverflow.com/questions/46720233/haskell-recursion-functions-and-syntax", "title": "Haskell recursion functions and syntax", "body": "<p>I am quite new to haskell and was tasked with creating a function that takes an int and a list of ints, the function would find the inputted ints position and return the value prior to it, ex fn 5 [1,2,3,4,5,6] would return 4. I'm having many problems getting started. First off I keep getting Variable is not in scope errors.</p>\n\n<pre><code>fn' ::Int-&gt;[Int]-&gt;Int\nfn' y [] = -1\nfn' y (x:xs)\n    |y = (head listail) = x \n    |otherwise = listail\n    where listail = fn' y (tail)xs\n</code></pre>\n\n<p>Where should I start looking at, and in general are there other things I should or shouldn't do?</p>\n\n<p>Adams code error      </p>\n\n<pre><code>main.hs:3:31: error:\n\n\u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018[Int]\u2019\n\u2022 In the expression: fn y x2 : xs\n  In an equation for \u2018fn\u2019:\n      fn y (x1 : x2 : xs)\n        | y == x2 = x1\n        | otherwise = fn y x2 : xs\nmain.hs:3:36: error:\n\u2022 Couldn't match expected type \u2018[Int]\u2019 with actual type \u2018Int\u2019\n\u2022 In the second argument of \u2018fn\u2019, namely \u2018x2\u2019\n  In the first argument of \u2018(:)\u2019, namely \u2018fn y x2\u2019\n  In the expression: fn y x2 : xs\n&lt;interactive&gt;:3:1: error:\n\u2022 Variable not in scope: main\n\u2022 Perhaps you meant \u2018min\u2019 (imported from Prelude)\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507846928, "post_id": 46718726, "comment_id": 80386222, "body": "I recommend you stop thinking in terms of \u201cvector lengths\u201d entirely, and let the type system deal with <a href=\"http://hackage.haskell.org/package/vector-space\" rel=\"nofollow noreferrer\">vector-<i>spaces</i></a> instead. Not only does this make type-level-numbers unnecessary, it also makes much better use of the type system, focusing on the <i>conceptual structure</i> of vectors, rather than their expansion in some arbitrary basis. You can e.g. work on <a href=\"http://hackage.haskell.org/package/linearmap-category\" rel=\"nofollow noreferrer\">spaces of linear operators</a>, without any of the awkward flattening/reshaping this would require in Matlab."}, {"owner": {"reputation": 1423, "user_id": 1480605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/98d26ead0d4b27f07e8444bea07a3949?s=128&d=identicon&r=PG", "display_name": "Hew Wolff", "link": "https://stackoverflow.com/users/1480605/hew-wolff"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507889710, "post_id": 46718726, "comment_id": 80401106, "body": "Interesting, @leftaroundabout.  Any sample code around?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507890667, "post_id": 46718726, "comment_id": 80401635, "body": "I use vector spaces mostly for solving differential equations, <a href=\"https://gist.github.com/leftaroundabout/35396046ea0a779a00cbb29c6ba76833\" rel=\"nofollow noreferrer\">here&#39;s one simple example</a> (numerically solving the <a href=\"https://en.wikipedia.org/wiki/Three-body_problem#Circular\" rel=\"nofollow noreferrer\">restricted three-body problem</a>, with a <a href=\"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#The_Runge.E2.80.93Kutta_method\" rel=\"nofollow noreferrer\">4th order Runge-Kutta solver</a>)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507890671, "post_id": 46718726, "comment_id": 80401639, "body": "The best-known application is probably <a href=\"http://hackage.haskell.org/package/diagrams\" rel=\"nofollow noreferrer\">diagrams</a>, which was originally parameterised to \u201cdraw graphics in an arbitrary affine space\u201d. (It has by now switched to the <a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\">linear library</a> \u2013 which is a bit less elegant IMO but still doesn&#39;t explicitly talk about dimensions/vector-lengths \u2013 because that apparently gives better performance in the low-dimensional case which you always have, because drawing diagrams in more than 3-dimensional space is a bit crazy...)"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1507842588, "creation_date": 1507842588, "answer_id": 46718948, "question_id": 46718726, "link": "https://stackoverflow.com/questions/46718726/why-is-int-not-promotable/46718948#46718948", "title": "Why is Int not promotable?", "body": "<p><code>Int</code> is promotable in principle, but the implementation work hasn't (yet?) been done. They are implemented at the term level as hardware words, with primitive operations implemented as C or assembly routines; each such operation one would want to use at the type level (including \"convert this compile-time constant to an <code>Int</code>\"!) would need to be promoted by hand, and as far as I know this hasn't been done.</p>\n\n<p>Use a standard algebraic definition of numbers -- e.g. Peano nats or lists of bits -- instead, as algebraic types can be promoted with the existing implementation. Although I haven't done enough to have a recommendation for a specific one, there should be several implementations of these available on Hackage somewhere.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1507846131, "post_id": 46718957, "comment_id": 80385954, "body": "To be clear, <code>GHC.TypeLits.Nat</code> isn&#39;t really promotable in the usual sense. There is no (non-bottom) value of type <code>Nat</code>, only types of kind <code>Nat</code>. I don&#39;t think this matters to the OP, but anyways..."}], "tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": 7, "last_activity_date": 1507842622, "creation_date": 1507842622, "answer_id": 46718957, "question_id": 46718726, "link": "https://stackoverflow.com/questions/46718726/why-is-int-not-promotable/46718957#46718957", "title": "Why is Int not promotable?", "body": "<p>While I can't speak as to why <code>Int</code> isn't promotable, I can suggest using a similar promotable type <code>GHC.TypeLits.Nat</code>. Your second example works verbatim with this definition of <code>Point'</code></p>\n\n<pre><code>import GHC.TypeLits\n\ndata Point' :: Nat -&gt; * where\n    Point' :: Int -&gt; [Int] -&gt; Point' d\n</code></pre>\n\n<p>I'd also suggest explicitly typing <code>origin</code> or else GHC may have a difficult time inferring the type, since the <code>d</code> in <code>Point d</code> is a phantom type.</p>\n"}], "owner": {"reputation": 1423, "user_id": 1480605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/98d26ead0d4b27f07e8444bea07a3949?s=128&d=identicon&r=PG", "display_name": "Hew Wolff", "link": "https://stackoverflow.com/users/1480605/hew-wolff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 46718948, "answer_count": 2, "score": 4, "last_activity_date": 1507842622, "creation_date": 1507841647, "question_id": 46718726, "link": "https://stackoverflow.com/questions/46718726/why-is-int-not-promotable", "title": "Why is Int not promotable?", "body": "<p>I'd like to have points in two or three dimensions such that the two-dimensional points and the three-dimensional points can share code, but the compiler can tell them apart.  Here's a first attempt.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures #-}\n\ndata Dimension = D2 | D3\ndata Point :: Dimension -&gt; * where\n  Point :: Dimension -&gt; [Int] -&gt; Point d\norigin = Point D2 [0, 0]\n</code></pre>\n\n<p>That works OK so far.  Here's a simplified version:</p>\n\n<pre><code>data Point' :: Int -&gt; * where\n  Point' :: Int -&gt; [Int] -&gt; Point' d\norigin' = Point' 2 [0, 0]\n</code></pre>\n\n<p>This does not compile: <code>\u2018Int\u2019 of kind \u2018*\u2019 is not promotable</code>.  <a href=\"https://downloads.haskell.org/~ghc/7.10.3/docs/html/users_guide/promotion.html\" rel=\"nofollow noreferrer\">The documentation on datatype promotion</a> for GHC 7.10.3 lists various reasons that a type might not be promotable (for example, if it already involves promoted types), but I don't see why they would exclude Int.</p>\n\n<p>(1) Why is it giving this error?</p>\n\n<p>And as a bonus,</p>\n\n<p>(2) Is there a reasonable fix or alternate approach?  A search shows, for example, <a href=\"https://blog.jle.im/entry/fixed-length-vector-types-in-haskell.html\" rel=\"nofollow noreferrer\">Fixed-Length Vector Types in Haskell</a>, but that seems overcomplicated.</p>\n"}, {"tags": ["list", "haskell", "template-haskell", "data-kinds"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507838760, "post_id": 46718002, "comment_id": 80382326, "body": "Why do you need a <code>w</code> if the constructor takes a type <code>Int</code>?"}, {"owner": {"reputation": 119, "user_id": 1612614, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1eb300f91a6949bb637dfe98bbb9d11f?s=128&d=identicon&r=PG", "display_name": "Matt Ahrens", "link": "https://stackoverflow.com/users/1612614/matt-ahrens"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507838801, "post_id": 46718002, "comment_id": 80382346, "body": "This is just an example, my statically defined code is using the phantom type to give some static guarantees"}, {"owner": {"reputation": 119, "user_id": 1612614, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1eb300f91a6949bb637dfe98bbb9d11f?s=128&d=identicon&r=PG", "display_name": "Matt Ahrens", "link": "https://stackoverflow.com/users/1612614/matt-ahrens"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507838881, "post_id": 46718002, "comment_id": 80382380, "body": "My problem would persist just the same if the w was used in the RHS of GenMe&#39;s Data Constructors"}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 1612614, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1eb300f91a6949bb637dfe98bbb9d11f?s=128&d=identicon&r=PG", "display_name": "Matt Ahrens", "link": "https://stackoverflow.com/users/1612614/matt-ahrens"}, "edited": false, "score": 0, "creation_date": 1507843878, "post_id": 46718353, "comment_id": 80384958, "body": "In my real use case, Foo takes a list of arguments to its data constructor. <code>data Foo = Foo [Int] [Int]</code> So, let me try extending your promote with PromotedConsT and PromotedNilT and see what happens, but otherwise this looks like the correct answer to me :) Thank you"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 119, "user_id": 1612614, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1eb300f91a6949bb637dfe98bbb9d11f?s=128&d=identicon&r=PG", "display_name": "Matt Ahrens", "link": "https://stackoverflow.com/users/1612614/matt-ahrens"}, "edited": false, "score": 0, "creation_date": 1507844208, "post_id": 46718353, "comment_id": 80385121, "body": "@MattAhrens That&#39;s a tougher case. Have fun trying it out. I&#39;ve also edited the answer to include it."}, {"owner": {"reputation": 119, "user_id": 1612614, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1eb300f91a6949bb637dfe98bbb9d11f?s=128&d=identicon&r=PG", "display_name": "Matt Ahrens", "link": "https://stackoverflow.com/users/1612614/matt-ahrens"}, "edited": false, "score": 0, "creation_date": 1507844710, "post_id": 46718353, "comment_id": 80385353, "body": "Yep! I got to the same answer for that case, thanks a bunch for your help."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1507844724, "last_edit_date": 1507844724, "creation_date": 1507840142, "answer_id": 46718353, "question_id": 46718002, "link": "https://stackoverflow.com/questions/46718002/generating-a-type-annotation-using-datakinds-within-a-th-quasiquote/46718353#46718353", "title": "Generating a type annotation using DataKinds within a TH QuasiQuote", "body": "<p>Another way to slice this problem is to define a <code>promote :: Exp -&gt; Maybe Type</code> function and then use <a href=\"https://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH-Syntax.html#v:lift\" rel=\"nofollow noreferrer\"><code>lift</code></a> on <code>Foo</code>.</p>\n\n<pre><code>-- | Takes the AST for an expression and tries to produce the corresponding\n-- promoted type AST.\npromote :: Exp -&gt; Q Type\npromote (VarE n) = fail (\"Cannot promote variable \" ++ show n)\npromote (ConE n) = pure (PromotedT n)\npromote (LitE l) = LitT &lt;$&gt; promoteLit l\npromote (TupE es) = foldl AppT (PromotedTupleT (length es)) &lt;$&gt; (traverse promote es)\npromote (ListE es) = foldr (\\x xs -&gt; AppT (AppT PromotedConsT x) xs) PromotedNilT &lt;$&gt; (traverse promote es)\npromote (ParensE e) = ParensT &lt;$&gt; promote e\npromote (AppE e1 e2) = AppT &lt;$&gt; promote e1 &lt;*&gt; promote e2\npromote (InfixE (Just e1) e2 (Just e3)) = AppT &lt;$&gt; (AppT &lt;$&gt; promote e2 &lt;*&gt; promote e1) &lt;*&gt; promote e3\npromote _ = fail \"Either impossible to promote or unimplemented\"\n\n-- | Promote an expression literal to a type one\npromoteLit :: Lit -&gt; Q TyLit\npromoteLit (StringL s) = pure (StrTyLit s)\npromoteLit (IntegerL i) = pure (NumTyLit i)\npromoteLit _ = fail \"Expression literal cannot be promoted\"\n</code></pre>\n\n<p>Then, I think something along the lines of the following should work</p>\n\n<pre><code>ghci&gt; :set -XDeriveLift -XDataKinds -XKindSignatures -XTemplateHaskell -XQuasiQuotes\nghci&gt; data Foo = A | B deriving (Lift)\nghci&gt; foo1 = A\nghci&gt; data GenMe (w :: Foo) = GenMe Int\nghci&gt; runQ [| GenMe 1 :: GenMe $(promote =&lt;&lt; lift foo1) |]\nSigE (AppE (ConE Ghci5.GenMe) (LitE (IntegerL 1))) (AppT (ConT Ghci5.GenMe) (PromotedT Ghci3.A))\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 1612614, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1eb300f91a6949bb637dfe98bbb9d11f?s=128&d=identicon&r=PG", "display_name": "Matt Ahrens", "link": "https://stackoverflow.com/users/1612614/matt-ahrens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 46718353, "answer_count": 1, "score": 2, "last_activity_date": 1508178722, "creation_date": 1507838708, "last_edit_date": 1508178722, "question_id": 46718002, "link": "https://stackoverflow.com/questions/46718002/generating-a-type-annotation-using-datakinds-within-a-th-quasiquote", "title": "Generating a type annotation using DataKinds within a TH QuasiQuote", "body": "<p>In a haskell project using template haskell, I am trying to generate an expression that has a type annotation as a phantom type.</p>\n\n<p>A simple example would be a situation with <code>DataKinds</code> and <code>KindSignatures</code> like:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures #-}\ndata Foo = A | B\ndata GenMe (w :: Foo) = GenMe Int\n\n[| $(generate some code) :: GenMe $(genType someCompileTimeData) |]\n</code></pre>\n\n<p>How can I write a function, like <code>genType</code> such that</p>\n\n<pre><code>genType :: Foo -&gt; Q Type\n</code></pre>\n\n<p>lifting just lifts the variable holding the compile time <code>Foo</code> value? I don't know which constructor to use from the <a href=\"https://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:Type\" rel=\"nofollow noreferrer\">Type Data Constructors</a>\nto make data kinds.</p>\n\n<p>Any thoughts? Thanks!</p>\n"}]