[{"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1502938421, "post_id": 45723921, "comment_id": 78409267, "body": "What is the total file size you are trying to download ? That may be a good check to see for other&#39;s if it&#39;s reproducible."}, {"owner": {"reputation": 23, "user_id": 6850255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7e548a96df1ab64d22bfa7b21b03a8?s=128&d=identicon&r=PG&f=1", "display_name": "frankhucek", "link": "https://stackoverflow.com/users/6850255/frankhucek"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1502970572, "post_id": 45723921, "comment_id": 78426248, "body": "Maybe only a few MB. Right now I&#39;m just using it for pictures. Using an existing file server written in Scotty, its send file function doesn&#39;t have a problem with the same files."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1502984288, "post_id": 45723921, "comment_id": 78436569, "body": "Maybe you should show us some code."}], "owner": {"reputation": 23, "user_id": 6850255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7e548a96df1ab64d22bfa7b21b03a8?s=128&d=identicon&r=PG&f=1", "display_name": "frankhucek", "link": "https://stackoverflow.com/users/6850255/frankhucek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503000128, "creation_date": 1502922390, "last_edit_date": 1503000128, "question_id": 45723921, "link": "https://stackoverflow.com/questions/45723921/haskell-yesod-serving-large-file-issue", "title": "Haskell Yesod serving large file issue", "body": "<p>I'm working on a Yesod file server, and I need to be able to serve larger files (in this case, pictures) as well. </p>\n\n<p>I have a static file subsite set up to serve the desired directory. Whenever I try to download those larger files, Yesod responds with a 206 Partial Content response, only sending part of the file, and it eventually times out.</p>\n\n<p>I'm also having this issue when serving files with <code>sendFile</code> from <code>Yesod.Core.Handler</code>. I thought that <code>sendFile</code> was trying to load the whole file into memory which may have accounted for the slow speed, but then I looked at the docs and realized this isn't the case.</p>\n\n<p>EDIT: After playing around with a few things, I managed to solve the problem. I was using the <code>warp-tls</code> package to host my <code>Yesod</code> App over SSL using the <code>runTLS</code> function. It should have occurred to me that these files would have to be read into memory in order to encrypt them. This caused the time outs and failed downloads that I was seeing. </p>\n\n<p>I fixed this by running my <code>Yesod</code> app without the <code>warp-tls</code> package using instead the <code>warpDebug</code> function that <code>Yesod</code> provides, and I served it over SSL with an nginx reverse proxy.</p>\n"}, {"tags": ["debugging", "haskell", "ghci"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502920881, "post_id": 45723197, "comment_id": 78405173, "body": "What are the contents of <code>Api.Checklist</code>?"}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502922354, "post_id": 45723197, "comment_id": 78405605, "body": "@user2407038 contents of <code>Api.Checklist</code> are posted as requested."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1502922650, "post_id": 45723197, "comment_id": 78405699, "body": "Assuming I&#39;ve read the code correctly, line 207 contains precisely <code>checklistAnswerPG entryId apiAnswer =</code>. From the docs: &quot;When a breakpoint is set on a particular line, GHCi sets the breakpoint on the leftmost subexpression&quot; - is there an expression on that line at all?"}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502922810, "post_id": 45723197, "comment_id": 78405767, "body": "@user2407038 I guess not. But I have been able to set breakpoints on top-level function definitions before -- is this case different because the function is defined within a <code>where</code> clause?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502923511, "post_id": 45723197, "comment_id": 78405975, "body": "You are not setting a breakpoint on a function, you are setting a breakpoint on a line. There are multiple different syntaxes for setting breakpoints, and they have different semantics. The syntax you are asking about doesn&#39;t permit setting a breakpoint on a declaration, top-level or local. I would reiterate once more, but I feel that the <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/ghci-debugger.html#setting-breakpoints\" rel=\"nofollow noreferrer\">docs</a> explain it quite clearly."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502923670, "post_id": 45723197, "comment_id": 78406037, "body": "@user2407038 okay, thank you for the help."}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 345, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1502922694, "creation_date": 1502918476, "last_edit_date": 1502922694, "question_id": 45723197, "link": "https://stackoverflow.com/questions/45723197/ghci-error-no-breakpoints-found-at-that-location", "title": "ghci error: &quot;No breakpoints found at that location.&quot;", "body": "<p>I am attempting to follow the <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/ghci-debugger.html\" rel=\"nofollow noreferrer\">ghci debugger documentation</a> to my stack project, and have entered the repl by running <code>$ stack ghci</code>. When I try to set a breakpoint at line 207 in module <code>Api.Checklist</code>, I get the following error.</p>\n\n<pre><code>&gt; :break Api.Checklist 207\nNo breakpoints found at that location.\n</code></pre>\n\n<p>The breakpoint is not set, as shown by the empty result of <code>:show breaks</code>.</p>\n\n<pre><code>&gt; :show breaks\nNo active breakpoints.\n</code></pre>\n\n<p>Why does <code>&gt; :break Api.Checklist 207</code> fail to set the breakpoint?</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>as requested, the content of Api.Checklist is below, where line <code>207</code> is the line reading <code>checklistAnswerPG entryId apiAnswer =</code>.</p>\n\n<pre><code>{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE DeriveGeneric         #-}\n{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE ExtendedDefaultRules  #-}\n{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE TypeOperators         #-}\n\nmodule Api.Checklist where\n\nimport           Control.Monad            (mapM, mapM_)\nimport           Control.Monad.IO.Class   (liftIO)\nimport           Data.Aeson               (FromJSON, Value(..),\n                                           toJSON, encode)\nimport qualified Data.HashMap.Strict      as M\nimport           Data.Text                (Text, pack)\nimport           Data.Time.Clock          (UTCTime, getCurrentTime)\nimport           GHC.Generics             (Generic)\nimport qualified Opaleye                  as O\nimport           Servant\n\nimport           Api.Shared\nimport           App\nimport           Models.Checklist\nimport           Models.ChecklistAnswer\nimport           Models.ChecklistEntry\nimport           Models.ChecklistQuestion\nimport           Models.ChecklistTemplate\nimport           Models.Validation        (Errors(..), Validatable,\n                                           Validation,\n                                           ValidationResult (Failure, Success),\n                                           errors, failure, keyToField,\n                                           validate, validateEntity)\nimport           Queries.Checklist\nimport           Types.JWTUser\n\ndata ApiAnswer = ApiAnswer { questionId :: Int, answer :: Maybe Bool }\n  deriving (Generic)\ndata ApiChecklistEntryWrite = ApiChecklistEntryWrite { answers :: [ApiAnswer] }\n  deriving (Generic)\n\ninstance FromJSON ApiAnswer\ninstance FromJSON ApiChecklistEntryWrite\ninstance Validatable ApiChecklistEntryWrite where\n  validateEntity entry = do\n    mapM_ validateAnswer $ answers entry\n\n    where\n      validateAnswer :: ApiAnswer -&gt; Validation\n      validateAnswer apiAnswer = do\n        case answer (apiAnswer :: ApiAnswer) of\n          Just _ -&gt;\n            return ()\n\n          Nothing -&gt;\n            failure (pack $ \"answers[questionId=\" ++ show (questionId (apiAnswer :: ApiAnswer)) ++ \"]\") [\"must not be null\"]\n\n\ntype ChecklistAPI = Get '[JSON] ChecklistRead\n               :&lt;|&gt; ReqBody '[JSON] TemplateChecklist :&gt; Patch '[JSON] ChecklistRead\n               :&lt;|&gt; \"entries\" :&gt; Get '[JSON] [ChecklistEntryRead]\n               :&lt;|&gt; \"entries\" :&gt; Capture \"checklistEntryId\" Int :&gt; Get '[JSON] ChecklistEntryRead\n               :&lt;|&gt; \"entries\" :&gt; ReqBody '[JSON] ApiChecklistEntryWrite :&gt; Post '[JSON] ChecklistEntryRead\n               :&lt;|&gt; \"questions\" :&gt; Get '[JSON] [ChecklistQuestionRead]\n               :&lt;|&gt; \"entries\" :&gt; Capture \"entryId\" Int :&gt; \"answers\" :&gt; Get '[JSON] [Value]\n\n\nchecklistAPI :: Servant.Proxy ChecklistAPI\nchecklistAPI = Servant.Proxy\n\n\nchecklistServer :: JWTUser -&gt; Int -&gt; ServerT ChecklistAPI AppM\nchecklistServer jwtUser checklistId' = getChecklist jwtUser checklistId'\n                                 :&lt;|&gt; updateChecklist jwtUser checklistId'\n                                 :&lt;|&gt; getChecklistEntries jwtUser checklistId'\n                                 :&lt;|&gt; getChecklistEntry jwtUser checklistId'\n                                 :&lt;|&gt; createChecklistEntry jwtUser checklistId'\n                                 :&lt;|&gt; getChecklistQuestions jwtUser checklistId'\n                                 :&lt;|&gt; getChecklistAnswers jwtUser checklistId'\n\n\ngetChecklist :: JWTUser -&gt; Int -&gt; AppM ChecklistRead\ngetChecklist _ = singleQuery . checklistQuery\n\n\nupdateChecklist :: JWTUser -&gt; Int -&gt; TemplateChecklist -&gt; AppM ChecklistRead\nupdateChecklist jwtUser checklistId' template' = withTransaction $ do\n  case validate template' of\n    Success -&gt;\n      go\n\n    Failure es -&gt;\n      throwError $ err422 { errBody = encode $ Errors { errors = es } }\n\n  where\n    go = do\n      originalChecklist &lt;- singleQuery (checklistQuery checklistId')\n      let facilityId' = facilityId (originalChecklist :: ChecklistRead)\n          checklistWrite = ChecklistWrite { facilityId = facilityId'\n                                          , name = name (template' :: TemplateChecklist)\n                                          }\n\n      updatedChecklist &lt;- liftIO . checklistToPG $ checklistWrite\n      result &lt;- update\n                jwtUser\n                (Just facilityId')\n                checklistTable\n                (\\_ -&gt; updatedChecklist { Models.Checklist.checklistId = Just $ O.pgInt4 checklistId' })\n                (\\org -&gt; (Models.Checklist.checklistId org) O..== O.pgInt4 checklistId')\n\n      case result of\n        Left err -&gt;\n          handleSqlError (keyToField template') err\n\n        Right savedChecklist -&gt; do\n          updateQuestions savedChecklist\n          return savedChecklist\n\n    updateQuestions savedChecklist = do\n      let facilityId' = facilityId (savedChecklist :: ChecklistRead)\n      now &lt;- liftIO getCurrentTime\n      archivePreviousQuestions now facilityId'\n      mapM_ (createQuestion savedChecklist now) $ questions template'\n      return ()\n\n    createQuestion :: ChecklistRead -&gt; UTCTime -&gt; TemplateQuestion -&gt; AppM ChecklistQuestionRead\n    createQuestion savedChecklist now question' = do\n      let facilityId' = facilityId (savedChecklist :: ChecklistRead)\n      newChecklistQuestion &lt;-\n        liftIO . checklistQuestionToPG now $ ChecklistQuestionWrite\n                                             (checklistId (savedChecklist :: ChecklistRead))\n                                             (question (question' :: TemplateQuestion))\n                                             (description (question' :: TemplateQuestion))\n                                             (questionType (question' :: TemplateQuestion))\n                                             (position (question' :: TemplateQuestion))\n      createOr500\n        (keyToField template')\n        jwtUser\n        (Just facilityId')\n        checklistQuestionTable\n        newChecklistQuestion\n\n    archivePreviousQuestions now facilityId' = do\n      previousQuestions &lt;- query (checklistQuestionsByChecklistAndTimeQuery checklistId' now)\n      mapM_ (archiveQuestion now facilityId') previousQuestions\n\n    archiveQuestion :: UTCTime -&gt; Int -&gt; ChecklistQuestionRead -&gt; AppM ChecklistQuestionRead\n    archiveQuestion now facilityId' question' = do\n      updatedQuestion &lt;- liftIO . checklistQuestionReadToWrite $ question'\n      updateOr500 (keyToField template') jwtUser (Just facilityId') checklistQuestionTable\n                (\\_ -&gt; updatedQuestion { effectiveTo = O.pgUTCTime now })\n                (\\q -&gt; Models.ChecklistQuestion.checklistQuestionId q O..== O.pgInt4 (Models.ChecklistQuestion.checklistQuestionId question'))\n\n\n\ngetChecklistEntry :: JWTUser -&gt; Int -&gt; Int -&gt; AppM ChecklistEntryRead\ngetChecklistEntry _ _ = singleQuery . checklistEntryQuery\n\n\ngetChecklistEntries :: JWTUser -&gt; Int -&gt; AppM [ChecklistEntryRead]\ngetChecklistEntries _  = query . checklistEntryByChecklistQuery\n\n\ngetChecklistQuestions :: JWTUser -&gt; Int -&gt; AppM [ChecklistQuestionRead]\ngetChecklistQuestions _ checklistId' =\n  query . checklistQuestionsByChecklistAndTimeQuery checklistId' =&lt;&lt; liftIO getCurrentTime\n\n\ngetChecklistAnswers :: JWTUser -&gt; Int -&gt; Int -&gt; AppM [Value]\ngetChecklistAnswers _ _ id =\n  fmap buildJson &lt;$&gt; (query $ checklistAnswersWithQuestionForChecklistEntryQuery id)\n\n  where\n    buildJson :: (ChecklistAnswerRead, ChecklistQuestionRead) -&gt; Value\n    buildJson (a, q) =\n      let\n        Object jsonAnswer = toJSON a\n        jsonQuestion = toJSON q\n      in\n        Object (M.insert \"checklistQuestion\" jsonQuestion jsonAnswer)\n\n\ncreateChecklistEntry :: JWTUser -&gt; Int -&gt; ApiChecklistEntryWrite -&gt; AppM ChecklistEntryRead\ncreateChecklistEntry jwtUser cId checklistEntryWrite = do\n  checklist &lt;- singleQuery (checklistQuery cId) :: AppM ChecklistRead\n  withTransaction $ validateAndCreate (go $ facilityId (checklist :: ChecklistRead)) checklistEntryWrite\n\n  where\n    go facId = do\n      newChecklistEntry &lt;- liftIO . checklistEntryToPG $ ChecklistEntryWrite cId\n      savedChecklistEntry &lt;- create jwtUser (Just facId) checklistEntryTable newChecklistEntry\n\n      case savedChecklistEntry of\n        Right checklistEntry -&gt; do\n          let newChecklistAnswerPG = checklistAnswerPG $ checklistEntryId (checklistEntry :: ChecklistEntryRead)\n\n          createdAnswers &lt;- mapM newChecklistAnswerPG $ answers checklistEntryWrite\n          results &lt;- mapM (create jwtUser (Just facId) checklistAnswerTable) createdAnswers :: AppM [DbResult ChecklistAnswerRead]\n          case all isRight results of\n            True -&gt;\n              return checklistEntry\n            False -&gt;\n              throwError $ err500 { errBody = \"one or more answers failed to save\" }\n\n        Left _ -&gt;\n          throwError err500\n\n    checklistAnswerPG entryId apiAnswer =\n      case answer (apiAnswer :: ApiAnswer) of\n        Just a -&gt;\n          liftIO $ checklistAnswerToPG $ ChecklistAnswerWrite { checklistEntryId = entryId\n                                                              , checklistQuestionId = questionId apiAnswer\n                                                              , answer = boolToText a\n                                                              }\n        Nothing -&gt;\n          throwError $ err500 { errBody = \"got a null answer, validations should have happened by now\" }\n\n    boolToText :: Bool -&gt; Text\n    boolToText True  = \"true\"\n    boolToText False = \"false\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502914372, "post_id": 45722194, "comment_id": 78402481, "body": "To be clear on the intended semantics: if a node satisfies the removal condition, you promote all of its children up (and then also try removing them)?"}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502914434, "post_id": 45722194, "comment_id": 78402514, "body": "Yes, that&#39;s correct"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502914471, "post_id": 45722194, "comment_id": 78402531, "body": "Then what happens if the root satisfies the condition?"}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502914546, "post_id": 45722194, "comment_id": 78402579, "body": "All its children will be moved up"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502914655, "post_id": 45722194, "comment_id": 78402632, "body": "I must not be clear: by &quot;move up&quot; I mean raise the children to be at the same level as their parent was previously. The problem is that the root has no parent list to which its children should be moved up. What would be the new root?"}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502915102, "post_id": 45722194, "comment_id": 78402836, "body": "Aha, I see what you mean. Good question, I don&#39;t know :)"}, {"owner": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "edited": false, "score": 0, "creation_date": 1502915804, "post_id": 45722194, "comment_id": 78403122, "body": "Shouldn&#39;t there be additional filtering going on in this case: <code>then (extractChild rTree)</code>?"}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "reply_to_user": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "edited": false, "score": 0, "creation_date": 1502915946, "post_id": 45722194, "comment_id": 78403173, "body": "@JamesWilcox: I tried that. If I do <code>then (extractChild $ filterTree condition rTree)</code> or <code>then (filterTree condition $ extractChild rTree)</code>, it causes infinite loop."}, {"owner": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "edited": false, "score": 0, "creation_date": 1502916214, "post_id": 45722194, "comment_id": 78403303, "body": "Well yeah, the first one obviously loops. The second one also loops because <code>extractChild</code> sometimes doesn&#39;t do anything. I don&#39;t really understand why <code>extractChild</code> is defined the way it is. It means that if there&#39;s not exactly one child, then nothing gets removed?"}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "reply_to_user": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "edited": false, "score": 0, "creation_date": 1502916511, "post_id": 45722194, "comment_id": 78403428, "body": "@JamesWilcox: Yes, that&#39;s correct. Generally for RoseTree, if there is more than one child, then it is not clear where to assign them after deletion of parent. In my case doing transfer of only one child makes sense because of the nature of data I want to use it with. It always contains only single child in the place where parent is to be removed due to matching condition."}], "answers": [{"comments": [{"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1502917841, "post_id": 45722979, "comment_id": 78403980, "body": "Sorry, I haven&#39;t specified in the previous comment that my data structure <i>can</i> have more than one child. It is just that <i>removed</i> elements (matching condition) in my data structure have only one child. I should probably update the question with more details..."}, {"owner": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "reply_to_user": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1502917885, "post_id": 45722979, "comment_id": 78404001, "body": "@altern I believe this solution still works in that case. If not, can you give another example input that demonstrates the problem?"}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1502918110, "post_id": 45722979, "comment_id": 78404082, "body": "If I do <code>filterTree (==2) (RoseTree 1 [ RoseTree 2 [ RoseTree 4 [], RoseTree 3 [ RoseTree 2 [RoseTree 1[]]] ]])</code> with your solution, it goes into infinite loop."}, {"owner": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "reply_to_user": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1502918170, "post_id": 45722979, "comment_id": 78404106, "body": "@altern But that violates your precondition that all nodes matching the filter condition will have exactly one child. The first matching node has two children."}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1502920299, "post_id": 45722979, "comment_id": 78404965, "body": "I had a small hiccup with something else that prevented me from validating your solution. Found an error in my program that incorrectly matched an element that does not have children. Given that error is fixed, your solution seems to work, thanks!"}], "tags": [], "owner": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "is_accepted": true, "score": 2, "last_activity_date": 1502917466, "creation_date": 1502917466, "answer_id": 45722979, "question_id": 45722194, "link": "https://stackoverflow.com/questions/45722194/filtering-out-elements-in-rosetree/45722979#45722979", "title": "Filtering out elements in RoseTree", "body": "<p>The following works for me on the examples you provided.</p>\n\n<p>Note that it will loop if a node ever matches the filter condition and does not have exactly one child.</p>\n\n<pre><code>filterTree :: ( a -&gt; Bool ) -&gt; RoseTree a -&gt; RoseTree a\nfilterTree condition rTree@(RoseTree a list) = \n    if (condition $ a) \n      then filterTree condition (extractChild rTree)\n      else (RoseTree a (filterTreeList condition list)) \n</code></pre>\n"}], "owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 45722979, "answer_count": 1, "score": 0, "last_activity_date": 1502917466, "creation_date": 1502914223, "question_id": 45722194, "link": "https://stackoverflow.com/questions/45722194/filtering-out-elements-in-rosetree", "title": "Filtering out elements in RoseTree", "body": "<p>I am trying to write a function <code>filterTree</code> that would filter out elements in RoseTree using given condition:</p>\n\n<pre><code>data RoseTree a = RoseTree a [RoseTree a]\n                   deriving (Show, Functor)\n\nextractChild :: RoseTree a -&gt; RoseTree a\nextractChild (RoseTree _ (x:[])) = x\nextractChild rTree = rTree\n\nfilterTree :: ( a -&gt; Bool ) -&gt; RoseTree a -&gt; RoseTree a\nfilterTree condition rTree@(RoseTree a list) = \n    if (condition $ a) \n      then (extractChild rTree)  \n      else (RoseTree a (filterTreeList condition list)) \n\nfilterTreeList :: (a -&gt; Bool) -&gt; [RoseTree a] -&gt; [RoseTree a]\nfilterTreeList condition [] = []\nfilterTreeList condition (x:xs) = [filterTree condition x] ++ (filterTreeList condition xs)\n</code></pre>\n\n<p>But it does not work quite as expected. For some reason it does not filter out nested elements that satisfy the condition. For example, if I run </p>\n\n<pre><code>filterTree (==2) (RoseTree 1 [ RoseTree 2 [ RoseTree 3 [] ]])\n</code></pre>\n\n<p>then it runs fine returning <code>RoseTree 1 [RoseTree 3 []]</code>. But if I run it with one more nested element that satisfies the condition</p>\n\n<pre><code>filterTree (==2) (RoseTree 1 [ RoseTree 2 [ RoseTree 3 [RoseTree 2 [RoseTree 1[]]] ]])\n</code></pre>\n\n<p>then it returns erroneous result having second matching element in the list: <code>RoseTree 1 [RoseTree 3 [RoseTree 2 [RoseTree 1 []]]]</code></p>\n\n<p>Any ideas why this might be happening?</p>\n"}, {"tags": ["haskell", "frp"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1502916856, "post_id": 45722021, "comment_id": 78403578, "body": "What type would <code>foldStream</code> have?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1502919943, "post_id": 45722021, "comment_id": 78404800, "body": "Presumably <code>foldStream :: (a -&gt; b -&gt; b) -&gt; b -&gt; Stream a -&gt; Stream b</code>"}, {"owner": {"reputation": 616, "user_id": 3892684, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/fs52b.png?s=128&g=1", "display_name": "Jan van Br&#252;gge", "link": "https://stackoverflow.com/users/3892684/jan-van-br%c3%bcgge"}, "edited": false, "score": 0, "creation_date": 1502951331, "post_id": 45722021, "comment_id": 78413473, "body": "just like fold for Arrays: <code>foldStream :: (b -&gt; a -&gt; b) -&gt; b -&gt; Stream a -&gt; Stream b</code>"}], "answers": [{"comments": [{"owner": {"reputation": 616, "user_id": 3892684, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/fs52b.png?s=128&g=1", "display_name": "Jan van Br&#252;gge", "link": "https://stackoverflow.com/users/3892684/jan-van-br%c3%bcgge"}, "edited": false, "score": 0, "creation_date": 1502974036, "post_id": 45731259, "comment_id": 78428679, "body": "Thanks, I already guessed that i would have to use the state monad or something similar. Just wanted to be sure that there is not a clever way to use recursion for this"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1502961819, "creation_date": 1502961819, "answer_id": 45731259, "question_id": 45722021, "link": "https://stackoverflow.com/questions/45722021/how-can-i-fold-streaming-data/45731259#45731259", "title": "How can I fold streaming data?", "body": "<p><code>foldStream</code> keeps track of state. You'll have to put that state somewhere, like in an <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-IORef.html\" rel=\"nofollow noreferrer\"><code>IORef</code></a>.</p>\n\n<pre><code>import Data.IORef\n\nfoldStream :: (a -&gt; b -&gt; b) -&gt; b -&gt; Stream a -&gt; Stream b\nfoldStream f z source = Stream $ \\observer -&gt; do\n    ref &lt;- newIORef z\n    subscribe source $ Observer $ \\a -&gt; do\n        b &lt;- readIORef ref\n        let b' = f a b\n        writeIORef ref b'\n        next observer b'\n</code></pre>\n"}], "owner": {"reputation": 616, "user_id": 3892684, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/fs52b.png?s=128&g=1", "display_name": "Jan van Br&#252;gge", "link": "https://stackoverflow.com/users/3892684/jan-van-br%c3%bcgge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1502962222, "creation_date": 1502913564, "question_id": 45722021, "link": "https://stackoverflow.com/questions/45722021/how-can-i-fold-streaming-data", "title": "How can I fold streaming data?", "body": "<p>I'm trying to implement functional reactive streams in Haskell. I have this rather simple definition:</p>\n\n<pre><code>data Observer a = Observer { next :: a -&gt; IO () }\ndata Stream a = Stream { subscribe :: Observer a -&gt; IO () }\n\ninstance Functor Stream where\n    fmap = mapStream\n\nmapStream :: (a -&gt; b) -&gt; Stream a -&gt; Stream b\nmapStream f Stream{ subscribe=s } = Stream {\n        subscribe = \\Observer{ next=n } -&gt; s Observer{ next = \\a -&gt; n $ f a }\n    }\n\n fromArray :: [a] -&gt; Stream a\n fromArray arr = Stream {\n        subscribe = \\Observer{ next=n } -&gt; forM_ arr n\n    }\n</code></pre>\n\n<p>This works well for simple operators like <code>fmap</code> above. My question is how would I implement <code>foldStream</code> for this? I can't change values, so I will have to recursively call <code>foldStream</code> with a new seed value. But I have no clue how to do this in this context. Is this even possible with my simple definition or do I need something different? Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1502897731, "post_id": 45717639, "comment_id": 78393485, "body": "You defined <code>myrunf</code>, but called <code>myrnf</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502899169, "post_id": 45717639, "comment_id": 78394524, "body": "Note that many books/articles etc. have different versions, and furthermore the same content may appear on different pages even in the same version, since multiple sources may have it typeset differently (e.g. the physical book and online version are typeset differently). I cannot find the claim you have made e.g. <a href=\"http://community.haskell.org/~simonmar/par-tutorial.pdf\" rel=\"nofollow noreferrer\">here</a> (indeed, there I only find references to &#39;weak head normal form&#39; and not &#39;normal form&#39;, which are entirely different things)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1502899318, "post_id": 45717639, "comment_id": 78394638, "body": "That&#39;s just a default implementation of the method (in older versions of the library anyway). Each instance should define an appropriate implementation."}, {"owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1502902232, "post_id": 45717639, "comment_id": 78396317, "body": "@n.m.       Ah yes my bad, that certainly clears things up... Is it usual to declare an implementation of a class method inside the class declaration itself? Because that&#39;s what the author did. Perhaps, by declaring the implementation in class, one is saying that that is the <i>default</i> implementation, unless stated otherwise in a specific instance declaration?"}, {"owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "edited": false, "score": 0, "creation_date": 1502902403, "post_id": 45717639, "comment_id": 78396388, "body": "@nm Yes, I think that is indeed what you&#39;re saying? :) Alright, I am happy, the world is in order again."}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 3, "last_activity_date": 1502904784, "last_edit_date": 1502904784, "creation_date": 1502904408, "answer_id": 45719677, "question_id": 45717639, "link": "https://stackoverflow.com/questions/45717639/seq-vs-rnf-in-haskell/45719677#45719677", "title": "seq vs. rnf in Haskell", "body": "<blockquote>\n  <p>Perhaps, by declaring the implementation in class, one is saying that that is the default implementation, unless stated otherwise in a specific instance declaration? </p>\n</blockquote>\n\n<p>Yes, that's exactly what it means. What's unusual (IMO) is that normally this default implementation is valid (i.e. does what you want) for all instances but may be overridden for efficiency or to break a cycle of default definitions (e.g. in <code>Eq</code> the default implementations are <code>x == y = not (x /= y)</code> and <code>x /= y = not (x == y)</code>, so you can override whichever is more convenient).</p>\n\n<p>But in case of <code>rnf</code>, <a href=\"https://hackage.haskell.org/package/deepseq-1.3.0.0/docs/Control-DeepSeq.html#v:rnf\" rel=\"nofollow noreferrer\">the documentation for 1.3.0.0</a> says </p>\n\n<blockquote>\n  <blockquote>\n    <p>The default implementation of <code>rnf</code> ... may be convenient when defining instances for data types with no unevaluated fields (e.g. enumerations). </p>\n  </blockquote>\n</blockquote>\n\n<p>i.e. it doesn't really work for nearly all types.</p>\n\n<p>This problem has been fixed <a href=\"https://hackage.haskell.org/package/deepseq-1.4.3.0/docs/Control-DeepSeq.html#v:rnf\" rel=\"nofollow noreferrer\">since 1.4.0.0</a>.</p>\n"}], "owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 45719677, "answer_count": 1, "score": 3, "last_activity_date": 1502904784, "creation_date": 1502897467, "last_edit_date": 1502898334, "question_id": 45717639, "link": "https://stackoverflow.com/questions/45717639/seq-vs-rnf-in-haskell", "title": "seq vs. rnf in Haskell", "body": "<p>According to the definitions given by \"Parallel and Concurrent Programming in Haskell\" on page 29, the class method \"return normal form\" is defined as:</p>\n\n<pre><code>rnf a = a `seq` ()\n</code></pre>\n\n<p>Just to see if wrapping seq in another function, as the authors prescribe, really had the result of forcing 'a' to be evaluated to normal form, I tried implementing the function myself and got a result in the negative:</p>\n\n<pre><code>Prelude Control.DeepSeq &gt; myrnf a = a `seq` ()\nPrelude Control.DeepSeq &gt; xs = map (+1) [1..10] :: [Int]\nPrelude Control.DeepSeq &gt; :sprint xs\nxs = _\nPrelude Control.DeepSeq &gt; myrunf xs\n()\nPrelude Control.DeepSeq &gt; :sprint xs\nxs = _ : _\nPrelude Control.DeepSeq &gt; rnf xs\n()\nPrelude Control.DeepSeq &gt; :sprint xs\nxs = [2,3,4,5,6,7,8,9,10,11]\n</code></pre>\n\n<p>So have the authors made a glaring mistake, or am I missing something here?</p>\n\n<p>Edit: I realised my original question contained elementary mistakes. Here is the proper form of the question.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 6, "creation_date": 1502891767, "post_id": 45715446, "comment_id": 78389084, "body": "Why not just write it in a separate .hs file and have your .ghci load that?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1502900900, "post_id": 45715446, "comment_id": 78395581, "body": "You can also write haskell using curly braces and semicolons to fit it in a oneliner: <code>what :: Show a =&gt; a -&gt; a ; what = Db.traceShowId</code>. You can do case statements:  <code>case x of {1 -&gt; &quot;one&quot;; 2 -&gt; &quot;two&quot;; _ -&gt; &quot;I don&#39;t know&quot; }</code>, instance definitions <code>instance Num a =&gt; Num (X a) { (+) =&gt; liftA2 (+); (*) = liftA2 (*); {- ... -} }</code>, and any other construct."}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1517033335, "post_id": 45715446, "comment_id": 83939914, "body": "@Cubic That worked great, I created a <code>.ghci.hs</code> file and loaded it in <code>.ghci</code> with <code>:load ~&#47;.ghci.hs</code>"}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1517033417, "post_id": 45715446, "comment_id": 83939932, "body": "@Cubic You should perhaps create an answer about that since current answer is confusing."}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1502900641, "post_id": 45715555, "comment_id": 78395422, "body": "it&#39;s worth noting that that a single multiline statement can contain either multiple definitions (like <code>newtype Unit = Unit ()</code> or a single expression (like <code>1 + 2</code>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "edited": false, "score": 0, "creation_date": 1502905471, "post_id": 45715555, "comment_id": 78398169, "body": "@hgiesel Ah, interesting. I assumed it worked. Try the alternative I added in my edit."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "edited": false, "score": 0, "creation_date": 1502909044, "post_id": 45715555, "comment_id": 78399971, "body": "@hgiesel Both methods suggested here do work for me. Can you edit your question to include the exact thing you tried? Maybe include your GHC version, as well."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1502905431, "last_edit_date": 1502905431, "creation_date": 1502891788, "answer_id": 45715555, "question_id": 45715446, "link": "https://stackoverflow.com/questions/45715446/defining-multiline-functions-in-ghci-file/45715555#45715555", "title": "Defining multiline functions in .ghci file", "body": "<p>The .ghci file is not the proper place for such definitions.</p>\n\n<p>Still, if you really must, you can use</p>\n\n<pre><code>:{\nline1\nline2\n...\n:}\n</code></pre>\n\n<p>otherwise, you can try to put the whole definition in one line</p>\n\n<pre><code>line1 ; line2 ; ...\n</code></pre>\n"}], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1502905431, "creation_date": 1502891464, "question_id": 45715446, "link": "https://stackoverflow.com/questions/45715446/defining-multiline-functions-in-ghci-file", "title": "Defining multiline functions in .ghci file", "body": "<p>Can you define a multi-line function in the <code>.ghci</code> file?</p>\n\n<p>I've tried</p>\n\n<pre><code> what :: Show a =&gt; a -&gt; a\n what = Db.traceShowId\n</code></pre>\n\n<p>But this didn't work. Is there some way to do this?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 6, "last_activity_date": 1502893179, "creation_date": 1502893179, "answer_id": 45716099, "question_id": 45715208, "link": "https://stackoverflow.com/questions/45715208/how-to-catch-an-exception-thrown-by-httplbs-http-client/45716099#45716099", "title": "how to catch an exception thrown by httpLbs (http-client)", "body": "<p>I'd recommend using the <code>tryAny</code> function from the <a href=\"https://haskell-lang.org/library/safe-exceptions\" rel=\"noreferrer\">safe-exceptions</a> library. Roughly, this would look like:</p>\n\n<pre><code>eres &lt;- tryAny $ httpLbs req man\ncase eres of\n  Left e -&gt; handleException e\n  Right lbs -&gt; handleBody lbs\n</code></pre>\n\n<p>Using safe-exceptions will help you avoid some corner cases you might otherwise run into with async exceptions and monad transformers.</p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 45716099, "answer_count": 1, "score": 3, "last_activity_date": 1502893179, "creation_date": 1502890814, "question_id": 45715208, "link": "https://stackoverflow.com/questions/45715208/how-to-catch-an-exception-thrown-by-httplbs-http-client", "title": "how to catch an exception thrown by httpLbs (http-client)", "body": "<p>I have a yesod application that uses http-client <a href=\"https://www.stackage.org/haddock/lts-9.0/http-client-0.5.7.0/Network-HTTP-Client.html#v:httpLbs\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-9.0/http-client-0.5.7.0/Network-HTTP-Client.html#v:httpLbs</a> . I am calling</p>\n\n<pre><code>resp &lt;- httpLbs req man\n</code></pre>\n\n<p>inside the <code>Handler (Response BSL.ByteString)</code>  monad.</p>\n\n<p>I am getting this (in the application's log)</p>\n\n<pre><code>6/Aug/2017:15:14:17 +0200 [Error#yesod-core] HttpExceptionRequest Request { ...\n</code></pre>\n\n<p>(the next line of code never gets executed)</p>\n\n<p>Instead, I want to catch the exception, and handle it in my code. How?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1502881299, "post_id": 45711268, "comment_id": 78381534, "body": "Every monad <i>is also</i> an applicative, so choosing applicative lets you use it for more things."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1502884631, "post_id": 45711268, "comment_id": 78383693, "body": "Don&#39;t worry too much about failing to generalize as much as possible. Often the fully general abstraction is so far away from concrete applications that gets little use in practice, since it becomes easier to reinvent the wheel than to exploit the abstract higher-kinded coinductive rotary device transformer combinator library. Finding the right level of abstraction requires a lot of effort and skills. (And, at least for theoretical purposes, it&#39;s very nice to read and understand super-abstract category-theoretic approaches to regular tasks -- many love Haskell just for that!)"}], "answers": [{"tags": [], "owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "is_accepted": false, "score": 2, "last_activity_date": 1502931016, "last_edit_date": 1502931016, "creation_date": 1502881769, "answer_id": 45711938, "question_id": 45711268, "link": "https://stackoverflow.com/questions/45711268/how-to-do-generalization/45711938#45711938", "title": "How to do generalization?", "body": "<p>Applicative chosen because we want to chain actions but action order does not depend on previous results.</p>\n\n<p>Monad: <code>action1 &gt;&gt;= \\resultOfAction1 -&gt; if P(resultOfAction1) then action1 else action2</code> (action chain may vary depending on results)</p>\n\n<p>Applicative: <code>processCombinedResult &lt;$&gt; action1 &lt;*&gt; action2 &lt;*&gt; action3</code> (action chain fixed)</p>\n\n<p>When traversing Traversable action order dictated by Traversable's internal structure and does not depend on each other results. Monad also can be used, but it more restrictive and it's ability to chain actions \"dynamically\" depending on results of previous actions is not required to implement these functions. So Applicative is chosen as less restrictive class which provides required functionality.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1502931016, "creation_date": 1502879746, "question_id": 45711268, "link": "https://stackoverflow.com/questions/45711268/how-to-do-generalization", "title": "How to do generalization?", "body": "<p>Earlier, it used to have <code>map</code> and <code>sequence</code> with following implementation:  </p>\n\n<pre><code>mapM :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]\n\nsequence :: Monad m =&gt; [m a] -&gt; m [a]\n</code></pre>\n\n<p>then haskell contributors did generalize to:  </p>\n\n<pre><code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b) \n\nsequenceA :: (Applicative f, Traversable t) =&gt; t (f a) -&gt; f (t a)\n</code></pre>\n\n<p>Why they choose applicative over monad? </p>\n\n<p>How they become the idea to generalize <code>mapM</code> and <code>sequence</code>? I want to understand the process, when I have to be more abstract. As you can see, functions <code>mapM</code> and <code>sequence</code> work only on list, but <code>traverse</code> and <code>sequenceA</code> are more abstract and work with all datatype that has <code>Traversable</code> implemented.     </p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 277, "user_id": 2464093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5066381bc937a320b03de5926f4f8024?s=128&d=identicon&r=PG", "display_name": "Artem Solod", "link": "https://stackoverflow.com/users/2464093/artem-solod"}, "edited": false, "score": 0, "creation_date": 1502886235, "post_id": 45711179, "comment_id": 78384824, "body": "It seems that the problem is caused by the fact that the &quot;inner&quot; parameter of Fold can be anything. Thus, constrained functions (i.e. unboxed vector map and scanl) can not be used as consumers of it. To support this point, we can construct a similar datatype that can be consumed just as you describe: <code>data FoldlUnboxed a b = forall x . VG.Unbox x =&gt; FoldlUnboxed (x -&gt; a -&gt; x) x (x -&gt; b)</code> can be processed with <code>scanVG (FoldlUnboxed step begin done) v = VG.map done . VG.scanl&#39; step begin $ v</code>"}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 277, "user_id": 2464093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5066381bc937a320b03de5926f4f8024?s=128&d=identicon&r=PG", "display_name": "Artem Solod", "link": "https://stackoverflow.com/users/2464093/artem-solod"}, "edited": false, "score": 0, "creation_date": 1502888283, "post_id": 45711179, "comment_id": 78386476, "body": "That works, but does not allow <code>Folds</code> to be converted to <code>FoldlUnboxed</code>, does it?"}, {"owner": {"reputation": 277, "user_id": 2464093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5066381bc937a320b03de5926f4f8024?s=128&d=identicon&r=PG", "display_name": "Artem Solod", "link": "https://stackoverflow.com/users/2464093/artem-solod"}, "edited": false, "score": 0, "creation_date": 1502894706, "post_id": 45711179, "comment_id": 78391339, "body": "It does not so it&#39;s probably of no real use for you."}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1502879459, "creation_date": 1502879459, "question_id": 45711179, "link": "https://stackoverflow.com/questions/45711179/is-there-an-equivalent-to-ofoldlunwrap-for-scanl-ing-unboxed-vectors", "title": "Is there an equivalent to ofoldlUnwrap for scanl-ing unboxed vectors?", "body": "<p>Is there a way to use a <code>Control.Foldl</code> from <code>foldl</code> as a <code>scanl</code> over an unboxed or generic <code>vector</code>?</p>\n\n<p>It's definitely possible to use <code>purely ofoldlUnwrap</code> to fold over the unboxed vector as suggested in the <code>foldl</code> documentation. But the same is not possible for scans.</p>\n\n<p>The naive approach fails because there is (at least to my knowledge) no way to set the type of the intermediate result:</p>\n\n<pre><code>scanVG :: forall v a b . (VG.Vector v a, VG.Vector v b)\n       =&gt; F.Fold a b -&gt; v a -&gt; v b\nscanVG (F.Fold step begin done)  = VG.map done . VG.scanl' step begin\n\n===&gt;\n\n\u2022 Could not deduce (Vector v x) arising from a use of \u2018map\u2019\n  from the context: (Vector v a, Vector v b)\n    bound by the type signature for:\n               scanVG :: (Vector v a, Vector v b) =&gt; Fold a b -&gt; v a -&gt; v b\n    at src/File.hs:(162,1)-(163,34)\n  Possible fix:\n    add (Vector v x) to the context of the data constructor \u2018Fold\u2019\n\u2022 In the first argument of \u2018(.)\u2019, namely \u2018map done\u2019\n  In the expression: map done . scanl' step begin\n  In an equation for \u2018scanVG\u2019:\n      scanVG (Fold step begin done) = map done . scanl' step begin\n</code></pre>\n\n<p>Right now I am converting to and from a boxed vector and hope that fusion get's rid of the overhead involved.</p>\n"}, {"tags": ["haskell", "haskell-stack", "c2hs"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1503087319, "last_edit_date": 1503087319, "creation_date": 1503046491, "answer_id": 45752540, "question_id": 45706137, "link": "https://stackoverflow.com/questions/45706137/asking-stack-to-pass-extra-command-line-arguments-to-c2hs/45752540#45752540", "title": "Asking stack to pass extra command-line arguments to c2hs", "body": "<p>Adding your location in the <code>include-dirs</code> field under the library or executable section (depending on your project) in the cabal file should make it work.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 45752540, "answer_count": 1, "score": 1, "last_activity_date": 1503087319, "creation_date": 1502863480, "question_id": 45706137, "link": "https://stackoverflow.com/questions/45706137/asking-stack-to-pass-extra-command-line-arguments-to-c2hs", "title": "Asking stack to pass extra command-line arguments to c2hs", "body": "<p>I use <a href=\"http://hackage.haskell.org/package/c2hs\" rel=\"nofollow noreferrer\">c2hs</a> for easing the process of writing Haskell bindings to C/C++ libraries.  I also recently started using stack for managing my Haskell projects. </p>\n\n<p>To use c2hs, I need to have a line saying <code>#include \"myheader.h\"</code> inside my Haskell source code; here <code>myheader.h</code> is the interface file to my C/C++ libraries. </p>\n\n<p>I found out today, that instead of embedding this <code>#include</code> line into the <code>.chs</code> source file, one can also pass the location of the header file while invoking c2hs as follows</p>\n\n<p><code>c2hs   /&lt;path-to-my-header&gt;/myheader.h    Foo.chs</code> </p>\n\n<p>Thankfully, stack automatically detects when a file has a .chs extension and then calls c2hs on it. My question is, how do I tell stack to pass this extra command-line argument (i.e. the location of the header-file) while calling c2hs? \nWhat changes will I need to make to my .cabal or my stack.yaml file? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502864218, "post_id": 45706071, "comment_id": 78370559, "body": "Note that, for the <code>Monad</code> instance for <code>Writer</code>, you have <code>(&gt;&gt;) :: Monoid w =&gt; Writer w a -&gt; Writer w b -&gt; Writer w b</code>. You can see just the last type argument of the first function argument is &quot;ignored&quot; (the type <code>a</code>). A bit more explicitly (<code>~</code> is equality of types), the <code>m ~ (Writer w)</code>, so <code>(&gt;&gt;) :: Monoid w =&gt; (Writer w) a -&gt; (Writer w) b -&gt; (Writer w) b</code>."}, {"owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502865096, "post_id": 45706071, "comment_id": 78370948, "body": "It is a little above my level but I understood your comment after I read @Silvio &#39;s answer. Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "edited": false, "score": 2, "creation_date": 1502864869, "post_id": 45706366, "comment_id": 78370836, "body": "Thank you for your explanation! It makes me totally understand it."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 13, "last_activity_date": 1502868646, "last_edit_date": 1502868646, "creation_date": 1502864514, "answer_id": 45706366, "question_id": 45706071, "link": "https://stackoverflow.com/questions/45706071/how-does-haskell-function-tell-work/45706366#45706366", "title": "How does Haskell function `tell` work", "body": "<p>You're confusing the result with the context. You are correct that, when applying <code>&gt;&gt;</code> or <code>&gt;&gt;= \\_ -&gt;</code>, the result of the left-hand-side is ignored. However, if the entire value was ignored, it would be completely pointless; the monadic context can be passed forward.</p>\n\n<pre><code>a &gt;&gt; b\n</code></pre>\n\n<p>This means \"take the context from <code>a</code> and combine it with the context of <code>b</code>, keeping the result value of <code>b</code>\". In the case of <code>Writer</code>, the monadic context is that there is some write-only data being passed about.</p>\n\n<pre><code>tell :: Monoid w =&gt; w -&gt; Writer w ()\n</code></pre>\n\n<p>This is the (somewhat simplified) type of <code>tell</code>. It takes a value to write and returns a <code>Writer</code> instance whose result value is insignificant (<code>()</code>) but whose context is that there is a write-only value containing the <code>w</code> argument. When you apply <code>&gt;&gt;</code>, the result value is ignored (which is irrelevant because <code>tell</code> returns nothing of value through its result) but the <em>context</em> is kept.</p>\n"}], "owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 814, "favorite_count": 0, "accepted_answer_id": 45706366, "answer_count": 1, "score": 11, "last_activity_date": 1502868646, "creation_date": 1502863149, "question_id": 45706071, "link": "https://stackoverflow.com/questions/45706071/how-does-haskell-function-tell-work", "title": "How does Haskell function `tell` work", "body": "<p>I'm learning <code>do expression</code> and <code>Monad</code> using <em>LEARN YOU A HASKELL FOR GREAT GOOD</em>. There's a <code>gcd</code> implementation using <code>tell</code> function makes me confused.</p>\n\n<pre><code>gcd :: Int -&gt; Int -&gt; Writer [String] Int\ngcd a b\n  | b == 0 = tell [\"Finished with \" ++ show a ] &gt;&gt;= (\\_ -&gt; return a)\n  | otherwise = tell [show a ++ \" mod \" ++ show b ++ \" = \" ++ show (a `mod` b)] &gt;&gt;= (\\_ -&gt; gcd b (a `mod` b))\n\ngcdResult = gcd 8 3\n\n-- result: WriterT (Identity (1,[\"8 mod 3 = 2\",\"3 mod 2 = 1\",\"2 mod 1 = 0\",\"Finished with 1\"]))\n</code></pre>\n\n<p>But I am confused by the <code>tell</code> function. When using <code>&gt;&gt;= (\\_ -&gt; ...)</code> or <code>&gt;&gt;</code>, the result before will be ignored, so why does the result of <code>tell</code> can be passed to the final result? As my thought, the <code>tell</code> result may be ignored, and the final result will be <code>WriterT (Identity (1,[]))</code>.</p>\n"}, {"tags": ["haskell", "atom-editor"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502872325, "post_id": 45705235, "comment_id": 78375361, "body": "You need to make sure that Windows can find <code>ghc-mod</code>, so you need to put it in your <code>PATH</code>. See e.g. <a href=\"https://superuser.com/q/284342/12455\">superuser.com/q/284342/12455</a> for more information."}, {"owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502873111, "post_id": 45705235, "comment_id": 78375877, "body": "So how do I find out that where did it install ghc-mod ?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502873201, "post_id": 45705235, "comment_id": 78375924, "body": "Search your hard drive."}, {"owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502874669, "post_id": 45705235, "comment_id": 78376903, "body": "thanks @MarkSeemann... it is working now :-) :-)"}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "edited": false, "score": 0, "creation_date": 1502960838, "post_id": 45705235, "comment_id": 78419280, "body": "In order to find where stack installed <code>ghc-mod</code> you can do <code>stack exec where ghc-mod</code> from Bash, right where you have your <code>stack.yaml</code> file."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1502864205, "post_id": 45705659, "comment_id": 78370549, "body": "hi thanks for answering . when i run cabal install ghc-mod I get this <a href=\"https://pastebin.com/Wj1zyEQW\" rel=\"nofollow noreferrer\">output</a>"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1502864655, "post_id": 45705659, "comment_id": 78370739, "body": "@Jhoy See the error message at line 122. I&#39;ve always only executed Haskell code and tool chain from Git Bash, which uses MINGW. That seems to circumvent that problem."}, {"owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1502867553, "post_id": 45705659, "comment_id": 78372366, "body": "Awesome thanks that installed using git bash. What to next to get rid of the error?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1502867967, "post_id": 45705659, "comment_id": 78372654, "body": "@Jhoy Are you still getting the same error as in the OP?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1502869860, "post_id": 45705659, "comment_id": 78373803, "body": "@Jhoy Can you run <code>ghc-mod</code> from the command-line (Git Bash)? From an arbitrary directory? When I do that, I get a response that I haven&#39;t supplied enough arguments to the program, but at least it tells me that Windows can find the executable (<code>ghc-mod.exe</code>)."}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "edited": false, "score": 0, "creation_date": 1502960775, "post_id": 45705659, "comment_id": 78419237, "body": "Keep in mind that if you change the resolver in the <code>stack.yaml</code> file you must redo <code>stack build ghc-mod</code> in order to build the appropriate version of ghc-mod against the resolver you&#39;re using."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1502861073, "creation_date": 1502861073, "answer_id": 45705659, "question_id": 45705235, "link": "https://stackoverflow.com/questions/45705235/using-haskell-in-atom-ghc-mod-error/45705659#45705659", "title": "Using haskell in atom - ghc mod error", "body": "<p>Getting Haskell to work on Windows 10 in Atom is doable, but it does require a bit of fidgeting before you can get it to work.</p>\n\n<h1>ghc-mod</h1>\n\n<p>IIRC, <em>ghc-mod</em> isn't part of the GHC installation, so the first step you most likely need to take is to add it.</p>\n\n<h2>Cabal</h2>\n\n<p>If you're only using GHC (and not Stack), you can <a href=\"http://www.mew.org/~kazu/proj/ghc-mod/en/install.html\" rel=\"nofollow noreferrer\">install it using Cabal</a>:</p>\n\n<pre><code>$ cabal install ghc-mod\n</code></pre>\n\n<h2>Stack</h2>\n\n<p>If you're just getting started with Haskell, then you probably want to stick with Cabal, but once you've gotten the hang of it and need to do slightly more complicated work, you should consider using <a href=\"https://docs.haskellstack.org\" rel=\"nofollow noreferrer\">Stack</a> instead.</p>\n\n<p>I usually have fairly good success with running</p>\n\n<pre><code>$ stack build ghc-mod\n</code></pre>\n\n<p>in my Stack project directory, but the Atom editor project has more detailed guidance here: <a href=\"https://github.com/atom-haskell/haskell-ghc-mod/wiki/Using-with-stack\" rel=\"nofollow noreferrer\">https://github.com/atom-haskell/haskell-ghc-mod/wiki/Using-with-stack</a></p>\n"}], "owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1524, "favorite_count": 0, "accepted_answer_id": 45705659, "answer_count": 1, "score": 2, "last_activity_date": 1502870838, "creation_date": 1502858493, "last_edit_date": 1502870838, "question_id": 45705235, "link": "https://stackoverflow.com/questions/45705235/using-haskell-in-atom-ghc-mod-error", "title": "Using haskell in atom - ghc mod error", "body": "<p>I have installed Haskell minimal installer on Windows 10. I have been using haskell by writiting small programs in Notepad++ and running then by ghci using ':l myfile.hs'</p>\n\n<p>I have now installed the hackable 'ATOM' text editor and installed the atom-haskell core packages.</p>\n\n<p>However, I get the error below</p>\n\n<pre><code>Haskell-ghc-mod: ghc-mod failed to launch. It is probably missing or misconfigured. ENOENT\nError was: Error\nspawn ghc-mod ENOENT\nDebug information:\n{\n  \"dir\": \"C:\\\\Users\\\\myfunnyusrname\\\\Desktop\",\n  \"err\": {\n    \"code\": \"ENOENT\",\n    \"errno\": \"ENOENT\",\n    \"syscall\": \"spawn ghc-mod\",\n    \"path\": \"ghc-mod\",\n    \"spawnargs\": [\n      \"version\"\n    ],\n    \"cmd\": \"ghc-mod version\"\n  },\n  \"opts\": {\n    \"cwd\": \"C:\\\\Users\\\\myfunnyusrname\\\\Desktop\",\n    \"env\": {\n      \"Path\": \"C:\\\\Program Files\\\\Haskell\\\\bin;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\lib\\\\extralibs\\\\bin;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\bin;C:\\\\ProgramData\\\\Oracle\\\\Java\\\\javapath;C:\\\\Program Files\\\\Java\\\\jdk1.8.0_121;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\mingw\\\\bin;C:\\\\Program Files\\\\nodejs\\\\;C:\\\\Ruby24-x64\\\\bin;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3\\\\Scripts;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3\\\\Library\\\\bin;C:\\\\Users\\\\myfunnyusrname\\\\AppData\\\\Local\\\\Microsoft\\\\WindowsApps;C:\\\\Users\\\\myfunnyusrname\\\\AppData\\\\Roaming\\\\npm\",\n      \"PATH\": \"C:\\\\Program Files\\\\Haskell\\\\bin;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\lib\\\\extralibs\\\\bin;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\bin;C:\\\\ProgramData\\\\Oracle\\\\Java\\\\javapath;C:\\\\Program Files\\\\Java\\\\jdk1.8.0_121;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\mingw\\\\bin;C:\\\\Program Files\\\\nodejs\\\\;C:\\\\Ruby24-x64\\\\bin;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3\\\\Scripts;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3\\\\Library\\\\bin;C:\\\\Users\\\\myfunnyusrname\\\\AppData\\\\Local\\\\Microsoft\\\\WindowsApps;C:\\\\Users\\\\myfunnyusrname\\\\AppData\\\\Roaming\\\\npm\"\n    },\n    \"encoding\": \"utf8\",\n    \"maxBuffer\": null\n  }\n}\nEnvironment (filtered):\n{\n  \"Path\": \"C:\\\\Program Files\\\\Haskell\\\\bin;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\lib\\\\extralibs\\\\bin;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\bin;C:\\\\ProgramData\\\\Oracle\\\\Java\\\\javapath;C:\\\\Program Files\\\\Java\\\\jdk1.8.0_121;C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2-a\\\\mingw\\\\bin;C:\\\\Program Files\\\\nodejs\\\\;C:\\\\Ruby24-x64\\\\bin;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3\\\\Scripts;C:\\\\Users\\\\myfunnyusrname\\\\Anaconda3\\\\Library\\\\bin;C:\\\\Users\\\\myfunnyusrname\\\\AppData\\\\Local\\\\Microsoft\\\\WindowsApps;C:\\\\Users\\\\myfunnyusrname\\\\AppData\\\\Roaming\\\\npm\"\n}\nShow Stack Trace\n</code></pre>\n\n<p>I understand that i am missing something BUT I do not know anything about PATH and variables.</p>\n\n<p>If someone could please help me, I would be grateful to you</p>\n\n<p>Note: I am using WINDOWS 10 laptop</p>\n\n<h2>Edit:</h2>\n\n<p>I have now installed ghc-mod (thanks to @Mark Seemann). But when i try 'ghc-mod' from gitbash I get:</p>\n\n<pre><code>K@ORUKO-PC MINGW64 ~\n$ ghc-mod\nbash: ghc-mod: command not found\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1502853961, "post_id": 45704591, "comment_id": 78367404, "body": "What is your question? Keep in mind that &quot;How do I write code to do this?&quot; isn&#39;t considered an on-topic question here. Show us what you thought might work, and explain what went wrong when you tried that."}], "answers": [{"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 8, "last_activity_date": 1502859063, "creation_date": 1502859063, "answer_id": 45705314, "question_id": 45704591, "link": "https://stackoverflow.com/questions/45704591/how-to-repeat-string-and-take-parts-of-it-in-haskell/45705314#45705314", "title": "How to repeat string and take parts of it in Haskell", "body": "<p>One simple implementation would be to use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:cycle\" rel=\"noreferrer\"><code>cycle</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:take\" rel=\"noreferrer\"><code>take</code></a>:</p>\n\n<pre><code>takeRepeated :: Int -&gt; [a] -&gt; [a]\ntakeRepeated n = take n . cycle\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 8470124, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlyHW.jpg?s=128&g=1", "display_name": "RNee", "link": "https://stackoverflow.com/users/8470124/rnee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1502871605, "creation_date": 1502853619, "last_edit_date": 1502871605, "question_id": 45704591, "link": "https://stackoverflow.com/questions/45704591/how-to-repeat-string-and-take-parts-of-it-in-haskell", "title": "How to repeat string and take parts of it in Haskell", "body": "<p>I need to write a Haskell program that takes an integer and a list and repeats the characters of the list up to n digits:</p>\n\n<pre><code>Int -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>e.g. <code>3 \"pink\"</code> would give <code>\"pin\"</code><br>\n<code>6 \"blue\"</code> would give <code>\"bluebl\"</code>  </p>\n\n<p>I'm new to the Haskell so cannot form the logic or don't know if there's any function to do it.</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"tags": [], "owner": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "is_accepted": true, "score": 1, "last_activity_date": 1502890326, "last_edit_date": 1502890326, "creation_date": 1502865237, "answer_id": 45706544, "question_id": 45699601, "link": "https://stackoverflow.com/questions/45699601/how-can-i-chain-multiple-actions-at-managehook-in-xmonad/45706544#45706544", "title": "How can I chain multiple actions at manageHook in Xmonad?", "body": "<p>I've just realized that the first error at a code above is that I pass workspace name instead of workspace id to <code>screenWorkspace \"11:w-\"</code>. Also,\n<code>screenWorkspace</code> is a completely wrong function for my goal.</p>\n\n<p>Anyway, found that what I want is already covered in wiki\n<a href=\"https://wiki.haskell.org/Xmonad/General_xmonad.hs_config_tips#Shift_an_app_to_a_workspace_and_view_it\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Xmonad/General_xmonad.hs_config_tips#Shift_an_app_to_a_workspace_and_view_it</a></p>\n"}], "owner": {"reputation": 8654, "user_id": 1421254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa3a6df99b65a2cdc4de3bef78eb24e5?s=128&d=identicon&r=PG", "display_name": "Dmitriusan", "link": "https://stackoverflow.com/users/1421254/dmitriusan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 45706544, "answer_count": 1, "score": 1, "last_activity_date": 1502890326, "creation_date": 1502823203, "question_id": 45699601, "link": "https://stackoverflow.com/questions/45699601/how-can-i-chain-multiple-actions-at-managehook-in-xmonad", "title": "How can I chain multiple actions at manageHook in Xmonad?", "body": "<p>I'm trying to get the effect when opening skype/discord from tray icon moves program window to specific workspace <code>\"11:w-\"</code> and switches current screen to this workspace as well. My problem is that I can not get types right.</p>\n\n<pre><code>myManageHook = composeAll . concat $\n   [ [ className   =? t --&gt; sequence [doShift \"11:w-\", screenWorkspace \"11:w-\"] | t &lt;- rarelyUsedApps] ]\n\nrarelyUsedApps = [\"Skype\", \"discord\"]\n</code></pre>\n\n<p>this code produces an error </p>\n\n<pre><code>Error detected while loading xmonad configuration file: /home/i/.xmonad/xmonad.hs\n\nxmonad.hs:268:33:\n    Couldn't match type `[Data.Monoid.Endo WindowSet]'\n                  with `Data.Monoid.Endo\n                          (W.StackSet\n                             WorkspaceId (Layout Window) Window ScreenId ScreenDetail)'\n    Expected type: Query\n                     (Data.Monoid.Endo\n                        (W.StackSet\n                           WorkspaceId (Layout Window) Window ScreenId ScreenDetail))\n      Actual type: Query [Data.Monoid.Endo WindowSet]\n    In the return type of a call of `sequence'\n    In the second argument of `(--&gt;)', namely\n      `sequence [doShift \"11:w-\", screenWorkspace \"11:w-\"]'\n    In the expression:\n      className =? t\n      --&gt; sequence [doShift \"11:w-\", screenWorkspace \"11:w-\"]\n\nxmonad.hs:268:60:\n    Couldn't match type `X' with `Query'\n    Expected type: Query (Data.Monoid.Endo WindowSet)\n      Actual type: X (Maybe WorkspaceId)\n    In the return type of a call of `screenWorkspace'\n    In the expression: screenWorkspace \"11:w-\"\n    In the first argument of `sequence', namely\n      `[doShift \"11:w-\", screenWorkspace \"11:w-\"]'\n\nxmonad.hs:268:76:\n    Couldn't match expected type `ScreenId' with actual type `[Char]'\n    In the first argument of `screenWorkspace', namely `\"11:w-\"'\n    In the expression: screenWorkspace \"11:w-\"\n    In the first argument of `sequence', namely\n      `[doShift \"11:w-\", screenWorkspace \"11:w-\"]'\n\nPlease check the file for errors.\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1502821472, "post_id": 45698968, "comment_id": 78356621, "body": "Monads are not generally closed under composition. That is, given monads <code>m</code> and <code>n</code>, the composition of <code>m</code> and <code>n</code> is not necessarily a monad. In this specific case, however, where both are the identity monad, they do compose."}, {"owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502821563, "post_id": 45698968, "comment_id": 78356687, "body": "Ah, yes, the definitions are placeholders, and not intended to be <code>Identity</code>. So, okay, this is not generally possible."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502821717, "post_id": 45698968, "comment_id": 78356747, "body": "I&#39;ve voted to close this as a duplicate of a question with a high quality answer on why monads do not compose (while applicatives do). I hope it&#39;s helpful."}, {"owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502851908, "post_id": 45698968, "comment_id": 78366967, "body": "It is, thank you Rein. I&#39;ll vote to close as well."}], "owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "closed_date": 1502824383, "answer_count": 0, "score": 3, "last_activity_date": 1502820907, "creation_date": 1502820907, "question_id": 45698968, "link": "https://stackoverflow.com/questions/45698968/monadic-double-bind", "closed_reason": "Duplicate", "title": "Monadic &quot;double-bind&quot;", "body": "<p>Is it possible to resolve <code>y</code> as a function of <code>f</code> and <code>x</code>, if the monads <code>N</code> and <code>M</code> are one-way?</p>\n\n<pre><code>x :: M (N X)\n\nf :: X -&gt; M (N Y)\n\n-- pattern matching not allowed, one-way monads implied\ny :: M (N Y)\ny = _\n</code></pre>\n\n<p>Full definitions:</p>\n\n<pre><code>data X = X\ndata Y = Y\n\n-- pattern matching not allowed, one-way monads implied\ndata M a = M a\ndata N a = N a\n\ninstance Functor M where\n  fmap = undefined\n\ninstance Applicative M where\n  pure = undefined\n  (&lt;*&gt;) = undefined\n\ninstance Monad M where\n  (&gt;&gt;=) = undefined\n\ninstance Functor N where\n  fmap = undefined\n\ninstance Applicative N where\n  pure = undefined\n  (&lt;*&gt;) = undefined\n\ninstance Monad N where\n  (&gt;&gt;=) = undefined\n\n\nx :: M (N X)\nx = undefined\n\nf :: X -&gt; M (N Y)\nf = undefined\n\n-- pattern matching not allowed, one-way monads implied\ny :: M (N Y)\ny = _\n</code></pre>\n\n<p>My intuition is that this is not generally possible, and that it is related to the problem that monad transformers solve, but I am not sure.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502817234, "post_id": 45696542, "comment_id": 78354371, "body": "The pattern you have is <code>foo = in do { ..; if something then foo else .. }</code>. That is the pattern you should abstract into its own function."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1503001656, "post_id": 45696542, "comment_id": 78446147, "body": "I&#39;m not sure I understand... Why can&#39;t you use <code>waitfor</code>? Couldn&#39;t you write <code>hunt&#39;</code> as <code>hunt&#39; idx conn t = waitfor &quot;0300aa0801&quot; conn t $ do {  ... your do-block from your original hunt&#39; goes here ... }</code>?"}, {"owner": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "edited": false, "score": 0, "creation_date": 1504250831, "post_id": 45696542, "comment_id": 78950250, "body": "Hi David Young, your answer works for my case. I can modify <code>waitfor</code> and use the way you&#39;ve suggested. Thank you :)"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "edited": false, "score": 0, "creation_date": 1502813100, "post_id": 45696617, "comment_id": 78351939, "body": "Thank for your response, but still can&#39;t apply the helper function for other functions like hunt&#39; ?"}, {"owner": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "reply_to_user": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "edited": false, "score": 0, "creation_date": 1502813896, "post_id": 45696617, "comment_id": 78352409, "body": "if you include the code for <code>hunt&#39;</code>, someone might be able to help you find a helper that works for both."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502818366, "post_id": 45696617, "comment_id": 78354919, "body": "Why can&#39;t you use <code>hunt&#39;</code> in an <code>if</code> expression?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "edited": false, "score": 0, "creation_date": 1503001723, "post_id": 45696617, "comment_id": 78446181, "body": "@T.Do Maybe you can give a specific example of what thing (or things) you&#39;re trying to do that aren&#39;t working"}], "tags": [], "owner": {"reputation": 3644, "user_id": 438267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d2d9d649c9840c499ce01b3b203352a?s=128&d=identicon&r=PG", "display_name": "James Wilcox", "link": "https://stackoverflow.com/users/438267/james-wilcox"}, "is_accepted": false, "score": 7, "last_activity_date": 1502812434, "creation_date": 1502812434, "answer_id": 45696617, "question_id": 45696542, "link": "https://stackoverflow.com/questions/45696542/does-haskell-have-a-combination-of-when-and-unless/45696617#45696617", "title": "Does Haskell have a combination of `when` and `unless`?", "body": "<p>You can just use <code>if ... then ... else</code> for that.</p>\n\n<p>For example, </p>\n\n<pre><code>waitfor :: ByteString -&gt; Socket -&gt; t -&gt; (ByteString -&gt; Socket -&gt; t -&gt; IO ()) -&gt; IO ()\nwaitfor str conn tid f = do \n    threadDelay 1000000\n    msg &lt;- recv conn 1024\n    if C.isInfixOf str msg\n    then waitfor str conn tid f\n    else f msg conn tid\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1502814945, "creation_date": 1502812206, "last_edit_date": 1502814945, "question_id": 45696542, "link": "https://stackoverflow.com/questions/45696542/does-haskell-have-a-combination-of-when-and-unless", "title": "Does Haskell have a combination of `when` and `unless`?", "body": "<p>I'm developing a TCP client that fetch a specified kind message from the streams and just find my self use a lot of unless and when expressions. For example:</p>\n\n<pre><code>hunt :: Socket -&gt; ThreadId -&gt; IO ()                               \nhunt conn t = do threadDelay 1000000\n                 msg &lt;- recv conn 1024\n                 unless (C.isInfixOf \"1b14010102\" $ encode msg) $ hunt conn t\n                 when (C.isInfixOf \"1b14010102\" $ encode msg) $ do\n                     threadDelay 7000000\n                     sendAll conn $ goHunt\n                     msg &lt;- recv conn 1024\n                     threadDelay 3000000\n                     close conn\n                     killThread t\n</code></pre>\n\n<p>I was trying to build a helper like:</p>\n\n<pre><code>waitfor :: ByteString -&gt; Socket -&gt; t -&gt; (ByteString -&gt; Socket -&gt; t -&gt; IO ()) -&gt; IO ()\nwaitfor str conn tid f = do \n    threadDelay 1000000\n    msg &lt;- recv conn 1024\n    let m = C.isInfixOf str msg\n    unless m $ waitfor str conn tid f\n    when m $ f msg conn tid\n</code></pre>\n\n<p>Then I can re-use the helper:</p>\n\n<pre><code>main = do\n    ...\n    tid &lt;- myThreadId\n    conn &lt;- joinWorld u\n    waitfor \"1b14010102\" conn tid hunt.\n</code></pre>\n\n<p>But if I have another function (it take 3 arguments unlike <code>hunt</code>)</p>\n\n<pre><code>hunt' :: ByteString -&gt; Socket -&gt; ThreadId -&gt; IO ()\nhunt' idx conn t = do threadDelay 1000000\n                      msg &lt;- recv conn 1024\n                      unless (C.isInfixOf \"0300aa0801\" $ encode msg) $ hunt' conn t\n                      when (C.isInfixOf \"0300aa0801\" $ encode msg) $ do\n                          threadDelay 1000000\n                          sendAll conn $ goHunt' idx\n                          threadDelay 3000000\n                          close conn\n                          killThread t\n</code></pre>\n\n<p>then I can't use <code>waitfor</code>, and need to use <code>when</code>/<code>unless</code> again. So, does Haskell have a combination of <code>when</code>/<code>unless</code>? If not, then what is a better approach for my case?</p>\n"}, {"tags": ["haskell", "d3.js", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 1, "last_activity_date": 1502812945, "creation_date": 1502812945, "answer_id": 45696779, "question_id": 45696427, "link": "https://stackoverflow.com/questions/45696427/how-to-install-d3js-haskell-package/45696779#45696779", "title": "How to install d3js Haskell package?", "body": "<p>This package is pretty old, and it has fixed dependency on <code>base</code> package (read, compiler version).</p>\n\n<p>I'd start with relaxing that dependency requirement in <code>d3js.cabal</code> file and then running build again. if that wouldn't work, you'd need to either hack the code, or use a old compiler (or stack resolver, if you are using stack).</p>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 8, "last_activity_date": 1502821582, "last_edit_date": 1502821582, "creation_date": 1502812961, "answer_id": 45696783, "question_id": 45696427, "link": "https://stackoverflow.com/questions/45696427/how-to-install-d3js-haskell-package/45696783#45696783", "title": "How to install d3js Haskell package?", "body": "<p>As you can see, the d3js package has an upper bound on the base package. The base package is the set of modules that ship with a given version of GHC including, e.g., <code>Prelude</code>. Because base ships with GHC, you can't install a different version than the one you already have without installing a different GHC.</p>\n\n<p>The d3js package was last (and only) updated in 2013 and its base version bounds indicate that it will only work with GHC 7.6. Unfortunately, Stack did not exist in 2013 and there is no version of stackage that works with GHC 7.6. You may have some success instructing Stack (and thereby Cabal) to ignore the upper version bound and using LTS 2.22 with GHC 7.8.4, which the d3js package might be compatible with despite its upper bound on base, but I have not tested this. You can do this by setting <code>allow-newer: True</code> in a stack.yaml file.</p>\n\n<p>It may just be the case, however, that the d3js package is too old to work with the GHCs provided by Stack.</p>\n\n<p>As a last resort, you may be able to rehabilitate it by downloading it locally, updating its bounds (and perhaps fixing any incompatibilities that result), and configuring a stack.yaml file to treat it as both a local package and an extra dependency. See <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#local-dependency-packages-extra-dep\" rel=\"noreferrer\">Local dependency packages</a> in the Stack configuration documentation for instructions.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 45696783, "answer_count": 2, "score": 1, "last_activity_date": 1503051651, "creation_date": 1502811857, "last_edit_date": 1503051651, "question_id": 45696427, "link": "https://stackoverflow.com/questions/45696427/how-to-install-d3js-haskell-package", "title": "How to install d3js Haskell package?", "body": "<p>I'd just like to try the Haskell <a href=\"https://hackage.haskell.org/package/d3js\" rel=\"nofollow noreferrer\">d3js</a> package. Here's what I tried: </p>\n\n<pre><code>stack install d3js\n</code></pre>\n\n<p>But it gives the error: </p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for d3js-0.1.0.0:\n    base-4.9.1.0 must match &gt;=4.6 &amp;&amp; &lt;4.7 (latest applicable is 4.6.0.1)\n</code></pre>\n\n<p>I tried <code>stack install base-4.6.0.1</code>, which doesn't output anything but completes without an error, but I still get the same error when I try <code>stack install d3js</code>. </p>\n\n<p>I also tried using cabal: </p>\n\n<pre><code>$ cabal install d3js                         \n\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: d3js-0.1.0.0 (user goal)\nnext goal: base (dependency of d3js-0.1.0.0)\nrejecting: base-4.9.1.0/installed-4.9... (conflict: d3js =&gt; base&gt;=4.6 &amp;&amp; &lt;4.7)\nrejecting: base-4.10.0.0, base-4.9.1.0, base-4.9.0.0, base-4.8.2.0,\nbase-4.8.1.0, base-4.8.0.0, base-4.7.0.2, base-4.7.0.1, base-4.7.0.0,\nbase-4.6.0.1, base-4.6.0.0, base-4.5.1.0, base-4.5.0.0, base-4.4.1.0,\nbase-4.4.0.0, base-4.3.1.0, base-4.3.0.0, base-4.2.0.2, base-4.2.0.1,\nbase-4.2.0.0, base-4.1.0.0, base-4.0.0.0, base-3.0.3.2, base-3.0.3.1\n(constraint from non-upgradeable package requires installed instance)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>What am I doing wrong? How can I fix this dependency issue? </p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 1, "last_activity_date": 1502823474, "creation_date": 1502823474, "answer_id": 45699664, "question_id": 45695604, "link": "https://stackoverflow.com/questions/45695604/should-stack-repl-load-test-modules-from-other-packages/45699664#45699664", "title": "Should stack repl load test modules from *other* packages?", "body": "<p>From the <code>stack ghci</code> docs (<a href=\"https://docs.haskellstack.org/en/stable/ghci/\" rel=\"nofollow noreferrer\">https://docs.haskellstack.org/en/stable/ghci/</a>):</p>\n\n<blockquote>\n  <p>Similarly to stack build, the default is to load up ghci with all libraries and executables in the project.</p>\n</blockquote>\n\n<p>So, to load just one package you need to do <code>stack ghci creatur-wains</code>.</p>\n"}], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 45699664, "answer_count": 1, "score": 2, "last_activity_date": 1502823474, "creation_date": 1502809214, "last_edit_date": 1502809565, "question_id": 45695604, "link": "https://stackoverflow.com/questions/45695604/should-stack-repl-load-test-modules-from-other-packages", "title": "Should stack repl load test modules from *other* packages?", "body": "<p>I have a project which pulls in two local packages. My <code>stack.yaml</code> has:</p>\n\n<pre><code>packages:\n- '.'\n- '../creatur-wains'\n- '../creatur-wains-test-utils'\n</code></pre>\n\n<p>Both <code>creatur-wains</code> and <code>creatur-wains-test-utils</code> define a module called <code>ALife.Creatur.Wain.TestUtils</code>, but in <code>creatur-wains</code> it's only part of the test code, not part of the library. This wasn't a problem when I was using ghci. I could load both packages, and only the version of <code>TestUtils</code> from <code>creatur-wains-test-utils</code> was visible.</p>\n\n<p>However, Stack also seems to pull in the test modules from <code>creatur-wains</code>, so I get the following error:</p>\n\n<pre><code>$ stack repl\nThe following GHC options are incompatible with GHCi and have not been passed to it: -Werror -threaded\nConfiguring GHCi with the following packages: creatur-dvector-wains, creatur-wains-test-utils, creatur-wains\n\n* * * * * * * *\nThe following modules are present in multiple packages:\n * ALife.Creatur.Wain.TestUtils (in creatur-wains, creatur-wains-test-utils)\n* * * * * * * *\n\nNot attempting to start ghci due to these duplicate modules.\nUse --no-load to try to start it anyway, without loading any modules (but these are still likely to cause errors)\n</code></pre>\n\n<p>I can work around this using <code>--no-load</code>, and adding the packages one by one, but that's a bit tedious. Is this desireable behaviour for <code>stack repl</code>, or is it a bug?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502809578, "post_id": 45695566, "comment_id": 78349537, "body": "What you actually need is a value of type <code>exists a . Delayed a</code>. You can express this by a function of type <code>Dynamic -&gt; (forall a . Typeable a =&gt; Delayed a -&gt; r) -&gt; r</code> (which is an encoding of <code>Dynamic -&gt; exists a . Typeable a =&gt; Delayed a</code>). Note that passing <code>cancel</code> as the 2nd argument of such a function is valid. As of GHC 8.2, you can use <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Type-Reflection.html#v:Con-39-\" rel=\"nofollow noreferrer\">this</a>. Before 8.2, you&#39;ll have to resort to pattern matching on the <code>TypeRep</code> and then using <code>unsafeCoerce</code>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502810600, "post_id": 45695566, "comment_id": 78350201, "body": "How do I write such a function ? Can you elaborate (both unsafeCoerce and GHC 8.2 solution ) ?"}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1502921624, "post_id": 45702190, "comment_id": 78405386, "body": "I managed to get something working using <code>unsafeCoerce</code>, however I get a different behaviour when I use it compared to casting to the correct type (using <code>fromDynamic</code>). Which is strange, especially because it doesn&#39;t crash but just gives a erroneous result ..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1502927495, "post_id": 45702190, "comment_id": 78406949, "body": "It is not really strange; an incorrect use of <code>unsafeCoerce</code> can cause anything to happen, including coincidentally correct behavior, a segfault, or producing a garbage value. In any case, I&#39;ve included my implementation in the answer."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1502958713, "post_id": 45702190, "comment_id": 78417854, "body": "Wow !! My mistake was to <code>unsafeCoerce</code> the Dynamic itself, instead of it&#39;s value. Your code works like a charme. I struggle a bit, because <code>Delayed</code> as actuall 2 arguments, so the pattern matching on <code>[a]</code> will always fail and the function was compiling but always returning Nothing."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1502978919, "post_id": 45702190, "comment_id": 78432446, "body": "The pattern match on <code>[a]</code> is for the <i>type</i> arguments of <code>Delayed</code>; it should work regardless of the contents of <code>Delayed</code>. If <code>Delayed</code> is actually <code>Delayed a b</code>, then change that to <code>[a,b]</code> and insert an additional <code>withTypeable b $ ..</code>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1502983497, "post_id": 45702190, "comment_id": 78435984, "body": "I know. I managed to fix it but struggled mainly because just copied paste the code without reading. It compiles, so I assume it worked ;-). But you are right changing to <code>[a,b</code>] did the trick."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 6, "last_activity_date": 1502927315, "last_edit_date": 1502927315, "creation_date": 1502834356, "answer_id": 45702190, "question_id": 45695566, "link": "https://stackoverflow.com/questions/45695566/how-to-convert-dynamic-to-forall-something/45702190#45702190", "title": "How to convert Dynamic to Forall something", "body": "<p>A value of type <code>forall a . X a</code> is a value which can be instantiated to any of <code>X Int</code>, <code>X Bool</code>, <code>X String</code>, etc. Presumably, your cache stores values of many different types, but no single value is valid at every possible type parameter. What you actually need is a value of type <code>exists a . Delayed a</code>. However, Haskell doesn't have first-class existential quantifiers, so you must encode that type in some way. One particular encoding is:</p>\n\n<pre><code>castToDelayed :: (forall a . Typeable a =&gt; Delayed a -&gt; r) -&gt; Dynamic -&gt; r\n</code></pre>\n\n<p>Assume that you have this function; then you can simply write <code>castToDelayed cancel :: Dynamic -&gt; IO ()</code>. Note that the function parameter to <code>castToDelayed</code> provides a <code>Typeable</code> constraint, but you can freely ignore that constraint (which is what <code>cancel</code> is doing). Also note this function must be partial due to its type alone (clearly not every <code>Dynamic</code> is a <code>Delayed a</code> for some <code>a</code>), so in real code, you should produce e.g. <code>Maybe r</code> instead. Here I will elide this detail and just throw an error.</p>\n\n<p>How you actually write this function will depend on which version of GHC you are using (the most recent, 8.2, or some older version). On 8.2, this is a very nice, simple function:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n-- NB: probably requires some other extensions\n\nimport Data.Dynamic\nimport Type.Reflection\n\ncastToDelayed :: (forall a . Typeable a =&gt; Delayed a -&gt; r) -&gt; Dynamic -&gt; r\ncastToDelayed k (Dynamic (App (eqTypeRep (typeRep :: TypeRep Delayed) -&gt; Just HRefl) a) x)\n  = withTypeable a (k x) \ncastToDelayed _ _ = error \"Not a Delayed\"\n</code></pre>\n\n<p>(Aside: at first I thought the <code>Con</code> pattern synonym would be useful here, but on deeper inspection it seems entirely useless. You must use <code>eqTypeRep</code> instead.)</p>\n\n<p>Briefly, this function works as follows:</p>\n\n<ul>\n<li><p>It pattern matches on the <code>Dynamic</code> value to obtain the actual value (of some existentially quantified type <code>a</code>) stored within, and the representation of its type (of type <code>TypeRep a</code>).</p></li>\n<li><p>It pattern matches on the <code>TypeRep a</code> to determine if it is an application (using <code>App</code>). Clearly, <code>Delayed a</code> is the application of a type constructor, so that is the first thing we must check.</p></li>\n<li><p>It compares the type constructor (the first argument to <code>App</code>) to the <code>TypeRep</code> corresponding to <code>Delayed</code> (note you must have an <code>instance Typeable Delayed</code> for this). If that comparison is successful, it pattern matches on the proof (that is <code>Just HRefl</code>) that the first argument to <code>App</code> and <code>Delayed</code> are in fact the same type.</p></li>\n<li><p>At this point, the compiler knows that <code>a ~ Delayed x</code> for some <code>x</code>. So, you can call the function <code>forall a . Typeable a =&gt; Delayed a -&gt; r</code> on the value <code>x :: a</code>. It must also provide the proof that <code>x</code> is <code>Typeable</code>, which is given precisely by a value of type <code>TypeRep x</code> - <code>withTypeable</code> reifies this value-level proof as a type-level constraint (alternatively, you could have the input function take as argument <code>TypeRep a</code>, or just omit the constrain altogether, since your specific use case doesn't need it; but this type is the most general possible).</p></li>\n</ul>\n\n<p>On older versions, the principle is basically the same. However, <code>TypeRep</code> did not take a type parameter then; you can pattern match on it to discover if it is the <code>TypeRep</code> corresponding to <code>Delayed</code>, but you cannot prove to the compiler that the value stored inside the <code>Dynamic</code> has type <code>Delayed x</code> for some <code>x</code>. It will therefore require <code>unsafeCoerce</code>, at the step where you are applying the function <code>k</code> to the value <code>x</code>. Furthermore, there is no <code>withTypeable</code> before GHC 8.2, so you will have to write the function with type <code>(forall a . Delayed a -&gt; r) -&gt; Dynamic -&gt; r</code> instead (which, fortunately, is enough for your use case); or implement such a function yourself (see the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/Data.Typeable.Internal.html#withTypeable\" rel=\"nofollow noreferrer\">source</a> of the function to see how; the implementation on older versions of GHC will be similar, but will have type <code>TypeRep -&gt; (forall a . Typeable a =&gt; Proxy a -&gt; r) -&gt; r</code> instead).</p>\n\n<p>Here is how you implement this in GHC &lt; 8.2 (tested on 8.0.2). It is a horrible hack, and I make no claim it will correctly in all circumstances.</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable, MagicHash, ScopedTypeVariables, PolyKinds, ViewPatterns #-}\n\nimport Data.Dynamic\nimport Data.Typeable\nimport Unsafe.Coerce\nimport GHC.Prim (Proxy#)\nimport Data.Proxy\n\n-- This part reifies a `Typeable' dictionary from a `TypeRep'.\n-- This works because `Typeable' is a class with a single field, so \n-- operationally `Typeable a =&gt; r' is the same as `(Proxy# a -&gt; TypeRep) -&gt; r'\nnewtype MagicTypeable r (kp :: KProxy k) =\n  MagicTypeable (forall (a :: k) . Typeable a =&gt; Proxy a -&gt; r)\n\nwithTypeRep :: MagicTypeable r (kp :: KProxy k)\n            -&gt; forall a . TypeRep -&gt; Proxy a -&gt; r\nwithTypeRep d t = unsafeCoerce d ((\\_ -&gt; t) :: Proxy# a -&gt; TypeRep)\n\nwithTypeable :: forall r . TypeRep -&gt; (forall (a :: k) . Typeable a =&gt; Proxy a -&gt; r) -&gt; r\nwithTypeable t k = withTypeRep (MagicTypeable k) t Proxy\n\n-- The type constructor for Delayed\ndelayed_tycon = fst $ splitTyConApp $ typeRep (Proxy :: Proxy Delayed)\n\n-- This is needed because Dynamic doesn't export its constructor, and\n-- we need to pattern match on it.\ndata DYNAMIC = Dynamic TypeRep Any\n\nunsafeViewDynamic :: Dynamic -&gt; DYNAMIC\nunsafeViewDynamic = unsafeCoerce\n\n-- The actual implementation, much the same as the one on GHC 8.2, but more \n-- 'unsafe' things\ncastToDelayed :: (forall a . Typeable a =&gt; Delayed a -&gt; r) -&gt; Dynamic -&gt; r\ncastToDelayed k (unsafeViewDynamic -&gt; Dynamic t x) =\n  case splitTyConApp t of\n    (((== delayed_tycon) -&gt; True), [a]) -&gt;\n      withTypeable a $ \\(_ :: Proxy (a :: *)) -&gt; k (unsafeCoerce x :: Delayed a)\n    _ -&gt; error \"Not a Delayed\"\n</code></pre>\n\n<p>I don't know what <code>Delayed</code> actually is, but lets assume it's defined as follows for testing purposes:</p>\n\n<pre><code>data Delayed a = Some a | None deriving (Typeable, Show)\n</code></pre>\n\n<p>Then consider this simple test case:</p>\n\n<pre><code>test0 :: Typeable a =&gt; Delayed a -&gt; String\ntest0 (Some x) = maybe \"not a String\" id $ cast x\ntest0 None     = \"None\"\n\ntest0' =\n  let c = castToDelayed test0 in\n   [ c (toDyn (None :: Delayed Int))\n   , c (toDyn (Some 'a'))\n   , c (toDyn (Some \"a\")) ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502988105, "post_id": 45731413, "comment_id": 78439004, "body": "This seems to be the cleanest way, but I think it may not be the most efficient. Each value is wrapper in a <code>Delayed&#39;</code> constructor before being wrapped again in a <code>Dynamic</code>."}], "tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": false, "score": 2, "last_activity_date": 1502962261, "creation_date": 1502962261, "answer_id": 45731413, "question_id": 45695566, "link": "https://stackoverflow.com/questions/45695566/how-to-convert-dynamic-to-forall-something/45731413#45731413", "title": "How to convert Dynamic to Forall something", "body": "<p>Why not define</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata Delayed' = forall a. Delayed' (Delayed a)\n</code></pre>\n\n<p>and then store than in the <code>Dynamic</code>?  You can then <code>cast</code> it out of the dynamic, <code>case</code> on it, and pass the result to <code>cancel</code>.  (Depending on what your use case is you may no longer even need the <code>Dynamic</code>.)</p>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 45702190, "answer_count": 2, "score": 3, "last_activity_date": 1502962261, "creation_date": 1502809063, "last_edit_date": 1592644375, "question_id": 45695566, "link": "https://stackoverflow.com/questions/45695566/how-to-convert-dynamic-to-forall-something", "title": "How to convert Dynamic to Forall something", "body": "<p>I have a cache with Dynamic values. Some of them have the type <code>Delayed a</code>.</p>\n<p>Normally when I access the cache, I know the type <code>a</code>, so it's not a problem, I can use <code>fromDynamic</code> to cast to <code>Maybe a</code>.</p>\n<p>I would like to call a function which doesn't need to know anything about the type <code>a</code> on a list of <code>Dynamic</code>. (The method is <code>cancel :: Delay a -&gt; IO ()</code>).\nIs there a way to do so ?</p>\n<p>Basically I need a way to do get from <code>Dynamic</code> to <code>Forall a . Delayed a</code> ?</p>\n<h3>Edit</h3>\n<p>For information, Delayed holds a pending asynchronous value and a MVar to start or Cancel it. It is equivalent to</p>\n<pre><code> data Delayed m a = Delayed { blocker :: MVar Bool, async :: Async m a }\n</code></pre>\n<p>Such values are stored in a cache (which use Dynamic and store other things). When displaying the cache status, I need to be able to get the status of <code>Delayed</code> value (which involve accessing the blocker but has nothing to do with the actual value.</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1502809443, "post_id": 45695640, "comment_id": 78349434, "body": "I think it&#39;s <code>FlexibleContexts</code>. Yesod basically requires <code>{-# LANGUAGE AllTheExtensions #-}</code> anyway though, so author should be fine."}, {"owner": {"reputation": 23, "user_id": 6850255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7e548a96df1ab64d22bfa7b21b03a8?s=128&d=identicon&r=PG&f=1", "display_name": "frankhucek", "link": "https://stackoverflow.com/users/6850255/frankhucek"}, "edited": false, "score": 0, "creation_date": 1502809623, "post_id": 45695640, "comment_id": 78349575, "body": "Heres the error when I try that change <code>* Non type-variable argument         in the constraint: Show (AuthId master)       (Use FlexibleContexts to permit this)     * In the type signature:         getFileserverHomeR :: (YesodAuth master, Show (AuthId master)) =&gt;                               HandlerT Fileserver (HandlerT master IO) Html </code>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 23, "user_id": 6850255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7e548a96df1ab64d22bfa7b21b03a8?s=128&d=identicon&r=PG&f=1", "display_name": "frankhucek", "link": "https://stackoverflow.com/users/6850255/frankhucek"}, "edited": false, "score": 0, "creation_date": 1502809673, "post_id": 45695640, "comment_id": 78349606, "body": "@frankhucek Yes, you need <code>{-# LANGUAGE FlexibleContexts #-}</code> at the top of your source file for this to work. I&#39;ll add it to the answer."}, {"owner": {"reputation": 23, "user_id": 6850255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7e548a96df1ab64d22bfa7b21b03a8?s=128&d=identicon&r=PG&f=1", "display_name": "frankhucek", "link": "https://stackoverflow.com/users/6850255/frankhucek"}, "edited": false, "score": 0, "creation_date": 1502810451, "post_id": 45695640, "comment_id": 78350100, "body": "@Cubic adding <code>{-# LANGUAGE FlexibleContexts #-}</code> fixed the problem. Thank you! Why is this necessary though?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 23, "user_id": 6850255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7e548a96df1ab64d22bfa7b21b03a8?s=128&d=identicon&r=PG&f=1", "display_name": "frankhucek", "link": "https://stackoverflow.com/users/6850255/frankhucek"}, "edited": false, "score": 0, "creation_date": 1502810728, "post_id": 45695640, "comment_id": 78350301, "body": "@frankhucek The original definition for function constraints only allowed constraints of the form <code>Constraint typeVariable</code>. The constraint we have here is more complicated than that: <code>Constraint (SomeTypeFunction typeVariable)</code>. As you&#39;ve seen yourself this is useful, but isn&#39;t part of the base language (yet), which is why it rests in a language extension. I&#39;ve linked an explanation page in the answer, which has some more details."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 1, "last_activity_date": 1502809727, "last_edit_date": 1502809727, "creation_date": 1502809293, "answer_id": 45695640, "question_id": 45695102, "link": "https://stackoverflow.com/questions/45695102/haskell-yesod-get-user-credentials-in-subsite/45695640#45695640", "title": "Haskell Yesod get user credentials in subsite", "body": "<p>Seems to me like all you need is a <code>Show (AuthId master)</code> constraint in your type signature:</p>\n\n<pre><code>getSubsiteHomeR :: (YesodAuth master, Show (AuthId master)) =&gt; HandlerT Subsite (HandlerT master IO) Html\n</code></pre>\n\n<p>Note that this requires the <a href=\"https://prime.haskell.org/wiki/FlexibleContexts\" rel=\"nofollow noreferrer\"><code>FlexibleContexts</code></a> language extension, which you can enable by putting <code>{-# LANGUAGE FlexibleContexts #-}</code> at the top of your source file.</p>\n"}], "owner": {"reputation": 23, "user_id": 6850255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7e548a96df1ab64d22bfa7b21b03a8?s=128&d=identicon&r=PG&f=1", "display_name": "frankhucek", "link": "https://stackoverflow.com/users/6850255/frankhucek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 45695640, "answer_count": 1, "score": 1, "last_activity_date": 1502809727, "creation_date": 1502807658, "last_edit_date": 1502809323, "question_id": 45695102, "link": "https://stackoverflow.com/questions/45695102/haskell-yesod-get-user-credentials-in-subsite", "title": "Haskell Yesod get user credentials in subsite", "body": "<p>I'm writing a subsite for my yesod project, and I need to display the logged in user's name on that subsite (I'm using yesod-auth hardcoded where the type of <code>AuthId master = Text</code>).</p>\n\n<p>However, the user is logged in on the master site. I'm able to get a value of type <code>AuthId master</code> using <code>maybeAuthId</code>, but I am unable to display this value because it is not an instance of <code>Show</code>.</p>\n\n<p>Is there a type constraint I can put on my Handler to make sure the type of <code>AuthId master</code> derives <code>Show</code>?</p>\n\n<pre><code>getSubsiteHomeR :: (YesodAuth master) =&gt; HandlerT Subsite (HandlerT master IO) Html\ngetSubsiteHomeR = do\n   lift $ do\n     maid &lt;- maybeAuthId -- I want to display the value of 'maid'\n     liftIO $ print maid\n     defaultLayout [whamlet|.......|]\n</code></pre>\n\n<p>EDIT: Here is the error message:</p>\n\n<pre><code>Could not deduce (Show (AuthId master))\n    arising from a use of `print'\n  from the context: YesodAuth master\n    bound by the type signature for:\n               getSubsiteHomeR :: YesodAuth master =&gt;\n                                     HandlerT Subsite (HandlerT master IO) Html\n    at src/Subsite.hs:24:1-89\n* In the second argument of `($)', namely `print maid'\n  In a stmt of a 'do' block: liftIO $ print maid\n  In the second argument of `($)', namely\n    `do { maid &lt;- maybeAuthId;\n          liftIO $ print maid;\n          defaultLayout\n            (do { (asWidgetT . toWidget)\n                    ((blaze-markup-0.8.0.0:Text.Blaze.Internal.preEscapedText . T.pack)\n                       \"&lt;p&gt;Welcome to the Subsite!&lt;/br&gt;&lt;a href=\\\"\");\n                  (getUrlRenderParams\n                   &gt;&gt;=\n                     (\\ urender_alJ6\n                        -&gt; (asWidgetT . toWidget)\n                             (toHtml\n                                ((\\ u_alJ7 -&gt; urender_alJ6 u_alJ7 ...)\n                                   (toParent SubsiteHomeR)))));\n                  (asWidgetT . toWidget)\n                    ((blaze-markup-0.8.0.0:Text.Blaze.Internal.preEscapedText . T.pack)\n                       \"\\\"&gt;Subsite&lt;/br&gt;&lt;/a&gt;\\n\\\n                       \\&lt;a href=\\\"\");\n                  .... }) }'\n</code></pre>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1502805121, "post_id": 45693237, "comment_id": 78346490, "body": "I think <code>Control.Concurrent.Async.cancel</code> throws an asynchronous exception so you could use <code>Control.Exception.mask</code> with the portion you don&#39;t want to be interrupted, but this would block the thread calling <code>cancel</code> and should be used carefully."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502901296, "post_id": 45693237, "comment_id": 78395795, "body": "@ryachza I&#39;m using an <code>MVar</code> at the moment, but I&#39;m still wondering what the &#39;standard&#39; way of doing this is (if there is a such a thing)."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502908238, "post_id": 45693237, "comment_id": 78399593, "body": "*is such a thing"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502912436, "post_id": 45693237, "comment_id": 78401552, "body": "I think <code>mask</code> is designed for exactly the occasion when you have a block that you don&#39;t want interrupted if an asynchronous exception is thrown, which sounds like what you&#39;re looking for? Perhaps you could expand your code sample and indicate how you want to cancel and what you don&#39;t want interrupted? Because as it is I don&#39;t think it would be working the way you hope if I&#39;m understanding your question."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502913075, "post_id": 45693237, "comment_id": 78401827, "body": "@ryachza I&#39;ll add the code. Works fine (atleast for now)."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502913187, "post_id": 45693237, "comment_id": 78401884, "body": "@ryachza And no, perhaps I should have been more specific. I&#39;m not worried about exceptions specifically. Rather, I want to be able to cancel an action, but not eg. in the middle of a loop body. I think the code snippet will clear it up."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502913300, "post_id": 45693237, "comment_id": 78401947, "body": "The way <code>cancel</code> works is by throwing an exception to the thread <code>async</code> spawns. <code>mask</code> should cause that exception to &quot;wait&quot; (blocking the thrower) until outside the block you don&#39;t want interrupted."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502913581, "post_id": 45693237, "comment_id": 78402074, "body": "I&#39;m aware of how <code>cancel</code> works, which is why I&#39;m not using it in my function atm."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502913601, "post_id": 45693237, "comment_id": 78402085, "body": "Looking at the updated code, it doesn&#39;t seem like you&#39;re canceling or waiting for the spawned thread to complete - just setting the &quot;stop&quot; flag and moving on. I would probably at least add a <code>wait</code> after setting the <code>MVar</code>, but otherwise I think what you have is fine though fundamentally different from what you asked about <code>cancel</code> and interruption."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502913874, "post_id": 45693237, "comment_id": 78402212, "body": "Again, maybe I should have been clearer. I&#39;m simply looking for a way of stopping a thread at a specific point (or <i>not</i> stopping it at some other point). I used the word &#39;cancelling&#39; in a generic sense. Adding <code>wait</code> is probably a good idea though (I removed it when clearing out some debug logic)."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502914448, "post_id": 45693237, "comment_id": 78402520, "body": "@ryachza Wanna write up an answer so I can accept it?"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1502971061, "post_id": 45693237, "comment_id": 78426566, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/152151/discussion-between-swiftsnamesake-and-ryachza\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1502917310, "post_id": 45722768, "comment_id": 78403774, "body": "My question was really about the <b>preferred/best/most efficient/orthodox</b> way of interrupting a thread at a specific point. I&#39;m <i>not</i> just looking for the nicest way of implementing <code>awaitResult</code> (which admittedly could use some polishing). As an aside, it&#39;s rather important in my particular case that the action executes in the main thread."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1502917860, "post_id": 45722768, "comment_id": 78403990, "body": "@SwiftsNamesake I&#39;m not sure there is one, in general. I think it would be preferred to avoid explicit <code>MVar</code> management if possible, but sometimes it is the best option. If you can present an example and/or a set of requirements I would be happy to take a look. In <code>awaitResult</code>, for example, there&#39;s the potential for a significant (depending on your definition) delay between the action completing and the result propagating."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1502918097, "post_id": 45722768, "comment_id": 78404077, "body": "I&#39;ll follow up tomorrow. Thank you for your time."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1502918243, "post_id": 45722768, "comment_id": 78404138, "body": "@SwiftsNamesake Sure thing. I can&#39;t during the day (firewall) but in the evening I would be happy to use chat if you&#39;d like."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 1, "last_activity_date": 1502916583, "creation_date": 1502916583, "answer_id": 45722768, "question_id": 45693237, "link": "https://stackoverflow.com/questions/45693237/elegant-egress-from-async-actions/45722768#45722768", "title": "Elegant egress from `Async` actions", "body": "<p>The phrasing of the question made me think of a more antagonistic relationship, in which case using <code>Control.Concurrent.mask</code> to limit when the task can be interrupted should be reasonable.</p>\n\n<p>Based on the updated code it seems the threads have a tight coupling and the first alternative I can think of would be spawning the action instead of the indicator and using <code>poll</code>, which I think is less noisy than the <code>MVar</code> route:</p>\n\n<pre><code>import Control.Monad (forM_)\nimport Control.Exception (throw)\nimport Control.Concurrent (threadDelay)\nimport Control.Concurrent.Async (Async,async,poll)\n\nsecond :: (Num a) =&gt; a\nsecond = 1000000\n\nawaitResult :: String -&gt; IO a -&gt; IO a\nawaitResult s act = do\n  putStrLn s\n  a &lt;- async $ act\n  ellipsis a\n  where\n    ellipsis :: Async a -&gt; IO a\n    ellipsis a = do\n      result &lt;- poll a\n      case result of\n        Nothing -&gt; do\n          forM_ [\".  \",\".. \",\"...\",\"   \"] $ \\dots -&gt; do\n            putStr dots\n            putStr \"\\r\"\n            threadDelay $ floor $ 0.4 * second\n          ellipsis a\n        Just (Left e) -&gt; throw e\n        Just (Right x) -&gt; return x\n\nmain = awaitResult \"testing\" (threadDelay (5 * second) &gt;&gt; return 5)\n</code></pre>\n"}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1502916583, "creation_date": 1502801549, "last_edit_date": 1502913248, "question_id": 45693237, "link": "https://stackoverflow.com/questions/45693237/elegant-egress-from-async-actions", "title": "Elegant egress from `Async` actions", "body": "<p>Is there a simple way of cancelling an <code>Async a</code> value, such that it won't be interrupted in the middle of some critical action? I suppose I could use a semaphore inside a loop condition.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>async $ whileM readSemaphore runLoopBody\n</code></pre>\n\n<p>But I'd like to know whether <code>async</code> or some other related library supports it out-of-the-box.</p>\n\n<hr>\n\n<p>My code, as requested.</p>\n\n<pre><code>-- |\n-- TODO | - Rename (?)\n--        - Time-out\nawaitResult :: String -&gt; IO a -&gt; IO a\nawaitResult s act = do\n  putStr s\n  sem &lt;- newMVar True\n  a &lt;- async $ ellipsis sem\n  r &lt;- act\n  swapMVar sem False\n  return r\n  where\n    ellipsis :: MVar Bool -&gt; IO ()\n    ellipsis sem = void $ do\n      whileM (readMVar sem) $ forM [\".  \", \".. \", \"...\", \"   \"] $ \\dots -&gt; do\n        putStr dots\n        cursorBackward 3\n        threadDelay (floor $ 0.4 * second)\n      -- TODO | - If the Windows console wasn't shit, I'd use a checkmark\n      putStr \" (\" &gt;&gt; withPretty fgGreen \"done\" &gt;&gt; putStrLn \")\"\n</code></pre>\n"}, {"tags": ["haskell", "floating-point", "rounding", "built-in"], "comments": [{"owner": {"reputation": 2158, "user_id": 7190191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80c97da8e6a0d7784317a81a3e8539ca?s=128&d=identicon&r=PG&f=1", "display_name": "grepcake", "link": "https://stackoverflow.com/users/7190191/grepcake"}, "edited": false, "score": 1, "creation_date": 1502774367, "post_id": 45686791, "comment_id": 78331236, "body": "You can try searching <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">hoogle</a> for <code>RealFrac a =&gt; a -&gt; a</code>. I could find nothing, though"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 2158, "user_id": 7190191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80c97da8e6a0d7784317a81a3e8539ca?s=128&d=identicon&r=PG&f=1", "display_name": "grepcake", "link": "https://stackoverflow.com/users/7190191/grepcake"}, "edited": false, "score": 0, "creation_date": 1502774597, "post_id": 45686791, "comment_id": 78331296, "body": "@A.Yurchenko Yeah, that&#39;s what I did before asking this question. Like you, I came up empty-handed."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502778754, "post_id": 45686791, "comment_id": 78332728, "body": "What is wrong with defining <code>sameTypeRound f = fromIntegral (round f)</code>?"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1502779458, "post_id": 45686791, "comment_id": 78332970, "body": "@user2407038 Nothing really. I&#39;ll probably settle for that definition, albeit with a different name. I&#39;m just curious though, because most languages I&#39;m familiar with don&#39;t have type-changing <code>round</code>, <code>ceiling</code> and <code>floor</code> functions. Although admittedly, it makes sense for those functions to return an integer type, especially given the nature of Haskell."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502779860, "post_id": 45686791, "comment_id": 78333125, "body": "&quot;it makes sense for those functions to return an integer type, especially given the nature of Haskell&quot; - indeed, the strength of the Haskell type system makes it easy to model the true type of <code>round</code>, which is <code>Real -&gt; Integer</code>. If we had <code>round&#39; :: Real -&gt; Real</code> then recovering <code>round</code> from this function would be somewhat difficult. But as you&#39;ve seen, the other direction is very easy. Furthermore, the standard lib. doesn&#39;t typically define <code>h = f . g</code> if <code>f</code> and <code>g</code> are already library functions; if it did, the syntactic noise would be simply intractable."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502780348, "post_id": 45686791, "comment_id": 78333346, "body": "@user2407038 I&#39;m not baffled by the fact that it&#39;s not defined in <code>base</code> or <code>Prelude</code>, merely curious. I take your point about function compositions, although the upshot of that is that you end up redefining <i>very</i> common operations yourself, or depending on a metric tonne of fairly small libraries. Not a major concern, but I suppose it irks me slightly in spite of that."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502780405, "post_id": 45686791, "comment_id": 78333375, "body": "@user2407038 If you write up a short answer stating that such a function <i>does not exist</i> in the Prelude and explain why (as you already have in the comments), I&#39;ll happily accept it."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 3, "creation_date": 1502787505, "post_id": 45686791, "comment_id": 78336824, "body": "If you do define <code>sameTypeRound</code> I would use <code>fromInteger . round</code> instead of <code>fromIntegral . round</code>. It fixes the ambiguous type without a type signature and <code>fromIntegral</code> is just <code>fromInteger . toInteger</code> anyway."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502817677, "post_id": 45686791, "comment_id": 78354580, "body": "Interesting. I wonder why <code>round</code> was not given the type <code>round :: (RealFrac a, Num b) =&gt; a -&gt; b</code>. Then you could literally just use <code>round</code>; and none of the methods that <code>Integral</code> has but <code>Num</code> doesn&#39;t seem particularly useful for implementing <code>round</code>. This might be worth a separate question."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502873799, "post_id": 45686791, "comment_id": 78376326, "body": "@DanielWagner <code>properFraction</code> returns an <code>(Integral, Real)</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502906065, "post_id": 45686791, "comment_id": 78398462, "body": "@SwiftsNamesake That just pushes the question one layer deeper: why isn&#39;t <i>that</i> one a <code>(Num a, Real b) =&gt; (a, b)</code>?"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502906275, "post_id": 45686791, "comment_id": 78398616, "body": "@DanielWagner Probably because the first value <i>has</i> to be a whole number, and the type ensures that. Haskellers are pretty fond of encoding properties via types. That being said, I obviously agree with you that the type you suggest would be <i>useful</i> (it&#39;s why I asked the question, after all)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502906526, "post_id": 45686791, "comment_id": 78398755, "body": "@SwiftsNamesake Values of type <code>forall a. Num a =&gt; a</code> are <i>also</i> guaranteed to be whole numbers: by parametricity, they can only be constructed by applications of the <code>Num</code> methods, which all look like they preserve whole-ness to me."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1502907492, "post_id": 45686791, "comment_id": 78399241, "body": "<code>abs</code> doesn&#39;t preserve whole-ness for certain types (and type classes can&#39;t enforce rules beyond types). There&#39;s also the matter of <code>Num</code> being the class for <i>all numbers</i> (conceptually). Again, if I had to hazard a guess as to what the motivation was, I&#39;d say it&#39;s about what the types signify. I wouldn&#39;t be the first to say that the numerical hierarchy is broken in some ways though."}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1502773654, "creation_date": 1502773654, "question_id": 45686791, "link": "https://stackoverflow.com/questions/45686791/type-preserving-rounding-in-haskell", "title": "Type-preserving rounding in Haskell", "body": "<p>Is there a <em>built-in</em> function in Haskell that rounds a real floating-point number to the nearest whole number, without changing the type of said number?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sameTypeRound f == fromIntegral (round f)\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 7, "creation_date": 1502775587, "post_id": 45686726, "comment_id": 78331602, "body": "Note that the source code for <code>ReaderT</code> is <code>newtype ReaderT r m a = ReaderT { runReaderT :: r -&gt; m a }</code>. The <code>k</code> is only generated in the documentation by Haddock to emphasize the poly-kindedness of <code>ReaderT</code> (<code>-XPolyKinds</code> is enabled in the module where it is defined)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1502779063, "post_id": 45686726, "comment_id": 78332850, "body": "&quot;I am attempting to derive a new monad from ReaderT with IO as the base monad and a class constraint on the r value&quot; - while this is likely to cause more problems than it solves (the placing of a constraint on the <code>r</code> value, not the derivation of a new type from <code>ReaderT</code> with <code>m</code> instantiated to <code>IO</code>) I don&#39;t see why doing this would be impeded by the polykinded definition of <code>ReaderT</code>. As @Alec states, the <code>k</code> parameter is an artifact of haddock - in reality, it is entirely implicit, and you can pretend that <code>ReaderT :: (* -&gt; *) -&gt; * -&gt; *</code> (because it does indeed have that type)."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502859430, "post_id": 45686726, "comment_id": 78368851, "body": "@user2407038 and nicolas You are both correct.  The constraint belonged and is now placed on an instance declaration not the monad definition."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502861149, "post_id": 45686726, "comment_id": 78369357, "body": "@Alec, I think this is the real answer to my question. (Make it an answer instread of a comment and I&#39;ll accept it.) As a follow up where did the type constructor and the field name disappear to in the documentation.  Those are useful to know."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502865429, "post_id": 45686726, "comment_id": 78371125, "body": "I&#39;m hoping someday Haddock will put kind arguments in curly braces or something like that (or maybe prefix them with <code>@</code>). It can get confusing to read the kind arguments and type arguments together (I guess <code>TypeInType</code> might blur things a bit though)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1502898908, "post_id": 45686726, "comment_id": 78394358, "body": "@JohnF.Miller I can see both the constructor and field name <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html#t:ReaderT\" rel=\"nofollow noreferrer\">here</a>. Where do you find that it is omitted? (If you do not see it there, you should - I can only guess that there is something strange going on with your browser)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502937671, "post_id": 45686726, "comment_id": 78409113, "body": "@JohnF.Miller I recommend you just ask the existing answerer to modify his answer to mention Haddock. I reckon most people who stumble on this question will probably see my comment anyways"}], "answers": [{"comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1502859531, "post_id": 45686951, "comment_id": 78368872, "body": "You are correct. The constraint belonged and is now placed on an instance declaration not the monad definition."}], "tags": [], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "is_accepted": true, "score": 5, "last_activity_date": 1503216149, "last_edit_date": 1503216149, "creation_date": 1502775003, "answer_id": 45686951, "question_id": 45686726, "link": "https://stackoverflow.com/questions/45686726/what-is-the-purpose-of-in-the-readert-monad-transformer/45686951#45686951", "title": "What is the purpose of * in the ReaderT Monad Transformer?", "body": "<p><code>*</code> is the kind of types with values : it stands for things like <code>Int</code>, <code>List Int</code> etc..</p>\n\n<p><code>forall k</code> means <code>k</code> is not necessarily of that kind. it stands for any kind of types, viewed as simply static things which you can declare and manipulate, but are not necessarily associated with runtime values. One example of this is when you want to 'decorate' some other type with extra information : the embroidering type has no reason to have any sort of value attached to it, it is \"pure\" information, to some embroided type (which usually have values)</p>\n\n<p>More simply here, you can see that in <code>Reader</code> it all gets specialized to <code>*</code>, and <code>m</code> is specialised to the <code>Identity</code> monad. That's where you'd want your <code>IO</code> monad to be.</p>\n\n<p>As for the constraints, it is best to not specify it in the type itself. Upon usage, where you use a particular method attached to the typeclass, it will get added on the fly. Indeed there are no reason expressions written which do not use a method should be burdened by requiring their callers to provide it.</p>\n\n<p>(Unless you have a very good reason to, for deducing other instances, as in <code>Dict</code> where you capture a typeclass witness as a runtime value with a GADT, but that's probably not what you want to do)</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 1, "accepted_answer_id": 45686951, "answer_count": 1, "score": 6, "last_activity_date": 1503216149, "creation_date": 1502773093, "last_edit_date": 1502788855, "question_id": 45686726, "link": "https://stackoverflow.com/questions/45686726/what-is-the-purpose-of-in-the-readert-monad-transformer", "title": "What is the purpose of * in the ReaderT Monad Transformer?", "body": "<p>I am looking at <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html\" rel=\"noreferrer\">the documentation</a> for the <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html#t:Reader\" rel=\"noreferrer\">Reader monad</a> and <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html#t:ReaderT\" rel=\"noreferrer\">ReaderT</a> monad transformer.</p>\n\n<p>The relevant definitions are:</p>\n\n<pre><code>newtype ReaderT k r m a :: forall k. * -&gt; (k -&gt; *) -&gt; k -&gt; *\ntype Reader r = ReaderT * r Identity\n</code></pre>\n\n<p>I don't understand what the <code>*</code> are doing in the definitions.  In particular I am attempting to derive a new monad from ReaderT with IO as the base monad and a class constraint on the <code>r</code> value.</p>\n\n<p>I am not sure why there is a fourth input to ReaderT (<code>k</code>) and what Reader is doing with that value when it puts a * in that position.</p>\n"}, {"tags": ["haskell", "emacs", "haskell-stack"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1503108458, "post_id": 45684261, "comment_id": 78492470, "body": "Do you happen to have a public link to this project? It is tough to debug without an example..."}, {"owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503291055, "post_id": 45684261, "comment_id": 78536630, "body": "@Alec: <a href=\"https://github.com/amcphail/gpe\" rel=\"nofollow noreferrer\">github.com/amcphail/gpe</a>  It is not finished, I have uploaded in response to your comment.  I am in the development stage where it is helpful to load files in emacs."}], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 5, "last_activity_date": 1503672519, "creation_date": 1503672519, "answer_id": 45884061, "question_id": 45684261, "link": "https://stackoverflow.com/questions/45684261/in-emacs-stack-ghci-cannot-load-interface-files-but-stack-build-from-the-comma/45884061#45884061", "title": "In emacs stack-ghci cannot load interface files but `stack build` from the command line does", "body": "<p>I was able to compile your project with <code>stack build</code> (of course, after installing a few system wide dependencies like llvm, cuda, fftw3 etc.) and load it fine with <code>C-c C-l</code> in emacs.</p>\n\n<p>Here is the minimal emacs config that worked for me:</p>\n\n<pre><code>(defun haskell-mode-setup ()\n  (setq haskell-process-type 'stack-ghci))\n\n(add-hook 'haskell-mode-hook 'interactive-haskell-mode)\n(add-hook 'haskell-mode-hook 'haskell-mode-setup)\n</code></pre>\n\n<p>The only ways I was able to replicate the issue you are having was with  <code>inf-haskell-mode</code>, instead of <code>interactive-haskell-mode</code>, as well as simply by setting \n<code>(setq haskell-process-type 'ghci)</code>. So, it is possible that emacs doesn't find <code>stack</code>.</p>\n\n<p>I'd recommend trying to let haskell-mode know where stack is, in case that it is installed in a non-common location: <code>(setq haskell-process-path-stack \"/path/to/stack\")</code>.</p>\n\n<p>Alternatively, I've solved a few issues in the past related to <code>$PATH</code> environment variable being not the same that is set for the current user, but the one that is used system wide. Simply install <code>exec-path-from-shell</code> emacs package and add <code>(exec-path-from-shell-initialize)</code> to the <code>~/.emacs</code>.</p>\n\n<p>Also, if you haven't done it yet, inspecting haskell-mode log could prove being useful. Add <code>(setq haskell-process-log t)</code> to <code>haskell-mode-setup</code>, which will result in an extra buffer with the log.</p>\n\n<p>Notes:</p>\n\n<ul>\n<li>In order to compile your package, I had to remove few lines from <code>stack.yaml</code>, namely ones that include local dirs <code>/home/amcp011/local/</code>, which are not included in the repo and use my system installed <code>gcc</code> instead of one from <code>RHEL6.3</code>.</li>\n<li>If you use some other emacs packages besides <code>haskell-mode</code>, they might be the cause of the problem as well. I've tested it with <code>intero</code> and <code>flycheck</code> without any problems.</li>\n<li>Try upgrading to newest <code>stack upgrade</code> and <code>haskell-mode</code>, maybe that will help. I've tested with <code>stack-1.5.1</code> and <code>haskell-mode-20170824.1124</code> on <code>emacs-25.2.2</code></li>\n</ul>\n"}], "owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 1, "accepted_answer_id": 45884061, "answer_count": 1, "score": 7, "last_activity_date": 1503672519, "creation_date": 1502751683, "last_edit_date": 1503615133, "question_id": 45684261, "link": "https://stackoverflow.com/questions/45684261/in-emacs-stack-ghci-cannot-load-interface-files-but-stack-build-from-the-comma", "title": "In emacs stack-ghci cannot load interface files but `stack build` from the command line does", "body": "<p>I can <code>stack build</code> a project from the command line but when I try <code>C-c C-l</code> in emacs (with <code>(custom-set-variables '(haskell-process-type 'stack-ghci))</code>) I get an error that all the package modules I import can't be found.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>/home/amcp011/bec/amcp011/accelerate/gpe/src/Numeric/GPE/Utils.hs:30:1: error:\n    Failed to load interface for \u2018Data.Array.Accelerate\u2019\n    Locations searched:\n      Data/Array/Accelerate.hs\n      Data/Array/Accelerate.lhs\n      Data/Array/Accelerate.hsig\n      Data/Array/Accelerate.lhsig\n      /home/amcp011/bec/amcp011/accelerate/gpe/src/Data/Array/Accelerate.hs\n      /home/amcp011/bec/amcp011/accelerate/gpe/src/Data/Array/Accelerate.lhs\n      /home/amcp011/bec/amcp011/accelerate/gpe/src/Data/Array/Accelerate.hsig\n      /home/amcp011/bec/amcp011/accelerate/gpe/src/Data/Array/Accelerate.lhsig\n</code></pre>\n\n<p><code>gpe.cabal</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                   , bytestring\n                   , bytestring-conversion\n                   , mtl\n                   , time\n                   , filepath\n                   , directory\n                   , accelerate\n                   , accelerate-io\n</code></pre>\n\n<p><code>stack.yaml</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>extra-deps: [accelerate-1.0.0.0\n            ,accelerate-io-1.0.0.0\n            ]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502740400, "post_id": 45681982, "comment_id": 78321941, "body": "The usual solution is to make the executables separate projects that depend on a shared library."}, {"owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502740852, "post_id": 45681982, "comment_id": 78322145, "body": "@ReinHenrichs that&#39;s actually what I&#39;m currently doing, but there are many executables in my project, even linking each of them takes sometime and I cannot choose to link only some of them due to <a href=\"https://github.com/commercialhaskell/stack/issues/1406\" rel=\"nofollow noreferrer\">stack#issue1406</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502742258, "post_id": 45681982, "comment_id": 78322830, "body": "If I understand correctly, you have k <code>executable</code> fields in your cabal file which you would like to replace with a single executable field, but still have <code>stack exec</code> recognize the k executables you have before. I don&#39;t think that is possible, but I think you could have k <code>executable</code> fields as before, except replacing <code>k-1</code> of them with some &#39;dummy&#39; program (e.g. <code>main = return ()</code>) and having a custom <code>Setup.hs</code> which has a hook which overwrites the dummies with the &#39;true&#39; executable. This still requires many <code>executable</code> fields, but it doesn&#39;t require linking the same program many times."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502744476, "post_id": 45681982, "comment_id": 78323922, "body": "Or you could use git&#39;s (conceptual) model: one executable with k subcommands."}, {"owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502747849, "post_id": 45681982, "comment_id": 78325318, "body": "@ReinHenrichs that&#39;s the idea I initially came up with, i.e. <code>foo</code> in my example, but later I want to shorten the commands a bit, therefore turning <code>foo progA ...</code> into <code>progA ...</code>"}, {"owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502748166, "post_id": 45681982, "comment_id": 78325441, "body": "@user2407038 yes that&#39;s what I&#39;m trying to do. I&#39;ve been considering <code>Setup.hs</code> to be a project boilerplate for years, but in my case this might come in handy - I&#39;ll take a look and see if that works"}], "owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 147, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1502741135, "creation_date": 1502740053, "last_edit_date": 1502741135, "question_id": 45681982, "link": "https://stackoverflow.com/questions/45681982/is-it-possible-to-make-program-aliases-in-stack-exec", "title": "is it possible to make program aliases in `stack exec`?", "body": "<p>I have a project that has many small executable targets. It takes quite a lot of time whenever the source code changes due to the problem that you cannot avoid building every executables in the project.</p>\n\n<p>So instead I'm trying to have one single executable who decides its own behavior by checking its name (perhaps by using <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/System-Environment.html\" rel=\"nofollow noreferrer\"><code>getProgName</code></a>): for example, I can build a single executable name <code>foo</code>, and two soft links targeting at it, one called <code>progA</code> and another <code>progB</code>: I want it to behave like there are three separated programs:</p>\n\n<ul>\n<li><code>foo [progA|progB]</code> print help messages when arguments are missing, or run as if it's <code>progA</code> or <code>progB</code> if <code>foo</code> is equal to either of them</li>\n<li><code>progA</code> &amp; <code>progB</code>: as if there are separated binaries</li>\n</ul>\n\n<p>As I don't want my project executables to be exposed globally, what I usually do is just <code>stack build &amp;&amp; stack exec -- &lt;progName&gt; [...args]</code>. My question is: is it possible to have one single executable (namely <code>foo</code> in my example) in <code>.cabal</code> file, while stack does something under the hood to make available <code>stack exec -- progA</code> and <code>stack exec -- progB</code>?</p>\n\n<p>I know I could get and parse <code>PATH</code> from the environment in which <code>stack exec</code> runs, and make soft links accordingly there, but I'll prefer a less hacky method.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502751584, "post_id": 45681820, "comment_id": 78326482, "body": "I don&#39;t believe the library itself offers a way to combine <code>Splitter</code>s sensibly. Perhaps it is time to upgrade to a real parser."}], "answers": [{"tags": [], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "is_accepted": false, "score": 0, "last_activity_date": 1511028625, "creation_date": 1511028625, "answer_id": 47369399, "question_id": 45681820, "link": "https://stackoverflow.com/questions/45681820/how-can-i-combine-multiple-splitting-criterion-when-using-haskell-package-split/47369399#47369399", "title": "How can I combine multiple splitting criterion when using Haskell package split?", "body": "<p>I ended up with break and a lambda expression like </p>\n\n<pre><code>break (\\t -&gt;   isPrefixOf' \"a\"  t\n            || isPrefixOf' \"ab\" t\n            || isPrefixOf' \"aac\" t\n       ) input\n</code></pre>\n\n<p>not really nice nor clever, but does the trick.\nNote: <code>break</code> has similar functionality as <code>split</code> but expects a condition as argument.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1511028625, "creation_date": 1502739370, "question_id": 45681820, "link": "https://stackoverflow.com/questions/45681820/how-can-i-combine-multiple-splitting-criterion-when-using-haskell-package-split", "title": "How can I combine multiple splitting criterion when using Haskell package split?", "body": "<p>i use <code>Data.List.Split</code> from <code>split</code> on <code>Hackage</code> to split a text into sublists at \". \" (period followed by blank) with </p>\n\n<pre><code>split (keepDelimsR $ onSublist \". \"  )\n</code></pre>\n\n<p>but I would like to split on multiple sequence (i.e. \"? \" (question mark, blank), possibly others.\nFrom the documentation in split i cannot see how to use multiple (more than one character) conditions to split. </p>\n\n<p>Anybody knows a solution? Thank you!</p>\n"}, {"tags": ["function", "haskell", "floating-point"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1502755301, "post_id": 45681347, "comment_id": 78327365, "body": "The minimal change is to give <code>e</code> a polymorphic type signature just like you did for <code>fermiFunc</code>. Defining <code>one</code> isn&#39;t needed at all; just use <code>1</code> instead. But the answers here that suggest more radical changes are great."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1502741124, "post_id": 45681482, "comment_id": 78322265, "body": "Yes, however <code>e**(-x)</code> translates to <code>exp ((-x) * log e)</code>, where <code>log e</code> is a very inefficient way of writing <code>1</code>. (Though not quite as inefficient as defining <code>one = fromIntegral 1</code>, granted...)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1502741192, "post_id": 45681482, "comment_id": 78322305, "body": "That&#39;s true, and I&#39;m glad your answer corrects this, but I think the rest of my answer is still useful. The misuse of <code>e</code> is somewhat tangential to the question, which is really about ad hoc polymorphism, imo."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1502741388, "post_id": 45681482, "comment_id": 78322419, "body": "<code>fermiFunc = recip . succ . exp . negate</code> is beautiful though."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 8, "last_activity_date": 1502740621, "last_edit_date": 1502740621, "creation_date": 1502737935, "answer_id": 45681482, "question_id": 45681347, "link": "https://stackoverflow.com/questions/45681347/what-is-the-nicest-way-to-make-a-function-that-takes-float-or-double-as-input/45681482#45681482", "title": "What is the nicest way to make a function that takes Float or Double as input?", "body": "<p>Assuming that you want floating point exponent, that's <code>(**)</code>. <code>(^)</code> is integral exponent. Rewriting your function to use <code>(**)</code> and letting GHC infer the type gives:</p>\n\n<pre><code>fermiFunc x = 1/(1 + e ** (-x))\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; :t fermiFunc\nfermiFunc :: (Floating a) =&gt; a -&gt; a\n</code></pre>\n\n<p>Since <code>Float</code> and <code>Double</code> both have <code>Floating</code> instances, <code>fermiFunc</code> is now sufficiently polymorphic to work with both.</p>\n\n<p>(Note: you may need to declare a polymorphic type for <code>e</code> to get around the monomorphism restriction, i.e., <code>e :: Floating a =&gt; a</code>.)</p>\n\n<p>In general, the answer to \"How do I write a function that works with multiple types?\" is either \"Write it so that it works universally for all types.\" (parametric polymorphism, like <code>map</code>), \"Find (or create) one or more typeclasses that they share that provides the behaviour you need.\" (ad hoc polymorphism, like <code>show</code>), or \"Create a new type that is the sum of those types.\" (like <code>Either</code>).</p>\n\n<p>The latter two have some tradeoffs. For instance, type classes are open (you can add more at any time) while sum types are closed (you must modify the definition to add more types). Sum types require you to know which type you are dealing with (because it must be matched up with a constructor) while type classes let you write polymorphic functions.</p>\n\n<p>You can use <code>:i</code> in GHCi to list instances and to list instance methods, which might help you to locate a suitable typeclass.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1502741658, "last_edit_date": 1502741658, "creation_date": 1502740785, "answer_id": 45682157, "question_id": 45681347, "link": "https://stackoverflow.com/questions/45681347/what-is-the-nicest-way-to-make-a-function-that-takes-float-or-double-as-input/45682157#45682157", "title": "What is the nicest way to make a function that takes Float or Double as input?", "body": "<p>Don't write <code>e^x</code>, ever, in any language. That is not the exponential function, it's the <em>power function</em>.</p>\n\n<p>The exponential function is called <code>exp</code>, and its definition actually has little to do with the power operation \u2013 it's defined, depending on your taste, as a Taylor series or as <a href=\"https://en.wikipedia.org/wiki/Picard%E2%80%93Lindel%C3%B6f_theorem\" rel=\"noreferrer\">the unique solution</a> to the ordinary differential equation <sup>d</sup>\u2044<sub>d\ud835\udc65</sub> exp \ud835\udc65 = exp \ud835\udc65 with boundary condition exp 0 = 1. Now, it so happens that, for any rational <em>n</em>, we have exp <em>n</em> \u2261 (exp 1)<sup><em>n</em></sup> and that motivates also defining the power operation for numbers in \u211d or \u2102 addition to \u211a, namely as</p>\n\n<p><em>a</em><sup><em>z</em></sup> := exp (<em>z</em> \u00b7 ln <em>a</em>)</p>\n\n<p>...but <em>e</em><sup>\ud835\udc65</sup> should be understood as really just a shortcut for writing exp(\ud835\udc65) itself.</p>\n\n<p>So rather than defining <code>e</code> somewhere and trying to take some power of it, you should use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:exp\" rel=\"noreferrer\"><code>exp</code></a> just as it is.</p>\n\n<pre><code>fermiFunc :: Floating a =&gt; a -&gt; a\nfermiFunc x = 1/(1 + exp (-x))\n</code></pre>\n\n<p>...or indeed</p>\n\n<pre><code>fermiFunc = recip . succ . exp . negate\n</code></pre>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 45682157, "answer_count": 2, "score": 3, "last_activity_date": 1502741658, "creation_date": 1502737393, "question_id": 45681347, "link": "https://stackoverflow.com/questions/45681347/what-is-the-nicest-way-to-make-a-function-that-takes-float-or-double-as-input", "title": "What is the nicest way to make a function that takes Float or Double as input?", "body": "<p>Say I want to implement the Fermi function (the simplest example of a logistic curve) so that if it's passed a <code>Float</code> it returns a <code>Float</code> and if it's passed a <code>Double</code> it returns a <code>Double</code>. Here's what I've got:</p>\n\n<pre><code>e = 2.7182845904523536\n\nfermiFunc :: (Floating a) =&gt; a -&gt; a\nfermiFunc x = let one = fromIntegral 1 in one/(one + e^(-x))\n</code></pre>\n\n<p>The problem is that ghc says <code>e</code> is a <code>Double</code>. Defining the variable <code>one</code> is also kinda gross. The other solution I've thought of is to just define the function for doubles:</p>\n\n<pre><code>e = 2.7182845904523536\n\nfermiFuncDouble :: Double -&gt; Double\nfermiFuncDouble x = 1.0/(1.0 + e^(-x))\n</code></pre>\n\n<p>Then using <code>Either</code>:</p>\n\n<pre><code>fermiFunc :: (Floating a) =&gt; Either Float Double -&gt; a\nfermiFunc Right x = double2Float (fermiFuncDouble (float2Double x))\nfermiFunc Left x = fermiFuncDouble x\n</code></pre>\n\n<p>This isn't very exciting though because I might as well have just written a separate function for the <code>Float</code> case that just handles the casting and calls <code>fermiFuncDouble</code>. Is there a nice way to write a function for both types?</p>\n"}, {"tags": ["algorithm", "performance", "haskell", "optimization"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1502731293, "post_id": 45678702, "comment_id": 78317165, "body": "You&#39;ve reimplemented quite a lot of stuff that&#39;s already in the standard library. <code>subsets</code> is <code>subsequences</code>; <code>divides</code> is not used at all; <code>coprime_list</code> is <code>all . coprime</code>; <code>coprime_subsets_helper</code> is <code>filter mutually_coprime</code>; <code>list_length</code> is <code>length</code>; <code>max_element</code> is <code>maximum . (0:)</code>. None of these changes should affect the runtime much, but it will make your code much more readable to folks here, and make the computational core of your problem much more obvious."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1502732799, "post_id": 45678702, "comment_id": 78317912, "body": "By the way, this problem can be formulated as finding the <a href=\"https://en.wikipedia.org/wiki/Clique_problem#Finding_maximum_cliques_in_arbitrary_graphs\" rel=\"nofollow noreferrer\">largest maximal cliques</a> in the graph whose nodes are numbers and where there are edges between coprime nodes. The best known general-purpose algorithm for finding maximal cliques is exponential (roughly O(1.3^n)), so if you want a more efficient algorithm than that you are going to have to exploit the structure of coprimeness somehow -- which a priori sounds hard to me."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1502734283, "last_edit_date": 1502734283, "creation_date": 1502732140, "answer_id": 45679941, "question_id": 45678702, "link": "https://stackoverflow.com/questions/45678702/trying-to-optimize-this-algorithm-code-to-compute-the-largest-subset-of-mutually/45679941#45679941", "title": "Trying to optimize this algorithm/code to compute the largest subset of mutually coprime integers between a and b", "body": "<p>I suggest two main changes:</p>\n\n<ol>\n<li>Compute the <code>gcd</code> just once for each pair of numbers, rather than repeatedly.</li>\n<li>Only extend \"acceptable\" subsets, rather than constructing all subsets up front.</li>\n</ol>\n\n<p>(Neither suggestion is related to laziness at all; I think that guess of yours was a red herring.) Below I implement these two suggestions; it turned out quite succinct, I think:</p>\n\n<pre><code>coprime_subsets' [] = [[]]\ncoprime_subsets' (x:xs)\n    = coprime_subsets' xs\n    ++ map (x:) (coprime_subsets' (filter ((1==) . gcd x) xs))\n</code></pre>\n\n<p>We can check that this computes the same answers in ghci:</p>\n\n<pre><code>&gt; coprime_subsets 10 20 == coprime_subsets' [10..20]\nTrue\n&gt; coprime_subsets 100 120 == coprime_subsets' [100..120]\nTrue\n</code></pre>\n\n<p>Apparently my computer is much faster than yours: <code>coprime_subsets 100 120</code> completes in just under 16 seconds here even in ghci. Of course, my version takes 0.02 seconds even in ghci, so... =)</p>\n\n<p><s>If you only care about maximal coprime subsets, you can make it faster still. The main change here is the addition of the <code>filter</code> in front of the recursion:</p>\n\n<pre><code>maximal_coprime_subsets [] = [[]]\nmaximal_coprime_subsets (x:xs)\n    = filter (any ((&gt;1) . gcd x)) (maximal_coprime_subsets xs)\n    ++ map (x:) (maximal_coprime_subsets (filter ((1==) . gcd x) xs))\n</code></pre>\n\n<p>Even though this one repeats <code>gcd</code>s much more, it can do <code>[100..120]</code> in around 0.01 seconds even in ghci, so it's a fair factor faster than the previous implementation.</s></p>\n\n<p>The difference in timing here appears to be that the output <code>coprime_subsets'</code> just took longer to print, ha!</p>\n"}, {"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1502741583, "post_id": 45680808, "comment_id": 78322513, "body": "I understand what &quot;the slow&quot; means, but consider that this phrase may be difficult to comprehend, esp. to non-native speakers of English. For the benefit of future readers, please consider replacing it with some more standard terminology."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1502742566, "post_id": 45680808, "comment_id": 78322997, "body": "Maximal cliques is exponential, not quadratic. This matters, because improving the base of an exponential is an improvement in the asymptotic complexity -- so there can be hope to do better without <i>just</i> improving the constant factors. However, I love the pedagogical value of this answer, and the explanation of the approach one can generally use when tackling this kind of performance problem."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502742600, "post_id": 45680808, "comment_id": 78323022, "body": "@DanielWagner Thanks for the correction, I&#39;m working on an edit."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 5, "last_activity_date": 1502742949, "last_edit_date": 1502742949, "creation_date": 1502735503, "answer_id": 45680808, "question_id": 45678702, "link": "https://stackoverflow.com/questions/45678702/trying-to-optimize-this-algorithm-code-to-compute-the-largest-subset-of-mutually/45680808#45680808", "title": "Trying to optimize this algorithm/code to compute the largest subset of mutually coprime integers between a and b", "body": "<h2>First, we must find out what is slow.</h2>\n\n<p>When working with numbers, one should use the fastest representation that provides the required accuracy and range. Your code doesn't have top-level type signatures, so GHC infers the type signature for <code>coprime_subsets</code> as</p>\n\n<pre><code>coprime_subsets :: Integral a =&gt; a -&gt; a -&gt; [[a]]\n</code></pre>\n\n<p>This allows GHC to choose an <code>Integral</code> for you and it will happily choose <code>Integer</code>, which is much slower than <code>Int</code>. With <code>Integer</code>, the program spends a huge amount of time just computing gcds. Forcing GHC to use <code>Int</code> takes the run time down from 6 seconds to 1 second, since GHC can do integer math on machine integers directly.</p>\n\n<p>NB: It is also a good practice to always provide top-level type signatures. Even when the compiler doesn't benefit from them, humans often do.</p>\n\n<p>Now, on to the meat of the problem. Running</p>\n\n<pre><code>main = print . length $ coprime_subsets (100 :: Int) 120\nmain :: IO ()\n</code></pre>\n\n<p>with profiling enabled (<code>stack build --profile</code> for Stack) and passing <code>+RTS -p -h</code> to the executable (<code>-p</code> for time and <code>-h</code> for space) gives us a breakdown:</p>\n\n<pre><code>COST CENTRE            MODULE  SRC                            %time %alloc\n\nsubsets                Coprime src/Coprime.hs:(4,1)-(5,52)     52.5  100.0\ncoprime                Coprime src/Coprime.hs:11:1-26          25.5    0.0\ncoprime_list           Coprime src/Coprime.hs:(19,1)-(21,41)   18.5    0.0\ncoprime_subsets_helper Coprime src/Coprime.hs:(27,1)-(29,69)    1.8    0.0\nmutually_coprime       Coprime src/Coprime.hs:(14,1)-(16,43)    1.7    0.0\n</code></pre>\n\n<p>When we were using <code>Integer</code>, the vast majority (~78%) of the time was spent in the <code>coprime</code> test. The majority is now spent constructing the powerset, so let's look there first.</p>\n\n<h2>Next, we must understand why it is slow.</h2>\n\n<p>There are generally three strategies to speed something up:</p>\n\n<ol>\n<li>Improve its asymptotic complexity.</li>\n<li>Improve its constant factors.</li>\n<li>Call it fewer times.</li>\n</ol>\n\n<p>Which of these might apply to <code>subsets</code>? (1) is an obvious choice. Constructing the powerset is <code>O(2^n)</code>, so any asymptotic improvements here would be very helpful indeed. Can we find any? Theoretically, we should be able to. As Daniel suggests, this problem is equivalent to the maximal cliques problem, which is also exponential. However, maximal cliques has a solution with a smaller base, which means we should be able to find an asymptotic improvement for this problem as well.</p>\n\n<p>The key insight to reducing its asymptotic complexity (and also the number of times we call it) is that we are generating the vast majority of subsets just to throw them away later on when we check them for coprimality. If we can avoid generating bad subsets initially, we will generate fewer subsets and perform fewer checks for coprimality. If the number of pruned results is proportional to the size of the entire computation tree, this will yield an asymptotic improvement. This sort of pruning is common in functional algorithm optimization; you can see an instructive example in <a href=\"http://www.cs.tufts.edu/~nr/cs257/archive/richard-bird/sudoku.pdf\" rel=\"nofollow noreferrer\">Richard Bird's sudoku solver</a>. In fact, if we can write a function that only generates non-mutually-coprime subsets, we will have solved the entire problem!</p>\n\n<h2>Finally, we are ready to fix it!</h2>\n\n<p>We can do this by modifying the original generator <code>subsets</code> to filter out non-coprime terms as it goes:</p>\n\n<pre><code>coprimeSubsets [] = [[]]\ncoprimeSubsets (x:xs)\n  = coprimeSubsets xs ++ map (x :) (coprimeSubsets (filter (coprime x) xs))\n</code></pre>\n\n<p>(There is probably some clever fold we can use here if we think about it really hard but the explicit recursion is fine too.)</p>\n\n<p>Once we do this, we can find coprime subsets of <code>[100..120]</code> in ~0.1 seconds, an order of magnitude improvement. The cost centre report tells the story:</p>\n\n<pre><code>COST CENTRE    MODULE          SRC                            %time %alloc\n\nMAIN           MAIN            &lt;built-in&gt;                      42.9    0.5\ncoprimeSubsets Coprime         src/Coprime.hs:(33,1)-(35,75)   28.6   67.4\nCAF            GHC.IO.Encoding &lt;entire-module&gt;                 14.3    0.1\ncoprime        Coprime         src/Coprime.hs:13:1-26          14.3   31.1\n</code></pre>\n\n<p>Now we actually spend most of our time doing IO and such. Furthermore, the number of calls to our <code>coprime</code> test is now only 3,848, an improvement of several orders of magnitude. We can also find the coprime subsets of <code>[100..150]</code> in 3 seconds, compared to... well, I didn't wait for it to finish, but at least a few minutes.</p>\n\n<p>The next place to look for speedups might be in memoizing the <code>coprime</code> function, since this problem involves computing it for the same arguments many times.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1502794337, "last_edit_date": 1502794337, "creation_date": 1502736235, "answer_id": 45681009, "question_id": 45678702, "link": "https://stackoverflow.com/questions/45678702/trying-to-optimize-this-algorithm-code-to-compute-the-largest-subset-of-mutually/45681009#45681009", "title": "Trying to optimize this algorithm/code to compute the largest subset of mutually coprime integers between a and b", "body": "<p>I am unsure if this might be a way to solve the problem efficiently enough but it will return all subsets among the provided two integer values in 0.02 secs even in GHCI.</p>\n\n<pre><code>coprimes :: Int -&gt; Int -&gt; [[Int]]\ncoprimes x y | y &lt;= x    = []\n             | otherwise = (x : filter ((== 1) . gcd x) (tail [x..y])) : (coprimes . head . tail) [x..y] y\n\n*Main&gt; coprimes 100 120\n[[100,101,103,107,109,111,113,117,119],[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120],[102,103,107,109,113,115],[103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120],[104,105,107,109,111,113,115,119],[105,106,107,109,113,116,118],[106,107,109,111,113,115,117,119],[107,108,109,110,111,112,113,114,115,116,117,118,119,120],[108,109,113,115,119],[109,110,111,112,113,114,115,116,117,118,119,120],[110,111,113,117,119],[111,112,113,115,116,118,119],[112,113,115,117],[113,114,115,116,117,118,119,120],[114,115,119],[115,116,117,118,119],[116,117,119],[117,118,119],[118,119],[119,120]]\n(0.02 secs, 811,576 bytes)\n</code></pre>\n"}], "owner": {"reputation": 146, "user_id": 5577239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c763a6f299c59fcfd538f0e036f0911c?s=128&d=identicon&r=PG&f=1", "display_name": "user64742", "link": "https://stackoverflow.com/users/5577239/user64742"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 2, "answer_count": 3, "score": 4, "last_activity_date": 1502794337, "creation_date": 1502727158, "question_id": 45678702, "link": "https://stackoverflow.com/questions/45678702/trying-to-optimize-this-algorithm-code-to-compute-the-largest-subset-of-mutually", "title": "Trying to optimize this algorithm/code to compute the largest subset of mutually coprime integers between a and b", "body": "<p>I'm writing a function in Haskell that takes in two integers a and b and computes the length of the largest subset(s) of [a,b] such that all the elements are mutually coprime. Now, the reason for this is because I believe investigating such values might yield means of producing trivial lesser bounds (possibly one's large enough to imply actual primes in various per conjectured ranges such as consecutive squares). So naturally I'm trying to run this for some pretty large numbers.</p>\n\n<p>Unfortunately the below code is not running fast enough for it to be even practical for me to use. I think the flaw is Haskell's laziness policy causing issues, but I neither know the syntax nor the place where I need to force execution to prevent the operations from accumulating.</p>\n\n<pre><code>subsets [] = [[]]\nsubsets (x:xs) = subsets xs ++ map (x:) (subsets xs)\n\ndivides a b = (mod a b == 0)\n\ncoprime a b = ((gcd a b) == 1)\n\nmutually_coprime []  = True\nmutually_coprime (x:xs) | (coprime_list x xs) = mutually_coprime xs\n                        | otherwise = False\n\ncoprime_list _ [] = True\ncoprime_list a (x:xs) | (coprime a x) = coprime_list a xs\n                      | otherwise = False\n\ncoprime_subsets a b = coprime_subsets_helper (subsets [a..b])\n\ncoprime_subsets_helper [] = []\ncoprime_subsets_helper (x:xs) | (mutually_coprime x) = [x] ++ (coprime_subsets_helper xs)\n                              | otherwise = coprime_subsets_helper xs\n\ncoprime_subset_length a b = max_element (map list_length (coprime_subsets a b))\n\nlist_length [] = 0\nlist_length (x:xs) = 1 + list_length xs\n\nmax_element a = max_element_helper a 0\n\nmax_element_helper [] a = a\nmax_element_helper (x:xs) a | (x &gt; a) = max_element_helper xs x\n                            | otherwise = max_element_helper xs a\n</code></pre>\n\n<p>Just to make it clear what sort of input this is hanging upon, \"coprime_subsets 100 120\" never seems to even halt for me. I actually left it running, got up, did some other stuff and came back to it later. <em>It was still running</em>. I suspect that a large bottleneck is computing all the subsets immediately. However, I don't want to put an artificial lower bound on the subsets generated. That might sieve out all of the coprime sets leaving me with nothing.</p>\n\n<p>What I have tried so far:</p>\n\n<ul>\n<li><p>I replaced the original coprime function I had with gcd. Originally this used modulo and iterative checking for all integers. I presume gcd used something like Euclid's Algorithm which should run faster, in theory.</p></li>\n<li><p>I've been trying to think of a way to build the generation of the subsets into the coprime set generator. So far I haven't been able to come up with anything. I'm also not sure if that would actually help with anything.</p></li>\n<li><p>I've been looking for anywhere that Haskell's laziness policy might be hurting me. Nothing stands out, but I'm sure.</p></li>\n</ul>\n\n<p>I'm also aware that this could be an efficiency issue with the environment I use (winhugs). I'd say that is the issue; however, when I asked how to determine the largest subset (for general n sized ranges) on Math Stack Exchange the answers I received indicated that computationally speaking this is a very slow thing to calculate. If so, that's fine. I was just hoping to maybe be able to run through some of the ranges I was interested in without it taking almost forever.</p>\n\n<p>I know efficiency is generally not allowed on this site; however, I have tried quite a bit and I'm not just trying to be lazy here. I know Haskell has quite a few weird quirks that can force it into being deceptively inefficient. It's been a while since I've coded in it, and I suspect I've landed in one of those quirks.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502741228, "post_id": 45677539, "comment_id": 78322326, "body": "The question here is unclear to me. What is the &quot;main logic&quot; which is failing to work? <code>$sel:userBar:User</code> is the pretty printed representation of some part of the TH AST (presumably, it is the overloaded record label for the type <code>User</code> whose name is <code>userBar</code>). You convert a string to an ADT by parsing it, but I don&#39;t see why you would need to do so (just manipulate the TH AST directly?). (Aside: if you are ever relying on the <code>Show</code> instance of the TH AST for anything but debugging, you&#39;re doing it wrong - just splice the <code>Q [Dec]</code> where you need to use it.)"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502771046, "post_id": 45677539, "comment_id": 78330449, "body": "I <b>am</b> manipulating the Ast directly at <code>if (fname elem requiredFields)</code>  but it is not working because <code>requiredFields</code>, upon inspection seems to have a <code>$sel</code> in it whereas <code>fname</code> doesnt. And both of them refer to the same thing, conceptually!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502778636, "post_id": 45677539, "comment_id": 78332679, "body": "Well, as you&#39;ve discovered, they are not the same thing, regardless of your desire to treat them as equal elements (a record field is not the same thing as the projection function generated from that record field, despite the fact that they use the same identifier in concrete Haskell code). I take it the problem then is that <code>elem fname requiredFields</code> is <code>False</code> when you want it to be <code>True</code>? If so, define your own comparison function <code>cmp :: Name -&gt; Name -&gt; Bool</code> which has the desired semantics and replace <code>elem</code> with <code>any . cmp</code>."}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1502723071, "creation_date": 1502723071, "question_id": 45677539, "link": "https://stackoverflow.com/questions/45677539/what-is-sel-in-a-template-haskell-name", "title": "What is $sel in a Template Haskell Name?", "body": "<p>I'm calling my TH function, called <code>createRecordSplice</code> in the following manner:</p>\n\n<pre><code>data User = User {userFoo :: String, userBar :: Text} deriving (Eq, Show, Generic)\ncreateRecordSplice \"user\" ''User ['userBar] \"NewUser\" \"nuser\"\n</code></pre>\n\n<p>Notice that the record selector <code>userBar</code> is passed with a single-quote.</p>\n\n<p>Now, in my TH function where I want to check the field names of <code>User</code> against <code>userBar</code>, I'm encountering a strange field name which contains <code>$sel</code>, due to which, my main logic is failing to work.</p>\n\n<pre><code>(Common.TestRecordSplices.userFoo,[Common.TestRecordSplices.$sel:userBar:User])\n(Common.TestRecordSplices.userBar,[Common.TestRecordSplices.$sel:userBar:User])\n</code></pre>\n\n<p><strong>What is this <code>$sel:userBar:User</code> and how does one convert <code>userBar</code> to <code>$sel:userBar:User</code>, or vice versa, without resorting to string manipulation?</strong></p>\n\n<p>My TH function:</p>\n\n<pre><code>createRecordSplice :: String -&gt; Name -&gt; [Name] -&gt; String -&gt; String -&gt; Q [Dec]\ncreateRecordSplice sourcePrefix record requiredFields newRectype targetPrefix = reify record &gt;&gt;= \\case\n  (TyConI (DataD [] recordConstr [] knd constrs classes)) -&gt; case constrs of\n    [(RecC _ sourceFields)] -&gt; do\n      let newFields = DL.foldl'\n                      (\\memo (fname, bang, ftype) -&gt;\n\n                         -- OUTPUT FOR THIS TRACE IS GIVEN ABOVE\n                         trace (show (nameBase fname, nameBase &lt;$&gt; requiredFields)) $ \n\n                         if (fname `elem` requiredFields)\n                         then (sourceToTargetName fname, bang, ftype):memo\n                         else memo\n                      ) [] sourceFields\n      runIO $ putStrLn (show newFields)\n      pure $ [DataD [] (mkName newRectype) [] knd [RecC (mkName newRectype) newFields] classes]\n    _ -&gt; fail $ \"creating record splices for types with multiple constructors (sum types), i.e. data X = Y | Z, is not supported yet\"\n  where\n    sourceToTargetName n = mkName $ targetPrefix ++ (DL.drop (DL.length sourcePrefix) (nameBase n))\n</code></pre>\n"}, {"tags": ["haskell", "networking"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 3, "creation_date": 1502719588, "post_id": 45675403, "comment_id": 78310414, "body": "A lot of internal functions? It just calls native <code>bind</code> with some prior sanity checking."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1502776099, "post_id": 45675403, "comment_id": 78331772, "body": "Use <code>bind</code> and use 0 for the port number?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1502789074, "post_id": 45675403, "comment_id": 78337664, "body": "At first I thought about avoiding <code>bind</code> because there are a lot of parameters I&#39;m not sure how to fill in, and I have to <code>bind</code> and <code>close</code> a socket, which seems like overhead. I&#39;ll update the question with my current approach."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1502996165, "post_id": 45675403, "comment_id": 78443351, "body": "<code>bind()</code>&#39;ing a socket to port 0 is the correct way to get a random available port from the OS. However, once you close the socket, the port is released back to the OS, so someone else may be able to grab the port before you can use it yourself.  If you need a port, it is usually because you are going to be using it soon, so don&#39;t close the socket that obtained the port, just use it."}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1502789321, "creation_date": 1502716527, "last_edit_date": 1502789321, "question_id": 45675403, "link": "https://stackoverflow.com/questions/45675403/getting-the-first-available-port-in-haskell-in-a-platform-independent-way", "title": "Getting the first available port in Haskell, in a platform-independent way", "body": "<p>I'd like to get the first available (unbound) port to be able to start a connection on it. Right now I'm using the <a href=\"https://hackage.haskell.org/package/network-2.6.3.2/docs/Network-Socket.html\" rel=\"nofollow noreferrer\">bind</a> function in the following way:</p>\n\n<pre><code>-- | Get a free port number.\ngetFreePort :: IO Integer\ngetFreePort = do\n  sock &lt;- socket AF_INET Stream defaultProtocol\n  bind sock (SockAddrInet aNY_PORT iNADDR_ANY)\n  port &lt;- socketPort  sock\n  close sock\n  return (toInteger port)\n</code></pre>\n\n<p>But I'm not sure about the parameters I'm passing to <code>socket</code> and <code>bind</code>, and I also have to bind the socket only to extract its number and then close it again, which seems like a bit of overhead.</p>\n\n<p>Can this be achieved in a better way?</p>\n"}, {"tags": ["haskell", "arrows"], "owner": {"reputation": 277, "user_id": 2464093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5066381bc937a320b03de5926f4f8024?s=128&d=identicon&r=PG", "display_name": "Artem Solod", "link": "https://stackoverflow.com/users/2464093/artem-solod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1502727555, "creation_date": 1502715323, "last_edit_date": 1502727555, "question_id": 45675017, "link": "https://stackoverflow.com/questions/45675017/arrowloop-instance-for-control-foldl-like-datatype", "title": "ArrowLoop instance for Control.Foldl-like datatype", "body": "<p>I am working on a modification of <a href=\"https://hackage.haskell.org/package/foldl-1.3.0/docs/Control-Foldl.html\" rel=\"nofollow noreferrer\">Control.Foldl</a> datatype that provides instances of <code>Category</code> and <code>Arrow</code>.\nMy definition is as follows:</p>\n\n<pre><code>data FoldlCat a b = forall x c. FoldlCat (x -&gt; a -&gt; c) x (c -&gt; x) (c -&gt; b)\n</code></pre>\n\n<p>where the first argument stands for a \"step\" function (<code>savedState -&gt; newInput -&gt; intermediateValue</code>), second is for initial <code>savedState</code>, third is a \"save\" function (<code>intermediateValue -&gt; savedState</code>) and the last one is an \"extract\" function (<code>intermediateValue -&gt; newOutput</code>).</p>\n\n<p>So something like <code>map (*10) . scanl (+) 0</code> can be expressed as <code>FoldlCat (+) 0 id (*10)</code>.</p>\n\n<p>The main purpose of a save function is to facilitate definitions of <code>id</code> and <code>arr</code> like so:</p>\n\n<pre><code>id = FoldlCat (\\_ x -&gt; x) () (const ()) id\n</code></pre>\n\n<p>Now I am unsuccessfully trying to come up with an instance of <code>ArrowLoop</code>. I can not see any reason for it not being possible, however, I am not comfortable enough with <code>fix</code>-like concepts. My best attempt so far typechecks but loops forever.</p>\n\n<pre><code>instance ArrowLoop FoldlCat where\n  loop (FoldlCat s b a d) = FoldlCat step b (a . snd) fst where\n    step x = loop' d (s x)\n    loop' f g x = let ~(v, ~(c,d)) = let ~v = g (x,d) in (v, f v)\n                  in (c, v)\n</code></pre>\n\n<p>I would be grateful if someone could share their approach on defining such an instance (extra kudos if it would work with a strict tuple in accumulator inside of <code>(.)</code>) or explain why that is not possible or advice on a better structure for FoldlCat.</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE BangPatterns #-}\n{-# LANGUAGE Arrows #-}\n\nimport Data.List (unfoldr)\nimport Prelude hiding (id, (.))\nimport Control.Category\nimport Control.Arrow\n\n-- | FoldlCat  step init save export\ndata FoldlCat a b = forall x c. FoldlCat (x -&gt; a -&gt; c) x (c -&gt; x) (c -&gt; b)\n\nmapCat :: (a -&gt; b) -&gt; FoldlCat a b\nmapCat f = FoldlCat (\\_ x -&gt; x) () (const ()) f\n\nevalList :: FoldlCat t b -&gt; [t] -&gt; [b]\nevalList (FoldlCat s b a d) ys = unfoldr stepan (b, ys) where\n    stepan (accVal, (x:xs))  = Just (nexVal, (newAcc, xs)) where\n      newMeta = s accVal x\n      newAcc  = a newMeta\n      nexVal  = d newMeta\n    stepan (accVal, [])      = Nothing\n\ndelay :: b -&gt; FoldlCat b b\ndelay def = FoldlCat (,) def snd fst\n\ninstance Category FoldlCat where\n  id = mapCat id\n\n  (.) (FoldlCat step2 begin2 acc2 done2) (FoldlCat step1 begin1 acc1 done1) =\n      let step = \\(a, b) y -&gt; let !a' = step1 a y\n                                  !b' = step2 b (done1 a') in (a', b')\n          begin = (begin1, begin2)\n          acc   = \\(x, y) -&gt; ((acc1 x), (acc2 y))\n          done = \\(a, b) -&gt; done2 b\n      in\n        FoldlCat step begin acc done\n\ninstance Arrow FoldlCat where\n  arr f = mapCat f\n\n  first (FoldlCat s b a d) = FoldlCat step b (a . fst) extF where\n    step = (\\a (x, y) -&gt; (s a x, y))\n    extF = (\\(ok, y) -&gt; (d ok, y))\n\ninstance ArrowLoop FoldlCat where\n  loop (FoldlCat s b a d) = FoldlCat step b (a . snd) fst where\n    step x = loop' d (s x)\n    loop' f g x = let ~(v, ~(c,d)) = let ~v = g (x,d) in (v, f v)\n                  in (c, v)\n\nchaseFromZero = proc target -&gt; do\n  rec let step = signum (target - x)\n      x &lt;- FoldlCat (+) 0 id id &lt;&lt;&lt; delay 0 -&lt; step\n  id -&lt; x\n\nmain = print $ evalList chaseFromZero [1..5]\n</code></pre>\n\n<p><strong>EDIT</strong> Although I am not sure how and why it works, fixing strictness of <code>step</code> in <code>(.)</code> (i.e. removing bang in <code>let !a' = step1 a y</code>) seems to make this example work.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1502694219, "post_id": 45668743, "comment_id": 78295364, "body": "The answer <a href=\"https://stackoverflow.com/questions/44802606/how-does-haskell-convert-integer-literals-to-different-types\">to this other question you asked a while ago</a> should cover this too I think."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 10, "last_activity_date": 1502693392, "creation_date": 1502693392, "answer_id": 45668875, "question_id": 45668743, "link": "https://stackoverflow.com/questions/45668743/how-it-becomes-to-concrete-type/45668875#45668875", "title": "How it becomes to concrete type?", "body": "<blockquote>\n  <p>1..4 are Integers and 5 is a type of Sum Integer</p>\n</blockquote>\n\n<p>Not exactly. <code>[1, 2, 3, 4, 5]</code> is of type <code>Num t =&gt; [t]</code>, where the type <code>t</code> is an instance of <code>Num</code> waiting to be inferred to a rigid type.</p>\n\n<p>When you point that one of the elements is <code>Sum Integer</code>, the compiler infers all the other elements of the list to the same type.</p>\n\n<p>So, the list becomes of type <code>[1,2,3,4,5 :: Sum Integer] :: [Sum Integer]</code>, just what you see in the output.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 45668875, "answer_count": 1, "score": -2, "last_activity_date": 1502693392, "creation_date": 1502692784, "question_id": 45668743, "link": "https://stackoverflow.com/questions/45668743/how-it-becomes-to-concrete-type", "title": "How it becomes to concrete type?", "body": "<p>I have following value: </p>\n\n<pre><code>Prelude Data.Monoid&gt; [1,2,3,4,5 :: Sum Integer]\n[Sum {getSum = 1},Sum {getSum = 2},Sum {getSum = 3},Sum {getSum = 4},Sum {getSum = 5}]\n</code></pre>\n\n<p>As you can see, <code>1..4</code> are Integers and <code>5</code> is a type of <code>Sum Integer</code>.<br>\nHow the contents of the list become to the type <code>Sum Integer</code>? There are more <code>Integers</code> inside, why does not it become to <code>Integer</code>?</p>\n"}, {"tags": ["haskell", "recursion", "tree"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1502685203, "post_id": 45667456, "comment_id": 78292457, "body": "Well, you&#39;ve written <code>Node</code> to take only two arguments, but pattern-matched on three."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502688705, "post_id": 45667456, "comment_id": 78293301, "body": "You have the data definition of a rose tree but a function that seems to expect a binary tree. If you want <code>preorderTree</code> to work for your <code>Tree</code> data type, take a look at <code>concatMap</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1502693962, "post_id": 45667456, "comment_id": 78295246, "body": "This actually isn&#39;t your first question since you didn&#39;t actually ask anything. You also haven&#39;t posted any error messages.  Given that the traversal and the data declaration don&#39;t match, there are two possible fixes.  Which fix is correct is unclear, so I voted to close.  Feel free to edit the question."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8460216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db819f8b569b17039dd3721499cd8bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Deindery", "link": "https://stackoverflow.com/users/8460216/deindery"}, "edited": false, "score": 0, "creation_date": 1502712437, "post_id": 45668965, "comment_id": 78305686, "body": "Thank you very much for your help, this really help me and also I&#39;m starting to really like Haskell :)"}], "tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": true, "score": 2, "last_activity_date": 1502693793, "creation_date": 1502693793, "answer_id": 45668965, "question_id": 45667456, "link": "https://stackoverflow.com/questions/45667456/tree-traversal-with-haskell/45668965#45668965", "title": "Tree traversal with Haskell", "body": "<p>In Haskell, <strong>type</strong> is a set of <strong>value</strong>s. So we have both type constructor and value constructor.</p>\n\n<p>So writing a haskell function. We need properly define the <strong>type</strong> (<code>Tree</code>). Deal every <strong>value</strong>(<code>Empty</code>, <code>Node ...</code>) in the corresponding <strong>type</strong>.</p>\n\n<p><code>Tree a</code> is a <strong>type</strong>. Its value is either <code>Empty</code> or a bunch of children. Thus we have</p>\n\n<pre><code>data Tree a = Empty\n            | Node a [Tree a]\n</code></pre>\n\n<p>So when we write a function like <code>preorderTree :: Tree a -&gt; [a]</code>. We are dealing with <strong>type</strong> <code>Tree a</code>, so we have to deal with value <code>Empty</code> and <code>Node a [Tree a]</code>. So we have</p>\n\n<pre><code>preorderTree :: Tree a -&gt; [a]\npreorderTree Empty = []\npreorderTree (Node a children) = a : concatMap preorderTree children\n</code></pre>\n\n<p>This is a rose tree, if you just want a binary tree, we need to change the value constructor of type <code>Tree a</code>, because <code>[Tree a]</code> is just too much for a binary tree. So we have</p>\n\n<pre><code>data Tree a = Empty\n            | Node a (Tree a) (Tree a)\n\npreorderTree :: Tree a -&gt; [a]\npreorderTree Empty = []\npreorderTree (Node a left right) = a : preorderTree left ++ preorderTree right\n</code></pre>\n\n<hr>\n\n<ol>\n<li><a href=\"https://wiki.haskell.org/Constructor\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Constructor</a></li>\n</ol>\n"}], "owner": {"reputation": 21, "user_id": 8460216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db819f8b569b17039dd3721499cd8bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Deindery", "link": "https://stackoverflow.com/users/8460216/deindery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3342, "favorite_count": 1, "accepted_answer_id": 45668965, "answer_count": 1, "score": 2, "last_activity_date": 1502693793, "creation_date": 1502684662, "question_id": 45667456, "link": "https://stackoverflow.com/questions/45667456/tree-traversal-with-haskell", "title": "Tree traversal with Haskell", "body": "<p>Hi all this is my first question here, I'm very new to Haskell and I need to do a Haskell function which takes a Tree and returns a list of the elements in its node in a preorder traversal but I can't get it to work.</p>\n\n<p>My Tree definition is the following:</p>\n\n<pre><code>data Tree a = Node a [Tree a] deriving Show\n</code></pre>\n\n<p>and the preorder function is:</p>\n\n<pre><code>preorderTree :: Tree a -&gt; [a]\npreorderTree Empty = []\npreorderTree (Node a l r) = a : (preorderTree l) ++ (preorderTree r)\n</code></pre>\n\n<p>In advance thank you very much for your help :)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 4, "creation_date": 1502673583, "post_id": 45666050, "comment_id": 78290212, "body": "Neil Mitchell has a very effective and very low-tech technique described on his blog: [Detecting Space Leaks ](<a href=\"http://neilmitchell.blogspot.com/2015/09/detecting-space-leaks.html\" rel=\"nofollow noreferrer\">neilmitchell.blogspot.com/2015/09/detecting-space-leaks.ht&zwnj;&#8203;ml</a>)."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1502713688, "post_id": 45666050, "comment_id": 78306405, "body": "In some future it would be possible to check this using static analyzers :) If this can be formalized then detecting space leaks is only matter of implementing algorithm."}, {"owner": {"reputation": 149, "user_id": 1132816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/40eb6a9679ea254308099cb066a131ac?s=128&d=identicon&r=PG", "display_name": "seagreen", "link": "https://stackoverflow.com/users/1132816/seagreen"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1502721909, "post_id": 45666050, "comment_id": 78311840, "body": "@Cactus: That&#39;s a great article. Unfortunately I don&#39;t know if it&#39;s possible to catch the exceptions generated when you run out of memory (which makes sense). I tried generating the exception in another process with <code>System.Posix.process.forkProcess</code> and catching it with <code>ClassyPrelude.catchAny</code>, but it still slips through and crashes the test suite."}], "answers": [{"tags": [], "owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "is_accepted": true, "score": 3, "last_activity_date": 1502791728, "creation_date": 1502791728, "answer_id": 45690774, "question_id": 45666050, "link": "https://stackoverflow.com/questions/45666050/test-that-a-haskell-function-has-a-space-leak/45690774#45690774", "title": "Test that a Haskell function has a space leak", "body": "<p>You can detect a space-leak with  test, but you can't prove an absence of space leaks. Even if memory profile relatively low it may just point that space leak very small and you have not made enough iterations.</p>\n\n<p>To detect space leaks you may use allocation limits and counters as described here <a href=\"https://stackoverflow.com/questions/42353661/may-i-limit-memory-usage-per-function-monad-thread-in-haskell\">May I limit memory usage per function/monad/thread in Haskell?</a></p>\n"}], "owner": {"reputation": 149, "user_id": 1132816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/40eb6a9679ea254308099cb066a131ac?s=128&d=identicon&r=PG", "display_name": "seagreen", "link": "https://stackoverflow.com/users/1132816/seagreen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 45690774, "answer_count": 1, "score": 8, "last_activity_date": 1502791728, "creation_date": 1502670604, "question_id": 45666050, "link": "https://stackoverflow.com/questions/45666050/test-that-a-haskell-function-has-a-space-leak", "title": "Test that a Haskell function has a space leak", "body": "<p>I'm writing a collection of example space leaks in Haskell, and would like to write a test suite to catch myself in case I insert any examples that don't actually leak space.</p>\n\n<p>Is there way to test the examples without making a separate executable for each one?</p>\n"}, {"tags": ["haskell", "functional-programming", "some-and-many"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 8, "creation_date": 1502671094, "post_id": 45666041, "comment_id": 78289809, "body": "It doesn&#39;t get <i>concatenated</i> with <code>pure []</code>. The empty list is the <i>alternative</i> where the recursion stops."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 8, "creation_date": 1502671161, "post_id": 45666041, "comment_id": 78289824, "body": "<code>some</code> means &quot;at least one&quot; while <code>many</code> means &quot;none or more&quot;."}, {"owner": {"reputation": 293, "user_id": 6675961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46f11b114fe506c0a7b305e730a02a64?s=128&d=identicon&r=PG&f=1", "display_name": "northlane", "link": "https://stackoverflow.com/users/6675961/northlane"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1502673648, "post_id": 45666041, "comment_id": 78290224, "body": "Aha thank you. I think this is starting to make sense. So the some guarantees at least one value, followed by 0 or more, and many gives you at least one value (plus 0 or more) <i>or</i> nothing. But how exactly does the recursion end? How do values from v get consumed?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1502676070, "post_id": 45666041, "comment_id": 78290696, "body": "Values from <code>v</code> do not get consumed. <code>some</code> and <code>many</code> are producing a (in a sense) &#39;larger&#39; value than their input. Recursion ends only if <code>&lt;*&gt;</code> and <code>&lt;|&gt;</code> are sufficiently lazy. This isn&#39;t the case for <code>[]</code> or <code>Maybe</code>, but it is the case for <code>IO</code>. e.g., <code>many (getLine &gt;&gt;= \\x -&gt; if all isDigit x then return x else empty)</code> will read lines until you enter something containing a non-digit."}], "answers": [{"tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": true, "score": 4, "last_activity_date": 1502678927, "creation_date": 1502678927, "answer_id": 45666803, "question_id": 45666041, "link": "https://stackoverflow.com/questions/45666041/what-is-the-meaning-of-the-definitions-for-the-some-and-many-functions-in-th/45666803#45666803", "title": "What is the meaning of the definitions for the &quot;some&quot; and &quot;many&quot; functions in the Haskell Alternative", "body": "<ul>\n<li><code>some p</code> means <strong>one</strong> or more match of p</li>\n<li><code>many p</code> means <strong>zero</strong> or more more match of p</li>\n</ul>\n\n<p>For input <code>\"abc\"</code>, <code>many letter</code> and <code>some letter</code> will both parse <code>abc</code>.</p>\n\n<p>But for input <code>\"123\"</code>, <code>many letter</code> will output empty string <code>\"\"</code>. <code>some letter</code> will report error.</p>\n\n<p>According to the definition. <code>some v</code> needs at least 1 match of <code>v</code>, so we can first parse <code>v</code> then we need 0 or more match of <code>v</code>, which is <code>many v</code>. It is something like :</p>\n\n<pre><code>some v = do\n    first_match &lt;- v\n    rest_matches &lt;- many v\n    return $ first_match : rest_matches\n</code></pre>\n\n<p>which is the same as <code>some v = (:) &lt;$&gt; v &lt;*&gt; many v</code>.</p>\n\n<p>But for <code>many v</code>. It will either match <code>some v</code> (1 or more) or nothing (pure []).</p>\n\n<p><code>many v = if matches (some v) then return (some v) else return nothing</code>.</p>\n\n<p>You can try solve <a href=\"https://www.codewars.com/kata/writing-applicative-parsers-from-scratch\" rel=\"nofollow noreferrer\">writing applicative parsers from scratch</a> from codewars.</p>\n\n<p><a href=\"http://www.cs.nott.ac.uk/~pszgmh/pearl.pdf\" rel=\"nofollow noreferrer\">Functional pearls</a> is also a very good reference about parse combinators.</p>\n\n<hr>\n\n<ol>\n<li><a href=\"https://www.codewars.com/kata/writing-applicative-parsers-from-scratch\" rel=\"nofollow noreferrer\">https://www.codewars.com/kata/writing-applicative-parsers-from-scratch</a></li>\n<li><a href=\"http://www.cs.nott.ac.uk/~pszgmh/pearl.pdf\" rel=\"nofollow noreferrer\">http://www.cs.nott.ac.uk/~pszgmh/pearl.pdf</a></li>\n</ol>\n"}], "owner": {"reputation": 293, "user_id": 6675961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46f11b114fe506c0a7b305e730a02a64?s=128&d=identicon&r=PG&f=1", "display_name": "northlane", "link": "https://stackoverflow.com/users/6675961/northlane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 45666803, "answer_count": 1, "score": 2, "last_activity_date": 1592414119, "creation_date": 1502670489, "last_edit_date": 1592414119, "question_id": 45666041, "link": "https://stackoverflow.com/questions/45666041/what-is-the-meaning-of-the-definitions-for-the-some-and-many-functions-in-th", "title": "What is the meaning of the definitions for the &quot;some&quot; and &quot;many&quot; functions in the Haskell Alternative", "body": "<p>I've been looking to write a lexer in Haskell and stumbled upon these functions.</p>\n\n<blockquote>\n  <p>If defined, <code>some</code> and <code>many</code> should be the least solutions of the\n  equations:</p>\n  \n  <p><code>some v = (:) &lt;$&gt; v &lt;*&gt; many v</code></p>\n  \n  <p><code>many v = some v &lt;|&gt; pure []</code></p>\n</blockquote>\n\n<p>I get that the <code>(:)</code> in <code>some</code> gets lifted and applied to the value of <code>v</code> in order to prepend it to the list returned in <code>many v</code>. </p>\n\n<p>But why does the definition of <code>many</code> start with <code>some</code>? And why does it get concatenated with <code>pure []</code>? </p>\n\n<p>What is the relationship or difference between these two functions? What does it mean for <code>some</code> and <code>many</code> to be the <strong><em>least</em></strong> solutions of those equations? And how does the recursion ever stop? Help!</p>\n"}, {"tags": ["haskell", "recursion", "proof", "induction", "recursion-schemes"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1502670187, "post_id": 45665873, "comment_id": 78289662, "body": "Why is bisimulation necessary here? What is wrong with the definition that two lists are equal if they have the same elements in the same order? It seems to me this definition works for infinite lists. The two steps here involving <code>~~</code> seem to hold for <code>=</code> as well - <code>Nil = Nil</code> and <code>x = y =&gt; Cons a x = Cons a y</code>. Also, why reason by cases? You could apply the induction hypothesis directly under <code>\\a -&gt; if p&#39; b then Nil else Cons (f&#39; b) a</code> since that is a constructor guarded term (i.e. by applying congruence to the induction hypothesis for a large function than <code>Cons ..</code>)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502672046, "post_id": 45665873, "comment_id": 78289974, "body": "@user2407038, &quot;have the same elements in the same order&quot; <i>is</i> what bisimulation means.  And there&#39;s nothing contradictory about the axiom &quot;bisimilarity implies equality&quot;, but it is after all an axiom -- it doesn&#39;t follow from the lambda calculus laws -- and we should know what we&#39;re doing."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502672310, "post_id": 45665873, "comment_id": 78290018, "body": "@user2407038, you&#39;re right about the steps involving equality, but we would still need to say &quot;if <code>Nil = Nil</code> or <code>x = y =&gt; Cons a x = Cons a y</code> holds at every position, then the lists are equal&quot;, that is, coinduction.  And it is in the attempt to say that rigorously that we arrive at bisimilarity."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502673247, "post_id": 45665873, "comment_id": 78290147, "body": "@user2407038, the case analysis is again related to this separation between bisimilarity and equality, because we don&#39;t <i>a priori</i> have a rule that says &quot;if <code>xs ~~ ys</code> then <code>f xs ~~ f ys</code>&quot; -- and there are consistent worlds in which this is not the case, in which <code>f</code> can inspect something about its argument that is beyond its elements (I can&#39;t think of any computable ones though and my hunch says there aren&#39;t any). It&#39;s reasonable to require all functions to be referentially transparent to infinite structures like this, but it is not a given and must be stated axiomatically."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502673572, "post_id": 45665873, "comment_id": 78290207, "body": "@user2407038, I&#39;m approaching all this from the perspective of my experience in type theory.  I haven&#39;t thought much about it, but I&#39;m guessing if we reasoned at the level of Haskell&#39;s denotational semantics as a Scott domain then you&#39;d be right and equality would do the job (we&#39;d still have to figure out the precise conditions of (co)induction). I just don&#39;t have experience with this kind of reasoning."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502675447, "post_id": 45665873, "comment_id": 78290554, "body": "&quot;&quot;have the same elements in the same order&quot; is what bisimulation means&quot; - is this not the definition of equality? Or does &#39;bisimulation&#39; mean &#39;pointwise lifting of propositional equality to coinductive lists&#39; (which is not the same as propositional equality for coinductive lists. Whereas for finite lists, the pointwise lifting of propositional equality and propositional equality are isomorphic. Does &#39;formal equality&#39; mean propositional equality?). If this understanding is correct, then it answers my questions (but the wiki page for bisimulation doesn&#39;t seem to reflect this understanding...)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502680429, "post_id": 45665873, "comment_id": 78291459, "body": "@user2407038, yes it seems like we are in agreement starting with &quot;Or&quot; :-), Yeah the wiki page doesn&#39;t really talk about any of these issues... I don&#39;t know of a good reference."}, {"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "edited": false, "score": 0, "creation_date": 1502698499, "post_id": 45665873, "comment_id": 78297574, "body": "Thanks for the answer and for the discussion, which is a bit over my head :-) A couple of points I would like to clarify: (i) When you defined bisimilarity I think you forgot to mention that the heads of the lists have to be equal for the <code>Cons</code> case, right? (ii) Just to make sure, is this the coinductive hypothesis: <code>unfoldL p f g (g (h b)) ~~ unfoldL p&#39; f&#39; g&#39; (g&#39; b)</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "edited": false, "score": 2, "creation_date": 1502709245, "post_id": 45665873, "comment_id": 78303759, "body": "@DanOnea\u021b\u0103, thanks, fixed.  As for (ii), it&#39;s slightly more general than that: <i>for all <code>b</code></i>, <code>unfoldL p f g b ~~ unfoldL p&#39; f&#39; g&#39; b</code>.  it&#39;s exactly the same as what we are trying to prove initially about the whole list, except that it must be applied to the tail of <code>Cons</code>.  Note the symmetry with induction, where we get to assume it&#39;s true about the tail in order to use it on the whole list."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1502708739, "last_edit_date": 1502708739, "creation_date": 1502668322, "answer_id": 45665873, "question_id": 45665417, "link": "https://stackoverflow.com/questions/45665417/proving-the-fusion-law-for-unfold/45665873#45665873", "title": "Proving the fusion law for unfold", "body": "<p>I haven't read Gibbons's article, and there might be other techniques that he's relying on, but here's what I know.</p>\n\n<p>It's a good intuition that you are looking for some kind of induction, because what you need is very similar to what you are trying to prove. But you actually need coinduction here.  It's because <code>unfoldL</code> can produce infinite lists.  In formal type systems, it's very rare that you can prove that two infinite structures are \"equal\" -- formal equality is much too strong to prove most results.  Instead, we prove <a href=\"https://en.wikipedia.org/wiki/Bisimulation\" rel=\"nofollow noreferrer\">bisimilarity</a>, which in informal circumstances might as well be equality.</p>\n\n<p>Bisimilarity is tricky theoretically, and I won't go into it (partially because I don't fully understand the underpinnings), but working with it in practice is not too hard.  Basically, to prove that two lists are bisimilar, you prove that they are either both <code>Nil</code>, or that they are both <code>Cons</code> with the same head and their tails are bisimilar, <em>and you may use the coinductive hypothesis when proving the bisimilarity of the tails</em> (but not elsewhere).</p>\n\n<p>So for you, we prove by coinduction that <em>for all <code>b</code></em> (because we need to use the coinductive hypothesis for different <code>b</code>s):</p>\n\n<pre><code>(unfoldL p f g . h) b ~~ unfoldL p' f' g' b\n</code></pre>\n\n<p>So far we have</p>\n\n<pre><code>(unfoldL p f g . h) b\n= { your reasoning }\nif p' b then Nil else Cons (f' b) ((unfoldL p f g . h) (g' b))\n</code></pre>\n\n<p>Analyzing by cases on <code>p' b</code>, if <code>p' b</code> is True then</p>\n\n<pre><code>if p' b then Nil else Cons (f' b) ((unfoldL p f g . h) (g' b))\n= { p' b is True }\nNil\n~~ { reflexivity }\nNil\n= { p' b is True }\nif p' b then Nil else Cons (f' b) (unfoldL p' f' g' (g' b))\n= { unfoldL }\nunfoldL p' f' g'\n</code></pre>\n\n<p>; if <code>p' b</code> is False then</p>\n\n<pre><code>if p' b then Nil else Cons (f' b) ((unfoldL p f g . h) (g' b))\n= { p' b is False }\nCons (f' b) ((unfoldL p f g . h) (g' b))\n*** ~~ { bisimilarity Cons rule, coinductive hypothesis } ***\nCons (f' b) (unfoldL p' f' g' (g' b))\n= { p' b is False }\nif p' b then Nil else Cons (f' b) (unfoldL p' f' g' (g' b))\n= { unfoldL }\n</code></pre>\n\n<p>The line marked with <code>***</code> is the key one.  First, note it's a <code>~~</code> instead of an <code>=</code>.  Also, we were allowed to use the coinductive hypothesis <em>only underneath the <code>Cons</code> constructor</em>.   If we were allowed to use it anywhere else, then we could prove that any two lists are bisimilar.</p>\n"}, {"tags": [], "owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "is_accepted": false, "score": 2, "last_activity_date": 1502710729, "creation_date": 1502710729, "answer_id": 45673703, "question_id": 45665417, "link": "https://stackoverflow.com/questions/45665417/proving-the-fusion-law-for-unfold/45673703#45673703", "title": "Proving the fusion law for unfold", "body": "<p>After some googling I've found a paper by the same Jeremy Gibbons (and Graham Hutton) that presents <a href=\"http://www.cs.ox.ac.uk/jeremy.gibbons/publications/corecursive.pdf\" rel=\"nofollow noreferrer\">proof methods for corecursive programs</a>;\nthe article includes a section on bisimulation and coinduction, the proof technique used by @luqui in the accepted answer.\nSection 6 has a proof of the fusion law using the universal property of unfold.\nFor completeness, I've copied the proof below.</p>\n\n<hr>\n\n<p>The universal property of <code>unfoldL</code>:</p>\n\n<pre><code>h = unfoldL p f g\n&lt;=&gt;\n\u2200 b . h b = if p b then Nil else Cons (f b) (h (g b))\n</code></pre>\n\n<p>Proof of the fusion law:</p>\n\n<pre><code>unfoldL p f g . h = unfoldL p' f' g'\n&lt;=&gt; { universal property }\n\u2200 b . (unfoldL p f g . h) b = if p' b then Nil else Cons (f' b) ((unfoldL p f g . h) (g' b))\n&lt;=&gt; { composition }\n\u2200 b . unfoldL p f g (h b) = if p' b then Nil else Cons (f' b) (unfoldL p f g (h (g' b)))\n&lt;=&gt; { unfoldL }\n\u2200 b . if p (h b) then Nil else Cons (p (h b)) (unfoldL p f g (g (h b))) = if p' b then Nil else Cons (f' b) (unfoldL p f g (h (g' b)))\n&lt;=&gt; { composition }\n\u2200 b . if (p . h) b then Nil else Cons (p . h) b (unfoldL p f g ((g . h) b)) = if p' b then Nil else Cons (f' b) (unfoldL p f g ((h . g') b))\n&lt;=  { assumptions }\n(p . h = p') ^ (f . h = f') ^ (g . h = h . g')\n</code></pre>\n"}], "owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 2, "accepted_answer_id": 45665873, "answer_count": 2, "score": 5, "last_activity_date": 1502710729, "creation_date": 1502663101, "last_edit_date": 1502667348, "question_id": 45665417, "link": "https://stackoverflow.com/questions/45665417/proving-the-fusion-law-for-unfold", "title": "Proving the fusion law for unfold", "body": "<p>I was reading Jeremy Gibbons' article on <a href=\"https://www.cs.ox.ac.uk/jeremy.gibbons/publications/origami.pdf\" rel=\"nofollow noreferrer\">origami programming</a> and I got stuck on exercise 3.7, which asks the reader to prove the <em>fusion law</em> for list unfolds:</p>\n\n<blockquote>\n<pre><code>unfoldL p f g . h = unfoldL p' f' g'\n</code></pre>\n  \n  <p>if</p>\n\n<pre><code>p . h = p'\nf . h = f'\ng . h = h . g'\n</code></pre>\n</blockquote>\n\n<p>The function <code>unfoldL</code>, unfold for lists, is defined as follows:</p>\n\n<pre><code>unfoldL :: (b -&gt; Bool) -&gt; (b -&gt; a) -&gt; (b -&gt; b) -&gt; b -&gt; List a\nunfoldL p f g b = if p b then Nil else Cons (f b) (unfoldL p f g (g b))\n</code></pre>\n\n<p>Here is my current attempt at a proof:</p>\n\n<pre><code>(unfoldL p f g . h) b\n=   { composition }\nunfoldL p f g (h b)\n=   { unfoldL }\nif p (h b) then Nil else Cons (f (h b)) (unfoldL p f g (g (h b)))\n=   { composition }\nif (p . h) b then Nil else Cons ((f . h) b) (unfoldL p f g ((g . h) b))\n=   { assumptions }\nif p' b then Nil else Cons (f' b) (unfoldL p f g ((h . g') b))\n=   { composition }\nif p' b then Nil else Cons (f' b) ((unfoldL p f g . h) (g' b))\n=   { ??? }\nif p' b then Nil else Cons (f' b) (unfoldL p' f' g' (g' b))\n=   { unFoldL }\nunFoldL p' f' g'\n</code></pre>\n\n<p>I am not sure how to justify the step marked with <code>???</code>. I should probably use some sort of induction on function application on <code>b</code>? Related question: what are some good resources that explain and motivate various induction techniques, such as structural induction?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 4, "creation_date": 1502662396, "post_id": 45665335, "comment_id": 78288342, "body": "You should include the error in your question. Anyway, <code>fmap print printabledate</code> will get you an <code>IO (IO ())</code>. You could use <code>printabledate &gt;&gt;= print</code>, but it\u2019s more common to make use of that <code>do</code> and <code>printabledate &lt;- date</code> then <code>printStrLn $ getDateStr date</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1502663227, "post_id": 45665335, "comment_id": 78288507, "body": "<code>main = print =&lt;&lt; getDateStr &lt;$&gt; date</code>"}, {"owner": {"reputation": 3932, "user_id": 233981, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/26b77ef1ab3e3df3df030435aea70568?s=128&d=identicon&r=PG", "display_name": "srking", "link": "https://stackoverflow.com/users/233981/srking"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1502663394, "post_id": 45665335, "comment_id": 78288538, "body": "@Ryan - Oops yes, I updated the question to describe the non-result.  Your &gt;&gt;= suggestion worked, though I don&#39;t yet understand why.  Care to leave an answer?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1502667441, "post_id": 45665335, "comment_id": 78289215, "body": "<code>fmap print :: Show a =&gt; IO a -&gt; IO (IO ())</code> is a function which given an <code>IO</code> action producing a value of some type <code>a</code>, gives another <code>IO</code> action which, when executed, has no side effects and produces yet another <code>IO</code> action - that last one is the one which prints the input. In other words, executing an <code>IO (IO ())</code> doesn&#39;t execute the inner <code>IO</code> action, only the outer one. (This is a duplicate of any number of questions, but I&#39;m too lazy to find any of them)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1502678106, "post_id": 45665335, "comment_id": 78291055, "body": "I recommend giving <code>main</code> the explicit type signature <code>main :: IO ()</code> (here and in the future), to avoid this sort of thing."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1502715897, "post_id": 45665335, "comment_id": 78307821, "body": "@Ryan you probably mean <code>putStrLn</code> rather than <code>printStrLn</code>."}], "answers": [{"tags": [], "owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "is_accepted": false, "score": 2, "last_activity_date": 1502709915, "creation_date": 1502709915, "answer_id": 45673467, "question_id": 45665335, "link": "https://stackoverflow.com/questions/45665335/struggling-with-basic-experiment-printing-to-stdio/45673467#45673467", "title": "Struggling with basic experiment printing to stdio", "body": "<p>It works like this:</p>\n\n<ul>\n<li><code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code>, noted the function to <code>fmap</code> is a normal function.</li>\n<li><code>fmap getDateStr date :: IO String</code>.</li>\n<li><code>print :: a -&gt; IO ()</code>, <code>a</code> will be <code>String</code>.</li>\n</ul>\n\n<p>So: <code>fmap print (fmap getDateStr date)</code> will has type of <code>IO (IO ())</code>. The point is <code>print</code> is <strong>not</strong> a \"normal\" function, but it is a <strong>monadic</strong> function. You <code>fmap</code> a monadic function to a monadic value, you will get a monadic value wrapped inside another monadic value.</p>\n\n<p>Then, when you evaluate <code>main</code>, you get back the inner monadic value of type <code>IO ()</code>. That's not what you want. To get the desired result, just <code>bind</code> <code>print</code> to <code>printabledate</code> as @Ryan suggested in the comment:</p>\n\n<pre><code>    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n    printabledate &gt;&gt;= print :: IO ()\n</code></pre>\n\n<p>That's all.</p>\n"}, {"tags": [], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "is_accepted": true, "score": 1, "last_activity_date": 1503969663, "last_edit_date": 1503969663, "creation_date": 1502719237, "answer_id": 45676300, "question_id": 45665335, "link": "https://stackoverflow.com/questions/45665335/struggling-with-basic-experiment-printing-to-stdio/45676300#45676300", "title": "Struggling with basic experiment printing to stdio", "body": "<p>Let's forget the concept of monads for a second to clear stuff a bit:</p>\n\n<p>In OOP, we have classes. Most of the time, these bind some behaviour to some data. In Haskell we do not do this, and rather we create <strong>data types</strong> that are just that, data.</p>\n\n<p>Also, in OOP, we have the concept of <strong>interface</strong>, which allows us to define an API for some common functions that some classes can share. In some way, we could group those classes by properties they share, like for example creating an interface <code>Mappable</code> which has a <code>map</code> method that applies a function to the contents of the class that implements that interface.</p>\n\n<p>Now, for example we could create a class <code>List&lt;T&gt;</code> that implements <code>Mappable</code> where <code>map</code> applies the function to each of the elements of the list.</p>\n\n<p>In Haskell, we have <strong>type classes</strong> which are like interfaces, but much better, because they allow you to implement the API for any existing type. For example our <code>Mappable</code> from before, is called <code>Functor</code> in Haskell. Don't get scared, as it is just a name like <code>AbstractEnterpriseJavaBeanFactory</code>. It is defined like this:</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n    ...\n</code></pre>\n\n<p>And now we can extend anything that has some contents, like our <code>List&lt;T&gt;</code> from before, with it, which in Haskell would be:</p>\n\n<pre><code>data List a = ...    -- List implementation\n\ninstance Functor List where\n    fmap f lst = ...     -- Implementation of fmap\n</code></pre>\n\n<p>This is great, because the <code>Functor</code> concept gives us the assurance that the function <code>f</code> will be applied to the contents of the data types that implements this, always returning another copy of the data type.</p>\n\n<p>And you now might be wondering, what has this to do with my question?</p>\n\n<p>Haskell comes with a lot of predefined type classes: <code>Functor</code>, <code>Foldable</code>, <code>Applicative</code>, ...</p>\n\n<p>Type classes only assure you that some constraints will be met when applying the functions defined in their API:</p>\n\n<ul>\n<li>Functor's <code>fmap</code> takes a function <code>a -&gt; b</code> and an <code>f a</code> as argument</li>\n<li>Applicative takes a \"container\" with a function inside <code>f (a -&gt; b)</code> and an <code>f a</code></li>\n<li>etc...</li>\n</ul>\n\n<p>Within all these many typeclasses there is one that has the following API</p>\n\n<pre><code>class X f where\n    bind :: (a -&gt; f b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>It's like our functor from before, but instead of returning an element, the function passed as a parameter, returns another \"container\".</p>\n\n<p><strong>This typeclass is called Monad</strong>, and in Haskell it is defined like:</p>\n\n<pre><code>class Monad m where\n    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n    return :: a -&gt; m a    -- This puts the value a inside of the \"container\" m\n    ...\n</code></pre>\n\n<p><em>(Note that arguments are flipped)</em></p>\n\n<p>So basically <em>IO</em> is not a monad, just a container type that happens to implement the API defined in the type class <code>Monad</code>, but also <code>Functor</code> and many others (you can check them in the <em>instances</em> section of <a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/System-IO.html#t:IO\" rel=\"nofollow noreferrer\">the IO API documentation</a>).</p>\n\n<p>Now let's reason a bit:</p>\n\n<p>First of all, we use <code>date</code> to get an <code>IO (Integer, Int, Int)</code>, which basically is a container that contains the triple.</p>\n\n<p>Then, we apply the <code>getDateStr</code> function to it's contents using <code>fmap</code>, so we get back an <code>IO</code> that has <code>String</code> inside of it.</p>\n\n<p>Now we bind this value to <code>printableDate</code>. So <code>printableDate</code> is now an <code>IO String</code>.</p>\n\n<p>Now we apply <code>print</code> to the contents of <code>printableDate</code> using <code>fmap</code>, but wait, <code>print</code> returns an \"empty\" <code>IO</code> container, so now what we get back is an <code>IO</code> containing an <code>IO ()</code> ( <code>IO (IO ())</code> ), but the <code>main</code> function's return type must be always <code>IO ()</code>.</p>\n\n<p>What do we do now? We have two options:</p>\n\n<p><strong>1)</strong> Unwrap the value inside our <code>printableDate</code> using the <code>&lt;-</code> operator, allowing us to get the <code>String</code> itself:</p>\n\n<pre><code>main = do\n    let printabledate = fmap getDateStr date\n    unwrappedPrintableDate &lt;- printabledate\n    print unwrappedPrintabledate\n</code></pre>\n\n<p>Or, directly:</p>\n\n<pre><code>main = do\n    printabledate &lt;- fmap getDateStr date\n    print printabledate\n</code></pre>\n\n<p><strong>2)</strong> Use the <code>&gt;&gt;=</code> operator defined in the <code>Monad</code> type class:</p>\n\n<pre><code>main = do\n    let printabledate = fmap getDateStr date\n    printabledate &gt;&gt;= print\n</code></pre>\n\n<p>Remember? The <code>&gt;&gt;=</code> operator expects that the function passed to it returns another \"container\", which is what <code>print</code> does.</p>\n\n<p>Use which one feels more natural to you, as they are both accepted and <a href=\"https://en.wikibooks.org/wiki/Haskell/do_notation\" rel=\"nofollow noreferrer\">the same thing</a></p>\n"}], "owner": {"reputation": 3932, "user_id": 233981, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/26b77ef1ab3e3df3df030435aea70568?s=128&d=identicon&r=PG", "display_name": "srking", "link": "https://stackoverflow.com/users/233981/srking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 45676300, "answer_count": 2, "score": 1, "last_activity_date": 1503969663, "creation_date": 1502662233, "last_edit_date": 1502663101, "question_id": 45665335, "link": "https://stackoverflow.com/questions/45665335/struggling-with-basic-experiment-printing-to-stdio", "title": "Struggling with basic experiment printing to stdio", "body": "<p>Brand new to Haskell and failing to print the date in a simple program.  What I'm trying to do:</p>\n\n<ol>\n<li>Get the current time from getCurrentTime</li>\n<li>Call a pure function on the date, returning a string</li>\n<li>Print the string to stdio.</li>\n</ol>\n\n<p>I've learned that getCurrentTime returns an IO monad.  I must raise my pure function into the monad using extra sauce like fmap.  Still no luck.</p>\n\n<p>What am I doing wrong?</p>\n\n<p>--- EDIT ---</p>\n\n<p>Forgot to mention that this compiles and runs but produces no output.</p>\n\n<pre><code>module Main where\nimport System.IO\nimport Data.Time.Clock\nimport Data.Time.Calendar\n\ndate :: IO (Integer,Int,Int)\ndate = fmap (toGregorian . utctDay) getCurrentTime\n\ngetDateStr :: (Integer,Int,Int) -&gt; String\ngetDateStr (year,month,day) = \"Date is \" ++ show year ++ \"/\" ++ show month ++ \"/\" ++ show day ++ \"\\n\"\n\nmain = do\n    let printabledate = fmap getDateStr date\n    fmap print printabledate\n</code></pre>\n"}, {"tags": ["haskell", "type-inference", "cyclic-dependency", "tying-the-knot", "st-monad"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1502656364, "post_id": 45664467, "comment_id": 78286938, "body": "I don&#39;t know of any real-world type checker which uses knot tying. I don&#39;t think it&#39;s going to get you far. A state of constraints/metavariables is the usual implementation, or bidirectional type checking for simple cases."}, {"owner": {"reputation": 402, "user_id": 4476886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826ef771ed046477d324a4dc64aa17b1?s=128&d=identicon&r=PG&f=1", "display_name": "SongWithoutWords", "link": "https://stackoverflow.com/users/4476886/songwithoutwords"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1502658137, "post_id": 45664467, "comment_id": 78287395, "body": "@Andr&#225;s-Kov&#225;cs I&#39;ve never written a compiler before, but a knot tying implementation appears to me to be a suitable solution by virtue of the fact that it works. I&#39;m curious to read about those other methods you mentioned, thanks for posting!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1502662305, "post_id": 45664467, "comment_id": 78288333, "body": "To expand on the &#39;constraint&#39; solution: when you encounter a mutual recursive block, e.g. <code>let x = y; y = x in ..</code>, you can assign a fresh type to all the variables; <code>x : t0; y : t1</code> and check each binding in sequence. When inferring the type of <code>x = y</code>, you emit an equality constraint <code>t0 ~ t1</code> and continue (without recursing to infer the type of <code>y</code>, since it is part of the same mutual block); then you infer <code>y = x</code> in the same manner by emitting the constraint <code>t1 ~ t0</code>. At the end, you must solve the (trivial) unification problem <code>t0 ~ t1 &#47;\\ t1 ~ t0</code>; one solutions is <code>t0 -&gt; t0; t1 -&gt; t0</code>."}, {"owner": {"reputation": 402, "user_id": 4476886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826ef771ed046477d324a4dc64aa17b1?s=128&d=identicon&r=PG&f=1", "display_name": "SongWithoutWords", "link": "https://stackoverflow.com/users/4476886/songwithoutwords"}, "edited": false, "score": 0, "creation_date": 1502666974, "post_id": 45664467, "comment_id": 78289133, "body": "As far as a knot tying implementation goes, I&#39;ve just discovered <code>Control.Monad.ST.Lazy</code>, which obviates the need for <code>unsafeInterleaveST</code> and works like a charm :)"}], "owner": {"reputation": 402, "user_id": 4476886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826ef771ed046477d324a4dc64aa17b1?s=128&d=identicon&r=PG&f=1", "display_name": "SongWithoutWords", "link": "https://stackoverflow.com/users/4476886/songwithoutwords"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1502654870, "creation_date": 1502654870, "question_id": 45664467, "link": "https://stackoverflow.com/questions/45664467/haskell-handling-cyclic-dependencies-while-tying-the-knot", "title": "Haskell: handling cyclic dependencies while tying the knot", "body": "<p>While writing a programming language that will feature local type inference (i.e. it will be capable of inferring types with the exception of function parameters, like Scala), I've run into a problem with cyclic dependencies.</p>\n\n<p>I perform type-checking/inference by exploring the AST recursively, and lazily mapping each optionally-typed node to a type-checked node. Because the type of any node may depend on the types of other nodes within the AST, I've tied the knot so that I can refer to the types of other nodes while inferring/checking the type of the current node (I keep the typed-AST within the environment of a Reader monad).</p>\n\n<p>This works perfectly well in the typical case, but breaks down with cyclic dependencies, as the program follows the loop endlessly in search of a known type.</p>\n\n<p>The solution to this sort of problem generally (as far as I know) is to maintain a collection of explored nodes, but I cannot think of a referentially-transparent way of doing this while tying the knot, because I do not know in advance the order in which the nodes will be visited/evaluated, as this depends on the graph of their dependencies on one another.</p>\n\n<p>As such, it seems I need to maintain a local, mutable collection of explored nodes. In order to do so, I tried the following:</p>\n\n<ul>\n<li>Using the State monad, which failed because it <em>seems</em> that each sub-computation receives its own copy of the state, so no information about already explored nodes can be shared between different branches of the computation.</li>\n<li>Using the IO monad with IORefs, which precluded me from tying the knot as a result of its strictness.</li>\n<li>Using <code>unsafePerformIO</code> with IORefs, which introduced problems with mutations occurring out of order or not at all.</li>\n<li>Using the ST monad with STRefs, which introduced the same problems with strictness as the IO monad.</li>\n</ul>\n\n<p>Finally, I came up with a solution using the ST monad, in which I force lazy evaluation while mapping over the AST using <code>unsafeInterleaveST</code>, which works, but feels fragile.</p>\n\n<p>Is there a more idiomatic and/or referentially transparent solution that isn't obscenely lengthy or complicated? I would have included a code sample, but my simplest formulation of this problem is ~250 lines.</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1502652266, "post_id": 45663520, "comment_id": 78285773, "body": "<code>liftA2 (flip const) fa fb</code> = <code>fmap (\\a b-&gt;b) fa &lt;*&gt; fb</code> = <code>fmap (const id) fa &lt;*&gt; fb</code> = <code>const id &lt;$&gt; fa &lt;*&gt; fb</code> (= <code>id &lt;$ fa &lt;*&gt; fb</code>). that&#39;s the meaning. lists are easy enough to handle, try <code>(,) &lt;$&gt; [1,2] &lt;*&gt; [10,20,30]</code>, <code>const id &lt;$&gt; [1,2] &lt;*&gt; [10,20,30]</code>, <code>[1,2] *&gt; [10,20,30]</code> and <code>[1,2] &lt;* [10,20,30]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1502652669, "post_id": 45663520, "comment_id": 78285899, "body": "and <code>fa &lt;* fb</code> = <code>liftA2 const fa fb</code> = <code>fmap const fa &lt;*&gt; fb</code> = <code>(\\a b -&gt; a) &lt;$&gt; fa &lt;*&gt; fb</code>. compare it with when <code>(,)</code> = <code>\\a b -&gt; (a,b)</code> is used, as above."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503261098, "post_id": 45663868, "comment_id": 78530658, "body": "Indeed, some care in writing <code>fmap</code> is required for recursive types to allow it to inline into the default <code>&lt;$</code> and avoid a bunch of worthless <code>const a b</code> thunks."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503261300, "post_id": 45663868, "comment_id": 78530715, "body": "<code>Data.Sequence.Seq</code> is a good example of a type with a peculiarly efficient <code>&lt;$</code>. <code>&lt;$</code> for that type takes time and space logarithmic in the length of the sequence, while <code>fmap</code> takes linear time and space."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 7, "last_activity_date": 1502650748, "creation_date": 1502650748, "answer_id": 45663868, "question_id": 45663520, "link": "https://stackoverflow.com/questions/45663520/what-are-applicative-left-and-right-star-sequencing-operators-expected-to-do/45663868#45663868", "title": "What are Applicative left and right star sequencing operators expected to do?", "body": "<p>These operators sequence two applicative actions and provide the result of the action that the arrow points to. For example,</p>\n\n<pre><code>&gt; Just 1 *&gt; Just 2\nJust 2\n\n&gt; Just 1 &lt;* Just 2\nJust 1\n</code></pre>\n\n<p>Another example in writing parser combinators is</p>\n\n<pre><code>brackets p = char '(' *&gt; p &lt;* char ')'\n</code></pre>\n\n<p>which will be a parser that matches <code>p</code> contained in brackets and gives the result of parsing <code>p</code>.</p>\n\n<p>In fact, <code>(*&gt;)</code> is the same as <code>(&gt;&gt;)</code> but only requires an <code>Applicative</code> constraint instead of a <code>Monad</code> constraint.</p>\n\n<blockquote>\n  <p>I don't even understand why does <code>&lt;$</code> deserve a place in a typeclass.</p>\n</blockquote>\n\n<p>The answer is given by <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Functor.html#v:-60--36-\" rel=\"noreferrer\">the Functor documentation</a>: <code>(&lt;$)</code> can sometimes have more efficient implementations than its default, which is <code>fmap . const</code>.</p>\n\n<blockquote>\n  <p>How is that related to the meaning of Applicative sequencing operators?</p>\n</blockquote>\n\n<p>In cases where <code>(&lt;$)</code> is more efficient, you want to maintain that efficiency in the definition of <code>(*&gt;)</code>.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1503245524, "creation_date": 1502648519, "last_edit_date": 1503245524, "question_id": 45663520, "link": "https://stackoverflow.com/questions/45663520/what-are-applicative-left-and-right-star-sequencing-operators-expected-to-do", "title": "What are Applicative left and right star sequencing operators expected to do?", "body": "<p>I looked up the implementation and it's even more mysterious:</p>\n\n<pre><code>-- | Sequence actions, discarding the value of the first argument.\n(*&gt;) :: f a -&gt; f b -&gt; f b\na1 *&gt; a2 = (id &lt;$ a1) &lt;*&gt; a2\n-- This is essentially the same as liftA2 (flip const), but if the\n-- Functor instance has an optimized (&lt;$), it may be better to use\n-- that instead. Before liftA2 became a method, this definition\n-- was strictly better, but now it depends on the functor. For a\n-- functor supporting a sharing-enhancing (&lt;$), this definition\n-- may reduce allocation by preventing a1 from ever being fully\n-- realized. In an implementation with a boring (&lt;$) but an optimizing\n-- liftA2, it would likely be better to define (*&gt;) using liftA2.\n\n-- | Sequence actions, discarding the value of the second argument.\n(&lt;*) :: f a -&gt; f b -&gt; f a\n(&lt;*) = liftA2 const\n</code></pre>\n\n<p>I don't even understand why does <code>&lt;$</code> deserve a place in a typeclass. It looks like there is some sharing-enhancig effect which <code>fmap . const</code> might not have and that <code>a1</code> might not be \"fully realized\". How is that related to the meaning of <code>Applicative</code> sequencing operators?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502647959, "post_id": 45663088, "comment_id": 78284476, "body": "Is the example on the wikibooks page (<code>pointCoordinates</code> is a <code>Traversal</code> and not a <code>Lens</code>) inadequate? If so, how?"}, {"owner": {"reputation": 2815, "user_id": 4394797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f29f3a02e559366d897f287948c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "cgold", "link": "https://stackoverflow.com/users/4394797/cgold"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502648459, "post_id": 45663088, "comment_id": 78284648, "body": "Thanks for the note! I didn&#39;t even make this connection and will look at the <code>pointCoordinates</code> example more closely, I think a big part of that will be practically using this Traversal to get and set values."}], "owner": {"reputation": 2815, "user_id": 4394797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f29f3a02e559366d897f287948c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "cgold", "link": "https://stackoverflow.com/users/4394797/cgold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1502645689, "creation_date": 1502645689, "question_id": 45663088, "link": "https://stackoverflow.com/questions/45663088/traversals-as-multilenses-what-would-be-an-example", "title": "Traversals as multilenses: What would be an example?", "body": "<p>I'm currently working on understanding the <code>lens</code> library in detail by following the explanation in <a href=\"https://en.wikibooks.org/wiki/Haskell/Lenses_and_functional_references#The_scenic_route_to_lenses\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/Haskell/Lenses_and_functional_references#The_scenic_route_to_lenses</a>, which starts with a <code>Traversal</code> and then introduces the <code>Lens</code>. The wiki makes the distinction that a <code>Traversal</code> can have multiple targets, while a <code>Lens</code> has a single target.</p>\n\n<p>This arguments is also made <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Traversal.html\" rel=\"nofollow noreferrer\">in the documentation for <code>Traversal</code></a>, \"[Traversals] have also been known as multilenses\".</p>\n\n<p>What would be example code to illustrate this distinction? E.g. how can I use a <code>Traversal</code> to get or set multiple values in a way I cannot do with a <code>Lens</code>?</p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1502625845, "post_id": 45660110, "comment_id": 78278085, "body": "not sure I understand the question... what exactly are you trying to achieve?"}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1502626159, "post_id": 45660110, "comment_id": 78278162, "body": "load libraries, compile expression and return it for later use, when those libraries may no longer be loaded (because of <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-8.2.1/GHC.html#v:workingDirectoryChanged\" rel=\"nofollow noreferrer\">this</a>)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502637566, "post_id": 45660110, "comment_id": 78281402, "body": "Do you have an example of it not working? Why do you say you are using symbols from a module? After unloading <code>test.hs</code>, you only refer to <code>act</code>, which is a value in the <i>current</i> Haskell program, not in the interpreted program you previously loaded. Is there a broader context of what you&#39;re trying to achieve? (besides this <a href=\"https://stackoverflow.com/questions/45659935/changing-directories-in-ghc-monad\">other</a> question, which fails to provide any such context)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502640611, "post_id": 45660110, "comment_id": 78282273, "body": "@user2407038 <code>act</code> is the compilation of <code>print test</code>; presumably <code>test</code> comes from the previously-loaded (and unloaded?) <code>test.hs</code>. Seems like a perfectly cromulent question and concern to me."}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502643931, "post_id": 45660110, "comment_id": 78283235, "body": "@user2407038 <code>test</code> is just <code>(123 :: Int)</code>, so it&#39;s trivial. I don&#39;t know what kind of code should i load to prove that this is reliable. If you can give me such example i&#39;ll try it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502647190, "post_id": 45660110, "comment_id": 78284234, "body": "Test it on whichever code you want to actually interpret (i.e. a &quot;non trivial&quot; case, whatever that may be in your understanding). If you don&#39;t have such code, I simply wouldn&#39;t worry about it. @DanielWagner It doesn&#39;t seem so to me since there is no example showing not-working behaviour, and I don&#39;t follow the logic (for the reason I&#39;ve explained) leading to the conclusion that there exists such an example. As it stands, this question is purely hypothetical (in my opinion) so I don&#39;t see how one can answer it (unless one is aware of a counter-example, but I see no reason for it to exist)."}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502650255, "post_id": 45660110, "comment_id": 78285226, "body": "@user2407038 the purpose of this is that it can be possible workaround (not really good, but still) to <a href=\"https://stackoverflow.com/questions/45659935/changing-directories-in-ghc-monad?noredirect=1#comment78284384_45659935\">this</a> question, namely load file, create and store expressions using this, file, then unload and change directory properly. This looks theoretically correct, but i&#39;m not sure if tinkering with linker won&#39;t break referential transparency."}], "owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1502625650, "creation_date": 1502625650, "question_id": 45660110, "link": "https://stackoverflow.com/questions/45660110/returning-expression-from-ghc-monad", "title": "Returning expression from GHC Monad", "body": "<p>I've found this <a href=\"https://parenz.wordpress.com/2013/08/17/ghc-api-interpreted-compiled-and-package-modules/\" rel=\"nofollow noreferrer\">blog post</a>, and i was playing a bit with example code.</p>\n\n<p>I've modified first example to look like this:</p>\n\n<pre><code>main = defaultErrorHandler defaultFatalMessager defaultFlushOut $ do\nrunGhc (Just libdir) $ do\n    dflags &lt;- getSessionDynFlags\n    setSessionDynFlags $ dflags { hscTarget = HscInterpreted\n                                , ghcLink   = LinkInMemory\n                                }\n    setTargets =&lt;&lt; sequence [guessTarget \"test.hs\" Nothing]\n    load LoadAllTargets\n    setContext [IIModule $ mkModuleName \"Test\"]\n    !act &lt;- unsafeCoerce &lt;$&gt; compileExpr \"print test\"  \n    setTargets []\n    load LoadAllTargets\n    liftIO act\n</code></pre>\n\n<p>This happened to work, but this doesn't looks safe - for me this looks like i'm using symbols from module i just unloaded. Will this work in non trivial cases?</p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1502634547, "post_id": 45659935, "comment_id": 78280513, "body": "Maybe you should use something more high-level, like hint? <a href=\"https://hackage.haskell.org/package/hint\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/hint</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502636380, "post_id": 45659935, "comment_id": 78281078, "body": "&quot;I need to run loaded code and compile expressions while changing directories.&quot; - you should provide some context of what you hope to achieve here; the details will determine how you accomplish it."}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1502644184, "post_id": 45659935, "comment_id": 78283316, "body": "@arrowd hint uses GHC Monad, same rules should apply, they could just not be metioned (i guess it&#39;s a rare use case)"}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502644188, "post_id": 45659935, "comment_id": 78283317, "body": "@user2407038 I&#39;m embeding haskell runtime into zsh module, which will load and interpret haskell code"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502647636, "post_id": 45659935, "comment_id": 78284384, "body": "This is very broad; what Haskell code do you wish to embed, and how do you wish to use it from zsh? In other words, is there a minimal example of a situation in which you want to compile <code>x</code>, change directories, compile <code>y</code>, and this doesn&#39;t work because of the aforementioned restriction (where x and y are concrete programs)? (As a potential solution, make <code>x</code> and <code>y</code> into packages, and have a third module <code>z</code> which depends on <code>x</code> and <code>y</code> via a build system, e.g. cabal)."}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502648623, "post_id": 45659935, "comment_id": 78284698, "body": "@user2407038 1. Create zsh builtins that can: a) load .hs file, b) compile string and store resulting function in a map, c) get function form map and call it (a alredy have b and c implemented using hint, but hint is a little limited) 2. <code>load somefile.hs; cd somewhere; mkfunc &quot;name&quot; &quot;\\args -&gt; funcFromSomeFile $ head args&quot;; callfunc &quot;name&quot; &quot;foo&quot;</code>  Judging by documentation alone this won&#39;t work, i don&#39;t want to rely on undefined behaviours if i don&#39;t have to.  I am aware that i can create packages, but this is rather cumbersome solution"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502650835, "post_id": 45659935, "comment_id": 78285405, "body": "If you have a and b, but not yet c, why not write a question which includes: how you&#39;ve done a and b, how you&#39;ve attempted to do c, and the overall desired semantics (e.g. should this map be persistent between sessions?). To deal with the pwd issue, you should be able to construct the <code>Target</code> explicitly using a fully qualified <code>FilePath</code>, which should allow you to bypass the pwd altogether. (Aside: hint is indeed limited; you have have to rewrite things to work with the GHC api directly to get your desired semantics)"}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502652394, "post_id": 45659935, "comment_id": 78285815, "body": "@user2407038 using fully qualified paths is something that will probably let me get away with using GHC api incorrectly. Unless some proper solution to this exists this, or switching directory to some constant ghc work dir and back is the way to go."}], "owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1502624439, "creation_date": 1502624439, "last_edit_date": 1592644375, "question_id": 45659935, "link": "https://stackoverflow.com/questions/45659935/changing-directories-in-ghc-monad", "title": "Changing directories in GHC Monad", "body": "<p>Looking at ghc package documentation i found this function:</p>\n<blockquote>\n<p><code>workingDirectoryChanged :: GhcMonad m =&gt; m ()</code></p>\n<p>Inform GHC that the working directory has changed. GHC will flush its cache of module locations, since it may no longer be valid.</p>\n<p>Note: Before changing the working directory make sure all threads running in the same session have stopped. If you change the working directory, you should also unload the current program (set targets to empty, followed by load).</p>\n</blockquote>\n<p>I need to run loaded code and compile expressions while changing directories. Is there any way/workaround to this?</p>\n<p>One solution i can think of is having separate directory, and setting workdir to that directory whenever interpreter is to be invoked, then restoring old pwd, but i'm not sure if it will work or if this is the best solution.</p>\n"}, {"tags": ["haskell", "records"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 4, "last_activity_date": 1502621435, "creation_date": 1502621435, "answer_id": 45659560, "question_id": 45659190, "link": "https://stackoverflow.com/questions/45659190/why-is-this-hasfield-instance-not-being-resolved/45659560#45659560", "title": "Why is this HasField instance not being resolved?", "body": "<p>The problem is solved by enabling <code>{-# LANGUAGE PolyKinds #-}</code> in the <code>Moat</code> module which defines the <code>HasField</code> instance.</p>\n\n<p>I suppose it has to do with <code>HasField</code> typeclass being poly-kinded:</p>\n\n<pre><code>\u03bb :info HasField\nclass HasField k (x :: k) r a | x r -&gt; a where\n    getField :: r -&gt; a\n</code></pre>\n\n<p>This allows us to define <code>HasField</code> instances like this one, where the field selector is  a non-<code>Symbol</code> type:</p>\n\n<pre><code>import GHC.Records\ndata A = A B\ndata B = B deriving Show\ninstance HasField B A B where\n    getField (A b) = b\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>\u03bb&gt; getField @B (A B)\nB\n</code></pre>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 45659560, "answer_count": 1, "score": 3, "last_activity_date": 1502621435, "creation_date": 1502618653, "question_id": 45659190, "link": "https://stackoverflow.com/questions/45659190/why-is-this-hasfield-instance-not-being-resolved", "title": "Why is this HasField instance not being resolved?", "body": "<p>I'm using <strong>GHC 8.2.1</strong>. I have the following module:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nmodule Moat (Moat,moat) where\n\nimport GHC.Records (HasField(..))\n\nnewtype Moat r = Moat r\n\nmoat :: r -&gt; Moat r\nmoat = Moat\n\ninstance HasField s r v =&gt; HasField s (Moat r) v where\n    getField (Moat r) = getField @s r\n</code></pre>\n\n<p>And this other one:</p>\n\n<pre><code>module Foo (Foo(..)) where\n\ndata Foo a = Foo { getDims :: (Int, Int), getData :: [a] }\n</code></pre>\n\n<p>My problem is that when I have both modules imported and I try to do something like:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE DataKinds #-}\nimport Moat\nimport Foo\nimport GHC.Records\n\noops :: (Int,Int)\noops = getField @\"getDims\" (moat (Foo (5,5) ['c']))\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>No instance for (HasField \"getDims\" (Moat (Foo Char)) (Int, Int))\n       arising from a use of \u2018getField\u2019\n</code></pre>\n\n<p>Why is the <code>HasField</code> instance not being resolved?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1502607749, "post_id": 45657854, "comment_id": 78273784, "body": "<code>possibly incorrect indentation</code>. The <code>let..in</code> block looks like it&#39;s incorrectly indented. Try to experiment with its indentation to get the code to compile."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1502609692, "post_id": 45657854, "comment_id": 78274238, "body": "<code>let arg = arg-1</code> and <code>let n=n+1</code> are recursive definition which define <code>arg</code> and <code>n</code> as infinite looping computations. You don&#39;t want that. You are trying to mutate variables in Haskell, which was designed so to make that impossible. That approach is too imperative to work in a FP language. Roughly, the only way to &quot;change&quot; a variable is to call a function with the new value, eg. <code>f 0 = 0 ; f n = f (n-1)</code> defines a recursion that &quot;decreases&quot; <code>n</code> until it reaches 0."}], "answers": [{"tags": [], "owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "is_accepted": false, "score": 3, "last_activity_date": 1502608485, "creation_date": 1502608485, "answer_id": 45658052, "question_id": 45657854, "link": "https://stackoverflow.com/questions/45657854/haskell-parse-error-possibly-incorrect-indentation-or-mismatched-brackets/45658052#45658052", "title": "Haskell: parse error possibly incorrect indentation or mismatched brackets", "body": "<p>You can't write <code>let n = 0</code> at the top level. Once you remove that, the <code>else let</code> portion of your code is not correctly indented either, as its use (outside of a <code>do</code> block) is always <code>let ... in ...</code>, and the contents of the <code>let</code> portion must be equally indented. Even if it were formatted, <code>let</code> is recursive, so <code>arg = arg - 1</code> means a value which is one less than itself, which doesn't compute.</p>\n\n<p>Now, this function actually does two things: it cycles through all the elements of the list, and also limits it to a given length. Both of these are already available in the standard library.</p>\n\n<pre><code>demo n xs = take n (cycle xs)\n</code></pre>\n\n<p>If you wanted to write it yourself, a similar breakdown is also reasonable.</p>\n\n<pre><code>demo :: Int -&gt; [a] -&gt; [a]\n-- Handle negative n, so we can assume it's positive below\ndemo n _ | n &lt; 0 = []\n-- Similarly, handle empty list, so we can assume it's non-empty below\ndemo _ [] = []\n-- Given a positive n and non-empty list, start cycling list with limit n.\ndemo n list = demo' n list\n  where\n    -- Limit has been reached, stop.\n    demo' 0 _ = []\n    -- List is exhausted, cycle back to the start.\n    demo' m [] = demo' m list\n    -- Take the next element of the list and continue.\n    demo' m (x:xs) = x : demo' (m-1) xs\n</code></pre>\n\n<p>Note that it was not necessary to use <code>length</code>, which is a good thing! <code>length</code> diverges on infinite lists, while this handles them gracefully.</p>\n"}, {"comments": [{"owner": {"reputation": 39, "user_id": 7555905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uw3Aq.jpg?s=128&g=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/7555905/sean"}, "edited": false, "score": 0, "creation_date": 1502692399, "post_id": 45663123, "comment_id": 78294601, "body": "Thanks jferard! Your code is exactly what I mean.  And I thought the problem is caused by variable n, but I don&#39;t know how to fix that, thanks for answer my question."}, {"owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "reply_to_user": {"reputation": 39, "user_id": 7555905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uw3Aq.jpg?s=128&g=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/7555905/sean"}, "edited": false, "score": 0, "creation_date": 1502730436, "post_id": 45663123, "comment_id": 78316710, "body": "@Sean You are welcome. You should accept either my answer or ephemient&#39;s one."}], "tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": false, "score": 6, "last_activity_date": 1502645905, "creation_date": 1502645905, "answer_id": 45663123, "question_id": 45657854, "link": "https://stackoverflow.com/questions/45657854/haskell-parse-error-possibly-incorrect-indentation-or-mismatched-brackets/45663123#45663123", "title": "Haskell: parse error possibly incorrect indentation or mismatched brackets", "body": "<p>You are mixing imperative and functional paradigms: <code>let n = 0</code>, <code>let (x:xs) = (x:xs) ++ (x:xs)!!n</code>, <code>arg = arg - 1</code>, <code>n = n + 1</code> are (in your code) imperative expressions. You expect the values of <code>n</code>, <code>(x:xs)</code> and <code>arg</code> to be modified, but functional programming does not work like that.</p>\n\n<p>The function you are declaring is meant to be <em>pure</em>: that means that you can't expect values to be modified (what we call a \"side effect\"). The only thing you can do is to call a new function (or the same function) with new arguments that are computed \"on the fly\" from the original arguments.</p>\n\n<p>Let's try to be concrete.</p>\n\n<p>You can't do:</p>\n\n<pre><code>arg = arg - 1\ndemo arg (x:xs)\n</code></pre>\n\n<p>But you can do:</p>\n\n<pre><code>demo (arg - 1) (x:xs)\n</code></pre>\n\n<p>The latter is a call of <code>demo</code> with <code>arg - 1</code> as argument. The value of <code>arg</code> was never modified.</p>\n\n<p>The main problem in your code is the <code>n</code> variable. It should be <code>0</code> at first call, and should be increased each time <code>arg &lt; length (x:xs)</code> to add the next element from <code>(x:xs)</code> to the end of <code>(x:xs)</code> itself. Thus, the list will grow in a cyclic way until we can take the desired number of elements.</p>\n\n<p>To reach that goal, you have to create an auxiliary function and to \"move\" the recursion into that auxiliary function:</p>\n\n<pre><code>demo :: Int -&gt; [a] -&gt; [a]\ndemo arg [] = [] \ndemo arg (x:xs) = demo' arg 0 (x:xs) -- n = 0\n    where \n        demo' :: Int -&gt; Int -&gt; [a] -&gt; [a]\n        demo' arg n l = if arg &lt;= length l \n                        then take arg l \n                        else \n                            -- call demo' with new parameters:\n                            -- (x:xs) = (x:xs) ++ [(x:xs)!!n]\n                            -- arg = arg - 1\n                            -- n = n + 1 \n                            demo' (arg-1) (n+1) ((x:xs) ++ [(x:xs)!!n]) ```\n</code></pre>\n\n<p>Now, from the example you have given, <code>arg</code> is the constant number of elements in the list you want to create, so it should not be decreased. And you don't need the deconstruction of the list in <code>(x:xs)</code>. Finally, with a little cleanup, you have :</p>\n\n<pre><code>demo :: Int -&gt; [a] -&gt; [a]\ndemo arg [] = [] \ndemo arg l = demo' arg 0 l\n    where \n        demo' :: Int -&gt; Int -&gt; [a] -&gt; [a]\n        demo' arg n l = if arg &lt;= length l \n                        then take arg l \n                        else demo' arg (n+1) (l ++ [l!!n])\n</code></pre>\n\n<p>There is a far better way to achieve this (<code>demo n=take n.cycle</code>), but I tried to stay close to your original implementation.</p>\n"}], "owner": {"reputation": 39, "user_id": 7555905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uw3Aq.jpg?s=128&g=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/7555905/sean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10026, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1502645905, "creation_date": 1502606790, "question_id": 45657854, "link": "https://stackoverflow.com/questions/45657854/haskell-parse-error-possibly-incorrect-indentation-or-mismatched-brackets", "title": "Haskell: parse error possibly incorrect indentation or mismatched brackets", "body": "<p>When I try to use the function below to implement a function like below the compiler return </p>\n\n<blockquote>\n  <p>parse error (possibly incorrect indentation or mismatched brackets)</p>\n</blockquote>\n\n<p>The function:</p>\n\n<blockquote>\n  <p>demo 8 [1,2,3]    should return   [1,2,3,1,2,3,1,2]</p>\n</blockquote>\n\n<pre><code> demo :: Int -&gt; [a] -&gt; [a] \n    let n = 0 \n    demo arg [] = [] \n    demo arg (x:xs) = \n         if arg &lt;= length (x:xs) then\n             take arg (x:xs) \n         else\n             let (x:xs) = (x:xs) ++ (x:xs)!!n\n             arg = arg - 1\n             n = n + 1\n             demo arg (x:xs)\n</code></pre>\n\n<p>How can I correct that?\nRegards!</p>\n"}, {"tags": ["haskell", "uuagc"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1502606171, "post_id": 45657756, "comment_id": 78273491, "body": "Figure 5 of <a href=\"https://svn.science.uu.nl/repos/project.ruler.papers/ag-haskell-paper/ag-haskell-lncs.pdf\" rel=\"nofollow noreferrer\">Merging Idiomatic Haskell with Attribute Grammars</a> implies I should be able to write <code>data Foo @a</code> but that syntax is rejected by UUAGC 0.9.52."}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1502605687, "creation_date": 1502605687, "question_id": 45657756, "link": "https://stackoverflow.com/questions/45657756/polymorphic-uuag-attributes", "title": "Polymorphic UUAG attributes", "body": "<p>I'd like to define an attribute which is polymorphic. For a non-sensical example, suppose I want to <code>syn</code>thesize a list of any type (so in practice it can only be the empty list) :</p>\n\n<pre><code>ATTR Foo\n  SYN lst : {[a]}\n</code></pre>\n\n<p>(a less non-sensical example could involve some typeclass constraint, or an <code>ST s (STRef s Something))</code> etc.)</p>\n\n<p>The problem, of course, is that without telling UUAGC that <code>lst</code> is supposed to be polymorphic, it generates the following invalid Haskell code:</p>\n\n<pre><code>type T_Foo = ( ([a]))\ndata Inh_Foo = Inh_Foo {}\ndata Syn_Foo = Syn_Foo {lst_Syn_Foo :: ([a])}\n\nsem_Foo :: Foo -&gt; T_Foo\n</code></pre>\n\n<p>So how do I get UUAGC to instead generate something like</p>\n\n<pre><code>type T_Foo a = ( ([a]))\ndata Inh_Foo a = Inh_Foo {}\ndata Syn_Foo a = Syn_Foo {lst_Syn_Foo :: ([a])}\n\nsem_Foo :: Foo -&gt; T_Foo a\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 8456850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d3ebd9c83d5e96d60a30c9e6d32f49d?s=128&d=identicon&r=PG&f=1", "display_name": "YM.Zhou", "link": "https://stackoverflow.com/users/8456850/ym-zhou"}, "edited": false, "score": 0, "creation_date": 1502703355, "post_id": 45658130, "comment_id": 78300402, "body": "Great answer! Worked for me.Thanks for your advice."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 1, "last_activity_date": 1502609353, "creation_date": 1502609353, "answer_id": 45658130, "question_id": 45657266, "link": "https://stackoverflow.com/questions/45657266/there-was-an-error-when-executing-the-ghc-modi-type-command/45658130#45658130", "title": "There was an error when executing the ghc-modi `type` command:", "body": "<p>The problem is in exactly what compiler says:</p>\n\n<pre><code>The constructor \u2018Ramen\u2019 should have no arguments, but has been given 1.\n</code></pre>\n\n<p><code>Ramen</code> and <code>Chips</code> have definition <code>data Product = Ramen | Chips</code>, but receive an argument in <code>case</code> expression (<code>Ramen x</code> and <code>Chips x</code>). In order to fix the compile error, you'll need:</p>\n\n<p>Either change <code>Ramen x</code> and <code>Chips x</code> to just <code>Ramen</code> and <code>Chips</code> and move <code>x</code> into the function definition or change you data constructors to <code>data Product = Ramen Integer | Chips Integer</code> and move <code>Integer</code> out of <code>totalPrice :: Product -&gt; Integer -&gt; Float</code>. Probably, the first option is more suitable.</p>\n\n<p>But after fixing this problem you'll get another one:</p>\n\n<pre><code>Couldn't match expected type \u2018Float\u2019 with actual type \u2018Integer\u2019\n</code></pre>\n\n<p>It can be fixed by using <code>fromIntegral :: (Num b, Integral a) =&gt; a -&gt; b</code>.</p>\n\n<p>This should fix the compile errors, but after calling the <code>totalPrice Ramen 10</code> you'll get <code>14.0</code> as a result, but I assume you're expecting <code>20.0</code>. That's because <code>case</code> fails on <code>x &gt;= 200 -&gt; 1.35*x</code>, but succeeds on <code>x &lt;= 200 -&gt; 1.4*x</code>.</p>\n\n<p>The following example will compile and return:</p>\n\n<pre><code>200 * 1.35 on totalPrice Ramen 200\n150 * 1.4 on totalPrice Ramen 150\nand\n10 * 2.0 on totalPrice Ramen 10\n</code></pre>\n\n<p>But, I think it's not encouraged to use <code>error</code> in <code>Haskell</code>, what about just returning <code>0</code> is <code>count</code> is negative?</p>\n\n<pre><code>totalPrice :: Product -&gt; Integer -&gt; Float    \ntotalPrice product count = case product of\n                Ramen\n                     | x &gt;= 200 -&gt; 1.35*x\n                     | x &gt;  100 -&gt; 1.4*x\n                     | x &gt;  30 -&gt; 1.5*x\n                     | x &gt;  10 -&gt; 1.8*x\n                     | x &gt;= 0 -&gt; 2.0*x\n                     | otherwise -&gt; 0\n                Chips\n                     | x &gt;= 21 -&gt; 2.35*x\n                     | x &gt;  10 -&gt; 2.5*x\n                     | x &gt;  5 -&gt; 2.7*x\n                     | x &gt;  2 -&gt; 2.95*x\n                     | x &gt;= 0 -&gt; 3.0*x\n                     | otherwise -&gt; 0\n   where x = fromIntegral count\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 8456850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d3ebd9c83d5e96d60a30c9e6d32f49d?s=128&d=identicon&r=PG&f=1", "display_name": "YM.Zhou", "link": "https://stackoverflow.com/users/8456850/ym-zhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1502609353, "creation_date": 1502600585, "last_edit_date": 1502601510, "question_id": 45657266, "link": "https://stackoverflow.com/questions/45657266/there-was-an-error-when-executing-the-ghc-modi-type-command", "title": "There was an error when executing the ghc-modi `type` command:", "body": "<p>I try to use the data.maybe type but failed. When I tried to run it in ghci, it told me\"The constructor \u2018Ramen\u2019 should have no arguments, but has been given 1.\". How can I fix it?</p>\n\n<pre><code>data Product = Ramen | Chips\n\ntotalPrice :: Product -&gt; Integer -&gt; Float\n\ntotalPrice product = case product of\n                Ramen x\n                     | x &gt;= 200 -&gt; 1.35*x\n                     | x &lt;= 200 -&gt; 1.4*x\n                     | x &lt;= 100 -&gt; 1.5*x\n                     | x &lt;= 30 -&gt; 1.8*x\n                     | x &lt;= 10 -&gt; 2.0*x\n                     | otherwise -&gt; error \"Something's wrong.\"\n                Chips x\n                     | x &gt;= 21 -&gt; 2.35*x\n                     | x &lt;= 20 -&gt; 2.5*x\n                     | x &lt;= 10 -&gt; 2.7*x\n                     | x &lt;= 5 -&gt; 2.95*x\n                     | x &gt;= 1 &amp;&amp; x &lt;= 2 -&gt; 3.0*x\n                     |otherwise -&gt; error \"Something's wrong.\"\n</code></pre>\n"}, {"tags": ["haskell", "scope"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1502582585, "post_id": 45655944, "comment_id": 78270059, "body": "This is the exact situation to use a fold. I would consider a fold to be a &quot;primitive&quot;."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1502583224, "post_id": 45655944, "comment_id": 78270170, "body": "To sum a list, it&#39;s just <code>foldl + numbers</code>. Folds are incredibly simple once you use them a few times."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 2, "creation_date": 1502583499, "post_id": 45655944, "comment_id": 78270212, "body": "Are you just trying to sum a list of numbers? I&#39;ll write an answer if that&#39;s your question. It&#39;s unclear though exactly what you&#39;re going for."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4234032"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1502584584, "post_id": 45655944, "comment_id": 78270377, "body": "Sum the numbers in a list, yes. I was supposed to be able to solve this before learning Foldable. I also just learned the (+1) trick in place of the succ function. I&#39;d love an answer, would clear the post."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1502584925, "post_id": 45655944, "comment_id": 78270426, "body": "Can you explain what you aim to achieve with the <code>drop (succ (elemIndex x xs)) xs</code> part?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4234032"}, "edited": false, "score": 0, "creation_date": 1502585063, "post_id": 45655944, "comment_id": 78270444, "body": "It&#39;s like tail, but variable with x?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1502585902, "post_id": 45655944, "comment_id": 78270547, "body": "Your questions states that your function should &quot;Sum the contents of a list&quot;. However, it is very clearly intended to do something else. It is adding <i>some</i> of the elements of the list, but not all. <code>drop (succ (elemIndex x xs)) xs</code> doesn&#39;t even typecheck (<code>elemIndex</code> produces <code>Maybe Int</code>). If that part did work, it would remove the prefix of <code>xs</code> which comes before another occurrence of <code>x</code> (and do .. something when <code>x</code> is not in <code>xs</code>). Can you describe the intended semantics of <code>sum&#39;</code> correctly?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502586183, "post_id": 45655944, "comment_id": 78270570, "body": "To address some more concrete issues here: &quot;Note how rest is a set&quot; - is it? It looks like a plain old list. &quot;not being built by an explicit notation&quot; ... &quot; - what is &#39;explicit notation&#39;? Is it relevant to the question? &quot;Instead it is out of scope.&quot; - It sounds like your code is presently giving you an error. You should include that error in your question. (I see no scope errors here). &quot;I&#39;ve seen a similar question or two&quot; - if your question has already been asked and answered, can you change the focus of this question to what you don&#39;t understand about those answers?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502587387, "post_id": 45655944, "comment_id": 78270724, "body": "What do you mean by &quot;[x] is out of scope&quot;?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4234032"}, "edited": false, "score": 0, "creation_date": 1502591629, "post_id": 45655944, "comment_id": 78271280, "body": "Edited. It was hard to read, and wrong. Thanks"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4234032"}, "edited": false, "score": 1, "creation_date": 1502591857, "post_id": 45656193, "comment_id": 78271316, "body": "1. Your explanation of foldl is excellent 2. I didn&#39;t realize it could be written so simply as your first answer. 3. The Haskell community appears to be alot more understanding than many others! I was expecting to be downvoted into oblivion. Instead, I got a good answer and learned something. Thank you"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1502592105, "post_id": 45656193, "comment_id": 78271345, "body": "Np. I should note though that the function you give to <code>foldl</code> doesn&#39;t need to be as simple as a math operator. Folds + anonymous functions = very succinct looping."}], "tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 3, "last_activity_date": 1502594134, "last_edit_date": 1502594134, "creation_date": 1502585992, "answer_id": 45656193, "question_id": 45655944, "link": "https://stackoverflow.com/questions/45655944/haskell-remembering-previous-element-in-a-list/45656193#45656193", "title": "Haskell: Remembering previous element in a list", "body": "<p>If you want to write a summing function \"manually\", it would simply be the first element plus the sum of the remaining elements:</p>\n\n<pre><code>sum' :: Num a =&gt; [a] -&gt; a\n\n-- The sum of an empty list is 0\n-- The \"base case\" of the recursion\nsum' [] = 0\n\n-- The sum of a non-empty list is equal to the first element\n-- plus the sum of the rest of the list \nsum' (x:xs) = x + (sum' xs)\n</code></pre>\n\n<p>Which is nice, but after a while, you'll realize you'll be doing this exact pattern a lot: looping over a list while maintaining an accumulator. The sum of the numbers is the accumulator in this case.</p>\n\n<p>This is where <code>fold</code>s come in. A complete description of how a fold works is beyond the question, but to sum a list of numbers using a fold, you can simply write:</p>\n\n<pre><code>sum' :: Num a =&gt; [a] -&gt; a\nsum' xs = foldl (+) 0 xs\n</code></pre>\n\n<p>Folds <em>basically</em> insert the function you give it between each element in the list, so</p>\n\n<pre><code>foldl (+) 0 [1, 2, 3, 4, 5]\n</code></pre>\n\n<p>Is <em>basically</em> the same thing as (note the 0 on the left. That's the starting sum):</p>\n\n<pre><code>0 + 1 + 2 + 3 + 4 + 5\n</code></pre>\n\n<p>For more on folds, I wrote an answer (among many others) <a href=\"https://softwareengineering.stackexchange.com/q/331544/139925\">here</a>. It's worth a look.</p>\n"}, {"tags": [], "owner": {"reputation": 1439, "user_id": 334582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0adff13c4bbb337e2ccee14870161615?s=128&d=identicon&r=PG", "display_name": "Jonas Fagundes", "link": "https://stackoverflow.com/users/334582/jonas-fagundes"}, "is_accepted": false, "score": 0, "last_activity_date": 1502592359, "creation_date": 1502592359, "answer_id": 45656607, "question_id": 45655944, "link": "https://stackoverflow.com/questions/45655944/haskell-remembering-previous-element-in-a-list/45656607#45656607", "title": "Haskell: Remembering previous element in a list", "body": "<p>If you understand currying you can simply it even more:</p>\n\n<pre><code>sum' = foldl (+) 0\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4234032"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1124, "favorite_count": 0, "accepted_answer_id": 45656193, "answer_count": 2, "score": 0, "last_activity_date": 1502594134, "creation_date": 1502582320, "last_edit_date": 1502591604, "question_id": 45655944, "link": "https://stackoverflow.com/questions/45655944/haskell-remembering-previous-element-in-a-list", "title": "Haskell: Remembering previous element in a list", "body": "<p>Simple question, unsure how to do it.</p>\n\n<p>I'm writing a more limited version of the sum function from Data.List, and have the following code:</p>\n\n<pre><code>-- Sum the contents of a list\n\nsum' :: Num a =&gt; [a] -&gt; a\n\nsum' [] = 0\n\nsum' (x:xs) = x + sum' rest where\n              rest = drop (succ (elemIndex x xs)) xs \n</code></pre>\n\n<p>I believe this would work if the <em>x</em> argument of elemIndex was in scope of the current list element.</p>\n\n<p>I want to do this without using Foldable, as basic as possible, since it is a problem in Graham Hutton's <em>Programming in Haskell</em> expected to be written before he covers Foldable, or most Haskell ideas.</p>\n"}, {"tags": ["haskell", "record", "encapsulation", "accessor"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1502585423, "post_id": 45655819, "comment_id": 78270490, "body": "No, there isn&#39;t. Note that your latter example is the standard way of achieving this, and still uses records. What you call &#39;roundabout&#39; is actually only two extra lines of code."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 7, "last_activity_date": 1502644605, "last_edit_date": 1502644605, "creation_date": 1502610949, "answer_id": 45658270, "question_id": 45655819, "link": "https://stackoverflow.com/questions/45655819/haskell-export-record-for-read-access-only/45658270#45658270", "title": "Haskell Export Record for Read Access Only", "body": "<p>Hiding the constructor and then defining new accessor functions for each field is a solution, but it can get tedious for records with a large number of fields.</p>\n\n<p>Here's a solution with the new <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/GHC-Records.html#t:HasField\" rel=\"nofollow noreferrer\"><code>HasField</code></a> typeclass in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#record-field-selector-polymorphism\" rel=\"nofollow noreferrer\">GHC 8.2.1</a> that avoids having to define functions for each field.</p>\n\n<p>The idea is to define an auxiliary newtype like this:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE ScopedTypeVariables #-}    \n{-# LANGUAGE PolyKinds #-} -- Important, obscure errors happen without this.\n\nimport GHC.Records (HasField(..))\n\n-- Do NOT export the actual constructor!\nnewtype Moat r = Moat r\n\n-- Export this instead.\nmoat :: r -&gt; Moat r\nmoat = Moat\n\n-- If r has a field, Moat r also has that field\ninstance HasField s r v =&gt; HasField s (Moat r) v where\n    getField (Moat r) = getField @s r\n</code></pre>\n\n<p>Every field in a record <code>r</code> will be accesible from <code>Moat r</code>, with the following syntax:</p>\n\n<pre><code>\u03bb :set -XDataKinds\n\u03bb :set -XTypeApplications\n\u03bb getField @\"getDims\" $ moat (Foo (5,5) ['s'])\n(5,5)\n</code></pre>\n\n<p>The <code>Foo</code> constructor should be hidden from clients. However, the field accessors for <code>Foo</code> should <em>not</em> be hidden; they must be in scope for the <code>HasField</code> instances of <code>Moat</code> to kick in.</p>\n\n<p><em>Every</em> function in your public-facing api should return and receive <code>Moat Foo</code>s instead of <code>Foo</code>s.</p>\n\n<p>To make the accessor syntax slightly less verbose, we can turn to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#overloaded-labels\" rel=\"nofollow noreferrer\"><code>OverloadedLabels</code></a>:</p>\n\n<pre><code>import GHC.OverloadedLabels\n\nnewtype Label r v = Label { field :: r -&gt; v }\n\ninstance HasField l r v =&gt; IsLabel l (Label r v)  where\n    fromLabel = Label (getField @l)\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>\u03bb :set -XOverloadedLabels\n\u03bb field #getDims $ moat (Foo (5,5) ['s'])\n(5,5)\n</code></pre>\n\n<hr>\n\n<p>Instead of hiding the <code>Foo</code> constructor, another option would be to make <code>Foo</code> completely public and define <code>Moat</code> inside your library, hiding any <code>Moat</code> constructors from clients.</p>\n"}], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 2, "accepted_answer_id": 45658270, "answer_count": 1, "score": 9, "last_activity_date": 1502644605, "creation_date": 1502580785, "question_id": 45655819, "link": "https://stackoverflow.com/questions/45655819/haskell-export-record-for-read-access-only", "title": "Haskell Export Record for Read Access Only", "body": "<p>I have a Haskell type that uses record syntax.</p>\n\n<pre><code>data Foo a = Foo { getDims :: (Int, Int), getData :: [a] }\n</code></pre>\n\n<p>I don't want to export the <code>Foo</code> value constructor, so that the user can't construct invalid objects. However, I would like to export <code>getDims</code>, so that the user can get the dimensions of the data structure. If I do this</p>\n\n<pre><code>module Data.ModuleName(Foo(getDims)) where\n</code></pre>\n\n<p>then the user can use <code>getDims</code> to get the dimensions, but the problem is that they can also use record update syntax to update the field.</p>\n\n<pre><code>getDims foo -- This is allowed (as intended)\nfoo { getDims = (999, 999) } -- But this is also allowed (not intended)\n</code></pre>\n\n<p>I would like to prevent the latter, as it would put the data in an invalid state. I realize that I could simply not use records.</p>\n\n<pre><code>data Foo a = Foo { getDims_ :: (Int, Int), getData :: [a] }\n\ngetDims :: Foo a -&gt; (Int, Int)\ngetDims = getDims_\n</code></pre>\n\n<p>But this seems like a rather roundabout way to work around the problem. Is there a way to continue using record syntax while only exporting the record name for read access, not for write access?</p>\n"}, {"tags": ["json", "mongodb", "haskell", "serialization"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502597830, "post_id": 45654455, "comment_id": 78272012, "body": "Where is the <code>Document</code> type coming from?"}, {"owner": {"reputation": 43, "user_id": 4709004, "user_type": "registered", "profile_image": "https://graph.facebook.com/1050152595001840/picture?type=large", "display_name": "Stanislav Iliev", "link": "https://stackoverflow.com/users/4709004/stanislav-iliev"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1502610030, "post_id": 45654455, "comment_id": 78274302, "body": "<code>Document</code> is what a <code>Database.MongoDB.Query</code> returns and it&#39;s definition can be found here: <a href=\"https://hackage.haskell.org/package/bson-0.3.2.3/docs/Data-Bson.html#t:Document\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bson-0.3.2.3/docs/&hellip;</a>"}], "owner": {"reputation": 43, "user_id": 4709004, "user_type": "registered", "profile_image": "https://graph.facebook.com/1050152595001840/picture?type=large", "display_name": "Stanislav Iliev", "link": "https://stackoverflow.com/users/4709004/stanislav-iliev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1502569867, "creation_date": 1502568383, "last_edit_date": 1502569867, "question_id": 45654455, "link": "https://stackoverflow.com/questions/45654455/reading-mongodb-documents-into-haskell-data-types", "title": "Reading MongoDB documents into Haskell data types", "body": "<p>My ultimate goal is to return a JSON response from a scotty endpoint that runs a MongoDB query. So far I've got the query written down, but it returns a Document and I want to turn that Document into a custom type that I've defined.</p>\n\n<p>Here is the code I have so far:</p>\n\n<pre><code>data User = User { username :: String } deriving (Show, Read)\n\ngetUsers :: Pipe -&gt; IO [Document]\ngetUsers pipe = access pipe master \"mydb\" (find (select [] \"users\") &gt;&gt;= rest)\n\nserver :: Pipe -&gt; ScottyM()\nserver pipe =\n    get \"/\" $ do\n        res &lt;- liftIO $ getUsers pipe\n        -- json $ T.pack $ show res\n</code></pre>\n\n<p>The last line is where I get the query result and I'm wondering how can I easily turn the Document data into the User type I have declared at the top. The commented out line is my attempt at some kind of serialization but unfortunately the result is not valid JSON.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1502575229, "post_id": 45654216, "comment_id": 78268779, "body": "The definition of <code>groupBy</code> in the standard library assumes that the given function is an equivalence relation; if that isn&#39;t the case (it isn&#39;t for any of the three functions you&#39;ve used) then <code>groupBy</code> won&#39;t work as the documentation claims (or, if it does, it&#39;s pure coincidence)."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1502567821, "post_id": 45654354, "comment_id": 78266993, "body": "Good close reading of the source, I feel like this helped me think"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1502567668, "creation_date": 1502567668, "answer_id": 45654354, "question_id": 45654216, "link": "https://stackoverflow.com/questions/45654216/haskell-groupby-function-how-exactly-does-it-work/45654354#45654354", "title": "Haskell groupBy function: How exactly does it work?", "body": "<blockquote>\n  <p>But in my second example above it splits the list on every element, but the predicate should evaluate to <code>False</code>.</p>\n</blockquote>\n\n<p>In the second example it <em>also</em> evaluates every two consecutive elements. The function on which it works is <code>const isAlphaNum</code>. So that means that the type is:</p>\n\n<pre><code>const isAlphaNum :: b -&gt; Char -&gt; Bool\n</code></pre>\n\n<p>It thus <em>calls</em> the function with the beginning of the group and the element, but it takes <em>only the second element into account</em>.</p>\n\n<p>So if we call it with: <code>groupBy (const isAlphaNum) \"split this\"</code>, it will evaluate:</p>\n\n<pre><code>succs   2nd    const isAlphaNum\n-------------------------------\n\"sp\"    'p'    True\n\"sl\"    'l'    True\n\"si\"    'i'    True\n\"st\"    't'    True\n\"s \"    ' '    False\n\" t\"    't'    True\n\" h\"    'h'    True\n\" i\"    'i'    True\n\" s\"    's'    True\n</code></pre>\n\n<p>Every time <code>const isAlphaNum</code> is <code>True</code>, it will append the character to the current sequence. So in case we evaluate <code>\"t \"</code>, <code>const isAlphaNum</code>, it will evaluate to <code>False</code>, <code>groupBy</code> will start a new group.</p>\n\n<p>So here we thus construct two groups since there is only one <code>False</code>.</p>\n\n<p>We can also obtain this result if we analyze the function <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/src/Data.OldList.html#groupBy\" rel=\"noreferrer\">source code</a>:</p>\n\n<blockquote>\n<pre><code>groupBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]\ngroupBy _  []     =  []\ngroupBy eq (x:xs) =  (x:ys) : groupBy eq zs\n    where (ys,zs) = span (eq x) xs\n</code></pre>\n</blockquote>\n\n<p>So here <code>groupBy</code> will return the empty list if the given list is empty. In case it is not an empty list <code>(x:xs)</code> then we will construct a new sequence. The sequence starts with <code>x</code>, and contains furthermore all the elements of <code>ys</code>. <code>ys</code> is the first element of the 2-tuple constructed by <code>span</code>.</p>\n\n<p><code>span :: (a -&gt; Bool) -&gt; [a] -&gt; ([a],[a])</code> constructs a 2-tuple where the first element is the longest possible prefix of the list that satisfies the predicate, the predicate here is <code>eq x</code> so we keep adding elements to the group, as long as <code>eq x y</code> (with <code>y</code> an element) holds.</p>\n\n<p>With the remaining part of the list <code>ys</code>, we construct a new group until the input is completely exhausted.</p>\n"}], "owner": {"reputation": 226, "user_id": 7525350, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8684620dc1923d467f336e062c5e90c1?s=128&d=identicon&r=PG&f=1", "display_name": "tillyboy", "link": "https://stackoverflow.com/users/7525350/tillyboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2355, "favorite_count": 2, "accepted_answer_id": 45654354, "answer_count": 1, "score": 5, "last_activity_date": 1502567668, "creation_date": 1502566606, "question_id": 45654216, "link": "https://stackoverflow.com/questions/45654216/haskell-groupby-function-how-exactly-does-it-work", "title": "Haskell groupBy function: How exactly does it work?", "body": "<p>I experienced the following behavior:</p>\n\n<pre><code>ghci :m +Data.List\n\nghci&gt; groupBy (\\x y -&gt; succ x == y) [1..6]\n[[1,2], [3,4], [5,6]]\nghci&gt; groupBy (\\x y -&gt; succ x /= y) [1..6]\n[[1], [2], [3], [4], [5], [6]]\n\nghci :m +Data.Char   -- just a test to verify that nothing is broken with my ghc\n\nghci&gt; groupBy (const isAlphaNum) \"split this\"\n[\"split\",\" this\"]\n</code></pre>\n\n<p>which surprised me, I thought, based on the example down below, that <code>groupBy</code> splits a list whenever the predicate evaluates to <code>True</code> for two successive elements supplied to a predicate. But in my second example above it splits the list on every element, but the predicate should evaluate to <code>False</code>. I framed my assumption of how it works in Haskell as well, just so everybody understands how I believed it to work:</p>\n\n<pre><code>groupBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]\ngroupBy p l@(x:y:ys)\n  | p x y     = (x:y:(head l)) ++ (tail l)       -- assuming l has a tail, unwilling to\n  | otherwise = [x] ++ (y:(head l)) ++ (tail l)  -- to debug this right now, I guess you\ngroupBy _ [x] = [[x]]                            -- already got the hang of it ;)\n</code></pre>\n\n<p>Which brought me to the conclusion, that it works somewhat different. So my question is, how does that function actually work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1502550134, "post_id": 45651550, "comment_id": 78261617, "body": "leading question - what is the type of <code>a</code> and <code>b</code> in <code>concat1 [a] [b] = ...</code>? What is the type of <code>[a]</code>? <code>[b]</code>? <code>[a] ++ [b]</code>?"}, {"owner": {"reputation": 85, "user_id": 7418108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ecaf391443ff1ed669c14e044f53ab2?s=128&d=identicon&r=PG&f=1", "display_name": "Muffy", "link": "https://stackoverflow.com/users/7418108/muffy"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1502550579, "post_id": 45651550, "comment_id": 78261765, "body": "They are both chars in a list, aren&#39;t they?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1502550748, "post_id": 45651550, "comment_id": 78261831, "body": "It&#39;s helpful when getting started to have a mechanism for writing this down, so you can work through errors like this. Just as you wrote that <code>concat1</code> has type <code>[Char] -&gt; [Char] -&gt; [String]</code> using <code>::</code>, write down the type of <code>a</code>, <code>b</code>, <code>[a]</code>, <code>[b]</code>, and <code>[a] ++ [b]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1502559328, "post_id": 45651550, "comment_id": 78264430, "body": "This doesn&#39;t address your misunderstandings at all, but: <code>groupBy ((==) `on` isDigit)</code>. Might be worth trying to reimplement each of those pieces yourself if you&#39;re not sure how that works."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1502550989, "creation_date": 1502550989, "answer_id": 45651802, "question_id": 45651550, "link": "https://stackoverflow.com/questions/45651550/define-concat-function-for-digits/45651802#45651802", "title": "Define concat function for Digits", "body": "<p>The type of <code>concat1</code> is wrong: your example indicates you want <em>one</em> input list and an output list. The input list (ex: <code>['1','5','+','2','4']</code>) is of type <code>[Char]</code> and the output (ex: <code>[\"15\",\"+\",\"24\"]</code>) of type <code>[String]</code>. That gives the signature</p>\n\n<pre><code>concat1 :: [Char] -&gt; [String]\n</code></pre>\n\n<p>For the implementation, you probably want to use <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:span\" rel=\"noreferrer\"><code>span</code></a>, which finds the prefix satisfying a certain predicate function and also returns the remaining elements.</p>\n\n<pre><code>concat1 [] = []\nconcat1 (e : es)\n  | isDigit e = let (d, es') = span isDigit (e : es) in d : concat1 es'\n  | otherwise = [ e ] : concat1 es\n</code></pre>\n\n<p>Then, trying it out at GHCi:</p>\n\n<pre><code>ghci&gt; concat1 ['1','5','+','2','4']\n[\"15\",\"+\",\"24\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1502566681, "last_edit_date": 1502566681, "creation_date": 1502564902, "answer_id": 45653952, "question_id": 45651550, "link": "https://stackoverflow.com/questions/45651550/define-concat-function-for-digits/45653952#45653952", "title": "Define concat function for Digits", "body": "<p>An idea might be to construct a more generic function: a <code>groupWith :: Eq b =&gt; (a -&gt; b) -&gt; [a] -&gt; [(b,[a])]</code> function like the one that is defined in Python's <code>itertools</code>:</p>\n\n<pre><code>groupWith :: Eq b =&gt; (a -&gt; b) -&gt; [a] -&gt; [(b,[a])]\ngroupWith f = steps . map ((,) =&lt;&lt; f)\n    where steps [] = []\n          steps ((b,a):xs) = (b,(a : map snd ys)) : steps zs\n              where (ys,zs) = span ((b == ) . fst) xs\n</code></pre>\n\n<p>Given a function <code>f :: a -&gt; b</code> and a list <code>xs</code>, it will construct groups <code>[(b,[a])]</code> such that every group represents the longest possible sequence of <code>xs</code> where <code>f x</code> is the same. So for <code>groupWith isDigit \"15+24\"</code>, we get:</p>\n\n<pre><code>*Main Data.Char&gt; groupWith isDigit ['1','5','+','2','4']\n[(True,\"15\"),(False,\"+\"),(True,\"24\")]\n</code></pre>\n\n<p>Now we can simply obtain the second element <code>snd</code> of every tuple, so:</p>\n\n<pre><code>*Main Data.Char&gt; map snd $ groupWith isDigit ['1','5','+','2','4']\n[\"15\",\"+\",\"24\"]\n</code></pre>\n\n<p>We can easily reuse this piece of code if we for instance wish to discriminate based on more conditions.</p>\n"}, {"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 0, "last_activity_date": 1502587686, "creation_date": 1502587686, "answer_id": 45656308, "question_id": 45651550, "link": "https://stackoverflow.com/questions/45651550/define-concat-function-for-digits/45656308#45656308", "title": "Define concat function for Digits", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:groupBy\" rel=\"nofollow noreferrer\"><code>groupBy</code></a> in order to group together adjacent elements in a list over some equivalence function. You can use is like this:</p>\n\n<pre><code>import Data.List (groupBy)\nimport Data.Function (on)\nimport Data.Char (isDigit)\n\ngroupDigits :: String -&gt; [String]\ngroupDigits = groupBy ((&amp;&amp;) `on` isDigit)\n</code></pre>\n\n<hr>\n\n<pre><code>Prelude Data.List Data.Function Data.Char&gt; groupDigits ['1','5','+','2','4']\n[\"15\",\"+\",\"24\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1502625791, "creation_date": 1502625791, "answer_id": 45660121, "question_id": 45651550, "link": "https://stackoverflow.com/questions/45651550/define-concat-function-for-digits/45660121#45660121", "title": "Define concat function for Digits", "body": "<p>I guess as @4castle mentioned <code>groupBy</code> is the ideal tool for this job however my approach would be slightly different.</p>\n\n<pre><code>import Data.List (groupBy)\nimport Data.Function (on)\n\ngroupDigits :: String -&gt; [String]\ngroupDigits = groupBy ((==) `on` ((&amp;&amp;) &lt;$&gt; (&gt;'/') &lt;*&gt; (&lt;':')))\n\n*Main&gt; groupDigits ['1','5','+','2','4'] \n[\"15\",\"+\",\"24\"]\n*Main&gt; groupDigits ['1','5','+','+','2','4'] \n[\"15\",\"++\",\"24\"]\n</code></pre>\n\n<p>The difference is instead of using <code>(&amp;&amp;)</code> operator i use an XNOR (which is simply <code>(==)</code> in Haskell).</p>\n\n<p>And also my implementation of <code>isDigit :: Char -&gt; Bool</code> is a little different than it is in <code>Data.Char</code>.</p>\n"}], "owner": {"reputation": 85, "user_id": 7418108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ecaf391443ff1ed669c14e044f53ab2?s=128&d=identicon&r=PG&f=1", "display_name": "Muffy", "link": "https://stackoverflow.com/users/7418108/muffy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 45651802, "answer_count": 4, "score": 2, "last_activity_date": 1502625791, "creation_date": 1502549439, "last_edit_date": 1502549487, "question_id": 45651550, "link": "https://stackoverflow.com/questions/45651550/define-concat-function-for-digits", "title": "Define concat function for Digits", "body": "<p>I have a list chars and I would like to concat all characters, which are digits and which are next to each other</p>\n\n<p>For example: <code>['1','5','+','2','4'] =&gt; [\"15\",\"+\",\"24\"]</code></p>\n\n<pre><code>concat1 :: [Char] -&gt; [Char] -&gt; [String]\nconcat1 [] [] = []\nconcat1 [a] [b]\n    | (isDigit a) &amp;&amp; (isDigit b) = [a] ++ [b]\n</code></pre>\n\n<p>I tried to write this code, but it doesn't seem to be right approach and debugger tells me this:</p>\n\n<pre><code>Couldn't match type `Char' with `[Char]'\n      Expected type: [String]\n        Actual type: [Char]\n    * In the expression: [a] ++ [b]\n      In an equation for `concat1':\n          concat1 [a] [b] | (isDigit a) &amp;&amp; (isDigit b) = [a] ++ [b]\n</code></pre>\n"}, {"tags": ["haskell", "compilation", "nix", "ghcjs", "haskell-miso"], "answers": [{"tags": [], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "is_accepted": true, "score": 9, "last_activity_date": 1502549730, "last_edit_date": 1502549730, "creation_date": 1502548165, "answer_id": 45651372, "question_id": 45651371, "link": "https://stackoverflow.com/questions/45651371/faster-compilation-for-haskell-miso/45651372#45651372", "title": "Faster compilation for Haskell Miso", "body": "<p>(Credit goes to <a href=\"https://github.com/NickSeagull\" rel=\"noreferrer\">NickSeagull</a>)</p>\n\n<p>For faster edit-compile-run cycle it is recommended to use <code>GHCJSi</code> as follows.</p>\n\n<p>First, enter the Nix configured shell environment:</p>\n\n<pre><code>nix-shell -A env\n</code></pre>\n\n<p>Then, enter the GHCJSi shell:</p>\n\n<pre><code>cabal configure --ghcjs\ncabal repl\n</code></pre>\n\n<p>GHCJSi starts up a web server. You should immediately connect to it from the web browser via <a href=\"http://localhost:6400/\" rel=\"noreferrer\">http://localhost:6400/</a></p>\n\n<p>From the GHCJSi shell--and everytime <code>Main.hs</code> changes--recompile and send the new code to the browser:</p>\n\n<pre><code>&gt; import Miso.Dev  # Once\n&gt; :r\n&gt; clearBody &gt;&gt; main\n</code></pre>\n\n<p>The UI in the web browser will now update automatically with the new code. Happy hacking!</p>\n\n<p><a href=\"https://github.com/srid/miso-viso#development\" rel=\"noreferrer\">Example project</a></p>\n"}], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 4, "accepted_answer_id": 45651372, "answer_count": 1, "score": 7, "last_activity_date": 1502549730, "creation_date": 1502548165, "last_edit_date": 1502549060, "question_id": 45651371, "link": "https://stackoverflow.com/questions/45651371/faster-compilation-for-haskell-miso", "title": "Faster compilation for Haskell Miso", "body": "<p>I use the Haskell Miso framework to write frontend web apps and <a href=\"https://github.com/haskell-miso/miso#nix\" rel=\"noreferrer\">the Nix compilation process</a> takes a long time. </p>\n\n<p>How can I speed it up? </p>\n\n<p>Or what is the recommended approach to have a near instantaneous edit-compile-run cycle?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1502547196, "post_id": 45651137, "comment_id": 78260763, "body": "You can use <code>concat (repeat [(+), (-)])</code>. Don&#39;t <code>fmap repeat</code>, that would get you multiple infinite lists that you would have to merge."}, {"owner": {"reputation": 293, "user_id": 6675961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46f11b114fe506c0a7b305e730a02a64?s=128&d=identicon&r=PG&f=1", "display_name": "northlane", "link": "https://stackoverflow.com/users/6675961/northlane"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1502548072, "post_id": 45651137, "comment_id": 78261019, "body": "Thanks. I was thinking I could apply repeat to the contents of the list to avoid the nesting, but I realize why that wouldn&#39;t work."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 13, "last_activity_date": 1502546698, "creation_date": 1502546698, "answer_id": 45651151, "question_id": 45651137, "link": "https://stackoverflow.com/questions/45651137/how-to-repeat-a-list-of-functions-in-haskell/45651151#45651151", "title": "How to repeat a list of functions in haskell", "body": "<p>What you are looking for is <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:cycle\" rel=\"noreferrer\"><strong><code>cycle :: [a] -&gt; [a]</code></strong></a>:</p>\n\n<pre><code><b>cycle</b> [(+),(-)]</code></pre>\n\n<p>The type of this expression is:</p>\n\n<pre><code>Prelude&gt; :t cycle [(+),(-)]\ncycle [(+),(-)] :: Num a =&gt; [a -&gt; a -&gt; a]\n</code></pre>\n\n<p><code>cycle</code> takes a list <code>[a]</code> and produces a list where the given list is repeated over and over again. So <code>cycle [1,2,3]</code> produces <code>[1,2,3,1,2,3,1,2,3,1,...]</code></p>\n"}], "owner": {"reputation": 293, "user_id": 6675961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46f11b114fe506c0a7b305e730a02a64?s=128&d=identicon&r=PG&f=1", "display_name": "northlane", "link": "https://stackoverflow.com/users/6675961/northlane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 45651151, "answer_count": 1, "score": 5, "last_activity_date": 1502546854, "creation_date": 1502546608, "last_edit_date": 1502546854, "question_id": 45651137, "link": "https://stackoverflow.com/questions/45651137/how-to-repeat-a-list-of-functions-in-haskell", "title": "How to repeat a list of functions in haskell", "body": "<p>I want to have an infinite list of functions that cycles through some pattern. For example: <code>[(+), (-), (+), (-), ...]</code></p>\n\n<p>If I do something like </p>\n\n<pre><code>fmap repeat [(+), (-)]\n</code></pre>\n\n<p>then I get nested lists <code>[[a -&gt; a -&gt; a]]</code>. What's the best way to get a single infinite list of functions following a pattern like this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1502546547, "post_id": 45651043, "comment_id": 78260577, "body": "The easiest way is probably <code>listToTree xs = foldl (\\acc x -&gt; insert x acc) Empty $ reverse xs</code>."}], "answers": [{"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": true, "score": 2, "last_activity_date": 1502560526, "creation_date": 1502560526, "answer_id": 45653266, "question_id": 45651043, "link": "https://stackoverflow.com/questions/45651043/reverse-order-bst-insertion/45653266#45653266", "title": "Reverse order BST Insertion", "body": "<p>The obvious thing to do is to <code>reverse</code> the list before feeding it to <code>foldl</code>.  The same effect can be achieved by using <code>foldr</code>.</p>\n\n<p>If you are asking how to modify the <code>insert</code> instruction itself, what you want is the last node inserted to be the root and whatever was there already to move down the tree. so:</p>\n\n<pre><code>insert x (Node y l r)  -- Note: x is the new value and y the existing root.\n    | y == x = Node y l r -- Don't insert a dup (per original)\n    | y &gt; x = Node x l (insert y r) -- make x the new root and y goes in the left tree\n    | y &lt; x = Node x (insert y l) r  -- make x the new root and y goes in the right tree\n</code></pre>\n"}], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 45653266, "answer_count": 1, "score": 0, "last_activity_date": 1502560526, "creation_date": 1502545832, "question_id": 45651043, "link": "https://stackoverflow.com/questions/45651043/reverse-order-bst-insertion", "title": "Reverse order BST Insertion", "body": "<p>I was wondering if their is a way to insert list items in a BST from right to left. So far I can insert items from left to right.</p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>-- Type constructor\ndata Tree a = Empty | Node a (Tree a) (Tree a)\n   deriving (Eq, Show)\n\n-- inserts into BST\ninsert :: (Ord a) =&gt; a -&gt; Tree a -&gt; Tree a\ninsert x Empty = Node x Empty Empty\ninsert x (Node y l r)\n    | y == x = Node y l r\n    | y &lt; x = Node y l (insert x r)\n    | y &gt; x = Node y (insert x l) r\n\n-- Converts list to a BST\nlistToTree :: (Ord a) =&gt; [a] -&gt; Tree a\nlistToTree xs = foldl (\\acc x -&gt; insert x acc) Empty xs\n</code></pre>\n\n<p>What I'm currently achieving:</p>\n\n<pre><code>Prelude&gt; listToTree [4,2,6]\nNode 4 (Node 2 Empty Empty) (Node 6 Empty Empty)\n</code></pre>\n\n<p>But I wish the reverse order:</p>\n\n<pre><code>Node 6 (Node 2 Empty (Node 4 Empty Empty)) Empty\n</code></pre>\n\n<p>I'm not really sure how I can modify <code>foldl</code> to do this. Would a recursive approach be better for this sort of task? Any sort of help would be appreciated. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1502539705, "post_id": 45649581, "comment_id": 78258565, "body": "After <code>main</code> completes, your program exits."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1502546760, "post_id": 45649581, "comment_id": 78260655, "body": "Yes, but the binding to motionFile persists, so I can invoke the other functions using it as a parameter.  I&#39;m trying to make that possible for the other constants I have."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1502547082, "post_id": 45649581, "comment_id": 78260737, "body": "Are you doing this from the interactive interpreter? Otherwise, it doesn&#39;t make sense to say you are using other functions after <code>main</code> completes. There is no program running at that point from which you <i>can</i> call functions."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1502548372, "post_id": 45649581, "comment_id": 78261105, "body": "Yes, I mentioned that in the title, but not the body of the OP, I will add that note."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1502548535, "post_id": 45649581, "comment_id": 78261165, "body": "You don&#39;t really need a <code>main</code> definition in GHCi; <code>main</code> is just the required entry point for a standalone-executable. Otherwise, it is no different than any other name you define during a session."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1502548888, "post_id": 45649581, "comment_id": 78261258, "body": "Once I have this working correctly, the executable will be used under normal circumstances.  I&#39;m using GCHI to develop the transformations and want to be able to have the variables available to facilitate further inquiry over what is happening with the data."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502591608, "post_id": 45649581, "comment_id": 78271274, "body": "I&#39;m a bit confused. I would expect <code>mP</code> and friends to be in scope if you just typed the lines after <code>main = do</code> into ghci. Is that not what you are seeing? Can you post an exact <code>ghci</code> session, along with the exact error it gives you?"}], "answers": [{"comments": [{"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 0, "creation_date": 1502547528, "post_id": 45649649, "comment_id": 78260852, "body": "Being new to Haskell, could you please explain what you mean?"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1502536882, "creation_date": 1502536882, "answer_id": 45649649, "question_id": 45649581, "link": "https://stackoverflow.com/questions/45649581/ghci-how-to-make-let-assignments-visible-outside-of-main-do/45649649#45649649", "title": "GHCi: How to make let assignments visible outside of main do", "body": "<p>Pass them as additional arguments to your other functions.</p>\n"}, {"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1502543333, "post_id": 45650266, "comment_id": 78259667, "body": "This won&#39;t work currently, because <code>mP</code> is now a function instead of a list, so the definition of <code>mPT</code> won&#39;t type check."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1502544795, "post_id": 45650266, "comment_id": 78260082, "body": "Yes, and then a similar change would be made to <code>mA</code> because of how it uses <code>mPT</code>."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 0, "creation_date": 1502546895, "post_id": 45650266, "comment_id": 78260687, "body": "I have the main :: IO () declaration, just didn&#39;t include it in the code I pasted.  My plan was to expand the function/variable names once I got it to work."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1502548267, "post_id": 45650266, "comment_id": 78261075, "body": "Syntactically,  <code>mP file = toListListDbl $ toListListStr $ dropXFromStrA 4 (lines file) mPT = transpose . mP mA = actuatorCurves nJ . mPT</code>  works as @4castle pointed out.  THNX However it doesn&#39;t quite work.  GCHI is complaining I don&#39;t have an instance for Show."}], "tags": [], "owner": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "is_accepted": false, "score": 1, "last_activity_date": 1502541261, "last_edit_date": 1502541261, "creation_date": 1502540881, "answer_id": 45650266, "question_id": 45649581, "link": "https://stackoverflow.com/questions/45649581/ghci-how-to-make-let-assignments-visible-outside-of-main-do/45650266#45650266", "title": "GHCi: How to make let assignments visible outside of main do", "body": "<p>Just move the let assignments out of your main function and define them as separate functions at top level like so</p>\n\n<pre><code>mP file = toListListDbl $ toListListStr $ dropXFromStrA 4 (lines file)\nmPT = transpose $ mP\nmA = actuatorCurves nJ mPT\n\nmain = do  \n    motionFile &lt;- readFile \"transitions.mot\"\n    putStrLn $ mA motionFile\n</code></pre>\n\n<p>I would highly recommend you to provide type declarations like</p>\n\n<pre><code>main :: IO ()\nmain = do ...\n</code></pre>\n\n<p>and use proper function names instead of 2-3 char abbreviations.</p>\n"}], "owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1502561248, "creation_date": 1502536401, "last_edit_date": 1502561248, "question_id": 45649581, "link": "https://stackoverflow.com/questions/45649581/ghci-how-to-make-let-assignments-visible-outside-of-main-do", "title": "GHCi: How to make let assignments visible outside of main do", "body": "<p>I'm a noob with Haskell and I don't know how to do the following:<br>\n  Using GHCi, in my main function, I make progressive assignments to constants.  The main purpose of this is to be able to continue analysing their contents after main has completed.  However, other than <code>motionFile</code>, which is using a bind, none of my other constants are visible.</p>\n\n<pre><code>main = do  \n    motionFile &lt;- readFile \"transitions.mot\"\n    let mP = toListListDbl $ toListListStr $ dropXFromStrA 4 (lines motionFile)\n    let mPT = transpose $ mP\n    let mA = actuatorCurves nJ mPT\n    putStrLn mA\n</code></pre>\n\n<p>After main completes, I would like to have each of the <code>mP</code>, <code>mPT</code>, and <code>mA</code> available to be inputs for other functions.  </p>\n\n<p>Is there a way to do this?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1502532662, "post_id": 45649001, "comment_id": 78256659, "body": "To throw <code>123</code>, you need <code>e</code> to be Num. What do you need in order to throw <code>&quot;abc&quot;</code>?"}, {"owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1502532962, "post_id": 45649001, "comment_id": 78256743, "body": "I have a <code>ExceptT String m</code>, i.e error which has representation of <code>String</code>, so I need to throw a <code>String</code>. If I write down the signature using explicit types like: <code>ExceptT String (StateT L.ByteString Identity) ()</code> then the compilation is success. But I want a bit polymorphism here. It is possible?"}], "answers": [{"comments": [{"owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 0, "creation_date": 1502537157, "post_id": 45649665, "comment_id": 78257896, "body": "I got this error:     \u2022 Non type-variable argument in the constraint: MonadError String m       (Use FlexibleContexts to permit this)     \u2022 In the type signature:         sTest :: (MonadState s m, MonadError String m) =&gt; m ()"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 0, "creation_date": 1502537217, "post_id": 45649665, "comment_id": 78257918, "body": "Yes, this requires the <code>FlexibleContexts</code> extension, which is benign."}, {"owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 0, "creation_date": 1502537708, "post_id": 45649665, "comment_id": 78258049, "body": "Yah, ^^. But if I want to persist the genericness of e, what else should I do?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 0, "creation_date": 1502537870, "post_id": 45649665, "comment_id": 78258101, "body": "Perhaps you want <code>e</code> to be a sum type with one constructor for strings? Then you could use a type class such as <code>IsString</code> with a <code>fromString :: String -&gt; e</code> method. <code>throwError (fromString &quot;abc&quot;) :: (MonadError e m, IsString e) =&gt; m a</code>."}, {"owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 0, "creation_date": 1502538638, "post_id": 45649665, "comment_id": 78258308, "body": "I updated the question, I did something like you said. Can you take a look?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 0, "creation_date": 1502539352, "post_id": 45649665, "comment_id": 78258495, "body": "<code>throwError $ OtherError &quot;abc&quot;</code> should be <code>throwError $ strMsg &quot;abc&quot;</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 2, "creation_date": 1502539607, "post_id": 45649665, "comment_id": 78258541, "body": "@V\u0169T&#244; If <code>e</code> is completely generic, you cannot generate a value for it, because you have <i>no</i> idea what type the caller will request; the best you could do is take the error value as an argument, and throw that. (For example, <code>sTest :: (MonadState s m, MonadError e m) =&gt; e -&gt; m (); stest eValue = do { s &lt;- get; throwError eValue; put s; }</code>"}, {"owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "edited": false, "score": 0, "creation_date": 1502539697, "post_id": 45649665, "comment_id": 78258561, "body": "Aha, I&#39;ve got the idea. It can&#39;t be specific in the body of the function, because I&#39;m using the genericness in the signature. Thanks both of you, dudes :)"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1502536984, "creation_date": 1502536984, "answer_id": 45649665, "question_id": 45649001, "link": "https://stackoverflow.com/questions/45649001/typeclass-deduction-error-when-using-type-constraints/45649665#45649665", "title": "Typeclass deduction error when using type constraints", "body": "<pre><code>throwError :: MonadError e m =&gt; e -&gt; m a\n</code></pre>\n\n<p>Here <code>throwError \"abc\"</code> makes <code>e</code> equal to <code>String</code>, so you need <code>MonadError String m</code>.</p>\n\n<pre><code>sTest :: (MonadState s m, MonadError String m) =&gt; m ()\n</code></pre>\n"}], "owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1502538564, "creation_date": 1502532298, "last_edit_date": 1502538564, "question_id": 45649001, "link": "https://stackoverflow.com/questions/45649001/typeclass-deduction-error-when-using-type-constraints", "title": "Typeclass deduction error when using type constraints", "body": "<p>I have this function:</p>\n\n<pre><code>sTest :: (MonadState s m, MonadError e m) =&gt; m ()\nsTest = do\n  s &lt;- get\n  throwError \"abc\"\n  put s\n</code></pre>\n\n<p>When compiling, I got a typeclass deduction error:</p>\n\n<pre><code>\u2022 Could not deduce (MonadError [Char] m)\n    arising from a use of \u2018throwError\u2019\n  from the context: (MonadState s m, MonadError e m)\n    bound by the type signature for:\n               sTest :: (MonadState s m, MonadError e m) =&gt; m ()\n    at ...\n\u2022 In a stmt of a 'do' block: throwError \"abc\"\n  In the expression:\n    do { s &lt;- get;\n         throwError \"abc\";\n         put s }\n  In an equation for \u2018sTest\u2019:\n      sTest\n        = do { s &lt;- get;\n               throwError \"abc\";\n               put s }\n</code></pre>\n\n<p>If I change the <code>throwError</code> to throw an <code>Int</code> instead (and add a <code>Num</code> constraint) then the compilation is success:</p>\n\n<pre><code>sTest :: (Num e, MonadState s m, MonadError e m) =&gt; m ()\nsTest = do\n  s &lt;- get\n  throwError 123\n  put s\n</code></pre>\n\n<p>Can anyone explain me about this?</p>\n\n<p><strong>Update #1</strong></p>\n\n<p>I create a new type for the errors:</p>\n\n<pre><code>data EvalError = VarNotFound\n  | PlusParamsMustBeIntVal\n  | FirstAppParamMustBeFunVal\n  | OtherError String\n  deriving (Show)\n\ninstance Error EvalError where\n  strMsg = OtherError\n\nsTest :: (Error e, MonadState s m, MonadError e m) =&gt; m ()\nsTest = do\n  s &lt;- get\n  throwError $ OtherError \"abc\"\n  put s\n</code></pre>\n\n<p>But the compilation is still not success:</p>\n\n<pre><code>\u2022 Could not deduce (MonadError EvalError m)\n    arising from a use of \u2018throwError\u2019\n  from the context: (Error e, MonadState s m, MonadError e m)\n    bound by the type signature for:\n               sTest :: (Error e, MonadState s m, MonadError e m) =&gt; m ()\n    at ...\n\u2022 In a stmt of a 'do' block: throwError $ OtherError \"abc\"\n  In the expression:\n    do { s &lt;- get;\n         throwError $ OtherError \"abc\";\n         put s }\n  In an equation for \u2018sTest\u2019:\n      sTest\n        = do { s &lt;- get;\n               throwError $ OtherError \"abc\";\n               put s }\n</code></pre>\n"}, {"tags": ["haskell", "haskell-backpack"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 0, "last_activity_date": 1552217502, "last_edit_date": 1552217502, "creation_date": 1502623108, "answer_id": 45659777, "question_id": 45648088, "link": "https://stackoverflow.com/questions/45648088/how-to-avoid-the-need-of-an-auxiliary-newtype-when-matching-this-backpack-signat/45659777#45659777", "title": "How to avoid the need of an auxiliary newtype when matching this Backpack signature?", "body": "<p>It seems that there isn't a way to avoid the newtype. The Backpack <a href=\"https://github.com/ezyang/thesis/releases/tag/final\" rel=\"nofollow noreferrer\">thesis</a> clearly states that type synonyms are required to be nullary (section 6.2.4 \"Subtyping rules\"):</p>\n\n<blockquote>\n  <p>the implementing type synonyms are required to be nullary: for\n  example, type <code>M a = a</code> is not a valid implementation of the abstract\n  data <code>M a</code>, but <code>type M = Maybe :: * -&gt; *</code> is. This restriction stems\n  from an old design decision in Haskell to not support type level\n  lambdas. This restriction greatly helps type inference, since given\n  the type equality <code>t a = s b</code>, we can now conclude that <code>t = s</code> and <code>a = b</code>\n  (this property is called generativity).</p>\n</blockquote>\n\n<p>Also related, in section B.2 \"Challenges\":</p>\n\n<blockquote>\n  <p>Translucency: A feature not supported in Backpack\u201914 but supported in\n  Backpack\u201917 is the ability to use a type synonym to implement an\n  abstract data type. This introduces a form of \u201ctranslucency\u201d, where\n  the abstract data type is opaque while the implementation is unknown,\n  and transparent afterwards. For example, in Section 2.3, we\n  demonstrated how we could instantiate a generic regular expression\n  matcher to match on strings. Inside the implementation of the matcher,\n  we knew nothing about the abstract type <code>Str</code>; after instantiating it,\n  the accept function transparently accepts <code>String</code> arguments.</p>\n</blockquote>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 45659777, "answer_count": 1, "score": 2, "last_activity_date": 1552217502, "creation_date": 1502525846, "question_id": 45648088, "link": "https://stackoverflow.com/questions/45648088/how-to-avoid-the-need-of-an-auxiliary-newtype-when-matching-this-backpack-signat", "title": "How to avoid the need of an auxiliary newtype when matching this Backpack signature?", "body": "<p>I'm using the new Backpack module system along with Cabal 2. I have the follwing signature:</p>\n\n<pre><code>{-# LANGUAGE KindSignatures #-}\nsignature Streamy where\n\nimport Control.Monad\nimport Control.Monad.Trans.Class\nimport Control.Monad.IO.Class\n\ndata Stream :: * -&gt; (* -&gt; *) -&gt; * -&gt; *\n\ninstance Monad m =&gt; Functor (Stream o m)\ninstance Monad m =&gt; Applicative (Stream o m)\ninstance Monad m =&gt; Monad (Stream o m)\ninstance MonadIO m =&gt; MonadIO (Stream o m) \ninstance MonadTrans (Stream o)\n</code></pre>\n\n<p>I'm trying to match it with the concrete <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.5/docs/Streaming-Prelude.html#t:Stream\" rel=\"nofollow noreferrer\"><code>Stream</code></a> type from <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.5\" rel=\"nofollow noreferrer\">streaming</a>, like this:</p>\n\n<pre><code>import Streaming (Of(..))\nimport qualified Streaming as Q\n\ntype Stream o m r = Q.Stream (Of o) m r\n</code></pre>\n\n<p>However, this gives me the error</p>\n\n<blockquote>\n  <p>Illegal parameterized type synonym in implementation of abstract data.\n  (Try eta reducing your type synonym so that it is nullary)</p>\n</blockquote>\n\n<p>It seems that the type synonym can't have parameters. I need at least one  however, because the <code>o</code> is sitting inside the <code>Of</code> instead of being a direct parameter of <code>Q.Stream</code>.</p>\n\n<p>I can solve the problem by defining an adapter newtype:</p>\n\n<pre><code>{-# language GeneralizedNewtypeDeriving #-}\nnewtype S o m r = S { unS :: Q.Stream (Of o) m r } \n        deriving (Functor,Applicative,Monad,MonadIO,MonadTrans)\n\ntype Stream = S\n</code></pre>\n\n<p>Is there another way that doesn't require defining the newtype?</p>\n"}, {"tags": ["haskell", "category-theory", "free-monad", "alternative-functor", "abstract-algebra"], "answers": [{"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 2, "creation_date": 1502659909, "post_id": 45656620, "comment_id": 78287808, "body": "It&#39;s pretty neat how &quot;mechanical&quot; this is; it makes it straightforward to enforce arbitrary laws according to typeclass laws and generate a free structure for...everything.  I&#39;ve figured out one my own actually I think, that isn&#39;t mechanical and is instead more natural in that it doesn&#39;t use any type level predicates and existential types, but this answer is pretty nice for its &quot;no cleverness required&quot; kinda feel in translating arbitrary laws to the free structures."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 6, "last_activity_date": 1502592509, "creation_date": 1502592509, "answer_id": 45656620, "question_id": 45647253, "link": "https://stackoverflow.com/questions/45647253/structurally-enforced-free-alternative-without-left-distributivity/45656620#45656620", "title": "Structurally enforced Free Alternative, without left distributivity", "body": "<p><code>Control.Alternative.Free</code>'s <code>Alt f</code> produces a left-distributive <code>Alternative</code> for free, even if <code>f</code> isn't <code>Alternative</code> or <code>f</code> is a non-left-distributive <code>Alternative</code>. We can say that, in addition to the well-agreed upon alternative laws</p>\n\n<pre><code>empty &lt;|&gt; x = x\nx &lt;|&gt; empty = x\n(x &lt;|&gt; y) &lt;|&gt; z = x &lt;|&gt; (y &lt;|&gt; z)\nempty &lt;*&gt; f = empty\n</code></pre>\n\n<p><code>Alt f</code> also gives left-distribution for free.</p>\n\n<pre><code>(a &lt;|&gt; b) &lt;*&gt; c = (a &lt;*&gt; c) &lt;|&gt; (b &lt;*&gt; c)\n</code></pre>\n\n<p>Because <code>Alt f</code> is always left distributive (and <code>runAlt . liftAlt = id</code>) <code>liftAlt</code> can never be a homomorphism for non-left-distributive <code>Alternative</code>s. If an <code>Alternative f</code> is not left-distributive, then there exist <code>a</code>, <code>b</code>, and <code>c</code> such that</p>\n\n<pre><code>(a &lt;|&gt; b) &lt;*&gt; c != (a &lt;*&gt; c) &lt;|&gt; (b &lt;*&gt; c)\n</code></pre>\n\n<p>If <code>liftAlt : f -&gt; Alt f</code> were a homomorphism then</p>\n\n<pre><code>                  (a &lt;|&gt; b) &lt;*&gt; c  !=                   (a &lt;*&gt; c) &lt;|&gt; (b &lt;*&gt; c)                                       -- f is not left-distributive\nid               ((a &lt;|&gt; b) &lt;*&gt; c) != id               ((a &lt;*&gt; c) &lt;|&gt; (b &lt;*&gt; c))\nrunAlt . liftAlt ((a &lt;|&gt; b) &lt;*&gt; c) != runAlt . liftAlt ((a &lt;*&gt; c) &lt;|&gt; (b &lt;*&gt; c))                                      -- runAlt . liftAlt = id\nrunAlt ((liftAlt a &lt;|&gt; liftAlt b) &lt;*&gt; liftAlt c) != runAlt ((liftAlt a &lt;*&gt; liftAlt c) &lt;|&gt; (liftAlt b &lt;*&gt; liftAlt c))  -- homomorphism\nrunAlt ((liftAlt a &lt;|&gt; liftAlt b) &lt;*&gt; liftAlt c) != runAlt ((liftAlt a &lt;|&gt; liftAlt b) &lt;*&gt; liftAlt c)                  -- by left-distribution of `Alt`, this is a contradiction\n</code></pre>\n\n<p>To demonstrate this we need an <code>Alternative</code> that isn't left-distributive. Here's one, <code>FlipAp []</code>.</p>\n\n<pre><code>newtype FlipAp f a = FlipAp {unFlipAp :: f a}\n  deriving Show\n\ninstance Functor f =&gt; Functor (FlipAp f) where\n    fmap f (FlipAp x) = FlipAp (fmap f x)\n\ninstance Applicative f =&gt; Applicative (FlipAp f) where\n    pure = FlipAp . pure\n    (FlipAp f) &lt;*&gt; (FlipAp xs) = FlipAp ((flip ($) &lt;$&gt; xs) &lt;*&gt; f)\n\ninstance Alternative f =&gt; Alternative (FlipAp f) where\n    empty = FlipAp empty\n    (FlipAp a) &lt;|&gt; (FlipAp b) = FlipAp (a &lt;|&gt; b)\n</code></pre>\n\n<p>Along with some laws for left distribution and right distribution, and some examples</p>\n\n<pre><code>leftDist :: Alternative f =&gt; f (x -&gt; y) -&gt; f (x -&gt; y) -&gt; f x -&gt; Example (f y)\nleftDist a b c = [(a &lt;|&gt; b) &lt;*&gt; c, (a &lt;*&gt; c) &lt;|&gt; (b &lt;*&gt; c)]\n\nrightDist :: Alternative f =&gt; f (x -&gt; y) -&gt; f x -&gt; f x -&gt; Example (f y)\nrightDist a b c = [a &lt;*&gt; (b &lt;|&gt; c), (a &lt;*&gt; b) &lt;|&gt; (a &lt;*&gt; c)]\n\ntype Example a = [a]\n\nldExample1 :: Alternative f =&gt; Example (f Int)\nldExample1 = leftDist (pure (+1)) (pure (*10)) (pure 2 &lt;|&gt; pure 3)\n\nrdExample1 :: Alternative f =&gt; Example (f Int)\nrdExample1 = rightDist (pure (+1) &lt;|&gt; pure (*10)) (pure 2) (pure 3)\n</code></pre>\n\n<p>We can demonstrate a few properties of lists, <code>FlipAp</code> lists, and <code>runAlt</code>.</p>\n\n<p>Lists are left-distributive, but <code>FlipAp</code> lists aren't</p>\n\n<pre><code>ldExample1 :: Example [Int]\nldExample1 :: Example (FlipAp [] Int)\n\n[[3,4,20,30],[3,4,20,30]]\n[FlipAp {unFlipAp = [3,20,4,30]},FlipAp {unFlipAp = [3,4,20,30]}]\n</code></pre>\n\n<p>Lists aren't right-distributive, but <code>FlipAp</code> lists are</p>\n\n<pre><code>rdExample1 :: Example [Int]\nrdExample1 :: Example (FlipAp [] Int)\n\n[[3,4,20,30],[3,20,4,30]]\n[FlipAp {unFlipAp = [3,20,4,30]},FlipAp {unFlipAp = [3,20,4,30]}]\n</code></pre>\n\n<p><code>Alt</code> is always left-distributive</p>\n\n<pre><code>map (runAlt id) ldExample1 :: Example [Int]\nmap (runAlt id) ldExample1 :: Example (FlipAp [] Int)\n\n[[3,4,20,30],[3,4,20,30]]\n[FlipAp {unFlipAp = [3,4,20,30]},FlipAp {unFlipAp = [3,4,20,30]}]\n</code></pre>\n\n<p><code>Alt</code> is never right-distributive</p>\n\n<pre><code>map (runAlt id) rdExample1 :: Example [Int]\nmap (runAlt id) rdExample1 :: Example (FlipAp [] Int)\n\n[[3,4,20,30],[3,20,4,30]]\n[FlipAp {unFlipAp = [3,4,20,30]},FlipAp {unFlipAp = [3,20,4,30]}]\n</code></pre>\n\n<p>We can defile a right-distributive free alternative in terms of <code>FlipAp</code> and <code>Alt</code>.</p>\n\n<pre><code>runFlipAlt :: forall f g a. Alternative g =&gt; (forall x. f x -&gt; g x) -&gt; FlipAp (Alt f) a -&gt; g a\nrunFlipAlt nt = runAlt nt . unFlipAp\n</code></pre>\n\n<p><code>FlipAp</code> <code>Alt</code> is never left-distributive.</p>\n\n<pre><code>map (runFlipAlt id) ldExample1 :: Example [Int]\nmap (runFlipAlt id) ldExample1 :: Example (FlipAp [] Int)\n\n[[3,20,4,30],[3,4,20,30]]\n[FlipAp {unFlipAp = [3,20,4,30]},FlipAp {unFlipAp = [3,4,20,30]}]\n</code></pre>\n\n<p><code>FlipAp</code> <code>Alt</code> is always right-distributive</p>\n\n<pre><code>map (runFlipAlt id) rdExample1 :: Example [Int]\nmap (runFlipAlt id) rdExample1 :: Example (FlipAp [] Int)\n\n[[3,20,4,30],[3,20,4,30]]\n[FlipAp {unFlipAp = [3,20,4,30]},FlipAp {unFlipAp = [3,20,4,30]}]\n</code></pre>\n\n<p>Up until now I haven't told you anything that you didn't already imply by saying that <code>liftAlt : f -&gt; Alt f</code> is an <code>Alternative</code> homomorphism, but only for <em>left-distributive</em> Alternative instances. But I have shown you a free-alternative that isn't left-distributive (it's trivially right-distributive instead).</p>\n\n<h3>A structurally valid free <code>Alternative</code></h3>\n\n<p>This section answers the bulk of your question, is there a <em>structurally</em> valid free <code>Alternative</code> that isn't left-distributive? Yes.</p>\n\n<p>This isn't an efficient implementation; it's purpose is to demonstrate that it exists and that some version of it can be arrived at in a straight-forward manner.</p>\n\n<p>To make a structurally valid free <code>Alternative</code> I am doing two things. The first is to create a data structure that can't represent any of the <code>Alternative</code> laws; if it can't represent the law then a structure can't be constructed independently of the type class to violate it. This is the same trick used to make lists structurally obey the <code>Alternative</code> associativity law; there's no list that can represent the left-associated <code>(x &lt;|&gt; y) &lt;|&gt; z</code>. The second part is to make sure the operations obey the laws. A list can't represent the left association law, but an implementation of <code>&lt;|&gt;</code> could still violate it, like <code>x &lt;|&gt; y = x ++ reverse y</code>.</p>\n\n<p>The following structure can't be constructed to represent any of the <code>Alternative</code> laws.</p>\n\n<pre><code>{-# Language GADTs #-}\n{-# Language DataKinds #-}\n{-# Language KindSignatures #-}\n\ndata Alt :: (* -&gt; *) -&gt; * -&gt; * where\n    Alt :: Alt' empty pure plus f a -&gt; Alt f a\n\n--           empty   pure    plus\ndata Alt' :: Bool -&gt; Bool -&gt; Bool -&gt; (* -&gt; *) -&gt; * -&gt; * where\n    Empty ::        Alt' True  False False f a\n    Pure  :: a   -&gt; Alt' False True  False f a\n    Lift  :: f a -&gt; Alt' False False False f a\n\n    Plus  :: Alt' False pure1 False f a -&gt; Alt' False pure2 plus2 f a -&gt; Alt' False False True  f a\n      -- Empty can't be to the left or right of Plus\n      -- empty &lt;|&gt; x = x\n      -- x &lt;|&gt; empty = x\n\n      -- Plus can't be to the left of Plus\n      -- (x &lt;|&gt; y) &lt;|&gt; z = x &lt;|&gt; (y &lt;|&gt; z)\n    Ap    :: Alt' False False plus1 f (a -&gt; b) -&gt; Alt' empty False plus2 f a -&gt; Alt' False False False f b\n      -- Empty can't be to the left of `Ap`\n      -- empty &lt;*&gt; f = empty\n\n      -- Pure can't be to the left or right of `Ap`\n      -- pure id &lt;*&gt; v = v     \n      -- pure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w = u &lt;*&gt; (v &lt;*&gt; w)\n      -- pure f &lt;*&gt; pure x = pure (f x)\n      -- u &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u\n</code></pre>\n\n<p>It's a <code>Functor</code></p>\n\n<pre><code>instance Functor f =&gt; Functor (Alt' empty pure plus f) where\n    fmap _ Empty       = Empty\n    fmap f (Pure a)    = Pure (f a)\n    fmap f (Plus a as) = Plus (fmap f a) (fmap f as)\n    fmap f (Lift a)    = Lift (fmap f a)\n    fmap f (Ap g a)    = Ap (fmap (f .) g) a\n\ninstance Functor f =&gt; Functor (Alt f) where\n    fmap f (Alt a) = Alt (fmap f a)\n</code></pre>\n\n<p>And it's <code>Applicative</code>. Because the structure can't represent the laws, when we encounter a term containing one of the unpreventable expressions we're forced to convert it into something else. The laws tell us what to do.</p>\n\n<pre><code>instance Functor f =&gt; Applicative (Alt f) where\n    pure a = Alt (Pure a)\n\n    Alt Empty &lt;*&gt; _ = Alt Empty                          -- empty &lt;*&gt; f = empty\n    Alt (Pure f) &lt;*&gt; (Alt x) = Alt (fmap f x)            -- pure f &lt;*&gt; x = fmap f x          (free theorem)\n    Alt u &lt;*&gt; (Alt (Pure y)) = Alt (fmap ($ y) u)        -- u &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u\n    Alt f@(Lift _)   &lt;*&gt; Alt x@Empty      = Alt (Ap f x)\n    Alt f@(Lift _)   &lt;*&gt; Alt x@(Lift _)   = Alt (Ap f x)\n    Alt f@(Lift _)   &lt;*&gt; Alt x@(Plus _ _) = Alt (Ap f x)\n    Alt f@(Lift _)   &lt;*&gt; Alt x@(Ap _ _)   = Alt (Ap f x)\n    Alt f@(Plus _ _) &lt;*&gt; Alt x@Empty      = Alt (Ap f x)\n    Alt f@(Plus _ _) &lt;*&gt; Alt x@(Lift _)   = Alt (Ap f x)\n    Alt f@(Plus _ _) &lt;*&gt; Alt x@(Plus _ _) = Alt (Ap f x)\n    Alt f@(Plus _ _) &lt;*&gt; Alt x@(Ap _ _)   = Alt (Ap f x)\n    Alt f@(Ap _ _)   &lt;*&gt; Alt x@Empty      = Alt (Ap f x)\n    Alt f@(Ap _ _)   &lt;*&gt; Alt x@(Lift _)   = Alt (Ap f x)\n    Alt f@(Ap _ _)   &lt;*&gt; Alt x@(Plus _ _) = Alt (Ap f x)\n    Alt f@(Ap _ _)   &lt;*&gt; Alt x@(Ap _ _)   = Alt (Ap f x)\n</code></pre>\n\n<p>All of those <code>Ap</code>s could be covered by a pair of view patterns, but it doesn't make it any simpler.</p>\n\n<p>It's also an <code>Alternative</code>. For this we'll use a view pattern to divide the cases into the empty and non-empty cases, and an extra type to store the proof that they're non-empty</p>\n\n<pre><code>{-# Language ViewPatterns #-}\n\nimport Control.Applicative\n\ndata AltEmpty :: (* -&gt; *) -&gt; * -&gt; * where\n    Empty_    :: Alt' True  False False f a -&gt; AltEmpty f a\n    NonEmpty_ :: AltNE f a -&gt; AltEmpty f a\n\ndata AltNE :: (* -&gt; *) -&gt; * -&gt; * where\n    AltNE :: Alt' False pure plus f a -&gt; AltNE f a\n\nempty_ :: Alt' e1 p1 p2 f a -&gt; AltEmpty f a\nempty_ x@Empty      = Empty_ x\nempty_ x@(Pure _)   = NonEmpty_ (AltNE x)\nempty_ x@(Lift _)   = NonEmpty_ (AltNE x)\nempty_ x@(Plus _ _) = NonEmpty_ (AltNE x)\nempty_ x@(Ap _ _)   = NonEmpty_ (AltNE x)\n\ninstance Functor f =&gt; Alternative (Alt f) where\n    empty = Alt Empty\n\n    Alt Empty &lt;|&gt; x = x                                 -- empty &lt;|&gt; x = x\n    x &lt;|&gt; Alt Empty = x                                 -- x &lt;|&gt; empty = x\n    Alt (empty_ -&gt; NonEmpty_ a) &lt;|&gt; Alt (empty_ -&gt; NonEmpty_ b) = case a &lt;&gt; b of AltNE c -&gt; Alt c\n      where\n        (&lt;&gt;) :: AltNE f a -&gt; AltNE f a -&gt; AltNE f a\n        AltNE (Plus x y) &lt;&gt; AltNE z = AltNE x &lt;&gt; (AltNE y &lt;&gt; AltNE z)  -- (x &lt;|&gt; y) &lt;|&gt; x = x &lt;|&gt; (y &lt;|&gt; z)\n        AltNE a@(Pure _) &lt;&gt; AltNE b = AltNE (Plus a b)\n        AltNE a@(Lift _) &lt;&gt; AltNE b = AltNE (Plus a b)\n        AltNE a@(Ap _ _) &lt;&gt; AltNE b = AltNE (Plus a b)\n</code></pre>\n\n<p><code>liftAlt</code> and <code>runAlt</code></p>\n\n<pre><code>{-# Language RankNTypes #-}\n{-# Language ScopedTypeVariables #-}\n\nliftAlt :: f a -&gt; Alt f a\nliftAlt = Alt . Lift\n\nrunAlt' :: forall f g x empty pure plus a. Alternative g =&gt; (forall x. f x -&gt; g x) -&gt; Alt' empty pure plus f a -&gt; g a\nrunAlt' u = go\n  where\n    go :: forall empty pure plus a. Alt' empty pure plus f a -&gt; g a\n    go Empty    = empty\n    go (Pure a) = pure a\n    go (Lift a) = u a\n    go (Plus x y) = go x &lt;|&gt; go y\n    go (Ap f x)   = go f &lt;*&gt; go x\n\nrunAlt :: Alternative g =&gt; (forall x. f x -&gt; g x) -&gt; Alt f a -&gt; g a\nrunAlt u (Alt x) = runAlt' u x\n</code></pre>\n\n<p>This new <code>Alt f</code> doesn't provide either left-distribution or right-distribution for free, and therefore <code>runAlt id :: Alt f a -&gt; g a</code> preserves how distributive <code>g</code> is.</p>\n\n<p>Lists are still left-distributive, but <code>FlipAp</code> lists aren't.</p>\n\n<pre><code>map (runAlt id) ldExample1 :: Example [Int]\nmap (runAlt id) ldExample1 :: Example (FlipAp [] Int)\n\n[[3,4,20,30],[3,4,20,30]]\n[FlipAp {unFlipAp = [3,20,4,30]},FlipAp {unFlipAp = [3,4,20,30]}]\n</code></pre>\n\n<p>List's aren't right-distributive, but <code>FlipAp</code> lists still are</p>\n\n<pre><code>map (runAlt id) rdExample1 :: Example [Int]\nmap (runAlt id) rdExample1 :: Example (FlipAp [] Int)\n\n[[3,4,20,30],[3,20,4,30]]\n[FlipAp {unFlipAp = [3,20,4,30]},FlipAp {unFlipAp = [3,20,4,30]}]\n</code></pre>\n\n<p><a href=\"https://gist.github.com/Cedev/3ef669f809b3c2e771e57efb8771899e\" rel=\"noreferrer\">Source code</a> for this section</p>\n\n<h3>Structurally valid left-catch free <code>Alternative</code></h3>\n\n<p>To control which laws we want we can add them to the structurally free alternative we made earlier.</p>\n\n<p>To add left-catch we'll modify the structure so it can't represent it. Left catch is</p>\n\n<p>(pure a) &lt;|> x = pure a</p>\n\n<p>To keep <code>Alt'</code> from representing it we'll exclude <code>pure</code> from what's allowed to the left of <code>Plus</code>.</p>\n\n<pre><code>--           empty   pure    plus\ndata Alt' :: Bool -&gt; Bool -&gt; Bool -&gt; (* -&gt; *) -&gt; * -&gt; * where\n    Empty ::        Alt' True  False False f a\n    Pure  :: a   -&gt; Alt' False True  False f a\n    Lift  :: f a -&gt; Alt' False False False f a\n\n    Plus  :: Alt' False False False f a -&gt; Alt' False pure2 plus2 f a -&gt; Alt' False False True  f a\n      -- Empty can't be to the left or right of Plus\n      -- empty &lt;|&gt; x = x\n      -- x &lt;|&gt; empty = x\n\n      -- Plus can't be to the left of Plus\n      -- (x &lt;|&gt; y) &lt;|&gt; z = x &lt;|&gt; (y &lt;|&gt; z)\n\n      -- Pure can't be to the left of Plus\n      -- (pure a) &lt;|&gt; x = pure a\n\n    ...\n</code></pre>\n\n<p>This results in a compiler error in the implementation of <code>Alternative Alt</code></p>\n\n<pre><code>Couldn't match type \u2018'True\u2019 with \u2018'False\u2019\nExpected type: Alt' 'False 'False 'False f a1\n  Actual type: Alt' 'False pure2 plus2 f a1\nIn the first argument of \u2018Plus\u2019, namely \u2018a\u2019\nIn the first argument of \u2018AltNE\u2019, namely \u2018(Plus a b)\n</code></pre>\n\n<p>Which we can fix by appealing to our new law, <code>(pure a) &lt;|&gt; x = pure a</code></p>\n\n<pre><code>instance Functor f =&gt; Alternative (Alt f) where\n    empty = Alt Empty\n\n    Alt Empty &lt;|&gt; x = x                                 -- empty &lt;|&gt; x = x\n    x &lt;|&gt; Alt Empty = x                                 -- x &lt;|&gt; empty = x\n    Alt (empty_ -&gt; NonEmpty_ a) &lt;|&gt; Alt (empty_ -&gt; NonEmpty_ b) = case a &lt;&gt; b of AltNE c -&gt; Alt c\n      where\n        (&lt;&gt;) :: AltNE f a -&gt; AltNE f a -&gt; AltNE f a\n        AltNE a@(Pure _) &lt;&gt; _ = AltNE a                                -- (pure a) &lt;|&gt; x = pure a\n        AltNE (Plus x y) &lt;&gt; AltNE z = AltNE x &lt;&gt; (AltNE y &lt;&gt; AltNE z)  -- (x &lt;|&gt; y) &lt;|&gt; x = x &lt;|&gt; (y &lt;|&gt; z)\n        AltNE a@(Lift _) &lt;&gt; AltNE b = AltNE (Plus a b)\n        AltNE a@(Ap _ _) &lt;&gt; AltNE b = AltNE (Plus a b)\n</code></pre>\n"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 4, "accepted_answer_id": 45656620, "answer_count": 1, "score": 15, "last_activity_date": 1614318466, "creation_date": 1502519465, "last_edit_date": 1614318466, "question_id": 45647253, "link": "https://stackoverflow.com/questions/45647253/structurally-enforced-free-alternative-without-left-distributivity", "title": "Structurally enforced Free Alternative, without left distributivity", "body": "<p>There is a nice <a href=\"http://hackage.haskell.org/package/free-4.12.4/docs/Control-Alternative-Free.html\" rel=\"noreferrer\">Free Alternative</a> in the great <em>free</em> package, which lifts a Functor to a left-distributive Alternative.</p>\n\n<p>That is, the claim is that:</p>\n\n<pre><code>runAlt :: Alternative g =&gt; (forall x. f x -&gt; g x) -&gt; Alt f a -&gt; g a\n</code></pre>\n\n<p>is an <em>Alternative homomorphism</em>, with <code>liftAlt</code>.  And, indeed, it <em>is</em> one, but only for <a href=\"https://wiki.haskell.org/Typeclassopedia#Laws_6\" rel=\"noreferrer\"><em>left-distributive</em></a> Alternative instances.</p>\n\n<p>Of course, in reality, very few Alternative instances are actually left-distributive.  Most of the alternative instances that actually matter (parsers, MaybeT f for most Monad f, etc.) are not left-distributive.  This fact can be shown by an example where <code>runAlt</code> and <code>liftAlt</code> do not form an Alternative homomorphism:</p>\n\n<pre><code>(writeIORef x False &lt;|&gt; writeIORef True) *&gt; (guard =&lt;&lt; readIORef x)\n-- is an IO action that throws an exception\nrunAlt id $ (liftAlt (writeIORef x False) &lt;|&gt; liftAlt (writeIORef True))\n               *&gt; liftAlt (guard =&lt;&lt; readIORef x)\n-- is an IO action that throws no exception and returns successfully ()\n</code></pre>\n\n<p>So <code>runAlt</code> is only an Alternative homomorphism for some Alternatives, but not all.  This is because the structure of <code>Alt</code> <em>normalizes</em> all actions to distribute over the left.</p>\n\n<p><code>Alt</code> is great because, structurally, <code>Alt f</code> is a lawful <code>Applicative</code> and <code>Alternative</code>.  There isn't any possible way to construct a value of type <code>Alt f a</code> using the Applicative and Alternative functions that don't follow the laws...the structure of the type itself is what makes it a free Alternative.</p>\n\n<p>Just like, for lists, you can't construct a list using <code>&lt;&gt;</code> and <code>mempty</code> that doesn't respect <code>x &lt;&gt; mempty = x</code>, <code>mempty &lt;&gt; x = x</code>, and associativity.</p>\n\n<p>I've written a Free alternative that <em>doesn't</em> enforce the Applicative and Alternative laws, structurally, but <em>does</em> yield a valid Alternative and Applicative homomorphism with runAlt/liftAlt:</p>\n\n<pre><code>data Alt :: (* -&gt; *) -&gt; * -&gt; * where\n    Pure  :: a   -&gt; Alt f a\n    Lift  :: f a -&gt; Alt f a\n    Empty :: Alt f a\n    Ap    :: Alt f (a -&gt; b) -&gt; Alt f a -&gt; Alt f b\n    Plus  :: Alt f as -&gt; Alt f as -&gt; Alt f as\n\ninstance Functor f =&gt; Functor (Alt f) where\n    fmap f = \\case\n      Pure x     -&gt; Pure (f x)\n      Lift x     -&gt; Lift (f &lt;$&gt; x)\n      Empty      -&gt; Empty\n      Ap fs xs   -&gt; Ap ((f .) &lt;$&gt; fs) xs\n      Plus xs ys -&gt; Plus (f &lt;$&gt; xs) (f &lt;$&gt; ys)\n\ninstance Functor f =&gt; Applicative (Alt f) where\n    pure  = Pure\n    (&lt;*&gt;) = Ap\n\ninstance Functor f =&gt; Alternative (Alt f) where\n    empty = Empty\n    (&lt;|&gt;) = Plus\n</code></pre>\n\n<p>structurally, <code>Alt f</code> is not an actual <code>Applicative</code>, because:</p>\n\n<pre><code>pure f &lt;*&gt; pure x = Ap (Pure f) (Pure x)\npure (f x)        = Pure (f x)\n</code></pre>\n\n<p>So <code>pure f &lt;*&gt; pure x</code> is not the same as <code>pure (f x)</code>, structurally.  Not a valid Applicative, right off the bat.</p>\n\n<p><em>But</em>, with the given <code>runAlt</code> and <code>liftAlt</code>:</p>\n\n<pre><code>liftAlt :: f a -&gt; Alt f a\nliftAlt = Lift\n\nrunAlt :: Alternative g =&gt; (forall x. f x -&gt; g x) -&gt; Alt f a -&gt; g a\nrunAlt f = \\case\n  Pure x     -&gt; pure x\n  Lift x     -&gt; f x\n  Empty      -&gt; empty\n  Ap fs xs   -&gt; runAlt f fs &lt;*&gt; runAlt f xs\n  Plus xs ys -&gt; runAlt f xs &lt;|&gt; runAlt f ys\n</code></pre>\n\n<p>And <code>runAlt</code> here does indeed act as a valid Applicative homomorphism with a given natural transformation...</p>\n\n<p>One could say that my new <code>Alt f</code> is a valid Alternative and Applicative when quotiented by the equivalence relationship defined by <code>runAlt</code>, i suppose.</p>\n\n<p>Anyway, this is only slightly unsatisfying.  Is there any way to write a free Alternative that is <em>structurally</em> a valid Alternative and Applicative, <em>without</em> enforcing left distributivity?</p>\n\n<p>(In particular, I'm actually interested in one that follows the <a href=\"https://wiki.haskell.org/Typeclassopedia#Laws_6\" rel=\"noreferrer\">left catch</a> law, and enforces it structurally.  This would be a separate and also interesting thing, but not completely necessary.)</p>\n\n<p>And, if there isn't any way, why not?</p>\n"}, {"tags": ["haskell", "types", "aeson"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1502525378, "post_id": 45645748, "comment_id": 78254559, "body": "If I understand correctly, your goal is to have a runtime list of all available instances for <code>Update</code>. This can not be achieved, I think."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1502555972, "post_id": 45645748, "comment_id": 78263474, "body": "I&#39;d say the core question is how do you want to determine the data type of each chunk?"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1502559409, "post_id": 45645748, "comment_id": 78264454, "body": "Petr, The first field in the JSON object determines the data type."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1502564496, "post_id": 45645748, "comment_id": 78266076, "body": "@JohnF.Miller I meant how do you want to map such a  field into the corresponding data type? You need to have some kind of a dictionary, either implicit or explicit. Implicit ones are problematic that they can (1) overlap, (2) include something unexpected. (Please respond using the <a href=\"https://meta.stackexchange.com/q/43019/192930\">@name</a> syntax, it then lands in my inbox.)"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1502772288, "post_id": 45645748, "comment_id": 78330718, "body": "@PetrPudl&#225;k Yes, that is the question I am trying to ask.  How do I either create a dictionary (which must be heterogeneous) or use one of haskell&#39;s libraries to introspect on an existing dictionary at run time? Data.Typeable says that the code clearly knows what the name of it&#39;s type is.  Is there a library that will reverse the process?  Given the name of a type produce a constructor for that type."}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1502798275, "creation_date": 1502798275, "answer_id": 45692382, "question_id": 45645748, "link": "https://stackoverflow.com/questions/45645748/deserializing-to-different-types-at-runtime-in-haskell/45692382#45692382", "title": "Deserializing to different types at runtime in haskell", "body": "<p><em>(This is more an extended comment than a full answer.)</em></p>\n\n<blockquote>\n  <p>I'm not real happy with this solution because I cannot add new types to the update class without also touching this union type.</p>\n</blockquote>\n\n<p>I'd suggest to actually rethink this reasoning. Type classes in Haskell express that a certain type has a specific property. For example, that numbers can be added. This doesn't mean that a program should/wants to use such a property, the property is intrinsic to the data type. And they're open - different parts of a program can add new instances, and the program's behavior shouldn't depend on instances declared in independent modules.</p>\n\n<p>Your suggestion, to automatically parse all instances of <code>Update</code>, goes against the above sense. It can make your program less readable, and more importantly, create more problems in the future. If someone wants to determine how exactly the parsing part works, (s)he would have to examine the complete source code of the program and look for all instances of <code>Update</code>. I'd rather advocate for <em>locality</em> - the meaning of a program should depend on its \"local surroundings\".</p>\n\n<p>It also doesn't allow to have instances that you don't want to use (for example only for testing). It also doesn't allow you to have 2 or more parsing routines, each working with a different set of <code>Update</code> instances. </p>\n\n<p>Using <code>Typeable</code> to tag your data can be also problematic, as it doesn't allow you to refactor your code easily. If you need to change your types, you won't be able to parse your data.</p>\n\n<hr>\n\n<p>So my suggestion would be to have such an union data type, but to simplify the corresponding boilerplate code.</p>\n\n<p>Aeson already gives you the ability to derive instances using <code>Generic</code>. So you don't need to worry about <code>FromJSON</code>/<code>ToJSON</code>. And you can write a generic <code>Upgrade</code> instance once for this union type using Template Haskell, or using Generic, such that it'll be automatically derived regardless on the number of constructors of the union type. This will allow you to have full, local control on the serialization/deserialization process, with very little of manual work when modifying the instances.</p>\n\n<p>If you want, I can also give an example how to write such an instance.</p>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 0, "last_activity_date": 1502869869, "creation_date": 1502869869, "answer_id": 45707979, "question_id": 45645748, "link": "https://stackoverflow.com/questions/45645748/deserializing-to-different-types-at-runtime-in-haskell/45707979#45707979", "title": "Deserializing to different types at runtime in haskell", "body": "<p>After much research, the answer appears to be that what I was attempting to do cannot be done.  There are three libraries (Data Typeable, Data.Data, and Data.Dynamic) that allow type level data to be promoted to values, but nothing that allows value level date to be converted to type level data.  This seems to be a consequence of the way the type system works.  Types simply do not exist at the end of the compile step. <strong>There is not, and cannot be an equivalent to Ruby's <code>Object.const_get</code> in Haskell.</strong>\u00b9 </p>\n\n<p><a href=\"https://stackoverflow.com/a/45692382/163177\">Another answer</a> ran with my suggestion of working around this limitation by constructing a type which is the union of all possible types.  Indeed if one looks at lexer and parser implementations this is what is typically done.  For my situation I found it easier -- knowing that my intent was always to store my results back to the file anyway -- to make <code>Update</code> a data type rather then a class and explicitly write the dictionary. Rather than concern myself with how to make it heterogeneous, I just included the write to disk in the functions that are the values of the map so they all have a resulting type of <code>IO()</code></p>\n\n<pre><code>data Update = Update {\n    clock :: IO (Int)\n  , updaters :: Map String (Int -&gt; Value -&gt; IO())\n  , source :: Int -&gt; IO(Maybe (String, Value)) \n  }\n</code></pre>\n\n<p>A value of type <code>Update</code> can then be created at runtime and stored in a ReaderT Monad Transformer along with the rest of the program's runtime configuration data. With the messy details of command and control and error handling <em>left out</em> an update worker looks a bit like:</p>\n\n<pre><code>updateWorker :: Update -&gt; IO()\nupdateWorker u = do\n  time &lt;- clock u\n  (key,val) &lt;- fromJust &lt;$&gt; source t\n  let updateFunct =  fromJust  $  lookup k (updaters u)\n  updateFunct time val\n</code></pre>\n\n<hr>\n\n<p>1: There are ways to do this using Template Haskell at compile time, and it may be possible to extend this to run time with the careful use of the GHC API, but that is beyond the scope of this answer. </p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1502869869, "creation_date": 1502502170, "question_id": 45645748, "link": "https://stackoverflow.com/questions/45645748/deserializing-to-different-types-at-runtime-in-haskell", "title": "Deserializing to different types at runtime in haskell", "body": "<p><strong>Background</strong></p>\n\n<p>I'm working with the Aeson library to store and retrieve values from a file. I am using <code>Typeable</code> (and <code>TypeRep</code>s) to tag the data so I have a pretty good idea that it will parse correctly.</p>\n\n<p>I have a Class wherein each member of the class has a function that takes a time (<code>Integer</code>) and updates itself ie: </p>\n\n<pre><code>class Update a where\n  update :: Integer -&gt; a -&gt; a\n</code></pre>\n\n<p>All the values stored in the file are Instances of the <code>Update</code> class.</p>\n\n<p><strong>Question</strong>\nI would like to iterate through the file <code>update</code>ing each value and write a new file. I would like to have the program determine at runtime what the data type of the chunk of data is, use <code>fromJSON</code> to create value of that type, run <code>update</code> on it, and write it back.  The type checker thinks this is a terrible idea because it cannot statically type check the fromJSON call at compile time and therefore cannot get the right entry from the <code>Update</code> class dictionary.</p>\n\n<p>Is there a way to use Typeable (or Data) to get the type checker to do the right thing? Is there a better alternative?</p>\n\n<hr>\n\n<p>My only thought on working around this is to create a union data type of all updateable types, and then use a case statement to parse the tag and choose the correct constructor.  I'm not real happy with this solution because I cannot add new types to the update class without also touching this union type.</p>\n"}, {"tags": ["haskell", "singleton-type"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1502659563, "post_id": 45642783, "comment_id": 78287725, "body": "never thought i&#39;d see &quot;i&#39;m a beginner to haskell&quot; and singletons in the same post"}, {"owner": {"reputation": 753, "user_id": 2172459, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/750bdd93b854a92288fec857151718b4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/2172459/pat"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1502720128, "post_id": 45642783, "comment_id": 78310755, "body": "@JustinL. I have a good deal of metaprogramming experience from C++, so it&#39;s not so scary for me :D"}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 5, "last_activity_date": 1502484310, "last_edit_date": 1502484310, "creation_date": 1502483642, "answer_id": 45643350, "question_id": 45642783, "link": "https://stackoverflow.com/questions/45642783/singletons-typerepstar-sing-data-instance/45643350#45643350", "title": "Singletons TypeRepStar Sing Data Instance", "body": "<p>The compiler insists that the <code>a</code> in <code>Bloop (a :: *)</code> and the <code>a</code> in <code>Typeable a =&gt; Bloop a</code> are not the same <code>a</code>. It produces exactly the same error if you replace one of them with <code>b</code>:</p>\n\n<pre><code>data instance Bloop (b :: *) where\n      Blop :: Typeable a =&gt; Bloop a\n\n* Data constructor `Blop' returns type `Bloop a'\n    instead of an instance of its parent type `Bloop b'\n* In the definition of data constructor `Blop'\n  In the data instance declaration for `Bloop'\n</code></pre>\n\n<p>This can be made more visible with <code>-fprint-explicit-kinds</code>:</p>\n\n<pre><code>* Data constructor `Blop' returns type `Bloop k a'\n    instead of an instance of its parent type `Bloop * a'\n* In the definition of data constructor `Blop'\n  In the data instance declaration for `Bloop'\n</code></pre>\n\n<p>Now we can clearly see right in the error message that one <code>a</code> has kind <code>k</code> and the other has kind <code>*</code>. From this, a solution is obvious - explicitly declare the kind of the second <code>a</code> :</p>\n\n<pre><code>data instance Bloop (a :: *) where\n      Blop :: Typeable (a :: *) =&gt; Bloop (a :: *)  -- Works now\n</code></pre>\n\n<p>It appears that this happens because of the <code>PolyKinds</code> extension. Without it, the second <code>a</code> is assumed to have kind <code>*</code>, and thus the original definition works.</p>\n"}, {"tags": [], "owner": {"reputation": 753, "user_id": 2172459, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/750bdd93b854a92288fec857151718b4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/2172459/pat"}, "is_accepted": false, "score": 2, "last_activity_date": 1502483659, "creation_date": 1502483659, "answer_id": 45643357, "question_id": 45642783, "link": "https://stackoverflow.com/questions/45642783/singletons-typerepstar-sing-data-instance/45643357#45643357", "title": "Singletons TypeRepStar Sing Data Instance", "body": "<p>It appears as though the <code>PolyKinds</code> extension is causing the error.  The singletons library splits the <code>data family</code> declaration and the <code>data instance</code> definitions into different files.  The data family requires the PolyKinds extension to work, but if the instance will fail if the extension is on.  It seems you must use the KindSignatures extension instead.</p>\n\n<p>Def.hs</p>\n\n<pre><code>{-# LANGUAGE PolyKinds, TypeFamilies #-}\n\nmodule Def (Bloop) where\n\ndata family Bloop (a :: k)\n</code></pre>\n\n<p>Main.hs</p>\n\n<pre><code>{-# LANGUAGE GADTs\n           , TypeFamilies\n           , KindSignatures\n           #-}\n\nmodule Main where\n\nimport Def\nimport Data.Typeable\n\ndata instance Bloop (a :: *) where\n  Blop :: Typeable a =&gt; Bloop a\n\nmain :: IO ()\nmain = putStrLn \"Hello, Haskell!\"\n</code></pre>\n"}], "owner": {"reputation": 753, "user_id": 2172459, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/750bdd93b854a92288fec857151718b4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/2172459/pat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 45643350, "answer_count": 2, "score": 4, "last_activity_date": 1502484310, "creation_date": 1502480879, "question_id": 45642783, "link": "https://stackoverflow.com/questions/45642783/singletons-typerepstar-sing-data-instance", "title": "Singletons TypeRepStar Sing Data Instance", "body": "<p>I'm new to Haskell, so I'm probably missing something obvious, but what seems to be the problem here?</p>\n\n<p>The singletons library provides a <code>Sing</code> instance for the kind <code>*</code> in <code>import Data.Singletons.TypeRepStar</code>.</p>\n\n<p>The <code>Sing</code> data family is defined as follows..</p>\n\n<pre><code>data family Sing (a :: k)\n</code></pre>\n\n<p>and the <code>*</code> instance is defined as..</p>\n\n<pre><code>data instance Sing (a :: *) where\n  STypeRep :: Typeable a =&gt; Sing a\n</code></pre>\n\n<p>I'm trying to reproduce a minimal version of this using the following ...</p>\n\n<pre><code>{-# LANGUAGE GADTs\n           , TypeFamilies\n           , PolyKinds\n           #-}\n\nmodule Main where\n\nimport Data.Typeable\n\ndata family Bloop (a :: k)\ndata instance Bloop (a :: *) where\n  Blop :: Typeable a =&gt; Bloop a\n\nmain :: IO ()\nmain = putStrLn \"Hello, Haskell!\"\n</code></pre>\n\n<p>But I'm getting the following error...</p>\n\n<pre><code>Main.hs:12:3: error:\n    \u2022 Data constructor \u2018Blop\u2019 returns type \u2018Bloop a\u2019\n         instead of an instance of its parent type \u2018Bloop a\u2019\n    \u2022 In the definition of data constructor \u2018Blop\u2019\n         In the data instance declaration for \u2018Bloop\u2019\n    |\n 12 |   Blop :: Typeable a =&gt; Bloop a\n    |   ^\n</code></pre>\n"}, {"tags": ["haskell", "emacs", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 2, "last_activity_date": 1502485953, "creation_date": 1502485953, "answer_id": 45643852, "question_id": 45642386, "link": "https://stackoverflow.com/questions/45642386/intero-goto-definition-doesnt-include-libraries/45643852#45643852", "title": "intero-goto-definition doesn&#39;t include libraries?", "body": "<p>It'd be great to have this, but it's not implemented yet - <a href=\"https://github.com/commercialhaskell/intero/issues/231\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/intero/issues/231</a> .  It would take quite a bit of effort:</p>\n\n<p>1) Need to keep the source files around for all dependencies.  Not sure how to make this handle wired in packages like base.  These files should be marked read-only so that you aren't given the impression that you can edit them.</p>\n\n<p>2) Somehow have an index that maps from module name + identifier name to source location.  Haddock may have this info, not sure, but in that case, it means that you need to build all your dependencies with documentation.  Alternatively, you'd need to have an extra step which reloads every package with intero, to generate an index like this.  This would certainly be necessary if you wanted features like type info within the package you're viewing.</p>\n"}], "owner": {"reputation": 53, "user_id": 8424819, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBooO.jpg?s=128&g=1", "display_name": "gremdrus", "link": "https://stackoverflow.com/users/8424819/gremdrus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 45643852, "answer_count": 1, "score": 5, "last_activity_date": 1502546943, "creation_date": 1502479093, "last_edit_date": 1502546943, "question_id": 45642386, "link": "https://stackoverflow.com/questions/45642386/intero-goto-definition-doesnt-include-libraries", "title": "intero-goto-definition doesn&#39;t include libraries?", "body": "<p>I am trying to use <code>M-.</code> to go to the definition of a function, but it seems like <code>intero-goto-definition</code> only works the library I am currently developing, not on ones that I am importing.</p>\n\n<p>Here is my stack.yaml:</p>\n\n<pre><code>flags: {}\nextra-package-dbs: []\npackages:\n- location: libs/not-gloss/not-gloss # the library I am trying to C-. into\n- .\nextra-deps:\n- spatial-math-0.4.0.0\nresolver: lts-9.0\n</code></pre>\n"}, {"tags": ["haskell", "syntax", "typed-holes"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1502475897, "post_id": 45641021, "comment_id": 78242716, "body": "could you include the full contents of <code>source_file.hs</code>."}, {"owner": {"reputation": 435, "user_id": 1499196, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c2fa33885952f08f1a32ad80619ee637?s=128&d=identicon&r=PG", "display_name": "Henning", "link": "https://stackoverflow.com/users/1499196/henning"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1502477923, "post_id": 45641021, "comment_id": 78243783, "body": "The source file does not contain anything else. I am currently trying to implement an haskell parser in typescript and for that I need to understand the behavior in this case."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1502479752, "post_id": 45641021, "comment_id": 78244555, "body": "What version of GHC are you using?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502486291, "post_id": 45641021, "comment_id": 78247181, "body": "Are these the only errors you are getting?"}, {"owner": {"reputation": 435, "user_id": 1499196, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c2fa33885952f08f1a32ad80619ee637?s=128&d=identicon&r=PG", "display_name": "Henning", "link": "https://stackoverflow.com/users/1499196/henning"}, "edited": false, "score": 0, "creation_date": 1502534813, "post_id": 45641021, "comment_id": 78257281, "body": "I have been using this <a href=\"http://rextester.com/l/haskell_online_compiler\" rel=\"nofollow noreferrer\">online tool</a> which is <code>The Glorious Glasgow Haskell Compilation System, version 7.10.3</code>. The mentioned error is the only one."}, {"owner": {"reputation": 435, "user_id": 1499196, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c2fa33885952f08f1a32ad80619ee637?s=128&d=identicon&r=PG", "display_name": "Henning", "link": "https://stackoverflow.com/users/1499196/henning"}, "edited": false, "score": 0, "creation_date": 1502537336, "post_id": 45641021, "comment_id": 78257950, "body": "This seems to be a bug in ghc: <code>data A = B | C A deriving Show; main = print ((C.let x = (\\arg -&gt; B) in x) B)</code> does not compile (it throws <code>parse error on input \u2018=\u2019</code>), but <code>data A = B | C A deriving Show; main = print ((C . let x = (\\arg -&gt; B) in x) B)</code> does. According to the syntax reference, both should compile, as <code>C.let</code> does not match <code>qvarid</code> (<code>let</code> is a <code>reservedid</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1502475847, "post_id": 45641459, "comment_id": 78242690, "body": "Are you sure <code>A</code> is interpreted as type constructor, I am getting errors about a missing import <code>A</code> - it is hard to figure this without the full source code."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1502476120, "post_id": 45641459, "comment_id": 78242833, "body": "at <a href=\"https://begriffs.com/posts/2015-02-07-haskell-type-holes.html\" rel=\"nofollow noreferrer\">begriffs.com</a> there is a video which shows the power and usage of type(d) holes in (AGDA and) Haskell"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1502476360, "post_id": 45641459, "comment_id": 78242954, "body": "@epsilonhalbe I actually expected errors about a module <code>A</code> - my answer is just based on OPs error message. I reckon this probably comes down to a GHC version difference."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1502476523, "post_id": 45641459, "comment_id": 78243040, "body": "<code>I reckon this probably comes down to a GHC version difference.</code> those are  the things I <i>never</i> think of - good idea."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1502479182, "post_id": 45641459, "comment_id": 78244321, "body": "It isn&#39;t attempting to specifically match the type of <code>_</code> against a function type though. That makes me think it&#39;s interpreting <code>A</code> as a module name."}, {"owner": {"reputation": 435, "user_id": 1499196, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c2fa33885952f08f1a32ad80619ee637?s=128&d=identicon&r=PG", "display_name": "Henning", "link": "https://stackoverflow.com/users/1499196/henning"}, "edited": false, "score": 0, "creation_date": 1502535281, "post_id": 45641459, "comment_id": 78257396, "body": "What do you mean with <code>special placeholders</code>? I thought <code>_</code> is treated as a lower case letter, thus <code>_foo</code> should be a valid variable identifier, shouldn&#39;t it? Only a single <code>_</code> behaves differently, as <code>_</code> is a reserved id and varid&#39;s cannot be reservedid&#39;s (=&gt; <code>_foo</code> is not a reserved id).  GHC does not seem to have a problem with  <code>main = print $ _a; _a = 32</code>  - it outputs 32 without any compiler errors/warnings. However, just <code>main = print $ _a</code> yields the same error as <code>main = print $ _</code> as mentioned before."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 435, "user_id": 1499196, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c2fa33885952f08f1a32ad80619ee637?s=128&d=identicon&r=PG", "display_name": "Henning", "link": "https://stackoverflow.com/users/1499196/henning"}, "edited": false, "score": 0, "creation_date": 1502567290, "post_id": 45641459, "comment_id": 78266860, "body": "@Henning It depends on whether <code>_a</code> is bound or unbound. If it is unbound, it is treated as a &quot;named&quot; <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#typed-holes\" rel=\"nofollow noreferrer\">type hole</a>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 5, "last_activity_date": 1502475200, "creation_date": 1502475200, "answer_id": 45641459, "question_id": 45641021, "link": "https://stackoverflow.com/questions/45641021/haskell-tokens-in-expression-a/45641459#45641459", "title": "Haskell Tokens in expression `A._`", "body": "<p>These are <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#typed-holes\" rel=\"noreferrer\">typed holes</a>, which are part of a GHC extension enabled by default. From this link:</p>\n\n<blockquote>\n  <p>Typed holes are a feature of GHC that allows special placeholders written with a leading underscore (e.g., \u201c<code>_</code>\u201d, \u201c<code>_foo</code>\u201d, \u201c<code>_bar</code>\u201d), to be used as expressions. During compilation these holes will generate an error message that describes which type is expected at the hole\u2019s location, information about the origin of any free type variables, and a list of local bindings that might help fill the hole with actual code. Typed holes are always enabled in GHC.</p>\n</blockquote>\n\n<p>That means that <code>A._</code> gets parsed as an application of composition, <code>(.)</code>, to the constructor <code>A</code> and the typed hole expression <code>_</code>. The same holds for <code>A._t</code>.</p>\n\n<p>The purpose of typed holes is mostly debugging: it lets you know what type GHC infers an expression in that position should have and reports that in an error message.</p>\n"}], "owner": {"reputation": 435, "user_id": 1499196, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c2fa33885952f08f1a32ad80619ee637?s=128&d=identicon&r=PG", "display_name": "Henning", "link": "https://stackoverflow.com/users/1499196/henning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1502475200, "creation_date": 1502473578, "question_id": 45641021, "link": "https://stackoverflow.com/questions/45641021/haskell-tokens-in-expression-a", "title": "Haskell Tokens in expression `A._`", "body": "<p>How does Haskell interpret the expression <code>A._</code>?\nE.g. in <code>main = print $ A._</code>.</p>\n\n<p>Haskell throws the following error error:</p>\n\n<pre><code>source_file.hs:1:16:\n    Found hole \u2018_\u2019 with type: r0\n    Where: \u2018r0\u2019 is an ambiguous type variable\n    Relevant bindings include\n      main :: IO ()\n        (bound at source_file.hs:1:1)\n    In the second argument of \u2018($)\u2019, namely \u2018A._\u2019\n    In the expression: print $ A._\n    In an equation for \u2018main\u2019: main = print $ A._\n</code></pre>\n\n<p>However, according to Haskell's <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html\" rel=\"nofollow noreferrer\">Syntax Reference</a>, <code>A._</code> should be interpreted as <code>consym (A)</code>, <code>varsym (.)</code> and <code>reservedid (_)</code>, since <code>_</code> is not a valid <code>varid</code> (<code>varid</code>s cannot be <code>reservedid</code>s).</p>\n\n<p>Haskell throws the same error for <code>main = print $ A._t</code>:</p>\n\n<pre><code>source_file.hs:1:16:\n    Found hole \u2018_t\u2019 with type: r0\n    Where: \u2018r0\u2019 is an ambiguous type variable\n    Relevant bindings include\n      main :: IO ()\n        (bound at source_file.hs:1:1)\n    In the second argument of \u2018($)\u2019, namely \u2018A._t\u2019\n    In the expression: print $ A._t\n    In an equation for \u2018main\u2019: main = print $ A._t\n</code></pre>\n\n<p>In this case however, the token sequence should be <code>qvarid (A._t)</code> as <code>A</code> matches <code>modid</code> and <code>_t</code> matches <code>varid</code>.</p>\n\n<p>Can anybody help me out and explain what is going on?</p>\n"}, {"tags": ["haskell", "optimization", "profiling"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 5, "creation_date": 1502459284, "post_id": 45636590, "comment_id": 78232794, "body": "You have functions that recurse over a list and call <code>length</code> at every iteration.  <code>length</code> is O(n).  You&#39;ve accidentally added an O(n^2) term to the runtime."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 2, "creation_date": 1502461736, "post_id": 45636590, "comment_id": 78234626, "body": "Just skipping the guard <code>| length xs &lt; 5 = maxim</code> for an additional pattern <code>digit5&#39; [] maxim = maxim</code> gives me 0.004 s instead of 1.7 s. That is even faster than the elegant solution. (read will always consume 5 bytes of the partial strings, whereas the string comparison might only need to compare the first Char.)"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1502470407, "post_id": 45637379, "comment_id": 78239901, "body": "Some proposals for further speed: the lexicographical ordering on <code>String</code> and the ordering on <code>Integer</code> coincide, so you can skip the <code>read</code> entirely. You can also avoid the <code>filter</code> with a fancy trick: <code>zipWith const (tails xs) (drop 4 xs)</code> will produce all the at-least-length-5 tails of <code>xs</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1502471061, "post_id": 45637379, "comment_id": 78240211, "body": "(...or you can move the <code>read</code>, as in <code>read . maximum . map (take 5)</code>, if you want to keep the same type. I have done this in the following timing tests.) Results: <code>digit5ReadFilter</code>, 0.32s for a length-10000 <code>String</code>; <code>digit5ReadZipwith</code>, 0.04s; <code>digit5LexFilter</code>, 0.27s; <code>digit5LexZipwith</code> doesn&#39;t even register (reported 0.00s)."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1502502894, "post_id": 45637379, "comment_id": 78250735, "body": "This was the first bug due to strictness that I encountered when I was learning Haskell: <code>length xs &lt; 5</code> is too strict here because <code>Int</code> is too strict. If you use a lazy number type like <code>Data.Nat</code>, it\u2019ll stop evaluating <code>xs</code> after 5 elements: <code>genericLength xs &lt; (5 :: Nat)</code>. The same goes for <code>filter ((&gt;= (5 :: Nat)) . genericLength)</code>."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1502526591, "post_id": 45637379, "comment_id": 78254904, "body": "Try <code>digit5 = maximum . scanl (\\a b -&gt; rem (10 * a + b) 100000) 0 . map digitToInt</code>. I didn&#39;t benchmark it, but I imagine the lack of string manipulation should help."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 9, "last_activity_date": 1502461730, "last_edit_date": 1502461730, "creation_date": 1502460949, "answer_id": 45637379, "question_id": 45636590, "link": "https://stackoverflow.com/questions/45636590/haskell-speed-difference-between-two-versions-of-code/45637379#45637379", "title": "Haskell: speed difference between two versions of code", "body": "<p>The problem with your \"slow\" version is this line:</p>\n\n<pre><code>| length xs &lt; 5 = maxim\n</code></pre>\n\n<p>This computes the length of <code>xs</code>, and because Haskell lists are singly-linked lists, this operation requires full traversal of the whole list, which is O(n). And it happens on every iteration. And there are N iterations. Which makes the whole process O(n^2).</p>\n\n<p>The \"fast\" code, on the other hand, is just linear, which on large inputs shows up vividly.</p>\n\n<p>If you just replace the offending line with this:</p>\n\n<pre><code>| null xs = maxim\n</code></pre>\n\n<p>it will make the whole thing just linear, and it will be just as fast as the \"elegant\" solution. Sure, this will result in extra 5 iterations, but that loss is more than compensated by reducing the overall complexity.</p>\n\n<p>Or, alternatively, you can make the \"elegant\" solution just as slow by filtering out the tails that are 5 chars or shorter:</p>\n\n<pre><code>digit5 = maximum . map (read . take 5) . filter ((&gt;= 5) . length) . tails\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 5536169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab2a14c7f47b526586dd612404c6514a?s=128&d=identicon&r=PG&f=1", "display_name": "twosan", "link": "https://stackoverflow.com/users/5536169/twosan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 45637379, "answer_count": 1, "score": 3, "last_activity_date": 1502461730, "creation_date": 1502458557, "last_edit_date": 1502458867, "question_id": 45636590, "link": "https://stackoverflow.com/questions/45636590/haskell-speed-difference-between-two-versions-of-code", "title": "Haskell: speed difference between two versions of code", "body": "<p>I've started diving into Haskell by trying to solve some small problems.</p>\n\n<p>I've stumbled upon a big performance difference(~100-200x) between the <em>\"standard haskell-friendly\"</em> solution and my <em>\"very-ugly and haskell-unfriendly\"</em> version.</p>\n\n<p>I'm sure for fellow haskellers this difference in performance has a good reason, which I'm missing, and can educate me on this topic. </p>\n\n<p><strong>The problem:</strong> Find the maximum 5 digit number inside a numerical string</p>\n\n<p>Both use the same <em>concept</em> in solving: generate all 5 digit numbers and find the maximum.</p>\n\n<p>Elegant and fast code </p>\n\n<pre><code>digit5 :: String -&gt; Int\ndigit5 = maximum . map (read . take 5) . init . tails\n</code></pre>\n\n<p>Ugly and very slow code(once the string size is big)</p>\n\n<pre><code>digit5' :: String -&gt; String -&gt; String\n-- xs - input string\n-- maxim - current maximal value\ndigit5' xs maxim \n  | (length xs) &lt; 5 = maxim\n  | y &gt; maxim = digit5' (drop 1 xs) y -- use new detected maximum value\n  | otherwise = digit5' (drop 1 xs) maxim\n  where y = take 5 xs\n\ndigit5 :: String -&gt; Int\ndigit5 xs\n-- return the original string if the input size is smaller than 6\n  | length (xs) &lt; 6 = read xs \n  | otherwise = read $ digit5' xs \"00000\"\n</code></pre>\n\n<p>For small inputs I get roughly the same execution times, for big inputs I start to see very big differences(for an input of 44550 elements):</p>\n\n<pre><code>Computation time for ugly version: 2.047 sec\nComputation time for nice version: 0.062 sec\n</code></pre>\n\n<p>My superficial understanding of this is that the fast code is using <em>pre-available higher order functions</em>. For the slower version recursion is used but I think tail biting should be possible. But at a <em>naive</em> level, to me both seem to do the same thing.</p>\n\n<p>While the slower function does comparisons on strings instead of converting them to numbers, I've also tried converting the strings to ints but without any big improvement </p>\n\n<p>I've tried compiling using ghc without any flags and with the following commands:</p>\n\n<pre><code>ghc \nghc -O2 \nghc -O2 -fexcess-precision -optc-O3 -optc-ffast-math -no-\nrecomp \nstack runhaskell \nghc -O3\n</code></pre>\n\n<p>For sake of reproducibility I'm adding a link to the code contaning also the test vector: <a href=\"https://pastebin.com/kuS5iKgd\" rel=\"nofollow noreferrer\">https://pastebin.com/kuS5iKgd</a></p>\n"}, {"tags": ["haskell", "types", "functional-programming", "polymorphism", "type-coercion"], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1502455667, "post_id": 45635576, "comment_id": 78230326, "body": "Isn&#39;t it puzzling that <code>(fromIntegral : b -&gt; c) . (fromIntegral : a -&gt; b) : a -&gt; c</code> doesn&#39;t lead to a type error? How is the &quot;intermediate&quot; type <code>b</code> picked given that it is neither determined by the input nor the output?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1502456382, "post_id": 45635576, "comment_id": 78230834, "body": "@gallais Very good catch! The solution is that <a href=\"https://www.haskell.org/onlinereport/decls.html#sect4.3.4\" rel=\"nofollow noreferrer\">there&#39;s a special case for numeric classes</a> which allows the compiler to default <code>Num b =&gt; b</code> without an explicit type annotation, and the default <code>default</code> is <code>Integer</code>."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1502456708, "post_id": 45635576, "comment_id": 78231016, "body": "Nice! Thanks for the explanation!"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 7, "last_activity_date": 1502455830, "last_edit_date": 1502455830, "creation_date": 1502455485, "answer_id": 45635576, "question_id": 45634776, "link": "https://stackoverflow.com/questions/45634776/function-return-type-not-enforced/45635576#45635576", "title": "Function return type not enforced", "body": "<blockquote>\n  <p>I thought that if <code>t</code>'s type is stated explicite as <code>(Integer, Word32)</code>, GHCi will conclude that <code>y' :: Integer</code> and <code>y :: Word32</code> since the function result is <code>(y', y)</code>.</p>\n</blockquote>\n\n<p>No, it does not infer anything about the types of <code>y'</code> and <code>y</code>. It just checks whether they are compatible with the expected type. A simpler example<sup>1</sup>:</p>\n\n<pre><code>x = -1\n\ny :: Integer\ny = x\n\ny' :: Word32\ny' = x\n</code></pre>\n\n<p>Which type does <code>x</code> have? It's neither <code>Integer</code> nor <code>Word32</code>. It's the <a href=\"http://andrew.gibiansky.com/blog/haskell/haskell-typeclasses/#_literals\" rel=\"noreferrer\">type of literals</a>:</p>\n\n<pre><code>x :: Num a =&gt; a\nx = fromInteger (-1 :: Integer)\n</code></pre>\n\n<p>And <code>Num a =&gt; a</code> is compatible both with the usage as an <code>Integer</code> in <code>y</code> and as a <code>Word32</code> in <code>y'</code>. It doesn't matter how <code>x</code> is used, the type of <code>x</code> is determined only by how the term is defined.</p>\n\n<hr>\n\n<p>To explain your results, remember referential transparency - we can just replace the variables with their definition:</p>\n\n<pre><code>t = let y = fromIntegral (-1)\n        y' = (fromIntegral y) :: Integer\n    in (y', y) :: (Integer, Word32)\n</code></pre>\n\n<p>expands to </p>\n\n<pre><code>t = ( (fromIntegral (fromIntegral (-1))) :: Integer -- nothing says Word32 here\n    , fromIntegral (-1)\n    ) :: (Integer, Word32)\n</code></pre>\n\n<p>whereas the second</p>\n\n<pre><code>t = let y = (fromIntegral (-1)) :: Word32\n        y' = (fromIntegral y) :: Integer\n     in (y', y) :: (Integer, Word32)\n</code></pre>\n\n<p>expands to</p>\n\n<pre><code>t = ( (fromIntegral ( (fromIntegral (-1)) :: Word32 )) :: Integer\n    , (fromIntegral (-1)) :: Word32\n    ) :: (Integer, Word32)\n</code></pre>\n\n<p><sub>1: I hope the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"noreferrer\">dreaded monomorphism restriction</a> doesn't mess with us here. Can anyone more knowledgeable confirm that it doesn't apply to <code>x</code> (or under what circumstances)?</sub></p>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 3, "last_activity_date": 1502455705, "creation_date": 1502455705, "answer_id": 45635658, "question_id": 45634776, "link": "https://stackoverflow.com/questions/45634776/function-return-type-not-enforced/45635658#45635658", "title": "Function return type not enforced", "body": "<p>The result depends on the <code>-X[No]MonomorphismRestriction</code> option. By default, the <code>-XNoMonomorphismRestriction</code> option is used in GHCi, so GHCi inferred a type for <code>y :: Num a =&gt; a</code>. And in the expression <code>fromIntegral y</code> it instantiated as <code>Integer</code> (by default instance for <code>Num</code> class), in the expression <code>(y', y)</code> it instantiated as <code>Word32</code>. When you explicitly specified type of <code>y</code>, the variable <code>y</code> was <code>Word32</code> in all the expression.</p>\n\n<p>If you run the command <code>:set -XMonomorphismRestriction</code>, all variants will get the same result.</p>\n"}], "owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 45635576, "answer_count": 2, "score": 4, "last_activity_date": 1502457510, "creation_date": 1502452943, "last_edit_date": 1502457510, "question_id": 45634776, "link": "https://stackoverflow.com/questions/45634776/function-return-type-not-enforced", "title": "Function return type not enforced", "body": "<p>I would be very thankful if someone patient enough explained to me the situation below. It seems to me as if Haskell were ready to perform some kind of integral type coercion when returning a value from a function. On the other hand, I have read that Haskell does never convert a type implicitly.</p>\n\n<p>If I type in GHCi:</p>\n\n<pre><code>&gt; import Data.Word\n&gt; let t :: (Integer, Word32); \n      t = let { y = fromIntegral (-1)     -- line breaks added for readability\n              ; y' :: Integer \n              ; y' = fromIntegral y } in (y', y)\n</code></pre>\n\n<p>GHCi tells me later that <code>t = (-1,4294967295)</code>. But if I constrain the local <code>y</code> type specifically to <code>Word32</code>:</p>\n\n<pre><code>&gt; let t :: (Integer, Word32); \n      t = let { y :: Word32\n              ; y = fromIntegral (-1)     -- line breaks added for readability\n              ; y' :: Integer\n              ; y' = fromIntegral y } in (y', y)\n</code></pre>\n\n<p>GHCi will tell me that <code>t = (4294967295,4294967295)</code>.</p>\n\n<p>I thought that if <code>t</code>'s type is stated explicite as <code>(Integer, Word32)</code>, GHCi will conclude that <code>y' :: Integer</code> and <code>y :: Word32</code> since the function result is <code>(y', y)</code>. Then, the type definition <code>y :: Word32</code> would be completely unnecessary.</p>\n\n<p>This all started when I tried to write a function to \"safely\" convert between Integral class members - e.g. Int -> Word32. That function was meant to return <code>Just 1</code> when passed <code>1</code> and <code>Nothing</code> when passed <code>-1</code>.</p>\n\n<p>A short search through SO and internet overall didn't provide me with any explanation.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 5, "creation_date": 1502445488, "post_id": 45632218, "comment_id": 78223464, "body": "As instance, <code>filter ((||) &lt;$&gt; isZero &lt;*&gt; isOne) [0..100]</code>. Lift <code>(||)</code> to an Applicative functor like this: <code>(&lt;||&gt;) = liftA2 (||)</code>. And then use: <code>filter (isZero &lt;||&gt; isOne &lt;||&gt; ...) ...</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 7, "creation_date": 1502456290, "post_id": 45632218, "comment_id": 78230762, "body": "Note that <code>(||) &lt;$&gt; isZero &lt;*&gt; isOne</code> is 25 chars, and <code>\\x -&gt; isZero x || isOne x</code> is 25 chars. I&#39;d stick with the pointful version, which is easier to read by humans."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1502457548, "post_id": 45632218, "comment_id": 78231572, "body": "@freestyle I love <code>&lt;||&gt;</code>. Hoping it&#39;s not use elsewhere with different meaning\u2026"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1502457936, "post_id": 45632218, "comment_id": 78231817, "body": "@Bergi It already defined in some packages, for example: control-bool, classy-prelude."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1502458093, "post_id": 45632218, "comment_id": 78231931, "body": "@chi I would also prefer pointful version."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 2, "creation_date": 1502503714, "post_id": 45632218, "comment_id": 78250831, "body": "@freestyle: I tend to spell <code>liftA2 (||)</code> as <code>.||.</code> because mnemonically there\u2019s a \u201cpoint\u201d on both sides. If you\u2019re really into APL-style tacit programming, you can add silly generalisations like <code>(..||..) = liftA2 (liftA2 (||))</code>, which allows things like <code>(&gt;=) = (&gt;) ..||.. (==)</code> (\u201c\u2018greater than or equal to\u2019 means \u2018greater than\u2019 or \u2018equal to\u2019\u201d)."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1502463697, "post_id": 45632417, "comment_id": 78235982, "body": "This doesn&#39;t explain how to scale this solution. I like @Rampion answer more because it explains how to use <code>liftA2 (||)</code> to write arbitrary number predications in point-free style."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 23, "last_activity_date": 1502450023, "last_edit_date": 1502450023, "creation_date": 1502445751, "answer_id": 45632417, "question_id": 45632218, "link": "https://stackoverflow.com/questions/45632218/how-would-i-write-this-function-in-point-free-style/45632417#45632417", "title": "How would I write this function in point-free style?", "body": "<p>There's a <a href=\"http://pointfree.io/\" rel=\"noreferrer\">online-service</a> for converting <code>Haskell</code> code to point-free.</p>\n\n<p>It suggests: <code>filter (liftM2 (||) isZero isOne) [0..100]</code></p>\n\n<p><code>liftA2 (||) isZero isOne</code> or <code>(||) &lt;$&gt; isZero &lt;*&gt; isOne</code> is also possible</p>\n\n<p><code>(||) &lt;$&gt; isZero</code> has type <code>a0 -&gt; Bool -&gt; Bool</code> and it's the composition of <code>(||)</code> and <code>isZero</code>. This composition takes a number (for <code>isZero</code>) and a boolean (as another argument for <code>(||)</code>)</p>\n\n<p>So, it's the same as <code>\\x y -&gt; (||) (isZero x) y</code></p>\n\n<p>The function type is an instance of <code>Applicative Functor</code> and we can look at its implementation:</p>\n\n<pre><code>instance Applicative ((-&gt;) r) where  \n    pure x = (\\_ -&gt; x)  \n    f &lt;*&gt; g = \\x -&gt; f x (g x)\n</code></pre>\n\n<p>So, <code>(||) &lt;$&gt; isZero &lt;*&gt; isOne</code> is the same as <code>\\x -&gt; ((||) &lt;$&gt; isZero) x (isOne x)</code> and the same as <code>\\x -&gt; (||) (isZero x) (isOne x)</code></p>\n\n<p>Thus, if there's <code>z x = y (f x) (g x)</code>, it can be transformed into point free: <code>z = y &lt;$&gt; f &lt;*&gt; g</code></p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 7, "last_activity_date": 1502462187, "creation_date": 1502462187, "answer_id": 45637823, "question_id": 45632218, "link": "https://stackoverflow.com/questions/45632218/how-would-i-write-this-function-in-point-free-style/45637823#45637823", "title": "How would I write this function in point-free style?", "body": "<p>An alternate point-free form would be to use the <code>a -&gt; Any</code> monoid:</p>\n\n<pre><code>\u03bb import Data.Monoid (Any(..))\n\u03bb :t getAny . (Any . isZero &lt;&gt; Any . isOne)\ngetAny . (Any . isZero &lt;&gt; Any . isOne)\n  :: (Num a, Eq a) =&gt; a -&gt; Bool\n\u03bb filter (getAny . (Any . isZero &lt;&gt; Any . isOne)) [0..100]\n[0,1]\n</code></pre>\n\n<p>It's a bit longer than the <code>Applicative</code> solution, but I think it's a little easier to follow when you have more conditions to combine. Compare</p>\n\n<pre><code>getAny . (Any . isZero &lt;&gt; Any . isOne &lt;&gt; Any . isSquare &lt;&gt; Any . isPrime)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>getAny . foldMap (Any .) [isZero, isOne, isSquare, isPrime]\n</code></pre>\n\n<p>and </p>\n\n<pre><code>liftA2 (||) (liftA2 (||) (liftA2 (||) isZero isOne) isSquare) isPrime\n</code></pre>\n\n<p>or</p>\n\n<pre><code>liftA2 (||) isZero $ liftA2 (||) isOne $ liftA2 (||) isSquare isPrime\n</code></pre>\n\n<p>Though to be honest, if I had lots of these to do, I'd be tempted to define <code>&lt;||&gt; = liftA2 (||)</code> and do</p>\n\n<pre><code>isZero &lt;||&gt; isOne &lt;||&gt; isSquare &lt;||&gt; isPrime\n</code></pre>\n"}], "owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1553, "favorite_count": 1, "answer_count": 2, "score": 19, "last_activity_date": 1502462187, "creation_date": 1502445274, "question_id": 45632218, "link": "https://stackoverflow.com/questions/45632218/how-would-i-write-this-function-in-point-free-style", "title": "How would I write this function in point-free style?", "body": "<p>I'm just looking to make general improvements to my Haskell code, and was wondering if the following function could be made point-free? Mostly for curiosity's sake.</p>\n\n<p>Given two functions which we'd like to use in our <code>filter</code>:</p>\n\n<pre><code>isZero = (==0)\nisOne = (==1)\n</code></pre>\n\n<p>How would we go about utilising those two functions in our contrived example, but making it point-free?</p>\n\n<pre><code>filter (\\x -&gt; isZero x || isOne x) [0..100]\n</code></pre>\n"}, {"tags": ["haskell", "xmonad"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 3, "creation_date": 1502416269, "post_id": 45625700, "comment_id": 78211200, "body": "It&#39;s <code>keys(def,x)</code>, but it&#39;s not clear what <code>def</code> is without context."}, {"owner": {"reputation": 980, "user_id": 3042952, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717b0592a18a7c6fc70f50172fddf3c?s=128&d=identicon&r=PG&f=1", "display_name": "Duncan X Simpson", "link": "https://stackoverflow.com/users/3042952/duncan-x-simpson"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1502416345, "post_id": 45625700, "comment_id": 78211222, "body": "@FyodorSoikin Okay, cool. If you could post an answer saying that, and explaining how you know it&#39;s not keys(def(x)), I&#39;ll upvote and accept."}, {"owner": {"reputation": 980, "user_id": 3042952, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717b0592a18a7c6fc70f50172fddf3c?s=128&d=identicon&r=PG&f=1", "display_name": "Duncan X Simpson", "link": "https://stackoverflow.com/users/3042952/duncan-x-simpson"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1502417490, "post_id": 45625700, "comment_id": 78211451, "body": "If you&#39;re curious about the context, here&#39;s the link. I just wanted the question to be answered without depending on the context so I could understand the language better. <a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Doc-Extending.html#g:10\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/xmonad-contrib-0.13/docs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 980, "user_id": 3042952, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717b0592a18a7c6fc70f50172fddf3c?s=128&d=identicon&r=PG&f=1", "display_name": "Duncan X Simpson", "link": "https://stackoverflow.com/users/3042952/duncan-x-simpson"}, "edited": false, "score": 0, "creation_date": 1502416641, "post_id": 45625786, "comment_id": 78211281, "body": "I understand that, but couldn&#39;t def be a function that takes x as an argument, making it keys(def(x))?"}, {"owner": {"reputation": 980, "user_id": 3042952, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717b0592a18a7c6fc70f50172fddf3c?s=128&d=identicon&r=PG&f=1", "display_name": "Duncan X Simpson", "link": "https://stackoverflow.com/users/3042952/duncan-x-simpson"}, "edited": false, "score": 0, "creation_date": 1502416897, "post_id": 45625786, "comment_id": 78211335, "body": "Perfect! Thank you!"}, {"owner": {"reputation": 980, "user_id": 3042952, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717b0592a18a7c6fc70f50172fddf3c?s=128&d=identicon&r=PG&f=1", "display_name": "Duncan X Simpson", "link": "https://stackoverflow.com/users/3042952/duncan-x-simpson"}, "edited": false, "score": 0, "creation_date": 1502417389, "post_id": 45625786, "comment_id": 78211424, "body": "Wow, the last paragraph is really interesting."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1502425079, "post_id": 45625786, "comment_id": 78213046, "body": "<code>def</code> is from <a href=\"https://hackage.haskell.org/package/data-default-0.7.1.1/docs/Data-Default.html#v:def\" rel=\"nofollow noreferrer\"><code>data-default</code></a>."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 10, "last_activity_date": 1502417631, "last_edit_date": 1502417631, "creation_date": 1502416542, "answer_id": 45625786, "question_id": 45625700, "link": "https://stackoverflow.com/questions/45625700/what-is-this-expression-in-haskell-and-how-do-i-interpret-it/45625786#45625786", "title": "What is this expression in Haskell, and how do I interpret it?", "body": "<p>It's <code>keys(def,x)</code>.</p>\n\n<p>This is basic Haskell syntax for function application: first the function itself, then its arguments separated by spaces. For example:</p>\n\n<pre><code>f x y = x + y\nz = f 5 6 \n-- z = 11\n</code></pre>\n\n<p>However, it is not clear what <code>def</code> is without larger context.</p>\n\n<p>In response to your comment: no, <code>def</code> couldn't be a function that takes <code>x</code> as argument, and then the result of that is passed to <code>keys</code>. This is because function application is left-associative, which basically means that in any bunch of things separated by spaces, only the first one is the function being applied, and the rest are its arguments. In order to express <code>keys(def(x))</code>, one would have to write <code>keys (def x)</code>.</p>\n\n<p>If you want to be super technical, then the right way to think about it is that <em>all functions have exactly one parameter</em>. When we declare a function of two parameters, e.g. <code>f x y = x + y</code>, what we really mean is that it's a function of one parameter, which returns another function, to which we can then pass the remaining parameter. In other words, <code>f 5 6</code> means <code>(f 5) 6</code>. </p>\n\n<p>This idea is kind of one of the core things in Haskell (and any ML offshoot) syntax. It's so important that it has its own name - \"currying\" (after Haskell Curry, the mathematician).</p>\n"}], "owner": {"reputation": 980, "user_id": 3042952, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717b0592a18a7c6fc70f50172fddf3c?s=128&d=identicon&r=PG&f=1", "display_name": "Duncan X Simpson", "link": "https://stackoverflow.com/users/3042952/duncan-x-simpson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 45625786, "answer_count": 1, "score": 1, "last_activity_date": 1503007093, "creation_date": 1502415725, "last_edit_date": 1503007093, "question_id": 45625700, "link": "https://stackoverflow.com/questions/45625700/what-is-this-expression-in-haskell-and-how-do-i-interpret-it", "title": "What is this expression in Haskell, and how do I interpret it?", "body": "<p>I'm learning basic Haskell so I can configure Xmonad, and I ran into this code snippet:</p>\n\n<pre><code>newKeys x  = myKeys x `M.union` keys def x\n</code></pre>\n\n<p>Now I understand what the <code>M.union</code> in backticks is and means. Here's how I'm interpreting it:</p>\n\n<pre><code>newKeys(x) = M.union(myKeys(x),???)\n</code></pre>\n\n<p>I don't know what to make of the <code>keys def x</code>. Is it like <code>keys(def(x))</code>? Or <code>keys(def,x)</code>? Or is <code>def</code> some sort of other keyword?</p>\n"}, {"tags": ["haskell", "vector", "pattern-matching"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1502408391, "post_id": 45624790, "comment_id": 78209515, "body": "Well, it&#39;s just a different style of defining the same thing. What exactly is your question?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1502443947, "post_id": 45624790, "comment_id": 78222433, "body": "As a general advice, I&#39;d recommend to learn to use pattern matching as much as possible, at least at the beginner level. The alternative with <code>fst,snd</code> is OK, but here on SO I&#39;ve seen too many beginners to use dangerous functions like <code>head,tail,fromJust</code>, which often lead to crashes, when pattern matching is much safer, especially when warnings are turned on with <code>-Wall</code> (strongly recommended)."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1502422342, "post_id": 45625154, "comment_id": 78212452, "body": "This is true, but probably much too subtle to be useful to OP or anyone who lands on this question from Google."}, {"owner": {"reputation": 67, "user_id": 4416730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f94d1b8d6530041b521a2e503e7ee9ee?s=128&d=identicon&r=PG", "display_name": "Zhengqun Koo", "link": "https://stackoverflow.com/users/4416730/zhengqun-koo"}, "edited": false, "score": 0, "creation_date": 1502424045, "post_id": 45625154, "comment_id": 78212799, "body": "Thanks for understanding the question - I didn&#39;t phrase it well because I didn&#39;t know Haskell! Maybe I should follow the <a href=\"https://www.haskell.org/tutorial/patterns.html\" rel=\"nofollow noreferrer\">official tutorial</a> instead."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 7, "last_activity_date": 1502410649, "last_edit_date": 1502410649, "creation_date": 1502410267, "answer_id": 45625154, "question_id": 45624790, "link": "https://stackoverflow.com/questions/45624790/haskell-pattern-match-vectors/45625154#45625154", "title": "Haskell Pattern Match Vectors", "body": "<p>They differ in strictness. Suppose we rename them:</p>\n\n<pre><code>&gt; let addVectorsStrict (x1, y1) (x2, y2) = (x1 + x2, y1 + y2)\n&gt; let addVectorsLazy a b = (fst a + fst b, snd a + snd b)\n</code></pre>\n\n<p><code>addVectorsStrict undefined undefined</code> is <code>undefined</code>\u2014the pattern matching is performed as soon as the outer <code>(,)</code> constructor of the result is demanded:</p>\n\n<pre><code>&gt; case addVectorsStrict (error \"A\") (error \"B\") of (_, _) -&gt; ()\n*** Exception: A\n</code></pre>\n\n<p>But <code>addVectorsLazy undefined undefined</code> is <code>(undefined, undefined)</code>\u2014the pattern matching is deferred until one of the <em>elements</em> of the result is demanded.</p>\n\n<pre><code>&gt; case addVectorsLazy (error \"A\") (error \"B\") of (_, _) -&gt; ()\n()\n</code></pre>\n\n<p>Basically, <code>addVectorsLazy</code> always returns a tuple, where the elements may be unevaluated. <code>addVectorsStrict</code> may not return. You can also get the effect of <code>addVectorsLazy</code> using a lazy pattern match:</p>\n\n<pre><code>&gt; let addVectorsAlsoLazy ~(x1, y1) ~(x2, y2) = (x1 + x2, y1 + y2)\n&gt; case addVectorsAlsoLazy (error \"A\") (error \"B\") of (_, _) -&gt; ()\n()\n</code></pre>\n\n<p>To get a better understanding of evaluation order, you can observe it using <code>Debug.Trace.trace</code>:</p>\n\n<pre><code>addVectors\n  (trace \"first tuple evaluated\"\n    (trace \"x1 evaluated\" 1, trace \"y1 evaluated\" 2))\n  (trace \"second tuple evaluated\"\n    (trace \"x2 evaluated\" 3, trace \"y2 evaluated\" 4))\n</code></pre>\n\n<p>The basic thing to remember about evaluation in Haskell is that it\u2019s driven by pattern matching using <code>case</code> and function equations (which desugar to <code>case</code>).</p>\n\n<p>It doesn\u2019t matter much in this case, but you can write your functions lazily to avoid evaluating expensive computations if their results are never needed, or strictly to avoid the overhead of thunks if you know some result will <em>always</em> be needed.</p>\n\n<p>In general, it\u2019s a good idea to make the fields of your <em>data structures</em> strict unless you need them to be lazy, and make your <em>functions</em> lazy unless you need them to be strict. Here you could make a strict pair type to represent your vectors:</p>\n\n<pre><code>data Vector a = Vector !a !a\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 4416730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f94d1b8d6530041b521a2e503e7ee9ee?s=128&d=identicon&r=PG", "display_name": "Zhengqun Koo", "link": "https://stackoverflow.com/users/4416730/zhengqun-koo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 45625154, "answer_count": 1, "score": 3, "last_activity_date": 1502410649, "creation_date": 1502407214, "question_id": 45624790, "link": "https://stackoverflow.com/questions/45624790/haskell-pattern-match-vectors", "title": "Haskell Pattern Match Vectors", "body": "<p>I'm following an online <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">tutorial on Haskell</a>. We define a function to add two-dimensional vectors, represented by tuple pairs of numbers. The following is the explicit type declaration, that ensures both inputs are two-dimensional vectors.</p>\n\n<pre><code>addVectors :: (Num a) =&gt; (a, a) -&gt; (a, a) -&gt; (a, a)\n</code></pre>\n\n<p>I understand why the following function definition uses pattern matching: it describes the patterns that input data should conform to.</p>\n\n<pre><code>addVectors (x1, y1) (x2, y2) = (x1 + x2, y1 + y2)  \n</code></pre>\n\n<p>Why does the following alternative function definition not use pattern matching? (fst) and (snd) are guaranteed to work, because the inputs are explicitly declared to be tuples of length two.</p>\n\n<p>What is the difference between the two function definitions?</p>\n\n<pre><code>addVectors a b = (fst a + fst b, snd a + snd b)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502381670, "post_id": 45618634, "comment_id": 78196840, "body": "I tried the approach you suggested with <code>ALens&#39;</code> but I&#39;m getting a different error now: <code>Couldn&#39;t match type \u2018s\u2019 with \u2018ALens (ALens&#39; s a) t0 a b0\u2019        \u2018s\u2019 is a rigid type variable bound by          the type signature for:            applyUpdater :: forall s a. [ALens&#39; s a] -&gt; s -&gt; s -&gt; s          at &#47;Users&#47;saurabhnanda&#47;projects&#47;vl-haskell&#47;.stack-work&#47;intero&#47;i&zwnj;&#8203;ntero54587Sfx.hs:10:&zwnj;&#8203;17        Expected type: [(s -&gt; a, a -&gt; s -&gt; s)]          Actual type: [(ALens (ALens&#39; s a) t0 a b0 -&gt; a, a -&gt; s -&gt; s)]</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502382037, "post_id": 45618634, "comment_id": 78197084, "body": "There&#39;s another problem with your code, namely you&#39;ve partially-applied <code>^.</code>, respectively <code>^#</code>, the wrong way around. Does is work with <code>DL.map (flip (^#)) fields</code>?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502382122, "post_id": 45618634, "comment_id": 78197143, "body": "<code>applyUpdater</code> compiles with the <code>flip</code>, but actually using it still causes a type error. eg: <code>testUpdater existingUser incomingUser = applyUpdater [email, notificationEnabled] existingUser incomingUser</code> results in <code>Couldn&#39;t match type \u2018Bool\u2019 with \u2018[Char]\u2019          arising from a functional dependency between:            constraint \u2018HasNotificationEnabled User String\u2019              arising from a use of \u2018notificationEnabled\u2019            instance \u2018HasNotificationEnabled User Bool\u2019</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502382284, "post_id": 45618634, "comment_id": 78197242, "body": "Uh, you want to put <i>lenses to different-typed fields in a single list</i>? It shouldn&#39;t surprise you that this doesn&#39;t work, right?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502382724, "post_id": 45618634, "comment_id": 78197468, "body": "Can this be done by tuples instead?  Something like <code>applyUpdater2</code> <code>applyUpdater3</code>, <code>applyUpdater4</code>, etc?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502382929, "post_id": 45618634, "comment_id": 78197578, "body": "It seems to be working with tuples. Would you know how to make this code shorter? <code>applyUpdater2 (f1, f2) existing incoming = (storing f2 (incoming ^# f2)) $ (storing f1 (incoming ^# f1) existing)</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502383482, "post_id": 45618634, "comment_id": 78197915, "body": "Well... use shorter variable names? But really, I don&#39;t think it&#39;s sensible to wrap these things in a fixed-length <i>tuple</i>. Do use a list, but store only the concrete-updater form that doesn&#39;t mention the updated-element-type anymore."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1502383243, "last_edit_date": 1502383243, "creation_date": 1502381306, "answer_id": 45618634, "question_id": 45618101, "link": "https://stackoverflow.com/questions/45618101/how-to-treat-a-lens-or-any-other-optic-as-a-getter-and-setter-simultaneously/45618634#45618634", "title": "How to treat a lens (or any other optic) as a getter and setter simultaneously?", "body": "<p>First, note that <code>(^.)</code> takes the lens as its <em>right</em> argument, so what you really want is actually <code>getters = DL.map (flip (^.)) fields</code>, aka <code>DL.map view field</code>.</p>\n\n<p>But the more interesting problem here: optics require higher-rank polymorphism, so GHC can only <em>guess</em> types. Always <em>start out</em> with the type signature for this reason!</p>\n\n<p>Na\u00efvely, you would probably write</p>\n\n<pre><code>applyUpdater :: [Lens' s a] -&gt; s -&gt; s -&gt; s\n</code></pre>\n\n<p>Well, that doesn't actually work, because <code>Lens'</code> includes a <code>\u2200</code> quantifier so putting it in a list <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism\" rel=\"nofollow noreferrer\">would require impredicative polymorphism, which GHC isn't really capable of</a>. Common problem, so the lens library has two ways of getting around that:</p>\n\n<ul>\n<li><p><a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#t:ALens\" rel=\"nofollow noreferrer\"><code>ALens</code></a> is just a specific instantiation of the <code>Functor</code> constraint, chosen so you retain the full generality. You need to use different combinators for applying it, however.</p>\n\n<pre><code>applyUpdater :: [ALens' s a] -&gt; s -&gt; s -&gt; s\napplyUpdater fields existing incoming =\n let getters = DL.map (flip (^#)) fields\n     setters = DL.map storing fields\n     updaters = DL.zipWith (,) getters setters\n in DL.foldl' (\\upd (\u03b3, \u03c3) -&gt; \u03c3 (\u03b3 incoming) upd) existing updaters\n</code></pre>\n\n<p>Because <code>ALens</code> is strictly an instantiation of <code>Lens</code>, you can use that exactly the way you intended.</p></li>\n<li><p><a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Reified.html#t:ReifiedLens\" rel=\"nofollow noreferrer\"><code>ReifiedLens</code></a> keeps the original polymorphism, but wraps it in a newtype so the lenses can be stored in e.g. a list. The wrapped lens can then be used as usual, but you'll need to explicitly wrap them to pass into your function; this is probably not worth the hassle for your application. This approach is more useful when you want to re-use the stored lenses in a less direct manner. (This can also be done with <code>ALens</code>, but it requires <code>cloneLens</code> which I reckon is bad for performance.)</p></li>\n</ul>\n\n<p><code>applyUpdater</code> will now work the way I explained with <code>ALens'</code>, however it can only be used with a lists of lenses <em>all focusing of fields of the same type</em>. Putting lenses focusing on fields of <em>different</em> type in a list is quite clearly a type error. To accomplish that, you <em>must</em> wrap the lenses in some newtype to hide the type parameter \u2013 no way around it, it's simply not possible to unify the types of <code>email</code> and <code>notificationEnabled</code> to something you can stuff in one single list.</p>\n\n<p>But before going through that trouble, I would strongly consider <em>not</em> storing any lenses in a list at all: basically what is just composing update-functions that all access a shared reference. Well, do that directly \u2013 \u201call accessing a shared reference\u201d is, conveniently, exactly what the function monad offers you, so it's trivial to write</p>\n\n<pre><code>applyUpdater :: [s -&gt; r -&gt; s] -&gt; s -&gt; r -&gt; s\napplyUpdater = foldr (&gt;=&gt;) pure\n</code></pre>\n\n<p>To convert a lens to an individual updater-function, write</p>\n\n<pre><code>mkUpd :: ALens' s a -&gt; s -&gt; s -&gt; s\nmkUpd l exi inc = storing l (inc^#l) exi\n</code></pre>\n\n<p>to be used like</p>\n\n<pre><code>applyUpdater \n  [mkUpd email, mkUpd notificationEnabled]\n  User{name=\"saurabh\", email=\"blah@blah.com\", notificationEnabled=True}\n  User{name=\"saurabh\", email=\"foo@bar.com\", notificationEnabled=False}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "is_accepted": false, "score": 0, "last_activity_date": 1502428045, "creation_date": 1502428045, "answer_id": 45627345, "question_id": 45618101, "link": "https://stackoverflow.com/questions/45618101/how-to-treat-a-lens-or-any-other-optic-as-a-getter-and-setter-simultaneously/45627345#45627345", "title": "How to treat a lens (or any other optic) as a getter and setter simultaneously?", "body": "<p>Based off @leftaroundabout 's answer, there's an approach based on tuples as well:</p>\n\n<pre><code>applyUpdater2 (f1, f2) existing incoming = (storing f2 (incoming ^# f2)) $ (storing f1 (incoming ^# f1) existing)\napplyUpdater3 (f1, f2, f3) existing incoming = (storing f3 (incoming ^# f3)) $ (applyUpdater2 (f1, f2) existing incoming)\napplyUpdater4 (f1, f2, f3, f4) existing incoming = (storing f4 (incoming ^# f4)) $ (applyUpdater3 (f1, f2, f3) existing incoming)\n-- and so on\n</code></pre>\n\n<p>Which can be used in the following manner:</p>\n\n<pre><code>testUpdater :: User -&gt; User -&gt; User\ntestUpdater existingUser incomingUser = applyUpdater2 (email, notificationEnabled) existingUser incomingUser\n</code></pre>\n\n<p>Setting up <code>applyUpdaterN</code> till, say 32-tuples, should be easy enough. After that, it all boils down to personal preference and actual use-cases. You <em>may</em> prefer not having to wrap your updaters with <code>mkUpd</code> at every call site. On the other hand, if you want to generate the <code>updaters</code> list dynamically, then working with lists is easier than working with tuples.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 45618634, "answer_count": 2, "score": 2, "last_activity_date": 1502428045, "creation_date": 1502379614, "question_id": 45618101, "link": "https://stackoverflow.com/questions/45618101/how-to-treat-a-lens-or-any-other-optic-as-a-getter-and-setter-simultaneously", "title": "How to treat a lens (or any other optic) as a getter and setter simultaneously?", "body": "<p>I'm trying to write a generic record updater which will allow one to easily update fields in an <code>existing</code> record, with fields in a similarly shaped <code>incoming</code> record. Here is what I have till now:</p>\n\n<pre><code>applyUpdater fields existing incoming =\n  let getters = DL.map (^.) fields\n      setters = DL.map set fields\n      updaters = DL.zipWith (,) getters setters\n  in DL.foldl' (\\updated (getter, setter) -&gt; setter (getter incoming) updated) existing updaters\n</code></pre>\n\n<p>And I wish to use it in the following manner:</p>\n\n<pre><code>applyUpdater \n  [email, notificationEnabled] -- the fields to be copied from incoming =&gt; existing (this obviously assumed that `name` and `email` lenses have already been setup\n  User{name=\"saurabh\", email=\"blah@blah.com\", notificationEnabled=True}\n  User{name=\"saurabh\", email=\"foo@bar.com\", notificationEnabled=False}\n</code></pre>\n\n<p>This doesn't work, probably because Haskell infers a very weird type signature for <code>applyUpdater</code> which means it it not doing what I'm expecting it to do:</p>\n\n<pre><code>applyUpdater :: [ASetter t1 t1 a t] -&gt; t1 -&gt; Getting t (ASetter t1 t1 a t) t -&gt; t1\n</code></pre>\n\n<p>Here's a code-sample and the compile error:</p>\n\n<pre><code>module TryUpdater where\nimport Control.Lens\nimport GHC.Generics\nimport Data.List as DL\n\ndata User = User {_name::String, _email::String, _notificationEnabled::Bool} deriving (Eq, Show, Generic)\nmakeLensesWith classUnderscoreNoPrefixFields ''User\n\n-- applyUpdater :: [ASetter t1 t1 a t] -&gt; t1 -&gt; Getting t (ASetter t1 t1 a t) t -&gt; t1\napplyUpdater fields existing incoming =\n  let getters = DL.map (^.) fields\n      setters = DL.map set fields\n      updaters = DL.zipWith (,) getters setters\n  in DL.foldl' (\\updated (getter, setter) -&gt; setter (getter incoming) updated) existing updaters\n\ntestUpdater :: User -&gt; User -&gt; User\ntestUpdater existingUser incomingUser = applyUpdater [email, notificationEnabled] existingUser incomingUser\n</code></pre>\n\n<p>Compile error:</p>\n\n<pre><code>18  62 error           error:\n \u2022 Couldn't match type \u2018Bool\u2019 with \u2018[Char]\u2019\n     arising from a functional dependency between:\n       constraint \u2018HasNotificationEnabled User String\u2019\n         arising from a use of \u2018notificationEnabled\u2019\n       instance \u2018HasNotificationEnabled User Bool\u2019\n         at /Users/saurabhnanda/projects/vl-haskell/.stack-work/intero/intero54587Sfx.hs:8:1-51\n \u2022 In the expression: notificationEnabled\n   In the first argument of \u2018applyUpdater\u2019, namely\n     \u2018[email, notificationEnabled]\u2019\n   In the expression:\n     applyUpdater [email, notificationEnabled] existingUser incomingUser (intero)\n18  96 error           error:\n \u2022 Couldn't match type \u2018User\u2019\n                  with \u2018(String -&gt; Const String String)\n                        -&gt; ASetter User User String String\n                        -&gt; Const String (ASetter User User String String)\u2019\n   Expected type: Getting\n                    String (ASetter User User String String) String\n     Actual type: User\n \u2022 In the third argument of \u2018applyUpdater\u2019, namely \u2018incomingUser\u2019\n   In the expression:\n     applyUpdater [email, notificationEnabled] existingUser incomingUser\n   In an equation for \u2018testUpdater\u2019:\n       testUpdater existingUser incomingUser\n         = applyUpdater\n             [email, notificationEnabled] existingUser incomingUser (intero)\n</code></pre>\n"}, {"tags": ["haskell", "dependent-type", "type-families"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1502379531, "post_id": 45617893, "comment_id": 78195387, "body": "Are you saying that your JSON storage determines what <code>c</code> is? Or is <code>c</code> determined by the static structure of the code?"}, {"owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1502381877, "post_id": 45617893, "comment_id": 78196971, "body": "<code>c</code> is a service on which we can run the request. For example S3, or Google"}], "answers": [{"comments": [{"owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1502386622, "post_id": 45618248, "comment_id": 78199846, "body": "Thanks for that simple solution. Is it possible to have a generic function that constructs SomeAuth? Something like <code>mkSomeAuth :: Auth c -&gt; SomeAuth</code>"}, {"owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1502387175, "post_id": 45618248, "comment_id": 78200147, "body": "To be more specific I am going with adding CTags in SomeAuth, so I guess the question is how to go from <code>(Auth c) -&gt; CTag c</code>"}, {"owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1502400718, "post_id": 45618248, "comment_id": 78207160, "body": "I went back to play around with adding <code>Typable</code> as a constraint and I&#39;m a bit lost. Could you point to an example?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1502413069, "post_id": 45618248, "comment_id": 78210515, "body": "@whitehead, if I get a chance. Things are a bit crazy right now."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1502380143, "creation_date": 1502380143, "answer_id": 45618248, "question_id": 45617893, "link": "https://stackoverflow.com/questions/45617893/how-to-validate-type-family-after-storing-it-in-json/45618248#45618248", "title": "How to validate type family after storing it in json?", "body": "<p>Given a <code>SomeAuth</code> and a <code>SomeReq</code>, you have no way to find out whether the types they wrap are the same. If there are finitely many possibilities (a finite \"universe\"), then you can use a GADT to tag them:</p>\n\n<pre><code>data CTag c where\n  C1T :: CTag C1\n  C2T :: CTag C2\n  ...\n</code></pre>\n\n<p>sticking a <code>CTag</code> in <code>SomeAuth</code> and one in <code>SomeReq</code> and pattern matching.</p>\n\n<p>If <code>c</code> could be any old thing, your best bet is to use <code>Data.Typeable</code>, adding a <code>Typeable</code> constraint to the <code>SomeAuth</code> and <code>SomeReq</code> constructors. Once you open them both, you'll be able to find out if the types match, and if so get evidence of it.</p>\n"}], "owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 45618248, "answer_count": 1, "score": 1, "last_activity_date": 1502381027, "creation_date": 1502379004, "last_edit_date": 1502381027, "question_id": 45617893, "link": "https://stackoverflow.com/questions/45617893/how-to-validate-type-family-after-storing-it-in-json", "title": "How to validate type family after storing it in json?", "body": "<p>The following code won't compile and gives the error of</p>\n\n<blockquote>\n  <p>Couldn't match type \u2018c1\u2019 with \u2018c\u2019\n        \u2018c1\u2019 is a rigid type variable bound by\n          a pattern with constructor:\n            SomeReq :: forall c. Conn c => Req c -> SomeReq,\n          in an equation for \u2018run\u2019</p>\n</blockquote>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\nmodule Main where\n\nimport qualified Data.Text as T\n\nclass Conn c where\n  data Auth c :: *\n  data Env c :: *\n  data Req c :: *\n\n  getEnv :: Auth c -&gt; IO (Env c)\n  runReq :: Env c -&gt; Req c -&gt; IO String\n\ndata SomeAuth = forall c. (Conn c) =&gt; SomeAuth (Auth c)\ndata SomeReq = forall c. (Conn c) =&gt; SomeReq (Auth c)\n\nrun :: SomeAuth -&gt; SomeReq -&gt; IO String\nrun (SomeAuth auth) (SomeReq req) = do\n  env &lt;- getEnv auth\n  runReq env req\n\nmain :: IO ()\nmain = return ()\n</code></pre>\n\n<p>The reason for the existentials is that I need to store these data types in json. <code>(Auth c)</code> and <code>(Req c)</code> are always stored seperatly, but are always used together.</p>\n\n<p>I'm assuming that the only possible way to make this work is to have some kind of runtime check to validate that these types match up. I'm not sure how to do that though.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1502373200, "post_id": 45608749, "comment_id": 78190223, "body": "Okay, I&#39;ll ask the obvious counter-question: why would you expect <code>fmap f []</code> and <code>fmap f (return [])</code> to do the same thing?"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 2, "last_activity_date": 1502357915, "last_edit_date": 1502357915, "creation_date": 1502355590, "answer_id": 45609022, "question_id": 45608749, "link": "https://stackoverflow.com/questions/45608749/why-it-has-to-be-a-monad/45609022#45609022", "title": "Why it has to be a monad?", "body": "<p>In your first example <code>fmap ((:) 3) []</code> has type <code>Num a =&gt; [[a]]</code>. <code>fmap f [] == []</code>.</p>\n\n<p>In contrast the type of <code>fmap ((:) 3) x</code> is <code>(Monad m, Num a) =&gt; m [a]</code>.<a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/interactive-evaluation.html\" rel=\"nofollow noreferrer\">GHCi deafults</a> <code>m</code> to <code>IO</code> so at the prompt it has type <code>Num a =&gt; IO [a]</code>. The corresponding IO action is evaluated and the result is printed if it is an instance of <code>Show</code>. <code>a</code> defaults to <code>Integer</code> and <code>[Integer]</code> has a <code>Show</code> instance so it is displayed.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 8, "last_activity_date": 1502357000, "creation_date": 1502357000, "answer_id": 45609542, "question_id": 45608749, "link": "https://stackoverflow.com/questions/45608749/why-it-has-to-be-a-monad/45609542#45609542", "title": "Why it has to be a monad?", "body": "<p><code>fmap</code> works on any <code>Functor</code>, including <code>[]</code>. Note how GHCi infers the type of your first expression:</p>\n\n<pre><code>Prelude&gt; :t fmap ((:) 3) []\nfmap ((:) 3) [] :: Num a =&gt; [[a]]\n</code></pre>\n\n<p>The return type is a nested list, because otherwise the cons operator (<code>:</code>) doesn't make sense. When you <code>fmap</code> over an empty list (<code>[]</code>), however, there's nothing to do, so the result is also the empty list.</p>\n\n<p>On the other hand, the type of your second expression is different:</p>\n\n<pre><code>Prelude&gt; x = return []\nPrelude&gt; :t x\nx :: Monad m =&gt; m [t]\nPrelude&gt; :t fmap ((:) 3) x\nfmap ((:) 3) x :: (Num a, Monad f) =&gt; f [a]\n</code></pre>\n\n<p>You'll notice that the return value is no longer a nested list, but a <code>Monad</code> over <code>[a]</code>. <code>Monad</code>, however, includes <code>Applicative</code>, which again includes <code>Functor</code>, so in this second expression, <code>fmap</code> is no longer the for the <code>[]</code> instance, but for <code>f</code>. As Lee points out, in GHCi, the default <code>Monad</code> is <code>IO</code>, so the <code>fmap</code> in <code>fmap ((:) 3) x</code> maps <code>IO</code>, not <code>[]</code>.</p>\n\n<p>This means that <code>x</code> actually becomes <code>IO []</code> in GHCi, and <code>fmap</code> in the <code>IO</code> monad applies the mapping function to the data contained inside of the monad (<code>[]</code>). This means that you get <code>((:) 3) []</code>, which is <code>[3]</code>:</p>\n\n<pre><code>Prelude&gt; ((:) 3) []\n[3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1502358842, "creation_date": 1502358842, "answer_id": 45610354, "question_id": 45608749, "link": "https://stackoverflow.com/questions/45608749/why-it-has-to-be-a-monad/45610354#45610354", "title": "Why it has to be a monad?", "body": "<pre><code>fmap ((:) 3) []\n</code></pre>\n\n<p>Would actually apply the <code>(:) 3</code> operator to the \"contents\" of your list functor. As you have no contents you normally get an empty list in return. If in case you had it like;</p>\n\n<pre><code>fmap ((:) 3) [[],[],[]]\n</code></pre>\n\n<p>then you would get <code>[[3],[3],[3]]</code> as the return value.</p>\n\n<p>Now if you chose to feed <code>fmap</code> with a list value. You may feed it with a list value \"wrapped\" into List value constructor like;</p>\n\n<pre><code>*Main&gt; fmap ((:) 3) $ return []\n[3]\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 45609542, "answer_count": 3, "score": 2, "last_activity_date": 1502358842, "creation_date": 1502354855, "question_id": 45608749, "link": "https://stackoverflow.com/questions/45608749/why-it-has-to-be-a-monad", "title": "Why it has to be a monad?", "body": "<p>I've tried following code snippet on prelude: </p>\n\n<pre><code>*ExerciseMonad Control.Monad&gt; :t fmap ((:) 3) []\n</code></pre>\n\n<p>and got as result an empty <code>[]</code>. </p>\n\n<p>Then I convert an empty list to <code>monad</code> structure: </p>\n\n<pre><code>*ExerciseMonad Control.Monad&gt; x = return []\n*ExerciseMonad Control.Monad&gt; :t x\nx :: Monad m =&gt; m [t]\n</code></pre>\n\n<p>the returned value is wrapped in <code>Monad</code> structure.</p>\n\n<p>It seems like a magic, that I do not get an empty list:</p>\n\n<pre><code>*ExerciseMonad Control.Monad&gt; fmap ((:) 3) x\n[3]\n</code></pre>\n\n<p>Why did not I get an empty list?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "mingw-w64"], "answers": [{"comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502376716, "post_id": 45616645, "comment_id": 78193157, "body": "It doesn&#39;t look like that&#39;s the case... When I copy that into my bash and run it, I get &quot;Could not understand these extra arguments: never&quot;"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502380894, "post_id": 45616645, "comment_id": 78196306, "body": "<code>--color never</code> is an option in tasty. Are you using another test framework?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1502381078, "post_id": 45616645, "comment_id": 78196445, "body": "test-framework has <code>--plain</code> instead. And in general you can try ask <code>--help</code> to the test executable."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502385102, "post_id": 45616645, "comment_id": 78198881, "body": "Thank you, <code>--plain</code> does remove the colouring. I did try <code>--help</code>, but that one escaped me."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1502713185, "post_id": 45616645, "comment_id": 78306119, "body": "I&#39;m going to accept this answer, although it&#39;s the next-best answer I had hoped for..."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1502386159, "last_edit_date": 1502386159, "creation_date": 1502375600, "answer_id": 45616645, "question_id": 45608617, "link": "https://stackoverflow.com/questions/45608617/stack-test-output-garbled-on-mingw64/45616645#45616645", "title": "Stack test output garbled on MINGW64", "body": "<p>Arguments can be passed to the test executable like this:</p>\n\n<pre><code>stack test --test-arguments \"--plain\"\n</code></pre>\n\n<p><code>--plain</code> is the option to remove colors in test-framework, while <code>--color never</code> is from tasty.</p>\n"}, {"comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1525323087, "post_id": 50143254, "comment_id": 87312454, "body": "Interesting. Unfortunately, it doesn&#39;t solve my issue, but thanks for sharing :)"}], "tags": [], "owner": {"reputation": 11, "user_id": 9731094, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "David Carter", "link": "https://stackoverflow.com/users/9731094/david-carter"}, "is_accepted": false, "score": 1, "last_activity_date": 1525294177, "last_edit_date": 1525294177, "creation_date": 1525293699, "answer_id": 50143254, "question_id": 45608617, "link": "https://stackoverflow.com/questions/45608617/stack-test-output-garbled-on-mingw64/50143254#50143254", "title": "Stack test output garbled on MINGW64", "body": "<p>I have been having this same issue on Windows 10, Git 2.17.0, with MINGW64 as the Git Bash shell.  Colors are fine until I run \"php artisan tinker\", after which colors cease and suddenly all output is garbled with the ANSI color codes.</p>\n\n<p>My solution turned out to be (it surprised me that it worked):  run Bash inside the Git Bash shell.</p>\n\n<p>Before:</p>\n\n<pre><code>$ php artisan tinker\n?[34mPsy Shell v0.7.2 (PHP 7.1.11 \u0393\u00c7\u00f6 cli) by Justin Hileman?[39m\n&gt;&gt;&gt; exit\n?[37;41mExit:  Goodbye.?[39;49m\n$\n</code></pre>\n\n<p>After:</p>\n\n<pre><code>$ bash\n$ php artisan tinker\nPsy Shell v0.7.2 (PHP 7.1.11 \u2014 cli) by Justin Hileman\n&gt;&gt;&gt; exit\nExit:  Goodbye.\n$\n</code></pre>\n\n<p>It's really a work-around, but it works. Maybe this is a clue to the actual underlying issue. Terminal type did not seem to matter (xterm, xterm-256, etc.) were all tried with little difference. </p>\n"}], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 45616645, "answer_count": 2, "score": 1, "last_activity_date": 1525294177, "creation_date": 1502354532, "question_id": 45608617, "link": "https://stackoverflow.com/questions/45608617/stack-test-output-garbled-on-mingw64", "title": "Stack test output garbled on MINGW64", "body": "<p>I'm running GHC using Stack on Windows 10, and using Git Bash (MINGW64) for much of my daily workflow. That includes using GHC and GHCi, which generally works fine.</p>\n\n<p>However, when I run <code>stack test</code> from MINGW64, the output is garbled by ANSI color codes:</p>\n\n<pre><code>$ stack test\nUC-0.1.0.0: test (suite: UC-test)\n\n[?25lSorting Group 1:\n\n[2K[1F  prop1: [[92mOK, passed 100 tests[0m]\n\n[2K[1F  prop2: [[92mOK, passed 100 tests[0m]\n\n         Properties  Total\n Passed  [92m2[0m           [92m2[0m\n Failed  0           0\n Total   [92m2[0m           [92m2[0m\n[?25h\n</code></pre>\n\n<p>Strangely, if I run <code>stack test</code> from the normal Windows console (<code>cmd</code>), it displays correctly:</p>\n\n<p><a href=\"https://i.stack.imgur.com/HvYxf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HvYxf.png\" alt=\"Correctly coloured test output in cmd\"></a></p>\n\n<p>I'd like to stick with my (Git) Bash console instead of having to use two separate console windows, so:</p>\n\n<ul>\n<li>Is it possible to get the colours to render correctly for <code>stack test</code> in MINGW64?</li>\n<li>Alternatively, can I turn off ANSI colouring for <code>stack test</code>, so that, at least, it's easier to read the output?</li>\n</ul>\n\n<p>I've also tried to run variations of <code>stack --color never test</code>, but it doesn't seem to make any difference.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 1, "creation_date": 1502351999, "post_id": 45607474, "comment_id": 78174136, "body": "<code>meh :: (Functor m, Monad m) =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]</code> your function returns a <code>m [b]</code> not a <code>[m b]</code>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1502354047, "post_id": 45607474, "comment_id": 78175472, "body": "<code>(Functor m, Monad m)</code> is redundant; you only need to put <code>Monad m</code>, since <code>Functor</code> is a requirement of <code>Monad</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 2, "last_activity_date": 1502353408, "last_edit_date": 1502353408, "creation_date": 1502352290, "answer_id": 45607848, "question_id": 45607474, "link": "https://stackoverflow.com/questions/45607474/get-wrong-result-by-substituting-through-value/45607848#45607848", "title": "Get wrong result by substituting through value", "body": "<p>According to the type, everything works fine</p>\n\n<pre><code>meh :: (Functor m, Monad m) =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]\n</code></pre>\n\n<p>If you're expecting <code>[Just 3, Just 4, Just 5]</code> you might need something like:</p>\n\n<pre><code>meh :: (Functor m, Monad m) =&gt; [a] -&gt; (a -&gt; m b) -&gt; [m b]\n</code></pre>\n\n<p>Or just</p>\n\n<pre><code>meh :: (Functor m) =&gt; [a] -&gt; (a -&gt; m b) -&gt; [m b]\n</code></pre>\n\n<p>Because you don't need the monad instance if you're not going to join values.</p>\n\n<pre><code>meh' :: (Functor m, Monad m) =&gt; [a] -&gt; (a -&gt; m b) -&gt; [m b]\nmeh' [] _ = []\nmeh' (x:xs) f =\n  (f x) : (meh' xs f)\n</code></pre>\n\n<p>Calling <code>meh' [3,4,5] Just</code> returns <code>[Just 3, Just 4, Just 5]</code></p>\n\n<p>Calling <code>meh [3,4,5] Just</code> returns <code>Just [3,4,5]</code></p>\n\n<p>Talking about a substitution (starting from the empty list):</p>\n\n<p><code>meh [] _ = Just []</code>, because <code>meh [] _ = return []</code> returns an empty list wrapped into a monadic structure (in this case <code>Maybe</code> monad)</p>\n\n<pre><code>meh (5:[]) (\\x -&gt; Just x) = do\n  x' &lt;- (\\x -&gt; Just x) 5\n  fmap ((:) x') (meh [] (\\x -&gt; Just x))\n</code></pre>\n\n<p>In this step <code>x' &lt;- (x -&gt; Just x) 5</code> binds <code>x'</code> to <code>5</code>. That's why <code>meh [5] Just</code> transforms into <code>fmap ((:) 5) (Just [])</code> that equals <code>Just [5]</code>, rather than <code>fmap ((:) (Just 5)) []</code> which indeed equals <code>[Just 5]</code></p>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 0, "last_activity_date": 1502354162, "last_edit_date": 1502354162, "creation_date": 1502352420, "answer_id": 45607899, "question_id": 45607474, "link": "https://stackoverflow.com/questions/45607474/get-wrong-result-by-substituting-through-value/45607899#45607899", "title": "Get wrong result by substituting through value", "body": "<p>As I commented before your type signature is wrong:\nIf you check the type for <code>[Just 1, Just 2, ...]</code> would be like <code>[m b]</code> not <code>m []</code>.</p>\n\n<p>Also, you cant simplify your function to:</p>\n\n<pre><code>meh :: (Functor m, Monad m) =&gt; [a] -&gt; (a -&gt; m b) -&gt; [m b]\nmeh l f = fmap f l\n</code></pre>\n\n<p>Here you have a <a href=\"https://repl.it/KE28/0\" rel=\"nofollow noreferrer\">life example</a></p>\n\n<p>Your substitution is wrong on this step:</p>\n\n<p><code>x' &lt;- f x</code></p>\n\n<p>Since you are working inside a monad you are binding (with <code>&lt;-</code>) to <code>x'</code> the Value inside \nthe monad (<code>Just</code> in this case) so 'x'' will be <code>3</code> (4, 5, ...) not <code>Just 3</code></p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 45607848, "answer_count": 2, "score": 1, "last_activity_date": 1502354162, "creation_date": 1502351106, "last_edit_date": 1502352702, "question_id": 45607474, "link": "https://stackoverflow.com/questions/45607474/get-wrong-result-by-substituting-through-value", "title": "Get wrong result by substituting through value", "body": "<p>I have following function:</p>\n\n<pre><code>meh :: (Functor m, Monad m) =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]\nmeh [] _ = return []\nmeh (x:xs) f = do\n  x' &lt;- f x\n  fmap ((:) x') (meh xs f)\n</code></pre>\n\n<p>then I try it out in prelude as follow and I've got:</p>\n\n<pre><code>*ExerciseMonad Control.Monad&gt; meh [3,4,5] (\\x -&gt; Just x)\nJust [3,4,5]\n</code></pre>\n\n<p>But I do expect <code>[Just 3, Just 4, Just 5]</code>.   </p>\n\n<p>To find out, what went wrong, I did substitution:</p>\n\n<pre><code>meh [3,4,5] (\\x -&gt; Just x) = Just [3,4,5]\n\nmeh (3:[4,5])] (\\x -&gt; Just x) =\n  Just 3 &lt;- (\\3 -&gt; Just 3)\n  fmap ((:) (Just 3)) (meh [4,5] (\\x -&gt; Just x))\n\nmeh (4:[5])] (\\x -&gt; Just x) =\n  Just 4 &lt;- (\\4 -&gt; Just 4)\n  fmap ((:) (Just 4)) (meh [5] (\\x -&gt; Just x))\n\nmeh ([5])] (\\x -&gt; Just x) =\n  Just 5 &lt;- (\\5 -&gt; Just 5]\n  fmap ((:) (Just 5)) (meh [] (\\x -&gt; Just x))\n\nmeh [] _ = return []  \n\n\n--all the way back\nmeh ([5])] (\\x -&gt; Just x) = fmap ((:) (Just 5)) []\nmeh (4:[5])] (\\x -&gt; Just x) = fmap ((:) (Just 4)) [Just 5] &lt;- result [Just 4, Just 5]\nmeh (3:[4,5])] (\\x -&gt; Just x) = fmap ((:) (Just 3)) [Just 4, Just 5] &lt;- result [Just 4, Just 5]\nmeh [3,4,5] (\\x -&gt; Just x) = [Just 3,Just 4, Just 5]\n</code></pre>\n\n<p>As you can see, the substitution does not match to the right result:</p>\n\n<pre><code>Just [3,4,5] != [Just 3,Just 4, Just 5]\n</code></pre>\n\n<p>My question, what did I wrong with the substitution? That I've got the wrong result? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1502351790, "post_id": 45605958, "comment_id": 78174026, "body": "<code>&lt;$&gt;</code> is <code>fmap</code> in functor and  <code>&lt;*&gt;</code> is a function defined in applicative class. The code <code>l2&#39; f a b = f &lt;$&gt; a &lt;*&gt; b</code> does , apply <code>fmap</code> to <code>a</code>, get function <code>(a-&gt;b)</code> back in context and apply it to value of b with <code>&lt;*&gt;</code> apply"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1502346675, "last_edit_date": 1502346675, "creation_date": 1502346280, "answer_id": 45605958, "question_id": 45605883, "link": "https://stackoverflow.com/questions/45605883/write-with-monad-bind-function/45605958#45605958", "title": "Write with monad bind function", "body": "<p>You forgot to add <code>return</code> around <code>f x y</code>. Let us have a look how to desugar <code>do</code>:</p>\n\n<pre><code>do                   --\n  x &lt;- foo           -- foo &gt;&gt;= (\\x -&gt;\n  bar                --   bar &gt;&gt; \n  foobar x           --     foobar x)\n</code></pre>\n\n<p>Note that we didn't remove anything. We just switched the arrows and added <code>bind</code>, if you want to read it like that. If we follow that approach, we can desugar your code equivalently:</p>\n\n<pre><code>do                   --  \n  x &lt;- a             --  a &gt;&gt;= (\\x -&gt;\n  y &lt;- b             --    b &gt;&gt;= (\\y -&gt;\n  return (f x y)     --      return (f x y)))\n</code></pre>\n\n<p>The <code>return</code> stays. It's not part of <code>do</code>'s sugar. We therefore end up with</p>\n\n<pre><code>l2' f a b = a &gt;&gt;= (\\x -&gt; b &gt;&gt;= (\\y -&gt; return (f x y)))\n</code></pre>\n\n<p>Remark: You don't need <code>Monad</code> to implement <code>l2'</code>, as long as your instance follow the monad and applicative laws. You can use <code>Applicative</code> instead:</p>\n\n<pre><code>l2' f a b = f &lt;$&gt; a &lt;*&gt; b\n</code></pre>\n\n<p><sub>Exercise: if you don't know <code>Applicative</code> yet, try to guess what <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> types might be (in the context of <code>Monad</code>).</sub></p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 45605958, "answer_count": 1, "score": 1, "last_activity_date": 1502346675, "creation_date": 1502346044, "last_edit_date": 1502346378, "question_id": 45605883, "link": "https://stackoverflow.com/questions/45605883/write-with-monad-bind-function", "title": "Write with monad bind function", "body": "<p>I have following function, that is written with <code>do</code> statement:</p>\n\n<pre><code>  l2 :: Monad m =&gt; (a -&gt; b -&gt; c) -&gt; m a -&gt; m b -&gt; m c\n  l2 f a b = do\n    x &lt;- a\n    y &lt;- b\n    return (f x y)\n</code></pre>\n\n<p>the <code>do</code> statement is the sugar of <code>&gt;&gt;=</code>, so I try to write it with operator:</p>\n\n<pre><code>  l2' :: Monad m =&gt; (a -&gt; b -&gt; c) -&gt; m a -&gt; m b -&gt; m c\n  l2' f a b = a &gt;&gt;= (\\x -&gt; b &gt;&gt;= (\\y -&gt; f x y))\n</code></pre>\n\n<p>and the compiler complains:  </p>\n\n<pre><code>D:\\haskell\\chapter18\\src\\ExerciseMonad.hs:159:41: error:\n    * Couldn't match expected type `m c' with actual type `c'\n      `c' is a rigid type variable bound by\n        the type signature for:\n          l2' :: forall (m :: * -&gt; *) a b c.\n                 Monad m =&gt;\n                 (a -&gt; b -&gt; c) -&gt; m a -&gt; m b -&gt; m c\n        at D:\\haskell\\chapter18\\src\\ExerciseMonad.hs:158:10\n    * In the expression: f x y\n      In the second argument of `(&gt;&gt;=)', namely `(\\ y -&gt; f x y)'\n      In the expression: b &gt;&gt;= (\\ y -&gt; f x y)\n    * Relevant bindings include\n        b :: m b\n          (bound at D:\\haskell\\chapter18\\src\\ExerciseMonad.hs:159:11)\n        a :: m a (bound at D:\\haskell\\chapter18\\src\\ExerciseMonad.hs:159:9)\n        f :: a -&gt; b -&gt; c\n          (bound at D:\\haskell\\chapter18\\src\\ExerciseMonad.hs:159:7)\n        l2' :: (a -&gt; b -&gt; c) -&gt; m a -&gt; m b -&gt; m c\n          (bound at D:\\haskell\\chapter18\\src\\ExerciseMonad.hs:159:3)\n</code></pre>\n\n<p>because the return value of <code>f</code> is not in monadic structure. How to improve?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 7, "creation_date": 1502324619, "post_id": 45602514, "comment_id": 78164459, "body": "These are not functions, they are <code>Bool</code>s. There is no such thing as a function with no arguments. And how did you end up with values <code>t1</code> through <code>t99</code> anyway, if not by typing them out by hand? Having 99 named, related variables is very strange indeed, and there is no particularly elegant way to work with them."}, {"owner": {"reputation": 1, "user_id": 8442465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e50f02e11268038601da95d8b1019c2?s=128&d=identicon&r=PG&f=1", "display_name": "JHoe", "link": "https://stackoverflow.com/users/8442465/jhoe"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1502324691, "post_id": 45602514, "comment_id": 78164476, "body": "right. thank you for that. i am new to haskell sorry"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1502327741, "post_id": 45602514, "comment_id": 78165214, "body": "What problem would this solve for you? What are you trying to do? I ask because this is an odd thing to want to do in Haskell and there may be a better way to do whatever you&#39;re <i>really</i> trying to do."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1502328784, "post_id": 45602514, "comment_id": 78165425, "body": "You could always just write a program that prints what you want, and then copy-paste it into your source code. Repetitive typing is for people who don&#39;t know how to program."}, {"owner": {"reputation": 1, "user_id": 8442465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e50f02e11268038601da95d8b1019c2?s=128&d=identicon&r=PG&f=1", "display_name": "JHoe", "link": "https://stackoverflow.com/users/8442465/jhoe"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1502346919, "post_id": 45602514, "comment_id": 78170970, "body": "@ReinHenrichs IT IS A series of test cases for other functions eg <code>t1 = mymaximum 1 2 == 2</code> so i want to check if my test cases work or not"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1502376263, "post_id": 45602514, "comment_id": 78192768, "body": "@JHoe then when you&#39;ll understand the basics of the language, you can have a look at Quickcheck. It might help you to generate test cases."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1502329674, "creation_date": 1502329674, "answer_id": 45603162, "question_id": 45602514, "link": "https://stackoverflow.com/questions/45602514/haskell-list-of-functions/45603162#45603162", "title": "Haskell list of functions", "body": "<p>If instead of <code>t0</code> through <code>t99</code>, you write</p>\n\n<pre><code>t 0 = 2 == 1+1\nt 1 = \"\" == []\n-- ...\nt 99 = 'a' == pred 'b'\n</code></pre>\n\n<p>then you can use <code>map t [0..99]</code> to apply <code>t</code> to the numbers <code>0</code> through <code>99</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 8442465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e50f02e11268038601da95d8b1019c2?s=128&d=identicon&r=PG&f=1", "display_name": "JHoe", "link": "https://stackoverflow.com/users/8442465/jhoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 45603162, "answer_count": 1, "score": -3, "last_activity_date": 1502329674, "creation_date": 1502324090, "question_id": 45602514, "link": "https://stackoverflow.com/questions/45602514/haskell-list-of-functions", "title": "Haskell list of functions", "body": "<p>I have many functions (no arguments ) like below and all return a Bool</p>\n\n<pre><code> t0 = 2 == (1+1)\n\n t1 = \"\" == []\n</code></pre>\n\n<p>And all the way up to t99</p>\n\n<p>Can I create a list with all these function results. An example is below but I have to type it all out...</p>\n\n<pre><code> tests = [t0,t1,t2,t3,t4,t5 ........... t99]\n</code></pre>\n\n<p>Can I do something with list comprehension to avoid typing that all out ??</p>\n\n<p>Thanks</p>\n"}]