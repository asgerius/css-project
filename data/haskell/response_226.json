[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 3, "creation_date": 1557350638, "post_id": 56049192, "comment_id": 98739892, "body": "Where is the monad? Please show a complete example that illustrates what you are trying to do."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1557350715, "post_id": 56049192, "comment_id": 98739916, "body": "Please make a complete, compiling example with all data structures and a syntactically valid definition of the value into which you want to zoom in."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1557350877, "post_id": 56049192, "comment_id": 98739977, "body": "What is Person, and what is <code>MyEmployment</code> supposed to be? You have several syntax issues here. Capitalization matters in Haskell; you need to distinguish between types, constructors, and functions more clearly."}, {"owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "edited": false, "score": 0, "creation_date": 1557350906, "post_id": 56049192, "comment_id": 98739991, "body": "Sure -- this is pseudocode that I wrote just to communicate what I&#39;m trying to get inside."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1557354505, "post_id": 56049192, "comment_id": 98741020, "body": "@reallymemorable Could you fix it please? Right now a lot of people here - including me - are quite confused about exactly what it is you&#39;re trying to communicate."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557355916, "post_id": 56049192, "comment_id": 98741376, "body": "What is <code>dmap</code>? <code>fmap</code> seems irrelevant, because you don&#39;t have any functors, let alone monads. All your types (<code>Employment</code>, <code>Person</code>, <code>MyEmployment</code>) have kind <code>*</code>, not <code>* -&gt; *</code> required for a functor."}, {"owner": {"reputation": 747, "user_id": 6933270, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AdXs.jpg?s=128&g=1", "display_name": "William Rusnack", "link": "https://stackoverflow.com/users/6933270/william-rusnack"}, "edited": false, "score": 1, "creation_date": 1557356703, "post_id": 56049192, "comment_id": 98741553, "body": "Just chatting with @reallymemorable on slack and he&#39;s working on his actual question"}], "answers": [{"tags": [], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "is_accepted": false, "score": 4, "last_activity_date": 1557352039, "creation_date": 1557352039, "answer_id": 56049484, "question_id": 56049192, "link": "https://stackoverflow.com/questions/56049192/manipulating-a-value-within-several-layers-of-monads/56049484#56049484", "title": "Manipulating a value within several layers of monads", "body": "<p>Apart from all the syntax issues, I think what you are trying to do is the following.</p>\n\n<p>This is how you declare a data type:</p>\n\n<pre><code>data Employment = Employment\n    { textVal1 :: Text\n    , textVal2 :: Text\n    , textVal3 :: Text\n    , numVal4  :: Money }\n</code></pre>\n\n<p>Note the <code>::</code>s which are not <code>=</code>, and note the indentation.</p>\n\n<p><code>MyEmployment</code> seems to be a data type and by <code>MyEmployment :: Person Employment</code> I think you in fact mean</p>\n\n<pre><code>data MyEmployment = MyEmployment Person Employment\n</code></pre>\n\n<p>In this setting then, If you want to take a value of type <code>MyEmployment</code>, and apply a function to the <code>numVal4</code> field of the <code>Employment</code> field, record syntax allows you to write:</p>\n\n<pre><code>foo :: (Money -&gt; Money) -&gt; MyEmployment -&gt; MyEmployment\nfoo f (MyEmployment p e@(Employment {numVal4 = nv}))\n        = MyEmployment p ( e {numVal4 = f nv})\n</code></pre>\n"}], "owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1557355183, "creation_date": 1557350354, "last_edit_date": 1557355183, "question_id": 56049192, "link": "https://stackoverflow.com/questions/56049192/manipulating-a-value-within-several-layers-of-monads", "title": "Manipulating a value within several layers of monads", "body": "<p>My goal is to pull out <code>numVal4</code> from <code>Employment</code> -- but doing it from the level of the <code>MyEmployment</code> value.</p>\n\n<pre><code>data Employment = Employment\n   { textVal1 :: Text\n   , textVal2 :: Text\n   , textVal3 :: Text\n   , numVal4 :: Money }\n\ndata MyEmployment = MyEmployment Person Employment\n\nMyEmployment (Person \"Me\") (Employment \"This\" \"is a\" \"test\" 55)\n\nfmap . fmap (fromInteger (Employment _ _ _ x)) MyEmployment\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>I should have bee more specific.  I need to access the value from within a DMap.  The actual code looks like something closer to this:</p>\n\n<pre><code>thing = dmap ! (Some_Function . Some_OtherFunction $ MyEmployment)\n</code></pre>\n\n<p>And I need to get the numeric value from inside of <code>Employment</code>, with some kind of wrapper like:</p>\n\n<pre><code>thing = fmap (fromIntegral (Employment _ _ _ x)) (dmap ! (Some_Function . Some_OtherFunction $ MyEmployment)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1557347328, "post_id": 56048517, "comment_id": 98738639, "body": "Hoogle the functions. <a href=\"https://hoogle.haskell.org/?hoogle=ord+%3A%3A+Char+-%3E+Int&amp;scope=set%3Astackage\" rel=\"nofollow noreferrer\"><code>ord :: Char -&gt; Int</code></a>. As for converting to binary, I&#39;m sure you could easily write a little recursive function for that, it&#39;s not hard."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1557347587, "post_id": 56048517, "comment_id": 98738756, "body": "The <code>make_binary</code> function you are asking for needs to take both a string AND an encoding. You cannot write such a function without an encoding, unless you are assuming UTF-8 everywhere, which I guess is fine. So just to be clear, you DO want UTF-8, correct?"}, {"owner": {"reputation": 24870, "user_id": 146077, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IvgEc.jpg?s=128&g=1", "display_name": "Kirk Broadhurst", "link": "https://stackoverflow.com/users/146077/kirk-broadhurst"}, "reply_to_user": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1557348346, "post_id": 56048517, "comment_id": 98739073, "body": "@RayToal yes. thanks for the clarification. I assume everything is UTF-8 but it&#39;s useful to call that out."}, {"owner": {"reputation": 24870, "user_id": 146077, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IvgEc.jpg?s=128&g=1", "display_name": "Kirk Broadhurst", "link": "https://stackoverflow.com/users/146077/kirk-broadhurst"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1557348772, "post_id": 56048517, "comment_id": 98739237, "body": "@AJFarmar Hoogle is great and useful, but for a simple type signature like <code>Char -&gt; Int</code> I get a ton of hits, each with pretty concise and pithy documentation or comment."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1557349282, "post_id": 56048517, "comment_id": 98739443, "body": "<code>Char</code> is not (user-visibly) UTF-8 encoded; it is a Unicode codepoint. If you want a specific encoding, you must encode first to a suitable type (<code>ByteString</code> is a popular choice for that)."}, {"owner": {"reputation": 24870, "user_id": 146077, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IvgEc.jpg?s=128&g=1", "display_name": "Kirk Broadhurst", "link": "https://stackoverflow.com/users/146077/kirk-broadhurst"}, "edited": false, "score": 0, "creation_date": 1557349573, "post_id": 56048517, "comment_id": 98739532, "body": "The question says &#39;ASCII&#39; - I&#39;m only interested in simple English characters [a-zA-Z] in ASCII/UTF-8. I can improve the question if people give feedback - I don&#39;t see why it deserves 3 downvotes."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1557349584, "post_id": 56048517, "comment_id": 98739538, "body": "Yes UTF-32 is the easiest thing to do here. I&#39;m sure someone has solved the problem of turning a Haskell String into bytes with UTF-8, then you just have to map the to-8-bit-binary-string over each byte."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1557349653, "post_id": 56048517, "comment_id": 98739560, "body": "Oh sorry I missed the ASCII part.... I guess I was not expecting it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1557352601, "post_id": 56048517, "comment_id": 98740543, "body": "For what it&#39;s worth, I downvoted because the question is very basic and easily answerable by just browsing the standard libraries for a little while. So a priori it looks like you haven&#39;t done your due diligence before asking."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1557347353, "creation_date": 1557347353, "answer_id": 56048593, "question_id": 56048517, "link": "https://stackoverflow.com/questions/56048517/binary-representation-of-a-string/56048593#56048593", "title": "Binary representation of a string", "body": "<p>You can get where you need to go with <code>fromEnum</code> (or its specialized version <code>ord</code>) and <code>showIntAtBase</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1557365757, "post_id": 56049144, "comment_id": 98743282, "body": "Is <code>intercalate &quot;&quot;</code>  just <code>concat</code>?"}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1557383588, "post_id": 56049144, "comment_id": 98747708, "body": "Yep, for <code>List Char</code> they are the same. Good eye, that would have been cleaner. :)"}], "tags": [], "owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "is_accepted": false, "score": 3, "last_activity_date": 1557350086, "creation_date": 1557350086, "answer_id": 56049144, "question_id": 56048517, "link": "https://stackoverflow.com/questions/56048517/binary-representation-of-a-string/56049144#56049144", "title": "Binary representation of a string", "body": "<p>Here's a quick ASCII-only version that might help:</p>\n\n<pre><code>Prelude Data.Char Text.Printf Data.List&gt; format = Text.Printf.printf::String-&gt;Int-&gt;String\nPrelude Data.Char Text.Printf Data.List&gt; intercalate \"\" $ map (format \"%08b\" . ord) \"ABCD\"\n\"01000001010000100100001101000100\"\n</code></pre>\n"}], "owner": {"reputation": 24870, "user_id": 146077, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IvgEc.jpg?s=128&g=1", "display_name": "Kirk Broadhurst", "link": "https://stackoverflow.com/users/146077/kirk-broadhurst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1557350086, "creation_date": 1557347009, "question_id": 56048517, "link": "https://stackoverflow.com/questions/56048517/binary-representation-of-a-string", "title": "Binary representation of a string", "body": "<p>Assuming I have some ASCII characters in a string, let's say <code>s = \"ABC\"</code>, how can I retrieve the binary/bit representation as a string?</p>\n\n<p>In this case,</p>\n\n<pre><code>A = 41 = \"01000001\"\nB = 42 = \"01000010\"\nC = 43 = \"01000011\"\n</code></pre>\n\n<p>so I want something like <code>make_binary \"ABC\"</code> to return <code>\"010000010100001001000011\"</code></p>\n\n<p>I don't know if there's any way to get the encoded value of a character, and (if there is) I don't know if there's any way to get the 'bit-representation' of that value.</p>\n\n<p>I could solve this with a straight map from character to 'bit-representation string' but hope there's a better approach.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1557347711, "post_id": 56048487, "comment_id": 98738811, "body": "That&#39;s not the error I get. I get that <code>def</code> is not in scope (and after fixing that, a type error -- though perhaps I got a different version of the library than you did)."}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "edited": false, "score": 0, "creation_date": 1557353135, "post_id": 56048487, "comment_id": 98740680, "body": "I have scalpel-core 0.5.1, which seems to have the <code>def</code> method defined in this code source: <a href=\"https://hackage.haskell.org/package/scalpel-0.5.1/src/src/Text/HTML/Scalpel/Internal/Scrape/URL.hs\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/scalpel-0.5.1/src/src/Text/HTML/&zwnj;&#8203;&hellip;</a>"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1557357484, "post_id": 56048487, "comment_id": 98741739, "body": "That version uses <code>def</code> from <code>Data.Default</code>, but it doesn&#39;t re-export it. If you want to use that <code>def</code> too, you&#39;ll have to do <code>import Data.Default (def)</code>."}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "edited": false, "score": 0, "creation_date": 1557364790, "post_id": 56048487, "comment_id": 98743073, "body": "For me, importing the <code>Data.Default (def)</code> function explicitly still gets me the same error: <code>error: Not in scope: \u2018manager\u2019</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557367300, "post_id": 56048487, "comment_id": 98743537, "body": "Are you sure you have copied and pasted the exact code you&#39;re trying to compile? Can you please paste the <i>entire</i> error?"}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557368885, "post_id": 56048487, "comment_id": 98743870, "body": "@DanielWagner ok let me paste the entire console output of the build. And yes I have copied and pasted the exact code, I just tried again to make sure this is legitimate."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1557370895, "post_id": 56048487, "comment_id": 98744257, "body": "Hm. Your error says line 26, but line 26 of the code you&#39;ve pasted has just <code>where</code> on it. Are you <i>sure</i> you&#39;ve pasted the exact code you&#39;re trying to compile?"}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "edited": false, "score": 0, "creation_date": 1557373778, "post_id": 56048487, "comment_id": 98744789, "body": "Does the Haskell community has some sort of equivalent to jsfiddle where I can load the required libraries, write the code and have it executed to reproduce my issue, in order to easily share what is happening?"}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "edited": false, "score": 0, "creation_date": 1557374007, "post_id": 56048487, "comment_id": 98744839, "body": "There is a module definition that I added from the example code which adds two lines (i.e. module Example where), for it to compile properly when executing stack build. I will update it with the module definition if you want. The rest is the same."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557379895, "post_id": 56048487, "comment_id": 98746318, "body": "Wow, this is a really long discussion for what seems obvious.  1. Record syntax needs a <code>{ field = value}</code> not just <code>{ value }</code>.  2. Yeah, from my view there&#39;s a missing import but from a common enough module and I did see your presented error first - perhaps that&#39;s a difference of compiler version from what @DanielWagner is using.  I guess tired me is trying to say thanks for posting copious information and conversing on your question, I know us SO denizens have grown weary of incomplete/abandoned/inaccurate questions which leads to all this up-front vetting just to help someone."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1557406772, "post_id": 56048487, "comment_id": 98760356, "body": "@ThomasM.DuBuisson <code>{ manager }</code> is correct with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=namedfieldpuns#extension-NamedFieldPuns\" rel=\"nofollow noreferrer\"><code>NamedFieldPuns</code></a> on, which it is."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1557407115, "post_id": 56048487, "comment_id": 98760536, "body": "Ah, thanks Daniel. Unclear why that error always with that extension but I did reproduce."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1557407245, "post_id": 56048487, "comment_id": 98760614, "body": "@ThomasM.DuBuisson I don&#39;t think you did. Look at the error in the question carefully: as called out in the comments, the question&#39;s claimed error does <i>not</i> say that <code>def</code> is out of scope, but that <code>manager</code> is. So in your answer, you fixed a different error than the question-asker says they need help fixing, and changed a thing that wasn&#39;t broken in the first place!"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1557407835, "post_id": 56048487, "comment_id": 98760943, "body": "Hurm, seems likely.  Tired me has done stupider things."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1557407916, "post_id": 56048487, "comment_id": 98760993, "body": "@ThomasM.DuBuisson It does seem like a curious question. My current top hypothesis is that OP is lying somehow. Not out of malice or anything like that, just by being mistaken. e.g. I could imagine the pattern &quot;copy and paste from documentation to file, hit a wrong keystroke by accident without noticing that deletes a letter from the <code>manager</code> binding on line 25; save; then, when writing the SO question, copy and paste from documentation again instead of from the actual file&quot;. You&#39;ll notice that in the edit from 9 hours ago, a new <code>Just</code> appeared (!) which supports the hypothesis."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1557408013, "post_id": 56048487, "comment_id": 98761049, "body": "@ThomasM.DuBuisson ...hence my repeated prodding to make <i>double plus sure</i> that the code in the file is exactly as represented here. If you can think of other small mistakes (perhaps they&#39;re compiling a different file than they think they are...? or their editor&#39;s view of the file is out of synch with what&#39;s actually on disk...???) that would lead to this kind of lie I&#39;m sure both the asker and I are all ears."}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1557382820, "post_id": 56052597, "comment_id": 98747400, "body": "Although I&#39;m not familiar with the extension, it seems that <a href=\"https://ghc.readthedocs.io/en/8.0.1/glasgow_exts.html#record-puns\" rel=\"nofollow noreferrer\">NamedFieldPuns</a>, which is enabled here, should enable precisely this syntax?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557407165, "post_id": 56052597, "comment_id": 98760572, "body": "Indeed, thanks.  I&#39;ll need to look harder to see why the error appeared."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1557412548, "post_id": 56052597, "comment_id": 98763780, "body": "I see your point.  Clearly the asker needed help and comments were not sufficient communication.  META: There are two categories of answers I see on SO.  1. Answers to questions, which usually generalize to help others 2. Examples and dialog that gets an individual unstuck.  I don&#39;t think this question will resolve with an answer of the first type."}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "edited": false, "score": 0, "creation_date": 1557413850, "post_id": 56052597, "comment_id": 98764540, "body": "@ThomasM.DuBuisson Indeed, solving these situations are sometimes tricky.. Although I didn&#39;t find the exact reason why <code>manager</code> was out of scope, I explicitly overridden the scalpel version to 0.6.0 in my <code>stack.yaml</code> configuration to align with your answer (I was on 0.5.1 as previously mentioned) and then, I started to see the error with the <code>def</code> function not being imported, which I imported (again). That did the trick, it&#39;s all working now. Solving this compilation error is all that matters to me right now. Thanks a ton!"}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "edited": false, "score": 1, "creation_date": 1557414028, "post_id": 56052597, "comment_id": 98764660, "body": "I am marking this as the solution, where the answer is to upgrade the scalpel library version from 0.5.1 to 0.6.0. @ThomasM.DuBuisson if you want to mention this explicitly int he answer, feel free to do so."}, {"owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "edited": false, "score": 0, "creation_date": 1557426220, "post_id": 56052597, "comment_id": 98770805, "body": "Thanks @ThomasM.DuBuisson for digging further! It&#39;s now much clearer why I had this error and a good teaching for me on my way to learning Haskell. =)"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 5, "last_activity_date": 1557416587, "last_edit_date": 1557416587, "creation_date": 1557378795, "answer_id": 56052597, "question_id": 56048487, "link": "https://stackoverflow.com/questions/56048487/a-constant-is-out-of-scope-but-clearly-defined-or-so-i-believe/56052597#56052597", "title": "A constant is out of scope but clearly defined (or so I believe)", "body": "<p>EDIT:  I can reproduce the asker's problem with an old version of scalpel, which the asker mentioned they were using:</p>\n\n<pre><code>[1 of 1] Compiling Example          ( Main.hs, /var/folders/m7/_2kqsz4n4c3ck8050glq4ggr0000gn/T/cabal-repl.-26184/dist-newstyle/build/x86_64-osx/ghc-8.6.4/fake-package-0/x/script/build/script/script-tmp/Example.o )\n\nMain.hs:34:40: error: Not in scope: \u2018manager\u2019\n   |\n34 |     html &lt;- scrapeURLWithConfig (def { manager }) url $ htmls anySelector\n   |                                        ^^^^^^^\n./so.hs  16.94s user 3.89s system 114% cpu 18.155 total\n</code></pre>\n\n<p>This is a suboptimal error message that seems to result from using named field puns and a variable that is not a field name.  That is, <code>Config</code> in that version of <code>scalpel</code> does not have a manager field.  We can reproduce this issue in a smaller example:</p>\n\n<pre><code>% cat test.hs\n{-# LANGUAGE NamedFieldPuns #-}\ndata Foo = Foo { bar :: Int } deriving (Show)\nmain :: IO ()\nmain = print (Foo { zar})\n where zar = 23 :: Int\n% ghc test.hs\n...snipt...\ntest.hs:4:21: error:\n    Not in scope: \u2018zar\u2019\n    Perhaps you meant \u2018bar\u2019 (line 3)\n  |\n4 | main = print (Foo { zar})\n</code></pre>\n\n<p>The solution is thus to update to a newer version of scalpel.</p>\n\n<p><strike>\n    html &lt;- scrapeURLWithConfig (def { manager }) url $ htmls anySelector</p>\n\n<p>I have no idea what this is supposed to be. Specifically <code>(def { manager })</code>. That isn't any syntax I'm familiar with.</p>\n\n<p>Where you have <code>manager</code>, there should be a field.  For example:</p>\n\n<pre><code>def { someField = someValue }\n</code></pre>\n\n<p>not what you have of <code>def { someValue }</code> which makes no sense.</strike></p>\n\n<p>Ah, NamedFieldPuns.  I've honestly never used them and looking at them I find myself perfering RecordWildCards.  Moving on.</p>\n\n<p>Looking at the haddocks, the field name is <code>manager</code> so you have a <code>manager</code> field and a <code>manager</code> value for the named field pun. I needed to add an import for <code>def</code>.  At the same time I took the liberty of using <code>cabal</code> and a shebang to be explicit about all the packages:</p>\n\n<pre><code>#! /usr/bin/env cabal\n{- cabal:\nbuild-depends:\n      base &gt;= 4\n    , scalpel == 0.6.0\n    , http-types == 0.12.3\n    , http-client-tls == 0.3.5.3\n    , http-client == 0.6.4\n    , data-default == 0.7.1.1\n-}\n{-# LANGUAGE NamedFieldPuns #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Data.Default\nimport Text.HTML.Scalpel\nimport qualified Network.HTTP.Client as HTTP\nimport qualified Network.HTTP.Client.TLS as HTTP\nimport qualified Network.HTTP.Types.Header as HTTP\n\n-- Create a new manager settings based on the default TLS manager that updates\n-- the request headers to include a custom user agent.\nmanagerSettings :: HTTP.ManagerSettings\nmanagerSettings = HTTP.tlsManagerSettings {\n  HTTP.managerModifyRequest = \\req -&gt; do\n    req' &lt;- HTTP.managerModifyRequest HTTP.tlsManagerSettings req\n    return $ req' {\n      HTTP.requestHeaders = (HTTP.hUserAgent, \"My Custom UA\")\n                          : HTTP.requestHeaders req'\n    }\n}\n\nmain = do\n    manager &lt;- Just &lt;$&gt; HTTP.newManager managerSettings\n    html &lt;- scrapeURLWithConfig (def { manager = manager }) url $ htmls anySelector\n    maybe printError printHtml html\n  where\n    url = \"https://www.google.com\"\n    printError = putStrLn \"Failed\"\n    printHtml = mapM_ putStrLn\n</code></pre>\n\n<p>Which seems to run well.  Notice the module containing <code>main</code> should itself be <code>Main</code>.</p>\n"}], "owner": {"reputation": 928, "user_id": 647641, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ZhWcT.jpg?s=128&g=1", "display_name": "jlr", "link": "https://stackoverflow.com/users/647641/jlr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 56052597, "answer_count": 1, "score": 3, "last_activity_date": 1557416587, "creation_date": 1557346846, "last_edit_date": 1557373969, "question_id": 56048487, "link": "https://stackoverflow.com/questions/56048487/a-constant-is-out-of-scope-but-clearly-defined-or-so-i-believe", "title": "A constant is out of scope but clearly defined (or so I believe)", "body": "<p>I am trying out Scalpel to scrape a website but got into an out of scope error using their own example code. That example is found on their <a href=\"https://github.com/fimad/scalpel\" rel=\"nofollow noreferrer\">github page</a>, section <em>My Scraping Target Doesn't Return The Markup I Expected</em>.</p>\n\n<p>I am using the <code>ghc-8.6.4</code> Haskell compiler.</p>\n\n<p>My <code>packages.yaml</code> dependencies are:</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- http-conduit\n- http-client\n- http-client-tls\n- http-types\n- scalpel\n</code></pre>\n\n<p>The code:</p>\n\n<pre><code>{-# LANGUAGE NamedFieldPuns #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Example where\n\nimport Text.HTML.Scalpel\nimport qualified Network.HTTP.Client as HTTP\nimport qualified Network.HTTP.Client.TLS as HTTP\nimport qualified Network.HTTP.Types.Header as HTTP\n\n-- Create a new manager settings based on the default TLS manager that updates\n-- the request headers to include a custom user agent.\nmanagerSettings :: HTTP.ManagerSettings\nmanagerSettings = HTTP.tlsManagerSettings {\n  HTTP.managerModifyRequest = \\req -&gt; do\n    req' &lt;- HTTP.managerModifyRequest HTTP.tlsManagerSettings req\n    return $ req' {\n      HTTP.requestHeaders = (HTTP.hUserAgent, \"My Custom UA\")\n                          : HTTP.requestHeaders req'\n    }\n}\n\nmain = do\n    manager &lt;- Just &lt;$&gt; HTTP.newManager managerSettings\n    html &lt;- scrapeURLWithConfig (def { manager }) url $ htmls anySelector\n    maybe printError printHtml html\n  where\n    url = \"https://www.google.com\"\n    printError = putStrLn \"Failed\"\n    printHtml = mapM_ putStrLn\n</code></pre>\n\n<p>As you can see from the code sample, the <code>manager</code> constant is sitting next to the <code>def</code> function. But it seems like it is hiding <code>manager</code> somehow... I can't put my finger on what's wrong. </p>\n\n<p>The entire console output from the <code>stack build</code> command, which contains the reported error:</p>\n\n<pre><code>jroyer$ stack build\nmy-okr-haskeller-0.1.0.0: build (lib + exe)\nPreprocessing library for my-okr-haskeller-0.1.0.0..\nBuilding library for my-okr-haskeller-0.1.0.0..\n[2 of 3] Compiling Example          ( src/Example.hs, .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/Example.o )\n\n/Users/jroyer/Projects/bizgithub/my-okr-haskeller/src/Example.hs:26:40: error: Not in scope: \u2018manager\u2019\n   |\n26 |     html &lt;- scrapeURLWithConfig (def { manager }) url $ htmls anySelector\n   |                                        ^^^^^^^\n\n\n--  While building package my-okr-haskeller-0.1.0.0 using:\n      /Users/jroyer/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.4 --builddir=.stack-work/dist/x86_64-osx/Cabal-2.4.0.1 build lib:my-okr-haskeller exe:my-okr-haskeller-exe --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "is_accepted": false, "score": 6, "last_activity_date": 1557349799, "creation_date": 1557349799, "answer_id": 56049096, "question_id": 56048289, "link": "https://stackoverflow.com/questions/56048289/sorting-a-part-of-a-list-without-using-library-functions/56049096#56049096", "title": "Sorting a part of a list without using library functions", "body": "<p>You don't need to involve tuples. You can write what you wrote for tuples as patterns to match instead.</p>\n\n<pre><code>sortFirst3 [x, y] = if x &gt; y then [y, x] else [x, y]\nsortFirst3 [x, y, z]\n    | x &gt;= y &amp;&amp; y &gt;= z = [z, y, x]\n    | x &gt;= z &amp;&amp; z &gt;= y = [y, z, x]\n    | y &gt;= x &amp;&amp; x &gt;= z = [z, x, y]\n    | y &gt;= z &amp;&amp; z &gt;= x = [x, z, y]\n    | z &gt;= x &amp;&amp; x &gt;= y = [y, x, z]\n    | z &gt;= y &amp;&amp; y &gt;= x = [x, y, z]\nsortFirst3 (x : y : z : ws) = sortFirst3 [x, y, z] ++ ws\nsortFirst3 xs = xs\n</code></pre>\n\n<p>The last line catches what has not been matched, which are the singletons and empty lists, which remain the same when sorted. You should not have strict inequalities in your guards since elements may repeat. Also note that, in your code, even if you didn't have the type mismatch, the recursive call to <code>sortFirst3</code> would be erroneous, since after sorting the first three terms, the first three of the rest would be sorted, and so on.</p>\n"}, {"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": false, "score": 0, "last_activity_date": 1557349919, "creation_date": 1557349919, "answer_id": 56049117, "question_id": 56048289, "link": "https://stackoverflow.com/questions/56048289/sorting-a-part-of-a-list-without-using-library-functions/56049117#56049117", "title": "Sorting a part of a list without using library functions", "body": "<pre><code>sortfirst3 (x:y:z:v:xs) =  sort3(x,y,z) : sortfirst3 (v:xs)\n</code></pre>\n\n<p>This definition says, take the first 4 elements off the list, sort the first 3 into a tuple, then cons it onto the (recursive) result on the fourth element of the list with the rest of the list. </p>\n\n<p>This reveals three changes to be made.</p>\n\n<p>First, we only need to match the first 3 elements, not the first 4, but we should also probably deal with cases for when the list is &lt;3 elements long. I've just made it an error, but you can use eg. <code>sort2</code>  instead.</p>\n\n<pre><code>sortfirst3 (x:y:z:xs) =  sort3 (x,y,z) : sortfirst3 xs\nsortfirst3 _ = error \"Can't sort first 3 elements of list shorter than 3 elements\"\n</code></pre>\n\n<p>Second, we intend to sort the first 3 elements ie. resulting in a 3 element list. <code>(:) :: a -&gt; [a] -&gt; [a]</code> ie. takes an element (not a list) in the first argument, what we want instead is concatentation <code>(++) :: [a] -&gt; [a] -&gt; [a]</code>.</p>\n\n<pre><code>sortfirst3 (x:y:z:xs) =  sort3 (x,y,z) ++ sortfirst3 xs\n</code></pre>\n\n<p>Third, we intend to leave the elements after the first 3 untouched, so we shouldn't actually make a recursive call on the rest of the list - otherwise we'll instead be sorting the list in 3 element chunks.</p>\n\n<pre><code>sortfirst3 (x:y:z:xs) =  sort3 (x,y,z) ++ xs\n</code></pre>\n\n<p>This is now almost correct, but for <code>sort3</code>, which as you identified incorrectly returns a tuple rather than a 3-element list. kuoytfouy's answer helps with that.</p>\n"}], "owner": {"reputation": 5, "user_id": 11472082, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-l-15N7LfhG0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd8H6b8eu_iptMYxMddti7-SjmE-A/mo/photo.jpg?sz=128", "display_name": "FelixH", "link": "https://stackoverflow.com/users/11472082/felixh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1557405914, "creation_date": 1557345974, "last_edit_date": 1557405914, "question_id": 56048289, "link": "https://stackoverflow.com/questions/56048289/sorting-a-part-of-a-list-without-using-library-functions", "title": "Sorting a part of a list without using library functions", "body": "<p>I want to sort the first three elements of a list, yet keep the other elements untouched. And I don't want to use any library functions because I am new to Haskell.</p>\n\n<p>This is what I have so far:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wincomplete-patterns #-}\n\n\nsort2 (x, y) = if x &gt; y then (y,x) else (x,y)\nsort3 (x,y,z)\n    | x &gt; y &amp;&amp; y &gt; z = (z,y,x)\n    | x &gt; z &amp;&amp; z &gt; y = (y,z,x)\n    | y &gt; x &amp;&amp; x &gt; z = (z,x,y)\n    | y &gt; z &amp;&amp; z &gt; x = (x,z,y)\n    | z &gt; x &amp;&amp; x &gt; y = (y,x,z)\n    | z &gt; y &amp;&amp; y &gt; x = (x,y,z)\n    | otherwise = (0,0,0)\n\n--sortfirst3 :: [Int] -&gt; [Int]\nsortfirst3 (x:y:z:v:xs) =  sort3(x,y,z) : sortfirst3 (v:xs)\n\n</code></pre>\n\n<p>I'm trying to sort the first three elements, put them in a list, and then put the other elements in another list and then concatenate them with each other. However, this generates an error because of the type difference a tuple and a list.  Is there another way I should be doing this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1557343593, "post_id": 56047335, "comment_id": 98737097, "body": "fyi: it&#39;s easier for people to run your code (and thereby figure out what&#39;s wrong with it) if you post the source, rather than a screenshot. You can use triple-backticks (``` ...```) to make it format nicely."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1557345788, "post_id": 56047335, "comment_id": 98737982, "body": "Your edit includes the fix suggested in <a href=\"https://stackoverflow.com/a/56047435/1126841\">this answer</a>; that either destroys the premise of the question, or you still have a problem that you aren&#39;t describing."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1557368855, "post_id": 56047335, "comment_id": 98743864, "body": "I&#39;ve removed <code>hiding (find)</code> from the question because otherwise it looks like you asked &quot;I have this problem: &lt;code that has no problem goes here&gt; how do I fix it?&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557342456, "post_id": 56047430, "comment_id": 98736580, "body": "Or, since <code>Data.List</code> is a pretty large library, just import specifically those few functions you actually need: <code>import Data.List (sort)</code> seems to be enough here, and it&#39;s not too painful to add a few more functions if you need them"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1557343444, "post_id": 56047430, "comment_id": 98737025, "body": "Or just use the fully qualified name <code>Main.find</code> in the code."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 2, "last_activity_date": 1557342199, "creation_date": 1557342199, "answer_id": 56047430, "question_id": 56047335, "link": "https://stackoverflow.com/questions/56047335/how-to-fix-ambiguous-occurrence-find/56047430#56047430", "title": "How to fix Ambiguous occurrence \u2018find\u2019?", "body": "<p>In your situation your options are:</p>\n\n<ol>\n<li>Rename your own <code>find</code> into something else.</li>\n<li>Import <code>Data.List</code> as qualified: <code>import qualified Data.List</code>. You can add <code>as L</code> to shorten code that uses stuff from <code>Data.List</code>.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 3, "last_activity_date": 1557342230, "creation_date": 1557342230, "answer_id": 56047435, "question_id": 56047335, "link": "https://stackoverflow.com/questions/56047335/how-to-fix-ambiguous-occurrence-find/56047435#56047435", "title": "How to fix Ambiguous occurrence \u2018find\u2019?", "body": "<p>You can change line 1 to <code>import Data.List hiding (find)</code>, assuming you never intend to use the <code>find</code> defined there.</p>\n"}], "owner": {"reputation": 805, "user_id": 9332848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7be9ab7a13088194ec317711aeaa1c50?s=128&d=identicon&r=PG&f=1", "display_name": "Ovidiu Ionut", "link": "https://stackoverflow.com/users/9332848/ovidiu-ionut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 56047435, "answer_count": 2, "score": -1, "last_activity_date": 1557368822, "creation_date": 1557341761, "last_edit_date": 1557368822, "question_id": 56047335, "link": "https://stackoverflow.com/questions/56047335/how-to-fix-ambiguous-occurrence-find", "title": "How to fix Ambiguous occurrence \u2018find\u2019?", "body": "<p>I'm new to haskell and I'm trying to run a piece of code but I'm getting this error: \n\"Ambiguous occurrence \u2018find\u2019\n    It could refer to either \u2018Data.List.find\u2019, imported from \u2018Data.List\u2019 at sequential.hs:1:1-16 (and originally defined in \u2018Data.Foldable\u2019) or \u2018Main.find\u2019, defined at sequential.hs:5:1\"</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import System.IO\nimport Data.List\n\n\nfind :: String -&gt; FilePath -&gt; IO (Maybe FilePath)\nfind s d = do\n  fs &lt;- getDirectoryContents d                         -- 1\n  let fs' = sort $ filter (`notElem` [\".\",\"..\"]) fs    -- 2\n  if any (== s) fs'                                    -- 3\n     then return (Just (d &lt;/&gt; s))\n     else loop fs'                                     -- 4\n where\n  loop [] = return Nothing                             -- 5\n  loop (f:fs)  = do\n    let d' = d &lt;/&gt; f                                   -- 6\n    isdir &lt;- doesDirectoryExist d'                     -- 7\n    if isdir\n       then do r &lt;- find s d'                          -- 8\n               case r of\n                 Just _  -&gt; return r                   -- 9\n                 Nothing -&gt; loop fs                    -- 10\n       else loop fs  \n</code></pre>\n"}, {"tags": ["haskell", "type-families", "higher-kinded-types"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1557341318, "post_id": 56047176, "comment_id": 98736108, "body": "Have you looked at Haskell Generics?"}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1557341590, "post_id": 56047176, "comment_id": 98736222, "body": "GHC.Generics? Yes. I don&#39;t think that helps here. Or is it something else or something I missed."}], "answers": [{"comments": [{"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 1, "creation_date": 1557346103, "post_id": 56047990, "comment_id": 98738106, "body": "Thanks. I tried something along those lines, but need to recover the nat at some point. How would i for instance match proxy n in an instance head/context and use it in the body? I can try to expand on this tomorrow if necessary."}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1557346524, "post_id": 56047990, "comment_id": 98738273, "body": "Use n in the body that is, not proxy n"}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1557404303, "post_id": 56047990, "comment_id": 98758920, "body": "I revisited this, and it seems to be working. I&#39;m going to play with it a little more before accepting. For completeness, I&#39;d also like to see a use case where the Nat was recovered, e.g. via an equality constraint. I can update the answer if that&#39;s appropriate."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1557424820, "post_id": 56047990, "comment_id": 98770178, "body": "@trevorcook yeah, if you can show how you&#39;d like to consume the <code>Nat</code>, that&#39;d be useful. I don&#39;t know of any use cases that wouldn&#39;t be better served by just an arity type family."}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1557429445, "post_id": 56047990, "comment_id": 98772231, "body": "I added to my question. Is arity type family the name of what you are proposing? Thanks"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1557850230, "post_id": 56047990, "comment_id": 98900163, "body": "@trevorcook: what about something simple like <code>type family GetN s (t :: Either Nat k) :: k where { GetN (f a) (&#39;Left 0) = a; GetN (f a b) (&#39;Left 1) = a; GetN (f a b c) (&#39;Left 2) = a; ... ; GetN x (&#39;Right a) = a</code>?"}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1557850343, "post_id": 56047990, "comment_id": 98900208, "body": "I cant test this now, but pretty sure using the type family (Proxy n) in the left hand side of another type family is illegal. Ill have to check tonight."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1557344670, "creation_date": 1557344670, "answer_id": 56047990, "question_id": 56047176, "link": "https://stackoverflow.com/questions/56047176/declare-a-type-to-for-all-higher-order-kind/56047990#56047990", "title": "Declare a type to for all higher order kind", "body": "<p>How about this:</p>\n\n<pre><code>{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule SO56047176 where\nimport GHC.TypeLits\nimport Data.Functor.Compose -- for example\n\ntype family Proxy (n :: Nat) :: k\n\ntype Maybe_ = Maybe (Proxy 0)\ntype Either__ = Either (Proxy 0) (Proxy 1)\ntype Compose___ = Compose (Proxy 0) (Proxy 1) (Proxy 2)\n</code></pre>\n\n<p><code>Data.Functor.Compose</code> takes two <code>(-&gt;)</code>-kinded parameters, but <code>Proxy 0</code> and <code>Proxy 1</code> still work.</p>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 0, "last_activity_date": 1558361376, "creation_date": 1558361376, "answer_id": 56222692, "question_id": 56047176, "link": "https://stackoverflow.com/questions/56047176/declare-a-type-to-for-all-higher-order-kind/56222692#56222692", "title": "Declare a type to for all higher order kind", "body": "<p>I found a solution by way of type and data families combined. Starting with the data definition:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE PolyKinds #-}\n\nimport GHC.TypeLits hiding ( (*) )\nimport Data.Kind\n\nclass HasNProxyK j where\n  data NProxyK (n :: Nat) (a::j) :: k\ninstance HasNProxyK Type where\n  data NProxyK n a = NProxyK0\ninstance HasNProxyK k =&gt; HasNProxyK (j -&gt; k) where\n  data NProxyK n f = NProxyKSuc -- or NProxyKS (ProxyK n (f a))\n</code></pre>\n\n<p>I declare a type class <code>HasNProxyK</code> for which <em>kinds</em> will be instances. The associated data, <code>NProxyK</code> expects a <code>Nat</code> and some variable of the appropriate kind, <code>j</code>. The return type of this data family will be some other kind, <code>k</code>. </p>\n\n<p>I then create a base case for <code>Type</code>, (aka <code>*</code>), and an inductive case for all higher kinds that eventually lead to a kind with <code>HasNProxyK</code>.  </p>\n\n<p>Checking this out in a GHCI session:</p>\n\n<pre><code>&gt; :kind! NProxyK 3 Int\nNProxyK 3 Int :: k\n= NProxyK * k 3 Int\n\n&gt; :kind! NProxyK 3 (,,,,)\nNProxyK 3 (,,,,) :: k\n= NProxyK (* -&gt; * -&gt; * -&gt; * -&gt; * -&gt; *) k 3 (,,,,)\n</code></pre>\n\n<p>We see that this proxy is almost ready. The lhs of the return shows that the type has a kind <code>k</code>, but the first kind parameter on the rhs (which I believe corresponds to the class parameter) has the appropriate kind.</p>\n\n<p>We could specify at the call site the appropriate kind for k, instead I just made a type family to ensure the <code>NProxyK</code> kind matches the class kind.</p>\n\n<pre><code>type family ToNProxyK (n :: Nat) (a :: k) :: k where\n  ToNProxyK n (a :: Type) = NProxyK n a\n  ToNProxyK n (a :: j -&gt; k) = NProxyK n a\n\n&gt;:kind! ToNProxyK 1 (,,,,)\nToNProxyK 1 (,,,,) :: * -&gt; * -&gt; * -&gt; * -&gt; * -&gt; *\n= NProxyK\n  (* -&gt; * -&gt; * -&gt; * -&gt; * -&gt; *) (* -&gt; * -&gt; * -&gt; * -&gt; * -&gt; *) 1 (,,,,)\n</code></pre>\n\n<p>Now, the <code>Nat</code> can be recovered using something like the following family:</p>\n\n<pre><code>type family LookupN (x :: k) :: Maybe Nat where\n  LookupN (NProxyK n a) = Just n\n  LookupN x             = Nothing\n\n&gt;:kind! (LookupN (ToNProxyK 3 Maybe))\n(LookupN (ToNProxyK 3 Maybe)) :: Maybe Nat\n= 'Just Nat 3\n&gt;:kind! (LookupN Maybe)\n(LookupN Maybe) :: Maybe Nat\n= 'Nothing Nat\n</code></pre>\n"}], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 56222692, "answer_count": 2, "score": 1, "last_activity_date": 1558361376, "creation_date": 1557341061, "last_edit_date": 1557429307, "question_id": 56047176, "link": "https://stackoverflow.com/questions/56047176/declare-a-type-to-for-all-higher-order-kind", "title": "Declare a type to for all higher order kind", "body": "<p>I have a feeling I'm asking the impossible, but here it goes.</p>\n\n<p>I want to associate type constructors with a fully applied version that number's the parameters at the type level with natural numbers. Here's an example ghci session with its desired use:</p>\n\n<pre><code>ghci&gt; :kind! MKNumbered Maybe\nMKNumbered Maybe :: *\n= Maybe (Proxy Nat 1)\nghci&gt; :kind! MKNumbered Either\nMKNumbered Either :: *\n= Either (Proxy Nat 1) (Proxy Nat 2)\n</code></pre>\n\n<p>To cut down on the noise of the above a little bit, essentially I get something like</p>\n\n<pre><code>Maybe  &gt;----&gt; Maybe 1\nEither &gt;----&gt; Either 1 2 \n</code></pre>\n\n<p>It turns out, I can get close enough with the following type families. They actually use an extra parameter, specifying the total number of arguments, but that's ok.</p>\n\n<pre><code>type MkNumbered f n = UnU (MkNumbered_ (U f) 1 n)\ntype family MkNumbered_ (f :: k) (i::Nat) (n::Nat) :: j where\n  MkNumbered_ (U f) i i = U (f (Proxy i))\n  MkNumbered_ (U f) i n = MkNumbered_ (U (f (Proxy i))) (i+1) n\n\ndata U (a::k)\ntype family UnU f :: * where\n  UnU (U f) = f\n</code></pre>\n\n<p>The <code>U</code> type is another proxy which seems necessary to get behavior I wanted. If I have a fully applied <code>U</code>, i.e. <code>U (a :: *)</code> I can unwrap it with <code>UnU</code>. </p>\n\n<p>The shortcoming of the above is that, since <code>Proxy i :: *</code>, <code>MkNumbered</code> can only handle constructors with <code>*</code> variables. Numbering </p>\n\n<pre><code>data A (f :: * -&gt; *) a = ...\n</code></pre>\n\n<p>is out, <code>A (Proxy 1) (Proxy 2)</code> won't work in the <code>Proxy 1</code> argument. I should be able to enhance <code>MkNumbered</code>, by introducing a number of specific numbering proxies:</p>\n\n<pre><code>data NPxy1 (n :: Nat)\ndata NPxy2 (n :: Nat) (a :: i)\ndata NPxy3 (n :: Nat) (a :: i) (b :: j)\n...\n</code></pre>\n\n<p>This should leave me with behavior like:</p>\n\n<pre><code>ghci&gt; :kind! MKNumbered A\nMKNumbered A :: *\n= A (NPxy2 Nat 1) (NPxy1 Nat 2)\n</code></pre>\n\n<p>That helps a lot, just those three NPxy definitions probably cover most of the higher ordered kind cases. But I was wondering if there was a way to enhance this so that I could cover all <code>k -&gt; j -&gt; ... -&gt; *</code> cases? </p>\n\n<hr>\n\n<p>Incidentally, I don't seriously hope to handle types like</p>\n\n<pre><code>data B (b::Bool) = ...   \n</code></pre>\n\n<p>I would need something like this illegal definition:</p>\n\n<pre><code>data NPxyBool (n :: Nat) :: Bool\n</code></pre>\n\n<p>In any case, all the <code>Bool</code> types seem to be taken already. Going further, I'd be thrilled to learn that there was a way to create some data</p>\n\n<pre><code>data UndefinedN (n :: Nat) :: forall k . k\n</code></pre>\n\n<p>which I called <code>UndefinedN</code> since it seems like a bottom at the kind level. </p>\n\n<hr>\n\n<p>Edit: Intended Use</p>\n\n<p>The crux of my intended use is to query a type for the proxied parameter.</p>\n\n<pre><code>type family GetN s (a :: k) :: k \n\nGetN (Either Int Char) (Proxy 1) ~ Int\n</code></pre>\n\n<p>However, I also require that if the Proxy index is some other specific type besides <code>Proxy n</code>, then that type is just returned.</p>\n\n<pre><code>GetN (Either Int Char) Maybe ~ Maybe\n</code></pre>\n\n<p>However, any type family solution for <code>Proxy n</code> makes writing family instances for <code>GetN</code> with <code>Proxy n</code> on the lhs illegal. I'm open to type class based solutions, where we can have:</p>\n\n<pre><code>instance (Proxy n ~ pxy, GetNat s n ~ a) =&gt; GetN s pxy a where... \n</code></pre>\n\n<p>but my requirement to also resolve concrete values to themselves causes conflicting instance definitions that I'm also having trouble to resolve.</p>\n\n<p>The rest of this is just for information sake, but having the above I should be able to derive sub-data from my proxy parameter types. For example, filling in my definition of <code>A</code>, above:</p>\n\n<pre><code>data A f a = A { unA :: f (Maybe a) }\n</code></pre>\n\n<p>the sub-data at <code>unA</code>, as numbered parameters looks like:</p>\n\n<pre><code>type UnANums = (Proxy 1) (Maybe (Proxy 2))\n</code></pre>\n\n<p>I would like to derive a type family (or some other method) that creates a concrete sub-data based on an example of the super-data.</p>\n\n<pre><code>type family GetNs s (ns :: k) :: k\nGetNs (A [] Int) UnANums ~ [Maybe Int]\nGetNs (A (Either String) Char) UnANums ~ Either String (Maybe Char)\n</code></pre>\n\n<p>Ultimately, this is leading to deriving traversal signatures generically. Given a source and target contexts, for instance <code>A f a</code> and <code>A g b</code>, in a Generic representation I will have at the <code>K1</code> nodes types like <code>UnANums</code>, from which I can derive a source and target to traverse to.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1557339802, "post_id": 56046752, "comment_id": 98735430, "body": "The suggested duplicate -- while not a perfect match in title -- does cover this case and suggests <code>(putStrLn . unlines . map showDetails) [(&quot;A&quot;,100,1),(&quot;B&quot;,101,2)]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 4651663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Bq63.jpg?s=128&g=1", "display_name": "Nestoter", "link": "https://stackoverflow.com/users/4651663/nestoter"}, "edited": false, "score": 0, "creation_date": 1557341498, "post_id": 56046898, "comment_id": 98736185, "body": "Hey Robin, and how <code>(putStrLn . unlines . map showDetails) ([(&quot;A&quot;,100,1),(&quot;B&quot;,101,2)])</code> does actually work? Why <code>putStrLn . unlines . (map showDetails [(&quot;A&quot;,100,1),(&quot;B&quot;,101,2)])</code> it&#39;s not the correct answer? I think ghci should resolve the map sD [] before everything else."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 57, "user_id": 4651663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Bq63.jpg?s=128&g=1", "display_name": "Nestoter", "link": "https://stackoverflow.com/users/4651663/nestoter"}, "edited": false, "score": 0, "creation_date": 1557342219, "post_id": 56046898, "comment_id": 98736488, "body": "@Nestoter <code>putStrLn . unlines . (map showDetails [(&quot;A&quot;,100,1),(&quot;B&quot;,101,2)])</code> is a type error, because <code>.</code> expects a function type on either side, and <code>map showDetails [(&quot;A&quot;,100,1),(&quot;B&quot;,101,2)]</code> is not a function but a list of strings. In the correctly grouped version, you compose 3 functions to form another function - whose type is <code>[(String, Int, Int)] -&gt; IO ()</code> - and apply it to a specific list of triples."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 57, "user_id": 4651663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Bq63.jpg?s=128&g=1", "display_name": "Nestoter", "link": "https://stackoverflow.com/users/4651663/nestoter"}, "edited": false, "score": 0, "creation_date": 1557342779, "post_id": 56046898, "comment_id": 98736694, "body": "I should add that <code>(putStrLn . unlines) (map showDetails [(&quot;A&quot;,100,1),(&quot;B&quot;,101,2)])</code> is fine. As is <code>putStrLn ((unlines . map showDetails) [(&quot;A&quot;,100,1),(&quot;B&quot;,101,2)])</code> - although I think that last version is clearly inferior to the others, due to additional nesting. But there are lots of ways of expressing the same thing."}, {"owner": {"reputation": 57, "user_id": 4651663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Bq63.jpg?s=128&g=1", "display_name": "Nestoter", "link": "https://stackoverflow.com/users/4651663/nestoter"}, "edited": false, "score": 0, "creation_date": 1557360030, "post_id": 56046898, "comment_id": 98742209, "body": "Awesome, thanks Robin."}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 5, "last_activity_date": 1557341975, "last_edit_date": 1557341975, "creation_date": 1557339751, "answer_id": 56046898, "question_id": 56046752, "link": "https://stackoverflow.com/questions/56046752/how-to-transform-expression-to-regular-expression/56046898#56046898", "title": "How to transform $ expression to &quot;regular&quot; expression", "body": "<p><code>$</code> is just function application:</p>\n\n<pre><code>f $ x = f x\n</code></pre>\n\n<p>Put like that, it looks useless. But it actually has a number of uses - and one of the most common ones comes from the fact that, as an infix operator, it has a lower precedence than any other. That is, when parsing the expression, Haskell takes everything to its left (that doesn't include another <code>$</code>) and everything to its right (likewise), and effectively puts both sides in parentheses.</p>\n\n<p>This allows one to use <code>$</code> as a substitute for parentheses, since <code>f $ complicatedExpression</code> is the same as <code>f (complicatedExpression)</code>. So in your example:</p>\n\n<pre><code>putStrLn . unlines . map showDetails $ [(\"A\",100,1),(\"B\",101,2)]\n</code></pre>\n\n<p>is identical to</p>\n\n<pre><code>(putStrLn . unlines . map showDetails) ([(\"A\",100,1),(\"B\",101,2)])\n</code></pre>\n\n<p>and the choice is purely stylistic preference. But most prefer <code>$</code>, particularly because multiple <code>$</code>s are much nicer than multiply-nested parentheses.</p>\n"}], "owner": {"reputation": 57, "user_id": 4651663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Bq63.jpg?s=128&g=1", "display_name": "Nestoter", "link": "https://stackoverflow.com/users/4651663/nestoter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "closed_date": 1557347321, "accepted_answer_id": 56046898, "answer_count": 1, "score": 0, "last_activity_date": 1557386621, "creation_date": 1557339039, "last_edit_date": 1557386621, "question_id": 56046752, "link": "https://stackoverflow.com/questions/56046752/how-to-transform-expression-to-regular-expression", "closed_reason": "Duplicate", "title": "How to transform $ expression to &quot;regular&quot; expression", "body": "<p>I have read <a href=\"https://stackoverflow.com/questions/8094993/printing-the-values-inside-a-tuple-in-haskell\">Printing the values inside a tuple in Haskell</a> and the solution works.\nMy intention with this question is understand what does <code>$</code> symbol by \"translating\" the code into a <code>$</code> free code.</p>\n\n<pre><code>showDetails :: (String, Int, Int) -&gt; String\nshowDetails (name, uid, _) = \"Your name is:\" ++ name ++ \" Your ID is: \" ++ show uid\n\nmain = do \n    putStrLn . unlines . map showDetails $ [(\"A\",100,1),(\"B\",101,2)]\n</code></pre>\n\n<p>How does <code>$</code> to tell showDetails to be applyed to list elements (the tuples)?\nWhat is the <code>$</code> free version of that line?</p>\n"}, {"tags": ["haskell", "traversal", "fold"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1557352475, "last_edit_date": 1557352475, "creation_date": 1557343435, "answer_id": 56047720, "question_id": 56046217, "link": "https://stackoverflow.com/questions/56046217/is-there-an-efficient-lazy-way-to-fuse-foldmap-with-traverse/56047720#56047720", "title": "Is there an efficient, lazy way to fuse foldMap with traverse?", "body": "<p>I don't believe it's possible. Avoiding <code>fmap</code>s at the elements seems to require some knowledge of the structure of the container. For example, the <code>Traversable</code> instance for lists can be written</p>\n\n<pre><code>traverse f (x : xs) = liftA2 (:) (f x) (traverse f xs)\n</code></pre>\n\n<p>We know that the first argument of <code>(:)</code> is a single element, so we can use <code>liftA2</code> to combine the process of mapping over the action for that element with the process of combining the result of that action with the result associated with the rest of the list.</p>\n\n<p>In a more generic context, the structure of a fold can be captured faithfully using a magma type with a bogus <code>Monoid</code> instance:</p>\n\n<pre><code>data Magma a = Bin (Magma a) (Magma a) | Leaf a | Nil\n  deriving (Functor, Foldable, Traversable)\n\ninstance Semigroup (Magma a) where\n  (&lt;&gt;) = Bin\ninstance Monoid (Magma a) where\n  mempty = Nil\n\ntoMagma :: Foldable t =&gt; t a -&gt; Magma a\ntoMagma = foldMap Leaf\n</code></pre>\n\n<p>We can write</p>\n\n<pre><code>ft'' :: (Applicative f, Monoid m, Foldable t)\n   =&gt; (b -&gt; m) -&gt; (a -&gt; f b) -&gt; t a -&gt; f m\nft'' f g = fmap (lowerMagma f) . traverse g . toMagma\n\nlowerMagma :: Monoid m =&gt; (a -&gt; m) -&gt; Magma a -&gt; m\nlowerMagma f (Bin x y) = lowerMagma f x &lt;&gt; lowerMagma f y\nlowerMagma f (Leaf x) = f x\nlowerMagma _ Nil = mempty\n</code></pre>\n\n<p>But there's trouble in the <code>Traversable</code> instance:</p>\n\n<pre><code>traverse f (Leaf x) = Leaf &lt;$&gt; f x\n</code></pre>\n\n<p>That's exactly the sort of trouble we were trying to avoid. And there's no lazy fix for it. If we encounter <code>Bin l r</code>, we can't <em>lazily</em> determine whether <code>l</code> or <code>r</code> are leaves. So we're stuck. If we allowed a <code>Traversable</code> constraint on <code>ft''</code>, we could capture the result of <em>traversing</em> with a richer sort of magma type (such as one used in <code>lens</code>), which I <em>suspect</em> could let us do something more clever though I haven't found anything yet.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 5, "answer_count": 1, "score": 11, "last_activity_date": 1557412846, "creation_date": 1557336805, "last_edit_date": 1557412846, "question_id": 56046217, "link": "https://stackoverflow.com/questions/56046217/is-there-an-efficient-lazy-way-to-fuse-foldmap-with-traverse", "title": "Is there an efficient, lazy way to fuse foldMap with traverse?", "body": "<p>A recent proposal on the Haskell libraries mailing list led me to consider the following:</p>\n\n<pre><code>ft :: (Applicative f, Monoid m, Traversable t)\n   -&gt; (b -&gt; m) -&gt; (a -&gt; f b) -&gt; t a -&gt; f m\nft f g xs = foldMap f &lt;$&gt; traverse g xs\n</code></pre>\n\n<p>I noticed that the <code>Traversable</code> constraint can be weakened to <code>Foldable</code>:</p>\n\n<pre><code>import Data.Monoid (Ap (..))  -- Requires a recent base version\n\nft :: (Applicative f, Monoid m, Foldable t)\n   -&gt; (b -&gt; m) -&gt; (a -&gt; f b) -&gt; t a -&gt; f m\nft f g = getAp . foldMap (Ap . fmap f . g)\n</code></pre>\n\n<p>In the original proposal, <code>f</code> was supposed to be <code>id</code>, leading to</p>\n\n<pre><code>foldMapA\n  :: (Applicative f, Monoid m, Foldable t)\n   -&gt; (a -&gt; f m) -&gt; t a -&gt; f m\n--foldMapA g = getAp . foldMap (Ap . fmap id . g)\nfoldMapA g = getAp . foldMap (Ap . g)\n</code></pre>\n\n<p>which is strictly better than the traverse-then-fold approach.</p>\n\n<p>But in the more general <code>ft</code>, there's a potential problem: <code>fmap</code> could be expensive in the <code>f</code> functor, in which case the fused version could potentially be more expensive than the original!</p>\n\n<p>The usual tools for dealing with expensive <code>fmap</code> are <code>Yoneda</code> and <code>Coyoneda</code>. Since we need to lift many times and only lower once, <code>Coyoneda</code> is the one that can help us:</p>\n\n<pre><code>import Data.Functor.Coyoneda\n\nft' :: (Applicative f, Monoid m, Foldable t)\n    =&gt; (b -&gt; m) -&gt; (a -&gt; f b) -&gt; t a -&gt; f m\nft' f g = lowerCoyoneda . getAp\n  . foldMap (Ap . fmap f . liftCoyoneda . g)\n</code></pre>\n\n<p>So now we replace all those expensive <code>fmap</code>s with one (buried in <code>lowerCoyoneda</code>). Problem solved? Not quite.</p>\n\n<p>The trouble with <code>Coyoneda</code> is that its <code>liftA2</code> is <em>strict</em>. So if we write something like</p>\n\n<pre><code>import Data.Monoid (First (..))\n\nft' (First . Just) Identity $ 1 : undefined\n-- or, importing Data.Functor.Reverse,\nft' (Last . Just) Identity (Reverse $ 1 : undefined)\n</code></pre>\n\n<p>then it will fail, whereas <code>ft</code> has no trouble with those. Is there a way to have our cake and eat it too? That is, a version that uses only a <code>Foldable</code> constraint, only <code>fmap</code>s O(1) times more than <code>traverse</code> in the <code>f</code> functor, and is just as lazy as <code>ft</code>?</p>\n\n<hr>\n\n<p>Note: we could make <code>liftA2</code> for <code>Coyoneda</code> <em>somewhat</em> lazier:</p>\n\n<pre><code>liftA2 f m n = liftCoyoneda $\n  case (m, n) of\n    (Coyoneda g x, Coyoneda h y) -&gt; liftA2 (\\p q -&gt; f (g p) (h q)) x y\n</code></pre>\n\n<p>This is enough to let it produce an answer to <code>ft' (First . Just) Identity $ 1 : 2 : undefined</code>, but not to <code>ft' (First . Just) Identity $ 1 : undefined</code>. I don't see any obvious way to make it lazier than that, because pattern matches on existentials must always be strict.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557306791, "post_id": 56037251, "comment_id": 98716899, "body": "hint: what lists does <code>(x:xs)</code> match? If still in doubt, try evaluating your function &quot;by hand&quot; for a reasonably short list, and see what happens"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1557306827, "post_id": 56037251, "comment_id": 98716923, "body": "The obvious logical problem with your code is that <code>x_length</code> never returns a value. It always calls itself (which calls itself again (which calls itself again (which ...)))."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1557306952, "post_id": 56037251, "comment_id": 98716995, "body": "What if you reached the <i>end</i> of the list, so it is <code>[]</code> instead of <code>(x:xs)</code>?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1557306953, "post_id": 56037251, "comment_id": 98716996, "body": "@melpomene well it will terminate (assuming a finite list is given), with a runtime exception - exactly the one seen here"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1557307009, "post_id": 56037251, "comment_id": 98717026, "body": "@RobinZigmond It&#39;s all _|_ to me."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557307268, "post_id": 56037251, "comment_id": 98717167, "body": "Yes, technically I know that&#39;s true. (Almost pointed it out but didn&#39;t want to confuse the OP.) But there is an observable difference nonetheless. (I&#39;m honestly not trying to be argumentative though.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1557334441, "post_id": 56037251, "comment_id": 98732761, "body": "Enabling warnings makes GHC report about the missed <code>[]</code> case. I&#39;d recommend to always keep warnings enabled."}], "answers": [{"comments": [{"owner": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "edited": false, "score": 0, "creation_date": 1557341631, "post_id": 56037509, "comment_id": 98736244, "body": "Thank you for your detailed answer. Trough the comment section I&#39;ve figured out, that I have to check for the empty-list-case. But I didn&#39;t know, that I simply could declare a second case <code>x_length [] = 0</code> above the actual implementation of the function. Is this method treated as one function or are these two different functions? Sorry, I&#39;m new to Haskell. Thank you very much."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "edited": false, "score": 0, "creation_date": 1557348500, "post_id": 56037509, "comment_id": 98739135, "body": "@TabmanRekoj It&#39;s one function, which &quot;branches&quot; into one of multiple definitions depending on which pattern matches the input: the topmost pattern that matches will be used. This can be thought of as being similar to a piecewise function in mathematics. Really though, it&#39;s equivalent to using a <code>case</code> statement directly inside of the function definition."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "edited": false, "score": 0, "creation_date": 1557356074, "post_id": 56037509, "comment_id": 98741410, "body": "@TabmanRekoj To elaborate on DarthFennec&#39;s comment: inside the Haskell compiler, <code>f case1 = _something; f case2 = _somethingelse</code> is treated <i>identically</i> to <code>f x = case x of { case1 -&gt; _something; case2 -&gt; _somethingelse }</code>."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 10, "last_activity_date": 1557307617, "creation_date": 1557307617, "answer_id": 56037509, "question_id": 56037251, "link": "https://stackoverflow.com/questions/56037251/non-exhaustive-patterns-error-when-recursion-a-list/56037509#56037509", "title": "Non-exhaustive patterns error when recursion a list", "body": "<p>Take a look at your definition again:</p>\n\n<pre><code>x_length :: [Int] -&gt; Int\nx_length (x:xs) = 1 + x_length xs\n</code></pre>\n\n<p>Now let's evaluate this for <code>x_length [1,2,3,4]</code>:</p>\n\n<pre><code>x_length [1,2,3,4]\nx_length (1:2:3:4:[])\n= 1 + x_length (2:3:4:[])\n= 1 + 1 + x_length (3:4:[])\n= 1 + 1 + 1 + x_length (4:[])\n= 1 + 1 + 1 + 1 + x_length []\n</code></pre>\n\n<p>But your definition doesn't have a case for matching <code>[]</code>! It has a case matching <code>(x:xs)</code>, but this requires at least one element in the list. Thus the error: 'non-exhaustive patterns'; that is, there was a case which was not matched by a pattern.</p>\n\n<p>To fix this, you'll need one extra case, for <code>x_length []</code>. So your definition will look like this:</p>\n\n<pre><code>x_length :: [Int] -&gt; Int\nx_length [] = _something\nx_length (x:xs) = 1 + x_length xs\n</code></pre>\n\n<p>A small exercise for you: what should <code>_something</code> be? (Hint: what is the length of an empty list?) I'll put the answer in spoiler quotes if you need it; hover over it to show the answer.</p>\n\n<blockquote class=\"spoiler\">\n  <p> <code>x_length [] = 0</code></p>\n</blockquote>\n"}], "owner": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "closed_date": 1557321837, "accepted_answer_id": 56037509, "answer_count": 1, "score": 2, "last_activity_date": 1557320884, "creation_date": 1557306710, "last_edit_date": 1557320884, "question_id": 56037251, "link": "https://stackoverflow.com/questions/56037251/non-exhaustive-patterns-error-when-recursion-a-list", "closed_reason": "Duplicate", "title": "Non-exhaustive patterns error when recursion a list", "body": "<p>I'm getting the following error, if I try to execute my <code>x_length</code> function, that should measure the length of a given list:</p>\n\n<blockquote>\n  <p>Exception: test.hs:2:1-36: Non-exhaustive patterns in function x_length</p>\n</blockquote>\n\n<p>I load my <code>test.hs</code> file into ghci with <code>Prelude&gt;:l test.hs</code>.</p>\n\n<p>The implementation of the <code>x_length</code> function is (within the <code>test.hs</code> file):</p>\n\n<pre><code>x_length :: [Int] -&gt; Int\nx_length (x:xs) = 1 + x_length xs\n</code></pre>\n\n<p>I've already figured out, that it has to do something with loading the <code>test.hs</code> file, but I haven't figured out, how to solve this issue.</p>\n\n<p>The actual function call I do with <code>x_length [1,2,3,4]</code>.</p>\n"}, {"tags": ["haskell", "cabal", "nix", "cabal-install"], "comments": [{"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "edited": false, "score": 0, "creation_date": 1557303940, "post_id": 56033911, "comment_id": 98715338, "body": "Did you try to see if <code>cabal new-build -v</code> gives more information?"}, {"owner": {"reputation": 7576, "user_id": 480398, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3468d23f15a9f631136b508b967b0fbe?s=128&d=identicon&r=PG", "display_name": "hvr", "link": "https://stackoverflow.com/users/480398/hvr"}, "edited": false, "score": 1, "creation_date": 1557388070, "post_id": 56033911, "comment_id": 98749840, "body": "This looks like an installation issue of your Nix build-environment; Does <code>ghc --make Main.hs</code> work?"}, {"owner": {"reputation": 333, "user_id": 7441934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gKmnB.png?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7441934/daniel"}, "reply_to_user": {"reputation": 7576, "user_id": 480398, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3468d23f15a9f631136b508b967b0fbe?s=128&d=identicon&r=PG", "display_name": "hvr", "link": "https://stackoverflow.com/users/480398/hvr"}, "edited": false, "score": 0, "creation_date": 1557410413, "post_id": 56033911, "comment_id": 98762487, "body": "@hvr ghc could compile, but you were probably right that it was a problem with the nix installation. After reinstalling nix the project could build"}], "answers": [{"tags": [], "owner": {"reputation": 333, "user_id": 7441934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gKmnB.png?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7441934/daniel"}, "is_accepted": true, "score": 1, "last_activity_date": 1557410557, "creation_date": 1557410557, "answer_id": 56061207, "question_id": 56033911, "link": "https://stackoverflow.com/questions/56033911/undefined-references-and-gcc-error-when-building-haskell-executable-with-cabal/56061207#56061207", "title": "Undefined references and gcc error when building Haskell executable with cabal?", "body": "<p>While I don't have a definitive answer as to why the error occurred, after reinstalling nix I could finally build the project. So the issue was not with cabal.</p>\n"}], "owner": {"reputation": 333, "user_id": 7441934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gKmnB.png?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7441934/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 56061207, "answer_count": 1, "score": 0, "last_activity_date": 1557410609, "creation_date": 1557292285, "last_edit_date": 1557410609, "question_id": 56033911, "link": "https://stackoverflow.com/questions/56033911/undefined-references-and-gcc-error-when-building-haskell-executable-with-cabal", "title": "Undefined references and gcc error when building Haskell executable with cabal?", "body": "<p>I set up a simple cabal project to try and acquaint myself with it better, and I have a very simple Main.hs file:</p>\n\n<pre><code>main :: IO ()\nmain = putStrLn \"Hello, World!\"\n</code></pre>\n\n<p>So then I try to build it, using <code>cabal new-configure</code> and then <code>cabal new-build</code>. There's no problems for the configure command, but building it gives this:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( Main.hs, /home/redacted/Documents/Haskell/nixtut/dist-newstyle/build/x86_64-linux/ghc-8.0.1/newp-0.1.0.0/x/newp/build/newp/newp-tmp/Main.o )\nLinking /home/daniel/Documents/Haskell/nixtut/dist-newstyle/build/x86_64-linux/ghc-8.0.1/newp-0.1.0.0/x/newp/build/newp/newp ...\n/nix/store/6yjpyqkx6d9k5f2s2g8h9kz40q6rz1yx-binutils-2.31.1/bin/ld: //nix/store/siks2gcfwx6qwh27m7c5r5lixcr621bd-glibc-2.27/lib/libpthread.so.0: undefined reference to `_IO_enable_locks@GLIBC_PRIVATE'\n/nix/store/6yjpyqkx6d9k5f2s2g8h9kz40q6rz1yx-binutils-2.31.1/bin/ld: //nix/store/siks2gcfwx6qwh27m7c5r5lixcr621bd-glibc-2.27/lib/libpthread.so.0: undefined reference to `__mmap@GLIBC_PRIVATE'\n/nix/store/6yjpyqkx6d9k5f2s2g8h9kz40q6rz1yx-binutils-2.31.1/bin/ld: //nix/store/siks2gcfwx6qwh27m7c5r5lixcr621bd-glibc-2.27/lib/libpthread.so.0: undefined reference to `__munmap@GLIBC_PRIVATE'\n/nix/store/6yjpyqkx6d9k5f2s2g8h9kz40q6rz1yx-binutils-2.31.1/bin/ld: //nix/store/siks2gcfwx6qwh27m7c5r5lixcr621bd-glibc-2.27/lib/libpthread.so.0: undefined reference to `__mprotect@GLIBC_PRIVATE'\n/nix/store/6yjpyqkx6d9k5f2s2g8h9kz40q6rz1yx-binutils-2.31.1/bin/ld: //nix/store/siks2gcfwx6qwh27m7c5r5lixcr621bd-glibc-2.27/lib/libpthread.so.0: undefined reference to `__tunable_get_val@GLIBC_PRIVATE'\n/nix/store/6yjpyqkx6d9k5f2s2g8h9kz40q6rz1yx-binutils-2.31.1/bin/ld: //nix/store/siks2gcfwx6qwh27m7c5r5lixcr621bd-glibc-2.27/lib/libpthread.so.0: undefined reference to `__sigtimedwait@GLIBC_PRIVATE'\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>Here is my .cabal file:</p>\n\n<pre><code>name:                newp\nversion:             0.1.0.0\nsynopsis:            toying around\n-- description:\nhomepage:            none\n-- bug-reports:\nlicense:             BSD-3-Clause\nlicense-file:        LICENSE\nauthor:              redacted\nmaintainer:          none\n-- copyright:\ncategory:            practice\nextra-source-files:  CHANGELOG.md\n\nexecutable newp\n  main-is:             Main.hs\n  --other-modules:\n  -- other-extensions:\n  build-depends:       base ^&gt;=4.9.0.0\n  -- hs-source-dirs:\n  default-language:    Haskell2010\n</code></pre>\n\n<p>I can't seem to understand what's wrong. GCC is installed, I'm not trying to link any external library, I'm not using any other modules, I have no idea know what these references allude to.</p>\n\n<p>Any help is appreciated, because frankly, I don't know where to begin with this. I've tried looking online, but all the situations are different and the solutions don't seem to apply to me. I noticed that for others a similar error occurs when there's an issue with linking or not including modules in the cabal file, but I'm not sure how or if that applies here.</p>\n"}, {"tags": ["haskell", "parallel-processing", "profiling", "ghc"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1557287646, "post_id": 56033182, "comment_id": 98709474, "body": "How are you determining that there isn\u2019t any speedup?"}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1557291342, "last_edit_date": 1557291342, "creation_date": 1557290744, "answer_id": 56033683, "question_id": 56033182, "link": "https://stackoverflow.com/questions/56033182/cant-observe-speedup-on-parallel-haskell-code-but-profiling-indicates-otherwise/56033683#56033683", "title": "Can&#39;t observe speedup on parallel Haskell code but profiling indicates otherwise", "body": "<p>When <code>par</code> compute it's first argument it just force top level node to compute, but it can still refer to some lazy computation.</p>\n\n<p>If you change it to </p>\n\n<pre><code>import Control.Parallel\nimport Data.List\n\nparmap f a l = let\n    halflen = floor $ (realToFrac $ length l) / 2\n    half1 = take halflen l\n    half2 = drop halflen l\n    mapped1 = map f half1\n    mapped2 = map f half2\n    agg1 = a mapped1\n    agg2 = a mapped2\n    in agg1 `par` agg2 `pseq` a [agg1, agg2] \n\nforceEval x = sin x + cos x - tan x + sin(3*x) - cos(2*x)                   \n\nrunMap :: Double\nrunMap = parmap forceEval (foldl' (+) 0.0) [0.0..20000000.0]\n\nmain = do\n    putStrLn $ show runMap\n</code></pre>\n\n<p>You will see speedup when switch from one thread</p>\n\n<pre><code>time ./f +RTS -N1\n-4615093.834471449\n\nreal    0m13.077s\nuser    0m12.333s\nsys 0m0.744s\n</code></pre>\n\n<p>to two thread</p>\n\n<pre><code>time ./f +RTS -N2\n-4615093.834471449\n\nreal    0m9.057s\nuser    0m14.512s\nsys 0m2.170s\n</code></pre>\n\n<p>In my example <code>agg1</code> and <code>agg2</code> is primitive values and it is easier to force their computation.</p>\n\n<p><strong>Alternative</strong></p>\n\n<p>You can use <code>rnf</code> from <code>Control.DeepSeq</code> to force whole list to be computed.</p>\n\n<pre><code>import Control.Parallel \nimport Control.DeepSeq\nimport Data.List\n\nparmap f l = let\n    halflen = floor $ (realToFrac $ length l) / 2\n    half1 = take halflen l\n    half2 = drop halflen l\n    mapped1 = map f half1\n    mapped2 = map f half2\n    in (rnf mapped1) `par` (rnf mapped2) `pseq` (mapped1 ++ mapped2)\n\nforceEval x = sin x + cos x - tan x + sin(3*x) - cos(2*x)\n\nrunMap :: Double\nrunMap = foldl' (+) 0.0 $ parmap forceEval [0.0..20000000.0]\n\nmain = do\n    putStrLn $ show runMap\n</code></pre>\n\n<p>And see performance improvement.</p>\n\n<p>One thread</p>\n\n<pre><code>time ./f2 +RTS -N1\n-4615093.83447202\n\nreal    0m15.241s\nuser    0m14.261s\nsys 0m0.980s\n</code></pre>\n\n<p>Two threads</p>\n\n<pre><code>time ./f2 +RTS -N2\n-4615093.83447202\n\nreal    0m11.640s\nuser    0m17.092s\nsys 0m3.178s\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11467700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b73db925ead04bddb281efb715a3e8e7?s=128&d=identicon&r=PG&f=1", "display_name": "miyehn", "link": "https://stackoverflow.com/users/11467700/miyehn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1557291342, "creation_date": 1557286689, "question_id": 56033182, "link": "https://stackoverflow.com/questions/56033182/cant-observe-speedup-on-parallel-haskell-code-but-profiling-indicates-otherwise", "title": "Can&#39;t observe speedup on parallel Haskell code but profiling indicates otherwise", "body": "<p>I wrote a minimal example trying to parallelize some computation in Haskell. I basically tried to map some trig functions onto a long list by </p>\n\n<ol>\n<li>split the list in half  </li>\n<li>evaluate the two halves in parallel  </li>\n<li>concatenate them</li>\n<li>fold the list</li>\n</ol>\n\n<p>My code: </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- in file par.hs\n\nmodule Par where\n\nimport Control.Parallel\nimport Data.List\n\nparmap f l = let\n    halflen = floor $ (realToFrac $ length l) / 2\n    half1 = take halflen l\n    half2 = drop halflen l\n    mapped1 = map f half1\n    mapped2 = map f half2\n    in mapped1 `par` (mapped2 `pseq` mapped1 ++ mapped2)\n\nforceEval x = sin x + cos x - tan x + sin(3*x) - cos(2*x)\n\nrunMap :: Double\nrunMap = foldl' (+) 0.0 $ parmap forceEval [0.0..2000000.0]\n\nmain = do\n    putStrLn $ show runMap\n</code></pre>\n\n<p>I compiled it with <code>ghc -prof -fprof-auto -rtsopts -threaded par.hs</code></p>\n\n<p>I ran it with <code>./par +RTS -p -N?</code> where <code>?</code> is number of processors</p>\n\n<p>I then looked at the generated <code>par.prof</code> file.</p>\n\n<hr>\n\n<p>Below are a couple of profiling outputs I got. I ran and profiled multiple times, so I'm pretty sure these numbers were not outliers.</p>\n\n<p>Running with <code>-N1</code> gave me:</p>\n\n<pre><code>    Tue May  7 23:20 2019 Time and Allocation Profiling Report  (Final)\n\n       par +RTS -N1 -p -RTS\n\n    total time  =        1.20 secs   (1200 ticks @ 1000 us, 1 processor)\n    total alloc = 1,936,132,144 bytes  (excludes profiling overheads)\n\nCOST CENTRE   MODULE    SRC                   %time %alloc\n\nforceEval     Main      par.hs:28:1-57         75.8   60.3\nrunMap        Main      par.hs:31:1-59         17.5   19.0\nparmap'       Main      par.hs:(6,1)-(12,56)    3.2   14.9\nparmap'.half1 Main      par.hs:8:5-26           2.3    5.8\nparmap'.half2 Main      par.hs:9:5-26           1.1    0.0\n</code></pre>\n\n<p>Running with <code>-N2</code> (note how the profile indicates a more than a 2x speedup?):</p>\n\n<pre><code>    Tue May  7 23:24 2019 Time and Allocation Profiling Report  (Final)\n\n       par +RTS -N2 -p -RTS\n\n    total time  =        0.36 secs   (725 ticks @ 1000 us, 2 processors)\n    total alloc = 1,936,149,368 bytes  (excludes profiling overheads)\n\nCOST CENTRE   MODULE    SRC                   %time %alloc\n\nforceEval     Main      par.hs:28:1-57         70.6   60.3\nrunMap        Main      par.hs:31:1-59         19.3   19.0\nparmap'       Main      par.hs:(6,1)-(12,56)    4.3   14.9\nparmap'.half1 Main      par.hs:8:5-26           3.3    5.8\nparmap'.half2 Main      par.hs:9:5-26           1.7    0.0\n</code></pre>\n\n<p>Running with <code>-N4</code> (note the slight more speedup compared to <code>-N2</code>):</p>\n\n<pre><code>    Tue May  7 23:25 2019 Time and Allocation Profiling Report  (Final)\n\n       par +RTS -N4 -p -RTS\n\n    total time  =        0.27 secs   (1098 ticks @ 1000 us, 4 processors)\n    total alloc = 1,936,183,704 bytes  (excludes profiling overheads)\n\nCOST CENTRE   MODULE    SRC                   %time %alloc\n\nforceEval     Main      par.hs:28:1-57         71.5   60.3\nrunMap        Main      par.hs:31:1-59         19.3   19.0\nparmap'       Main      par.hs:(6,1)-(12,56)    3.8   14.9\nparmap'.half1 Main      par.hs:8:5-26           3.6    5.8\nparmap'.half2 Main      par.hs:9:5-26           1.2    0.0\n</code></pre>\n\n<hr>\n\n<p>I expected to see <em>some</em> speedup when running on two processors, but no additional speedup if I run on more processors. But I couldn't visually observe any speedup at all, yet the GHC profiles above told me that there was a speed up - an unrealistically good one, plus additional speedup if I use more than two processors? </p>\n\n<p>In fact in another program where I attempted to parallelize computation, I was compiling and profiling using stack, and observed such similar false speedup as well.</p>\n\n<p>I'd really appreciate if someone could explain to me what went on: Is this the right way of writing parallel Haskell code? Why could running with 4 cores be helpful in runtime if I only had two parts to evaluate in parallel? Or did I just misinterpret the profiling output?</p>\n\n<p>Thanks in advance for any help.</p>\n"}, {"tags": ["haskell", "concurrency", "promise", "monads"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1557284602, "post_id": 56032669, "comment_id": 98708878, "body": "Yes, that is exactly the reason: the whole point of monads is that they encode <i>order of operations</i>, and <code>Concurrently</code> expresses parallelism, which is an inherently unordered thing. But <code>Concurrently</code> is not actually equivalent to JS promise. Promises don&#39;t give you parallelism, only asynchrony. Perhaps if you described what your ultimate goal is, people here could help you find the right solution."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1557338176, "post_id": 56032669, "comment_id": 98734642, "body": "Related GitHub issue: <a href=\"https://github.com/simonmar/async/pull/26\" rel=\"nofollow noreferrer\">github.com/simonmar/async/pull/26</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1557285309, "post_id": 56032961, "comment_id": 98709016, "body": "But why can&#39;t we just let <code>ap = (&lt;*&gt;)</code>, is there any constraints that ap must be implemented by <code>(&gt;&gt;=)</code> ?"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1557285384, "post_id": 56032961, "comment_id": 98709034, "body": "I have read the code just now, and find that maybe it is just a Historical issues?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1557285420, "post_id": 56032961, "comment_id": 98709039, "body": "<code>ap</code> isn&#39;t in the <code>Monad</code> class. It&#39;s defined as <code>ap m1 m2 = do { x1 &lt;- m1; x2 &lt;- m2; return (x1 x2) }</code>, for every Monad. And no, it&#39;s not a historical issue."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1557285715, "post_id": 56032961, "comment_id": 98709106, "body": "So I&#39;m wondering, why can&#39;t we design a monad, which Applicative is a concurrent version, and Monad is a sequential version?  why <code>(&lt;*&gt;)</code> and <code>ap</code> must be equivalent? what is the motivation to add this rule?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1557285963, "post_id": 56032961, "comment_id": 98709166, "body": "For your first 2 questions, because the Monad laws say so. For your third, lots of reasons. See <a href=\"https://www.reddit.com/r/haskell/comments/3v9qlf/why_must_ap/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/3v9qlf/why_must_ap</a> and <a href=\"https://stackoverflow.com/q/46913472/7509065\">stackoverflow.com/q/46913472/7509065</a> and <a href=\"https://stackoverflow.com/q/24112786/7509065\">stackoverflow.com/q/24112786/7509065</a> for some of them."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 3, "creation_date": 1557287120, "post_id": 56032961, "comment_id": 98709386, "body": "I think i got it. these laws like <code>pure = return</code> and <code>(&lt;*&gt;) = ap</code> makes a promise that the <code>Applicative</code> and <code>Monad</code> instance of some specific data have the same semantics."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1557305528, "post_id": 56032961, "comment_id": 98716191, "body": "@luochen1990: exactly there are contracts between <code>Functor</code>, <code>Applicative</code> and <code>Monad</code>. One can not just implement these in an isolated manner, the <code>Functor</code> &quot;partly determines&quot; the &quot;shape&quot; of the <code>Monad</code>, and vice versa."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1557309828, "post_id": 56032961, "comment_id": 98718616, "body": "Thanks, I think maybe Haxl is what I want."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 5, "last_activity_date": 1557284779, "creation_date": 1557284779, "answer_id": 56032961, "question_id": 56032669, "link": "https://stackoverflow.com/questions/56032669/why-concurrently-is-not-a-monad-in-haskell/56032961#56032961", "title": "Why `Concurrently` is not a monad in Haskell?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad.html#t:Monad\" rel=\"noreferrer\">The <code>Monad</code> typeclass</a> states that <code>(&lt;*&gt;)</code> and <code>ap</code> should be equivalent. <code>(&lt;*&gt;)</code> for <code>Concurrently</code> evaluates both the LHS and the RHS at the same time. <code>ap</code> can't evaluate the RHS until the LHS is done, since <code>(&gt;&gt;=)</code> needs to finish evaluating the LHS before it can call the function that gives it the RHS.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 56032961, "answer_count": 1, "score": 4, "last_activity_date": 1557284779, "creation_date": 1557281903, "question_id": 56032669, "link": "https://stackoverflow.com/questions/56032669/why-concurrently-is-not-a-monad-in-haskell", "title": "Why `Concurrently` is not a monad in Haskell?", "body": "<p>I'm reading the doc of package <a href=\"https://www.stackage.org/haddock/lts-13.20/async-2.2.1/Control-Concurrent-Async.html\" rel=\"nofollow noreferrer\">async</a>, and trying to find something similar to JavaScript's Promise, and I find <code>Concurrently</code>, which is the most close concept that implemented <code>Functor</code>, <code>Applicative</code> (Promise.all), <code>Alternative</code> (Promise.race). But it doesn't implement <code>Monad</code> (Promise.then), I'm wondering why.</p>\n\n<p>I think it maybe because <code>(&gt;&gt;=)</code> is a sequential operation, which conflict with the name <code>Concurrently</code>, but is this the only reason? is there some more important reason here?</p>\n"}, {"tags": ["haskell", "idris", "frp"], "answers": [{"comments": [{"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1557275569, "post_id": 56031945, "comment_id": 98707335, "body": "Everything in the library will be single threaded async with callbacks and  no blocking."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1557276191, "post_id": 56031945, "comment_id": 98707437, "body": "I read your answer a few times. I believe you are saying that they should occur simultaneously, correct?"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1557277242, "post_id": 56031945, "comment_id": 98707593, "body": "Why do reflex and reactive-banana seem to think that they should not be simultaneous?"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1557274479, "creation_date": 1557274479, "answer_id": 56031945, "question_id": 56031824, "link": "https://stackoverflow.com/questions/56031824/should-io-run-inline-during-propagation/56031945#56031945", "title": "Should IO run inline during propagation?", "body": "<p>Trying to figure out what you are asking.  I think you are wondering how to account for <code>IO</code> actions that take time, no?  Because if the <code>IO</code> action was instantaneous this would not be a question.  Though there is still a question for me, which is does the <code>IO</code> action block until the future occurs or does it schedule it asynchronously?</p>\n\n<p>If this is a non-blocking call, I would say it should wait until the <code>IO</code> action completes.  (I would also call it <code>schedFuture</code> or some such to be clear that it doesn't block.)  Otherwise you could have the case of the <code>Future</code>'s time being in the past, yet the value still not being available, which could screw up the logic of functions that merge events, etc.</p>\n\n<p>If this is a blocking call, I would instead provide</p>\n\n<pre><code>waitFuture :: Future a -&gt; IO a\n</code></pre>\n\n<p>and let the user deal with the rest (e.g. they could <code>fmap (const x)</code> on the original future if they wanted to preserve the time, they could use <code>now :: IO (Future ())</code> if they wanted it when the action completes, etc.).  It might be worth providing combinators for those if you can come up with good names for them, otherwise they are easy enough that I'd just punt.</p>\n\n<p>I have also found it helpful when making systems like this to distinguish between \"morally instantaneous\" <code>IO</code> actions and actions that might block.  I suppose this is parallel to javascript's distinction between async and regular stack calls.  There are a lot of fuzzy questions like this, and the corresponding obvious answers tend to depend on this distinction.</p>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 56031945, "answer_count": 1, "score": 1, "last_activity_date": 1557277713, "creation_date": 1557273204, "last_edit_date": 1557277713, "question_id": 56031824, "link": "https://stackoverflow.com/questions/56031824/should-io-run-inline-during-propagation", "title": "Should IO run inline during propagation?", "body": "<p>I am trying to write an FRP library in Idris. This library designed to be run in a single thread environment. Future implement <code>Monad</code> and <code>Align</code>. I want to implement functions with these simplified type signatures:</p>\n\n<pre><code>createFutureResolveLater : (Future a, a -&gt; IO ()) -- later time\n\ncreateFutureResolveNow : a -&gt; IO (Future a) -- current time\n\npure : a -&gt; Future a -- before everything\n\nalign : Future a -&gt; Future a -&gt; Future (These a b) -- min of two times\n\njoin : Future (Future a)) -&gt; Future a -- max of two times\n\nexeEvent : Future (IO a) -&gt; IO (Future a) -- ??\n\nsimultaneous : Future a -&gt; Future b -&gt; Future Bool -- min of two times\n\nsubFuture : Future a -&gt; (a -&gt; IO ()) -&gt; IO ()\n</code></pre>\n\n<p>In seems obvious to me that</p>\n\n<pre><code>simultaneous a a, simultaneous a (fmap f a), etc.\n</code></pre>\n\n<p>should be a future that resolves to true.</p>\n\n<p>In</p>\n\n<pre><code>do\n    oe &lt;- exeEvent ie\n    let s = simultaneous oe ie\n    ...\n</code></pre>\n\n<p>should s resolve to true?</p>\n\n<p>In reactive-banana, s would be false. See mapEventIO in  <a href=\"http://hackage.haskell.org/package/reactive-banana-1.2.1.0/docs/Reactive-Banana-Frameworks.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/reactive-banana-1.2.1.0/docs/Reactive-Banana-Frameworks.html</a></p>\n\n<p>In reflex, s would also mostly likely be false. See performEvent in <a href=\"https://daig.github.io/reflex/Reflex-PerformEvent-Class.html\" rel=\"nofollow noreferrer\">https://daig.github.io/reflex/Reflex-PerformEvent-Class.html</a></p>\n\n<p>Why do these library authors choose for s to be false?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 2236, "user_id": 11384392, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5bfH.jpg?s=128&g=1", "display_name": "Das_Geek", "link": "https://stackoverflow.com/users/11384392/das-geek"}, "edited": false, "score": 0, "creation_date": 1557262502, "post_id": 56030311, "comment_id": 98704261, "body": "You could use the <code>head</code> and <code>last</code> functions if you don&#39;t care about complexity: they&#39;re O(n)."}], "answers": [{"tags": [], "owner": {"reputation": 516, "user_id": 8909756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3da2f45be132bea17b96c011c36b1013?s=128&d=identicon&r=PG&f=1", "display_name": "Steven Fontanella", "link": "https://stackoverflow.com/users/8909756/steven-fontanella"}, "is_accepted": true, "score": 2, "last_activity_date": 1557264784, "last_edit_date": 1557264784, "creation_date": 1557262783, "answer_id": 56030398, "question_id": 56030311, "link": "https://stackoverflow.com/questions/56030311/haskell-list-manipulation/56030398#56030398", "title": "Haskell: List manipulation", "body": "<p>Note that we have to use <code>drop 1</code> instead of <code>tail</code> here to avoid errors for odd-length lists.</p>\n\n<pre><code>g2 :: [a] -&gt; [[a]]\ng2 [] = []\ng2 xs = [first xs] ++ (g2 . drop 1 $ init xs)\n    where first (x:[]) = [x]\n          first xs = [head xs, last xs]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1557264594, "post_id": 56030694, "comment_id": 98704960, "body": "I was about to post a very similar solution, but I used <code>splitAt (length xs `div` 2) xs</code>"}, {"owner": {"reputation": 25268, "user_id": 215168, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/212c9d7980fe9aa71739313d483b3782?s=128&d=identicon&r=PG", "display_name": "Abe Voelker", "link": "https://stackoverflow.com/users/215168/abe-voelker"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1557265136, "post_id": 56030694, "comment_id": 98705133, "body": "Oh nice, that&#39;s even better"}], "tags": [], "owner": {"reputation": 25268, "user_id": 215168, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/212c9d7980fe9aa71739313d483b3782?s=128&d=identicon&r=PG", "display_name": "Abe Voelker", "link": "https://stackoverflow.com/users/215168/abe-voelker"}, "is_accepted": false, "score": 4, "last_activity_date": 1557264503, "creation_date": 1557264503, "answer_id": 56030694, "question_id": 56030311, "link": "https://stackoverflow.com/questions/56030311/haskell-list-manipulation/56030694#56030694", "title": "Haskell: List manipulation", "body": "<p>Here's one using <code>transpose</code></p>\n\n<pre><code>import Data.List\n\ng2 xs =\n  transpose [take (x + y) xs, take x (reverse xs)]\n    where (x, y) = (length xs) `divMod` 2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "is_accepted": false, "score": 6, "last_activity_date": 1557272461, "last_edit_date": 1557272461, "creation_date": 1557269984, "answer_id": 56031473, "question_id": 56030311, "link": "https://stackoverflow.com/questions/56030311/haskell-list-manipulation/56031473#56031473", "title": "Haskell: List manipulation", "body": "<p>Here's one that does it in one pass:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>pairs :: [a] -&gt; [[a]]\npairs xs = fst (go xs xs) where\n  go (x:xs) (_:_:ys) = f x (go xs ys)\n  go (x:xs) [_]      = ([[x]],xs)\n  go xs     []       = ([],xs)\n\n  f x (xs,y:ys) = ([x,y]:xs,ys)\n</code></pre>\n\n<p>How does it work? Let's look at the first two arguments of go first, and in particular this line:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  go (x:xs) (_:_:ys) = f x (go xs ys)\n</code></pre>\n\n<p>Those two arguments are both from the same list (<code>xs</code>), but we take 2 items off of one, and only one off of the other. Why? So we know when we hit the halfway point. Look at this function for comparison:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>halfway xs = go xs xs\n  where\n    go (_:xs) (_:_:ys) = go xs ys\n    go xs _ = xs\n\n&gt;&gt;&gt; halfway [1..6]\n[4,5,6]\n</code></pre>\n\n<p>Now, once we get to the halfway point we'll need to \"zip\" it with the other list. But it needs to be in reverse! How do we do this? A handy way to reverse any function in one pass is to first write it as a fold. Here's zip written as a fold:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>zip = foldr (\\x k (y:ys) -&gt; (x,y) : k ys) (const [])\n</code></pre>\n\n<p>To \"reverse\" it, you just apply is as a <code>foldl</code> rather than as a <code>foldr</code> (you also have to flip the closure).</p>\n\n<p>For our uses, we basically build up the base as we go (in the form of <code>k</code>). So no our function looks like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>pairs :: [a] -&gt; [[a]]\npairs xs = go xs xs (const []) where\n  go (y:ys) (_:_:zs) k = go ys zs (f y k)\n  go (y:ys) [_]      k = [y] : k ys\n  go ys     []       k = k ys\n\n  f x k (y:ys) = [x,y] : k ys -- same `f` as from `zip`\n</code></pre>\n\n<p>There's still one problem: the list is returned in the wrong order. To fix this, we replace the list with a <a href=\"https://wiki.haskell.org/Difference_list\" rel=\"noreferrer\">difference list</a>, and swap the order of the appends.</p>\n\n<p>Finally, we un-CPS the function, and we get the above.</p>\n"}, {"tags": [], "owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1557307751, "creation_date": 1557307751, "answer_id": 56037545, "question_id": 56030311, "link": "https://stackoverflow.com/questions/56030311/haskell-list-manipulation/56037545#56037545", "title": "Haskell: List manipulation", "body": "<p>Two more, the second is using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:unfoldr\" rel=\"nofollow noreferrer\">unfoldr</a>:</p>\n\n<pre><code>pair xs = take (length xs `div` 2) $ zip xs (reverse xs)\n-- Note: uses tuples instead of lists\n\nimport Data.List\npairs2 = unfoldr (\\xs -&gt;\n    if length xs &lt; 2 \n    then Nothing\n    else Just ([head xs, last xs], init.tail $ xs))\n\nxs = [2,3,4,7,6]\npair xs   -- [(2,6),(3,7)]\npair2 xs  -- [[2,6],[3,7]]\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 56030398, "answer_count": 4, "score": 1, "last_activity_date": 1557307751, "creation_date": 1557262251, "last_edit_date": 1557295869, "question_id": 56030311, "link": "https://stackoverflow.com/questions/56030311/haskell-list-manipulation", "title": "Haskell: List manipulation", "body": "<p>I want to write a function which takes a input list and manipulates it in the following way:</p>\n\n<p>Step 1: Take the first element of the list and the last element of the list and put it together in a sublist. </p>\n\n<p>Step 2: Take the second element of the list and the second last element of the list and put it together in the next sublist.</p>\n\n<p>Step 3: Take the third element of the list and the third last element of the \nlist and put it together in next sublist.</p>\n\n<p>Continue this according to the same scheme (for a list of n elements)...</p>\n\n<p>If the number of elements of the input list is odd the n/2 element of the input list will be added as last sublist of the output list.</p>\n\n<p>Example:</p>\n\n<pre><code>[1,2,3,4,5,6,7]\n\n-- should be transformed to\n\n[[1,7],[2,6],[3,5],[4]]\n</code></pre>\n\n<p>I already wrote a function which takes every 2 elements of a list and puts it together in sublists and I am wondering if this code might help me with my problem above:</p>\n\n<pre><code>g2 :: [a] -&gt; [[a]]\ng2 [] = []\ng2 (x1:x2:xs) = [x1,x2]: g2 xs\ng2 xs = [xs]\n</code></pre>\n"}, {"tags": ["macos", "haskell", "haskell-stack", "haskell-platform"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 2, "creation_date": 1557323419, "post_id": 56029761, "comment_id": 98726645, "body": "<code>utimensat</code> is available in Mac OS 10.13 and later."}, {"owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1557334611, "post_id": 56029761, "comment_id": 98732850, "body": "@BobDalgleish - do you have any idea how to install utimensat in older mac versions? <code>brew install utimensat</code> is giving error <code>No available formula with the name &quot;utimensat&quot;</code>"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1557341223, "post_id": 56029761, "comment_id": 98736066, "body": "It is an operating system call. It can&#39;t be &quot;installed&quot;. If you are unable to install MacOS 10.13 or later, you might consider spinning up a virtual machine running linux. Alternatively, you can try to install an older version of the haskell-ide-engine."}], "answers": [{"tags": [], "owner": {"reputation": 445, "user_id": 189176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/274a52c00e4f37979f33423fc8acf371?s=128&d=identicon&r=PG", "display_name": "Carter Tazio Schonwald", "link": "https://stackoverflow.com/users/189176/carter-tazio-schonwald"}, "is_accepted": false, "score": 1, "last_activity_date": 1583525882, "last_edit_date": 1583525882, "creation_date": 1583514418, "answer_id": 60568614, "question_id": 56029761, "link": "https://stackoverflow.com/questions/56029761/undefined-symbols-for-architecture-x86-64-utimensat-referenced-from-cazw/60568614#60568614", "title": "Undefined symbols for architecture x86_64: &quot;_utimensat&quot;, referenced from: _cazW_info in libHSdirectory-1.3.3.0.a(Posix.o)", "body": "<p>I believe the culprit is that the Unix package is built with <code>ghc</code> on a newer macOS version. Try using your own build of the Unix package.</p>\n"}], "owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 497, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1583525882, "creation_date": 1557259519, "question_id": 56029761, "link": "https://stackoverflow.com/questions/56029761/undefined-symbols-for-architecture-x86-64-utimensat-referenced-from-cazw", "title": "Undefined symbols for architecture x86_64: &quot;_utimensat&quot;, referenced from: _cazW_info in libHSdirectory-1.3.3.0.a(Posix.o)", "body": "<p>I'm trying to install haskell-ide-engine. Below are the commands</p>\n\n<pre><code>git clone https://github.com/haskell/haskell-ide-engine --recursive\ncd haskell-ide-engine \n./install.hs build-all\n</code></pre>\n\n<p>The last command <code>./install.hs build-all</code> failed with the below error - </p>\n\n<pre><code>    [146 of 150] Compiling Distribution.Client.Sandbox ( Distribution/Client/Sandbox.hs, .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/cabal/cabal-tmp/Distribution/Client/Sandbox.o )\n    [147 of 150] Compiling Distribution.Client.Reconfigure ( Distribution/Client/Reconfigure.hs, .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/cabal/cabal-tmp/Distribution/Client/Reconfigure.o )\n    [148 of 150] Compiling Distribution.Client.Exec ( Distribution/Client/Exec.hs, .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/cabal/cabal-tmp/Distribution/Client/Exec.o )\n    [149 of 150] Compiling Distribution.Client.CmdLegacy ( Distribution/Client/CmdLegacy.hs, .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/cabal/cabal-tmp/Distribution/Client/CmdLegacy.o )\n    [150 of 150] Compiling Main             ( main/Main.hs, .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/cabal/cabal-tmp/Main.o )\n    Linking .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/cabal/cabal ...\n    Undefined symbols for architecture x86_64:\n      \"_utimensat\", referenced from:\n          _cazW_info in libHSdirectory-1.3.3.0.a(Posix.o)\n    ld: symbol(s) not found for architecture x86_64\n    clang: error: linker command failed with exit code 1 (use -v to see invocation)\n    `gcc' failed in phase `Linker'. (Exit code: 1)\n)\n</code></pre>\n\n<p>my mac os Sierra version 10.12.6.</p>\n\n<p>How can I resolve this issue?</p>\n"}, {"tags": ["if-statement", "haskell"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 2, "creation_date": 1557255067, "post_id": 56028824, "comment_id": 98701180, "body": "Try the MultiWayIf extension."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557256004, "post_id": 56028824, "comment_id": 98701580, "body": "Does this imply that if <code>bool7</code> is false, the outer branch is considered again and <code>bool8</code> is evaluated, and so on? Your <code>multiIf</code> does not do that, AFAICS."}, {"owner": {"reputation": 23, "user_id": 10255887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2915bdc5d5f64cf239284336e9741483?s=128&d=identicon&r=PG&f=1", "display_name": "Laurens", "link": "https://stackoverflow.com/users/10255887/laurens"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557256089, "post_id": 56028824, "comment_id": 98701610, "body": "@chi Thanks, I meant to use otherwise"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557256133, "post_id": 56028824, "comment_id": 98701627, "body": "while I&#39;d admit it&#39;s not particularly nice, if you really need to write this sort of function then I&#39;d probably just make a big <code>if&#47;then&#47;else</code> tree, with the proper indentation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557259372, "post_id": 56028824, "comment_id": 98702989, "body": "@RobinZigmond Minor point: technically <code>if</code> does not require any indentation (but pragmatically writing a large nested <code>if</code> without proper indentation leads to unreadable code, so its&#39; still strongly recommended)."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557259644, "post_id": 56028824, "comment_id": 98703097, "body": "@chi, understood and agreed - that&#39;s all I meant"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557262242, "post_id": 56028824, "comment_id": 98704173, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/34124558/is-it-possible-to-nest-guards-in-haskell\">Is it possible to nest guards in Haskell?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1557271218, "creation_date": 1557271218, "answer_id": 56031604, "question_id": 56028824, "link": "https://stackoverflow.com/questions/56028824/is-there-a-multiple-condition-if-in-haskell/56031604#56031604", "title": "Is there a multiple-condition if in Haskell?", "body": "<p>Not directly, but <a href=\"https://downloads.haskell.org/~ghc/8.6.5/docs/html/users_guide/glasgow_exts.html#multi-way-if-expressions\" rel=\"nofollow noreferrer\">the MultiWayIf extension</a> can get you a very similar style.</p>\n\n<pre><code>{-# LANGUAGE MultiWayIf #-}\n\nf :: Int -&gt; Int\nf i\n   | bool1\n       = if | bool2 -&gt; a\n            | bool3 -&gt; a2\n            | otherwise -&gt; a3\n   | bool4\n       = if | bool5 -&gt; a4\n            | bool6 -&gt; a5\n            | otherwise -&gt; a6\n   | bool8\n...\n   | otherwise = an\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 10255887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2915bdc5d5f64cf239284336e9741483?s=128&d=identicon&r=PG&f=1", "display_name": "Laurens", "link": "https://stackoverflow.com/users/10255887/laurens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 56031604, "answer_count": 1, "score": 1, "last_activity_date": 1557271218, "creation_date": 1557255019, "last_edit_date": 1557256119, "question_id": 56028824, "link": "https://stackoverflow.com/questions/56028824/is-there-a-multiple-condition-if-in-haskell", "title": "Is there a multiple-condition if in Haskell?", "body": "<p>I was trying to nest guards which check for more than two conditions like so:</p>\n\n<pre><code>f :: Int -&gt; Int\nf i\n   | bool1\n       | bool2 = a\n       | bool3 = a2\n       | otherwise = a3\n   | bool4\n       | bool5 = a4\n       | bool6 = a5\n       | otherwise = a6\n   | bool8\n...\n   | otherwise = an\n\n\n</code></pre>\n\n<p>which gives me a parse error.\nIs the proper way to do this<br>\n   to flatten the guards with &amp;&amp; or<br>\n   to implement a function like so:</p>\n\n<pre><code>multiIf :: [Bool] -&gt; [a] -&gt; a\nmultiIf (x:xs) (l:ls) = if x then l else multiIf xs ls\nmultiIf _ _ = undefined\n\n</code></pre>\n\n<p>Or is there another method?</p>\n"}, {"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557253132, "post_id": 56028373, "comment_id": 98700338, "body": "You can try to first implement the cases individually, or if that is still too hard, start with simpler problems."}, {"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "edited": false, "score": 1, "creation_date": 1557304690, "post_id": 56028373, "comment_id": 98715693, "body": "Why do you allow invalid things to be expressible? The second layer is three shots, the inner layer is two numbers. I would define <code>data Multiplier = Single | Double | Triple</code>, <code>type Shot = (Int, Multiplier)</code>, <code>type Turn = (Shot, Shot, Shot)</code>, <code>type Leg = [(Turn, Turn)]</code>, and things would be cleaner to deal with. You can write <code>shotPoints :: Shot -&gt; Int</code>, then <code>turnPoints :: Turn -&gt; Int</code> in terms of <code>shotPoints</code>, etc."}], "owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557252915, "creation_date": 1557252915, "question_id": 56028373, "link": "https://stackoverflow.com/questions/56028373/haskell-a-game-of-darts", "title": "Haskell: A game of darts", "body": "<p>I am trying to implement a game of darts in haskell. I chose to represent the result of every leg in different layers of lists. Every first element of the inner list represents the multiplier (single, double, triple), every second element represents the value of points which are getting multiplied. Every player starts with a score of 501 points. These points are getting reduced by the amount of points a player shots in every turn. If a player reaches 0 points he will win the full leg.</p>\n\n<p>This is an example for an random leg in which the starting player wins:</p>\n\n<pre><code>          leg1 = [[[3,20],[3,20],[3,20]],[[3,20],[3,19],[2,25]],[[3,19], \n          [3,19],[3,19]],[[3,20],[3,19],[2,25]],[[2,25],[2,25],[2,25]]] \n          -- the outer list represents the full leg.\n          -- the second layer of lists represents a full turn of a player. \n          -- the inner lists are composed of a pair of two elements\n          -- and every pair represents one shot.\n</code></pre>\n\n<p>My goal is to write a function which takes a random leg as input parameter and do the following for different chases:</p>\n\n<p>Chase 1: It should return 1 if the starting player wins the full leg.</p>\n\n<p>Chase 2: It should return 2 if the other player wins.</p>\n\n<p>Chase 3: It should return 0 if there is a invalid combination of the inner\n         pair of list elements (for example [3,0] is invalid because triple 0 \n         does not exist in the game). </p>\n\n<p>Example:      </p>\n\n<pre><code>      legWinner leg1 -- call of the function with parameter.\n     -&gt; 1            -- return value.\n</code></pre>\n\n<p>I am not quite sure how to approach the definition of this function.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1557253022, "post_id": 56028342, "comment_id": 98700288, "body": "Newline at the end?"}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1557253027, "creation_date": 1557253027, "answer_id": 56028398, "question_id": 56028342, "link": "https://stackoverflow.com/questions/56028342/data-bytestring-length-gives-wrong-length/56028398#56028398", "title": "Data.Bytestring length gives wrong length", "body": "<p><code>B.getLine</code> includes the newline character at the end of your input in the <code>ByteString</code> it produces. </p>\n"}], "owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 56028398, "answer_count": 1, "score": 1, "last_activity_date": 1557253027, "creation_date": 1557252775, "question_id": 56028342, "link": "https://stackoverflow.com/questions/56028342/data-bytestring-length-gives-wrong-length", "title": "Data.Bytestring length gives wrong length", "body": "<p>I'm trying to make a program that uses the length of an input string as part of the calculation. </p>\n\n<p>I want to use ByteString to speed things up as the input string can be extremely long (Note: I dont really know what ByteString is, I just heard its faster than String when input is large).</p>\n\n<p>However, when doing something like this:</p>\n\n<pre><code>import qualified Data.ByteString as B\n\nmain = do\n    line &lt;- B.getLine\n    putStrLn . show $ B.length line\n</code></pre>\n\n<p>If I would pass the string: 10888869450418352160768000000</p>\n\n<p>I get 30, but the length is 29. </p>\n\n<p>Anyone know why?</p>\n"}, {"tags": ["haskell", "monads", "category-theory"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1557247919, "post_id": 56026072, "comment_id": 98698041, "body": "Are you thinking of some specific text which says &quot;a monad is a model of computation&quot;? In the context of a concrete examples it would be easier to tell whether it is just a mondegreen, as Carl suggests, or something more substantial."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1557248624, "post_id": 56026072, "comment_id": 98698319, "body": "Don&#39;t try to find a one-liner that easily explains what a monad is, it&#39;s a fairly complex notion that requires more explanation. I&#39;ve heard &quot;monads are programmable semicolons&quot;, &quot;monads are monoids (in the category of endofunctors, of course)&quot;, &quot;monads are like burritos&quot;, etc. which on their own are of no help to a beginner (even when they are technically correct). Try reading a monad tutorial, and focus on the examples and theory."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557251702, "post_id": 56026072, "comment_id": 98699680, "body": "@chi, agreed, but I&#39;m pretty sure that &quot;monads are like Burritos&quot; was a joke, which arose (ironically) from a post rightly saying exactly what you are, that there is no one analogy that instantly explains &quot;what a monad is&quot;. <a href=\"https://www.google.com/amp/s/byorgey.wordpress.com/2009/01/12/abstraction-intuition-and-the-monad-tutorial-fallacy/amp/\" rel=\"nofollow noreferrer\">This</a> is the post I&#39;m thinking of."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557251874, "post_id": 56026072, "comment_id": 98699765, "body": "Also, it&#39;s really not clear that the OP here is just another &quot;what is a monad&quot; post (for which there are of course a number of SO questions with excellent answers). Perhaps they will come back and clarify the question, if the comments and answer here haven&#39;t addressed it."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1557255054, "post_id": 56026072, "comment_id": 98701172, "body": "The idea of using monads in programming languages comes from Eugenio Moggi&#39;s  \u200e1991 paper &quot;Notions of computation and monads&quot; <a href=\"https://core.ac.uk/download/pdf/21173011.pdf\" rel=\"nofollow noreferrer\">core.ac.uk/download/pdf/21173011.pdf</a> Its final paragraph includes the sentence: &quot;We have identified monads as important to model notions of computations&quot;. A later paper by Rivas and Jaskelioff called &quot;Notions of Computation as Monoids&quot; begins like this: &quot;When constructing a semantic model of a system or when structuring computer code, there are several notions of computation that one might consider. Monads are the most popular notion&quot;."}, {"owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "edited": false, "score": 0, "creation_date": 1557255069, "post_id": 56026072, "comment_id": 98701181, "body": "No this is not just another &quot;what is a monad&quot; post. See my clarification of the question above where I also added a link to a typical case where this phrase is used."}, {"owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1557261472, "post_id": 56026072, "comment_id": 98703894, "body": "Thanks @danidiaz, your comment led me to this other paper by Moggi: <a href=\"https://www.disi.unige.it/person/MoggiE/ftp/lics89.pdf\" rel=\"nofollow noreferrer\">disi.unige.it/person/MoggiE/ftp/lics89.pdf</a>. Here the term &quot;computational model&quot; is used in the sense like the lambda calculus is a computational model."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1557275800, "post_id": 56026757, "comment_id": 98707372, "body": "I suggest adjusting this answer to somewhat deemphasise the advice for learners, which feels out of place now that the OP has made it clear they aren&#39;t looking for a monad tutorial, and expand a bit on the mix-up between predication and identity that appears to be at the root of your objection to &quot;monads are models of computation&quot; (which can be used in a reductive way, <i>if</i> the &quot;are&quot; is taken to mean identity)."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 12, "last_activity_date": 1557245994, "creation_date": 1557245994, "answer_id": 56026757, "question_id": 56026072, "link": "https://stackoverflow.com/questions/56026072/what-does-a-monad-is-a-model-of-computation-mean/56026757#56026757", "title": "What does &quot;a monad is a model of computation&quot; mean", "body": "<p>Nothing. It doesn't mean anything. It's the output of someone struggling to find metaphors which make monads into something they already know. It <em>almost</em> means something. \"It is possible to construct models of computation which form monads,\" for instance, is a meaningful statement. But the difference is significant. \"Monads are models of computation\" is an attempt to force a broad abstraction into a narrow interpretation. The other specifies that you can work with a broader abstraction for one use case. </p>\n\n<p>Be very wary of reductive explanations. Do you think that an entire community of developers would keep using unfamiliar terminology if familiar terminology communicated the same thing? The term <code>Monad</code> has stuck around for 20 years in a language community that rapidly invents and discards abstractions as it searches for improvements. The only way that can happen is if it communicates something useful and precise.</p>\n\n<p>It's just hard to write an explanation of the application of the idea to programming that makes any sense to people who don't know enough of the language to understand the constructs in use. If you aren't comfortable with at least higher-kinded types, type classes, and higher-order functions there's no way to understand what the notation is saying. </p>\n\n<p>Learning prerequisite ideas will help. Practice writing code will help. Looking at how <code>(&gt;&gt;=)</code> works for various concrete types will help. Struggling through learning how to use a library like Parsec (or modern descendants like megaparsec) will help.</p>\n\n<p>Trying to force the idea to match something you already know via metaphor will not. </p>\n"}, {"comments": [{"owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "edited": false, "score": 2, "creation_date": 1557308563, "post_id": 56031603, "comment_id": 98717891, "body": "Thanks @duplode for putting this together. The essence to me is from Moggi&#39;s 1991 paper cited above and nicely summarized on page 3 of <a href=\"https://arxiv.org/ftp/arxiv/papers/1803/1803.10195.pdf\" rel=\"nofollow noreferrer\">arxiv.org/ftp/arxiv/papers/1803/1803.10195.pdf</a>: &quot;Moggi used monads in semantics of programming languages to capture many different notions of computation that go beyond total functions, such as non-determinism, side-effects and exceptions&quot;."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 14, "last_activity_date": 1557311725, "last_edit_date": 1592644375, "creation_date": 1557271210, "answer_id": 56031603, "question_id": 56026072, "link": "https://stackoverflow.com/questions/56026072/what-does-a-monad-is-a-model-of-computation-mean/56031603#56031603", "title": "What does &quot;a monad is a model of computation&quot; mean", "body": "<p>The idea of monads as models of computation can be traced back to the work of Eugenio Moggi. Among Haskell practitioners, the best known paper by Moggi on this matter is <a href=\"https://www.disi.unige.it/person/MoggiE/ftp/ic91.pdf\" rel=\"noreferrer\"><em>Notions of computations as monads</em></a> (1991). Relevant quotes include:</p>\n<blockquote>\n<p>The [lambda]-calculus is considered a useful mathematical tool in the study  of programming languages, since programs can be <em>identified</em> with [lambda]-terms. However, if one goes further and uses [beta][eta]-conversion to prove equivalence of programs, then a gross simplification is introduced (programs are identified with total functions from <em>values</em> to <em>values</em>) that may jeopardise the applicability  of theoretical results, In this paper we introduce calculi based on a categorical semantics for <em>computations</em>, that provide a correct basis for proving equivalence of programs for a wide range of <em>notions of computation</em>. [p. 1]</p>\n<p>[...]</p>\n<p>We do not take as a starting point for proving equivalence of programs the theory of [beta][eta]-conversion, which identifies the denotation of a program (procedure) of type A -&gt; B with a total function from A to B, since this identification wipes out completely behaviours such as non-termination, non-determinism, and side-effects, that can be exhibited by real programs. Instead, we proceed as follows:</p>\n<ul>\n<li>\n<ol>\n<li>We take category theory as a general theory of functions and develop on top a categorical semantics of computations based on monads. [...] [p. 1]</li>\n</ol>\n</li>\n</ul>\n<p>[...]</p>\n<p>The basic idea behind the categorical semantics below  is that, in order to interpret a programming language in a category [C], we distinguish the object A of values (of type A) from the object TA of computations (of type A), and take as denotations of programs (of type A) the elements of TA. In particular, we identify the type A with the object of values (of type A) and obtain the object of computations (of type A) by applying an unary type-constructor T to A. We call T a <em>notion of computation</em>, since it abstracts away from the type of values computations may produce. There are many choices for TA corresponding to different notions of computations. [pp. 2-3]</p>\n<p>[...]</p>\n<p>We have identified monads as important to modeling notions of computations, but <em>computational monads</em> seem to have additional properties; e.g., they have a tensorial strength and may satisfy the mono requirement. It is likely that there are other properties of computational monads still to be identified, and there is no reason to believe that such properties have to be found in the literature on monads. [p. 27 -- thanks danidiaz]</p>\n</blockquote>\n<p>A related older paper by Moggi, <a href=\"https://www.disi.unige.it/person/MoggiE/ftp/lics89.pdf\" rel=\"noreferrer\"><em>Computational lambda-calculus and monads</em></a> (1989 -- thanks michid for the reference), speaks literally of &quot;computational model[s]&quot;:</p>\n<blockquote>\n<p>A <strong>computational model</strong> is a monad (T;[eta];[mu]) satisfying the <strong>mono requirement</strong>: [eta-A] is a mono for every A [belonging to] C.</p>\n<p>There is an alternative description of a monad (see[7]), which is easier to justify computationally. [...] [p. 2]</p>\n</blockquote>\n<p>This particular bit of terminology was dropped in the <em>Notions of computations as monads</em>, as Moggi sharpened the focus of his presentation on the &quot;alternative description&quot; (namely, Kleisli triples, which are composed by, in Haskell parlance, a type constructor, return and bind). The essence, though, remain the same throughout.</p>\n<hr />\n<p>Philip Wadler presents the idea with a more practical bent in <a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf\" rel=\"noreferrer\"><em>Monads for functional programming</em></a> (1992):</p>\n<blockquote>\n<p>The use of monads to structure functional programs is described. Monads provide a convenient framework for simulating effectsfound in other languages, such as global state, exception handling, out-put, or non-determinism. [p. 1]</p>\n<p>[...]</p>\n<p>Pure functional languages have this advantage: all flow of data is made explicit.And this disadvantage: sometimes it is painfully explicit.</p>\n<p>A  program  in  a  pure  functional  language  is  written  as  a  set  of  equations. Explicit data flow ensures that the value of an expression depends only on its free  variables.  Hence  substitution  of  equals  for  equals  is  always  valid,  making such programs especially easy to reason about. Explicit data flow also ensures that the order of computation is irrelevant, making such programs susceptible to lazy evaluation.</p>\n<p>It is with regard to modularity that explicit data flow becomes both a blessing and  a  curse.  On  the  one  hand,  it  is  the  ultimate  in  modularity.  All  data  in and all data out are rendered manifest and accessible, providing a maximum of flexibility. On the other hand, it is the nadir of modularity. The essence of an algorithm can become buried under the plumbing required to carry data from its point of creation to its point of use. [p. 2]</p>\n<p>[...]</p>\n<p>Say it is desired to add error checking, so that the second example above returns a sensible error message. In an impure language, this is easily achieved with the use of exceptions.</p>\n<p>In a pure language, exception handling may be mimicked by introducing a type to represent computations that may raise an exception. [pp. 3 -4 -- note this is before monads are introduced as an unifying abstraction.]</p>\n<p>[...]</p>\n<p>Each of the variations on the interpreter has a similar structure, which may be abstracted to yield the notion of a monad.</p>\n<p>In  each  variation,  we  introduced  a  type  of  computations.  Respectively, M represented computations that could raise exceptions, act on state, and generate output. By now the reader will have guessed that M stands for monad. [p. 6]</p>\n</blockquote>\n<p>This is one of the roots of the usage of &quot;computation&quot; to refer to monadic values.</p>\n<hr />\n<p>A significant body of later literature makes use of the concept of computation in this manner. For instance, this is the opening passage of <a href=\"https://arxiv.org/abs/1406.4823\" rel=\"noreferrer\"><em>Notions of Computation as Monoids</em></a> by Exequiel Rivas and Mauro Jaskelioff (2014 -- thanks danidiaz for the suggestion):</p>\n<blockquote>\n<p>When  constructing  a  semantic  model  of  a  system  or  when  structuring  computer  code,there are several notions of computation that one might consider. Monads (Moggi, 1989; Moggi, 1991) are the most popular notion, but other notions,such as arrows (Hughes, 2000) and,  more recently, applicative functors (McBride &amp; Paterson, 2008)  have been  gaining widespread acceptance. Each of these notions of computation has particular characteristics that makes them more suitable  for  some  tasks  than  for  others.  Nevertheless,  there  is  much  to  be  gained from unifying all three different notions under a single conceptual framework. [p. 1]</p>\n</blockquote>\n<p>Another good example is <a href=\"https://www.sciencedirect.com/science/article/pii/S1571066108003435\" rel=\"noreferrer\"><em>Comonadic notions of computation</em></a> by Tarmo Uustalu and Varmo Vene (2000):</p>\n<blockquote>\n<p>Since the seminal work by Moggi in the late 80s, monads, more precisely, strong monads, have become a generally accepted tool for structuring effectful notions of computation, such as computation with exceptions, output, computation using an environment, state-transforming, nondeterministic and probabilistic computation etc.  The idea is to use a Kleisli category as the category of impure, effectful functions, with the Kleisli inclusion giving an embedding of the pure functions from the base category. [...] [p. 263]</p>\n<p>[...]</p>\n<p>The starting-point in the monadic approach to (call-by-value) effectful computation is the idea that impure, effectful functions from A to B must be nothing else than pure functions from A to TB. Here pure functions live in a base category C and T is an endofunctor on C that describes the notion of effect of interest; it is useful to think of TA as the type of effectful computations of values of a given type A.</p>\n<p>For this to work, impure functions must have identities and compose. Therefore T cannot merely be a functor, but must be a monad. [p. 265]</p>\n</blockquote>\n<hr />\n<p>Such uses of &quot;computation&quot; fit the usual computer science notion of <a href=\"https://en.wikipedia.org/wiki/Model_of_computation\" rel=\"noreferrer\">models of computation</a> (see <a href=\"https://stackoverflow.com/a/56034400/2751851\">danidiaz's answer</a> for more on that). In the informal functional programming literature, allusions to monads as models of computation have varying degrees of precision. Still, they generally draw from, or at least are offshoots of, a rigorous idea.</p>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1557295380, "post_id": 56034400, "comment_id": 98711516, "body": "Related: <a href=\"https://cstheory.stackexchange.com/questions/944/solid-applications-of-category-theory-in-tcs\" title=\"solid applications of category theory in tcs\">cstheory.stackexchange.com/questions/944/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 4, "last_activity_date": 1557296122, "last_edit_date": 1557296122, "creation_date": 1557295197, "answer_id": 56034400, "question_id": 56026072, "link": "https://stackoverflow.com/questions/56026072/what-does-a-monad-is-a-model-of-computation-mean/56034400#56034400", "title": "What does &quot;a monad is a model of computation&quot; mean", "body": "<p>Expanding a little on @duplode's answer, I think that when talking about computation, \"model\" can have at least two slightly different meanings.</p>\n\n<hr>\n\n<p>One is <a href=\"https://en.wikipedia.org/wiki/Model_of_computation\" rel=\"nofollow noreferrer\">model</a> in the sense of the <a href=\"https://en.wikipedia.org/wiki/Church%E2%80%93Turing_thesis\" rel=\"nofollow noreferrer\">Church\u2013Turing thesis</a>. Here a model is a way of performing computations that is capable of expressing any algorithm. So <a href=\"https://en.wikipedia.org/wiki/Turing_machine\" rel=\"nofollow noreferrer\">turing machines</a>, <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus\" rel=\"nofollow noreferrer\">lambda calculus</a>, <a href=\"https://en.wikipedia.org/wiki/Post_correspondence_problem\" rel=\"nofollow noreferrer\">post correspondence systems</a>... are all models.</p>\n\n<hr>\n\n<p>Another is model in the sense of <a href=\"https://en.wikipedia.org/wiki/Semantics_(computer_science)\" rel=\"nofollow noreferrer\">programming language semantics</a>. The idea is that we consider programs as composable <em>syntactical</em> structures, and we want them to \"mean\" something, ideally in a way that lets us determine the meaning of a composition from the meaning of the elements. In this sense, lambda calculus <em>has</em> models.</p>\n\n<p>Now, one kind of semantics is <a href=\"https://cstheory.stackexchange.com/questions/3577/what-constitutes-denotational-semantics\">denotational semantics</a>, in which the meaning we assign to a program is some kind of mathematical object. For a trivial example, consider binary numbers. Here the \"programs\" are strings of 0s and 1s, <em>regarded as mere symbols</em>. And the \"model\" would be natural numbers, along with a function which maps each string of symbols to the corresponding natural number.</p>\n\n<p>Sometimes these denotations of programs are expressed in terms of <a href=\"https://en.wikipedia.org/wiki/Simply_typed_lambda_calculus#Categorical_semantics\" rel=\"nofollow noreferrer\">category theory</a>. This is the context of Moggi's papers: he is making use of machinery from category theory\u2014like monads\u2014to map programming language concepts like exceptions, continuations, input/output... into a mathematical model. Monads become a convenient way of structuring the mathematical universe of program meanings.</p>\n"}], "owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 516, "favorite_count": 1, "accepted_answer_id": 56031603, "answer_count": 3, "score": 16, "last_activity_date": 1557311725, "creation_date": 1557243337, "last_edit_date": 1557254917, "question_id": 56026072, "link": "https://stackoverflow.com/questions/56026072/what-does-a-monad-is-a-model-of-computation-mean", "title": "What does &quot;a monad is a model of computation&quot; mean", "body": "<p>What does it mean exactly when people say \"a monad is a model of computation\"? Does this mean computation in the sense of turing completeness? If so, how?</p>\n\n<p><strong>Clarification</strong>: This question is not about explaining monads but what people mean with \"model of computation\" in this context and how this relates to monads. See towards the end of <a href=\"https://stackoverflow.com/a/3273549/402428\">this answer</a> for a typical use of this phrase. </p>\n\n<p>In my understanding a turing machine, the theory of recursive functions, lambda calculus etc. are all models of computation and I cannot see how a monad would relate to that if at all. </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557225086, "post_id": 56020299, "comment_id": 98685001, "body": "you could use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:break\" rel=\"nofollow noreferrer\">break</a> - although as always, you&#39;ll need to be careful about what might happen if no elements of the list satisfy your condition"}, {"owner": {"reputation": 115, "user_id": 11463887, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NpQLc.png?s=128&g=1", "display_name": "meatandmahjong", "link": "https://stackoverflow.com/users/11463887/meatandmahjong"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557225973, "post_id": 56020299, "comment_id": 98685461, "body": "Ah, I didn&#39;t think about that. Just saw that that also could end up as an issue in my C/C++ code. Break looks interesting, but I would still have to get &quot;last&quot; from the first list and &quot;head&quot; from the second."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557226353, "post_id": 56020299, "comment_id": 98685668, "body": "yes, which is why as I said you need to be careful of the edge cases. But that&#39;s no different from using <code>dropWhile</code> and/or <code>takeWhile</code>. (And it&#39;s an inherent problem with getting a value from a list - the list could be empty for example. Presumably you have some way of handling this in your C/C++ code, and you need a way to handle in in Haskell too, likely by using <code>Maybe</code>.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1557226858, "post_id": 56020299, "comment_id": 98685949, "body": "You could probably use something similar to <a href=\"https://hackage.haskell.org/package/extra/docs/Data-List-Extra.html#v:breakOn\" rel=\"nofollow noreferrer\"><code>breakOn</code> from <i>extra</i></a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1557237817, "post_id": 56020299, "comment_id": 98692475, "body": "What should happen if the first element matches your predicate? (I note that your C code would simply be a memory safety violation in this case.)"}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 11463887, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NpQLc.png?s=128&g=1", "display_name": "meatandmahjong", "link": "https://stackoverflow.com/users/11463887/meatandmahjong"}, "edited": false, "score": 0, "creation_date": 1557230392, "post_id": 56021267, "comment_id": 98687944, "body": "Just seeing <code>zip</code> made me gloss over your solution due to my assumption that having to go through elements and zipping them together would be slow, but that&#39;s probably wrong due to laziness?"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "reply_to_user": {"reputation": 115, "user_id": 11463887, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NpQLc.png?s=128&g=1", "display_name": "meatandmahjong", "link": "https://stackoverflow.com/users/11463887/meatandmahjong"}, "edited": false, "score": 1, "creation_date": 1557234613, "post_id": 56021267, "comment_id": 98690435, "body": "I&#39;m not sure how clever the optimizer can be here.  I would guess it won&#39;t avoid allocating the pairs but I could be wrong.  Laziness at least means it won&#39;t do this past the point where it finds an element.  A solution with break allocates a similar amount.  Possibly for the best performance you need to write a manual recursion, but I don&#39;t know without benchmarking."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1557239406, "post_id": 56021267, "comment_id": 98693479, "body": "<code>zip</code> only produces the pairs it needs to: <code>zip (a:as) (b:bs) = (a,b) : zip as bs</code>."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 8, "last_activity_date": 1557227341, "creation_date": 1557227341, "answer_id": 56021267, "question_id": 56020299, "link": "https://stackoverflow.com/questions/56020299/is-there-a-straight-forward-solution-to-receiving-the-element-prior-to-hitting/56021267#56021267", "title": "Is there a straight-forward solution to receiving the element *prior* to hitting the dropWhile predicate?", "body": "<p>I would zip the list with its tail so that you have pairs of elements\navailable.  Then you can just use <code>find</code> on the list of pairs:</p>\n\n<pre><code>f :: [Int] -&gt; Maybe (Int, Int)\nf xs = find ((&gt;3) . snd) (zip xs (tail xs))\n\n&gt; f [1..10]\nJust (3,4)\n</code></pre>\n\n<p>If the <em>first</em> element matches the predicate this will return\n<code>Nothing</code> (or the second match if there is one) so you might need to special-case that if you want something\ndifferent.</p>\n\n<p>As Robin Zigmond says <code>break</code> can also work:</p>\n\n<pre><code>g :: [Int] -&gt; (Int, Int)\ng xs = case break (&gt;3) xs of (_, []) -&gt; error \"not found\"\n                             ([], _) -&gt; error \"first element\"\n                             (ys, z:_) -&gt; (last ys, z)\n</code></pre>\n\n<p>(Or have this return a <code>Maybe</code> as well, depending on what you need.)</p>\n\n<p>But this will, I think, keep the whole prefix <code>ys</code> in memory until it\nfinds the match, whereas <code>f</code> can start garbage-collecting the elements\nit has moved past.  For small lists it doesn't matter.</p>\n"}, {"comments": [{"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1557239707, "post_id": 56021347, "comment_id": 98693695, "body": "What should happen if the first element satisfies the predicate? (Depending on the answer this might complicate a fold solution further.)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1557265285, "post_id": 56021347, "comment_id": 98705175, "body": "@MichaWiedenmann In this case it would just return <code>Nothing</code>. That would be a problem in this case though."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 2, "last_activity_date": 1557227665, "creation_date": 1557227665, "answer_id": 56021347, "question_id": 56020299, "link": "https://stackoverflow.com/questions/56020299/is-there-a-straight-forward-solution-to-receiving-the-element-prior-to-hitting/56021347#56021347", "title": "Is there a straight-forward solution to receiving the element *prior* to hitting the dropWhile predicate?", "body": "<p>There's several alternatives; either way, you'll have to implement this yourself. You could use explicit recursion:</p>\n\n<pre><code>getLastAndFirst :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe (a, a)\ngetLastAndFirst p (x : xs@(y:ys))\n    | p y = Just (x, y)\n    | otherwise = getLastAndFirst p xs\ngetLastAndFirst _ [] = Nothing\n</code></pre>\n\n<p>Alternately, you <em>could</em> use a fold, but that would look fairly similar to the above, except less readable.</p>\n\n<p>A third option is to use <code>break</code>, as suggested in the comments:</p>\n\n<pre><code>getLastAndFirst' :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe (a,a)\ngetLastAndFirst' p l =\n    case break p l of\n        (xs@(_:_), (y:_)) -&gt; Just (last xs, y)\n        _ -&gt; Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 4, "last_activity_date": 1557228723, "last_edit_date": 1557228723, "creation_date": 1557228246, "answer_id": 56021526, "question_id": 56020299, "link": "https://stackoverflow.com/questions/56020299/is-there-a-straight-forward-solution-to-receiving-the-element-prior-to-hitting/56021526#56021526", "title": "Is there a straight-forward solution to receiving the element *prior* to hitting the dropWhile predicate?", "body": "<p>I would use a zipper-like search:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type ZipperList a = ([a], [a])\n\ntoZipperList :: [a] -&gt; ZipperList a\ntoZipperList = (,) []\n\nmoveUntil' :: (a -&gt; Bool) -&gt; ZipperList a -&gt; ZipperList a\nmoveUntil' _ (xs, []) = (xs, [])\nmoveUntil' f (xs, (y:ys))\n    | f y       = (xs, (y:ys))\n    | otherwise = moveUntil' f (y:xs, ys)\n\nmoveUntil :: (a -&gt; Bool) -&gt; [a] -&gt; ZipperList a\nmoveUntil f = moveUntil' f . toZipperList\n\nexample :: [Int]\nexample = [2,3,5,7,11,13,17,19]\n\nresult :: ZipperList Int\nresult = moveUntil (&gt;10) example -- ([7,5,3,2], [11,13,17,19])\n</code></pre>\n\n<p>The good thing about zippers is that they are efficient, you can access as many elements near the index you want, and you can move the focus of the zipper forwards and backwards. Learn more about zippers here:</p>\n\n<p><a href=\"http://learnyouahaskell.com/zippers\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/zippers</a></p>\n\n<p>Note that my <code>moveUntil</code> function is like <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:break\" rel=\"nofollow noreferrer\"><code>break</code></a> from the Prelude but the initial part of the list is reversed. Hence you can simply get the <code>head</code> of both lists.</p>\n"}, {"comments": [{"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 1, "creation_date": 1557239621, "post_id": 56021770, "comment_id": 98693632, "body": "I find it odd that your result is a two element list. Wouldn&#39;t a tuple (i.e. <code>(last xs, head ys)</code>) fit better?"}, {"owner": {"reputation": 115, "user_id": 11463887, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NpQLc.png?s=128&g=1", "display_name": "meatandmahjong", "link": "https://stackoverflow.com/users/11463887/meatandmahjong"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1557247718, "post_id": 56021770, "comment_id": 98697958, "body": "I wanted it as a list so I could extend it like shown in my updated answer, where I can supply the function with how many elements I want from before and after the predicate I want, all in a single list."}], "tags": [], "owner": {"reputation": 115, "user_id": 11463887, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NpQLc.png?s=128&g=1", "display_name": "meatandmahjong", "link": "https://stackoverflow.com/users/11463887/meatandmahjong"}, "is_accepted": false, "score": 1, "last_activity_date": 1557280828, "last_edit_date": 1557280828, "creation_date": 1557229136, "answer_id": 56021770, "question_id": 56020299, "link": "https://stackoverflow.com/questions/56020299/is-there-a-straight-forward-solution-to-receiving-the-element-prior-to-hitting/56021770#56021770", "title": "Is there a straight-forward solution to receiving the element *prior* to hitting the dropWhile predicate?", "body": "<pre><code>(\\(xs, ys) -&gt; [last xs, head ys]) $ break (==0) list\n</code></pre>\n\n<p>Using <code>break</code> as Robin Zigmond suggested ended up short and simple, not using <code>Maybe</code> to catch edge-cases, but I could replace the lambda with a simple function that used <code>Maybe</code>.</p>\n\n<hr>\n\n<p>I toyed a bit more with the solution and came up with </p>\n\n<pre><code>breakAround :: Int -&gt; Int -&gt; (a -&gt; Bool) -&gt; [a] -&gt; [a]\nbreakAround m n cond list = (\\(xs, ys) -&gt; (reverse (reverse take m (reverse xs))) ++ take n ys) $ break (cond) list\n</code></pre>\n\n<p>which takes two integers, a predicate, and a list of <code>a</code>, and returns a single list of <code>m</code> elements before the predicate and <code>n</code> elements after.</p>\n\n<p>Example: <code>breakAround 3 2 (==0) [3,2,1,0,10,20,30]</code> would return <code>[3,2,1,0,10]</code></p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557292865, "post_id": 56032831, "comment_id": 98710718, "body": "Surely you didn&#39;t mean <code>Nothing &lt;|&gt; bnd</code>. That&#39;s just <code>bnd</code>! Perhaps you intended <code>findBoundary x (y : _) bnd = ((x,y) &lt;$ guard (p y)) &lt;|&gt; bnd</code> or similar?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557309032, "post_id": 56032831, "comment_id": 98718117, "body": "@dfeuer Oops! That was a thinko: it is indeed just <code>bnd</code>, though I rather like your spelling using <code>guard</code> -- or perhaps <a href=\"https://stackoverflow.com/a/49282010/2751851\"><code>ensure</code></a>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557318640, "post_id": 56032831, "comment_id": 98723557, "body": "<code>ensure</code> doesn&#39;t look quite strong enough for the job. You&#39;d need to <code>fmap</code> to complete the pair, and that&#39;s just getting silly."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1557309056, "last_edit_date": 1557309056, "creation_date": 1557283441, "answer_id": 56032831, "question_id": 56020299, "link": "https://stackoverflow.com/questions/56020299/is-there-a-straight-forward-solution-to-receiving-the-element-prior-to-hitting/56032831#56032831", "title": "Is there a straight-forward solution to receiving the element *prior* to hitting the dropWhile predicate?", "body": "<p>A non-awkward way of implementing this as a fold is making it a paramorphism. For general explanatory notes, see <a href=\"https://stackoverflow.com/a/55926036/2751851\">this answer by dfeuer</a> (I took <code>foldrWithTails</code> from it):</p>\n\n<pre><code>-- The extra [a] argument f takes with respect to foldr\n-- is the tail of the list at each step of the fold.  \nfoldrWithTails :: (a -&gt; [a] -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldrWithTails f n = go\n    where\n    go (a : as) = f a as (go as)\n    go [] = n\n\nboundary :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe (a, a)\nboundary p = foldrWithTails findBoundary Nothing\n    where\n    findBoundary x (y : _) bnd\n        | p y = Just (x, y)\n        | otherwise = bnd\n    findBoundary _ [] _ = Nothing\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li><p>If <code>p y</code> is true we don't have to look at <code>bnd</code> to get the result. That makes the solution adequately lazy. You can check that by trying out <code>boundary (&gt; 1000000) [0..]</code> in GHCi.</p></li>\n<li><p>This solution gives no special treatment to the edge case of the first element of the list matching the condition. For instance:</p>\n\n<pre><code>GHCi&gt; boundary (&lt;1) [0..9]\nNothing\nGHCi&gt; boundary even [0..9]\nJust (1,2)\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 115, "user_id": 11463887, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NpQLc.png?s=128&g=1", "display_name": "meatandmahjong", "link": "https://stackoverflow.com/users/11463887/meatandmahjong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 56021267, "answer_count": 5, "score": 6, "last_activity_date": 1557309056, "creation_date": 1557223911, "last_edit_date": 1557279630, "question_id": 56020299, "link": "https://stackoverflow.com/questions/56020299/is-there-a-straight-forward-solution-to-receiving-the-element-prior-to-hitting", "title": "Is there a straight-forward solution to receiving the element *prior* to hitting the dropWhile predicate?", "body": "<p>Given a condition, I want to search through a list of elements and return the first element that reaches the condition, and the previous one.</p>\n\n<p>In C/C++ this is easy :</p>\n\n<pre><code>int i = 0;\nfor(;;i++) if (arr[i] == 0) break;\n</code></pre>\n\n<p>After we get the index where the condition is met, getting the previous element is easy, through \"<code>arr[i-1]</code>\"</p>\n\n<p>In Haskell:</p>\n\n<ul>\n<li><p><code>dropWhile (/=0) list</code>  gives us the last element I want</p></li>\n<li><p><code>takeWhile (/=0) list</code>  gives us the first element I want</p></li>\n</ul>\n\n<p>But I don't see a way of getting both in a simple manner. I could enumerate the list and use indexing, but that seems messy. Is there a proper way of doing this, or a way of working around this?</p>\n"}, {"tags": ["scala", "haskell", "tuples", "category-theory", "either"], "comments": [{"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "edited": false, "score": 0, "creation_date": 1557231629, "post_id": 56020174, "comment_id": 98688674, "body": "here is some explanation about this topic <a href=\"https://www.youtube.com/watch?v=V10hzjgoklA\" rel=\"nofollow noreferrer\">youtube.com/watch?v=V10hzjgoklA</a> . Starting at 15 min"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557270260, "post_id": 56020174, "comment_id": 98706393, "body": "I took the liberty of replacing the word &quot;draw&quot; (by which I imagine you meant &quot;drawing&quot;) with the term &quot;diagram&quot;, which is what these pictures are called in category theory."}], "answers": [{"tags": [], "owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "is_accepted": false, "score": 5, "last_activity_date": 1557234123, "last_edit_date": 1557234123, "creation_date": 1557224326, "answer_id": 56020413, "question_id": 56020174, "link": "https://stackoverflow.com/questions/56020174/understanding-the-diagrams-of-product-and-coproduct/56020413#56020413", "title": "Understanding the diagrams of Product and Coproduct", "body": "<p>A product (<code>Tuple</code> in Haskell) is an object with two <em>projections</em>. Those are functions <em>projecting</em> the product to their individual factors <code>fst</code> and <code>snd</code>.</p>\n\n<p>Conversly a coproduct (<code>Either</code> in Haskell) is an object that has two <em>injections</em>. Those are functions <em>injecting</em> the individual summands <code>lefts</code> and <code>rights</code> into the sum.</p>\n\n<p>Note, both product and coproduct need to satisfy an universal property. I recommend Bartosz Milewski's <a href=\"https://bartoszmilewski.com/2015/01/07/products-and-coproducts/\" rel=\"nofollow noreferrer\">introduction</a> on the topic along with his <a href=\"https://youtu.be/Bsdl_NKbNnU\" rel=\"nofollow noreferrer\">lecture</a>. </p>\n"}, {"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 5, "last_activity_date": 1557227803, "last_edit_date": 1557227803, "creation_date": 1557224659, "answer_id": 56020505, "question_id": 56020174, "link": "https://stackoverflow.com/questions/56020174/understanding-the-diagrams-of-product-and-coproduct/56020505#56020505", "title": "Understanding the diagrams of Product and Coproduct", "body": "<p>So as far as I can tell, the idea behind these diagrams is that you are given:</p>\n\n<ul>\n<li>types <code>A</code>, <code>B</code> and <code>Z</code></li>\n<li>function <code>f</code> and <code>g</code> of the indicated types (in the first diagram, <code>f :: Z -&gt; A</code> and <code>g :: Z -&gt; B</code>, in the second the arrows go \"the other way\", so <code>f :: A -&gt; Z</code> and <code>g :: B -&gt; Z</code>).</li>\n</ul>\n\n<p>I'll concentrate on the first diagram for now, so that I don't have to say everything twice with slight variations.</p>\n\n<p>Anyway, given the above, the idea is that there is a type <code>M</code> together with functions <code>fst :: M -&gt; A</code>, <code>snd :: M -&gt; B</code>, and <code>h :: Z -&gt; M</code> such that, as the mathematicians say, the diagram \"commutes\". By that is simply meant that, given any two points in the diagram, if you follow the arrows in any way from one to the other, the resulting functions are the same. That is, <code>f</code> is the same as  <code>fst . h</code> and <code>g</code> is the same as <code>snd . h</code></p>\n\n<p>It is easy to see that, no matter what <code>Z</code> is, the pair type <code>(A, B)</code>, together with the usual Haskell functions <code>fst</code> and <code>snd</code>, satisfies this - together with an appropriate choice of <code>h</code>, which is:</p>\n\n<pre><code>h z = (f z, g z)\n</code></pre>\n\n<p>which trivially satisfies the two required identities for the diagram to commute.</p>\n\n<p>That's a basic explanation of the diagram. But you may be slightly confused about the role of <code>Z</code> in all this. That arises because what's actually being stated is rather stronger. It is that, given <code>A</code>, <code>B</code>, <code>f</code> and <code>g</code>, there is an <code>M</code> together with functions <code>fst</code> and <code>snd</code>, that you can construct such a diagram for <em>any</em> type <code>Z</code> (which means supplying a function <code>h :: Z -&gt; M</code> as well). And further that there is <em>only one</em> function <code>h</code> which satisfies the required properties.</p>\n\n<p>It's pretty clear, once you play with it and understand the various requirements, that the pair <code>(A, B)</code>, and various other types isomorphic to it (which basically means <code>MyPair A B</code> where you've defined <code>data MyPair a b = MyPair a b</code>), are the only things which satisfy this. And that there are other types <code>M</code> which would also work, but which would give various different <code>h</code>s - eg. take <code>M</code> to be a triple <code>(A, B, Int)</code>, with <code>fst</code> and <code>snd</code> extracting (\"projecting to\" in mathematical terminology) the first and second components, and then <code>h z = (f z, g z, x)</code> is such a function for any <code>x :: Int</code> that you care to name.</p>\n\n<p>It's been too long since I studied mathematics, and category theory in particular, to be able to prove that the pair <code>(A, B)</code> is the only type that satisfies the \"universal property\" we're talking about - but rest assured that it is, and you really don't need to understand that (or really any of this) in order to be able to program with product and sum types in Haskell.</p>\n\n<p>The second diagram is more or less the same, but with all the arrows reversed. In this case the \"coproduct\" or \"sum\" <code>M</code> of <code>A</code> and <code>B</code> turns out to be <code>Either a b</code> (or something isomoprhic to it), and <code>h :: M -&gt; Z</code> will be defined as:</p>\n\n<pre><code>h (Left a) = f a\nh (Right b) = g b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1557285752, "last_edit_date": 1557285752, "creation_date": 1557248965, "answer_id": 56027478, "question_id": 56020174, "link": "https://stackoverflow.com/questions/56020174/understanding-the-diagrams-of-product-and-coproduct/56027478#56027478", "title": "Understanding the diagrams of Product and Coproduct", "body": "<p>One thing not communicated by these diagrams is which pieces are inputs and which are outputs. I'm going to start with products and be extra careful about which things are handed to you, and which you must cook up.</p>\n\n<p>So a product says:</p>\n\n<ol>\n<li>You give me two objects, A and B.</li>\n<li>I give you a new object M, and two arrows fst : M -> A and snd : M -> B.</li>\n<li>You give me an object Z and two arrows f : Z -> A and g : Z -> B.</li>\n<li>I give you an arrow h : Z -> M that makes the diagram commute (...and this arrow is uniquely determined by the choices made so far).</li>\n</ol>\n\n<p>We often pretend that there is a category Hask in which the objects are concrete (monomorphic) types, and the arrows are Haskell functions of the appropriate type. Let's see how the protocol above plays out, and demonstrate that Haskell's <code>data Pair a b = P a b</code> is a product in Hask.</p>\n\n<ol>\n<li>You give me two objects (types), A=<code>a</code> and B=<code>b</code>.</li>\n<li><p>I must produce an object (type) and two arrows (functions). I pick M=<code>Pair a b</code>. Then I must write functions of type <code>Pair a b -&gt; a</code> (for the arrow fst : M -> A) and <code>Pair a b -&gt; b</code> (for the arrow snd : M -> B). I choose:</p>\n\n<pre><code>fst :: Pair a b -&gt; a\nfst (P a b) = a\n\nsnd :: Pair a b -&gt; b\nsnd (P a b) = b\n</code></pre></li>\n<li>You give me an object (type) Z=<code>z</code> and two arrows (functions); <code>f</code> will have type <code>z -&gt; a</code> and <code>g</code> will have type <code>z -&gt; b</code>.</li>\n<li><p>I must produce a function <code>h</code> of type <code>z -&gt; Pair a b</code>. I choose:</p>\n\n<pre><code>h = \\z -&gt; P (f z) (g z)\n</code></pre>\n\n<p>This <code>h</code> is required to make the diagram commute. This means that any two paths through the diagram that begin and end at the same object should be equal. For the diagrams given, that means we must show that it satisfies two equations:</p>\n\n<pre><code>f = fst . h\ng = snd . h\n</code></pre>\n\n<p>I'll prove the first; the second is similar.</p>\n\n<pre><code>fst . h\n= { definition of h }\nfst . (\\z -&gt; P (f z) (g z))\n= { definition of (.) }\n\\v -&gt; fst ((\\z -&gt; P (f z) (g z)) v)\n= { beta reduction }\n\\v -&gt; fst (P (f v) (g v))\n= { definition of fst }\n\\v -&gt; f v\n= { eta reduction }\nf\n</code></pre>\n\n<p>As required.</p></li>\n</ol>\n\n<p>The story for coproducts is similar, with the slight tweaks to the protocol described below:</p>\n\n<ol>\n<li>You give me two objects, A and B.</li>\n<li>I give you a new object W, and two arrows left : A -> W and right : B -> W.</li>\n<li>You give me an object Z and arrows f : A -> Z and g : A -> Z.</li>\n<li>I give you an arrow h : W -> Z that makes the diagrams commute (...and this arrow is uniquely determined by the choices made so far).</li>\n</ol>\n\n<p>It should be straightforward to adapt the discussion above about products and <code>Pair</code> to see how this would apply to coproducts and <code>data Copair a b = L a | R b</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1557285752, "creation_date": 1557223533, "last_edit_date": 1557270169, "question_id": 56020174, "link": "https://stackoverflow.com/questions/56020174/understanding-the-diagrams-of-product-and-coproduct", "title": "Understanding the diagrams of Product and Coproduct", "body": "<p>I am trying to understand the <code>Product</code> and <code>Coproduct</code> corresponding to the following picture: </p>\n\n<p>Product:\n<a href=\"https://i.stack.imgur.com/Rs8mo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Rs8mo.png\" alt=\"enter image description here\"></a></p>\n\n<p>Coproduct: </p>\n\n<p><a href=\"https://i.stack.imgur.com/oJYIA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oJYIA.png\" alt=\"enter image description here\"></a></p>\n\n<p>As I understand, a <code>Product</code> type in Haskell is for example: </p>\n\n<pre><code>data Pair = P Int Double\n</code></pre>\n\n<p>and a <code>Sum</code>type is: </p>\n\n<pre><code>data Pair = I Int | D Double \n</code></pre>\n\n<p>How to understand the images in relation with <code>Sum</code> and <code>Product</code> type?</p>\n\n<p>The images are from <a href=\"http://blog.higher-order.com/blog/2014/03/19/monoid-morphisms-products-coproducts/\" rel=\"nofollow noreferrer\">http://blog.higher-order.com/blog/2014/03/19/monoid-morphisms-products-coproducts/</a>.</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 6, "last_activity_date": 1557215444, "creation_date": 1557215444, "answer_id": 56017905, "question_id": 56017472, "link": "https://stackoverflow.com/questions/56017472/is-there-a-way-to-use-more-than-one-monad-in-one-function/56017905#56017905", "title": "Is there a way to use more than one monad in one function?", "body": "<p>You are looking for a \"monad transformer\". Just as values of type <code>IO a</code> and <code>Maybe a</code> are monads, so too can be a value of type <code>IO (Maybe a)</code>. This combination uses <a href=\"http://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Maybe.html\" rel=\"noreferrer\"><code>MaybeT</code></a>.</p>\n\n<p>However, this is a bit of an advanced topic, and will have you scratching your head if you are new to the concepts. If you just want to do printf-style debugging, consider <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Debug-Trace.html\" rel=\"noreferrer\"><code>Debug.Trace</code></a> instead. It lets you cheat the type system to get text output when debugging, but should never be used in a finished program.</p>\n"}, {"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1557216479, "creation_date": 1557216479, "answer_id": 56018149, "question_id": 56017472, "link": "https://stackoverflow.com/questions/56017472/is-there-a-way-to-use-more-than-one-monad-in-one-function/56018149#56018149", "title": "Is there a way to use more than one monad in one function?", "body": "<p>If you just need <code>add2Maybe</code> implementation here it is</p>\n\n<pre><code>add2Maybe :: (Show a, Num a) =&gt; Maybe a -&gt; Maybe a -&gt; IO (Maybe a)\nadd2Maybe x y = do\n                 mapM print x\n                 mapM print y\n                 return $ do \n                  n1 &lt;- x\n                  n2 &lt;- y\n                  return $ n1 + n2\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 9600787, "user_type": "registered", "profile_image": "https://graph.facebook.com/1940374526035557/picture?type=large", "display_name": "SAN", "link": "https://stackoverflow.com/users/9600787/san"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1557247954, "answer_count": 2, "score": 2, "last_activity_date": 1557216479, "creation_date": 1557213675, "question_id": 56017472, "link": "https://stackoverflow.com/questions/56017472/is-there-a-way-to-use-more-than-one-monad-in-one-function", "closed_reason": "Duplicate", "title": "Is there a way to use more than one monad in one function?", "body": "<p>I have a function</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>add2Maybe :: (Num a) =&gt; Maybe a -&gt; Maybe a -&gt; Maybe a\nadd2Maybe x y = do\n    n1 &lt;- x\n    n2 &lt;- y\n    return $ n1 + n2\n</code></pre>\n\n<p>It will successfully return <code>Just 8</code> when called with <code>Just 3</code> and <code>Just 5</code>. What I want is when this fuction is called, similar to printf debugging in C, printing</p>\n\n<pre><code>The number in x is 3. --(Or Nothing).\nThe number in y is 5.\nFinal result is 8.\n</code></pre>\n\n<p>and return <code>Just 8</code>.</p>\n\n<p>I concluded that to define a function like this, I have to use Maybe monad with IO monad, but the type signiture of <code>&gt;&gt;=</code> doesn't allow to use more than two monad in a single function. Is there a way to combine Maybe monad and IO monad, and more generally, is there a way to combine two or more monad types?</p>\n"}, {"tags": ["haskell", "types", "polymorphism"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 11, "creation_date": 1557208881, "post_id": 56016314, "comment_id": 98676602, "body": "&quot;The compiler is probably buggy&quot;. First words of absolutely everybody trying to compile their first Haskell program. The real reason is never a compiler bug."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1557214011, "post_id": 56016314, "comment_id": 98678910, "body": "You can also write <code>defaultEither = first . const</code> with <code>first</code> coming from <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\"><code>Data.Bifunctor</code></a>. I might, however, call it something like <code>setLeft</code>, since there&#39;s nothing particularly defaulty about <code>Left</code>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1557231215, "post_id": 56016314, "comment_id": 98688428, "body": "@n.m. It&#39;s never a compiler bug for beginner programs anyway. It definitely sometimes is when you&#39;re trying to do more esoteric things."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557234712, "post_id": 56016314, "comment_id": 98690502, "body": "Although compilers <i>have</i> bugs, my experience is that once you start blaming the compiler, it (close to) certainty is not. In short, a <code>Right x</code> of type <code>Either Int Int</code>, is not a <code>Right x</code> of <code>Either String Int</code>."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1557210270, "creation_date": 1557210270, "answer_id": 56016654, "question_id": 56016314, "link": "https://stackoverflow.com/questions/56016314/why-doesnt-this-type-check-in-haskell/56016654#56016654", "title": "Why doesn&#39;t this type-check in Haskell?", "body": "<blockquote>\n  <p>an Either a c type can only be...</p>\n</blockquote>\n\n<p>Indeed, but in your first example, the value <code>b</code> does not have type <code>Either a c</code>! As your type signature proves, it has type <code>Either b c</code>. And of course, you cannot return an <code>Either b c</code> where an <code>Either a c</code> is expected. Instead, you must destructure the value and reconstruct it with the right type.</p>\n"}, {"comments": [{"owner": {"reputation": 1783, "user_id": 2509549, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/px0ti.png?s=128&g=1", "display_name": "ThePiercingPrince", "link": "https://stackoverflow.com/users/2509549/thepiercingprince"}, "edited": false, "score": 0, "creation_date": 1557221123, "post_id": 56016705, "comment_id": 98682740, "body": "I don&#39;t say that the output has the same type as the second input. I only say that the output is the same as the second input. And just because they are different types doesn&#39;t mean they don&#39;t intersect! The intersection of <code>Either a c</code> and <code>Either b c</code> is precisely the values of the form <code>Right (y::c)</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 1783, "user_id": 2509549, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/px0ti.png?s=128&g=1", "display_name": "ThePiercingPrince", "link": "https://stackoverflow.com/users/2509549/thepiercingprince"}, "edited": false, "score": 0, "creation_date": 1557221704, "post_id": 56016705, "comment_id": 98683059, "body": "But there is no such thing as an &quot;intersection&quot; of types. The value <code>Right (y::c)</code> has type <code>Either a c</code>, which you could also call <code>Either b c</code>, since the name of a type variable is arbitrary. But when you&#39;ve used both <code>Either a c</code> and <code>Either b c</code> in a type signature, the compiler has to assume they&#39;re different types. It seems that you want GHC&#39;s type inference to be able to look at the implementation of <code>Either</code> and see that in your definition the <code>b</code> must be a value that could <i>also</i> be of type <code>Either b c</code>. And I don&#39;t think it&#39;s reasonable to expect it to be able to do that."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 1783, "user_id": 2509549, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/px0ti.png?s=128&g=1", "display_name": "ThePiercingPrince", "link": "https://stackoverflow.com/users/2509549/thepiercingprince"}, "edited": false, "score": 7, "creation_date": 1557231435, "post_id": 56016705, "comment_id": 98688559, "body": "@ThePiercingPrince &quot;And just because they are different types doesn&#39;t mean they don&#39;t intersect!&quot;  It does mean exactly that in Haskell. Haskell&#39;s type system is nominal (as is nearly every other static type system used in programming languages) - i.e. if two types have different names they (and their values!) are fully distinct. Of course it&#39;s possible to extract the right value and inject it as another right value of a different type, but that&#39;s not going to happen automatically."}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 9, "last_activity_date": 1557212891, "last_edit_date": 1557212891, "creation_date": 1557210477, "answer_id": 56016705, "question_id": 56016314, "link": "https://stackoverflow.com/questions/56016314/why-doesnt-this-type-check-in-haskell/56016705#56016705", "title": "Why doesn&#39;t this type-check in Haskell?", "body": "<p>The problem is that when you say</p>\n\n<pre><code>defaultEither _ b = b\n</code></pre>\n\n<p>you're saying that the output value <code>b</code> is the same as the second input value. And that's only possible if the values have the same type. But you've told the compiler that the input has type <code>Either b c</code>, while the output has type <code>Either a c</code>. These are different types, so no wonder the compiler complains.</p>\n\n<p>I understand what you are trying to do - but even though a value <code>Right x</code> (with <code>x</code> of type <code>c</code>) on its own can be of type <code>Either d c</code> for any <code>d</code>, your type signature constrains the input and output values to versions with different <code>d</code>s. And that means you can't use the same variable to refer to both values.</p>\n"}, {"tags": [], "owner": {"reputation": 716, "user_id": 3507206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/848870b4043d5ca319aa3111cb55845b?s=128&d=identicon&r=PG", "display_name": "tejasbubane", "link": "https://stackoverflow.com/users/3507206/tejasbubane"}, "is_accepted": false, "score": 0, "last_activity_date": 1557210936, "creation_date": 1557210936, "answer_id": 56016818, "question_id": 56016314, "link": "https://stackoverflow.com/questions/56016314/why-doesnt-this-type-check-in-haskell/56016818#56016818", "title": "Why doesn&#39;t this type-check in Haskell?", "body": "<blockquote>\n  <p>an Either a c type can be only Left (x::a) or Right (y::c), if it isn't Left then it is Right, and we know that Right :: b -> Either a b so Right (y::c) :: Either a c.</p>\n</blockquote>\n\n<p>I think you are confusing <code>type</code> constructors with <code>data</code> constructors. <code>Either</code> is defined like this in <code>ghc-base</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data  Either a b  =  Left a | Right b\n</code></pre>\n\n<p><code>Either</code> is a <code>type</code> constructor with two abstract variables. i.e. it takes any two types (<code>Int</code>, <code>String</code>, etc). and constructs a concrete type like <code>Either Int String</code>.</p>\n\n<p><code>Left</code> and <code>Right</code> on the other hand are <code>data</code> constructors. They take actual values like <code>1</code>, <code>\"hi\"</code> and construct values like <code>Left 1</code> and <code>Right \"hi\"</code>.</p>\n\n<pre><code>Prelude&gt; :t Left\nLeft :: a -&gt; Either a b\nPrelude&gt; :t Right\nRight :: b -&gt; Either a b\n</code></pre>\n\n<p>Haskell type inference <strong>does not</strong> work with <code>values</code> (<code>Left</code> and <code>Right</code>). It only works on <code>types</code> (<code>Either</code>). So the type checker only knows about <code>Either b c</code> and <code>Either a c</code> - so in the first case the variables don't match.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 5, "last_activity_date": 1557232674, "creation_date": 1557232674, "answer_id": 56022814, "question_id": 56016314, "link": "https://stackoverflow.com/questions/56016314/why-doesnt-this-type-check-in-haskell/56022814#56022814", "title": "Why doesn&#39;t this type-check in Haskell?", "body": "<p>Let's try an even simpler example:</p>\n\n<pre><code>data Foo x = Bar\n\nfoobar :: Foo a -&gt; Foo b\nfoobar f = f\n</code></pre>\n\n<p>Take a look at the definition of <code>Foo</code>. There's a type variable on the left-hand side (<code>x</code>), which never actually appears anywhere on the right-hand side. This is an example of a so-called \"phantom type variable\". There's a type in the type signature which doesn't actually correspond to the type of anything in the actual value. (And this is perfectly legal, by the way.)</p>\n\n<p>Now if you have the expression <code>Just True</code>, then since <code>True :: Bool</code>, then <code>Just True :: Maybe True</code>. However, the expression <code>Nothing</code> is definitely a <code>Maybe</code> <em>something</em>. But with no actual value present, there's nothing to force it to be any specific maybe-type. The type variable is phantom in this case.</p>\n\n<p>We have a similar thing here; <code>Bar :: Foo x</code>, for any <code>x</code>. So <em>you would think</em> that our definition of <code>foobar</code> is legal.</p>\n\n<p>And you would be <em>wrong</em>.</p>\n\n<p>You cannot pass a value of <code>Foo a</code> where a value of type <code>Foo b</code> is expected, <em>even if</em> they have exactly the same run-time structure. Because the type checker doesn't <em>care</em> about the run-time structure; it only cares about <em>types</em>. As far as the type checker is concerned, <code>Foo Int</code> is different to <code>Foo Bool</code>, even though at run-time there's no observable difference.</p>\n\n<p>And <em>that</em> is why your code is rejected.</p>\n\n<p>In fact, you have to write</p>\n\n<pre><code>foobar :: Foo a -&gt; Foo b\nfoobar Bar = Bar\n</code></pre>\n\n<p>to let the type checker know that the <code>Bar</code> you're outputting is a new, <em>different</em> <code>Bar</code> than the one you received as input (and hence it can have a different type).</p>\n\n<p>Believe it or not, this is actually a <em>feature</em>, not a bug. You can write code that makes it so that (for example) <code>Foo Int</code> behaves differently than <code>Foo Char</code>. Even though at run-time they're both just <code>Bar</code>.</p>\n\n<p>The solution, as you have discovered, is to just take your value <code>b</code> out of <code>Right</code> and then immediately put it back in again. It seems pointless and silly, but it's to explicitly signal to the type checker that the types have potentially changed. It's perhaps annoying, but it's just one of those corners of the language. It's not a bug, it's purposely designed to work this way.</p>\n"}], "owner": {"reputation": 1783, "user_id": 2509549, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/px0ti.png?s=128&g=1", "display_name": "ThePiercingPrince", "link": "https://stackoverflow.com/users/2509549/thepiercingprince"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 0, "answer_count": 4, "score": 3, "last_activity_date": 1560014756, "creation_date": 1557208558, "last_edit_date": 1560014756, "question_id": 56016314, "link": "https://stackoverflow.com/questions/56016314/why-doesnt-this-type-check-in-haskell", "title": "Why doesn&#39;t this type-check in Haskell?", "body": "<p>This doesn't type check:</p>\n\n<pre><code>module DoesntTypeCheck where {\nimport Prelude(Either(..));\ndefaultEither :: a -&gt; Either b c -&gt; Either a c;\ndefaultEither a (Left _) = Left a;\ndefaultEither _ b = b;\n}\n</code></pre>\n\n<p>But this does:</p>\n\n<pre><code>module DoesTypeCheck where {\nimport Prelude(Either(..));\ndefaultEither :: a -&gt; Either b c -&gt; Either a c;\ndefaultEither a (Left _) = Left a;\ndefaultEither _ (Right b) = Right b;\n}\n</code></pre>\n\n<p>The compiler is probably buggy, an <code>Either a c</code> type can be only <code>Left (x::a)</code> or <code>Right (y::c)</code>, if it isn't <code>Left</code> then it is <code>Right</code>, and we know that <code>Right :: b -&gt; Either a b</code> so <code>Right (y::c) :: Either a c</code>.</p>\n"}, {"tags": ["macos", "haskell", "build", "haskell-stack"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1557183376, "post_id": 56013322, "comment_id": 98671540, "body": "Have you tried blowing away stack cache? Worked for me in the past."}, {"owner": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1557183862, "post_id": 56013322, "comment_id": 98671609, "body": "is that different than <code>stack clean --full</code>?"}, {"owner": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1557183909, "post_id": 56013322, "comment_id": 98671620, "body": "also, I&#39;ve tried erasing the entire project <code>.stack-work</code> directory."}, {"owner": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1557185805, "post_id": 56013322, "comment_id": 98671955, "body": "tried deleting ~/.stack as well, now most stack commands hang at <code>Configuring GHC...</code>"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1557219825, "post_id": 56013322, "comment_id": 98682038, "body": "might also be just reaaaaly slow..."}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "edited": false, "score": 0, "creation_date": 1557254533, "post_id": 56022222, "comment_id": 98700941, "body": "I can&#39;t even get to the point where I&#39;m compiling packages anymore. I deleted and reinstalled stack (using brew--my attempts with wget and curl as per <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/install_and_upgrade</a>) hang immediately after calling <code>stack</code>), but now it gets stuck during the <code>Configuring GHC...</code> stage. Activity monitor shows it at zero cpu, and a thread sample appears to show all threads either waiting or polling. I&#39;ve left it sitting there for several hours, with no change."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "edited": false, "score": 0, "creation_date": 1557307071, "post_id": 56022222, "comment_id": 98717059, "body": "I see you opened up an issue on Github about this problem, it&#39;s probably best to discuss that there. For others: <a href=\"https://github.com/commercialhaskell/stack/issues/4815\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/4815</a>"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 3, "last_activity_date": 1557230640, "creation_date": 1557230640, "answer_id": 56022222, "question_id": 56013322, "link": "https://stackoverflow.com/questions/56013322/why-is-haskell-stack-hanging-while-attempting-to-build-my-project/56022222#56022222", "title": "Why is Haskell Stack hanging while attempting to build my project?", "body": "<p>Usually this is due to a package simply taking a long time to compile, not an actual bug. This comes up most often with the Cabal library. There are two good ways to check if this is what's happening:</p>\n\n<ul>\n<li>Add the <code>--interleaved-output</code> flag, which will show you the progress of compiling individual modules in dependencies. This flag will be on by default in Stack 2, in large part due to this issue.</li>\n<li>Check your activity monitor/<code>top</code>/etc program and confirm that GHC is in fact using significant CPU.</li>\n</ul>\n"}], "owner": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 771, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1557230640, "creation_date": 1557182993, "last_edit_date": 1557184810, "question_id": 56013322, "link": "https://stackoverflow.com/questions/56013322/why-is-haskell-stack-hanging-while-attempting-to-build-my-project", "title": "Why is Haskell Stack hanging while attempting to build my project?", "body": "<p>Running <code>stack build</code> in a project that should build correctly (it works on other developers' machines, and has worked on mine in the past) hangs on the same library (<code>regex-posix-0.95.2</code>) every time.</p>\n\n<p>I'm running macos 10.14.4.</p>\n\n<p>I've already tried <code>stack clean --full</code> and reinstalling stack from scratch. Attempting to <code>stack upgrade</code> hangs at <code>Download complete, testing executable</code>.</p>\n\n<p>Here's the output of <code>stack build --verbose</code>:</p>\n\n<pre><code>stack build --verbose\n1.9.3 x86_64\nCompiled with:\n- Cabal-2.4.0.1\n- Glob-0.9.3\n- HUnit-1.6.0.0\n- QuickCheck-2.11.3\n- StateVar-1.1.1.1\n- aeson-1.3.1.1\n- aeson-compat-0.3.9\n- annotated-wl-pprint-0.7.0\n- ansi-terminal-0.8.2\n- ansi-wl-pprint-0.6.8.2\n- array-0.5.2.0\n- asn1-encoding-0.9.5\n- asn1-parse-0.9.4\n- asn1-types-0.3.2\n- async-2.2.1\n- attoparsec-0.13.2.2\n- attoparsec-iso8601-1.0.1.0\n- auto-update-0.1.4\n- base-4.11.1.0\n- base-compat-0.10.5\n- base-orphans-0.7\n- base-prelude-1.3\n- base16-bytestring-0.1.1.6\n- base64-bytestring-1.0.0.1\n- basement-0.0.8\n- bifunctors-5.5.3\n- binary-0.8.5.1\n- bindings-uname-0.1\n- bitarray-0.0.1.1\n- blaze-builder-0.4.1.0\n- blaze-html-0.9.1.1\n- blaze-markup-0.8.2.2\n- byteable-0.1.1\n- bytestring-0.10.8.2\n- call-stack-0.1.0\n- case-insensitive-1.2.0.11\n- cereal-0.5.7.0\n- clock-0.7.2\n- colour-2.3.4\n- comonad-5.0.4\n- conduit-1.3.1\n- conduit-extra-1.3.0\n- connection-0.2.8\n- containers-0.5.11.0\n- contravariant-1.4.1\n- cookie-0.4.4\n- cryptohash-0.11.9\n- cryptohash-sha256-0.11.101.0\n- cryptonite-0.25\n- cryptonite-conduit-0.2.2\n- data-default-class-0.1.2.0\n- deepseq-1.4.3.0\n- digest-0.0.1.2\n- directory-1.3.1.5\n- distributive-0.5.3\n- dlist-0.8.0.5\n- easy-file-0.2.2\n- echo-0.1.3\n- ed25519-0.0.5.0\n- either-5.0.1\n- exceptions-0.10.0\n- extra-1.6.13\n- fast-logger-2.4.11\n- file-embed-0.0.10.1\n- filelock-0.1.1.2\n- filepath-1.4.2\n- free-5.0.2\n- fsnotify-0.3.0.1\n- generic-deriving-1.12.2\n- ghc-boot-th-8.4.4\n- ghc-prim-0.5.2.0\n- hackage-security-0.5.3.0\n- hashable-1.2.7.0\n- haskell-src-exts-1.20.3\n- haskell-src-meta-0.8.0.3\n- hfsevents-0.1.6\n- hourglass-0.2.12\n- hpack-0.31.1\n- hpc-0.6.0.3\n- hspec-2.5.5\n- hspec-core-2.5.5\n- hspec-discover-2.5.5\n- hspec-expectations-0.8.2\n- hspec-smallcheck-0.5.2\n- http-api-data-0.3.8.1\n- http-client-0.5.14\n- http-client-tls-0.3.5.3\n- http-conduit-2.3.2\n- http-types-0.12.2\n- infer-license-0.2.0\n- integer-gmp-1.0.2.0\n- integer-logarithms-1.0.2.2\n- lifted-base-0.2.3.12\n- logict-0.6.0.2\n- megaparsec-6.5.0\n- memory-0.14.18\n- microlens-0.4.9.1\n- microlens-th-0.4.2.3\n- mime-types-0.1.0.8\n- mintty-0.1.2\n- monad-control-1.0.2.3\n- monad-logger-0.3.30\n- monad-loops-0.4.3\n- mono-traversable-1.0.9.0\n- mtl-2.2.2\n- mustache-2.3.0\n- neat-interpolation-0.3.2.2\n- network-2.6.3.6\n- network-uri-2.6.1.0\n- old-locale-1.0.0.7\n- old-time-1.1.0.3\n- open-browser-0.2.1.0\n- optparse-applicative-0.14.3.0\n- parsec-3.1.13.0\n- parser-combinators-1.0.0\n- path-0.6.1\n- path-io-1.3.3\n- path-pieces-0.2.1\n- pem-0.2.4\n- persistent-2.8.2\n- persistent-sqlite-2.8.2\n- persistent-template-2.5.4\n- pretty-1.1.3.6\n- primitive-0.6.3.0\n- process-1.6.3.0\n- profunctors-5.2.2\n- project-template-0.2.0.1\n- quickcheck-io-0.2.0\n- random-1.1\n- regex-applicative-0.3.3\n- regex-applicative-text-0.1.0.1\n- resource-pool-0.2.3.2\n- resourcet-1.2.2\n- retry-0.7.7.0\n- rio-0.1.5.0\n- rts-1.0\n- safe-0.3.17\n- scientific-0.3.6.2\n- semigroupoids-5.2.2\n- semigroups-0.18.5\n- setenv-0.1.1.3\n- silently-1.2.5\n- smallcheck-1.1.5\n- socks-0.5.6\n- split-0.2.3.3\n- stm-2.4.5.1\n- stm-chans-3.0.0.4\n- store-0.5.0.1\n- store-core-0.4.4\n- streaming-commons-0.2.1.0\n- syb-0.7\n- tagged-0.8.5\n- tar-0.5.1.0\n- template-haskell-2.13.0.0\n- temporary-1.3\n- text-1.2.3.1\n- text-metrics-0.3.0\n- tf-random-0.5\n- th-abstraction-0.2.8.0\n- th-expand-syns-0.4.4.0\n- th-lift-0.7.11\n- th-lift-instances-0.1.11\n- th-orphans-0.13.6\n- th-reify-many-0.1.8\n- th-utilities-0.2.0.1\n- time-1.8.0.2\n- time-locale-compat-0.1.1.5\n- tls-1.4.1\n- transformers-0.5.5.0\n- transformers-base-0.4.5.2\n- transformers-compat-0.6.2\n- typed-process-0.2.3.0\n- unicode-transforms-0.3.5\n- unix-2.7.2.2\n- unix-compat-0.5.1\n- unix-time-0.3.8\n- unliftio-0.2.8.1\n- unliftio-core-0.1.2.0\n- unordered-containers-0.2.9.0\n- uri-bytestring-0.3.2.1\n- uuid-types-1.0.3\n- vector-0.12.0.1\n- vector-algorithms-0.7.0.4\n- void-0.7.2\n- x509-1.7.5\n- x509-store-1.6.7\n- x509-system-1.6.6\n- x509-validation-1.6.11\n- yaml-0.10.4.0\n- zip-archive-0.3.3\n- zlib-0.6.2\n\nWarning: this is an unsupported build that may use different versions of\ndependencies and GHC than the officially released binaries, and therefore may\nnot behave identically.  If you encounter problems, please try the latest\nofficial build by running 'stack upgrade --force-download'.\n\n2019-05-06 15:34:43.787917: [debug] Checking for project config at: /Users/marnold/Code/lambda/authentication-service/stack.yaml\n2019-05-06 15:34:43.788935: [debug] Loading project config file stack.yaml\n2019-05-06 15:34:43.790456: [debug] Decoding build plan from: /Users/marnold/.stack/build-plan/lts-9.21.yaml\n2019-05-06 15:34:43.790519: [debug] Trying to decode /Users/marnold/.stack/build-plan-cache/lts-9.21.cache\n2019-05-06 15:34:43.795490: [debug] Success decoding /Users/marnold/.stack/build-plan-cache/lts-9.21.cache\n2019-05-06 15:34:43.797255: [debug] Potential GHC builds: standard\n2019-05-06 15:34:43.797339: [debug] Found already installed GHC builds: standard\n2019-05-06 15:34:43.798120: [debug] Asking GHC for its version\n2019-05-06 15:34:43.798403: [debug] Run process: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc --numeric-version\n2019-05-06 15:34:43.799254: [debug] Getting Cabal package version\n2019-05-06 15:34:43.799975: [debug] Getting global package database location\n2019-05-06 15:34:43.800054: [debug] Run process: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --no-user-package-db field --simple-output Cabal version\n2019-05-06 15:34:43.800731: [debug] Run process: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --no-user-package-db list --global\n2019-05-06 15:34:43.942529: [debug] Process finished in 142ms: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --no-user-package-db field --simple-output Cabal version\n2019-05-06 15:34:43.942739: [debug] Process finished in 142ms: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --no-user-package-db list --global\n2019-05-06 15:34:43.956352: [debug] Process finished in 158ms: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc --numeric-version\n2019-05-06 15:34:43.956423: [debug] GHC version is: ghc-8.0.2\n2019-05-06 15:34:43.956499: [debug] Resolving package entries\n2019-05-06 15:34:43.956606: [debug] Trying to decode /Users/marnold/.stack/loaded-snapshot-cache/x86_64-osx/ghc-8.0.2/lts-9.21.cache\n2019-05-06 15:34:43.996883: [debug] Success decoding /Users/marnold/.stack/loaded-snapshot-cache/x86_64-osx/ghc-8.0.2/lts-9.21.cache\n2019-05-06 15:34:44.000908: [debug] Starting to execute command inside EnvConfig\n2019-05-06 15:34:44.000979: [debug] Parsing the targets\n2019-05-06 15:34:44.001189: [debug] Running hpack on /Users/marnold/Code/lambda/authentication-service/package.yaml\n2019-05-06 15:34:44.026786: [debug] hpack output unchanged in /Users/marnold/Code/lambda/authentication-service/authentication-service.cabal\n2019-05-06 15:34:44.040562: [debug] Trying to decode /Users/marnold/.stack/indices/Hackage/01-index.cache\n2019-05-06 15:34:44.256229: [debug] Success decoding /Users/marnold/.stack/indices/Hackage/01-index.cache\n2019-05-06 15:34:44.289569: [debug] Start: getPackageFiles /Users/marnold/Code/lambda/authentication-service/authentication-service.cabal\n2019-05-06 15:34:44.358574: [debug] Finished in 69ms: getPackageFiles /Users/marnold/Code/lambda/authentication-service/authentication-service.cabal\n2019-05-06 15:34:44.358912: [debug] Exception ignored when attempting to load /Users/marnold/Code/lambda/authentication-service/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-caches/lib: /Users/marnold/Code/lambda/authentication-service/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-caches/lib: openBinaryFile: does not exist (No such file or directory)\n2019-05-06 15:34:44.373278: [debug] Exception ignored when attempting to load /Users/marnold/Code/lambda/authentication-service/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-caches/exe-authentication-service: /Users/marnold/Code/lambda/authentication-service/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-caches/exe-authentication-service: openBinaryFile: does not exist (No such file or directory)\n2019-05-06 15:34:44.374206: [debug] Exception ignored when attempting to load /Users/marnold/Code/lambda/authentication-service/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-caches/exe-authentication-service-rotate-keys: /Users/marnold/Code/lambda/authentication-service/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-caches/exe-authentication-service-rotate-keys: openBinaryFile: does not exist (No such file or directory)\n2019-05-06 15:34:44.378317: [debug] Start: getPackageFiles /Users/marnold/Code/lambda/authentication-service/.stack-work/downloaded/IzWmITn_pxL3/amazonka/amazonka.cabal\n2019-05-06 15:34:44.406152: [debug] Finished in 28ms: getPackageFiles /Users/marnold/Code/lambda/authentication-service/.stack-work/downloaded/IzWmITn_pxL3/amazonka/amazonka.cabal\n2019-05-06 15:34:44.407749: [debug] Start: getPackageFiles /Users/marnold/Code/lambda/authentication-service/.stack-work/downloaded/VaZUmJdBvu9Z/jose.cabal\n2019-05-06 15:34:44.458370: [debug] Finished in 51ms: getPackageFiles /Users/marnold/Code/lambda/authentication-service/.stack-work/downloaded/VaZUmJdBvu9Z/jose.cabal\n2019-05-06 15:34:44.459843: [debug] Finding out which packages are already installed\n2019-05-06 15:34:44.460563: [debug] Run process: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --global --no-user-package-db dump --expand-pkgroot\n2019-05-06 15:34:44.509236: [debug] Process finished in 48ms: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --global --no-user-package-db dump --expand-pkgroot\n2019-05-06 15:34:44.510078: [debug] Ignoring package haskeline due to wanting version 0.7.4.2 instead of 0.7.3.0\n2019-05-06 15:34:44.510146: [debug] Ignoring package terminfo due to wanting version 0.4.1.0 instead of 0.4.0.2\n2019-05-06 15:34:44.510190: [debug] Ignoring package xhtml due to wanting version 3000.2.2 instead of 3000.2.1\n2019-05-06 15:34:44.510393: [debug] Run process: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --user --no-user-package-db --package-db /Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb dump --expand-pkgroot\n2019-05-06 15:34:44.643387: [debug] Process finished in 133ms: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --user --no-user-package-db --package-db /Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb dump --expand-pkgroot\n2019-05-06 15:34:44.643669: [debug] Ignoring package jose, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.643745: [debug] Ignoring package test-fixture, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.643800: [debug] Ignoring package haskell-src-meta, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.643852: [debug] Ignoring package th-orphans, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.643917: [debug] Ignoring package quickcheck-instances, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.643982: [debug] Ignoring package concise, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644052: [debug] Ignoring package amazonka-s3, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644100: [debug] Ignoring package amazonka, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644155: [debug] Ignoring package amazonka-core, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644210: [debug] Ignoring package lens, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644257: [debug] Ignoring package persistent-postgresql, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644301: [debug] Ignoring package persistent-template, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644742: [debug] Ignoring package persistent, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644797: [debug] Ignoring package xml-conduit, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644849: [debug] Ignoring package postgresql-simple, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.644996: [debug] Ignoring package resource-pool, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.645087: [debug] Ignoring package aeson-compat, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.645146: [debug] Ignoring package hspec, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.645192: [debug] Ignoring package hspec-core, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.645258: [debug] Ignoring package quickcheck-io, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.645334: [debug] Ignoring package QuickCheck, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.645382: [debug] Ignoring package tf-random, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.645426: [debug] Ignoring package monad-logger, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.648628: [debug] Ignoring package ini, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.648739: [debug] Ignoring package http-conduit, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.648897: [debug] Ignoring package conduit-extra, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.648960: [debug] Ignoring package servant-client, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.649046: [debug] Ignoring package servant-server, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.649377: [debug] Ignoring package wai-app-static, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.649534: [debug] Ignoring package warp, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.649628: [debug] Ignoring package wai-extra, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.649852: [debug] Ignoring package http-date, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.650489: [debug] Ignoring package servant, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.650561: [debug] Ignoring package http-api-data, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.650616: [debug] Ignoring package uri-bytestring, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.650685: [debug] Ignoring package th-lift-instances, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.650755: [debug] Ignoring package attoparsec-iso8601, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.650972: [debug] Ignoring package hlint, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651038: [debug] Ignoring package yaml, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651112: [debug] Ignoring package aeson, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651162: [debug] Ignoring package monad-journal, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651225: [debug] Ignoring package either, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651302: [debug] Ignoring package attoparsec, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651392: [debug] Ignoring package vector, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651484: [debug] Ignoring package scientific, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651590: [debug] Ignoring package conduit, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651804: [debug] Ignoring package MonadRandom, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.651983: [debug] Ignoring package primitive, from (InstalledTo Snap,\"/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb/\"), due to wrong location: (Just (InstalledTo Snap),Local)\n2019-05-06 15:34:44.652703: [debug] Run process: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --user --no-user-package-db --package-db /Users/marnold/Code/lambda/authentication-service/.stack-work/install/x86_64-osx/lts-9.21/8.0.2/pkgdb dump --expand-pkgroot\n2019-05-06 15:34:44.719839: [debug] Process finished in 67ms: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --user --no-user-package-db --package-db /Users/marnold/Code/lambda/authentication-service/.stack-work/install/x86_64-osx/lts-9.21/8.0.2/pkgdb dump --expand-pkgroot\n2019-05-06 15:34:44.722534: [debug] Constructing the build plan\n2019-05-06 15:34:44.851193: [debug] Checking if we are going to build multiple executables with the same name\n2019-05-06 15:34:44.851459: [debug] Executing the build plan\n2019-05-06 15:34:44.854074: [debug] Getting global package database location\n2019-05-06 15:34:44.854179: [debug] Run process: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --no-user-package-db list --global\n2019-05-06 15:34:44.894256: [debug] Process finished in 40ms: /Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --no-user-package-db list --global\n2019-05-06 15:34:44.895126: [debug] Exception ignored when attempting to load /Users/marnold/.stack/precompiled/x86_64-osx/ghc-8.0.2/1.24.2.0/regex-posix-0.95.2@sha256:4fba55cdae7fb6c11ee2f5e823e56cc5fc30d7041edeef4c81f7f26b9235d624,3794/84y8nQstWbhLt6U-nBiCnfQ_PrWr5ann9qOnwUBs-I0=: /Users/marnold/.stack/precompiled/x86_64-osx/ghc-8.0.2/1.24.2.0/regex-posix-0.95.2@sha256:4fba55cdae7fb6c11ee2f5e823e56cc5fc30d7041edeef4c81f7f26b9235d624,3794/84y8nQstWbhLt6U-nBiCnfQ_PrWr5ann9qOnwUBs-I0=: openBinaryFile: does not exist (No such file or directory)\n2019-05-06 15:34:44.908903: [debug] Exception ignored when attempting to load /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-config-cache: /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-config-cache: openBinaryFile: does not exist (No such file or directory)\n2019-05-06 15:34:44.909117: [debug] Exception ignored when attempting to load /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-cabal-mod: /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-cabal-mod: openBinaryFile: does not exist (No such file or directory)\n2019-05-06 15:34:44.909266: [info] regex-posix-0.95.2: configure\n2019-05-06 15:34:44.910644: [debug] Run process within /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/: /Users/marnold/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.24.2.0 configure --with-ghc=/Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc --with-ghc-pkg=/Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb --libdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/lib --bindir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/bin --datadir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/share --libexecdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/libexec --sysconfdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/etc --docdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/doc/regex-posix-0.95.2 --htmldir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/doc/regex-posix-0.95.2 --haddockdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/doc/regex-posix-0.95.2 --dependency=array=array-0.5.1.1 --dependency=base=base-4.9.1.0 --dependency=bytestring=bytestring-0.10.8.1 --dependency=containers=containers-0.5.7.1 --dependency=regex-base=regex-base-0.93.2-AYjYAsBidAc8f5XNm9b2Aa --extra-include-dirs=/usr/local/opt/openssl/include --extra-lib-dirs=/usr/local/opt/openssl/lib\n2019-05-06 15:34:46.975642: [debug] Process finished in 2065ms: /Users/marnold/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.24.2.0 configure --with-ghc=/Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc --with-ghc-pkg=/Users/marnold/.stack/programs/x86_64-osx/ghc-8.0.2/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/pkgdb --libdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/lib --bindir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/bin --datadir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/share --libexecdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/libexec --sysconfdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/etc --docdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/doc/regex-posix-0.95.2 --htmldir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/doc/regex-posix-0.95.2 --haddockdir=/Users/marnold/.stack/snapshots/x86_64-osx/lts-9.21/8.0.2/doc/regex-posix-0.95.2 --dependency=array=array-0.5.1.1 --dependency=base=base-4.9.1.0 --dependency=bytestring=bytestring-0.10.8.1 --dependency=containers=containers-0.5.7.1 --dependency=regex-base=regex-base-0.93.2-AYjYAsBidAc8f5XNm9b2Aa --extra-include-dirs=/usr/local/opt/openssl/include --extra-lib-dirs=/usr/local/opt/openssl/lib\n2019-05-06 15:34:46.975924: [debug] Encoding /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-config-cache\n2019-05-06 15:34:46.976439: [debug] Finished writing /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-config-cache\n2019-05-06 15:34:46.976505: [debug] Encoding /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-cabal-mod\n2019-05-06 15:34:46.976849: [debug] Finished writing /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-cabal-mod\n2019-05-06 15:34:46.976968: [info] regex-posix-0.95.2: build\n2019-05-06 15:34:46.977205: [debug] Run process within /private/var/folders/21/zwczf5r93z11lv5bpxp25rwm0000gn/T/stack-25f25e16a2305aa4/regex-posix-0.95.2/: /Users/marnold/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.24.2.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\nProgress 0/4\n</code></pre>\n"}, {"tags": ["scala", "haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1557179778, "last_edit_date": 1557179778, "creation_date": 1557179457, "answer_id": 56012862, "question_id": 56012646, "link": "https://stackoverflow.com/questions/56012646/questions-about-a-la-carte-data-types/56012862#56012862", "title": "Questions about a la carte data types", "body": "<blockquote>\n  <p>What does it mean exactly \u201cwe have tied the \u2018recursive knot\u2019 of a signature\u201d?</p>\n</blockquote>\n\n<p>The original <code>Expr</code> datatype is recursive, referring to itself in its own definition:</p>\n\n<pre><code>data Expr = Val Int | Add Expr Expr\n</code></pre>\n\n<p>The <code>Arith</code> type \u201cfactors out\u201d the recursion by replacing recursive calls with a parameter:</p>\n\n<pre><code>data Arith e = Val Int | Add e e\n</code></pre>\n\n<p>The original <code>Expr</code> type can have any depth of nesting, which we want to support with <code>Arith</code> as well, but the maximum depth depends on what type we choose for <code>e</code>:</p>\n\n<ul>\n<li><p><code>Arith Void</code> can\u2019t be nested: it can only be a literal value (<code>Val n</code>) because we can\u2019t construct an <code>Add</code>, because we can\u2019t obtain a value of type <code>Void</code> (it has no constructors)</p></li>\n<li><p><code>Arith (Arith Void)</code> can have one level of nesting: the outer constructor can be an <code>Add</code>, but the inner constructors can only be <code>Lit</code>.</p></li>\n<li><p><code>Arith (Arith (Arith Void))</code> can have two levels</p></li>\n<li><p>And so on</p></li>\n</ul>\n\n<p>What <code>Fix Arith</code> gives us is a way to talk about the <em>fixed point</em> <code>Arith (Arith (Arith \u2026))</code> with no limit on the depth.</p>\n\n<p>This is just like how we can replace a recursive function with a non-recursive function and recover the recursion with the fixed-point combinator:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>factorial' :: (Integer -&gt; Integer) -&gt; Integer -&gt; Integer\nfactorial' recur n = if n &lt;= 1 then 1 else n * recur (n - 1)\n\nfactorial :: Integer -&gt; Integer\nfactorial = fix factorial'\n\nfactorial 5 == 120\n</code></pre>\n\n<blockquote>\n  <p>What does it mean <code>Fix Arith</code> is a language equivalent to the original <code>Expr</code>?</p>\n</blockquote>\n\n<p>The language (grammar) that <code>Fix Arith</code> represents is equivalent to the language that <code>Expr</code> represents; that is, they\u2019re isomorphic: you can write a pair of total functions <code>Fix Arith -&gt; Expr</code> and <code>Expr -&gt; Fix Arith</code>.</p>\n\n<blockquote>\n  <p>How it happens that it\u2019s valid to apply function <code>g</code> to <code>LaCarte$Add</code>?</p>\n</blockquote>\n\n<p>I\u2019m not very familiar with Scala, but it looks like <code>Add</code> is a subtype of <code>Arith</code>, so the parameter of <code>g</code> of type <code>F[Fix[F]]</code> can be filled with a value of type <code>Arith[Fix[Arith]]</code> which you get by matching on the <code>In</code> constructor to \u201cunfold\u201d one level of recursion.</p>\n"}], "owner": {"reputation": 615, "user_id": 1325109, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/503cdb1e62fb2c8e86674c23b394e298?s=128&d=identicon&r=PG&f=1", "display_name": "dmgcodevil", "link": "https://stackoverflow.com/users/1325109/dmgcodevil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 2, "accepted_answer_id": 56012862, "answer_count": 1, "score": 7, "last_activity_date": 1557179856, "creation_date": 1557178026, "last_edit_date": 1557179856, "question_id": 56012646, "link": "https://stackoverflow.com/questions/56012646/questions-about-a-la-carte-data-types", "title": "Questions about a la carte data types", "body": "<p>I was reading <a href=\"http://www.cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf\" rel=\"noreferrer\">the original paper about data types a la carte</a> and decided to try to implement the idea in Scala (I know it's already implemented in many functional libraries). Unfortunately I found the original paper is hard to comprehend and I stuck somewhere in the beginning. Then I found <a href=\"http://www.cs.nott.ac.uk/~pszgmh/alacarte.pdf\" rel=\"noreferrer\">another paper</a> that was easier to understand and I managed to rewrite Haskell code from the paper into Scala, you can find it <a href=\"https://gist.github.com/dmgcodevil/ddc3d3fa13f70d15db9f13cf383bfc04\" rel=\"noreferrer\">here</a>. However I still struggling to understand a few moments:</p>\n\n<ol>\n<li>A quote from the second paper</li>\n</ol>\n\n<p>Orignal <code>Expr</code> data type</p>\n\n<pre><code>data Expr = Val Int | Add Expr Expr\n</code></pre>\n\n<p>New type signature:</p>\n\n<pre><code>data Arith e = Val Int | Add e e\n</code></pre>\n\n<blockquote>\n  <p>For any functor <code>f</code>, its induced recursive datatype, <code>Fix f</code>, is defined as the least fixpoint of <code>f</code>, implemented as follows:</p>\n</blockquote>\n\n<pre><code>data Fix f = In (f (Fix f))\n</code></pre>\n\n<blockquote>\n  <p>Now that we have tied the <em>recursive knot</em> of a signature,\n  <code>Fix Arith</code> is a language equivalent to the original <code>Expr</code> datatype\n  which allowed integer values and addition.</p>\n</blockquote>\n\n<p>What does it mean exactly \"we have tied the recursive knot of a signature\"  and what does it mean <code>Fix Arith</code> is a language equivalent to the original <code>Expr</code> ?</p>\n\n<p>The actual type of <code>In</code> is <code>In :: f (Fix f) -&gt; Fix f</code>\nIf we try to construct a value using <code>In</code> construct and <code>Val 1</code> variable we'll get the following result:</p>\n\n<pre><code>&gt; :t  In(Val 1)\n&gt; In(Val 1) :: Fix Arith\n</code></pre>\n\n<p>Scala encoding of the same data types:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>  sealed trait Arith[A]\n  case class Val[A](x: Int) extends Arith[A]\n  case class Add[A](a: A, b: A) extends Arith[A]\n\n  trait Fix[F[_]]\n  case class In[F[_]](exp: F[Fix[F]]) extends Fix[F]\n</code></pre>\n\n<ol start=\"2\">\n<li><code>fold</code> function\nThe <code>fold</code> function has the following signature and implementation</li>\n</ol>\n\n<p>Haskell:</p>\n\n<pre><code>fold :: Functor f =&gt; (f a -&gt; a) -&gt; Fix f -&gt; a\nfold f (In t) = f (fmap (fold f) t)\n</code></pre>\n\n<p>Scala variant I came up with</p>\n\n<pre><code>  def fold[F[_] : Functor, A](f: F[A] =&gt; A): Fix[F] =&gt; A = {\n    case In(t) =&gt;\n      val g: F[Fix[F]] =&gt; F[A] = implicitly[Functor[F]].lift(fold(f))\n      f(g(t))\n  }\n</code></pre>\n\n<p>The thing that I'm curious about is that in my Scala version function <code>g</code> has the following type <code>F[Fix[F]] =&gt; F[A]</code> but the type of variable <code>t</code> after pattern matching is <code>LaCarte$Add</code> with value <code>Add(In(Val(1)),In(Val(2)))</code>, how it happens that it's valid to apply function <code>g</code> to <code>LaCarte$Add</code> ? Also, I'd very appreciate if you can help me to understand <code>fold</code> function ?</p>\n\n<p>Quote from the paper:</p>\n\n<blockquote>\n  <p>The first argument of fold is an <em>f-algebra</em>, which provides\n  the behavior of each constructor associated with a given signature <code>f</code>. </p>\n</blockquote>\n"}, {"tags": ["haskell", "recursion-schemes", "catamorphism", "anamorphism"], "comments": [{"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 2, "creation_date": 1557174747, "post_id": 56011854, "comment_id": 98669069, "body": "The corresponding identity to <code>foldr (:) []</code> is <code>unfoldr uncons</code>. But what kind of <code>Int -&gt; Int</code> function are you looking for? There&#39;s no structure there to construct, destruct, or otherwise recurse over."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 1, "creation_date": 1557175101, "post_id": 56011854, "comment_id": 98669191, "body": "@user11228628 There would be an unfold that wouldn&#39;t be entirely trivial if the OP were using recursively defined naturals, though I&#39;m not exactly sure about how relevant doing so would be to this specific question."}, {"owner": {"reputation": 309, "user_id": 4740467, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e653edf458dc50848e813cf0dfde6a10?s=128&d=identicon&r=PG&f=1", "display_name": "Conor Quinn", "link": "https://stackoverflow.com/users/4740467/conor-quinn"}, "edited": false, "score": 0, "creation_date": 1557175127, "post_id": 56011854, "comment_id": 98669204, "body": "I&#39;m looking for something that will recurse based on an input integer and also return an integer. Something like fact using a recursion scheme."}, {"owner": {"reputation": 309, "user_id": 4740467, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e653edf458dc50848e813cf0dfde6a10?s=128&d=identicon&r=PG&f=1", "display_name": "Conor Quinn", "link": "https://stackoverflow.com/users/4740467/conor-quinn"}, "edited": false, "score": 0, "creation_date": 1557175196, "post_id": 56011854, "comment_id": 98669231, "body": "factorial 0 = 1 factorial n = n * factorial (n - 1)"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557175439, "post_id": 56011854, "comment_id": 98669311, "body": "You can write factorial with a <code>hylo</code>morphism; are you asking for how exactly to do that? That question seems unrelated to whether unfoldl/r can be used to define the identity function, since factorial isn&#39;t the identity function."}, {"owner": {"reputation": 309, "user_id": 4740467, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e653edf458dc50848e813cf0dfde6a10?s=128&d=identicon&r=PG&f=1", "display_name": "Conor Quinn", "link": "https://stackoverflow.com/users/4740467/conor-quinn"}, "edited": false, "score": 0, "creation_date": 1557175862, "post_id": 56011854, "comment_id": 98669470, "body": "I asked about it in those terms because I&#39;ve always thought about fold and unfold as being symmetric. I&#39;m just looking for a recursion scheme that takes and Int and returns an Int. I&#39;m looking into the Nat base type and that looks promising."}, {"owner": {"reputation": 309, "user_id": 4740467, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e653edf458dc50848e813cf0dfde6a10?s=128&d=identicon&r=PG&f=1", "display_name": "Conor Quinn", "link": "https://stackoverflow.com/users/4740467/conor-quinn"}, "edited": false, "score": 0, "creation_date": 1557175918, "post_id": 56011854, "comment_id": 98669492, "body": "If it is best done with a hylomorphism how to do it would be the answer im looking for."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557176640, "post_id": 56011854, "comment_id": 98669746, "body": "Maybe you could edit the question to make that more clear? From the headline and the first half of the body, it really looks like you&#39;re asking for <code>unfoldr uncons</code> instead of an explanation of how recursion schemes could be used to define functions that stay within <code>Int</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": false, "score": 3, "last_activity_date": 1557176856, "last_edit_date": 1557176856, "creation_date": 1557176203, "answer_id": 56012344, "question_id": 56011854, "link": "https://stackoverflow.com/questions/56011854/a-recursion-scheme-from-int-int/56012344#56012344", "title": "A recursion scheme from Int -&gt; Int?", "body": "<p>The kind of recursion scheme that deals with building up an intermediate structure and tearing it down, so that the structure doesn't appear in the input or output, is a hylomorphism, spelled <code>hylo</code> in <code>recursion-schemes</code>.</p>\n\n<p>To use a hylomorphism, you need to specify an algebra (something that consumes one step of a recursive structure) and a coalgebra (something that produces one step of a recursive structure), and you need to have a data type for the kind of structure you're using, of course.</p>\n\n<p>You suggested factorial, so let's look into how to write that as a hylomorphism.</p>\n\n<p>One way to look at factorial is as the product of a list of numbers counting down from the initial <code>n</code>. In this framing, we can think of the product as our algebra, tearing down the list one cons at a time, and the count-down as our coalgebra, building up the list as <code>n</code> is decremented.</p>\n\n<p><code>recursion-schemes</code> gives us <code>ListF</code> as a handy base functor for lists, so we'll use that as the data type produced by the coalgebra and consumed by the algebra. Its constructors are <code>Nil</code> and <code>Cons</code>, which of course resemble the constructors for full lists, except that a <code>ListF</code>, like any base structure in a recursion scheme, uses a type parameter in the place that lists would use actual recursion (meaning that <code>Cons :: a -&gt; b -&gt; ListF a b</code> instead of <code>(:) :: a -&gt; [a] -&gt; [a]</code>).</p>\n\n<p>So that determines our types. Now defining <code>fact</code> is a rather fill-in-the-blanks exercise:</p>\n\n<pre><code>import Prelude hiding (product)\nimport Data.Functor.Foldable\n\nproduct :: ListF Int Int -&gt; Int\nproduct Nil = 1\nproduct (Cons a b) = a * b\n\ncountDown :: Int -&gt; ListF Int Int\ncountDown 0 = Nil\ncountDown n = Cons n (n - 1)\n\nfact :: Int -&gt; Int\nfact = hylo product countDown\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1557183542, "last_edit_date": 1557183542, "creation_date": 1557178548, "answer_id": 56012727, "question_id": 56011854, "link": "https://stackoverflow.com/questions/56011854/a-recursion-scheme-from-int-int/56012727#56012727", "title": "A recursion scheme from Int -&gt; Int?", "body": "<p>Taking a cue from your remark about factorials, we can note that natural numbers can be treated as a recursive data structure:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n</code></pre>\n\n<p>In terms of the <a href=\"http://hackage.haskell.org/package/recursion-schemes\" rel=\"nofollow noreferrer\"><em>recursion-schemes</em></a> machinery, the corresponding base functor would be:</p>\n\n<pre><code>data NatF a = ZeroF | SuccF a\n    deriving (Functor)\n</code></pre>\n\n<p><code>NatF</code>, however, is isomorphic to <code>Maybe</code>. That being so, <em>recursion-schemes</em> conveniently makes <code>Maybe</code> the base functor of <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Numeric-Natural.html\" rel=\"nofollow noreferrer\">the <code>Natural</code> type from <em>base</em></a>. For instance, here is the type of <code>ana</code> specialised to <code>Natural</code>:</p>\n\n<pre><code>ana @Natural :: (a -&gt; Maybe a) -&gt; a -&gt; Natural\n</code></pre>\n\n<p>We can use it to write the identity unfold for <code>Natural</code>:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\nimport Numeric.Natural\nimport Data.Functor.Foldable\n\nidNatAna :: Natural -&gt; Natural\nidNatAna = ana $ \\case\n    0 -&gt; Nothing\n    x -&gt; Just (x - 1)\n</code></pre>\n\n<p>The coalgebra we just gave to <code>ana</code> is <a href=\"http://hackage.haskell.org/package/recursion-schemes-5.1.3/docs/src/Data.Functor.Foldable.html#line-349\" rel=\"nofollow noreferrer\"><code>project</code> for <code>Natural</code></a>, <code>project</code> being the function that unwraps one layer of the recursive structure. In terms of the <em>recursion-schemes</em> vocabulary, <code>ana project</code> is the identity unfold, and <code>cata embed</code> is the identity fold. (In particular, <code>project</code> for lists is <code>uncons</code> from <code>Data.List</code>, except that it is encoded with <code>ListF</code> instead of <code>Maybe</code>.)</p>\n\n<p>By the way, the factorial function can be expressed as a paramorphism on naturals (<a href=\"https://stackoverflow.com/q/55977311/2751851\">as pointed out in the note at the end of this question</a>). We can also implement that in terms of <em>recursion-schemes</em>:</p>\n\n<pre><code>fact :: Natural -&gt; Natural\nfact = para $ \\case\n    Nothing -&gt; 1\n    Just (predec, prod) -&gt; prod * (predec + 1)\n</code></pre>\n\n<p><code>para</code> makes available, at each recursive step, the rest of the structure to be folded (if we were folding a list, that would be its tail). In this case, I have called the value thus provided <code>predec</code> because at the <code>n</code>-th recursive step from bottom to top <code>predec</code> is <code>n - 1</code>.</p>\n\n<p>Note that <a href=\"https://stackoverflow.com/a/56012344/2751851\">user11228628's hylomorphism</a> is probably a more efficient implementation, if you happen to care about that. (I haven't benchmarked them, though.)</p>\n"}], "owner": {"reputation": 309, "user_id": 4740467, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e653edf458dc50848e813cf0dfde6a10?s=128&d=identicon&r=PG&f=1", "display_name": "Conor Quinn", "link": "https://stackoverflow.com/users/4740467/conor-quinn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 56012727, "answer_count": 2, "score": 0, "last_activity_date": 1557183542, "creation_date": 1557173825, "last_edit_date": 1557178176, "question_id": 56011854, "link": "https://stackoverflow.com/questions/56011854/a-recursion-scheme-from-int-int", "title": "A recursion scheme from Int -&gt; Int?", "body": "<p>The foldr identity is</p>\n\n<pre><code>foldr (:) []\n</code></pre>\n\n<p>More generally, with folds you can either destroy structure and end up with a summary value or inject structure in such a way that you end up with the same output structure. </p>\n\n<p><code>[Int] -&gt; [Int]</code>\nor \n<code>[Int] -&gt; Int</code>\nor\n<code>[Int] -&gt; ?</code></p>\n\n<p>I'm wondering if there a similar identity with unfoldr/l. </p>\n\n<p>I know how to get</p>\n\n<p><code>Int -&gt; [Int]</code></p>\n\n<p>with unfold/ana.</p>\n\n<p>I'm looking for some kind of way to go from </p>\n\n<p><code>Int -&gt; Int</code></p>\n\n<p>with a recursion scheme. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557170364, "post_id": 56011066, "comment_id": 98667464, "body": "By providing a <i>legal</i> signature :). You can remove the signature of the <code>helper</code> function, in fact right now you did not define a clause with the function body itself."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557170441, "post_id": 56011066, "comment_id": 98667490, "body": "Furthermore, although not strictly necessary, I strongly suggest that you name your variabel differently than <code>sum</code>, since the <code>Prelude</code> already contains a function named <code>sum</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1557222744, "last_edit_date": 1557222744, "creation_date": 1557171438, "answer_id": 56011343, "question_id": 56011066, "link": "https://stackoverflow.com/questions/56011066/how-to-fix-illegal-type-signature-error-in-haskell/56011343#56011343", "title": "How to fix &quot;Illegal type signature&quot; error in Haskell", "body": "<p>This actually looks more like a syntactical error: you never defined a function <em>body</em> for <code>helper</code>, indeed you defined the signature of <code>helper</code>, followed by guards (the <code>| ...</code> part), but you should again state <code>helper f g n x = ...</code>.</p>\n\n<p>Furthermore I don't think it is useful to define <code>helper</code> here with a variable for <code>f</code>, an <code>g</code>, since these remain fixed throughout the recursion.</p>\n\n<p>You can probably define the function as:</p>\n\n<pre><code>sumfg :: (Double -&gt; Double) -&gt; (Double -&gt; Double) -&gt; Int -&gt; Double -&gt; Double\nsumfg f g = helperf\n    where helperf 0 _ = 0\n          helperf i x = let fx = f x in fx + helperg (i-1) fx\n          helperg 0 _ = 0\n          helperg i x = let gx = g x in gx + helperf (i-1) gx</code></pre>\n\n<p>We here defined two \"helper\" functions <code>helperf</code> and <code>helperg</code>, <code>helperf</code> will sum up <code>f x</code> with <code>helperg (i-1) (f x)</code>, and <code>helperg</code> does the same, except that we use <code>g</code> instead of <code>f</code>. We here thus use <em>mutual recursion</em> to solve the problem.</p>\n\n<p>We can however solve this problem more elegantly, by making use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:scanl\" rel=\"nofollow noreferrer\"><strong><code>scanl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]</code></strong></a>, <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\"><strong><code>take :: Int -&gt; [a]</code></strong></a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:sum\" rel=\"nofollow noreferrer\"><strong><code>sum :: Num a =&gt; [a] -&gt; a</code></strong></a>:</p>\n\n<pre><code>sumfg :: Num a =&gt; (a -&gt; a) -&gt; (a -&gt; a) -&gt; Int -&gt; a -&gt; a\nsumfg f g n x = sum (take n (scanl (flip ($)) (f x) (cycle [g, f])))</code></pre>\n\n<p>Here we thus make an infinite list of <code>g</code> and <code>f</code>, like <code>[g, f, g, f, g, f, ...]</code> with <code>cycle [f, g]</code>. We then use <code>scanl (flip ($))</code> to each time apply the accumulator to one of the functions, and yield that element. We take the first <code>n</code> items of that list with <code>take n</code>, and finally we use <code>sum</code> to sum up these values.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; sumfg (2+) (3*) 5 1\n91\n</code></pre>\n\n<p>Since <code>(2+1) + (3*(2+1)) + (2+(3*(2+1))) + (3*(2+(3*(2+1)))) + (2+(3*(2+(3*(2+1)))))</code> is <code>91</code>.</p>\n\n<p>We also generalized the signature: we can now work with any numerical type <code>a</code>, with the two functions <code>f</code> and <code>g</code> of type <code>f, g :: a -&gt; a</code>.</p>\n"}], "owner": {"reputation": 39, "user_id": 11461094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9bfb11cd4f0864677ca94b284a5e1c2?s=128&d=identicon&r=PG&f=1", "display_name": "headfxll", "link": "https://stackoverflow.com/users/11461094/headfxll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 0, "accepted_answer_id": 56011343, "answer_count": 1, "score": 1, "last_activity_date": 1557222744, "creation_date": 1557169969, "question_id": 56011066, "link": "https://stackoverflow.com/questions/56011066/how-to-fix-illegal-type-signature-error-in-haskell", "title": "How to fix &quot;Illegal type signature&quot; error in Haskell", "body": "<p>I ran into the following error in Haskell:\n\"Type signatures are only allowed in patterns with ScopedTypeVariables\"\nHow should I re-use the defined variables. Thanks in advance</p>\n\n<pre><code> sum :: (Double -&gt; Double) -&gt; (Double -&gt; Double) -&gt; Int -&gt; \n    (Double -&gt; Double)\n sum f g n = (\\x -&gt; helper f g n x)\n  where\n   helper :: (Double -&gt; Double) -&gt; (Double -&gt; Double) -&gt; Int -&gt; Double -&gt; \n   Double\n    |n == 0 = 0\n    |mod n 2 == 1 = f(x) + helper f g n-1 f(x)\n    |otherwise = g(x) + helper f g n-1 g(x)\n</code></pre>\n"}, {"tags": ["haskell", "tag-soup"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557162634, "post_id": 56009606, "comment_id": 98664516, "body": "You could use <a href=\"http://hackage.haskell.org/package/scalpel-0.6.0\" rel=\"nofollow noreferrer\"><b><code>scalpel</code></b></a>. I personally find it a rather convenient way to parse HTML. It is a library that has the same scope as <code>BeautifulSoup</code> in Python, but of course more declarative and type safe :)."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557162915, "post_id": 56009606, "comment_id": 98664645, "body": "tagsoup is another option."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557163102, "post_id": 56009606, "comment_id": 98664722, "body": "Why define <code>toStrict1</code> when <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Lazy.html#v:toStrict\" rel=\"nofollow noreferrer\"><code>toStrict</code></a> is already available in the library?"}, {"owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557163766, "post_id": 56009606, "comment_id": 98664994, "body": "@MichaelLitchard yes, I plan to use tagsoup. but I will need to parse the list with nested objects, there are no actual examples in the documentation. maybe you know where can i find such? <code>toStrict1</code> is my mistake, thanks:) i even dont know now what to do with this ByteString..."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1557543305, "creation_date": 1557543305, "answer_id": 56086802, "question_id": 56009606, "link": "https://stackoverflow.com/questions/56009606/what-is-the-best-way-to-get-data-from-url-and-parse-it-on-haskell/56086802#56086802", "title": "What is the best way to get data from url and parse it on Haskell?", "body": "<p>As you've seen, the <code>simpleHttp</code> function returns a lazy bytestring.  There are several ways to deal with this in TagSoup.</p>\n\n<p>First, it turns out that you can parse it directly.  The function <code>parseTags</code> has signature:</p>\n\n<pre><code>parseTags :: StringLike str =&gt; str -&gt; [Tag str]\n</code></pre>\n\n<p>meaning that it can parse any type <code>str</code> with a <code>StringLike</code> instance, and if you look at the <code>Text.StringLike</code> module documentation, you'll see that lazy <code>ByteStrings</code> have a <code>StringLike</code> instance.</p>\n\n<p>However, if you go this route, you need to be aware that everything's kind of \"trapped\" in a <code>ByteString</code> world, so you have to write your code using versions of functions like <code>words</code> and <code>unwords</code> that are bytestring-compatible, and even your <code>putStrLn</code> needs an adapter.  A full working example would look like this:</p>\n\n<pre><code>import Network.HTTP.Conduit\nimport Text.HTML.TagSoup\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.ByteString.Lazy.Char8 as CL\n\nmain :: IO ()\nmain = do\n    lbs &lt;- simpleHttp \"https://wiki.haskell.org\"\n    let lastModifiedDateTime = fromFooter $ parseTags lbs\n    putStrLn $ \"wiki.haskell.org was last modified on \" \n        ++ CL.unpack lastModifiedDateTime\n    where fromFooter = CL.unwords . drop 6 . CL.words\n              . innerText . take 2 . dropWhile (~/= \"&lt;li id=footer-info-lastmod&gt;\")\n</code></pre>\n\n<p>and it works fine:</p>\n\n<pre><code>&gt; main\nwiki.haskell.org was last modified on 9 September 2013, at 22:38.\n&gt;\n</code></pre>\n\n<p>The functions from <code>Data.ByteString.Lazy.Char8</code> basically assume that the bytestring is ASCII-encoded, which is close enough for this example to work.</p>\n\n<p>However, it would be more robust to decode the bytestring based on the proper character encoding to a valid text type.  The two main text types in Haskell are the default <code>String</code> type, which is inefficient and slow, but easy to work with, and the <code>Text</code> type, which is highly efficient but a bit more complicated.  (Like <code>ByteString</code>, you need to use <code>Text</code>-compatible versions of functions like <code>words</code> and so on.)  Both <code>String</code> and <code>Text</code> have <code>StringLike</code> instances, so they both work fine with TagSoup.</p>\n\n<p>If we were going to write production-quality code, we'd actually consult the response headers from the HTTP request and/or check for a <code>&lt;meta&gt;</code> tag in the HTML to determine the real encoding.  But, if we just assume the coding is UTF-8 (which it is), the <code>Text</code> version looks like this:</p>\n\n<pre><code>import Network.HTTP.Conduit\nimport Text.HTML.TagSoup\nimport qualified Data.Text.Lazy as TL\nimport qualified Data.Text.Lazy.Encoding as TL\nimport qualified Data.ByteString.Lazy as BL\n\nmain :: IO ()\nmain = do\n    lbs &lt;- simpleHttp \"https://wiki.haskell.org\"\n    let lastModifiedDateTime = fromFooter $ parseTags (TL.decodeUtf8 lbs)\n    putStrLn $ \"wiki.haskell.org was last modified on \" \n        ++ TL.unpack lastModifiedDateTime\n    where fromFooter = TL.unwords . drop 6 . TL.words\n              . innerText . take 2 . dropWhile (~/= \"&lt;li id=footer-info-lastmod&gt;\")\n</code></pre>\n\n<p>and a <code>String</code> version using <code>Data.ByteString.Lazy.UTF8</code> from the <code>utf8-string</code> package looks like this:</p>\n\n<pre><code>import Network.HTTP.Conduit\nimport Text.HTML.TagSoup\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.ByteString.Lazy.UTF8 as BL\n\nmain :: IO ()\nmain = do\n    lbs &lt;- simpleHttp \"https://wiki.haskell.org\"\n    let lastModifiedDateTime = fromFooter $ parseTags (BL.toString lbs)\n    putStrLn $ \"wiki.haskell.org was last modified on \" \n        ++ lastModifiedDateTime\n    where fromFooter = unwords . drop 6 . words\n              . innerText . take 2 . dropWhile (~/= \"&lt;li id=footer-info-lastmod&gt;\")\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 56086802, "answer_count": 1, "score": 0, "last_activity_date": 1557543305, "creation_date": 1557162517, "last_edit_date": 1557162953, "question_id": 56009606, "link": "https://stackoverflow.com/questions/56009606/what-is-the-best-way-to-get-data-from-url-and-parse-it-on-haskell", "title": "What is the best way to get data from url and parse it on Haskell?", "body": "<p>I'm having trouble with parsing data from url. </p>\n\n<p>I have url with \"https://\" so i think i should use import Network.HTTP.Conduit\nBut</p>\n\n<pre><code>simpleHttp url\n</code></pre>\n\n<p>returns L.ByteString\nI really don't understand what shoud i do after that</p>\n\n<p>So i have such code to get data</p>\n\n<pre><code>toStrict1 :: L.ByteString -&gt; B.ByteString\ntoStrict1 = B.concat . L.toChunks\n\nmain :: IO ()\nmain = do\n    lbs &lt;- simpleHttp url\n    let page = toStrict1 lbs\n</code></pre>\n\n<p>and example of parsing</p>\n\n<pre><code>    let lastModifiedDateTime = fromFooter $ parseTags doc\n    putStrLn $ \"wiki.haskell.org was last modified on \" ++ lastModifiedDateTime\n    where fromFooter = unwords . drop 6 . words . innerText . take 2 . dropWhile (~/= \"&lt;li id=footer-info-lastmod&gt;\")\n</code></pre>\n\n<p>How can i combine this two parts of code?</p>\n"}, {"tags": ["list", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 2, "creation_date": 1557161718, "post_id": 56009380, "comment_id": 98664150, "body": "You can use a separate function that reverses the elements of a list of length three. It will simply return a list of any other list without modification."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1557162442, "post_id": 56009380, "comment_id": 98664443, "body": "<code>[1,2,3]</code> to <code>[2,3,1]</code> is a rotation, not a reversal (which would be <code>[3,2,1]</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 0, "last_activity_date": 1557197833, "last_edit_date": 1557197833, "creation_date": 1557184566, "answer_id": 56013492, "question_id": 56009380, "link": "https://stackoverflow.com/questions/56009380/manipulating-a-list-using-pattern-matching/56013492#56013492", "title": "Manipulating a list using pattern-matching", "body": "<p>If the inner lists are always 3 elements, then you can hardcode that fact and use a simple solution like this:</p>\n\n<pre><code>f :: [a] -&gt; [[a]]\nf [] = []\nf (x1:x2:x3:xs) = [x2,x3,x1]:f xs\nf xs = [xs]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1557197705, "post_id": 56014014, "comment_id": 98673970, "body": "This only addresses step 1."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1557189069, "creation_date": 1557189069, "answer_id": 56014014, "question_id": 56009380, "link": "https://stackoverflow.com/questions/56009380/manipulating-a-list-using-pattern-matching/56014014#56014014", "title": "Manipulating a list using pattern-matching", "body": "<p>You can achieve your goal using take and drop as well</p>\n\n<pre><code>f [] = []\nf xs = (take 3 xs) : f2 (drop 3 xs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1557239352, "post_id": 56014655, "comment_id": 98693444, "body": "Did you even test this? It&#39;s full of errors. 1. Syntax error: <code>:</code> instead of <code>::</code> after <code>divide</code>. 2. You use <code>\\case</code> without enabling the LambdaCase extension. 3. You use <code>mapRight</code> from a third-party library that you don&#39;t bother to mention. 4. <code>process</code> doesn&#39;t type-check (you&#39;re calling <code>concat</code> and shouldn&#39;t be)."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1558137533, "post_id": 56014655, "comment_id": 99013992, "body": "@JosephSible, actually nope, I was writing it from a phone waiting for a train. Thanks for catching <code>:</code> instead of <code>::</code> and unnecessary <code>concat</code>.  The rest (lambdacase and mapRight) is easily googleable."}], "tags": [], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "is_accepted": false, "score": -1, "last_activity_date": 1558137434, "last_edit_date": 1558137434, "creation_date": 1557195443, "answer_id": 56014655, "question_id": 56009380, "link": "https://stackoverflow.com/questions/56009380/manipulating-a-list-using-pattern-matching/56014655#56014655", "title": "Manipulating a list using pattern-matching", "body": "<p>Idiomatic Haskell would be much better than other answers here. Basically, try to always design the API so it contains the proof that no corner case could occur. Hardcoding literals or hardcoding flip-like operations on lists (without guarantees of its length) are ALWAYS BAD. </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE LambdaCase #-}\n\ndivide : [a] -&gt; [Either [a] (a,a,a)]\ndivide = \\case\n    []          -&gt; []\n    t1:t2:t3:ts -&gt; Right (t1,t2,t3) : divide ts\n    ts          -&gt; [Left ts]\n\nprocess :: [Either [a] (a,a,a)] -&gt; [[a]]\nprocess = fmap (flatten . flipEls) where\n    flipEls = fmap $ \\(t1,t2,t3) -&gt; [t2,t1,t3]\n    flatten = either id id\n</code></pre>\n\n<p>Now, you can just it like <code>process . divide</code></p>\n"}], "owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 56013492, "answer_count": 3, "score": 0, "last_activity_date": 1558137434, "creation_date": 1557161437, "last_edit_date": 1557161838, "question_id": 56009380, "link": "https://stackoverflow.com/questions/56009380/manipulating-a-list-using-pattern-matching", "title": "Manipulating a list using pattern-matching", "body": "<p>I want to write a function which takes a list as input value and manipulates it the following way:</p>\n\n<p>Step 1: Put every 3 elements of the list in a sublist. \nShould there remain less then 3 elements the remaining elements are put together in a specific sublist which is not going to be relevant in Step 2. </p>\n\n<p>Step 2: Reverse the order of the elements in the created sublists. \nThe first element should be placed at the position of the third element, the second at the position of first element and the third element at the position of the second element. ([1,2,3] transformed to [2,3,1])</p>\n\n<p>Example: </p>\n\n<pre><code>[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17] \n\n-- should be transformed to \n[[2,3,1],[5,6,4],[8,9,7],[11,12,10],[14,15,13],[16,17]] \n</code></pre>\n\n<p>So far I found the following approach to put every 3 elements together in sublists but I am not quite sure how to change the order of the elements in every sublist to match the requirements.</p>\n\n<pre><code>    splitEvery :: Int -&gt; [a] -&gt; [[a]]\n    splitEvery _ [] = []\n    splitEvery n xs = as : splitEvery n bs \n        where (as,bs) = splitAt n xs\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "fold"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1557162449, "post_id": 56008430, "comment_id": 98664446, "body": "For clarification. You are working with a list, not an array. Your list has values of type <code>Int</code>. Thinking of them as objects may add confusion. You don&#39;t have any variables in your list, just values."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557168765, "post_id": 56008430, "comment_id": 98666866, "body": "Note that <code>negate</code> already exists, as a member of the <code>Num</code> class. <code>map negate [1,2,3] == [-1, -2, -3]</code>."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1557179721, "post_id": 56008430, "comment_id": 98670713, "body": "Why do people downvote this? The question about the nature of foldl and foldr is helpful, even if the <code>map</code> solution is much simpler"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557181432, "post_id": 56008430, "comment_id": 98671132, "body": "Everyone suggesting the <code>negate</code> in <code>Prelude</code>: notice that OP wants &quot;a list where every element is negative&quot;, which is exactly what their implementation does. That&#39;s not the same as &quot;negate every element&quot;!"}], "answers": [{"tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 5, "last_activity_date": 1557181469, "last_edit_date": 1557181469, "creation_date": 1557158427, "answer_id": 56008718, "question_id": 56008430, "link": "https://stackoverflow.com/questions/56008430/fold-function-keep-switching-var-locations/56008718#56008718", "title": "fold function keep switching var locations", "body": "<p><code>foldl</code> does! <code>foldl</code> is a left fold, so it works on your list by starting with its initial state (which you provide as <code>[]</code>) and the leftmost element of the list, and calls your function which prepends the negation of that element to the state. Then it takes the next leftmost element and does the same thing. But you're prepending each time, which means that the first element of your input ends up corresponding to the last element of the output, because it was the first to get prepended.</p>\n\n<p>You might want <code>foldr</code> for this, which is a fold that starts with the rightmost element. Alternatively, using <code>map</code> would be a simpler approach for this particular problem.</p>\n\n<p>Sample code:</p>\n\n<pre><code>makeAllNegative = map (negate . abs)\n</code></pre>\n"}], "owner": {"reputation": 695, "user_id": 9733887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f81e5b70f7650bb2ec38ef326bd0d67?s=128&d=identicon&r=PG&f=1", "display_name": "I.zv", "link": "https://stackoverflow.com/users/9733887/i-zv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "accepted_answer_id": 56008718, "answer_count": 1, "score": 1, "last_activity_date": 1557181469, "creation_date": 1557157299, "last_edit_date": 1557162164, "question_id": 56008430, "link": "https://stackoverflow.com/questions/56008430/fold-function-keep-switching-var-locations", "title": "fold function keep switching var locations", "body": "<p>I want to write a function which takes a list of integers and returns a list where every element is negative.</p>\n\n<pre><code>negate :: [Int] -&gt; [Int]\nnegate xs = foldl (\\x xs -&gt; (abs x * (-1)) : xs) [] xs\n</code></pre>\n\n<p>This function negate all the array objects but also reverse the locations of all variables in the array. What make this function reverse the locations?</p>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557134698, "post_id": 56002197, "comment_id": 98650735, "body": "I&#39;m not sure what you mean by &quot;linear&quot;, or what&#39;s wrong with the second (correct) definition. (Note that you can use guards instead of <code>if&#47;then&#47;else</code> to get it closer to the first example.) But the first one doesn&#39;t work because Haskell pattern matching doesn&#39;t work like that, using the same variable name in 2 different patterns doesn&#39;t allow the compiler to realise you only want the pattern to apply when those 2 things are equal."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557147169, "post_id": 56002197, "comment_id": 98656744, "body": "@RobinZigmond &quot;Linear&quot;, meaning each variable can be mentioned only once (cf linear types)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1557151435, "post_id": 56002197, "comment_id": 98659181, "body": "Why not sidestep the whole issue? <code>isWaiting = any . (==)</code>. GHC can provide you with a <code>Foldable</code> instance via deriving if you haven&#39;t got one already."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1557154041, "post_id": 56002197, "comment_id": 98660505, "body": "@DanielWagner: Or even <code>isWaiting = elem</code>. :-D"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1557203441, "post_id": 56002197, "comment_id": 98675090, "body": "Technically, they aren&#39;t linear - you can mention previous variables in the expression part of a view pattern. :)"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557154816, "post_id": 56002581, "comment_id": 98660925, "body": "Nice, I&#39;m mad at myself for not recognizing <code>elem</code>! ...and at this point I&#39;d even be tempted not to define <code>isWaiting</code> at all, hah."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 9, "last_activity_date": 1557172572, "last_edit_date": 1557172572, "creation_date": 1557135685, "answer_id": 56002581, "question_id": 56002197, "link": "https://stackoverflow.com/questions/56002197/why-do-haskell-patterns-have-to-be-linear/56002581#56002581", "title": "Why do Haskell patterns have to be linear?", "body": "<p>Some languages with pattern matching (e.g. Prolog, Erlang) allow for</p>\n\n<pre><code>isWaiting x (Push x y p) = True \n</code></pre>\n\n<p>to mean that the pattern only matches when the two pattern variables <code>x</code> are equivalent.</p>\n\n<p>Haskell doesn't. You can read up on <a href=\"https://stackoverflow.com/questions/9780779/pattern-matching-prolog-vs-haskell\">Pattern Matching - Prolog vs. Haskell</a> if you like.</p>\n\n<hr>\n\n<p>An alternative to your working variant that uses guards looks like:</p>\n\n<pre><code>isWaiting :: Eq a =&gt; a -&gt; PriorityQueue a -&gt; Bool\nisWaiting x EmptyQueue = False\nisWaiting x (Push z y p)\n  | x == z = True\n  | otherwise = isWaiting x p\n</code></pre>\n\n<p>And one that uses the <code>(||)</code> operator instead of <em>if-then-else</em> looks like:</p>\n\n<pre><code>isWaiting :: Eq a =&gt; a -&gt; PriorityQueue a -&gt; Bool\nisWaiting x EmptyQueue = False\nisWaiting x (Push z y p) = x == z || isWaiting x p\n</code></pre>\n\n<p><strong>Edit:</strong> And one that uses Daniel Wagner's proposal of deriving <code>Foldable</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\ntype Priority = ...\n\ndata PriorityQueue a\n  = EmptyQueue\n  | Push a Priority (PriorityQueue a)\n  deriving (Foldable)\n\nisWaiting :: Eq a =&gt; a -&gt; PriorityQueue a -&gt; Bool\nisWaiting = elem\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "edited": false, "score": 0, "creation_date": 1557161935, "post_id": 56002623, "comment_id": 98664248, "body": "Assuming that GC matters, which is the &quot;explicit variant&quot;?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "edited": false, "score": 0, "creation_date": 1557166120, "post_id": 56002623, "comment_id": 98665928, "body": "@mushishi I meant code like <code>foo x y z | z==x = bar z</code> which one can still use if more control on GC is required."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1557192014, "post_id": 56002623, "comment_id": 98673057, "body": "Allowing non-linear patterns was discussed during the design of Haskell, but we decided against it. The implicit equality comparison can hide an arbitrary amount of computation, so it felt better not to allow it."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 16, "last_activity_date": 1557136203, "last_edit_date": 1557136203, "creation_date": 1557135801, "answer_id": 56002623, "question_id": 56002197, "link": "https://stackoverflow.com/questions/56002197/why-do-haskell-patterns-have-to-be-linear/56002623#56002623", "title": "Why do Haskell patterns have to be linear?", "body": "<p>Handling non-linear patterns would require to decide equality on the two terms which are being matched. In general, we can't do this:</p>\n\n<pre><code>areFunctionsEqual :: (Integer-&gt;Integer) -&gt; (Integer-&gt;Integer) -&gt; Bool\nareFunctionsEqual f f = True\nareFunctionsEqual _ _ = False\n</code></pre>\n\n<p>The above can not really be allowed since we can't compare functions.</p>\n\n<p>One might however wonder why that is not allowed for types in the <code>Eq</code> class, where decidability is not an issue. That would allow one to write</p>\n\n<pre><code>foo x y x = ...\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>foo x y z | z==x = ...\n</code></pre>\n\n<p>This is harder to justify. One might argue that the first non linear pattern might be written by accident, and introduce subtle bugs. The second is not that longer, and better documents the intent.</p>\n\n<p>Whether this is a good argument or not is a matter of personal opinion, I think.</p>\n\n<hr>\n\n<p>Another subtle argument:</p>\n\n<pre><code>foo x y z | z==x = bar x\n</code></pre>\n\n<p>is denotationally equivalent to</p>\n\n<pre><code>foo x y z | z==x = bar z\n</code></pre>\n\n<p>but the two variants might still lead to different memory footprints, since in a larger program the first one might allow <code>z</code> to be garbage collected, while the second one would allow <code>x</code> to be garbage collected. If, say, <code>z</code> is already referred to elsewhere in the program, we want to use the second form, so that <code>x</code> is garbage collected. The first form would lead to both <code>x</code> and <code>z</code> to be kept in memory.</p>\n\n<p>If we could write <code>foo x y x = bar x</code>, which is going to be garbage collected?\nNot so clear.</p>\n\n<p>This is arguably a very a minor point, since one could still use the explicit variant, if controlling garbage collection is that important.</p>\n"}], "owner": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 56002623, "answer_count": 2, "score": 6, "last_activity_date": 1557172572, "creation_date": 1557134274, "question_id": 56002197, "link": "https://stackoverflow.com/questions/56002197/why-do-haskell-patterns-have-to-be-linear", "title": "Why do Haskell patterns have to be linear?", "body": "<p>Example forbidden code (which I would like to be able to write): </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isWaiting :: Eq a =&gt; a -&gt; PriorityQueue a -&gt; Bool\nisWaiting x EmptyQueue = False\nisWaiting x (Push x y p) = True \nisWaiting x (Push z y p) = isWaiting x p \n</code></pre>\n\n<p>The same logic, but working variant:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isWaiting :: Eq a =&gt; a -&gt; PriorityQueue a -&gt; Bool\nisWaiting x EmptyQueue = False\nisWaiting x (Push z y p) = if x == z then True else isWaiting x p\n</code></pre>\n"}, {"tags": ["haskell", "arrows", "type-level-computation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1557143078, "post_id": 56001863, "comment_id": 98654575, "body": "I think this has to be re-thought. <code>Tonic t :: * -&gt; * -&gt; *</code> has the right kind for <code>Arrow</code> or <code>Category</code>, but <code>Tonic Antitonic</code> is not a category since the composition of two (antitonic) arrows is no longer an (antitonic) arrow. Indeed, antitonic functions do not make a category. At best, we can make a category with &quot;functions of known tonicity&quot;, using a type which does <i>not</i> expose the tonicity (a sort of existential type) and juggle between <code>Tonicity t a b</code> (not a category) and <code>SomeTonicity a b</code> (category). Alternatively, we could use a <code>IndexedCategory</code> class to allow for tonicity changes."}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557149191, "post_id": 56001863, "comment_id": 98657904, "body": "@chi very interesting! Can you elaborate on how a <code>IndexedCategory</code> class would work?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557149758, "post_id": 56001863, "comment_id": 98658203, "body": "Something like <code>class IC k where type F k t1 t2 ; type B k ; comp :: k t1 a b -&gt; k t2 b c -&gt; k (F k t1 t2) a c ; id :: k (B k) a c</code>, I guess, forcing <code>k</code> to define the composition rule for indices <code>t</code>s (and the index for <code>id</code>). This is untested, it might require some more changes."}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557151235, "post_id": 56001863, "comment_id": 98659066, "body": "@chi The other option you mention, is that similar to moving between GHC.TypeLits&#39; <code>KnownNat n</code> and <code>SomeNat</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557167411, "post_id": 56001863, "comment_id": 98666385, "body": "Roughly, yes. I&#39;d rather use two types instead of a typeclass like <code>KnownNat</code>, but the spirit is similar. This is assuming that you really want/need to reuse the standard arrow/category class,"}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557257260, "post_id": 56001863, "comment_id": 98702110, "body": "@chi actually, this makes me think. <code>Arrow</code>s were first introduced as generalization of Monads because there were instances of them whose type specifications did not completely match up. Is there a more general <code>Arrow</code>-like interface waiting from the shadows that might be useful for cases like these, where the return type of composition might fill in a different <code>t</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1557259805, "post_id": 56001863, "comment_id": 98703164, "body": "I believe there might indeed be such a generalization, extending <code>IC</code> above to arrows. Anyway, many standard typeclasses over the years have been extended/generalized in the libraries, but only a few of such generalizations proved useful enough to become widespread. This however does not mean that one should not experiment and have some fun ;)"}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557341556, "post_id": 56001863, "comment_id": 98736210, "body": "@chi Very cool! So we have (a) change between a general (non-category) type and more specialized types that are not parametrized by <code>t</code> (but can also not compose in the same way because they are restricted categories?). (b) convert between a general and an existential type that does not expose <code>t</code>, but then there is no way to convert back. (Is this true?). (c) Usage of an IndexedCategory. Exactly how this would solve the problem I don&#39;t know yet, because I&#39;d think that would hit the same limits as my attempt above(?) (Please post an answer!) or (d) hand-roll a more general Category and Arrow."}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557589886, "post_id": 56001863, "comment_id": 98820056, "body": "The code I finally ended up with (with a simpler example that working with tonicities) can be found <a href=\"https://gist.github.com/Qqwy/ebb6b8968817428f4f2a39fc3b59c57c\" rel=\"nofollow noreferrer\">in this gist</a>. It is based on the answer by Li-Yao Xia, and also contains the helper &#39;indexed category&#39; and &#39;indexed arrow&#39; typeclasses suggested by @chi."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557164684, "post_id": 56005135, "comment_id": 98665317, "body": "Nothing unsafe about <code>applySfun</code>! Might also be worth just reusing <code>Tagged</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557176850, "post_id": 56005135, "comment_id": 98669817, "body": "Very good point! I still think  <code>Sfun</code> should be its own opaque type though, while I think the point of <code>Tagged</code> is to be transparent."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1557176869, "last_edit_date": 1557176869, "creation_date": 1557145305, "answer_id": 56005135, "question_id": 56001863, "link": "https://stackoverflow.com/questions/56001863/how-to-work-with-types-that-change-under-composition/56005135#56005135", "title": "How to work with types that change under composition?", "body": "<p>The universe of tonicities is fixed, so a single data type would be more accurate. The data constructors are lifted to the type level with the <code>DataKinds</code> extension.</p>\n\n<pre><code>data Tonicity = Monotone | Antitone | Constant | Unknown\n</code></pre>\n\n<p>Then, I would use a newtype to represent tonic functions:</p>\n\n<pre><code>newtype Sfun (t :: Tonicity) a b = UnsafeMkSfun { applySfun :: a -&gt; b }\n</code></pre>\n\n<p>To ensure safety, the constructor must be hidden by default. But users of such a Haskell EDSL would most likely want to wrap their own functions in it. Tagging the name of the constructor with \"unsafe\" is a nice compromise to enable that use case.</p>\n\n<p>Function composition literally behaves as function composition, with some extra type-level information.</p>\n\n<pre><code>composeSfun :: Sfun t1 b c -&gt; Sfun t2 a b -&gt; Sfun (ComposeTonicity t1 t2) a c\ncomposeSfun (UnsafeMkSfun f) (UnsafeMkSfun g) = UnsafeMkSfun (f . g)\n\n-- Composition of tonicity annotations\ntype family ComposeTonicity (t1 :: Tonicity) (t2 :: Tonicity) :: Tonicity where\n  ComposeTonicity Monotone Monotone = Monotone\n  ComposeTonicity Monotone Antitone = Antitone\n  ...\n  ComposeTonicity _ _ = Unknown  -- Any case we forget is Unknown by default.\n                                 -- In a way, that's some extra safety.\n</code></pre>\n"}], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 56005135, "answer_count": 1, "score": 8, "last_activity_date": 1557176869, "creation_date": 1557133084, "last_edit_date": 1557138489, "question_id": 56001863, "link": "https://stackoverflow.com/questions/56001863/how-to-work-with-types-that-change-under-composition", "title": "How to work with types that change under composition?", "body": "<p>I recently read the very interesting paper <a href=\"https://infoscience.epfl.ch/record/231867/files/monotonicity-types.pdf\" rel=\"noreferrer\">Monotonicity Types</a> in which a new HM-language is described that keeps track of monotonicity across operations, so that the programmer does not have to do this manually (and fail at compile-time when a non-monotonic operation is passed to something that requires one).</p>\n\n<p>I was thinking that it probably would be possible to model this in Haskell, since the <code>sfun</code>s that the paper describes seem to be 'just another Arrow instance', so I set out to create a very small POC.</p>\n\n<p>However, I came across the problem that there are, simply put, four kinds of 'tonicities' (for lack of a better term): monotonic, antitonic, constant (which is both) and unknown (which is neither), which can turn into one-another under composition or application:</p>\n\n<p>When two 'tonic functions' are applied, the resulting tonic function's tonicity ought to be the most specific one that matches both types ('Qualifier Contraction; Figure 7' in the paper):</p>\n\n<ul>\n<li>if both are constant tonicity, the result should be constant.</li>\n<li>if both are monotonic, the result should be monotonic</li>\n<li>if both are antitonic, the result should be antitonic</li>\n<li>if one is constant and the other monotonic, the result should be monotonic</li>\n<li>if one is constant and the other antitonic, the result should be antitonic</li>\n<li>if one is monotonic and one antitonic, the result should be unknown.</li>\n<li>if either is unknown, the result is unknown.</li>\n</ul>\n\n<p>When two 'tonic functions' are composed, the resulting tonic function's tonicity might flip ('Qualifier Composition; Figure 6' in the paper):</p>\n\n<ul>\n<li>if both are constant tonicity, the result should be constant.</li>\n<li>if both are monotonic, the result should be monotonic</li>\n<li>if both are antitonic, the result should be monotonic</li>\n<li>if one is monotonic and one antitonic, the result should be antitonic.</li>\n<li>if either is unknown, the result is unknown.</li>\n</ul>\n\n<p>I have a problem to properly express this (the relationship between tonicities, and how 'tonic functions' will compose) in Haskell's types.\nMy latest attempt looks like this, using GADTs, Type Families, DataKinds and a slew of other type-level programming constructs:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, FlexibleInstances, MultiParamTypeClasses, AllowAmbiguousTypes, UndecidableInstances, KindSignatures, DataKinds, PolyKinds, TypeOperators, TypeFamilies #-}\nmodule Main2 where\n\nimport qualified Control.Category\nimport Control.Category (Category, (&gt;&gt;&gt;), (&lt;&lt;&lt;))\n\nimport qualified Control.Arrow\nimport Control.Arrow (Arrow, (***), first)\n\n\nmain :: IO ()\nmain =\n  putStrLn \"Hi!\"\n\ndata Tonic t a b where\n  Tonic :: Tonicity t =&gt; (a -&gt; b) -&gt; Tonic t a b\n  Tonic2 :: (TCR t1 t2) ~ t3 =&gt; Tonic t1 a b -&gt; Tonic t2 b c -&gt; Tonic t3 a c\n\ndata Monotonic = Monotonic\ndata Antitonic = Antitonic\nclass Tonicity t\n\ninstance Tonicity Monotonic\ninstance Tonicity Antitonic\n\ntype family TCR (t1 :: k) (t2 :: k) :: k where\n  TCR Monotonic Antitonic = Antitonic\n  TCR Antitonic Monotonic = Antitonic\n  TCR t t = Monotonic\n\n\n--- But now how to define instances for Control.Category and Control.Arrow?\n</code></pre>\n\n<p>I have the feeling I am greatly overcomplicating things. Another attempt I had introduced </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class (Tonicity a, Tonicity b) =&gt; TonicCompose a b where\n  type TonicComposeResult a b :: *\n</code></pre>\n\n<p>but it is not possible to use <code>TonicComposeResult</code> in the instance declaration of e.g. <code>Control.Category</code> (\"illegal type synonym family application in instance\"). </p>\n\n<hr>\n\n<p>What am I missing? How can this concept properly be expressed in type-safe code?</p>\n"}, {"tags": ["haskell", "types", "constructor"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1557092411, "post_id": 55996595, "comment_id": 98640291, "body": "One way out would be spinning off <code>YetAnotherConstructor</code> into a different type, which you would then use in both <code>SomeDataType</code> and <code>WantedDataType</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 9, "last_activity_date": 1557092989, "creation_date": 1557092989, "answer_id": 55996719, "question_id": 55996595, "link": "https://stackoverflow.com/questions/55996595/is-it-possible-to-have-a-data-type-that-has-just-one-constructor-of-another-data/55996719#55996719", "title": "Is it possible to have a data type that has just one constructor of another data type?", "body": "<p>This makes me think <code>YetAnotherConstructor</code> is actually \"supposed\" to be its own data type:</p>\n\n<pre><code>data YetAnotherData = YetAnotherConstructor Yadda Yadda Tittle\ndata SomeDataType   = Constructor Blah Blah Blah\n                    | OtherConstructor Blah Yadda\n                    | SomeYetAnotherConstructor {-!-}YetAnotherData\n                    -- ! will make this EXACTLY isomorphic to the original \n                    -- but is likely unnecessary \n                    | StillOneMoreConstructor Tittle Tattle Wish Wash\ndata WantedDataType = ConstructorName1 Double\n                    | ConstructorName2 {-!-}YetAnotherData\n</code></pre>\n\n<p>If it annoys you to say <code>SomeYetAnotherConstructor (YetAnotherConstructor _ _ _)</code> and <code>ConstructorName2 (YetAnotherData _ _ _)</code>, there's an extension for that (though I think you'll think it leads you back to square one):</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\npattern SomeYetAnother :: Yadda -&gt; Yadda -&gt; Tittle -&gt; SomeDataType\npattern SomeYetAnother x y z = SomeYetAnotherConstructor (YetAnotherConstructor x y z)\n{-# COMPLETE Constructor, OtherConstructor, SomeYetAnother, StillOneMoreConstructor #-}\n\npattern WantedYetAnother :: Yadda -&gt; Yadda -&gt; Tittle -&gt; WantedDataType\npattern WantedYetAnother x y z = ConstructorName2 (YetAnotherConstructor x y z)\n{-# COMPLETE ConstructorName1, WantedYetAnother #-}\n</code></pre>\n\n<p>This will make <code>SomeYetAnother</code> and <code>WantedYetAnother</code> act like data constructors (complete with coverage checking (<code>COMPLETE</code> pragmas), pattern matching, and construction). You can use them for constructing/matching on each type when you don't care about the fact that <code>YetAnotherData</code> is its own unit, and you can use the underlying <code>SomeYetAnotherConstructor</code> and <code>ConstructorName2</code> constructors if you want to treat the <code>YetAnotherData</code> as one unit. The latter may be useful for e.g.</p>\n\n<pre><code>someToWantedByYet :: SomeDataType -&gt; Maybe WantedDataType\nsomeToWantedByYet (SomeYetAnotherConstructor y) = Just $ ConstructorName2 y\nsomeToWantedByYet _ = Nothing\nwantedToSomeByYet :: WantedDataType -&gt; Maybe SomeDataType\nwantedToSomeByYet (ConstructorName2 y) = Just $ SomeYetAnotherConstructor y\nwantedToSomeByYet _ = Nothing\n</code></pre>\n"}], "owner": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557092989, "creation_date": 1557091838, "question_id": 55996595, "link": "https://stackoverflow.com/questions/55996595/is-it-possible-to-have-a-data-type-that-has-just-one-constructor-of-another-data", "title": "Is it possible to have a data type that has just one constructor of another data type?", "body": "<p>I have a (quite complex) data type:</p>\n\n<pre><code>data SomeDataType = Constructor Blah Blah Blah | OtherConstructor Blah Yadda | YetAnotherConstructor Yadda Yadda Tittle | StillOneMoreConstructor Tittle Tattle Wish Wash\n</code></pre>\n\n<p>Now I find myself wanting another data type\u2026 With two constructors. One would be identical to <code>YetAnotherConstructor</code> of <code>SomeDataType</code>; the other one would just store a <code>Double</code>. What are my options?</p>\n\n<pre><code>data WantedDataType = ConstructorName1 Double | ConstructorName2 SomeDataType\n</code></pre>\n\n<p>While this would work this would also allow stuff like <code>ConstructorName2 $ StillOneMoreConstructor tittle tattle wish wash</code> which makes no sense.</p>\n\n<pre><code>data WantedDataType = ConstructorName1 Double | ConstructorName2 Yadda Yadda Tittle\n</code></pre>\n\n<p>Again, this would work but it seems to me to be a violation of DRY and it might be tedious to convert stuff to and from <code>WantedDataType</code> and <code>SomeDataType</code>.</p>\n\n<pre><code>data WantedDataType = ConstructorName1 Double | YetAnotherConstructor Yadda Yadda Tittle\n</code></pre>\n\n<p>This is what I'd like most but unfortunately, Haskell doesn't seem to support this sort of polymorphism (a constructor can't belong simultaneously to two data types).</p>\n\n<p>What are my options? How should I tackle this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557086604, "post_id": 55995909, "comment_id": 98638926, "body": "The indentation looks a bit off in the second case."}, {"owner": {"reputation": 37, "user_id": 7290407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/114169179a309f4c3a55039c2e721b76?s=128&d=identicon&r=PG", "display_name": "SamTulster", "link": "https://stackoverflow.com/users/7290407/samtulster"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557086970, "post_id": 55995909, "comment_id": 98639042, "body": "Thanks! I corrected the indentation and it seems to be working! I didn&#39;t realize indentation matters so much here."}, {"owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "edited": false, "score": 1, "creation_date": 1557087467, "post_id": 55995909, "comment_id": 98639189, "body": "Yep, this is called layout.  If the first thing (aside from whitespace and comments) after <code>do</code> is <code>{</code>, then indentation doesn&#39;t matter, and you have to separate statements with <code>;</code> and end with <code>}</code>.  But otherwise, the column of that next thing sets your layout level.  Anything indented more than that is part of the same statement.  New statements are indented the same amount.  Indenting less than that ends the block.  So in your original code, the second line ended the <code>do</code> block, and this looked like you were applying <code>do first &lt;- (ints &lt;|&gt; floats)</code> as a function to some arguments."}], "owner": {"reputation": 37, "user_id": 7290407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/114169179a309f4c3a55039c2e721b76?s=128&d=identicon&r=PG", "display_name": "SamTulster", "link": "https://stackoverflow.com/users/7290407/samtulster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2203, "favorite_count": 0, "closed_date": 1557092674, "answer_count": 0, "score": 0, "last_activity_date": 1557087624, "creation_date": 1557086480, "last_edit_date": 1557087624, "question_id": 55995909, "link": "https://stackoverflow.com/questions/55995909/how-to-fix-unexpected-do-block-in-function-application-in-haskell", "closed_reason": "Duplicate", "title": "How to fix &quot;Unexpected do block in function application&quot; in Haskell?", "body": "<p>I'm trying to write a Haskell parser to parse my own language.</p>\n\n<p>This function handles Less Than (&lt;), and I encounter <code>Unexpected do block in function application: do first &lt;- (ints &lt;|&gt; floats)</code> when testing my code.</p>\n\n<p><code>parseNotEq</code> works fine, but <code>parseLT</code> would not compile. I think the problem may be <code>ints &lt;|&gt; floats</code>, but I don't know how to fix it.</p>\n\n<p>Can anyone help me? </p>\n\n<pre><code>parseNotEq :: Parser Ast\nparseNotEq = do first &lt;- expr\n                token $ literal \"/=\"\n                second &lt;- expr\n                return $ NotEq first second\n\nparseLT :: Parser Ast\nparseLT = do first &lt;- (ints &lt;|&gt; floats)\n            token $ literal \"&lt;\"\n            second &lt;- (ints &lt;|&gt; floats)\n            return $ LessThan first second\n</code></pre>\n"}, {"tags": ["haskell", "generics", "lava"], "answers": [{"comments": [{"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "edited": false, "score": 0, "creation_date": 1557089490, "post_id": 55995648, "comment_id": 98639672, "body": "<code>:t halfAdd</code> yields  <code>halfAdd :: (Signal Bool, Signal Bool) -&gt; (Signal Bool, Signal Bool)</code>.  I asked this question also on #haskell irc and got some insight there. User dmjio extracted it into a gist: <a href=\"https://gist.github.com/dmjio/36a394ff36e382b8f9da53ec1687acb2\" rel=\"nofollow noreferrer\">gist.github.com/dmjio/36a394ff36e382b8f9da53ec1687acb2</a>"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1557084774, "creation_date": 1557084774, "answer_id": 55995648, "question_id": 55995244, "link": "https://stackoverflow.com/questions/55995244/haskell-type-constructor-in-generic-function/55995648#55995648", "title": "Haskell type constructor in generic function", "body": "<blockquote>\n  <p>Can someone tell me what function (var \"inp\") in writeVhdlresolves to? </p>\n</blockquote>\n\n<p>It depends on what you pass to <code>writeVhdl</code> 2nd argument, namely <code>circ</code>. The type of its argument (if I read that correctly) is exactly the type that gets returned by <code>var \"foo\"</code>.</p>\n\n<p>You can observe expression types in <code>ghci</code> by typing <code>:t some expression</code>. Try loading your code into GHCi session and play with <code>:t</code> command.</p>\n"}], "owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 55995648, "answer_count": 1, "score": 0, "last_activity_date": 1557084774, "creation_date": 1557081913, "question_id": 55995244, "link": "https://stackoverflow.com/questions/55995244/haskell-type-constructor-in-generic-function", "title": "Haskell type constructor in generic function", "body": "<p>I'm digging around in the Haskell Lava HDL system and am stuck in\nunderstanding \n<a href=\"http://hackage.haskell.org/package/chalmers-lava2000-1.6.1/docs/src/Lava-Vhdl.html#writeVhdl\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/chalmers-lava2000-1.6.1/docs/src/Lava-Vhdl.html#writeVhdl</a></p>\n\n<p>Can someone tell me what function <code>(var \"inp\")</code> in <code>writeVhdl</code>resolves to? </p>\n\n<p>Function <code>var</code> is not defined yet and seems to be generated with some <strong>meta-programming</strong> that is not familiar to me in <code>class Constructive</code> in   <a href=\"http://hackage.haskell.org/package/chalmers-lava2000-1.6.1/docs/src/Lava-Generic.html#line-253\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/chalmers-lava2000-1.6.1/docs/src/Lava-Generic.html#line-253</a> .</p>\n\n<p>Function <code>var</code> seems to act like a <strong>constructor</strong>. How is this mechanism working?</p>\n\n<p>The input to <code>writeVhdl</code> is a circuit description like</p>\n\n<pre><code>halfAdd (a, b) = (sum, arry)\n  where\n    sum = xor2 (a, b)\n    arry = and2 (a, b)\n</code></pre>\n"}, {"tags": ["string", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557076840, "post_id": 55994502, "comment_id": 98636451, "body": "In Haskell a <code>String</code> is just a list of <code>Char</code>s, indeed <code>type String = [Char]</code>. <code>String</code> is just an &quot;alias&quot; for such list. So all functions you define on lists work on strings, given the elements of that list are <code>Char</code>s."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1557082746, "post_id": 55994502, "comment_id": 98638001, "body": "Regarding your last sentence, you can definitely call your functions one after another, by composing them as in e.g. <code>doEverything arg = finishJob (workMore (work (startJob arg)))</code>."}, {"owner": {"reputation": 969, "user_id": 326242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cde28dc376b1403cf4de6cbebc80e5?s=128&d=identicon&r=PG", "display_name": "Andrew Koster", "link": "https://stackoverflow.com/users/326242/andrew-koster"}, "edited": false, "score": 0, "creation_date": 1593449669, "post_id": 55994502, "comment_id": 110779586, "body": "Working with strings is brutally difficult in Haskell. It&#39;s the only &quot;high-level&quot; language where doing a regex replacement just isn&#39;t possible without bringing in a badly-documented third-party library, and I have to fall back to some C-style iterative filtering."}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "edited": false, "score": 1, "creation_date": 1557150763, "post_id": 55997362, "comment_id": 98658784, "body": "Thanks a lot. Your answer really helped me. But I still have one question about your code. Is it possible to modify the replace function in your code in such a way to replace multiple character pairs at same time (by not calling the functions one after another but at the same time). For example i want to replace all &#39;a&#39; with &#39;z&#39;, all &#39;A&#39; with &#39;Z&#39;, all &#39;z&#39; with &#39;a&#39; and all &#39;Z&#39; with &#39;A&#39; in one function call at the same time."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "reply_to_user": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "edited": false, "score": 0, "creation_date": 1557152472, "post_id": 55997362, "comment_id": 98659677, "body": "No. That requires a completely different function."}], "tags": [], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "is_accepted": true, "score": 2, "last_activity_date": 1557101094, "last_edit_date": 1557101094, "creation_date": 1557100162, "answer_id": 55997362, "question_id": 55994502, "link": "https://stackoverflow.com/questions/55994502/string-manipulation-haskell/55997362#55997362", "title": "String manipulation haskell", "body": "<p>Yes, absolutely! That's one of the beautiful things about Haskell.<br>\nYou can treat <code>String</code>s as <code>[Char]</code>. In fact, that's what they are!<br>\nIn GHCi, type <code>:i String</code> - you get <code>type String = [Char]</code>.<br>\nYou can easily compose functions. There's an operator for that, <code>(.)</code>.\nSo <code>(f . g) x</code> is <code>f (g x)</code>.</p>\n\n<p>I would improve the code in a few key ways.<br>\nFirstly, make the <code>replaceBlank</code> function more general, so it takes a condition and a replacement function.<br>\nSecondly, compose all the functions in a \"main\" function, as you call it.<br>\n<strong>But do not name the main function <code>main</code>! That name is reserved for the IO action of a program.</strong></p>\n\n<p>It's also important not to think of the final function as \"calling\" the other functions.<br>\nThat is imperative terminology, here, we are <em>applying</em> the function(s).</p>\n\n<p>Also, why does your <code>dropInvalids</code> contain a <code>toUpperStr</code>? You never specified the string to be all uppercase in the end.</p>\n\n<p>Also also, be sure to declare the type of your functions.</p>\n\n<p>In this case, the following would be the correct code:</p>\n\n<pre><code>import Data.Char\n\ndropInvalids :: [Char] -&gt; [Char]\ndropInvalids = filter (\\x -&gt; isLetter x || isSpace x || isDigit x)\n    -- isLetter exists\n\nreplace' :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; [a] -&gt; [a]\nreplace' _ _ [] = []\nreplace' f g (x:xs) =\n            if f x\n            then g x : replace' f g xs\n            else x : replace' f g xs\n    -- To replace one value with another, use replace (== a) (const b).\n\nreplaceWith :: (a -&gt; Bool) -&gt; a -&gt; [a] -&gt; [a]\nreplaceWith f b = replace' f (const b)\n\nreplace :: Eq a =&gt; a -&gt; a -&gt; [a] -&gt; [a]\nreplace a b = replace' (== a) (const b)\n  -- The Eq makes sure you can check for equality.\n\nmanipulateString :: [Char] -&gt; [Char]\nmanipulateString = replace 'A' 'Z' . replace 'a' 'z' . replaceWith isDigit ' ' . replace ' ' '_' . dropInvalids\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1559, "favorite_count": 0, "accepted_answer_id": 55997362, "answer_count": 1, "score": 1, "last_activity_date": 1573427903, "creation_date": 1557076772, "last_edit_date": 1557118223, "question_id": 55994502, "link": "https://stackoverflow.com/questions/55994502/string-manipulation-haskell", "title": "String manipulation haskell", "body": "<p>In the following exercise i want to manipulate a random string input by using functions.</p>\n\n<p>Step 1: I want to remove all characters which are not digits, letters or spaces</p>\n\n<p>Step 2: I want to replace all spaces with '_'</p>\n\n<p>Step 3: I want to convert all numbers to spaces</p>\n\n<p>Step 4: I want to replace all 'a' with 'z' and all 'A' with 'Z'</p>\n\n<p>For lists i already used the filter function and i am wondering if this function can also be used for string inputs. I am not quite sure how to approach this exercise.</p>\n\n<p>Update: I found an approach to solve step 1 and step 3 but i am not quite sure how to put the different functions together in a function which includes every step. Is it possible to call the different functions one after another in the right order in some kind of main function?</p>\n\n<pre><code>    import Data.Char \n\n    toUpperStr xs = map toUpper xs     -- function to convert lower to upper\n\n    dropInvalids xs = (filter (\\x -&gt; isUpper x || isSpace x || isDigit x)) $ \n    toUpperStr xs           \n\n    replaceBlank [] = []               -- function to replace \" \" with \"_\"\n    replaceBlank (x:xs) =  \n             if x == ' ' \n             then '_' : replaceBlank xs \n             else x : replaceBlank xs   \n</code></pre>\n"}, {"tags": ["haskell", "strictness", "unordered-containers"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1557086641, "post_id": 55994488, "comment_id": 98638938, "body": "Those thunks seem to be for internal nodes of the map. Looking at the documentation for the strictness properties (version 0.2.9.0 <a href=\"http://hackage.haskell.org/package/unordered-containers-0.2.9.0/docs/Data-HashMap-Strict.html#g:1\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/unordered-containers-0.2.9.0/doc&zwnj;&#8203;s/&hellip;</a>) it only says that <i>keys</i> and <i>values</i> are reduced to WHNF, but says nothing about the internal nodes."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1557105982, "post_id": 55994488, "comment_id": 98642504, "body": "If there are really thunks anywhere in a <code>HashMap</code> constructed using only strict operations, I&#39;d call that a bug; for performance, we don&#39;t want that. What version of <code>unordered-containers</code> are you using? Please open a ticket."}, {"owner": {"reputation": 117, "user_id": 952804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/32ac383940690c4fd4339d4641161896?s=128&d=identicon&r=PG", "display_name": "MantasG", "link": "https://stackoverflow.com/users/952804/mantasg"}, "edited": false, "score": 1, "creation_date": 1557160645, "post_id": 55994488, "comment_id": 98663666, "body": "I&#39;ve tested this with tip of <code>unorder-containers</code> master branch (0.2.10.0). I have created a simple project to demonstrate this behaviour: <a href=\"https://github.com/mantasg/hashmap-test\" rel=\"nofollow noreferrer\">github.com/mantasg/hashmap-test</a>. I also created a ticket: <a href=\"https://github.com/tibbe/unordered-containers/issues/232\" rel=\"nofollow noreferrer\">github.com/tibbe/unordered-containers/issues/232</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557163279, "post_id": 55994488, "comment_id": 98664798, "body": "I believe the problem is with the helper function <code>two</code> in <code>Data.HashMap.Base</code>, which isn&#39;t strict in its key arguments. But I&#39;m still surprised, because I&#39;d expect inlining to reveal that those arguments have been forced."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557164242, "post_id": 55994488, "comment_id": 98665171, "body": "Ah.... I guess probably because <code>two</code> is defined as a (recursive) <code>go</code> function...."}, {"owner": {"reputation": 117, "user_id": 952804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/32ac383940690c4fd4339d4641161896?s=128&d=identicon&r=PG", "display_name": "MantasG", "link": "https://stackoverflow.com/users/952804/mantasg"}, "edited": false, "score": 0, "creation_date": 1557164464, "post_id": 55994488, "comment_id": 98665250, "body": "You seem to be right. Adding bangs to the arguments of <code>go</code> inside <code>two</code> fixes it."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1557175796, "last_edit_date": 1557175796, "creation_date": 1557167165, "answer_id": 56010527, "question_id": 55994488, "link": "https://stackoverflow.com/questions/55994488/why-is-hashmap-not-in-normal-form-upon-series-of-inserts/56010527#56010527", "title": "Why is HashMap not in normal form upon series of inserts?", "body": "<p>When inserting a new, non-colliding key into a <code>Leaf</code> node, <code>insert</code> uses a helper function called <code>two</code> to generate a two-element map. The <code>two</code> function is lazy in the values of the keys, which leads to GHC creating thunks to create the two new <code>Leaf</code> nodes. This whole thing is pretty silly, because the keys are actually certain to be in WHNF by then. But (presumably because of a recursive <code>go</code> function) GHC doesn't realize that. The problem should be fixed in the next version of <code>unordered-containers</code>.</p>\n"}], "owner": {"reputation": 117, "user_id": 952804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/32ac383940690c4fd4339d4641161896?s=128&d=identicon&r=PG", "display_name": "MantasG", "link": "https://stackoverflow.com/users/952804/mantasg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 56010527, "answer_count": 1, "score": 5, "last_activity_date": 1557175796, "creation_date": 1557076699, "last_edit_date": 1557077155, "question_id": 55994488, "link": "https://stackoverflow.com/questions/55994488/why-is-hashmap-not-in-normal-form-upon-series-of-inserts", "title": "Why is HashMap not in normal form upon series of inserts?", "body": "<p>I've been trying to ensure the strictness of an in-memory model of a Haskell program using ghc-heap-view package and the utils it provides when I noticed that my <code>HashMap</code>s don't seem to be in NF upon a series on inserts. I tried printing Heap tree and indeed it shows some thunks. I then tried another way of inserting elements (using <code>union</code> and <code>singleton</code>) and this time it comes out strict.</p>\n\n<p>Could somebody please explain why is this so and advise if there's anything I can do to make <code>insert</code> behave the same way as the other method?</p>\n\n<p>Here's my test code:</p>\n\n<pre><code>module Main where\n\nimport           Control.Exception           (evaluate)\nimport           Data.Foldable\nimport           Data.HashMap.Strict         (HashMap)\nimport qualified Data.HashMap.Strict         as HM\nimport           GHC.HeapView\n\ntest1 :: HashMap Int Int\ntest1 = foldl' (\\m v -&gt; HM.insert v v m) HM.empty [0..5]\n\ntest2 :: HashMap Int Int\ntest2 = foldl' (\\m v -&gt; HM.union (HM.singleton v v) m) HM.empty [0..5]\n\nmain :: IO ()\nmain = do\n  putStrLn \"HeapTree for test1\"\n  t1 &lt;- evaluate test1\n  buildHeapTree 10 (asBox t1) &gt;&gt;= print . ppHeapTree\n\n  putStrLn \"HeapTree for test2\"\n  t2 &lt;- evaluate test2\n  buildHeapTree 10 (asBox t2) &gt;&gt;= print . ppHeapTree\n</code></pre>\n\n<p>And here's the output:</p>\n\n<pre><code>HeapTree for test1\n\"BitmapIndexed ([ (_thunk (I# 0) (I# 0) 0), (_thunk (I# 1) (I# 1) 1), (Leaf (I# 2) (I# 2) 2), (Leaf (I# 3) (I# 3) 3), (Leaf (I# 4) (I# 4) 4), (Leaf (I# 5) (I# 5) 5) ]) 63\"\nHeapTree for test2\n\"BitmapIndexed ([ (Leaf (I# 0) (I# 0) 0), (Leaf (I# 1) (I# 1) 1), (Leaf (I# 2) (I# 2) 2), (Leaf (I# 3) (I# 3) 3), (Leaf (I# 4) (I# 4) 4), (Leaf (I# 5) (I# 5) 5) ]) 63\"\n(0.02 secs, 1,067,672 bytes)\n</code></pre>\n"}, {"tags": ["haskell", "algebra", "type-variables"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 7, "creation_date": 1557070683, "post_id": 55993573, "comment_id": 98634884, "body": "Common mistake, search for <code>ScopedTypeVariables</code>."}, {"owner": {"reputation": 237, "user_id": 6560657, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S6x_pA3n_FM/AAAAAAAAAAI/AAAAAAAAABQ/N4i4v-fjVH0/photo.jpg?sz=128", "display_name": "fantasie", "link": "https://stackoverflow.com/users/6560657/fantasie"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1557071686, "post_id": 55993573, "comment_id": 98635169, "body": "@arrowd Thanks! That works for me."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1557081016, "creation_date": 1557081016, "answer_id": 55995112, "question_id": 55993573, "link": "https://stackoverflow.com/questions/55993573/why-can-t-haskell-deduce-this-type/55995112#55995112", "title": "Why can\u2019t Haskell deduce this type", "body": "<p><em>From arrowd's comment:</em></p>\n\n<p>The code is fine, but requires the <code>ScopedTypeVariables</code> extension, which makes the type variable <code>a</code> in <code>fzero :: a</code> refer to the previously introduced <code>a</code>.</p>\n"}], "owner": {"reputation": 237, "user_id": 6560657, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S6x_pA3n_FM/AAAAAAAAAAI/AAAAAAAAABQ/N4i4v-fjVH0/photo.jpg?sz=128", "display_name": "fantasie", "link": "https://stackoverflow.com/users/6560657/fantasie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 55995112, "answer_count": 1, "score": 1, "last_activity_date": 1557082975, "creation_date": 1557070181, "last_edit_date": 1557082975, "question_id": 55993573, "link": "https://stackoverflow.com/questions/55993573/why-can-t-haskell-deduce-this-type", "title": "Why can\u2019t Haskell deduce this type", "body": "<p>I have been trying to writing a program to implement polynomials on arbitrary field, a mathematical structure. I chose Haskell as the programming language, and I used the <code>GADTs</code> language extension. However, I don\u2019t understand why GHCi can\u2019t deduce the constraints of <code>a</code>.</p>\n\n<p>The context:</p>\n\n<pre><code>-- irreducible.hs\n\n{-# LANGUAGE GADTs #-}\n\ninfixl 6 .+\ninfixl 7 .*\n\nclass Ring a where\n  (.+) :: a -&gt; a -&gt; a\n  (.*) :: a -&gt; a -&gt; a\n  fneg :: a -&gt; a\n  fzero :: a\n  funit :: a\n\nclass (Ring a) =&gt; Field a where\n  finv :: a -&gt; a\n\ndata Polynomial a where \n  Polynomial :: (Field a) =&gt; [a] -&gt; Char -&gt; Polynomial a\n\ninstance (Show a) =&gt; Show (Polynomial a) where\n  show (Polynomial (a0:ar) x)\n    = show a0\n      ++ concatMap (\\(a, k) -&gt; \"+\" ++ show a ++ x:'^':show k) (zip ar [0..])\n  show (Polynomial [] _) = show (fzero::a)\n</code></pre>\n\n<p>Explanation: A ring is something with addition and multiplication defined, where addition forms an (actually abelian) group, and multiplication forms a monoid. A field is a ring with the inverse of multiplication defined. The polynomials on a field is represented by a list of coefficients and a character. The character, for example <code>'x'</code>, indicates this polynomial is about the unknown variable <code>x</code>. For the zero polynomial, which is written as <code>Polynomial [] 'x'</code>, I want it shows the zero element of the underlying field.</p>\n\n<p>After running on GHCi, I got this:</p>\n\n<pre><code>irreducible.hs:59:28: error:\n    \u2022 Could not deduce (Show a0) arising from a use of \u2018show\u2019\n      from the context: Show a\n        bound by the instance declaration at irreducible.hs:55:10-40\n      or from: Field a\n        bound by a pattern with constructor:\n                   Polynomial :: forall a. Field a =&gt; [a] -&gt; Char -&gt; Polynomial a,\n                 in an equation for \u2018show\u2019\n        at irreducible.hs:59:9-23\n      The type variable \u2018a0\u2019 is ambiguous\n      These potential instances exist:\n        instance (Show a, Show b) =&gt; Show (Either a b)\n          -- Defined in \u2018Data.Either\u2019\n        instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n        instance Show Integer -- Defined in \u2018GHC.Show\u2019\n        ...plus 25 others\n        ...plus 87 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression: show (fzero :: a)\n      In an equation for \u2018show\u2019:\n          show (Polynomial [] _) = show (fzero :: a)\n      In the instance declaration for \u2018Show (Polynomial a)\u2019\n   |\n59 |   show (Polynomial [] _) = show (fzero::a)\n   |                            ^^^^^^^^^^^^^^^\n\nirreducible.hs:59:34: error:\n    \u2022 Could not deduce (Ring a1) arising from a use of \u2018fzero\u2019\n      from the context: Show a\n        bound by the instance declaration at irreducible.hs:55:10-40\n      or from: Field a\n        bound by a pattern with constructor:\n                   Polynomial :: forall a. Field a =&gt; [a] -&gt; Char -&gt; Polynomial a,\n                 in an equation for \u2018show\u2019\n        at irreducible.hs:59:9-23\n      Possible fix:\n        add (Ring a1) to the context of\n          an expression type signature:\n            forall a1. a1\n    \u2022 In the first argument of \u2018show\u2019, namely \u2018(fzero :: a)\u2019\n      In the expression: show (fzero :: a)\n      In an equation for \u2018show\u2019:\n          show (Polynomial [] _) = show (fzero :: a)\n   |\n59 |   show (Polynomial [] _) = show (fzero::a)\n   |            \n</code></pre>\n\n<p>Now let\u2019s focus on the questionable part:</p>\n\n<pre><code>instance (Show a) =&gt; Show (Polynomial a) where\n  show (Polynomial (a0:ar) x) = show a0 ++ [...]\n  show (Polynomial [] _) = show (fzero::a)\n</code></pre>\n\n<p>In my opinion, <code>Polynomial a</code> guarantees <code>a</code> is an instance of <code>Field</code>, which implies <code>a</code> is an instance of <code>Ring</code>. So calling <code>fzero::a</code>, just like <code>42::Int</code>, should be reasonable. Besides, I already wrote <code>Show a</code> as a constraint, and the constructor of <code>Polynomial a</code> has the shape <code>Polynomial [a] Char</code>, so it should also know the type of <code>a0</code> is an instance of <code>Show</code>.</p>\n\n<p>Apparently, the interpreter thinks differently. Where did I make a mistake?</p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "category-theory", "monoids"], "comments": [{"owner": {"reputation": 34814, "user_id": 5249621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lLtZV.jpg?s=128&g=1", "display_name": "Dmytro Mitin", "link": "https://stackoverflow.com/users/5249621/dmytro-mitin"}, "edited": false, "score": 3, "creation_date": 1557068705, "post_id": 55993254, "comment_id": 98634319, "body": "<a href=\"https://en.wikipedia.org/wiki/Monoid#Monoid_homomorphisms\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Monoid#Monoid_homomorphisms</a>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 83, "last_activity_date": 1557096266, "last_edit_date": 1557096266, "creation_date": 1557069072, "answer_id": 55993423, "question_id": 55993254, "link": "https://stackoverflow.com/questions/55993254/what-is-monoid-homomorphism-exactly/55993423#55993423", "title": "What is monoid homomorphism exactly?", "body": "<blockquote>\n  <p>Does he mean, the datatype String and Int are monoid.</p>\n</blockquote>\n\n<p><strong>No</strong>, neither <code>String</code> nor <code>Int</code> are monoids. A monoid is a 3-tuple <em>(S, &oplus;, e)</em> where &oplus; is a binary operator <em>&oplus; : S&times;S &rightarrow; S</em>, such that for all elements <em>a, b, c&in;S</em> it holds that <em>(a&oplus;b)&oplus;c=a&oplus;(b&oplus;c)</em>, and <em>e&in;S</em> is an \"identity element\" such that <em>a&oplus;e=e&oplus;a=a</em>. <code>String</code> and <code>Int</code> are types, so basically sets of values, but not 3-tuples.</p>\n\n<p>The article says:</p>\n\n<blockquote>\n  <p>Let's take the <strong><code>String</code> concatenation</strong> and <strong><code>Int</code> addition</strong> as\n  example <em>monoids</em> that have a relationship.</p>\n</blockquote>\n\n<p>So the author clearly also mentions the binary operators (<code>(++)</code> in case of <code>String</code>, and <code>(+)</code> in case of <code>Int</code>). The identities (empty string in case of <code>String</code> and <code>0</code> in case of <code>Int</code>) are left implicit; leaving the identities as an exercise for the reader is common in informal English discourse.</p>\n\n<p>Now given that we have two monoid structures <em>(M, &oplus;, e<sub>m</sub>)</em> and <em>(N, &otimes;, e<sub>n</sub>)</em>, a function <em>f : M &rightarrow; N</em> (like <code>length</code>) is then called a <a href=\"https://en.wikipedia.org/wiki/Monoid#Monoid_homomorphisms\" rel=\"noreferrer\"><em>monoid homomorphism</em> [wiki]</a> given it holds that <em>f(m<sub>1</sub>&oplus;m<sub>2</sub>)=f(m<sub>1</sub>)&otimes;f(m<sub>2</sub>)</em> for all elements <em>m<sub>1</sub>, m<sub>2</sub>&in;M</em> and that mapping also preserves the identity element: <em>f(e<sub>m</sub>)=e<sub>n</sub></em>.</p>\n\n<p>For example <code>length :: String -&gt; Int</code> is a monoid homomorphism, since we can consider the monoids <em>(<code>String</code>, <code>(++)</code>, <code>\"\"</code>)</em> and <em>(<code>Int</code>, <code>(+)</code>, <code>0</code>)</em>. It holds that:</p>\n\n<ol>\n<li><code>length (s1 ++ s2) == length s1 + length s2</code> (for all <code>String</code>s <code>s1</code> and <code>s2</code>); and</li>\n<li><code>length \"\" == 0</code>.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1557148079, "post_id": 55993551, "comment_id": 98657239, "body": "1. Seems to be missing &quot;preserving structure &quot; part (that not all string-&gt;int functions are homomorphisms). 2. &quot;length\u2026 forms a yet another monoid&quot; With what set and ops?"}], "tags": [], "owner": {"reputation": 8670, "user_id": 5599298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EKZDL.jpg?s=128&g=1", "display_name": "slouc", "link": "https://stackoverflow.com/users/5599298/slouc"}, "is_accepted": false, "score": 23, "last_activity_date": 1557167666, "last_edit_date": 1557167666, "creation_date": 1557069962, "answer_id": 55993551, "question_id": 55993254, "link": "https://stackoverflow.com/questions/55993254/what-is-monoid-homomorphism-exactly/55993551#55993551", "title": "What is monoid homomorphism exactly?", "body": "<p>Datatype cannot be a monoid on its own. For a monoid, you need a data type <code>T</code> and two more things:</p>\n\n<ul>\n<li>an <strong>associative binary operation</strong>, let's call it <code>|+|</code>, that takes two elements of type <code>T</code> and produces an element of type <code>T</code></li>\n<li>an <strong>identity element</strong> of type <code>T</code>, let's call it <code>i</code>, such that for every element <code>t</code> of type <code>T</code> the following holds: <code>t |+| i = i |+| t = t</code></li>\n</ul>\n\n<p>Here are some examples of a monoid:</p>\n\n<ul>\n<li>set of integers with operation = addition and identity = zero</li>\n<li>set of integers with operation = multiplication and identity = one</li>\n<li>set of lists with operation = appending and identity = empty list</li>\n<li>set of strings with operation = concatenation and identity = empty string</li>\n</ul>\n\n<p><strong>Monoid homomorphism</strong></p>\n\n<p>String concatenation monoid can be transformed into integer addition monoid by applying <code>.length</code> to all its elements. Both those sets form a monoid. By the way, remember that we can't just say \"set of integers forms a monoid\"; we have to pick an associative operation and a corresponding identity element. If we take e.g. division as operation, we break the first rule (instead of producing an element of type integer, we might produce an element of type float/double).</p>\n\n<p>Method <code>length</code> allows us to go from a monoid (string concatenation) to another monoid (integer addition). If such operation also preserves monoid structure, it is considered to be a <em>monoid homomorphism</em>. </p>\n\n<p>Preserving the structure means:</p>\n\n<pre><code>length(t1 |+| t2) = length(t1) |+| length(t2)\n\nand\n\nlength(i) = i'\n</code></pre>\n\n<p>where <code>t1</code> and <code>t2</code> represent elements of the \"source\" monoid, <code>i</code> is the identity of the \"source\" monoid, and <code>i'</code> is the identity of the \"destination\" monoid. You can try it out yourself and see that <code>length</code> indeed is a structure-preserving operation on a string concatenation monoid, while e.g. <code>indexOf(\"a\")</code> isn't.</p>\n\n<p><strong>Monoid isomorphism</strong></p>\n\n<p>As demonstrated, <code>length</code> maps all strings to their corresponding integers and forms a monoid with addition as operation and zero as identity. But we can't go back - for every string, we can figure out its length, but given a length we can't reconstruct the \"original\" string. If we could, then the operation of \"going forward\" combined with the operation of \"going back\" would form a <em>monoid isomorphism</em>. </p>\n\n<p>Isomorphism means being able to go back and forth without any loss of information. For example, as stated earlier, list forms a monoid under appending as operation and empty list as identity element. We could go from \"list under appending\" monoid to \"vector under appending\" monoid and back without any loss of information, which means that operations <code>.toVector</code> and <code>.toList</code> together form an isomorphism. Another example of an isomorphism, which Runar mentioned in his text, is <code>String</code> \u27f7 <code>List[Char]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "is_accepted": false, "score": 4, "last_activity_date": 1611004013, "last_edit_date": 1611004013, "creation_date": 1557141556, "answer_id": 56004148, "question_id": 55993254, "link": "https://stackoverflow.com/questions/55993254/what-is-monoid-homomorphism-exactly/56004148#56004148", "title": "What is monoid homomorphism exactly?", "body": "<p>Colloquially a homomorphism is a function that preserves structure. In the example of the <code>length</code> function the preserved structure is the sum of the lengths of two strings being equal to the length of the concatenation of the same strings. Since both strings and integers can be regarded as monoids (when equipped with an identity and an associative binary operation obeying the monoid laws) <code>length</code> is called a monoid homomorphism.</p>\n<p>See also the other answers for a more technical explanation.</p>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 5751675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f22435bc60c7740d07dfeaa8af5e6e?s=128&d=identicon&r=PG&f=1", "display_name": "Rupam Bhattacharjee", "link": "https://stackoverflow.com/users/5751675/rupam-bhattacharjee"}, "is_accepted": false, "score": 0, "last_activity_date": 1606307458, "creation_date": 1606307458, "answer_id": 65004754, "question_id": 55993254, "link": "https://stackoverflow.com/questions/55993254/what-is-monoid-homomorphism-exactly/65004754#65004754", "title": "What is monoid homomorphism exactly?", "body": "<pre><code>trait Monoid[T] {\ndef op(a: T, b: T): T\ndef zero: T\n}\n\nval strMonoid = new Monoid[String] {\n  def op(a: String, b: String): String = a ++ b\n  def zero: String = &quot;&quot;\n}\n\nval lcMonoid = new Monoid[List[Char]] {\n  def op(a: List[Char], b: List[Char]): List[Char] = a ::: b\n  def zero = List.empty[Char]\n}\n</code></pre>\n<h1>homomorphism via function f</h1>\n<pre><code>f{M.op(x,y)} = N.op(f(x),g(y))\n\nfor example, using toList available on String\n\n//in REPL\nscala&gt; strMonoid.op(&quot;abc&quot;,&quot;def&quot;).toList == lcMonoid.op(&quot;abc&quot;.toList,&quot;def&quot;.toList)\nres4: Boolean = true\n</code></pre>\n<h1>isomorphism via functions f and g</h1>\n<p>given bi-directional homomorphism between monoids M and N,</p>\n<pre><code>f{M.op(x,y)} = N.op(f(x),f(y))\ng{N.op(x,y)} = M.op(g(x),g(y))\n</code></pre>\n<p>And if both (f andThen g) and (g andThen f) are identify functions, then monoids M and N are isomorphic via f and g</p>\n<pre><code>g{f{M.op(x,y)}} = g{N.op(f(x),f(y))} = M.op(g(f(x)),g(f(y))) = M.op(x,y)\n</code></pre>\n<p>for example, using <code>toList</code> available on <code>String</code> and <code>toString</code> available on <code>List[Char]</code> (where <code>toList andThen toString</code> and <code>toString andThen toList</code> are identity functions)</p>\n<pre><code>scala&gt; ( strMonoid.op(&quot;abc&quot;,&quot;def&quot;).toList ).toString == ( lcMonoid.op(&quot;abc&quot;.toList,&quot;def&quot;.toList) ).toString\nres7: Boolean = true \n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3402, "favorite_count": 10, "accepted_answer_id": 55993423, "answer_count": 4, "score": 67, "last_activity_date": 1611004013, "creation_date": 1557068007, "last_edit_date": 1557101160, "question_id": 55993254, "link": "https://stackoverflow.com/questions/55993254/what-is-monoid-homomorphism-exactly", "title": "What is monoid homomorphism exactly?", "body": "<p>I've read about monoid homomorphism from <a href=\"http://blog.higher-order.com/blog/2014/03/19/monoid-morphisms-products-coproducts/\" rel=\"noreferrer\">Monoid Morphisms, Products, and Coproducts</a> and could not understand 100%.  </p>\n\n<p>The author says (emphasis original):</p>\n\n<blockquote>\n  <p>The <code>length</code> function maps from <code>String</code> to <code>Int</code> <em>while preserving the\n  monoid structure</em>. Such a function, that maps from one monoid to\n  another in such a preserving way, is called a <em>monoid homomorphism</em>. In\n  general, for monoids <code>M</code> and <code>N</code>, a homomorphism <code>f: M =&gt; N</code>, and all values\n  <code>x:M</code>, <code>y:M</code>, the following equations hold:  </p>\n\n<pre><code>f(x |+| y) == (f(x) |+| f(y))\n\nf(mzero[M]) == mzero[N]\n</code></pre>\n</blockquote>\n\n<p>Does he mean that, since the datatypes <code>String</code> and <code>Int</code> are monoids, and the function <code>length</code> maps <code>String =&gt; Int</code> preserving the monoid structure (<code>Int</code> is a monoid), it is called monoid homomorphism, right?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1557066076, "post_id": 55992807, "comment_id": 98633533, "body": "What do you mean &quot;you have to keep the function definition the same&quot;? Also be sure to compile with -Wall. You can do <code>:set -Wall</code> in ghci and reload to get warnings"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1557066172, "post_id": 55992807, "comment_id": 98633557, "body": "I can&#39;t change <code>filterFirst :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code>"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557069923, "post_id": 55992807, "comment_id": 98634671, "body": "@Francis That is not the function definition, that&#39;s the function&#39;s type."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557090007, "post_id": 55992807, "comment_id": 98639798, "body": "yes, it is possible. you only need to replace one instance of a four letter word with another, five letter word. this assumes that your test results are actually wrong in one case."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557142581, "post_id": 55992807, "comment_id": 98654324, "body": "have you been able to find it? would you like a further hint, or an answer?"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1557090874, "post_id": 55994341, "comment_id": 98639988, "body": "they mean <code>f p (splitAt 1 -&gt; first (filter (not . p)) -&gt; uncurry (++) -&gt; x) = x</code>, coded with <code>foldr</code>, <code>map</code> or <code>filter</code> <i>only</i>. this is my best guess anyway, they&#39;ve asked about this problem before, several times recently, every time in a very confusing manner."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 0, "last_activity_date": 1557075560, "creation_date": 1557075560, "answer_id": 55994341, "question_id": 55992807, "link": "https://stackoverflow.com/questions/55992807/using-higher-order-functions-to-assess-boolen-function-and-return-tail/55994341#55994341", "title": "Using higher order functions to assess Boolen function and return tail", "body": "<p>We should be able to state our problem clearly without leaning on input/output examples. You don't have a clear problem statement, so let's start there. Here's how I would state what I think you want to do:</p>\n\n<blockquote>\n  <p><code>filterFirst</code> takes a predicate and a list. If <em>any</em> elements of the list match the predicate return the tail of the list, otherwise return the input list. When the input list is empty, return the empty list.</p>\n</blockquote>\n\n<p>This isn't a great name for the function we've just described, but we'll leave it.</p>\n\n<p>Here's a framework to get you started:</p>\n\n<pre><code>filterFirst p [] = [] -- \"When the input list is empty, return the empty list.\"\nfilterFirst p l@(_:xs) = \n  if all p l\n    then xs -- \"return the tail of the list\"\n    else l  -- \"...otherwise return the input list\"\n\nall :: -- type left as an exercise\nall p l =\n  -- try using `foldr` with `&amp;&amp;` here. \n  -- Then if you have time see if you can get it to return `False` on an infinite list.\n  -- if you get stuck, try using `filter`, `map`, `==` and `length` to implement this.\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 55994341, "answer_count": 1, "score": -2, "last_activity_date": 1557075560, "creation_date": 1557065299, "question_id": 55992807, "link": "https://stackoverflow.com/questions/55992807/using-higher-order-functions-to-assess-boolen-function-and-return-tail", "title": "Using higher order functions to assess Boolen function and return tail", "body": "<p>I'm trying to create a <code>foldr</code> function that evaluates a <code>Bool</code> function and, if it returns <code>True</code>, the return is <code>tail xs</code>. I intend to only remove the FIRST element only if the argument function returns <code>True</code>. Is there a way to change <code>foldr</code> (I can also use <code>map</code> and/or <code>filter</code>) to return <code>tail</code> in the instance of a <code>True</code>?</p>\n\n<p>Here are two conditional functions I've been using:</p>\n\n<pre><code>isNegative = (&lt;0)\nisPositive = (&gt;0)\n</code></pre>\n\n<p>This is a recursive function that checks to find if there's any <code>True</code> statement within the function but it removes the element where the <code>True</code> occurs instead of just returning <code>tail xs</code>:</p>\n\n<pre><code> filterFirst :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n filterFirst x xs = foldr condition (\\x -&gt; []) xs True\n    where\n    condition y ys True\n       | x y = y : ys True\n       | otherwise = ys False\n    condition y ys False = y : ys False\n</code></pre>\n\n<p>Would it be possible to use this but alter it to only remove the FIRST element? Or do I need an entirely different approach?</p>\n\n<p><code>filterFirst</code> should return:</p>\n\n<pre><code>filterFirst isNegative [1,2,(-3)]\n[2,-3]\n\nfilterFirst isPositive [1,2,(-3)]\n[2,-3]\n</code></pre>\n\n<p>Actually returns:</p>\n\n<pre><code>filterFirst isPositive [1,2,(-3)]\n[1,2]\n</code></pre>\n\n<p>because it's filtering the first instance of <code>True</code> when I only want to remove the FIRST element in the entire list.</p>\n\n<p>I HAVE to keep the function definition the same and I can use library functions but ONLY map, filter, and foldr higher order functions to solve this. I've been working on this forever and I feel just as lost as when I started.</p>\n"}, {"tags": ["list", "haskell", "testing"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557063934, "post_id": 55992535, "comment_id": 98632935, "body": "You realize that your <code>length xs</code> in your function definition is one less than the length of the list, since you here calculate the length of the tail, right?"}, {"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 2, "creation_date": 1557064463, "post_id": 55992535, "comment_id": 98633089, "body": "I unsure why <code>Just x</code> is being returned from <code>a=1</code> instead of from <code>a=0</code>? Or was this an attempt at implementing 1-based indexing... :P"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 0, "creation_date": 1557064631, "post_id": 55992535, "comment_id": 98633139, "body": "@TrebledJ: that is my idea yes. That is not <i>per se</i> a problem. It would definitely make it a bit more challenging."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1557064809, "post_id": 55992535, "comment_id": 98633188, "body": "Why does your <code>nth a (x:xs)</code> part have 4 different conditions/branches? There should be only 2."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557064819, "post_id": 55992535, "comment_id": 98633191, "body": "I would simply remove the <code>length</code> check entirely. The recursive case should mean all attempts to access a too-large index will eventually come to taking the index of an empty list, which you&#39;ve already covered. And computing the length at each recursive step will make this function exceptionally slow."}, {"owner": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1557066573, "post_id": 55992535, "comment_id": 98633681, "body": "@melpomene I wanted to check if the index I&#39;m getting is negative so I don&#39;t have to check anything and I would get the nothing immediately."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1557066642, "post_id": 55992535, "comment_id": 98633709, "body": "@Dania If anything, that should happen at an outer layer. There&#39;s no need to check for negative indices at every single step of the algorithm."}, {"owner": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557067703, "post_id": 55992535, "comment_id": 98634062, "body": "@WillemVanOnsem yes, you are probably right I shouldn&#39;t use the length function I wanted to see if the index is just bigger than the length of the List but I can do it by using the recursive function."}, {"owner": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1557068063, "post_id": 55992535, "comment_id": 98634161, "body": "@melpomene yes, you are right it will slow the run time. I&#39;ve changed it."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "edited": false, "score": 0, "creation_date": 1557067497, "post_id": 55992741, "comment_id": 98633990, "body": "Actually, I am not allowed to change the specification part because it is a part of the question. I&#39;ve changed the code the way you wrote it, however, I am getting the same failure with big indices. it should actually work because if I try it without using the test it gives me &quot;Nothing&quot; if I try for example nth 1000 [1,2,3]"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "edited": false, "score": 0, "creation_date": 1557067805, "post_id": 55992741, "comment_id": 98634091, "body": "@Dania: you realize that since this is one-based, the bounds of the test should be sligly different?"}, {"owner": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "edited": false, "score": 0, "creation_date": 1557069047, "post_id": 55992741, "comment_id": 98634401, "body": "yes, in my test they are testing the zero-based. I changed my code now to this: <code>nth :: Integer -&gt; [a] -&gt; Maybe a nth 0 (x:_) = Nothing  nth 1 (x:_) = Just x nth a (_:xs) |a &lt; 0 = Nothing  |otherwise = nth (a-1) xs  nth _ [] = Nothing</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "edited": false, "score": 0, "creation_date": 1557069432, "post_id": 55992741, "comment_id": 98634539, "body": "@Dania: but that is insufficient to make it zero-based."}, {"owner": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "edited": false, "score": 0, "creation_date": 1557070893, "post_id": 55992741, "comment_id": 98634951, "body": "it works now <code>nth :: Integer -&gt; [a] -&gt; Maybe a nth 0 (x:_) = Just x nth a (_:xs) |a &lt; 0 = Nothing |otherwise = nth (a-1) xs nth _ [] = Nothing</code>  thanks"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557081760, "post_id": 55992741, "comment_id": 98637729, "body": "@chi: somehow after rereading, I think &quot;phase&quot; here does not make much sense either. Modified it to &quot;in each iteration&quot;. Thanks."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1557081712, "last_edit_date": 1557081712, "creation_date": 1557064882, "answer_id": 55992741, "question_id": 55992535, "link": "https://stackoverflow.com/questions/55992535/problem-with-larg-index-when-testing-my-code/55992741#55992741", "title": "Problem with larg index when testing my code", "body": "<p>There are some problems here with your function. The reason why the first case (behaving like <code>(!!)</code>) fails, is because <code>(!!) :: Int -&gt; [a] -&gt; a</code> uses a zero-based index, whereas your function seems to work with a one-based index. That means that you will thus need to decrement the index you give to the function.</p>\n\n<p>Furthermore in your function you make a a comparison between <code>n</code> and <code>fromIntegral (length xs)</code>. Since <code>xs</code> is the <em>tail</em> of the list, the check is not correct since it will, in certain circumstances, never consider the last element. Indeed:</p>\n\n<pre><code>Prelude&gt; nth 2 [0, 2]\nNothing\n</code></pre>\n\n<p>Furthermore it is typically <em>not</em> a good idea to use <code>length</code> in <em>each</em> iteration. <code>length</code> runs in <em>O(n)</em>, that means that your algorithm now runs in <em>O(n<sup>2</sup>)</em>, so as the list grows, this easily will start taking considerable time.</p>\n\n<p>A shorter and more elegant way to fix this is probably:</p>\n\n<pre><code>nth :: Integral i => i -&gt; [a] -&gt; Maybe a\nnth 1 (x:_) = Just x\nnth i (_:xs) | i &lt; 1 = Nothing\n             | otherwise = nth (i-1) xs\nnth _ [] = Nothing</code></pre>\n\n<p>Here we thus have four cases: in case the index is <code>1</code> and the list is non-empty, we return the head of the list, wrapped in a <code>Just</code>. If the index is not one, and it is less than one, then the index is too small, and hence we return <code>Nothing</code> (this case is strictly speaking not necessary). If <code>i</code> is greater than one, then we call <code>nth (i-1) xs</code>. Finally if we have reached the end of the list (or the list was empty in the first place), we return <code>Nothing</code> as well).</p>\n\n<p>Now in order to test this, we thus need to rewrite these three cases:</p>\n\n<pre><code>describe &quot;nth&quot; $ do\n    it &quot;for valid indexes it behaves like (!!)&quot; $\n        property $ \\n xs -&gt; n &lt;= 0 || n &gt; length (xs :: [Integer]) || Lists.nth n xs == Just (xs !! (n-1))\n    it &quot;for negative indexes it returns Nothing&quot; $\n        property $ \\n xs -&gt; n &gt; 0 || Lists.nth n (xs :: [Integer]) == Nothing\n    it &quot;for too large indexes it returns Nothing&quot; $\n        property $ \\n xs -&gt; n &lt;= length xs || Lists.nth n (xs :: [Integer]) == Nothing</code></pre>\n\n<p>The first one thus excludes <code>n &lt;= 0</code> (negative or zero indices) as well as <code>n &gt; length xs</code> and thus checks if the value is <code>Just (xs !! (n-1))</code>.</p>\n\n<p>In the second case excludes values greater than zero, and checks if all remaining indices map on <code>Nothing</code>.</p>\n\n<p>Finally the last property checks that for values that are higher than <code>length xs</code>, we obtain nothing as well.</p>\n\n<p>Note that here <code>nth</code> uses one-based indexing. I leave it as an exercise to make it zero-based.</p>\n"}], "owner": {"reputation": 11, "user_id": 3160364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7Idx.jpg?s=128&g=1", "display_name": "Dania", "link": "https://stackoverflow.com/users/3160364/dania"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 55992741, "answer_count": 1, "score": 1, "last_activity_date": 1557081712, "creation_date": 1557063561, "last_edit_date": 1557064700, "question_id": 55992535, "link": "https://stackoverflow.com/questions/55992535/problem-with-larg-index-when-testing-my-code", "title": "Problem with larg index when testing my code", "body": "<p>I am trying to learn Haskell, I want to write a recursive function and do not use any library functions. The function </p>\n\n<pre><code>nth ::Integer -&gt; [a ] -&gt; Maybe a\n</code></pre>\n\n<p>takes an index n and a list of elements and returns the n-th element of the list (if the index is valid) or Nothing if\nthe index is invalid.</p>\n\n<p>My code: </p>\n\n<pre><code>nth :: Integer -&gt; [a] -&gt; Maybe a\nnth a [] = Nothing\nnth a (x:xs) |a == 1 = Just x \n             |fromIntegral (length xs) &lt; a = Nothing \n             |a==0 = Nothing\n             | otherwise = nth (a-1) xs  \n</code></pre>\n\n<p>I want to do this test to my code: </p>\n\n<pre><code>spec = do\n\n    describe \"nth\" $ do\n        it \"for valid indexes it behaves like (!!)\" $\n            property $ \\n xs -&gt; n &lt; 0 || (fromInteger n) &gt;= length (xs::[Integer]) || Lists.nth n xs == Just (xs!!(fromInteger n))\n        it \"for negative indexes it returns Nothing\" $\n            property $ \\n xs -&gt; n &gt;= 0 || Lists.nth n (xs::[Integer]) == Nothing\n        it \"for too large indexes it returns Nothing\" $\n            property $ \\n xs -&gt; (fromInteger n) &lt; length xs || Lists.nth n (xs::[Integer]) == Nothing\n</code></pre>\n\n<p>but every time I am doing the test I'm getting an error </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>  for valid indexes it behaves like (!!) FAILED [1]\n    for negative indexes it returns Nothing\n      +++ OK, passed 100 tests.\n    for too large indexes it returns Nothing FAILED [2]\n\n1) Lists.nth for valid indexes it behaves like (!!)\n       Falsified (after 5 tests and 5 shrinks):\n         0\n         [0]\n\n  To rerun use: --match \"/Lists/nth/for valid indexes it behaves like (!!)/\"\n\n  ./ListsSpec.hs:23:9: \n  2) Lists.nth for too large indexes it returns Nothing\n       Falsified (after 38 tests):\n         1\n         [0]\n</code></pre>\n"}, {"tags": ["haskell", "monads", "functor", "applicative"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557053935, "post_id": 55991151, "comment_id": 98630320, "body": "I&#39;m struggling to understand what you&#39;re really asking about. Even if the definition of <code>funct</code> isn&#39;t relevant, can you at least edit the question so that you tell us its type?"}, {"owner": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557054008, "post_id": 55991151, "comment_id": 98630337, "body": "My question was basically just looking for understanding, but i added specific questions below.. I will add a definition for funct though. and if you can think of anyway I can add additional clarity please let me know."}, {"owner": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557054316, "post_id": 55991151, "comment_id": 98630395, "body": "@RobinZigmond I&#39;ve updated the question per your suggestion. Is this better or is there any other way I could help clarify what I&#39;m asking?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557055538, "post_id": 55991151, "comment_id": 98630653, "body": "I&#39;m afraid that doesn&#39;t really clear anything up. We need to see some actual code you&#39;ve tried to run, together with a description of what you expected, and what the actual result was instead."}, {"owner": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557055688, "post_id": 55991151, "comment_id": 98630693, "body": "@RobinZigmond Alright, give me a minute ill share all the bits of the code I used to draw the diagram above in the first place."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557055744, "post_id": 55991151, "comment_id": 98630701, "body": "However, I would say that the &quot;container&quot; metaphor isn&#39;t very helpful for the function instance. Also see <a href=\"https://stackoverflow.com/questions/54961639/applicative-functor-evaluation-is-not-clear-to-me/54962496\">this previous question</a> and its answers (full disclosure, I wrote one of them, that I think is a good explanation of functions-as-Applicatives) for some further discussion which might be helpful."}, {"owner": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557056431, "post_id": 55991151, "comment_id": 98630854, "body": "@RobinZigmond I added extra details. Please let me know if that helps you, If not let me know what I can clarify for you. Thanks for your time."}], "answers": [{"comments": [{"owner": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "edited": false, "score": 0, "creation_date": 1557056641, "post_id": 55991427, "comment_id": 98630914, "body": "I&#39;m a bit confused by your example, I couldnt get past the first part. because it wouldnt run given how function i defined, it takes 3 arguments not 2. So <code>funct x (x+3)</code> wouldnt work, it would just produce another function that takes one argument. Is that a mistake on your part or was that intentional?"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "reply_to_user": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "edited": false, "score": 1, "creation_date": 1557059303, "post_id": 55991427, "comment_id": 98631646, "body": "Not a mistake, that&#39;s just what it is.  If <code>funct</code> has type <code>Num a =&gt; a -&gt; a -&gt; a -&gt; a</code> then <code>funct &lt;*&gt; (+3)</code> has type <code>Num a =&gt; a -&gt; a -&gt; a</code>.  It&#39;s not a problem, you just have a function.  If you want to see a concrete result from it try calculating out something like <code>(funct &lt;*&gt; (+3)) 4 5</code> (or type that into ghci)."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 2, "last_activity_date": 1557055584, "creation_date": 1557055584, "answer_id": 55991427, "question_id": 55991151, "link": "https://stackoverflow.com/questions/55991151/understanding-functions-as-applicatives-in-haskell/55991427#55991427", "title": "Understanding Functions as Applicatives in Haskell", "body": "<p>You can usually understand what a function is doing in Haskell if you\nsubstitute its definition into some examples.  You already have some\nexamples and the definition you need is <code>&lt;*&gt;</code> for <code>(-&gt;) a</code> which is\nthis:</p>\n\n<pre><code>(f &lt;*&gt; g) x = f x (g x)\n</code></pre>\n\n<p>I don't know if you'll find any better intuition than just using the\ndefinition a few times.</p>\n\n<p>On your first example we get this:</p>\n\n<pre><code>  (funct &lt;*&gt; (+3)) x\n= funct x ((+3) x)\n= funct x (x+3)\n</code></pre>\n\n<p>(Since there was nothing I could do with <code>funct &lt;*&gt; (+3)</code> without a\nfurther parameter I just applied it to <code>x</code> - do this any time you need\nto.)</p>\n\n<p>And the rest:</p>\n\n<pre><code>  (funct &lt;*&gt; (+3) &lt;*&gt; (+5)) x\n= (funct x (x+3) &lt;*&gt; (+5)) x\n= funct x (x+3) x ((+5) x)\n= funct x (x+3) x (x+5)\n\n  (funct &lt;*&gt; (+)) x\n= funct x ((+) x)\n= funct x (x+)\n</code></pre>\n\n<p>Notice you can't use the same <code>funct</code> with both of these - in\nthe first it can take four numbers, but in the second it needs to take\na number and a function.</p>\n\n<pre><code>  ((\\a b -&gt; 3) &lt;*&gt; (+)) x\n= (\\a b -&gt; 3) x (x+)\n= (\\b -&gt; 3) (x+)\n= 3\n\n  (((\\a b -&gt; a + b) &lt;*&gt; (+)) x\n= (\\a b -&gt; a + b) x (x+)\n= x + (x+)\n= type error\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "edited": false, "score": 0, "creation_date": 1557056701, "post_id": 55991479, "comment_id": 98630924, "body": "One issue, which is my fault not yours, is the part of the book I&#39;m stuck on is before the part where they explain what a Monad is in haskell. For that reason alone I am struggling to understand your answer. Perhaps that is where the book got things wrong, not explaining Monads first?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "edited": false, "score": 0, "creation_date": 1557057002, "post_id": 55991479, "comment_id": 98631005, "body": "@JeffreyPhillipsFreeman no, a monad is just a slightly stronger applicative. I used the word because it&#39;s shorter to write; you can replace every \u201cmonad\u201d with \u201capplicative\u201d in my answer. But actually I would recommend that you leave aside the function-applicative completely until you are more firm with Haskell in general, including with monads."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "edited": false, "score": 1, "creation_date": 1557057006, "post_id": 55991479, "comment_id": 98631009, "body": "In fact, it is my personal opinion that it was a mistake to include the <code>Functor ((-&gt;)a)</code> etc. instances in the libraries at all \u2013 sure they can be useful, but it&#39;s really confusing because we&#39;re all the time dealing with function arrows in a non-monadic way, so it becomes hard to see where the monad actually is that you&#39;re dealing with. There&#39;s a more explicit name for the function monad which avoids this problem: <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Reader.html#t:Reader\" rel=\"nofollow noreferrer\">Reader</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557065635, "post_id": 55991479, "comment_id": 98633423, "body": "Directly <i>using</i> the <code>Functor</code> instance may be confusing, but its <i>definition</i> is necessary for the <code>Applicative</code> instance; IMO <code>f &lt;$&gt; g &lt;*&gt; h == \\x -&gt; f (g x) (h x)</code> is a useful idiom to learn, even without understanding exactly why it works."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557067312, "post_id": 55991479, "comment_id": 98633917, "body": "@chepner well, I would favour writing that as <code>f &lt;&lt;&lt; g&amp;&amp;&amp;h</code> (though that would require <code>f</code> to be uncurried). What I don&#39;t get is why people have an aversion against anything from <code>Control.Arrow</code> (though functions are an instance of category/arrow in an extremely obvious way!), but don&#39;t mind the <code>Functor</code>/<code>Applicative</code>/<code>Monad (a-&gt;)</code> instances, which cause lots of confusion not only for beginners."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557069078, "post_id": 55991479, "comment_id": 98634415, "body": "<code>f &lt;&lt;&lt; g &amp;&amp;&amp; h</code> doesn&#39;t scale as well for higher-arity <code>f</code>, though (unless I&#39;m missing something); <code>f &lt;$&gt; g1 &lt;*&gt; g2 &lt;*&gt; g3 &lt;*&gt; ...</code> extends to however many arguments <code>f</code> expects."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1557077800, "post_id": 55991479, "comment_id": 98636719, "body": "Yeah, but that&#39;s already quite an involved case where you might anyways want to use <code>Reader</code> to make it clear what&#39;s going on. (FWIW, the <code>&amp;&amp;&amp;</code> style <i>could</i> scale nicely for this application, but that would require <code>(a,b,c)</code> to be syntactic sugar for <code>(a,(b,c))</code> and tuples to be the norm for multiple-argument functions \u2013 that&#39;s quite far from where we&#39;re at in Haskell!)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1557056650, "last_edit_date": 1557056650, "creation_date": 1557055979, "answer_id": 55991479, "question_id": 55991151, "link": "https://stackoverflow.com/questions/55991151/understanding-functions-as-applicatives-in-haskell/55991479#55991479", "title": "Understanding Functions as Applicatives in Haskell", "body": "<p>You <em>can</em> view the function monad as a container. Note that it's really a separate monad for every argument-type, so we can pick a simple example: <code>Bool</code>.</p>\n\n<pre><code>type M a = Bool -&gt; a\n</code></pre>\n\n<p>This is equivalent to</p>\n\n<pre><code>data M' a = M' { resultForFalse :: a\n               , resultForTrue :: a  }\n</code></pre>\n\n<p>and the instances could be defined</p>\n\n<pre><code>instance Functor M where            instance Functor M' where\n  fmap f (M g) = M g'                 fmap f (M' gFalse gTrue) = M g'False g'True\n   where g' False = f $ g False        where g'False = f $ gFalse\n         g' True  = f $ g True               g'True  = f $ gTrue\n</code></pre>\n\n<p>and similar for <code>Applicative</code> and <code>Monad</code>.</p>\n\n<p>Of course this exhaustive case-listing definition would become totally impractical for argument-types with more than a few possible values, but it's always the same principle.</p>\n\n<p>But the important thing to take away is that the instances are <em>always specific for one particular argument</em>. So, <code>Bool -&gt; Int</code> and <code>Bool -&gt; String</code> belong to the same monad, but <code>Int -&gt; Int</code> and <code>Char -&gt; Int</code> do not. <code>Int -&gt; Double -&gt; Int</code> does belong to the same monad as <code>Int -&gt; Int</code>, but only if you consider <code>Double -&gt; Int</code> as an opaque result type which has nothing to do with the <code>Int-&gt;</code> monad.</p>\n\n<p>So, if you're considering something like <code>a -&gt; a -&gt; a -&gt; a</code> then this is not really a question about applicatives/monads but about Haskell in general. And therefore, you shouldn't expect that the monad=container picture gets you anywhere. To understand <code>a -&gt; a -&gt; a -&gt; a</code> as a member of a monad, you need to pick out which of the arrows you're talking about; in this case it's only the leftmost one, i.e. you have the value <code>M (a-&gt;a-&gt;a)</code> in the <code>type M=(a-&gt;)</code> monad. The arrows between <code>a-&gt;a-&gt;a</code> do not participate in the monadic action in any way; if they do in your code, then it means you're actually mixing multiple monads together. Before you do that, you should understand how a single monad works, so stick to examples with only a single function arrow.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1557076122, "last_edit_date": 1557076122, "creation_date": 1557074553, "answer_id": 55994188, "question_id": 55991151, "link": "https://stackoverflow.com/questions/55991151/understanding-functions-as-applicatives-in-haskell/55994188#55994188", "title": "Understanding Functions as Applicatives in Haskell", "body": "<p><a href=\"https://stackoverflow.com/a/55991427/2751851\">As pointed out by David Fletcher</a>, <code>(&lt;*&gt;)</code> for functions is: </p>\n\n<pre><code>(g &lt;*&gt; f) x = g x (f x)\n</code></pre>\n\n<p>There are two intuitive pictures of <code>(&lt;*&gt;)</code> for functions which, though not quite able to stop it from being dizzying, might help with keeping your balance as you go through code that uses it. In the next few paragraphs, I will use <code>(+) &lt;*&gt; negate</code> as a running example, so you might want to try it out a few times in GHCi before continuing. </p>\n\n<p>The first picture is <code>(&lt;*&gt;)</code> as applying the <em>result of a function</em> to the result of another function:</p>\n\n<pre><code>g &lt;*&gt; f = \\x -&gt; (g x) (f x)\n</code></pre>\n\n<p>For instance, <code>(+) &lt;*&gt; negate</code> passes an argument to both <code>(+)</code> and <code>negate</code>, giving out a function and a number respectively, and then applies one to the other...</p>\n\n<pre><code>(+) &lt;*&gt; negate = \\x -&gt; (x +) (negate x)\n</code></pre>\n\n<p>... which explains why its result is always <code>0</code>.</p>\n\n<p>The second picture is <code>(&lt;*&gt;)</code> as a variation on function composition in which the argument is also used to determine what the second function to be composed will be</p>\n\n<pre><code>g &lt;*&gt; f = \\x -&gt; (g x . f) x\n</code></pre>\n\n<p>From that point of view, <code>(+) &lt;*&gt; negate</code> negates the argument and then adds the argument to the result:</p>\n\n<pre><code>(+) &lt;*&gt; negate = \\x -&gt; ((x +) . negate) x\n</code></pre>\n\n<p>If you have a <code>funct :: Num a =&gt; a -&gt; a -&gt; a -&gt; a</code>, <code>funct &lt;*&gt; (+3)</code> works because:</p>\n\n<ul>\n<li><p>In terms of the first picture: <code>(+ 3) x</code> is a number, and so you can apply <code>funct x</code> to it, ending up with <code>funct x ((+ 3) x)</code>, a function that takes two arguments.</p></li>\n<li><p>In terms of the second picture:  <code>funct x</code> is a function (of type <code>Num a =&gt; a -&gt; a -&gt; a</code>) that takes a number, and so you can compose it with <code>(+ 3) :: Num a =&gt; a -&gt; a</code>.</p></li>\n</ul>\n\n<p>On the other hand, with <code>funct &lt;*&gt; (+)</code>, we have:</p>\n\n<ul>\n<li><p>In terms of the first picture: <code>(+) x</code> is not a number, but a <code>Num a =&gt; a -&gt; a</code> function, and so you can't apply <code>funct x</code> to it.</p></li>\n<li><p>In terms of the second picture: the result type of <code>(+)</code>, when seen as a function of one argument (<code>(+) :: Num a =&gt; a -&gt; (a -&gt; a)</code>), is <code>Num a =&gt; a -&gt; a</code> (and not <code>Num a =&gt; a</code>), and so you can't compose it with <code>funct x</code> (which expects a <code>Num a =&gt; a</code>).</p></li>\n</ul>\n\n<p>For an arbitrary example of something that does work with <code>(+)</code> as the second argument to <code>(&lt;*&gt;)</code>, consider the function <code>iterate</code>:</p>\n\n<pre><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]\n</code></pre>\n\n<p>Given a function and an initial value, <code>iterate</code> generates an infinite list by repeatedly applying the function. If we flip the arguments to <code>iterate</code>, we end up with:</p>\n\n<pre><code>flip iterate :: a -&gt; (a -&gt; a) -&gt; [a]\n</code></pre>\n\n<p>Given the problem with <code>funct &lt;*&gt; (+)</code> was that <code>funct x</code> wouldn't take a <code>Num a =&gt; a -&gt; a</code> function, this seems to have a suitable type. And sure enough:</p>\n\n<pre><code>GHCi&gt; take 10 $ (flip iterate &lt;*&gt; (+)) 1\n[1,2,3,4,5,6,7,8,9,10]\n</code></pre>\n\n<p>(On a tangential note, you can leave out the <code>flip</code> if you use <code>(=&lt;&lt;)</code> instead of <code>(&lt;*&gt;)</code>. <a href=\"https://stackoverflow.com/a/40136614/2751851\">That, however, is a different story</a>.)</p>\n\n<hr>\n\n<p>As a final aside, neither of the two intuitive pictures lends itself particularly well to the common use case of applicative style expressions such as:</p>\n\n<pre><code>(+) &lt;$&gt; (^2) &lt;*&gt; (^3)\n</code></pre>\n\n<p>To use the intuitive pictures there, you'd have to account for how <code>(&lt;$&gt;)</code> for functions is <code>(.)</code>, which murks things quite a bit. It is easier to just see the entire thing as lifted application instead: in this example, we are adding up the results of (^2)  and (^3). The equivalent spelling as...</p>\n\n<pre><code>liftA2 (+) (^2) (^3)\n</code></pre>\n\n<p>... somewhat emphasises that. Personally, though, I feel one possible disadvantage of writing <code>liftA2</code> in this setting is that, if you apply the resulting function right in the same expression, you end up with something like...</p>\n\n<pre><code>liftA2 (+) (^2) (^3) 5\n</code></pre>\n\n<p>... and seeing <code>liftA2</code> followed by three arguments tends to make my brain tilt.</p>\n"}], "owner": {"reputation": 815, "user_id": 5028702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/kzikN.jpg?s=128&g=1", "display_name": "Jeffrey Phillips Freeman", "link": "https://stackoverflow.com/users/5028702/jeffrey-phillips-freeman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "accepted_answer_id": 55991427, "answer_count": 3, "score": 0, "last_activity_date": 1557076573, "creation_date": 1557053121, "last_edit_date": 1557076573, "question_id": 55991151, "link": "https://stackoverflow.com/questions/55991151/understanding-functions-as-applicatives-in-haskell", "title": "Understanding Functions as Applicatives in Haskell", "body": "<p>I've recently been trying to learn Haskell with the \"Learn You a Haskell\" and have been really struggling with understanding functions as Applicatives. I should point out that using other types of Applicatives like Lists and Maybe I seem to understand well enough to use them effectively.</p>\n\n<p>As I tend to do when trying to understand something is I tried to play with as many examples as I could and once the pattern emerges things tend to make sense. As such I tried a few examples. Attached are my notes of several examples I tried along with a diagram I drew to try to visualize what was happening.</p>\n\n<p><a href=\"https://i.stack.imgur.com/D01Se.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/D01Se.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>The definition of <code>funct</code> doesnt seem to relevant to the outcome but in my tests I used a function with the following definition:</p>\n\n<pre><code>funct :: (Num a) =&gt; a -&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>At the bottom I tried to show the same thing as in the diagrams just using normal math notation.</p>\n\n<p>So all of this is well and good, I can understand the pattern when I have some function of an arbitrary number of arguments (though needs 2 or more) and apply it to a function that takes one argument. However intuitively this pattern doesn't make that much sense to me.</p>\n\n<p><strong>So here are the specific questions I have:</strong></p>\n\n<p>What is the intuitive way to understand the pattern I'm seeing, particularly if i view an Applicative as a container (which is how I view <code>Maybe</code> and lists)?</p>\n\n<p>What is the pattern when the function on the right of the <code>&lt;*&gt;</code> takes more than a single argument (I've mostly been using the function <code>(+3)</code> or <code>(+5)</code> on the right)?</p>\n\n<p>why is the function on the right hand side of the &lt;*> applied to the second argument of the function on the left side. For example if the function on the right hand side were <code>f()</code> then <code>funct(a,b,c)</code> turns into <code>funct (x, f(x), c)</code>?</p>\n\n<p>Why does it work for <code>funct &lt;*&gt; (+3)</code> but not for <code>funct &lt;*&gt; (+)</code>? Moreover it DOES work for <code>(\\ a b -&gt; 3) &lt;*&gt; (+)</code></p>\n\n<p>Any explanation that gives me a better intuitive understanding for this concept would be greatly appreciated. I read other explanations such as in the book I mentioned that explains functions in terms of <code>((-&gt;)r)</code> or similar patterns but even though I know how to use the <code>-&gt;</code>) operator when defining a function I'm not sure i understand it in this context.</p>\n\n<p><strong>Extra Details:</strong></p>\n\n<p>I want to also include the actual code I used to help me form the diagrams above.</p>\n\n<p>First I defined funct as I showed above with:</p>\n\n<pre><code>funct :: (Num a) =&gt; a -&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Throughout the process i refined funct in various ways to understand what was going on.</p>\n\n<p>Next I tried this code:</p>\n\n<pre><code>funct a b c = 6 \nfunctMod =  funct &lt;*&gt; (+3)\nfunctMod 2 3\n</code></pre>\n\n<p>Unsuprisingly the result was 6</p>\n\n<p>So now I tried just returning each argument directly like this:</p>\n\n<pre><code>funct a b c = a\nfunctMod =  funct &lt;*&gt; (+3)\nfunctMod 2 3 -- returns 2\n\nfunct a b c = b\nfunctMod =  funct &lt;*&gt; (+3)\nfunctMod 2 3 -- returns 5\n\nfunct a b c = c\nfunctMod =  funct &lt;*&gt; (+3)\nfunctMod 2 3 -- returns 3\n</code></pre>\n\n<p>From this I was able to confirm the second diagram is what was taking place. I repeated this patterns to observe the third diagram as well (which is the same patterns extended on top a second time).</p>\n"}, {"tags": ["haskell", "parallel-processing", "ghc"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1557059787, "post_id": 55990934, "comment_id": 98631782, "body": "&quot;I am trying to achieve parallelism with as little libraries as possible (therefore no Strategies, no Par) and small level of abstraction as for Haskell.&quot; I don&#39;t think this is a terrifically useful goal, but if you&#39;re sticking to it, I suggest you copy the definition of <code>Eval</code> and the code for <code>parEval</code> out of <code>Control.Parallel.Strategies</code> (you&#39;ll have to copy <code>rpar</code> too) and build your abstractions on that; it&#39;s a better-behaved parallelism primitive than <code>par</code>."}, {"owner": {"reputation": 1409, "user_id": 7518695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dT38T.jpg?s=128&g=1", "display_name": "GrayCat", "link": "https://stackoverflow.com/users/7518695/graycat"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557083407, "post_id": 55990934, "comment_id": 98638157, "body": "@dfeuer I am well aware of that it would be better idea to use Stategies, well ... however. By the way when you mention it - do you know some references to places where I can learn more about differences in internal implementation of Stategies and <code>par</code> primitives ?"}], "owner": {"reputation": 1409, "user_id": 7518695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dT38T.jpg?s=128&g=1", "display_name": "GrayCat", "link": "https://stackoverflow.com/users/7518695/graycat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 201, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557051423, "creation_date": 1557051423, "question_id": 55990934, "link": "https://stackoverflow.com/questions/55990934/haskell-parallel-map-with-par-and-pseq", "title": "Haskell parallel map with `par` and `pseq`", "body": "<p>I am doing some experiments with parallelism in Haskell. Part of it is inspecting differences between Strategies and ordinary <code>par</code> and <code>pseq</code> combinators.</p>\n\n<p>I created a function like this :</p>\n\n<pre><code>parMap :: NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]\nparMap _ [] = []\nparMap f (a:as) =\n  let v = f a\n      vs = parMap f as\n  in rnf v `par` vs `pseq` v : vs\n</code></pre>\n\n<p>I am trying to achieve parallelism with as little libraries as possible (therefore no Strategies, no Par) and small level of abstraction as for Haskell. </p>\n\n<p>With this function I am trying to perform matrix-matrix multiplication with one of those two functions:</p>\n\n<pre><code>matmultListPar :: (Num a, NFData a) =&gt; [[a]] -&gt; [[a]] -&gt; [[a]]\nmatmultListPar a b = parMap multiplyRowByEachColumn a\n  where multiplyRowByEachColumn r = map (\\c -&gt; sum . zipWith (*) r $ c) $ b'\n        b' = transpose b\n\nmatmultListParChunks :: (Num a, NFData a) =&gt; Int -&gt; [[a]] -&gt; [[a]] -&gt; [[a]]\nmatmultListParChunks size a b\n  = let\n        chunks = toChunks size a\n        b' = transpose b\n    in concat $ parMap (flip matmultList $ b) chunks\n</code></pre>\n\n<p><code>matmultList</code> is defined as follows:</p>\n\n<pre><code>matmultList :: (Num a) =&gt; [[a]] -&gt; [[a]] -&gt; [[a]]\nmatmultList a b = fmap multiplyRowByEachColumn a\n  where multiplyRowByEachColumn r = fmap (\\c -&gt; sum $ zipWith (*) r c) $ b'\n        b' = transpose b\n</code></pre>\n\n<p>And <code>toChunks</code> :</p>\n\n<pre><code>toChunks :: Int -&gt; [a] -&gt; [[a]]\ntoChunks _ [] = []\ntoChunks size list\n  = let (i, f) = splitAt size list\n    in i : (toChunks size f)\n</code></pre>\n\n<p>Just for clarity - matrix is stored row-major.</p>\n\n<p>My problem and hence questions are:</p>\n\n<ol>\n<li><p>While applying Strategy <code>parList rdeepseq</code> to sheer <code>matmultList</code> I get almost two times speedup on two cores. With my <code>parMap</code> I get little to none speedup.</p></li>\n<li><p>Inspecting spark statistics with <code>-s</code> switch for RTS I can see that most of sparks are GC'd for <code>parMap</code> (while converted for Strategy).</p></li>\n<li><p>As you can guess no parallel speedup is achieved by my <code>parMap</code> (measured with <code>criterion</code> benchmarks) while it is by Strategy</p></li>\n</ol>\n\n<p>I noticed while inspecting Haskell libraries code that <code>par</code> combinator uses function <code>par#</code> for sprking while Strategies use something like <code>spark#</code> (I am not able to find it anymore so I might be wrong).</p>\n\n<p>I need <code>rnf</code> in <code>parMap</code> as <code>a</code> might be <code>[Double]</code> so sparking to WHNF is not enough (I did experiment with <code>force</code> in various places as well).</p>\n\n<p><strong>Is the lack of speedup caused by my wrong implementation, too fine-grained computations (GC'd sparks) or differences between <code>par</code> and Strategies? Or something else entirely? How to achieve speedup with <code>par</code> and <code>pseq</code>?</strong></p>\n"}, {"tags": ["haskell", "fold", "haskell-lens", "foldable"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557049639, "post_id": 55990665, "comment_id": 98629329, "body": "In order to convert it to a list, you should use <code>foldrOf each (:) [] (1,2,3)</code>, since your initial accumulator is the empty list."}, {"owner": {"reputation": 123, "user_id": 11323942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d040d48dc09031501a031acd841cd580?s=128&d=identicon&r=PG", "display_name": "Giulio", "link": "https://stackoverflow.com/users/11323942/giulio"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557049726, "post_id": 55990665, "comment_id": 98629353, "body": "@WillemVanOnsem thanks! that&#39;s what I was looking for"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1559435348, "post_id": 55990665, "comment_id": 99419836, "body": "&quot;toListOf each&quot; should do the trick, also see the infix alias ^.."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1557050139, "last_edit_date": 1557050139, "creation_date": 1557049751, "answer_id": 55990702, "question_id": 55990665, "link": "https://stackoverflow.com/questions/55990665/convert-tuple-into-foldable/55990702#55990702", "title": "Convert Tuple into Foldable", "body": "<blockquote>\n  <p>but I would need instead</p>\n\n<pre><code>foldr1Of each (\\a x -&gt; a:x) (1,2,3) \n</code></pre>\n  \n  <p>which doesn't compile</p>\n</blockquote>\n\n<p>The reason why this does not compile is because <code>(:) :: a -&gt; [a] -&gt; [a]</code> expects a list as second argument, but with <code>foldr1Of</code>, you provide it the <em>last</em> element of your fold, which is here a number.</p>\n\n<p>You can solve it by using <a href=\"https://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Combinators.html#v:foldrOf\" rel=\"nofollow noreferrer\"><strong><code>foldrOf :: Getting (Endo r) s a -&gt; (a -&gt; r -&gt; r) -&gt; r -&gt; s -&gt; r</code></strong></a> instead:</p>\n\n<pre><code>Prelude Control.Lens&gt; foldrOf each (:) [] (1,2,3)\n[1,2,3]\n</code></pre>\n\n<p>Here we thus pass <code>[]</code> as the \"initial accumulator\".</p>\n\n<p>We can thus convert several several \"containers\" to lists with:</p>\n\n<pre><code>toList :: Each s s a a =&gt; s -&gt; [a]\ntoList = foldrOf each (:) []\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Control.Lens&gt; toList (1,2)\n[1,2]\nPrelude Control.Lens&gt; toList (1,2,3)\n[1,2,3]\nPrelude Control.Lens&gt; toList (1,2,3,4)\n[1,2,3,4]\nPrelude Control.Lens&gt; toList [1,2,3]\n[1,2,3]\nPrelude Control.Lens&gt; toList Nothing\n[]\nPrelude Control.Lens&gt; toList (Just 2)\n[2]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1557173858, "last_edit_date": 1557173858, "creation_date": 1557096733, "answer_id": 55997108, "question_id": 55990665, "link": "https://stackoverflow.com/questions/55990665/convert-tuple-into-foldable/55997108#55997108", "title": "Convert Tuple into Foldable", "body": "<p>In addition to <a href=\"https://stackoverflow.com/a/55990702/2751851\">Willem's answer</a>, it is worth noting that <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Fold.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Fold</code></a> offers analogues for pretty much everything in <code>Data.Foldable</code>. That includes <code>toList</code>, which becomes <a href=\"http://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Fold.html#v:toListOf\" rel=\"nofollow noreferrer\"><code>toListOf</code></a>:</p>\n\n<pre><code>GHCi&gt; toListOf each (1,2,3)\n[1,2,3]\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 11323942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d040d48dc09031501a031acd841cd580?s=128&d=identicon&r=PG", "display_name": "Giulio", "link": "https://stackoverflow.com/users/11323942/giulio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 55990702, "answer_count": 2, "score": 2, "last_activity_date": 1603974703, "creation_date": 1557049477, "last_edit_date": 1603974703, "question_id": 55990665, "link": "https://stackoverflow.com/questions/55990665/convert-tuple-into-foldable", "title": "Convert Tuple into Foldable", "body": "<p>Is there a way to derive <code>Foldable</code> from <code>Tuple</code>?\nAt least when the tuple is homogeneous?</p>\n\n<p>For example let's say I have <code>(1,2,3)</code> and I want to <code>reverse</code> it or to transform it into <code>[1,2,3]</code> and similar things.</p>\n\n<p>I've tried to do something like</p>\n\n<pre><code>over each (\\x -&gt; 4 -x) (1,2,3) -- lol\n</code></pre>\n\n<p>but I need a sort of equivalent of fold with lens...</p>\n\n<p>and actually I see that I can do</p>\n\n<pre><code> foldr1Of each (\\a x -&gt; a+x) (1,2,3)\n</code></pre>\n\n<p>but I would need instead</p>\n\n<pre><code> foldr1Of each (\\a x -&gt; a:x) (1,2,3) \n</code></pre>\n\n<p>which doesn't compile</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1557033809, "post_id": 55989020, "comment_id": 98626596, "body": "You cannot. That&#39;s the point of not exporting them."}, {"owner": {"reputation": 6952, "user_id": 114583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6bbb0d3de873b4188eed6814ff9c08e7?s=128&d=identicon&r=PG", "display_name": "Dathan", "link": "https://stackoverflow.com/users/114583/dathan"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1557034355, "post_id": 55989020, "comment_id": 98626676, "body": "Thanks. Can you elaborate on what the perceived advantage is to not permitting it? Is it just plain old implementation hiding?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1557034817, "post_id": 55989020, "comment_id": 98626747, "body": "Yes implementation hiding would be the most obvious reason for not exporting the constructors."}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1557035194, "last_edit_date": 1557035194, "creation_date": 1557034642, "answer_id": 55989137, "question_id": 55989020, "link": "https://stackoverflow.com/questions/55989020/how-to-pattern-match-an-abstract-data-type-when-the-data-constructor-isnt-in-sc/55989137#55989137", "title": "How to pattern match an abstract data type when the data constructor isn&#39;t in scope?", "body": "<p>Although the data constructor isn't exported, functions to access its parameters are. You can use these in combination with <a href=\"https://downloads.haskell.org/~ghc/8.6.5/docs/html/users_guide/glasgow_exts.html#extension-ViewPatterns\" rel=\"nofollow noreferrer\">view patterns</a> to sort of get what you want. In your case, the pattern <code>(errorMessages -&gt; msgs)</code> can stand in almost perfectly for <code>(ParseError _ msgs)</code>, with two caveats:</p>\n\n<ol>\n<li>You need <code>{-# LANGUAGE ViewPatterns #-}</code> to use this feature.</li>\n<li><code>errorMessages</code> sorts the messages, which a pattern match on the data constructor wouldn't do.</li>\n</ol>\n\n<p>You can even use this technique with <a href=\"https://downloads.haskell.org/~ghc/8.6.5/docs/html/users_guide/glasgow_exts.html#pattern-synonyms\" rel=\"nofollow noreferrer\">pattern synonyms</a> to make a fake data constructor, so you can use the exact same syntax you would otherwise:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, ViewPatterns #-}\npattern ParseError pos msgs &lt;- ((,) &lt;$&gt; errorPos &lt;*&gt; errorMessages -&gt; (pos, msgs)) where\n        ParseError pos msgs = foldr addErrorMessage (newErrorUnknown pos) msgs\n</code></pre>\n"}], "owner": {"reputation": 6952, "user_id": 114583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6bbb0d3de873b4188eed6814ff9c08e7?s=128&d=identicon&r=PG", "display_name": "Dathan", "link": "https://stackoverflow.com/users/114583/dathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557035194, "creation_date": 1557032918, "question_id": 55989020, "link": "https://stackoverflow.com/questions/55989020/how-to-pattern-match-an-abstract-data-type-when-the-data-constructor-isnt-in-sc", "title": "How to pattern match an abstract data type when the data constructor isn&#39;t in scope?", "body": "<p>I'm writing a parser library using Parsec combinators, and I want to unit test some of my parsers. So I have a simple parser:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>dash :: GenParser Char st Char\ndash = char '-'\n</code></pre>\n\n<p>I'd like to write some tests for it. The positive test is pretty easy:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>spec :: Spec\nspec = do\n  describe \"dash\" $ do\n    it \"parses a dash\" $\n      parse dash \"N/A\" \"-\" `shouldBe` (Right '-')\n</code></pre>\n\n<p>I'd like to write a negative test as well. When the parser doesn't match, it returns <code>Left</code> of a <code>ParseError</code>. I'd like to write a test that validates the exact message that the <code>ParseError</code> contains. So what I'd really like to do is something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>spec :: Spec\nspec = do\n  describe \"dash\" $ do\n    it \"doesn't parse an underscore\" $\n      parse dash \"N/A\" \"_\" `shouldSatisfy` (hasErrorMessage \"not a dash\")\n\nhasErrorMessage (Left (ParseError _ msgs)) expected = msg == expected\nhasErrorMessage _ expected = False\n</code></pre>\n\n<p>But I'm having trouble writing this sort of code, since the <code>ParseError</code> data constructor isn't exported from <code>Text.Parsec.Error</code>.</p>\n\n<p>Is there any way to use pattern matching on types where no data constructor for the type is in scope?</p>\n\n<p>I know I could write <code>hasErrorMessage</code> something like </p>\n\n<pre><code>hasErrorMessage :: String -&gt; (Either ParseError a) -&gt; Bool\nhasErrorMessage expected (Left pe) = elem expected $ fmap messageString (errorMessages pe)\n</code></pre>\n\n<p>but I'd like to understand this nuance, too.</p>\n"}, {"tags": ["haskell", "yaml", "dhall"], "answers": [{"tags": [], "owner": {"reputation": 1210, "user_id": 437583, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/227b1832ae8d065bfdce3b5c92d0792b?s=128&d=identicon&r=PG", "display_name": "Linus Arver", "link": "https://stackoverflow.com/users/437583/linus-arver"}, "is_accepted": true, "score": 1, "last_activity_date": 1557089520, "last_edit_date": 1557089520, "creation_date": 1557085678, "answer_id": 55995787, "question_id": 55987916, "link": "https://stackoverflow.com/questions/55987916/how-to-represent-data-map-text-text-in-dhall/55995787#55995787", "title": "How to represent &quot;Data.Map Text Text&quot; in Dhall?", "body": "<p>After some digging, I found three workarounds. Skip to the bottom if you want\nthe best workaround until\n<a href=\"https://github.com/dhall-lang/dhall-lang/issues/234#issuecomment-422478261\" rel=\"nofollow noreferrer\"><code>toMap</code></a> lands.</p>\n\n<p>As of 2019-05-05 there is no way to represent maps in Dhall like how it is\npossible with Aeson/YAML (although support for a native <code>toMap</code> function is\ncoming soon). So for now we basically have to use a list of homogeneous\nrecords. It's a bit clunky, but at least you get the native unmarshaling.</p>\n\n<p>If we want to use a list of tuples instead of a map, we can do this:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving   #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE RecordWildCards     #-}\n\nmodule Tuple where\n\nimport Dhall\nimport qualified Data.Text as T\n\ndata MyType = MyType { env :: [MyTuple] }\n    deriving (Generic, Show)\n\ninstance Interpret MyType\n\nnewtype MyTuple = MyTuple (T.Text, T.Text)\n    deriving (Interpret, Show)\n\n-- input auto \"{env = [{_1= \\\"HOME\\\", _2 = \\\"foo\\\"}] }\" :: IO MyType\n</code></pre>\n\n<p>The above was adapted from <a href=\"https://stackoverflow.com/a/54642516/437583\">this\nanswer</a>, which showed a way to\nparse IP addresses as 4-element tuples.</p>\n\n<p>For parsing into a Map, we can do:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE FlexibleInstances     #-}\n\nmodule MapA where\n\nimport Data.Map (Map)\nimport Data.Text (Text)\nimport Dhall\n\nimport qualified Data.Map\n\ndata MyType = MyType { env :: Map Text Text }\n    deriving (Generic, Show)\n\ndata KeyValue a = KeyValue { mapKey :: Text, mapValue :: a }\n    deriving (Generic, Show)\n\ntoMap :: [KeyValue a] -&gt; Map Text a\ntoMap keyValues = Data.Map.fromList (map adapt keyValues)\n  where\n    adapt (KeyValue {..}) = (mapKey, mapValue)\n\ninstance Interpret MyType\ninstance Interpret a =&gt; Interpret (KeyValue a)\n\n-- Wrap `Map` in a newtype if you want to avoid an orphan instance\ninstance Interpret a =&gt; Interpret (Map Text a) where\n    autoWith options = fmap toMap (autoWith options)\n\n-- input auto \"{env = [{mapKey = \\\"HOME\\\", mapValue = \\\"foo\\\"}] }\" :: IO MapA.MyType\n</code></pre>\n\n<p>The above was adapted from this\n<a href=\"https://github.com/dhall-lang/dhall-haskell/issues/505#issuecomment-403248928\" rel=\"nofollow noreferrer\">comment</a>. The idea is to make\nrecords that look like <code>{ mapKey = X, mapValue = Y}</code> parseable, and then to\nconvert any lists of such records into a Map. Notice how we support any value\ntype, not just text (so we can have <code>env</code> in <code>MyType</code> be <code>Map Text Int</code> or\nsomething else, if we wanted to). This solution has just 1 type variable <code>a</code>\nfor the values in the map, but I suppose it is possible to make the keys more\ngeneric as well.</p>\n\n<p>OK so after some tweaking, I got the following to compile, which supports both\nkeys and values to be generic as well:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE FlexibleInstances     #-}\n\nmodule MapKV where\n\nimport Data.Map (Map)\nimport Data.Text (Text)\nimport Dhall\n\nimport qualified Data.Map\n\ndata MyType = MyType { env :: Map Text Text }\n    deriving (Generic, Show)\n\ndata MyTypeInts = MyTypeInts { envInts :: Map Integer Integer }\n    deriving (Generic, Show)\n\ndata KeyValue k v = KeyValue { mapKey :: k, mapValue :: v }\n    deriving (Generic, Show)\n\ntoMap :: Ord k =&gt; [KeyValue k v] -&gt; Map k v\ntoMap keyValues = Data.Map.fromList (map adapt keyValues)\n  where\n    adapt (KeyValue {..}) = (mapKey, mapValue)\n\ninstance Interpret MyType\ninstance Interpret MyTypeInts\ninstance (Interpret k, Interpret v) =&gt; Interpret (KeyValue k v)\n\n-- Wrap `Map` in a newtype if you want to avoid an orphan instance\ninstance (Ord k, Interpret k, Interpret v) =&gt; Interpret (Map k v) where\n    autoWith options = fmap toMap (autoWith options)\n\n-- input auto \"{env = [{mapKey = +1, mapValue = \\\"foo\\\"}] }\" :: IO MapKV.MyType\n-- input auto \"{envInts = [{mapKey = +1, mapValue = -22 }] }\" :: IO MapKV.MyTypeInts\n</code></pre>\n\n<p>Lastly here is a version that avoids the orphan instance that uses an <code>Env</code> newtype wrapper:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE FlexibleInstances     #-}\n\nmodule MapKV where\n\nimport Data.Map (Map)\nimport Dhall\n\nimport qualified Data.Map\n\ndata MyType = MyType { env :: Env }\n    deriving (Generic, Show)\n\nnewtype Env = Env (Map Text Text)\n  deriving (Eq, Generic, Show)\n\ndata KeyValue k v = KeyValue { mapKey :: k, mapValue :: v }\n    deriving (Generic, Show)\n\ntoMap :: Ord k =&gt; [KeyValue k v] -&gt; Map k v\ntoMap keyValues = Data.Map.fromList (map adapt keyValues)\n  where\n    adapt (KeyValue {..}) = (mapKey, mapValue)\n\ninstance Interpret MyType\ninstance (Interpret k, Interpret v) =&gt; Interpret (KeyValue k v)\n\ninstance Interpret Env where\n    autoWith options = fmap (Env . toMap) (autoWith options)\n\n-- input auto \"{env = [{mapKey = \\\"HOME\\\", mapValue = \\\"foo\\\"}] }\" :: IO MapKV.MyType\n</code></pre>\n"}], "owner": {"reputation": 1210, "user_id": 437583, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/227b1832ae8d065bfdce3b5c92d0792b?s=128&d=identicon&r=PG", "display_name": "Linus Arver", "link": "https://stackoverflow.com/users/437583/linus-arver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 55995787, "answer_count": 1, "score": 2, "last_activity_date": 1557089520, "creation_date": 1557016114, "question_id": 55987916, "link": "https://stackoverflow.com/questions/55987916/how-to-represent-data-map-text-text-in-dhall", "title": "How to represent &quot;Data.Map Text Text&quot; in Dhall?", "body": "<p>If I have a type in Haskell like this:</p>\n\n<pre><code>data MyType = MyType\n  { env :: Map Text Text\n  }\n</code></pre>\n\n<p>How can I represent a value of <code>MyType</code> in Dhall?</p>\n\n<pre><code>{ env = ???\n}\n</code></pre>\n\n<p>What I want to do is to write values of <code>MyType</code> in Dhall and then read it in from Haskell and unmarshal it into <code>MyType</code>, like this:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    x &lt;- input auto \"./config\"\n    print (x :: MyType)\n</code></pre>\n\n<p>I'm coming from <code>Data.Aeson</code> and YAML where you can represent maps like this:</p>\n\n<pre><code>env:\n  KEY1: \"foo\"\n  KEY2: \"bar\"\n</code></pre>\n\n<p>(you would be able to parse the above into the <code>MyType</code> type usinge Aeson's <code>decodeFileEither</code>).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1557016060, "post_id": 55987899, "comment_id": 98624460, "body": "You assume that the fifth argument is non-empty when the second is\u2014this is not guaranteed to be true."}, {"owner": {"reputation": 1, "user_id": 11453671, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yeWUsrTrCIQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcQhAs0AztHjgzZ6we-LlcKVKVnYw/mo/photo.jpg?sz=128", "display_name": "Furgul", "link": "https://stackoverflow.com/users/11453671/furgul"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1557016371, "post_id": 55987899, "comment_id": 98624495, "body": "yes, I try to find more precisly where the error come from and there it is : FUN_imageCompressor_2018/app/Main.hs:77:1: warning: [-Wincomplete-patterns]     Pattern match(es) are non-exhaustive     In an equation for \u2018verifWhereShouldGo\u2019:         Patterns not matched: _ (<i>:</i>) _ p [] where p is not one of {525}    | 77 | verifWhereShouldGo _ _ _ 525 newListCluster = newListCluster"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1557017268, "post_id": 55987899, "comment_id": 98624589, "body": "I have told you precisely where it comes from. You need to add a line along the lines of <code>verifWhereShouldGo a (x:xs) b c [] = ...</code>, that&#39;s it."}, {"owner": {"reputation": 1, "user_id": 11453671, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yeWUsrTrCIQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcQhAs0AztHjgzZ6we-LlcKVKVnYw/mo/photo.jpg?sz=128", "display_name": "Furgul", "link": "https://stackoverflow.com/users/11453671/furgul"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1557048605, "post_id": 55987899, "comment_id": 98629105, "body": "Ow, yes! Thank you for you fast answer."}], "owner": {"reputation": 1, "user_id": 11453671, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yeWUsrTrCIQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcQhAs0AztHjgzZ6we-LlcKVKVnYw/mo/photo.jpg?sz=128", "display_name": "Furgul", "link": "https://stackoverflow.com/users/11453671/furgul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557015975, "creation_date": 1557015914, "last_edit_date": 1557015975, "question_id": 55987899, "link": "https://stackoverflow.com/questions/55987899/how-to-fix-error-non-exhaustive-patterns-in-haskell", "title": "How to fix Error &quot;Non-exhaustive patterns&quot; in Haskell", "body": "<p>I have some problem with my code, I'm trying to put a color into a list of colors depending of a list of centroids.\nI've got a non-matching pattern but i don't understand why?\nCould you help me? </p>\n\n<p>Best Regard\n(Sorry for my English level)</p>\n\n<pre><code>verifWhereShouldGo :: Colors -&gt; [Float] -&gt; Float -&gt; Int -&gt; [[Colors]] -&gt; [[Colors]]\nverifWhereShouldGo    _ _ _ 525 newListCluster = newListCluster\nverifWhereShouldGo    _ [] d_anc _ newListCluster = newListCluster\nverifWhereShouldGo    couleur (firstD:restD) d_anc counter (fristList:restList) = do\n   case firstD &lt;= d_anc of\n    True -&gt; do\n        let try = (fristList ++ [couleur])\n        verifWhereShouldGo couleur (firstD:restD) 0 525 (try:restList)\n    False -&gt; do\n        let d_anc = firstD\n        verifWhereShouldGo couleur restD d_anc 1 restList\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557008354, "post_id": 55987251, "comment_id": 98623405, "body": "What&#39;s the error?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557008426, "post_id": 55987251, "comment_id": 98623416, "body": "@moonGoose They have written the error in the title."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1557022660, "post_id": 55987304, "comment_id": 98625207, "body": "Minor notes: the parentheses around <code>fromIntegral l</code> are also redundant, and this can be written with a <code>where</code> block <code>anteilImKreis k = fromIntegral l &#47; k ^ 2 where l = length (punkteImKreis k)</code> or without local bindings <code>anteilImKreis k = fromIntegral (length (punkteImKreis k)) &#47; k ^ 2</code>"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1557039643, "post_id": 55987304, "comment_id": 98627475, "body": "@JonPurdy I know the brackets around <code>fromIntegral l</code> are redundant, but personally I prefer to write it this way to avoid ambiguity. I&#39;m also aware that it can be written using <code>where</code> or without bindings, but I thought that doing this would be irrelevant to answering the question."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1557115827, "post_id": 55987304, "comment_id": 98644077, "body": "@bradm: Of course, just some addenda for OP and beginner Haskellers coming across this in the future."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 6, "last_activity_date": 1557008630, "creation_date": 1557008630, "answer_id": 55987304, "question_id": 55987251, "link": "https://stackoverflow.com/questions/55987251/how-to-fix-parse-error-possibly-incorrect-indentation-or-mismatched-brackets-i/55987304#55987304", "title": "How to fix parse error (possibly incorrect indentation or mismatched brackets) in Haskell", "body": "<p>The error is in this definition:</p>\n\n<pre><code>anteilImKreis :: Double -&gt; Double\nlet l = length(punkteImKreis)\nin anteilImKreis k = (fromIntegral (l)) / k^2\n</code></pre>\n\n<p><code>let</code> is an expression; therefore, it has to be <em>inside</em> a definition (that is, on the <em>right</em> of an <code>=</code> sign). This should be:</p>\n\n<pre><code>anteilImKreis :: Double -&gt; Double\nanteilImKreis k =\n  let l = length(punkteImKreis)\n  in (fromIntegral (l)) / k^2\n</code></pre>\n\n<p>By the way, you don't really need parentheses around an argument of a function when it's just one identifier. I would rewrite this as follows:</p>\n\n<pre><code>anteilImKreis :: Double -&gt; Double\nanteilImKreis k =\n  let l = length punkteImKreis\n  in (fromIntegral l) / k^2\n</code></pre>\n\n<p>Additionally, this exposes another error. <code>punkteImKreis</code> isn't a list; it's a function which <em>returns</em> a list, which means you can't directly take its <code>length</code>. I would assume you meant the following:</p>\n\n<pre><code>anteilImKreis :: Double -&gt; Double\nanteilImKreis k =\n  let l = length (punkteImKreis k)\n  in (fromIntegral l) / k^2\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 4406515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5d29f6c434b409c15be500ec04fcb8?s=128&d=identicon&r=PG&f=1", "display_name": "Evul4t3r", "link": "https://stackoverflow.com/users/4406515/evul4t3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 55987304, "answer_count": 1, "score": 0, "last_activity_date": 1557010910, "creation_date": 1557008093, "last_edit_date": 1557010910, "question_id": 55987251, "link": "https://stackoverflow.com/questions/55987251/how-to-fix-parse-error-possibly-incorrect-indentation-or-mismatched-brackets-i", "title": "How to fix parse error (possibly incorrect indentation or mismatched brackets) in Haskell", "body": "<p>I wrote the following code and put the error in the title.\nCan someone help me please?\nError in line 7</p>\n\n<pre><code>punkteImKreis :: Double -&gt; [(Double, Double)]\npunkteImKreis k = [(x,y)|x &lt;- [1.0,2.0..k-1.0],\n                         y &lt;- [1.0,2.0..k-1.0] ]\n\nanteilImKreis :: Double -&gt; Double\nlet l = length(punkteImKreis)\nin anteilImKreis k = (fromIntegral (l)) / k^2\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1557002819, "post_id": 55986659, "comment_id": 98622288, "body": "Do you understand <i>why</i> that is not working?"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 6, "creation_date": 1557003267, "post_id": 55986659, "comment_id": 98622386, "body": "What&#39;s the function <code>f</code> signature?"}, {"owner": {"reputation": 38746, "user_id": 238884, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/febf321631229c7408834722691c06e9?s=128&d=identicon&r=PG", "display_name": "Malvolio", "link": "https://stackoverflow.com/users/238884/malvolio"}, "edited": false, "score": 0, "creation_date": 1557005631, "post_id": 55986659, "comment_id": 98622871, "body": "There is a reason I didn&#39;t post this on socraticmethod.com.  Yes, I know this doesn&#39;t work.  No, I don&#39;t know what would work."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1557009046, "post_id": 55986659, "comment_id": 98623508, "body": "@Malvolio A more direct way of stating bereal&#39;s question would be: which type(s) do you want <code>n</code> to have?  The answer to that directs the choice of a solution. (leftaroundabout&#39;s answer covers that point very well.)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1557023447, "post_id": 55986659, "comment_id": 98625319, "body": "Would you add some context about the problem you\u2019re trying to solve that made you want this feature? There\u2019s probably a way to accomplish what you want in a way that\u2019s simpler and more idiomatic for Haskell than the direct translation with <code>Typeable</code>/<code>Dynamic</code>."}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 1, "last_activity_date": 1557007688, "last_edit_date": 1557007688, "creation_date": 1557007113, "answer_id": 55987148, "question_id": 55986659, "link": "https://stackoverflow.com/questions/55986659/pattern-matching-on-basic-types/55987148#55987148", "title": "Pattern matching on basic types", "body": "<p>In general, ad-hoc polymorphism and type introspection like this in Haskell is frowned upon. It's possible anyway, but a little bit fragile:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nclass F a where\n  f :: a -&gt; String\n\ninstance F String where\n  f n = \"string\"\n\ninstance {-# OVERLAPPABLE #-} F other where\n  f n = \"other\"\n</code></pre>\n\n<p>Alternatively, you can use <code>Typeable</code>, which is less fragile, at the expense of needing an instance from the caller:</p>\n\n<pre><code>import Data.Typeable\n\nf :: Typeable a =&gt; a -&gt; String\nf n = if typeOf n == typeOf \"\" then \"string\" else \"other\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1557010812, "last_edit_date": 1557010812, "creation_date": 1557007735, "answer_id": 55987224, "question_id": 55986659, "link": "https://stackoverflow.com/questions/55986659/pattern-matching-on-basic-types/55987224#55987224", "title": "Pattern matching on basic types", "body": "<p>If you're coming from JS and Python it's understandable you think that something that this should be possible \u2013 after all, in those languages a type is essentially a particular property of a value. But that's not at all how the Haskell type system works! In fact, types and values belong to completely separate \u201cuniverses\u201d: types only exist at compile time, values only at runtime. It's still true that every value belongs to a type, but this information is already completely resolved at compile-time. At runtime it is generally not necessary to dispatch on types, because the compiler has already done that earlier, and it <em>can never be possible</em> that a value of type other than <em>the valid one</em> is ever passed in. So this would always be redundant. In fact <a href=\"https://en.wikipedia.org/wiki/Type_erasure\" rel=\"nofollow noreferrer\">the type information is removed</a> before the program is run.<br>\nSo in the direct sense, what you're trying to accomplish is indeed impossible. Or, cynically speaking, it's <em>trivial</em>:</p>\n\n<pre><code>f :: String -&gt; String\nf _ = \"string\"\n</code></pre>\n\n<p>Generally, if you find yourself wanting to runtime-dispatch on types it's a sign that you should probably have started out with a variant type in the first place:</p>\n\n<pre><code>data StringOrInt = It'sAString String | It'sAnInt Int\n\nf :: StringOrInt -&gt; String\nf (It'sAString _) = \"string\"\nf (It'sAnInt _) = \"int\"\n</code></pre>\n\n<p>...ideally with more descriptive, application-specific names.</p>\n\n<p>That said, it <em>is</em> actually possible to have \u201cdynamically typed\u201d values in Haskell, like in Python. You just need to request the wrapper that contains the type information which the compiler would otherwise erase before the runtime:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport Data.Dynamic\nimport Type.Reflection\n\nf :: Dynamic -&gt; String\nf (Dynamic t _)\n   = case eqTypeRep t (typeOf \"string\") of\n       Just HRefl -&gt; \"string\"\n       _          -&gt; \"other\"\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>main = do\n   putStrLn . f $ toDyn \"bla\"\n   putStrLn . f $ toDyn True\n   putStrLn . f $ toDyn 'y'\n</code></pre>\n\n<p>yielding</p>\n\n<pre>\nstring\nother\nother\n</pre>\n\n<p>A more elegant way of writing <code>f</code> than with the awkward <code>eqTypeRep</code> construct would be</p>\n\n<pre><code>f :: Dynamic -&gt; String\nf s = case fromDynamic s :: Maybe String of\n       Just _ -&gt; \"string\"\n       _      -&gt; \"other\"\n</code></pre>\n"}], "owner": {"reputation": 38746, "user_id": 238884, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/febf321631229c7408834722691c06e9?s=128&d=identicon&r=PG", "display_name": "Malvolio", "link": "https://stackoverflow.com/users/238884/malvolio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1557010862, "creation_date": 1557002744, "last_edit_date": 1557010862, "question_id": 55986659, "link": "https://stackoverflow.com/questions/55986659/pattern-matching-on-basic-types", "title": "Pattern matching on basic types", "body": "<p>Here is what I want:</p>\n\n<pre><code>f n = case n of\n  String -&gt; \"string\"\n  _ -&gt; \"other\"\n</code></pre>\n\n<p>Or something.  I want <code>f</code> to map to the literal \"string\" if called with a string, \"other\" otherwise.  This cannot be as hard as I am making it.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1556981603, "post_id": 55983500, "comment_id": 98616686, "body": "heads up this is a follow-up question to <a href=\"https://stackoverflow.com/q/55910708/849891\">this one</a>. the OP wanted to do it with a fold."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 0, "last_activity_date": 1556981179, "last_edit_date": 1556981179, "creation_date": 1556979958, "answer_id": 55983500, "question_id": 55983039, "link": "https://stackoverflow.com/questions/55983039/filtering-first-last-using-higher-order-function/55983500#55983500", "title": "Filtering first/last using higher order function", "body": "<p>Your function as written actually removes not the first element of the list, but <em>the first element that doesn't match the predicate</em>.</p>\n\n<p><strong>Equational reasoning to the rescue!</strong></p>\n\n<p>Let's unfold the <code>foldr</code> application:</p>\n\n<pre><code>foldr f a [x1, x2, ... xn] = f x1 (f x2 (... (f xn a)))\n</code></pre>\n\n<p>So applying to your example:</p>\n\n<pre><code>foldr condition (\\x -&gt; []) [1, 2, (-3)] True\n    = condition 1 ( condition 2 ( condition (-3) (\\x -&gt; []) ) ) True\n</code></pre>\n\n<p>So you can see that <code>foldr</code>, as the name suggests, applies <code>condition</code> right-to-left. \nBut another important thing to notice is this: the last argument <code>True</code> gets passed to the <em>first</em> application of <code>condition</code>, not the last one:</p>\n\n<pre><code>condition 1 (...) True\n</code></pre>\n\n<p>Now let's see what <code>condition</code> does with it. Because <code>isPositive 1 == True</code>, the first sub-branch of <code>condition</code> comes into play:</p>\n\n<pre><code>| x y = y : ys True\n</code></pre>\n\n<p>So the above expression becomes:</p>\n\n<pre><code>1 : (...) True\n</code></pre>\n\n<p>And if we now bring back the collapsed contents of parens:</p>\n\n<pre><code>1 : (condition 2 (condition (-3) (\\x -&gt; []))) True\n</code></pre>\n\n<p>Which is the same as:</p>\n\n<pre><code>1 : (condition 2 (condition (-3) (\\x -&gt; [])) True)\n</code></pre>\n\n<p>By the same logic as above, the second application of <code>condition</code> similarly passes the <code>True</code> parameter to the third application:</p>\n\n<pre><code>1 : 2 : (condition (-3) (\\x -&gt; []) True)\n</code></pre>\n\n<p>But the third application is different, because <code>isPositive (-3)</code> is not <code>True</code> anymore. So the second sub-branch comes into play:</p>\n\n<pre><code>| otherwise = ys False\n</code></pre>\n\n<p>Dropping the <code>(-3)</code> and passing <code>False</code> to the final parameter (the seed of <code>foldr</code>). Which makes the whole expression transform to:</p>\n\n<pre><code>1 : 2 : ((\\x -&gt; []) False)\n</code></pre>\n\n<p>Which is finally equivalent to:</p>\n\n<pre><code>1 : 2 : []\n</code></pre>\n\n<p>If there were any more negative numbers after that, they wouldn't get dropped, because the final parameter is now <code>False</code>, and it gets passed through all the way to the end.</p>\n\n<hr>\n\n<p>Now, the root problem here is that your solution is way too complicated for the problem it's trying to solve. One of the big strengths of Haskell is that it can encode mathematical statements more or less directly, without all the silly shoehorning that we all know and love from C++ and Java.</p>\n\n<p>So why not just encode your requirement directly?</p>\n\n<pre><code>-- if it's false, it should remove the first element in the list; \nfilterFirst pred (x : tail) | pred x == False = tail\n-- if not, it should leave the list alone.\nfilterFirst _ xs = xs\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 55983500, "answer_count": 1, "score": 0, "last_activity_date": 1556981179, "creation_date": 1556976785, "question_id": 55983039, "link": "https://stackoverflow.com/questions/55983039/filtering-first-last-using-higher-order-function", "title": "Filtering first/last using higher order function", "body": "<p>I have a filterFirst function that only works the right way some of the time and I'm not sure why. The function should receive a Boolean argument and if it's false, it should remove the first element in the list; if not, it should leave the list alone.</p>\n\n<p>Here are two conditional functions I've been using:</p>\n\n<pre><code>isNegative :: Int -&gt; Bool\nisNegative x\n  | x &lt; 0 = True\n  | otherwise = False\n\nisPositive:: Int -&gt; Bool\nisPositive x\n  | x &gt; 0 = True\n  | otherwise = False\n</code></pre>\n\n<p>Here's the function:</p>\n\n<pre><code>filterFirst :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterFirst x xs = foldr condition (\\x -&gt; []) xs True\n   where\n   condition y ys True\n      | x y = y : ys True\n      | otherwise = ys False\n   condition y ys False = y : ys False\n</code></pre>\n\n<p><code>filterFirst</code> returns the correct answer with:</p>\n\n<pre><code>filterFirst isNegative [1,2,(-3)]\n[2,-3]\n</code></pre>\n\n<p>But then this actually filters out the negative:</p>\n\n<pre><code>filterFirst isPositive [1,2,(-3)]\n[1,2]\n</code></pre>\n\n<p>Why is it removing the negative number from the list and not the first element?</p>\n\n<p>Also, and this might need to be a secondary post, but is there a way to change this slightly so that it filters the last element if the condition is met?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1556970196, "post_id": 55982155, "comment_id": 98613706, "body": "This is not a token, it is part of the identifier, for example <code>State#</code>, <code>Int#</code>, etc. are types: <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Exts.html#t:State-35-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557000540, "post_id": 55982155, "comment_id": 98621785, "body": "&quot;internal type that is ultimately defined in C&quot; is not accurate, but is at least morally correct in my eye. It is a lower-level implementation detail that one should not directly use. Pragmatically, don&#39;t mindlessly mess with <code>State# a</code> since that can break a lot of runtime invariants about IO and ST -- it&#39;s rather fragile. If you instead want to play with unboxed tuples to gain some performance, that should be safe (note that the optimizer might be already switching to those in many cases, so you might gain nothing...)."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1556974041, "creation_date": 1556974041, "answer_id": 55982673, "question_id": 55982155, "link": "https://stackoverflow.com/questions/55982155/haskell-token/55982673#55982673", "title": "Haskell token &quot;#&quot;", "body": "<p>The <code>#</code> marks the type as an <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#unboxed-types-and-primitive-operations\" rel=\"noreferrer\">unboxed type</a>. The <code>#</code> is conventional, but requires an extension (<code>MagicHash</code>) to make it valid syntax. Likewise, <code>(# ... #)</code> is the syntax for an unboxed tuple.</p>\n"}], "owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 55982673, "answer_count": 1, "score": 8, "last_activity_date": 1557948766, "creation_date": 1556970088, "last_edit_date": 1557948766, "question_id": 55982155, "link": "https://stackoverflow.com/questions/55982155/haskell-token", "title": "Haskell token &quot;#&quot;", "body": "<p>What does the <code>#</code> token mean and how is it used?</p>\n\n<pre><code>newtype IO a = IO (State# RealWorld -&gt; (# State# RealWorld, a #))\n</code></pre>\n\n<p>I came across this <a href=\"https://wiki.haskell.org/Evaluation_order_and_state_tokens\" rel=\"nofollow noreferrer\">here</a> and wonder where this type is actually defined or weather this is some syntax of a internal type that is ultimately defined in C? </p>\n"}, {"tags": ["haskell", "lenses"], "comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1556965785, "post_id": 55981177, "comment_id": 98612589, "body": "I kinda got this working, in the sense <code>_3 .~ &quot;hello&quot; $ (1,2)</code> was accepted and produced the result I wanted. But the instance wasn&#39;t accepted: inconsistent with the proper instance, for FunDep <code>t a -&gt; s</code> -- which is quite correct. I just suppressed that FunDep on the class."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 2, "creation_date": 1556979418, "post_id": 55981177, "comment_id": 98616022, "body": "If all you want is a setter <code>(a, b) -&gt; c -&gt; (a, b, c)</code>, what is the rest of the lens infrastructure getting you that <code>_3&#39; = uncurry (,,)</code> doesn&#39;t? Genericity of some sort?"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557005311, "post_id": 55981177, "comment_id": 98622797, "body": "My two-ple is of course deeply nested inside all sorts of other structures I&#39;m lensing into. So I want something I can compose as a lens. Then your <code>_3&#39;</code> is not that. I see no Functor."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557072204, "post_id": 55981177, "comment_id": 98635293, "body": "It&#39;s a setter. It doesn&#39;t need to operate over an arbitrary <code>Functor</code>; its <code>Functor</code> is <code>Identity</code>.  If you have a van Laarhoven lens <code>forall f. Functor f =&gt; ((a, b) -&gt; f (a, b, c)) -&gt; s -&gt; f t</code>, you should be able to compose that with <code>c -&gt; (a, b) -&gt; Identity (a, b, c)</code> to get a setter in the style you want for your larger structure. That&#39;s the beauty of van Laarhoven lenses; you can do an awful lot with plain old composition."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557107695, "post_id": 55981177, "comment_id": 98642744, "body": "Sorry @user11228628, I&#39;m not seeing it. Using my def&#39;n <code>set _3 &quot;hello&quot; (1, 2)</code> gives <code>(1,2,&quot;hello&quot;)</code>, and the type of <code>_3</code> has a Functor required in its constraints. Using your def&#39;n <code>set _3&#39; &quot;hello&quot; (1,2)</code> is ill-typed, and the type of <code>_3&#39;</code>  doesn&#39;t mention Functor. <code>set</code> would introduce the <code>Identity</code> Functor."}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1557122569, "post_id": 55998482, "comment_id": 98645680, "body": "&quot;the tuple-appender be an actual lens with a getter and everything&quot; yes: once the two-ple is extended to a three-ple, then get/set the 3rd element. Then <code>mk3ple&#39;</code> is not that. <code>view mk3ple&#39; (1,2,3)</code> is ill typed. <code>view mk3ple&#39; (1,2)</code> is well-typed, but always returns dummy <code>()</code>. <code>set mk3ple&#39; &quot;hello&quot; (1,2,3)</code> is ill-typed. So I think to avoid corrupting the FunDep <code>t a -&gt; s</code> on class <code>Field3</code>, create another class that is like it but without that FunDep, with a method that is as per <code>_3</code> for the <code>instance Field3x (a,b,c) (a,b,c&#39;) ...</code> but per my O.P. for <code>instance Field3x (a,b) (a,b,c&#39;) ...</code>."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1557122857, "post_id": 55998482, "comment_id": 98645770, "body": "I want to use the same-named lens for every access. Because lenses. Otherwise I need to use one name once only to extend, then a different name for <code>view</code>/<code>over</code>. That&#39;ll be hard to read and brittle code: I can&#39;t readily refactor if it resequences the actions."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1557156748, "post_id": 55998482, "comment_id": 98661936, "body": "&quot;Otherwise I need to use one name once only to extend, then a different name for <code>view</code>/<code>over</code>.&quot; Well, they <i>are</i> different lenses. Technically, <code>mk3ple&#39;</code> is not law-abiding, since <code>mk3ple&#39; pure = pure</code> is not satisfied. But <code>_3</code> is law-abiding. That&#39;s why I presented the <code>over</code> solution first, because what you want isn&#39;t a perfect fit for the lens pattern. I&#39;m not sure it&#39;s a great idea to make a type class where some instances are law-abiding and others aren&#39;t, but it&#39;s your code!"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1557157593, "post_id": 55998482, "comment_id": 98662317, "body": "(To be clear, this is not just a flaw of my <code>mk3ple&#39;</code>; no lens\u2014or even setter\u2014that behaves as you originally describe can be law-abiding. For setters, the relevant law is <code>over l id = id</code>. But if your optic <code>l</code> converts two-ples to three-ples, then the action of <code>id</code> over it can&#39;t be <code>id</code>: the input type of <code>over l id</code> is a two-ple but the output is a three-ple.)"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1557157780, "post_id": 55998482, "comment_id": 98662405, "body": "Also, the answer to the question, &quot;should I fight the type system tooth and nail so I can give two things the same name&quot; is always, &quot;Yes, of course you should. What could possibly go wrong?&quot;"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1557231973, "post_id": 55998482, "comment_id": 98688898, "body": "My expectation of the compiler/type system is that if the code compiles, it is well-typed. So in what sense am I &quot;fight[ing] the type system&quot;? Oh yes: GHC compiles methods but then you find they&#39;re unusable/there&#39;s no non-bottom values that inhabit the inferred type. It&#39;s rich lensists throwing &quot;law-abiding&quot; at this: EKmett seems to delight in breaking the vanLaarhoven laws. So I&#39;ll work on a solution that&#39;s more law-abiding. Already I can do <code>over l id = id</code>."}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": false, "score": 2, "last_activity_date": 1557114327, "last_edit_date": 1557114327, "creation_date": 1557113694, "answer_id": 55998482, "question_id": 55981177, "link": "https://stackoverflow.com/questions/55981177/lenses-for-tuple-extension/55998482#55998482", "title": "lenses for tuple extension?", "body": "<p>In the van Laarhoven lens formulation, a optic is just a higher-order function that takes an action on a smaller structure to an action on a larger structure. These functions can be composed, and then used with the sugar provided in the <code>lens</code> package to make calling them mindless. But they can also just be called.</p>\n\n<p>Let's say you have this:</p>\n\n<pre><code>bigStructure :: (Int, (Int, (Int, Int)))\nbigStructure = (0, (1, (2, 3)))\n</code></pre>\n\n<p>And you want to append a <code>10</code> to the innermost pair. That's an action on that pair, which is a smaller piece of the big structure.</p>\n\n<pre><code>mk3ple :: c -&gt; (a, b) -&gt; (a, b, c)\nmk3ple = flip $ uncurry (,,)\n</code></pre>\n\n<p>So <code>_2 . _2</code> is a lens focusing on that innermost pair\u2014in other words, it's a function that takes actions on that innermost pair to actions on the big structure. So let's just... pass <code>mk3ple</code> to it (<code>over</code> does this; it just takes care of some <code>Identity</code> busywork for us):</p>\n\n<pre><code>over (_2 . _2) (mk3ple 10) bigStructure\n</code></pre>\n\n<p>And there you are\u2014a setter (conceptual, that is; not a literal <code>Setter</code>) for <code>bigStructure</code> that uses whatever lenses you need to focus on the tuple.</p>\n\n<hr>\n\n<p>Of course, if you'd rather have the tuple-appender be an actual lens with a getter and everything, you can certainly do that too! Just think of unit as a part of every tuple, and write:</p>\n\n<pre><code>mk3ple' :: Lens (a, b) (a, b, c) () c\nmk3ple' = lens (const ()) (uncurry (,,))\n\nset (_2 . _2 . mk3ple') 10 bigStructure\n</code></pre>\n"}], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1557114327, "creation_date": 1556962112, "question_id": 55981177, "link": "https://stackoverflow.com/questions/55981177/lenses-for-tuple-extension", "title": "lenses for tuple extension?", "body": "<p><a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Tuple.html\" rel=\"nofollow noreferrer\">Control.Lens.Tuple</a> defines lenses to access elements of tuples. For example</p>\n\n<pre><code>class Field3 s t a b | s -&gt; a, t -&gt; b, s b -&gt; t, t a -&gt; s where\n  -- | Access the 3rd field of a tuple.\n  _3 :: Lens s t a b\n\n  -- &gt;&gt;&gt; (1,2,3)^._3\n  -- 3\n  --\n  -- &gt;&gt;&gt; _3 .~ \"hello\" $ (1,2,3)\n  -- (1,2,\"hello\")\n</code></pre>\n\n<p>The setter <code>_3 .~</code> returns a tuple with the third element changed, to a different type in this example.</p>\n\n<p>For class <code>Field3</code> there's instances defined for tuples with three or more elements. Not for pairs/two-ples, because what would a getter get?</p>\n\n<p>But if a setter can change the type of the nth element, why couldn't it change the type to a different arity of tuple?</p>\n\n<pre><code>  -- &gt;&gt;&gt; _3 .~ \"hello\" $ (1,2)\n  -- (1,2,\"hello\")\n</code></pre>\n\n<p>That is, a setter <code>_3 .~</code> setting the third element by extending a two-ple.</p>\n\n<pre><code>instance Field3 (a,b) (a,b,c') Dummy c' where\n  _3 k ~(a,b) = k undefined &lt;&amp;&gt; \\c' -&gt; (a,b,c')\n</code></pre>\n\n<p>In which <code>Dummy</code> and <code>undefined</code> is some place-holder type and value for the non-existent third element of the incoming two-ple.</p>\n\n<p>After extending to arity 3, lens <code>_3</code> works as usual; also lenses <code>_1, _2</code> obey the lens laws throughout.</p>\n\n<p>Q1. Will this work for a setter?<br/>\n    (of course it won't for an updater/<code>over</code>)</p>\n\n<p>Q2. If so, is there some way to make it ill-typed to try <code>view</code>ing the non-existent 3rd element?</p>\n\n<p>Q3. If a setter won't work, could there be an <code>extend</code> operator that will achieve the effect? (Presumably using a different functor.)</p>\n\n<p>Perhaps the instance could be this</p>\n\n<pre><code>instance Field3 (a,b) (a,b,c') (a,b) c' where\n  _3 k ~(a,b) = k (a,b) &lt;&amp;&gt; \\c' -&gt; (a,b,c')\n</code></pre>\n\n<p>Such that <code>view</code> would return a weirdly typed result, and <code>over</code> could potentially build the third element from the first two.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1556961405, "post_id": 55980406, "comment_id": 98611675, "body": "On my system, after compiling that with <code>-O2</code>, it needs ~1% CPU. I changed the <code>threadDelay</code> to <code>100000</code> so to make it 10x more expensive, and I got ~7% CPU. Are you compiling that with <code>-O2</code>? (I also tried to use bytestrings instead of strings, but it did not have any significant effect, apparently)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1556961646, "post_id": 55980406, "comment_id": 98611718, "body": "Unrelated: I think your code does not consider pids like <code>&#47;proc&#47;91</code> since <code>&quot;91&quot; &gt; &quot;9&quot;</code>."}, {"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1556961657, "post_id": 55980406, "comment_id": 98611720, "body": "Yes, with -O2. The CPU usage may relate to how fast the hardware is. I am using a Gen2 i5. Have you tried to compare with top/ps (repeatedly)?"}, {"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1556961752, "post_id": 55980406, "comment_id": 98611740, "body": "Ah, yes, did not pay attention on that. I was using <code>isDigital</code>, just change to this trying to save some calculation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1556962497, "post_id": 55980406, "comment_id": 98611886, "body": "<code>top</code> here, once set to 1s updates, reports itself sometimes at 0%, sometimes at 1%, and your code is more steady at 1%. I can&#39;t estimate the difference here, but it might be a bit slower."}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556957489, "creation_date": 1556954255, "last_edit_date": 1556957489, "question_id": 55980406, "link": "https://stackoverflow.com/questions/55980406/reading-folder-content-and-some-files-in-it-uses-way-more-cpu-than-c-or-rust", "title": "Reading folder content and some files in it uses way more CPU than C or Rust", "body": "<p>I have a function reading the content of /proc every second. Surprisingly, its CPU usage in top is around 5%, peak at 8%. But same logic in C or Rust just takes like 1% or 2%. Wondering if this can be improved.</p>\n\n<pre><code>import Control.Exception\nimport Control.Concurrent\nimport Control.Monad\nimport Data.Char\nimport Data.Maybe\nimport System.Directory\nimport System.FilePath\nimport System.Posix.Files\nimport System.Posix.Signals\nimport System.Posix.Types\nimport System.Posix.User\nimport System.IO.Strict as Strict\n\nwatch u limit0s limit0h = do\n  listDirectory \"/proc/\" &gt;&gt;= mapM_ (\\fp -&gt; do\n    isMyPid' &lt;- maybe False id &lt;$&gt; wrap2Maybe (isMyPid fp u)\n    wrap2Maybe (Strict.readFile (\"/proc/\" &lt;/&gt; fp &lt;/&gt; \"stat\")))\n  threadDelay 1000000\n  watch u limit0s limit0h\n  where\n    wrap2Maybe :: IO a -&gt; IO (Maybe a)\n    wrap2Maybe f = catch ((&lt;$&gt;) Just $! f) (\\(_ :: IOException) -&gt; return Nothing)\n    isMyPid :: FilePath -&gt; UserID -&gt; IO Bool\n    isMyPid fp me = do\n      let areDigit = fp &gt;= \"0\" &amp;&amp; fp &lt;= \"9\"\n      isDir &lt;- doesDirectoryExist $ \"/proc/\" &lt;/&gt; fp\n      owner &lt;- fileOwner &lt;$&gt; getFileStatus (\"/proc\" &lt;/&gt; fp)\n      return $ areDigit &amp;&amp; isDir &amp;&amp; (owner == me)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1556953628, "post_id": 55980338, "comment_id": 98610122, "body": "You use <code>id</code> as an argument here, as a result <code>m</code> collapses to <code>(-&gt;) a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 463, "user_id": 3203476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7935bf89df5baff4e39ea43be4ce4e?s=128&d=identicon&r=PG&f=1", "display_name": "user3203476", "link": "https://stackoverflow.com/users/3203476/user3203476"}, "edited": false, "score": 0, "creation_date": 1556955229, "post_id": 55980386, "comment_id": 98610448, "body": "and there it is ! <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Reader.html#v:reader\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/mtl-2.2.2/docs/&hellip;</a> . many thanks !"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 9, "last_activity_date": 1556954410, "last_edit_date": 1556954410, "creation_date": 1556953960, "answer_id": 55980386, "question_id": 55980338, "link": "https://stackoverflow.com/questions/55980338/haskell-why-does-id-make-this-function-no-longer-monadic/55980386#55980386", "title": "Haskell: why does &#39;id&#39; make this function no longer monadic?", "body": "<p>You\u2019re fixing the type to a particular <code>Monad</code> instance, namely the \u201cfunction reader\u201d monad (<code>instance Monad ((-&gt;) a)</code>).</p>\n\n<p><code>id :: a -&gt; a</code> and you are attempting to use it as an argument to a parameter of type <code>m a</code>, so:</p>\n\n<pre><code>m a  ~  a -&gt; a\nm a  ~  (-&gt;) a a\nm a  ~  ((-&gt;) a) a\nm    ~  (-&gt;) a\na    ~  a\n</code></pre>\n\n<p>The remainder of the signature is:</p>\n\n<pre><code>m a -&gt; m Bool\n</code></pre>\n\n<p>And since <code>m ~ (-&gt;) a</code>, the resulting type is:</p>\n\n<pre><code>(-&gt;) a a -&gt; (-&gt;) a Bool\n(a -&gt; a) -&gt; (a -&gt; Bool)\n(a -&gt; a) -&gt; a -&gt; Bool\n</code></pre>\n\n<p>(Plus the <code>Eq a</code> constraint from the use of <code>==</code>.)</p>\n\n<p>This is useful in pointfree code, particularly using the <code>Applicative</code> instance, since you can implicitly \u201cspread\u201d the argument of a function to subcomputations:</p>\n\n<pre><code>nextThree = (,,) &lt;$&gt; (+ 1) &lt;*&gt; (+ 2) &lt;*&gt; (+ 3)\n-- or\nnextThree = liftA3 (,,) (+ 1) (+ 2) (+ 3)\n\nnextThree 5 == (6, 7, 8)\n\nuncurry' f = f &lt;$&gt; fst &lt;*&gt; snd\n-- or\nuncurry' f = liftA2 f fst snd\n\nuncurry' (+) (1, 2) == 3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1556954024, "creation_date": 1556954024, "answer_id": 55980390, "question_id": 55980338, "link": "https://stackoverflow.com/questions/55980338/haskell-why-does-id-make-this-function-no-longer-monadic/55980390#55980390", "title": "Haskell: why does &#39;id&#39; make this function no longer monadic?", "body": "<p>The signature of <code>liftM2 (==)</code> is <code>(Monad m, Eq a) =&gt; m a -&gt; m a -&gt; m Bool</code>. So that means that if we call this function with <code>id :: b -&gt; b</code> as argument, then it means that <code>m a</code> and <code>b -&gt; b</code> are the same type.</p>\n\n<p>The fact that <code>m ~ (-&gt;) b</code> holds is not a problem since <code>(-&gt;) r</code> is an instance of <code>Monad</code>, indeed in the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#line-822\" rel=\"nofollow noreferrer\">GHC.Base source code</a> we see:</p>\n\n<blockquote><pre><code>-- | @since 2.01\ninstance <b>Monad ((-&gt;) r)</b> where\n    f &gt;&gt;= k = \\ r -&gt; k (f r) r</code></pre></blockquote>\n\n<p>This only makes sense if <code>m ~ (-&gt;) b</code>. Here the arrow <code>(-&gt;)</code> is a type constructor, and <code>(-&gt;) a b</code> is the same as <code>a -&gt; b</code>.</p>\n\n<p>So it means that if we calculate the type of <code>liftM2 (==) id</code>, we derive the following:</p>\n\n<pre><code>liftM2 (==)    ::  m a     -&gt; m a -&gt; m Bool\n            id :: (b -&gt; b)\n-------------------------------------------\nm ~ (-&gt;) b, a ~ b\n</code></pre>\n\n<p>This thus means that the output type of <code>liftM2 (==) id</code> is <code>liftM2 (==) id :: (Monad m, Eq a) =&gt; m a -&gt; m Bool</code>, but we need to \"specialize\" this with the knowledge we obtained: that <code>m a</code> is <code>(-&gt;) b</code> and <code>a</code> is the same type as <code>b</code>, so:</p>\n\n<pre><code>   liftM2 (==) id :: (Monad m, Eq a) =&gt; m a -&gt; m Bool\n-&gt; liftM2 (==) id :: (Monad m, Eq a) =&gt; (b -&gt; a) -&gt; (b -&gt; Bool)\n-&gt; liftM2 (==) id :: Eq b =&gt; (b -&gt; b) -&gt; (b -&gt; Bool)\n-&gt; liftM2 (==) id :: Eq b =&gt; (b -&gt; b) -&gt; b -&gt; Bool\n</code></pre>\n\n<p>In short the function is still \"monadic\", although by using <code>id</code>, you have selected a specific monad, and thus the function is no longer applicable to all sorts of monads, only to the <code>(-&gt;) r</code> monad.</p>\n"}], "owner": {"reputation": 463, "user_id": 3203476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7935bf89df5baff4e39ea43be4ce4e?s=128&d=identicon&r=PG&f=1", "display_name": "user3203476", "link": "https://stackoverflow.com/users/3203476/user3203476"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 1, "accepted_answer_id": 55980386, "answer_count": 2, "score": 5, "last_activity_date": 1556954410, "creation_date": 1556953498, "question_id": 55980338, "link": "https://stackoverflow.com/questions/55980338/haskell-why-does-id-make-this-function-no-longer-monadic", "title": "Haskell: why does &#39;id&#39; make this function no longer monadic?", "body": "<p>I am trying to understand why adding <code>id</code> in the last line of the sequence below removes the monadic aspect:</p>\n\n<pre><code>Prelude&gt; :t id\nid :: a -&gt; a\nPrelude&gt; :t Control.Monad.liftM2\nControl.Monad.liftM2\n  :: Monad m =&gt; (a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r\nPrelude&gt; :t  (==)\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\nPrelude&gt; :t Control.Monad.liftM2 (==)\nControl.Monad.liftM2 (==)\n  :: (Monad m, Eq a) =&gt; m a -&gt; m a -&gt; m Bool\nPrelude&gt; :t Control.Monad.liftM2 (==) id\nControl.Monad.liftM2 (==) id :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; Bool\nPrelude&gt;\n</code></pre>\n\n<p>How does adding <code>id :: a -&gt; a</code> change the signature in the way it does in the last line ?</p>\n"}, {"tags": ["haskell", "recursion", "fold", "recursion-schemes", "catamorphism"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556919429, "post_id": 55977311, "comment_id": 98605250, "body": "What is the question? This function seems to work fine for me - except the exclamation marks are totally unnecessary (perhaps they are for very large arguments, I&#39;m not great at understanding where strictness is beneficial), and you need to enable the <code>BangPatterns</code> GHC extension in order to be allowed to use them."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556919563, "post_id": 55977311, "comment_id": 98605295, "body": "@RobinZigmond I want to implement fib using <code>foldNat</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556919701, "post_id": 55977311, "comment_id": 98605340, "body": "Oh right, I see. Well as a large hint, you can achieve this in a very similar way to your existing <code>fib</code> version, by having it work on pairs. You just need to extract the first element of the resulting pair."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1556926881, "post_id": 55977311, "comment_id": 98606788, "body": "Your <code>fact</code> implementation is incorrect: it computes n^n."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1556930333, "post_id": 55977311, "comment_id": 98607254, "body": "@RobinZigmond Unless GHC&#39;s strictness analyzer determines the equivalent to the <code>!</code>s (which is possible), then they are not unnecessary if you are concerned about efficiency. It doesn&#39;t depend so much on the size of the actual inputs as it does how many operations are performed on them (before the value is examined/forced). In this case, that <i>does</i> depend on the size of the argument, but the size of the argument is not, itself, the issue in general."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1556952130, "post_id": 55977311, "comment_id": 98609877, "body": "@amalloy I reimplemented <code>fact</code> using a paramorphism."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1556954326, "post_id": 55977311, "comment_id": 98610266, "body": "a side note: in your <code>fib</code> above the edit, the bang in <code>!n</code> isn&#39;t necessary since you use <code>| n==0</code> as a guard, and that necessarily forces <code>n</code> anyway. the forcing of <code>a</code> and <code>b</code> is good style (even though only one of them is strictly necessary, because of the shifting). --- re your new <code>fact</code>: good naming goes a long way towards ease of understanding, and your naming is nonexistent. see &quot;boolean blindness&quot;. what is first field? what is second? better to use names, like <code>paraNat 1 (\\(r, n) -&gt; n*r)</code> with <code>r</code> the mnemonic for &quot;Recursive partial Result&quot;. so now it is clear that it&#39;s correct."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1556955565, "post_id": 55977311, "comment_id": 98610511, "body": "btw <code>fact = snd . foldNat (0,1) (\\(pred,r) -&gt; (pred+1, (pred+1)*r))</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557061579, "post_id": 55977311, "comment_id": 98632249, "body": "that one emulated a paramorphism by recreating the input structure (number) on the way back, as <code>pred+1</code>. another way is <code>fact n = foldNat (const 1) (\\r n -&gt; n * r (n-1) ) n n</code>, by traversing the same structure twice at the same time, in a synchronized manner -- but manually so (i.e. calling the second <code>(n-1)</code> ourselves, in <code>n * r (n-1)</code>, <i>not</i> having it done <i>for us</i> by the <code>foldNat</code> definition). Some think it an abomination, apparently, so buyer beware."}], "answers": [{"comments": [{"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1556953117, "post_id": 55978840, "comment_id": 98610040, "body": "This is a very comprehensible explanation, thank you. I also enjoyed your blog post on the topic (<i>What&#39;s in a fold</i>), but polymorphic cata-/anamorphisms etc. are still to advanced for me. I still have some ground work to do. If you feel like it, you can review my edit on the broken <code>fact</code> function."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 1, "creation_date": 1556975048, "post_id": 55978840, "comment_id": 98614862, "body": "@bob Your paramorphism-based <code>fact</code> is correct. (If you compare it to other implementations out there, you&#39;ll note the pair components in <code>paraFact</code> are usually swapped around -- that is <code>(structure, result)</code> rather than <code>(result, structure)</code> -- but that is just by convention.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1556940147, "last_edit_date": 1556940147, "creation_date": 1556934754, "answer_id": 55978840, "question_id": 55977311, "link": "https://stackoverflow.com/questions/55977311/how-to-define-the-fibonacci-sequence-using-a-fold-for-natural-numbers/55978840#55978840", "title": "How to define the fibonacci sequence using a fold for natural numbers?", "body": "<p>Let the types guide you. Here is your <code>foldNat</code>, but with a type signature:</p>\n\n<pre><code>import Numeric.Natural\n\nfoldNat :: b -&gt; (b -&gt; b) -&gt; Natural -&gt; b\nfoldNat zero succ = go\n  where\n    go n = if (n &lt;= 0) then zero else succ (go (n - 1))\n</code></pre>\n\n<p>Having another look at the <code>go</code> helper in your implementation of <code>fib</code>, we can note the recursive case takes and returns a <code>(Natural, Natural)</code> pair. Comparing that with the successor argument to <code>foldNat</code> suggests we want <code>b</code> to be <code>(Natural, Natural)</code>. That is a nice hint on how the pieces of <code>go</code> should fit:</p>\n\n<pre><code>fibAux = foldNat (0, 1) (\\(a, b) -&gt; (b, a + b))\n</code></pre>\n\n<p>(I am ignoring the matter of strictness for now, but I will get back to that.)</p>\n\n<p>This is not quite <code>fib</code> yet, as can be seen by looking at the result type. Fixing that, though, is no problem, as Robin Zigmond notes:</p>\n\n<pre><code>fib :: Natural -&gt; Natural\nfib = fst . foldNat (0, 1) (\\(a, b) -&gt; (b, a + b))\n</code></pre>\n\n<p>At this point, you might want to work backwards and substitute the definition of <code>foldNat</code> to picture how this corresponds to an explicitly recursive solution.</p>\n\n<hr>\n\n<p>While this is a perfectly good implementation of <code>fib</code>, there is one major difference between it and the one you had written: this one is a lazy right fold (as is the norm for Haskell catamorphisms), while yours was clearly meant as a strict left fold. (And yes, it does make sense to use a strict left fold here: in general, if what you are doing looks like arithmetic, you ideally want strict left, while if it looks like building a data structure, you want lazy right). The good news, though, is that we can use catamorphisms to define pretty much anything that consumes a value recursively... including strict left folds! Here I will use an adapted version of the foldl-from-foldr trick (see <a href=\"https://stackoverflow.com/q/6172004/2751851\">this question</a> for a detailed explanation of that in the case of lists), which relies on a function like this:</p>\n\n<pre><code>lise :: (b -&gt; b) -&gt; ((b -&gt; b) -&gt; (b -&gt; b))\nlise suc = \\g -&gt; \\n -&gt; g (suc n)\n</code></pre>\n\n<p>The idea is that we take advantage of function composition (<code>\\n -&gt; g (suc n)</code> is the same as <code>g . suc</code>) to do things in the opposite order -- it is as if we swapped <code>succ</code> and <code>go</code> in the right hand side of your definition of <code>go</code>. <code>lise suc</code> can be used as the successor argument to <code>foldNat</code>. That means we will get a <code>b -&gt; b</code> function in the end rather than a <code>b</code>, but that is not a problem because we can apply it to the zero value ourselves. </p>\n\n<p>Since we want a <em>strict</em> left fold, we have to sneak in a <code>($!)</code> to make sure <code>suc n</code> is eagerly evaluated:</p>\n\n<pre><code>lise' :: (b -&gt; b) -&gt; ((b -&gt; b) -&gt; (b -&gt; b))\nlise' suc = \\g -&gt; \\n -&gt; g $! suc n\n</code></pre>\n\n<p>Now we can define a strict left fold (it is to <code>foldNat</code> what <code>foldl'</code> from <code>Data.List</code> is to <code>foldr</code>):</p>\n\n<pre><code>foldNatL' :: b -&gt; (b -&gt; b) -&gt; Natural -&gt; b\nfoldNatL' zero suc n = foldNat id (lise' suc) n zero\n</code></pre>\n\n<p>There is a final, important detail to deal with: making the fold strict is of little use if we are lazily building a pair along the way, as the pair components will remain being built lazily. We could deal with that by using <code>($!)</code> along with <code>(,)</code> for building the pair in the successor function. However, I believe it is nicer to use a strict pair type instead so that we don't have to worry with that:</p>\n\n<pre><code>data SP a b = SP !a !b \n    deriving (Eq, Ord, Show)\n\nfstSP :: SP a b -&gt; a\nfstSP (SP a _) = a\n\nsndSP :: SP a b -&gt; b\nsndSP (SP _ b) = b\n</code></pre>\n\n<p>The <code>!</code> mark the fields as strict (note that you don't need to enable <code>BangPatterns</code> to use them).</p>\n\n<p>With everything in place, we can at last have <code>fib</code> as a strict left fold:</p>\n\n<pre><code>fib' :: Natural -&gt; Natural\nfib' = fstSP . foldNatL' (SP 0 1) (\\(SP a b) -&gt; SP b (a + b))\n</code></pre>\n\n<hr>\n\n<p>P.S.: As amalloy notes, your <code>fac</code> calculates <em>n^n</em> rather than <em>n!</em>. That is probably a matter better left for a separate question; in any case, the gist of it is that factorial is more naturally expressed as a paramorphism on naturals, rather than as a plain catamorphism. (For more on that, see, for instance, the <a href=\"https://medium.com/@jaredtobin/practical-recursion-schemes-c10648ec1c29\" rel=\"nofollow noreferrer\"><em>Practical Recursion Schemes</em></a> blog post by Jared Tobin, more specifically the section about paramorphisms.)</p>\n"}], "owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 55978840, "answer_count": 1, "score": 2, "last_activity_date": 1556954688, "creation_date": 1556918952, "last_edit_date": 1556954688, "question_id": 55977311, "link": "https://stackoverflow.com/questions/55977311/how-to-define-the-fibonacci-sequence-using-a-fold-for-natural-numbers", "title": "How to define the fibonacci sequence using a fold for natural numbers?", "body": "<p>I am currently learning folds in the sense of structural recursion/catamorphisms. I implemented power and factorial using a fold for natural numbers. Please note that I barely know Haskell, so the code is probably awkward:</p>\n\n<pre><code>foldNat zero succ = go\n  where\n    go n = if (n &lt;= 0) then zero else succ (go (n - 1))\n\npow n = foldNat 1 (n*)\n\nfact n = foldNat 1 (n*) n\n</code></pre>\n\n<p>Next I wanted to adapt the fibonacci sequence:</p>\n\n<pre><code>fib n = go n (0,1)\n  where\n    go !n (!a, !b) | n==0      = a\n                   | otherwise = go (n-1) (b, a+b)\n</code></pre>\n\n<p>With <code>fib</code> I have a pair as second argument whose fields are swapped at each recursive call. I am stuck at this point, because I don't understand the mechanics of the conversion process.</p>\n\n<p>[EDIT]</p>\n\n<p>As noted in the comments my <code>fact</code> function is wrong. Here is a new implementation based on a paramorphism (hopefully):</p>\n\n<pre><code>paraNat zero succ = go \n  where \n    go n = if (n &lt;= 0) then zero else succ (go (n - 1), n)\n\nfact = paraNat 1 (\\(r, n) -&gt; n * r)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "higher-order-functions", "parse-error"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1556914055, "post_id": 55976419, "comment_id": 98603527, "body": "Could you clarify what your intention is for the <code>and_</code> function? Is it as simple as you want it to return <code>True</code> if and only if both the functions passed to it return <code>True</code> when applied to the 3rd argument? If so, that&#39;s just <code>and_ f g m = f m &amp;&amp; g m</code>"}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1556919135, "post_id": 55977256, "comment_id": 98605167, "body": "Note that you can also write this as simply <code>and_ = liftA2 (&amp;&amp;)</code> (using the <code>Applicative</code> instance for functions)."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556932885, "post_id": 55977256, "comment_id": 98607578, "body": "@RobinZigmond: That\u2019s one of my favourite little utilities, defined monadically as <code>x &lt;&amp;&amp;&gt; y = x &gt;&gt;= \\case True -&gt; y; False -&gt; pure False</code> so it short-circuits effects\u2014ditto <code>&lt;||&gt;</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1556918510, "creation_date": 1556918510, "answer_id": 55977256, "question_id": 55976419, "link": "https://stackoverflow.com/questions/55976419/higher-order-function-parameter/55977256#55977256", "title": "Higher order function parameter", "body": "<p>Your call to <code>and_</code> does not see <code>director</code> and <code>\"Brad Bird\"</code> directly; it gets the function that <em>results</em> from applying <code>director</code> to <code>\"Brad Bird\"</code> (and similarly for the second argument.</p>\n\n<pre><code>and_ :: (Movie -&gt; Bool) -&gt; (Movie -&gt; Bool) -&gt; Movie -&gt; Bool\nand_ f1 f2 (_, rank, dir) | ...\n</code></pre>\n\n<p>The bigger problem is that you can't compare functions for equality. Even assuming <code>director</code> itself <em>was</em> passed as a distinct argument, you can't check if it's the same function referred to by <code>director</code>.</p>\n\n<p>What you want is to simply apply each of the first two functions to the third function and use <code>&amp;&amp;</code> on the results:</p>\n\n<pre><code>and_ :: (Movie -&gt; Bool) -&gt; (Movie -&gt; Bool) -&gt; Movie -&gt; Bool\nand_ f1 f2 m = f1 m &amp;&amp; f2 m\n</code></pre>\n\n<p><code>f1</code> and <code>f2</code> already \"know\" which part of the <code>Movie</code> argument they are checking against.</p>\n"}], "owner": {"reputation": 7, "user_id": 9300860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d17d0a14f414e21c35453877acd65d00?s=128&d=identicon&r=PG&f=1", "display_name": "black", "link": "https://stackoverflow.com/users/9300860/black"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "closed_date": 1557089938, "accepted_answer_id": 55977256, "answer_count": 1, "score": -7, "last_activity_date": 1556918510, "creation_date": 1556913812, "last_edit_date": 1556916788, "question_id": 55976419, "link": "https://stackoverflow.com/questions/55976419/higher-order-function-parameter", "closed_reason": "Not suitable for this site", "title": "Higher order function parameter", "body": "<p>Problem with and_ function</p>\n\n<p>\"error: Parse error in pattern: f1\"</p>\n\n<pre><code> type Movie = (String, Double, String)\n\n-- movies :: [(String, Double, String)]\nmovies :: [Movie]\nmovies = [ (\"Green Book\", 8.3, \"Peter Farrelly\")\n     , (\"Inception\", 8.8, \"Christopher Nolan\")\n     , (\"Incredibles 2\", 7.7, \"Brad Bird\")\n     , (\"The Dark Knight\", 9.0, \"Christopher Nolan\")\n     ]\n\nimdbAtLeast :: Double -&gt; Movie -&gt; Bool\nimdbAtLeast minRank (_, rank, _)\n  | rank &lt; minRank = False\n  | otherwise      = True\n\ndirector :: String -&gt; Movie -&gt; Bool\ndirector expDir (_, _, dir)\n  | expDir == dir = True\n  | otherwise     = False\n</code></pre>\n\n<p>here is the wrong function</p>\n\n<pre><code>and_ :: (Movie -&gt; Bool) -&gt; (Movie -&gt; Bool) -&gt; Movie -&gt; Bool\nand_ (f1 param1) (f2 param2) (_, rank, dir)\n  | f1 == director = (f1 param1 dir) &amp;&amp; (f2 param2 rank)\n  | otherwise      = (f1 param1 rank) &amp;&amp; (f2 param2 dir)\n</code></pre>\n\n<p>here is two test for and_ function</p>\n\n<pre><code>and_ (director \"Brad Bird\") (imdbAtLeast 7.5) (\"Incredibles 2\", 7.7, \"Brad \nBird\")\nand_ (imdbAtLeast 7.5) (director \"Brad Bird\")  (\"Incredibles 2\", 7.7, \"Brad \nBird\")\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1556903639, "post_id": 55974016, "comment_id": 98599591, "body": "Can you share the code that&#39;s leading you to believe profile results don&#39;t take into account I/O? You may very well be right but my understanding is the monotonic clock is used for ticks. But you might also be interested in <a href=\"http://www.well-typed.com/blog/86/\" rel=\"nofollow noreferrer\">well-typed.com/blog/86</a> as well as trying out <code>perf</code> with your Haskell compiled with dwarf debug symbols"}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1556903900, "post_id": 55974016, "comment_id": 98599700, "body": "As I said, this is a client tester and the profiler tells me it spends ~1.2% of its time in <code>runClientM</code> which is simply not possible. Thanks for the point, I will have a look."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1556907065, "post_id": 55974016, "comment_id": 98600896, "body": "(can confirm <code>threadDelay</code> and waits on a socket don&#39;t show up in cpu profile)"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1556901627, "creation_date": 1556901627, "question_id": 55974016, "link": "https://stackoverflow.com/questions/55974016/how-can-i-include-time-spent-in-i-o-when-using-ghc-profiler", "title": "How can I include time spent in I/O when using GHC profiler?", "body": "<p>When using GHC's profiler capabilities, e.g. passing <code>+RTS -p -RTS</code> options, it does not take into account time spent waiting for I/O operations. This kind of makes sense but I would be interested in profiling my application taking into account this time, as I would like to ensure this code does not introduce significant overhead (this is a test-driver application talking to our system through the network, so I expect time spent in HTTP queries to dwarf any other cost).</p>\n\n<p>Is there a way to do that using GHC?</p>\n"}, {"tags": ["haskell", "deriving"], "comments": [{"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1556880020, "post_id": 55964963, "comment_id": 98587000, "body": "I&#39;ve changed <code>A</code> to <code>X</code> here to avoid ambiguity with <code>isA</code>. Feel free to roll it back if you don&#39;t think it improves the question."}], "answers": [{"comments": [{"owner": {"reputation": 2273, "user_id": 4407321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/KHKUZ.png?s=128&g=1", "display_name": "Allan W", "link": "https://stackoverflow.com/users/4407321/allan-w"}, "edited": false, "score": 0, "creation_date": 1556909615, "post_id": 55968589, "comment_id": 98601853, "body": "Thank you! To clarify, the first example requires the language flag <code>DefaultSignatures</code>"}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "reply_to_user": {"reputation": 2273, "user_id": 4407321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/KHKUZ.png?s=128&g=1", "display_name": "Allan W", "link": "https://stackoverflow.com/users/4407321/allan-w"}, "edited": false, "score": 0, "creation_date": 1556926106, "post_id": 55968589, "comment_id": 98606678, "body": "The other one probably requires a few, too."}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 4, "last_activity_date": 1556881735, "creation_date": 1556881735, "answer_id": 55968589, "question_id": 55964963, "link": "https://stackoverflow.com/questions/55964963/derive-instance-from-field-in-record/55968589#55968589", "title": "Derive instance from field in record", "body": "<p>Here are some strategies that do not require any extensions, but trade some upfront cost for the ease of deriving these classes.</p>\n\n<p>Note that since <code>Sample</code> is not a newtype, there's no guarantee it will only hold one <code>X</code> and not two, more or a variable amount (<code>Maybe X</code>? <code>Either X X</code>?). Therefore, as you'll see, your options have to make the choice of <code>X</code> inside the structure explicit, and that is a likely reason for an extension that derives this automatically to <em>not</em> exist.</p>\n\n<h2>Derive one function instead of many</h2>\n\n<p>To satisfy <code>Sample</code>, we really need an <code>X</code>. Let's make that a typeclass:</p>\n\n<pre><code>class HasX t where\n  getX :: t -&gt; X\n\nclass Sample t where\n  isA :: t -&gt; Bool\n  isB :: t -&gt; Bool\n  isC :: t -&gt; Bool\n  default isA :: HasX t =&gt; t -&gt; Bool\n  isA = isA . getX\n  default isB :: HasX t =&gt; t -&gt; Bool\n  isB = isB . getX\n  default isC :: HasX t =&gt; t -&gt; Bool\n  isC = isC . getX\n\ninstance HasX Wrapper where\n  getX = x\n\ninstance Sample Wrapper -- no implementation necessary\n</code></pre>\n\n<h2>Derive via generics</h2>\n\n<p>Let's say we want to only work on the records that have <code>X</code> as the first field. To match the type structure, we can use <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\">GHC.Generics</a>. Here we add a way for <code>HasX</code> to default to the first field:</p>\n\n<pre><code>class HasX t where\n  getX :: t -&gt; X\n  default getX :: (Generic a, HasX (Rep a)) =&gt; t -&gt; X\n  getX = getX . from\n\ninstance HasX (M1 D d (M1 C c (M1 S s (Rec0 X) :*: ff))) o where\n  getX (M1 (M1 ((M1 (K1 x)) :*: _))) = x\n</code></pre>\n\n<p>The last instance for <code>HasX</code> matches any record (<code>M1 D</code>) with a single constructor (<code>M1 C</code>), which has more than one (<code>:*:</code>) field (<code>M1 S</code>), the first field being of type (<code>Rec0</code>) <code>X</code>.</p>\n\n<p>(Yes, the generic instance is unwieldy. Edits welcome.)</p>\n\n<p>(To see the exact representation of the generic type of <code>Wrapper</code>, inspect <code>Rep Wrapper</code> in the GHCi console.)</p>\n\n<p>Now the instance for <code>Wrapper</code> can be written as:</p>\n\n<pre><code>data Wrapper = Wrapper\n  { x :: X\n  , i :: Int\n  }\n  deriving (Generic, HasX, Sample)\n</code></pre>\n"}], "owner": {"reputation": 2273, "user_id": 4407321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/KHKUZ.png?s=128&g=1", "display_name": "Allan W", "link": "https://stackoverflow.com/users/4407321/allan-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 55968589, "answer_count": 1, "score": 5, "last_activity_date": 1556881735, "creation_date": 1556867849, "last_edit_date": 1556879984, "question_id": 55964963, "link": "https://stackoverflow.com/questions/55964963/derive-instance-from-field-in-record", "title": "Derive instance from field in record", "body": "<p>Example code:</p>\n\n<pre><code>{-# LANGUAGE NamedFieldPuns #-}\n\nmodule Sample where\n\nclass Sample a where\n  isA :: a -&gt; Bool\n  isB :: a -&gt; Bool\n  isC :: a -&gt; Bool\n\ndata X =\n  X\n\ninstance Sample X where\n  isA = undefined\n  isB = undefined\n  isC = undefined\n\ndata Wrapper = Wrapper\n  { x :: X\n  , i :: Int\n  }\n\ninstance Sample Wrapper where\n  isA Wrapper {x} = isA x\n  isB Wrapper {x} = isB x\n  isC Wrapper {x} = isC x\n</code></pre>\n\n<p>Here, I have some class that is implemented by <code>X</code>, and then another record <code>Wrapper</code> containing <code>X</code>.</p>\n\n<p>I want <code>Wrapper</code> to derive the <code>Sample</code> instance, through its field <code>x</code>.</p>\n\n<p>I know I can do so by getting the field and calling it myself for each function, as shown.</p>\n\n<p>Is there some flag or some method to do so automatically or once only?</p>\n\n<p>This seems similar to <code>DerivingVia</code> and <code>GeneralisedNewtypeDeriving</code>, but both seem to target <code>newtype</code> or coercible types only</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1556881706, "post_id": 55961935, "comment_id": 98587799, "body": "You are trying to use <code>.</code> to compose <code>map f x</code>, but that is a list, not a function, so it does not compose with <code>.</code>. The error &quot;applied to too few arguments&quot; is due to <code>.</code> returning a function (<code>f . g</code> is the function obtained by composing function <code>f</code> and function <code>g</code>), but the type of <code>total</code> claims to return an <code>Int</code>. So, GHC wonders if the function resulting from <code>.</code> should be applied to some argument which you forgot. This is not the issue in your code, but this is why GHC generated that message."}], "answers": [{"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 4, "last_activity_date": 1556891174, "last_edit_date": 1556891174, "creation_date": 1556844563, "answer_id": 55961962, "question_id": 55961935, "link": "https://stackoverflow.com/questions/55961935/using-map-and-sum-to-apply-a-function-and-total-the-outcome/55961962#55961962", "title": "Using map and sum to apply a function and total the outcome", "body": "<p><code>map</code> is fully applied so you shouldn't be using composition here.</p>\n\n<p>Either use the application operator</p>\n\n<pre><code>total f x = sum x $ map f x\n</code></pre>\n\n<p>Or, if <code>sum</code> didn't require <code>x</code>, you could omit the explicit parameter to the function and use composition instead</p>\n\n<pre><code>total f = sum . map f\n</code></pre>\n\n<p>The composition operator is expecting a function, but you're fully applying <code>map</code> and passing the operator the list that <code>map</code> returned.</p>\n\n<p>(I'm unfamiliar with a sum function that would accept an int though along with a list. Is that an error as well?)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 55961962, "answer_count": 1, "score": 0, "last_activity_date": 1556891174, "creation_date": 1556844286, "last_edit_date": 1556879919, "question_id": 55961935, "link": "https://stackoverflow.com/questions/55961935/using-map-and-sum-to-apply-a-function-and-total-the-outcome", "title": "Using map and sum to apply a function and total the outcome", "body": "<p>I'm out of my element a bit. I've been using higher order functions and I'm trying to apply a function AND use (.) to combine functions. I'm trying to write a function total that applies the function (first argument) to every element in the list (second argument) and sums the result.</p>\n\n<p>I was given a specific type definition (which I'm not supposed to change) and I'm trying to <code>map</code> the function <code>f</code> to a list and then <code>sum</code> the returned list.</p>\n\n<pre><code> total :: (Int -&gt; Int) -&gt; [Int] -&gt; Int\n total f x = sum x . map f x\n</code></pre>\n\n<p>I should get an Int that's the <code>sum</code> of the total. I get an error but it's one I'm unfamiliar with:</p>\n\n<pre><code>* Couldn't match expected type `Int' with actual type `[Int] -&gt; c0'\n* Probable cause: `(.)' is applied to too few arguments\n  In the expression: sum x . map f\n  In an equation for `total': total f x = sum x . map f\n</code></pre>\n\n<p>I need direction. I don't understand why <code>.</code> should be applied to more arguments.</p>\n"}, {"tags": ["haskell", "io", "monads"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1556842383, "post_id": 55961714, "comment_id": 98574820, "body": "Sounds like you need <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:sequence\" rel=\"nofollow noreferrer\">sequence</a>. Or just use <code>mapM</code> instead of <code>fmap</code> / <code>&lt;$&gt;</code>"}, {"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556842686, "post_id": 55961714, "comment_id": 98574878, "body": "I swore I tried mapM and it gave the same error as map, but I was wrong. I feel very foolish."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1557320219, "post_id": 55961714, "comment_id": 98724534, "body": "can you please add the information that it now worked to the question or answer your own question or accept an answer that has been posted instead of just saying that you solved it in the comments"}], "answers": [{"tags": [], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "is_accepted": false, "score": 2, "last_activity_date": 1557319995, "last_edit_date": 1557319995, "creation_date": 1557180942, "answer_id": 56013071, "question_id": 55961714, "link": "https://stackoverflow.com/questions/55961714/haskell-binding-a-mapped-monadic-function/56013071#56013071", "title": "Haskell - binding a mapped monadic function", "body": "<p>This is because the function <code>tagsort</code> is of type <code>String -&gt; IO String</code><br>\nNote: I am using <code>IO</code> for simplicity and <code>String</code> for both <code>[Char]</code> and <code>FilePath</code>.</p>\n\n<p>However, when mapping it onto <code>filedir :: [String]</code> using</p>\n\n<pre><code>(&lt;$&gt;) = fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>a conflict occured between <code>IO [String]</code> and `[IO String] - the former is what the compiler expects an expression in a do block to be.</p>\n\n<p>This isn't very useful on first glance. However, haskell has a function called <code>sequence</code> for this exact task. Its constraints needn't matter much now, as <code>Foldable</code> is something completely different. For now, know that it can be of type <code>[IO a] -&gt; IO [a]</code></p>\n\n<p>Luckily again, there's a very useful predefined utility function, <code>mapM</code> just for <code>sequence . map f</code>.</p>\n\n<p>The final code will be:</p>\n\n<pre><code>mapM tagSort fileDirs\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557319995, "creation_date": 1556842091, "question_id": 55961714, "link": "https://stackoverflow.com/questions/55961714/haskell-binding-a-mapped-monadic-function", "title": "Haskell - binding a mapped monadic function", "body": "<p>Within this block of code here, I have a function tagsort that takes a FilePath and returns an IO String.</p>\n\n<pre><code>   builddir xs = do\n    writeto  &lt;- lastest getArgs\n    let folderl b = searchable &lt;$&gt; (getPermissions b)\n    let filel   c = ((lastlookup mlookup c) &amp;&amp;) &lt;$&gt; ((not &lt;$&gt; folderl c))\n    a &lt;- listDirectory xs\n    listdirs &lt;- filterM (folderl) (map ((xs ++ \"/\") ++) a)\n    filedirs &lt;- filterM (filel)   (map ((xs ++ \"/\") ++) a)\n    tagfiles &lt;- tagsort &lt;$&gt; filedirs\n--testprint to terminal\n    putStrLn $ concat listdirs\n    putStrLn $ concat tagfiles\n\n\ntagsort :: Control.Monad.IO.Class.MonadIO m =&gt; FilePath -&gt; m [Char]\ntagsort xs = do\n    nsartist &lt;- getTags xs artistGetter\n    nsalbum  &lt;- getTags xs albumGetter\n    let artist = init $ drop 8 $ show nsartist\n    let album  = init $ drop 7 $ show nsalbum\n    pure (artist ++ \" - \" ++ album)\n</code></pre>\n\n<p>I'd like to take this function and map it over a list of directories. When run, I get this error.</p>\n\n<pre><code>\u2022 Couldn't match type \u2018[]\u2019 with \u2018IO\u2019\n      Expected type: IO (t0 [Char])\n        Actual type: [t0 [Char]]\n    \u2022 In a stmt of a 'do' block: tagfiles &lt;- tagsort &lt;$&gt; filedirs\n</code></pre>\n\n<p>I believe I understand what is happening here. In order to bind in the way I desire to tagfiles, I would want an <code>IO [String]</code>, but instead mapping tagsort to the list filedirs produces <code>[IO String]</code>. I am not totally sure how to circumvent this or if it is even able to be circumvented at all. Perhaps mapping is not the correct way to do this? Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "concatenative-language"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1556835312, "post_id": 55960860, "comment_id": 98573339, "body": "Your last sentence seems like a completely different question to me. Consider removing it, and asking it as a separate question."}, {"owner": {"reputation": 198, "user_id": 3217109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee206f12f5d313f2f2bc3955d52d58b6?s=128&d=identicon&r=PG&f=1", "display_name": "Zylviij", "link": "https://stackoverflow.com/users/3217109/zylviij"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1556894249, "post_id": 55960860, "comment_id": 98594755, "body": "@amalloy I included the question about lazy-evaluation in this post because the two concepts are somewhat related. Usually a function&#39;s parameters aren&#39;t evaluated until the function needs to return a value, so I was wondering if that could affect how I have to represent partially applied function in my experimental language. -Thank you"}], "answers": [{"comments": [{"owner": {"reputation": 198, "user_id": 3217109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee206f12f5d313f2f2bc3955d52d58b6?s=128&d=identicon&r=PG&f=1", "display_name": "Zylviij", "link": "https://stackoverflow.com/users/3217109/zylviij"}, "edited": false, "score": 1, "creation_date": 1556906043, "post_id": 55961099, "comment_id": 98600511, "body": "Thank you very much. Your <a href=\"http://evincarofautumn.blogspot.com/2012/02/why-concatenative-programming-matters.html\" rel=\"nofollow noreferrer\">article</a> is one of the main reasons I&#39;m interested in concatenative programming!"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 3, "last_activity_date": 1556909400, "last_edit_date": 1556909400, "creation_date": 1556836616, "answer_id": 55961099, "question_id": 55960860, "link": "https://stackoverflow.com/questions/55960860/partial-function-application-in-concatenative-programming-languages/55961099#55961099", "title": "Partial Function Application in Concatenative Programming Languages", "body": "<p><code>swap [[&gt;] dip] filter</code> won\u2019t work because it assumes <code>n</code> is accessible for each call to the quotation by which you\u2019re filtering; that implies <code>filter</code> can\u2019t leave any intermediate values on the stack while it\u2019s operating, and <code>&gt;</code> doesn\u2019t consume <code>n</code>. You need to capture the value of <code>n</code> in that quotation.</p>\n\n<p>First \u201ceta\u201d-reduce the list parameter:</p>\n\n<pre><code>l n f = l [ n &gt; ] filter\nn f = [ n &gt; ] filter\n</code></pre>\n\n<p>Then capture <code>n</code> by explicitly quoting it and composing it with <code>&gt;</code>:</p>\n\n<pre><code>n f = n quote [ &gt; ] compose filter\n</code></pre>\n\n<p>(Assuming <code>quote : a -&gt; (-&gt; a)</code> a.k.a. <code>unit</code>, takes a value and wraps it in a quotation and <code>compose : (A -&gt; B) (B -&gt; C) -&gt; (A -&gt; C)</code> a.k.a. <code>cat</code>, concatenates two quotations.)</p>\n\n<p>Then just \u201ceta\u201d-reduce <code>n</code>:</p>\n\n<pre><code>f = quote [ &gt; ] compose filter\n</code></pre>\n\n<p>I put \u201ceta\u201d in scare quotes because it\u2019s a little more general than in lambda calculus, working for any number of values on the stack, not just one.</p>\n\n<p>You can of course factor out partial application into its own definition, e.g. the <code>papply</code> combinator in Cat, which is already defined as <code>swons</code> (<code>swap cons</code>) in Joy, but can also be defined like so:</p>\n\n<pre><code>DEFINE\n\n  papply (* x [F] -- [x F] *)\n    == [unit] dip concat ;\n\n  f (* xs n -- xs[&gt;=n] *)\n    == [&gt;] papply filter .\n</code></pre>\n\n<p>In Kitten this could be written in a few different ways, according to preference:</p>\n\n<pre><code>// Point-free\nfunction \\&gt; compose filter\n\n// Local variable and postfix\n-&gt; n; { n (&gt;) } filter\n\n// Local variable and operator section\n-&gt; n; \\(n &lt;) filter\n</code></pre>\n\n<p>Any evaluation strategy compatible with functional programming is also compatible with concatenative programming\u2014<a href=\"https://github.com/HackerFoo/poprc\" rel=\"nofollow noreferrer\">popr</a> is a lazy concatenative language.</p>\n"}], "owner": {"reputation": 198, "user_id": 3217109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee206f12f5d313f2f2bc3955d52d58b6?s=128&d=identicon&r=PG&f=1", "display_name": "Zylviij", "link": "https://stackoverflow.com/users/3217109/zylviij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 55961099, "answer_count": 1, "score": 2, "last_activity_date": 1556909400, "creation_date": 1556834768, "question_id": 55960860, "link": "https://stackoverflow.com/questions/55960860/partial-function-application-in-concatenative-programming-languages", "title": "Partial Function Application in Concatenative Programming Languages", "body": "<p>Say I have a haskell function <code>f n l = filter (n&lt;) l</code> where it takes an integer <code>n</code> and list <code>l</code> and returns all of the integers in <code>l</code> greater then <code>n</code>.</p>\n\n<p>I'm trying to figure out how to best write this function in a language like Joy. I've generally had good luck with converting the haskell function to pointfree form <code>f = filter . (&lt;)</code> and then trying to rewrite it in Joy from there. But I can't figure out how to simulate partial function application in a concatenative language.</p>\n\n<p>So far, I've tried to do something like <code>swap [[&gt;] dip] filter</code>, but it seems like there must be a better/cleaner way to write this.</p>\n\n<p>Also, I'm experimenting with writing my own concatenative language and was wondering if lazy-evaluation could be compatible with concatenative languages.</p>\n"}, {"tags": ["haskell", "io", "monads"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 8, "creation_date": 1556819627, "post_id": 55957712, "comment_id": 98567211, "body": "You will get much better error messages, and write much better questions, if you give every top-level definition a type signature. Also, when you&#39;re only giving a fragment of code please be sure to 1. Show your imports and 2. Give the type signatures of all the functions/values you wrote that are called/used in the fragment but not defined in it."}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1556819626, "post_id": 55957768, "comment_id": 98567208, "body": "Thank you for the quick response Jon! I think it is time for me to take a break for a bit, as now I can clearly see that in my test program that worked I had in fact used a let binding, which I did not in my main block of code. Not sure how I missed that!"}, {"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1556822201, "post_id": 55957768, "comment_id": 98568348, "body": "If I have another problem very related to this one, should I make an entirely new thread or simply ask it here?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 1, "creation_date": 1556829224, "post_id": 55957768, "comment_id": 98571306, "body": "@Sagarmatha New questions should be new questions."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 6, "last_activity_date": 1556819681, "last_edit_date": 1556819681, "creation_date": 1556819428, "answer_id": 55957768, "question_id": 55957712, "link": "https://stackoverflow.com/questions/55957712/haskell-getting-char-type-when-expecting-char-within-list-monad/55957768#55957768", "title": "Haskell - getting Char type when expecting [Char] within List Monad", "body": "<p>You\u2019re mixing up <code>IO</code> and <code>[]</code> in <code>tagsort</code>:</p>\n\n<pre><code>tagsort xs = do\n\n    -- Okay, run IO action and bind result to \u2018nsartist\u2019\n    nsartist &lt;- getTags xs artistGetter\n\n    -- Similarly for \u2018nsalbum\u2019\n    nsalbum  &lt;- getTags xs albumGetter\n\n    -- Mistaken: \u2018init \u2026\u2019 returns a list, not an \u2018IO\u2019 action\n    artist   &lt;- init $ drop 8 $ show nsalbum\n    album    &lt;- init $ drop 7 $ show nsalbum\n\n    -- You are also missing a \u2018pure\u2019 or \u2018return\u2019 here\n    (artist ++ \" - \" ++ album)\n</code></pre>\n\n<p>The fixes are simple: use a <code>let</code> statement instead of a bind statement <code>&lt;-</code>, and add a <code>pure</code> to make an <code>IO String</code> out of the <code>String</code> you have:</p>\n\n<pre><code>tagsort xs = do\n    nsartist &lt;- getTags xs artistGetter\n    nsalbum  &lt;- getTags xs albumGetter\n    let artist = init $ drop 8 $ show nsalbum\n    let album = init $ drop 7 $ show nsalbum\n    pure (artist ++ \" - \" ++ album)\n</code></pre>\n\n<p>Generally speaking, each <code>do</code> block must be in a single monad, until you start learning about using monad transformers to combine different effects. So in an <code>IO</code> block, anything on the right of a binding statement must be an <code>IO</code> action; if you just want to do pure computations, you can use <code>let</code> (or just inline expressions, if you don\u2019t need to bind something to a name). Finally, the last statement in a <code>do</code> block must also be an action in the particular monad\u2014this is often a pure value, just wrapped up in the monad with <code>pure :: Applicative f =&gt; a -&gt; f a</code> (or <code>return :: Monad m =&gt; a -&gt; m a</code>, which does the same thing but works in slightly fewer contexts because of the more restrictive <code>Monad</code> constraint).</p>\n"}], "owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 55957768, "answer_count": 1, "score": -1, "last_activity_date": 1556819681, "creation_date": 1556819152, "question_id": 55957712, "link": "https://stackoverflow.com/questions/55957712/haskell-getting-char-type-when-expecting-char-within-list-monad", "title": "Haskell - getting Char type when expecting [Char] within List Monad", "body": "<p>I am practising Haskell by trying to make a program that finds .mp3 and .flac metadata and writes it neatly to a file. I've gone this far on my own but I am pretty stumped at what I should be doing. Here is the main chunk of the code here:</p>\n\n<pre><code>builddir xs = do\n    writeto  &lt;- lastest getArgs\n    let folderl b = searchable &lt;$&gt; (getPermissions b)\n    let filel   c = ((lastlookup mlookup c) &amp;&amp;) &lt;$&gt; ((not &lt;$&gt; folderl c))\n    a &lt;- listDirectory xs\n    listdirs &lt;- filterM (folderl) (map ((xs ++ \"/\") ++) a)\n    filedirs &lt;- filterM (filel)   (map ((xs ++ \"/\") ++) a)\n    let tagfiles = mapM (tagsort) filedirs\n    putStrLn $ concat listdirs\n    putStrLn $ concat tagfiles\n\n\ntagsort xs = do\n    nsartist &lt;- getTags xs artistGetter\n    nsalbum  &lt;- getTags xs albumGetter\n    artist   &lt;- init $ drop 8 $ show nsalbum\n    album    &lt;- init $ drop 7 $ show nsalbum\n    (artist ++ \" - \" ++ album)\n</code></pre>\n\n<p>I know, it's very messy. When run in ghci, I get this:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018Char\u2019\n\u2022 In the first argument of \u2018(++)\u2019, namely \u2018artist\u2019\n  In a stmt of a 'do' block: artist ++ \" - \" ++ album\n  In the expression:\n    do nsartist &lt;- getTags xs artistGetter\n       nsalbum &lt;- getTags xs albumGetter\n       artist &lt;- init $ drop 8 $ show nsalbum\n       album &lt;- init $ drop 7 $ show nsalbum\n       ....\n       60    artist ++ \" - \" ++ album\n</code></pre>\n\n<p>I'm having trouble understanding why this is happening. Running a similar command in a test program of mine:</p>\n\n<pre><code>main = do\nartg &lt;- getTags \"/home/spilskinanke/backlogtest/02 - await rescue.mp3\" artistGetter\nlet test = init $ drop 8 $ show artg\nprint test\n</code></pre>\n\n<p>this works exactly fine. Prints the string \"65daysofstatic\" to my terminal in ghci. It clearly is not a Char type. So why is being called a Char in my code?\nAlso note that before adding any pieces of code that referenced the metadata module I am using (htaglib) this program ran fine in a test. With the tagfiles function and tagsort monad absent, I was able to set an arg for a certain directory, and my test would successfully print a list of FilePaths containing all readable folders, and another list of FilePaths containing all files ending in whatever I desired in mlookup, in this case being .mp3, .mp4, .flac, and .wav. Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 1, "creation_date": 1556892455, "post_id": 55957477, "comment_id": 98593690, "body": "typo <code>s&#47;slack&#47;stack&#47;</code>"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1556892564, "post_id": 55957477, "comment_id": 98593758, "body": "Just the one spot, yes?"}], "answers": [{"comments": [{"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1556892739, "post_id": 55971535, "comment_id": 98593861, "body": "When I do that, the effect is that all my tests write to the same file, called <code>test-results&#47;$test-suite.xml</code>."}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1556893007, "post_id": 55971535, "comment_id": 98594018, "body": "Well, actually, using that syntax they all write to <code>test-results&#47;-suite.xml</code>, because bash, but if I single-quote that bit you&#39;ve got double-quoted I get all the tests writing to <code>test-results&#47;$test-suite.xml</code>.  Also, I mentioned this in my question."}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "reply_to_user": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1556893588, "post_id": 55971535, "comment_id": 98594352, "body": "something like that <code>XX=&quot;--jxml=test-results&#47;$test-suite.xml&quot; YY=&quot;stack test --test-arguments=$XX&quot;  $YY</code>. It would be wise to rename <code>test-suite</code>. <a href=\"https://bash.cyberciti.biz/guide/Rules_for_Naming_variable_name\" rel=\"nofollow noreferrer\">See</a>"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1556894217, "post_id": 55971535, "comment_id": 98594730, "body": "But the <i>ACTUAL POINT</i>, in any case is that unlike cabal (which will substitute <code>$test-suite</code> for the test name when it runs each test), stack will do no such substitution. So I still get all of the tests writing to the same file, and overwriting each other&#39;s results"}], "tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": false, "score": -1, "last_activity_date": 1556892632, "creation_date": 1556892632, "answer_id": 55971535, "question_id": 55957477, "link": "https://stackoverflow.com/questions/55957477/get-stack-to-pass-test-suite-name-as-part-of-test-arguments/55971535#55971535", "title": "Get Stack to pass test suite name as part of --test-arguments", "body": "<p><code>stack test --test-arguments=\"--jxml=test-results/$test-suite.xml\"</code></p>\n"}, {"tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 1, "last_activity_date": 1557615169, "creation_date": 1557615169, "answer_id": 56094871, "question_id": 55957477, "link": "https://stackoverflow.com/questions/55957477/get-stack-to-pass-test-suite-name-as-part-of-test-arguments/56094871#56094871", "title": "Get Stack to pass test suite name as part of --test-arguments", "body": "<blockquote>\n  <p>I'd even accept some stack command that parsed the cabal file for me and told me what test suites there are, because then I could script a loop in bash calling each test one at a time.</p>\n</blockquote>\n\n<p>If you're willing to stoop to that, <code>stack ide targets</code> will return a list of targets, from which you can do some bashing to get the list of test suites. Something like this:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack ide targets 2&gt;&amp;1 |\n  while IFS=: read pkg type suite; do\n    [[ $type = test ]] &amp;&amp; stack test \":$suite\" --test-arguments=\"--jxml=test-results/$suite.xml\"\n  done\n</code></pre>\n"}], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 56094871, "answer_count": 2, "score": 5, "last_activity_date": 1557615169, "creation_date": 1556818046, "last_edit_date": 1556894241, "question_id": 55957477, "link": "https://stackoverflow.com/questions/55957477/get-stack-to-pass-test-suite-name-as-part-of-test-arguments", "title": "Get Stack to pass test suite name as part of --test-arguments", "body": "<p>It's possible, with cabal, to set up a continuous build that records test successes/failures in a format many CI systems will accept with a command like:</p>\n\n<pre><code>cabal test '--test-option=--jxml=test-results/$test-suite.xml'\n</code></pre>\n\n<p>The important part here is that <code>$test-suite</code> is replaced with the name of the test, so that different tests put their results into different files.</p>\n\n<p>When I use stack, all tests get literally the option <code>--jxml=test-results/$test-suite.xml</code> passed to them, so the end result is that the tests overwrite each others' results.</p>\n\n<p>Is there any way to run all my tests with <code>stack</code> so that I can tell each test suite a different place to write their results?</p>\n\n<p>I'd even accept some stack command that parsed the cabal file for me and told me what test suites there are, because then I could script a loop in bash calling each test one at a time.</p>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1556817907, "post_id": 55956853, "comment_id": 98566463, "body": "I don&#39;t understand the part &quot;I was writing my code with Control.Monad.Writer.Lazy using (,) [String] as my writer monad.&quot; If you are using the <code>(,) [String]</code> monad, you are not using <code>Control.Monad.Writer.Lazy</code>. I guess the <code>base</code> monad <code>(,) [String]</code> is isomorphic to <code>Control.Monad.Writer.Strict.Writer [String]</code> instead, which should loop on your code (once adapted)."}, {"owner": {"reputation": 445, "user_id": 8919942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df193de377da686960f0109f46a80bf2?s=128&d=identicon&r=PG", "display_name": "MorJ", "link": "https://stackoverflow.com/users/8919942/morj"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1556859550, "post_id": 55956853, "comment_id": 98577983, "body": "I god damn I read it all wrong. I thought this module only exported instances and methods, didn&#39;t notice the <code>Writer</code> itself. Time to test it out."}], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 8919942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df193de377da686960f0109f46a80bf2?s=128&d=identicon&r=PG", "display_name": "MorJ", "link": "https://stackoverflow.com/users/8919942/morj"}, "edited": false, "score": 1, "creation_date": 1556859233, "post_id": 55957487, "comment_id": 98577895, "body": "Oh thanks, I looked into the source code but didn&#39;t know about this behvaiour of <code>case .. of</code>"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1556818092, "creation_date": 1556818092, "answer_id": 55957487, "question_id": 55956853, "link": "https://stackoverflow.com/questions/55956853/haskell-tuple-monad-is-too-strict/55957487#55957487", "title": "Haskell tuple monad is too strict?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#line-436\" rel=\"nofollow noreferrer\">Hackage says</a></p>\n\n<pre><code>instance Monoid a =&gt; Monad ((,) a) where\n    (u, a) &gt;&gt;= k = case k a of (v, b) -&gt; (u &lt;&gt; v, b)\n</code></pre>\n\n<p>and this means they are strict  because of the <code>case</code> (unlike your <code>let (Writer w2 y) = f x</code>):</p>\n\n<pre><code>foldr1 (&gt;&gt;) $ repeat one\n= one &gt;&gt; foldr1 (&gt;&gt;) (repeat one)\n= ([\"goodbye\"], ()) &gt;&gt;= \\_ -&gt; foldr1 (&gt;&gt;) (repeat one)\n= case ((\\_ -&gt; foldr1 (&gt;&gt;) (repeat one)) ()) of (v, b) -&gt; ([\"goodbye\"] &lt;&gt; v, b)\n= case (foldr1 (&gt;&gt;) (repeat one)) of (v, b) -&gt; ([\"goodbye\"] &lt;&gt; v, b)\n</code></pre>\n\n<p>and this actually forces the nested <code>(foldr1 (&gt;&gt;) ...)</code> before you can ever access the <code>[\"goodbye\"] &lt;&gt; v</code> part.</p>\n\n<p>This is because <code>case</code> pattern matching is forcing but <code>let</code> patterns are lazy. Your code in effect writes the above as</p>\n\n<pre><code>= let (v, b) = foldr1 (&gt;&gt;) (repeat one) in ([\"goodbye\"] &lt;&gt; v, b)\n</code></pre>\n\n<p>and all is fine and lazy.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556832647, "post_id": 55959510, "comment_id": 98572574, "body": "<code>base</code> has some similarly unlawful instances, including <code>Bifunctor (,)</code> and <code>Arrow (-&gt;)</code>. I find it a bit distressing."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556835309, "post_id": 55959510, "comment_id": 98573336, "body": "@dfeuer: What\u2019s unlawful about them? For the <code>Arrow</code> instance <code>arr f = f; (f *** g) ~(x, y) = (f x, g y)</code>, does the lazy match make it more defined than it\u2019s supposed to be for <code>first (first f) &gt;&gt;&gt; arr assoc = arr assoc &gt;&gt;&gt; first f</code>? The definition of <code>assoc ((a, b), c) = (a, (b, c))</code> seems suspect in the first place."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1556837759, "post_id": 55959510, "comment_id": 98573936, "body": "@JonPurdy, okay, to be fair, I&#39;m not sure about <code>Arrow</code>, but I&#39;d certainly <i>expect</i> <code>first id = id</code>, which is not strictly satisfied."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556837842, "post_id": 55959510, "comment_id": 98573959, "body": "Another not-quite-monad in <code>base</code>: lazy <code>ST</code>."}, {"owner": {"reputation": 445, "user_id": 8919942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df193de377da686960f0109f46a80bf2?s=128&d=identicon&r=PG", "display_name": "MorJ", "link": "https://stackoverflow.com/users/8919942/morj"}, "edited": false, "score": 0, "creation_date": 1556860103, "post_id": 55959510, "comment_id": 98578101, "body": "That&#39;s a really nice answer, thanks! I always forget about the bottom."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 5, "last_activity_date": 1556828609, "last_edit_date": 1556828609, "creation_date": 1556827551, "answer_id": 55959510, "question_id": 55956853, "link": "https://stackoverflow.com/questions/55956853/haskell-tuple-monad-is-too-strict/55959510#55959510", "title": "Haskell tuple monad is too strict?", "body": "<p>That's because your <code>Writer</code> violates the monad laws. Look at this law:</p>\n\n<pre><code>-- forall (f :: a -&gt; Writer m b) (x :: a).\nreturn x &gt;&gt;= f = f x\n-- basically f (id x) = f x, which we should agree is pretty important!\n</code></pre>\n\n<p>But, alas, it doesn't hold! <code>let f = undefined</code>! (or <code>f = const undefined</code>; they are indistinguishable if you don't use <code>seq</code>)</p>\n\n<pre><code>  return x &gt;&gt;= undefined\n= Writer mempty x &gt;&gt;= undefined\n= let (Writer m y) = undefined\n  in  Writer (mempty &lt;&gt; m) y\n= Writer (mempty &lt;&gt; undefined) undefined\n</code></pre>\n\n<p>Yet, by law,</p>\n\n<pre><code>  return x &gt;&gt;= undefined\n= undefined x\n= undefined\n</code></pre>\n\n<p>These are not equivalent, therefore your lazy <code>Monad</code> instance is unlawful (and yes, I believe so is the one in <code>mtl</code>). However, <a href=\"https://www.cs.ox.ac.uk/jeremy.gibbons/publications/fast+loose.pdf\" rel=\"nofollow noreferrer\">Fast and Loose Reasoning is Morally Correct</a>, so we generally just accept it. The idea is that a lazy <code>Writer</code> monad generally follows the laws its supposed to, as long as you keep infinite or bottoming values out of it, but it breaks down at those edge cases. In contrast, the strict implementation is <em>completely</em> lawful, and that is why it is in <code>base</code>. However, as you've discovered, when lazy <code>Writer</code>s break the law, they do it in a useful manner, so we place the lazy implementation in <code>mtl</code>.</p>\n\n<p>Here is a <a href=\"https://repl.it/@howtonotwin/Writers\" rel=\"nofollow noreferrer\">demo of this behavior</a>. Notice that the lazy version produces a <code>Writer \"</code> in the output before blowing up, while both the strict version and the specification given by the law don't do so.</p>\n"}], "owner": {"reputation": 445, "user_id": 8919942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df193de377da686960f0109f46a80bf2?s=128&d=identicon&r=PG", "display_name": "MorJ", "link": "https://stackoverflow.com/users/8919942/morj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 55957487, "answer_count": 2, "score": 5, "last_activity_date": 1556828609, "creation_date": 1556815311, "question_id": 55956853, "link": "https://stackoverflow.com/questions/55956853/haskell-tuple-monad-is-too-strict", "title": "Haskell tuple monad is too strict?", "body": "<p>I was writing my code with <code>Control.Monad.Writer.Lazy</code> using <code>(,) [String]</code> as my writer monad. But I found that <code>(&gt;&gt;=)</code> and <code>(&gt;&gt;)</code> are too strict with the monoid operator? They cause infinte loop with this code for example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Wrtr a = ([String], a)\nwriter (x, w) = (w, x)\n\nmain :: IO ()\nmain = do\n    let one = writer ((), [\"goodbye\"])\n    let w = foldr1 (&gt;&gt;) $ repeat one\n    let (log, _) = w\n    mapM_ putStrLn . take 5 $ log\n\n</code></pre>\n\n<p>This code will loop endlessly and never print anything and it's bad for me. So for now I'm using this naive implementation of the same monad, which seems to be fine and lazy:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Writer w a = Writer w a\ninstance Functor (Writer w) where\n    fmap f (Writer w x) = Writer w (f x)\ninstance Monoid w =&gt; Applicative (Writer w) where\n    pure x = Writer mempty x\n    (Writer w1 f) &lt;*&gt; (Writer w2 x) = Writer (w1 &lt;&gt; w2) (f x)\ninstance Monoid w =&gt; Monad (Writer w) where\n    return = pure\n    (Writer w1 x) &gt;&gt;= f =\n        let (Writer w2 y) = f x\n        in Writer (w1 &lt;&gt; w2) y\nwriter (x, w) = Writer w x\n</code></pre>\n\n<p>(You have to define functor and applicative instances because of monoid constraint)</p>\n\n<p>If you then run the code with the same exact <code>main</code> function as above, it will print \"goodbye\" five times and exit.</p>\n\n<p>So the question is: why are tuples so strict? Or if it's not strictness, what is it and why is it there?</p>\n\n<p>BTW I'm using ghc 8.6.4 and everything else whihch comes with stack lts-13.19</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556815418, "post_id": 55956795, "comment_id": 98565469, "body": "It&#39;s easy enough to implement <code>max</code> as a fold. (I think any recursive function on a list can be done as a fold.) But you definitely can&#39;t do it with just <code>map</code> and/or <code>filter</code>. (Well I don&#39;t see how, someone might prove me wrong though :) )"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556815474, "post_id": 55956795, "comment_id": 98565493, "body": "Could I do it with foldr? I&#39;m trying to stick with foldr, map, and filter."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556815722, "post_id": 55956795, "comment_id": 98565591, "body": "Yes, you certainly can. Your accumulator is just the maximum &quot;so far&quot;. You probably want <code>foldr1</code> rather than <code>foldr</code> (it crashes on an empty list, but so does <code>max</code>)."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1556815796, "post_id": 55956795, "comment_id": 98565617, "body": "Just realised the function that finds the max value of a list is actually <code>maximum</code> (<code>max</code> takes 2 plain values and returns the greater)"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1556825660, "post_id": 55956795, "comment_id": 98569937, "body": "With the type signature you have, the only sensible thing that <code>max&#39; []</code> can return is \u22a5. If you can restructure your calling code so that this can have either <code>Ord a =&gt; NonEmpty a -&gt; a</code> or <code>Ord a =&gt; [a] -&gt; Maybe a</code> instead, then \u22a5 can be avoided."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556824235, "post_id": 55958650, "comment_id": 98569273, "body": "This doesn&#39;t typecheck."}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556824415, "post_id": 55958650, "comment_id": 98569359, "body": "Sorry, I was taking the type from the question, when what the questioner asked for obviously requires a different type.  Fixed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1556825809, "post_id": 55958650, "comment_id": 98569997, "body": "I doubt that was what they really intended."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "edited": false, "score": 0, "creation_date": 1556843492, "post_id": 55958650, "comment_id": 98575047, "body": "I found this super helpful, not sure why it was down-voted."}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1556843713, "post_id": 55958650, "comment_id": 98575083, "body": "I&#39;ve been having a downvote kind of day on here; see <a href=\"https://stackoverflow.com/q/55957477/107331\">stackoverflow.com/q/55957477/107331</a> . In this case, I answered the question I thought you were asking &quot;find all elements less than the maximum&quot;, not the question you did ask."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557141866, "post_id": 55958650, "comment_id": 98653962, "body": "@Francis <a href=\"https://stackoverflow.com/help/privileges/vote-up\"><i>&quot;Whenever you encounter a question, answer or comment that you feel is especially useful, vote it up!&quot;</i></a> &quot;Awarded at: 15 reputation&quot;"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557142097, "post_id": 55958650, "comment_id": 98654087, "body": "@DanielMartin &quot;to filter them <i>out</i>&quot; probably means <code>\\xs -&gt; filter (not . (&lt; maximum xs)) xs  =  \\xs -&gt; filter (maximum xs &lt;=) xs  =  filter =&lt;&lt; ((&lt;=) . maximum)</code>. :)"}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": false, "score": -1, "last_activity_date": 1556824374, "last_edit_date": 1556824374, "creation_date": 1556823547, "answer_id": 55958650, "question_id": 55956795, "link": "https://stackoverflow.com/questions/55956795/find-max-of-list-using-higher-order-function/55958650#55958650", "title": "Find max of list using higher order function", "body": "<p>So first off, as you discovered, what you wanted is:</p>\n\n<pre><code>max' :: Ord a =&gt; [a] -&gt; [a]\nmax' xs = filter (&lt; maximum xs) xs\n</code></pre>\n\n<p>If you are absolutely dedicated to pointfree style for some reason, and want to write using only higher-order functions, this will also work:</p>\n\n<pre><code>max' :: Ord a =&gt; [a] -&gt; [a]\nmax' = flip filter &lt;*&gt; ((&gt;) &lt;$&gt; maximum)\n</code></pre>\n\n<p>don't do that though, it's awful. Just repeat the argument twice.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1556826146, "last_edit_date": 1556826146, "creation_date": 1556825781, "answer_id": 55959135, "question_id": 55956795, "link": "https://stackoverflow.com/questions/55956795/find-max-of-list-using-higher-order-function/55959135#55959135", "title": "Find max of list using higher order function", "body": "<p>An empty list has no maximum element, so you can't write a total function with the type you've provided. A more sensible one is</p>\n\n<pre><code>maximum' :: Ord a =&gt; [a] -&gt; Maybe a\n</code></pre>\n\n<p>The easy way to do this is with <code>foldl'</code>:</p>\n\n<pre><code>maximum' = foldl' gom Nothing where\n  gom Nothing new = Just new\n  gom (Just old) new\n    | old &lt; new = Just new\n    | otherwise = Just old\n</code></pre>\n\n<p>But you want <code>foldr</code>. Since <code>foldl'</code> is actually defined in terms of <code>foldr</code>, this is easy!</p>\n\n<pre><code>foldl' f b0 xs = foldr gof id xs b0\n  where\n    gof x r b = b `seq` r (f b x)\n</code></pre>\n\n<p>Inlining,</p>\n\n<pre><code>maximum' xs = foldr gob id xs Nothing\n  where\n    --gob new r b = b `seq` r (gom b new)\n    gob new r b = seq b $ r $\n      case b of\n        Nothing -&gt; Just new\n        Just old\n          | old &lt; new -&gt; Just new\n          | otherwise -&gt; Just old\n</code></pre>\n\n<p>Doing a little manual strictness analysis, this simplifies to</p>\n\n<pre><code>maximum' xs = foldr gob id xs Nothing\n  where\n    gob new r b = r $!\n      case b of\n        Nothing -&gt; Just new\n        Just old\n          | old &lt; new -&gt; Just new\n          | otherwise -&gt; Just old\n</code></pre>\n\n<hr>\n\n<p>A small caution: if this is homework and you turn in my solution, your teacher will likely become suspicious. There's a much simpler way that's also much less efficient, but I'll let you search for it.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "accepted_answer_id": 55959135, "answer_count": 2, "score": 0, "last_activity_date": 1556826146, "creation_date": 1556815054, "question_id": 55956795, "link": "https://stackoverflow.com/questions/55956795/find-max-of-list-using-higher-order-function", "title": "Find max of list using higher order function", "body": "<p>I'm trying to use filter (though I can also use map and/or foldr) to find the max element of a list.</p>\n\n<p>I tried filtering out every number less than max but it refuses to accept max as a filter argument.</p>\n\n<p>Here's my code:</p>\n\n<pre><code> max' :: Ord a =&gt; [a] -&gt; a\n max' xs = filter (&lt; max) xs\n</code></pre>\n\n<p>Here's the error I get:</p>\n\n<pre><code>* Couldn't match type `a' with `a0 -&gt; a0 -&gt; a0'\n  `a' is a rigid type variable bound by\n    the type signature for:\n      max' :: forall a. Ord a =&gt; [a] -&gt; a\n    at Prog8.hs:50:1-25\n  Expected type: [a0 -&gt; a0 -&gt; a0]\n    Actual type: [a]\n* In the second argument of `filter', namely `xs'\n  In the expression: filter (&lt; max) xs\n  In an equation for max': max' xs = filter (&lt; max) xs\n* Relevant bindings include\n    xs :: [a] (bound at Prog8.hs:51:6)\n    max' :: [a] -&gt; a (bound at Prog8.hs:51:1)\n</code></pre>\n\n<p>Is there a way to write max' in a simple filter function (or maybe combine it with map or foldr)?</p>\n"}, {"tags": ["haskell", "random", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1556851219, "last_edit_date": 1556851219, "creation_date": 1556850338, "answer_id": 55962539, "question_id": 55956651, "link": "https://stackoverflow.com/questions/55956651/how-to-sample-rvart-in-io/55962539#55962539", "title": "How to sample RVarT in IO", "body": "<p>Yes, you're pretty much doing something unsound.  <code>MaybeT m a</code> is isomorphic to <code>m (Maybe a)</code> for any monad, including <code>m = RVar</code>, so a <code>MaybeT RVar a</code> is really just an <code>RVar (Maybe a)</code>, which is a representation of a random variable taking values in <code>Maybe a</code>.  Given this, it's easy enough to imagine sampling two <code>Maybe a</code>-valued random variables and combining them into a <code>Maybe (a,a)</code>-value random variable in the usual manner (i.e., if either or both are <code>Nothing</code>, the result is <code>Nothing</code>, and if they're <code>Just x</code> and <code>Just y</code> respectively, the result is <code>Just (x,y)</code>).  That's what your first chunk of code is doing.</p>\n\n<p>However, <code>RVarT Maybe a</code> is different.  It's a <code>a</code>-valued (<em>not</em> <code>Maybe a</code>-valued) random variable that can <strong>use the facilities of the base <code>Maybe</code> monad</strong> in generating its values, provided they can be lifted in some sensible way to the final monad in which the \"randomness\" of the random variable is realized.</p>\n\n<p>To understand what this means, we have to take a more detailed look at the types <code>RVar</code> and <code>RVarT</code>.</p>\n\n<p>The type <code>RVar a</code> represents an <code>a</code>-valued random variable.  In order to actually turn this representation into a real random value, you have to run it with:</p>\n\n<pre><code>runRVar :: RandomSource m s =&gt; RVar a -&gt; s -&gt; m a\n</code></pre>\n\n<p>This is a little too general, so imagine it being specialized to:</p>\n\n<pre><code>runRVar :: RVar a -&gt; StdRandom -&gt; IO a\n</code></pre>\n\n<p>Note that <code>StdRandom</code> is the only valid value of <code>StdRandom</code> here, so we'll always write <code>runRVar something StdRandom</code>, which can also be written <code>sample something</code>.</p>\n\n<p>With this specialization, you should view an <code>RVar a</code> as a <strong>monadic recipe for constructing a random variable using a limited set of randomization primitives</strong> that <code>runRVar</code> converts into <code>IO</code> actions that realize the randomization primitives with respect to a global random number generator.  This conversion to IO actions is what allows the recipe to generate an actual sampled random value.  If you're interested, you can find the limited set of randomization primitives in <a href=\"https://hackage.haskell.org/package/random-source-0.3.0.6/docs/Data-Random-Internal-Source.html#v:getRandomPrim\" rel=\"noreferrer\"><code>Data.Random.Internal.Source</code></a>.</p>\n\n<p>Similarly, <code>RVarT n a</code> is also an <code>a</code>-valued random variable (i.e., a recipe for constructing a random variable using a limited set of randomization primitives) that also has access to the \"facilities of another base monad <code>n</code>\".  This recipe can be run inside any final monad that can realize <em>both</em> the randomization primitives <em>and</em> the facilities of the base monad <code>n</code>.  In the general case, you run it with:</p>\n\n<pre><code>runRVarTWith :: MonadRandom m =&gt; \n    (forall t. n t -&gt; m t) -&gt; RVarT n a -&gt; s -&gt; m a\n</code></pre>\n\n<p>which takes an explicit lifting function that explains <em>how</em> to lift the facilities of the base monad <code>n</code> to the final monad <code>m</code>.</p>\n\n<p>If the base monad <code>n</code> is <code>Maybe</code>, then it's \"facilities\" are the ability to signal an error or failed computation.  You might use those facilities to construct the following somewhat silly random variable:</p>\n\n<pre><code>sqrtNormal :: RVarT Maybe Double\nsqrtNormal = do\n  z &lt;- stdNormalT\n  if z &lt; 0\n    then lift Nothing   -- use Maybe facilities to signal error\n    else return $ sqrt z\n</code></pre>\n\n<p>Note that, critically, <code>sqrtNormal</code> does not represent a <code>Maybe Double</code>-valued random variable to be generated.  Instead it represents <code>Double</code>-valued random variable whose generation can fail via the facilities of the base <code>Maybe</code> monad.</p>\n\n<p>In order to realize this random variable (i.e., sample it), we need to run it in an appropriate final monad.  The final monad needs to support both the randomization primitives <em>and</em> an appropriately lifted notion of failure from the <code>Maybe</code> monad.</p>\n\n<p>IO works fine, if the appropriate notion of failure is a runtime error:</p>\n\n<pre><code>liftMaybeToIO :: Maybe a -&gt; IO a\nliftMaybeToIO Nothing = error \"simulation failed!\"\nliftMaybeToIO (Just x) = return x\n</code></pre>\n\n<p>after which:</p>\n\n<pre><code>main1 :: IO ()\nmain1 = print =&lt;&lt; runRVarTWith liftMaybeToIO sqrtNormal StdRandom\n</code></pre>\n\n<p>generates the square root of a positive standard Gaussian about half the time and throws a runtime error the other half.</p>\n\n<p>If you want to capture failure in a pure form (as a <code>Maybe</code>, for example), then you need to consider realizing the <code>RVar</code> in an appropriate monad.  The monad:</p>\n\n<pre><code>MaybeT IO a\n</code></pre>\n\n<p>will do the trick.  It's isomorphic to <code>IO (Maybe a)</code>, so it has IO facilities available (needed to realize the randomization primitives) and is capable of signaling failure by returning <code>Nothing</code>.  If we write:</p>\n\n<pre><code>main2 :: IO ()\nmain2 = print =&lt;&lt; runMaybeT act\n  where act :: MaybeT IO Double\n        act = sampleRVarTWith liftMaybe sqrtNormal\n</code></pre>\n\n<p>we'll get an error that there's no instance for <code>MonadRandom (MaybeT IO)</code>.  We can create one as follows:</p>\n\n<pre><code>import Control.Monad.Trans (liftIO)\ninstance MonadRandom (MaybeT IO) where\n  getRandomPrim = liftIO . getRandomPrim\n</code></pre>\n\n<p>together with an appropriate lifting function:</p>\n\n<pre><code>liftMaybe :: Maybe a -&gt; MaybeT IO a\nliftMaybe = MaybeT . return\n</code></pre>\n\n<p>After which, <code>main2</code> will return <code>Nothing</code> about half the time and <code>Just</code> the square root of a positive Gaussian the other half.</p>\n\n<p>The full code:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Control.Monad.Trans (liftIO)\nimport Control.Monad.Trans.Maybe (MaybeT(..))\nimport Data.Random\nimport Data.Random.Lift\nimport Data.Random.Internal.Source\n\nsqrtNormal :: RVarT Maybe Double\nsqrtNormal = do\n  z &lt;- stdNormalT\n  if z &lt; 0\n    then lift Nothing   -- use Maybe facilities to signal error\n    else return $ sqrt z\n\nliftMaybeToIO :: Maybe a -&gt; IO a\nliftMaybeToIO Nothing = error \"simulation failed!\"\nliftMaybeToIO (Just x) = return x\n\nmain1 :: IO ()\nmain1 = print =&lt;&lt; runRVarTWith liftMaybeToIO sqrtNormal StdRandom\n\ninstance MonadRandom (MaybeT IO) where\n  getRandomPrim = liftIO . getRandomPrim\n\nmain2 :: IO ()\nmain2 = print =&lt;&lt; runMaybeT act\n  where act :: MaybeT IO Double\n        act = runRVarTWith liftMaybe sqrtNormal StdRandom\n        liftMaybe :: Maybe a -&gt; MaybeT IO a\n        liftMaybe = MaybeT . return\n</code></pre>\n\n<p>The way this would all apply to your second example would look something like this, which will always print <code>Nothing</code>:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Control.Monad.Trans (liftIO)\nimport Control.Monad.Trans.Maybe (MaybeT(..))\nimport Data.Random\nimport Data.Random.Lift\nimport Data.Random.Internal.Source\n\nreverseMaybeRandSome :: RVarT Maybe Int\nreverseMaybeRandSome = return 1\n\nreverseMaybeRandNone :: RVarT Maybe Int\nreverseMaybeRandNone = lift Nothing\n\nreverseMaybeTwoRands :: RVarT Maybe (Int, Int)\nreverseMaybeTwoRands =\n  do\n    x &lt;- reverseMaybeRandSome\n    y &lt;- reverseMaybeRandNone\n    return (x, y)\n\ninstance MonadRandom (MaybeT IO) where\n  getRandomPrim = liftIO . getRandomPrim\n\nrunRVarTMaybe :: RVarT Maybe a -&gt; IO (Maybe a)\nrunRVarTMaybe act = runMaybeT $ runRVarTWith liftMaybe act StdRandom\n  where\n    liftMaybe :: Maybe a -&gt; MaybeT IO a\n    liftMaybe = MaybeT . return\n\nmain :: IO ()\nmain = print =&lt;&lt; runRVarTMaybe reverseMaybeTwoRands\n</code></pre>\n"}], "owner": {"reputation": 563, "user_id": 465398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb2047aaf15653beea6ba8299c8ff08?s=128&d=identicon&r=PG", "display_name": "Samuel Rivas", "link": "https://stackoverflow.com/users/465398/samuel-rivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 55962539, "answer_count": 1, "score": 1, "last_activity_date": 1556851219, "creation_date": 1556814473, "question_id": 55956651, "link": "https://stackoverflow.com/questions/55956651/how-to-sample-rvart-in-io", "title": "How to sample RVarT in IO", "body": "<p>I am having difficulties wrapping my brain around <code>RVarT</code> in random-fu. Just as a mental exercise I am trying to generate <code>Maybe x</code> randomly and combining them in <code>Maybe (x, x)</code>, using monad transformers</p>\n\n<p>I have manged to pull this off, which seems intuitive to me</p>\n\n<pre><code>maybeRandSome :: (MaybeT RVar) Int\nmaybeRandSome = lift $ return 1\n\nmaybeRandNone :: (MaybeT RVar) Int\nmaybeRandNone = MaybeT . return $ Nothing\n\nmaybeTwoRands :: (MaybeT RVar) (Int, Int)\nmaybeTwoRands =\n  do\n    x &lt;- maybeRandSome\n    y &lt;- maybeRandNone\n    return (x, y)\n</code></pre>\n\n<p>And can sample them in IO doing this</p>\n\n<pre><code>&gt; sample $ runMaybeT maybeTwoRands\nNothing\n</code></pre>\n\n<p>However I cannot figure out if the reverse is possible:</p>\n\n<pre><code>reverseMaybeRandSome :: (RVarT Maybe) Int\nreverseMaybeRandSome = lift $ Just 1\n\nreverseMaybeRandNone :: (RVarT Maybe) Int\nreverseMaybeRandNone = lift Nothing\n\nreverseMaybeTwoRands :: (RVarT Maybe) (Int, Int)\nreverseMaybeTwoRands =\n  do\n    x &lt;- Random.sample reverseMaybeRandSome\n    y &lt;- Random.sample reverseMaybeRandNone\n    return (x, y)\n</code></pre>\n\n<p>Which requires me to lift from <code>Maybe m</code> to <code>MonadRandom m</code> somehow, and I can't figure out if that makes sense or if I am doing something unsound to begin with.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1556867749, "post_id": 55957705, "comment_id": 98580688, "body": "There is something I don&#39;t get, I know they are saying  Value Constructor etc... but I don&#39;t understand why I couldn&#39;t consider for example the sum type Either[Error,String] in 2 types Left[Error,String] or Right[Error,String]... They are a Set of values at the end, aren&#39;t they ? It looks like the border they have done between types and values is not cut in the right place... Because, @chepner with your solution I have the impression I&#39;m twisting the language a bit... In my example,  CreateWorkspace and RenameWorkspace are types naturally but at the same time they are GSDCommand..."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1556868055, "post_id": 55957705, "comment_id": 98580826, "body": "I hesitated to use a typeclass GSDCommand instead of a Sum type, but I&#39;m loosing some features like the pattern matching etc... I would love to find some information about this issue..."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1556819114, "creation_date": 1556819114, "answer_id": 55957705, "question_id": 55956320, "link": "https://stackoverflow.com/questions/55956320/promoting-data-record-types/55957705#55957705", "title": "Promoting Data Record Types", "body": "<p><code>DataKinds</code> creates new kinds and values, but does not change the type of a value. A <code>CreateWorkspace</code> value still has type <code>GsdCommand</code>, not type <code>'CreateWorkspace</code>. </p>\n\n<p>One option would be to use a phantom type, which wouldn't require the <code>DataKinds</code> extension.</p>\n\n<pre><code>data CreateWorkspace\ndata RenameWorkspace\n\ndata GsdCommand t = GsdCommand CommandID WorkspaceID Text\n\nhandle :: Offset -&gt; GsdCommand CreateWorkspace -&gt; IO CommandHandlingResult\nhandle o (GsdCommand cmdID wkspID wkspName) = ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 40613, "user_id": 4099593, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zweIW.png?s=128&g=1", "display_name": "Bhargav Rao", "link": "https://stackoverflow.com/users/4099593/bhargav-rao"}, "edited": false, "score": 1, "creation_date": 1556904528, "post_id": 55965916, "comment_id": 98599954, "body": "Please don&#39;t update the question to add an answer. Add it in the answer itself. Also, don&#39;t post a screenshot of a book as an answer. Kindly write the answer in your own words and provide the name of the book as a reference."}], "tags": [], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "is_accepted": false, "score": 0, "last_activity_date": 1556871805, "creation_date": 1556871805, "answer_id": 55965916, "question_id": 55956320, "link": "https://stackoverflow.com/questions/55956320/promoting-data-record-types/55965916#55965916", "title": "Promoting Data Record Types", "body": "<p>I've added the solution in the question itself but basically I have to pass on the Class-based way of expressing the problem instead of using the Alternation-based (use of Sum Types...) and trying to play with promoting values...</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1556904459, "creation_date": 1556813160, "last_edit_date": 1556904459, "question_id": 55956320, "link": "https://stackoverflow.com/questions/55956320/promoting-data-record-types", "title": "Promoting Data Record Types", "body": "<p>Let's say we have the following datatype</p>\n\n<pre><code>data GsdCommand =  CreateWorkspace { commandId :: CommandId , workspaceId ::WorkspaceId , workspaceName :: Text }\n             | RenameWorkspace { commandId :: CommandId , workspaceId ::WorkspaceId , workspaceNewName :: Text }\n</code></pre>\n\n<p>I want to have a function that only take a <code>CreateWorkspace</code> :</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\nhandle :: Offset -&gt;\n          `CreateWorkspace CommandId WorkspaceId Text  -&gt;\n          IO (CommandHandlingResult)\n</code></pre>\n\n<p>That's the way I would do it naturally but I have the following compiler error : </p>\n\n<pre><code>Expected a type, but\u2018 'CreateWorkspace CommandId WorkspaceId Text\u2019 has kind \u2018GsdCommand\u2019\nExpected kind \u2018CommandId\u2019, but \u2018CommandId\u2019 has kind \u2018*\u2019\nExpected kind \u2018WorkspaceId\u2019, but \u2018WorkspaceId\u2019 has kind \u2018*\u2019\nExpected kind \u2018Text\u2019, but \u2018Text\u2019 has kind \u2018*\u2019\n</code></pre>\n\n<p>this is the context :</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE NamedFieldPuns #-}\nmodule Eventuria.GSD.Write.CommandConsumer.Handling.HandleGSDCommand (handleGSDCommand) where\n\nimport           Eventuria.Libraries.PersistedStreamEngine.Interface.PersistedItem\n\nimport           Eventuria.Libraries.CQRS.Write.CommandConsumption.Definitions\nimport           Eventuria.Libraries.CQRS.Write.CommandConsumption.CommandHandlingResult\n\n\nimport           Eventuria.GSD.Write.Model.WriteModel\nimport           Eventuria.GSD.Write.Model.Commands.Command\nimport           Eventuria.GSD.Write.CommandConsumer.Handling.CommandPredicates\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.CreateWorkspace          as CreateWorkspace\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.RenameWorkspace          as RenameWorkspace\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.SetGoal                  as SetGoal\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.RefineGoalDescription    as RefineGoalDescription\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.StartWorkingOnGoal       as StartWorkingOnGoal\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.PauseWorkingOnGoal       as PauseWorkingOnGoal\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.NotifyGoalAccomplishment as NotifyGoalAccomplishment\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.GiveUpOnGoal             as GiveUpOnGoal\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.ActionizeOnGoal          as ActionizeOnGoal\nimport qualified Eventuria.GSD.Write.CommandConsumer.Handling.Commands.NotifyActionCompleted    as NotifyActionCompleted\n\ntype GSDCommandHandler  = Maybe GsdWriteModel -&gt;\n                         (Persisted GsdCommand) -&gt;\n                         IO (CommandHandlingResult)\n\nhandleGSDCommand :: HandleCommand GsdWriteModel\nhandleGSDCommand writeModelMaybe\n               PersistedItem {offset , item = command }\n  | (isFirstCommand offset) &amp;&amp; (not . isCreateWorkspaceCommand) command = return $ CommandRejected \"CreateWorkspace should be the first command\"\n  | otherwise =   gsdCommandHandler writeModelMaybe PersistedItem {offset , item = (fromCommand command) }\n\ngsdCommandHandler :: GSDCommandHandler\ngsdCommandHandler\n        writeModelMaybe\n        PersistedItem {offset , item = gsdCommand } =\n  case (writeModelMaybe, gsdCommand) of\n     (Nothing        ,CreateWorkspace          {commandId, workspaceId, workspaceName})                   -&gt; CreateWorkspace.handle          offset            commandId workspaceId workspaceName\n     (Just writeModel,RenameWorkspace          {commandId, workspaceId, workspaceNewName})                -&gt; RenameWorkspace.handle          offset writeModel commandId workspaceId workspaceNewName\n     (Just writeModel,SetGoal                  {commandId, workspaceId, goalId, goalDescription})         -&gt; SetGoal.handle                  offset writeModel commandId workspaceId goalId goalDescription\n     (Just writeModel,RefineGoalDescription    {commandId, workspaceId, goalId, refinedGoalDescription})  -&gt; RefineGoalDescription.handle    offset writeModel commandId workspaceId goalId refinedGoalDescription\n     (Just writeModel,StartWorkingOnGoal       {commandId, workspaceId, goalId})                          -&gt; StartWorkingOnGoal.handle       offset writeModel commandId workspaceId goalId\n     (Just writeModel,PauseWorkingOnGoal       {commandId, workspaceId, goalId})                          -&gt; PauseWorkingOnGoal.handle       offset writeModel commandId workspaceId goalId\n     (Just writeModel,NotifyGoalAccomplishment {commandId, workspaceId, goalId})                          -&gt; NotifyGoalAccomplishment.handle offset writeModel commandId workspaceId goalId\n     (Just writeModel,GiveUpOnGoal             {commandId, workspaceId, goalId, reason})                  -&gt; GiveUpOnGoal.handle             offset writeModel commandId workspaceId goalId reason\n     (Just writeModel,ActionizeOnGoal          {commandId, workspaceId, goalId, actionId, actionDetails}) -&gt; ActionizeOnGoal.handle          offset writeModel commandId workspaceId goalId actionId actionDetails\n     (Just writeModel,NotifyActionCompleted    {commandId, workspaceId, goalId, actionId})                -&gt; NotifyActionCompleted.handle    offset writeModel commandId workspaceId goalId actionId\n     (_            ,_)                                                                                    -&gt; return $ CommandRejected \"Scenario not handle\"\n</code></pre>\n\n<p>I have to pattern match the fields and pass them to the handles....</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1556808124, "post_id": 55954682, "comment_id": 98561601, "body": "Best in terms how long it takes? or how much memory it requires? or ease of writing the code?"}, {"owner": {"reputation": 23, "user_id": 10255887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2915bdc5d5f64cf239284336e9741483?s=128&d=identicon&r=PG&f=1", "display_name": "Laurens", "link": "https://stackoverflow.com/users/10255887/laurens"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1556808235, "post_id": 55954682, "comment_id": 98561665, "body": "@chepner my primary concern is time, but the other ones are also important"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1556808504, "post_id": 55954682, "comment_id": 98561823, "body": "Try both and measure. Although tbh I suspect with such a small set it&#39;s not going to make a huge difference either way."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556815703, "post_id": 55955037, "comment_id": 98565586, "body": "Wait, what? An unboxed <code>MArray</code> of <code>Bool</code> makes sense. And unboxed <code>MVector</code> of <code>Bool</code> stores one value per <i>byte</i>. Using immutable arrays or <code>Integer</code> for this sounds pretty inefficient to me given the size."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556816017, "post_id": 55955037, "comment_id": 98565695, "body": "@dfeuer I didn&#39;t suggest using an <code>MVector</code> of <code>Bool</code>, so that one appears to be a strawman. As for efficiency, I guess it&#39;s probably worth doing some profiling after all. In any case <code>Integer</code> should be quite space-efficient: I compute roughly 2.5kb for an <code>Integer</code>, whereas a <code>Set Int</code> or <code>HashSet Int</code> is likely to be in the hundreds of kb range."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1556816118, "post_id": 55955037, "comment_id": 98565737, "body": "Sorry, I assumed that you included <code>MVector</code> in the generic &quot;mutable array&quot;. I would recommend neither <code>Set Int</code> nor <code>HashSet Int</code>. But <code>IntSet</code> is another story altogether, since it&#39;s a tree of bitsets. I&#39;ll explain in my answer how to avoid initialization cost for <code>IntSet</code> if that&#39;s important."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1556809099, "last_edit_date": 1556809099, "creation_date": 1556808665, "answer_id": 55955037, "question_id": 55954682, "link": "https://stackoverflow.com/questions/55954682/do-i-need-a-hashset-or-a-set/55955037#55955037", "title": "Do I need a HashSet or a Set?", "body": "<p>Use a bitset (a.k.a. <code>Integer</code>). A <code>1</code> bit represents a value still in the set; a <code>0</code> bit represents one that just ain't there. For example, the <code>Integer</code> that represents having all the numbers from <code>1</code> to <code>n</code> would be <code>bit (n+1) - 2</code> (assuming you plan to use 0-indexing, as seems sensible to me); to check whether a number is in the set, use <code>testBit</code>; to remove a number, use <code>clearBit</code>.</p>\n\n<p>An alternate implementation strategy for the same underlying idea would be to use an unboxed array of <code>Bool</code>, either mutable or immutable as needed. The unboxed versions do the appropriate bit-packing. The only downside would be possibly having to resize the array if you need to add numbers to the set later that are larger than you originally allocated space for.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1556905396, "last_edit_date": 1556905396, "creation_date": 1556816226, "answer_id": 55957064, "question_id": 55954682, "link": "https://stackoverflow.com/questions/55954682/do-i-need-a-hashset-or-a-set/55957064#55957064", "title": "Do I need a HashSet or a Set?", "body": "<p>If you want to stick to immutable data structures, I would recommend <code>IntSet</code>. It's carefully optimized for precisely this kind of thing. A <code>Set Int</code> is a balanced binary search tree of <code>Int</code>s, which takes a lot of space and a good bit of time. A <code>HashSet Int</code> is an array-mapped trie of <code>Int</code>s, which is likely faster and more compact, but still pretty mediocre. An <code>IntSet</code> is a PATRICIA tree whose leaves are bitsets. So it's pretty compact (a little over twice the size of an unboxed immutable array when full), but much more efficient to modify.</p>\n\n<p>Initializing an <code>IntSet</code> with all <code>Int</code>s from <code>1</code> to <code>n</code> takes <code>O(n)</code> time. If you're only initializing once, or once in a while, and <code>n &lt; 20000</code>, then that shouldn't cause any performance trouble. If, however, you need to initialize often (especially if you sometimes only remove a few elements before discarding the set), or <code>n</code> turns out to be much larger (e.g., hundreds of millions) and you want to cut down on initialization time, you can use <code>IntSet</code> to represent the <em>complement</em> of the set you want to store.</p>\n\n<pre><code>data CompSet = CompSet\n  { initialMax :: !Int\n  , size :: !Int\n  , missingElements :: !IntSet\n  }\n</code></pre>\n\n<p>A <code>CompSet</code> stores the initial maximum (<code>n</code>), and an <code>IntSet</code> indicating which elements in <code>[1..initialMax]</code> are <em>no longer</em> in the set. The size of the <code>CompSet</code> is initialized to <code>initialMax</code> and lets you know in <code>O(1)</code> time whether the set is empty (i.e., when <code>size missingElements = initialMax</code>).</p>\n"}], "owner": {"reputation": 23, "user_id": 10255887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2915bdc5d5f64cf239284336e9741483?s=128&d=identicon&r=PG&f=1", "display_name": "Laurens", "link": "https://stackoverflow.com/users/10255887/laurens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 55955037, "answer_count": 2, "score": 0, "last_activity_date": 1556905396, "creation_date": 1556807529, "question_id": 55954682, "link": "https://stackoverflow.com/questions/55954682/do-i-need-a-hashset-or-a-set", "title": "Do I need a HashSet or a Set?", "body": "<p>I want to initialise a set of all Ints from 1 to n (n&lt;20000). Then I want to remove them one by one and meanwhile check if certain elements are still in it until the set is empty.</p>\n\n<p>Which data structure is suited best for this task?</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1556803763, "post_id": 55953490, "comment_id": 98559023, "body": "<a href=\"https://stackoverflow.com/questions/53057923/defining-foldl-in-terms-of-foldr\"><code>foldl</code> can be defined in terms of <code>foldr</code></a>, so yes."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1556803843, "post_id": 55953490, "comment_id": 98559075, "body": "<a href=\"https://wiki.haskell.org/Foldl_as_foldr\" rel=\"nofollow noreferrer\"><code>foldr</code> can also be written in terms of <code>foldl</code></a>, but only for finite lists."}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1556815419, "post_id": 55953630, "comment_id": 98565470, "body": "Surely <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#foldl1\" rel=\"nofollow noreferrer\"><code>foldl1</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#foldr1\" rel=\"nofollow noreferrer\"><code>foldr1</code></a> are cheating?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1556815635, "post_id": 55953630, "comment_id": 98565557, "body": "In a sense, yes - but since they can be rewritten in terms of &quot;plain&quot; <code>foldl</code> and <code>foldr</code> (except for empty lists, but then <code>head</code> and <code>tail</code> crash too) I don&#39;t see how you can say this isn&#39;t a solution. It&#39;s not particularly clear what motivates the OP&#39;s question, other than simple curiosity, so I can&#39;t say whether this is acceptable or not. But it seems ok to me."}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 1, "last_activity_date": 1556803863, "creation_date": 1556803863, "answer_id": 55953630, "question_id": 55953490, "link": "https://stackoverflow.com/questions/55953490/finding-head-of-a-list-using-foldl-and-the-last-element-using-foldr/55953630#55953630", "title": "Finding head of a list using foldl and the last element using foldr", "body": "<p>The first thing that springs to mind is to use <code>foldl1</code> instead of <code>foldl</code>, then:</p>\n\n<pre><code>head'' :: [a] -&gt; a\nhead'' = foldl1 (\\x _ -&gt; x)\n</code></pre>\n\n<p>and since <code>foldl1</code> is defined in terms of <code>foldl</code> if the list is non-empty (and crashes if the list is empty - but so does <code>head</code>):</p>\n\n<pre><code>foldl1 f (x:xs) = foldl f x xs\n</code></pre>\n\n<p>we can say</p>\n\n<pre><code>head'' (x:xs) = foldl (\\x _ -&gt; x) x xs\n</code></pre>\n\n<p>The same of course for <code>last</code>, using <code>foldr1</code></p>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 3, "last_activity_date": 1556900545, "last_edit_date": 1556900545, "creation_date": 1556819419, "answer_id": 55957763, "question_id": 55953490, "link": "https://stackoverflow.com/questions/55953490/finding-head-of-a-list-using-foldl-and-the-last-element-using-foldr/55957763#55957763", "title": "Finding head of a list using foldl and the last element using foldr", "body": "<p><code>head</code> cannot be written with <code>foldl</code>, because <code>foldl</code> goes into an infinite loop on infinite lists, while <code>head</code> doesn't. Otherwise, sure:</p>\n\n<pre><code>head' :: [a] -&gt; a\nhead' = fromJust . foldl (\\y x -&gt; y &lt;|&gt; Just x) Nothing\n</code></pre>\n\n<p>Drop the <code>fromJust</code> for a safe version.</p>\n\n<p><code>last</code> can definitely be written as a <code>foldr</code>, in about the same way:</p>\n\n<pre><code>last' :: [a] -&gt; a\nlast' = fromJust . foldr (\\x y -&gt; y &lt;|&gt; Just x) Nothing\n</code></pre>\n\n<p>For <code>head</code>, we start with <code>Nothing</code>. The first element (the wanted one) is wrapped into <code>Just</code> and used to \"override\" the <code>Nothing</code> with <code>(&lt;|&gt;)</code>. The following elements are ignored. For <code>last</code>, it's about the same, but flipped.</p>\n"}], "owner": {"reputation": 39, "user_id": 11441910, "user_type": "registered", "profile_image": "https://graph.facebook.com/2280162792027047/picture?type=large", "display_name": "Adrian Kozie\u0144", "link": "https://stackoverflow.com/users/11441910/adrian-kozie%c5%84"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 976, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1556900856, "creation_date": 1556803425, "last_edit_date": 1556900856, "question_id": 55953490, "link": "https://stackoverflow.com/questions/55953490/finding-head-of-a-list-using-foldl-and-the-last-element-using-foldr", "title": "Finding head of a list using foldl and the last element using foldr", "body": "<p>It is known that we can find <em>head</em> of a list using <code>foldr</code> like this:</p>\n\n<pre><code>head'' :: [a] -&gt; a\nhead'' = foldr (\\x _ -&gt; x) undefined\n</code></pre>\n\n<p>but, is there any way to get the same result using <strong><em><code>foldl</code></em></strong>?</p>\n\n<p>Similarly, we can find the <em>last</em> element of list using <code>foldl</code> like this:</p>\n\n<pre><code>last'' :: [a] -&gt; a\nlast'' = foldl (\\_ x -&gt; x) undefined\n</code></pre>\n\n<p>Is there any way to get the same result using <strong><em><code>foldr</code></em></strong>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1556799096, "post_id": 55952131, "comment_id": 98556178, "body": "What type should the function <code>lastButOne</code> be? This might help you see what the problem is."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1556799097, "post_id": 55952131, "comment_id": 98556180, "body": "I agree, this error message is a bit cryptic. You can see the fundamental problem though if you look up the type signatures of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:head\" rel=\"nofollow noreferrer\">head</a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#tail\" rel=\"nofollow noreferrer\">tail</a>. One returns a single element, the other a list. GHC&#39;s error message is basically complaining that it&#39;s trying, and obviously failing, to find a type which can be both of those at once."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1556801957, "post_id": 55952131, "comment_id": 98557949, "body": "Adding an explicit type signature <code>lastButOne :: [a] -&gt; ...</code> would have helped the compiler in identifying the issue, and providing a better error message. It is strongly recommended to start writing a function from its type."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 11441228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2eade32d4e24136b3696450e2ed51940?s=128&d=identicon&r=PG&f=1", "display_name": "ADW", "link": "https://stackoverflow.com/users/11441228/adw"}, "edited": false, "score": 0, "creation_date": 1556805980, "post_id": 55952209, "comment_id": 98560372, "body": "I understand what you say. Bacause my function use &quot;head&quot; and &quot;tail&quot; simultaneously, lead to ghci type check confusion. I use recurse becase it a easy and obviously methon to achieve. when I learn Lisp, recurse is regular. can you tell me situation about haskll? And thanks your response."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 25, "user_id": 11441228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2eade32d4e24136b3696450e2ed51940?s=128&d=identicon&r=PG&f=1", "display_name": "ADW", "link": "https://stackoverflow.com/users/11441228/adw"}, "edited": false, "score": 1, "creation_date": 1556806826, "post_id": 55952209, "comment_id": 98560875, "body": "Possibly even more so than in Lisp, recursion is your <i>only</i> option for any type of iterative computation."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1556799144, "creation_date": 1556799144, "answer_id": 55952209, "question_id": 55952131, "link": "https://stackoverflow.com/questions/55952131/my-function-return-last-list-has-an-error/55952209#55952209", "title": "My function return last list has an error", "body": "<p><code>lastButOne</code> has intended type <code>[a] -&gt; a</code>, but with <code>tail x</code> you are trying to return a value of type <code>[a]</code>. The error message results from the type checker's attempt to find a type which unifies with both <code>a</code> and <code>[a]</code>, in an attempt to make sense of a function that returns one or the other depending on which branch is taken.</p>\n\n<p>What you want to do is <em>recurse</em> on the tail of the list:</p>\n\n<pre><code>lastButOne x = if length x == 2\n               then head x\n               else lastButOne (tail x)\n</code></pre>\n\n<p>This is more naturally written using pattern matching, though.</p>\n\n<pre><code>lastButOne [x,_] = x  -- lists of length exactly 2\nlastButOne (_:xs) = lastButOne xs -- All other non-empty lists\n</code></pre>\n\n<p>Note <code>lastButOne</code> simply is not defined for empty or singleton lists, and will produce a run-time error if called on such. You can fix that by altering the return to <code>Maybe a</code>:</p>\n\n<pre><code>lastButOne :: [a] -&gt; Maybe a\nlastButOne [x,_] = Just x\nlastButOne (_:xs) = lastButOne xs\nlastButOne _ = Nothing\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 11441228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2eade32d4e24136b3696450e2ed51940?s=128&d=identicon&r=PG&f=1", "display_name": "ADW", "link": "https://stackoverflow.com/users/11441228/adw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 55952209, "answer_count": 1, "score": 2, "last_activity_date": 1556802494, "creation_date": 1556798881, "last_edit_date": 1556802494, "question_id": 55952131, "link": "https://stackoverflow.com/questions/55952131/my-function-return-last-list-has-an-error", "title": "My function return last list has an error", "body": "<p>I just started learning Haskell, and I intended to code a function that would return to last list 2.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>lastButOne x = if ((==) (length x) 2)\n               then (head x)\n               else (tail x)\n</code></pre>\n\n<p>this is error:</p>\n\n<pre><code>    \u2027 Occurs check: cannot construct the infinite type: a ~ [a]\n    \u2027 In the expression: (tail x)\n      In the expression:\n        if ((==) (length x) 2) then (head x) else (tail x)\n      In an equation for \u2018lastButOne\u2019:\n          lastButOne x = if ((==) (length x) 2) then (head x) else (tail x)\n    \u2027 Relevant bindings include\n        x :: [a] (bound at D:\\\\tool\\8.6.3\\test\\lBoErr.hs:1:12)\n        lastButOne :: [a] -&gt; a (bound at D:\\\\tool\\8.6.3\\test\\lBoErr.hs:1:1)\n\n  |\n3 |                            else (tail x)\n  |                                  ^^^^^^\n</code></pre>\n\n<p>I do not understand where my code is wrong and what the error meant.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 4, "creation_date": 1556792660, "post_id": 55950294, "comment_id": 98552981, "body": "Have you imported <code>Data.Maybe</code>? You also don&#39;t really need to use <code>do</code> notation here."}, {"owner": {"reputation": 68, "user_id": 7554042, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5c40cfc641e748be82ea601eca627e9?s=128&d=identicon&r=PG&f=1", "display_name": "leveeee", "link": "https://stackoverflow.com/users/7554042/leveeee"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1556793084, "post_id": 55950294, "comment_id": 98553195, "body": "@Lee I forgot to include that yes, thank you ! However now i&#39;m getting an error saying i couldn&#39;t match [string] with maybe int. Any ideas why that might be?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1556793474, "post_id": 55950294, "comment_id": 98553393, "body": "If you read the full error message it tells you the problem: &quot;The function \u2018findWord\u2019 is applied to two arguments, but its type \u2018[String] -&gt; Maybe Int\u2019 has only one&quot;."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1556794134, "post_id": 55950294, "comment_id": 98553716, "body": "<code>x &lt;- [y]</code> looks as a complex way to write <code>let x = y</code>. I can&#39;t understand why you are using <code>do</code> and monads there, it feels unnecessary complex. Also, you should avoid <code>fromJust</code> since it&#39;s a partial function. Use <code>case findWord t of Just i -&gt; ... ; Nothing -&gt; ...</code> and handle the &quot;not found&quot; case properly instead of crashing the program."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1556800973, "creation_date": 1556800973, "answer_id": 55952735, "question_id": 55950294, "link": "https://stackoverflow.com/questions/55950294/fromjust-doesnt-convert-maybe-int-value/55952735#55952735", "title": "fromJust doesn&#39;t convert maybe int value", "body": "<p>The purpose of using <code>Maybe</code> is to force users of <code>findWord</code> to consider the possibility that <code>findWord</code> could fail. <code>fromJust</code> ignores that possibility. A better definition of <code>putCursorTo</code> would be</p>\n\n<pre><code>putCursorTo :: String -&gt; [String] -&gt; Maybe [String]\nputCursorTo word t = do\n    index &lt;- findWord word t\n    let (x,y) = splitAt index t\n    return $ init x ++ [last x ++ \"^\"] ++ y\n</code></pre>\n\n<p>Here, we <em>try</em> to extract an <code>Int</code> from the result of <code>findWord</code>. If it succeeds, we can proceed as usual, except we lift the final result back into a <code>Maybe</code> value. If the extraction <em>doesn't</em> succeed, because <code>findWord</code> returned <code>Nothing</code>, then <code>putCursorTo</code> will return <code>Nothing</code> as well, by definition of the <code>Maybe</code> monad.</p>\n\n<p>The alternative is to have some default index in mind should <code>findWord</code> fail. We can provide that using the <code>fromMaybe</code> function:</p>\n\n<pre><code>putCursorTo :: String -&gt; [String] -&gt; [String]\nputCursorTo word t = let (x,y) = splitAt (fromMaybe 0 (findWord word t)) t\n                     in init x ++ [last x ++ \"^\"] ++ y\n</code></pre>\n\n<p>Replace 0 with whatever index makes sense if <code>word</code> isn't found. Or, maybe if <code>findWord</code> fails, you just return the original list as-is:</p>\n\n<pre><code>putCursorTo :: String -&gt; [String] -&gt; [String]\nputCursorTo word t = case findWord word t of\n                       Nothing -&gt; t\n                       Just index -&gt; let (x, y) = splitAt index t\n                                     in init x ++ [last x ++ \"^\"] ++ y\n</code></pre>\n\n<hr>\n\n<p>All that said, there's a mismatch between the definition of <code>findWord</code> and how you call it. Perhaps the call should be <code>findWord t</code> instead of <code>findWord word t</code>.</p>\n"}], "owner": {"reputation": 68, "user_id": 7554042, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5c40cfc641e748be82ea601eca627e9?s=128&d=identicon&r=PG&f=1", "display_name": "leveeee", "link": "https://stackoverflow.com/users/7554042/leveeee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1556800973, "creation_date": 1556792386, "question_id": 55950294, "link": "https://stackoverflow.com/questions/55950294/fromjust-doesnt-convert-maybe-int-value", "title": "fromJust doesn&#39;t convert maybe int value", "body": "<p>From my putCursorTo function i'm calling the findWord function, which returns a Maybe Int value. This is processed by fromJust, to store the index value. Why does it throw a signature error?</p>\n\n<p>I have tried to add an Int input signature for the putCursorTo but that wasn't the error</p>\n\n<pre><code>putCursorTo :: String -&gt; [String] -&gt; [String]\nputCursorTo word t = do\n    index &lt;- [fromJust (findWord word t)]\n    let (x,y) = splitAt index t\n    init x ++ [last x ++ \"^\"] ++ y \n\nfindWord :: [String] -&gt; Maybe Int\nfindWord t = find t 0\n    where\n        find [] _ = Nothing\n        find (x:xs) c\n            | \"^\" `isInfixOf` x = Just c\n            | otherwise = find xs (c+1)\n\n</code></pre>\n\n<p>The error that i'm getting is on the line <code>index &lt;- [fromJust (findWord word t)]</code> telling me that the variable fromJust is not in scope.</p>\n\n<p>I'd like to get it working so the index value stores value of the findWord function, that is converted with fromJust to an integer</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 6, "creation_date": 1556783583, "post_id": 55947897, "comment_id": 98548430, "body": "<code>show</code> converts another type to a string. To go the other way, you want <code>read</code>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1556800824, "post_id": 55947897, "comment_id": 98557243, "body": "If you&#39;re doing this for homework presumably you&#39;re meant to write the conversion yourself by hand, rather than just using the existing <code>read</code> function."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1556890027, "post_id": 55947897, "comment_id": 98592286, "body": "What is the type of <code>show</code>? Compare that with the type of <code>atoi &lt;somestring&gt;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 3, "creation_date": 1556788790, "post_id": 55948509, "comment_id": 98551023, "body": "Do you need the <code>:: Int</code> here in the first code block? The type signature should already constrain the output type."}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1556789055, "post_id": 55948509, "comment_id": 98551176, "body": "Im not sure of that, I usually type it to clarify."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1556810556, "post_id": 55948509, "comment_id": 98562989, "body": "@Netwave You don&#39;t; explicitly typing <code>atoi</code> lets the type checker infer which instance of <code>Read</code> to use."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1556810624, "post_id": 55948509, "comment_id": 98563027, "body": "Using <code>TypeApplications</code>, you could also simply write <code>atoi = read @Int</code>."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 4, "last_activity_date": 1556786015, "creation_date": 1556786015, "answer_id": 55948509, "question_id": 55947897, "link": "https://stackoverflow.com/questions/55947897/convert-string-of-digits-to-integer/55948509#55948509", "title": "Convert string of digits to integer", "body": "<p>Use <code>read</code>:</p>\n\n<pre><code>atoi :: String -&gt; Int\natoi s = read s :: Int\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>Prelude&gt; atoi s = read s :: Int\nPrelude&gt; atoi \"12345\"\n12345\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10232607, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207753258309780/picture?type=large", "display_name": "Zhi Ying", "link": "https://stackoverflow.com/users/10232607/zhi-ying"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1556786015, "creation_date": 1556783547, "last_edit_date": 1556783778, "question_id": 55947897, "link": "https://stackoverflow.com/questions/55947897/convert-string-of-digits-to-integer", "title": "Convert string of digits to integer", "body": "<p>I am trying to write this function in Haskell called atoi, which takes a string of digits representing an integer to the integer itself.</p>\n\n<p>For example, <code>atoi \"123\"</code> should give 123.</p>\n\n<p>Here's my implementation so far:</p>\n\n<pre><code>atoi :: String -&gt; Int\natoi str = show str :: Int\n</code></pre>\n\n<p>I got an error stating</p>\n\n<blockquote>\n  <p>Couldn't match type</p>\n</blockquote>\n"}, {"tags": ["haskell", "overlapping-instances"], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1556785112, "creation_date": 1556785112, "answer_id": 55948278, "question_id": 55947743, "link": "https://stackoverflow.com/questions/55947743/overlapping-instance-for-show/55948278#55948278", "title": "Overlapping instance for Show", "body": "<p>In your example you can just remove <code>instance (Show a, ListContainer l) =&gt; Show (l a)</code> and add <code>deriving (Show)</code> to <code>L</code> definition.</p>\n\n<p>Alternatively you can remove <code>deriving (Show)</code> from <code>A</code> definition.</p>\n\n<p>If you want you code behave as it is now remove <code>deriving (Show)</code> and implement it explicitly</p>\n\n<pre><code> instance {-# OVERLAPPING #-}  Show a =&gt; Show (A a)\n      where \n         show (A a) = \"A \" ++ show a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1036, "user_id": 4608364, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/5xwHK.jpg?s=128&g=1", "display_name": "Quelklef", "link": "https://stackoverflow.com/users/4608364/quelklef"}, "edited": false, "score": 0, "creation_date": 1609582945, "post_id": 55952285, "comment_id": 115870082, "body": "This seems like unfortunate and unintuitive behaviour, at least from the perspective of the user. Is there are good reason that ghc works this way?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 1036, "user_id": 4608364, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/5xwHK.jpg?s=128&g=1", "display_name": "Quelklef", "link": "https://stackoverflow.com/users/4608364/quelklef"}, "edited": false, "score": 0, "creation_date": 1609597007, "post_id": 55952285, "comment_id": 115873695, "body": "If instances were chosen based on constraints, then the result would depend on which instances are in scope, which would be super fragile. For example, the meaning of your program could change if you add an import of a seemingly unrelated module that just happens to contain an instance. Or even without changing your imports, but instead upgrading dependencies. This would be hell to debug."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 6, "last_activity_date": 1556825572, "last_edit_date": 1556825572, "creation_date": 1556799404, "answer_id": 55952285, "question_id": 55947743, "link": "https://stackoverflow.com/questions/55947743/overlapping-instance-for-show/55952285#55952285", "title": "Overlapping instance for Show", "body": "<blockquote>\n  <p>I can understand that it thinks type\u00a0<code>a</code>\u00a0can either derive\u00a0<code>Show</code>, or derive\u00a0<code>ListContainer</code>, which may result in\u00a0<code>Show</code>.</p>\n</blockquote>\n\n<p>That is not what it thinks.</p>\n\n<p>When Haskell chooses class instance, it doesn't look at instance constraints at all. All it considers when choosing an instance is the instance head (the thing that comes right after class name).</p>\n\n<p>In your <code>Show</code> instance, the instance head is <code>l a</code>. This instance head matches <code>A a</code> (by assuming <code>l = A</code>). It also matches a lot of other things by the way - for example, it matches <code>Maybe a</code> (where <code>l = Maybe</code>), and <code>Either b a</code> (with <code>l = Either b</code>), and <code>Identity a</code>, and <code>IO a</code> - pretty much every type with a type parameter, come to think of it. It doesn't matter that neither <code>A</code> nor <code>Maybe</code> nor <code>IO</code> have an instance of <code>ListContainer</code>, because like I said above, Haskell doesn't look at constraints when choosing instances, only at instance heads.</p>\n\n<p>It is only <em>after</em> finding a matching instance (by matching on its head) that Haskell will check if that instance's constraints are in fact satisfied. And will complain if they aren't. But it will never go back and try to pick another instance instead.</p>\n\n<p>So coming back to your example: since <code>A</code> now has two matching <code>Show</code> instances - its own derived one and the <code>Show (l a)</code> one that you wrote, - the compiler complains that they are overlapping.</p>\n"}], "owner": {"reputation": 2273, "user_id": 4407321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/KHKUZ.png?s=128&g=1", "display_name": "Allan W", "link": "https://stackoverflow.com/users/4407321/allan-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 55952285, "answer_count": 2, "score": 1, "last_activity_date": 1556825572, "creation_date": 1556782873, "question_id": 55947743, "link": "https://stackoverflow.com/questions/55947743/overlapping-instance-for-show", "title": "Overlapping instance for Show", "body": "<p>Suppose we have the following:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nmodule Sample where\n\nnewtype A a =\n  A a\n  deriving (Show)\n\nnewtype L a =\n  L [a]\n\nclass ListContainer l where\n  getList :: l a -&gt; [a]\n\ninstance ListContainer L where\n  getList (L l) = l\n\ninstance (Show a, ListContainer l) =&gt; Show (l a) where\n  show = const \"example\"\n</code></pre>\n\n<p>With this code, ghc complains:</p>\n\n<pre><code>warning:\u00a0[-Wdeferred-type-errors]\n\u2022\u00a0Overlapping\u00a0instances\u00a0for\u00a0Show\u00a0(A\u00a0a)\n\u00a0\u00a0\u00a0\u00a0arising\u00a0from\u00a0a\u00a0use\u00a0of\u00a0\u2018GHC.Show.$dmshowList\u2019\n\u00a0\u00a0Matching\u00a0instances:\n\u00a0\u00a0\u00a0\u00a0instance\u00a0(Show\u00a0a,\u00a0ListContainer\u00a0l)\u00a0=&gt;\u00a0Show\u00a0(l\u00a0a)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--\u00a0Defined\u00a0at\u00a0/.../src/Sample.hs:18:10\n\u00a0\u00a0\u00a0\u00a0instance\u00a0Show\u00a0a\u00a0=&gt;\u00a0Show\u00a0(A\u00a0a)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--\u00a0Defined\u00a0at\u00a0/.../src/Sample.hs:7:13\n\u2022\u00a0In\u00a0the\u00a0expression:\u00a0GHC.Show.$dmshowList\u00a0@(A\u00a0a)\n\u00a0\u00a0In\u00a0an\u00a0equation\u00a0for\u00a0\u2018showList\u2019:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0showList\u00a0=\u00a0GHC.Show.$dmshowList\u00a0@(A\u00a0a)\n\u00a0\u00a0When\u00a0typechecking\u00a0the\u00a0code\u00a0for\u00a0\u2018showList\u2019\n\u00a0\u00a0\u00a0\u00a0in\u00a0a\u00a0derived\u00a0instance\u00a0for\u00a0\u2018Show\u00a0(A\u00a0a)\u2019:\n\u00a0\u00a0\u00a0\u00a0To\u00a0see\u00a0the\u00a0code\u00a0I\u00a0am\u00a0typechecking,\u00a0use\u00a0-ddump-deriv\n\u00a0\u00a0In\u00a0the\u00a0instance\u00a0declaration\u00a0for\u00a0\u2018Show\u00a0(A\u00a0a)\u2019\nwarning:\u00a0[-Wdeferred-type-errors]\n\u2022\u00a0Overlapping\u00a0instances\u00a0for\u00a0Show\u00a0(A\u00a0a)\n\u00a0\u00a0\u00a0\u00a0arising\u00a0from\u00a0a\u00a0use\u00a0of\u00a0\u2018GHC.Show.$dmshow\u2019\n\u00a0\u00a0Matching\u00a0instances:\n\u00a0\u00a0\u00a0\u00a0instance\u00a0(Show\u00a0a,\u00a0ListContainer\u00a0l)\u00a0=&gt;\u00a0Show\u00a0(l\u00a0a)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--\u00a0Defined\u00a0at\u00a0/.../src/Sample.hs:18:10\n\u00a0\u00a0\u00a0\u00a0instance\u00a0Show\u00a0a\u00a0=&gt;\u00a0Show\u00a0(A\u00a0a)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--\u00a0Defined\u00a0at\u00a0/.../src/Sample.hs:7:13\n\u2022\u00a0In\u00a0the\u00a0expression:\u00a0GHC.Show.$dmshow\u00a0@(A\u00a0a)\n\u00a0\u00a0In\u00a0an\u00a0equation\u00a0for\u00a0\u2018show\u2019:\u00a0show\u00a0=\u00a0GHC.Show.$dmshow\u00a0@(A\u00a0a)\n\u00a0\u00a0When\u00a0typechecking\u00a0the\u00a0code\u00a0for\u00a0\u2018show\u2019\n\u00a0\u00a0\u00a0\u00a0in\u00a0a\u00a0derived\u00a0instance\u00a0for\u00a0\u2018Show\u00a0(A\u00a0a)\u2019:\n\u00a0\u00a0\u00a0\u00a0To\u00a0see\u00a0the\u00a0code\u00a0I\u00a0am\u00a0typechecking,\u00a0use\u00a0-ddump-deriv\n\u00a0\u00a0In\u00a0the\u00a0instance\u00a0declaration\u00a0for\u00a0\u2018Show\u00a0(A\u00a0a)\u2019\n</code></pre>\n\n<p>I can understand that it thinks type <code>a</code> can either derive <code>Show</code>, or derive <code>ListContainer</code>, which may result in <code>Show</code>.</p>\n\n<p>How do we avoid that?</p>\n\n<p>I understand that there exists a function <code>showList</code>, but its signature is a bit foreign. I do already have a function that I intend to use to display certain lists, which returns <code>String</code> directly.</p>\n"}]