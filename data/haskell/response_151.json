[{"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1511988085, "post_id": 47561437, "comment_id": 82080563, "body": "well, the first pattern of <code>te</code> will here always be matched, so you keep making the <i>list</i> larger,"}, {"owner": {"reputation": 15, "user_id": 9026817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9db28de3462cd97e579ee27209c9992c?s=128&d=identicon&r=PG&f=1", "display_name": "EStudent", "link": "https://stackoverflow.com/users/9026817/estudent"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511988191, "post_id": 47561437, "comment_id": 82080614, "body": "how could i stop the recursion i tried it with f  0   0 c and 0 0"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511988249, "post_id": 47561437, "comment_id": 82080646, "body": "put them at the top of the <code>te</code> definition instead of at the bottom. It is not like in Java where the &quot;most specific function is called&quot;. Haskell conceptually evaluates clauses top-to-bottom until one of these fires."}, {"owner": {"reputation": 15, "user_id": 9026817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9db28de3462cd97e579ee27209c9992c?s=128&d=identicon&r=PG&f=1", "display_name": "EStudent", "link": "https://stackoverflow.com/users/9026817/estudent"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511988360, "post_id": 47561437, "comment_id": 82080698, "body": "it worked now thanks"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511988409, "post_id": 47561437, "comment_id": 82080719, "body": "as far as I know, it probably produces the result in reverse: <code>[0,1,2,3]</code> instead of <code>[0,3,2,1]</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1511989052, "post_id": 47561437, "comment_id": 82081058, "body": "Why not <code>we n = 0 : [n,n-1..1]</code>..?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1511989981, "post_id": 47561437, "comment_id": 82081563, "body": "Yet another case which would have been spotted by GHC, had the warnings been on. I&#39;d strongly recommend to turn on warnings with the <code>-Wall</code> flag."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1511990131, "post_id": 47561437, "comment_id": 82081627, "body": "@Redu: I think the assignment is meant to make exercises on recursion."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1511988870, "creation_date": 1511988870, "answer_id": 47561639, "question_id": 47561437, "link": "https://stackoverflow.com/questions/47561437/haskell-my-recursion-crashes/47561639#47561639", "title": "Haskell my recursion crashes", "body": "<p>Your function has some problems, although only is currently the reason why your program freezes:</p>\n\n<ol>\n<li><code>te (x:xs) f c = ...</code> is a pattern that matches <em>nearly</em> all possibilities: all calls with the first argument being a non-empty list will be match, the remaining clauses will never \"fire\", since these are subset patterns of the first clause; and</li>\n<li>when we take the first clause, we will perform recursion with a list that is growing. There is no way we will get to the base cases (because of the first item), but we will eventually also run out of memory.</li>\n</ol>\n\n<p>There are also some strange things with your function (that are not wrong, but not efficient or elegant):</p>\n\n<ol>\n<li>you use <code>f</code> and <code>c</code> in the <code>te</code> function, but these always have the same value; and</li>\n<li>you compare with <code>w &gt; 0</code>, <code>w &lt; 0</code> and <code>w == 0</code>, and an otherwise, this is weird since there is no way a value can not be greater than, not be less than and not be equal at the same time.</li>\n</ol>\n\n<p>So perhaps we should return to the drawing board first. The first step is more or less a good one: we define the function <code>we</code> and we discriminate between three cases:</p>\n\n<pre><code>we w | w &gt; 0 = ...\n     | w == 0 = ...\n     | otherwise = ...\n</code></pre>\n\n<p>apparently (this is not in the specifications you posted), we should error on <code>w &lt; 0</code>, and return an empty list in case <code>w</code> is equal to zero, so:</p>\n\n<pre><code>we w | w &gt; 0 = ...\n     | w == 0 = []\n     | otherwise = error \"w is less than zero\"\n</code></pre>\n\n<p>Now for <code>w &gt; 0</code> we know we will produce a list that starts with <code>0</code> followed by something else, so we can write:</p>\n\n<pre><code>we w | w &gt; 0 = 0 : ...\n     | w == 0 = []\n     | otherwise = error \"w is less than zero\"\n</code></pre>\n\n<p>so we construct a list <code>(_:_)</code> with <code>0</code> as head. Now the rest is a call to a recursive function (for instance <code>te</code>):</p>\n\n<pre><code>we w | w &gt; 0 = 0 : te w\n     | w == 0 = []\n     | otherwise = error \"w is less than zero\"\n    where te n = ...\n</code></pre>\n\n<p>Now for <code>te</code> there are two possibilities: <code>n &gt; 0</code>, in which case we \"<em>emit</em>\" <code>n</code>, and perform recursion on the decrement of <code>n</code>; or in case <code>n &lt;= 0</code>, we terminate (so we produce an empty list):</p>\n\n<pre><code>we w | w &gt; 0 = 0 : te w\n     | w == 0 = []\n     | otherwise = error \"w is less than zero\"\n    where te n | n &gt; 0 = n : te (n-1)\n               | otherwise = []\n</code></pre>\n\n<p>and that's it!</p>\n"}], "owner": {"reputation": 15, "user_id": 9026817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9db28de3462cd97e579ee27209c9992c?s=128&d=identicon&r=PG&f=1", "display_name": "EStudent", "link": "https://stackoverflow.com/users/9026817/estudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 47561639, "answer_count": 1, "score": 1, "last_activity_date": 1511988870, "creation_date": 1511988022, "question_id": 47561437, "link": "https://stackoverflow.com/questions/47561437/haskell-my-recursion-crashes", "title": "Haskell my recursion crashes", "body": "<p>Hello I am beginner and I try to learn recursions in Haskell \nbut my recursive function wont give me a solution and my pc freezes. Here is my function. I want that my function gets a number and it gets subtracted with 1. \nEverytime the number gets subtracted it will be added to the list which starts with 0. For example \nwe 3 = [0,3,2,1] </p>\n\n<pre><code>we w \n   |w == 0 = []\n   |w &gt;0 = te [0] w w\n   |w &lt;0 = error \"test\"\n   |otherwise = error \"test\"\n   where\nte (x:xs) f c = te (x:f:xs) (f-1) (c-1)\nte (x:xs) f 0 = x:xs \nte (x:xs) 0 c = x:xs \nte (x:xs) 0 0 = x:xs\n</code></pre>\n"}, {"tags": ["haskell", "http-conduit"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511994547, "post_id": 47561071, "comment_id": 82083681, "body": "Based on what I can tell, the actual problem is the expected type is a strict <code>ByteString</code> while the actual type is a lazy <code>ByteString</code> (which the compiler helpfully indicates is a different type by printing it fully qualified). The error seems bogus, however, since there is no way to specialize the type of <code>httpLbs</code> to <code>Request -&gt; Manager -&gt; Response Lazy.ByteString</code> - even if you did set <code>m ~ Response</code> (which would give another very obvious error - <code>no instance for MonadIO Response</code>) then the actual instantiation would be <code>... -&gt; Response (Response Lazy.ByteString)</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511994692, "post_id": 47561071, "comment_id": 82083755, "body": "Aside: the type annotation you gave in the final line doesn&#39;t make use of <code>ScopedTypeVariables</code> because <code>IO (Response ByteString)</code> doesn&#39;t contain any type variables; and it is also entirely superfluous, since the type signature on the function already gives the type."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1512034951, "creation_date": 1512034951, "answer_id": 47570241, "question_id": 47561071, "link": "https://stackoverflow.com/questions/47561071/haskell-type-error-while-using-http-conduit/47570241#47570241", "title": "Haskell Type Error while using HTTP-Conduit", "body": "<p>You haven't included your import statements, making it difficult to debug this. My best guess though is that you've imported <code>Network.HTTP.Simple</code>, which provides functions that do not require an explicit <code>Manager</code> argument. I'm guessing this from the error message providing the expected type:</p>\n\n<pre><code>Request -&gt; m1 (Response Data.ByteString.Lazy.Internal.ByteString)\n</code></pre>\n\n<p>Solution: either change the import, or drop the <code>Manager</code> argument.</p>\n"}], "owner": {"reputation": 3418, "user_id": 738762, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0ef9a1ef193431ba6a0e2fc5c71ab22d?s=128&d=identicon&r=PG", "display_name": "nomen", "link": "https://stackoverflow.com/users/738762/nomen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512034951, "creation_date": 1511986586, "question_id": 47561071, "link": "https://stackoverflow.com/questions/47561071/haskell-type-error-while-using-http-conduit", "title": "Haskell Type Error while using HTTP-Conduit", "body": "<p>I am working on OAuth2 authentication for a Yesod application and  I am having a type error that I really really don't understand.  The code is broken at the moment, and I have a few <code>:: IO ()</code>'s and <code>undefined</code>s thrown around to help me isolate the type error, but the relevant code is:</p>\n\n<pre><code>getAccessToken :: Manager -&gt; OAuth2 -&gt; ExchangeToken -&gt; IO (OAuth2Result Errors OAuth2Token)\ngetAccessToken manager oa code = do\n\n  let (uri, defaultBody) = accessTokenUrl oa code\n  let body = defaultBody &lt;&gt; [ (\"client_id\", TE.encodeUtf8 . oauthClientId $ oa )\n                            , (\"client_secret\", TE.encodeUtf8 . oauthClientSecret $ oa)\n                            , (\"resource\", TE.encodeUtf8 . oauthClientId $ oa)\n                            ]\n\n  response &lt;- performOAuth2PostRequest manager oa uri body\n\n  return undefined\n\nperformOAuth2PostRequest :: Manager -&gt; OAuth2 -&gt; URI -&gt; PostBody -&gt; IO (Response ByteString)\nperformOAuth2PostRequest manager oa uri body  = do\n  defaultReq &lt;- uriToRequest uri\n\n  let addBasicAuth = applyBasicAuth (TE.encodeUtf8 . oauthClientId $ oa)\n                                    (TE.encodeUtf8 . oauthClientSecret $ oa)\n\n  let req = (addBasicAuth . updateRequestHeaders Nothing) defaultReq\n\n  (httpLbs (urlEncodedBody body req) manager) :: IO (Response ByteString)\n</code></pre>\n\n<p>Notice that I am specifically setting the type of the <code>httpLbs (urlEnc...) manager</code> action as an <code>IO (Response ByteString)</code> using the <code>ScopedTypeVariables</code> extension.  Also, that line of code <em>should</em> be an IO action because it's being performed at the top level of an IO action.</p>\n\n<p>In fact, I ran a GHCi session and did:</p>\n\n<pre><code>Network.OAuth.OAuth2.HttpClient Network.OAuth.OAuth2.Internal \nNetwork.HTTP.Conduit Data.Functor Prelude&gt; :t httpLbs\nhttpLbs\n  :: Control.Monad.IO.Class.MonadIO m =&gt;\n     Request\n     -&gt; Manager -&gt; m (Response Data.ByteString.Lazy.Internal.ByteString)\n</code></pre>\n\n<p>Which confirms my understanding that <code>httpLbs</code> should yield a <code>MonadIO m =&gt; m (Response ByteString)</code>.</p>\n\n<p>But here is the error I get:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018Response\n                         Data.ByteString.Lazy.Internal.ByteString\u2019\n                 with \u2018IO (Response ByteString)\u2019\n  Expected type: Manager -&gt; IO (Response ByteString)\n    Actual type: Manager\n                 -&gt; Response Data.ByteString.Lazy.Internal.ByteString\n\u2022 The function \u2018httpLbs\u2019 is applied to two arguments,\n  its type is \u2018Request\n               -&gt; m1 (Response Data.ByteString.Lazy.Internal.ByteString)\u2019,\n  it is specialized to \u2018Request\n                        -&gt; Manager -&gt; Response Data.ByteString.Lazy.Internal.ByteString\u2019\n</code></pre>\n\n<p><strong>Why is GHC specializing <code>m</code> to <code>Response</code> instead of <code>IO</code>?  How do I fix it?</strong></p>\n"}, {"tags": ["haskell", "integration"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1511983201, "post_id": 47560058, "comment_id": 82078067, "body": "I don&#39;t think this is a haskell specific problem but has to  do with numerical accuracy and rounding error due to floating point arithmetic."}, {"owner": {"reputation": 159, "user_id": 8260539, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45974390fcb7548c100f887df0ad6496?s=128&d=identicon&r=PG&f=1", "display_name": "bubu", "link": "https://stackoverflow.com/users/8260539/bubu"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511983819, "post_id": 47560058, "comment_id": 82078427, "body": "It won&#39;t be entirely accurate because of this, yes, but it still not jump so drastically"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1511994967, "post_id": 47560058, "comment_id": 82083867, "body": "Also note that if you increase the number of triangles <code>definiteIntegral (-1) 1 (^100) 100000</code> you get very close to the &quot;right answer&quot; 2/101=0.0198"}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512023897, "post_id": 47560840, "comment_id": 82092089, "body": "Just for clarification FP is floating point here not functional programming?!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512034798, "post_id": 47560840, "comment_id": 82097600, "body": "@epsilonhalbe no no, it&#39;s a little-known fact that the number 42 can only be expressed approximately in pure functional programming languages, because else the universe would collapse and be replaced by something even stranger..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1512034716, "last_edit_date": 1512034716, "creation_date": 1511985722, "answer_id": 47560840, "question_id": 47560058, "link": "https://stackoverflow.com/questions/47560058/trapezoid-rule-in-haskell/47560840#47560840", "title": "Trapezoid Rule in Haskell", "body": "<p>The problem is your end condition. You calculate the step size so <em>in principle</em>, you should end up exactly at the right boundary after <code>n</code> steps. And indeed that will work if you make sure the step size can be exactly represented in floating-point, i.e. a multiple of a power of two:</p>\n\n<pre><code>*Main&gt; definiteIntegral (-1) 1 (^100) &lt;$&gt; [64, 128, 256, 512, 1024]\n[3.396429282002939e-2,2.3718601030590182e-2,2.08093271780123e-2,2.0055667986086628e-2,1.9865519301509465e-2]\n     -- convergence towards 1.98\u00d710\u207b\u00b2\n</code></pre>\n\n<p>But most numbers <a href=\"https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\" rel=\"nofollow noreferrer\">can <em>not</em> be exactly represented in FP</a>, therefore you'll regularly <em>not</em> hit the right boundary exactly. If the last point falls slightly short of that bound, the algorithm will do an entire extra step, i.e. you blow up a small float inaccuracy to an entire-step inaccuracy. Numerically speaking, it's &ldquo;just&rdquo; an order-1 error, because that single step size gets ever smaller as you increase the resolution. (It's still bad, because the trapezoidal rule should actually be second-order accurate!)</p>\n\n<p>Problem with <code>(^100)</code> in particular is: that function is very close to zero on most of the interval [-1,1], but grows very quickly in the vicinity of &pm;1. Therefore the result of the interval is <em>dominated</em> by the trapezes right next to the boundary, and even more by a trapeze outside the boundary!</p>\n\n<p>The easiest fix is to get rid of that <code>innerSum</code> function and use built-in tools instead:</p>\n\n<pre><code>definiteIntegral :: Double -&gt; Double -&gt; (Double -&gt; Double) -&gt; Integer -&gt; Double\ndefiniteIntegral a b g n\n    | a &lt;= b = - definiteIntegral b a g n\n    | otherwise = \u03b4 * sum [ (g x + g (x+\u03b4))/2\n                          | x &lt;- [a, a+\u03b4 .. b] ]\n where \u03b4 = (b-a) / fromIntegral n\n</code></pre>\n\n<p>It is explained <a href=\"https://stackoverflow.com/questions/7290438/haskell-ranges-and-floats/7296160#7296160\">in this question</a> why that works reliable even when the step size is not exactly represented: float ranges like <code>[a, a+\u03b4 .. b]</code> refuse to take an extra step if the previous one is already close to the boundary and the next one would take you far beyond the boundary.</p>\n"}], "owner": {"reputation": 159, "user_id": 8260539, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45974390fcb7548c100f887df0ad6496?s=128&d=identicon&r=PG&f=1", "display_name": "bubu", "link": "https://stackoverflow.com/users/8260539/bubu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512034716, "creation_date": 1511982596, "last_edit_date": 1512002990, "question_id": 47560058, "link": "https://stackoverflow.com/questions/47560058/trapezoid-rule-in-haskell", "title": "Trapezoid Rule in Haskell", "body": "<p>I'm trying to define the trapezoid rule in Haskell. I created a helper function innerSum, which is sum portion of the trapezoid rule. Then in the integral definition I multiple by the distance and take in the lower bound, upper bound, a function, and some n number of trapezoids.As n increases the answer should become more accurate. My function seems to work for most cases </p>\n\n<p>except this case (and likely others):\ndefiniteIntegral (-1) 1 (\\x->x^100) 20.</p>\n\n<p>As I change the value for 20 instead of my answers diverging to a certain and getting more accurate, the numbers just jump randomly. I cannot seem to find the mistake</p>\n\n<pre><code>definiteIntegral :: Double -&gt; Double -&gt; (Double -&gt; Double) -&gt; Integer -&gt; Double\ndefiniteIntegral a b g n | a &lt;= b = (dist a b n)*(innerSum a b g (dist a b n))\n                         | otherwise = (dist a b n)*(innerSum b a g (dist b a n))\n                         where dist a b n = (b-a)/(fromIntegral n::Double)\n\ninnerSum :: Double -&gt; Double -&gt; (Double -&gt; Double) -&gt; Double -&gt; Double\ninnerSum a b g d | a &gt;= b = 0\n                 | otherwise = (((g a) + (g (a + d)))/2)+(innerSum (a + d) b g d) \n</code></pre>\n"}, {"tags": ["c++", "parsing", "haskell", "boost-spirit", "boost-spirit-qi"], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1511989492, "post_id": 47561646, "comment_id": 82081288, "body": "And <code>qi::double_ [ qi::_val += qi::_1 ] % &#39;,&#39;</code> interprets as a list of doubles, separated by commas, correct?"}, {"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "reply_to_user": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 1, "creation_date": 1511989551, "post_id": 47561646, "comment_id": 82081319, "body": "Simplified by dropping the semantic action: <a href=\"http://www.boost.org/doc/libs/1_65_1/libs/spirit/doc/html/spirit/qi/reference/operator/list.html\" rel=\"nofollow noreferrer\"><code>double_ % &#39;,&#39;</code></a> does, yes."}, {"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "reply_to_user": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1511989818, "post_id": 47561646, "comment_id": 82081468, "body": "For fun: separating parsing from summing makes <i>everything</i> a lot simpler: <b><a href=\"http://coliru.stacked-crooked.com/a/e5d33ef9d196be20\" rel=\"nofollow noreferrer\">Live On Coliru</a></b>. I think you should do this, for small/bounded lists. (PSA: Coliru cannot usually compile these samples, I have backdoor access)"}, {"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 1, "creation_date": 1511989954, "post_id": 47561646, "comment_id": 82081537, "body": "Yep, the point of this was to figure out how I can make complicated rules, as needed. I think I understand the val notation. I really like Spirit (to the extent one can like being that deep in the preprocessor) so far."}, {"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "reply_to_user": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1511990019, "post_id": 47561646, "comment_id": 82081579, "body": "I like Spirit, because (a) it enables rapid prototyping (b) it doesn&#39;t involve the preprocessor :) You obviously meant generic template instantiations."}, {"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1511990221, "post_id": 47561646, "comment_id": 82081680, "body": "Oh - I just spent a bit of time fighting through the <code>boost::Fusion</code> bits for structs with too many elements to go through BOOST_FUSION_ADAPT_STRUCT - getting my head around that whole thing was interesting... I guess there isn&#39;t any preprocessor stuff in Spirit, it&#39;s an optional feature."}, {"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "reply_to_user": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1511990241, "post_id": 47561646, "comment_id": 82081686, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/160140/discussion-between-sehe-and-carbon\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "is_accepted": true, "score": 3, "last_activity_date": 1511989298, "last_edit_date": 1511989298, "creation_date": 1511988894, "answer_id": 47561646, "question_id": 47559631, "link": "https://stackoverflow.com/questions/47559631/applying-operations-on-parser-exposed-attributes-in-qi/47561646#47561646", "title": "Applying operations on parser exposed attributes in Qi", "body": "<h2>First the quick answer</h2>\n\n<blockquote>\n  <p>why am I getting 1 instead of 3?</p>\n</blockquote>\n\n<p>You're likely getting 1 because that's the exposed attribute.\u00b3 </p>\n\n<p>However, you can't reason about your code due to Undefined Behaviour.</p>\n\n<p>Your semantic actions </p>\n\n<ul>\n<li><p>invoke UB: you assign to <code>a</code> whose lifetime ends at the end of the parser constructor. That's random memory corruption</p></li>\n<li><p>has no effect: the action <code>[a+_1]</code> is an expression that results in a temporary that is the sum of <em><code>/whatever is at the memory location that used to hold the local variable</code>a<code>at the time of parser construction/</code></em> and the attribute exposed by the subject parser (<code>double_</code>). In this case it would be \"?+2.0\" but it doesn't matter at all because nothing is done with the result: it's merely discarded.</p></li>\n</ul>\n\n<h2>The normal answer</h2>\n\n<p>Taking the requirement to be <em>Just</em>:</p>\n\n<blockquote>\n  <p>Say I had two doubles separated by a comma to parse returning their\n  sum</p>\n</blockquote>\n\n<p>Here's how we'd do it:</p>\n\n<pre><code>double parseDoublesAndSum(std::istream&amp; is) {\n    double a, b; char comma;\n    if (is &gt;&gt; a &gt;&gt; comma &amp;&amp; comma == ',' &amp;&amp; is &gt;&gt; b)\n        return a + b;\n\n    is.setstate(std::ios::failbit);\n    return 0;\n}\n</code></pre>\n\n<p>See it <strong><kbd><a href=\"http://coliru.stacked-crooked.com/a/044a543d1fd568f7\" rel=\"nofollow noreferrer\">Live On Coliru</a></kbd></strong>.</p>\n\n<h2>Yeah, but using Spirit</h2>\n\n<p>I get it :)</p>\n\n<p>Well, firstly, we'd realize the exposed attribute is a double, not the list. </p>\n\n<p>Next step is to realize that the individual elements of the list aren't of interest. We can just initialize the result to 0 and use it to accumulate the elements\u00b9, e.g.:</p>\n\n<p><strong><kbd><a href=\"http://coliru.stacked-crooked.com/a/fa5b76b6f287658e\" rel=\"nofollow noreferrer\">Live On Coliru</a></kbd></strong></p>\n\n<pre><code>#include &lt;boost/spirit/include/qi.hpp&gt;\n#include &lt;boost/spirit/include/phoenix.hpp&gt;\n\ndouble parseDoublesAndSum(std::string const&amp; source) {\n    double result = 0;\n\n    {\n        using namespace boost::spirit::qi;\n        namespace px = boost::phoenix;\n\n        bool ok = parse(source.begin(), source.end(), double_ [ px::ref(result) += _1 ] % ',');\n        if (!ok)\n            throw std::invalid_argument(\"source: expect comma delimited list of doubles\");\n    }\n\n    return result;\n}\n\nvoid test(std::string input) {\n    try {\n        std::cout &lt;&lt; \"'\" &lt;&lt; input &lt;&lt; \"' -&gt; \" &lt;&lt; parseDoublesAndSum(input) &lt;&lt; \"\\n\";\n    } catch (std::exception const&amp; e) {\n        std::cout &lt;&lt; \"'\" &lt;&lt; input &lt;&lt; \"' -&gt; \" &lt;&lt; e.what() &lt;&lt; \"\\n\";\n    }\n}\nint main() {\n    test(\"1,2\");\n    test(\"1,2,3\");\n    test(\"1,2,3\");\n    test(\"1,2,inf,4\");\n    test(\"1,2,-inf,4,5,+inf\");\n    test(\"1,2,-NaN\");\n    test(\"1,,\");\n    test(\"1\");\n    test(\"aaa,1\");\n}\n</code></pre>\n\n<p>Prints</p>\n\n<pre><code>'1,2' -&gt; 3\n'1,2,3' -&gt; 6\n'1,2,3' -&gt; 6\n'1,2,inf,4' -&gt; inf\n'1,2,-inf,4,5,+inf' -&gt; -nan\n'1,2,-NaN' -&gt; -nan\n'1,,' -&gt; 1\n'1' -&gt; 1\n'aaa,1' -&gt; 'aaa,1' -&gt; source: expect comma delimited list of doubles\n</code></pre>\n\n<h2>Advanced things:</h2>\n\n<ol>\n<li><blockquote>\n  <p>woah, \"1,,\" shouldn't have parsed!</p>\n</blockquote>\n\n<p>It didn't :) We have formulated the parser not to expect the full input to be consumed, fix: append <code>&gt;&gt; eoi</code>:</p>\n\n<pre><code>bool ok = parse(source.begin(), source.end(), double_ [ px::ref(result) += _1 ] % ',' &gt;&gt; eoi);\n</code></pre>\n\n<p>Now the relevant test case prints</p>\n\n<pre><code>'1,,' -&gt; '1,,' -&gt; source: expect comma delimited list of doubles\n</code></pre>\n\n<p>What if we want the diagnostic to mention that the end of input (<code>eoi</code>) was expected? Make it <a href=\"http://www.boost.org/doc/libs/1_65_1/libs/spirit/doc/html/spirit/qi/reference/operator/expect.html\" rel=\"nofollow noreferrer\">an expectation point</a> <code>&gt; eoi</code>:</p>\n\n<pre><code>bool ok = parse(source.begin(), source.end(), double_ [ px::ref(result) += _1 ] % ',' &gt; eoi);\n</code></pre>\n\n<p>Now prints</p>\n\n<pre><code>'1,,' -&gt; '1,,' -&gt; boost::spirit::qi::expectation_failure\n</code></pre>\n\n<p>Which can be improved by handling that exception type:</p>\n\n<p><strong><kbd><a href=\"http://coliru.stacked-crooked.com/a/f10dfc67340363ba\" rel=\"nofollow noreferrer\">Live On Coliru</a></kbd></strong></p>\n\n<p>Prints</p>\n\n<pre><code>'1,,' -&gt; Expecting &lt;eoi&gt; at ',,'\n</code></pre></li>\n<li><blockquote>\n  <p>How about accepting spaces?</p>\n</blockquote>\n\n<p>Just use <code>phrase_parse</code> which allows a skipper outside <code>lexeme</code>s.\u00b2:</p>\n\n<pre><code>bool ok = phrase_parse(source.begin(), source.end(), double_ [ px::ref(result) += _1 ] % ',' &gt; eoi, blank);\n</code></pre>\n\n<p>Now everything <code>blank</code> is ignored in between the primitives: </p>\n\n<pre><code>test(\"   1, 2   \");\n</code></pre>\n\n<p>Prints</p>\n\n<pre><code>'   1, 2   ' -&gt; 3\n</code></pre></li>\n<li><blockquote>\n  <p>How to package it up as <code>rule</code>?</p>\n</blockquote>\n\n<p>Like I mentioned, realize you can use the rule's exposed attribute as accumulator register:</p>\n\n<pre><code>namespace Parsers {\n    static const qi::rule&lt;iterator, double(), qi::blank_type&gt; product\n        = qi::eps [ qi::_val = 0 ] // initialize\n        &gt;&gt; qi::double_ [ qi::_val += qi::_1 ] % ','\n        ;\n}\n</code></pre>\n\n<p><strong><kbd><a href=\"http://coliru.stacked-crooked.com/a/81a56144d2f14cf0\" rel=\"nofollow noreferrer\">Live On Coliru</a></kbd></strong></p>\n\n<p>Printing the same results as before</p></li>\n</ol>\n\n<hr>\n\n<p>\u00b9 bear in mind that summation is an interesting subject, <a href=\"http://www.partow.net/programming/sumtk/index.html\" rel=\"nofollow noreferrer\">http://www.partow.net/programming/sumtk/index.html</a></p>\n\n<p>\u00b2 primitive parsers are implicitly lexemes, <code>lexeme[]</code> directives inhibit skipping and rules declared without a skipper are implicitly lexemes: <a href=\"https://stackoverflow.com/questions/17072987/boost-spirit-skipper-issues/17073965#17073965\">Boost spirit skipper issues</a></p>\n\n<p>\u00b3 PS. There's a subtlety at play here. Had you not written <code>%=</code> but just <code>=</code> the value would have been indeterminate: <a href=\"http://www.boost.org/doc/libs/1_65_1/libs/spirit/doc/html/spirit/qi/reference/nonterminal/rule.html#spirit.qi.reference.nonterminal.rule.expression_semantics\" rel=\"nofollow noreferrer\">http://www.boost.org/doc/libs/1_65_1/libs/spirit/doc/html/spirit/qi/reference/nonterminal/rule.html#spirit.qi.reference.nonterminal.rule.expression_semantics</a></p>\n"}], "owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "accepted_answer_id": 47561646, "answer_count": 1, "score": 3, "last_activity_date": 1511990208, "creation_date": 1511981022, "last_edit_date": 1511990208, "question_id": 47559631, "link": "https://stackoverflow.com/questions/47559631/applying-operations-on-parser-exposed-attributes-in-qi", "title": "Applying operations on parser exposed attributes in Qi", "body": "<p>Say I had two doubles separated by a comma to parse returning their sum. I might do it as follows in Haskell:</p>\n\n<pre><code>import Data.Attoparsec.Text\nimport Data.Text (pack)\ndblParse = (\\a -&gt; fst a + snd a) &lt;$&gt; ((,) &lt;$&gt; double &lt;* char ',' &lt;*&gt; double)\nparseOnly dblParse $ pack \"1,2\"\n</code></pre>\n\n<p>The <code>parseOnly</code> statement will yield <code>(Right 3)::Either String Double</code> - where Either is how Haskell often handles errors.</p>\n\n<p>You can kind of get a sense how this works - <code>(,) &lt;$&gt; double &lt;*&gt; double</code> yields a <code>Parser (Double,Double)</code>, and applying <code>(\\a -&gt; fst a + snd a)</code> makes it a <code>Parser Double</code>.</p>\n\n<p>I'm trying to do the same thing in Qi, but when I expect to get back 3, I actually get back 1:</p>\n\n<pre><code>namespace qi = boost::spirit::qi;\nnamespace ascii = boost::spirit::ascii;\n\nnamespace phx = boost::phoenix;\n\nstruct cat\n{\n    double q;\n};\n\nBOOST_FUSION_ADAPT_STRUCT(cat, q)\nBOOST_FUSION_ADAPT_STRUCT(cat, q)\ntemplate &lt;typename Iterator&gt;\nstruct cat_parser : qi::grammar&lt;Iterator, cat()&gt;\n{\n    cat_parser() : cat_parser::base_type(start)\n    {\n        using qi::int_;\n        using qi::double_;\n        using qi::repeat;\n        using qi::eoi;\n        using qi::_1;\n        double a;\n        start %= double_[phx::ref(a) =_1] &gt;&gt; ',' &gt;&gt; double_[a + _1];\n    }\n    qi::rule&lt;Iterator, cat()&gt; start;\n};\n\nint main()\n    {\n\n        std::string wat(\"1,2\");\n        cat_parser&lt;std::string::const_iterator&gt; f;\n        cat example;\n        std::string::const_iterator st = wat.begin();\n        std::string::const_iterator en = wat.end();\n        std::cout &lt;&lt; parse(st, en, f, example) &lt;&lt; std::endl;\n        std::cout &lt;&lt; example.q &lt;&lt; std::endl;\n        return 0;\n}\n</code></pre>\n\n<p>My question is twofold: Is this the idiomatic way to do this with Spirit, and why am I getting 1 instead of 3?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "edited": false, "score": 0, "creation_date": 1511979368, "post_id": 47559228, "comment_id": 82076145, "body": "I have imported Data.Either already in my code."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1511979458, "post_id": 47559228, "comment_id": 82076182, "body": "Which version of <code>base</code> are you using? <code>fromLeft</code> was added in <code>4.10.0.01</code>."}, {"owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1511979563, "post_id": 47559228, "comment_id": 82076234, "body": "build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5 is showing in my.cabal file."}], "answers": [{"comments": [{"owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "edited": false, "score": 0, "creation_date": 1511979739, "post_id": 47559302, "comment_id": 82076313, "body": "&quot;The Glorious Glasgow Haskell Compilation System, version 7.10.3&quot; terminal shows above ghc version , is possible to include / install it in this version or do I have to reinstall/upgrade the ghc?"}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "edited": false, "score": 0, "creation_date": 1511979902, "post_id": 47559302, "comment_id": 82076393, "body": "@mali Yes, please see the update and the answers in the other question. You don&#39;t have to reinstall/upgrade."}, {"owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "edited": false, "score": 0, "creation_date": 1511980593, "post_id": 47559302, "comment_id": 82076743, "body": "thanks! &quot; How to define function only for old versions in GHC? &quot; has a solution for the problem."}], "tags": [], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "is_accepted": true, "score": 2, "last_activity_date": 1511979751, "last_edit_date": 1511979751, "creation_date": 1511979611, "answer_id": 47559302, "question_id": 47559228, "link": "https://stackoverflow.com/questions/47559228/isleft-works-but-fromleft-is-not-working-in-haskell/47559302#47559302", "title": "isLeft works but fromLeft is not working in haskell", "body": "<p>I had a similar question (<a href=\"https://stackoverflow.com/questions/47065477\">How to define function only for old versions in GHC?</a>) about <code>fromRight</code>. </p>\n\n<p>And I found that <code>fromLeft</code> and <code>fromRight</code> are only available in the newer versions of <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Either.html\" rel=\"nofollow noreferrer\">Data.Either</a> in GHC 8.2+.  The documentation says they are available:</p>\n\n<blockquote>\n  <p>Since: 4.10.0.0</p>\n</blockquote>\n\n<p>--Update--</p>\n\n<p>The answers in the question above show how to make <code>fromLeft</code> or <code>fromRight</code> work for both older and newer versions of Haskell.</p>\n"}], "owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 595, "favorite_count": 0, "closed_date": 1511992362, "accepted_answer_id": 47559302, "answer_count": 1, "score": 2, "last_activity_date": 1511979751, "creation_date": 1511979313, "question_id": 47559228, "link": "https://stackoverflow.com/questions/47559228/isleft-works-but-fromleft-is-not-working-in-haskell", "closed_reason": "Duplicate", "title": "isLeft works but fromLeft is not working in haskell", "body": "<p>I am new to Haskell .I am trying to run the Data.Either.fromLeft Command in a program. </p>\n\n<pre><code>*NumericTypeCast Data.Char Data.List Data.Either&gt; isLeft ( checkIntArgument \"ss\")\nFalse\n*NumericTypeCast Data.Char Data.List Data.Either&gt; fromLeft ( checkIntArgument \"ss\")\n\n&lt;interactive&gt;:87:1: Not in scope: \u2018fromLeft\u2019\n*NumericTypeCast Data.Char Data.List Data.Either&gt; fromLeft ( Left \"ss\")\n\n&lt;interactive&gt;:88:1: Not in scope: \u2018fromLeft\u2019\n*NumericTypeCast Data.Char Data.List Data.Either&gt;\n</code></pre>\n\n<p>This seems to be odd, while isLeft works fine , fromLeft show error. any thoughts?</p>\n"}, {"tags": ["list", "haskell", "tuples", "factors"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1511977000, "post_id": 47558410, "comment_id": 82074760, "body": "You want to connect these pieces (1) generate an infinite list <code>[1,2,3,4,......]</code> (2) find out how to produce a new list by applying a function to all elements of an old list (3) make a function that given a number, say <code>x</code>, return a tuple <code>(x, divisors x)</code>."}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 1, "creation_date": 1511977002, "post_id": 47558410, "comment_id": 82074761, "body": "<a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\">take</a> just takes n elements from a list. So <code>take 3 [5,4,7,10,2] == [5,4,7]</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1511982340, "post_id": 47558410, "comment_id": 82077624, "body": "related question, what does <code>divisors 25</code> return?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1511982883, "post_id": 47558410, "comment_id": 82077877, "body": "are you familiar with the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map</code></a> function? and/or, with <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"nofollow noreferrer\">list comprehensions</a> syntax? what about list generator syntax, like <code>[2..10]</code> or <code>take 5 [2,4..]</code>? do you know about <a href=\"http://hoogle.haskell.org/?hoogle=%28a-%3Eb%29+-%3E+%5Ba%5D+-%3E+%5Bb%5D&amp;scope=set%3Astackage\" rel=\"nofollow noreferrer\">searching by types</a>?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1511987689, "post_id": 47558410, "comment_id": 82080342, "body": "This is nothing but finding prime numbers so you better concentrate on how it is done best."}, {"owner": {"reputation": 43, "user_id": 8908375, "user_type": "registered", "profile_image": "https://graph.facebook.com/1460228620720869/picture?type=large", "display_name": "Dewayn Clark", "link": "https://stackoverflow.com/users/8908375/dewayn-clark"}, "edited": false, "score": 0, "creation_date": 1511993414, "post_id": 47558410, "comment_id": 82083187, "body": "divisors 25  returns [1,5,25], why ?  And thanks for the input, and no, I&#39;m not familiar with map, sadly, as it seems to be the way to go, but tomorrow I&#39;m gonna read up a bit! You gave me some key words to look out for, thanks!  EDIT I uploaded the wrong code, jeez...gonna update now."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512050565, "post_id": 47558410, "comment_id": 82107367, "body": "@DewaynClark you&#39;re welcome. (use @ to ping someone, so they get notified). you were getting <code>[1,5,5,25]</code> with that code, haven&#39;t you? BTW you could fix that, without making it so much slower, with some testing to discover this special case."}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 0, "last_activity_date": 1511978081, "creation_date": 1511978081, "answer_id": 47558882, "question_id": 47558410, "link": "https://stackoverflow.com/questions/47558410/potentially-infinite-list-of-tuples-in-haskell/47558882#47558882", "title": "Potentially infinite list of tuples in Haskell", "body": "<p>In Haskell, there isn\u2019t really a difference between finite and infinite lists. The question is asking you to make a variable (although Haskell variables don\u2019t vary) called <code>trueDivisors</code> which has type <code>[(Int, [Int])]</code>.</p>\n\n<p>Let\u2019s first look at how to make some infinite list</p>\n\n<pre><code>myFirstInfiniteList :: [Int]\nmyFirstInfiniteList = [1..]\npowers :: [Int]\npowers = powers\u2019 1 where\n  powers\u2019 n = n : n * 2\nmyThirdInfiniteList :: [(Int,[Int])]\nmyThirdInfiniteList = map it [1..] where\n  it n = (n, [1..n])\n</code></pre>\n\n<p>Now Haskell doesn\u2019t know in advance whether a list is infinite or not so if you try to print one, it will go on forever. So you can use the <code>take</code> function which returns the first n elements of a list (where n is the first parameter)</p>\n\n<p>I think this should be enough for you to solve it yourself now.</p>\n\n<pre><code>trueDivisors :: [(Int,[Int])]\ntrueDivisors = {- you need to do this -}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1511984492, "last_edit_date": 1511984492, "creation_date": 1511981280, "answer_id": 47559701, "question_id": 47558410, "link": "https://stackoverflow.com/questions/47558410/potentially-infinite-list-of-tuples-in-haskell/47559701#47559701", "title": "Potentially infinite list of tuples in Haskell", "body": "<p>Here\u2019s a hint. If you <code>map divisors [1..7]</code>, you get:</p>\n\n<pre><code>[[1,1],[1,2],[1,3],[1,2,2,4],[1,5],[1,2,3,6],[1,7]]\n</code></pre>\n\n<p>These are the second components of the association list you want to create, except that you have a minor bug unless returning the same divisor multiple times is allowed.  (Hint: you can write a nice one-line version of <code>divisors</code> using <code>filter</code>, but a quick fix is <code>Data.List.nub</code>.) You want to return:</p>\n\n<pre><code>[(1,[1]),(2,[1,2]),(3,[1,3]),(4,[1,2,4]),...]`\n</code></pre>\n\n<p>One simple way to solve this problem is to write a helper function <code>makeAssoc :: Int -&gt; (Int, [Int])</code> and then <code>map makeAssoc [1..]</code>. This function can call <code>divisors</code>.</p>\n\n<p>Another is to take the two lists <code>[1..]</code> and <code>(map divisors [1..])</code>. The first has type <code>[Int]</code>, the second has type <code>[[Int]]</code>, and you want the result to have type <code>[( Int, [Int] )]</code>. So look for a function in the <code>Prelude</code> that will zip two lists of types <code>[a]</code> and <code>[b]</code> into a list of pairs <code>[(a,b)]</code>. That is, look for functions with type signature <a href=\"http://hoogle.haskell.org/?hoogle=%20%5Ba%5D%20%20-%3E%20%5Bb%5D%20%20-%3E%20%20%5B(a%2Cb)%5D&amp;scope=set%3Aincluded-with-ghc\" rel=\"nofollow noreferrer\"><code>[a] -&gt; [b] -&gt; [(a,b)]</code></a> and see if any of them do what you want.</p>\n\n<p>If figuring out the types seems complicated, don\u2019t worry: you can get GHC to do it for you!  If you write,</p>\n\n<pre><code>divisorAssocs :: [( Int, [Int] )]\ndivisorAssocs = map _ is\n  where is :: [Int]\n        is = [1..]\n</code></pre>\n\n<p>GHC will recognize the <code>_</code> as a typed hole, and tell you what you need to fill it:</p>\n\n<pre><code>\u2022 Found hole: _ :: Int -&gt; (Int, [Int])\n</code></pre>\n\n<p>Similarly if you write it the other way with a hole:</p>\n\n<pre><code>divisorAssocs :: [( Int, [Int] )]\ndivisorAssocs = _ is (map divisors is)\n  where is :: [Int]\n        is = [1..]\n</code></pre>\n\n<p>Gives you:</p>\n\n<pre><code>\u2022 Found hole: _ :: [Int] -&gt; [[Int]] -&gt; [(Int, [Int])]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1511982408, "creation_date": 1511982408, "answer_id": 47560011, "question_id": 47558410, "link": "https://stackoverflow.com/questions/47558410/potentially-infinite-list-of-tuples-in-haskell/47560011#47560011", "title": "Potentially infinite list of tuples in Haskell", "body": "<p>How do you pair the number and divisors?</p>\n\n<p>One trivial implementation is:</p>\n\n<pre><code>pair n = (n, divisors n)\n</code></pre>\n\n<p>what is left is mapping pair to the infinite sequence of natural numbers and take the required number of elements</p>\n\n<pre><code>take 7 $ map pair [1..]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8908375, "user_type": "registered", "profile_image": "https://graph.facebook.com/1460228620720869/picture?type=large", "display_name": "Dewayn Clark", "link": "https://stackoverflow.com/users/8908375/dewayn-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 617, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1511993683, "creation_date": 1511976455, "last_edit_date": 1511993683, "question_id": 47558410, "link": "https://stackoverflow.com/questions/47558410/potentially-infinite-list-of-tuples-in-haskell", "title": "Potentially infinite list of tuples in Haskell", "body": "<p>I have a problem I somehow cannot solve. It's the follow up task about divisors.</p>\n\n<p>First one was defining a function that puts all positive divisors of a number <em>k</em> into a list</p>\n\n<p>EDIT: Accidentally wrote the wrong code (this is what you get when you have a function divisors and divisor...was just playing arround seeing how the lists react.)\nConcerning the problem about having multiples in a list, this shouldn't happen here, but it's way slower.</p>\n\n<pre><code>divisor :: Int -&gt; [Int]\ndivisor k = divisor' 1 k\n where\n  divisor' n k  | n &gt; k = []\n              | k `mod` n == 0 = (n:result)\n              | otherwise = result\n   where result = divisor' (n+1) k\n</code></pre>\n\n<p>So far so good.</p>\n\n<p>My following task is to write a function that gives back a list of tuples <code>(x,xs)</code> where <code>x</code> is a natural number <code>/= 0</code> and <code>xs</code> is a list of all  positive divisors of <code>x</code>.</p>\n\n<p>It should look like that:</p>\n\n<pre><code>take 7 trueDivisors \n[(1,[]),(2,[1]),(3,[1]),(4,[1,2]),(5,[1]),(6,[1,2,3]),(7,[1])]\n</code></pre>\n\n<p>(<code>take</code> stands for what exactly? that might be my problem now that I re-read the task. Usually functions only get called by their name... tried to get <code>trueDivisors k</code> to work)</p>\n\n<p>I've tried quite a bit, like using my first function to get the divisors in the list inside of the tuple, which didn't work out. Syntax error over syntax error.</p>\n\n<p>Maybe someone can help me out a bit, or give me a hint. Sadly there isn't something remotely like that in the script. And google wasn't too keen either.</p>\n\n<p>Thanks in advance !</p>\n"}, {"tags": ["list", "haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1511976440, "post_id": 47557844, "comment_id": 82074462, "body": "I&#39;m unsure with the last sentence, though. The tail recursive version (with a proper strictness fix, or praying the the optimizer fixes it) runs in constant space (provided numbers are of a standard type), while the non tail recursive one uses linear memory. I&#39;d use the first version."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 3, "last_activity_date": 1511974303, "creation_date": 1511974303, "answer_id": 47557844, "question_id": 47557606, "link": "https://stackoverflow.com/questions/47557606/haskell-creating-a-counter-with-a-single-input/47557844#47557844", "title": "Haskell creating a counter with a single input", "body": "<p>Very simple, define a new function, and define the 'helper' function in a <code>where</code> block:</p>\n\n<pre><code>elements ls = helper 0 ls --`helper' is your previous function, defined below:\n    where helper n []     = n\n          helper n (_:xs) = helper (1+n) xs\n</code></pre>\n\n<p>This will prevent <code>helper</code> from being used elsewhere, but allows you to write your function in this way.</p>\n\n<p>However, you could avoid this tail-recursion entirely, and just write:</p>\n\n<pre><code>elements []     = 0\nelements (_:xs) = 1 + elements xs\n</code></pre>\n\n<p>and therefore avoid the need for two arguments. This second style is generally considered more idiomatic haskell.</p>\n"}], "owner": {"reputation": 15, "user_id": 9026817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9db28de3462cd97e579ee27209c9992c?s=128&d=identicon&r=PG&f=1", "display_name": "EStudent", "link": "https://stackoverflow.com/users/9026817/estudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 47557844, "answer_count": 1, "score": 0, "last_activity_date": 1511974303, "creation_date": 1511973451, "last_edit_date": 1511974158, "question_id": 47557606, "link": "https://stackoverflow.com/questions/47557606/haskell-creating-a-counter-with-a-single-input", "title": "Haskell creating a counter with a single input", "body": "<p>I am a beginner and I want to define a function which shows how many elements are in one list. I already created this :</p>\n\n<pre><code>elementsl n []     = n\nelementsl n (_:xs) = elementsl (n+1) xs\n</code></pre>\n\n<p>But I need to give two inputs: <code>0</code> and a list.\nhow can I give only the list as a single input and still have a counter in my function?</p>\n"}, {"tags": ["sorting", "haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 2989581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6072caeec9be00b54c538479c29ff39b?s=128&d=identicon&r=PG&f=1", "display_name": "albinantti", "link": "https://stackoverflow.com/users/2989581/albinantti"}, "edited": false, "score": 0, "creation_date": 1511957897, "post_id": 47552460, "comment_id": 82061794, "body": "Thank you, the map keyword was what I was looking for, our tutor hasn&#39;t gone over it yet in our Haskell course."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 11, "creation_date": 1511958483, "post_id": 47552460, "comment_id": 82062211, "body": "<a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map</code></a> isn&#39;t a keyword, it&#39;s a function."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1511957146, "creation_date": 1511957146, "answer_id": 47552460, "question_id": 47552237, "link": "https://stackoverflow.com/questions/47552237/haskell-sort-strings-inside-a-tuple-in-alphabetical-order/47552460#47552460", "title": "Haskell - Sort strings inside a tuple in alphabetical order", "body": "<p>A tuple can only be either ordered or in inverse-order, because it always has exactly two elements, so these are the only permutations. Hence you simply need to check which is the case, and if necessary flip the tuple once.</p>\n\n<pre><code>sortTuple :: Ord a =&gt; (a,a) -&gt; (a,a)\nsortTuple (x,y)\n  | x&gt;y        = ...\n  | otherwise  = ...\n</code></pre>\n\n<p>This question has nothing to do with lists, since you merely apply the operation independently to each element</p>\n\n<pre><code>sortTuplesInList :: Ord a =&gt; [(a,a)] -&gt; [(a,a)]\nsortTuplesInList = map sortTuple\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 504, "user_id": 3629604, "user_type": "registered", "profile_image": "https://graph.facebook.com/765524385/picture?type=large", "display_name": "Gene", "link": "https://stackoverflow.com/users/3629604/gene"}, "is_accepted": false, "score": 1, "last_activity_date": 1511973347, "creation_date": 1511973347, "answer_id": 47557574, "question_id": 47552237, "link": "https://stackoverflow.com/questions/47552237/haskell-sort-strings-inside-a-tuple-in-alphabetical-order/47557574#47557574", "title": "Haskell - Sort strings inside a tuple in alphabetical order", "body": "<p>While tuples can vary in length (I think up to 64 elements), the wrapper list must be homogenous (i.e. all tuple elements will have the same length). This makes using something like list comprehension easy:</p>\n\n<pre><code>import Data.List\n\nlet sortedPairs = [(x,y) | [x,y] &lt;- tmp]\n  where tmp = [sort [x,y] | (x,y) &lt;- [(\"m\",\"l\"),(\"p\",\"q\"),(\"s\",\"r\")]]\n</code></pre>\n\n<p>You can adjust the size of the tuples (and variables in the pattern matching) to fit your domain.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 7, "user_id": 2989581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6072caeec9be00b54c538479c29ff39b?s=128&d=identicon&r=PG&f=1", "display_name": "albinantti", "link": "https://stackoverflow.com/users/2989581/albinantti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1720, "favorite_count": 0, "accepted_answer_id": 47552460, "answer_count": 2, "score": -3, "last_activity_date": 1511973347, "creation_date": 1511956430, "question_id": 47552237, "link": "https://stackoverflow.com/questions/47552237/haskell-sort-strings-inside-a-tuple-in-alphabetical-order", "title": "Haskell - Sort strings inside a tuple in alphabetical order", "body": "<p>I have a list containing tuples that I would like to sort so that the <em>values</em> they contain appear in alphabetical order. I've toyed around with the Data.List-sorting but have only managed to sort the list, not the values of the tuples.</p>\n\n<p>In essence, is there any way to turn a list of </p>\n\n<pre><code>[(\"foo\",\"bar\"),(\"stack\",\"overflow\"),(\"help\",\"please\")]\n</code></pre>\n\n<p>into a list</p>\n\n<pre><code>[(\"bar\",\"foo\"),(\"overflow\",\"stack\"),(\"help\",\"please\")]\n</code></pre>\n"}, {"tags": ["haskell", "types", "constructor"], "comments": [{"owner": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 0, "creation_date": 1511952278, "post_id": 47550580, "comment_id": 82058274, "body": "It might help to understand your confusion if you explained why the question is about <code>Pt</code> and not about <code>False</code> or <code>Green</code> from the previous examples in that section."}, {"owner": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "reply_to_user": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 0, "creation_date": 1511953168, "post_id": 47550580, "comment_id": 82058872, "body": "I see these values as a kind of <code>enum</code> from C: explicitly giving the possible values, so a variable of that type can take a value <code>Green</code> or <code>False</code>. I can write <code>let x=Green</code> and x will be of type <code>Color</code>."}, {"owner": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 1, "creation_date": 1511958915, "post_id": 47550580, "comment_id": 82062518, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/18204308/haskell-type-vs-data-constructor\">Haskell Type vs Data Constructor</a>"}, {"owner": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 0, "creation_date": 1511959251, "post_id": 47550580, "comment_id": 82062743, "body": "So this is not a bad intuition, non-nullary data constructors simply generalize it so that eg. <code>let x=Pt Green Red</code>  will give you an x of type <code>Point Color</code>."}, {"owner": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "reply_to_user": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 0, "creation_date": 1511966375, "post_id": 47550580, "comment_id": 82067447, "body": "yeah, but then, writing <code>let x=Pt</code> is valid, but then <code>x</code> is not of type <code>Point</code>, but rather <code>a -&gt; a -&gt; Point a</code>. The crucial thing was to see that &quot;Red&quot; is also not a value, but a data constructor returning the value &quot;Red&quot;. Can &quot;Red&quot; be defined in such a way that it returns &quot;FF0000&quot; rather than &quot;Red&quot;?"}, {"owner": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 0, "creation_date": 1511966888, "post_id": 47550580, "comment_id": 82067845, "body": "Then I think that even more crucial will be to see that a data constructor <b>is</b> a value. That Red is a value and so is Pt (one is a value of type <code>Color</code>, the other of type <code>a -&gt; a -&gt; Point a</code>, as good a type as any)."}, {"owner": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "reply_to_user": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 0, "creation_date": 1512045182, "post_id": 47550580, "comment_id": 82103837, "body": "Ah. If that is literally true (data constructor is a value), then I did not understand anything after all. Back to the drawing board then. (Unless you mean something meaningless like &quot;everything is a value when you get to the bottom of it&quot;, but I think you mean &quot;it is a value as opposed to, say, type constructor&quot;)"}, {"owner": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 0, "creation_date": 1512126158, "post_id": 47550580, "comment_id": 82140922, "body": "I mean you can distinguish the <code>Red</code> data constructor as a syntactic element of a program (a kind of expression) from the abstract value <b>Red</b> it evaluates to. But (by the definition in this example) it can only evaluate to this one specific value of the <b>Color</b> type. And similarly a <code>Pt</code> expression - in a program containing the <code>data Point a = Pt a a</code> definition - will evaluate to a specific value of a function type denoted by the type expression <code>a -&gt; a -&gt; Point a</code> (or <code>b -&gt; b -&gt; Point b</code>, or ...)."}], "answers": [{"comments": [{"owner": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "edited": false, "score": 0, "creation_date": 1511953228, "post_id": 47550815, "comment_id": 82058916, "body": "Lovely. But weird. But lovely. Thank you. Also, now the rest of the para makes sense."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511957439, "post_id": 47550815, "comment_id": 82061487, "body": "What&#39;s weird about it? (Unless you are referring to using the same name as both the type constructor and data constructor. Yeah, that takes some getting used to.)"}, {"owner": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "edited": false, "score": 0, "creation_date": 1511966173, "post_id": 47550815, "comment_id": 82067290, "body": "Because we do not define Pt (not explicitly), we only name it. When you think about it, it is logical, but it is a leap from simply enumerating possible values of a type (yes, I do understand now that in an enumerative type definition these are not &quot;values&quot; but data constructors returning a single data point)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "edited": false, "score": 5, "creation_date": 1511973373, "post_id": 47550815, "comment_id": 82072587, "body": "@January Indeed, the Haskell data type definition notation is compact but can slightly confuse beginners -- here on SO it&#39;s frequent to see such confusion. If you prefer, you can turn on the <code>GADTSyntax</code> extension and use the more verbose notation <code>data Point a where Pt :: a -&gt; a -&gt; Point a</code> where you explicitly provide a type for <code>Pt</code>, as if it were a function signature. This is 100% equivalent to the compact one, and can be used for multiple constructors as well. I think this syntax is more clear with beginners (even if they did not read a tutorial, yet)."}, {"owner": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "edited": false, "score": 0, "creation_date": 1512045526, "post_id": 47550815, "comment_id": 82104054, "body": "This is, indeed, more logical. Makes perfect sense. I find I don&#39;t have problems with the logic of the language itself, but rather with weird notations, shorthands and syntax sugar"}, {"owner": {"reputation": 2564, "user_id": 4134881, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/797360342295a3f637a9c4d71d40d113?s=128&d=identicon&r=PG&f=1", "display_name": "evianpring", "link": "https://stackoverflow.com/users/4134881/evianpring"}, "edited": false, "score": 0, "creation_date": 1564705021, "post_id": 47550815, "comment_id": 101128094, "body": "I am a beginner so this is all quite confusing still. Why can you wriite <code>let p = Pt 1 2</code>, without Pt being defined in any concrete way? <code>Pt a a</code> is a data constructor so it should yield a value. Is it not necessary to define how this value is generated?"}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "reply_to_user": {"reputation": 2564, "user_id": 4134881, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/797360342295a3f637a9c4d71d40d113?s=128&d=identicon&r=PG&f=1", "display_name": "evianpring", "link": "https://stackoverflow.com/users/4134881/evianpring"}, "edited": false, "score": 0, "creation_date": 1564737326, "post_id": 47550815, "comment_id": 101137186, "body": "@evianpring if you&#39;ve earlier said <code>data Point a = Pt a a</code> then you have defined <code>Pt</code> as concretely as you can (while still having that type). I guess the closest thing in C would be a <code>struct Pt{void* x; void* y;}</code> although the Haskell code also makes sure the <code>x</code> and <code>y</code> fields are of the same type. When you <code>let p = Pt 1 2</code> and evaluate <code>p</code>, you could imagine Haskell allocating such a C struct with pointers to two ints"}], "tags": [], "owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "is_accepted": false, "score": 6, "last_activity_date": 1511952102, "creation_date": 1511952102, "answer_id": 47550815, "question_id": 47550580, "link": "https://stackoverflow.com/questions/47550580/meaning-of-pt-in-this-haskell-example-for-data-constructor/47550815#47550815", "title": "Meaning of `Pt&#39;&#39; in this Haskell example for data constructor", "body": "<p>The <code>Pt</code> is a name that you yourself make up. You use it to create a new <code>Point</code>. </p>\n\n<pre><code>\u03bb&gt; data Point a = Pt a a\n\u03bb&gt; let p = Pt 1 2\n\u03bb&gt; :t p\np :: Num a =&gt; Point a\n</code></pre>\n\n<p>(For these single-constructor data's, you'll also often see them named the same as the type, like <code>data Point a = Point a a</code>.)</p>\n"}], "owner": {"reputation": 13969, "user_id": 1686814, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/WJgTB.jpg?s=128&g=1", "display_name": "January", "link": "https://stackoverflow.com/users/1686814/january"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1511953533, "creation_date": 1511951432, "last_edit_date": 1511953533, "question_id": 47550580, "link": "https://stackoverflow.com/questions/47550580/meaning-of-pt-in-this-haskell-example-for-data-constructor", "title": "Meaning of `Pt&#39;&#39; in this Haskell example for data constructor", "body": "<p>The following example is from <a href=\"https://www.haskell.org/tutorial/haskell-98-tutorial.pdf\" rel=\"nofollow noreferrer\">\"A gentle introduction to Haskell 98\"</a> by Hudak, Peterson and Fasel:</p>\n\n<pre><code>data Point a = Pt a a\n</code></pre>\n\n<p>What is this `Pt'? Where does it come from? What does it mean? Has it been defined previously, or are we defining it here? It appears suddenly in the text, has not been mentioned before, and a google for \"Pt Haskell\" returns Haskell documentation in Portugese  ;-)</p>\n\n<p>Edit: thanks to the reply from @unhammer, I now see that this answer to another question explains the problem really well: <a href=\"https://stackoverflow.com/a/18205862/1686814\">here</a></p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"comments": [{"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1512026198, "post_id": 47554282, "comment_id": 82093141, "body": "Thanks for the answer. I have seen the Debugging page and it does not really address my question: What I would like to have is something that explains to me the build plan, why each target has been rebuilt, which rules were triggered. I have used <code>Diagnostic</code> output but it is somewhat overwhelming even for a small project with a handful of rules."}, {"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "reply_to_user": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 1, "creation_date": 1512049549, "post_id": 47554282, "comment_id": 82106698, "body": "I think the HTML profile reports should change to show you what you want to see, so perhaps open a ticket on the Shake issue tracker to record what you were looking for. If you can share the HTML profile I can shed some more light, but beware it likely contains detailed information about the files in your build."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1512116851, "post_id": 47554282, "comment_id": 82135790, "body": "Thanks for your answer, I will do that. Closing the question."}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 1, "last_activity_date": 1511963023, "creation_date": 1511963023, "answer_id": 47554282, "question_id": 47549212, "link": "https://stackoverflow.com/questions/47549212/how-to-debug-shake-rules-execution/47554282#47554282", "title": "How to debug shake rules execution?", "body": "<p>There is a page entitled <a href=\"http://shakebuild.com/debugging\" rel=\"nofollow noreferrer\">Debugging</a> on the <a href=\"http://shakebuild.com/\" rel=\"nofollow noreferrer\">Shake Website</a>. The <a href=\"http://shakebuild.com/profiling#html-profile\" rel=\"nofollow noreferrer\">HTML profiling reports</a> might also shed some light. The plan is to enhance the HTML profile reports to give a more question/answer style interface, tracked at <a href=\"https://github.com/ndmitchell/shake/issues/446\" rel=\"nofollow noreferrer\">#446</a> and <a href=\"https://github.com/ndmitchell/shake/issues/148\" rel=\"nofollow noreferrer\">#148</a>.</p>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "accepted_answer_id": 47554282, "answer_count": 1, "score": 3, "last_activity_date": 1511963023, "creation_date": 1511947562, "question_id": 47549212, "link": "https://stackoverflow.com/questions/47549212/how-to-debug-shake-rules-execution", "title": "How to debug shake rules execution?", "body": "<p>I love Shake as a build system, but one thing I find hard with Shake is to troubleshoot rules triggering issues. I often run into a situation where I <em>think</em> something should not be rebuilt yet it is rebuilt. </p>\n\n<p>What are some guidelines to troubleshoot those kind of issues, beyond staring at the code and thinking hard? </p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 1, "creation_date": 1511951771, "post_id": 47548725, "comment_id": 82057905, "body": "Can you put the code in a github repo or something? Though I&#39;m guessing you&#39;re simply missing a pragma like <code>{-# LANGUAGE QuasiQuotes #-}</code> (and possibly TemplateHaskell OverloadedStrings, TypeFamilies)"}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 1, "creation_date": 1511952266, "post_id": 47548725, "comment_id": 82058269, "body": "(<code>[whamlet|&lt;h1&gt;#{theText}|]</code> is a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#template-haskell-quasi-quotation\" rel=\"nofollow noreferrer\">quasiquote</a>)"}, {"owner": {"reputation": 911, "user_id": 3528539, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/76bcc5c6b40213c8bbee447308334cf4?s=128&d=identicon&r=PG&f=1", "display_name": "Asalle", "link": "https://stackoverflow.com/users/3528539/asalle"}, "reply_to_user": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1511964244, "post_id": 47548725, "comment_id": 82065997, "body": "@unhammer thank you, I added the quasiquote pragma and it works! Please add an answer so I can accept it."}], "answers": [{"tags": [], "owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "is_accepted": true, "score": 3, "last_activity_date": 1511982492, "creation_date": 1511982492, "answer_id": 47560032, "question_id": 47548725, "link": "https://stackoverflow.com/questions/47548725/error-parse-error-on-input-using-simples-yesod-code/47560032#47560032", "title": "error: parse error on input \u2018{\u2019 using simples yesod code", "body": "<p><code>[whamlet|&lt;h1&gt;#{theText}|]</code> is <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#template-haskell-quasi-quotation\" rel=\"nofollow noreferrer\">quasiquote</a> syntax; this requires enabling the QuasiQuotes GHC extension. </p>\n\n<p>The simplest way to enable it is to add the <a href=\"https://downloads.haskell.org/~ghc/7.0.4/docs/html/users_guide/pragmas.html\" rel=\"nofollow noreferrer\">pragma</a> <code>{-# LANGUAGE QuasiQuotes #-}</code> to the top of the .hs file (which enables it for that file only \u2013 you can also enable pragmas project-wide in the Cabal file).</p>\n"}], "owner": {"reputation": 911, "user_id": 3528539, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/76bcc5c6b40213c8bbee447308334cf4?s=128&d=identicon&r=PG&f=1", "display_name": "Asalle", "link": "https://stackoverflow.com/users/3528539/asalle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 1, "accepted_answer_id": 47560032, "answer_count": 1, "score": 2, "last_activity_date": 1511982492, "creation_date": 1511946029, "last_edit_date": 1511948690, "question_id": 47548725, "link": "https://stackoverflow.com/questions/47548725/error-parse-error-on-input-using-simples-yesod-code", "title": "error: parse error on input \u2018{\u2019 using simples yesod code", "body": "<p>I built basic yesod template like this:</p>\n\n<pre><code>stack new kek yesod-simple\nstack build \n</code></pre>\n\n<p>it was okay. After that I tried to add a handler following <a href=\"https://www.schoolofhaskell.com/user/yogsototh/a-yesod-tutorial#echo\" rel=\"nofollow noreferrer\">this</a> tutorial, the <code>echo</code> part:</p>\n\n<ol>\n<li><p>I added <code>/echo/#String EchoR GET</code> to config/routes</p></li>\n<li><p>I also added the following handler to Home.hs</p>\n\n<pre><code>getEchoR :: String -&gt; Handler RepHtml    \ngetEchoR theText = do    \n    defaultLayout $ do    \n            [whamlet|&lt;h1&gt;#{theText}|]\n</code></pre></li>\n</ol>\n\n<p>When I tried <code>stack build</code> again I got the following error:</p>\n\n<pre><code>[8 of 9] Compiling Handler.Home     ( src/Handler/Home.hs, .stack-work/dist/x86_64-linux-nopie/Cabal-1.24.2.0/build/Handler/Home.o )\n\n/home/kek/me/haskell/webservices/lol/src/Handler/Home.hs:72:23: error: parse error on input \u2018{\u2019\n\n--  While building package lol-0.0.0 using:\n      /home/kek/.stack/setup-exe-cache/x86_64-linux-nopie/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux-nopie/Cabal-1.24.2.0 build lib:lol --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>I just copied this <code>whamlet[...]</code> string from the tutorial, everything else is generated according to yesod-simple template, I didn't change anything. </p>\n\n<p>upd: I managed to get it working by changing handler code to the following:</p>\n\n<pre><code>getEchoR :: String -&gt; Handler RepHtml\ngetEchoR theText = do\n    defaultLayout $ do\n        setTitle \"My Awesome Site\"\n        $(widgetFile \"echo\")\n</code></pre>\n\n<p>And adding a sample <code>echo.hamlet</code> file to /templates/</p>\n\n<pre><code>&lt;!-- Static navbar --&gt;\n&lt;nav .navbar.navbar-default.navbar-static-top&gt;\n    &lt;div .container&gt;\n        &lt;div .navbar-header&gt;\n            &lt;button type=\"button\" .navbar-toggle.collapsed data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\"&gt;\n                &lt;span class=\"sr-only\"&gt;Toggle navigation&lt;/span&gt;\n                &lt;span class=\"icon-bar\"&gt;&lt;/span&gt;\n                &lt;span class=\"icon-bar\"&gt;&lt;/span&gt;\n                &lt;span class=\"icon-bar\"&gt;&lt;/span&gt;\n\n        &lt;div #navbar .collapse.navbar-collapse&gt;\n            &lt;ul .nav.navbar-nav&gt;\n\n            &lt;ul .nav.navbar-nav.navbar-right&gt;\n\n\n&lt;!-- Page Contents --&gt;\n\n&lt;div .container&gt;\n\n\n&lt;!-- Footer --&gt;\n&lt;footer .footer&gt;\n    &lt;div .container&gt;\n        &lt;p .text-muted&gt;\n</code></pre>\n\n<p>So my question change to following: am I obliged to do this in this case?</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "hamming-numbers", "smooth-numbers"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511952966, "post_id": 47550833, "comment_id": 82058732, "body": "What is <code>map (3*) hamming</code> supposed to do? You want to multiply the <i>elements</i> of a function (?!) with three?"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1518918655, "last_edit_date": 1518918655, "creation_date": 1511968061, "answer_id": 47555900, "question_id": 47550833, "link": "https://stackoverflow.com/questions/47550833/hamming-with-lists-in-haskell/47555900#47555900", "title": "Hamming with lists in Haskell", "body": "<p>Even though this is a <a href=\"https://stackoverflow.com/questions/46404939/algorithm-to-find-products-of-a-set-of-primes-in-order-greater-than-x\">duplicate</a>, I'll show you how you could arrive at the solution. Which does appear at the duplicate; here my focus will be more on a journey, not its destination. You tried</p>\n\n<pre><code>hamming (x:xs)\n    = 1 : merge (map (2*) hamming) (merge (map (3*) hamming) (map (5*) hamming))\n</code></pre>\n\n<p>What is going on here? Is it a function? A list? It's all jumbled up here; it's a mess. You want to turn your list definition into a function, calling it as <code>hamming [2,3,5]</code>, say; but then <em>what</em> should be going into the <code>map</code> expressions? A function call, <code>hamming [2,3,5]</code>, as well? </p>\n\n<p>But that would defeat the purpose, as we are expressly using the <em>same</em> list here in several separate places, i.e. the three (or possibly <em>more...</em>) <code>map</code>s, each maintaining its own pointer into the shared sequence. And making separate function calls, even if equivalent, will (most likely and nearly assuredly) produce three separate even if equal lists. And that is <em>not</em> what we need here (this is actually a fun exercise; try it and see how much slower and memory hungry the function will get).</p>\n\n<p>So, separate your concerns! Re-write it first as (still invalid)</p>\n\n<pre><code>hamming (x:xs) = h where\n  h = 1 : merge (map (2*) h) (merge (map (3*) h) (map (5*) h))\n</code></pre>\n\n<p>Now <code>h</code> is the shared list, and you have the freedom to make your function, <code>hamming</code>, whatever you want it to be, i.e.</p>\n\n<pre><code>hamming :: [Integer] -&gt; [Integer] \nhamming [2,3,5] = h where\n   h = 1 : merge (map (2*) h) (merge (map (3*) h) (map (5*) h))\n     = 1 : merge (map (2*) h) (merge (map (3*) h) (merge (map (5*) h) []))\n</code></pre>\n\n<p>that is,</p>\n\n<pre><code>     = 1 : foldr merge [] [map (p*) h | p &lt;- [2,3,5]]\n</code></pre>\n\n<p>because</p>\n\n<pre><code>       g a (g b (g c (... (g n z) ...)))\n     =\n       foldr g z [a,b,c,...,n]\n</code></pre>\n\n<p>and there it is, your answer, up to some mundane renaming of parameters.</p>\n\n<p>Don't forget to rename your <code>merge</code> function as <code>union</code>, as \"merge\" isn't supposed to skip  the duplicates, being evocative of <em>mergesort</em> as it is. And keep all your definitions starting at the same indentation level in the file.</p>\n"}], "migrated_from": {"other_site": {"aliases": ["http://computerscience.stackexchange.com"], "markdown_extensions": ["MathJax", "Prettify"], "launch_date": 1439905020, "open_beta_date": 1332272936, "closed_beta_date": 1331060400, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/cs/Img/apple-touch-icon@2.png", "favicon_url": "https://cdn.sstatic.net/Sites/cs/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/cs/Img/apple-touch-icon.png", "audience": "students, researchers and practitioners of computer science", "site_url": "https://cs.stackexchange.com", "api_site_parameter": "cs", "logo_url": "https://cdn.sstatic.net/Sites/cs/Img/logo.png", "name": "Computer Science", "site_type": "main_site"}, "on_date": 1511952178, "question_id": 84632}, "owner": {"user_type": "does_not_exist", "display_name": "beginner334"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518918655, "creation_date": 1511944181, "last_edit_date": 1511968800, "question_id": 47550833, "link": "https://stackoverflow.com/questions/47550833/hamming-with-lists-in-haskell", "title": "Hamming with lists in Haskell", "body": "<p>I want to write a hamming function in Haskell that gets a list as Input. I already have this:</p>\n\n<pre><code>    merge :: [Integer] -&gt; [Integer] -&gt; [Integer]\n    merge (x:xs)(y:ys)\n      | x == y    = x : merge xs ys\n      | x &lt;  y    = x : merge xs (y:ys)\n      | otherwise = y : merge (x:xs) ys\n\n\nhamming :: [Integer] \nhamming \n  = 1 : merge (map (2*) hamming) (merge (map (3*) hamming) (map (5*) hamming))\n</code></pre>\n\n<p>That was easy. But now i want something like \"hamming [4,6,7,9]\" as input. The actual input is 1 but now the input should be a list and every number that is in the list is in the hamming-list. And of course 2x 3x and 5x are in the list. </p>\n\n<p>I wrote something like </p>\n\n<p><code>\"hamming (x:xs) = x : merge (map (2*) hamming) (merge (map (3*) hamming) (map (5*) hamming))\"</code> just to test with a list but it doesn't work.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511942385, "post_id": 47547393, "comment_id": 82051902, "body": "You can&#39;t, without a newtype or data wrapper."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1511950889, "post_id": 47547393, "comment_id": 82057246, "body": "You normally aren\u2019t allowed to define instances for type synonyms. Imagine you define a <code>Show</code> like class called <code>Write</code> (say) and you define an instance <code>Write Char</code> and <code>Write a =&gt; Write [a]</code> and now you want to do strings differently so you define <code>Write String</code>. But that isn\u2019t allowed because <code>String</code> is just <code>[Char]</code> so Haskell wouldn\u2019t be able to decide which instance to use. I think this is the root of your error even though your class has no members so all instances are isomorphic. There\u2019s probably some extensions you can turn on to make this work"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 2, "creation_date": 1511957773, "post_id": 47547393, "comment_id": 82061703, "body": "@DanRobertson <a href=\"https://stackoverflow.com/q/22665556/1126841\">Nope</a>. Although I think <code>FlexibleInstances</code> is what would allow you to have both <code>Write String</code> and <code>Write a =&gt; Write [a]</code>; the <code>String</code> instance (since <code>String</code> is a fully applied type synonym) is used when applicable, otherwise the general list instance is used."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511959016, "post_id": 47547393, "comment_id": 82062585, "body": "@chepner ah ok thanks for that"}], "owner": {"reputation": 718, "user_id": 1078763, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9392833e02aba05610a0428ca1d8dd57?s=128&d=identicon&r=PG", "display_name": "user1078763", "link": "https://stackoverflow.com/users/1078763/user1078763"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1511941113, "creation_date": 1511941113, "question_id": 47547393, "link": "https://stackoverflow.com/questions/47547393/how-to-work-around-the-fact-that-type-synonyms-have-to-be-fully-applied-in-insta", "title": "How to work around the fact that type synonyms have to be fully applied in instance definitions?", "body": "<pre><code>class Foo (x :: * -&gt; * -&gt; *) where\n\ndata Bar a b\n\ninstance Foo Bar\n\ntype Baz a b = Either (Bar a b) b\n\ninstance Foo Baz -- does not work as Foo is a type synonym and not fully applied\n</code></pre>\n\n<p>For the given example is there a way to define an instance for <code>Either (Bar a b) b</code> without adding a <code>newtype</code> or altering <code>Foo</code>?</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1511937536, "post_id": 47545964, "comment_id": 82049621, "body": "You&#39;d probably be interested in looking at the idea of a <a href=\"https://en.wikipedia.org/wiki/Closed_category\" rel=\"nofollow noreferrer\">closed category</a> (and possibly the more specific <a href=\"https://en.wikipedia.org/wiki/Closed_monoidal_category\" rel=\"nofollow noreferrer\">closed monoidal category</a> as well). Also, this might belong more over on <a href=\"https://cs.stackexchange.com\">cs.stackexchange.com</a> (or maybe even <a href=\"https://math.stackexchange.com\">math.stackexchange.com</a>). Finally, I&#39;m not sure how your last sentence relates to the rest of the question."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1511963413, "post_id": 47545964, "comment_id": 82065447, "body": "You might be interested in <a href=\"https://bartoszmilewski.com/2014/10/28/category-theory-for-programmers-the-preface/\" rel=\"nofollow noreferrer\">Category Theory for Programmers</a>. Note that you should interpret the title as meaning &quot;Category theory explained in terms programmers will understand&quot;, not (as I originally did) &quot;Bits of category theory that will be immediately usable in your code&quot; :)"}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1511945408, "post_id": 47547572, "comment_id": 82053572, "body": "As I see it, then, the <code>Axis</code> in question is that exponential object: <code>[Cursor] ^ Cursor</code>. Now, should I connect <code>Cursor</code> &amp; <code>[Cursor]</code> with a very long, arrow-shaped exponential object? Or rather forfeit the idea of drawing a cartesian closed category with a pen &amp; paper?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1511973024, "post_id": 47547572, "comment_id": 82072407, "body": "@Kindaro It depends on what you want to achieve. In general, these constructions can be helpful in rewriting a program in pointfree style, but sometimes this results is code which is much more complex than its pointful variant. E.g. writing <code>uncurry id</code> is not the best way to describe a function taking <code>(f,x)</code> and returning <code>f x</code> -- even if this is a basic result in cartesian closed categories. Personally, I like using <code>(&amp;&amp;&amp;),(***)</code> from the <code>Arrow</code> module when they can shorten boring code, still I usually am quite conservative on abusing pointfree style."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1511978746, "post_id": 47547572, "comment_id": 82075838, "body": "@Kindaro You should provide more information about what you&#39;re trying to do. I strongly suspect that trying to look at it from a category theory perspective will not help you out here in the first place (unless the actual objective is just to learn about category theory), but we need a bit more info."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1512018709, "post_id": 47547572, "comment_id": 82090293, "body": "@DavidYoung Starting from the suggestions that a category may be depicted as a graph, and that Haskell types form a category (even if more complicated than <b>Set</b>), I wanted to test the assumption that a fragment of a Haskell program may be depicted as a graph. Now, for the case at hand I am at loss searching for a depiction. I should now think awhile more and perhaps assume not all categories are graph-depictable (specifically, not those of which a hom-set is itself an object) and that an otherwise correct Haskell program fragment will oft happen to belong to such a category."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1512019091, "post_id": 47547572, "comment_id": 82090410, "body": "@DavidYoung Please take my word for the fact that my layman-level interest in category theory is founded on the more practical interest in Haskell. I had easily found practical benefit applying some elementary category-theoretical concepts to my code (for example, identifying unary functions within a module with iso, monic &amp; epi morphisms and depicting their relationships helps me understand what collection of functions I should export to expose a smallest complete interface), but on polyary functions I&#39;m so lost I can&#39;t even depict the code in terms of morphisms anymore!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1511941816, "creation_date": 1511941816, "answer_id": 47547572, "question_id": 47545964, "link": "https://stackoverflow.com/questions/47545964/how-to-use-category-theory-diagrams-with-polyary-functions/47547572#47547572", "title": "How to use category theory diagrams with polyary functions?", "body": "<p>There are two approaches to model binary functions as morphism in category theory (n-ary functions are dealt with similarly -- no new machinery is needed). One is to consider the uncurried version:</p>\n\n<pre><code>(A * B) -&gt; C\n</code></pre>\n\n<p>where we take the product of the types <code>A</code> and <code>B</code> as a starting object. For that we need the category to contain such a products. (In Haskell, products are written <code>(A, B)</code>. Well, technically in Haskell this is not exactly the product as in categories, but let's ignore that.)</p>\n\n<p>Another is to consider the result type <code>(B -&gt; C)</code> as an object in the category. Usually, this is called an exponential object, written as <code>C^B</code>. Assuming our category has such objects, we can write</p>\n\n<pre><code>A -&gt; C^B\n</code></pre>\n\n<p>These two representations of binary functions are isomorphic: using <code>curry</code> and <code>uncurry</code> we can transform each one into the other.</p>\n\n<p>Indeed, when there is such a (natural) isomorphism, we get a so called <em>cartesian closed category</em>, which is the simplest form of category which can describe a simply typed lambda calculus -- the core of every typed functional language.</p>\n\n<p>This isomorphism is often cited as an adjunction between two functors</p>\n\n<pre><code>(- * B) -| (- ^ B)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 0, "last_activity_date": 1512031753, "creation_date": 1512031753, "answer_id": 47569234, "question_id": 47545964, "link": "https://stackoverflow.com/questions/47545964/how-to-use-category-theory-diagrams-with-polyary-functions/47569234#47569234", "title": "How to use category theory diagrams with polyary functions?", "body": "<p>I can use tuple projections to depict this situation, as follows:\n<a href=\"https://i.stack.imgur.com/6TMgk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6TMgk.png\" alt=\"categorical depiction of the case at hand, in symbols\"></a></p>\n\n<p>-- Or, in actual Haskell terms:\n<a href=\"https://i.stack.imgur.com/4vysK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4vysK.png\" alt=\"categorical depiction of the case at hand, in actual terms\"></a></p>\n\n<p>This diagram features backwards <code>fst</code> &amp; <code>snd</code> arrows in place of a binary function that constructs the tuple from its constituents, and that I can in no way depict directly. The caveat is that, while in this diagram <code>Cursor</code> has only one incoming arrow, I should remember that in actual code some real arrows <code>X -&gt; Axis</code> &amp; <code>Y -&gt; Cursor</code> should go to both of the projections of the tuple, not just the symbolic projecting functions. The flow will then be uniformly left to right.</p>\n\n<p>Pragmatically speaking, I traded an <em>arrow with two sources</em> (that constructs a tuple and isn't a morphism) for <em>two reversed arrows</em> (the tuple's projections that are legal morphisms in all regards).</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 47569234, "answer_count": 2, "score": 2, "last_activity_date": 1512031753, "creation_date": 1511934807, "question_id": 47545964, "link": "https://stackoverflow.com/questions/47545964/how-to-use-category-theory-diagrams-with-polyary-functions", "title": "How to use category theory diagrams with polyary functions?", "body": "<p>So, there's a lot of buzz about categories all around the Haskell ecosystem. But I feel one piece is missing from the common sense I have so far absorbed by osmosis. <em>(I did read the first few pages of Mac Lane's famous introduction as well, but I don't believe I have enough mathematical maturity to carry the wisdom from this text to actual programming I have at hand.)</em> I will now follow with a real world example involving a binary function that I have trouble depicting in categorical terms.</p>\n\n<p>So, I have this function chain that allows me to <code>S -&gt; A</code>, where <code>A</code> is a type synonym for a function, akin to <code>a -&gt; b</code>. Now, I want to depict a process that does <code>S -&gt; a -&gt; b</code>, but I end up with an arrow pointing to another arrow rather than an object. How do I deal with such predicament?</p>\n\n<p>I did overhear someone talking about a thing called <em>n-category</em> but I don't know if I should even try to understand what it is and how it's useful.</p>\n\n<p>Though I believe my abstraction is accurate, the actual functions are <code>parsePath &gt;&gt;&gt; either error id &gt;&gt;&gt; toAxis :: String -&gt; Text.XML.Cursor.Axis</code> from <code>selectors</code> and <code>Axis = Text.XML.Cursor.Cursor -&gt; [Text.XML.Cursor.Cursor]</code> from <code>xml-conduit</code>.</p>\n"}, {"tags": ["c", "haskell", "fluidsynth"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1511914179, "post_id": 47542885, "comment_id": 82043090, "body": "Frankly, if you&#39;re new to Haskell <i>and</i> don&#39;t know C, then it doesn&#39;t seem very prudent to start right with a nontrivial FFI binding, which combines the pitfalls of both languages."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511916844, "post_id": 47542885, "comment_id": 82043815, "body": "This example is far from minimal, so it&#39;s hard to see what the problem is (esp. since each of these C functions will have their own requirements for what the lifetime of their pointer arguments may be). But one very obvious thing which stands out is <code>c&#39;new_fluid_audio_driver ptr ptr&#39; &gt;&gt;= newForeignPtr p&#39;delete_fluid_audio_driver &gt;&gt; ...</code> - here you create a pointer with the foreign call and immediately discard it!"}, {"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511924835, "post_id": 47542885, "comment_id": 82045705, "body": "@user2407038 Sorry I can&#39;t isolate the issue further because all of these calls are necessary to initialize fluidsynth and even attempt to get sound. I discarded the <code>newForeignPtr</code> line you mentioned, because I really don&#39;t use its output, but that didn&#39;t change anything. I&#39;m pretty sure it&#39;s about the <code>Synth</code> pointers not being freed properly. When a function that plays a sound passes on the <code>Synth</code> it used, I get no segfaults, but if I <code>return ()</code> at the end of the playing function, things break. Note the type signatures of <code>justPlay</code> and <code>justPlay&#39;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 2, "last_activity_date": 1511971066, "last_edit_date": 1511971066, "creation_date": 1511961567, "answer_id": 47553825, "question_id": 47542885, "link": "https://stackoverflow.com/questions/47542885/cleaning-up-after-foreign-c-pointers-in-haskell/47553825#47553825", "title": "Cleaning up after foreign C pointers in Haskell", "body": "<p>It is hard to say what exactly couses the crash, but there is at least one obviuosly wrong thing. Occurding to the <a href=\"http://www.fluidsynth.org/api/synth_8h.html#a585a63f3a25b9df17b82ae87f2d38cfc\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>Other users of a synthesizer instance, such as audio and MIDI drivers, should be deleted prior to freeing the FluidSynth instance.</p>\n</blockquote>\n\n<p>In your case the order of finalizers is not defined, so synthesizer could be deleted before driver. Probably other objects also has restrictions on their life circle.</p>\n\n<p>To explicitly finalize foreign pointer use <code>finalizeForeignPtr</code>.</p>\n"}], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 47553825, "answer_count": 1, "score": 2, "last_activity_date": 1511971066, "creation_date": 1511913077, "last_edit_date": 1511914037, "question_id": 47542885, "link": "https://stackoverflow.com/questions/47542885/cleaning-up-after-foreign-c-pointers-in-haskell", "title": "Cleaning up after foreign C pointers in Haskell", "body": "<p>I wrote a set of utility functions around the bindings-fluidsynth library:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>module FSUtilities where\n\nimport Control.Monad\nimport System.Directory\nimport Foreign.Ptr\nimport Foreign.ForeignPtr\nimport Foreign.C.Types\nimport Foreign.C.String\nimport Bindings.FluidSynth\n\nnewtype Settings = Settings (ForeignPtr C'fluid_settings_t)\n\nnewtype Synth = Synth (ForeignPtr C'fluid_synth_t)\n\ntype Channel = Int\ntype Key = Int\ntype Velocity = Int\n\ninitSynth :: IO Synth\ninitSynth = createSettings &gt;&gt;=\n            changeSettingStr \"audio.driver\" \"alsa\" &gt;&gt;=\n            changeSettingInt \"synth.polyphony\" 64 &gt;&gt;=\n            (\\s -&gt; createSynth s &gt;&gt;= createDriver s) &gt;&gt;=\n            loadSF \"GS.sf2\"\n\ncreateSettings :: IO Settings\ncreateSettings =\n    c'new_fluid_settings &gt;&gt;=\n    newForeignPtr p'delete_fluid_settings &gt;&gt;= (pure $!) . Settings\n\nchangeSettingStr :: String -&gt; String -&gt; Settings -&gt; IO Settings\nchangeSettingStr k v (Settings s) =\n    withForeignPtr s $ \\ptr -&gt;\n          withCAString k $ \\cstr -&gt;\n              withCAString v $ \\cstr' -&gt;\n                  c'fluid_settings_setstr ptr cstr cstr' &gt;&gt;\n    (pure $! Settings s)\n\nchangeSettingInt :: String -&gt; Int -&gt; Settings -&gt; IO Settings\nchangeSettingInt k v (Settings s) =\n    withForeignPtr s $ \\ptr -&gt;\n          withCAString k $ \\cstr -&gt;\n              c'fluid_settings_setint ptr cstr (fromIntegral v) &gt;&gt;\n    (pure $! Settings s)\n\ncreateSynth :: Settings -&gt; IO Synth\ncreateSynth (Settings s) =\n    withForeignPtr s c'new_fluid_synth &gt;&gt;=\n    newForeignPtr p'delete_fluid_synth &gt;&gt;= (pure $!) . Synth\n\ncreateDriver :: Settings -&gt; Synth -&gt; IO Synth\ncreateDriver (Settings set) (Synth syn) =\n    withForeignPtr set $ \\ptr -&gt;\n        withForeignPtr syn $ \\ptr' -&gt;\n            c'new_fluid_audio_driver ptr ptr' &gt;&gt;=\n    newForeignPtr p'delete_fluid_audio_driver &gt;&gt;\n    (pure $! Synth syn)\n\nloadSF :: String -&gt; Synth -&gt; IO Synth\nloadSF path (Synth syn) =\n    withForeignPtr syn $ \\s -&gt;\n      makeAbsolute path &gt;&gt;= \\p -&gt;\n        withCAString p $ \\p' -&gt;\n          c'fluid_synth_sfload s p' 1 &gt;&gt;=\n    \\c -&gt; if c == (-1) then error    \"loadSF: Could not load SoundFont\"\n                       else putStrLn \"loadSF: SoundFont loaded\" &gt;&gt;\n                            (pure $! Synth syn)\n\nnoteOn :: Channel -&gt; Key -&gt; Velocity -&gt; Synth -&gt; IO ()\nnoteOn c k v (Synth ptr) =\n    withForeignPtr ptr $ \\syn -&gt;\n        c'fluid_synth_noteon syn c' k' v' &gt;&gt; pure ()\n            where c' = fromIntegral c\n                  k' = fromIntegral k\n                  v' = fromIntegral v\n\njustPlay :: Channel -&gt; Key -&gt; IO ()\njustPlay c k = initSynth &gt;&gt;= noteOn c k 127\n\njustPlay' :: Channel -&gt; Key -&gt; IO Synth\njustPlay' c k = initSynth &gt;&gt;= \\s -&gt; noteOn c k 127 s &gt;&gt; pure s\n</code></pre>\n\n<p>The <code>justPlay</code> and <code>justPlay'</code> functions serve to illustrate the issue. When I call <code>justPlay</code> from ghci, I get random segfaults (not consistently, around 30% of the time), while <code>justPlay'</code> never does that (but swiftly fills up my system's memory after a bunch of calls, due to dangling <code>Synth</code>s. I think this is because I'm not cleaning up after myself when the <code>Synth</code> is no longer referenced, but I thought the call to <code>newForeignPtr</code> with a finalizer function at the creation of <code>Synth</code> was supposed to take care of that automatically.</p>\n\n<p>I'm new to Haskell and I don't know C, so I'm trying to feel my way through this. What's the proper way to handle such a situation?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1511907597, "post_id": 47541845, "comment_id": 82040949, "body": "This does not makes much sense, since <code>showString &quot;\\\\&quot;</code> is a function that expects another <code>String</code> parameter."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1511908554, "post_id": 47541845, "comment_id": 82041332, "body": "The string <code>&quot;\\\\&quot;</code> is precisely the string composed of a single backslash (try <code>length &quot;\\\\&quot;</code> and <code>head &quot;\\\\&quot;</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 7841878, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ea84e22431b5da70d9f514ee95767b09?s=128&d=identicon&r=PG&f=1", "display_name": "James Hamish", "link": "https://stackoverflow.com/users/7841878/james-hamish"}, "edited": false, "score": 0, "creation_date": 1511908405, "post_id": 47541930, "comment_id": 82041277, "body": "I&#39;m still unsure of how I can use the showString method to return a string containing a single &#39;\\&#39;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 105, "user_id": 7841878, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ea84e22431b5da70d9f514ee95767b09?s=128&d=identicon&r=PG&f=1", "display_name": "James Hamish", "link": "https://stackoverflow.com/users/7841878/james-hamish"}, "edited": false, "score": 0, "creation_date": 1511908596, "post_id": 47541930, "comment_id": 82041349, "body": "@JamesHamish: well the function <i>returns</i> a string where the <i>content</i> it a single backslash, but the <i>representation</i> of a string escapes that."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1511908714, "last_edit_date": 1511908714, "creation_date": 1511907770, "answer_id": 47541930, "question_id": 47541845, "link": "https://stackoverflow.com/questions/47541845/printing-a-single-backslash-in-haskell-using-showstring/47541930#47541930", "title": "Printing a single backslash in haskell using ShowString", "body": "<p><code>showString</code> has type:</p>\n\n<pre><code>showString :: String -&gt; String -&gt; String\n</code></pre>\n\n<p>so that means you need to provide two strings (you provide one together with an empty string). Basically <code>showString</code> concatenates the two strings (which is not a problem). The function <code>showString \"\\\\\" \"\"</code> <em>returns</em> a string with a single backslash, but it does not <em>print</em> anything (since <code>showString</code>) is a function that only returns content.</p>\n\n<p>Now there is a difference between the <em>content</em> of a string, and its <em>representation</em>. New lines, tabs, unicode characters, etc. are <em>represented</em> by <em>escaping</em>: one uses a backslash followed by some pattern. This pattern is not part of the <em>content</em> of the string.</p>\n\n<p>Nevertheless <code>showString</code> does <em>not</em> print anything. It returns a <code>String</code>, and that string is shown as a string literal by the interactive console.</p>\n\n<p>In order to print the <em>content</em> (not its representation) of a string, you can use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:putStrLn\" rel=\"nofollow noreferrer\"><strong><code>putStrLn :: String -&gt; IO ()</code></strong></a> or <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:putStr\" rel=\"nofollow noreferrer\"><strong><code>putStr :: String -&gt; IO ()</code></strong></a> in case you want to omit the new line.</p>\n\n<p>This then produces:</p>\n\n<pre><code>Prelude&gt; putStrLn \"\\\\\"\n\\\n</code></pre>\n\n<p><code>PutStrLn</code> will for a given <code>String</code> produce an <code>IO ()</code> that will print the string to the standard output channel (<code>stdout</code>). It is somewhat equivalent to <code>print(..)</code> in Python, <code>System.out.println(..)</code> in Java, and <code>Console.WriteLine(..)</code> in C#.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1511912072, "creation_date": 1511912072, "answer_id": 47542700, "question_id": 47541845, "link": "https://stackoverflow.com/questions/47541845/printing-a-single-backslash-in-haskell-using-showstring/47542700#47542700", "title": "Printing a single backslash in haskell using ShowString", "body": "<p>You probably want to use:</p>\n\n<pre><code>putStrLn (showString \"\\\\\" [])\n</code></pre>\n\n<p>Within the GHCi REPL when you enter a value, vs an IO action, is is automatically rendered using <code>show</code> which will then escape some characters.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; showString \"\\\\\" []\n\"\\\\\"\nPrelude&gt; putStrLn $ showString \"\\\\\" []\n\\\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7841878, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ea84e22431b5da70d9f514ee95767b09?s=128&d=identicon&r=PG&f=1", "display_name": "James Hamish", "link": "https://stackoverflow.com/users/7841878/james-hamish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1037, "favorite_count": 0, "accepted_answer_id": 47542700, "answer_count": 2, "score": 1, "last_activity_date": 1511912072, "creation_date": 1511907463, "last_edit_date": 1511907798, "question_id": 47541845, "link": "https://stackoverflow.com/questions/47541845/printing-a-single-backslash-in-haskell-using-showstring", "title": "Printing a single backslash in haskell using ShowString", "body": "<p>I am trying to return a string including a single backslash in Haskell, I am using <code>showString \"\\\\\" []</code></p>\n\n<p>My function type is Int -> String -> String\nhowever this is outputting two backslashes.</p>\n\n<p>How can I return a string with a single backslash? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7577, "user_id": 5638835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fba9e7db4baba416a82c4277758d886?s=128&d=identicon&r=PG&f=1", "display_name": "puhlen", "link": "https://stackoverflow.com/users/5638835/puhlen"}, "edited": false, "score": 2, "creation_date": 1511893896, "post_id": 47538553, "comment_id": 82034012, "body": "Could you explain what, specifically, you are having trouble understanding and what your understanding of the rest of the code is?"}, {"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "reply_to_user": {"reputation": 7577, "user_id": 5638835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fba9e7db4baba416a82c4277758d886?s=128&d=identicon&r=PG&f=1", "display_name": "puhlen", "link": "https://stackoverflow.com/users/5638835/puhlen"}, "edited": false, "score": 0, "creation_date": 1511894065, "post_id": 47538553, "comment_id": 82034089, "body": "I am having trouble understand what cpfx,cpfx&#39; and ifMatch are doing. @puhlen"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 3, "creation_date": 1511894144, "post_id": 47538553, "comment_id": 82034122, "body": "@blazing That&#39;s all the code. What specifically about them do you need help understanding?"}, {"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1511894512, "post_id": 47538553, "comment_id": 82034304, "body": "why do you need cpfx and cpfx&#39; ?@Carcigenicate"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1511896744, "post_id": 47538553, "comment_id": 82035512, "body": "<code>cpfx&#39;</code> is not well defined.  It&#39;s prone to <code>index too large Exception</code>"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1511904361, "post_id": 47538553, "comment_id": 82039571, "body": "@karakfa that&#39;s okay, I don&#39;t think <code>ifMatch</code> is testing what it thinks it is, anyway."}, {"owner": {"reputation": 845, "user_id": 2291248, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/62020bb07b3c5292ba8a064d6abf6a4d?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/2291248/adam"}, "edited": false, "score": 0, "creation_date": 1565869072, "post_id": 47538553, "comment_id": 101485732, "body": "<a href=\"https://wiki.haskell.org/How_to_read_Haskell\" rel=\"nofollow noreferrer\">wiki.haskell.org/How_to_read_Haskell</a>"}], "answers": [{"comments": [{"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1511981863, "post_id": 47540504, "comment_id": 82077345, "body": "But in the new code you have, are you literally doing the same thing I did in the previous code, but more efficiently? @Adam Smith"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1511982776, "post_id": 47540504, "comment_id": 82077825, "body": "@blazing that&#39;s a difficult question to answer. Yes and no. I&#39;m producing the same results, but through different means. I&#39;m mostly trying to avoid using <code>(!!)</code> as much as possible (indexing a haskell list is slow compared to many other languages). Especially my solutions using <code>transpose</code> are significantly faster since <code>transpose</code> is O(2n) instead of O(n log n) by mapping over <code>(!!)</code>"}, {"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1512052713, "post_id": 47540504, "comment_id": 82108804, "body": "I see, so allEq and ifMatch pretty much do the same thing but without using (!!), correct? And what is safeIndex doing and what is the main difference between your prefix function and my commonPrefix function? @Adam Smith"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1512070327, "post_id": 47540504, "comment_id": 82119852, "body": "<code>allEq</code> is not the same as <code>ifMatch</code>. <code>allEq</code> specifically looks at an <code>Eq a =&gt; [a]</code> to make sure all its elements are equal to each other. <code>safeIndex</code> is <code>(!!)</code> operating in the Maybe monad -- try <code>&quot;short&quot; !! 10</code> vs <code>&quot;short&quot; `safeIndex` 10</code>"}, {"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1512095983, "post_id": 47540504, "comment_id": 82129366, "body": "I still dont understand what safeIndex does though @Adam Smith"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1512099691, "post_id": 47540504, "comment_id": 82130233, "body": "@blazing I&#39;m not sure what&#39;s not clear. Play with it in GHCI and I think you&#39;ll understand on your own."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 2, "last_activity_date": 1511904228, "last_edit_date": 1511904228, "creation_date": 1511901397, "answer_id": 47540504, "question_id": 47538553, "link": "https://stackoverflow.com/questions/47538553/explaining-haskell-code/47540504#47540504", "title": "Explaining Haskell Code", "body": "<p>Take each function directly and look at it. Let's start from the bottom up, since they each use each other.</p>\n\n<pre><code>ifMatch :: [[Char]] -&gt; Int -&gt; Bool\n</code></pre>\n\n<p>so <code>ifMatch</code> takes a list of lists of Chars (or a list of Strings) and an Int, and gives you back a true/false value. Now let's look at the pattern matches</p>\n\n<pre><code>[x] _      = True          -- one element list and any number is True\n[x, y] n   = x!!n == y!!n  {- two element list is true if the character at index\n                              @n@ is the same in both lists -}\n(x:y:xs) n                 -- three+ element list guards against...\n  | x!!n == y!n            --   if the characters at index @n@ are equal...\n      = ifMatch xs n       --   ... then recurse\n  | otherwise = False      --   otherwise, give me a False.\n</code></pre>\n\n<p>Taken together, you can see that <code>ifMatch</code> is supposed to check that all strings passed to it have the same letter at index <code>n</code>. It is equivalent to:</p>\n\n<pre><code>ifMatch [] _ = True\nifMatch xs n = let c = head xs !! n in\n               foldr ((&amp;&amp;) . (==c) . (!!n)) True xs\n</code></pre>\n\n<p>Though it actually appears to have a slight bug. It only checks if each pair of strings has identical letters at index <code>n</code>, so</p>\n\n<pre><code>ifMatch [\"This\", \"That\", \"In\", \"Onward\"] 1 == True\n--        (^  ==   ^)  &amp;&amp; (^  == ^)\n</code></pre>\n\n<hr>\n\n<pre><code>cpfx' :: [[Char]] -&gt; Int -&gt; [Char]\n</code></pre>\n\n<p>so <code>cpfx'</code> takes a list of list of Chars (or a list of Strings) and an Int and gives you back a list of Chars (or a String). Let's look at pattern matches here:</p>\n\n<pre><code>cpfx' [x] _    = []       -- one element list and any number is the empty list\ncpfx' (x:xs) n            -- multiple element list guards against...\n  | ifMatch (x:xs) n      --   if all @x:xs@ share an element at @n@...\n    = x!!n :              --   ...add x!!n and...\n      cpfx' (x:xs) (n+1)  --   ...recurse to the next index\n  | otherwise = []        --   otherwise, empty list.\n</code></pre>\n\n<p>So this grabs a character from <code>x</code> until the characters no longer match among all the strings in <code>x:xs</code>, and returns that prefix string.</p>\n\n<hr>\n\n<pre><code>cpfx :: [[Char]] -&gt; [Char]\n</code></pre>\n\n<p>From a list of list of Chars (or a list of Strings) to a list of Chars (or a String).</p>\n\n<pre><code>cpfx []     = []              -- empty string gives empty string\ncpfx [x]    = x               -- one-element list gives its only element\ncpfx (x:xs) = cpfx' (x:xs) 0  {- anything else gives the shared prefix starting\n                                 at index zero -}\n</code></pre>\n\n<hr>\n\n<p>All in all, we've got three functions that work together to give you the longest substring of the head of a list of strings that exists at the beginning of all strings in that list.</p>\n\n<pre><code>import Data.Maybe (mapMaybe)\n\nsafeIndex :: [a] -&gt; Int -&gt; Maybe a\nsafeIndex xs n | length xs &gt; n = Just $ xs !! n\n               | otherwise     = Nothing\n\nallEq :: Eq a =&gt; [a] -&gt; Bool\nallEq [] = True\nallEq [_] = True\nallEq (x:xs) = all (==x) xs\n\nprefix :: [String] -&gt; String\nprefix xss@(x:_) = map snd $ takeWhile pred $ zip [0..] x where\n  pred :: (Int, Char) -&gt; Bool\n  pred (n, _) = (allEq . mapMaybe (flip safeIndex n)) xss\n\ntestData :: [String]\ntestData = [\"Hello\", \"Hello, World!\", \"Hello, Universe!\", \"Hello everybody!\", \"Hell's to you, then!\"]\n\nmain :: IO ()\nmain = do\n  let p = prefix testData\n  putStrLn \"Should be \\\"Hell\\\"\"\n  putStrLn p\n</code></pre>\n\n<p>or much easier with <code>transpose</code></p>\n\n<pre><code>import Data.List (transpose)\n\nprefix' :: [String] -&gt; String\nprefix' xss@(x:_) = take (length $ takeWhile allEq transposed) x where\n  transposed = transpose xss\n</code></pre>\n\n<p>or slightly more efficient</p>\n\n<pre><code>lengthWhile :: (a -&gt; Bool) -&gt; [a] -&gt; Int\nlengthWhile _ [] = 0\nlengthWhile pred (x:xs) | pred x    = 1 + lengthWhile pred xs\n                        | otherwise = 0\n\nprefix'' :: [String] -&gt; String\nprefix'' xss@(x:_) = take (lengthWhile allEq transposed) x where\n  transposed = transpose xss\n</code></pre>\n"}], "owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "closed_date": 1511899122, "answer_count": 1, "score": -5, "last_activity_date": 1511904228, "creation_date": 1511893798, "last_edit_date": 1511902553, "question_id": 47538553, "link": "https://stackoverflow.com/questions/47538553/explaining-haskell-code", "closed_reason": "Needs more focus", "title": "Explaining Haskell Code", "body": "<p>I was given this code and told to explain its logic, does anyone know what is going on, new to Haskell.</p>\n\n<pre><code>cpfx :: [[Char]] -&gt; [Char]\ncpfx [] = []\ncpfx [x] = x\ncpfx (x:xs) = cpfx' (x:xs) 0\n\ncpfx' :: [[Char]] -&gt; Int -&gt; [Char]\ncpfx' [x] _ = []\ncpfx' (x:xs) n\n    | ifMatch (x:xs) n = x!!n : cpfx' (x:xs) (n+1)\n    | otherwise = []\n\nifMatch :: [[Char]] -&gt; Int -&gt; Bool\nifMatch [x] _ = True\nifMatch [x,y] n = x!!n == y!!n\nifMatch (x:y:xs) n\n    | x!!n == y!!n = ifMatch xs n\n    | otherwise = False\n</code></pre>\n\n<p>I am having trouble understand what cpfx,cpfx' and ifMatch are doing.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1511884424, "post_id": 47535492, "comment_id": 82028144, "body": "Note that the <code>Node</code> in the first data declaration is <i>completely unrelated</i> to the <code>Node</code> in the second declaration. The first is in the type namespace, the second is in the value namespace."}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1511884661, "post_id": 47535492, "comment_id": 82028323, "body": "How can I make it work ?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1511884786, "post_id": 47535492, "comment_id": 82028414, "body": "You&#39;re going to have to explain what you are trying to do, because <code>Blue[Leaf Red]</code> suggests you&#39;re confusing Haskell syntax with something else.  Objective C, maybe?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1511884908, "post_id": 47535492, "comment_id": 82028515, "body": "You forgot the constructor for the non-leaf <code>Tree</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1511885889, "post_id": 47535492, "comment_id": 82029185, "body": "As a bit of nuance to Alec&#39;s claim: the second data declaration has <i>two</i> occurrences of <code>Node</code>, and one of them is related while the other isn&#39;t. (Specifically, in <code>Leaf Node</code>, this <code>Node</code> does indeed refer to the previous data declaration.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1511887871, "post_id": 47535492, "comment_id": 82030482, "body": "Try not to reuse names for type and data constructors until you are more comfortable with the difference. <code>data Color = Blue | Green | Red</code> and <code>data Tree = Leaf Color | Node [Tree]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": true, "score": 6, "last_activity_date": 1511894229, "last_edit_date": 1511894229, "creation_date": 1511885683, "answer_id": 47536147, "question_id": 47535492, "link": "https://stackoverflow.com/questions/47535492/tree-data-doesnt-compile-in-haskell/47536147#47536147", "title": "Tree data doesn&#39;t compile in haskell", "body": "<p>You can create a <code>Tree</code> as a single leaf with one of the colors, e.g. <code>Leaf Red</code> or as a node with a list of other trees, e.g. <code>Node [Leaf Red]</code>. Your <code>main</code> function should look like this:</p>\n\n<pre><code>main = do\n  let a = Node [Leaf Red]\n  print 1\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>main = do\n  let a = Node [Leaf Blue, Leaf Red]\n  print 1\n</code></pre>\n\n<p>In case you also want to add colors to your nodes, you can redefine your <code>Tree</code> datatype to:</p>\n\n<pre><code>data Tree = Leaf Node | Node Node [Tree]\n...\nlet a = Node Blue [Leaf Red]\n</code></pre>\n\n<p>Reading this may be confusing, so you should consider renaming either the <code>Node</code> type or the <code>Node</code> data constructor.</p>\n"}], "owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 47536147, "answer_count": 1, "score": 1, "last_activity_date": 1511894229, "creation_date": 1511883790, "question_id": 47535492, "link": "https://stackoverflow.com/questions/47535492/tree-data-doesnt-compile-in-haskell", "title": "Tree data doesn&#39;t compile in haskell", "body": "<pre><code>data Node = Blue | Green | Red\ndata Tree = Leaf Node | Node [Tree]\n\nmain = do\n  let a = Blue[Leaf Red]\n  print 1\n</code></pre>\n\n<p>It gives me the following error:</p>\n\n<pre><code>main.hs:5:15: error:\n\u2022 Couldn't match expected type \u2018[Tree] -&gt; t\u2019\n              with actual type \u2018Node\u2019\n\u2022 The function \u2018Blue\u2019 is applied to one argument,\n  but its type \u2018Node\u2019 has none\n  In the expression: Blue [Leaf Red]\n  In an equation for \u2018a\u2019: a = Blue [Leaf Red]\n\u2022 Relevant bindings include a :: t (bound at main.hs:5:11)\n</code></pre>\n\n<p>And I don't understand why it says it got Node instead of [Tree]</p>\n"}, {"tags": ["haskell", "unification", "hindley-milner"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1511884637, "post_id": 47535328, "comment_id": 82028307, "body": "What do you mean by &quot;expected type is <code>[b] -&gt; [b]</code>&quot;? Why do you expect that?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1511885091, "post_id": 47535328, "comment_id": 82028662, "body": "I did <code>:t ap id</code> in GHCi with an <code>undefined</code> implementation for <code>ap</code>."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1511885254, "post_id": 47535328, "comment_id": 82028773, "body": "That tells you the type of  <code>ap</code> applied to <code>id</code>, not unified with <code>id</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1511885680, "post_id": 47535328, "comment_id": 82029052, "body": "Oh, right. So I mean the unification of <code>a -&gt; [b]</code> with <code>a -&gt; a</code>, I guess. Sorry!"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1511885743, "post_id": 47535328, "comment_id": 82029094, "body": "Ok, so..  That&#39;s an entirely different question.  You probably should edit your original question to clarify that. :)"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1511890684, "post_id": 47535328, "comment_id": 82032274, "body": "Substitution always changes a variable to something else (which could be a variable again)."}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1511888450, "post_id": 47536309, "comment_id": 82030862, "body": "@ftor absolutely. Basic Hindley-Milner type inference uses Algorithm W for unification. GHC goes beyond basic Hindley-Milner types in several ways, and so it uses a more complex algorithm. You can find publications by Simon Peyton Jones that describe different systems GHC has used over the years.  I believe the current algorithm is still based on <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/jfp-outsidein.pdf\" rel=\"nofollow noreferrer\">OutsideIn(X)</a> with some modifications as GHC has developed further."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1511888558, "post_id": 47536309, "comment_id": 82030946, "body": "Thanks for your time and for sharing your knowledge! I have made a big leap forward on this subject."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 4, "last_activity_date": 1511888147, "last_edit_date": 1511888147, "creation_date": 1511886196, "answer_id": 47536309, "question_id": 47535328, "link": "https://stackoverflow.com/questions/47535328/how-to-derive-the-type-of-an-applicator-applied-to-the-identity-function/47536309#47536309", "title": "How to derive the type of an applicator applied to the identity function", "body": "<p>Ok, new answer because I now understand the question being asked!  To restate the question:</p>\n\n<p>Given</p>\n\n<pre><code>ap :: (a -&gt; [b]) -&gt; a -&gt; [b]\nid :: a -&gt; a\n</code></pre>\n\n<p>Explain how the type of the expression <code>ap id</code> is derived.</p>\n\n<p>Answer:</p>\n\n<p>Rename variables:</p>\n\n<pre><code>ap :: (a -&gt; [b]) -&gt; a -&gt; [b]\nid :: a0 -&gt; a0\n</code></pre>\n\n<p>Unify:</p>\n\n<pre><code>(a -&gt; [b]) ~ (a0 -&gt; a0)\n</code></pre>\n\n<p>Apply generativity a couple times, pulling the arguments from the <code>(-&gt;)</code> type constructor:</p>\n\n<pre><code>a   ~ a0\n[b] ~ a0\n</code></pre>\n\n<p>Apply commutativity/transitivity of type equality:</p>\n\n<pre><code>[b] ~ a\n</code></pre>\n\n<p>Substitute the most specific types known into the types of <code>ap</code> and <code>id</code></p>\n\n<pre><code>ap :: ([b] -&gt; [b]) -&gt; [b] -&gt; [b]\nid :: [b] -&gt; [b]\n</code></pre>\n\n<p><code>[b]</code> is the most specific type known, because it provides some restriction. The value must be a list of something.  The other two equivalent type expressions just mean any type at all.  You can think of unification as a constraint-solving process.  You find the maximal type that satisfies the constraints provided, which amount to \"it's a list of something\" for this case.</p>\n\n<p>Now that the types are unified, the type of the function application is the type of the function's result:</p>\n\n<pre><code>ap id :: [b] -&gt; [b]\n</code></pre>\n\n<p>I can see why the choice of <code>[b]</code> looks a little odd in this case, because only one of the three type expressions contributed factors to unify.  There are more involved cases where constraints come from multiple places, though.</p>\n\n<p>Let's consider a more advanced case.  This might involve some things you haven't seen before.  If it does, I apologize for jumping straight to the deep end.</p>\n\n<p>Given:</p>\n\n<pre><code>f1 :: (a -&gt; b) -&gt; f a -&gt; f b\nf2 :: p c d -&gt; (e, c) -&gt; (e, d)\n</code></pre>\n\n<p>Unify the types of <code>f1</code> and <code>f2</code>.</p>\n\n<p>Let's be really careful with this one.  First up, rewrite all the types in terms of prefix application.  Even the <code>(-&gt;)</code> types.  This is going to be ugly:</p>\n\n<pre><code>f1 :: (-&gt;) ((-&gt;) a b) ((-&gt;) (f a) (f b))\nf2 :: (-&gt;) (p c d) ((-&gt;) ((,) e c) ((,) e d))\n</code></pre>\n\n<p>Unify and apply generativity twice to top-level <code>(-&gt;)</code> type constructors:</p>\n\n<pre><code>((-&gt;) a b) ~ (p c d)\n((-&gt;) (f a) (f b)) ~ ((-&gt;) ((,) e c) ((,) e d))\n</code></pre>\n\n<p>And, just keep unifying and applying generativity:</p>\n\n<pre><code>(-&gt;) ~ p\na ~ c\nb ~ d\nf a ~ (,) e c\nf b ~ (,) e d\nf ~ (,) e\n</code></pre>\n\n<p>Ok, we've built up a giant stack of constraints now.  Choosing between <code>a</code> and <code>c</code> or <code>b</code> and <code>d</code> doesn't matter, as they're equivalently constrained. Let's choose letters closer to the beginning of the alphabet when it doesn't matter.  <code>(-&gt;)</code> is more constrained than <code>p</code>, so it wins there, and <code>(,) e</code> is more constrained than <code>f</code>.  Call it a winner too.</p>\n\n<p>Then switch back to infix type constructors to make it pretty, and the unified type is:</p>\n\n<pre><code>(a -&gt; b) -&gt; (e, a) -&gt; (e, b)\n</code></pre>\n\n<p>Notice how each of the two starting types contributed a constraint to the final unified type. <code>f1</code> requires the <code>p</code> type in <code>f2</code> to be more specific, and <code>f2</code> required the <code>f</code> type in <code>f1</code> to be more specific.</p>\n\n<p>Overall, this is a super-mechanical process.  It's also fiddly and requires precise tracking of what you know.  There's a reason we mostly leave it to the compiler to handle this.  It is absolutely useful in the cases when something goes wrong and you want to double-check the process yourself to see why the compiler is reporting an error, though.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 47536309, "answer_count": 1, "score": 2, "last_activity_date": 1511888147, "creation_date": 1511883321, "last_edit_date": 1511886989, "question_id": 47535328, "link": "https://stackoverflow.com/questions/47535328/how-to-derive-the-type-of-an-applicator-applied-to-the-identity-function", "title": "How to derive the type of an applicator applied to the identity function", "body": "<p>I want to derive the type of the following contrived applicator applied to the identity function. To achieve this I probably have to unify the type portion of the first argument <code>(a -&gt; [b])</code> with the type of <code>id</code>:</p>\n\n<pre><code>ap :: (a -&gt; [b]) -&gt; a -&gt; [b]\nid :: a -&gt; a\n\na -&gt; [b]\na0 -&gt; a0 -- fresh type vars\n\na ~ a0 -- mappings\n[b] ~ a0\n\na0 -&gt; a0 -- substitution\n</code></pre>\n\n<p>This is obviously wrong, since the expected type is <code>[b] -&gt; [b]</code>. There is an ambiguity within the unification, because <code>a0</code> cannot be equivalent to both <code>a</code> and <code>[b]</code>, except for <code>a ~ [b]</code> . But what is the rule that tells me to substitute <code>a</code> with <code>[b]</code> and not the other way around, as I would have to do with <code>ap :: ([a] -&gt; b) -&gt; [a] -&gt; b</code> for example.</p>\n\n<p>I know this is a very specific question, sorry. Hopefully it is not too confusing!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511881463, "post_id": 47534671, "comment_id": 82026095, "body": "Typeclasses and ADTs are quite orthogonal concepts."}], "answers": [{"comments": [{"owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 0, "creation_date": 1511946172, "post_id": 47535065, "comment_id": 82054008, "body": "What do you mean by &quot;It would be especially tedious to build composed instances like Ord a =&gt; Ord [a] by hand.&quot;? Could you give an example?"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 11, "last_activity_date": 1511883166, "last_edit_date": 1511883166, "creation_date": 1511882602, "answer_id": 47535065, "question_id": 47534671, "link": "https://stackoverflow.com/questions/47534671/type-classes-vs-algebraic-data-types/47535065#47535065", "title": "Type classes vs algebraic data types?", "body": "<p>You just invented type classes! A class <em>is</em> a dictionary of functions. During compilation, code like</p>\n\n<pre><code>class Monoid a where\n    mempty :: a\n    mappend :: a -&gt; a -&gt; a\n\ninstance Monoid [a] where\n    mempty = []\n    mappend = (++)\n\nmconcat :: Monoid a =&gt; [a] -&gt; a\nmconcat = foldr mappend\n\nmain = print $ mconcat [\"foo\", \"bar\"]\n</code></pre>\n\n<p>is translated into explicit dictionary-passing style.</p>\n\n<pre><code>data Monoid a = Monoid { mempty :: a, mappend :: a -&gt; a -&gt; a }\n\nlist_monoid = Monoid [] (++)\n\nmconcat :: Monoid a -&gt; [a] -&gt; a\nmconcat monoid = foldr (mappend monoid)\n\nmain = print $ mconcat list_monoid [\"foo\", \"bar\"]\n</code></pre>\n\n<p>That translation is exactly the most important difference between type classes and dictionaries: classes are implicit. You don't have to explicitly pass the <code>monoid</code> variable around - the compiler takes care of the plumbing for you. It would be especially tedious to build composed instances like <code>Ord a =&gt; Ord [a]</code> by hand.</p>\n\n<p>There's one other key difference between classes and dictionaries, and that's <em>coherence</em>. Basically, there's always at most one \"best\" instance to satisfy a given constraint, that instance is global and unique, and you can't override it. With dictionary-passing style, on the other hand, the function will just use whatever dictionary you passed in and there are no guarantees of uniqueness. <a href=\"https://www.youtube.com/watch?v=hIZxTQP1ifo\" rel=\"noreferrer\">This is sometimes good and sometimes bad</a>.</p>\n"}], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 47535065, "answer_count": 1, "score": 3, "last_activity_date": 1511883166, "creation_date": 1511881378, "question_id": 47534671, "link": "https://stackoverflow.com/questions/47534671/type-classes-vs-algebraic-data-types", "title": "Type classes vs algebraic data types?", "body": "<p>I frequently start thinking about a problem in terms of type classes to be defined, and realize when I start coding that I don't need type classes and can solve my problem with algebraic data types instead, which seems more straightforward. As a result, I am wondering when type classes are necessary.</p>\n\n<p>As I understand them, type classes are a way to say that certain functions exist for certain types. For example, when a type MyType is an instance of Monoid, then I can use the functions <code>mempty :: MyType</code> and <code>mappend :: MyType -&gt; MyType -&gt; MyType</code>, such that the monoid laws hold.</p>\n\n<p>We could acheive the same with algebraic data types, by defining Monoid as a type rather than a typeclass:</p>\n\n<pre><code>data Monoid a = Monoid { mempty :: a\n                       , mappend :: a -&gt; a -&gt; a}\n</code></pre>\n\n<p>and then say that a type MyType is a monoid by defining a new value of type <code>Monoid MyType</code> (which with typeclasses is done by declaring it an instance):</p>\n\n<pre><code>monoidMyType :: Monoid MyType\nmonoidMyType = Monoid { mempty = ...\n                      , mappend = \\a b -&gt; ... }\n</code></pre>\n\n<p>Then, we can write functions that operate on monoids like:</p>\n\n<pre><code>dummyFun :: Monoid a -&gt; a -&gt; a\ndummyFun m x = mempty m x\n</code></pre>\n\n<p>And use those functions by explicitly passing the appropriate \"monoid value\":</p>\n\n<pre><code>result = dummyFun monoidMyType valueOfMyType\n</code></pre>\n\n<p>The equivalent last two steps would happen very similarly with typeclasses:</p>\n\n<pre><code>dummyFun :: (Monoid a) =&gt; a -&gt; a\ndummyFun x = mempty x\n\nresult = dummyFun valueOfMyType\n</code></pre>\n\n<p>The only substantial difference that I see is that with algebraic data types, the monoid value must be passed explicitly when we call the function <code>dummyFun</code>. Although it is a bit more practical not to have to pass it explicitly, it doesn't look to me like a major obstacle.</p>\n\n<p>In fact, I see an advantage that algebraic data types have over type classes: you can relate together types accross different functions:</p>\n\n<pre><code>data Bla a b = Bla {f1 :: a -&gt; b, f2 :: b -&gt; a, ...}\n</code></pre>\n\n<p>Doing this with typeclasses would (i believe) require using the multiple parameter type classes extension.</p>\n\n<p>Is there a reason to use type classes that I'm not seeing here?</p>\n\n<p>When designing software, can you interchangeably chose to use type classes or algebraic data types, or are there situations where you can't do without type classes?</p>\n"}, {"tags": ["haskell", "hlint"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1511901049, "post_id": 47534224, "comment_id": 82037831, "body": "Even if you succeed, that seems awfully specific."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1511901446, "post_id": 47534224, "comment_id": 82038048, "body": "I agree it seems too specific. I think the pattern you&#39;re looking for is pattern matching on <code>Either</code> with <code>throwM</code> in the <code>Left</code> branch. Also <code>withThrow</code> seems specific too, if it only works for <code>ValidationErrors</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1511901482, "post_id": 47534224, "comment_id": 82038069, "body": "Separately, I don&#39;t think you&#39;ll have much luck matching <i>part</i> of a case expression. I think you&#39;ll at least need to mention the other branch somehow. But I&#39;ve never written HLint rules, so I&#39;m not sure."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1511940307, "post_id": 47534224, "comment_id": 82050859, "body": "it&#39;s specific because it&#39;s only related to our project. Not to be published as a general hlint rule. Let me try matching with Left/Right branches of a case expression."}], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 1, "last_activity_date": 1511963240, "creation_date": 1511963240, "answer_id": 47554342, "question_id": 47534224, "link": "https://stackoverflow.com/questions/47534224/how-to-write-complex-multi-line-hlint-rules/47554342#47554342", "title": "How to write complex / multi-line hlint rules?", "body": "<p>The problem is that HLint matching is expression based, whereas the rule you're trying to define is really statement based - you want to match the two statements anywhere adjacently in a <code>do</code>. It's possible HLint could be modified to do that, and you think that would be useful, please <a href=\"https://github.com/ndmitchell/hlint/issues/new\" rel=\"nofollow noreferrer\">raise an HLint issue</a>.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1511963240, "creation_date": 1511880039, "question_id": 47534224, "link": "https://stackoverflow.com/questions/47534224/how-to-write-complex-multi-line-hlint-rules", "title": "How to write complex / multi-line hlint rules?", "body": "<p>What's the way to match the following code-pattern...</p>\n\n<pre><code>do \n  x &lt;- createModel a b\n  case x of\n    Left e -&gt; throwM $ ValidationErrors e\n    Right y -&gt; ...\n</code></pre>\n\n<p>...and suggest the following replacement:</p>\n\n<pre><code>withThrow $ createModel a b\n</code></pre>\n\n<p>I tried the following, but it doesn't work:</p>\n\n<pre><code>hint: {lhs: \"do {x &lt;- createModel v w; case x of Left e -&gt; throwM $ ValidationErrors e}\", rhs: \"withThrow $ createModel v w\"}\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511878195, "post_id": 47533342, "comment_id": 82023701, "body": "Did you read the error? &quot;Perhaps you meant one of these: \u2018WriterT\u2019 (imported from Control.Monad.Writer), variable \u2018writer\u2019 (imported from Control.Monad.Writer)&quot;"}, {"owner": {"reputation": 638, "user_id": 6772989, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a05dc0e117ea9018de89f926894ea906?s=128&d=identicon&r=PG&f=1", "display_name": "Bulat M.", "link": "https://stackoverflow.com/users/6772989/bulat-m"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511879211, "post_id": 47533342, "comment_id": 82024472, "body": "I read, however, I want to use Writer, not WriterT. The above error left me wondering why book&#39;s code doesn&#39;t compile."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511880765, "post_id": 47534416, "comment_id": 82025576, "body": "I&#39;m pretty sure this isn&#39;t actually correct (or at least, not fully correct); I&#39;ll delete if you unaccept it. See <a href=\"https://stackoverflow.com/q/26415122/1126841\">stackoverflow.com/q/26415122/1126841</a> instead."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511881208, "post_id": 47534416, "comment_id": 82025905, "body": "I can&#39;t really fix this answer, since I don&#39;t fully understand how the monad modules have change; for instance, I don&#39;t even <i>have</i> <code>Control.Monad.Writer</code> in my 8.0.2 installation any more."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1511880565, "creation_date": 1511880565, "answer_id": 47534416, "question_id": 47533342, "link": "https://stackoverflow.com/questions/47533342/why-writer-constructor-causes-syntax-error/47534416#47534416", "title": "Why Writer constructor causes syntax error", "body": "<p>LYAH was written when <code>Control.Monad.Writer</code> still exported a <code>Writer</code> constructor. Now, you have to import <code>Control.Monad.Trans.Writer</code>, which defines the <code>WriterT</code> monad transformer as well as a simple <code>Writer</code> type defined as</p>\n\n<pre><code>type Writer w = WriterT w Identity\n</code></pre>\n"}], "owner": {"reputation": 638, "user_id": 6772989, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a05dc0e117ea9018de89f926894ea906?s=128&d=identicon&r=PG&f=1", "display_name": "Bulat M.", "link": "https://stackoverflow.com/users/6772989/bulat-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1511884032, "answer_count": 1, "score": -2, "last_activity_date": 1511914639, "creation_date": 1511877460, "last_edit_date": 1511914639, "question_id": 47533342, "link": "https://stackoverflow.com/questions/47533342/why-writer-constructor-causes-syntax-error", "closed_reason": "Duplicate", "title": "Why Writer constructor causes syntax error", "body": "<p>I am reading tut from <a href=\"http://learnyouahaskell.com/for-a-few-monads-more#useful-monadic-functions\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/for-a-few-monads-more#useful-monadic-functions</a></p>\n\n<p>Copied listing to my file, but it doesn't compile.</p>\n\n<pre><code>import Control.Monad.Writer  \n\nlogNumber :: Int -&gt; Writer [String] Int  \nlogNumber x = Writer (x, [\"Got number: \" ++ show x])  \n\nmultWithLog :: Writer [String] Int  \nmultWithLog = do  \n    a &lt;- logNumber 3  \n    b &lt;- logNumber 5  \n    return (a*b)\n\nMain.hs:4:15: error:                \n    \u2022 Data constructor not in scope:                                    \n        Writer :: (Int, [[Char]]) -&gt; Writer [String] Int                \n    \u2022 Perhaps you meant one of these:                                   \n        \u2018WriterT\u2019 (imported from Control.Monad.Writer),                 \n        variable \u2018writer\u2019 (imported from Control.Monad.Writer)          \nFailed, modules loaded: none.    \n</code></pre>\n\n<p>How to resolve it? Everything seems to be correct.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 5, "creation_date": 1511876656, "post_id": 47532837, "comment_id": 82022652, "body": "You can only use operations that a typeclass instance actually supports. An instance of <code>Monad</code> only supplies <code>(&gt;&gt;=)  :: m a -&gt; (  a -&gt; m b) -&gt; m b</code>, i.e. it restrictively requires the same <code>m</code> to be used throughout. If you can see some sensible meaning for there to be an arbitrary &quot;bind over anything&quot; operation, then by all means, you can specify it as a typeclass and create as many instances as you know how. A class like <code>(&gt;&gt;=)  :: m a -&gt; (a -&gt; n b) -&gt; n b</code>, while requiring nothing of the consumer, is almost impossible to sensibly satisfy for an implementer."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1511877184, "post_id": 47532837, "comment_id": 82023011, "body": "The theory behind the <code>Monad</code> type class requires <code>m</code> to be the same functor; this property is what makes it suitable as a basis for handling IO; you can&#39;t escape from <code>IO</code> by switching to a different type."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1511881062, "post_id": 47532837, "comment_id": 82025792, "body": "How would you bind <code>Maybe</code> with <code>IO</code>? An <code>IO</code> monad does <i>not</i> alters the state, it describes <i>how</i> to alter the state."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1511905448, "post_id": 47532837, "comment_id": 82040030, "body": "I can understand questions of the form &quot;why would this alternate design be bad?&quot;; it makes sense to wonder whether you have missed some important consideration and ask others to help you think of things you haven&#39;t. Nevertheless, I feel like the person asking such a question also has a burden to say what the alternate design is and why it would be good. I don&#39;t think you&#39;ve described either of those things (what would binding a <code>Maybe</code> to an <code>IO</code> do? and why would that be good?)."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 7, "last_activity_date": 1511878473, "creation_date": 1511878473, "answer_id": 47533692, "question_id": 47532837, "link": "https://stackoverflow.com/questions/47532837/what-is-the-logic-behind-allowing-only-same-monad-types-to-be-concatenated-with/47533692#47533692", "title": "What is the logic behind allowing only same Monad types to be concatenated with `&gt;&gt;` operator?", "body": "<p>There are a lot of good theoretical reasons, including \"that's not what <code>Monad</code> is.\"  But let's step away from that for a moment and just look at the implementation details.</p>\n\n<p>First off - <code>Monad</code> isn't magic.  It's just a standard type class.  Instances of <code>Monad</code> only get created when someone writes one.</p>\n\n<p>Writing that instance is what defines how <code>(&gt;&gt;)</code> works.  Usually it's done implicitly through the default definition in terms of <code>(&gt;&gt;=)</code>, but that just is evidence that <code>(&gt;&gt;=)</code> is the more general operator, and writing it requires making all the same decisions that writing <code>(&gt;&gt;)</code> would take.</p>\n\n<p>If you had a different operator that worked on more general types, you have to answer two questions.  First, what would the types be?  Second, how would you go about providing implementations?  It's really not clear what the desired types would be, from your question.  One of the following, I guess:</p>\n\n<pre><code>class Poly1 m n where\n    (&gt;&gt;) :: m a -&gt; n b -&gt; m b\n\nclass Poly2 m n where\n    (&gt;&gt;) :: m a -&gt; n b -&gt; n b\n\nclass Poly3 m n o | m n -&gt; o where\n    (&gt;&gt;) :: m a -&gt; n b -&gt; o b\n</code></pre>\n\n<p>All of them could be implemented.  But you lose two really important factors for using them practically.</p>\n\n<ol>\n<li>You need to write an instance for every pair of types you plan to use together. This is a massively more complex undertaking than just an instance for each type. Something about <code>n</code> vs <code>n^2</code>.</li>\n<li>You lose predictability.  What does the operation even <em>do</em>?  Here's where theory and practice intersect.  The theory behind <code>Monad</code> places a lot of restrictions on the operations.  Those restrictions are referred to as the \"monad laws\".  They are beyond the ability to verify in Haskell, but any <code>Monad</code> instance that doesn't obey them is considered to be buggy. The end result is that you quickly can build an intuition for what the <code>Monad</code> operations do and don't do.  You can use them without looking up the details of every type involved, because you know properties that they obey.  None of those possible classes I suggested give you any kind of assurances like that. You just have no idea what they do.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 0, "last_activity_date": 1512005081, "last_edit_date": 1512005081, "creation_date": 1512003015, "answer_id": 47564217, "question_id": 47532837, "link": "https://stackoverflow.com/questions/47532837/what-is-the-logic-behind-allowing-only-same-monad-types-to-be-concatenated-with/47564217#47564217", "title": "What is the logic behind allowing only same Monad types to be concatenated with `&gt;&gt;` operator?", "body": "<p>I\u2019m not sure that I understand your question correctly, but it\u2019s definitely possible to compose <code>Maybe</code> with <code>IO</code> or <code>[]</code> in the same sense that you can compose <code>IO</code> with <code>[]</code>.</p>\n\n<p>For example, if you check the types in GHCI using <code>:t</code>,</p>\n\n<pre><code>getContents &gt;&gt;= return . lines\n</code></pre>\n\n<p>gives you an <code>IO [String]</code>. If you add</p>\n\n<pre><code>            &gt;&gt;= return . map Text.Read.readMaybe\n</code></pre>\n\n<p>you get a type of <code>IO [Maybe a]</code>, which is a composition of <code>IO</code>, <code>[]</code> and <code>Maybe</code>.  You could then pass it to</p>\n\n<pre><code>            &gt;&gt;= return . Data.Maybe.catMaybes\n</code></pre>\n\n<p>to flatten it to an <code>IO [a]</code>. Then you might pass the list of parsed valid input lines to a function that flattens it again and computes an output.</p>\n\n<p>Putting this together, the program</p>\n\n<pre><code>import Text.Read (readMaybe)\nimport Data.Maybe (catMaybes)\n\nmain :: IO ()\nmain = getContents &gt;&gt;=                    -- IO String\n       return . lines &gt;&gt;=                 -- IO [String]\n       return . map readMaybe &gt;&gt;=         -- IO [Maybe Int]\n       return . catMaybes &gt;&gt;=             -- IO [Int]\n       return . (sum :: [Int] -&gt; Int) &gt;&gt;= -- IO Int\n       print                              -- IO ()\n</code></pre>\n\n<p>with the input:</p>\n\n<pre><code>1\n\n2\nIgnore this!\n3\n</code></pre>\n\n<p>prints <code>6</code>.</p>\n\n<p>It would also be possible to work with an <code>IO (Maybe [String])</code>, a <code>Maybe [IO String]</code>, etc.</p>\n\n<p>You can do this with <code>&gt;&gt;</code> as well. Contrived example: <code>getContents &gt;&gt; (return . Just) False</code> reads the input, ignores it, and gives you back an <code>IO (Maybe Bool)</code>.</p>\n"}], "owner": {"reputation": 768, "user_id": 8306896, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/924e40b39a2f51489d438fd284a9dd3f?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek", "link": "https://stackoverflow.com/users/8306896/abhishek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1512005081, "creation_date": 1511875906, "question_id": 47532837, "link": "https://stackoverflow.com/questions/47532837/what-is-the-logic-behind-allowing-only-same-monad-types-to-be-concatenated-with", "title": "What is the logic behind allowing only same Monad types to be concatenated with `&gt;&gt;` operator?", "body": "<p>Though it is okay to bind <code>IO [[Char]]</code> and <code>IO ()</code> but its not allowed to bind <code>Maybe</code> with <code>IO</code>. Can someone give an example how this relaxation would lead to a bad design? Why freedom in the polymorphic type of Monad is allowed though not the Monad itself?</p>\n"}, {"tags": ["json", "parsing", "haskell", "out-of-memory", "aeson"], "comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1511884384, "post_id": 47532459, "comment_id": 82028121, "body": "FYI, you are missing a comma after the <code>match-data</code> list in the example input."}, {"owner": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1511886562, "post_id": 47532459, "comment_id": 82029675, "body": "@pat: Indeed I am. Fixed now. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "edited": false, "score": 0, "creation_date": 1511887551, "post_id": 47536588, "comment_id": 82030298, "body": "Ah yes, another <code>String</code> to get rid of. Unfortunately, on my machine I still run out of memory for the large input..."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "reply_to_user": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "edited": false, "score": 0, "creation_date": 1511888094, "post_id": 47536588, "comment_id": 82030606, "body": "What version of what compiler are you using?"}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "reply_to_user": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "edited": false, "score": 1, "creation_date": 1511889029, "post_id": 47536588, "comment_id": 82031241, "body": "I&#39;m using ghc 8.0.2 under stack 1.5.1.  The process had a maximum resident set size of 2,621,968,384 bytes, with a 115,688,713 byte input file."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "reply_to_user": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "edited": false, "score": 0, "creation_date": 1511889385, "post_id": 47536588, "comment_id": 82031472, "body": "How much physical memory do you have?  How much swap space?"}, {"owner": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "edited": false, "score": 0, "creation_date": 1511939316, "post_id": 47536588, "comment_id": 82050398, "body": "I&#39;ve got 16GB, dunno about the swap. I also just occurred to me that the file I&#39;m using has no whitespace, meaning that in the format above it expands to about 500MB."}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 1, "last_activity_date": 1511887002, "creation_date": 1511887002, "answer_id": 47536588, "question_id": 47532459, "link": "https://stackoverflow.com/questions/47532459/haskell-program-runs-out-of-memory-when-trying-to-parse-115mb-json-file-using-ae/47536588#47536588", "title": "Haskell program runs out of memory when trying to parse 115MB JSON file using Aeson", "body": "<p>Try changing:</p>\n\n<pre><code>putStrLn $ BS.unpack $ encode (fromJust pmset :: PatternMatchset)\n</code></pre>\n\n<p>to</p>\n\n<pre><code> BS.putStrLn $ encode (fromJust pmset :: PatternMatchset)\n</code></pre>\n\n<p>The former caused my machine to go into swap hell.  The latter completed just fine.</p>\n"}], "owner": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1511887002, "creation_date": 1511874725, "last_edit_date": 1511886541, "question_id": 47532459, "link": "https://stackoverflow.com/questions/47532459/haskell-program-runs-out-of-memory-when-trying-to-parse-115mb-json-file-using-ae", "title": "Haskell program runs out of memory when trying to parse 115MB JSON file using Aeson", "body": "<p>My Haskell program runs out of memory when trying to parse a 115MB JSON file. I suspect I'm doing something that you shouldn't do in Haskell - at an earlier step in the program, I ran out of memory because I was operating on <code>String</code>s instead of <code>ByteString</code>s - but I am unable to figure out what.</p>\n\n<p>I've condensed my program down into the following MWE:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving, OverloadedStrings, FlexibleInstances #-}\n\n----------------------------------------\n-- Imports\n----------------------------------------\n\nimport System.Environment\n  ( getArgs )\nimport Control.Monad\n  ( mzero\n  , when\n  )\n\nimport qualified Data.ByteString.Lazy.Char8 as BS\nimport Data.Aeson\nimport Data.Maybe\nimport Data.Scientific\n  ( Scientific )\n\nimport qualified Data.Map as M\nimport qualified Data.Text as T\nimport qualified Data.Vector as V\n\n\n----------------------------------------\n-- Data types\n----------------------------------------\n\nnewtype Natural\n  = Natural Integer\n  deriving (Show, Eq, Ord)\n\ninstance Num Natural where\n    fromInteger = toNatural\n    x + y = toNatural (fromNatural x + fromNatural y)\n    x - y = let r = fromNatural x - fromNatural y\n            in if r &lt; 0\n               then error \"Subtraction yielded a negative value\"\n               else toNatural r\n    x * y = toNatural (fromNatural x * fromNatural y)\n    abs x = x\n    signum x = toNatural $ signum $ fromNatural x\n\ninstance Enum Natural where\n  toEnum = toNatural . toInteger\n  fromEnum = fromInteger . fromNatural\n\ninstance Real Natural where\n  toRational (Natural i) = toRational i\n\ninstance Integral Natural where\n  quotRem (Natural x) (Natural y) =\n    ( toNatural $ quot x y\n    , toNatural $ rem x y\n    )\n  toInteger (Natural i) = i\n\ninstance FromJSON Natural where\n  parseJSON (Number sn) = return $ sn2nat sn\n  parseJSON _ = mzero\n\ninstance ToJSON Natural where\n  toJSON i = toJSON (fromNatural i)\n\n----------------------------------------\n\ndata PatternMatchset\n  = PatternMatchset\n      { pmTarget :: TargetMachineID\n      , pmMatches :: [PatternMatch]\n      , pmTime :: Maybe Double\n      }\n  deriving (Show)\n\ninstance FromJSON PatternMatchset where\n  parseJSON (Object v) =\n    PatternMatchset\n      &lt;$&gt; v .: \"target-machine-id\"\n      &lt;*&gt; v .: \"match-data\"\n      &lt;*&gt; v .: \"time\"\n  parseJSON _ = mzero\n\ninstance ToJSON PatternMatchset where\n  toJSON m =\n    object [ \"target-machine-id\" .= (pmTarget m)\n           , \"match-data\"        .= (pmMatches m)\n           , \"time\"              .= (pmTime m)\n           ]\n\n----------------------------------------\n\ndata PatternMatch\n  = PatternMatch\n      { pmInstrID :: InstructionID\n      , pmMatchID :: MatchID\n      , pmMatch :: Match NodeID\n      }\n  deriving (Show)\n\ninstance FromJSON PatternMatch where\n  parseJSON (Object v) =\n    PatternMatch\n      &lt;$&gt; v .: \"instr-id\"\n      &lt;*&gt; v .: \"match-id\"\n      &lt;*&gt; v .: \"match\"\n  parseJSON _ = mzero\n\ninstance ToJSON PatternMatch where\n  toJSON m =\n    object [ \"instr-id\"   .= (pmInstrID m)\n           , \"match-id\"   .= (pmMatchID m)\n           , \"match\"      .= (pmMatch m)\n           ]\n\n----------------------------------------\n\ndata Match n\n  = Match { f2pMaps :: M.Map n [n]\n          , p2fMaps :: M.Map n [n]\n          }\n  deriving (Show, Eq, Ord)\n\ninstance FromJSON (Match NodeID) where\n  parseJSON v@(Array _) =\n    do list &lt;- parseJSON v\n       return $ toMatch list\n  parseJSON _ = mzero\n\ninstance ToJSON (Match NodeID) where\n  toJSON m = toJSON $ fromMatch m\n\n----------------------------------------\n\ndata Mapping n\n  = Mapping\n      { fNode :: n\n      , pNode :: n\n      }\n  deriving (Show, Eq, Ord)\n\ninstance FromJSON (Mapping NodeID) where\n  parseJSON v@(Array _) =\n    do list &lt;- parseJSON v\n       when (length list /= 2) mzero\n       return Mapping { fNode = head list\n                      , pNode = last list\n                      }\n  parseJSON _ = mzero\n\ninstance ToJSON (Mapping NodeID) where\n  toJSON m = Array (V.fromList [toJSON $ fNode m, toJSON $ pNode m])\n\n----------------------------------------\n\nnewtype MatchID\n  = MatchID Natural\n  deriving (Show, Eq, Ord, Num, Enum, Real, Integral)\n\ninstance FromJSON MatchID where\n  parseJSON (Number sn) = return $ toMatchID $ sn2nat sn\n  parseJSON _ = mzero\n\ninstance ToJSON MatchID where\n  toJSON mid = toJSON (fromMatchID mid)\n\n----------------------------------------\n\nnewtype NodeID\n  = NodeID Natural\n  deriving (Show, Eq, Ord, Num, Enum, Real, Integral)\n\ninstance FromJSON NodeID where\n  parseJSON (Number sn) = return $ toNodeID $ sn2nat sn\n  parseJSON _ = mzero\n\ninstance ToJSON NodeID where\n  toJSON mid = toJSON (fromNodeID mid)\n\n----------------------------------------\n\nnewtype InstructionID\n  = InstructionID Natural\n  deriving (Show, Eq, Ord, Num, Enum, Real, Integral)\n\ninstance FromJSON InstructionID where\n  parseJSON (Number sn) = return $ toInstructionID $ sn2nat sn\n  parseJSON _ = mzero\n\ninstance ToJSON InstructionID where\n  toJSON mid = toJSON (fromInstructionID mid)\n\n----------------------------------------\n\nnewtype TargetMachineID\n  = TargetMachineID String\n  deriving (Show, Eq)\n\ninstance FromJSON TargetMachineID where\n  parseJSON (String s) = return $ toTargetMachineID $ T.unpack s\n  parseJSON _ = mzero\n\ninstance ToJSON TargetMachineID where\n  toJSON tmid = toJSON (fromTargetMachineID tmid)\n\n\n----------------------------------------\n-- Help functions\n----------------------------------------\n\n-- | Converts an 'Integral' into a 'Natural'. If conversion fails, 'Nothing' is\n-- returned.\nmaybeToNatural :: (Integral i) =&gt; i -&gt; Maybe Natural\nmaybeToNatural x\n  | x &lt; 0     = Nothing\n  | otherwise = Just $ Natural $ toInteger x\n\n-- | Converts an 'Integral' into a 'Natural'. If conversion fails, an error is\n-- reported.\ntoNatural :: (Integral i) =&gt; i -&gt; Natural\ntoNatural x =\n  let n = maybeToNatural x\n  in if isJust n\n     then fromJust n\n     else error $ \"toNatural: negative number: \" ++\n                  show (toInteger x :: Integer)\n\n-- | Converts a 'Natural' into an 'Integer'.\nfromNatural :: Natural -&gt; Integer\nfromNatural (Natural i) = i\n\n-- | Converts a scientific number to a natural number. If the number is not an\n-- non-negative then an error occurs.\nsn2nat :: Scientific -&gt; Natural\nsn2nat sn =\n  let int_value = round sn\n  in if fromInteger int_value /= sn\n     then error $ \"sn2nat: not an integer: \" ++ show sn\n     else toNatural int_value\n\nfromTargetMachineID :: TargetMachineID -&gt; String\nfromTargetMachineID (TargetMachineID i) = i\n\ntoTargetMachineID :: String -&gt; TargetMachineID\ntoTargetMachineID = TargetMachineID\n\nfromMatchID :: MatchID -&gt; Natural\nfromMatchID (MatchID i) = i\n\ntoMatchID :: (Integral i) =&gt; i -&gt; MatchID\ntoMatchID = MatchID . toNatural\n\nfromNodeID :: NodeID -&gt; Natural\nfromNodeID (NodeID i) = i\n\ntoNodeID :: (Integral i) =&gt; i -&gt; NodeID\ntoNodeID = NodeID . toNatural\n\nfromInstructionID :: InstructionID -&gt; Natural\nfromInstructionID (InstructionID i) = i\n\ntoInstructionID :: (Integral i) =&gt; i -&gt; InstructionID\ntoInstructionID = InstructionID . toNatural\n\ntoMatch :: Ord n =&gt; [Mapping n] -&gt; Match n\ntoMatch ms =\n  let insert (n1, n2) m = M.insertWith (++) n1 [n2] m\n  in Match { f2pMaps = foldr insert M.empty $\n                       map (\\m -&gt; (fNode m, pNode m)) ms\n           , p2fMaps = foldr insert M.empty $\n                       map (\\m -&gt; (pNode m, fNode m)) ms\n           }\n\nfromMatch :: Ord n =&gt; Match n -&gt; [Mapping n]\nfromMatch m =\n  M.foldrWithKey\n    (\\fn pns ms -&gt; (ms ++ map (\\pn -&gt; Mapping { fNode = fn, pNode = pn }) pns))\n    []\n    (f2pMaps m)\n\n\n----------------------------------------\n-- Main program\n----------------------------------------\n\nmain :: IO ()\nmain =\n  do args &lt;- getArgs\n     when (length args == 0) $\n       error $ \"No input file\"\n     when (length args &gt; 1) $\n       error $ \"Too many arguments\"\n     let file = head args\n     str &lt;- BS.readFile file\n     let pmset = decode str\n     when (isNothing pmset) $\n       error $ \"Failed to parse JSON\"\n     putStrLn $ BS.unpack $ encode (fromJust pmset :: PatternMatchset)\n</code></pre>\n\n<p>The input is of the following format:</p>\n\n<pre><code>{\n  \"match-data\": [\n    {\n      \"instr-id\": 31,\n      \"match\": [\n        [2354, 5],\n        [2343, 3],\n        [2341, 10],\n        [2340, 9],\n        [1478, 8],\n        [1476, 6]\n      ],\n      \"match-id\": 0\n    }\n  ],\n  \"target-machine-id\": \"Architecture\",\n  \"time\": 27.642428397\n}\n</code></pre>\n\n<p>The program above simply parses the JSON file, converts it back to JSON and prints the data. To get a larger input file, simply copy-paste the object within the <code>match-data</code> list and append it to the list.</p>\n\n<p>I've tried compiling the program using -O2 flag, to no avail.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1511879848, "post_id": 47532021, "comment_id": 82024891, "body": "The <code>IO</code> monad is designed specifically to guarantee the evaluation order of side-effecting actions. In general though, Haskell doesn&#39;t place guarantees on which part of an expression is evaluated first. The only guarantee is that it will be as lazy as possible."}], "answers": [{"comments": [{"owner": {"reputation": 768, "user_id": 8306896, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/924e40b39a2f51489d438fd284a9dd3f?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek", "link": "https://stackoverflow.com/users/8306896/abhishek"}, "edited": false, "score": 0, "creation_date": 1511874716, "post_id": 47532138, "comment_id": 82021285, "body": "Suppose the program were to crash after step 3 would there be &quot;1&quot; on the screen?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 768, "user_id": 8306896, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/924e40b39a2f51489d438fd284a9dd3f?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek", "link": "https://stackoverflow.com/users/8306896/abhishek"}, "edited": false, "score": 0, "creation_date": 1511878894, "post_id": 47532138, "comment_id": 82024249, "body": "@abhishek Correct. <code>do { putStrLn &quot;1&quot;; undefined }</code> prints <code>1</code> and then crashes."}, {"owner": {"reputation": 768, "user_id": 8306896, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/924e40b39a2f51489d438fd284a9dd3f?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek", "link": "https://stackoverflow.com/users/8306896/abhishek"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1511885847, "post_id": 47532138, "comment_id": 82029158, "body": "@4castle thanks for your reply. function <code>f</code> here evaluates its body and returns a monad to main which main executes. So will not f never return in the above code with underfined inside do block or <code>&gt;&gt;</code> will never succeed and thus main will never run and so no side effect takes place. AFAIU only main is capable of side effect?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 768, "user_id": 8306896, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/924e40b39a2f51489d438fd284a9dd3f?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek", "link": "https://stackoverflow.com/users/8306896/abhishek"}, "edited": false, "score": 0, "creation_date": 1511888144, "post_id": 47532138, "comment_id": 82030648, "body": "@abhishek Because of laziness, <code>&gt;&gt;</code> can return without evaluating any of its arguments. When its output is finally demanded, it doesn&#39;t need to evaluate its second argument until the <code>putStrLn &quot;1&quot;</code> is finished executing."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 1, "last_activity_date": 1511873695, "creation_date": 1511873695, "answer_id": 47532138, "question_id": 47532021, "link": "https://stackoverflow.com/questions/47532021/when-does-first-print-happen-in-the-below-haskell-code/47532138#47532138", "title": "When does first print happen in the below haskell code?", "body": "<p><code>putStrLn</code> is of type <code>String -&gt; IO ()</code> so, it makes the computation and then return a <code>()</code> in the <code>IO</code> monad, ergo the second function that takes that <code>()</code> wich is then discarded and then just computes the second <code>putStrLn</code>.</p>\n\n<p>The order would be:</p>\n\n<p>1.- <code>putStrLn \"1\"</code></p>\n\n<p>2- get a <code>()</code> as result so</p>\n\n<p>3.- <code>\\() -&gt; putStrLn 2</code></p>\n\n<p>4.- <code>putStrLn 2</code></p>\n\n<p>The sintaxis wouldn't be exactly like that, but for you to make an idea.</p>\n"}], "owner": {"reputation": 768, "user_id": 8306896, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/924e40b39a2f51489d438fd284a9dd3f?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek", "link": "https://stackoverflow.com/users/8306896/abhishek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1511873695, "creation_date": 1511873295, "question_id": 47532021, "link": "https://stackoverflow.com/questions/47532021/when-does-first-print-happen-in-the-below-haskell-code", "title": "When does first print happen in the below haskell code?", "body": "<pre><code>f = do\n    putStrLn \"1\"\n    putStrLn \"2\"\n\nmain = f\n</code></pre>\n\n<p>The way I understand <code>f</code> reduces to <code>(putStrLn \"1\")&gt;&gt;=(\\_ -&gt; (putStrLn \"2\"))</code>. Is print operation completed while applying the lambda (lifting _ out of monad)? Can someone explain me which part gets evaluated and executed at what stage? </p>\n"}, {"tags": ["haskell", "benchmarking", "memoization"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1511875768, "post_id": 47529478, "comment_id": 82022059, "body": "You&#39;ll notice that <code>elem3</code> gets slower and slower as <code>y</code> gets bigger, keeping <code>ys</code> the same."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1511866576, "creation_date": 1511866576, "answer_id": 47529841, "question_id": 47529478, "link": "https://stackoverflow.com/questions/47529478/how-does-ghc-know-how-to-cache-one-function-but-not-the-others/47529841#47529841", "title": "How does GHC know how to cache one function but not the others?", "body": "<p><strong>Short answer</strong>: this has nothing to do with caching, but the fact that you force Haskell in the first two implementations, to <strong>iterate over all elements</strong>.</p>\n\n<p>No, this is because <code>foldl</code> works left to right, but it will thus keep iterating over the list until the list is exhausted.</p>\n\n<p>Therefore you better <strong>use <code>foldr</code></strong>. Here from the moment it finds a <code>3</code> it in the list, it will cut off the search.</p>\n\n<p>This is because <code>foldr</code>is defined as:</p>\n\n<pre><code>foldr f z [x1, x2, x3] = f x1 (f x2 (f x3 z))\n</code></pre>\n\n<p>whereas <code>foldl</code> is implemented as:</p>\n\n<pre><code>foldl f z [x1, x2, x3] = f (f (f (f z) x1) x2) x3\n</code></pre>\n\n<p>Note that the outer <code>f</code> thus binds with <code>x3</code>, so that means <code>foldl</code> first so if due to laziness you do not evaluate the first operand, you still need to iterate to the end of the list.</p>\n\n<p>If we implement the <code>foldl</code> and <code>foldr</code> version, we get:</p>\n\n<pre><code>y `elem1l` ys = foldl (\\acc x -&gt; if x == y then True else acc) False ys\ny `elem1r` ys = foldr (\\x acc -&gt; if x == y then True else acc) False ys\n</code></pre>\n\n<p>We then get:</p>\n\n<pre><code>Prelude&gt; 3 `elem1l` [1..1000000]\nTrue\n(0.25 secs, 112,067,000 bytes)\nPrelude&gt; 3 `elem1r` [1..1000000]\nTrue\n(0.03 secs, 68,128 bytes)\n</code></pre>\n\n<p>Stripping the duplicates from the list will not imrpove the efficiency. What here improves the efficiency is that you use <code>map</code>. <code>map</code> works left-to-right. Note furthermore that <code>nub</code> works lazy, so <code>nub</code> is here a <em>no op</em>, since you are only interested in the head, so Haskell does not need to perform memberchecks on the already seen elements.</p>\n\n<p>The performance is almost identical:</p>\n\n<pre><code>Prelude List&gt; 3 `elem3` [1..1000000]\nTrue\n(0.03 secs, 68,296 bytes)\n</code></pre>\n\n<p>In case you work with a <code>Set</code> however, you do not perform uniqueness lazily: you first fetch all the elements into the list, so again, you will iterate over <em>all</em> the elements, and not cut of the search after the first hit.</p>\n"}, {"tags": [], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "is_accepted": false, "score": 5, "last_activity_date": 1511883057, "last_edit_date": 1511883057, "creation_date": 1511866771, "answer_id": 47529901, "question_id": 47529478, "link": "https://stackoverflow.com/questions/47529478/how-does-ghc-know-how-to-cache-one-function-but-not-the-others/47529901#47529901", "title": "How does GHC know how to cache one function but not the others?", "body": "<h2>Explanation</h2>\n\n<p><code>foldl</code> goes to the innermost element of the list, applies the computation, and does so again recursively to the result and the next innermost value of the list, and so on.</p>\n\n<pre><code>foldl f z [x1, x2, ..., xn] == (...((z `f` x1) `f` x2) `f`...) `f` xn\n</code></pre>\n\n<p>So in order to produce the result, it has to traverse all the list.</p>\n\n<p>Conversely, in your function <code>elem3</code> as everything is lazy, nothing gets computed at all, until you call <code>head</code>. </p>\n\n<p>But in order to compute that value, you just the first value of the (filtered) list, so you just need to go as far as <code>3</code> is encountered in your big list. which is very soon, so the list is not traversed. if you asked for the <code>1000000th</code> element, <code>eleme3</code> would probably perform as badly as the other ones.</p>\n\n<h2>Lazyness</h2>\n\n<p>Lazyness ensure that your language is always composable : breaking a function into subfunction does not changes what is done.</p>\n\n<p>What you are seeing <em>can</em> lead to a <a href=\"https://stackoverflow.com/questions/46007746/whats-a-space-leak\">space leak</a> which is really about how control flow works in a lazy language. both in strict and in lazy, your code will decide what gets evaluated, but with a subtle difference :</p>\n\n<ul>\n<li><p>In a strict language, the builder of the function will choose, as it forces evaluation of its arguments: whoever <em>is called</em> is in charge.</p></li>\n<li><p>In a lazy language, the <em>consumer</em> of the function chooses. whoever <em>called</em> is in charge. It may choose to only evaluate the first element (by calling head), or every other element. All that <em>provided</em> its <em>own</em> caller choose to evaluate his own computation as well. there is a whole chain of command deciding what to do.</p></li>\n</ul>\n\n<p>In that reading, your <code>foldl</code> based <code>elem</code> function uses that \"inversion of control\" in an essential way : <code>elem</code> gets asked to produce a value. <code>foldl</code> goes deep inside the list. if the first element if <code>y</code> then it return the trivial computation <code>True</code>. if not, it forwards the  <em>requests</em> to the <em>computation</em> <code>acc</code>. In other words, what you read as values <code>acc</code>, <code>x</code> or even <code>True</code>, are really placeholders for <em>computations</em>, which you receive and yield back. And indeed, <code>acc</code> may be some unbelievably complex computation (or divergent one like <code>undefined</code>), as long as you transfer control to the computation <code>True</code>, your caller will never see the existence of <code>acc</code>.</p>\n\n<h2>foldr vs foldl vs foldl' VS speed</h2>\n\n<p>As suggested in another answer, <strong>foldr</strong> might best your intent on how to traverse the list, and will shield you away from space leaks (whereas <strong>foldl'</strong> will prevent space leaks as well if you <em>really</em> want to traverse the other way, which can lead to buildup of complex computations ... and can be very useful for <a href=\"https://wiki.haskell.org/Circular_programming\" rel=\"nofollow noreferrer\">circular computation</a> for instance).</p>\n\n<p>But the <em>speed</em> issue is really an algorithmic one. There might be better data structure for set membership <strong>if and only if</strong> you know beforehand that you have a certain pattern of usage.</p>\n\n<p>For instance, it might be useful to pay some upfront cost to have a <code>Set</code>, then have fast membership queries, but that is only useful if you know that you will have such a pattern where you have a few sets and lots of queries to those sets. Other data structure are optimal for other patterns, and it's interesting to note that from a API/specification/interface point of view, they are usually the same to the consumer. That's a general phenomena in any languages, and why many people love <em>abstract data types</em>/modules in programming.</p>\n\n<p>Using <code>foldr</code> and expecting to be faster really encodes the assumption that, given your static knowledge of your future access pattern, the values you are likely to test membership of will sit at the beginning. Using <code>foldl</code> would be fine if you expect your values to be at the end of it.</p>\n\n<p>Note that using foldl, you might construct the entire list, you do not construct the values <em>themselves</em>, until you need it of course, for instance to test for equality, as long as you have not found the searched element.</p>\n"}], "owner": {"reputation": 195, "user_id": 7419679, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/201735092000ec70e4246c77437ae490?s=128&d=identicon&r=PG&f=1", "display_name": "omrisim210", "link": "https://stackoverflow.com/users/7419679/omrisim210"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1511883057, "creation_date": 1511865644, "last_edit_date": 1511866233, "question_id": 47529478, "link": "https://stackoverflow.com/questions/47529478/how-does-ghc-know-how-to-cache-one-function-but-not-the-others", "title": "How does GHC know how to cache one function but not the others?", "body": "<p>I'm reading Learn You a Haskell (loving it so far) and it teaches how to implement <code>elem</code> in terms of <code>foldl</code>, using a lambda. The lambda solution seemed a bit ugly to me so I tried to think of alternative implementations (all using <code>foldl</code>):</p>\n\n<pre><code>import qualified Data.Set as Set\nimport qualified Data.List as List\n\n-- LYAH implementation\nelem1 :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool\ny `elem1` ys = \n    foldl (\\acc x -&gt; if x == y then True else acc) False ys\n\n-- When I thought about stripping duplicates from a list\n-- the first thing that came to my mind was the mathematical set\nelem2 :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool\ny `elem2` ys = \n    head $ Set.toList $ Set.fromList $ filter (==True) $ map (==y) ys\n\n-- Then I discovered `nub` which seems to be highly optimized: \nelem3 :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool\ny `elem3` ys = \n    head $ List.nub $ filter (==True) $ map (==y) ys\n</code></pre>\n\n<p>I loaded these functions in GHCi and did <code>:set +s</code> and then evaluated a small benchmark:</p>\n\n<pre><code>3 `elem1` [1..1000000] --  =&gt; (0.24 secs, 160,075,192 bytes)\n3 `elem2` [1..1000000] --  =&gt; (0.51 secs, 168,078,424 bytes)\n3 `elem3` [1..1000000] --  =&gt; (0.01 secs, 77,272 bytes)\n</code></pre>\n\n<p>I then tried to do the same on a (much) bigger list:</p>\n\n<pre><code>3 `elem3` [1..10000000000000000000000000000000000000000000000000000000000000000000000000]\n</code></pre>\n\n<p><code>elem1</code> and <code>elem2</code> took a very long time, while <code>elem3</code> was instantaneous (almost identical to the first benchmark).<br>\nI think this is because GHC knows that <code>3</code> is a member of <code>[1..1000000]</code>, and the big number I used in the second benchmark is bigger than <code>1000000</code>, hence <code>3</code> is also a member of <code>[1..bigNumber]</code> and GHC doesn't have to compute the expression at all.<br>\nBut how is it able to automatically cache (or memoize, a term that Land of Lisp taught me) <code>elem3</code> but not the two other ones?</p>\n"}, {"tags": ["haskell", "applicative", "continuation-passing", "some-and-many", "alternative-functor"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1511992145, "post_id": 47541079, "comment_id": 82082572, "body": "If <code>r</code> had some additional structure, however, perhaps something could be done.  For example maybe we could <code>fmap fold</code> the <code>f [r]</code>, and with suitable coherence laws that could be equivalent."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1511996336, "post_id": 47541079, "comment_id": 82084423, "body": "I would beg to differ. <code>some ca = Cont $ \\fla -&gt; run ca $ \\a -&gt;  (some $ pure a) &gt;&gt;= fla</code> is sort of interesting. The question is whether this is a valid <code>some</code> instance."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1512009244, "post_id": 47541079, "comment_id": 82087924, "body": "You can&#39;t get the <code>[a]</code> out of an <code>f [a]</code> like  <code>some $ pure a</code> with only an <code>Alternative f</code> constraint. You need either <code>Monad f</code> or <code>Traversable f</code> to do anything with it."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1512009481, "post_id": 47541079, "comment_id": 82087992, "body": "@luqui Yes, that&#39;s why I was very explicit with the <code>forall r</code>s."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1512010540, "post_id": 47541079, "comment_id": 82088267, "body": "I mentioned that I was fine with <code>f</code>  being a <code>Monad</code>. This post is useful though, showing that <code>Monad</code> is in fact required to even get it to type-check."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 4, "last_activity_date": 1511905048, "last_edit_date": 1511905048, "creation_date": 1511903836, "answer_id": 47541079, "question_id": 47524621, "link": "https://stackoverflow.com/questions/47524621/can-the-continuation-monad-transformer-be-given-an-alternative-instance-with-som/47541079#47541079", "title": "Can the continuation monad transformer be given an Alternative instance with some and many?", "body": "<p><strong>No.</strong></p>\n\n<p>There exists no arrow from</p>\n\n<pre><code>(forall a. f a -&gt; f [a]) -&gt;\n(forall r. ((a -&gt; f r) -&gt; f r)) -&gt; (([a] -&gt; f r) -&gt; f r)`\n</code></pre>\n\n<p>that makes use of its argument in an interesting way.</p>\n\n<p>The only place <code>forall a. f a -&gt; f [a]</code> can be applied is to an <code>f r</code>. These are  the results of <code>(a -&gt; f r) -&gt; f r</code>, like in your \"obvious options\", and <code>([a] -&gt; f r)</code>. This leaves a result of the type <code>f [r]</code>. The only thing that can be done with a <code>forall r. Alternative f =&gt; f [r]</code> to produce an <code>f r</code> is index the <code>f [r]</code> with some partial function <code>forall r. [r] -&gt; r</code> from a natural number to some other no-larger natural number.</p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "answer_count": 1, "score": 15, "last_activity_date": 1613785185, "creation_date": 1511847191, "last_edit_date": 1613785185, "question_id": 47524621, "link": "https://stackoverflow.com/questions/47524621/can-the-continuation-monad-transformer-be-given-an-alternative-instance-with-som", "title": "Can the continuation monad transformer be given an Alternative instance with some and many?", "body": "<p>We can define the continuation monad transformer as</p>\n\n<pre><code>data Cont r m a = Cont {run :: (a -&gt; m r) -&gt; m r}\n</code></pre>\n\n<p>We can give <code>Cont r m</code> an Alternative instance if <code>m</code> is a member of <code>Alternative</code> via</p>\n\n<pre><code>empty = Cont $ \\f -&gt; empty\nca &lt;|&gt; cb = Cont $ \\f -&gt; run ca f &lt;|&gt; run cb f\n</code></pre>\n\n<p>And then allow <code>some</code> and <code>many</code> to take on their default methods. My question is, can we define <code>some</code> and <code>many</code> in terms of <code>m</code>'s <code>some</code> and <code>many</code>, instead of the default definitions? The apparently obvious options</p>\n\n<pre><code>some ca = Cont $ \\f -&gt; some $ run ca f\nmany ca = Cont $ \\f -&gt; many $ run ca f\n</code></pre>\n\n<p>obviously do not work (they do not even type check). Is there some other way to use them (if we need <code>m</code> to also be a monad, that's fine)?</p>\n\n<p>For reference, <code>some</code> and <code>many</code> must be the least solution to the equations:</p>\n\n<ul>\n<li><code>some v = (:) &lt;$&gt; v &lt;*&gt; many v</code></li>\n<li><code>many v = some v &lt;|&gt; pure []</code></li>\n</ul>\n\n<p>Assuming that <code>some :: m a -&gt; m [a]</code> and <code>many :: m a -&gt; [a]</code> satisfy this law, so should <code>some :: Cont r m a -&gt; Cont r m [a]</code> and <code>many :: Cont r m a -&gt; Cont r m [a]</code>.</p>\n"}, {"tags": ["c", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511816903, "post_id": 47519724, "comment_id": 81995999, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/5259249/creating-static-mac-os-x-c-build\">Creating static Mac OS X C build</a>"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511817104, "post_id": 47519724, "comment_id": 81996105, "body": "I have checked, while am trying to build the same on linux and got the same error, the thread states that the problem was with Mac OS X while am getting the same with linux also"}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1511816626, "creation_date": 1511816472, "last_edit_date": 1511816626, "question_id": 47519724, "link": "https://stackoverflow.com/questions/47519724/error-while-statically-building-haskell-code", "title": "error while statically building Haskell code", "body": "<p>I have tried to build my code dynamically and it worked as expected, however when I try to statically build with the option <code>--ghc-options '-optl-static -fPIC'</code> I got the follow error</p>\n\n<pre><code>ld: library not found for -lcrt0.o\nclang: error: linker command failed with exit code 1 (use -v to see   invocation)\n`gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>any idea?</p>\n\n<p>edit : I added the c tag since I though the gcc is somehow related to c and I guess the error related to c library</p>\n"}, {"tags": ["haskell", "haskell-wai"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1511843222, "post_id": 47517973, "comment_id": 82004141, "body": "I would be tempted to argue the <i>force</i> behind the redesigns was the desire to get it right."}, {"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1525400934, "post_id": 47517973, "comment_id": 87350423, "body": "I think it would be reasonable to accept the answer from @danidiaz."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1525644903, "post_id": 47517973, "comment_id": 87427079, "body": "@Matt I upvoted it because it&#39;s (very) helpful and informative. I&#39;m reluctant accept it because I believe it isn&#39;t complete and I don&#39;t feel I can ask danidaz for digging stuff more than he already did. I&#39;m hoping someone who knows more about WAI will someday answer. For example, following documentation, resourcet is more powerful than bracket. Why was it dropped? A complete answer would explain the need for each change assuming that previous versions were actually valid solutions to the problem! Or maybe the problem definition itself changed?"}, {"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1525937650, "post_id": 47517973, "comment_id": 87553344, "body": "@sevo It seems clear that the goal was to generalize WAI as much as possible to boost uptake. Originally it was quite opinionated using Conduit and ResourceT. Each iteration has returned toward as vanilla Haskell as possible. It may have lost some &quot;power&quot; out of the box, but it&#39;s still achievable and now with less assumptions about the stack required to operate it."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1511914507, "last_edit_date": 1511914507, "creation_date": 1511819145, "answer_id": 47520325, "question_id": 47517973, "link": "https://stackoverflow.com/questions/47517973/what-forces-drove-wai-application-to-be-redesigned-five-times/47520325#47520325", "title": "What forces drove WAI Application to be redesigned five times?", "body": "<p>All the designs seem to be driven by three main concerns:</p>\n\n<ul>\n<li>Requests can have streamed bodies (so we don't have to load them all in memory before starting to process them). How to best represent it?</li>\n<li>Responses can be streamed as well. How to best represent it?</li>\n<li>How to ensure that resources allocated in the production of a response are properly freed? (For example, how to ensure that file handles are freed after serving a file?)</li>\n</ul>\n\n<hr>\n\n<pre><code>type Application = Request -&gt; Iteratee B.ByteString IO Response\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/wai-0.3.0/docs/Network-Wai.html#t:Application\" rel=\"nofollow noreferrer\">This version</a> uses iteratees, which were an early solution for streaming data in Haskell. Iteratee consumers had to be written in a \"push-based\" way, which was arguably less natural than the \"pull-based\" consumers used in modern streaming libraries.</p>\n\n<p>The streamed body of the request is fed to the iteratee and we get a <code>Response</code> value at the end. The <code>Response</code> contains an enumerator (a function that feeds streamed response bytes to a response iteratee supplied by the server). Presumably, the enumerator would control resource allocation using functions like <code>bracket</code>.</p>\n\n<hr>\n\n<pre><code>type Application = Request -&gt; ResourceT IO Response\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/wai-1.0.0/docs/Network-Wai.html#t:Response\" rel=\"nofollow noreferrer\">This version</a> uses the <a href=\"http://hackage.haskell.org/package/resourcet\" rel=\"nofollow noreferrer\">resourcet</a> monad transformer for resource management, instead of doing it in the enumerator. There is a special <code>Source</code> type inside both <code>Request</code> and <code>Response</code> which handles streamed data (and which is a bit hard to understant IMHO).</p>\n\n<hr>\n\n<pre><code>type Application = Request -&gt; IO Response\n</code></pre>\n\n<p>This version uses the streaming abstractions from <a href=\"http://hackage.haskell.org/package/conduit\" rel=\"nofollow noreferrer\">conduit</a>, but eschews resourcet and instead provides a bracket-like <a href=\"http://hackage.haskell.org/package/wai-2.1.0.3/docs/Network-Wai.html#v:responseSourceBracket\" rel=\"nofollow noreferrer\"><code>responseSourceBracket</code></a> function for handling resources in streamed responses.</p>\n\n<hr>\n\n<pre><code>type Application = Request -&gt; (forall b. (Response -&gt; IO b) -&gt; IO b)\ntype Application = Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html\" rel=\"nofollow noreferrer\">This version</a> moves to a continuation-based approach which enables the handler function to use regular <code>bracket</code>-like functions to control resource allocation. Back to square one, in that respect!</p>\n\n<p>Conduits are no longer used for streaming. Now there is a plain <code>Request -&gt; IO ByteString</code> <a href=\"http://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html#v:requestBody\" rel=\"nofollow noreferrer\">function</a> for reading chunks of the request body, and a <code>(Builder -&gt; IO ()) -&gt; IO () -&gt; IO ()</code> <a href=\"http://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html#t:StreamingBody\" rel=\"nofollow noreferrer\">function</a> in the <code>Response</code> for generating the response stream. (The <code>Builder -&gt; IO ()</code> write function along with a flush action are supplied by the server.)</p>\n\n<p>Like the resourcet-based versions, and unlike the iteratee-based version, this implementation lets you overlap reading the request body with streaming the response. </p>\n\n<p>The polymorphic handler is a neat trick to ensure that the response-taking callback <code>Response -&gt; IO b</code> is always called: the handler needs to return a <code>b</code>, and the only way to get one is to actually invoke the callback!</p>\n\n<p>This polymorphic solution seems to have caused some problems (perhaps with storing handlers in containers?) Instead of using polymorphism, we can use a <code>ResponseReceived</code> token without a public constructor. The effect is the same: the only way for handler code to get hold of the token it needs to return is to invoke the callback.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 1, "answer_count": 1, "score": 10, "last_activity_date": 1511914507, "creation_date": 1511809088, "question_id": 47517973, "link": "https://stackoverflow.com/questions/47517973/what-forces-drove-wai-application-to-be-redesigned-five-times", "title": "What forces drove WAI Application to be redesigned five times?", "body": "<p>I took a curious look at <code>WAI</code> interface and while it looks simple, I was surprised to see how many iterations it took to stabilize at the current form! </p>\n\n<p>I had assumed that CPS style for resource safety would be the most interesting thing but it looks like there is much more to learn from!</p>\n\n<pre><code>$ git log -p --reverse -- wai/Network/Wai.hs | grep '\\+type Application'\n+type Application = Request -&gt; Iteratee B.ByteString IO Response\n+type Application = Request -&gt; ResourceT IO Response\n+type Application = Request -&gt; C.ResourceT IO Response\n+type Application = Request -&gt; IO Response\n+type Application = Request -&gt; (forall b. (Response -&gt; IO b) -&gt; IO b)\n+type Application = Request -&gt; (Response -&gt; IO ResponseReceived)\n                            -&gt; IO ResponseReceived\n</code></pre>\n\n<p>Some archeology yields somewhat unsatisfactory results:</p>\n\n<pre><code>$ git log --reverse -G 'type Application' --pretty=oneline -- wai/Network/Wai.hs | cat\n879d4a23047c3585e1cba4cdd7c3e8fc13e17592 Moved everything to wai subfolder\n360442ac74f7e79bb0e320110056b3f44e15107c Began moving wai/warp to conduit\naf7d1a79cbcada0b18883bcc5e5e19a1cd06ae7b conduit 0.3\nfe2032ad4c7435709ed79683acac3b91110bba04 Pass around an InternalState instead of living in ResourceT\n63ad533299a0a5bad01a36171d98511fdf8d5821 Application uses bracket pattern\n1e1b8c222cce96c3d58cd27318922c318642050d ResponseReceived, to avoid existential issues\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1511813809, "post_id": 47516542, "comment_id": 81994390, "body": "In Haskell lists are homogeneous which means you can not construct a list with elements of different types. So <code>[2, 4, &quot;foo&quot;]</code> is a no no. So.. you can not do what exactly you are asking for in Haskell. However as the answers mention <code>all</code> should be the closest function to accomplish this task."}, {"owner": {"reputation": 231, "user_id": 7238436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d93443b9d6f74b6260f49cd59c639268?s=128&d=identicon&r=PG&f=1", "display_name": "setholopolus", "link": "https://stackoverflow.com/users/7238436/setholopolus"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1511816469, "post_id": 47516542, "comment_id": 81995758, "body": "Great point @Redu. I don&#39;t actually have a need to do this in Haskell. I just needed a simple example in Racket so people would know what I was talking about."}], "answers": [{"comments": [{"owner": {"reputation": 231, "user_id": 7238436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d93443b9d6f74b6260f49cd59c639268?s=128&d=identicon&r=PG&f=1", "display_name": "setholopolus", "link": "https://stackoverflow.com/users/7238436/setholopolus"}, "edited": false, "score": 0, "creation_date": 1511803970, "post_id": 47516591, "comment_id": 81989286, "body": "Perfect, thanks! Google wasn&#39;t helpful because of the completely different function name I guess..."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 6, "creation_date": 1511804770, "post_id": 47516591, "comment_id": 81989739, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=%3A%3A+%28a+-%3E+Bool%29+-%3E+%5Ba%5D+-%3E+Bool\" rel=\"nofollow noreferrer\">Use Hoogle</a> when you know the type."}, {"owner": {"reputation": 231, "user_id": 7238436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d93443b9d6f74b6260f49cd59c639268?s=128&d=identicon&r=PG&f=1", "display_name": "setholopolus", "link": "https://stackoverflow.com/users/7238436/setholopolus"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511804813, "post_id": 47516591, "comment_id": 81989760, "body": "@ThomasM.DuBuisson That&#39;s awesome! Thanks for the reference."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 231, "user_id": 7238436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d93443b9d6f74b6260f49cd59c639268?s=128&d=identicon&r=PG&f=1", "display_name": "setholopolus", "link": "https://stackoverflow.com/users/7238436/setholopolus"}, "edited": false, "score": 0, "creation_date": 1511807254, "post_id": 47516591, "comment_id": 81991055, "body": "@setholopolus there is other good info here <a href=\"https://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a>"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 231, "user_id": 7238436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d93443b9d6f74b6260f49cd59c639268?s=128&d=identicon&r=PG&f=1", "display_name": "setholopolus", "link": "https://stackoverflow.com/users/7238436/setholopolus"}, "edited": false, "score": 1, "creation_date": 1511807709, "post_id": 47516591, "comment_id": 81991282, "body": "@setholopolus Don&#39;t use this exact <code>hoogle</code> engine. It&#39;s horrible. And can find only something simple and very common. But in lot of real-world cases you won&#39;t find what you want :( Use search on stackage website: <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">stackage.org</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1511827978, "post_id": 47516591, "comment_id": 82000350, "body": "@Shersh it&#39;s true that Hoogle doesn&#39;t work nearly as well for advanced stuff involving type classes from libraries. But for beginners, it&#39;s actually a pretty good help at least for exploring the <code>base</code> library."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 6, "last_activity_date": 1511803524, "creation_date": 1511803524, "answer_id": 47516591, "question_id": 47516542, "link": "https://stackoverflow.com/questions/47516542/andmap-in-haskell/47516591#47516591", "title": "andmap in Haskell?", "body": "<p>You're looking for <code>all</code>:</p>\n\n<pre><code>&gt; all (&gt;0) [1, 2, 3]\nTrue\n&gt; all (&gt;0) [1, -2, 3]\nFalse\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 2, "last_activity_date": 1511803567, "creation_date": 1511803567, "answer_id": 47516605, "question_id": 47516542, "link": "https://stackoverflow.com/questions/47516542/andmap-in-haskell/47516605#47516605", "title": "andmap in Haskell?", "body": "<p>you can use <code>all</code> for this purpose</p>\n\n<p>e.g.</p>\n\n<pre><code>&gt; all even [2,4]\nTrue\n</code></pre>\n"}], "owner": {"reputation": 231, "user_id": 7238436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d93443b9d6f74b6260f49cd59c639268?s=128&d=identicon&r=PG&f=1", "display_name": "setholopolus", "link": "https://stackoverflow.com/users/7238436/setholopolus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 0, "accepted_answer_id": 47516591, "answer_count": 2, "score": 3, "last_activity_date": 1511803567, "creation_date": 1511803382, "question_id": 47516542, "link": "https://stackoverflow.com/questions/47516542/andmap-in-haskell", "title": "andmap in Haskell?", "body": "<p>In Racket, there is a really useful built in function <code>andmap</code> that lets see if a function evaluates to true on every element of a given list, as follows:</p>\n\n<pre><code>&gt; (andmap number? (list 2 4 5))\n#t\n&gt; (andmap number? (list 2 4 \"foo\"))\n#f\n</code></pre>\n\n<p>Is there an equivalent of this in Haskell, or do you have to construct it yourself by using <code>map</code> and <code>reduce</code>?</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1511801288, "post_id": 47514596, "comment_id": 81987684, "body": "I&#39;m not sure what&#39;s going on and things seem inconsistent to me, but replacing <code>eof</code> with <code>lookAhead eof</code> appears to provide the expected behavior. I&#39;m thinking there must be something in <code>parserBind</code> interacting with the implementation of <code>eof</code> since independently they seem to work as expected."}], "answers": [{"comments": [{"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 0, "creation_date": 1513375321, "post_id": 47638879, "comment_id": 82645044, "body": "It seems you&#39;re right: In the <a href=\"https://github.com/haskell/parsec/blob/b6c2d8e30b254acf053c3e9a340a9b0eab7216f0/Text/Parsec/Error.hs#L156-L157\" rel=\"nofollow noreferrer\"><code>Show</code> instance of <code>ParseError</code></a>, it calls <a href=\"https://github.com/haskell/parsec/blob/b6c2d8e30b254acf053c3e9a340a9b0eab7216f0/Text/Parsec/Error.hs#L180\" rel=\"nofollow noreferrer\"><code>showErrorMessages</code></a> which assumes there always exists on &quot;expected ...&quot; error message and one &quot;unexpected ...&quot; error message, where the latter one defaults to <code>end of input</code> if it isn&#39;t set by anything else, and in my <code>fail</code> case it hasn&#39;t been set by anything else. <code>megaparsec</code> does much better here!"}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": true, "score": 4, "last_activity_date": 1512408783, "creation_date": 1512408783, "answer_id": 47638879, "question_id": 47514596, "link": "https://stackoverflow.com/questions/47514596/unexpected-end-of-input-expecting-end-of-input-in-parsec/47638879#47638879", "title": "&quot;Unexpected end of input - expecting end of input&quot; in parsec", "body": "<p>Works with Megaparsec as expected:</p>\n\n<pre><code>module Main (main) where\n\nimport Data.Void\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\n\ntype Parser = Parsec Void String\n\nmain :: IO ()\nmain = do\n  parseTest' (manyTill anyChar eof &gt;&gt; fail \"forced fail\" :: Parser String)\n    \"somethingsomething\"\n</code></pre>\n\n<p>When I run it, I get:</p>\n\n<pre><code>1:19:\n  |\n1 | somethingsomething\n  |                   ^\nforced fail\n</code></pre>\n\n<hr>\n\n<p>The reason you get that error message with Parsec is that (if I remember correctly) Parsec internally uses a lot of questionable \"conventions\". One such convention is that \"unexpected end of input\" is represented by the absence of other unexpected items. This just asks for trouble, sure. When I started turning Parsec into Megaparsec, I was scared that this is the Haskell's \"industrial strength\" parsing library.</p>\n\n<p>Why you get no other unexpected components? Because <code>fail</code>, which actually causes your parser to fail (as you expect) does not generate any of them. Nor does it generate expected components, but those (in your case it's the \"expecting end of input\" part) are picked up and merged into your <code>fail</code> error message because of this feature:</p>\n\n<pre><code>\u03bb&gt; parseTest (many (char 'a') *&gt; many (char 'b') *&gt; empty) \"\"\nparse error at (line 1, column 1):\nunexpected end of input\nexpecting \"a\" or \"b\"\n</code></pre>\n\n<p>Parsec is clever enough to figure out that \"a\" and \"b\" are still possible here. Makes sense in this case, but lets you down with <code>fail</code>.</p>\n\n<p>Error messages in Parsec are a crazy thing, it's absolutely insane if you start to read the code critically.</p>\n\n<p>P.S. I don't mean to be mean, but let's call a shovel a shovel.</p>\n"}], "owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 767, "favorite_count": 0, "accepted_answer_id": 47638879, "answer_count": 1, "score": 2, "last_activity_date": 1512408783, "creation_date": 1511796937, "question_id": 47514596, "link": "https://stackoverflow.com/questions/47514596/unexpected-end-of-input-expecting-end-of-input-in-parsec", "title": "&quot;Unexpected end of input - expecting end of input&quot; in parsec", "body": "<p>Consider this parsec parser (put in a file <code>parsec-eof-test.hs</code>):</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\nmain = do\n  x &lt;- parse (manyTill anyChar eof &gt;&gt; fail \"forced fail\") \"\" &lt;$&gt; readFile \"parsec-eof-test.hs\"\n  print (x :: Either ParseError String)\n</code></pre>\n\n<p>If you run it, you get:</p>\n\n<pre><code>Left (line 7, column 1):\nunexpected end of input\nexpecting end of input\nforced fail\n</code></pre>\n\n<p><code>unexpected end of input - expecting end of input</code> - that doesn't make any sense, it's a contradiction.</p>\n\n<p>What's going on here?</p>\n\n<p>Is it a bad default in parsec, or is what I'm looking at actually some stack of potential errors that parsec came by while parsing?</p>\n\n<p>Since my parser <code>manyTill anyChar eof</code> consumes input, I'd expect the only error message to be emitted to be <code>forced fail</code>. What am I missing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511794822, "post_id": 47513005, "comment_id": 81983477, "body": "Do I understand correctly that you want to provide some user input that changes the state of the program such that <code>variables1 (Var N1) = False</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1511795549, "post_id": 47513005, "comment_id": 81983914, "body": "<code>evaluate</code> is already parameterized; you just pass a function other than <code>variables1</code> as its second argument."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1511891112, "post_id": 47513005, "comment_id": 82032535, "body": "Btw, F&#252;ralle is a perfectly legitimate constructor name."}], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 1, "last_activity_date": 1511809544, "last_edit_date": 1511809544, "creation_date": 1511806464, "answer_id": 47517314, "question_id": 47513005, "link": "https://stackoverflow.com/questions/47513005/haskell-change-variable-during-runtime/47517314#47517314", "title": "Haskell - Change variable during runtime", "body": "<p>You can create a new environment based on an existing environment with a variable bound to a new value:</p>\n\n<pre><code>erweiternBelegung :: Variable -&gt; Bool -&gt; Variables -&gt; Variables\nerweiternBelegung v b vs = \\v' -&gt; if v == v' then b else vs v'\n</code></pre>\n\n<p>and use it to make sure that, in the <code>Fueralle</code> case, <code>ausdruck</code> holds when <code>var</code> is both <code>True</code> and <code>False</code>:</p>\n\n<pre><code>...\nevaluate (Fueralle var ausdruk) belegung =\n  evaluate ausdruk (erweiternBelegung var True belegung) &amp;&amp;\n  evaluate ausdruk (erweiternBelegung var False belegung)\n</code></pre>\n\n<p>The existential quantifier <code>Esgibt</code> will be the same, except the <code>&amp;&amp;</code> will be replaced with <code>||</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 5841185, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lwhFV.png?s=128&g=1", "display_name": "Marc-Aurel P.", "link": "https://stackoverflow.com/users/5841185/marc-aurel-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 47517314, "answer_count": 1, "score": 0, "last_activity_date": 1511809544, "creation_date": 1511792038, "last_edit_date": 1511795338, "question_id": 47513005, "link": "https://stackoverflow.com/questions/47513005/haskell-change-variable-during-runtime", "title": "Haskell - Change variable during runtime", "body": "<p>How can i change a variable during runtime?</p>\n\n<p>I got this:</p>\n\n<pre><code>data Ausdruck = K Wahrheitswert                 -- Logical constant\n                | V Variable                    -- Logical Variable\n                | Nicht Ausdruck                -- Logical negation\n                | Und Ausdruck Ausdruck         -- Logical and\n                | Oder Ausdruck Ausdruck        -- Logical or\n                | Impl Ausdruck Ausdruck        -- Logical implied\n                | Esgibt Variable Ausdruck      -- \"exist\"\n                | Fueralle Variable Ausdruck    -- \"all\"\n                                    deriving (Eq,Show)\n\n\n\ntype Variables = Variable -&gt; Bool\n\n    variables1 :: Variable -&gt; Bool\n    variables1 (Var N1) = True\n    variables1 (Var N2) = False\n    variables1 (Var N3) = True\n    variables1 (Var N4) = True\n    variables1 (Var N5) = False\n\n\n\n\nevaluate :: Prop -&gt; Variables -&gt; Bool\nevaluate (K bool) belegung = bool\nevaluate (V var) belegung = belegung var\nevaluate (Nicht ausdruck) belegung = not (evaluate ausdruck belegung)\nevaluate (Und ausdruck ausdruck2) belegung = (evaluate ausdruck belegung) &amp;&amp; (evaluate ausdruck2 belegung)\nevaluate (Oder ausdruck ausdruck2) belegung = (evaluate ausdruck belegung) || (evaluate ausdruck2 belegung)\n</code></pre>\n\n<p>Now i want to add the quantifier \"all\". So i want to check an Propositional calculus if its still true, when i change N1 to False.\nBut how can i change a variable during runtime?</p>\n\n<p>Best regards Marc</p>\n"}, {"tags": ["multithreading", "haskell", "odbc", "unixodbc"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511799210, "post_id": 47512813, "comment_id": 81986331, "body": "Do you use a db connection or a db pool, maybe you need more connection handles, the latter shares between threads, if you use a single connection you must create one for each thread"}, {"owner": {"reputation": 56, "user_id": 3019777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eaadff2bf1584c9f9ba8af17a35696b?s=128&d=identicon&r=PG", "display_name": "Mihai Giurgeanu", "link": "https://stackoverflow.com/users/3019777/mihai-giurgeanu"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511804122, "post_id": 47512813, "comment_id": 81989367, "body": "@epsilonhalbe - i am using a different connection for each thread; i tried using a different environment for each thread; it seems that it is a bug in unixODBC on 64 bit platforms; if a handle is allocated in the main thread, then it will work, if it is allocated on a thread different then the main thread, they will not work, and I guess this will happen only on 64 bit platforms; I am still doing some research, I am not sure yet"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511804575, "post_id": 47512813, "comment_id": 81989630, "body": "Very strange! If you can go for the connection pool, I believe it is more economic. Have you checked the db settings on how many open connections it allows? (Just to make sure)"}, {"owner": {"reputation": 56, "user_id": 3019777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eaadff2bf1584c9f9ba8af17a35696b?s=128&d=identicon&r=PG", "display_name": "Mihai Giurgeanu", "link": "https://stackoverflow.com/users/3019777/mihai-giurgeanu"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511805740, "post_id": 47512813, "comment_id": 81990303, "body": "Meanwhile I have done my research, and it is indeed a bug in unixODBC. It returns as handlers the value of the pointer used for data structure that is behind the handler. In 32 bit systems, this is a 32 bit integer, but in 64 bit systems, it is truncated. So, in my case, for example for the handler with value 0xc8000c50, unixODBC allocated a data structure at the address 0x7f89c8000c50. When calling a function on this handler, it try to use it as the address of the structure, and, obviously, it fails."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511805923, "post_id": 47512813, "comment_id": 81990403, "body": "I think this is not a comment but an answer!"}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 3019777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eaadff2bf1584c9f9ba8af17a35696b?s=128&d=identicon&r=PG", "display_name": "Mihai Giurgeanu", "link": "https://stackoverflow.com/users/3019777/mihai-giurgeanu"}, "is_accepted": true, "score": 1, "last_activity_date": 1511863796, "creation_date": 1511863796, "answer_id": 47528866, "question_id": 47512813, "link": "https://stackoverflow.com/questions/47512813/unixodbc-invalid-handle-when-handle-is-allocated-in-a-haskell-thread/47528866#47528866", "title": "unixODBC: invalid handle when handle is allocated in a Haskell thread", "body": "<p>I found that the problem is caused by a bug in unixODBC, I documented it here: <a href=\"https://sourceforge.net/p/unixodbc/bugs/41/\" rel=\"nofollow noreferrer\">https://sourceforge.net/p/unixodbc/bugs/41/</a></p>\n\n<p>In a few words, unixODBC uses as handles pointers to memory allocated to keep data for those handles. As handles are 32 bit integers, on 64 bit architectures they are truncated to the last significant half (for x86 processors).</p>\n\n<p>Thus, if the pointer value is less than 2G, everything is ok, but if it is more than 2G (and not 4G due to the fact that the sign bit extends) then unixODBC will not be able to locate the data structure for the handle and will report invalid handle.</p>\n\n<p>When SQLAllocHandle is called from Haskell in the main thread, the allocated pointer has a value less than 2G, so everything works. But when it is called from another thread (liftIO or liftOS), the allocated pointer has a value larger than 2G, so multithreaded ODBC applications using unixODBC are not possible in Haskell unless all the handles allocation is done in the main thread.</p>\n\n<p>The workaround I found is based on the fact that, in the main thread I have a function that waits for the work in the threads to complete. I modified that function to also listen for a channel for handle allocation requests and then allocate the handle and return the response.</p>\n\n<p>This is the sample code I used for workarround:</p>\n\n<pre><code>-- All actions are ReaderT monad actions that share a global environment\n-- for threads execution\n\n-- | wait for worker threads to complete the work\nwaitForWorkToEnd :: (MonadIO m) =&gt; ReaderT MyEnvironment m ()\nwaitForWorkToEnd = do\n  threadsCountVar &lt;- asks threads_WorkerThreadsVar\n  allocHandleChan &lt;- asks threads_AllocHandleChan\n\n  let waitIO = join $ atomically $ orElse (readTVar threadsCountVar &gt;&gt;= check . (&lt;= 0) &gt;&gt; (return $ return ())) (allocHandleT allocHandleChan &gt;&gt;= \\ io -&gt; return (io &gt;&gt; waitIO))\n  liftIO $ waitIO\n  liftIO $ log $ fromString $ \"all worker threads have finished\"\n\n-- | creates an IO action inside a STM monad to allocate a new handler in the current thread\nallocHandleT :: (MonadIO m, MonadFail m) =&gt; TQueue (SQLSMALLINT, SQLINTEGER, TMVar SQLINTEGER) -&gt; STM (m ())\nallocHandleT chan = do\n  (hType, hParent, retVar) &lt;- readTQueue chan\n  return $ allocHandle hType hParent &gt;&gt;= liftIO . atomically . (putTMVar retVar) \n\n-- | make a handle alloc request to the main thread and wait for result\nallocHandleReq :: (MonadIO m, MonadFail m) =&gt; SQLSMALLINT -&gt; SQLINTEGER -&gt; ReaderT MyEnvironment m SQLINTEGER\nallocHandleReq htype hparent = do\n  allocHandleChan &lt;- asks threads_AllocHandleChan\n  resultVar       &lt;- liftIO $ atomically $ newEmptyTMVar\n  liftIO $ atomically $ writeTQueue allocHandleChan (htype, hparent, resultVar)\n  liftIO $ atomically $ takeTMVar resultVar\n\n-- allocHandle simply calls SQLAllocHandle and takes care of the diagnostics \n-- information; it is part of the sqlcli package you can find it here:\n-- https://hub.darcs.net/mihaigiurgeanu/sqlcli\n</code></pre>\n"}], "owner": {"reputation": 56, "user_id": 3019777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eaadff2bf1584c9f9ba8af17a35696b?s=128&d=identicon&r=PG", "display_name": "Mihai Giurgeanu", "link": "https://stackoverflow.com/users/3019777/mihai-giurgeanu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 47528866, "answer_count": 1, "score": 0, "last_activity_date": 1511863796, "creation_date": 1511791496, "question_id": 47512813, "link": "https://stackoverflow.com/questions/47512813/unixodbc-invalid-handle-when-handle-is-allocated-in-a-haskell-thread", "title": "unixODBC: invalid handle when handle is allocated in a Haskell thread", "body": "<p>I am building an ODBC application in Haskell, using foreign calls. When calling odbc functions in forkIO or forkOS thread (ie unbounded or bounded thread) on handles allocated in the same thread, the function returns invalid handle error.</p>\n\n<p>The same call works perfect when made in the main thread.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1511791407, "post_id": 47512682, "comment_id": 81981250, "body": "Haskell has no &quot;global&quot; state. So you can not really set <code>q</code>, etc. furthermore your code looks very imperative, this is usually not how fuctional programming works."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 6, "creation_date": 1511791783, "post_id": 47512682, "comment_id": 81981499, "body": "Note that <code>let c = c + 1</code> is infinitely recursive, so you&#39;ll get an error or an infinite looo when you try to use it."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511791919, "post_id": 47512682, "comment_id": 81981598, "body": "Usually functional programming implies that (most) functions are pure. This means that functions can not depend on global state: everything needs to be passed explicitly, and for the same input, a function should always produce the same output."}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "edited": false, "score": 0, "creation_date": 1511792567, "post_id": 47512682, "comment_id": 81982027, "body": "About let c = c + 1 : The way I right that it will exite the loop once it reaches the same value as counter. (I&#39;m not sure.)"}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "edited": false, "score": 0, "creation_date": 1511792614, "post_id": 47512682, "comment_id": 81982058, "body": "Willem Van Onsem I am new in this type of programming language. I can see you know what you are explaining and I want to thanks for that. Could you give me any help with this? How would you do to get the final result? (I am creating an image to upload)"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 4, "creation_date": 1511792645, "post_id": 47512682, "comment_id": 81982085, "body": "You also never actually run your loop."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1511792930, "post_id": 47512682, "comment_id": 81982271, "body": "@RobertoLopes I don&#39;t think you understood me. I&#39;m not saying that <code>loop</code> is infinitely recursive. I&#39;m saying that <code>c</code> is. Any use of <code>c</code> will lead to an error or infinite loop. Guaranteed. It doesn&#39;t matter what the rest of the program says; that line by itself is infinitely recursive."}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1511793047, "post_id": 47512682, "comment_id": 81982353, "body": "@sepp2k Omg, you right... I forgot to run the loop function... Thanks."}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "edited": false, "score": 0, "creation_date": 1511793545, "post_id": 47512682, "comment_id": 81982671, "body": "I don&#39;t really know much of this language... I&#39;m learning this from 5 days now... I&#39;m thinking of split my main&#39; function and treat each step on a side and at the end run all of them. Is this an option? (good or bad?)"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1511793954, "post_id": 47512682, "comment_id": 81982919, "body": "The bottom line here is that your code is very ill-suited to Haskell right now. I suggest asking a question more of the form &quot;I&#39;m trying to solve X problem using functional programming. Where am I going wrong?&quot; Because I&#39;m having trouble telling what the objective of your code is right now."}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "edited": false, "score": 0, "creation_date": 1511794143, "post_id": 47512682, "comment_id": 81983046, "body": "My question was how to turn the variable q into global. that variable is shown at the first peace of code. But after the first comments, I think I&#39;ll need to change my function entirely."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1511794213, "post_id": 47512682, "comment_id": 81983090, "body": "@RobertoLopes Yes, I would probably recommend that. You&#39;re trying to write C/Java-style code in Haskell, and it simply doesn&#39;t work that way."}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1511794384, "post_id": 47512682, "comment_id": 81983206, "body": "@Silvio Mayolo So, split everything might be the way?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1511794471, "post_id": 47512682, "comment_id": 81983267, "body": "Try to write, in English words, what your program&#39;s intended behavior is. Then edit that intended behavior into your question (or ask a new question). Then you should get some good answers, even if they are &quot;scrap your solution and try this other cool thing&quot;."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511799974, "post_id": 47512682, "comment_id": 81986829, "body": "Note that <code>letter&#39;</code> will go into an infinite loop on symbols like <code>?</code>, you can use guards in your <code>cap</code> function to do that in a nice readable way."}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511801157, "post_id": 47512682, "comment_id": 81987605, "body": "@epsilonhalbe I am aware of that, this function will be mainly for letters. After I solve all the problems I just need to add the rest of the asc II But thank you for your comment. I could have forgotten..."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1511801241, "post_id": 47512682, "comment_id": 81987652, "body": "@RobertoLopes I can highly recommend <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511801445, "post_id": 47512682, "comment_id": 81987780, "body": "@robertolopes <code>Char</code> is not only ASCII you can have fun stuff like <code>\u03c0</code> or <code>\u20ac</code> in your <code>String</code>s"}, {"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "edited": false, "score": 0, "creation_date": 1511801668, "post_id": 47512682, "comment_id": 81987933, "body": "Ok ok, I only need letters for this coursework xD"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511803629, "post_id": 47512682, "comment_id": 81989095, "body": "<code>let fresult = fresult ++ result</code> is another infinite loop, similarly to your previous <code>let c = c+1</code>. It has the same form, essentially."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1511795190, "last_edit_date": 1511795190, "creation_date": 1511794582, "answer_id": 47513848, "question_id": 47512682, "link": "https://stackoverflow.com/questions/47512682/haskell-global-var-inside-loop/47513848#47513848", "title": "Haskell Global var inside loop", "body": "<p>Haskell variables aren't &ldquo;variable&rdquo; in the sense that programmers usually interpret the word, namely, they aren't mutable. Basically, any Haskell variable is just a local constant. Hence your loop construct doesn't make sense, namely</p>\n\n<pre><code>       let c = 0\n       let loop = do\n            ...\n            let c = c + 1\n            when (c /= counter) loop\n</code></pre>\n\n<p>does not work at all.</p>\n\n<ul>\n<li>You don't actually enter the loop, you merely define what the loop would be.</li>\n<li>If you did enter the loop, you'd badly trip over the <code>let c = c + 1</code>. This does not modify the existing <code>c</code>, instead it just defines a completely separate variable <code>c</code> which, because it's in a narrower scope, <em>shadows</em> the former <code>c = 0</code>. This shadowing binding is even used in the definition itself, i.e. to calculate <code>c</code> the runtime needs to know the value of <code>c</code>, to which it needs to calculate <code>c</code>, to which... and so on.</li>\n</ul>\n\n<p>What you actually want there is</p>\n\n<pre><code>       <del>let c = 0</del>\n       let loop c = do\n            ...\n            let c' = c + 1\n            when (c' /= counter) $ loop c'\n       loop 0  -- actually invoke the loop, starting from 0.\n</code></pre>\n\n<p>But even so, this loop doesn't really accomplish anything &ndash; you merely define some local variables in each iteration, but never actually do anything of lasting impact with them.</p>\n\n<p>You <em>could</em> in each iteration commit some actual <code>IO</code> action, such as printing out a single big letter. You could also yield some result from the loop, which seems to be what you're asking in this question. For instance, to broadcast the last &ldquo;state&rdquo; of <code>q</code> to the outside, you'd need to replace the <code>when</code> (which shortcuts to <code>return ()</code> if the condition is not fulfilled) with</p>\n\n<pre><code>       let loop c = do\n            let q = ...\n            let c' = c + 1\n            if c' == counter\n             then return q\n             then loop c'\n       q &lt;- loop 0\n</code></pre>\n\n<p>But I dispute that this is sensible; instead, a much better approach is to concatenate all the letters still in list form (that doesn't require any ugly index/length juggling nor any IO or explicit loops, just <code>map</code> and <code>concat</code>), and then printing the entire result in one clean <code>putStr</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "edited": false, "score": 0, "creation_date": 1511872519, "post_id": 47522990, "comment_id": 82019878, "body": "Thank you, I tried your answer and it works perfectly! I only changed letter for letter&#39; to use my old letters."}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 0, "last_activity_date": 1511837848, "last_edit_date": 1511837848, "creation_date": 1511836158, "answer_id": 47522990, "question_id": 47512682, "link": "https://stackoverflow.com/questions/47512682/haskell-global-var-inside-loop/47522990#47522990", "title": "Haskell Global var inside loop", "body": "<p>The whole thing can be accomplished with the following:</p>\n\n<pre><code>module Main where\n\nimport Data.List (transpose)\nimport Data.Char (ord, chr, toUpper)\n\npp :: [String] -&gt; IO ()\npp = putStr . unlines\n\nletter :: Char -&gt; [String]\n{- letter definitions go here -}\n-- anything else gets a square of ?'s\nletter _ =  [\"?????\",\n             \"?   ?\",\n             \"?   ?\",\n             \"?   ?\",\n             \"?????\"]\n\nbigify :: String -&gt; [String]\nbigify = map unwords . transpose . map (letter . toUpper)\n\nmain :: IO ()\nmain = do putStr \"Enter a string: \"\n          getLine &gt;&gt;= pp . concatMap bigify . words\n</code></pre>\n\n<p>In <code>main</code>, we get a line of text, break it into words, and for each word, <code>bigify</code> the word into lines, concatenate the lines, and <code>pp</code> the whole thing.</p>\n\n<p>The <code>bigify</code> function maps each character in its word argument, passing each character to <code>toUpper</code> and then <code>letter</code>, which converts it to a list of lines for the upper-case version of that character.  The result is a list with an element per character where each element is a list of lines for that character.  This is <code>transpose</code>d into a list with an element per line where each element is a list of pieces of each character for that line.  These elements are joined with <code>unwords</code> to form a list of lines.</p>\n"}], "owner": {"reputation": 21, "user_id": 9015047, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208239239256997/picture?type=large", "display_name": "Roberto Lopes", "link": "https://stackoverflow.com/users/9015047/roberto-lopes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 1, "accepted_answer_id": 47522990, "answer_count": 2, "score": 1, "last_activity_date": 1511837848, "creation_date": 1511791090, "last_edit_date": 1511826617, "question_id": 47512682, "link": "https://stackoverflow.com/questions/47512682/haskell-global-var-inside-loop", "title": "Haskell Global var inside loop", "body": "<p>This is one of my functions which involve a few other more.</p>\n\n<pre><code>main' :: IO ()\nmain' = do putStr \"Enter a string: \"\n           yx &lt;- getLine\n           let a = chunks yx\n           let counter = (length . concat . map pairToList) a\n           let c = 0\n           let loop = do\n               let b = a !! c\n               let kk = xx b\n               let c = c + 1\n               let q = oncemore kk\n               when (c /= (counter))  loop\n           pp(q)\n</code></pre>\n\n<p><strong>My question will be at the bottom in bold</strong></p>\n\n<p>I'll let here the rest of the functions expecting new ways to sort my problem. At the end I have an image of how the final output should looks like.\n(I'm repeating the above code in the bottom one)</p>\n\n<pre><code>module Bigtext where\nimport Char\nimport Hugs.Prelude\nimport Data.List\nimport Control.Monad\n\ncap :: Char -&gt; Char\ncap  c = if c &gt;= 'a' &amp;&amp; c &lt;= 'z' then chr (ord c - 32) else c\n\nletter' :: Char -&gt; [String]\n\npp :: [String]-&gt;IO()\npp = putStr . concatMap (++\"\\n\")\n\nletter' 'A' = [\" AA \",\n               \"A  A\",\n               \"AAAA\",\n               \"A  A\",\n               \"A  A\"]\n\nletter' 'B' = [\"BBB \",\n               \"B  B\",\n               \"BBB \",\n               \"B  B\",\n               \"BBB \"]\n\nletter' 'C' = [\" CCC\",\n               \"C   \",\n               \"C   \",\n               \"C   \",\n               \" CCC\"]\n\nletter' 'D' = [\"DDD \",\n               \"D  D\",\n               \"D  D\",\n               \"D  D\",\n               \"DDD \"]\n\nletter' 'E' = [\"EEEE\",\n               \"E   \",\n               \"EEE \",\n               \"E   \",\n               \"EEEE\"]\n\nletter' 'F' = [\"FFFF\", \n               \"F   \", \n               \"FFF \", \n               \"F   \", \n               \"F   \"]\n\nletter' 'G' = [\" GGG \", \n               \"G    \", \n               \"G  GG\", \n               \"G   G\", \n               \" GGG \"]\n\nletter' 'H' = [\"H  H\", \n               \"H  H\", \n               \"HHHH\", \n               \"H  H\", \n               \"H  H\"]\n\nletter' 'I' = [\"III\", \n               \" I \", \n               \" I \", \n               \" I \", \n               \"III\"]\n\nletter' 'J' = [\"    J\", \n               \"    J\", \n               \"    J\", \n               \"J   J\", \n               \" JJJ \"]\n\nletter' 'K' = [\"K  K\", \n               \"K K \", \n               \"KK  \", \n               \"K K \", \n               \"K  K\"]\n\nletter' 'L' = [\"L   \",\n               \"L   \",\n               \"L   \",\n               \"L   \",\n               \"LLLL\"]\n\nletter' 'M' = [\"M   M\",\n               \"MM MM\",\n               \"M M M\",\n               \"M   M\",\n               \"M   M\"]\n\nletter' 'N' = [\"N   N\",\n               \"NN  N\",\n               \"N N N\",\n               \"N  NN\",\n               \"N   N\"]\n\nletter' 'O' = [\" OOO \",\n               \"O   O\",\n               \"O   O\",\n               \"O   O\",\n               \" OOO \"]\n\nletter' 'P' = [\"PPPP \",\n               \"P   P\",\n               \"PPPP \",\n               \"P    \",\n               \"P    \"]\n\nletter' 'Q' = [\" QQQ  \",\n               \"Q   Q \",\n               \"Q   Q \",\n               \"Q  QQ \",\n               \" QQQQQ\"]\n\nletter' 'R' = [\"RRRR \",\n               \"R   R\",\n               \"RRRR \",\n               \"R R  \",\n               \"R  RR\"]\n\nletter' 'S' = [\" SSS \",\n               \"S    \",\n               \" SSS \",\n               \"    S\",\n               \"SSSS \"]\n\nletter' 'T' = [\"TTTTTT\",\n               \"  TT  \",\n               \"  TT  \",\n               \"  TT  \",\n               \"  TT  \"]\n\nletter' 'U' = [\"U   U\",\n               \"U   U\",\n               \"U   U\",\n               \"U   U\",\n               \" UUU \"]\n\nletter' 'V' = [\"V     V\",\n               \"V     V\",\n               \" V   V \",\n               \"  V V  \",\n               \"   V   \"]\n\nletter' 'W' = [\"W     W\",\n               \"W     W\",\n               \"W  W  W\",\n               \" W W W \",\n               \"  W W  \"]\n\nletter' 'X' = [\"X   X\",\n               \" X X \",\n               \"  X  \",\n               \" X X \",\n               \"X   X\"]\n\nletter' 'Y' = [\"Y   Y\",\n               \" Y Y \",\n               \"  Y  \",\n               \"  Y  \",\n               \"  Y  \"]\n\nletter' 'Z' = [\"ZZZZZ\",\n               \"   Z \",\n               \"  Z  \",\n               \" Z   \",\n               \"ZZZZZ\"]\n\nletter' ' ' = [\"      \",\n               \"      \",\n               \"      \",\n               \"      \",\n               \"      \"]\n\nletter' c = letter' (cap c)\n\nletter :: Char -&gt; IO()\nletter c = pp(letter' (cap c))\n\nzipAll :: [[String]] -&gt; [String]\nzipAll = map unwords . transpose\n\nchunk :: Int -&gt; [a] -&gt; [[a]]\nchunk _ [] = []\nchunk n xs = first : chunk n rest where (first, rest) = splitAt n xs\n\nsplitSkip :: Int -&gt; [a] -&gt; [[a]]\nsplitSkip n xs = transpose $ chunk n xs\n\nchunks yx = words yx\n\npairToList :: a -&gt; [a]\npairToList x = [x]\n\nxx b = zipAll (map (letter' . head) (splitSkip (length b) b))\n\ntype MyString = [String]\n\noncemore :: MyString -&gt; MyString\noncemore kk = kk ++ kk\n\nmain' :: IO ()\nmain' = do putStr \"Enter a string: \"\n           yx &lt;- getLine\n           let a = chunks yx\n           let counter = (length . concat . map pairToList) a\n           let c = 0\n           let loop = do\n               let b = a !! c\n               let kk = xx b\n               let c = c + 1\n               let q = oncemore kk\n               when (c /= (counter))  loop\n           pp(q)\n</code></pre>\n\n<p>This is the expected output:</p>\n\n<p><a href=\"https://i.stack.imgur.com/jDm7w.png\" rel=\"nofollow noreferrer\">expected output</a></p>\n\n<p><strong>This is where I am at the moment</strong></p>\n\n<pre><code>main' :: IO ()\nmain' = do putStr \"Enter a string: \"\n           yx &lt;- getLine\n           let a = chunks yx\n           let counter = (length . concat . map pairToList) a\n           let c = 0\n           let loop c = do\n               let c' = c + 1\n               let b = a !! (c'-1)\n               let kk = xx b\n               if c' /= counter\n                  then return kk\n               else loop c'\n           **kk &lt;- loop c**\n           pp(kk)\n</code></pre>\n\n<p>In the line <strong>kk &lt;- loop c</strong> if I change c for a number, its possible to get a word (depending of how many words your input has) the problem is: <strong>How do I print all the index's?? for example if I have 3 words, how do I print it out without hard code?</strong></p>\n\n<p>Sorry about my english...\nAnd thank you for your time.</p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 10368, "user_id": 435904, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ce3dbd2b9c6693c6472c947e758a0e24?s=128&d=identicon&r=PG", "display_name": "4e6", "link": "https://stackoverflow.com/users/435904/4e6"}, "edited": false, "score": 0, "creation_date": 1511779240, "post_id": 47508894, "comment_id": 81973645, "body": "You should also implement <code>To&#47;FromJSON</code> instances for <code>EmailState</code>"}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "edited": false, "score": 0, "creation_date": 1511782800, "post_id": 47509085, "comment_id": 81975742, "body": "Thanks Willem . Your solution does work . If possible can you also update your answer or point to a good resource so that a new comer to haskell like me can understand hackage documentation. Like in above case I was trying   instance ToJSON EmailState where     toJSON _ = &quot;Y&quot; which did not work obviously."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1511779956, "last_edit_date": 1511779956, "creation_date": 1511779582, "answer_id": 47509085, "question_id": 47508894, "link": "https://stackoverflow.com/questions/47508894/convert-constructor-in-record-to-custom-json-string-in-aeson-haskell/47509085#47509085", "title": "Convert constructor in record to custom json string in aeson haskell", "body": "<p>You need to implement the <code>ToJSON</code> of <code>EmailState</code> yourself (so remove the <code>instance ToJSON EmailState</code>, and write it like):</p>\n\n<pre><code>instance ToJSON EmailState where\n    toJSON EmailVerified = String \"Y\"\n    toJSON EmailNotVerified = String \"N\"</code></pre>\n\n<p>You also will need to alter yhe parser:</p>\n\n<pre><code>instance FromJSON EmailState where\n    parseJSON (String \"Y\") = return EmailVerified\n    parseJSON (String \"N\") = return EmailNotVerified\n    parseJSON _ = fail \"Invalid JSON value to parse\"</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6658604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e5776b34097b177d7cc327137f60337?s=128&d=identicon&r=PG&f=1", "display_name": "Ishmum Khan", "link": "https://stackoverflow.com/users/6658604/ishmum-khan"}, "is_accepted": false, "score": 0, "last_activity_date": 1540825444, "creation_date": 1540825444, "answer_id": 53048313, "question_id": 47508894, "link": "https://stackoverflow.com/questions/47508894/convert-constructor-in-record-to-custom-json-string-in-aeson-haskell/53048313#53048313", "title": "Convert constructor in record to custom json string in aeson haskell", "body": "<p>Awesome answer by Willem, Just to add to the syntax\nyou can use - </p>\n\n<pre><code>instance FromJSON EmailState where\n    parseJSON (String s) \n        | s == \"Y\" = return EmailVerified\n        | s == \"N\" = return EmailNotVerified\n        | otherwise = fail \"Invalid JSON value to parse\"\n</code></pre>\n\n<p>-- Note: otherwise = mzero -- is prefered</p>\n\n<p>ref: <a href=\"https://mail.haskell.org/pipermail/beginners/2011-October/008791.html\" rel=\"nofollow noreferrer\">https://mail.haskell.org/pipermail/beginners/2011-October/008791.html</a></p>\n"}], "owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 47509085, "answer_count": 2, "score": 3, "last_activity_date": 1540825444, "creation_date": 1511779004, "question_id": 47508894, "link": "https://stackoverflow.com/questions/47508894/convert-constructor-in-record-to-custom-json-string-in-aeson-haskell", "title": "Convert constructor in record to custom json string in aeson haskell", "body": "<p>I would like to convert my json to below format. And to convert from below format to my record. Please check the code that I have written below.</p>\n\n<pre><code>{\n    \"uid\" : \"bob\",\n    \"emailid\" : \"bob@bob.com\",\n    \"email_verified\" : \"Y\" // \"Y\" for EmailVerified and \"N\" for EmailNotVerified\n}\n</code></pre>\n\n<p>I have below code where I am trying to convert user type to and from json\nusing Aeson library in Haskell</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nimport Data.Monoid ((&lt;&gt;))\nimport GHC.Generics\nimport Data.Aeson (FromJSON, ToJSON)\nimport Data.Aeson.Types\n\ndata User = User {\n    userId :: String,\n    userEmail :: String,\n    userEmailVerified :: EmailState\n  } deriving (Show, Generic)\n\ndata EmailState = EmailVerified | EmailNotVerified deriving (Generic, Show)\n\ninstance ToJSON User where\n    toJSON u = object [\n       \"uid\" .= userId u,\n       \"emailid\" .= userEmail u,\n       \"email_verified\" .= userEmailVerified u\n       ]\n\ninstance FromJSON User where\n    parseJSON = withObject \"User\" $ \\v -&gt; User\n        &lt;$&gt; v .: \"uid\"\n        &lt;*&gt; v .: \"emailid\"\n        &lt;*&gt; v .: \"email_verified\"\n\ninstance ToJSON EmailState\ninstance FromJSON EmailState\n</code></pre>\n\n<p>However, My format that I am currently able to generate is like below</p>\n\n<pre><code>{\n    \"uid\" : \"bob\",\n    \"emailid\" : \"bob@bob.com\",\n    \"email_verified\" : \"EmailVerified\"\n}\n</code></pre>\n"}, {"tags": ["haskell", "types", "gadt", "data-kinds"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1511777317, "post_id": 47507954, "comment_id": 81972429, "body": "If you want to put them in the same (homogeneous) list, you have to give the same type to root and non-root. But if they have the same type, you can substitute one for the other in subtrees. This is impossible, as stated. Perhaps it would be OK to wrap your first attempt into an existential wrapper so to remove the boolean in the type? Or using a sum type? Or, without GADTs, making root its own type (and still using a sum or wrapper)?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1511778253, "post_id": 47507954, "comment_id": 81973021, "body": "Can you explain why you want this? I.e., what the <code>Rooted</code> constructor is supposed to be <i>for</i>?"}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1511790456, "post_id": 47507954, "comment_id": 81980635, "body": "It&#39;s a pattern matcher. I&#39;d like to be able to write expressions as simple lists, with fairly compact syntax. <code>Branch</code> is actually a set of operators to combine two expressions. <code>Rooted</code> is a (set of) wrappers to say things like &quot;this pattern doesn&#39;t have to appear right next to the previous/next one&quot;. But it seems difficult to define this kind of type in a clean/simple way, so I guess I should find a different approach."}], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1511787454, "post_id": 47511028, "comment_id": 81978774, "body": "Please correct me if my comment on dependent types was inaccurate. Haskell has some support for dependent types (e.g. through GADTs), but I believe more support would be needed to satisfy the description given in the question."}], "tags": [], "owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "is_accepted": true, "score": 3, "last_activity_date": 1511785720, "creation_date": 1511785720, "answer_id": 47511028, "question_id": 47507954, "link": "https://stackoverflow.com/questions/47507954/can-i-disallow-one-particular-data-constructor-inside-another-while-both-give-t/47511028#47511028", "title": "Can I disallow one particular data constructor inside another, while both give the same type?", "body": "<p>You can use the first solution if you wrap everything in a constructor which hides the boolean value:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, KindSignatures, RankNTypes #-}\ndata T (x::Bool) where\n  Leaf :: Int -&gt; T True\n  Rooted :: T True -&gt; T False\n  Branch :: T True -&gt; T True -&gt; T True\n\ndata TWrap = forall (x :: Bool). TWrap (T x)\n\n[TWrap $ Leaf 1, TWrap $ Rooted (Leaf 2), TWrap $ Branch (Leaf 3) (Branch (Leaf 4) (Leaf 5))]\n</code></pre>\n\n<p>However, if we are going to have to wrap the type anyways, it's probably better to just go for the more straightforward solution of splitting the type:</p>\n\n<pre><code>data T = Leaf Int | Branch T T\ndata TWrap = Unrooted T | Rooted T\n\n[Unrooted $ Leaf 1, Rooted $ Leaf 2, Unrooted $ Branch (Leaf 3) (Branch (Leaf 4) (Leaf 5))]\n</code></pre>\n\n<hr>\n\n<p>What you are asking for is basically <a href=\"https://en.wikipedia.org/wiki/Dependent_type\" rel=\"nofollow noreferrer\">dependent types</a>, which Haskell doesn't have (<a href=\"https://ghc.haskell.org/trac/ghc/wiki/DependentHaskell\" rel=\"nofollow noreferrer\">yet</a>).</p>\n"}], "owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 47511028, "answer_count": 1, "score": 2, "last_activity_date": 1511785720, "creation_date": 1511776049, "question_id": 47507954, "link": "https://stackoverflow.com/questions/47507954/can-i-disallow-one-particular-data-constructor-inside-another-while-both-give-t", "title": "Can I disallow one particular data constructor inside another, while both give the same type?", "body": "<p>I'd like to make a type <code>T</code> in Haskell that allows for</p>\n\n<pre><code>[Leaf 1, Rooted (Leaf 2), Branch (Leaf 3) (Branch (Leaf 4) (Leaf 5))]\n</code></pre>\n\n<p>but not</p>\n\n<pre><code>[Leaf 1, Rooted (Leaf 2), Branch (Rooted (Leaf 3)) (Branch (Leaf 4) (Leaf 5))]\n</code></pre>\n\n<p>ie. all constructors of <code>T</code> except <code>Rooted</code> can appear in the first or second arguments of <code>Branch</code> (the complete code has a few more constructors).</p>\n\n<p>I've tried things like</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\ndata T (x::Bool) where\n  Leaf :: Int -&gt; T True\n  Rooted :: T True -&gt; T False\n  Branch :: T True -&gt; T True -&gt; T True\n</code></pre>\n\n<p>which ensures we can't do <code>Branch (Rooted \u2026) \u2026</code> but also means we can't do <code>[Rooted \u2026, One \u2026]</code> since that would be a list of different types (<code>[T True, T False]</code>).</p>\n\n<p>I looked into DataKinds, hoping I could do </p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, KindSignatures #-}\ndata T where\n  Leaf :: Int -&gt; T\n  Rooted :: T -&gt; T\n  Branch :: UnRooted a =&gt; a -&gt; a -&gt; T\nclass UnRooted a\ninstance UnRooted Leaf\ninstance UnRooted Branch\n</code></pre>\n\n<p>but then ghc (7.10.3) gives <code>Data constructor \u2018Leaf\u2019 comes from an un-promotable type \u2018T\u2019</code>.</p>\n\n<p>Is there way to do this in Haskell? </p>\n"}, {"tags": ["windows", "multithreading", "sockets", "haskell", "io"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1511777222, "post_id": 47507586, "comment_id": 81972352, "body": "Does it make any difference if the Haskell program is compiled threaded / nonthreaded?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1511778066, "post_id": 47507586, "comment_id": 81972905, "body": "It does. By compiling the program without <code>threaded</code> the main thread can kill the <code>reader</code> thread. However not using <code>threaded</code> is not an option (we do want to use OS threads)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511785047, "post_id": 47507586, "comment_id": 81977202, "body": "BTW, on linux this example seems to work, with both threaded and non-threaded RTS. So, it looks as a windows specific issue."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1511785665, "post_id": 47507586, "comment_id": 81977586, "body": "Indeed. That&#39;s why I mention Windows so many times in my question ;)"}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 1, "creation_date": 1511839447, "post_id": 47507586, "comment_id": 82003119, "body": "Looks like the bug report was closed as fixed in 8.2.1.  Is this confirmed?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1511852233, "post_id": 47507586, "comment_id": 82007211, "body": "Indeed. I&#39;m gonna check this tomorrow as soon as I have access to a Windows machine."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1511952183, "post_id": 47507586, "comment_id": 82058209, "body": "Nope. It is not fixed. I already added a comment in the bug report. This is quite strange ..."}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1511786560, "creation_date": 1511774913, "last_edit_date": 1511786560, "question_id": 47507586, "link": "https://stackoverflow.com/questions/47507586/killing-a-thread-waiting-on-hgetline-from-a-socket-windows", "title": "Killing a thread waiting on hGetLine from a socket (Windows)", "body": "<p>If I run the following Java program on a Windows (10) machine (I'm posting the program here for the sake of completeness):</p>\n\n<pre><code>public class IdleServer {\n    public static void main(String[] args) throws IOException, InterruptedException {\n        ServerSocket serverSock = new ServerSocket(9090);\n\n        Socket sock = serverSock.accept();\n\n        while (true) Thread.sleep(1000);\n    }\n}\n</code></pre>\n\n<p>and then I connect to the Java server from Haskell:</p>\n\n<pre><code>readWithinNSecs :: IO ()\nreadWithinNSecs = withSocketsDo $ do\n  h &lt;- connectTo \"localhost\" (PortNumber 9090)\n  hSetBuffering h NoBuffering\n  readerTid &lt;- forkIO $ reader h\n  threadDelay $ 2 * 10^6\n  putStrLn \"Killing the reader\"\n  killThread readerTid\n  putStrLn \"Reader thread killed\"\n  where\n    reader h = do\n      line &lt;- strip &lt;$&gt; hGetLine h\n      putStrLn $ \"Got \" ++ line\n</code></pre>\n\n<p>then the Haskell program will hang when trying to kill the process that is trying to read from the handle. Killing the Java server will cause the Haskell program to terminate, giving also the error:</p>\n\n<pre><code>&lt;socket: 380&gt;: hGetLine: failed (No error)\n</code></pre>\n\n<p>If I run the same two programs on Linux then the Haskell program terminates.</p>\n\n<p>This seems to point to a bug in the <code>base</code> libraries of Haskell, so <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14503#comment:1\" rel=\"nofollow noreferrer\">I reported it</a>, but in the meantime I need to find a way to workaround this. Any ideas?</p>\n\n<p><strong>UPDATE</strong>: I posted the solution below, but it is not satisfactory: it terminates the reader thread, but it leaks resources. </p>\n\n<pre><code>import           Control.Concurrent.Async\n\n-- ...\n\nreaderAsync h = do\n  a &lt;- async $ strip &lt;$&gt; hGetLine h\n  line &lt;- wait a\n  putStrLn $ \"Got \" ++ line\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 10, "creation_date": 1511780922, "post_id": 47507005, "comment_id": 81974686, "body": "Well, it depends on context. I\u2019m happy to see that a Haskell binary, which includes a runtime support library and garbage collector, takes up such a tiny amount of space (1MB). I\u2019m sad to see that a \u201chello world\u201d in C takes up such a huge amount of space (8KB)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511804678, "post_id": 47507005, "comment_id": 81989686, "body": "I also find it a bit larg-ish, but keep in mind that GHC statically links libraries in the executable, at least by default. I guess that if GHC liked libraries dynamically, and if the RTS was also moved to an external shared library (as libc does), the executable would be much smaller. For more complex programs it is not a serious issue, in my experience."}, {"owner": {"reputation": 139, "user_id": 3707023, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/624412516/picture?type=large", "display_name": "Steven2163712", "link": "https://stackoverflow.com/users/3707023/steven2163712"}, "edited": false, "score": 0, "creation_date": 1511883151, "post_id": 47507005, "comment_id": 82027290, "body": "Jon Purdy, very interesting comment, thank you. Chi, I like looking at the assembly output of my executables. It&#39;s a strange fetish that I have."}], "answers": [{"tags": [], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "is_accepted": false, "score": 3, "last_activity_date": 1511774171, "creation_date": 1511774171, "answer_id": 47507337, "question_id": 47507005, "link": "https://stackoverflow.com/questions/47507005/hello-world-in-haskell-is-1-3-mb/47507337#47507337", "title": "Hello world in Haskell is 1.3 mb", "body": "<p>Every Haskell binary ships with a copy of the runtime system (<a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts</a>). At any rate, you can reclaim some space by <code>strip</code>ping the binary.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 11, "last_activity_date": 1511777905, "creation_date": 1511777905, "answer_id": 47508548, "question_id": 47507005, "link": "https://stackoverflow.com/questions/47507005/hello-world-in-haskell-is-1-3-mb/47508548#47508548", "title": "Hello world in Haskell is 1.3 mb", "body": "<p>You don't say which platform or what version of GHC, so I'm making some guesses here.</p>\n\n<ol>\n<li><p>By default, GHC does not strip debugging symbols. On Linux you can run the <code>strip</code> utility to remove these. On any platform, you can compile with <code>-optl-s</code> to automatically strip debugging symbols during linking.</p></li>\n<li><p>Depending on exactly which platform you're on and what version of GHC you have, GHC defaults to <em>statically</em> linking all the Haskell libraries you call, and the Haskell runtime system itself (i.e., the garbage collector, thread scheduler, transaction manager, I/O manager...) If supported for your platform, turning on <em>dynamic</em> linking can result in a significant decrease in executable size.</p></li>\n</ol>\n\n<p>See also</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/6115459/small-haskell-program-compiled-with-ghc-into-huge-binary\">Small Haskell program compiled with GHC into huge binary</a></li>\n<li><a href=\"https://stackoverflow.com/questions/699908/making-small-haskell-executables\">Making small haskell executables?</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 0, "creation_date": 1511863873, "post_id": 47516043, "comment_id": 82014053, "body": "I didn&#39;t know the RTS could be linked dynamically as any other library. Thanks!"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1511801585, "creation_date": 1511801585, "answer_id": 47516043, "question_id": 47507005, "link": "https://stackoverflow.com/questions/47507005/hello-world-in-haskell-is-1-3-mb/47516043#47516043", "title": "Hello world in Haskell is 1.3 mb", "body": "<p>Don't statically link in the libraries (including RTS) into binaries if you want small binaries:</p>\n\n<pre><code>% cat x.c\n#include &lt;stdio.h&gt;\n\nint main()\n{\n    printf(\"Hello world\\n\");\n}\n% gcc x.c &amp;&amp; du -h a.out\n 12K    a.out\n% cat x.hs\nmain :: IO ()\nmain = putStrLn \"Hello world\"\n% ghc -dynamic x.hs &amp;&amp; du -h x\n[1 of 1] Compiling Main             ( x.hs, x.o ) [flags changed]\nLinking x ...\n 16K    x\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 3707023, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/624412516/picture?type=large", "display_name": "Steven2163712", "link": "https://stackoverflow.com/users/3707023/steven2163712"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "closed_date": 1511879129, "accepted_answer_id": 47508548, "answer_count": 3, "score": 1, "last_activity_date": 1511801585, "creation_date": 1511772969, "question_id": 47507005, "link": "https://stackoverflow.com/questions/47507005/hello-world-in-haskell-is-1-3-mb", "closed_reason": "Needs more focus", "title": "Hello world in Haskell is 1.3 mb", "body": "<p>I'm very disappointed to discover that my Hello World executable in Haskell is 1.3 mb. This is really unacceptable to me. Am I doing something wrong? What excuse is there for having a hello world executable be so large? Is there a reasonable way to cut this down? The same thing in C is 8 kb.</p>\n\n<pre><code>main = print \"Hello, worlds\"\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "is_accepted": true, "score": 2, "last_activity_date": 1511740668, "creation_date": 1511740668, "answer_id": 47502308, "question_id": 47502136, "link": "https://stackoverflow.com/questions/47502136/flags-in-global-stack-config-yaml/47502308#47502308", "title": "Flags in global Stack config.yaml", "body": "<p>Found the answer\u2014just add this:</p>\n\n<pre><code>extra-include-dirs:\n  - /usr/include/\n</code></pre>\n\n<p>It would still be nice to be able to pass global flags to Stack.</p>\n"}], "owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 0, "accepted_answer_id": 47502308, "answer_count": 1, "score": 4, "last_activity_date": 1511740668, "creation_date": 1511738969, "question_id": 47502136, "link": "https://stackoverflow.com/questions/47502136/flags-in-global-stack-config-yaml", "title": "Flags in global Stack config.yaml", "body": "<p>I tried adding some flags to my global Stack <code>config.yaml</code>:</p>\n\n<pre><code>flags:\n  extra-include-dirs: /usr/include/\n</code></pre>\n\n<p>Alas it's not being recognised:</p>\n\n<pre><code>Warning: /Users/vilem/.stack/config.yaml: Unrecognized field in ConfigMonoid: flags\n</code></pre>\n\n<p>What am I doing wrong? The documentation doesn't seem to have an answer.</p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1511734570, "post_id": 47501561, "comment_id": 81958862, "body": "Hint: what would the type signature for <code>mapmultiple</code> be?"}, {"owner": {"reputation": 19, "user_id": 8928743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa2745ef220bc3e8306432886d271d42?s=128&d=identicon&r=PG&f=1", "display_name": "Dieter Brow", "link": "https://stackoverflow.com/users/8928743/dieter-brow"}, "reply_to_user": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1511735533, "post_id": 47501561, "comment_id": 81959100, "body": "@Koterpillar the type should be <code>mapmultiple :: [a -&gt; b] -&gt; a -&gt; [b]?</code>"}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1511735746, "post_id": 47501561, "comment_id": 81959165, "body": "Rather <code>[a -&gt; b] -&gt; [a] -&gt; [[b]]</code> since you want to map over an array of values."}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1511736014, "post_id": 47501561, "comment_id": 81959242, "body": "@DieterBrow yes, unless you want to apply multiple functions to multiple values, in which case see mschmidt&#39;s comment."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1511736275, "post_id": 47501561, "comment_id": 81959325, "body": "<code>mapmultiple = sequence</code>"}, {"owner": {"reputation": 19, "user_id": 8928743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa2745ef220bc3e8306432886d271d42?s=128&d=identicon&r=PG&f=1", "display_name": "Dieter Brow", "link": "https://stackoverflow.com/users/8928743/dieter-brow"}, "reply_to_user": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1511736316, "post_id": 47501561, "comment_id": 81959339, "body": "@Koterpillar but how can I arrange this?"}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1511736281, "creation_date": 1511736281, "answer_id": 47501800, "question_id": 47501561, "link": "https://stackoverflow.com/questions/47501561/multiple-functions-on-one-argument-with-map/47501800#47501800", "title": "multiple functions on one argument with map", "body": "<p>Here is an alternative with <code>sequence</code></p>\n\n<pre><code>&gt; mmap = map . sequence\n&gt; mmap [(^2), pred] [1..3]\n[[1,0],[4,1],[9,2]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1511741016, "post_id": 47501940, "comment_id": 81960422, "body": "It&#39;s not so much flipping the arguments as shifting the functor. With <code>f ~ []</code>, you are going from <code>(a -&gt; b) -&gt; f a -&gt; f b</code> to <code>f (a -&gt; b) -&gt; a -&gt; f b</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1511763737, "post_id": 47501940, "comment_id": 81965808, "body": "I&#39;ve never seen <code>($ x)</code> called a &quot;slice&quot;.  The term I know is &quot;section&quot;."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1511791305, "post_id": 47501940, "comment_id": 81981186, "body": "Hm... can&#39;t imagine where I got the term &quot;slice&quot; from, but you&#39;re right."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 5, "last_activity_date": 1511791325, "last_edit_date": 1511791325, "creation_date": 1511737301, "answer_id": 47501940, "question_id": 47501561, "link": "https://stackoverflow.com/questions/47501561/multiple-functions-on-one-argument-with-map/47501940#47501940", "title": "multiple functions on one argument with map", "body": "<p>This is just <code>map</code> with the arguments flipped.</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmapmultiple :: [a -&gt; b] -&gt; a -&gt; [b]\n</code></pre>\n\n<p>The \"function\" of <code>map</code> is going to be a higher-order function applying an argument.</p>\n\n<pre><code>mapmultiple fs x = map ($ x) fs\n</code></pre>\n\n<p>If you're not comfortable with the <code>$</code> section, this is equivalent<sup>[1]</sup> to</p>\n\n<pre><code>mapmultiple fs x = map (\\f -&gt; f x) fs\n</code></pre>\n\n<hr>\n\n<p><sup>[1]</sup> For a time, there was a GHC bug where sections would compile incorrectly to similar (but not quite equivalent) code. I'm uncertain as to whether it's been fixed. It shouldn't be relevant here, but I figure I should mention it.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1511741319, "last_edit_date": 1511741319, "creation_date": 1511740488, "answer_id": 47502288, "question_id": 47501561, "link": "https://stackoverflow.com/questions/47501561/multiple-functions-on-one-argument-with-map/47502288#47502288", "title": "multiple functions on one argument with map", "body": "<p>If you aren't committed to those exact arguments or order of arguments, two options are </p>\n\n<pre><code>&gt;&gt;&gt; [(^ 2), pred] &lt;*&gt; pure 4\n[16, 3]\n\n&gt;&gt;&gt; fmap ($ 4) [(^ 2), pred]\n[16, 3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 4, "last_activity_date": 1511780280, "creation_date": 1511780280, "answer_id": 47509299, "question_id": 47501561, "link": "https://stackoverflow.com/questions/47501561/multiple-functions-on-one-argument-with-map/47509299#47509299", "title": "multiple functions on one argument with map", "body": "<p>Consider a list comprehension:</p>\n\n<pre><code>map' fs x = [ f x | f &lt;- fs ]\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 8928743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa2745ef220bc3e8306432886d271d42?s=128&d=identicon&r=PG&f=1", "display_name": "Dieter Brow", "link": "https://stackoverflow.com/users/8928743/dieter-brow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1633, "favorite_count": 0, "accepted_answer_id": 47501940, "answer_count": 4, "score": 1, "last_activity_date": 1511791325, "creation_date": 1511734408, "last_edit_date": 1511735871, "question_id": 47501561, "link": "https://stackoverflow.com/questions/47501561/multiple-functions-on-one-argument-with-map", "title": "multiple functions on one argument with map", "body": "<p>Is it possible to code a simple map function which allows to have multiple functions on one argument?\nfor example <strong>mapmultiple [square, pred] 4 --> [16, 3]</strong></p>\n\n<pre><code>map1 :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap1 f [] = []\nmap1 f (x:xs) = foldr (\\y ys -&gt; (f y):ys) [] xs\n</code></pre>\n\n<p>map1 allows it with one function but how will it work out with two or three functions? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511723471, "post_id": 47499943, "comment_id": 81955334, "body": "Hint: what operation should you apply to <i>every</i> element. How do you <i>map</i> element from one list to another one?"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1511726182, "post_id": 47499943, "comment_id": 81956203, "body": "<code>map (join (++))</code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511731224, "post_id": 47499943, "comment_id": 81957949, "body": "<code>((&lt;&gt;) &lt;*&gt; id) &lt;$&gt;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1511723498, "creation_date": 1511723498, "answer_id": 47499971, "question_id": 47499943, "link": "https://stackoverflow.com/questions/47499943/how-to-replicate-and-merge-string-in-haskell/47499971#47499971", "title": "How to replicate and merge String in Haskell?", "body": "<p>Since <code>(\\x -&gt; x++x)</code> duplicates a single string, what you need is</p>\n\n<pre><code>map (\\x -&gt; x++x)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 8859289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/142d7faff567c7aa229890553cae1600?s=128&d=identicon&r=PG&f=1", "display_name": "AlonErebos", "link": "https://stackoverflow.com/users/8859289/alonerebos"}, "edited": false, "score": 0, "creation_date": 1511724439, "post_id": 47500048, "comment_id": 81955630, "body": "Thanks so much! just what I needed, been trying to figure out how to do it for days, the closest I ever got was rep n = concatMap (replicate n)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1511724495, "post_id": 47500048, "comment_id": 81955649, "body": "days? Join the #haskell IRC room and get some feedback sooner, it really helps when learning."}, {"owner": {"reputation": 15, "user_id": 8859289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/142d7faff567c7aa229890553cae1600?s=128&d=identicon&r=PG&f=1", "display_name": "AlonErebos", "link": "https://stackoverflow.com/users/8859289/alonerebos"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511724535, "post_id": 47500048, "comment_id": 81955663, "body": "ah yes, I&#39;m a bit of a noob, literally only started getting into it last week @ThomasM.DuBuisson"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 4, "last_activity_date": 1511723973, "creation_date": 1511723973, "answer_id": 47500048, "question_id": 47499943, "link": "https://stackoverflow.com/questions/47499943/how-to-replicate-and-merge-string-in-haskell/47500048#47500048", "title": "How to replicate and merge String in Haskell?", "body": "<p>If you want to use <code>replicate</code>, you'll need to <code>concat</code>enate all the strings in each inner list:</p>\n\n<pre><code>-- Create n copies of the string, then concatenate them\ndupStr :: Int -&gt; String -&gt; String\ndupStr n = concat . replicate n\n\n-- Same thing on each element of a list of strings\ndupStrs :: Int -&gt; [String] -&gt; [String]\ndupStrs n = map $ dupStr n\n\n-- Your function specifically\ndup2 :: [String] -&gt; [String]\ndup2 = dupStrs 2\n\ndupStr 3 \"a\" == \"aaa\"\ndupStrs 2 [\"t1\", \"t2\"] == [\"t1t1\", \"t2t2\"]\ndup2 [\"test1\", \"test2\"] == [\"test1test1\", \"test2test2\"]\n</code></pre>\n\n<p>This works for any number of repetitions.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1511726748, "last_edit_date": 1511726748, "creation_date": 1511725012, "answer_id": 47500196, "question_id": 47499943, "link": "https://stackoverflow.com/questions/47499943/how-to-replicate-and-merge-string-in-haskell/47500196#47500196", "title": "How to replicate and merge String in Haskell?", "body": "<p>You can do this visually, without thinking verbally about it:</p>\n\n<pre><code>g :: [[t]] -&gt; [[t]]\ng xs = [ [c | y &lt;- [x,x], c &lt;- y]  | x &lt;- xs ]\n</code></pre>\n\n<p>Now that we have it working, we can recognize that it is equivalent to</p>\n\n<pre><code>     = [  concat   [x,x]           | x &lt;- xs ]\n     = [  concat  (replicate 2  x) | x &lt;- xs ]\n     = [ (concat . replicate 2) x  | x &lt;- xs ]\n     = map (concat . replicate 2)         xs\n</code></pre>\n\n<p>which is plenty verbal now. Whatever style is easier for you.</p>\n\n<p><code>(f . g) x = f (g x)</code> is <em>function composition</em>, piping the output of a function on the right into the function on its left, as input. Some like it <em>point-free</em> style,</p>\n\n<pre><code>g :: [[t]] -&gt; [[t]]\ng = map (concat . replicate 2)\n</code></pre>\n\n<p>(\"point\" refers to <code>xs</code> in the definition of <code>g xs = ...</code>; a definition without arguments is known as being in point-free style).</p>\n\n<p>Well, actually, <code>concat [x,x]</code> is just <code>x ++ x = (++) x x = join (++) x</code> and so we could even write</p>\n\n<pre><code>  = map (join (++))\n</code></pre>\n\n<p>but this style takes getting used to. It is also no good if we want to concatenate three, or even more copies of  string, which is very easy to arrange for with the above style, even defining a new function, </p>\n\n<pre><code>g :: Int -&gt; [[t]] -&gt; [[t]]\ng n = map (concat . replicate n)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1511781263, "post_id": 47501509, "comment_id": 81974899, "body": "there really is no need for <code>zip</code>. referencing the same variable twice is quite all right."}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1511784018, "post_id": 47501509, "comment_id": 81976578, "body": "@WillNess yep, I totally agree with you on that. Thanks for pointing that out."}], "tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 1, "last_activity_date": 1511783981, "last_edit_date": 1511783981, "creation_date": 1511733972, "answer_id": 47501509, "question_id": 47499943, "link": "https://stackoverflow.com/questions/47499943/how-to-replicate-and-merge-string-in-haskell/47501509#47501509", "title": "How to replicate and merge String in Haskell?", "body": "<p>A simple list comprehension works here:</p>\n\n<pre><code>map_twice xs = [x ++ x | x &lt;- xs]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1511781498, "post_id": 47501514, "comment_id": 81975054, "body": "or even <code>join (zipWith (++))</code>. :)"}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1511734008, "creation_date": 1511734008, "answer_id": 47501514, "question_id": 47499943, "link": "https://stackoverflow.com/questions/47499943/how-to-replicate-and-merge-string-in-haskell/47501514#47501514", "title": "How to replicate and merge String in Haskell?", "body": "<p>For some fanciness with applicative style you may also do as;</p>\n\n<pre><code>g :: [String] -&gt; [String]\ng = zipWith (++) &lt;$&gt; id &lt;*&gt; id\n\nPrelude&gt; g [\"test1\",\"test2\"]\n[\"test1test1\",\"test2test2\"]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 8859289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/142d7faff567c7aa229890553cae1600?s=128&d=identicon&r=PG&f=1", "display_name": "AlonErebos", "link": "https://stackoverflow.com/users/8859289/alonerebos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 47499971, "answer_count": 5, "score": -2, "last_activity_date": 1511783981, "creation_date": 1511723290, "last_edit_date": 1511724074, "question_id": 47499943, "link": "https://stackoverflow.com/questions/47499943/how-to-replicate-and-merge-string-in-haskell", "title": "How to replicate and merge String in Haskell?", "body": "<p>I'm trying to implement a function where you input a list of Strings i.e. </p>\n\n<pre><code>[\"test1\",\"test2\"]\n</code></pre>\n\n<p>and it will return a replication of the list which will turn it into</p>\n\n<pre><code>[\"test1test1\",\"test2test2\"]\n</code></pre>\n\n<p>I have tried to implement it using replicate, but that turns it into </p>\n\n<pre><code>[[\"test1\",\"test2\"],[\"test1\",\"test2\"]]. \n</code></pre>\n"}, {"tags": ["function", "haskell", "maybe"], "answers": [{"comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1511717710, "post_id": 47498953, "comment_id": 81953254, "body": "Perhaps it&#39;s worth mentioning that <code>mapMaybe</code> already exists and is called <code>fmap</code>, and <code>mapMaybes</code> can be obtained by composing list-targeted <code>fmap</code> with the maybe-targeted <code>fmap</code>, i.e. <code>mapMaybes = fmap . fmap</code>. Mind = blown. :-)"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 13, "last_activity_date": 1511732500, "last_edit_date": 1511732500, "creation_date": 1511717222, "answer_id": 47498953, "question_id": 47498896, "link": "https://stackoverflow.com/questions/47498896/apply-function-on-maybe-types/47498953#47498953", "title": "apply function on Maybe types?", "body": "<p>Let's start by defining how to act on a single <code>Maybe</code>, and then we'll scale it up to a whole list.</p>\n\n<pre><code>mapMaybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nmapMaybe f Nothing = Nothing\nmapMaybe f (Just x) = Just (f x)\n</code></pre>\n\n<p>If the <code>Maybe</code> contains a value, <code>mapMaybe</code> applies <code>f</code> to it, and if it doesn't contain a value then we just return an empty <code>Maybe</code>.</p>\n\n<p>But we have a <em>list</em> of <code>Maybe</code>s, so we need to apply <code>mapMaybe</code> to each of them.</p>\n\n<pre><code>mapMaybes :: (a -&gt; b) -&gt; [Maybe a] -&gt; [Maybe b]\nmapMaybes f ms = [mapMaybe f m | m &lt;- ms]\n</code></pre>\n\n<p>Here I'm using a list comprehension to evaluate <code>mapMaybe f m</code> for each <code>m</code> in <code>ms</code>.</p>\n\n<hr>\n\n<p>Now for a more advanced technique. The pattern of applying a function to every value in a container is captured by the <code>Functor</code> type class.</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>A type <code>f</code> is a <code>Functor</code> if you can write a function which takes a function from <code>a</code> to <code>b</code>, and applies that function to an <code>f</code> full of <code>a</code>s to get an <code>f</code> full of <code>b</code>s. For example, <code>[]</code> and <code>Maybe</code> are both <code>Functor</code>s:</p>\n\n<pre><code>instance Functor Maybe where\n    fmap f Nothing = Nothing\n    fmap f (Just x) = Just (f x)\n\ninstance Functor [] where\n    fmap f xs = [f x | x &lt;- xs]\n</code></pre>\n\n<p><code>Maybe</code>'s version of <code>fmap</code> is the same as the <code>mapMaybe</code> I wrote above, and <code>[]</code>'s implementation uses a list comprehension to apply <code>f</code> to every element in the list.</p>\n\n<p>Now, to write <code>mapMaybes :: (a -&gt; b) -&gt; [Maybe a] -&gt; [Maybe b]</code>, you need to operate on each item in the list using <code>[]</code>'s version of <code>fmap</code>, and then operate on the individual <code>Maybe</code>s using <code>Maybe</code>'s version of <code>fmap</code>.</p>\n\n<pre><code>mapMaybes :: (a -&gt; b) -&gt; [Maybe a] -&gt; [Maybe b]\nmapMaybes f ms = fmap (fmap f) ms\n-- or:\nmapMaybes = fmap . fmap\n</code></pre>\n\n<p>Note that we're actually calling two different <code>fmap</code> implementations here. The outer one is <code>fmap :: (Maybe a -&gt; Maybe b) -&gt; [Maybe a] -&gt; [Maybe b]</code>, which dispatches to <code>[]</code>'s <code>Functor</code> instance. The inner one is <code>(a -&gt; b) -&gt; Maybe a -&gt; Maybe b</code>.</p>\n\n<hr>\n\n<p>One more addendum - though this is quite esoteric, so don't worry if you don't understand everything here. I just want to give you a taste of something I think is pretty cool.</p>\n\n<p>This \"chain of <code>fmap</code>s\" style (<code>fmap . fmap . fmap ...</code>) is quite a common trick for drilling down through multiple layers of a structure. Each <code>fmap</code> has a type of <code>(a -&gt; b) -&gt; (f a -&gt; f b)</code>, so when you compose them with <code>(.)</code> you're building a higher-order function.</p>\n\n<pre><code>fmap        :: Functor g              =&gt;             (f a -&gt; f b) -&gt; (g (f a) -&gt; g (f b))\nfmap        :: Functor f              =&gt; (a -&gt; b) -&gt; (f a -&gt; f b)\n-- so...\nfmap . fmap :: (Functor f, Functor g) =&gt; (a -&gt; b)          -&gt;         g (f a) -&gt; g (f b)\n</code></pre>\n\n<p>So if you have a functor of functors (of functors...), then <em>n</em> <code>fmap</code>s will let you map the elements at level <em>n</em> of the structure. Conal Elliot calls this style <a href=\"http://conal.net/blog/posts/semantic-editor-combinators\" rel=\"noreferrer\">\"semantic editor combinators\"</a>.</p>\n\n<p>The trick also works with <code>traverse :: (Traversable t, Applicative f) =&gt; (a -&gt; f b) -&gt; (t a -&gt; f (t b))</code>, which is a kind of \"effectful <code>fmap</code>\".</p>\n\n<pre><code>traverse            :: (...) =&gt;               (t a -&gt; f (t b)) -&gt; (s (t a) -&gt; f (s (t b)))\ntraverse            :: (...) =&gt; (a -&gt; f b) -&gt; (t a -&gt; f (t b))\n-- so...\ntraverse . traverse :: (...) =&gt; (a -&gt; f b)            -&gt;           s (t a) -&gt; f (s (t b))\n</code></pre>\n\n<p>(I omitted the bits before the <code>=&gt;</code> because I ran out of horizontal space.) So if you have a traversable of traversables (of traversables...), you can perform an effectful computation on the elements at level <em>n</em> just by writing <code>traverse</code> <em>n</em> times. Composing traversals like this is the basic idea behind the <code>lens</code> library.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1511717791, "creation_date": 1511717791, "answer_id": 47499059, "question_id": 47498896, "link": "https://stackoverflow.com/questions/47498896/apply-function-on-maybe-types/47499059#47499059", "title": "apply function on Maybe types?", "body": "<p>You're likely already aware of</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>...which is really just a special case of</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>The latter works both on lists (where it behaves exactly like <code>map</code>) and on <code>Maybe</code>, because both are functors. I.e., both of the following signatures are valid specialisations:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\nfmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n</code></pre>\n\n<p>Now, your use case looks similar, but unfortunately <code>[Maybe a]</code> is not by itself a specialisation of <code>f a</code>, rather it has the form <code>f (g a)</code>. But note that we can just substitute the variable <code>\u03b1</code> for <code>g a</code>, i.e. for <code>Maybe a</code>, then we can use</p>\n\n<pre><code>fmap :: (\u03b1 -&gt; \u03b2) -&gt; [\u03b1] -&gt; [\u03b2]\n</code></pre>\n\n<p>i.e.</p>\n\n<pre><code>fmap :: (Maybe a -&gt; Maybe b) -&gt; [Maybe a] -&gt; [Maybe b]\n</code></pre>\n\n<p>That looks even more like the signature you want! However we still need a function with signature <code>Maybe a -&gt; Maybe b</code>. Well, look above... I repeat:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n</code></pre>\n\n<p>This can be <em>partially applied</em>, i.e. when you have a function <code>\u03c6 :: a -&gt; b</code>, you can easily obtain the function <code>fmap \u03c6 :: Maybe a -&gt; Maybe b</code>. And that solves your problem:</p>\n\n<pre><code>maybeX :: (a -&gt; b) -&gt; [Maybe a] -&gt; [Maybe b]\nmaybeX \u03c6 = fmap (fmap \u03c6)\n</code></pre>\n\n<p>...or, if you want to get extra fancy,</p>\n\n<pre><code>maybeX = fmap . fmap\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1511722743, "last_edit_date": 1511722743, "creation_date": 1511719263, "answer_id": 47499287, "question_id": 47498896, "link": "https://stackoverflow.com/questions/47498896/apply-function-on-maybe-types/47499287#47499287", "title": "apply function on Maybe types?", "body": "<p>[Note: this assumes familiarity with functors.]</p>\n\n<p>Another approach is to use type-level composition as defined in <code>Data.Functor.Compose</code>.</p>\n\n<pre><code>&gt;&gt;&gt; getCompose (fmap (+5) (Compose [Just 1, Just 2, Nothing, Just 3]))\n[Just 6,Just 7,Nothing,Just 8]\n</code></pre>\n\n<p>You can abstract this into a defintion for your <code>maybeX</code>:</p>\n\n<pre><code>-- Wrap, map, and unwrap\nmaybeX :: (a -&gt; b) -&gt; [Maybe a] -&gt; [Maybe b]\nmaybeX f = getCompose . fmap f . Compose\n</code></pre>\n\n<p>(In fact, nothing in the definition assumes <code>Maybe</code> or <code>[]</code>, just the restricted type annotation. If you enable the <code>FlexibleContexts</code> extension, you can infer the type <code>(Functor g, Functor f) =&gt; (a1 -&gt; a) -&gt; f (g a1) -&gt; f (g a)</code> and use it on arbitrary nested functors.</p>\n\n<pre><code> &gt;&gt;&gt; maybeX (+1) (Just [1,2])\n Just [2,3]\n &gt;&gt;&gt; maybeX (+1) [[1,2]]\n [[2,3]]\n &gt;&gt;&gt; maybeX (+1) Nothing -- type (Num a, Functor g) =&gt; Maybe (g a), since `Nothing :: Maybe a`\n</code></pre>\n\n<p>)</p>\n\n<hr>\n\n<p>The <code>Compose</code> constructor composes the <code>[]</code> and <code>Maybe</code> type constructors into a new type constructor:</p>\n\n<pre><code>&gt;&gt;&gt; :k Compose\nCompose :: (k1 -&gt; *) -&gt; (k -&gt; k1) -&gt; k -&gt; *\n</code></pre>\n\n<p>Compare:</p>\n\n<pre><code>Compose :: (k1 -&gt; *) -&gt; (k -&gt; k1) -&gt; k -&gt; *\n  (.)   :: (b  -&gt; c) -&gt; (a -&gt; b)  -&gt; a -&gt; c\n</code></pre>\n\n<p>(The main difference is that <code>(.)</code> can compose any two functions; it appears that <code>Compose</code> and its associated instances require the last higher-kinded value to be applied to a concrete type, one of kind <code>*</code>.)</p>\n\n<p>Applying the data constructor <code>Compose</code> to a list-of-Maybes produces a wrapped value</p>\n\n<pre><code>&gt;&gt;&gt; :t Compose [Nothing]\nCompose [Nothing] :: Compose [] Maybe a\n</code></pre>\n\n<p>As long as the arguments to <code>Compose</code> are themselves instances of <code>Functor</code> (as <code>[]</code> and <code>Maybe</code> are), <code>Compose f g</code> is <em>also</em> a functor, so you can use <code>fmap</code>:</p>\n\n<pre><code>&gt;&gt;&gt; fmap (+5) (Compose [Just 1,Nothing,Just 2,Just 3])\nCompose [Just 6,Nothing,Just 7,Just 8]\n</code></pre>\n\n<p>The <code>Compose</code> value is just a wrapper around the original value:</p>\n\n<pre><code>&gt;&gt;&gt; getCompose $ fmap (+5) (Compose [Just 1,Nothing,Just 2,Just 3])\n[Just 6,Nothing,Just 7,Just 8]\n</code></pre>\n\n<hr>\n\n<p>In the end, this isn't much different than simply composing <code>fmap</code> directly:</p>\n\n<pre><code>instance (Functor f, Functor g) =&gt; Functor (Compose f g) where\n    fmap f (Compose x) = Compose (fmap (fmap f) x)\n</code></pre>\n\n<p>The difference is that you can define the <em>type</em> with a function and get its accompanying <code>Functor</code> instance for free, instead of having to hand-code both.</p>\n"}], "owner": {"reputation": 91, "user_id": 8926103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f5d7fe3f5b115d13199513ffa0a8c96?s=128&d=identicon&r=PG&f=1", "display_name": "SomaXD", "link": "https://stackoverflow.com/users/8926103/somaxd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1587, "favorite_count": 0, "answer_count": 3, "score": 6, "last_activity_date": 1511738041, "creation_date": 1511716857, "last_edit_date": 1511738041, "question_id": 47498896, "link": "https://stackoverflow.com/questions/47498896/apply-function-on-maybe-types", "title": "apply function on Maybe types?", "body": "<p>New to Haskell and I can't figure out how apply a function (a -> b) into a list [Maybe a] and get [Maybe b]</p>\n\n<pre><code>maybeX:: (a -&gt; b) -&gt; [Maybe a] -&gt; [Maybe b]\n</code></pre>\n\n<p>The function is supposed to do the exact same thing as map, apply the function f on a list of Maybe statements and if it Just it returns me a f Just and if it's a Nothing just a Nothing.\nLike the following example I want to add +5 on every Element of the following List :</p>\n\n<pre><code>[Just 1,Just 2,Nothing,Just 3]\n</code></pre>\n\n<p>and get</p>\n\n<pre><code>[Just 6,Just 7,Nothing,Just 8]\n</code></pre>\n\n<p>Really trying to figure this and I tried a lot but it always seems like it is something that I'm not aware of in the way of which this Maybe datatype works..\nThanks for your help! </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511712926, "post_id": 47498102, "comment_id": 81951655, "body": "Change the type of <code>generateOp</code> to <code>(Float -&gt; Float -&gt; Float) -&gt; (Maybe Float) -&gt; (Maybe Float) -&gt; Maybe Float</code>, and the definition can be simplified to <code>generateOp = liftA2</code> (where <code>liftA2</code> is defined in <code>Control.Applicative</code>. Fancy type classes aside, changing the type also reflects normal prefix order, where the operator comes before the arguments."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511713110, "post_id": 47498102, "comment_id": 81951727, "body": "Also, <code>findVar</code> is just reimplementing the built-in <code>lookup</code> function."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511716249, "post_id": 47498102, "comment_id": 81952757, "body": "I think you meant <code>type Store = Map.Map Identifier Value</code> as well. <code>data Store = Map Identifier Value</code> just defines a type that wraps a pair of values with a constructor named <code>Map</code>, unrelated to the <code>Map</code> type constructor."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1511712722, "last_edit_date": 1511712722, "creation_date": 1511712634, "answer_id": 47498190, "question_id": 47498102, "link": "https://stackoverflow.com/questions/47498102/haskell-probleme-with-data-map-as-map/47498190#47498190", "title": "Haskell probleme with Data.Map as Map", "body": "<p>A list of tuples is not a <code>Map</code>; you need to use <code>fromList</code> to create an actual map object.</p>\n\n<pre><code>store = Map.fromList [(\"x\", 1), (\"y\", 2)]\n</code></pre>\n\n<p>Providing explicit type annotations would catch this type of error sooner, as the following wouldn't typecheck:</p>\n\n<pre><code>store :: Store\nstore = [(\"x\", 1), (\"y\", 2)]\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 9010920, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-MhFv85DhPB0/AAAAAAAAAAI/AAAAAAAABCk/dKYJ8RGOXI8/photo.jpg?sz=128", "display_name": "ABDOULFATAH Farah", "link": "https://stackoverflow.com/users/9010920/abdoulfatah-farah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1511712722, "creation_date": 1511712189, "last_edit_date": 1511712503, "question_id": 47498102, "link": "https://stackoverflow.com/questions/47498102/haskell-probleme-with-data-map-as-map", "title": "Haskell probleme with Data.Map as Map", "body": "<pre><code>import qualified Data.Map as Map \n\ntype Identifier = String\n\ntype Value = Float\n\ndata Store = Map Identifier Value\n\nstore = [(\"x\", 1), (\"y\", 2)]\n\n-- find in the store\n\nfindVar :: (Eq v) =&gt; v -&gt;[(v,val)] -&gt; Maybe val\n\nfindVar var [] = Nothing\n\nfindVar var ((v,val):xs) = if var == v then Just val else findVar var xs\n\n\ndata Expression =\n\n    Literal Float\n\n  | Addition Expression Expression \n\n  | Minus Expression Expression\n\n  | Multiplication Expression Expression\n\n  | Div Expression Expression\n\n  | Expo Expression Expression\n\n  | Neg  Expression \n\n  | Variable Identifier deriving Show\n\n\n\ngenerateOp :: Maybe Float -&gt; Maybe Float -&gt; (Float -&gt; Float -&gt; Float) -&gt; Maybe Float\ngenerateOp Nothing _ _ = Nothing\n\ngenerateOp _ Nothing _ = Nothing\n\ngenerateOp ( Just expr1) (Just expr2) op = Just (op expr1 expr2)\n\n\n\neval ::  Store -&gt; Expression -&gt; Maybe Value \n\neval store (Literal l) = Just (l)\n\neval store (Addition expr1 expr2) = generateOp (eval store expr1) (eval store expr2) (+)\n</code></pre>\n\n<p>hi i'm beginer in haskell i want your help in my studie project\nwhen i execute that commande i have a probleme . i have no idea why !! </p>\n\n<pre><code>*Main&gt; eval store ( Literal 5 )\n\n\n&lt;interactive&gt;:107:6:\n\n    Couldn't match expected type \u2018Store\u2019\n\n                with actual type \u2018[([Char], Integer)]\u2019\n\n    In the first argument of \u2018eval\u2019, namely \u2018store\u2019\n\n    In the expression: eval store (Literal 5)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1511705851, "post_id": 47497076, "comment_id": 81949402, "body": "Well how would you divide a list by two? Furthermore the question does not makes much sense. Why should you divide the element by two to calculate the average? Here you create a list with one element, which is weird since using the item itself is easier."}, {"owner": {"reputation": 3, "user_id": 8016827, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LdcU8aaDF3U/AAAAAAAAAAI/AAAAAAAAAdk/vP4B4tLdg74/photo.jpg?sz=128", "display_name": "Ridi", "link": "https://stackoverflow.com/users/8016827/ridi"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511706135, "post_id": 47497076, "comment_id": 81949481, "body": "ok, that makes i cant divide list  just by a element. then maybe a second map function which divides the result of the first by 2?.. Edit: mittelWert (n,m) = map (/2) (map (+n) [m]) works!! ty :D"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1511706247, "post_id": 47497076, "comment_id": 81949517, "body": "you can also alter the first map. But right now it does not makes (any) sense to use a list to start with. If you want to calculate the average of two numbers <code>n</code> and <code>m</code>, you can define it as <code>(m+n)&#47;2</code> (or <code>div (m+n) 2</code> for integers)."}, {"owner": {"reputation": 3, "user_id": 8016827, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LdcU8aaDF3U/AAAAAAAAAAI/AAAAAAAAAdk/vP4B4tLdg74/photo.jpg?sz=128", "display_name": "Ridi", "link": "https://stackoverflow.com/users/8016827/ridi"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511706315, "post_id": 47497076, "comment_id": 81949536, "body": "i know, but the the task is asked like this, im supposed to use map to get the average :P"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1511707173, "post_id": 47497076, "comment_id": 81949788, "body": "the average of a list is a number, but the result of a map - any map - is a list."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1511717036, "post_id": 47497076, "comment_id": 81953014, "body": "I strongly encourage you to check with your teacher (or a TA) to make sure that you have understood the exercise. This is not a sensible way to write code, and I do not believe that your teacher is intending to set an exercise whose only solution is not sensible."}], "answers": [{"comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1511715101, "post_id": 47497181, "comment_id": 81952342, "body": "I guess you try to do <code>\\n m -&gt; sum . map (&#47;2) $ n:[m]</code>"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1511723457, "post_id": 47497181, "comment_id": 81955327, "body": "what are you doing? how this is different from <code>(m+n) `div` 2</code>?"}], "tags": [], "owner": {"reputation": 3, "user_id": 8016827, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LdcU8aaDF3U/AAAAAAAAAAI/AAAAAAAAAdk/vP4B4tLdg74/photo.jpg?sz=128", "display_name": "Ridi", "link": "https://stackoverflow.com/users/8016827/ridi"}, "is_accepted": false, "score": 0, "last_activity_date": 1511706401, "creation_date": 1511706401, "answer_id": 47497181, "question_id": 47497076, "link": "https://stackoverflow.com/questions/47497076/haskell-create-list-with-map-and-apply-division/47497181#47497181", "title": "Haskell create list with map and apply division", "body": "<pre><code>mittelWert (n,m) = map (/2) (map (+n) [m])\n</code></pre>\n\n<p>two map functions did the job. <strong>one gets the sum into a list</strong> and then divides the list by a <strong>second map function by 2</strong></p>\n"}], "owner": {"reputation": 3, "user_id": 8016827, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LdcU8aaDF3U/AAAAAAAAAAI/AAAAAAAAAdk/vP4B4tLdg74/photo.jpg?sz=128", "display_name": "Ridi", "link": "https://stackoverflow.com/users/8016827/ridi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 735, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1511766110, "creation_date": 1511705772, "last_edit_date": 1511766110, "question_id": 47497076, "link": "https://stackoverflow.com/questions/47497076/haskell-create-list-with-map-and-apply-division", "title": "Haskell create list with map and apply division", "body": "<p>I'm supposed to use the <strong>map</strong> function to create a list and <strong>divide it by 2</strong> to calculate the average, but I'm stuck at the division part.</p>\n\n<pre><code>mittelWert (n,m) = map (+n) [m]\n</code></pre>\n\n<p>This gives me my list, but i cant divide it by 2 now...</p>\n\n<p>I tried this:</p>\n\n<pre><code>mittelWert (n,m) = map (+n) [m] / 2\n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>mittelWert (n,m) = map (+n) [m] `div` 2\n</code></pre>\n\n<p>ty.</p>\n\n<p>error: <code>* Non type-variable argument in the constraint: Fractional [b]\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type</code></p>\n"}, {"tags": ["haskell", "fold"], "answers": [{"comments": [{"owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 1, "creation_date": 1511698872, "post_id": 47496060, "comment_id": 81947240, "body": "According to <a href=\"https://gist.github.com/CMCDragonkai/9f5f75118dda10131764\" rel=\"nofollow noreferrer\">the diagrams in this link</a> the most inner operation always involves <code>acc</code> as a left/right operator respectively, so I think this might be mistaken."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 0, "creation_date": 1511699219, "post_id": 47496060, "comment_id": 81947341, "body": "@Jsevillamol Thanks. I was too fast to remove the neutral element requirement. Restored."}, {"owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 0, "creation_date": 1511699967, "post_id": 47496060, "comment_id": 81947566, "body": "Regarding the case where <code>l</code> is infinitve: if we take` op` which is strict on its second argument to be for example the list constructor <code>:</code> then the result is an infinite list that you can still use lazily. So I think that this argument is not sensitive to different kinds of $\\bottom$ values, if that makes sense."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 1, "creation_date": 1511700387, "post_id": 47496060, "comment_id": 81947717, "body": "@Jsevillamol Note that the list constructor <code>:</code> is <i>not</i> strict in Haskell, in both arguments. E.g. <code>seq (undefined : undefined) ()</code> will happily terminate. Infinite lists are also not considered bottom values."}, {"owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 0, "creation_date": 1511700987, "post_id": 47496060, "comment_id": 81947881, "body": "Can you specify exactly what do you mean by &#39;diverges&#39;? Is it possible to use <code>foldl</code> to create an infinite value different from bottom?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 2, "creation_date": 1511702230, "post_id": 47496060, "comment_id": 81948244, "body": "@Jsevillamol For instance, <code>foldr (+) 0 [1..]</code> is bottom. Instead, <code>foldr (:) [] [1..]</code> is <code>[1..]</code> which is not bottom. (Above, with &quot;diverges&quot; I mean the result is bottom). With <code>foldl </code> you always get a bottom value with an infinite list. You can only get an infinite value in trivial cases e.g. <code>foldr op [1..] []</code>, or when <code>op</code> itself produces (after finitely many applications) an infinite value."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1511725920, "post_id": 47496060, "comment_id": 81956112, "body": "@chi note: I think you mean <code>foldl op [1..] []</code> above (took me a second)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1511730094, "post_id": 47496060, "comment_id": 81957576, "body": "@luqui Indeed, in my comment I meant <code>foldl</code> as you point out."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1511702027, "last_edit_date": 1511702027, "creation_date": 1511698571, "answer_id": 47496060, "question_id": 47495835, "link": "https://stackoverflow.com/questions/47495835/sufficient-conditions-for-foldl-and-foldr-equivalence/47496060#47496060", "title": "Sufficient conditions for foldl and foldr equivalence", "body": "<p>If <code>op</code> is an associative operation, <code>acc</code> is a neutral element of <code>op</code>, and <code>l</code> is finite, then they are equivalent.</p>\n\n<p>Indeed, the result of <code>foldr</code> is</p>\n\n<pre><code>(l1 `op` (l2 `op` ... (ln `op` acc)))\n</code></pre>\n\n<p>while that of <code>foldl</code> is</p>\n\n<pre><code>(((acc `op` l1) `op` l2) `op` ... ln)\n</code></pre>\n\n<p>To prove that they are equal, it suffices to simplify <code>acc</code> away, and reassociate.</p>\n\n<hr>\n\n<p>Even if <code>acc</code> is not a neutral element, but <code>acc</code> still satisfies the weaker condition</p>\n\n<pre><code>forall x,  acc `op` x = x `op` acc\n</code></pre>\n\n<p>then, if <code>op</code> is associative and <code>l</code> is finite, we again get the desired equivalence.</p>\n\n<p>To prove this, we can exploit the fact that <code>acc</code> commutes with everything, and \"move\" it from the tail position to the head one, exploiting associativity. E.g.</p>\n\n<pre><code>(l1 `op` (l2 `op` acc))\n=\n(l1 `op` (acc `op` l2))\n=\n((l1 `op` acc) `op` l2)\n=\n((acc `op` l1) `op` l2)\n</code></pre>\n\n<p>In the question it is mentioned the sufficient condition <code>op = const k</code> which is associative but has no neutral element. Still, any <code>acc</code> commutes with everything, so the \"constant <code>op</code>\" case is a subcase of the above sufficient condition.</p>\n\n<hr>\n\n<p>Assuming <code>op</code> has a neutral element <code>acc</code>, if we assume</p>\n\n<pre><code>foldr op acc [a,b,c] = foldl op acc [a,b,c]      -- (*)\n</code></pre>\n\n<p>we derive</p>\n\n<pre><code>a `op` (b `op` c) = (a `op` b) `op` c\n</code></pre>\n\n<p>Hence, If <code>(*)</code> holds for all <code>a,b,c</code>, then <code>op</code> has to be associative. Associativity is then necessary and sufficient (when a neutral element exists).</p>\n\n<hr>\n\n<p>If <code>l</code> is infinite, <code>foldl</code> always diverges no matter what <code>op,acc</code> are. If <code>op</code> is strict on its second argument, <code>foldr</code> also diverges (i.e., it returns bottom).</p>\n"}], "owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 0, "accepted_answer_id": 47496060, "answer_count": 1, "score": 7, "last_activity_date": 1511702027, "creation_date": 1511697089, "question_id": 47495835, "link": "https://stackoverflow.com/questions/47495835/sufficient-conditions-for-foldl-and-foldr-equivalence", "title": "Sufficient conditions for foldl and foldr equivalence", "body": "<p>Consider the expressions <code>E1 = foldl op acc l</code> and <code>E2 = foldr op acc l</code>.</p>\n\n<p>What are some natural sufficient conditions for <code>op</code>, <code>acc</code> and/or <code>l</code> that guarantee the equivalence of <code>E1</code>and <code>E2</code>?</p>\n\n<p>A naive example would be that if <code>op</code>is constant then both are equivalent. </p>\n\n<p>I'm pretty sure there must be precise conditions involving commutativity and/or associativity of <code>op</code>, and/or finitude of <code>l</code>, and/or neutrality of <code>acc</code>.</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "is_accepted": true, "score": 3, "last_activity_date": 1511695414, "creation_date": 1511695414, "answer_id": 47495573, "question_id": 47495139, "link": "https://stackoverflow.com/questions/47495139/a-comand-to-remove-a-handler-in-yesod/47495573#47495573", "title": "A comand to remove a handler in Yesod", "body": "<p>There is no command to remove a handler, since it would be quite a destructive and risky thing to do, and since removing a handler is quite simple, just</p>\n\n<ul>\n<li><p>remove it from the .cabal file,</p></li>\n<li><p>remove it from the Application.hs file and</p></li>\n<li><p>delete the actual handler file</p></li>\n</ul>\n\n<p>And you should be good to go :) You can read what <code>add-handler</code> does <a href=\"https://www.yesodweb.com/book/scaffolding-and-the-site-template#scaffolding-and-the-site-template_handler_modules\" rel=\"nofollow noreferrer\">in the Yesod book</a>.</p>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 47495573, "answer_count": 1, "score": 1, "last_activity_date": 1511695414, "creation_date": 1511692223, "question_id": 47495139, "link": "https://stackoverflow.com/questions/47495139/a-comand-to-remove-a-handler-in-yesod", "title": "A comand to remove a handler in Yesod", "body": "<p>I added a handler using this command:</p>\n\n<pre><code>stack exec -- yesod add-handler\n</code></pre>\n\n<p>But now I want to remove it.\nIs there a command line to remove a handler in Yesod?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1511697839, "post_id": 47494993, "comment_id": 81946919, "body": "Have you tried using <code>subsequences</code> from <code>Data.List</code>? You could get all the subsequences with that, and only keep the sorted ones. Then get the maximum length subsequence from that."}], "answers": [{"comments": [{"owner": {"reputation": 39390, "user_id": 21755, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8d1dc85bd2d8ed3a2074b9728fbdaa55?s=128&d=identicon&r=PG", "display_name": "The Archetypal Paul", "link": "https://stackoverflow.com/users/21755/the-archetypal-paul"}, "edited": false, "score": 0, "creation_date": 1511698931, "post_id": 47496077, "comment_id": 81947258, "body": "This is straightforward (so, good) but also not as effcient as it might be. The potential longest-shorted sequences are disjoint, so you can pass through the list splitting at pairs where the second of the pair is less than the first, then pick the longest of those?"}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "reply_to_user": {"reputation": 39390, "user_id": 21755, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8d1dc85bd2d8ed3a2074b9728fbdaa55?s=128&d=identicon&r=PG", "display_name": "The Archetypal Paul", "link": "https://stackoverflow.com/users/21755/the-archetypal-paul"}, "edited": false, "score": 0, "creation_date": 1511699706, "post_id": 47496077, "comment_id": 81947477, "body": "@TheArchetypalPaul Thanks for the feedback, I see what you mean here. This is a pretty naive approach, but simple enough for the OP to understand. It&#39;s getting pretty late over here, and I probably wont be able to make this solution more efficient any time soon. But please feel free to extend, or come up with a better solution."}, {"owner": {"reputation": 39390, "user_id": 21755, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8d1dc85bd2d8ed3a2074b9728fbdaa55?s=128&d=identicon&r=PG", "display_name": "The Archetypal Paul", "link": "https://stackoverflow.com/users/21755/the-archetypal-paul"}, "edited": false, "score": 0, "creation_date": 1511699989, "post_id": 47496077, "comment_id": 81947575, "body": "Thanks. Unfortunately, my Haskell is pretty poor :( so not sure I can do that.  I could do it in Scala :)"}, {"owner": {"reputation": 39390, "user_id": 21755, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8d1dc85bd2d8ed3a2074b9728fbdaa55?s=128&d=identicon&r=PG", "display_name": "The Archetypal Paul", "link": "https://stackoverflow.com/users/21755/the-archetypal-paul"}, "edited": false, "score": 0, "creation_date": 1511700444, "post_id": 47496077, "comment_id": 81947731, "body": "Ah, ignore me, i misread the question. I thought it was consecutive subsequences"}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "reply_to_user": {"reputation": 39390, "user_id": 21755, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8d1dc85bd2d8ed3a2074b9728fbdaa55?s=128&d=identicon&r=PG", "display_name": "The Archetypal Paul", "link": "https://stackoverflow.com/users/21755/the-archetypal-paul"}, "edited": false, "score": 0, "creation_date": 1511701143, "post_id": 47496077, "comment_id": 81947938, "body": "Ah yes, bit of ambiguity in the question, I thought that also at first."}], "tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": true, "score": 3, "last_activity_date": 1511699035, "last_edit_date": 1511699035, "creation_date": 1511698652, "answer_id": 47496077, "question_id": 47494993, "link": "https://stackoverflow.com/questions/47494993/search-in-the-list-of-integers-one-of-the-longest-ordered-subsets-not-necessar/47496077#47496077", "title": "Search in the list of integers, one of the longest ordered subsets (not necessarily consecutive) ordered by growth", "body": "<p>You could always just use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:subsequences\" rel=\"nofollow noreferrer\"><code>subsequences</code></a> from <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html\" rel=\"nofollow noreferrer\"><code>Data.List</code></a> to get all the possible subsequences in a list. When you get these subsequences, just take the sorted ones with this function and <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a>:</p>\n\n<pre><code>isSorted :: (Ord a) =&gt; [a] -&gt; Bool\nisSorted [] = True\nisSorted [_] = True\nisSorted(x:y:xs) = x &lt;= y &amp;&amp; isSorted (y:xs)\n</code></pre>\n\n<p>Then get the maximum length subsequence with <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:maximumBy\" rel=\"nofollow noreferrer\"><code>maximumBy</code></a>(or another method), with the ordering being <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Ord.html#v:comparing\" rel=\"nofollow noreferrer\"><code>comparing</code></a><code>length</code>. </p>\n\n<p>Here is what the code could look like:</p>\n\n<pre><code>import Data.Ord (comparing)\nimport Data.List (subsequences, maximumBy, nub)\n\nisSorted :: (Ord a) =&gt; [a] -&gt; Bool\nisSorted [] = True\nisSorted [_] = True\nisSorted(x:y:xs) = x &lt;= y &amp;&amp; isSorted (y:xs)\n\nmax_sequence :: (Ord a) =&gt; [a] -&gt; [a]\nmax_sequence xs = maximumBy (comparing length) $ map nub $ filter isSorted (subsequences xs)\n</code></pre>\n\n<p>Which seems to work correctly:</p>\n\n<pre><code>*Main&gt; max_sequence [21,27,15,14,18,16,14,17,22,13]\n[14,16,17,22]\n</code></pre>\n\n<p><strong>Note:</strong> used <code>map nub</code> to remove duplicate elements from the sub sequences. If this is not used, then this will return <code>[14,14,17,22]</code> as the maximum sub sequence, which may be fine if you allow this. </p>\n"}, {"tags": [], "owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "is_accepted": false, "score": 2, "last_activity_date": 1511807013, "last_edit_date": 1511807013, "creation_date": 1511705717, "answer_id": 47497066, "question_id": 47494993, "link": "https://stackoverflow.com/questions/47494993/search-in-the-list-of-integers-one-of-the-longest-ordered-subsets-not-necessar/47497066#47497066", "title": "Search in the list of integers, one of the longest ordered subsets (not necessarily consecutive) ordered by growth", "body": "<p>Excellent question! Looking forward to a variety of answers.</p>\n\n<p>Still improving my answer. The answer below folds to build increasing subsequences from the right. It also uses the the list monad to prepend new elements to subsequences if the new element is smaller than the head of the subsequence. (This is my first real application of the list monad.) For example,</p>\n\n<pre><code>\u03bb&gt; [[3], [1]] &gt;&gt;= (prepIfSmaller 2)\n[[2,3],[3],[1]]\n</code></pre>\n\n<p>This solution is about as short as I can make it.</p>\n\n<pre><code>import Data.List (maximumBy)\n\nmaxSubsequence :: Ord a =&gt; [a] -&gt; [a]\nmaxSubsequence [] = []\nmaxSubsequence xs = takeLongest $ go [] xs\n  where\n    takeLongest :: Ord a =&gt; [[a]] -&gt; [a]\n    takeLongest = maximumBy (\\ x y -&gt; compare (length x) (length y))\n    go :: Ord a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\n    go = foldr (\\x subs -&gt; [x] : (subs &gt;&gt;= (prepIfSmaller x)))\n      where prepIfSmaller x s@(h:_) = (if x &lt; h then [x:s] else []) ++ [s]\n</code></pre>\n\n<p>Quick test.</p>\n\n<pre><code>\u03bb&gt; maxSubsequence [21,27,15,14,18,16,14,17,22,13]\n[15,16,17,22]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 3, "last_activity_date": 1511715424, "creation_date": 1511715424, "answer_id": 47498679, "question_id": 47494993, "link": "https://stackoverflow.com/questions/47494993/search-in-the-list-of-integers-one-of-the-longest-ordered-subsets-not-necessar/47498679#47498679", "title": "Search in the list of integers, one of the longest ordered subsets (not necessarily consecutive) ordered by growth", "body": "<p>A more efficient <code>n log n</code> solution can be done by maintaining a map where </p>\n\n<ul>\n<li>keys are the first element of an increasing sequence.</li>\n<li>values are a tuple: (length of the sequence, the actual sequence)</li>\n</ul>\n\n<p>and the map maintains the invariance that <em>for each possible size of an increasing sequence, only the lexicographically largest one is retained</em>.</p>\n\n<p>Extra <code>traceShow</code> bellow to demonstrate how the map changes while folding from the end of the list:</p>\n\n<pre><code>import Debug.Trace (traceShow)\nimport Data.Map (empty, elems, insert, delete, lookupGT, lookupLT)\n\n-- longest (strictly) increasing sequence\nlis :: (Ord k, Show k, Foldable t) =&gt; t k -&gt; [k]\nlis = snd . maximum . elems . foldr go empty\n  where\n  go x m = traceShow m $ case x `lookupLT` m of\n    Nothing -&gt; m'\n    Just (k, v) -&gt; if fst a &lt; fst v then m' else k `delete` m'\n    where\n    a = case x `lookupGT` m of\n      Nothing -&gt; (1, [x])\n      Just (_, (i, r)) -&gt; (i + 1, x:r)\n    m' = insert x a m\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; lis [21,27,15,14,18,16,14,17,22,13]\nfromList []\nfromList [(13,(1,[13]))]\nfromList [(22,(1,[22]))]\nfromList [(17,(2,[17,22])),(22,(1,[22]))]\nfromList [(14,(3,[14,17,22])),(17,(2,[17,22])),(22,(1,[22]))]\nfromList [(16,(3,[16,17,22])),(17,(2,[17,22])),(22,(1,[22]))]\nfromList [(16,(3,[16,17,22])),(18,(2,[18,22])),(22,(1,[22]))]\nfromList [(14,(4,[14,16,17,22])),(16,(3,[16,17,22])),(18,(2,[18,22])),(22,(1,[22]))]\nfromList [(15,(4,[15,16,17,22])),(16,(3,[16,17,22])),(18,(2,[18,22])),(22,(1,[22]))]\nfromList [(15,(4,[15,16,17,22])),(16,(3,[16,17,22])),(18,(2,[18,22])),(27,(1,[27]))]\n[15,16,17,22]\n</code></pre>\n\n<p>It is not necessary to retain the lists within the map. One can reconstruct the longest increasing sequence only using the keys and the length of the sequences (i.e. only the first element of the tuples). </p>\n"}], "owner": {"reputation": 43, "user_id": 8194730, "user_type": "registered", "profile_image": "https://graph.facebook.com/1794593110860310/picture?type=large", "display_name": "\u0412\u0456\u0442\u0430\u043b\u0456\u0439 \u0411\u0430\u0437\u0430\u043b\u0438\u0446\u044c\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/8194730/%d0%92%d1%96%d1%82%d0%b0%d0%bb%d1%96%d0%b9-%d0%91%d0%b0%d0%b7%d0%b0%d0%bb%d0%b8%d1%86%d1%8c%d0%ba%d0%b8%d0%b9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 47496077, "answer_count": 3, "score": 4, "last_activity_date": 1511807013, "creation_date": 1511691068, "last_edit_date": 1511693465, "question_id": 47494993, "link": "https://stackoverflow.com/questions/47494993/search-in-the-list-of-integers-one-of-the-longest-ordered-subsets-not-necessar", "title": "Search in the list of integers, one of the longest ordered subsets (not necessarily consecutive) ordered by growth", "body": "<p>Function, which finds in the list of integers one of the longest ordered increments of subscripts (not necessarily consecutive) numbers. Example:</p>\n\n<p>\u2022 Sequence <code>[21,27,15,14,18,16,14,17,22,13]</code> = <code>[14,16,17,22]</code></p>\n\n<p>I have a problem with the function which takes the initial number from the array, and looks for a sequence:</p>\n\n<pre><code>fstLen:: Int -&gt; [Int] -&gt; [Int]    \nfstLen a [] = a: []    \nfstLen x (l:ls) = if x &lt; l then x:(fstLen l ls) else fstLen x ls\n</code></pre>\n\n<p>I have problems in place, 14,18,16,14,17,22,13\n14 &lt; 18 but then 18 > 16 and my algorithm takes the number 16 as the basis and is looking for a new sequence and I need to go back to 14\nHow can I do it?</p>\n\n<p>(sorry for my english)</p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1511681967, "post_id": 47493765, "comment_id": 81942994, "body": "I believe this is a simple typo it should be <code>toJSON</code> instead of <code>toJson</code>"}, {"owner": {"reputation": 364, "user_id": 2735314, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4859cc55a401924145afc7787ac8f902?s=128&d=identicon&r=PG&f=1", "display_name": "yantrakaar", "link": "https://stackoverflow.com/users/2735314/yantrakaar"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1511686722, "post_id": 47493765, "comment_id": 81943988, "body": "Thanks. I didn&#39;t notice it . However, the error is so confusing . Coming from OOP I thought &quot;not visible&quot; means the method is not exposed out of module ."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 1, "last_activity_date": 1511681975, "creation_date": 1511681975, "answer_id": 47494002, "question_id": 47493765, "link": "https://stackoverflow.com/questions/47493765/custom-record-to-json-key-conversion-in-haskell-using-aeson-library/47494002#47494002", "title": "Custom record to json key conversion in Haskell using Aeson library", "body": "<p>The name of the method is <code>toJSON</code>, not <code>toJson</code>. Identifiers are case-sensitive in Haskell. You can find this in the <a href=\"https://hackage.haskell.org/package/aeson-1.2.3.0/docs/Data-Aeson.html#t:ToJSON\" rel=\"nofollow noreferrer\"><code>aeson</code> documentation for the <code>ToJSON</code> class</a>.</p>\n"}], "owner": {"reputation": 364, "user_id": 2735314, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4859cc55a401924145afc7787ac8f902?s=128&d=identicon&r=PG&f=1", "display_name": "yantrakaar", "link": "https://stackoverflow.com/users/2735314/yantrakaar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 47494002, "answer_count": 1, "score": 1, "last_activity_date": 1511681975, "creation_date": 1511679455, "question_id": 47493765, "link": "https://stackoverflow.com/questions/47493765/custom-record-to-json-key-conversion-in-haskell-using-aeson-library", "title": "Custom record to json key conversion in Haskell using Aeson library", "body": "<p>Below code does not work for me. Can anyone explain how to solve and avoid below kind of errors in Haskell</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule Test where\n\nimport GHC.Generics\nimport Data.Aeson.Types\nimport Data.Aeson\n\ndata Person = Person { personId :: Int , personName :: String} deriving (Show, Generic)\n\ninstance ToJSON Person where\n    toJson p = [\n            \"id\" .= personId p,\n            \"name\" .= personName p\n        ]\n\ninstance FromJSON Person\n</code></pre>\n\n<p>I am getting following error. I am not able to figure out the issue here.</p>\n\n<pre><code>Prelude&gt; :load src/User/Test\n[1 of 1] Compiling Test             ( src\\User\\Test.hs, interpreted )\n\nsrc\\User\\Test.hs:13:5: error:\n    `toJson' is not a (visible) method of class `ToJSON'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "packages", "ghc", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511657954, "post_id": 47492019, "comment_id": 81939354, "body": "&quot;Cabal seems to be a problem&quot;  the problem is actually that the needed module is &quot;a member of the hidden package...&quot; so don&#39;t hide the package - list it explicitly as a dependency for easyrender."}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511658980, "post_id": 47492071, "comment_id": 81939566, "body": "Where would I find <code>easyrender.cabal</code> such that I can add <code>Cabal</code> to <code>setup-depends</code>?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511659119, "post_id": 47492071, "comment_id": 81939601, "body": "Well using cabal-install it&#39;s <code>cabal unpack easyrender ; cd easyrender* ; vi easyrender.cabal</code>.  Stack probably has some similar unpack abilities or you can download the package from the repo."}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511659595, "post_id": 47492071, "comment_id": 81939683, "body": "Ok, I added <code>Cabal == 2.*</code> to the line you mentioned, but nothing seems to change. Did I do that wrong?"}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511661665, "post_id": 47492071, "comment_id": 81940015, "body": "I mean it now looks like this <code>setup-depends: base &gt;= 4.5 &amp;&amp; &lt; 5, Cabal == 2.*, superdoc == 0.1.*</code> I even did <code>stack update</code> to be sure, but the output is the same."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511664280, "post_id": 47492071, "comment_id": 81940349, "body": "and you did <code>stack install</code> not <code>stack install easyrender</code> right?"}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511668859, "post_id": 47492071, "comment_id": 81940991, "body": "<code>stack install</code> returns <code>Error parsing targets: The project contains no local packages (packages not marked with &#39;extra-dep&#39;)</code> I assume this means I&#39;m supposed to somehow flag the easyrender.cabal file as being extra-dep, but how?"}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511671430, "post_id": 47492071, "comment_id": 81941380, "body": "Ok, I figured out I had to add <code>easyrender-0.1.1.2</code> in the <code>packages</code> array in <code>stack.yaml</code>, thanks"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1511658498, "creation_date": 1511658498, "answer_id": 47492071, "question_id": 47492019, "link": "https://stackoverflow.com/questions/47492019/haskell-stack-failing-to-install-easyrender/47492071#47492071", "title": "Haskell Stack failing to install easyrender", "body": "<p>No such problems with cabal-install:</p>\n\n<pre><code>% cabal install easyrender\nResolving dependencies...\nDownloading superdoc-0.1.2.5...\nConfiguring superdoc-0.1.2.5...\nBuilding superdoc-0.1.2.5...\nInstalled superdoc-0.1.2.5\nDownloading easyrender-0.1.1.2...\nConfiguring easyrender-0.1.1.2...\nBuilding easyrender-0.1.1.2...\nInstalled easyrender-0.1.1.2\n</code></pre>\n\n<p>So I'm guessing this is an issue with stack handling non-simple builds in a different manner.  Namely, cabal-install seems to assume Cabal is a dependency of the setup.hs while stack does not.</p>\n\n<p>Just to check, I tried and could produce your same issue but adding <code>Cabal</code> to the <code>setup-depends:</code> line of the <code>easyrender.cabal</code> made it work fine.</p>\n"}, {"comments": [{"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511671446, "post_id": 47492750, "comment_id": 81941383, "body": "Thanks for the info"}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 3, "last_activity_date": 1511666961, "creation_date": 1511666961, "answer_id": 47492750, "question_id": 47492019, "link": "https://stackoverflow.com/questions/47492019/haskell-stack-failing-to-install-easyrender/47492750#47492750", "title": "Haskell Stack failing to install easyrender", "body": "<p>This is a bug in the easyrender package description.  Note that cabal-install's \"new-build\" encounters the same problem.  See my comment on this stack issue: <a href=\"https://github.com/commercialhaskell/stack/issues/3560#issuecomment-344075524\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/3560#issuecomment-344075524</a></p>\n\n<p>Workaround is as described by Thomas's answer, and also in the issue at <a href=\"https://github.com/commercialhaskell/stack/issues/3560#issuecomment-343980627\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/3560#issuecomment-343980627</a></p>\n\n<p>The next stack release will emit a warning about this circumstance, which should reduce confusion in the future.</p>\n\n<p>Unfortunately, easyrender does not have an issue tracker, it appears to only have a hackage page.  I have emailed the author requesting that he fix this.</p>\n"}], "owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 47492071, "answer_count": 2, "score": 0, "last_activity_date": 1511666961, "creation_date": 1511657666, "last_edit_date": 1511661350, "question_id": 47492019, "link": "https://stackoverflow.com/questions/47492019/haskell-stack-failing-to-install-easyrender", "title": "Haskell Stack failing to install easyrender", "body": "<p>I have GHC 8.0.2 installed on a Haskell stack, and I need a certain number of packages on it for my project, one being easyrender.</p>\n\n<p>I install it using the following command, which works for all other package installations:</p>\n\n<pre><code>stack install easyrender\n</code></pre>\n\n<p>I get the following output:</p>\n\n<pre><code>easyrender-0.1.1.2: configure\n\n--  While building package easyrender-0.1.1.2 using:\n  /home/nathan/.stack/programs/x86_64-linux/ghc-8.0.2/bin/ghc --make -odir /tmp/stack5987/easyrender-0.1.1.2/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup -hidir /tmp/stack5987/easyrender-0.1.1.2/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup -i -i. -clear-package-db -global-package-db -package-db=/home/nathan/.stack/snapshots/x86_64-linux/ghc-8.0.2/8.0.2/pkgdb -package-db=/home/nathan/.stack/global-project/.stack-work/install/x86_64-linux/ghc-8.0.2/8.0.2/pkgdb -hide-all-packages -package-id=base-4.9.1.0 -package-id=superdoc-0.1.2.5-9gGVGYAJpHrGct376cUN41 -optP-include -optP/tmp/stack5987/easyrender-0.1.1.2/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup/setup_macros.h /tmp/stack5987/easyrender-0.1.1.2/Setup.hs /home/nathan/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs -main-is StackSetupShim.mainOverride -o /tmp/stack5987/easyrender-0.1.1.2/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup/setup -threaded\nProcess exited with code: ExitFailure 1\nLogs have been written to: /home/nathan/.stack/global-project/.stack-work/logs/easyrender-0.1.1.2.log\n\n[1 of 2] Compiling Main             ( /tmp/stack5987/easyrender-0.1.1.2/Setup.hs, /tmp/stack5987/easyrender-0.1.1.2/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup/Main.o )\n[2 of 2] Compiling StackSetupShim   ( /home/nathan/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs, /tmp/stack5987/easyrender-0.1.1.2/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup/StackSetupShim.o )\n\n/home/nathan/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs:3:1: error:\n    Failed to load interface for \u2018Distribution.PackageDescription\u2019\n    It is a member of the hidden package \u2018Cabal-2.0.1.0\u2019.\n    It is a member of the hidden package \u2018Cabal-1.24.2.0\u2019.\n    Use -v to see a list of the files searched for.\n\n/home/nathan/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs:4:1: error:\n    Failed to load interface for \u2018Distribution.Simple\u2019\n    It is a member of the hidden package \u2018Cabal-2.0.1.0\u2019.\n    It is a member of the hidden package \u2018Cabal-1.24.2.0\u2019.\n    Use -v to see a list of the files searched for.\n\n/home/nathan/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs:5:1: error:\n    Failed to load interface for \u2018Distribution.Simple.Build\u2019\n    It is a member of the hidden package \u2018Cabal-2.0.1.0\u2019.\n    It is a member of the hidden package \u2018Cabal-1.24.2.0\u2019.\n    Use -v to see a list of the files searched for.\n\n/home/nathan/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs:6:1: error:\n    Failed to load interface for \u2018Distribution.Simple.Setup\u2019\n    It is a member of the hidden package \u2018Cabal-2.0.1.0\u2019.\n    It is a member of the hidden package \u2018Cabal-1.24.2.0\u2019.\n    Use -v to see a list of the files searched for.\n\n/home/nathan/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs:7:1: error:\n    Failed to load interface for \u2018Distribution.Simple.LocalBuildInfo\u2019\n    It is a member of the hidden package \u2018Cabal-2.0.1.0\u2019.\n    It is a member of the hidden package \u2018Cabal-1.24.2.0\u2019.\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>Since Cabal seems to be a problem, I tried running <code>stack install Cabal</code>, but that doesn't do anything. The log file referenced just says the same thing as the output. </p>\n\n<p>Ideas?\nNathan</p>\n"}, {"tags": ["haskell", "ffi", "reflex"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511666058, "post_id": 47491599, "comment_id": 81940570, "body": "have you tried <code>liftIO</code>ing? i mean  <code>liftIO (testSet (GDTpToJSVal e) . GDT.pToJSVal) =&lt;&lt; (sample $ current dt)</code>? I am no expert on Reflex -but this should typecheck, though I have to say that I have not verified."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511728819, "post_id": 47491599, "comment_id": 81957145, "body": "You&#39;ve chosen to omit the majority of the error, which is typically very informative in its entirety. Understanding the error would likely tell you how to fix it; and a good answer would give the fix and explain the error (teach a man to fish and all that...)."}, {"owner": {"reputation": 75, "user_id": 5895342, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SILBA619_G8/AAAAAAAAAAI/AAAAAAAAAGI/RQNL8lBOAn4/photo.jpg?sz=128", "display_name": "Thanacles", "link": "https://stackoverflow.com/users/5895342/thanacles"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1511730176, "post_id": 47491599, "comment_id": 81957605, "body": "@epsilonhalbe Just tried a few variations of liftM and liftIO, but can&#39;t seem to get it to work."}, {"owner": {"reputation": 75, "user_id": 5895342, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SILBA619_G8/AAAAAAAAAAI/AAAAAAAAAGI/RQNL8lBOAn4/photo.jpg?sz=128", "display_name": "Thanacles", "link": "https://stackoverflow.com/users/5895342/thanacles"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511730205, "post_id": 47491599, "comment_id": 81957619, "body": "@user2407038 Just added the full error message."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1511732166, "post_id": 47491599, "comment_id": 81958238, "body": "You can&#39;t get the T.Text value out of the Dynamic monad and use it directly as parameter for the <i>testSet</i> function. You have to run the <i>testSet</i> function in applicative mode inside the monad. Something like <code>testSet &lt;$&gt; ptrToHTMLControl &lt;*&gt; ptrToText</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 3, "last_activity_date": 1511757879, "creation_date": 1511757879, "answer_id": 47504092, "question_id": 47491599, "link": "https://stackoverflow.com/questions/47491599/in-reflex-dom-how-to-pass-a-value-from-a-dynamic-to-a-foreign-javascript-functi/47504092#47504092", "title": "In reflex-dom, how to pass a value from a dynamic to a foreign javascript function (FFI)", "body": "<p>The function <code>performEvent_</code> will force execution of a javascript function but <code>performEvent_</code> wants an <code>Event t (WidgetHost m ())</code> and,  as the error message points out, you've got a <code>Dynamic t (IO ())</code>.</p>\n\n<p>You can use <code>updated</code> to convert your <code>Dynamic t (IO ())</code> to an <code>Event t (IO ())</code> and you can use <code>fmap liftIO</code> to change the <code>IO ()</code> in the <code>Event</code> to  a <code>WidgetHost m ()</code> leaving you with <code>Event t (WidgetHost m ())</code> which you can pass to <code>performEvent_</code></p>\n\n<p>Here's your code with those modifications.  I removed the first argument to <code>testSet</code> and the element creation inside <code>testTB</code> because those were not relevant to the problem/solution.  I also added some extra type declarations.  These were not required but may make things clearer.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.Text as T (Text)\nimport qualified GHCJS.DOM.Types as GDT (pToJSVal)\nimport GHCJS.Types (JSVal)\nimport Reflex.Dom\nimport Control.Monad.Trans (liftIO)\n\nforeign import javascript safe\n  \"console.log $1\"\n  testSet :: JSVal -&gt; IO()\n\ntestTB :: forall t m.  MonadWidget t m =&gt; Dynamic t T.Text -&gt; m ()\ntestTB dt = do \n    let bob :: Dynamic t (IO ())\n        bob = (testSet.(GDT.pToJSVal)) &lt;$&gt; dt  \n\n        bobIOEvent :: Event t (IO ())\n        bobIOEvent = updated bob\n\n        bobWidgetHostEvent :: Event t (WidgetHost m ())\n        bobWidgetHostEvent = fmap liftIO bobIOEvent\n\n    performEvent_ bobWidgetHostEvent\n\nmain = mainWidget $ do\n    ti &lt;- textInput def \n    let dt = value ti\n    testTB dt\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 5895342, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SILBA619_G8/AAAAAAAAAAI/AAAAAAAAAGI/RQNL8lBOAn4/photo.jpg?sz=128", "display_name": "Thanacles", "link": "https://stackoverflow.com/users/5895342/thanacles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 47504092, "answer_count": 1, "score": 5, "last_activity_date": 1511757879, "creation_date": 1511653253, "last_edit_date": 1511730030, "question_id": 47491599, "link": "https://stackoverflow.com/questions/47491599/in-reflex-dom-how-to-pass-a-value-from-a-dynamic-to-a-foreign-javascript-functi", "title": "In reflex-dom, how to pass a value from a dynamic to a foreign javascript function (FFI)", "body": "<p>I am new to Haskell and reflex-dom, but really like the language.  I've been using <a href=\"https://github.com/hansroland/reflex-dom-inbits/blob/master/tutorial.md\" rel=\"nofollow noreferrer\">https://github.com/hansroland/reflex-dom-inbits/blob/master/tutorial.md</a> to learn, and it's been very helpful.</p>\n\n<p>I am currently trying to create a function that takes in a dynamic and creates an element and calls an FFI function every time the value changes in the dynamic.  Here is a simplified version of what I'm trying to do.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.Text as T\nimport qualified GHCJS.DOM.Types as GDT\nimport GHCJS.Types\nimport Reflex.Dom\n\nforeign import javascript safe\n  \"$1.value = $2\"\n  testSet :: JSVal -&gt; JSVal -&gt; IO()\n\ntestTB :: DomBuilder t m =&gt; Dynamic t T.Text -&gt; m ()\ntestTB dt = do\n  (e, _) &lt;- elAttr' \"input\" (\"type\" =: \"text\") blank\n  bob &lt;- (testSet (GDT.pToJSVal e) . GDT.pToJSVal) &lt;$&gt; dt\n  return ()\n\nmain = mainWidget $ testTB $ constDyn \"Hello World!\"\n</code></pre>\n\n<p>This results in the compile time error:</p>\n\n<pre><code>reflex-canvas.hs:14:10: error:\n    \u2022 Couldn't match type \u2018m\u2019 with \u2018Dynamic t\u2019\n      \u2018m\u2019 is a rigid type variable bound by\n        the type signature for:\n          testTB :: forall t (m :: * -&gt; *).\n                    DomBuilder t m =&gt;\n                    Dynamic t Text -&gt; m ()\n        at reflex-canvas.hs:11:11\n      Expected type: m (IO ())\n        Actual type: Dynamic t (IO ())\n    \u2022 In a stmt of a 'do' block:\n        bob &lt;- (testSet (GDT.pToJSVal e) . GDT.pToJSVal) &lt;$&gt; dt\n      In the expression:\n        do { (e, _) &lt;- elAttr' \"input\" (\"type\" =: \"text\") blank;\n             bob &lt;- (testSet (GDT.pToJSVal e) . GDT.pToJSVal) &lt;$&gt; dt;\n             return () }\n      In an equation for \u2018testTB\u2019:\n          testTB dt\n            = do { (e, _) &lt;- elAttr' \"input\" (\"type\" =: \"text\") blank;\n                   bob &lt;- (testSet (GDT.pToJSVal e) . GDT.pToJSVal) &lt;$&gt; dt;\n                   return () }\n    \u2022 Relevant bindings include\n        e :: Element EventResult (DomBuilderSpace m) t\n          (bound at reflex-canvas.hs:13:4)\n        dt :: Dynamic t Text (bound at reflex-canvas.hs:12:8)\n        testTB :: Dynamic t Text -&gt; m () (bound at reflex-canvas.hs:12:1)\n</code></pre>\n\n<p>I've tried various ways to convert the Dynamic to a m() but cannot figure it out.  What is the best practice for doing this?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1511637365, "post_id": 47489566, "comment_id": 81934383, "body": "Why do you think stack is the only way? The question you linked to doesn&#39;t say that."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1511637447, "post_id": 47489566, "comment_id": 81934404, "body": "What do you mean by &quot;failed to be extracted&quot;? And why do you think any of this is going to affect apt&#39;s package database?"}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1511642838, "post_id": 47489566, "comment_id": 81936008, "body": "melponene the question I linked said: <code>Use stack (second option on the haskell.org website) and it will do the work for you.</code> and <code>Please use stack and not the Haskell Platform.</code> and <code>Assuming there&#39;s not already a PPA for it, use stack. In fact, unless the PPA is from someone you trust with root privileges, probably better to use stack (as a less privileged user).</code> and the OP then said <code>I got it working with stack. Thanks everyone.</code> If there is ANY other way to update to ghc-8.0.2, i would <i>love</i> to not have to use stack"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511643008, "post_id": 47489566, "comment_id": 81936072, "body": "Just download the binary from ghchq."}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511643088, "post_id": 47489566, "comment_id": 81936091, "body": "All I want is to update my GHC to 8.0. Idc about stack except as a means to an end."}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511643434, "post_id": 47489566, "comment_id": 81936194, "body": "DeBuisson this <a href=\"https://www.haskell.org/ghc/download_ghc_8_0_2.html\" rel=\"nofollow noreferrer\">website?</a> Once I have it, (which has its own problem above) how would it be installed? Just regular sudo apt-get?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511643794, "post_id": 47489566, "comment_id": 81936296, "body": "@NathanGoedeke There is no .deb from ghchq so you don&#39;t use apt/apt-get to install it.  If you aren&#39;t familiar with autotools, config and makefiles then perhaps you should use hvr&#39;s ppa which I linked in my answer."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1511647227, "post_id": 47489566, "comment_id": 81937124, "body": "<code>stack install ghc</code> is definitely not the right way to install a particular compiler version (nor is that in the instructions you said you were following). It also seems like the output you posted is possibly for <code>stack install ghc-8.0.2</code>"}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 1, "creation_date": 1511647577, "post_id": 47489566, "comment_id": 81937210, "body": "jberry Its clearly from my lack of experience, but the instructions I gave just end with &quot;you can now run with <code>stack</code>&quot; leaving me to randomly guess how I&#39;m supposed to get from there to ghc-8.0, which is literally all I want"}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511647443, "post_id": 47490457, "comment_id": 81937179, "body": "So I added the repository, and added the lines to  <code>sources.list</code> as per the instructions in the PPA link you gave, followed by an apt-get update. Then re-installed GHC. I went through all the commands you gave you as well, and by the ghc-8.2 folder on my home directory I can see that it was successful.  Now what? If I compile in Quipper as I said in the OP, I get this error: <code>.&#47;quipper: 59: .&#47;quipper: ghc: not found</code>. Re-installing GHC is still version 7.10.3. What do I do now?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511647872, "post_id": 47490457, "comment_id": 81937268, "body": "The commands I gave you are for installing it to your home directory with the binary probably at <code>$HOME&#47;local&#47;bin</code>. If you aren&#39;t familiar with system administration then you are much better off using the PPA - uninstall any existing GHC and install hvr&#39;s ppa.  I can&#39;t help you with quipper as I&#39;ve not used it nor know how it finds binaries."}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511648234, "post_id": 47490457, "comment_id": 81937373, "body": "My point is I tried the PPA first (added repository, edited sources.list, updated), and not seeing any results I tried the other way too. Quipper is just a shell file, including a shell command to invoke ghc. What would I have to do (in either solution) to be able to recognize ghc as a viable shell command?"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1511643443, "creation_date": 1511643443, "answer_id": 47490457, "question_id": 47489566, "link": "https://stackoverflow.com/questions/47489566/how-to-update-to-ghc-8-0/47490457#47490457", "title": "How to update to GHC 8.0", "body": "<p>Binary distributions of GHC can be obtained from <a href=\"https://www.haskell.org/ghc/\" rel=\"nofollow noreferrer\">GHC HQ</a>:</p>\n\n<ul>\n<li>8.0.2 here <a href=\"https://www.haskell.org/ghc/download_ghc_8_0_2.html#binaries\" rel=\"nofollow noreferrer\">https://www.haskell.org/ghc/download_ghc_8_0_2.html#binaries</a></li>\n<li>8.2.2 here <a href=\"https://www.haskell.org/ghc/download_ghc_8_2_2.html#binaries\" rel=\"nofollow noreferrer\">https://www.haskell.org/ghc/download_ghc_8_2_2.html#binaries</a></li>\n</ul>\n\n<p>Any suggestion that any one tool is necessary to obtain GHC is wrong.</p>\n\n<p>EDIT: On a nix computer, for example, one can do the following (approx, not tested):</p>\n\n<pre><code>wget https://downloads.haskell.org/~ghc/8.2.2/ghc-8.2.2-x86_64-deb8-linux.tar.xz\ntar xJf ghc-8.2.2*\ncd ghc*\n./configure --prefix=$HOME\nmake install\n</code></pre>\n\n<p>If you don't like portable shell and really want to use apt then consider using <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">hvr's PPA</a> which is pretty darn popular.</p>\n"}, {"comments": [{"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511652677, "post_id": 47491343, "comment_id": 81938288, "body": "Ok, so how would I do something like cabal install for this ghc?"}, {"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "reply_to_user": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511691946, "post_id": 47491343, "comment_id": 81945208, "body": "You\u2019ll use <code>stack install</code> more or less the same way you use <code>cabal install</code>. The main difference you\u2019ll be concerned with is that stack looks at stackage.org for its packages, under whichever resolver you have specified (e.g. lts-9.11). Cabal installs directly from hackage.org, from which the packages on stackage is just a subset of these that are guaranteed to compile together. If you need to install packages not there, you can either get the source for them and run <code>stack install</code> inside them, or read up on the stack documentation a bit to see how it\u2019s used :)"}, {"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "reply_to_user": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511692030, "post_id": 47491343, "comment_id": 81945228, "body": "I think for Quipper, without knowing it, you\u2019ll run it as <code>stack exec \u2014 quipper</code>, which lets quipper find the GHC in stack\u2019s path."}], "tags": [], "owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "is_accepted": true, "score": 2, "last_activity_date": 1511650821, "creation_date": 1511650821, "answer_id": 47491343, "question_id": 47489566, "link": "https://stackoverflow.com/questions/47489566/how-to-update-to-ghc-8-0/47491343#47491343", "title": "How to update to GHC 8.0", "body": "<p>Don't jump into installing the binaries directly. While, as others mentioned, stack isn't the only way, it is certainly one of the easier ones.</p>\n\n<p>So first thing, <code>stack setup</code> actually downloads GHC for you based on the resolver it finds. If you are not in a stack project, it'll default to the global stack config. On the other hand <code>stack install</code> is used for installing packages. That means doing <code>stack install ghc</code> is trying to look for a <em>package</em> on stackage that's called ghc, of which I don't think there are any.</p>\n\n<p><strong>To run the GHC that stack installed</strong>, you'll do <code>stack ghc</code> and to get a GHCi session, <code>stack ghci</code> (generally just prefix with stack).</p>\n\n<p>You could also run the general <code>stack exec -- ..</code> to run a command with stack's path variables. E.g. <code>stack exec -- ghci</code> will work here as well, or <code>stack exec -- ghc --version</code> to get the GHC version.</p>\n"}], "owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2639, "favorite_count": 0, "accepted_answer_id": 47491343, "answer_count": 2, "score": 0, "last_activity_date": 1511650821, "creation_date": 1511636638, "last_edit_date": 1511643250, "question_id": 47489566, "link": "https://stackoverflow.com/questions/47489566/how-to-update-to-ghc-8-0", "title": "How to update to GHC 8.0", "body": "<p>I am trying to use the Quantum Programming language Quipper, and I am running into issues due to the version of GHC I am using:</p>\n\n<pre><code>root@ubuntu:~$ apt-show-versions ghc\nghc:amd64/xenial 7.10.3-7 uptodate\nghc:i386 not installed\n</code></pre>\n\n<p>As it turns out, 7.10 is the only version that Quipper cannot compile with. </p>\n\n<p>I then discovered that apparently the <a href=\"https://www.reddit.com/r/haskell/comments/5ovvsw/how_to_get_haskell_8_on_ubuntu_1604/\" rel=\"nofollow noreferrer\">only way</a> to install Haskell 8.0 was using haskell-stack. Ok, I've never installed something on a stack, so this will go over well.</p>\n\n<p>So I used the instructions on <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/#linux\" rel=\"nofollow noreferrer\">this website</a> to install haskell-stack, then ran the commands:</p>\n\n<pre><code>root@ubuntu:~$ stack setup\nroot@ubuntu:~$ stack update\nroot@ubuntu:~$ stack install ghc\n</code></pre>\n\n<p>The last command returned the following:</p>\n\n<pre><code>Didn't see ghc-8.0.2 in your package indices.\nUpdating and trying again.\nUpdating package index Hackage (mirrored at https://s3.amazonaws.com/hackage.fpc                                                                  Selected mirror https://s3.amazonaws.com/hackage.fpcomplete.com/\nUpdating package index Hackage (mirrored at https://s3.amazonaws.com/hackage.fpc                                                                    Downloading timestamp\nUpdating package index Hackage (mirrored at https://s3.amazonaws.com/hackage.fpc                                                                                Downloading snapshot\nUpdating package index Hackage (mirrored at https://s3.amazonaws.com/hackage.fpc                                                                                    Updating index   \nUpdating package index Hackage (mirrored at https://s3.amazonaws.com/hackage.fpc                                                                                Updated package list downloaded\nUpdating package index Hackage (mirrored at https://s3.amazonaws.com/hackage.fpc                                                                                    Populated index cache.    \nThe following package identifiers were not found in your indices: ghc-8.0.2\nPerhaps you meant AAI, AAI, AAI, AES, AES, AES, AES, AES, AES, or AES?\n</code></pre>\n\n<p>So, a quick check again:</p>\n\n<pre><code>root@ubuntu:~$ apt-show-versions ghc\nghc:amd64/xenial 7.10.3-7 uptodate\nghc:i386 not installed\n</code></pre>\n\n<p>Nope, still 7.10. Tried also to download the package from <a href=\"https://www.haskell.org/ghc/download_ghc_8_0_2.html\" rel=\"nofollow noreferrer\">this website</a>. The package failed to be extracted, so that's a good sign. Rinsed and repeated the above commands, and still nothing. Then I edited the stack.yaml file to say:</p>\n\n<pre><code>resolver: lts-9.14\nresolver: ghc-8.0.2\n</code></pre>\n\n<p>Did absolutely nothing. What step am I missing? Its frustrating when people basically say \"the stack does everything for you\" and I'm like \"what exactly am I supposed to do?\"</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>As I said above, downloading the package for 8.0.2 from haskell.org gives fails to extract the archive:</p>\n\n<p><a href=\"https://i.stack.imgur.com/xwu1w.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xwu1w.png\" alt=\"Failure message of archive extraction\"></a></p>\n"}, {"tags": ["haskell", "types", "algebraic-data-types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511628063, "post_id": 47488270, "comment_id": 81931409, "body": "It does not use the first type as an <code>Int</code>, it sees <code>Int</code> here as a constructor."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1511707853, "post_id": 47488270, "comment_id": 81950008, "body": "Haskell&#39;s unions are <a href=\"https://en.wikipedia.org/wiki/Tagged_union\" rel=\"nofollow noreferrer\">tagged</a>."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1511631232, "post_id": 47488344, "comment_id": 81932442, "body": "It might help to call out that the capitalized things in bold only exist at the term-level (in code), while the other capitalized things only appear at the type level (in type signatures). I think the syntax can be confusing in this respect."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1511707510, "post_id": 47488344, "comment_id": 81949893, "body": "<code>A1 Int</code> would cause even less confusion."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 11, "last_activity_date": 1511632989, "last_edit_date": 1511632989, "creation_date": 1511628407, "answer_id": 47488344, "question_id": 47488270, "link": "https://stackoverflow.com/questions/47488270/invalid-data-type/47488344#47488344", "title": "Invalid data type", "body": "<blockquote>\n  <p>Why is it ok to use the concrete type Int as part of a data type definition (..)</p>\n</blockquote>\n\n<p>It is <strong>not OK</strong>.</p>\n\n<p>What you here have written is the definition of a data type <code>A</code> that has a <strong>constructor named <code>Int</code></strong>. This has nothing to do with the data type <code>Int</code>, it is simply a coincidence that the name of the constructor is the same as the name of a type, but that is not a problem for the Haskell compiler, since Haskell has a clear distinction between types and constructor names.</p>\n\n<p>You can not use <code>[Int]</code> however, since <code>[Int]</code> is not an identifier (it starts with an open square bracket), nor is it an operator (that can only use symbols). So Haskell does not really knows how to deal with this and errors on this input.</p>\n\n<p>If you want to define a datatype that can take an <code>Int</code> value, you need to <strong>add it as a parameter</strong>. You can also define constructors for your <code>[Int]</code> and <code>(Int, Int)</code> parameters. For instance:</p>\n\n<pre><code>data A = <b>Int</b> Int | <b>Ints</b> [Int] | <b>Int2</b> (Int,Int)</code></pre>\n\n<p>So here there are three constructors: <code>Int</code>, <code>Ints</code>, and <code>Int2</code>. And the first constructor takes an <code>Int</code> as parameter, the second one an <code>[Int]</code>, and the last one an <code>(Int, Int)</code>.</p>\n\n<p>That being said, this will probably result into a lot of confusion, so it is better to use constructor names that cause less confusion, for instance:</p>\n\n<pre><code>data A = <b>A</b> Int | <b>As</b> [Int] | <b>A2</b> (Int,Int)</code></pre>\n\n<p>Note that the <code>A</code> of <code>data A</code> can be used in the signature of the functions, whereas the constructors (in boldcase) are used as values (so in the implementation of the function, that is the pattern matching in the head of the clauses, and in order to construct a value in the body of the clauses).</p>\n"}], "owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 47488344, "answer_count": 1, "score": 2, "last_activity_date": 1511632989, "creation_date": 1511627877, "question_id": 47488270, "link": "https://stackoverflow.com/questions/47488270/invalid-data-type", "title": "Invalid data type", "body": "<p>The following code is invalid:</p>\n\n<pre><code>data A = Int | [Int] | (Int, Int)\n</code></pre>\n\n<p>Why is it ok to use the concrete type <code>Int</code> as part of a data type definition, but not the concrete type <code>[Int]</code> or <code>(Int, Int)</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 1, "last_activity_date": 1511734861, "creation_date": 1511734861, "answer_id": 47501615, "question_id": 47486935, "link": "https://stackoverflow.com/questions/47486935/couldnt-match-type-a-with-b/47501615#47501615", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018b\u2019", "body": "<p>OK, let's try this again.  If we use the <code>-ddump-splices</code> switch, and massage the output a little, we see what <code>makeAction</code> generated:</p>\n\n<pre><code>data AccessAction r\n  where\n    GetItem :: FromJSON a =&gt; ItemId -&gt; AccessAction a\n    GetNextPage :: (FromJSON a, Show a, Eq a) =&gt;\n                   Pager a -&gt; AccessAction (Maybe (Pager a))\nderiving instance Eq (AccessAction r)\nderiving instance Show (AccessAction r)\n\ninstance Action AccessAction where\n  eqAction (GetItem x) (GetItem y)\n    = if x == y then\n          Just Refl\n      else\n          Nothing\n  eqAction (GetNextPage x) (GetNextPage y)\n    = if x == y True then\n          Just Refl\n      else\n          Nothing\n  eqAction _ _ = Nothing\n\ninstance Monad m =&gt;\n         MonadAccess (MockT AccessAction m) where\n  getItem x = mockAction \"getItem\" (GetItem x)\n  getNextPage x = mockAction \"getNextPage\" (GetNextPage x)\n</code></pre>\n\n<p>The error occurs when creating the <code>eqAction</code> function for the <code>AccessAction</code> instance of <code>Action</code>.  The function for this instance has type:</p>\n\n<pre><code>eqAction :: AccessAction a -&gt; AccessAction b -&gt; Maybe (a :~: b)\n</code></pre>\n\n<p>Which means it will be passed two <code>AccessAction</code>s with potentially different result types, and must return <code>Nothing</code> if the two actions are different, or <code>Just Refl</code> if the two actions are the same (meaning they have the same data constructor, equal arguments, and matching return types).</p>\n\n<p>The <code>AccessAction</code> constructors have type:</p>\n\n<pre><code>GetItem :: FromJSON a =&gt; ItemId -&gt; AccessAction a\nGetNextPage :: (FromJSON a, Show a, Eq a) =&gt; Pager a -&gt; AccessAction (Maybe (Pager a))\n</code></pre>\n\n<p>The <code>eqAction</code> function pattern matches on the constructors, checks that the arguments are equal, and returns <code>Just Refl</code> if they are.  However, <code>Refl</code> inhabits <code>a :~: b</code> iff <code>a ~ b</code>, but there's no constraint that guarantees that <code>a ~ b</code>, which results in the error.  For example, one <code>GetItem</code> could be an <code>AccessAction Int</code>, and the other an <code>AccessAction Bool</code>, since both <code>Int</code> and <code>Bool</code> have <code>FromJSON</code> instances.</p>\n\n<p>You would need to prove that the two <code>FromJSON</code> instances are the same type.  The only way I can see to do this would be if <code>AccessAction</code> had a <code>TestEquality</code> instance, which would require the <code>a</code> to also have a <code>TestEquality</code> instance.</p>\n\n<p>Rather, we can make <code>a</code> a parameter to the <code>MonadAccess</code> typeclass with a functional dependency (just like the state parameter in <code>MonadState</code>), and move the <code>FromJSON, Eq, and Show</code> constraints into the typeclass:</p>\n\n<pre><code>class (FromJSON a, Show a, Eq a, Monad m) =&gt; MonadAccess a m | m -&gt; a where\n  getItem :: ItemId -&gt; m (Pager a)\n  getNextPage :: Pager a -&gt; m (Maybe (Pager a))\n</code></pre>\n\n<p>This requires that we add the <code>FunctionalDependencies</code> language extension.</p>\n\n<p>Note that I also changed the return type of <code>getItem</code> from <code>m a</code> to <code>m (Pager a)</code>, which is how it is used in practice (the compile gets upset if the type is too general).</p>\n\n<p>The type of <code>getAllPages</code> now changes to:</p>\n\n<pre><code>getAllPages\n  :: MonadAccess a m\n  =&gt; String\n  -&gt; m [a]\n</code></pre>\n\n<p>And we can finally use <code>makeAction</code> to generate a mock for <code>MonadAccess Item</code> (which is the type of <code>a</code> we intend to use in the mock).</p>\n\n<pre><code>makeAction \"AccessAction\" [ts| MonadAccess Item |]\n</code></pre>\n\n<p>The generated code creates a context with <code>FromJSON Item</code>, which is not allowed unless you enable the <code>FlexibleContexts</code> language extension.</p>\n\n<p>Now we have a guarantee that, within <code>MonadAccess Item</code>, all <code>a</code> type variables refer to the same type <code>Item</code>.</p>\n"}], "owner": {"reputation": 29647, "user_id": 4999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae995fa03b218e7c27a608b5f14e68ae?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz", "link": "https://stackoverflow.com/users/4999/%c5%81ukasz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "accepted_answer_id": 47501615, "answer_count": 1, "score": 1, "last_activity_date": 1511734861, "creation_date": 1511619251, "last_edit_date": 1511623283, "question_id": 47486935, "link": "https://stackoverflow.com/questions/47486935/couldnt-match-type-a-with-b", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018b\u2019", "body": "<p>Full code <a href=\"http://codepad.org/of3mTarF\" rel=\"nofollow noreferrer\">http://codepad.org/of3mTarF</a></p>\n\n<p>I'm trying to use <a href=\"https://hackage.haskell.org/package/monad-mock\" rel=\"nofollow noreferrer\">monad-mock</a> to test my code, but I run into a problem which I have no idea how to solve.</p>\n\n<p>The monad I'm trying to mock:</p>\n\n<pre><code>class Monad m =&gt; MonadAccess m where\n  getItem :: FromJSON a =&gt; ItemId -&gt; m a\n  getNextPage :: (FromJSON a, Show a, Eq a) =&gt; Pager a -&gt; m (Maybe (Pager a))\n</code></pre>\n\n<p>I also have a function which is defined in terms of that monad:</p>\n\n<pre><code>getAllPages\n  :: (MonadAccess m, FromJSON a, Show a, Eq a)\n  =&gt; String\n  -&gt; m [a]\ngetAllPages s = do\n    firstPage &lt;- getItem s\n    go (pagerItems firstPage) (pagerNext firstPage)\n  where\n    go acc mp =\n      case mp of\n        Nothing -&gt; return acc\n        Just p  -&gt; getNextPage p &gt;&gt;= go (acc ++ pagerItems p)\n</code></pre>\n\n<p>I define the mock using TemplateHaskell:</p>\n\n<pre><code>makeAction \"AccessAction\" [ts| MonadAccess |]\n</code></pre>\n\n<p>But even if I define all the necessary bits manually the errors I'm getting are the same:</p>\n\n<pre><code>mock.hs:65:1: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018b\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          eqAction :: forall a b.\n                      AccessAction a\n                      -&gt; AccessAction b -&gt; Maybe (a Data.Type.Equality.:~: b)\n        at mock.hs:65:1\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          eqAction :: forall a b.\n                      AccessAction a\n                      -&gt; AccessAction b -&gt; Maybe (a Data.Type.Equality.:~: b)\n        at mock.hs:65:1\n      Expected type: Maybe (a Data.Type.Equality.:~: b)\n        Actual type: Maybe (a Data.Type.Equality.:~: a)\n    \u2022 In the expression: Just Data.Type.Equality.Refl\n      In the expression:\n        if (&amp;&amp;) ((==) x_amxO y_amxP) True then\n            Just Data.Type.Equality.Refl\n        else\n            Nothing\n      In an equation for \u2018eqAction\u2019:\n          eqAction (GetItem x_amxO) (GetItem y_amxP)\n            = if (&amp;&amp;) ((==) x_amxO y_amxP) True then\n                  Just Data.Type.Equality.Refl\n              else\n                  Nothing\n    \u2022 Relevant bindings include\n        eqAction :: AccessAction a\n                    -&gt; AccessAction b -&gt; Maybe (a Data.Type.Equality.:~: b)\n          (bound at mock.hs:65:1)\n\nmock.hs:65:1: error:\n    \u2022 Could not deduce: a2 ~ a1\n      from the context: (a ~ Maybe (Pager a1),\n                         FromJSON a1,\n                         Show a1,\n                         Eq a1)\n        bound by a pattern with constructor:\n                   GetNextPage :: forall a_Xe30.\n                                  (FromJSON a_Xe30, Show a_Xe30, Eq a_Xe30) =&gt;\n                                  Pager a_Xe30 -&gt; AccessAction (Maybe (Pager a_Xe30)),\n                 in an equation for \u2018eqAction\u2019\n        at mock.hs:65:1-45\n      or from: (b ~ Maybe (Pager a2), FromJSON a2, Show a2, Eq a2)\n        bound by a pattern with constructor:\n                   GetNextPage :: forall a_Xe30.\n                                  (FromJSON a_Xe30, Show a_Xe30, Eq a_Xe30) =&gt;\n                                  Pager a_Xe30 -&gt; AccessAction (Maybe (Pager a_Xe30)),\n                 in an equation for \u2018eqAction\u2019\n        at mock.hs:65:1-45\n      \u2018a2\u2019 is a rigid type variable bound by\n        a pattern with constructor:\n          GetNextPage :: forall a_Xe30.\n                         (FromJSON a_Xe30, Show a_Xe30, Eq a_Xe30) =&gt;\n                         Pager a_Xe30 -&gt; AccessAction (Maybe (Pager a_Xe30)),\n        in an equation for \u2018eqAction\u2019\n        at mock.hs:65:1\n      \u2018a1\u2019 is a rigid type variable bound by\n        a pattern with constructor:\n          GetNextPage :: forall a_Xe30.\n                         (FromJSON a_Xe30, Show a_Xe30, Eq a_Xe30) =&gt;\n                         Pager a_Xe30 -&gt; AccessAction (Maybe (Pager a_Xe30)),\n        in an equation for \u2018eqAction\u2019\n        at mock.hs:65:1\n      Expected type: Pager a1\n        Actual type: Pager a2\n    \u2022 In the second argument of \u2018(==)\u2019, namely \u2018y_amxR\u2019\n      In the first argument of \u2018(&amp;&amp;)\u2019, namely \u2018(==) x_amxQ y_amxR\u2019\n      In the expression: (&amp;&amp;) ((==) x_amxQ y_amxR) True\n    \u2022 Relevant bindings include\n        y_amxR :: Pager a2 (bound at mock.hs:65:1)\n        x_amxQ :: Pager a1 (bound at mock.hs:65:1)\n</code></pre>\n\n<p>I tried removing <code>Maybe</code> from the definition of the <code>getNextPage</code> but it didn't change anything. I also looked into <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Type-Equality.html\" rel=\"nofollow noreferrer\">Data.Type.Equality</a> but I couldn't figure out what may be wrong.</p>\n\n<p>Any pointers to get this piece of code to compile?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511622911, "post_id": 47486433, "comment_id": 81929816, "body": "If that&#39;s the full definition of the function, I would have named that <code>unsafeTail</code> or <code>dangerousTail</code>, since that will crash on the empty list."}, {"owner": {"reputation": 41, "user_id": 7549786, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1372256119482433/picture?type=large", "display_name": "Wandy", "link": "https://stackoverflow.com/users/7549786/wandy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511633486, "post_id": 47486433, "comment_id": 81933150, "body": "I got the catchall for the empty list but decided not to put it here because the main point here is that I don&#39;t understand the syntax of (x:xs) and not the function."}], "answers": [{"tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 1, "last_activity_date": 1511616883, "creation_date": 1511616883, "answer_id": 47486553, "question_id": 47486433, "link": "https://stackoverflow.com/questions/47486433/haskell-pattern-matching-in-safetail-function/47486553#47486553", "title": "Haskell pattern matching in safeTail function", "body": "<p>Thats the pattern matching.</p>\n\n<p>The first argument to your function <code>safeTail</code> is some list type. In case the argument is a non-empty list, this pattern matching will succeed and bind the <code>x</code> to the head element and <code>xs</code> to the tail of the list.</p>\n\n<p>In case you pass an empty list to <code>safeTail</code> the pattern match will fail and other patterns (if any exists) are checked.</p>\n"}, {"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1511649840, "post_id": 47487624, "comment_id": 81937729, "body": "The <code>Maybe</code>-based definition is actually a <code>safeHead</code> and not a <code>safeTail</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1511661230, "last_edit_date": 1511661230, "creation_date": 1511624051, "answer_id": 47487624, "question_id": 47486433, "link": "https://stackoverflow.com/questions/47486433/haskell-pattern-matching-in-safetail-function/47487624#47487624", "title": "Haskell pattern matching in safeTail function", "body": "<p>Consider a similar definition for a list data type.</p>\n\n<pre><code>data List a = Empty | Cons a (List a)  -- (1)\n</code></pre>\n\n<p>There are two constructors: one to create an empty list, and another to create a list given a value and another list.</p>\n\n<p>Pattern matching works by matching a value against the constructor used to create it.</p>\n\n<pre><code>safeTail (Cons x xs) = xs  -- (2)\n</code></pre>\n\n<p>That is, if <code>safeTail</code> is applied to a value defined using the <code>Cons</code> constructor, then the return value is the second argument to <code>Cons</code>.</p>\n\n<p>In real code, both the type constructor <code>List</code> and the <code>Empty</code> data constructor are named <code>[]</code> and the <code>Cons</code> constructor is named <code>(:)</code>.</p>\n\n<pre><code>data [] a = [] | (:) a ([] a)\n</code></pre>\n\n<p>which Haskell allows to be written with special syntax</p>\n\n<pre><code>data [a] = [] | a : [a]\n</code></pre>\n\n<p>Applying the type constructer <code>[]</code> to a type or type variable can be replaced by including the argument inside the <code>[]</code>, and the symbolic constructor (because it starts with a <code>:</code>) can be used as an infix operator.</p>\n\n<p>That is, you could write</p>\n\n<pre><code>safeTail ((:) x xs) = xs  -- (3)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>safeTail (x : xs) = xs  -- (4)\n</code></pre>\n\n<p>with (2), (3), and (4) being equivalent to (1) above.</p>\n\n<pre><code>&gt;&gt;&gt; safeTail ((:) 3 ((:) 2 ((:) 1 [])))\n[2,1]\n&gt;&gt;&gt; safeTail (3:2:1:[])\n[2,1]\n&gt;&gt;&gt; safeTail [3,2,1]\n[2,1]\n</code></pre>\n\n<p>For further simplicity, Haskell represents <code>(x:[])</code> as <code>[x]</code>, <code>(x:y:[])</code> as <code>[x,y]</code>, etc.</p>\n\n<p>A complete definition of <code>safeTail</code> would also provide a value for an empty list argument:</p>\n\n<pre><code>safeTail [] = []\n</code></pre>\n\n<p>or a <code>Maybe</code>-based definition</p>\n\n<pre><code>safeTail :: [a] -&gt; Maybe [a]\nsafeTail [] = Nothing\nsafeTail (x:xs) = Just xs\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 7549786, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1372256119482433/picture?type=large", "display_name": "Wandy", "link": "https://stackoverflow.com/users/7549786/wandy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 907, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1511661230, "creation_date": 1511616050, "question_id": 47486433, "link": "https://stackoverflow.com/questions/47486433/haskell-pattern-matching-in-safetail-function", "title": "Haskell pattern matching in safeTail function", "body": "<p>I got a Haskell function that is defined using pattern matching but i'm not really understand why is it looks like the way it is.</p>\n\n<pre><code>safeTail (x : xs) = xs\n</code></pre>\n\n<p>I'm not really understand specifically at the (x : xs), what does it mean ?</p>\n"}, {"tags": ["haskell", "set", "proof", "type-level-computation", "associativity"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1511718813, "post_id": 47485615, "comment_id": 81953669, "body": "Leaving aside convincing  the compiler of your proof, do you know how to prove that the operation should be associative on paper? (And here I don&#39;t mean the mathematical &quot;set union&quot; operation, but the one actually defined here: doing a sort, then deduplicating. And of course the requisite lemma that the operation implemented by the name <code>Sort</code> is a sort.) For a complex proof like this, that seems like an absolutely critical first step."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1511728018, "post_id": 47485615, "comment_id": 81956869, "body": "@DanielWagner is right, but I might go a bit further. Sorting is generally more complicated than merging, so you might be better off representing sets as <i>sorted</i> lists, with sortedness evidence."}, {"owner": {"reputation": 175, "user_id": 4914903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ac7fcfbb9192989cd71ccfb042dc6b?s=128&d=identicon&r=PG&f=1", "display_name": "starper", "link": "https://stackoverflow.com/users/4914903/starper"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1511730252, "post_id": 47485615, "comment_id": 81957637, "body": "@DanielWagner I&#39;m actually a noob in proving things. First two proofs I took from <a href=\"https://stackoverflow.com/a/27682570/4914903\">this</a> answer and right identity proof is super easy, so I was able to prove it by myself. BTW my final goal is to have an indexed free monad, like the one in the linked answer, only with Sets instead of Lists."}, {"owner": {"reputation": 175, "user_id": 4914903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ac7fcfbb9192989cd71ccfb042dc6b?s=128&d=identicon&r=PG&f=1", "display_name": "starper", "link": "https://stackoverflow.com/users/4914903/starper"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1511730899, "post_id": 47485615, "comment_id": 81957847, "body": "@dfeuer do you mean on value level (singleton)?"}], "owner": {"reputation": 175, "user_id": 4914903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ac7fcfbb9192989cd71ccfb042dc6b?s=128&d=identicon&r=PG&f=1", "display_name": "starper", "link": "https://stackoverflow.com/users/4914903/starper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1511612548, "creation_date": 1511610475, "last_edit_date": 1511612548, "question_id": 47485615, "link": "https://stackoverflow.com/questions/47485615/proof-of-associativity-law-for-type-level-set", "title": "Proof of associativity law for type-level set", "body": "<p>I'm trying to prove that type-level function <a href=\"https://hackage.haskell.org/package/type-level-sets-0.8.5.0/docs/Data-Type-Set.html#t:Union\" rel=\"nofollow noreferrer\">Union</a> is associative, but I'm not sure how it should be done. I proved right identity and associativity laws for type-level append function and right identity for union:</p>\n\n<pre><code>data SList (i :: [k]) where\n  SNil :: SList '[]\n  SSucc :: SList t -&gt; SList (h ': t)\n\nappRightId :: SList xs -&gt; xs :~: (xs :++ '[])\nappRightId SNil       = Refl\nappRightId (SSucc xs) = case appRightId xs of Refl -&gt; Refl\n\nappAssoc\n  :: SList xs\n  -&gt; Proxy ys\n  -&gt; Proxy zs\n  -&gt; (xs :++ (ys :++ zs)) :~: ((xs :++ ys) :++ zs)\nappAssoc SNil       _  _  = Refl\nappAssoc (SSucc xs) ys zs = case appAssoc xs ys zs of Refl -&gt; Refl\n\ncong :: a :~: b -&gt; f a :~: f b\ncong Refl = Refl\n\nunionRightId :: SList xs -&gt; AsSet xs :~: Union xs '[]\nunionRightId xs = case cong (appRightId xs) of Refl -&gt; Refl\n</code></pre>\n\n<p>but I don't get how to prove that union is associative.</p>\n"}, {"tags": ["haskell", "makefile", "ghci"], "comments": [{"owner": {"reputation": 23640, "user_id": 1595669, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IFn9l.png?s=128&g=1", "display_name": "pavel", "link": "https://stackoverflow.com/users/1595669/pavel"}, "edited": false, "score": 3, "creation_date": 1511610667, "post_id": 47485608, "comment_id": 81926069, "body": "We know what you want. Great. What you have so far?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1511611373, "post_id": 47485608, "comment_id": 81926277, "body": "I don&#39;t recommend that. Rather, use <code>ghc --make</code>, or <code>cabal</code>, or <code>stack</code>. If you do need <code>make</code>, read the docs about it: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/separate_compilation.html#using-make\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1511611899, "post_id": 47485608, "comment_id": 81926435, "body": "Well you first think what commands you call yourself when making the program, and then turn that into a Makefile."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1511659018, "post_id": 47485608, "comment_id": 81939577, "body": "If your program was in <code>C</code> you&#39;d use <code>gcc -c</code>, most Haskell programs are compiled with ghc so you use <code>ghc -c</code>.  If you want optimization then in C you&#39;d use <code>-O2</code> or 3, with ghc you also use <code>-O2</code>.  If you want warnings in  C you use <code>-Wall</code>, with ghc it&#39;s <code>-Wall</code>. If you want to compile a binary with c you just drop the flag and call <code>gcc</code> while with Haskell you just drop the flag and use <code>ghc</code>.  If you want to link a program from many object files with C you can use the compiler or linker such as <code>gcc obj1.o obj2.o -o res</code>; with ghc you would call ghc <code>ghc obj1.o obj2.o -o res</code>. Questions?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1511617601, "creation_date": 1511617601, "answer_id": 47486667, "question_id": 47485608, "link": "https://stackoverflow.com/questions/47485608/how-to-make-a-makefile-for-a-program-for-haskell-language/47486667#47486667", "title": "How to make a Makefile for a program for Haskell Language?", "body": "<p>Almost no Haskell project uses a Makefile, because that's clunky, hard to read and error-prone.</p>\n\n<p>For simple one-off projects, you don't really need any dedicated build system at all: GHC can itself figure out the dependency between modules:</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp$ cat &gt;&gt; Hello.hs\nmodule Main where\n\nimport Greeting\n\nmain = putStrLn greeting\n</code></pre>\n\n<hr>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp$ cat &gt;&gt; Greeting.hs\nmodule Greeting where\n\ngreeting = \"Hello, World!\"\n</code></pre>\n\n<hr>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp$ ghc Hello.hs \n[1 of 2] Compiling Greeting         ( Greeting.hs, Greeting.o )\n[2 of 2] Compiling Main             ( Hello.hs, Hello.o )\nLinking Hello ...\n</code></pre>\n\n<hr>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp$ ./Hello \nHello, World!\n</code></pre>\n\n<p>...or simply</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp$ runhaskell Hello.hs\nHello, World!\n</code></pre>\n\n<p>For more involved projects and definitely for libraries, you want to use <a href=\"https://www.haskell.org/cabal/\" rel=\"noreferrer\">Cabal</a>. I.e. you need a <code>.cabal</code> file, e.g. for the above &ldquo;project&rdquo; <code>hello.cabal</code>. Such a file can be generated semi-automatically by the <code>cabal</code> tool:</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp$ mkdir hello\nsagemuej@sagemuej-X302LA:/tmp$ mv Hello.hs hello\nsagemuej@sagemuej-X302LA:/tmp$ mv Greeting.hs hello\nsagemuej@sagemuej-X302LA:/tmp$ cd hello/\nsagemuej@sagemuej-X302LA:/tmp/hello$ cabal init\nPackage name? hello\nThis package name is already used by another package on hackage. Do you want to choose a different name? [default: y] n\nPackage version? [default: 0.1.0.0] \nPlease choose a license:\n   1) GPL-2\n   2) GPL-3\n   3) LGPL-2.1\n   4) LGPL-3\n   5) AGPL-3\n   6) BSD2\n * 7) BSD3\n   8) MIT\n   9) ISC\n  10) MPL-2.0\n  11) Apache-2.0\n  12) PublicDomain\n  13) AllRightsReserved\n  14) Other (specify)\nYour choice? [default: BSD3] 12\nAuthor name? [default: Justus Sagem\u00fcller] \nMaintainer email? [default: sagemueller@geo.uni-koeln.de] \nProject homepage URL? \nProject synopsis? hello\nProject category:\n * 1) (none)\n   2) Codec\n   3) Concurrency\n   4) Control\n   5) Data\n   6) Database\n   7) Development\n   8) Distribution\n   9) Game\n  10) Graphics\n  11) Language\n  12) Math\n  13) Network\n  14) Sound\n  15) System\n  16) Testing\n  17) Text\n  18) Web\n  19) Other (specify)\nYour choice? [default: (none)] 17\nWhat does the package build:\n   1) Library\n   2) Executable\nYour choice? 2\nWhat is the main module of the executable:\n * 1) Main.hs (does not yet exist, but will be created)\n   2) Main.lhs (does not yet exist, but will be created)\n   3) Other (specify)\nYour choice? [default: Main.hs (does not yet exist, but will be created)] 3\nPlease specify? Hello.hs\nSource directory:\n * 1) (none)\n   2) src\n   3) Other (specify)\nYour choice? [default: (none)] \nWhat base language is the package written in:\n * 1) Haskell2010\n   2) Haskell98\n   3) Other (specify)\nYour choice? [default: Haskell2010] \nAdd informative comments to each field in the cabal file (y/n)? [default: n] \n\nGuessing dependencies...\nGenerating Setup.hs...\nGenerating ChangeLog.md...\nGenerating hello.cabal...\n\nYou may want to edit the .cabal file and add a Description field.\n</code></pre>\n\n<p>The file will at this point contain:</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp/hello$ cat hello.cabal \n-- Initial hello.cabal generated by cabal init.  For further documentation,\n--  see http://haskell.org/cabal/users-guide/\n\nname:                hello\nversion:             0.1.0.0\nsynopsis:            hello\n-- description:         \nlicense:             PublicDomain\nauthor:              Justus Sagem\u00fcller\nmaintainer:          sagemueller@geo.uni-koeln.de\ncategory:            Text\nbuild-type:          Simple\nextra-source-files:  ChangeLog.md\ncabal-version:       &gt;=1.10\n\nexecutable hello\n  main-is:             Hello.hs\n  -- other-modules:       \n  -- other-extensions:    \n  build-depends:       base &gt;=4.10 &amp;&amp; &lt;4.11\n  -- hs-source-dirs:      \n  default-language:    Haskell2010\n</code></pre>\n\n<p>That's not quite complete, you still need to add <code>Greeting.hs</code> to the project: (without the filename extension)</p>\n\n<pre><code>...\nexecutable hello\n  main-is:             Hello.hs\n  other-modules:       Greeting\n  -- other-extensions:\n...\n</code></pre>\n\n<p>But that's it, you can now do</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp/hello$ cabal build\nResolving dependencies...\nConfiguring hello-0.1.0.0...\nPreprocessing executable 'hello' for hello-0.1.0.0..\nBuilding executable 'hello' for hello-0.1.0.0..\n[1 of 2] Compiling Greeting         ( Greeting.hs, dist/build/hello/hello-tmp/Greeting.o )\n[2 of 2] Compiling Main             ( Hello.hs, dist/build/hello/hello-tmp/Main.o )\nLinking dist/build/hello/hello ...\n</code></pre>\n\n<p>Or, to just run the script, <code>cabal run</code>, or <code>cabal install</code> to make it always available on your system.</p>\n"}], "owner": {"reputation": 105, "user_id": 7136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88e98cbde0fd93a626323471a96414bd?s=128&d=identicon&r=PG&f=1", "display_name": "MongJi", "link": "https://stackoverflow.com/users/7136970/mongji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3603, "favorite_count": 0, "accepted_answer_id": 47486667, "answer_count": 1, "score": 2, "last_activity_date": 1511617601, "creation_date": 1511610435, "question_id": 47485608, "link": "https://stackoverflow.com/questions/47485608/how-to-make-a-makefile-for-a-program-for-haskell-language", "title": "How to make a Makefile for a program for Haskell Language?", "body": "<p>i'm new in Haskell language and i want to create a makefile for a haskell program that i'm working on it right now. But i'm not sure how to do that. </p>\n\n<p>Thank you :)</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1511602629, "post_id": 47483773, "comment_id": 81923829, "body": "A good mental model is that WHNF conversion happens at runtime -- it&#39;s the way Haskell code is run.  Optimizations often reduce code at compile time, but they are free not to if they aren&#39;t sure it&#39;s going to work out, so to speak."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1511604626, "post_id": 47483773, "comment_id": 81924412, "body": "There&#39;s a third option: machine code that builds a graph representing the program (as needed) and reduces that graph."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1511683264, "last_edit_date": 1511683264, "creation_date": 1511610080, "answer_id": 47485554, "question_id": 47483773, "link": "https://stackoverflow.com/questions/47483773/does-the-whnf-reduction-in-haskell-happen-at-compile-time/47485554#47485554", "title": "Does the WHNF reduction in Haskell happen at Compile time?", "body": "<p>A compiler could perform its job performing all the reduction at runtime. That is, the resulting executable could have a (large) data section, where the whole program AST is encoded, and a (small) text/code section with a generic WHNF reducer which operates on the AST.</p>\n\n<p>Note that the above approach would work in any language. E.g. a Python compiler could also generate an executable file comprising AST data and generic reducer.\nThe reducer would follow the so-called <em>small-step semantics</em> of the language, which is a very well known notion in computer science (more specifically, in programming languages theory).</p>\n\n<p>However, the performance of such approach would be quite poor.</p>\n\n<p>Researchers in programming languages worked on finding better approaches, resulting in the definition of <em>abstract machines</em>. Essentially, an abstract machine is an algorithm for running an high level program in a lower level setting. Usually, it exploits a few data structures (e.g. stacks) to make the process more efficient. In the case of functional languages such as Haskell, well known abstract machines include:</p>\n\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Categorical_abstract_machine\" rel=\"nofollow noreferrer\">Categorical Abstract Machine</a> (Caml originally used this, I think)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Krivine_machine\" rel=\"nofollow noreferrer\">Krivine Machine</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/SECD_machine\" rel=\"nofollow noreferrer\">SECD</a></li>\n<li><a href=\"https://www.dcc.fc.up.pt/~pbv/aulas/linguagens/peytonjones92implementing.pdf\" rel=\"nofollow noreferrer\">Spineless Tagless G-machine</a> (GHC uses this one)</li>\n</ul>\n\n<p>The problem itself is far from being trivial. There has been, and I'd say there still is, research on making WHNF reduction more efficient.</p>\n\n<p>Each Haskell definition, after GHC compilation, becomes a sequence of assembly instructions, which manipulate the state of the STG machine. There is no AST around, only code which manipulates data / closures / etc.</p>\n\n<p>One could say that it is very important to use such advanced techniques to improve performance, coupled with heavy optimizations. A negative consequence, though, is that it becomes hard to understand the performance of the resulting code from the original one, since one needs to take into account how the abstract machine works (which is non trivial) and the optimizations (which are quite complex nowadays). To some lesser extent, this is also the case for heavily optimizing C or C++ compilers, where it becomes harder to know when the optimization was triggered or not.</p>\n\n<p>Ultimately, an experienced programmer (in Haskell, C, C++, or anything else) will come to understand the basic optimizations of their compiler, and the basic mechanisms abstract machine which is being used. However, this is not something which is easy to master, I think.</p>\n\n<p>In the question, it is mentioned that WHNF reduction could be performed at compile time. This is only partially true, since the value of the variables originating from IO actions can not be known until runtime, so reduction can only happen at runtime when it involves those values. Further, performing reduction can also make performance worse! E.g.</p>\n\n<pre><code>let x = complex computation in x + x\n-- vs\ncomplex computation + complex computation\n</code></pre>\n\n<p>The latter is the result of reducing the former, but it duplicates work! Indeed, most abstract machines use a lazy reduction approach that makes <code>x</code> to be computed only once in such cases.</p>\n"}], "owner": {"reputation": 768, "user_id": 8306896, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/924e40b39a2f51489d438fd284a9dd3f?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek", "link": "https://stackoverflow.com/users/8306896/abhishek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 47485554, "answer_count": 1, "score": 4, "last_activity_date": 1511683264, "creation_date": 1511596408, "last_edit_date": 1511596695, "question_id": 47483773, "link": "https://stackoverflow.com/questions/47483773/does-the-whnf-reduction-in-haskell-happen-at-compile-time", "title": "Does the WHNF reduction in Haskell happen at Compile time?", "body": "<p>AFAIU the object file generated by <code>Haskell compiler</code> should be machine code. So does that object file have a representation of the original <code>AST</code> and reduces it at run time or does this reduction happen at compile time and only final <code>WHNF</code> values are converted to the corresponding machine code.</p>\n\n<p>I understand the compilation time of latter would be a function of the time complexity of program itself which I think is less likely.</p>\n\n<p>Can someone give a clear explanation of what happens at run time and what happens at compile time in the case of <code>Haskell (GHC)</code>?</p>\n"}, {"tags": ["haskell", "functional-programming", "ghc", "quantum-computing"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1511591205, "post_id": 47483121, "comment_id": 81921195, "body": "What version of GHC are you using? Quipper uses a lot of advanced type-level machinery that is a bit brittle to GHC versions. I remember trying to patch Quipper to run on 7.10 and my errors were similar. AFAIK, 7.10 simple doesn&#39;t work with Quipper..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511592774, "post_id": 47483121, "comment_id": 81921486, "body": "I don&#39;t know anything about Quipper but the error suggest adding a <code>Proxy s</code> arg to <code>q_data_promotec</code> might help. Alternatively, you may use AmbiguousTypes, but this would require also using TypeApplications to specify the ambiguous type at every use site. Depending on what the entire body of code looks like, one or the other may be more convenient for you."}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511629699, "post_id": 47483121, "comment_id": 81931954, "body": "Alec well the version I have apparently is 7.10.3: <code>ghc:amd64&#47;xenial 7.10.3-7 uptodate</code>. I followed the instructions on <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/#linux\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/install_and_upgrade/#linux</a> and ran <code>stack setup</code>, which installed ghc 8.0.2. But when the problem above persisted, and when I checked the version of GHC again it still shows as 7.10.3 WTH?!"}, {"owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "edited": false, "score": 0, "creation_date": 1511630029, "post_id": 47483121, "comment_id": 81932061, "body": "User24 this is my first time programming in haskell, so I&#39;m not completely sure where I add the arg to"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511728097, "post_id": 47483121, "comment_id": 81956902, "body": "@NathanGoedeke Unfortunately, if you aren&#39;t familiar with some of the more advanced type level features of Haskell (and to be familiar with these, you must be familiar with the basics, of course) you&#39;ll find it very difficult to use a library which makes use of such advanced type level features."}], "owner": {"reputation": 93, "user_id": 6088543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-0eOzu6Dd59g/AAAAAAAAAAI/AAAAAAAAAGY/N_foPAPYFVg/photo.jpg?sz=128", "display_name": "Nathan Goedeke", "link": "https://stackoverflow.com/users/6088543/nathan-goedeke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1511589908, "creation_date": 1511589908, "question_id": 47483121, "link": "https://stackoverflow.com/questions/47483121/errors-compiling-a-ghc-program-in-quipper", "title": "Errors compiling a GHC program in Quipper", "body": "<p>I am trying to compile a program in Quipper, the official Quantum Programming Language from this site:\n<a href=\"http://mathstat.dal.ca/~selinger/quipper/\" rel=\"nofollow noreferrer\">http://mathstat.dal.ca/~selinger/quipper/</a></p>\n\n<p>I am having trouble getting it to compile, which I assume must be a problem related to GHC or Haskell, as Quipper itself has no outstanding bugs.</p>\n\n<p>I compile my program using these commands:</p>\n\n<pre><code>cd ~/quipper-0.8/quipper/scripts/\nsudo ./quipper ~/quipper-0.8/tests/name.hs\n</code></pre>\n\n<p>The error I receive looks like this:</p>\n\n<pre><code>[13 of 21] Compiling Quipper.QData    ( ../../quipper/Quipper/QData.hs, ../../quipper/Quipper/QData.o )\n\n../../quipper/Quipper/QData.hs:965:20:\nCould not deduce (QCType Bool Bool s0\n                  ~ QCType Int Bool (QCType Bit Bit s))\nfrom the context (QData s)\n  bound by the type signature for\n             qdata_promote_c :: QData s =&gt;\n                                BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n  at ../../quipper/Quipper/QData.hs:965:20-71\nNB: \u2018QCType\u2019 is a type function, and may not be injective\nThe type variable \u2018s0\u2019 is ambiguous\nExpected type: BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n  Actual type: BType s0 -&gt; CType s0 -&gt; ErrMsg -&gt; BType s0\nIn the ambiguity check for the type signature for \u2018qdata_promote_c\u2019:\n  qdata_promote_c :: forall s.\n                     QData s =&gt;\n                     BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\nTo defer the ambiguity check to use sites, enable AllowAmbiguousTypes\nIn the type signature for \u2018qdata_promote_c\u2019:\n  qdata_promote_c :: (QData s) =&gt;\n                     BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n</code></pre>\n\n<p>The referenced line of code in <code>QData.hs</code> looks like this:</p>\n\n<pre><code>-- | Like 'qdata_promote', except take a piece of classical data.\nqdata_promote_c :: (QData s) =&gt; BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\nqdata_promote_c b c s = qdata_promote b q s where\nq = qdata_map (shapetype_c c) map_qubit c\n\nmap_qubit :: Bit -&gt; Qubit\nmap_qubit = const qubit\n</code></pre>\n\n<p>Apparently that's the only part of the code it has a problem with in <code>QData.hs</code>, but when I comment it out I get this error:</p>\n\n<pre><code>[13 of 21] Compiling Quipper.QData    ( ../../quipper/Quipper/QData.hs, ../../quipper/Quipper/QData.o )\n[14 of 21] Compiling Quipper.Generic  ( ../../quipper/Quipper/Generic.hs, ../../quipper/Quipper/Generic.o )\n\n../../quipper/Quipper/Generic.hs:257:13:\nNot in scope: \u2018qdata_promote_c\u2019\nPerhaps you meant one of these:\n  \u2018qdata_promote\u2019 (imported from Quipper.QData),\n  \u2018qcdata_promote\u2019 (imported from Quipper.QData)\n</code></pre>\n\n<p>As you can see, this time it accepted <code>[13 of 21]</code> but broke on 14, as it depended on the function I commented out. When I try to follow its suggestion, and add AllowAmbiguousTypes:</p>\n\n<pre><code>sudo ./quipper ~/quipper-0.8/tests/name.hs -XAllowAmbiguousTypes\n</code></pre>\n\n<p>I get much more errors:</p>\n\n<pre><code>[13 of 21] Compiling Quipper.QData    ( ../../quipper/Quipper/QData.hs, ../../quipper/Quipper/QData.o )\n\n../../quipper/Quipper/QData.hs:966:25:\nCould not deduce (QCType\n                    Bool Bool (QCType Qubit Qubit (QCType Qubit Qubit s0))\n                  ~ QCType Int Bool (QCType Bit Bit s))\nfrom the context (QData s)\n  bound by the type signature for\n             qdata_promote_c :: QData s =&gt;\n                                BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n  at ../../quipper/Quipper/QData.hs:965:20-71\nNB: \u2018QCType\u2019 is a type function, and may not be injective\nThe type variable \u2018s0\u2019 is ambiguous\nExpected type: BType s\n  Actual type: BType (HType Qubit s0)\nRelevant bindings include\n  q :: HType Qubit s0 (bound at ../../quipper/Quipper/QData.hs:967:3)\n  c :: CType s (bound at ../../quipper/Quipper/QData.hs:966:19)\n  b :: BType s (bound at ../../quipper/Quipper/QData.hs:966:17)\n  qdata_promote_c :: BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n    (bound at ../../quipper/Quipper/QData.hs:966:1)\nIn the expression: qdata_promote b q s\nIn an equation for \u2018qdata_promote_c\u2019:\n    qdata_promote_c b c s\n      = qdata_promote b q s\n      where\n          q = qdata_map (shapetype_c c) map_qubit c\n          map_qubit :: Bit -&gt; Qubit\n          map_qubit = const qubit\n\n../../quipper/Quipper/QData.hs:967:30:\nCould not deduce (QCType Bit Bit s0 ~ QCType Bit Bit s)\nfrom the context (QData s)\n  bound by the type signature for\n             qdata_promote_c :: QData s =&gt;\n                                BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n  at ../../quipper/Quipper/QData.hs:965:20-71\nNB: \u2018QCType\u2019 is a type function, and may not be injective\nThe type variable \u2018s0\u2019 is ambiguous\nExpected type: CType s0\n  Actual type: CType s\nRelevant bindings include\n  q :: HType Qubit s0 (bound at ../../quipper/Quipper/QData.hs:967:3)\n  c :: CType s (bound at ../../quipper/Quipper/QData.hs:966:19)\n  b :: BType s (bound at ../../quipper/Quipper/QData.hs:966:17)\n  qdata_promote_c :: BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n    (bound at ../../quipper/Quipper/QData.hs:966:1)\nIn the first argument of \u2018shapetype_c\u2019, namely \u2018c\u2019\nIn the first argument of \u2018qdata_map\u2019, namely \u2018(shapetype_c c)\u2019\n\n../../quipper/Quipper/QData.hs:967:43:\nCould not deduce (QCType Bit Bit (QCType Qubit Qubit s0)\n                  ~ QCType Bit Bit s)\nfrom the context (QData s)\n  bound by the type signature for\n             qdata_promote_c :: QData s =&gt;\n                                BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n  at ../../quipper/Quipper/QData.hs:965:20-71\nNB: \u2018QCType\u2019 is a type function, and may not be injective\nThe type variable \u2018s0\u2019 is ambiguous\nExpected type: HType Bit s0\n  Actual type: CType s\nRelevant bindings include\n  q :: HType Qubit s0 (bound at ../../quipper/Quipper/QData.hs:967:3)\n  c :: CType s (bound at ../../quipper/Quipper/QData.hs:966:19)\n  b :: BType s (bound at ../../quipper/Quipper/QData.hs:966:17)\n  qdata_promote_c :: BType s -&gt; CType s -&gt; ErrMsg -&gt; BType s\n    (bound at ../../quipper/Quipper/QData.hs:966:1)\nIn the third argument of \u2018qdata_map\u2019, namely \u2018c\u2019\nIn the expression: qdata_map (shapetype_c c) map_qubit c\n</code></pre>\n\n<p>Which all stems from the exact same line I quoted above from <code>QData.hs</code>. Note none of these errors apparently has anything to do with my own code in <code>name.hs</code>. </p>\n\n<p>I've noticed this site doesn't have direct help from Quipper (and I've emailed both people in charge of Quipper with no response), but I'm pretty sure this is a problem from the way I'm compiling it, as these error messages don't come from Quipper but from GHC or Haskell. </p>\n\n<p>So anyway, any help to get to the bottom of this would be appreciated,\nNathan</p>\n"}, {"tags": ["list", "function", "haskell", "boolean"], "comments": [{"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1511584192, "post_id": 47482598, "comment_id": 81920055, "body": "If you added $ before tail your original version would work. Application is left-associative."}, {"owner": {"reputation": 11, "user_id": 6866450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d866800cf83bf1b32e0e381d77a2355f?s=128&d=identicon&r=PG&f=1", "display_name": "Elmangos", "link": "https://stackoverflow.com/users/6866450/elmangos"}, "reply_to_user": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1511585303, "post_id": 47482598, "comment_id": 81920211, "body": "I added that and I am now getting this error.       Parse error: naked expression at top level     Perhaps you intended to use TemplateHaskell"}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1511585465, "post_id": 47482598, "comment_id": 81920237, "body": "Haven&#39;t you forgot about proper indentation?"}, {"owner": {"reputation": 11, "user_id": 6866450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d866800cf83bf1b32e0e381d77a2355f?s=128&d=identicon&r=PG&f=1", "display_name": "Elmangos", "link": "https://stackoverflow.com/users/6866450/elmangos"}, "reply_to_user": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1511585933, "post_id": 47482598, "comment_id": 81920293, "body": "I wasn&#39;t aware that Haskell required proper indentation. Is it more like Python in that regard?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1511586047, "post_id": 47482598, "comment_id": 81920314, "body": "You&#39;re allowed to use <code>{}</code> to help squash some things into one line (unlike Python), but for the most part proper indentation is required. The rule is that things that are underneath some structure need to be indented more than the surroundings."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1511593122, "post_id": 47482598, "comment_id": 81921567, "body": "note that <code>member = elem :: Int -&gt; [Int] -&gt; Bool</code>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6866450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d866800cf83bf1b32e0e381d77a2355f?s=128&d=identicon&r=PG&f=1", "display_name": "Elmangos", "link": "https://stackoverflow.com/users/6866450/elmangos"}, "edited": false, "score": 0, "creation_date": 1511586507, "post_id": 47482756, "comment_id": 81920380, "body": "When I use this I get the error:                                                                       \u2022 Couldn&#39;t match expected type \u2018IO t2\u2019 with actual type \u2018Bool\u2019                          \u2022 In the expression: main       When checking the type of the IO action \u2018main\u2019"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1511586585, "post_id": 47482756, "comment_id": 81920393, "body": "That&#39;s because you wrote your <code>main</code> incorrectly. This implementation of <code>element</code> is fine."}, {"owner": {"reputation": 11, "user_id": 6866450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d866800cf83bf1b32e0e381d77a2355f?s=128&d=identicon&r=PG&f=1", "display_name": "Elmangos", "link": "https://stackoverflow.com/users/6866450/elmangos"}, "edited": false, "score": 0, "creation_date": 1511587370, "post_id": 47482756, "comment_id": 81920519, "body": "What should the main function look like for this? I currently just have main = do member 1 [1 2 3]"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1511587767, "post_id": 47482756, "comment_id": 81920601, "body": "If you know what a monad is: <code>main</code> needs to be an <code>IO ()</code>; it can&#39;t just be a <code>Bool</code> (and <code>do</code>-notation will start throwing a fit if you mix <code>IO</code> values and pure ones). If you don&#39;t: <code>main = print $ member 1 [1,2,3]</code>"}, {"owner": {"reputation": 11, "user_id": 6866450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d866800cf83bf1b32e0e381d77a2355f?s=128&d=identicon&r=PG&f=1", "display_name": "Elmangos", "link": "https://stackoverflow.com/users/6866450/elmangos"}, "edited": false, "score": 0, "creation_date": 1511589208, "post_id": 47482756, "comment_id": 81920830, "body": "I added this and it did fix the problems, but I am looking at it and do not completely understand it. Where it says <code>member x (y:ys)</code> what exactly is meant by the <code>y:ys</code> piece. I have seen this when searching this problem before, but just do not understand completely what it means. Is that some way to call the tail function on the list of y? Or am I misunderstanding?"}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "reply_to_user": {"reputation": 11, "user_id": 6866450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d866800cf83bf1b32e0e381d77a2355f?s=128&d=identicon&r=PG&f=1", "display_name": "Elmangos", "link": "https://stackoverflow.com/users/6866450/elmangos"}, "edited": false, "score": 0, "creation_date": 1511590065, "post_id": 47482756, "comment_id": 81920991, "body": "@Elmangos This is using pattern matching. Argument 2 is a list, and on the first function definition we match it with the empty list. If it&#39;s not an empty list, then it&#39;s an item (<code>y</code>), and another list (<code>ys</code>). <code>ys</code> is the tail of the list. If the inputted list was <code>[1,2,3,4]</code>, then <code>y == 1</code> and <code>ys == [2,3,4]</code>."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1511586042, "creation_date": 1511586042, "answer_id": 47482756, "question_id": 47482598, "link": "https://stackoverflow.com/questions/47482598/member-function-in-haskell/47482756#47482756", "title": "Member Function in Haskell", "body": "<p>with pattern matching you can write it more clearly</p>\n\n<pre><code>member :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool\nmember x [] = False\nmember x (y:ys) | x==y = True\n                | otherwise = member x ys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 3, "last_activity_date": 1511587400, "last_edit_date": 1511587400, "creation_date": 1511586769, "answer_id": 47482821, "question_id": 47482598, "link": "https://stackoverflow.com/questions/47482598/member-function-in-haskell/47482821#47482821", "title": "Member Function in Haskell", "body": "<pre><code>element _ [] = False\nelement e (x:xs) = e == x || e `element` xs\n-- OR\nelement e xs = if xs == [] then False\n               else if e == head xs then True\n                    else e `element` tail xs\n-- OR\nelement e xs = xs /= [] &amp;&amp; (e == head xs || e `element` tail xs)\n-- x `op` y = op x y\n\n-- If you're feeling cheeky\nelement = elem\n</code></pre>\n\n<p>Your syntax appears very confused, but your logic makes sense, so here's a bucket list of things to remember:</p>\n\n<ul>\n<li><p>Functions can be defined by multiple equations. Equations are checked top to bottom. That means using <code>=</code>.</p></li>\n<li><p>Pattern matches <em>are not</em> equality tests. A pattern match breaks a value into its constituents if it matches and fails otherwise. An equality test <code>x == y</code> returns a <code>Bool</code> about the equality of <code>x</code> and <code>y</code>.</p></li>\n<li><p>Pattern matching is used for flow control via...</p>\n\n<ul>\n<li><p>a <code>case</code> statement, like</p>\n\n<pre><code>case xs of {\n     [] -&gt;    ...\n     x:xs' -&gt; ...\n}\n</code></pre></li>\n<li><p>Multiple equations, like</p>\n\n<pre><code>element _ []     = ...\nelement e (x:xs) = ...\n</code></pre>\n\n<p>Note that you can ignore a value in a pattern with <code>_</code>. With multiple equations of a function with multiple arguments, you're really pattern matching on all the arguments at once.</p></li>\n</ul></li>\n<li><p><code>Bool</code>s are used for flow control via <code>if _ then _ else _</code>:</p>\n\n<pre><code>if xs == [] then False\n            else True\n</code></pre>\n\n<p>which is really just</p>\n\n<pre><code>case x == y of {\n     True  -&gt; False\n     False -&gt; True\n}\n</code></pre>\n\n<p>and <code>Bool</code>s can use the ordinary operators <code>(&amp;&amp;)</code> (<code>infixr 3</code>) and <code>(||)</code> (<code>infixr 2</code>)</p></li>\n<li><p>The difference is especially nefarious on lists. <code>instance Eq a =&gt; Eq [a]</code>, so in order to use <code>==</code> on lists, you need to know that the elements of the lists can be compared for equality, too. This is true even when you're just checking <code>(== [])</code>. <code>[] == []</code> actually causes an error, because the compiler cannot tell what type the elements are. Here it doesn't matter, but if you say, e.g. <code>nonEmpty xs = xs /= []</code>, you'll get <code>nonEmpty :: Eq a =&gt; [a] -&gt; Bool</code> instead of <code>nonEmpty :: [a] -&gt; Bool</code>, so <code>nonEmpty [not]</code> gives a type error when it should be <code>True</code>.</p></li>\n<li><p>Function application has the highest precedence, and is left-associative:</p>\n\n<ul>\n<li><code>element x xs</code> reads as <code>((element x) xs)</code></li>\n<li><code>element x tail xs</code> reads as <code>(((element x) tail) xs)</code>, which doesn't make sense here</li>\n</ul></li>\n<li><p><code>f $ x = f x</code>, but it's <code>infixr 0</code>, which means it basically reverses the rules and acts like a big set of parentheses around its right argument</p>\n\n<ul>\n<li><code>element x $ tail xs</code> reads as <code>((element x) (tail xs))</code>, which works</li>\n</ul></li>\n<li><p>Infix functions always have lower precedence than prefix application:</p>\n\n<ul>\n<li><code>x `element` tail xs</code> means <code>((element x) (tail xs))</code>, too</li>\n</ul></li>\n<li><p><code>let decls in expr</code> is an <em>expression</em>. <code>decls</code> is only in scope inside <code>expr</code>, and the entire thing evaluates to whatever <code>expr</code> evaluates to. It makes no sense on the top level.</p></li>\n<li><p>Haskell uses indentation to structure code, like Python. <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">Reference</a></p></li>\n</ul>\n"}], "owner": {"reputation": 11, "user_id": 6866450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d866800cf83bf1b32e0e381d77a2355f?s=128&d=identicon&r=PG&f=1", "display_name": "Elmangos", "link": "https://stackoverflow.com/users/6866450/elmangos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3087, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1511587400, "creation_date": 1511583854, "question_id": 47482598, "link": "https://stackoverflow.com/questions/47482598/member-function-in-haskell", "title": "Member Function in Haskell", "body": "<p>Working on a small assignment for class, having a lot of trouble with Haskell. I am trying to make a recursive method for finding if an integer is part of a list or not. I know the gist, but am unable to get it working correctly with the haskell syntax. Check if the current list is empty, if so then False, then check if integer is equal to the head of the current list, if so, then True, then call member again with the same value you are searching for, and the tail of the list. What can I do to get this functioning properly. </p>\n\n<p>Currently this is what I have:</p>\n\n<pre><code>member ::Int -&gt; [Int] -&gt; Bool\nmember x y\nif y [] then False\nelse if x == head y then True\nelse member x tail y\n</code></pre>\n\n<p>I have also tried using </p>\n\n<pre><code>member :: (Eq x) =&gt; x -&gt; [x] -&gt; Bool\n</code></pre>\n\n<p>as the beginning line, and also a much simplier :</p>\n\n<pre><code>let member x y =  if null y then False\nelse if x == head y then True\nelse member x tail y\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "state", "records"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511575793, "post_id": 47482011, "comment_id": 81918903, "body": "When you say <code>State</code> is this from <code>Control.Monad.Trans.State</code> from the transformers library or a different module?"}, {"owner": {"reputation": 21, "user_id": 6411999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eb51d9f1be596a0e65ea8b726e6c048?s=128&d=identicon&r=PG&f=1", "display_name": "DRutherford", "link": "https://stackoverflow.com/users/6411999/drutherford"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511575948, "post_id": 47482011, "comment_id": 81918926, "body": "I&#39;m using Control.Monad.State"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6411999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eb51d9f1be596a0e65ea8b726e6c048?s=128&d=identicon&r=PG&f=1", "display_name": "DRutherford", "link": "https://stackoverflow.com/users/6411999/drutherford"}, "edited": false, "score": 0, "creation_date": 1511576492, "post_id": 47482067, "comment_id": 81919000, "body": "Ahh, I see. The record syntax was really confusing to me, since I&#39;ve only ever seriously coded in C#, Python, and JavaScript. So, if I wanted to evaluate the value later on (to see if the player is dead), how would that syntax look in an if, then, else context?"}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 4, "last_activity_date": 1511576939, "last_edit_date": 1511576939, "creation_date": 1511576299, "answer_id": 47482067, "question_id": 47482011, "link": "https://stackoverflow.com/questions/47482011/altering-value-of-a-record-in-haskell/47482067#47482067", "title": "Altering value of a record in Haskell", "body": "<p>First, <code>defaultStats :: PlayerStats</code>, which is a record, not a function, so:</p>\n\n<pre><code>defaultStats health\n</code></pre>\n\n<p>doesn't make sense.  On the other hand, <code>health :: PlayerStats -&gt; Health</code> is a function, so</p>\n\n<pre><code>health defaultStats\n</code></pre>\n\n<p>makes more sense, but is essentially the constant <code>100</code>, since that is the <code>health</code> of a <code>defaultStats</code>.  However, in this case, it doesn't make sense, since you immediately introduce a new <code>h</code>, bound to <code>get</code>, which (assuming <code>State</code> is <code>Control.Monad.Trans.State</code>), gets the current <code>PlayerStats</code> from the <code>State</code> <code>Monad</code>.  Note that <code>h</code> will be the whole <code>PlayerStats</code>, not just the <code>health</code> component.</p>\n\n<p>Record update really creates a new record from an existing one with one or more fields replaced with new values.  In this case, you wish to replace the <code>health</code> field with the current value minus <code>10</code>:</p>\n\n<pre><code>takeDamage = do\n  ps &lt;- get\n  put $ ps { health = health ps - 10 }\n</code></pre>\n\n<p>Here, we get the current <code>PlayerStats</code> from the <code>State</code> <code>Monad</code> as <code>ps</code>, and then <code>put</code> a new <code>PlayerStats</code> based on the current one, but with the <code>health</code> field set to the current <code>health</code> minus <code>10</code>.  In the record update syntax, the <code>health</code> on the left of the <code>=</code> refers to the field name, and the <code>health</code> on the right refers to the accessor function that gets the <code>health</code> field from an existing record.</p>\n\n<p>The <code>get</code> followed by <code>put</code> is common enough that there's a <code>modify</code> function that takes a function that transforms the state, and wraps it with the <code>get</code> and <code>put</code>:</p>\n\n<pre><code>takeDamage = modify $ \\ps -&gt; ps { health = health ps - 10 }\n</code></pre>\n\n<p>Record update syntax is a huge Haskell wart.  You might want to check out <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lenses</a>, which make updating fields in a <code>State</code> <code>Monad</code> very easy (although the error messages you get when you mess up will make your brain melt).</p>\n\n<p><strong>Edit</strong></p>\n\n<p>If you want to see if your player lost all health, you can have the <code>takeDamage</code> function return a <code>Bool</code> indicating if the player survived:</p>\n\n<pre><code>takeDamage :: State PlayerStats Bool\ntakeDamage = do\n  ps &lt;- get\n  let health' = health ps - 10\n  put $ ps { health = health' } -- update health even if dead!\n  return (health' &gt; 0)\n\nplayRound :: State PlayerStats ()\nplayRound = do\n  survived &lt;- takeDamage\n  if survived\n    then do\n      ...\n    else do\n      ...\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6411999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eb51d9f1be596a0e65ea8b726e6c048?s=128&d=identicon&r=PG&f=1", "display_name": "DRutherford", "link": "https://stackoverflow.com/users/6411999/drutherford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 495, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1511576939, "creation_date": 1511575494, "question_id": 47482011, "link": "https://stackoverflow.com/questions/47482011/altering-value-of-a-record-in-haskell", "title": "Altering value of a record in Haskell", "body": "<p>I'm pretty new to Haskell and to practice, I've decided to make a d&amp;d style game where the battles are based on dice rolls, and whoever has the bigger number wins. However, I'm a bit confused on how to change the value of my records and change the global value of the record.</p>\n\n<p>Here is my record code: </p>\n\n<pre><code>data PlayerStats = PlayerStats { health :: Health\n                              ,mana :: Mana\n                              ,inventory :: [Items]   }deriving (Show,Eq)\n\n\n\n\ndefaultStats = PlayerStats {health = 100, mana = 50, inventory = []}\n</code></pre>\n\n<p>And here is my function to take damage if the player loses the dice roll: </p>\n\n<pre><code>takeDamage:: State PlayerStats ()\ntakeDamage = do\n         let h = defaultStats health \n         h &lt;- get\n         put $ (h - 10)\n</code></pre>\n\n<p>I've looked all over the internet for a solution to a problem like mine, but haven't found anything, so I think this could be useful to other people in my situation.</p>\n"}, {"tags": ["arrays", "haskell", "shuffle"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511579458, "post_id": 47481797, "comment_id": 81919400, "body": "&#39;my attempts are coming up short.&#39; - include your attempts."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511587515, "post_id": 47481797, "comment_id": 81920550, "body": "You should find it simpler if you reverse the order of your monads. Don&#39;t run random, instead runST and assume the random is the inner part of the monad - this should help since there is no ST transformer in base (though <a href=\"https://hackage.haskell.org/package/STMonadTrans-0.4.3\" rel=\"nofollow noreferrer\">one exists</a>) while there are lots of random monad transformers including State transformers and in the monad random package."}], "answers": [{"comments": [{"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "edited": false, "score": 0, "creation_date": 1511678762, "post_id": 47483239, "comment_id": 81942459, "body": "Thank you for the very thorough explanation. My main question is to do with the use of a concrete transformer stack, rather than a &#39;capability-based&#39; definition a la mtl. Is it possible to write this in such a way, or am I forced into a concrete stack as you&#39;ve described in this case? This has been my primary issue here, as I have no idea how to make such a &#39;capability-based&#39; definition run."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "edited": false, "score": 1, "creation_date": 1511714079, "post_id": 47483239, "comment_id": 81952003, "body": "@KozRoss Yes that is doable, see my edit. FWIW, I rarely want such a general thing since when I write monad stacks I&#39;m usually making a program and not a library."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1511714032, "last_edit_date": 1511714032, "creation_date": 1511591255, "answer_id": 47483239, "question_id": 47481797, "link": "https://stackoverflow.com/questions/47481797/combining-monadrandom-with-st-computations-in-a-stack/47483239#47483239", "title": "Combining MonadRandom with ST computations in a stack", "body": "<p>I have two suggestions for you:</p>\n\n<ul>\n<li>Select the right monad nesting.</li>\n<li>Separate out your monad implementation from the logic of the algorithm.</li>\n</ul>\n\n<p>You are trying to run the random monad last and use the ST internally, thus you need the ST to be a sort of monad transformer.  Decide what your monad stack looks like - which monad is the transformer and which is the inner monad?  The easy thing to do is make the ST monad the inner monad and the random monad the transformer (easy just because you have all the needed packages already).</p>\n\n<p>Now make a small set of helper functions.  It won't really pay off here -\n the payoff is large for complex projects.  Here's the monad stack and helpers I came up with:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Main where\n\nimport System.Random (StdGen)\nimport Control.Monad.Random\nimport Control.Monad.Primitive\nimport Control.Monad.ST\n\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as MV\n\n\ntype KozM s a = RandT StdGen (ST s) a\n</code></pre>\n\n<p>Notice the transformer is <code>RandT</code> and the inner monad of <code>ST s</code>.</p>\n\n<pre><code>rnd :: (Int,Int) -&gt; KozM s Int\nrnd = getRandomR\n\nswp :: MV.MVector s a -&gt; Int -&gt; Int -&gt; KozM s ()\nswp v i j = lift (MV.swap v i j)\n\nfreeze :: MV.MVector s a -&gt; KozM s (V.Vector    a)\nthaw   :: V.Vector     a -&gt; KozM s (MV.MVector s a)\nfreeze = lift . V.freeze\nthaw   = lift . V.thaw\n</code></pre>\n\n<p>All the operations you need to mutate the vector.  Now we just need to <em>run</em> this monad so we can somehow escape to another useful context. I noticed you previously hard-coded an RNG (42) - I use a random one but whichever...</p>\n\n<pre><code>run :: (forall s. KozM s a) -&gt; IO a -- Can be just `a` if you hard-code\n                                    -- an RNG as done in the question\nrun m = do g &lt;- newStdGen\n           pure (runST (evalRandT m g))\n</code></pre>\n\n<p>Finally we can use this monad to implement f-y:</p>\n\n<pre><code>fisherYates :: MV.MVector s a -&gt; KozM s ()\nfisherYates v = forM_ [0 .. l - 1] (\\i -&gt; do j &lt;- rnd (i, l)\n                                             swp v i j)\n  where l = MV.length v - 1\n</code></pre>\n\n<p>At this point you might not be feeling like you learned anything, hopefully the run function was helpful but I can see how you might feel this is getting verbose.  The important thing to take note of here is how clean the rest of your code can be if you handle the plumbing of the monad above so you don't have <code>lift</code> and module qualifiers polluting the logic of the possibly complex thing you actually set-out to solve.</p>\n\n<p>That said, here's the underwhelming shuffle:</p>\n\n<pre><code>shuffle :: V.Vector a -&gt; KozM s (V.Vector a)\nshuffle v = do\n    vm &lt;- thaw v\n    fisherYates vm\n    freeze vm\n</code></pre>\n\n<p>The type is important.  You had previously called <code>evalRand</code> on shuffle which implied it would be some sort of <code>MonadRandom m</code> and simultaneously have to call <code>runST</code> - a conflation of the monad logic and the algorithm logic that just hurts the brain.</p>\n\n<p>The main is uninteresting:</p>\n\n<pre><code>main :: IO ()\nmain = print =&lt;&lt; (run (shuffle (V.generate 10 id)) :: IO (V.Vector Int))\n</code></pre>\n\n<p>EDIT: yes you can do this while keeping the methods more general.  At some point you need to specify which monad you run or you can't have a main that will execute it, but all the logic can be general using MonadRandom and PrimMonad.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Main where\n\nimport System.Random (StdGen)\nimport Control.Monad.Random\nimport Control.Monad.Primitive\nimport Control.Monad.ST\n\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as MV\ntype KozM s a = RandT StdGen (ST s) a\n\nrnd  :: MonadRandom m =&gt; (Int, Int) -&gt; m Int\nrnd = getRandomR\n\nswp :: PrimMonad m =&gt; MV.MVector (PrimState m)  a -&gt; Int -&gt; Int -&gt; m ()\nswp v i j = MV.swap v i j\n\n-- freeze :: MV.MVector s a -&gt; KozM s (V.Vector    a)\n-- thaw   :: V.Vector     a -&gt; KozM s (MV.MVector s a)\nfreeze :: PrimMonad m =&gt; MV.MVector (PrimState m) a -&gt; m (V.Vector a)\nthaw :: PrimMonad m =&gt; V.Vector a -&gt; m (MV.MVector (PrimState m) a)\nfreeze = V.freeze\nthaw   = V.thaw\n\n\n-- Some monad libraries, like monadlib, have a generalized `run` class method.\n-- This doesn't exist, to the best of my knowledge, for the intersection of ST\n-- and mtl.\nrun :: (forall s. KozM s a) -&gt; IO a -- Can be just `a` if you hard-code\n                                    -- an RNG as done in the question\nrun m = do g &lt;- newStdGen\n           pure (runST (evalRandT m g))\n\n-- fisherYates :: MV.MVector s a -&gt; KozM s ()\nfisherYates :: (MonadRandom m, PrimMonad m) =&gt; MV.MVector (PrimState m) a -&gt; m ()\nfisherYates v = forM_ [0 .. l - 1] (\\i -&gt; do j &lt;- rnd (i, l)\n                                             swp v i j)\n  where l = MV.length v - 1\n\nshuffle :: (MonadRandom m, PrimMonad m) =&gt; V.Vector a -&gt; m (V.Vector a)\nshuffle v = do\n    vm &lt;- thaw v\n    fisherYates vm\n    freeze vm\n\nmain :: IO ()\nmain = print =&lt;&lt; (run (shuffle (V.generate 10 id)) :: IO (V.Vector Int))\n</code></pre>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 47483239, "answer_count": 1, "score": 2, "last_activity_date": 1511714032, "creation_date": 1511572496, "question_id": 47481797, "link": "https://stackoverflow.com/questions/47481797/combining-monadrandom-with-st-computations-in-a-stack", "title": "Combining MonadRandom with ST computations in a stack", "body": "<p>I'm trying to write the <a href=\"https://en.wikipedia.org/wiki/Fisher-Yates_Shuffle#The_modern_algorithm\" rel=\"nofollow noreferrer\">Fisher-Yates</a> shuffle using mutable arrays. So far, I have the following code:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad.Random\nimport Control.Monad.Primitive\nimport Control.Monad.ST\n\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as MV\n\nfisherYates :: (MonadRandom m, PrimMonad m) =&gt; MV.MVector (PrimState m) a -&gt; m ()\nfisherYates v = forM_ [0 .. l - 1] (\\i -&gt; do j &lt;- getRandomR (i, l)\n                                             MV.swap v i j)\n  where l = MV.length v - 1\n\nshuffle :: MonadRandom m =&gt; V.Vector a -&gt; m (V.Vector a)\nshuffle v = _ -- don't know how to write this\n\nmain :: IO ()\nmain = print . evalRand (shuffle . V.generate 10 $ id) $ mkStdGen 42\n</code></pre>\n\n<p>However, I am totally unsure how to define <code>shuffle</code>, which is meant to be a 'high-level wrapper' around the mutable vector operations. It seems (at least from my understanding), that I first have to 'run' the random 'part' of the stack, save the state, run the ST 'part' to get out an immutable vector, and then rewrap the whole thing. Additionally, I know I have to make use of <code>thaw</code> somewhere, but my attempts are coming up short. Could someone please tell me what I'm missing, and how I can do what I want?</p>\n"}, {"tags": ["haskell", "random", "lazy-evaluation"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1511565910, "post_id": 47481041, "comment_id": 81917148, "body": "What is the state of the random number generator after running it an infinite number of times? I believe that is essentially what you are asking for when you try to get <code>g1</code>."}], "answers": [{"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 3, "last_activity_date": 1511568475, "creation_date": 1511568475, "answer_id": 47481438, "question_id": 47481041, "link": "https://stackoverflow.com/questions/47481041/getrandom-hangs-the-second-time-around-why/47481438#47481438", "title": "getRandom hangs the second time around. Why?", "body": "<p>Asking for the value of <code>g1</code> essentially asks for the state of the random number generator after it runs for an infinite number of times</p>\n\n<p>You can get an idea that this is the case from specializing the type signature of <code>sequence</code>:</p>\n\n<pre><code>sequence :: [Rand g Int] -&gt; Rand g [Int]\n</code></pre>\n\n<p>The <code>Int</code> list it gives is infinite but it gives back a <em>single</em> random number generator state (the <code>g</code> in the signature). This would have to be the state of the generator after running it enough times to get all the <code>Int</code>s in the list (here, an infinite number of times).</p>\n"}], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 47481438, "answer_count": 1, "score": 1, "last_activity_date": 1511568475, "creation_date": 1511564776, "last_edit_date": 1511565080, "question_id": 47481041, "link": "https://stackoverflow.com/questions/47481041/getrandom-hangs-the-second-time-around-why", "title": "getRandom hangs the second time around. Why?", "body": "<p>The following code hangs when it get to the second runRand.  Why?</p>\n\n<pre><code>import Control.Monad.Random (Rand, getRandom, runRand)\nimport System.Random        (RandomGen, mkStdGen)\n\nrgen :: (RandomGen g) =&gt; Rand g [Int]\nrgen = do\n    r &lt;- sequence (repeat getRandom)\n    return $ take 5 r\n\nmain = do\n  let g0 = mkStdGen 0\n      (i,g1) = runRand rgen g0 \n  print i\n\n  print \"one done\"\n\n  let (j,_) = runRand rgen g1 \n  print j\n</code></pre>\n\n<p>Based on the answer to this question : <a href=\"https://stackoverflow.com/questions/30527699/infinite-random-sequence-loops-with-randomio-but-not-with-getrandom\">Infinite random sequence loops with randomIO but not with getRandom</a> I would have expected the lazy nature of getRandom to allow this program to terminate.</p>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 5, "last_activity_date": 1511573420, "last_edit_date": 1511573420, "creation_date": 1511573075, "answer_id": 47481841, "question_id": 47479802, "link": "https://stackoverflow.com/questions/47479802/understanding-leftover-from-conduit/47481841#47481841", "title": "Understanding &#39;leftover&#39; from conduit", "body": "<p>We must make a distinction between the composition of <code>Conduit</code>s with <code>&gt;&gt;=</code>, and with <code>.|</code>.</p>\n\n<p>With <code>&gt;&gt;=</code>, we are sequencing the actions of two <code>Conduit</code>s that share a common input and a common output stream.</p>\n\n<p>With <code>.|</code>, we are connecting the output stream of one <code>Conduit</code> to the input stream of another.</p>\n\n<p>The <code>leftover</code> function pushes a value into the current position of the current <code>Conduit</code>'s input stream, making it available to other <code>Conduit</code> actions connected to the same input stream (with <code>&gt;&gt;=</code>).  It does not <code>yield</code> anything into the current <code>Conduit</code>'s output stream, which is why <code>sinkList</code> produces the empty list in your example.</p>\n\n<p>If you want to see the effect of <code>leftover</code>, you must perform the <code>sinkList</code> where it can access the same input stream as the <code>leftover</code>:</p>\n\n<pre><code>runConduitPure $ yieldMany [1..2] .| (leftover 5 &gt;&gt; sinkList)\n</code></pre>\n\n<p>This produces <code>[5, 1, 2]</code> (not <code>[1, 2, 5]</code>), because the <code>leftover</code> pushes the <code>5</code> into the input stream before the <code>1</code>, and <code>2</code>, have been consumed.</p>\n\n<p>If we add an <code>await</code> before the <code>leftover</code>:</p>\n\n<pre><code>runConduitPure $ yieldMany [1..2] .| (await &gt;&gt; leftover 5 &gt;&gt; sinkList)\n</code></pre>\n\n<p>then we get <code>[5, 2]</code> because we consume (and discard) the <code>1</code> before doing the <code>leftover</code>.</p>\n\n<p>We could also <code>yield</code> from our <code>leftover</code> <code>Conduit</code>, which will push a value into the output stream to be consumed by another <code>Conduit</code> composed with <code>.|</code>:</p>\n\n<pre><code>runConduitPure $ yieldMany [1..2] .| myLeftoverConduit .| sinkList where\n  myLeftoverConduit = do\n    leftover 5\n    l &lt;- sinkList\n    yield l\n    yield [42]\n</code></pre>\n\n<p>produces <code>[[5, 1, 2], [42]]</code> because we <code>yield</code>ed the result of <code>sinkList</code> (a list), and then <code>yield</code>ed <code>[42]</code> (also a list).  The downstream <code>sinkList</code> then makes a list of these two values.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 47481841, "answer_count": 1, "score": 1, "last_activity_date": 1511573420, "creation_date": 1511556342, "question_id": 47479802, "link": "https://stackoverflow.com/questions/47479802/understanding-leftover-from-conduit", "title": "Understanding &#39;leftover&#39; from conduit", "body": "<p>Why does the following output <code>[]</code>?</p>\n\n<pre><code>\u03bb: &gt;runConduitPure $ yieldMany [1..2] .| leftover 5 .| sinkList\n[]\n</code></pre>\n\n<p>I naively expected it to return: <code>[1,2,5]</code> per <a href=\"https://hackage.haskell.org/package/conduit-1.2.12.1/docs/Data-Conduit.html\" rel=\"nofollow noreferrer\">leftover</a>'s docs:</p>\n\n<blockquote>\n  <p>Provide a single piece of leftover input to be consumed by the next component in the current monadic binding.</p>\n</blockquote>\n"}, {"tags": ["haskell", "haskell-stack", "nixos"], "comments": [{"owner": {"reputation": 10368, "user_id": 435904, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ce3dbd2b9c6693c6472c947e758a0e24?s=128&d=identicon&r=PG", "display_name": "4e6", "link": "https://stackoverflow.com/users/435904/4e6"}, "edited": false, "score": 3, "creation_date": 1511549173, "post_id": 47478520, "comment_id": 81912054, "body": "What nix-channel are you on? Is it updated?"}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1511674132, "post_id": 47478520, "comment_id": 81941793, "body": "<code>$ nix-shell -p stack -I nixpkgs=https:&#47;&#47;github.com&#47;NixOS&#47;nixpkgs&#47;archive&#47;master.tar.&zwnj;&#8203;gz</code> if you want to living on the edge. (<code>-I</code> flag also work on <code>nix-env</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "is_accepted": true, "score": 2, "last_activity_date": 1511566434, "creation_date": 1511566434, "answer_id": 47481228, "question_id": 47478520, "link": "https://stackoverflow.com/questions/47478520/upgrading-stack-on-nixos/47481228#47481228", "title": "Upgrading Stack on NixOS", "body": "<p>The packages listed on <a href=\"https://nixos.org/nixos/packages.html\" rel=\"nofollow noreferrer\">https://nixos.org/nixos/packages.html</a> reflect the current stable release of NixOS, which is currently 17.09.</p>\n\n<p>Stack 1.5.1 became available on that very same release, 17.09. To install Stack 1.5.1 you need to be either on the NixOS unstable branch or on NixOS 17.09. It seems you're currently on NixOS 17.03.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 47481228, "answer_count": 1, "score": 2, "last_activity_date": 1511710020, "creation_date": 1511548561, "last_edit_date": 1511710020, "question_id": 47478520, "link": "https://stackoverflow.com/questions/47478520/upgrading-stack-on-nixos", "title": "Upgrading Stack on NixOS", "body": "<p><strong>Problem:</strong> I am trying to upgrade haskell <code>stack</code> from version <code>1.4.0</code> to <code>.1.5.1</code> in NixOS.</p>\n\n<p>In my <code>configuration.nix</code>:</p>\n\n<pre><code>environment.systemPackages = with pkgs; [\n  # ...\n  stack\n  # ...\n];\n</code></pre>\n\n<p>On <code>nixpkgs</code>, it says that stack should be on version <code>1.5.1</code>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/O452F.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/O452F.png\" alt=\"enter image description here\"></a></p>\n\n<p>Yet:</p>\n\n<pre><code>$ stack --version\nVersion 1.4.0 x86_64\n</code></pre>\n"}, {"tags": ["haskell", "types", "compiler-errors", "functor"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1511541634, "post_id": 47477052, "comment_id": 81909115, "body": "The compiler gives an explanation (i.e. the errors)."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1511546978, "post_id": 47477052, "comment_id": 81911233, "body": "You can fix this in a few ways: change <code>Ok (f a) b</code> to <code>Ok a (f b)</code>; or change <code>Second a b = Ok a b | Ko a b</code> to <code>Second a b = Ok b a | Ko a b</code>; or change to <code>Second a = Ok a a | Ko a a</code> and replace <code>Second x</code> with <code>Second</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511553922, "post_id": 47477052, "comment_id": 81913621, "body": "You might want to make <code>Second</code> a bifunctor instead."}], "answers": [{"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 6, "last_activity_date": 1511543707, "last_edit_date": 1511543707, "creation_date": 1511542192, "answer_id": 47477361, "question_id": 47477052, "link": "https://stackoverflow.com/questions/47477052/double-type-functor-definition-refused/47477361#47477361", "title": "double type Functor definition refused", "body": "<p>If you unpack the definition of <code>Functor</code> you'll see that <code>Second</code>'s first parameter is kept the same, while its second parameter is up for transformation.</p>\n\n<pre><code>class Functor f where\n  fmap :: (s -&gt; t) -&gt; f s -&gt; f t\n</code></pre>\n\n<p>(where I've renamed type variables <code>a</code> and <code>b</code> to <code>s</code> and <code>t</code>, respectively, because you also have value variables <code>a</code> and <code>b</code>.)</p>\n\n<p>That <code>class</code> gives us, in your specific <code>instance</code></p>\n\n<pre><code>instance Functor (Second x) where\n  -- fmap :: (s -&gt; t) -&gt; (Second x) s -&gt; (Second x) t\n  --    i.e. (s -&gt; t) -&gt; Second x s   -&gt; Second x t\n</code></pre>\n\n<p>Now, when you implement <code>fmap</code>, you have to make sure that the <em>users</em> of <code>fmap</code> can choose any <code>x</code>, <code>s</code> and <code>t</code> they want. So you must make no assumptions about them: they stand for arbitrary, possibly different types. That's what the error messages mean when they talk about \"rigid\" type variables: <em>your</em> code is not allowed to choose specific types for them, so that its users can. The compiler is complaining that you are promising a <em>very polymorphic</em> function, but delivering a less polymorphic function which typechecks only when <code>x=s=t</code>.</p>\n\n<p>That is, when you write</p>\n\n<pre><code>  fmap f (Ok a b) = Ok (f a) b\n</code></pre>\n\n<p>you have</p>\n\n<pre><code>f :: s -&gt; t\nOk a b :: Second x s\na :: x\nb :: s\n</code></pre>\n\n<p>and you are returning</p>\n\n<pre><code>Ok (f a) b :: Second x t\n</code></pre>\n\n<p>which would need</p>\n\n<pre><code>f a :: x   -- clearly not true, as f :: s -&gt; t\nb :: t     -- clearly not true, as b :: s\n</code></pre>\n\n<p>where <code>f a</code> needs</p>\n\n<pre><code>a :: s     -- clearly not true, as a :: x\n</code></pre>\n\n<p>So, yes, lots of errors.</p>\n\n<p>A <code>Functor</code> instance lets you transform data in positions corresponding to the type's <em>last</em> parameter, i.e., the <code>b</code> in</p>\n\n<pre><code>data Second a b = Ok a b | Ko a b deriving (Show)\n</code></pre>\n\n<p>so your</p>\n\n<pre><code>  fmap f (Ko a b ) = Ko a (f b)\n</code></pre>\n\n<p>is just fine, but your</p>\n\n<pre><code>  fmap f (Ok a b ) = Ok (f a) b\n</code></pre>\n\n<p>hits the usage of a different parameter and is not ok.</p>\n\n<pre><code>  fmap f (Ok a b ) = Ok a (f b)\n</code></pre>\n\n<p>would work. As would changing the <code>data</code> declaration to</p>\n\n<pre><code>data Second a b = Ok b a | Ko a b deriving (Show)\n</code></pre>\n\n<p>and leaving your <code>instance</code> as it is.</p>\n\n<p>Either fix works, but don't do both \"just to be on the safe side\"!</p>\n"}], "owner": {"reputation": 464, "user_id": 4042041, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/83827a407e294030b50cdfaa38339f79?s=128&d=identicon&r=PG&f=1", "display_name": "Maurizio Ferreira", "link": "https://stackoverflow.com/users/4042041/maurizio-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 47477361, "answer_count": 1, "score": -2, "last_activity_date": 1511553888, "creation_date": 1511540934, "last_edit_date": 1511553888, "question_id": 47477052, "link": "https://stackoverflow.com/questions/47477052/double-type-functor-definition-refused", "title": "double type Functor definition refused", "body": "<p>why is this functor definition refused ?</p>\n\n<pre><code>data Second a b = Ok a b | Ko a b deriving (Show)\n\ninstance Functor (Second x) where\n  fmap f (Ok a b ) = Ok (f a) b\n  fmap f (Ko a b ) = Ko a (f b) \n</code></pre>\n\n<p>I <a href=\"https://repl.it/repls/ValidOffbeatWreckfish\" rel=\"nofollow noreferrer\">get a lot of errors</a>:</p>\n\n<pre><code>GHCi, version 8.0.1\n\nmain.hs:4:22: error:\n    \u2022 Couldn't match type \u2018b\u2019 with \u2018x\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          fmap :: forall a b. (a -&gt; b) -&gt; Second x a -&gt; Second x b\n        at main.hs:4:3\n      \u2018x\u2019 is a rigid type variable bound by\n        the instance declaration at main.hs:3:10\n      Expected type: Second x b\n        Actual type: Second b a\n    \u2022 In the expression: Ok (f a) b\n      In an equation for \u2018fmap\u2019: fmap f (Ok a b) = Ok (f a) b\n      In the instance declaration for \u2018Functor (Second x)\u2019\n    \u2022 Relevant bindings include\n        a :: x (bound at main.hs:4:14)\n        f :: a -&gt; b (bound at main.hs:4:8)\n        fmap :: (a -&gt; b) -&gt; Second x a -&gt; Second x b (bound at main.hs:4:3)\nmain.hs:4:28: error:\n    \u2022 Couldn't match expected type \u2018a\u2019 with actual type \u2018x\u2019\n      \u2018x\u2019 is a rigid type variable bound by\n        the instance declaration at main.hs:3:10\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          fmap :: forall a b. (a -&gt; b) -&gt; Second x a -&gt; Second x b\n        at main.hs:4:3\n    \u2022 In the first argument of \u2018f\u2019, namely \u2018a\u2019\n      In the first argument of \u2018Ok\u2019, namely \u2018(f a)\u2019\n      In the expression: Ok (f a) b\n    \u2022 Relevant bindings include\n        b :: a (bound at main.hs:4:16)\n        a :: x (bound at main.hs:4:14)\n        f :: a -&gt; b (bound at main.hs:4:8)\n        fmap :: (a -&gt; b) -&gt; Second x a -&gt; Second x b (bound at main.hs:4:3)\n</code></pre>\n\n<p>What does this all mean? Please help.</p>\n"}, {"tags": ["parsing", "haskell", "parsec", "left-recursion"], "answers": [{"comments": [{"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1511557877, "post_id": 47476275, "comment_id": 81914881, "body": "In effect: parse first using a different grammar, and then fix the parse tree to reflect the desired grammar."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1511537405, "creation_date": 1511537405, "answer_id": 47476275, "question_id": 47475486, "link": "https://stackoverflow.com/questions/47475486/parsing-left-recursive-grammar-in-sum-type-inifinite-recursion/47476275#47476275", "title": "Parsing left-recursive grammar in sum-type inifinite recursion", "body": "<p>The usual way to parse left-recursive grammars with tools that don't support left recursion, is indeed to replace the left recursion with repetition (i.e. <code>many</code>). For record access that'd mean replacing a rule like</p>\n\n<pre><code>lvalue ::= lvalue '.' ID\n         | primaryLValue\n</code></pre>\n\n<p>with</p>\n\n<pre><code>lvalue ::= primaryLValue ('.' ID)*\n</code></pre>\n\n<p>In terms of Parsec that would mean:</p>\n\n<pre><code>record &lt;- atomParser                                                                                                       \nfields &lt;- many (char '.' &gt;&gt; idParser)\n</code></pre>\n\n<p>Now you have an <code>LValue</code> and a list of 0 or more field names, which doesn't fit your AST type, but you can solve that by folding the <code>RecordAccess</code> constructor over the list.</p>\n"}, {"tags": [], "owner": {"reputation": 738, "user_id": 8075159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8709365a90d8a840b976b0f132f912e5?s=128&d=identicon&r=PG&f=1", "display_name": "Hogeyama", "link": "https://stackoverflow.com/users/8075159/hogeyama"}, "is_accepted": true, "score": 1, "last_activity_date": 1511602289, "creation_date": 1511602289, "answer_id": 47484468, "question_id": 47475486, "link": "https://stackoverflow.com/questions/47475486/parsing-left-recursive-grammar-in-sum-type-inifinite-recursion/47484468#47484468", "title": "Parsing left-recursive grammar in sum-type inifinite recursion", "body": "<p>Though you cannnot use <code>chainl1</code> here,\nYou can define <code>chainl1</code>-like combinator like this:</p>\n\n<pre><code>leftRec :: (Stream s m t)\n        =&gt; ParsecT s u m a -&gt; ParsecT s u m (a -&gt; a) -&gt; ParsecT s u m a\nleftRec p op = rest =&lt;&lt; p\n  where\n    rest x = do f &lt;- op\n                rest (f x)\n          &lt;|&gt; return x\n</code></pre>\n\n<p>I consulted <a href=\"http://hackage.haskell.org/package/parsec-3.1.11/docs/src/Text.Parsec.Combinator.html#chainl1\" rel=\"nofollow noreferrer\">here</a> to implement this.\nBy using this combinator, <code>lvalueParser</code> can be defined as follows:</p>\n\n<pre><code>lvalueParser :: Parser LValue\nlvalueParser = leftRec idParser (recordAccessModifier &lt;|&gt; arraySubscriptModifier)\n  where\n    idParser = Id &lt;$&gt; atomParser\n    recordAccessModifier = do\n      a &lt;- char '.' *&gt; atomParser\n      return (\\l -&gt; RecordAccess l a)\n    arraySubscriptModifier = do\n      e &lt;- between (char '[') (char ']') expParser\n      return (\\l -&gt; ArraySubscript l e)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>main = parseTest lvalueParser \"x.y[2].z\"\n-- =&gt; RecordAccess (ArraySubscript (RecordAccess (Id 'x') 'y') (ENat 2)) 'z'\n</code></pre>\n\n<p>where <code>Atom</code>, <code>Expression</code>, and their parsers are defined as follows:</p>\n\n<pre><code>type Atom = Char\natomParser :: Parser Atom\natomParser = letter &lt;?&gt; \"atom\"\n\ndata Expression = ENat Int\n  deriving Show\nexpParser :: Parser Expression\nexpParser = (ENat . read) &lt;$&gt; many digit\n</code></pre>\n"}], "owner": {"reputation": 594, "user_id": 1443481, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4dd92d46e793967128399d3af5357589?s=128&d=identicon&r=PG", "display_name": "Stuart", "link": "https://stackoverflow.com/users/1443481/stuart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 2, "accepted_answer_id": 47484468, "answer_count": 2, "score": 2, "last_activity_date": 1556502595, "creation_date": 1511534415, "last_edit_date": 1556502595, "question_id": 47475486, "link": "https://stackoverflow.com/questions/47475486/parsing-left-recursive-grammar-in-sum-type-inifinite-recursion", "title": "Parsing left-recursive grammar in sum-type inifinite recursion", "body": "<p>I'm trying to write a parser for the Tiger language from <em>modern compiler implementation in ML</em>, and am stuck on one of the recursive types.</p>\n\n<p>I have the following type</p>\n\n<pre><code>data LValue =                                                                                                                       \n    Id Atom                                                                                                                         \n    | RecordAccess LValue Atom                                                                                                      \n    | ArraySubscript LValue Expression  \n</code></pre>\n\n<p>with the following grammar:</p>\n\n<pre><code>lvalue -&gt; id\n       -&gt; lvalue.id\n       -&gt; lvalue[exp]\nid -&gt; atom\nexp -&gt; (the big, overarching, everything-is-an-expression type)\n</code></pre>\n\n<p>And I'm trying to parse it with Parsec, but I'm getting stuck in an infinitely recursive loop. Here's my current base parser:</p>\n\n<pre><code>lvalueParser :: Parsec String () LValue                                                                                             \nlvalueParser =                                                                                                                      \n    try (Id &lt;$&gt; (atomParser &lt;* (notFollowedBy (char '.'))))                                                                         \n    &lt;|&gt; try recordAccessParser                                                                                                      \n    where recordAccessParser = (uncurry RecordAccess) &lt;$&gt; do {                                                                      \n      record &lt;- lvalueParser;                                                                                                         \n      char '.';                                                                                                                     \n      atom &lt;- atomParser;                                                                                                           \n      return (record, atom)                                                                                                      \n      }\n</code></pre>\n\n<p>(Note: I haven't yet attempted to implement anything to handle the <code>ArrayAccess</code> portion)</p>\n\n<p>Clearly, the infinite-loopiness happens when the <code>recordAccessParser</code> calls back to the <code>lvalueParser</code>.</p>\n\n<p>I can change the <code>recordAccessParser</code> thusly:</p>\n\n<pre><code>recordAccessParser = (uncurry RecordAccess) &lt;$&gt; do {                                                                      \n          record &lt;- atomParser;                                                                                                         \n          char '.';                                                                                                                     \n          atom &lt;- atomParser;                                                                                                           \n          return (Id record, atom)                                                                                                      \n          }\n</code></pre>\n\n<p>and it terminates. However, it will not parse record access more than a single level deep:</p>\n\n<pre><code>Parsec.parse lvalueParser \"\" \"record_1.field_1.field_2\"\n#=&gt; RecordAccess (Id record_1) (Id field_1)\n</code></pre>\n\n<p>And I expect</p>\n\n<pre><code>#=&gt; RecordAccess (RecordAccess (Id record_1) (Id field_1)) (Id field_2)\n</code></pre>\n\n<p>I looked at <a href=\"http://stuckinaninfiniteloop.blogspot.com/2011/10/left-recursion-in-parsec.html\" rel=\"nofollow noreferrer\"><code>chainl1</code></a>, but the type of the chaining parser is <code>a -&gt; a -&gt; a</code>, and that doesn't match the type of <code>LValue</code> that reflects the grammar. I also looked at <a href=\"https://stackoverflow.com/a/14674328\"><code>many</code></a>; however I don't have a constant prefix for each term - the left recursion term is what I'm trying to parse into part of the result type. </p>\n\n<p>I imagine I'm missing a specific concept of Parsec/parsing and would love to be pointed in the right direction. There are more types in the language that I'm writing a parser for that will have similar constructions.</p>\n"}, {"tags": ["haskell", "zeromq", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 2, "last_activity_date": 1511535140, "last_edit_date": 1511535140, "creation_date": 1511534831, "answer_id": 47475589, "question_id": 47474972, "link": "https://stackoverflow.com/questions/47474972/stack-statically-link-external-library-on-mac/47475589#47475589", "title": "stack statically link external library on mac", "body": "<p>I did something similar with lua. My aproach is to pass full path to the static library to ghc. In cabal file:</p>\n\n<pre><code>if os(darwin)\n  ghc-options: /usr/local/lib/liblua5.1.a\n</code></pre>\n\n<p>According to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using.html#meaningful-file-suffixes\" rel=\"nofollow noreferrer\">documentation</a> ghc will pass it to linker:</p>\n\n<blockquote>\n  <p>Files with other suffixes (or without suffixes) are passed straight to\n  the linker.</p>\n</blockquote>\n\n<p>However it doesn't work if the library is used in other package which you depend on. So if you are using e.g. <code>zeromq4-haskell</code> package, then you need to modify it locally.</p>\n"}], "owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1511535140, "creation_date": 1511532410, "question_id": 47474972, "link": "https://stackoverflow.com/questions/47474972/stack-statically-link-external-library-on-mac", "title": "stack statically link external library on mac", "body": "<p>I would really like to create a single binary for my application however it depends on libzmq and I am building on OSX, has anyone managed to get an external library linking correctly on a mac?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1511531144, "creation_date": 1511531144, "answer_id": 47474620, "question_id": 47474488, "link": "https://stackoverflow.com/questions/47474488/understanding-monomorphic-containers-w-foldable/47474620#47474620", "title": "Understanding Monomorphic Containers w/ Foldable", "body": "<p><a href=\"http://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text.html\" rel=\"noreferrer\"><code>Text</code></a> is intuitively a container, however it is not polymorphic. Hence</p>\n\n<pre><code>Prelude&gt; Data.Foldable.foldr ((:) . fromEnum) [] (Data.Text.pack \"blub\")\n\n&lt;interactive&gt;:8:28: error:\n    \u2022 Couldn't match expected type \u2018[a0]\u2019\n                  with actual type \u2018Data.Text.Internal.Text\u2019\n    \u2022 In the third argument of \u2018foldr\u2019, namely\n        \u2018(Data.Text.pack \"blub\")\u2019\n      In the expression:\n        foldr ((:) . fromEnum) [] (Data.Text.pack \"blub\")\n      In an equation for \u2018it\u2019:\n          it = foldr ((:) . fromEnum) [] (Data.Text.pack \"blub\")\n</code></pre>\n\n<p>OTOH,</p>\n\n<pre><code>Prelude&gt; Data.MonoTraversable.ofoldr ((:) . fromEnum) [] (Data.Text.pack \"blub\")\n[98,108,117,98]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19421, "user_id": 3795501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaeec79535337d9a96f63f2d6ef3e49d?s=128&d=identicon&r=PG", "display_name": "Luka Jacobowitz", "link": "https://stackoverflow.com/users/3795501/luka-jacobowitz"}, "is_accepted": false, "score": 1, "last_activity_date": 1511531156, "creation_date": 1511531156, "answer_id": 47474623, "question_id": 47474488, "link": "https://stackoverflow.com/questions/47474488/understanding-monomorphic-containers-w-foldable/47474623#47474623", "title": "Understanding Monomorphic Containers w/ Foldable", "body": "<p>I think what's meant here is, that usually when talking about <code>Foldable</code> we mean the higher-kinded polymorphic version. I.e. <code>List</code> is a <code>Foldable</code> for all <code>a</code>. So <code>Foldable</code> works on types * -> * (also called type constructors).</p>\n\n<p>The <code>MonoFoldable</code> type class works on actual types instead. So for example we could write an instance of <code>MonoFoldable</code> for something like <code>Text</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 4, "last_activity_date": 1511531167, "creation_date": 1511531167, "answer_id": 47474628, "question_id": 47474488, "link": "https://stackoverflow.com/questions/47474488/understanding-monomorphic-containers-w-foldable/47474628#47474628", "title": "Understanding Monomorphic Containers w/ Foldable", "body": "<p>A <code>Foldable</code> has kind <code>* -&gt; *</code>. Lists, trees, basically anything that can take another type for their element type has that kind. Any instance of <code>Foldable</code> must be a type <em>constructor</em> , not <em>a type</em> , since the class is defined as</p>\n\n<pre><code>class Foldable (t :: * -&gt; *) where\n   foldMap :: Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m\n                                  --  ^ ^\n</code></pre>\n\n<p>However, <code>Text</code>, <code>ByteString</code> and other types are clearly a collection of some underlying element type, yet their kind is <code>*</code>. They aren't type constructors, they are already types. They don't fit <code>foldMap</code>'s type:</p>\n\n<pre><code>listLength :: Text -&gt; Int\nlistLength = getSum . foldMap (const (Sum 1))\n\ntextLength :: Text -&gt; Int\ntextLength = foldMap magic -- will never compile, for no magic\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1511531600, "post_id": 47474705, "comment_id": 81904004, "body": "True. Worth noting however that this GADT wrapper only works for <code>Foldable</code>, because that is purely catamorphic. It does not allow you to get around the <code>MonoTraversable</code> methods."}], "tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": false, "score": 1, "last_activity_date": 1511531619, "last_edit_date": 1511531619, "creation_date": 1511531443, "answer_id": 47474705, "question_id": 47474488, "link": "https://stackoverflow.com/questions/47474488/understanding-monomorphic-containers-w-foldable/47474705#47474705", "title": "Understanding Monomorphic Containers w/ Foldable", "body": "<p><a href=\"https://hackage.haskell.org/package/bytestring\" rel=\"nofollow noreferrer\"><code>ByteString</code></a> and <a href=\"https://hackage.haskell.org/package/text\" rel=\"nofollow noreferrer\"><code>Text</code></a>, which can only contain <code>Word8</code> and <code>Char</code> respectively. Also <a href=\"https://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-Unboxed.html\" rel=\"nofollow noreferrer\">unboxed arrays</a> have a restriction on their data type so can't be directly made instances of <code>Foldable</code>.</p>\n\n<p>Note however you can trivially make a <code>Monofoldable</code> into a <code>Foldable</code> just by wrapping it appropriately. My package <a href=\"https://hackage.haskell.org/package/make-monofoldable-foldable\" rel=\"nofollow noreferrer\"><code>make-monofoldable-foldable</code></a> does that for you, so for example if you need to pass a <code>ByteString</code> to a function that expects a <code>Foldable</code> you can just wrap it with <a href=\"https://hackage.haskell.org/package/make-monofoldable-foldable-0.1.0.0/docs/Data-MonoTraversable-WrapMonoFoldable.html#t:WrappedMonoFoldable\" rel=\"nofollow noreferrer\"><code>WrappedMonoFoldable</code></a> and then pass it in. </p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 47474620, "answer_count": 4, "score": 3, "last_activity_date": 1511531619, "creation_date": 1511530681, "question_id": 47474488, "link": "https://stackoverflow.com/questions/47474488/understanding-monomorphic-containers-w-foldable", "title": "Understanding Monomorphic Containers w/ Foldable", "body": "<p><code>snoyberg/mono-traversable</code>'s <a href=\"https://github.com/snoyberg/mono-traversable/tree/master/mono-traversable#monofoldable\" rel=\"nofollow noreferrer\">README</a> notes</p>\n\n<blockquote>\n  <p>[MonoFoldable  is the same] as Foldable, but also operates over monomorphic containers.</p>\n</blockquote>\n\n<p>Please give an example where <code>Foldable</code> does not operate over monomorphic containers.</p>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "sanctuary"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1511530934, "post_id": 47473763, "comment_id": 81903698, "body": "You shouldn&#39;t start with advanced type system features like type classes (provided you&#39;re referring to type classes with <i>type values</i>). Start with function types, tagged unions and algebraic data types. Study parametric polymorphism, parametricity and how this sort of polymorphism differs from subtyping in OOP. Then go on with bounded polymorphism (often implemented as type classes like Functor), kinds of types and higher kinded types."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1511531839, "post_id": 47473763, "comment_id": 81904124, "body": "Type classes are similar to function overloading in OOP. But they are more flexible, since you can also overload functions based on their return type."}, {"owner": {"reputation": 20812, "user_id": 312785, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5f41fa18e9774f1a2ea7c519f476c348?s=128&d=identicon&r=PG", "display_name": "davidchambers", "link": "https://stackoverflow.com/users/312785/davidchambers"}, "edited": false, "score": 0, "creation_date": 1511538625, "post_id": 47473763, "comment_id": 81907772, "body": "The inelegant Accessible type class was removed in <a href=\"https://github.com/sanctuary-js/sanctuary/pull/425\" rel=\"nofollow noreferrer\">sanctuary-js/sanctuary#425</a> and will disappear from the library in the next release. :)"}, {"owner": {"reputation": 567, "user_id": 8075005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-Y3F7QyeEgV0/AAAAAAAAAAI/AAAAAAAAAPA/rYjlu772ico/photo.jpg?sz=128", "display_name": "webstackdev", "link": "https://stackoverflow.com/users/8075005/webstackdev"}, "edited": false, "score": 0, "creation_date": 1511624287, "post_id": 47473763, "comment_id": 81930175, "body": "@ftor - thanks for the roadmap!"}, {"owner": {"reputation": 567, "user_id": 8075005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-Y3F7QyeEgV0/AAAAAAAAAAI/AAAAAAAAAPA/rYjlu772ico/photo.jpg?sz=128", "display_name": "webstackdev", "link": "https://stackoverflow.com/users/8075005/webstackdev"}, "reply_to_user": {"reputation": 20812, "user_id": 312785, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5f41fa18e9774f1a2ea7c519f476c348?s=128&d=identicon&r=PG", "display_name": "davidchambers", "link": "https://stackoverflow.com/users/312785/davidchambers"}, "edited": false, "score": 0, "creation_date": 1511624464, "post_id": 47473763, "comment_id": 81930215, "body": "@davidchambers - thank you for all the work you&#39;ve done on the sanctuary.js library. I feel like by working with it I&#39;ll be able to grasp FP concepts, something I&#39;ve worked on a bit here and there for the past year or so. For some reason it&#39;s making more sense to me with sanctuary than with Haskell. The library is really nice also, and your explanations of the why of it compared to Ramda has been helpful. Thanks again!"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1511534283, "post_id": 47474381, "comment_id": 81905402, "body": "<i>No. Yes. You can write unlawful methods, and nothing will stop you.</i> Not every type class must have algebraic laws, e.g. <code>Show</code>. So there are also useful &quot;lawless&quot; type classes."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1511536653, "post_id": 47474381, "comment_id": 81906690, "body": "@ftor Ah, right, good point. However I think unlawful != lawless."}, {"owner": {"reputation": 567, "user_id": 8075005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-Y3F7QyeEgV0/AAAAAAAAAAI/AAAAAAAAAPA/rYjlu772ico/photo.jpg?sz=128", "display_name": "webstackdev", "link": "https://stackoverflow.com/users/8075005/webstackdev"}, "edited": false, "score": 0, "creation_date": 1511624578, "post_id": 47474381, "comment_id": 81930249, "body": "@Bergi you mentioned FP type values don&#39;t carry any values; can they carry constants?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 567, "user_id": 8075005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-Y3F7QyeEgV0/AAAAAAAAAAI/AAAAAAAAAPA/rYjlu772ico/photo.jpg?sz=128", "display_name": "webstackdev", "link": "https://stackoverflow.com/users/8075005/webstackdev"}, "edited": false, "score": 0, "creation_date": 1511627093, "post_id": 47474381, "comment_id": 81931052, "body": "@calligraphic-io Yes, the static methods that don&#39;t take any arguments (nullary functions) are essentially constants. An example would be the <code>empty</code> value of all monoids, like <a href=\"https://github.com/sanctuary-js/sanctuary#maybefantasy-landempty-----maybea\" rel=\"nofollow noreferrer\">Maybe</a>"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 5, "last_activity_date": 1511531039, "last_edit_date": 1511531039, "creation_date": 1511530334, "answer_id": 47474381, "question_id": 47473763, "link": "https://stackoverflow.com/questions/47473763/type-values-and-accessible-pseudotype-in-sanctuary-js-fantasy-land/47474381#47474381", "title": "Type Values and &quot;Accessible Pseudotype&quot; in Sanctuary.js (Fantasy Land)", "body": "<blockquote>\n  <p>What is the difference between a FP type value and normal object-oriented objects, besides the type value not having any state?</p>\n</blockquote>\n\n<p>It's not only that they don't have any mutable state, they don't carry <em>any</em> values like OOP instances do. They're more like the <em>class</em> of OOP object. They are JS objects with only <strong>static methods</strong>, or put differently: a record that contains plain functions.</p>\n\n<blockquote>\n  <p>Am I free to create my user types and require the methods I like on them?</p>\n</blockquote>\n\n<p>Yes!</p>\n\n<blockquote>\n  <p>Do those methods have to conform to any algebraic design principles or laws?</p>\n</blockquote>\n\n<p>No. Yes. You can write unlawful methods, and nothing will stop you. Even in Haskell, these laws are not enforced by the compiler/typechecker. (<a href=\"https://blog.jle.im/entry/verified-instances-in-haskell.html\" rel=\"noreferrer\">Usually</a>).</p>\n\n<p>They might even work. But they break the assumptions of other developers, and they break the assumptions that code written by those developers relies on to work.</p>\n\n<blockquote>\n  <p>Are types like interfaces?</p>\n</blockquote>\n\n<p>Yes, that might be a good metaphor. Or at least, the <a href=\"http://book.realworldhaskell.org/read/using-typeclasses.html\" rel=\"noreferrer\">type classes</a> instantiated by the type objects (a reification necessary in JavaScript) are the interfaces that are implemented by the type.</p>\n\n<blockquote>\n  <p>Printing an object created with null shows <code>{}</code>, and its <code>typeof</code> being object. It seems like a member of the Object type to me. What am I misunderstanding?</p>\n</blockquote>\n\n<p>\"Member\" probably refers to <code>instanceof</code> here - and <code>Object.create(null) instanceof Object</code> is <code>false</code>, because it does not inherit from <code>Object.prototype</code>. Other accessible but non-<code>Object</code> objects might be values from other realms, like an iframe environment.</p>\n"}], "owner": {"reputation": 567, "user_id": 8075005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-Y3F7QyeEgV0/AAAAAAAAAAI/AAAAAAAAAPA/rYjlu772ico/photo.jpg?sz=128", "display_name": "webstackdev", "link": "https://stackoverflow.com/users/8075005/webstackdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 47474381, "answer_count": 1, "score": -1, "last_activity_date": 1511531039, "creation_date": 1511528051, "question_id": 47473763, "link": "https://stackoverflow.com/questions/47473763/type-values-and-accessible-pseudotype-in-sanctuary-js-fantasy-land", "title": "Type Values and &quot;Accessible Pseudotype&quot; in Sanctuary.js (Fantasy Land)", "body": "<p>I am working through the documentation on Sanctuary.js. I've been working on learning Haskell also, and struggled a bit with FP concepts.</p>\n\n<ol>\n<li><p>I understand that a type value is an object that has (a) a constructor (the type representative), (b) a type identifier (the name of the type as a property named <code>@@type</code>, and (c) any methods required to be implemented by the type. What is the difference between a FP type value and normal object-oriented objects, besides the type value not having any state? The Fantasy-Land specification gives standard types to implement, including methods on them. Some (all?) of those methods obey algebraic laws, like <code>Functors</code> requiring a <code>map</code> method that obeys the identity and composition laws. Am I free to create my user types and require the methods I like on them? Do those methods have to conform to any algebraic design principles or laws? If not, it sure seems like OO design (minus state in the object) to me! I don't know what I'm missing. Are types like interfaces? Parent objects?</p></li>\n<li><p>The <a href=\"https://github.com/sanctuary-js/sanctuary#accessible-pseudotype\" rel=\"nofollow noreferrer\">Sanctuary documentation</a> talks about an \"accessible pseudotype\" - the type of values which support property access, or every value except <code>null</code> and <code>undefined</code>. It says that \"<code>Object</code> is close, but <code>Object.create(null)</code> produces a value which supports property access but which is not a member of the Object type\". But printing an object created with <code>null</code> shows <code>{}</code>, and its <code>typeof</code> being <code>object</code>. It <strong>seems</strong> like a member of the Object type to me. What am I misunderstanding? Why is the <code>Accessible</code> psuedo-type necessary? And what is the difference between a pseudo-type and a regular type? <code>Integer</code>, for example, is called a pseudo-class, but it seems like an extension of the <code>Number</code> class to me.</p></li>\n</ol>\n"}, {"tags": ["list", "haskell", "records"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1511523165, "post_id": 47471519, "comment_id": 81899101, "body": "<code>Maybe</code> abstracts zero or one, <code>[]</code> abstracts arbitrary elements. Are you sure you need both? Do you need to tell <code>Just []</code> and <code>Nothing</code> apart?"}, {"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1511526300, "post_id": 47471519, "comment_id": 81901002, "body": "@Zeta not really. You mean I could have the type :: [PageContent] -&gt; [a]  where [a] is either [ServiceRequest] or [] the empty list?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1511528790, "post_id": 47471519, "comment_id": 81902393, "body": "Yes, but your <code>PageComponent</code> or <code>PageElement</code> could have <code>services :: [ServiceRequest]</code> instead of <code>Maybe [ServiceRequest]</code>."}, {"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1511529674, "post_id": 47471519, "comment_id": 81902890, "body": "@Zeta Ahh I see what you mean. The reason I have Maybe [ServiceRequest] is because it&#39;s parsing these information from a yaml file where the services declaration can be present or not. So I guess yes I need to tell it apart. I thought you meant the return type of the function"}], "answers": [{"comments": [{"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "edited": false, "score": 0, "creation_date": 1511560128, "post_id": 47478282, "comment_id": 81915600, "body": "thank you very much for this clear and informative answer"}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 2, "last_activity_date": 1511546995, "creation_date": 1511546995, "answer_id": 47478282, "question_id": 47471519, "link": "https://stackoverflow.com/questions/47471519/recursively-search-for-a-record-attribute-and-collect-into-list-in-haskell/47478282#47478282", "title": "Recursively search for a record attribute and collect into list in Haskell", "body": "<p><code>Maybe a</code> is a <code>Monoid</code> as long as <code>a</code> is a <code>Monoid</code>:</p>\n\n<pre><code>instance Monoid a =&gt; Monoid (Maybe a)\n</code></pre>\n\n<p>Therefore, we can <code>map</code> each <code>PageContent</code> to a <code>Maybe [ServiceRequest]</code> and <code>mconcat</code> them.</p>\n\n<p>The <code>PageElement</code> has a <code>services :: Maybe [ServiceRequest]</code>, but it may also have more <code>Maybe [ServiceRequest]</code>s under the <code>body :: Maybe [PageContent]</code>.  We can use <code>getPageContentServiceRequests</code> on the body, using <code>&gt;&gt;=</code> to join the two levels of <code>Maybe</code> that would be introduced, and use <code>&lt;&gt;</code> (aka <code>mappend</code>) to append them with <code>services</code>.  We can do the same for <code>PageComponent</code> and <code>PageConditional</code>:</p>\n\n<pre><code>import Data.Monoid\n\ngetPageContentServiceRequests :: [PageContent] -&gt; Maybe [ServiceRequest]\ngetPageContentServiceRequests = mconcat . map getServiceRequests where\n\n  getServiceRequests :: PageContent -&gt; Maybe [ServiceRequest]\n  getServiceRequests PageElement { services=services, body=body } =\n    services &lt;&gt; (body &gt;&gt;= getPageContentServiceRequests)\n  getServiceRequests PageComponent { services=services } =\n    services\n  getServiceRequests PageConditional { true=true, false=false } =\n    (true &gt;&gt;= getPageContentServiceRequests) &lt;&gt;\n    (false &gt;&gt;= getPageContentServiceRequests)\n</code></pre>\n"}], "owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "accepted_answer_id": 47478282, "answer_count": 1, "score": 2, "last_activity_date": 1511546995, "creation_date": 1511520120, "question_id": 47471519, "link": "https://stackoverflow.com/questions/47471519/recursively-search-for-a-record-attribute-and-collect-into-list-in-haskell", "title": "Recursively search for a record attribute and collect into list in Haskell", "body": "<p>Hi I'm trying to get how I would collect the same attibute of a (possibly) deeply nested data structure. The following data types are</p>\n\n<pre><code>data PageContent = \nPageElement { content_type :: String\n            , element :: String\n            , attributes :: Maybe Object\n            , services :: Maybe [ServiceRequest]\n            , body :: Maybe [PageContent]\n            , styles :: Maybe Object\n            , scripts :: Maybe Object }\n| PageComponent { content_type :: String\n                , id :: String\n                , tag :: Maybe String\n                , args :: Maybe Object\n                , services ::Maybe [ServiceRequest]}\n| PageConditional { content_type :: String\n                  , true :: Maybe [PageContent]\n                  , false :: Maybe [PageContent]\n                  , condition :: String }\nderiving(Show)\n</code></pre>\n\n<p>So in  my case I'm trying to collect all ServiceRequest that are declared. Elements are passed in as a list of [PageContent]. I think it would be perfect to use a recursive function because for example when I hit a PageElement that element could have a _body which has a Maybe [PageContent], so going through the _body of a PageElement should be identical to going through the original [PageContent] list passed in, given that I extract it from Maybe. </p>\n\n<p>I have a hard time figuring out how I would return this as a new list</p>\n\n<pre><code>getPageContentServiceRequests :: [PageContent] -&gt; Maybe [ServiceRequest]\n</code></pre>\n\n<p>So I could have no ServiceRequest or I could have a list of 1 or more ServiceRequests. If I do this recursively, would I pass two lists to the function? One with [PageContent] and then an empty list which I could add to recursively while collecting ServiceRequests?</p>\n\n<p>example</p>\n\n<pre><code>getPageContentServiceRequests (x:xs) (y:ys) =\n    case (isJust (body x)) of\n        True -&gt; y : getPageContentServiceRequests fromJust (body x) ys\n</code></pre>\n\n<p>Would this be the correct approach? I feel I understand the recursive concept when I'm working with a list of the same type but not if I have to construct a completely new list with a different type. </p>\n"}, {"tags": ["haskell", "exponentiation", "church-encoding"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 7, "creation_date": 1511511492, "post_id": 47468799, "comment_id": 81892265, "body": "What is <code>Func a</code>? Which symptoms are you experiencing?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1511516887, "post_id": 47468799, "comment_id": 81895365, "body": "Some untyped lambda calculus idioms translate nicely in typed lambda calculi, and consequently in typed functional languages. Some do not, though. This one might need some careful adaptation."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1511523129, "last_edit_date": 1511523129, "creation_date": 1511522781, "answer_id": 47472311, "question_id": 47468799, "link": "https://stackoverflow.com/questions/47468799/exponentiation-function-haskell/47472311#47472311", "title": "Exponentiation function Haskell", "body": "<p>Church numeral arithmetic tends to involve rather strange types, so it's not quite as elegant in Haskell as in an untyped language. In principle, a church numeral is a function that takes <em>any <a href=\"https://en.wikipedia.org/wiki/Endomorphism\" rel=\"noreferrer\">endomorphism</a></em> and gives another endomorphism on the same type, i.e.</p>\n\n<pre><code>five :: (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>which works for any type <code>a</code>, i.e. it really means</p>\n\n<pre><code>{-# LANGUAGE ExplicitForall, UnicodeSyntax #-}\nfive :: \u2200 a . (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>The trick when you're doing interesting arithmetic with such numbers is that the individual components of a calculation may actually be dealing with different-typed endomorphisms, including endomorphisms that are themselves higher-order functions. It gets quite tricky to keep track of all this.</p>\n\n<p>Hence the least painful way to toy around with Church arithmetic in Haskell is to wrap all the polymorphism into a <em>single type for natural numbers</em> (whose implementation happens to be Church-encoding):</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, UnicodeSyntax #-}\nnewtype Nat = Nat {getChurchNum :: \u2200 a . (a -&gt; a) -&gt; a -&gt; a}\n</code></pre>\n\n<p>Then you can give all the fundamental operations clear type signatures, just you always need to put the terms which correspond to numbers in the <code>Nat</code> wrapper, to hide the polymorphism:</p>\n\n<pre><code>zero :: Nat\nzero = Nat (\\f x -&gt; x)\n\nsuc :: Nat -&gt; Nat\nsuc = \\(Nat n) -&gt; Nat (\\f x -&gt; n f (f x))\n</code></pre>\n\n<p>...or, as I'd prefer to write it,</p>\n\n<pre><code>instance Enum Nat where\n  succ (Nat n) = Nat (\\f -&gt; n f . f)\n\ninstance Num Nat where\n  fromInteger 0 = Nat (const id)\n  fromInteger n = succ . fromInteger $ n-1\n  Nat a + Nat b = Nat (\\f -&gt; a f . b f)\n  Nat a * Nat b = Nat (a . b)\n\ninstance Show Nat where\n  show (Nat n) = show (n (+1) 0 :: Int)\n</code></pre>\n\n<p>Quick test:</p>\n\n<pre><code>GHCi&gt; [0, 1, 2, 4, 8, 3+4, 3*4 :: Nat]\n[0,1,2,4,8,7,12]\n</code></pre>\n\n<p>Now with these types, you can also implement the exponentiation directly:</p>\n\n<pre><code>pow :: Nat -&gt; Nat -&gt; Nat\npow (Nat n) (Nat m) = Nat (m n)\n</code></pre>\n\n<p>And it works as expected:</p>\n\n<pre><code>GHCi&gt; [pow a b :: Nat | a&lt;-[0,1,2,3], b&lt;-[0,1,2,3]]\n[1,0,0,0,1,1,1,1,1,2,4,8,1,3,9,27]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 9938718, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UQgrp.png?s=128&g=1", "display_name": "TSRTSR", "link": "https://stackoverflow.com/users/9938718/tsrtsr"}, "is_accepted": false, "score": 2, "last_activity_date": 1532161661, "creation_date": 1532161661, "answer_id": 51454283, "question_id": 47468799, "link": "https://stackoverflow.com/questions/47468799/exponentiation-function-haskell/51454283#51454283", "title": "Exponentiation function Haskell", "body": "<p>Here is another example using <a href=\"https://www.haskell.org/hugs/pages/downloading-May2006.htm\" rel=\"nofollow noreferrer\">WinHugs</a>:</p>\n\n<pre><code>type Church a = (a -&gt; a) -&gt; a -&gt; a\n\nzero :: Church a\nzero = \\s z -&gt; z\n\none :: Church a\none = \\s z -&gt; s z\n\ntwo :: Church a\ntwo = \\s z -&gt; s (s z)\n\nthree :: Church a\nthree = \\s z -&gt; s (s (s z))\n\nfour :: Church a\nfour = \\s z -&gt; s (s (s (s z)))\n\nsucc :: Church a -&gt; Church a\nsucc n f = f . n f\n\nadd :: Church a -&gt; Church a -&gt; Church a\nadd x y = \\s z -&gt; x s (y s z)\n\nmult :: Church a -&gt; Church a -&gt; Church a\nmult x y = x.y\n\nexp :: Church a -&gt; (Church a -&gt; Church a) -&gt; Church a\nexp x y = y x\n</code></pre>\n\n<p>Testing the operation <code>add</code>, <code>mult</code> and <code>exp</code> (using <code>s=(+1)</code> and <code>z=0</code>):</p>\n\n<pre><code>Main&gt; add two three (+1) 0\n5\nMain&gt; mult four three (+1) 0\n12\nMain&gt; exp two three (+1) 0\n8\n</code></pre>\n\n<p>Testing the operation <code>add</code>, <code>mult</code> and <code>exp</code> (using <code>s=('|':)</code> and <code>z=\"\"</code>):</p>\n\n<pre><code>Main&gt; add two three ('|':) \"\"\n\"|||||\" --5 sticks\nMain&gt; mult four three ('|':) \"\"\n\"||||||||||||\" --12 sticks\nMain&gt; exp two three ('|':) \"\"\n\"||||||||\" --8 sticks\n</code></pre>\n\n<p>Or <code>exp four two</code> (4^2 = 16) which is written as:</p>\n\n<pre><code>Main&gt; two four (+1) 0\n16\n</code></pre>\n\n<p>It works fine!</p>\n"}], "owner": {"reputation": 13, "user_id": 9002495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcce13af670514e43b7b7f00f0875b2a?s=128&d=identicon&r=PG&f=1", "display_name": "thali", "link": "https://stackoverflow.com/users/9002495/thali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 590, "favorite_count": 0, "accepted_answer_id": 47472311, "answer_count": 2, "score": 1, "last_activity_date": 1532199774, "creation_date": 1511510581, "last_edit_date": 1532199774, "question_id": 47468799, "link": "https://stackoverflow.com/questions/47468799/exponentiation-function-haskell", "title": "Exponentiation function Haskell", "body": "<p>How to get the exponentiation function in church numerals using Haskell?</p>\n\n<p>I'm trying to apply the rule, which is \u03bbxy.yx but something doesn't work right.</p>\n\n<pre><code>exponentiation :: (Num a) =&gt; Func a\nexponentiation x y = y x\n</code></pre>\n"}, {"tags": ["scala", "haskell", "traits", "typeclass", "higher-kinded-types"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511516328, "post_id": 47468658, "comment_id": 81895028, "body": "&quot;both approaches seem like they cannot work with one degree of abstraction more&quot; - why do you believe so? (Aside: may be better to focus on traits or type classes, not both - they are entirely different beasts)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511516706, "post_id": 47468658, "comment_id": 81895273, "body": "Relevant: <a href=\"https://stackoverflow.com/questions/42370444/what-types-of-problems-helps-higher-kinded-polymorphism-solve-better\" title=\"what types of problems helps higher kinded polymorphism solve better\">stackoverflow.com/questions/42370444/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511511665, "post_id": 47468868, "comment_id": 81892348, "body": "So in your second example: A and B are concrete type constructor names, not type variables, right?"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511512430, "post_id": 47468868, "comment_id": 81892740, "body": "they are abstract. Such Functor type doesn&#39;t not exist but if you create trait like this it would have kind ((* -&gt; <i>) -&gt; *) -&gt; * .  And compiler would take care about checking that all A-typed parameters has kind (</i> -&gt; *) -&gt; *. Like def doSomething(a: A) would compile only with values like List(List(1,3))"}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511512837, "post_id": 47468868, "comment_id": 81892959, "body": "Is there any difference between an abstract name like <code>A</code> and the underscore <code>_</code>? Or does the latter simply mean \u201eI don\u2018t care about the name because I don\u2018t use it in the implementation.\u201c?"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511513049, "post_id": 47468868, "comment_id": 81893077, "body": "correct. And you can even create trait Functor[ _ [ _ [ _ ] ] ] having the same kind  ((* -&gt; *) -&gt; *) -&gt; *"}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511514494, "post_id": 47468868, "comment_id": 81893860, "body": "Ah, so is <code>_</code> therefore an existential type? And: Is a higher kinded type still just a type that I can use anywhere a type is required?"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511515362, "post_id": 47468868, "comment_id": 81894432, "body": "yes its existential type. You can use anywhere where type of this kind is required and in some advanced cases even when different kind required (see this quesiton <a href=\"https://stackoverflow.com/questions/46263931/higher-order-unification-for-type-constructor-inference\" title=\"higher order unification for type constructor inference\">stackoverflow.com/questions/46263931/&hellip;</a> )"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511516122, "post_id": 47468868, "comment_id": 81894893, "body": "if your method accepts A type you can pass all higher kinded types there, but if you have A[ _ ] you need exactly * -&gt; * except for advanced usage based on SI-2712 fix"}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511519646, "post_id": 47468868, "comment_id": 81897097, "body": "OK, regarding this: Is there any sort of substitution principle for kinds? Like <code>* -&gt; *</code> conforms to <code>*</code> or <code>(* -&gt; *) -&gt; *</code> conforms to <code>* -&gt; *</code> and <code>*</code>?"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511520770, "post_id": 47468868, "comment_id": 81897770, "body": "it looks something like this: if you have higher kinded type parameter you must passe at least this kind or higher. It meas if you have * -&gt; * you need at least A[ _ ] but in place of &quot;_&quot; there can be higher kinded type as well. So in case * -&gt; * required on the place of first star you can put any type including higher kinded type. In other words: if you stated that type has a kind you need to provide this kind. In case of A[ B ] I stated that A has a kind but B doesn&#39;t, so I can pass type of any kind instead of B"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511521398, "post_id": 47468868, "comment_id": 81898117, "body": "you can check with Array for example. It has kind * -&gt; * (Array[T]) but you can pass any-kinded-type instead of T. You just can&#39;t use benefits of knowing kind of T inside Array because T has no kind difined. But for Array functionality it&#39;s not a problem."}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511521992, "post_id": 47468868, "comment_id": 81898442, "body": "Awesome! I wonder if I&#39;m ever in a situation where I have a <b>concrete value</b> that is statically known to have type of kind <code>* -&gt; *</code> (or higher). <b>How can it come into existence</b>? Let&#39;s say I have a variable of type <code>Array</code>. What can I do with it? Can I call <code>.count()</code> on it? Or must the type of any concrete value always be fully-constructed, but maybe containing an existential type parameter, like <code>Array[_]</code>? <code>Array[_]</code> is quite different than <code>Array</code>, right? The former has kind <code>*</code> (i.e. fully-constructed, but with unknown parts), the latter has kind <code>* -&gt; *</code> (i.e. not fully-constructed)."}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511522652, "post_id": 47468868, "comment_id": 81898813, "body": "not sure if I understand you, but you will probably be interested in reading this <a href=\"https://typelevel.org/blog/2017/02/13/more-types-than-classes.html\" rel=\"nofollow noreferrer\">typelevel.org/blog/2017/02/13/more-types-than-classes.html</a> . BTW: you can&#39;t have variable of type Array it can be subtype of Array constructed by type constructor only."}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511524306, "post_id": 47468868, "comment_id": 81899761, "body": "Thanks for the article. I just flew over it. Let me pin-point my question with a simple example: Can I write an Identity function that takes a higher-kinded argument, and just returns it, with a signature like this: <code>id(A[_] argument)</code>, where <code>A</code> is some abstract type constructor?"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511532792, "post_id": 47468868, "comment_id": 81904650, "body": "I guess you mean something like this:     def id[A[ _ ]](x: A[ _ ]): A[ _ ]  = x"}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511533150, "post_id": 47468868, "comment_id": 81904829, "body": "Yeah, so in this case, does <code>A[_]</code> have kind <code>*</code> or <code>* -&gt; *</code>? I.e. is <code>_</code> an existential type or a type parameter placeholder?"}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 1, "creation_date": 1511533412, "post_id": 47468868, "comment_id": 81904970, "body": "it is existential type. The kind of A[_] is * -&gt; *. I can rewrite it without existential type: def id[A[B],B](x: A[B]): A[B]  = x . In this case I can use B  type inside the def if needed."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1511542582, "post_id": 47468868, "comment_id": 81909556, "body": "Some people use &quot;type&quot; to mean &quot;thing that classifies a value&quot;. Other people use it more loosely to mean &quot;any expression in the language of <i>type-formers</i> used right of <code>::</code>, but I wish they wouldn&#39;t, because it causes the confusion we see here. All types (meaning those things which classify values) have kind <code>*</code>. All types are type-formers but not all type-formers are types: type-formers have a variety of kinds. There is no such thing as a value with a type of higher kind, because there is no such thing as a type of higher kind."}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1511545084, "post_id": 47468868, "comment_id": 81910549, "body": "@pigworker: Yeah this sounds reasonable to me. But then, the type of argument <code>x</code> in the function in the example, <code>def id[A[_]](x: A[_]): A[_] = x</code>, simply has kind <code>*</code>. But the expression <code>A[_]</code> does not denote a type, but rather a type-former of kind <code>* -&gt; *</code>. It only becomes a type once a caller of <code>id</code> provides an actual instantiation of <code>A[_]</code>, correct?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1511579437, "post_id": 47468868, "comment_id": 81919397, "body": "For clarification, because I don&#39;t think anyone truly answered it in the above comments, in the second example, <code>A</code> is a type constructor that is visible inside the definition of <code>Functor</code>. <code>B</code> is just a name given to that parameter, but is only in scope in the declaration of <code>A</code>. <code>trait Functor[A[B[_]]] { def b: B[Int] }</code> is invalid, but <code>Functor[A[B[_]] &lt;: B[Int]]</code> isn&#39;t. You can replace <code>B</code> with <code>_</code> as in <code>Functor[A[_[_]]]</code>, but not as in <code>Functor[A[_[_]] &lt;: _[Int]]</code>, as that removes the relationship between <code>A</code>&#39;s argument and the bound. Analogy: <code>trait T[F[X] &lt;: Seq[X]]</code>/<code>trait T[F[_]]</code>."}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1511600908, "post_id": 47468868, "comment_id": 81923372, "body": "@HTNW: What about this: <code>trait Functor[A[B[_]], B[_]] { def b: B[Int] }</code>. Can be very precise about what exactly the symbols <code>A</code> and <code>B</code> are (both in my and your example)? What exactly is different in my definition as compared to yours (<code>trait Functor[A[B[_]]] { def b: B[Int] }</code>)?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1511616851, "post_id": 47468868, "comment_id": 81927853, "body": "I&#39;m not so familiar with the Scala syntax, but it looks to me as if <code>A[_]</code> is used in two subtly different ways. In <code>id[A[_]]</code>, it indicates parametrisation by a type-former. In the return type of <code>id</code> and the type of <code>x</code>, <code>A[_]</code> refers to an arbitrary instantiation of that type-former to a type. In Haskell, we&#39;d have <code>forall (a :: * -&gt; *)(x :: *). a x -&gt; a x</code>, which makes clearer the abstraction over first a type-former, then an arbitrary parameter for that type-former."}, {"owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "reply_to_user": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511632147, "post_id": 47468868, "comment_id": 81932729, "body": "@MightyNicM from the practical perspective, as mentioned HTNW,  the difference between trait Functor[A[B[ _ ]], B[ _ ]] and trait Functor[A[B[ _ ]]] is that you can or can&#39;t use B type inside the definition of trait Functor. Both A and B are abstract types. I guess we need such trick because of type erasure in JVM. At runtime A[B[ _ ]] will be replaced to SomeRealType[Object] .. so we probably need some extra hint for JVM for understand real type of B ... but I&#39;m not sure about that."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1511633752, "post_id": 47468868, "comment_id": 81933235, "body": "@MightNicM No. The <code>B</code> in the first parameter is <i>out of scope</i> by the time you define it in the second. The first parameter and second parameter are totally unrelated, and it makes no sense to compare semantics between mine and yours, because mine is semantically <i>nonsense</i>. Think about it: what would <code>trait T[A[B[_]]] { def b: B[Int] }</code> even mean? That&#39;s like trying to write a function <code>f[A,B]: (B =&gt; A) =&gt; B</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1511634088, "post_id": 47468868, "comment_id": 81933345, "body": "@BogdanVakulenko No, erasure has nothing to do with this. <code>B</code> isn&#39;t a parameter to <i>you</i>; it&#39;s the parameter to <code>A</code>. <i>You <b>set</b></i> <code>B</code> by passing an argument to <code>A</code>."}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1511853939, "post_id": 47468868, "comment_id": 82007969, "body": "Thanks to all of you for helping me understand at least the important concepts involved here, and to reduce the overall confusion."}], "tags": [], "owner": {"reputation": 3310, "user_id": 8362765, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1882004112073375/picture?type=large", "display_name": "Bogdan Vakulenko", "link": "https://stackoverflow.com/users/8362765/bogdan-vakulenko"}, "is_accepted": false, "score": 5, "last_activity_date": 1536746795, "last_edit_date": 1536746795, "creation_date": 1511510918, "answer_id": 47468868, "question_id": 47468658, "link": "https://stackoverflow.com/questions/47468658/higher-degrees-of-higher-kinded-types/47468868#47468868", "title": "Higher degrees of higher kinded types?", "body": "<pre><code>trait Functor[F[_]] //has kind (* -&gt; *) -&gt; *\n\ntrait Functor[A[B[_]]] //has kind ((* -&gt; *) -&gt; *) -&gt; *\n\ntrait Map[A[_],B[_]] //has kind (* -&gt; *) -&gt; (* -&gt; *) -&gt; *\n</code></pre>\n\n<p><strong><em>Edit:</em></strong></p>\n\n<p>You can investigate kinds by yourself by calling \"kind\" command in REPL:</p>\n\n<p>scala> :kind -v Map</p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 5, "last_activity_date": 1511534090, "last_edit_date": 1511534090, "creation_date": 1511528321, "answer_id": 47473840, "question_id": 47468658, "link": "https://stackoverflow.com/questions/47468658/higher-degrees-of-higher-kinded-types/47473840#47473840", "title": "Higher degrees of higher kinded types?", "body": "<p>In Scala(Z), the obvious higher-kind type is the <code>MonadTrans</code> trait:</p>\n\n<pre><code>trait MonadTrans[F[_ [_], _]] { ... }\n</code></pre>\n\n<p>Its kind is <code>T-&gt;*</code>, where <code>T</code> is the kind of its parameter <code>F</code>.</p>\n\n<p><code>F</code> is a monad transformer, and <code>T</code> is the kind of all monad transformers. Recall that a monad transformer is parametrised by a monad and its \"output\" is another monad, so its kind is <code>(*-&gt;*) -&gt; (*-&gt;*)</code> (or, equivalently, <code>(*-&gt;*) -&gt; * -&gt; *</code>). So the kind of <code>MonadTrans</code> is </p>\n\n<pre><code>((*-&gt;*) -&gt; * -&gt; *) -&gt; *\n</code></pre>\n\n<p>In Haskell there are no traits, and type classes are not types, so <code>MonadTrans</code> is out as a non-type. There is a type that represents a composition of monad transformers though:</p>\n\n<pre><code>newtype ComposeT f g m a = ...\n</code></pre>\n\n<p>Here's its full definition from <code>Control.Monad.Trans.Compose</code>:</p>\n\n<pre><code>newtype ComposeT (f :: (* -&gt; *) -&gt; * -&gt; *) (g :: (* -&gt; *) -&gt; * -&gt; *) m a\n    = ComposeT { getComposeT :: f (g m) a }\n</code></pre>\n\n<p>Quite a mouthful! <code>f</code> and <code>g</code> are monad transformers (as can be seen from their explicitly given signatures), <code>m</code> is a monad (signature <code>* -&gt;*</code> is not given explicitly but implied by <code>g m</code>), and <code>a</code> is a regular type of kind <code>*</code>. So the overall kind of <code>ComposeT</code> is:</p>\n\n<pre><code>((* -&gt; *) -&gt; * -&gt; *) -&gt;\n((* -&gt; *) -&gt; * -&gt; *) -&gt;\n (* -&gt; *) -&gt; * -&gt; *\n</code></pre>\n"}], "owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1536746795, "creation_date": 1511510006, "last_edit_date": 1511510750, "question_id": 47468658, "link": "https://stackoverflow.com/questions/47468658/higher-degrees-of-higher-kinded-types", "title": "Higher degrees of higher kinded types?", "body": "<p>I just recently learned about higher kinded types, but every example I was presented with only used a degree-2 kind <code>(* -&gt; *) -&gt; *</code>, like <code>Functor</code>.</p>\n\n<p>In Scala, a weird <strong>trait</strong> definition is used, and in Haskell, <strong>type classes</strong> are used. And both approaches seem like they cannot work with one degree of abstraction more (i.e. <code>((* -&gt; *) -&gt; *) -&gt; *</code>).</p>\n\n<p>I am neither an expert in Scala nor Haskell, so it would be helpful if you could provide <strong>simple</strong> examples of such higher degree types, if they are expressible at all.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1914, "user_id": 1511037, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/3P5Qq.png?s=128&g=1", "display_name": "Penguino", "link": "https://stackoverflow.com/users/1511037/penguino"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1511510121, "post_id": 47468078, "comment_id": 81891585, "body": "@Zeta Thanks for the reference. I guessed it must have already been asked previously but hadn&#39;t though of searching on &#39;decrement&#39;"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1511512754, "post_id": 47468078, "comment_id": 81892915, "body": "Actually, another user found that question (and answer), but their comment got automatically removed. They should get the honors, but I cannot recall the user name, sorry :/"}], "owner": {"reputation": 1914, "user_id": 1511037, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/3P5Qq.png?s=128&g=1", "display_name": "Penguino", "link": "https://stackoverflow.com/users/1511037/penguino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1511508887, "answer_count": 0, "score": 1, "last_activity_date": 1511507631, "creation_date": 1511507631, "question_id": 47468078, "link": "https://stackoverflow.com/questions/47468078/constructing-a-reverse-order-list-of-ints-in-haskell", "closed_reason": "Duplicate", "title": "Constructing a reverse order list of Ints in Haskell", "body": "<p>I understand that I can define an ordered list of integers by use of the construct [1..10]. For example:</p>\n\n<pre><code>&gt; [1..10] == [1,2,3,4,5,6,7,8,9,10]. \n</code></pre>\n\n<p>But if I want to define a similar list in reverse order, why does the following </p>\n\n<pre><code>&gt; [10,9..1] == [10,9,8,7,6,5,4,3,2,1] \n</code></pre>\n\n<p>work as expected but </p>\n\n<pre><code>&gt; [10..1] == []\n</code></pre>\n\n<p>produces the empty list?</p>\n"}, {"tags": ["performance", "haskell", "string-comparison"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1511506757, "post_id": 47467810, "comment_id": 81890045, "body": "Well... did you measure it? Not sure what you&#39;re expecting us to do that you can&#39;t do yourself. Other than the comments on performance in the <a href=\"https://stackoverflow.com/tags/haskell/info\">tag wiki</a>, there&#39;s not much expertise that can be brought to bear here."}, {"owner": {"reputation": 437, "user_id": 5299034, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10203272588494957/picture?type=large", "display_name": "BrainFRZ", "link": "https://stackoverflow.com/users/5299034/brainfrz"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1511506980, "post_id": 47467810, "comment_id": 81890159, "body": "I wasn&#39;t sure if anyone knew an answer based on Haskell/GHC&#39;s behavior. I didn&#39;t notice any difference by eyeballing it, and I&#39;m not sure how to benchmark in Haskell."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1511507359, "post_id": 47467810, "comment_id": 81890346, "body": "<a href=\"http://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a> is good."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1511507381, "post_id": 47467810, "comment_id": 81890360, "body": "Would like to point out that you really just want <code>find</code>."}, {"owner": {"reputation": 437, "user_id": 5299034, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10203272588494957/picture?type=large", "display_name": "BrainFRZ", "link": "https://stackoverflow.com/users/5299034/brainfrz"}, "edited": false, "score": 0, "creation_date": 1511507486, "post_id": 47467810, "comment_id": 81890402, "body": "Thanks, Daniel! And thanks so much HTNW!!! There are so many built-in functions I&#39;m constantly finding out about as I work with Haskell :)"}, {"owner": {"reputation": 437, "user_id": 5299034, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10203272588494957/picture?type=large", "display_name": "BrainFRZ", "link": "https://stackoverflow.com/users/5299034/brainfrz"}, "edited": false, "score": 1, "creation_date": 1511507658, "post_id": 47467810, "comment_id": 81890464, "body": "However, even with <code>find</code>, that still brings up the same problem. It&#39;s just a safe way of doing what <code>head$filter</code> does, isn&#39;t it?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1511516612, "post_id": 47467810, "comment_id": 81895215, "body": "All these approaches do essentially the same thing. Their performance differences, if any, should be negligible, and likely hard to detect. You are correct when you say that <code>==</code> on strings must scan all the strings <i>when they are equal</i>, and <code>&#47;=</code> can terminate early <i>when they are different</i>. However, the vice versa also holds! <code>==</code> is not really more efficient than &#39;/=` on strings, on the same inputs."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511533897, "post_id": 47467810, "comment_id": 81905211, "body": "If you are worried about performance, use <code>Text</code> instead of <code>String</code> and a container other than <code>[]</code> to store the <code>Person</code>s."}, {"owner": {"reputation": 437, "user_id": 5299034, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10203272588494957/picture?type=large", "display_name": "BrainFRZ", "link": "https://stackoverflow.com/users/5299034/brainfrz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1511543949, "post_id": 47467810, "comment_id": 81910116, "body": "Thanks @chi! If you make your comment an answer I&#39;ll accept it."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1511551112, "creation_date": 1511551112, "answer_id": 47478973, "question_id": 47467810, "link": "https://stackoverflow.com/questions/47467810/is-there-a-performance-difference-between-headfilter-and-headdropwhile-with-ha/47478973#47478973", "title": "Is there a performance difference between head$filter and head$dropWhile with Haskell Strings?", "body": "<p>There are several approaches to the problem</p>\n\n<pre><code>findPerson n = head $ dropWhile (\\p -&gt; name p /= n)\nfindPerson n = head $ filter (\\p -&gt; name p == n)\nfindPerson n = fromJust $ find (\\p -&gt; name p == n)\n</code></pre>\n\n<p>The question also points out two facts:</p>\n\n<ul>\n<li>when <code>x,y</code> are equal strings, <code>==</code> needs to compare all the characters</li>\n<li>when <code>x,y</code> are different strings, <code>/=</code> only needs to compare until the first different character</li>\n</ul>\n\n<p>This is correct, but does not consider the other cases</p>\n\n<ul>\n<li>when <code>x,y</code> are equal strings, <code>/=</code> needs to compare all the characters</li>\n<li>when <code>x,y</code> are different strings, <code>==</code> only needs to compare until the first different character</li>\n</ul>\n\n<p>So, between <code>==</code> and <code>/=</code> there is no performance winner. We can expect that, at most, one of them will perform an additional <code>not</code> w.r.t. the other one.</p>\n\n<p>Also, <em>all</em> the three implementations of <code>findPerson</code> mentioned above, essentially perform the same steps. Given <code>xs :: [Person]</code>, they will all scan <code>xs</code> until a matching name is found, and no more. On all the persons before the match, the name will be compared against <code>n</code>, and this comparison will stop at the first different character (no matter what comparison we use above). The matching person will have their name compared completely with <code>n</code> (again, in all cases).</p>\n\n<p>Hence, the approaches are expected to run in the same time. There might be a very small difference between them, but it could be so small that it would be hard to detect. You can try to experiment with <code>criterion</code> and see what happens, if you wish.</p>\n"}], "owner": {"reputation": 437, "user_id": 5299034, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10203272588494957/picture?type=large", "display_name": "BrainFRZ", "link": "https://stackoverflow.com/users/5299034/brainfrz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 47478973, "answer_count": 1, "score": 1, "last_activity_date": 1563080691, "creation_date": 1511506522, "last_edit_date": 1563080691, "question_id": 47467810, "link": "https://stackoverflow.com/questions/47467810/is-there-a-performance-difference-between-headfilter-and-headdropwhile-with-ha", "title": "Is there a performance difference between head$filter and head$dropWhile with Haskell Strings?", "body": "<p>I'm working on lists of \"People\" objects in Haskell, and I was wondering if there was any difference in performance between <code>head$dropWhile</code> and <code>head$filter</code> to find the first person with a given name. The two options and a snip of the datatype would be:</p>\n\n<pre><code>datatype Person = Person { name :: String\n                         , otherStuff :: StuffTypesAboutPerson }\n\nfindPerson :: String -&gt; [Person] -&gt; Person\nfindPerson n = head $ dropWhile (\\p -&gt; name p /= n)\nfindPerson n = head $ filter (\\p -&gt; name p == n)\n</code></pre>\n\n<p>My thought was, <code>filter</code> would have to compare the full length of <code>n</code> to the full length of every <code>name</code> until it finds the first one. I would think <code>dropWhile</code> would only need to compare the strings until the first non-matching <code>Char</code>. However, I know there is a ton of magic in Haskell, especially GHC. I would prefer to use the <code>filter</code> version, because I think it's more straight-forward to read. However, I was wondering if there actually is any performance difference? Even if it's negligible, I'm also interested from a curiosity standpoint at this point.</p>\n\n<p>Edit: I know I also need to protect from errors with <code>Maybe</code>, etc, but I left that out to simplify the code example.</p>\n"}, {"tags": ["haskell", "haskell-stack", "duckling"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511508192, "post_id": 47467480, "comment_id": 81890695, "body": "Does the directory <code>&#47;usr&#47;share&#47;zoneinfo&#47;</code> exist?"}, {"owner": {"reputation": 177, "user_id": 8312081, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/5bed87b8c42680c9308062caca7ac443?s=128&d=identicon&r=PG&f=1", "display_name": "Rob Smith", "link": "https://stackoverflow.com/users/8312081/rob-smith"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511513735, "post_id": 47467480, "comment_id": 81893422, "body": "Yes this was the issue, Ubuntu 16 removed it"}], "answers": [{"tags": [], "owner": {"reputation": 177, "user_id": 8312081, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/5bed87b8c42680c9308062caca7ac443?s=128&d=identicon&r=PG&f=1", "display_name": "Rob Smith", "link": "https://stackoverflow.com/users/8312081/rob-smith"}, "is_accepted": false, "score": 4, "last_activity_date": 1511513791, "creation_date": 1511513791, "answer_id": 47469595, "question_id": 47467480, "link": "https://stackoverflow.com/questions/47467480/facebook-duckling-error-getdirectorycontentsopendirstream-does-not-exist/47469595#47469595", "title": "Facebook Duckling error getDirectoryContents:openDirStream: does not exist", "body": "<p>You might just need to apt-get install tzdata -- I was searching for where zoneinfo is supposed to come from, and I found reports that it was not installed by default anymore in Ubuntu 16.04. I don't see that it's a part of baseimage at all, so it's probably missing from your container.</p>\n\n<p>from <a href=\"https://github.com/phusion/baseimage-docker/issues/415\" rel=\"nofollow noreferrer\">source</a></p>\n"}], "owner": {"reputation": 177, "user_id": 8312081, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/5bed87b8c42680c9308062caca7ac443?s=128&d=identicon&r=PG&f=1", "display_name": "Rob Smith", "link": "https://stackoverflow.com/users/8312081/rob-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1511513791, "creation_date": 1511504764, "last_edit_date": 1592644375, "question_id": 47467480, "link": "https://stackoverflow.com/questions/47467480/facebook-duckling-error-getdirectorycontentsopendirstream-does-not-exist", "title": "Facebook Duckling error getDirectoryContents:openDirStream: does not exist", "body": "<p>i followed the following steps:</p>\n<blockquote>\n<p>apt-get install haskell-platform</p>\n<p>curl -sSL <a href=\"https://get.haskellstack.org/\" rel=\"nofollow noreferrer\">https://get.haskellstack.org/</a> | sh</p>\n<p>git clone <a href=\"https://github.com/facebookincubator/duckling.git\" rel=\"nofollow noreferrer\">https://github.com/facebookincubator/duckling.git</a></p>\n<p>stack setup</p>\n<p>stack build</p>\n<p>stack exec duckling-example-exe</p>\n</blockquote>\n<p>and i get the following error any idea why?</p>\n<blockquote>\n<p>duckling-example-exe: /usr/share/zoneinfo/: getDirectoryContents:openDirStream: does not exist (No such file or directory)</p>\n</blockquote>\n"}, {"tags": ["haskell", "compiler-errors", "functional-programming"], "comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1511508421, "post_id": 47467422, "comment_id": 81890773, "body": "outdent the definition of <code>matchingCode</code> so it is at the same level as the definition of <code>linkBill</code>"}, {"owner": {"reputation": 321, "user_id": 2260430, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/UVI0j.jpg?s=128&g=1", "display_name": "l&#230;ran91", "link": "https://stackoverflow.com/users/2260430/l%c3%a6ran91"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1511508744, "post_id": 47467422, "comment_id": 81890922, "body": "you mean.I should not put both of them in same line ?  @pat... I tried that too in that case its showing like  <code>parse error on input</code>..what should i do"}], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 2, "last_activity_date": 1511508959, "creation_date": 1511508959, "answer_id": 47468395, "question_id": 47467422, "link": "https://stackoverflow.com/questions/47467422/parse-error-in-pattern/47468395#47468395", "title": "parse error in pattern:?", "body": "<p>Indent the code for the function definitions inside the <code>where</code> are at the same level of indent:</p>\n\n<pre><code>linkItem :: ItemCode -&gt; BillType\nlinkItem = map linkBill where\n  linkBill code' = case lookupBy (matchingCode code') itemDb of \n    Just item -&gt; item \n    Nothing   -&gt; error \"**WRONG CODE, NO ITEMFOUND**\"\n  matchingCode code' (code, name, price, _) | code' == code = Just (name, price)\n                                            | otherwise     = Nothing\n</code></pre>\n\n<p>You also want <code>error</code> instead of <code>Error</code> (assuming you <em>really</em> want to use <code>error</code> for error handling).</p>\n"}], "owner": {"reputation": 321, "user_id": 2260430, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/UVI0j.jpg?s=128&g=1", "display_name": "l&#230;ran91", "link": "https://stackoverflow.com/users/2260430/l%c3%a6ran91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "closed_date": 1511545786, "answer_count": 1, "score": 0, "last_activity_date": 1511508959, "creation_date": 1511504441, "last_edit_date": 1511504861, "question_id": 47467422, "link": "https://stackoverflow.com/questions/47467422/parse-error-in-pattern", "closed_reason": "Not suitable for this site", "title": "parse error in pattern:?", "body": "<p>I am newbie to Haskell and trying to build simple <code>billing system for a Fastfood stall</code>.and I defined <code>linkItem function</code>(in the last part of the code), which operates over an entire list, in terms of the\nlocal function <code>linkBill</code>, which  operates on just one element. <code>linkBill</code> looks for\na matching code, returns the relevant bill type, or  causes a run-time error\nif there is no such code entry in <code>itemDb</code>.</p>\n\n<pre><code>import Data.List\nimport Data.Char\n\ntype Name = String\ntype Code = Int\ntype Price = Float\ntype ToatalQtity = Int\n\ntype Db = [(Code,Name,Price,ToatalQtity)]\n\nitemDb :: Db\nitemDb = [(1234,\"Chicken Lollypop\",250.00,50),\n          (2222,\"Chili Mushroom\",150.00,50),\n          (1111,\"Paneer Pakora\",100.00,100),\n          (4719,\"Fish Fingers\",121.00,100),\n          (1235,(\"Tandoori Chicken\",200.00,50))]\n\ntype ItemCode = [Code]\ntype BillType = [(Name,Price)]\n\ntill :: ItemCode\ntill = [1234,2222,1111,4719,1235]\n\nlookupBy :: (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b\nlookupBy f [] = Nothing\nlookupBy f (x:xs) = case f x of\n                  Nothing -&gt; lookupBy f xs\n                  r       -&gt; r\n\nlinkItem :: ItemCode -&gt; BillType\nlinkItem = map linkBill \n         where linkBill code' = case lookupBy (matchingCode code') itemDb of \n                                Just item -&gt; item \n                                Nothing -&gt; Error \"**WRONG CODE, NO ITEMFOUND**\"\n                                matchingCode (code') (code,name,price,_) \n                                                          | (code' == code) = Just (name,price)\n                                                          | otherwise = Nothing\n</code></pre>\n\n<p>and whenever I compiling it ,it's showing an error as below:</p>\n\n<pre><code>billing.hs:48:34: error: Parse error in pattern: matchingCode\n   |\n48 |       matchingCode (code') (code,name,price)     \n   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                                | (code' == code) = Just (name,price)\n   Failed, 0 modules loaded\n</code></pre>\n\n<p>I think am doing something wrong here at <code>matchingCode</code> function declaration I dont know what ? what can I doto get rid of these kinds of Errors? </p>\n"}, {"tags": ["haskell", "recursion-schemes"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511488359, "post_id": 47465205, "comment_id": 81885331, "body": "The function has a <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/src/Data-Functor-Foldable.html#prepro\" rel=\"nofollow noreferrer\">default</a> definition, so in a sense it should be obvious as to what it does and what the role of the &#39;extra&#39; argument is. If you find the definition too terse to understand, then you should phrase the question to refer to which specific part of the definition you are struggling with. If you&#39;re interested in Fokkinga&#39;s original description, see <a href=\"http://maartenfokkinga.github.io/utwente/mmfphd.pdf\" rel=\"nofollow noreferrer\">\u201cLaw and order in algorithmics\u201d</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1511495962, "post_id": 47465205, "comment_id": 81886850, "body": "<a href=\"http://comonad.com/reader/2009/recursion-schemes/\" rel=\"nofollow noreferrer\">Edward Kmett describes</a> a catamorphism as something that &quot;tears down a structure&quot;, and a prepromorphism as something that &quot;tears down a structure after repeatedly applying a natural transformation&quot;. It looks like the extra argument is the natural transformation to apply."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 6, "last_activity_date": 1511501900, "creation_date": 1511501900, "answer_id": 47466960, "question_id": 47465205, "link": "https://stackoverflow.com/questions/47465205/what-is-fokkingas-prepromorphism-meant-to-do/47466960#47466960", "title": "What is Fokkinga&#39;s prepromorphism meant to do?", "body": "<pre><code>cata f = c where c = f . fmap c . project\n{- c = cata f -}\n       = f . fmap (cata f) . project\n</code></pre>\n\n<p><code>cata</code> collapses a value: it unwraps one layer of the functor (<code>project</code>), collapses the interior values recursively (<code>fmap (cata f)</code>), and then collapses the whole thing.</p>\n\n<pre><code>prepro e f = c where c = f . fmap (c . cata (embed . e)) . project\n{- c = prepro e f -}\n           = f . fmap (prepro e f . cata (embed . e)) . project\n</code></pre>\n\n<p><code>prepro</code> also collapses a value, but it also applies <code>e</code> (a natural transformation <code>Base t ~&gt; Base t</code>) as it does so. Notice that <code>cata embed</code> means <code>id</code> (except it's able to turn e.g. <code>[Int]</code> into <code>Fix (ListF Int)</code>), because it collapses the functor layers by embedding them back into the output value:</p>\n\n<p><a href=\"https://i.stack.imgur.com/X46m8.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/X46m8.png\" alt=\"Diagram of &lt;code&gt;cata embed&lt;/code&gt;\"></a></p>\n\n<p><code>cata (embed . e)</code> is rather similar, except it transforms each layer of the functor as it passes down. Because <code>e</code> is a natural transformation, it cannot peer at whatever is inside the layers as they fall; it can only reorganize the structure of the layer (this includes shuffling the inner layers around as long is it doesn't actually look <em>into</em> the inner layers).</p>\n\n<p>So, back to <code>prepro e f</code>. It collapses a value, by first peeling off the outer layer, then \"rewriting\" the inner layers with <code>e</code>, collapsing the inner values recursively, and then collapsing the whole thing. Note that since the recursion is with <code>prepro</code> itself, the deeper a layer is inside the value, the more times it gets rewritten by <code>e</code>.</p>\n\n<hr/>\n\n<h2>Demonstration</h2>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-9.14 script\n{-# LANGUAGE TypeFamilies, DeriveFunctor, DeriveFoldable, DeriveTraversable #-}\nimport Data.Functor.Foldable -- package recursion-schemes\nimport Data.Tree             -- package containers\n-- Tree a = Rose trees of a\n-- makeBaseFunctor breaks down on it, so...\ndata TreeF a r = NodeF { rootLabelF :: a, subForestF :: [r] }\n  deriving (Functor, Foldable, Traversable)\ntype instance Base (Tree a) = TreeF a\ninstance Recursive (Tree a) where project (Node a ts) = NodeF a ts\ninstance Corecursive (Tree a) where embed (NodeF a ts) = Node a ts\n\ntree :: Tree Integer\ntree = Node 2 [Node 1 [Node 3 []], Node 7 [Node 1 [], Node 5 []]]\n\nmain = do -- Original\n          drawTree' tree\n\n          -- 0th layer: *1\n          -- 1st layer: *2\n          -- 2nd layer: *4\n          -- ...\n          drawTree' $ prepro (\\(NodeF x y) -&gt; NodeF (x*2) y) embed tree\n\n          -- Same thing but a different algebra\n          -- \"sum with deeper values weighted more\"\n          print $ prepro (\\(NodeF x y) -&gt; NodeF (x*2) y) ((+) &lt;$&gt; sum &lt;*&gt; rootLabelF) tree\n  where drawTree' = putStr . drawTree . fmap show\n</code></pre>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 2, "accepted_answer_id": 47466960, "answer_count": 1, "score": 5, "last_activity_date": 1511501900, "creation_date": 1511487146, "question_id": 47465205, "link": "https://stackoverflow.com/questions/47465205/what-is-fokkingas-prepromorphism-meant-to-do", "title": "What is Fokkinga&#39;s prepromorphism meant to do?", "body": "<p>I've been looking at the <code>recursion-schemes</code> library, and I'm very confused about what <code>prepro</code> is supposed to be used for, or even what it does. The description of it as 'Fokkinga's prepromorphism' isn't very informative, and the signature (<code>prepro :: Corecursive t =&gt; (forall b . Base t b -&gt; Base t b) -&gt; (Base t a -&gt; a) -&gt; t -&gt; a</code>) looks very similar to <code>cata</code> (the catamorphism) but with an extra argument, whose intent is unclear. Would someone be able to explain what this function is meant to do?</p>\n"}, {"tags": ["haskell", "generic-programming"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1511457568, "post_id": 47460361, "comment_id": 81875952, "body": "<code>Data</code> instances are usually derived (<code>deriving Data</code>), not written by hand. What are you trying to do?"}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 2, "creation_date": 1511458386, "post_id": 47460361, "comment_id": 81876319, "body": "Is this an exercise in generic programming, because I would just use the <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens library</a>."}, {"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1511462391, "post_id": 47460361, "comment_id": 81878122, "body": "I was hoping my first sentence and the definition of the <code>replace</code> function would explain my intentions well enough :-). I want to be able to recurse into the <code>ModuleN</code> structure (without having to describe the full path using a lens) until I find a function of a given type to replace it."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1511469693, "post_id": 47460361, "comment_id": 81880770, "body": "@dfeuer <code>deriving Data</code> fails here because there are no instances for functions"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1511485577, "post_id": 47460361, "comment_id": 81884873, "body": "If you want to define <code>Data</code> instances for these types, you&#39;ll need a <code>Data</code> instance for functions. You can define such an instance in the same way the <code>Data (Ptr a)</code> instance is defined, for example. However this problem is much better suited for <code>GHC.Generics</code> (which doesn&#39;t care if your type contains non-representable types). (Note: &quot;I am currently failing to understand / implement gunfold and associated methods on Data&quot; isn&#39;t really an on-topic question)"}, {"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1511504933, "post_id": 47460361, "comment_id": 81889337, "body": "Thanks I will have a look at all of that."}], "owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1511456294, "creation_date": 1511456294, "question_id": 47460361, "link": "https://stackoverflow.com/questions/47460361/deriving-data-for-a-record-with-functions", "title": "Deriving Data for a record with functions", "body": "<p>I am ultimately trying to define nested records of functions which I want to traverse generically in order to replace on deeply nested function.</p>\n\n<p>Something like this</p>\n\n<pre><code>data Module1 = Module1 {\n  _module2 :: Module2\n  _function1 :: Int -&gt; String\n} deriving (Typeable)\n\ndata Module2 = Module2 {\n  _module3 :: Module3\n  _function2 :: Double -&gt; String\n} deriving (Typeable)\n\ndata Module3 = Module3 {\n  _function3 :: Float -&gt; String\n} deriving (Typeable)\n\nreplace :: (Float -&gt; String) -&gt; Module1 -&gt; Module1\nreplace = undefined\n</code></pre>\n\n<p>I want to implement replace so that <code>_function3</code> is replaced in the <code>Module1</code> data structure. I am trying to implement this by defining <code>Data</code> instances for <code>Module 1, 2, 3</code> but I am currently failing to understand / implement <code>gunfold</code> and associated methods on <code>Data</code>.</p>\n\n<p>Question 1: how do you implement a <code>Data</code> instance for such data types?\nQuestion 2: can I achieve my goal and implement <code>replace</code> with such instances?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1511453217, "post_id": 47459487, "comment_id": 81873591, "body": "You can define a <code>data Nat0 = One | Succ0 Nat0</code>, all natural numbers except zero."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511453754, "post_id": 47459651, "comment_id": 81873884, "body": "I wouldn&#39;t quite call this type <code>Rational</code>, since it does not include the negative numbers, but it&#39;s worth the trade-off to not have to first define the integers in terms of natural numbers."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511454023, "post_id": 47459651, "comment_id": 81874032, "body": "@chepner: good point, I updated it with a possible way to represent negative rational numbers, although we can of course do it at the <code>Rational</code> level as well."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1511456163, "post_id": 47459651, "comment_id": 81875149, "body": "Just for fun: a <i>much</i> better way to define <code>Z</code> is <code>data Z = Nat :- Nat</code>, together with a quotienting rule <code>instance Eq Z where (a :- b) == (c :- d) = (a + d) == (c + b)</code>. This significantly reduces the headaches involved with defining the usual arithmetic operations, as there is generally just one case rather than four to consider."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1511481766, "post_id": 47459651, "comment_id": 81884182, "body": "For (much less) fun: define an addition function for rationals represented by <code>Zero | NextRational Rational</code> :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1511453992, "last_edit_date": 1511453992, "creation_date": 1511453569, "answer_id": 47459651, "question_id": 47459487, "link": "https://stackoverflow.com/questions/47459487/is-it-possible-to-create-a-recursive-data-type-with-rational-numbers-like-dat/47459651#47459651", "title": "Is it possible to create a recursive data type with rational numbers like -&gt; data Nat = Zero | Succ Nat?", "body": "<h1>Positive rational numbers</h1>\n\n<p>We can define it like:</p>\n\n<pre><code>data Nat0 = One | Succ0 Nat0\ndata Nat = Zero | Succ Nat\ndata PosRational = PosRational Nat Nat0\n</code></pre>\n\n<p>so here we use two data types <code>Nat0</code> (<strong>excluding</strong> zero), and <code>Nat</code> (including zero) that are defined recursively, and a data type <code>PosRational</code> that takes a <code>Nat</code> and <code>Nat0</code> (so a numerator, and a denominator).</p>\n\n<h1>Including negative rational numbers</h1>\n\n<p>We can also include negative rational numbers, for instance by defining:</p>\n\n<pre><code>data Z = Pos Nat | Neg Nat0\n</code></pre>\n\n<p>and then define our <code>Rational</code> as:</p>\n\n<pre><code>data Rational = Rational Z Nat0\n</code></pre>\n\n<h1>Countability of &#8474;</h1>\n\n<p>Nevertheless we actually do not need that (given we do not need fast access to the numerator and denominator). <strong>Rational numbers are countable</strong>. We can enumerate all of them with the following scheme <a href=\"https://www.homeschoolmath.net/teaching/rational-numbers-countable.php\" rel=\"noreferrer\">[source]</a>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/yT8wS.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/yT8wS.gif\" alt=\"countability of rational numbers\"></a></p>\n\n<p>So we can simply define it as:</p>\n\n<pre><code>data Rational = Zero | NextRational Rational\n</code></pre>\n\n<p>Basically, every countable set can use this definition, so &#8469;, &#8484;, &#8473;, &#8474;, etc.</p>\n"}], "owner": {"reputation": 179, "user_id": 7668147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f4d900eea1f31d46fc2226a444def97?s=128&d=identicon&r=PG&f=1", "display_name": "AutobahnPolizei", "link": "https://stackoverflow.com/users/7668147/autobahnpolizei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 47459651, "answer_count": 1, "score": 2, "last_activity_date": 1511453992, "creation_date": 1511453017, "question_id": 47459487, "link": "https://stackoverflow.com/questions/47459487/is-it-possible-to-create-a-recursive-data-type-with-rational-numbers-like-dat", "title": "Is it possible to create a recursive data type with rational numbers like -&gt; data Nat = Zero | Succ Nat?", "body": "<p>Is it possible to create a recursive data for rational numbers?\nI saw this one for natural numbers </p>\n\n<pre><code>data Nat = Zero | Succ Nat\n</code></pre>\n\n<p>I probably need to use two numbers for the ratio? But something like Zero,Zero doesnt work.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ffi", "alloca", "c2hs"], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 0, "last_activity_date": 1511811726, "creation_date": 1511811726, "answer_id": 47518613, "question_id": 47459483, "link": "https://stackoverflow.com/questions/47459483/using-alloca-with-c2hs/47518613#47518613", "title": "Using alloca- with c2hs", "body": "<p>c2hs will call <code>alloca</code> 3 times to allocate space for the 3 reference arguments.  Each call will be provided a lambda that binds the pointer to a name, and returns an <code>IO</code> action that either allocates the space for the next reference argument, or, when all space has been allocated, calls the underlying function, reads the values of the reference arguments, and packages them into a tuple.  Something like:</p>\n\n<pre><code>notebookQueryTabLabelPacking nb cld =\n  alloca $ \\a3 -&gt; do\n    alloca $ \\a4 -&gt; do\n      alloca $ \\a5 -&gt; do\n        gtk_notebookQueryTabLabelPacking nb cld a3 a4 a5\n        a3' &lt;- peekRep a3\n        a4' &lt;- peekRep a4\n        a5' &lt;- peekRep a5\n        return (a3', a4', a5')\n</code></pre>\n\n<p>Each <code>alloca</code> is nested in the <code>IO</code> action of the previous one.</p>\n\n<p>Note that the lambdas all take a pointer to their allocated storage, and return an <code>IO (Bool, Bool, PackType)</code>.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1511811726, "creation_date": 1511453001, "question_id": 47459483, "link": "https://stackoverflow.com/questions/47459483/using-alloca-with-c2hs", "title": "Using alloca- with c2hs", "body": "<p>Consider from the c2hs documentation that this:</p>\n\n<pre><code>{#fun notebook_query_tab_label_packing as ^\n  `(NotebookClass nb, WidgetClass cld)' =&gt;\n  {notebook `nb'                ,\n  widget   `cld'               ,\n  alloca-  `Bool'     peekBool*,\n  alloca-  `Bool'     peekBool*,\n  alloca-  `PackType' peekEnum*} -&gt; `()'#}\n</code></pre>\n\n<p>generates in Haskell</p>\n\n<pre><code>notebookQueryTabLabelPacking :: (NotebookClass nb, WidgetClass cld)\n          =&gt; nb -&gt; cld -&gt; IO (Bool, Bool, PackType)\n</code></pre>\n\n<p>which binds the following C function:</p>\n\n<pre><code>void gtk_notebook_query_tab_label_packing (GtkNotebook *notebook,\n            GtkWidget   *child,\n            gboolean    *expand,\n            gboolean    *fill,\n            GtkPackType *pack_type);\n</code></pre>\n\n<p><strong>Problem:</strong> Here I'm confused what the effect of <code>alloca-</code> has on the left side of, i.e., <code>`Bool'</code>. </p>\n\n<p>Now I know that, in practice, what is happening is that <code>alloca</code> is somehow generating a <code>Ptr Bool</code> that <code>peekBool</code> can convert into an output argument. But what I'm terribly confused about is how <code>alloca</code> is doing this, given its type signature <code>alloca :: Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b</code>. More specifically:</p>\n\n<p><strong>Question 1.</strong> When someone calls <code>notebookQueryTabLabelPacking</code> in Haskell, what does c2hs provide as argument for <code>alloca</code>'s first parameter <code>(Ptr a -&gt; IO b)</code>?</p>\n\n<p><strong>Question 2.</strong> In this case, what is the concrete type signature for <code>alloca</code>'s first paramater <code>(Ptr a -&gt; IO b)</code>? Is it <code>(Ptr CBool -&gt; IO CBool)</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1511442321, "post_id": 47456214, "comment_id": 81866813, "body": "Surely, you mean <code>fromIntegral</code> from the <code>Integral</code> class. :D"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1511442676, "post_id": 47456214, "comment_id": 81867058, "body": "@gallais I think it should be fixed now. As usual, numeric conversions are a bit tricky in Haskell. The only way I can see to perform the conversion is to go through <code>Integer</code>, which feels a bit clunky. I wonder if <code>toEnum</code> is guaranteed to be equivalent to that."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1511443697, "post_id": 47456214, "comment_id": 81867673, "body": "I&#39;m pretty sure <code>toIntegral (Note t o) = fromIntegral o * 12 + toIntegral t</code> will work just fine."}, {"owner": {"reputation": 5559, "user_id": 386082, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/1CTwm.jpg?s=128&g=1", "display_name": "Oleiade", "link": "https://stackoverflow.com/users/386082/oleiade"}, "edited": false, "score": 0, "creation_date": 1511447843, "post_id": 47456214, "comment_id": 81870315, "body": "I see my mistake now. What you&#39;re saying is that when I define the function, and say &quot;you&#39;re returning a <code>b</code> that&#39;s an integral&quot; although the actual implementation of my function is returning an Int, the compiler can&#39;t be sure until it&#39;s actually called, hence can&#39;t check the compliance to <code>Integral</code> is that right?  Anyways, the <code>fromIntegral</code> trick made it, thanks a lot folks!"}, {"owner": {"reputation": 5559, "user_id": 386082, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/1CTwm.jpg?s=128&g=1", "display_name": "Oleiade", "link": "https://stackoverflow.com/users/386082/oleiade"}, "edited": false, "score": 0, "creation_date": 1511447885, "post_id": 47456214, "comment_id": 81870343, "body": "Also, you folks are right, it might be good enough for me to enforce an <code>Int</code> return type from my <code>toIntegral</code> instead of the wider <code>Integral</code> typeclass..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5559, "user_id": 386082, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/1CTwm.jpg?s=128&g=1", "display_name": "Oleiade", "link": "https://stackoverflow.com/users/386082/oleiade"}, "edited": false, "score": 1, "creation_date": 1511449620, "post_id": 47456214, "comment_id": 81871415, "body": "@Oleiade No. The point is that you can&#39;t choose <code>b = Int</code>. The type you use is too general, it promises too much to the caller. Consider <code>f :: Num a =&gt; a-&gt;a ; f x = (3::Int)</code>, this wouldn&#39;t type check for the same reason."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1511446712, "last_edit_date": 1511446712, "creation_date": 1511442208, "answer_id": 47456214, "question_id": 47455968, "link": "https://stackoverflow.com/questions/47455968/custom-typeclass-instantiation-couldnt-match-expected-type-b-with-actual-typ/47456214#47456214", "title": "Custom typeclass instantiation: couldn&#39;t match expected type \u2018b\u2019 with actual type \u2018Int\u2019", "body": "<p>Type variables are chosen by the caller, not by the callee. In your case, <code>toIntegral</code> can not choose <code>b</code>, its caller does. According to its type, all of these uses must type check</p>\n\n<pre><code>toIntegral (Note t o) :: Int\ntoIntegral (Note t o) :: Integer\ntoIntegral (Note t o) :: Word32\n-- etc.\n</code></pre>\n\n<p>The solution is to convert <code>Int</code>s as well, i.e. convert <code>o</code>, so to return any integral <code>b</code>, and not just an <code>Int</code>.</p>\n\n<p>For instance, <code>fromIntegral o</code> can convert <code>o</code> to any <code>Num</code> type, hence any <code>Integral</code> one.</p>\n\n<p>Anyway, are you sure you really need that type for your <code>toIntegral</code>?</p>\n"}], "owner": {"reputation": 5559, "user_id": 386082, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/1CTwm.jpg?s=128&g=1", "display_name": "Oleiade", "link": "https://stackoverflow.com/users/386082/oleiade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 47456214, "answer_count": 1, "score": 2, "last_activity_date": 1511446712, "creation_date": 1511441386, "last_edit_date": 1511441753, "question_id": 47455968, "link": "https://stackoverflow.com/questions/47455968/custom-typeclass-instantiation-couldnt-match-expected-type-b-with-actual-typ", "title": "Custom typeclass instantiation: couldn&#39;t match expected type \u2018b\u2019 with actual type \u2018Int\u2019", "body": "<p>I am currently trying to implement a typeclass that allows me to convert any of custom types to an <code>Integral</code> (those types should all be convertible to an index or a weight). In this specific case I want to use it to make sure that a musical note, on a given octave, can be converted to the index of a piano keyboard key:</p>\n\n<pre><code>import Data.Int\n\nclass Convertible a where\n  toIntegral :: Integral b =&gt; a -&gt; b\n\ndata Note = Note Tone Int\n\ninstance Convertible Note where\n    toIntegral (Note t o) = o * 12 + toIntegral t\n</code></pre>\n\n<p>However the compiler complains my implementation of <code>toIntegral</code> for <code>Note</code> does not comply with my <code>Convertible</code> typeclass. </p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018b\u2019 with actual type \u2018Int\u2019\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      num :: forall b. Integral b =&gt; Note -&gt; b\n    at src/Note.hs:11:5\n\u2022 In the expression: octave * 12 + (num tone)\n  In an equation for \u2018num\u2019:\n      num (Note tone octave) = octave * 12 + (num tone)\n  In the instance declaration for \u2018Convertible Note\u2019\n\u2022 Relevant bindings include\n    num :: Note -&gt; b (bound at src/Note.hs:11:5)\n</code></pre>\n\n<p>As far as I understand, it considers the content of my <code>toIntegral</code> function evaluates to an <code>a -&gt; Int</code>, when I constrained it to be an <code>Integral =&gt; b -&gt; a -&gt; b</code>. Now I don't understand what's wrong, because <code>Int</code> implements the <code>Integral</code> typeclass, right?</p>\n\n<p>Can you help me understand what I'm obviously doing wrong here?</p>\n"}, {"tags": ["haskell", "encryption", "cryptography", "aes"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511463074, "post_id": 47454546, "comment_id": 81878358, "body": "&quot;How would I go about optimising this?&quot; - begin by <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"nofollow noreferrer\">profiling</a> your program."}, {"owner": {"reputation": 585, "user_id": 2844582, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc74eb3fe99c52ceaec1db7e8a720fe1?s=128&d=identicon&r=PG&f=1", "display_name": "Xandaros", "link": "https://stackoverflow.com/users/2844582/xandaros"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511463170, "post_id": 47454546, "comment_id": 81878399, "body": "I mean... that is how I know 80% of time is spent on decryption. What exactly do you want me to look for?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511464292, "post_id": 47454546, "comment_id": 81878819, "body": "You should profile <code>cfb8Decrypt</code> itself (unless you mean that 80% of the time spent inside <code>cfb8Decrypt</code> is spent on <code>ecbEncrypt</code>, in which case there probably isn&#39;t much you can do except replacing <code>ecbEncrypt</code> with a faster version). But you are using <code>snoc</code> inside a <code>fold</code> so your program has at least quadratic complexity (and presumably you call it on sizeable chunks of data, or performance wouldn&#39;t be an issue at all). Perhaps look at <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Builder.html\" rel=\"nofollow noreferrer\">Builder</a>."}, {"owner": {"reputation": 585, "user_id": 2844582, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc74eb3fe99c52ceaec1db7e8a720fe1?s=128&d=identicon&r=PG&f=1", "display_name": "Xandaros", "link": "https://stackoverflow.com/users/2844582/xandaros"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511465487, "post_id": 47454546, "comment_id": 81879297, "body": "Yeah, a good chunk of time is actually spent in ecbEncrypt. I was hoping there was a more efficient way of doing this than calling ecbEncrypt for every character. Using a Builder is a good shout, though, since there is some time to be gained in cfb8Decrypt itself and the snoc might be it. I&#39;ll add the profiling results to the question."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511478823, "post_id": 47454546, "comment_id": 81883421, "body": "Indeed, your profiling shows that <code>ecbEncrypt</code> is the majour issue. It also shows that within the call to <code>ecbEncrypt</code> most of the time is spent doing foreign marshalling (<code>allocAndFreeze</code>); based on this, it is very likely that finding a way to call <code>ecbEncrypt</code> fewer times would speed this up considerably. However, I don&#39;t know much about cryptography or this algorithm, so I can&#39;t recommend any way to do so. Perhaps consider crossposting this to the CS or crypto stack exchanges (they may be able to recommend a better algorithm)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1511479036, "post_id": 47454546, "comment_id": 81883481, "body": "Also consider writing your function in C (using the appropriate C functions to replace <code>ecbEncrypt</code> which you could find e.g. <a href=\"https://hackage.haskell.org/package/cryptonite-0.24/src/cbits/cryptonite_aes.c\" rel=\"nofollow noreferrer\">here</a>) and then calling it once per packet from Haskell. This would reduce the amount of marshalling done considerably. It probably isn&#39;t very satisfactory have to write your Haskell code in C, but often if you want to squeeze out every bit of performance possible, that&#39;s what you must do."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511482110, "post_id": 47454546, "comment_id": 81884249, "body": "Does your computer have aesni?"}, {"owner": {"reputation": 585, "user_id": 2844582, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc74eb3fe99c52ceaec1db7e8a720fe1?s=128&d=identicon&r=PG&f=1", "display_name": "Xandaros", "link": "https://stackoverflow.com/users/2844582/xandaros"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1511519066, "post_id": 47454546, "comment_id": 81896741, "body": "@user2407038 Thank you very much for that, I did not previously realise that it was mostly marshalling causing this issue. I&#39;ll try to rewrite it in C, although I don&#39;t have much experience interfacing with C (I do actually have some, though! :D) In the meantime, you may want to consider formulating this into an actual answer. You deserve an upvote and possibly an accept (if I can solve it this way, that is :P)"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1511533513, "post_id": 47454546, "comment_id": 81905022, "body": "Hey! My answer already has AES-NI! And the marshalling bit."}], "answers": [{"tags": [], "owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "is_accepted": true, "score": 1, "last_activity_date": 1511478785, "creation_date": 1511478785, "answer_id": 47464393, "question_id": 47454546, "link": "https://stackoverflow.com/questions/47454546/efficient-decryption-of-aes-cfb8/47464393#47464393", "title": "Efficient decryption of AES/CFB8", "body": "<p>CFB8 was created to have good error propagation properties over a noisy channel. It is well known that it is not fast; it is actually 16 times as slow, as it requires a block encrypt for each byte. Currently it is not very hot, as we tend to use CRC's for the data layer and MAC for integrity on cryptographic levels against willful attacks.</p>\n\n<p>How can you speed it up? The only thing you can really do is to use a fast library. The library you are currently using seems to have support for AES-NI, so make sure that is enabled on your CPU and BIOS.</p>\n\n<p>However, it is very likely that it won't speed up much if you have to call it block for block. You really want to use a native call that takes the whole packet and decrypts it. AES-NI in it's slowest on an Atom implementing TLS still goes to 20 MiB/s, but on server chips AES-NI often goes far beyond the 1 GiB/s limits. Assembly or optimized C should be about 6/7 times as slow when AES-NI is not available.</p>\n\n<p>Functional programming languages like Haskell are not really created for fast I/O nor fast bit-operations. So you can bet that it will be much, much slower than e.g. Java or C#, and those are already much slower than native code let alone assembly code or specialized instructions.</p>\n\n<p>Memory nowadays is pretty fast; CPU's are however much much faster. So avoiding spurious memory allocations and copying should be avoided (again, not that easy to do on a fully functional language, all the more reason to do as much as possible in native code). Do however make sure that there are no buffer overflow issues or you will have fast AES/CFB within an insecure application.</p>\n"}], "owner": {"reputation": 585, "user_id": 2844582, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc74eb3fe99c52ceaec1db7e8a720fe1?s=128&d=identicon&r=PG&f=1", "display_name": "Xandaros", "link": "https://stackoverflow.com/users/2844582/xandaros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1621, "favorite_count": 0, "accepted_answer_id": 47464393, "answer_count": 1, "score": 0, "last_activity_date": 1511478785, "creation_date": 1511436806, "last_edit_date": 1511465515, "question_id": 47454546, "link": "https://stackoverflow.com/questions/47454546/efficient-decryption-of-aes-cfb8", "title": "Efficient decryption of AES/CFB8", "body": "<p>I currently use this function to decrypt a data stream encrypted with AES in CFB8 mode:\n<a href=\"https://github.com/Lazersmoke/civskell/blob/ebf4d761362ee42935faeeac0fe447abe96db0b5/src/Civskell/Tech/Encrypt.hs#L167-L175\" rel=\"nofollow noreferrer\">https://github.com/Lazersmoke/civskell/blob/ebf4d761362ee42935faeeac0fe447abe96db0b5/src/Civskell/Tech/Encrypt.hs#L167-L175</a></p>\n\n<pre><code>cfb8Decrypt :: AES128 -&gt; BS.ByteString -&gt; BS.ByteString -&gt; (BS.ByteString,BS.ByteString)\ncfb8Decrypt c i = BS.foldl magic (BS.empty,i)\n  where\n    magic (ds,iv) d = (ds `BS.snoc` pt,ivFinal)\n      where\n        pt = BS.head (ecbEncrypt c iv) `xor` d\n        -- snoc on cipher always\n        ivFinal = BS.tail iv `BS.snoc` d\n</code></pre>\n\n<p>In case you don't understand Haskell, here's a quick rundown of how I believe this code works: (I did not write it)</p>\n\n<ul>\n<li>Given an IV and a list of encrypted bytes</li>\n<li>For every encrypted byte:\n\n<ul>\n<li>Encrypt the IV in ECB-mode.</li>\n<li>Take the first byte of the encrypted IV and xor it with the encrypted byte. This is the next plaintext byte.</li>\n<li>Remove the first byte from the IV</li>\n<li>Append the encrypted byte to the IV</li>\n<li>The next character will be decrypted using this new IV</li>\n</ul></li>\n</ul>\n\n<p>Not that the ECB-mode encryption is handled by the cryptonite library. I could not find a library supporting CFB8.</p>\n\n<p>Now, this works. However, with the amount of data I need to decrypt, it caps out one of my CPU cores and 80% of the time is just spent on decrypting.</p>\n\n<p>The incoming data is not even that much, so this is not acceptable. Unfortunately, my knowledge of cryptography is rather limited and resources on CFB8 seem rather sparse. It appears that CFB8 is an uncommon mode of operation, also indicated by the lack of library support.</p>\n\n<p>So, my question then is: How would I go about optimising this?</p>\n\n<p>The incoming data is from a TCP stream, but the information is grouped into packets. The cfb8Decrypt function is called 2-5 times per packet, depending on the size. This is necessary, because the length of the packet is transmitted at the beginning, but the length of this size information is variable. After 1-4 decryptions are used to decrypt the length, the entire packet will be decrypted at once. I thought about trying to reduce this, but I am unsure if it would have any effect on speed at all.</p>\n\n<p>Edit: Profiling results: <a href=\"http://svgur.com/i/40b.svg\" rel=\"nofollow noreferrer\">http://svgur.com/i/40b.svg</a></p>\n"}, {"tags": ["haskell", "generic-programming", "ghc-generics"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1511457946, "post_id": 47453657, "comment_id": 81876110, "body": "You can use a closed type family to do the instance resolution. I would probably define a datatype representing the location of an <code>Id</code> in the structure and a type family producing values of that type. Then you can make instances of an auxiliary class follow that path."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1511458696, "post_id": 47453657, "comment_id": 81876444, "body": "Do you have any references that I can read? Should I just lookup &quot;type families&quot;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1511459301, "post_id": 47453657, "comment_id": 81876741, "body": "I don&#39;t have time to help you find a good source right now, unfortunately. You may learn something from <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14255#comment:5\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/14255#comment:5</a> but there are definitely better examples out there (including a few in questions I&#39;ve answered here)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1511826654, "post_id": 47453657, "comment_id": 82000025, "body": "I think some sort of <code>Maybe</code>-like version is almost certainly necessary even to define a very certain version. Suppose you have <code>(x,y)</code>. This is certain to have an <code>Id</code> if and only if <code>x</code> or <code>y</code> is certain to have an <code>Id</code>. But if <code>y</code> is certain to have an <code>Id</code> and <code>x</code> <i>might</i> have an <code>Id</code>, then you want to check <code>x</code> first. There&#39;s going to be some kind of intertwined logic, I expect. Of course, this is only an issue if you have sum types around that can sometimes have an <code>Id</code> and sometimes not...."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512477675, "post_id": 47453657, "comment_id": 82265835, "body": "I&#39;m trying using <code>type-families</code> but <a href=\"https://stackoverflow.com/questions/47653880/using-type-families-and-generics-to-find-an-id-value\">I&#39;m hitting the wall</a> when I try to combine type-families with GHC.Generics :/"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512498749, "post_id": 47453657, "comment_id": 82279753, "body": "The wall I hit was really figuring out exactly what you wanted to do. Think particularly hard about what you want the constraint to be on <code>K1</code>."}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 2, "answer_count": 0, "score": 1, "last_activity_date": 1511434130, "creation_date": 1511434130, "question_id": 47453657, "link": "https://stackoverflow.com/questions/47453657/extracting-an-id-with-ghc-generics", "title": "Extracting an Id with GHC.Generics", "body": "<p>How to extract an identifier (in this case an integer) from a structure using <code>GHC.Generics</code>?</p>\n\n<p>I have an <code>Id</code> type:</p>\n\n<pre><code>newtype Id = Id { _id :: Int }\n</code></pre>\n\n<p>and a lot of types that use that type:</p>\n\n<pre><code>data VarId = VarId Name Id SortId\ndata FuncId = FuncId Name Id [SortId] SortId\ndata SortId = Name Id\n-- ... and 20 more of these things\n</code></pre>\n\n<p>On top of that there are other types that wrap the types above, for instance, identifiers:</p>\n\n<pre><code>data Identifier = IdVar VarId\n                | IdFunc FuncId\n                | IdSort SortId\n                -- ... and 20 more of these things\n</code></pre>\n\n<p>Now I need to extract the <code>_id</code> field from any of these types containing an <code>Id</code> value. Currently we have tons of boilerplate for this, and I want to scrap it away using generics.</p>\n\n<p>At first I thought about defining a class:</p>\n\n<pre><code>class Identifiable e where\n    getId :: e -&gt; Id\n\n    default getId :: (Generic e, GIdentifiable (Rep e)) =&gt; e -&gt; Id\n    getId = gGetId . from\n\nclass GIdentifiable f where\n    gGetId :: f e -&gt; Id\n</code></pre>\n\n<p>in such a way that you'd have an <code>Identifiable</code> instance <strong>only</strong> if there is  one such <code>Id</code> type inside (in case that there are multiple of those like in <code>FuncId</code> above we return the first <code>Id</code> found when traversing the structure from top to bottom). Now the problem comes when I try to define the <code>GIdentifiable</code> instances for the product and sum. I would like to express something like:</p>\n\n<pre><code>instance (GIdentifiable a) =&gt; GIdentifiable (a :*: b) where\n    gGetId (a :*: _) = gGetId a\n\ninstance {-# OVERLAPS #-} (GIdentifiable b) =&gt; GIdentifiable (a :*: b) where\ngGetId (_ :*: b) = gGetId b\n</code></pre>\n\n<p>Which won't work because I'm defining duplicate instances. </p>\n\n<p>I could redefine <code>Identifiable</code> so that <code>getId :: e -&gt; Maybe Id</code> but this will remove some of the type safety, and introduce unnecessary checks when <strong>I know</strong> that a type contains at least one <code>Id</code>.</p>\n\n<p>Is there a way to express this sort of case analysis when working with the type system?</p>\n"}, {"tags": ["sqlite", "haskell"], "comments": [{"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 1, "creation_date": 1511498984, "post_id": 47448544, "comment_id": 81887531, "body": "Technically it&#39;s not possible to write a <i>function</i> that reads from a database. That would be an <i>action</i> because it has IO."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1511447220, "post_id": 47448903, "comment_id": 81869938, "body": "<code>connectSqlite3 db &gt;&gt;= \\conn -&gt; getPerson conn &quot;Michael&quot; &gt;&gt;= print</code>. I&#39;d say the <code>do</code> notation makes it more readable."}], "tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": false, "score": 8, "last_activity_date": 1511427393, "last_edit_date": 1511427393, "creation_date": 1511418318, "answer_id": 47448903, "question_id": 47448544, "link": "https://stackoverflow.com/questions/47448544/how-can-i-write-a-haskell-function-to-query-a-database/47448903#47448903", "title": "How can I write a Haskell function to query a database?", "body": "<p>This code compiled</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Database.HDBC\nimport Database.HDBC.Sqlite3\nimport Data.Convertible.Base\n\ndb :: String\ndb = \"dev.db\"\n\ngetPerson :: (Convertible a SqlValue, IConnection conn) =&gt; conn -&gt; a -&gt; IO [[SqlValue]]\ngetPerson conn person =\n  quickQuery' conn \"select name from person where name like ?\" [toSql person]\n\nmain :: IO ()\nmain = do\n    conn &lt;- connectSqlite3 db\n    person &lt;- getPerson conn \"Michael\"\n    print person\n</code></pre>\n\n<p><code>connectSqlite3 :: FilePath -&gt; IO Connection</code> so value of <code>conn</code> should be extract in <code>IO monad</code>.</p>\n\n<p>Maybe there is better way to write this using <code>bind</code> to pass connection to <code>quickQuery</code> but I don't know, I have never use this library, just guessing from the type in <code>ghci</code></p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1511427393, "creation_date": 1511416715, "question_id": 47448544, "link": "https://stackoverflow.com/questions/47448544/how-can-i-write-a-haskell-function-to-query-a-database", "title": "How can I write a Haskell function to query a database?", "body": "<p>So I'm trying to write a database layer in Haskell, to interface with a SQLite DB. I'm following instructions from the book Real World Haskell, in the chapter about databases. This is what I have so far: </p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Database.HDBC\nimport Database.HDBC.Sqlite3\n\ndb = \"dev.db\"\nconn = connectSqlite3 db\n\ngetPerson person =\n  quickQuery' conn \"select name from person where name like ?\" [toSql person]\n\nmain :: IO ()\nmain = do\n  print $ getPerson \"Michael\"\n</code></pre>\n\n<p>But I get the error: </p>\n\n<pre><code>Could not deduce (IConnection (IO Connection))\n     arising from a use of \u2018quickQuery'\u2019\n   from the context: convertible-1.1.1.0:Data.Convertible.Base.Convertible\n                       a SqlValue\n     bound by the inferred type of\n              getPerson :: convertible-1.1.1.0:Data.Convertible.Base.Convertible\n                             a SqlValue =&gt;\n                           a -&gt; IO [[SqlValue]]\n</code></pre>\n\n<p>Which as a Haskell beginner I don't really understand. I can put a type annotation on getPerson, but that doesn't really seem to fix it. </p>\n"}, {"tags": ["haskell", "bytestring"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1511477589, "post_id": 47446588, "comment_id": 81883125, "body": "Notice your two programs are actually identical.  The type <code>BC.ByteString</code> is a re-export of <code>Data.ByteString.ByteString</code> which you use as <code>B.ByteString</code> - so these are literally referring to the same type and all the code is identical so..."}], "answers": [{"comments": [{"owner": {"reputation": 1117, "user_id": 1677501, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b4bbea40e2df964cf5c483ee0fdd3392?s=128&d=identicon&r=PG", "display_name": "laiboonh", "link": "https://stackoverflow.com/users/1677501/laiboonh"}, "edited": false, "score": 0, "creation_date": 1511408262, "post_id": 47446742, "comment_id": 81849553, "body": "Thank you so much for spending time to show me the differences. It seems that we should stick to <code>T.Text</code> if we do not want to lose the context of unicode characters. So what is the use case of <code>ByteString</code> then?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1117, "user_id": 1677501, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b4bbea40e2df964cf5c483ee0fdd3392?s=128&d=identicon&r=PG", "display_name": "laiboonh", "link": "https://stackoverflow.com/users/1677501/laiboonh"}, "edited": false, "score": 5, "creation_date": 1511411131, "post_id": 47446742, "comment_id": 81850284, "body": "@laiboonh <code>ByteString</code> is for (surprise!) strings of bytes. Operations like file reads/writes, network communication, most cryptographic operations, and so on are typically most naturally represented in terms of <code>ByteString</code>. Operations on text -- like preparing HTML for a web page, modifying text documents, build UI -- should use <code>Text</code>. Occasionally it is necessary to convert between the two, e.g. to send some of your HTML along the network or to display your UI on stdout; in such cases you must choose an encoding to convert correctly."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 1117, "user_id": 1677501, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b4bbea40e2df964cf5c483ee0fdd3392?s=128&d=identicon&r=PG", "display_name": "laiboonh", "link": "https://stackoverflow.com/users/1677501/laiboonh"}, "edited": false, "score": 0, "creation_date": 1511438713, "post_id": 47446742, "comment_id": 81864635, "body": "@laiboonh <code>ByteString</code> is for raw binary data. <code>Text</code> is for... well... text. It depends on whether you&#39;re trying to deal with textual data, or just raw binary files / network protocols / etc."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1511405637, "last_edit_date": 1511405637, "creation_date": 1511404974, "answer_id": 47446742, "question_id": 47446588, "link": "https://stackoverflow.com/questions/47446588/difference-between-data-bytestring-and-data-bytestring-char8/47446742#47446742", "title": "Difference between Data.ByteString and Data.ByteString.Char8", "body": "<p>If you compare <code>Data.ByteString</code> and <code>Data.ByteString.Char8</code>, you'll notice that a bunch of functions that reference <code>Word8</code> in the former reference <code>Char</code> in the latter.</p>\n\n<pre><code>-- Data.ByteString\nmap :: (Word8 -&gt; Word8) -&gt; ByteString -&gt; ByteString\ncons :: Word8 -&gt; ByteString -&gt; ByteString\nsnoc :: ByteString -&gt; Word8 -&gt; ByteString\nhead :: ByteString -&gt; Word8\nuncons :: ByteString -&gt; Maybe (Word8, ByteString) \n{- and so on... -}\n\n\n-- Data.ByteString.Char8\nmap :: (Char -&gt; Char) -&gt; ByteString -&gt; ByteString\ncons :: Char -&gt; ByteString -&gt; ByteString\nsnoc :: ByteString -&gt; Char -&gt; ByteString\nhead :: ByteString -&gt; Char\nuncons :: ByteString -&gt; Maybe (Char, ByteString) \n{- and so on... -}\n</code></pre>\n\n<p>For these functions, and these functions only, <code>Data.ByteString.Char8</code> is providing the convenience of not have to constantly convert <code>Word8</code> values into and out of <code>Char</code> ones. <strong><code>writeFile</code> does exactly the same thing in both modules.</strong></p>\n\n<p>Here is a nice way of seeing the different behaviours of similar functions in <code>Text</code>, <code>ByteString</code>, and <code>ByteString.Char8</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Text.Encoding\n\nimport qualified Data.Text as T\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Char8 as BC\n\nnameText :: T.Text\nnameText = \"\u54c8\u65f6\u523b\"\n\nnameByteString :: B.ByteString\nnameByteString = encodeUtf8 nameText\n\nmain :: IO ()\nmain = do\n  print $ T.head nameText               -- '\\21704'     actual first character\n  print $ B.head nameByteString         -- 229          first byte\n  print $ BC.head nameByteString        -- '\\299'       first byte as character\n\n  putStrLn [ T.head nameText ]          -- \u54c8           actual first character\n  putStrLn [ BC.head nameByteString ]   -- \u00e5            first byte as character\n</code></pre>\n"}], "owner": {"reputation": 1117, "user_id": 1677501, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b4bbea40e2df964cf5c483ee0fdd3392?s=128&d=identicon&r=PG", "display_name": "laiboonh", "link": "https://stackoverflow.com/users/1677501/laiboonh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 2, "accepted_answer_id": 47446742, "answer_count": 1, "score": 5, "last_activity_date": 1511405637, "creation_date": 1511403552, "question_id": 47446588, "link": "https://stackoverflow.com/questions/47446588/difference-between-data-bytestring-and-data-bytestring-char8", "title": "Difference between Data.ByteString and Data.ByteString.Char8", "body": "<p>I read that Char8 only supports ASCII characters and will be dangerous to use if you are using other Unicode characters</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\n--import qualified Data.ByteString as B\nimport qualified Data.ByteString.Char8 as BC\nimport qualified Data.Text.IO as TIO\nimport qualified Data.Text.Encoding as E\nimport qualified Data.Text as T\n\nname :: T.Text\nname = \"{ \\\"name\\\": \\\"\u54c8\u65f6\u523b\\\" }\"\n\nnameB :: BC.ByteString\nnameB = E.encodeUtf8 name\n\nmain :: IO ()\nmain = do\n  BC.writeFile \"test.json\" nameB\n  putStrLn \"done\"\n</code></pre>\n\n<p>produces the same result as</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.ByteString as B\n--import qualified Data.ByteString.Char8 as BC\nimport qualified Data.Text.IO as TIO\nimport qualified Data.Text.Encoding as E\nimport qualified Data.Text as T\n\nname :: T.Text\nname = \"{ \\\"name\\\": \\\"\u54c8\u65f6\u523b\\\" }\"\n\nnameB :: B.ByteString\nnameB = E.encodeUtf8 name\n\nmain :: IO ()\nmain = do\n  B.writeFile \"test.json\" nameB\n  putStrLn \"done\"\n</code></pre>\n\n<p>So what is the difference of using <code>Data.ByteString.Char8</code> vs <code>Data.ByteString</code></p>\n"}]