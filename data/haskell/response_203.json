[{"tags": ["debugging", "haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1543443613, "post_id": 53528548, "comment_id": 93926687, "body": "If you want to see the value of <code>t</code> for example, do <code>traceShowId t</code> instead (assuming <code>State</code> implements <code>Show</code>). Since <code>Debug.Trace</code> gives you a <code>trace</code> function that conflicts with the <code>trace</code> you define here, you might want to import it qualified, too. What have you been trying that gives you type errors?"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1543443801, "post_id": 53528548, "comment_id": 93926763, "body": "I&#39;ve been programming in Haskell over 10 years. I&#39;ve never used Debug.Trace/I&#39;ve never needed it. Haskell is a functional language; it doesn&#39;t have destructive assignment to variables; almost certainly tracing its execution will not help you understand. Despite the name <code>State</code> there&#39;s no overwriting of state to trace in this example. Get the types and definitions of the operators and functions; substitute those into the equations; apply them."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1543446743, "post_id": 53528548, "comment_id": 93927647, "body": "I&#39;ve also been programming in Haskell over 10 years and Debug.Trace has saved my ass many times.  There&#39;s nothing wrong with it as a debug tool, and tracing has absolutely helped me understand things about Haskell&#39;s runtime behavior."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1543449979, "post_id": 53528548, "comment_id": 93928447, "body": "I can see tracing would be useful with genuinely stateful/monadic code, to look into encapsulated/abstraction-hiding structures. But there&#39;s nothing hidden in this example. I think tracing should not be the first thing beginners reach for. @Darth is right to first ask what errors Petr is running into."}], "answers": [{"tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 0, "last_activity_date": 1543453832, "creation_date": 1543453832, "answer_id": 53530428, "question_id": 53528548, "link": "https://stackoverflow.com/questions/53528548/how-to-debug-variables-recursive-data-types-in-haskell/53530428#53530428", "title": "How to debug variables / recursive data types in Haskell", "body": "<p>Looks like section 3b is teaching <a href=\"https://www.inf.ed.ac.uk/teaching/courses/inf1/fp/lectures/2017/lect04.pdf\" rel=\"nofollow noreferrer\">'How Recursion works'</a> Those slides cover only conventional Haskell Lists. What you have with <code>:#:</code> is the opposite, sometimes called a <code>snoc</code> list. Then a sensible design for <code>trace</code> would be to also produce a <code>snoc</code> list result. But it doesn't (presumably because the lecturer thinks that by torturing beginners like this, they'll learn something). Haskell List comprehensions only work for Lists, not <code>snoc</code>. (Then half the content in those slides is useless for this exercise.) So 3b is teaching you structural inversion via recursion (which is the useful half of the slides).</p>\n\n<blockquote>\n  <p>violating the defined data types</p>\n</blockquote>\n\n<p>Variable <code>t</code> in the code you give is local to function <code>trace</code>, so it seems difficult to access. But its definition</p>\n\n<pre><code>t = trace com s\n</code></pre>\n\n<p>is not: </p>\n\n<ul>\n<li>We know <code>trace :: Command -&gt; State -&gt; [State]</code></li>\n<li>We can see in the equation for <code>t</code> that <code>trace</code> is applied to two arguments.</li>\n<li>So the type of <code>t</code> must be the type of the result of <code>trace</code>, that is <code>[State]</code>.</li>\n</ul>\n\n<p>Are you not sure what is the type of the arguments to <code>trace</code> in the equation for <code>t</code>? In particular <code>com</code> unpacked from the <code>Command</code> argument to <code>trace</code> at top level.</p>\n\n<ul>\n<li><p>Then we need to understand the type for <code>:#:</code>. We have for Question 3</p>\n\n<pre><code>data Command =\n     Nil\n   | Command :#: Move\n</code></pre></li>\n<li><p>That makes <code>(:#:)</code> an infix operator (which is why I've put it in parens).</p></li>\n<li>Then we can ask GHCi for its type, to make sure.</li>\n<li>Use the <code>:type</code> command, make sure to put parens.</li>\n<li><p>For contrast, also ask for the <code>:type</code> of the usual Haskell List <code>cons</code>tructor <code>(:)</code> -- see the left-right inversion?</p></li>\n<li><p>The term to the left of <code>(:#:)</code> is of type <code>Command</code>.</p></li>\n<li>Then variable <code>com</code> in the equation for <code>t</code> must be type <code>Command</code>; and that fits what the call to <code>trace</code> is expecting.</li>\n</ul>\n"}], "owner": {"reputation": 19, "user_id": 4949031, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205373356911199/picture?type=large", "display_name": "Petr Stejskal", "link": "https://stackoverflow.com/users/4949031/petr-stejskal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 193, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1543453832, "creation_date": 1543441231, "question_id": 53528548, "link": "https://stackoverflow.com/questions/53528548/how-to-debug-variables-recursive-data-types-in-haskell", "title": "How to debug variables / recursive data types in Haskell", "body": "<p><a href=\"https://www.inf.ed.ac.uk/teaching/courses/inf1/fp/exams/exam-2016-paper1-answers.pdf\" rel=\"nofollow noreferrer\">https://www.inf.ed.ac.uk/teaching/courses/inf1/fp/exams/exam-2016-paper1-answers.pdf</a></p>\n\n<pre><code>-- 3b\ntrace :: Command -&gt; State -&gt; [State]\ntrace Nil s = [s]\ntrace (com :#: mov) s = t ++ [state mov (last t)]\nwhere t = trace com s\n</code></pre>\n\n<p>I am having troubles to understand section 3b. I try to debug the variables one by one but I always end up with violating the defined data types. The code confuses me and I want to see what the variables contain. How can I do it using Debug.Trace?</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.12.0.0/Debug-Trace.html\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.12.0.0/Debug-Trace.html</a></p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "refinement-type", "liquid-haskell"], "answers": [{"tags": [], "owner": {"reputation": 1702, "user_id": 1684606, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a21fb1ca51672dfc93b938221e849aaf?s=128&d=identicon&r=PG", "display_name": "Alex Varga", "link": "https://stackoverflow.com/users/1684606/alex-varga"}, "is_accepted": true, "score": 1, "last_activity_date": 1543599304, "creation_date": 1543599304, "answer_id": 53562300, "question_id": 53527844, "link": "https://stackoverflow.com/questions/53527844/liquid-haskell-error-with-proof-combinators-and-types-refined-by-predicates/53562300#53562300", "title": "Liquid Haskell: Error with Proof Combinators and Types Refined by Predicates", "body": "<p>The issue was that I should have been using <code>NewProofCombinators</code> instead of <code>ProofCombinators</code>. Then replacing <code>==.</code> with <code>===</code> and <code>castWithTheorem (even_double x) (double' x)</code> with <code>(double' x) `withProof` (even_double x)</code> fixes the problem: <a href=\"http://goto.ucsd.edu:8090/index.html#?demo=permalink%2F1543595949_5844.hs\" rel=\"nofollow noreferrer\">http://goto.ucsd.edu:8090/index.html#?demo=permalink%2F1543595949_5844.hs</a></p>\n\n<p>All the online resources I've found use <code>ProofCombinators</code> so hopefully this saves someone some pain.</p>\n\n<p>Source: <a href=\"https://github.com/ucsd-progsys/liquidhaskell/issues/1378#issuecomment-443262472\" rel=\"nofollow noreferrer\">https://github.com/ucsd-progsys/liquidhaskell/issues/1378#issuecomment-443262472</a></p>\n"}], "owner": {"reputation": 1702, "user_id": 1684606, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a21fb1ca51672dfc93b938221e849aaf?s=128&d=identicon&r=PG", "display_name": "Alex Varga", "link": "https://stackoverflow.com/users/1684606/alex-varga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 53562300, "answer_count": 1, "score": 3, "last_activity_date": 1543599304, "creation_date": 1543438026, "question_id": 53527844, "link": "https://stackoverflow.com/questions/53527844/liquid-haskell-error-with-proof-combinators-and-types-refined-by-predicates", "title": "Liquid Haskell: Error with Proof Combinators and Types Refined by Predicates", "body": "<p>As a minimal example of the problem I'm having, here's a definition of natural numbers, a doubling function, and a type refined by an even-ness predicate:</p>\n\n<pre><code>data Nat' = Z | S Nat' deriving Show\n\n{-@ reflect double' @-}\ndouble' :: Nat' -&gt; Nat'\ndouble' Z = Z\ndouble' (S x) = (S (S (double' x)))\n\n{-@ type Even' = {v:Nat' | even' v} @-}\n\n{-@ reflect even' @-}\neven' :: Nat' -&gt; Bool\neven' Z = True\neven' (S Z) = False\neven' (S (S x)) = even' x\n</code></pre>\n\n<p>I'd like to first declare <code>{-@ double' :: Nat' -&gt; Even' @-}</code> and then prove this to be true, but I'm under the impression that I instead must first write the proof and then use <code>castWithTheorem</code> (which itself has worked for me) as such:</p>\n\n<pre><code>{-@ even_double :: x:Nat' -&gt; {even' (double' x)} @-}\neven_double Z =     even' (double' Z) \n              ==.   even' Z  \n              ==.   True \n              ***   QED\neven_double (S x) =     even' (double' (S x))\n                  ==.   even' (S (S (double' x)))\n                  ==.   even' (double' x)\n                  ?     even_double x\n                  ==.   True\n                  ***   QED\n\n{-@ double :: Nat' -&gt; Even' @-}\ndouble x = castWithTheorem (even_double x) (double' x)\n</code></pre>\n\n<p>However, this gives fairly illegible errors like:</p>\n\n<pre><code>:1:1-1:1: Error\n  elaborate solver elabBE 177 \"lq_anf$##7205759403792806976##d3tK\" {lq_tmp$x##1556 : (GHC.Types.$126$$126$ (GHC.Prim.TYPE GHC.Types.LiftedRep) (GHC.Prim.TYPE GHC.Types.LiftedRep) bool bool) | [(lq_tmp$x##1556 = GHC.Types.Eq#)]} failed on:\n      lq_tmp$x##1556 == GHC.Types.Eq#\n  with error\n      Cannot unify (GHC.Types.$126$$126$ (GHC.Prim.TYPE GHC.Types.LiftedRep) (GHC.Prim.TYPE GHC.Types.LiftedRep) bool bool) with func(0 , [(GHC.Prim.$126$$35$ @(42) @(43) @(44) @(45));\n          (GHC.Types.$126$$126$ @(42) @(43) @(44) @(45))]) in expression: lq_tmp$x##1556 == GHC.Types.Eq# \n  because\nElaborate fails on lq_tmp$x##1556 == GHC.Types.Eq#\n  in environment\n      GHC.Types.Eq# := func(4 , [(GHC.Prim.$126$$35$ @(0) @(1) @(2) @(3));\n                                 (GHC.Types.$126$$126$ @(0) @(1) @(2) @(3))])\n\n      lq_tmp$x##1556 := (GHC.Types.$126$$126$ (GHC.Prim.TYPE GHC.Types.LiftedRep) (GHC.Prim.TYPE GHC.Types.LiftedRep) bool bool)\n</code></pre>\n\n<p>What am I doing wrong? From my experiments, it seems to be caused by trying to prove that some predicate function is true of some argument.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1543432909, "post_id": 53526615, "comment_id": 93922118, "body": "You might want <code>lookup :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1543433024, "post_id": 53526615, "comment_id": 93922172, "body": "Currently, you are only getting the <code>[Int]</code> value returned by <code>map</code>, but you already stated that <code>findTup</code> would return an <code>Int</code>, not a <code>[Int]</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543433117, "post_id": 53526615, "comment_id": 93922217, "body": "<code>\\(x,y) -&gt; x</code> is already defined as <code>fst</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1543433121, "post_id": 53526615, "comment_id": 93922219, "body": "You may find it interesting to delete the type signature for <code>findTup</code> and see what happens. If it compiles, what type is inferred? If it doesn&#39;t compile, how does the error change? Do you find yourself surprised by the outcome?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543446538, "post_id": 53526615, "comment_id": 93927594, "body": "First things first, before checking the tuples have you decided what would be the answer if you fail to find a match?"}], "answers": [{"tags": [], "owner": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "is_accepted": false, "score": 0, "last_activity_date": 1543435824, "creation_date": 1543435824, "answer_id": 53527361, "question_id": 53526615, "link": "https://stackoverflow.com/questions/53526615/searching-a-tuple-for-a-matching-pair/53527361#53527361", "title": "Searching a tuple for a matching pair", "body": "<p>Let's start with what you have for <code>findTup</code>. If we put your function into ghci and ask it for the type we get</p>\n\n<pre><code>ghci&gt; findTup rs a = map (\\(x,y) -&gt; x) rs\nghci&gt; :t findTup\nfindTup :: [(b1, b2)] -&gt; p -&gt; [b1]\n</code></pre>\n\n<p>This tells us that your function returns a list of items that have some type <code>b1</code>, which makes sense given that the type signature of map is <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>. Another function that applies a given function to every element of a list which is more useful to us here is <code>filter</code>. Filter has a type signature of <code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code>.</p>\n\n<p>So lets try replacing the <code>map</code> in your code with <code>filter</code> which gives <code>findTup rs a = filter (\\(x, y) -&gt; x) rs</code>. Now if we check the type we find that it is <code>findTup :: [(Bool, b)] -&gt; p -&gt; [(Bool, b)]</code>. There's still a few problems with this function. For starters, <code>(\\(x, y) -&gt; x)</code> is constraining our input to have a boolean in the first item of the tuple, but that isn't what we want. We need to rewrite the filtering function so that it actually performs our search. <code>(\\(x, y) -&gt; x == a)</code> is what we actually want. This will cause filter to return only the elements that match the one we are searching for. Now we can see that <code>findTup :: Eq a =&gt; [(a, b)] -&gt; a -&gt; [(a, b)]</code>. </p>\n\n<p>Unfortunately this still returns a list, and we only want a single item. We can use the <code>head</code> function to get only the first item that matches, so <code>findTup rs a = head $ filter (\\(x, y) -&gt; x == a) rs</code>. Ghci tells us that the signature for this function is <code>findTup :: Eq a =&gt; [(a, b)] -&gt; a -&gt; (a, b)</code> which is so close to what we want. The only thing left is to get just the second value from the tuple, which we can do with the function <code>snd</code>.</p>\n\n<p>So our final code will be <code>findTup rs a = snd . head $ filter (\\(x, y) -&gt; x == a) rs</code>. A quick check in ghci shows <code>findTup :: Eq a =&gt; [(a, b)] -&gt; a -&gt; b</code>. Substituting <code>Int</code> in for the type variables we find <code>findTup :: [(Int, Int)] -&gt; Int -&gt; Int</code></p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1543439658, "last_edit_date": 1543439658, "creation_date": 1543439265, "answer_id": 53528097, "question_id": 53526615, "link": "https://stackoverflow.com/questions/53526615/searching-a-tuple-for-a-matching-pair/53528097#53528097", "title": "Searching a tuple for a matching pair", "body": "<p>The problem is your declared type doesn't match your partial implementation. You could simply change the type until you do the filtering:</p>\n\n<pre><code>findTup :: Rel -&gt; Int -&gt; [Int]\nfindTup rs a = map (\\(x,y) -&gt; x) rs\n</code></pre>\n\n<p>or add the filtering. To do that, explicit recursion and pattern matching would be simpler than using <code>map</code>:</p>\n\n<pre><code>findTup :: Rel -&gt; Int -&gt; Int\n-- findTup [] a = ...   -- Omitted to reflect the assumption of success\nfindTup ((k, v):rs) a = if k == a then v else findTup rs a\n</code></pre>\n\n<hr>\n\n<p>However, there's no need to reinvent the wheel:</p>\n\n<pre><code>import Data.Maybe\n\nfindTup :: Rel -&gt; Int -&gt; Int\nfindTup rs a = fromJust (lookup a rs)\n</code></pre>\n\n<p>or, since you probably shouldn't assume the lookup will succeed,</p>\n\n<pre><code>findTup :: Rel -&gt; Int -&gt; Maybe Int\nfindTup = flip lookup\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10718909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abe8005d747d56dec93fe7c215b1481f?s=128&d=identicon&r=PG&f=1", "display_name": "steinar", "link": "https://stackoverflow.com/users/10718909/steinar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1543439658, "creation_date": 1543432736, "question_id": 53526615, "link": "https://stackoverflow.com/questions/53526615/searching-a-tuple-for-a-matching-pair", "title": "Searching a tuple for a matching pair", "body": "<blockquote>\n  <p>[(3,9),(4,16),(5,25)] 4 = 16</p>\n</blockquote>\n\n<p>I was using <code>map (\\(x,y ) -&gt; x) [(3,9),(4,16),(5,25)]</code> to get the fst of every element, and then was going to filter it for the match--but I'm having errors just making the first piece work:</p>\n\n<pre><code>findTup :: Rel -&gt; Int -&gt; Int\nfindTup rs a = map (\\(x,y ) -&gt; x) rs\n</code></pre>\n\n<blockquote>\n  <ul>\n  <li>Couldn't match expected type 'Int' with actual type '[Int]'</li>\n  <li>In the expression: map (\\ (x, y) -> x) rs</li>\n  </ul>\n</blockquote>\n\n<p>Is there any way to make map work on the tuple with <code>Int -&gt; Int</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 8, "creation_date": 1543418106, "post_id": 53522593, "comment_id": 93913878, "body": "Please provide a more useful question title."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543420054, "post_id": 53522593, "comment_id": 93915267, "body": "this approach is <i>very</i> wrong. transposing a matrix should only be about manipulating the elements positionally, without regard to their values, but <code>delete</code> works with the elements&#39; values."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1543420100, "post_id": 53522593, "comment_id": 93915301, "body": "the answer you&#39;re looking for is: there&#39;s a missing comma in <code>[[1,2,3],[0,4,5],[0,06]]</code>."}, {"owner": {"reputation": 11, "user_id": 10708652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97e1d0fe4f31f834145ccf58ac4c6cc?s=128&d=identicon&r=PG&f=1", "display_name": "tbotl", "link": "https://stackoverflow.com/users/10708652/tbotl"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543427934, "post_id": 53522593, "comment_id": 93919747, "body": "@WillNess yes, my mistake, i already put a comma but still the same mistake. Someone posted here another way to do this transpose function"}, {"owner": {"reputation": 11, "user_id": 10708652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97e1d0fe4f31f834145ccf58ac4c6cc?s=128&d=identicon&r=PG&f=1", "display_name": "tbotl", "link": "https://stackoverflow.com/users/10708652/tbotl"}, "reply_to_user": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 0, "creation_date": 1543427950, "post_id": 53522593, "comment_id": 93919759, "body": "@deceze sorry, first time here"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10708652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97e1d0fe4f31f834145ccf58ac4c6cc?s=128&d=identicon&r=PG&f=1", "display_name": "tbotl", "link": "https://stackoverflow.com/users/10708652/tbotl"}, "edited": false, "score": 0, "creation_date": 1543419043, "post_id": 53522688, "comment_id": 93914531, "body": "i still couldn&#39;t solve it, because in a matrix all the lines have numbers so it can&#39;t be possible that the first line is an empty list"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11, "user_id": 10708652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97e1d0fe4f31f834145ccf58ac4c6cc?s=128&d=identicon&r=PG&f=1", "display_name": "tbotl", "link": "https://stackoverflow.com/users/10708652/tbotl"}, "edited": false, "score": 2, "creation_date": 1543419908, "post_id": 53522688, "comment_id": 93915168, "body": "@tbotl no, the error message you got says that you did hit that case at run time."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11, "user_id": 10708652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97e1d0fe4f31f834145ccf58ac4c6cc?s=128&d=identicon&r=PG&f=1", "display_name": "tbotl", "link": "https://stackoverflow.com/users/10708652/tbotl"}, "edited": false, "score": 0, "creation_date": 1543422987, "post_id": 53522688, "comment_id": 93917128, "body": "@tbotl Initially, yes, that&#39;s true. But your last row has only two columns, while other rows have three (since you forgot a comma, apparently). So, after two columns are removed, we get to a &quot;matrix&quot; which has two nonempty rows, and a last empty row, triggering the error."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1543418285, "creation_date": 1543418285, "answer_id": 53522688, "question_id": 53522593, "link": "https://stackoverflow.com/questions/53522593/how-can-i-solve-this-in-haskell/53522688#53522688", "title": "How can i solve this in haskell?", "body": "<p>To discover which cases you are missing, you should turn on warnings using the <code>-Wall</code> flag, as shown in the GHCi session below.</p>\n\n<pre><code>&gt; :set -Wall\n&gt; type Mat a = [[a]]\n&gt; :{\n| primelem :: Mat a -&gt; [a]\n| primelem [] = []\n| primelem [[x]] = [x] \n| primelem ((x:xs):t) = x : primelem t\n| :}\n\n&lt;interactive&gt;:5:1: warning: [-Wincomplete-patterns]\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018primelem\u2019: Patterns not matched: ([]:_)\n\n&lt;interactive&gt;:7:14: warning: [-Wunused-matches]\n    Defined but not used: \u2018xs\u2019\n</code></pre>\n\n<p>So, the case you are missing is:</p>\n\n<pre><code>primelem ([]:t) = ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543423249, "post_id": 53523481, "comment_id": 93917286, "body": "For what it is worth, the <code>transpose</code> function form the library does work on &quot;jagged matrices&quot;, skipping over missing entries. E.g. <code>transpose [[1,2],[3],[4,5]] = [[1,3,4],[2,5]]</code>. On whether that feature is useful or harmful, I&#39;m not sure."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543440494, "post_id": 53523481, "comment_id": 93925504, "body": "I&#39;d say that&#39;s the subtle difference between <code>transpose :: [[a]] -&gt; [[a]]</code> and <code>transpose :: Mat a -&gt; Mat a</code>; the latter should strive to preserve the intention that <code>Mat a</code> really is a valid matrix type, and not expose the leaky abstraction provided by the <code>type</code> alias."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1543422600, "last_edit_date": 1543422600, "creation_date": 1543420788, "answer_id": 53523481, "question_id": 53522593, "link": "https://stackoverflow.com/questions/53522593/how-can-i-solve-this-in-haskell/53523481#53523481", "title": "How can i solve this in haskell?", "body": "<p>You're over-thinking this. A list of empty lists is its own transpose.</p>\n\n<pre><code>transpose m | all null m = []\n            | any null m = error \"Not a matrix\"\n</code></pre>\n\n<p>Otherwise, take the first element of each list as the first row of the transpose, and transpose the remaining matrix as the rest of the transpose.</p>\n\n<pre><code>transpose m = map head m : transpose (map tail m)\n</code></pre>\n\n<p>This function is effectively total, failing only on those lists-of-lists that aren't actually matrices. The fact that it fails late on non-matrix values is a bit of a wart:</p>\n\n<pre><code>&gt; transpose [[1,2], [3]]\n[[1,3]*** Exception: Not a matrix\nCallStack (from HasCallStack):\n  error, called at tmp.hs:3:28 in main:Main\n</code></pre>\n\n<p>If you want to handle invalid matrices a little more cleanly, return a <code>Maybe (Mat a)</code> instead.</p>\n\n<pre><code>transpose :: Mat a -&gt; Maybe (Mat a)\ntranspose m | all null m = Just []\n            | any null m = Nothing\n            | otherwise  = ((map head m):) &lt;$&gt; transpose (map tail m)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10708652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97e1d0fe4f31f834145ccf58ac4c6cc?s=128&d=identicon&r=PG&f=1", "display_name": "tbotl", "link": "https://stackoverflow.com/users/10708652/tbotl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "closed_date": 1543428261, "answer_count": 2, "score": -3, "last_activity_date": 1543422600, "creation_date": 1543418005, "last_edit_date": 1543418216, "question_id": 53522593, "link": "https://stackoverflow.com/questions/53522593/how-can-i-solve-this-in-haskell", "closed_reason": "Duplicate", "title": "How can i solve this in haskell?", "body": "<p>I got this code to make a transposed matrix, but it doesn't work 100% fine.</p>\n\n<pre><code>type Mat a = [[a]]\n\ntranspose' :: Eq a =&gt; Mat a -&gt; Mat a\ntranspose' [] = []\ntranspose' (h:t) = primelem (h:t):transpose' (eliminate' (h:t))\n\nprimelem :: Mat a -&gt; [a]\nprimelem [] = []\nprimelem [[x]] = [x] \nprimelem ((x:xs):t) = x : primelem t\n\neliminate' :: Eq a =&gt; Mat a -&gt; Mat a\neliminate' [] = []\neliminate' (h:t) = (delete (head h) h):eliminate' t\n\n*Main&gt; transpose' [[1,2,3],[0,4,5],[0,06]]\n\n[[1,0,0],[2,4,6],[3,5*** Exception:(..)Non-exhaustive patterns in function primelem\n</code></pre>\n\n<p>I am trying to figure it out, but i really don't know which case is missing.</p>\n"}, {"tags": ["haskell", "pattern-matching", "pattern-synonyms"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1543412767, "post_id": 53520272, "comment_id": 93910406, "body": "Pretty sure the answer is <b>no</b>, but if you give some more context why you want that perhaps there&#39;s an alternative approach."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1543413260, "post_id": 53520272, "comment_id": 93910737, "body": "@leftaroundabout I figured out a way that sort of does what I want, the specific case where I needed it was better solved by simply not using pattern synonyms at all."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1543414381, "post_id": 53521044, "comment_id": 93911466, "body": "You can also look at the support for named fields in pattern synonyms. I bet you could mix that with some record extensions to do almost what you asked for."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543415990, "post_id": 53521044, "comment_id": 93912484, "body": "@dfeuer I briefly thought whether something like that might be possible, but couldn&#39;t figure out how it would be possible. But pattern synonyms keep twisting my brain anyways, so maybe I&#39;ve missed something."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1543428147, "post_id": 53521044, "comment_id": 93919852, "body": "&quot;you need to enumerate all parts of the pattern you want to use&quot; - to me, one of the uses of pattern synonyms is to avoid enumerating all parts of a constructor and <i>only</i> enumerate the ones I want to use. e.g. <code>pattern Head :: a -&gt; [a] ; pattern Head a &lt;- a : _</code> for <code>safeHead :: [a] -&gt; Maybe a; safeHead (Head a) = Just a; safeHead _ = Nothing</code>"}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 6, "last_activity_date": 1543413222, "creation_date": 1543413222, "answer_id": 53521044, "question_id": 53520272, "link": "https://stackoverflow.com/questions/53520272/can-i-capture-values-from-a-pattern-synonym/53521044#53521044", "title": "Can I capture values from a pattern synonym?", "body": "<p>Ok, this is slightly embarrasing, but I found that just doing this works:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\npattern P :: Int -&gt; [Int]\npattern P a &lt;- a:_\n\nf :: [Int] -&gt; Int\nf (P b) = b\n\nmain = print $ f [42]\n</code></pre>\n\n<p>The key point here is that the pattern parameter becomes explicit, but then it's also passed as an <code>b</code> pattern<sup>1</sup> which will be matched. I was missing this one piece of the puzzle.</p>\n\n<p>The drawback is that obviously you need to enumerate all parts of the pattern you want to use.</p>\n\n<hr>\n\n<p><sup>1</sup>Of course this can still be called <code>a</code>, I just named it differently for illustration.</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 3, "last_activity_date": 1543429366, "last_edit_date": 1543429366, "creation_date": 1543428927, "answer_id": 53525683, "question_id": 53520272, "link": "https://stackoverflow.com/questions/53520272/can-i-capture-values-from-a-pattern-synonym/53525683#53525683", "title": "Can I capture values from a pattern synonym?", "body": "<p>Do you want something like this?</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, RecordWildCards #-}\nmodule Temp where\n\npattern Cons :: a -&gt; [a] -&gt; [a]\npattern Cons { car, cdr } &lt;- car:cdr\n\nsafeHead :: [a] -&gt; Maybe a\nsafeHead Cons{..} = Just car\nsafeHead _ = Nothing\n</code></pre>\n\n<p>This used to cause errors but <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11987\" rel=\"nofollow noreferrer\">should work with recent releases of GHC</a>.</p>\n\n<p>Bear in mind that <code>car</code> and <code>cdr</code> are defined globally as functions and shadowed locally via <code>RecordWildCards</code>:</p>\n\n<pre><code>ghci&gt; :browse Temp\npattern Cons :: a -&gt; [a] -&gt; [a]\ncar :: [a] -&gt; a\ncdr :: [a] -&gt; [a]\nsafeHead :: [a] -&gt; Maybe a\n</code></pre>\n"}], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 53521044, "answer_count": 2, "score": 3, "last_activity_date": 1543429366, "creation_date": 1543410676, "last_edit_date": 1543411008, "question_id": 53520272, "link": "https://stackoverflow.com/questions/53520272/can-i-capture-values-from-a-pattern-synonym", "title": "Can I capture values from a pattern synonym?", "body": "<p>Assuming a pattern:</p>\n\n<pre><code>pattern P :: [Int]\npattern P &lt;- a:_\n</code></pre>\n\n<p>Can I <em>somehow</em> use <code>a</code> in the function <code>f</code>?</p>\n\n<pre><code>f :: [Int] -&gt; Int\nf P = a\n</code></pre>\n\n<p>The code above generates an error of <code>Not in scope: 'a'</code>.</p>\n"}, {"tags": ["haskell", "weak-head-normal-form"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 3, "creation_date": 1543401257, "post_id": 53517200, "comment_id": 93903502, "body": "Without an explicit type: <code>:t x -- x :: Num a =&gt; a</code>. Which can be inserted into different expressions with a different type.  <code>x :: Int -- 3</code> , <code>x :: Float -- 3.0</code>. Using these hints we can assume that <code>x</code> with the type <code>Num a =&gt; a</code> is reevaluated when given different instances of <code>Num</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 10, "last_activity_date": 1543401576, "last_edit_date": 1543401576, "creation_date": 1543401273, "answer_id": 53517392, "question_id": 53517200, "link": "https://stackoverflow.com/questions/53517200/confused-by-converting-whnf-to-nf-in-haskell/53517392#53517392", "title": "Confused by converting WHNF to NF in Haskell", "body": "<p>Since in GHCi the monomoprhism restriction is disabled, the last <code>x</code> is a polymorphic value of type <code>x :: Num a =&gt; a</code>. So it is not a simple integer, but a kind-of function <code>DictNum a -&gt; a</code> which is ready to create a value in any numeric type.</p>\n\n<p>Indeed, <code>x :: Int, x :: Float, x :: Double</code> will run and produce  different values. These values are numerically the same, but computationally different, since they are representations in different types.</p>\n\n<p>Since <code>x</code> is, essentially, \"multiple values, generated on demand\", there is no single WHNF or NF here.</p>\n\n<p>Note that if we compute <code>(x :: Int) + (x :: Int)</code>, then <code>x</code> is being recomputed <em>twice</em>: GHC in general will not \"cache\" the WHNF at type <code>Int</code> for successive computations. This is similar to <code>f 3 + f 3</code>, where <code>f 3</code> is not cached (memoized).</p>\n\n<p>This duplicate computation is precisely what the monomorphism restriction tries to avoid.</p>\n"}], "owner": {"reputation": 993, "user_id": 4541287, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/64f22664ee95fd0770558a2d2daeb879?s=128&d=identicon&r=PG&f=1", "display_name": "Bogdan Ruzhitskiy", "link": "https://stackoverflow.com/users/4541287/bogdan-ruzhitskiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "closed_date": 1543427553, "accepted_answer_id": 53517392, "answer_count": 1, "score": 7, "last_activity_date": 1543401576, "creation_date": 1543400647, "question_id": 53517200, "link": "https://stackoverflow.com/questions/53517200/confused-by-converting-whnf-to-nf-in-haskell", "closed_reason": "Duplicate", "title": "Confused by converting WHNF to NF in Haskell", "body": "<p>In a simple example, converting WHNF to NF by printing works fine</p>\n\n<pre><code>Prelude&gt; let x = 1 + 2 :: Int\nPrelude&gt; :sprint x\nx = _\nPrelude&gt; x\n3\nPrelude&gt; :sprint x\nx = 3\n</code></pre>\n\n<p>But in a case, the type is not declared it doesn't work.</p>\n\n<pre><code>Prelude&gt; let x = 1 + 2\nPrelude&gt; :sprint x\nx = _\nPrelude&gt; x\n3\nPrelude&gt; :sprint x\nx = _\n</code></pre>\n\n<p>Can you explain in some details why conversion doesn't work in the last case?</p>\n"}, {"tags": ["haskell", "types", "lava"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1543400007, "post_id": 53516593, "comment_id": 93902754, "body": "your input <code>x</code> will never match <code>0</code> nor <code>1</code>  nor <code>15</code> because <code>x</code> is a list not a number, so you are matching against <code>_</code> which returns <code>1000</code>. Actually I think it should not compile?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1543400500, "post_id": 53516593, "comment_id": 93903062, "body": "You should provide a pointer to the definition of your <code>Signal</code>. It&#39;s impossible to know what it is. If I had to guess, a signal is a value depending on time (e.g. an oscillating signal), so we can&#39;t convert it to a single value. The best we could do is sampling the signal at a single point, but that&#39;s not interesting. In general there is no conversion between <code>F Int</code> and <code>Int</code>, for a generic <code>F</code>. E.g. we can not convert <code>[Int]</code> to <code>Int</code>, or <code>Maybe Int</code> to <code>Int</code>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543401786, "post_id": 53516593, "comment_id": 93903844, "body": "@chi The library name <i>is</i> given in the question, though of course it would be better to include a link."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1543404341, "post_id": 53516593, "comment_id": 93905295, "body": "@AlexeyRomanov I only see &quot;Lava&quot; mentioned above, and there are <a href=\"http://hackage.haskell.org/packages/search?terms=lava\" rel=\"nofollow noreferrer\">multiple packages</a> for that, so I&#39;m not sure. Perhaps it&#39;s <a href=\"http://hackage.haskell.org/package/kansas-lava-0.2.4.5/docs/Language-KansasLava-Signal.html\" rel=\"nofollow noreferrer\">this one</a>."}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 1, "last_activity_date": 1543401697, "creation_date": 1543401697, "answer_id": 53517525, "question_id": 53516593, "link": "https://stackoverflow.com/questions/53516593/from-signal-int-to-int-in-haskell/53517525#53517525", "title": "From Signal Int to Int in Haskell", "body": "<p>Due to the way integer literals work in Haskell, your code <a href=\"https://stackoverflow.com/questions/48728742/haskell-pattern-matching-on-num-types\">is making comparisons <code>x == fromInteger 0</code>, <code>x == fromInteger 1</code> etc.</a> So it depends on the way <code>==</code> and <code>fromInteger</code> are implemented for <code>Signal Int</code>.</p>\n\n<p>And if you check <a href=\"http://hackage.haskell.org/package/chalmers-lava2000-1.6.1/docs/src/Lava-Signal.html\" rel=\"nofollow noreferrer\">sources</a>, it turns out <code>fromInteger</code> always creates a new <code>Ref</code> and won't be equal to any existing <code>Signal</code>s.</p>\n\n<p>So the question remains, how to do what you want. Pattern-matching should work, but instead of comparing with literals you'll need to go inside the actual structure of <code>Signal</code>. If I got it correct (without testing) something like this should work (returning <code>Maybe Int</code> because not all <code>Signal Int</code> signals are constant):</p>\n\n<pre><code>signalInt2int :: Signal Int -&gt; Maybe Int\nsignalInt2int (Signal (Symbol ref)) = case deref ref of\n    Int i -&gt; Just i\n    _ -&gt; None\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 4911399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jEpYo.jpg?s=128&g=1", "display_name": "Balkis", "link": "https://stackoverflow.com/users/4911399/balkis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 53517525, "answer_count": 1, "score": 0, "last_activity_date": 1543402285, "creation_date": 1543398742, "last_edit_date": 1543402285, "question_id": 53516593, "link": "https://stackoverflow.com/questions/53516593/from-signal-int-to-int-in-haskell", "title": "From Signal Int to Int in Haskell", "body": "<p>I am working with a Haskell libraby that discribes digital circuits (Lava), its function inputs and outputs are of the type signal ( Signal Bool , Signal Int) , as far as i know there is not a function that converts from a Signal Int to Int, I know there are several arithmetic operations that we can use with the type Signal Int, but not all arithmetic operations are possible. I wrote this function that is suppose to convert from Signal Int to Int ( just for the values that I need). </p>\n\n<pre><code>signalInt2int :: Signal Int -&gt; Int\nsignalInt2int x = case x of \n    0 -&gt; 0 \n    1 -&gt; 1 \n    15 -&gt; 15 \n    _ -&gt; 1000\n</code></pre>\n\n<p>Just for trying I only wrote these 4 possibilities, the problem is whenever I call this function no matter what the input is, the output is always 1000. I make sure to use an input of the type Signal Int. Here is what I get. </p>\n\n<p><a href=\"https://i.stack.imgur.com/OJWZM.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OJWZM.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Can anyone point out where the problem is? I will be grateful for your help. </p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1543394485, "creation_date": 1543394485, "answer_id": 53515298, "question_id": 53515297, "link": "https://stackoverflow.com/questions/53515297/invoking-stack-command-on-specific-stack-yaml-file/53515298#53515298", "title": "Invoking stack command on specific stack.yaml file", "body": "<p>To invoke the build process for a different stack yaml file, you need to set the <code>STACK_YAML</code> environment variable appropriately. Sample demo in bash:</p>\n\n<pre><code>$ STACK_YAML='stack-lts-12.yaml' stack build\n...\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "is_accepted": true, "score": 1, "last_activity_date": 1543397094, "last_edit_date": 1543397094, "creation_date": 1543396310, "answer_id": 53515815, "question_id": 53515297, "link": "https://stackoverflow.com/questions/53515297/invoking-stack-command-on-specific-stack-yaml-file/53515815#53515815", "title": "Invoking stack command on specific stack.yaml file", "body": "<p>The flag <code>--stack-yaml file</code> works for me too. Not sure if it is available for all versions though. Tested with stack version 1.7.1</p>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 53515815, "answer_count": 2, "score": 0, "last_activity_date": 1543401632, "creation_date": 1543394485, "last_edit_date": 1543401632, "question_id": 53515297, "link": "https://stackoverflow.com/questions/53515297/invoking-stack-command-on-specific-stack-yaml-file", "title": "Invoking stack command on specific stack.yaml file", "body": "<p>I have a multiple stack based yaml files for different resolvers in my Haskell project. </p>\n\n<pre><code>$ ls *yaml\nstack.yaml\nstack-lts-12.yaml\nstack-lts-11.yaml\nstack-lts-10.yaml\n</code></pre>\n\n<p>How can I invoke the <code>stack</code> build command for a specific yaml file ? By default, it picks up <code>stack.yaml</code> file.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 2, "creation_date": 1543379773, "post_id": 53512163, "comment_id": 93893729, "body": "You can us <code>&lt;*</code> instead of custom <code>&gt;==</code>. <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Applicative.html#v:-60--42-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543379958, "post_id": 53512163, "comment_id": 93893771, "body": "Is expression can occur only after statement?"}, {"owner": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543380108, "post_id": 53512163, "comment_id": 93893803, "body": "Thanks for the help @talex with the base function. Searched for something like it, and was surprised I couldn&#39;t find anything.  Expressions are always the last in the block, and there can be 0 or more statements."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543380309, "post_id": 53512163, "comment_id": 93893850, "body": "I just search for <code>m a -&gt; m b -&gt; m a</code> in hoogle :)"}, {"owner": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543380343, "post_id": 53512163, "comment_id": 93893861, "body": "I did the same on stackage and nothing showed up. Weird."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543380499, "post_id": 53512163, "comment_id": 93893899, "body": "Stackage only find it for <code>Applicative f =&gt; f a -&gt; f b -&gt; f a</code>."}, {"owner": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543380523, "post_id": 53512163, "comment_id": 93893906, "body": "That would be why then :)"}], "answers": [{"comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543384626, "post_id": 53512795, "comment_id": 93895113, "body": "That should fail <code>parseStmt</code> and when <code>many</code> try and fail it should stop. I don&#39;t have ghc at hand and can&#39;t  check that myself."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 0, "last_activity_date": 1543383466, "creation_date": 1543383466, "answer_id": 53512795, "question_id": 53512163, "link": "https://stackoverflow.com/questions/53512163/reading-list-of-statements-and-ending-with-a-single-expression-when-statements/53512795#53512795", "title": "Reading list of statements and ending with a single expression, when statements can be expressions", "body": "<p>The problem with your code is that <code>sepBy</code> have certain expectation about its parameters. In case separator successfully parsed it doesn't expect element parser to fail.</p>\n\n<p>To fix that I suggest following improvement</p>\n\n<pre><code>parseBlock = between\n    (char '{' &gt;&gt; spaces)\n    (spaces &gt;&gt; char '}')\n    (do\n        stmts &lt;- try $ many $ spaces *&gt; parseStmt\n        spaces\n        parseExpr\n    )\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "edited": false, "score": 0, "creation_date": 1543416205, "post_id": 53514054, "comment_id": 93912607, "body": "This worked, but I didn&#39;t have to do another change. I have declarations, of the form <code>[var|let] &lt;ident&gt; ....</code>. The var and let keywords were being picked up, so I had to save a list of reserved keywords."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "edited": false, "score": 0, "creation_date": 1543433767, "post_id": 53514054, "comment_id": 93922532, "body": "@Herbstein &quot;another change&quot; stand for what ?"}, {"owner": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "edited": false, "score": 0, "creation_date": 1543461743, "post_id": 53514054, "comment_id": 93930858, "body": "I didn&#39;t mention it because I didn&#39;t find it super relevant. Since my variable declarations look like <code>[var|let] &lt;ident&gt; = &lt;expr&gt;</code> the expression parser used in <code>manyTill</code> got caught there already. All I did was making a list of reserved keywords and failed if my parsed expression was in that list.  My actual implementation is here: <a href=\"https://github.com/Herbstein/dusker/blob/master/src/Lib.hs\" rel=\"nofollow noreferrer\">github.com/Herbstein/dusker/blob/master/src/Lib.hs</a>"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "edited": false, "score": 0, "creation_date": 1543465752, "post_id": 53514054, "comment_id": 93931694, "body": "@Herbstein Yes, I see"}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 1, "last_activity_date": 1543389423, "creation_date": 1543389423, "answer_id": 53514054, "question_id": 53512163, "link": "https://stackoverflow.com/questions/53512163/reading-list-of-statements-and-ending-with-a-single-expression-when-statements/53514054#53514054", "title": "Reading list of statements and ending with a single expression, when statements can be expressions", "body": "<p>Instead of <code>sepBy</code>, this sort of problems often can be solved by <code>manyTill</code>, the tricky point is to keep the input that don't be consumed by <code>manyTill</code>, it have to use <code>try $ lookAhead</code> </p>\n\n<blockquote>\n  <p>Side note: the reason can be found in source code of <code>Parsec</code>.\n  Internally, <code>manyTill</code> use <code>&lt;|&gt;</code>, so why <code>try</code> take effect, and\n  <code>lookAhead</code> can retain the input when apply monad bind <code>&gt;&gt;=</code>, <code>&gt;&gt;</code></p>\n</blockquote>\n\n<p>So, the correction look like:</p>\n\n<pre><code>parseBlock = between\n    (char '{' &gt;&gt; spaces)\n    (spaces &gt;&gt; char '}')\n    (do\n        stmts &lt;- manyTill (parseStmt &lt;* spaces) \n                          (try $ lookAhead (parseExpr &gt;&gt; space))\n        parseExpr\n    )\n</code></pre>\n\n<p>The above parser just return the output of <code>parseExpr</code>, i.e. <code>5</code>, if this is your intent, it can be simpified by:</p>\n\n<pre><code>manyTill (parseStmt &lt;* spaces) (try $ lookAhead (parseExpr &gt;&gt; space)) &gt;&gt; parseExpr\n</code></pre>\n\n<p>if you actually need the parsed string of statements as well, it become:</p>\n\n<pre><code>(do\n    stmts &lt;- manyTill (parseStmt &lt;* spaces) \n                      (try $ lookAhead (parseExpr &gt;&gt; space))\n    expr  &lt;- parseExpr\n    return (concat (stmts ++ [expr]))\n)\n</code></pre>\n\n<p>it return <code>555</code></p>\n"}], "owner": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 53514054, "answer_count": 2, "score": 1, "last_activity_date": 1543389423, "creation_date": 1543379419, "last_edit_date": 1543380283, "question_id": 53512163, "link": "https://stackoverflow.com/questions/53512163/reading-list-of-statements-and-ending-with-a-single-expression-when-statements", "title": "Reading list of statements and ending with a single expression, when statements can be expressions", "body": "<p>I've run into a problem where I want to parse a block of code with the following syntax</p>\n\n<pre><code>{\n    &lt;stmt&gt;;\n    &lt;stmt&gt;;\n    &lt;stmt&gt;;\n    &lt;expr&gt;\n}\n</code></pre>\n\n<p>A statement can be of the form <code>&lt;expr&gt;;</code>. This trips up Parsec in a way which I don't know how to fix. This is probably just me being kinda new to Haskell and the Parsec library, but I don't know where to search for a solution to the problem. I've written an example that captures my exact problem. </p>\n\n<p>With the input <code>{ 5; 5; 5 }</code> it fails on the third <code>5</code>, because it expects there to be a <code>;</code> present. How do I get around this?</p>\n\n<pre><code>import           Text.ParserCombinators.Parsec\nimport           Text.ParserCombinators.Parsec.Combinator\n\nparseIdentifier = do\n    first &lt;- letter\n    rest  &lt;- many $ letter &lt;|&gt; digit &lt;|&gt; char '_'\n    return $ first : rest\n\nparseExpr = parseIdentifier &lt;|&gt; many1 digit\n\n\nparseStmt = parseExpr &lt;* char ';'\n\nparseBlock = between\n    (char '{' &gt;&gt; spaces)\n    (spaces &gt;&gt; char '}')\n    (do\n        stmts &lt;- try $ parseStmt `sepBy` spaces\n        parseExpr\n    )\n\nreadParser :: Parser String -&gt; String -&gt; String\nreadParser parser input = case parse parser \"dusk\" input of\n    Left  err -&gt; show err\n    Right val -&gt; val\n\nmain = interact $ readParser parseBlock\n</code></pre>\n"}, {"tags": ["haskell", "hamming-numbers", "smooth-numbers"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1543362813, "post_id": 53509947, "comment_id": 93889864, "body": "Your solution satisfies the requirements you stated. Maybe you can state the problem more carefully? e.g. it sounds like you want the list to be in some particular order"}, {"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 0, "creation_date": 1543363155, "post_id": 53509947, "comment_id": 93889959, "body": "How many powers of 5 <i>are</i> there? <i>Bound</i> this limit for the sake of inspecting output."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1543364764, "post_id": 53509947, "comment_id": 93890368, "body": "Is there a non-dumb way of doing this that&#39;s better than <a href=\"https://tio.run/##PZBBa8JAEIXv@RXvmC0mqKUXQaEggtDiIYUeRHDcTJLFZNbubhBKf3vTNUrnNLvvfW92pyF/5rYdBtNdrAv46qk1leESawqUFxxAHkWSZXg41nzq6/zDkeYkkb47sfNYLLDfSuCa3eH/conaIi1yb6RuOVjBTCWIdW3Y8djF2OghrfGDcItE6ht7vVPffFOUwoZazzGul5IrI1yO7ANcQlNUi7zkOIQ3Rsp3I6Nkq9F4q1QmEK@QrSBYjA8Tj2OR92KsHCNeOdutjQ9GdHj1@i22SDu6RCOeFPbzCZ4neDkolSQdxQnxz9sdUnU/LXFxRiIS6MyYTad4rEENw6@uWqr9kH1SXHW2m/8B\" rel=\"nofollow noreferrer\">my solution</a>?"}, {"owner": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1543370370, "post_id": 53509947, "comment_id": 93891613, "body": "@melpomene Your code seems like a perfect solution, even though it will take me some time to figure it out. Please consider posting it as a solution to the question."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1543395887, "post_id": 53509947, "comment_id": 93900216, "body": "@melpomene yes, there is. your solution overproduces the sequence, always adding three multiples into it, while picking one. You could conditionally add only the smallest one, by in effect maintaining three back-pointers into the ordered sequence that is being produced. the famous and canonical code can be found on the tags (which I added), <a href=\"http://rosettacode.org/wiki/Hamming_numbers#Haskell\" rel=\"nofollow noreferrer\">RosettaCode page</a>, and <a href=\"https://en.wikipedia.org/wiki/Haskell_features#Hamming_numbers\" rel=\"nofollow noreferrer\">&quot;Haskell Features&quot; page</a> on Wikipedia."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1543395890, "post_id": 53509947, "comment_id": 93900218, "body": "@melpomene /contd./ then there&#39;s a <a href=\"https://stackoverflow.com/q/12480291/849891\">new, twice faster</a> code, which produces each number just once. (also present on the RosettaCode and WP pages linked above)."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543396066, "post_id": 53509947, "comment_id": 93900316, "body": "@WillNess Thanks. I knew I had to be doing something stupid."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1543396166, "post_id": 53509947, "comment_id": 93900383, "body": "@melpomene not stupid, just not the best. btw your code is ~ n log n instead of being just linear, too, because the overproduced segment has ~ n^(2/3) elements in it (assuming the Set union is logarithmic in the set&#39;s size). -- the <i>&quot;stupid&quot;</i> way would be to filter the <code>[1..]</code> stream for multiples of 2,3,5 (since that makes it exponential)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1543396922, "post_id": 53509947, "comment_id": 93900846, "body": "@melpomene having now read your answer, your analysis there is spot on. :) good answer, btw, precisely because of that analysis, and the general exposition. I&#39;d upvoted. please ping me if you reconsider the deletion."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1543397024, "post_id": 53509947, "comment_id": 93900904, "body": "@WillNess OK, if you think it&#39;s worthwile, I&#39;ll leave it up."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1543674683, "post_id": 53509947, "comment_id": 94007982, "body": "I&#39;m going to post an answer to the question above that this is marked duplicate of. My solution will generate an infinite list of the multiples with one <code>fold</code> and a recurring pattern. It virtually takes numbers from the list of integers which are already sorted."}], "answers": [{"comments": [{"owner": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "edited": false, "score": 0, "creation_date": 1543367279, "post_id": 53510186, "comment_id": 93890933, "body": "My apologies, it seems that I did not clarify the question enough. What I want is an ordered infinite list, and while I could sort a finite list, I feel as if there may be a solution that is more efficient."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "edited": false, "score": 0, "creation_date": 1543397445, "post_id": 53510186, "comment_id": 93901155, "body": "@robbie0630 a methematician&#39;s solution for that would be: make a series of these finite lists for the increasing <code>n</code> (by doubling, or repeated squaring, or something); while skipping the portion that was already found on previous stages; there&#39;s your infinite sequence with a tolerable <i>theoretical complexity</i>, too. :) Of course it&#39;d get quickly stuck, in practice. but also, each thus produced finite sequence is only right up to some point, contains holes in it afterwards, so comparing them pairwise would help there, too. again, a <i>theoretical</i> (non-)solution. :)"}], "tags": [], "owner": {"reputation": 41, "user_id": 9921109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7fbc782c77c92604366273b572ffdbc?s=128&d=identicon&r=PG&f=1", "display_name": "Kacper Korban", "link": "https://stackoverflow.com/users/9921109/kacper-korban"}, "is_accepted": false, "score": 4, "last_activity_date": 1543363898, "creation_date": 1543363898, "answer_id": 53510186, "question_id": 53509947, "link": "https://stackoverflow.com/questions/53509947/how-do-you-find-the-list-of-all-numbers-that-are-multiples-of-only-powers-of-2/53510186#53510186", "title": "How do you find the list of all numbers that are multiples of only powers of 2, 3, and 5?", "body": "<p>The reason why there are only powers of 5 is that Haskell tries to evaluate every possible c for a = 2^0 and b = 3^0 and only when it is finished it goes for a = 2^0 and b = 3^1.\nSo this way you can only construct a finite list like this:<br>\n    <code>[ a * b * c | a &lt;- map (2^) [0..n], b &lt;- map (3^) [0..n], c &lt;- map (5^) [0..n] ]</code><br>\nfor a given n.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1543402363, "post_id": 53511283, "comment_id": 93904205, "body": "you could also be working along the diagonals of the form <code>a*log 2 + b*log 3 = v</code>, :) for gradually increasing <code>v</code>, to be producing the numbers in order. and for planes, <code>a*log 2 + b*log 3 + c*log5 = v</code>. (easier said than done). can you think of an (easy) way to do this? (because I can&#39;t)"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543409266, "post_id": 53511283, "comment_id": 93908187, "body": "Now that would be interesting. Need to give it some thought. I&#39;d be"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543411117, "post_id": 53511283, "comment_id": 93909332, "body": "I&#39;d be interested even in a solution that guarantees just a &quot;good enough&quot;  localised order. In theory we could e.g. sort that stream  based on the fact that the maximum number obtained via <code>diagonal k</code>  is <code>5^k</code>, smaller than <code>2^(3+k)</code>  the minimum obtained via  <code>diagonal (k+3)</code>. Pretty terrible though..."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 2, "last_activity_date": 1543401345, "last_edit_date": 1543401345, "creation_date": 1543372644, "answer_id": 53511283, "question_id": 53509947, "link": "https://stackoverflow.com/questions/53509947/how-do-you-find-the-list-of-all-numbers-that-are-multiples-of-only-powers-of-2/53511283#53511283", "title": "How do you find the list of all numbers that are multiples of only powers of 2, 3, and 5?", "body": "<blockquote>\n  <p>but it only lists powers of 5 and never goes on to 2 or 3.</p>\n</blockquote>\n\n<p>Addressing only this bit.\nTo calculate numbers <code>2^a*3^0b*5^c</code> you tried generating the triples <code>(a,b,c)</code>, but got stuck producing those of the form <code>(0,0,c)</code>. Which is why your numbers are all of the form <code>2^0*3^0*5^c</code>, i.e. only powers of 5.</p>\n\n<p>It's easier if you start with pairs. To produce all pairs <code>(a,b)</code> you can work along the diagonals of the form, </p>\n\n<pre><code>a+b = k\n</code></pre>\n\n<p>for each positive<code>k</code>. Each diagonal is easy to define, </p>\n\n<pre><code>diagonal k = [(k-x,x) | x &lt;- [0..k]]\n</code></pre>\n\n<p>So to produce all pairs you'd just generate all diagonals for <code>k&lt;-[1..]</code>. You want triples <code>(a,b,c)</code> though, but it's similar, just work along the planes, </p>\n\n<pre><code>a+b+c = k\n</code></pre>\n\n<p>To generate such planes just work along their diagonals, </p>\n\n<pre><code>triagonal k = [(k-x,b,c) | x &lt;- [0..k], (b,c) &lt;- diagonal x]\n</code></pre>\n\n<p>And there you go. Now just generate all 'triagonals' to get all possible triples,</p>\n\n<pre><code>triples = [triagonal k | k &lt;- [0..]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543574105, "post_id": 53513093, "comment_id": 93976886, "body": "unfortunately this is exponential in <i>n</i>, in producing the first <i>n</i> numbers in the sequence.  <i>O( expt (n^(1/3)) )</i>, <a href=\"https://en.wikipedia.org/wiki/Regular_number#Number_theory\" rel=\"nofollow noreferrer\">to be exact</a>."}, {"owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543578002, "post_id": 53513093, "comment_id": 93978925, "body": "@WillNess - It may not be time optimized, but it will return the list for small n and in order. In initial solution mentioned in question where even for small n it is going in infinite time and when there are restrictions put the return values are not in order."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543594655, "post_id": 53513093, "comment_id": 93988059, "body": "yes, that&#39;s true. it <i>is</i> correct. :)"}], "tags": [], "owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1543385012, "creation_date": 1543385012, "answer_id": 53513093, "question_id": 53509947, "link": "https://stackoverflow.com/questions/53509947/how-do-you-find-the-list-of-all-numbers-that-are-multiples-of-only-powers-of-2/53513093#53513093", "title": "How do you find the list of all numbers that are multiples of only powers of 2, 3, and 5?", "body": "<p>The other way to look at it is you wanted the numbers which are only divisible by 2,3 or 5. So check if each number starting from 1 satisfies this condition. If yes it is part of the list. </p>\n\n<pre><code>someList = [x| x&lt;- [1..], isIncluded x]\n</code></pre>\n\n<p>where isIncluded is the function which decides whether x satisfies the above condition. To do this isIncluded divides the number first by 2 till it can not be divided any further by 2. Then same it does with new divided number for 3 and 5. It at ends there is 1 then we know this number is only divisible by 2,3 or 5 and nothing else. </p>\n\n<p>This may not be the fastest way but still the simplest way. </p>\n\n<pre><code>isIncluded :: Int -&gt; Bool  \nisIncluded n = if (powRemainder n 2 == 1) then True \n                                          else let q = powRemainder n 2 \n                                           in if (powRemainder q 3 == 1) then True \n                                                                          else let p = powRemainder q 3 \n                                                                               in if (powRemainder p 5 == 1) then True else False;\n</code></pre>\n\n<p>powRemainder is the function which takes number and base and returns the number which can not be further divided by base. </p>\n\n<pre><code>powRemainder :: Int -&gt; Int -&gt; Int\npowRemainder 1 b = 1\npowRemainder n b = if (n `mod` b) == 0 then powRemainder (n `div` b) b else n\n</code></pre>\n\n<p>with this when I run <code>take 20 someList</code> it returns <code>[1,2,3,4,5,6,8,9,10,12,15,16,18,20,24,25,27,30,32,36]</code>.  </p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543397162, "post_id": 53514252, "comment_id": 93900992, "body": "just a side note: the size of that Set is ~ n ^ (2/3), for the n th number in the sequence to be produced. at least I think so. (I think I proved it for myself once...)"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 3, "last_activity_date": 1543390193, "creation_date": 1543390193, "answer_id": 53514252, "question_id": 53509947, "link": "https://stackoverflow.com/questions/53509947/how-do-you-find-the-list-of-all-numbers-that-are-multiples-of-only-powers-of-2/53514252#53514252", "title": "How do you find the list of all numbers that are multiples of only powers of 2, 3, and 5?", "body": "<p>My first idea was starting from lists of powers of 2, 3 and 5, respectively:</p>\n\n<pre><code>p2 = iterate (2 *) 1\np3 = iterate (3 *) 1\np5 = iterate (5 *) 1\n</code></pre>\n\n<p>It's also easy to merge two sorted streams:</p>\n\n<pre><code>fuse [] ys = ys\nfuse xs [] = xs\nfuse xs@(x : xs') ys@(y : ys')\n    | x &lt;= y    = x : fuse xs' ys\n    | otherwise = y : fuse xs ys'\n</code></pre>\n\n<p>But then I got stuck because <code>fuse p2 (fuse p3 p5)</code> doesn't do anything useful. It only produces multiples of 2, or 3, or 5, never mixing factors.</p>\n\n<p>I couldn't figure out a purely generative solution, so I added a bit of filtering in the form of a set accumulator. The algorithm (which is quite imperative) is:</p>\n\n<ol>\n<li>Initialize the accumulator to <code>{1}</code>.</li>\n<li>Find and remove the smallest element from the accumulator; call it <code>n</code>.</li>\n<li>Emit <code>n</code>.</li>\n<li>Add <code>{2n, 3n, 5n}</code> to the accumulator.</li>\n<li>Go to #2 if you need more elements.</li>\n</ol>\n\n<p>The accumulator is a set because this easily lets me find and extract the smallest element (I'm using it as a priority queue, basically). It also handles duplicates that arise from e.g. computing both <code>2 * 3</code> and <code>3 * 2</code>.</p>\n\n<p>Haskell implementation:</p>\n\n<pre><code>import qualified Data.Set as S\n\nnumbers :: [Integer]\nnumbers = go (S.singleton 1)\n    where\n    go acc = case S.deleteFindMin acc of\n        (n, ns) -&gt; n : go (ns `S.union` S.fromDistinctAscList (map (n *) [2, 3, 5]))\n</code></pre>\n\n<p>This works, but there are things I don't like about it:</p>\n\n<ul>\n<li>For every element we emit (<code>n : ...</code>), we add up to three new elements to the accumulator (<code>ns `S.union` ... [2, 3, 5]</code>). (\"Up to three\" because some of them may be duplicates that will be filtered out.)</li>\n<li>That means <code>numbers</code> carries around a steadily growing data structure; the more elements we consume from <code>numbers</code>, the bigger the accumulator grows.</li>\n<li>In that sense it's not a pure \"streaming\" algorithm. Even if we ignore the steadily growing numbers themselves, we need more memory and perform more computation the deeper we get into the sequence.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543413407, "post_id": 53514285, "comment_id": 93910831, "body": "sorry for the mix-up; don&#39;t know how I could&#39;ve missed those definitions before. should&#39;ve read the answer closer..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1543444373, "post_id": 53514285, "comment_id": 93926950, "body": "thanks for the answer; I don&#39;t think I saw this way of doing this before; interesting. :) I followed your idea and ended up with <code>foldr merge&#39; [] . iterate (map (5*)) . foldr merge&#39; [] . iterate (map (3*)) . iterate (*2) $ 1</code> with <code>merge&#39; (m:ms) = (m :) . merge ms</code>"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1544047603, "post_id": 53514285, "comment_id": 94142437, "body": "All multiples of 2,3 &amp; 5 using recursive addition without merging or sorting <code>scanl (\\b a -&gt; a+b) 2 $ cycle  [1,1,1,1,2,1,1,2,2,1,1,2,2,1,1,2,1,1,1,1,2,2]</code>"}], "tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": false, "score": 2, "last_activity_date": 1543400327, "last_edit_date": 1543400327, "creation_date": 1543390333, "answer_id": 53514285, "question_id": 53509947, "link": "https://stackoverflow.com/questions/53509947/how-do-you-find-the-list-of-all-numbers-that-are-multiples-of-only-powers-of-2/53514285#53514285", "title": "How do you find the list of all numbers that are multiples of only powers of 2, 3, and 5?", "body": "<p>From your code:</p>\n\n<pre><code>[ a * b * c | a &lt;- map (2^) [0..], b &lt;- map (3^) [0..], c &lt;- map (5^) [0..] ] \n</code></pre>\n\n<p>Since <code>map (5^) [0..]</code> is an infinite list, upon first iterations of <code>a</code> and <code>b</code>, it iterates over the said infinite list, which won't halt. That's why it is stuck at powers of 5.</p>\n\n<p>Here is a solution apart from arithmetics. Note that <code>map (2^) [0..]</code>, <code>map (3^) [0..]</code>, and <code>map (5^) [0..]</code> are all lists sorted in ascending order. That means the usual merge operation is applicable:</p>\n\n<pre><code>merge []     ys     = ys\nmerge xs     []     = xs\nmerge (x:xs) (y:ys) = if x &lt;= y then x : merge xs (y:ys) else y : merge (x:xs) ys\n</code></pre>\n\n<p>For convenience, <code>let xs = map (2^) [0..]; let ys = map (3^) [0..]; let zs = map (5^) [0..]</code>.</p>\n\n<p>To get multiples of 2 and 3, consider the following organization of said numbers:</p>\n\n<pre><code>1, 2, 4, 8, 16, ...\n3, 6, 12, 24, 48, ...\n9, 18, 36, 72, 144, ...\n...\n</code></pre>\n\n<p>Judging by this, you might hope the following works:</p>\n\n<pre><code>let xys = foldr (merge . flip fmap xs . (*)) [] ys\n</code></pre>\n\n<p>But this doesn't work, because from the organization above, <code>merge</code> doesn't know which row contains the resulting head element, infinitely leaving it unevaluated. We know that the upper row contains said head element, so with following little tweak, it finally works:</p>\n\n<pre><code>let xys = foldr ((\\(m:ms) ns -&gt; m : merge ms ns) . flip fmap xs . (*)) [] ys\n</code></pre>\n\n<p>Do the same against <code>zs</code>, and here comes the desired list:</p>\n\n<pre><code>let xyzs = foldr ((\\(m:ms) ns -&gt; m : merge ms ns) . flip fmap xys . (*)) [] zs\n</code></pre>\n\n<p>Full code in summary:</p>\n\n<pre><code>merge []     ys     = ys\nmerge xs     []     = xs\nmerge (x:xs) (y:ys) = if x &lt;= y then x : merge xs (y:ys) else y : merge (x:xs) ys\n\nxyzs = let\n    xs = map (2^) [0..]\n    ys = map (3^) [0..]\n    zs = map (5^) [0..]\n    xys = foldr ((\\(m:ms) ns -&gt; m : merge ms ns) . flip fmap xs . (*)) [] ys\n    in foldr ((\\(m:ms) ns -&gt; m : merge ms ns) . flip fmap xys . (*)) [] zs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1543399924, "creation_date": 1543399924, "answer_id": 53516949, "question_id": 53509947, "link": "https://stackoverflow.com/questions/53509947/how-do-you-find-the-list-of-all-numbers-that-are-multiples-of-only-powers-of-2/53516949#53516949", "title": "How do you find the list of all numbers that are multiples of only powers of 2, 3, and 5?", "body": "<p>As others already commented, your core does not work because it is analogous to the following imperative pseudocode:</p>\n\n<pre><code>for x in 0..infinity:\n   for y in 0..infinity:\n      for z in 0..infinity:\n         print (2^x * 3^y * 5^x)\n</code></pre>\n\n<p>The innermost <code>for</code> takes infinite time to execute, so the other two loops will never get past their first iteration. Consequently, <code>x</code> and <code>y</code> are both stuck to value <code>0</code>.</p>\n\n<p>This is a classic <a href=\"https://en.wikipedia.org/wiki/Dovetailing_(computer_science)\" rel=\"nofollow noreferrer\">dovetailing</a> problem: if we insist on trying all the values of <code>z</code> before taking the next <code>y</code> (or <code>x</code>), we get stuck on a subset of the intended outputs. We need a more \"fair\" way to choose the values of <code>x,y,z</code> so that we do not get stuck in such way: such techniques are known as \"dovetailing\".</p>\n\n<p>Others have shown some dovetailing techniques. Here, I'll only mention the <a href=\"http://hackage.haskell.org/package/control-monad-omega\" rel=\"nofollow noreferrer\"><code>control-monad-omega</code></a> package, which implements an easy to use dovetailing monad. The resulting code is very similar to the one posted in the OP.</p>\n\n<pre><code>import Control.Monad.Omega\n\npowersOf235 :: [Integer]\npowersOf235 = runOmega $ do\n   x &lt;- each [0..]\n   y &lt;- each [0..]\n   z &lt;- each [0..]\n   return $ 2^x * 3^y * 5^z\n</code></pre>\n"}], "owner": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1202, "favorite_count": 0, "closed_date": 1543425409, "answer_count": 6, "score": 4, "last_activity_date": 1545201668, "creation_date": 1543362125, "last_edit_date": 1543393725, "question_id": 53509947, "link": "https://stackoverflow.com/questions/53509947/how-do-you-find-the-list-of-all-numbers-that-are-multiples-of-only-powers-of-2", "closed_reason": "Duplicate", "title": "How do you find the list of all numbers that are multiples of only powers of 2, 3, and 5?", "body": "<p>I am trying to generate a list of all multiples which can be represented by the form <img src=\"https://chart.googleapis.com/chart?cht=tx&amp;chl=2%5Ea*3%5Eb*5%5Ec\" alt=\"2^a*3^b*5^c\">, where a, b, and c are whole numbers. I tried the following,</p>\n\n<pre><code>[ a * b * c | a &lt;- map (2^) [0..], b &lt;- map (3^) [0..], c &lt;- map (5^) [0..] ] \n</code></pre>\n\n<p>but it only lists powers of 5 and never goes on to 2 or 3.</p>\n\n<p>Edit: My apologies, it seems that I did not clarify the question enough. What I want is an ordered infinite list, and while I could sort a finite list, I feel as if there may be a solution that is more efficient.</p>\n"}, {"tags": ["haskell", "deriving", "coerce"], "answers": [{"comments": [{"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "edited": false, "score": 1, "creation_date": 1543359708, "post_id": 53508998, "comment_id": 93888992, "body": "I&#39;m a moron. Thankyou."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1543356665, "creation_date": 1543356665, "answer_id": 53508998, "question_id": 53508755, "link": "https://stackoverflow.com/questions/53508755/using-deriving-via-with-phantom-types/53508998#53508998", "title": "Using Deriving Via with Phantom Types", "body": "<p><code>DerivingVia</code> works through newtypes, but you wrote</p>\n\n<pre><code>data Via a b = Via a   -- should be newtype\n</code></pre>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 53508998, "answer_count": 1, "score": 1, "last_activity_date": 1543356665, "creation_date": 1543355554, "question_id": 53508755, "link": "https://stackoverflow.com/questions/53508755/using-deriving-via-with-phantom-types", "title": "Using Deriving Via with Phantom Types", "body": "<p>Apologies for the long repro but I haven't been able to make it any shorter. The following code compiles fine until the last line:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, UndecidableInstances #-}\n{-# LANGUAGE DerivingVia, DerivingStrategies, StandaloneDeriving #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Repro where\n\nimport Prelude hiding ((+))\n\nclass (Additive a) where\n    (+) :: a -&gt; a -&gt; a\n\ndata Vector2D u = Vector2D { \n    x :: u, \n    y :: u \n}\n\naddVector2 :: (Additive a) =&gt; Vector2D a -&gt; Vector2D a -&gt; Vector2D a \naddVector2 Vector2D { x = x1, y = y1 } (Vector2D { x = x2, y = y2 }) = \n    Vector2D { x = x1 + x2, y = y1 + y2 }\n\ninstance (Additive a) =&gt; Additive (Vector2D a) where\n    (+) = addVector2\n\nnewtype Phantom1 d a = Phantom1 (Vector2D a) --Axial \n\nderiving via (Vector2D a) instance forall d . (Additive a) =&gt; (Additive (Phantom1 d a))\n\ndata Via a b = Via a\n\nclass IsoEvidence a b where\n    convertTo :: a -&gt; b\n    convertFrom :: b -&gt; a\n\ninstance forall a b . (IsoEvidence a b, Additive b) =&gt; (Additive (Via a b)) where\n    (Via x) + (Via y) = Via $ convertFrom $ (convertTo x :: b) + (convertTo y :: b)  \n\nnewtype Phantom2 d a = Phantom2 (Vector2D a) --Offset \n\ninstance (IsoEvidence (Phantom1 d a) (Phantom2 d a)) where\n    convertTo (Phantom1 x) = Phantom2 x\n    convertFrom (Phantom2 x) = Phantom1 x\n\nderiving via (Via (Phantom2 d a) (Phantom1 d a)) \n    instance (Additive a, IsoEvidence (Phantom1 d a) (Phantom2 d a)) =&gt; \n        (Additive (Phantom2 d a))\n</code></pre>\n\n<p>After that I get the following error:</p>\n\n<ul>\n<li>Couldn't match representation of type <code>Vector2D a</code>\n          with that of <code>Via (Phantom2 d a) (Phantom1 d a)</code></li>\n</ul>\n\n<p>Which seems to be saying it can't coerce \"Via &amp;c\" to \"Vector2D a\", which is odd because it's literally a newtype two levels deep and that works fine.</p>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["json", "parsing", "haskell", "bytestring"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543345332, "post_id": 53506414, "comment_id": 93882574, "body": "The data you read from the file hasn&#39;t been decoded yet; do that before attempting to parse it. That &quot;noise&quot; is just how the Unicode text is rendered, not something that actually exists in the data."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543345489, "post_id": 53506414, "comment_id": 93882663, "body": "Can I also encode it afterwards?"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543345559, "post_id": 53506414, "comment_id": 93882702, "body": "@Chepner: your comment qualified as an answer to me by the way, but I don&#39;t think I can mark comments as answer"}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1543385462, "post_id": 53508157, "comment_id": 93895391, "body": "Thanks for that. So it is not the most charming way to parse JSON I came up with, still ending up with Data.Text as Daniel Wagner posted in another question."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 0, "last_activity_date": 1543352899, "creation_date": 1543352899, "answer_id": 53508157, "question_id": 53506414, "link": "https://stackoverflow.com/questions/53506414/haskell-building-simple-json-parser/53508157#53508157", "title": "Haskell building simple JSON parser", "body": "<p>JSON is, by definition, a Unicode string that represents a data structure. What you get from <code>B.readFile</code>, though, is a raw byte string that you must first decode to get a Unicode string. To do that, you need to know what encoding was used to create the file. Assuming the file uses UTF-8 encoding, you can do something like</p>\n\n<pre><code>import Data.Text\n\nimportJson :: String -&gt; IO Text\nimportJson name = do\n    jsonData &lt;- B.readFile name\n    return (Data.Text.Encoding.decodeUtf8 jsonData)\n</code></pre>\n\n<p>Once you have a <code>Text</code> value, you can parse that into some data structure according to the JSON grammar.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 53508157, "answer_count": 1, "score": 0, "last_activity_date": 1543352899, "creation_date": 1543345105, "last_edit_date": 1543345175, "question_id": 53506414, "link": "https://stackoverflow.com/questions/53506414/haskell-building-simple-json-parser", "title": "Haskell building simple JSON parser", "body": "<p>Getting my feet wet with building stuff, and not being able to get Aeson to work properly I decided my new project is building a JSON parser. Very abstract since it is one way or another, so it wouldn't make sense to put all the code here. \nThe ByteString library lets me do what I need. Remove characters, replace stuff, but: I have a very hard time reconstructing it the exact way I took it apart. Data.Text however seems more appropriate for the job but when generated a lot of noise with /\"/, \\n etc.\nWhat would be the best and fastest way to clear a file from all rubbish and restore the remaining parts to useful text? Very small part below. Remarks on the code are welcome. Learning here. </p>\n\n<pre><code>import Network.HTTP.Simple\nimport GHC.Generics\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Char8 as C\nimport Data.Text as T\nimport Data.Char\nimport Data.Text.Encoding as DTE\n\nword8QuoteMark = fromIntegral (ord '\"')\nword8Newline = fromIntegral (ord '\\n')\nword8Backslash = fromIntegral (ord ':')\n\nfilterJson jsonData = B.filter (/= word8Backslash)\n                        (B.filter (/= word8Newline)\n                           (B.filter (/= word8QuoteMark) jsonData))\n\nimportJson :: IO ()\nimportJson = do\n        jsonData &lt;- B.readFile \"local.json\"\n        output &lt;- return (filterJson jsonData)\n        print $ (output)\n</code></pre>\n\n<p>Now the downside is, that if someone is called eg. Fran\u00e7ois, it is now returned as <code>Fran\\195\\167ois</code>. I think I would need a lot more steps to do this in <code>Data.Text</code>, but correct me if I am wrong...</p>\n\n<p>Note: i saw in a post that Daniel Wagner strongly advises against <code>ByteString</code> for text, but just for the sake of argument.</p>\n"}, {"tags": ["haskell", "metaprogramming", "typeclass", "deriving"], "answers": [{"comments": [{"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1543325331, "post_id": 53499091, "comment_id": 93870699, "body": "But the docs say that <code>Generic1</code> is for &quot;Representable types of kind <code>* -&gt; *</code> (or kind <code>k -&gt; *</code>, when <code>PolyKinds</code> is enabled)&quot;, and I did enable <code>PolyKinds</code>!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 3, "creation_date": 1543326177, "post_id": 53499091, "comment_id": 93871266, "body": "There are indeed some higher kinded types for which GHC can currently derive <code>Generic1</code> instances, but the feature is so limited it&#39;s hardly worth mentioning. This is mostly an artifact of taking the original implementation of <code>Generic1</code> intended for <code>* -&gt; *</code> (which already has serious limitations), turning on <code>PolyKinds</code>, and keeping whatever sticks, which is not much."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1543331981, "post_id": 53499091, "comment_id": 93874857, "body": "So IIUC the &quot;In principle there could be support for <code>(* -&gt; *) -&gt; *</code> with more constructors in <code>GHC.Generics</code>&quot; part isn&#39;t precise, as the constructor is the right one, it&#39;s just that the deriving mechanism doesn&#39;t support this kind, right?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1543332916, "post_id": 53499091, "comment_id": 93875399, "body": "By &quot;constructor&quot; I meant type constructors like <code>M1</code>, <code>(:*:)</code>, etc. There are missing pieces to be able to define an instance for <code>Rep1 Foo</code> even by hand."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1543325251, "last_edit_date": 1543325251, "creation_date": 1543319602, "answer_id": 53499091, "question_id": 53498707, "link": "https://stackoverflow.com/questions/53498707/cant-derive-generic-for-this-type/53499091#53499091", "title": "Can&#39;t derive Generic for this type?", "body": "<p><code>Generic1 Foo</code> can't be derived because <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Generics.html#t:Generic1\" rel=\"nofollow noreferrer\"><code>Generic1</code></a> is meant for types of kind <code>* -&gt; *</code>, not <code>(* -&gt; *) -&gt; *</code>. In principle there could be support for <code>(* -&gt; *) -&gt; *</code> with more constructors in <code>GHC.Generics</code>, but this approach just doesn't scale well (it comes with lots more unintuitive syntactic restrictions, and you will always have the same problem for more complex types).</p>\n\n<p>You can actually do a lot with plain <code>Generic</code> that overlaps with the initially intended use cases for <code>Generic1</code>. Otherwise, you'll need something more powerful than <code>GHC.Generics</code> like, perhaps, the recently released <a href=\"https://www.reddit.com/r/haskell/comments/9smtbs/generics_for_gadts_and_arbitrary_kinds/\" rel=\"nofollow noreferrer\">kind-generics</a> (includes links to paper and hackage).</p>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 2, "accepted_answer_id": 53499091, "answer_count": 1, "score": 4, "last_activity_date": 1543325251, "creation_date": 1543318283, "question_id": 53498707, "link": "https://stackoverflow.com/questions/53498707/cant-derive-generic-for-this-type", "title": "Can&#39;t derive Generic for this type?", "body": "<p>Compiling this short snippet on GHC 8.6.2:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, PolyKinds #-}\nimport GHC.Generics\n\ndata Foo f\n    = FA\n    | FB (f (Foo f))\n    deriving (Generic, Generic1)\n</code></pre>\n\n<p>Results in this error:</p>\n\n<pre><code>Can't make a derived instance of \u2018Generic1 Foo\u2019:\n  Constructor \u2018FB\u2019 applies a type to an argument involving the last parameter\n                   but the applied type is not of kind * -&gt; *\n</code></pre>\n\n<p>Is it not possible to derive <code>Generic</code> for such types? Why?</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 733, "user_id": 5305365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/aa60100cfd7f5408297163b84362458d?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Bhat", "link": "https://stackoverflow.com/users/5305365/siddharth-bhat"}, "edited": false, "score": 0, "creation_date": 1543319705, "post_id": 53498698, "comment_id": 93867338, "body": "Thanks! What would a proof that <code>reify2</code> is isomorphic to the original look like? I&#39;m not 100% convinced that they implement the same function."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 733, "user_id": 5305365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/aa60100cfd7f5408297163b84362458d?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Bhat", "link": "https://stackoverflow.com/users/5305365/siddharth-bhat"}, "edited": false, "score": 1, "creation_date": 1543320594, "post_id": 53498698, "comment_id": 93867847, "body": "It&#39;s kind of difficult to do in Haskell because there&#39;s so much ambiguity to resolve, and I&#39;m not sure how to implement the original signature. But for example in Coq where <code>=&gt;</code> is <code>-&gt;</code> plus some bells and whistles, and <code>-&gt;</code> in turn is just sugar for <code>forall</code>, one can be obtained from the other literally by reordering arguments. <code>fun c c&#39; a myreify2 cons f r3 Hc&#39;r3 =&gt; myreify2 r3 c c&#39; a Hc&#39;r3 cons f</code>."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1543318253, "creation_date": 1543318253, "answer_id": 53498698, "question_id": 53498010, "link": "https://stackoverflow.com/questions/53498010/rank-2-constraint-programming-constraint-implication/53498698#53498698", "title": "Rank 2 constraint programming / constraint implication", "body": "<p>The ambiguity can be lifted using <code>ScopedTypeVariables+TypeApplications</code>, although you need to reorder the arguments of <code>reify2</code>, putting the type arguments first to put them in scope.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, RankNTypes, ConstraintKinds, GADTs, ScopedTypeVariables, TypeApplications, TypeOperators #-}\n\ndata Dict c where\n  Dict :: c =&gt; Dict c\n\ndata c :- d where\n  Sub :: (c =&gt; Dict d) -&gt; c :- d\n\nreify2 :: forall r3 c c' a. c' r3 =&gt;\n          (forall r1. c' r1 :- c r1) -&gt;\n          (forall r2. c r2 =&gt; a) -&gt;\n          a\nreify2 cons f =\n  case cons @r3 of\n    Sub Dict -&gt; f @r3\n</code></pre>\n"}], "owner": {"reputation": 733, "user_id": 5305365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/aa60100cfd7f5408297163b84362458d?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Bhat", "link": "https://stackoverflow.com/users/5305365/siddharth-bhat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 53498698, "answer_count": 1, "score": 1, "last_activity_date": 1543318253, "creation_date": 1543315878, "question_id": 53498010, "link": "https://stackoverflow.com/questions/53498010/rank-2-constraint-programming-constraint-implication", "title": "Rank 2 constraint programming / constraint implication", "body": "<pre><code>import Data.Constraint\n\nreify :: (c' :- c) -&gt; (c =&gt; a) -&gt; (c' =&gt; a)\nreify cons f = case cons of Sub d -&gt; case d of Dict -&gt; f\n</code></pre>\n\n<p>Using <code>reify</code>, I can weaken a constraint <code>c</code> to a constraint <code>c'</code> given proof that <code>c'</code> implies <code>c</code>.</p>\n\n<p>Now, I want a <code>Rank2</code> variant of this:</p>\n\n<pre><code>-- reify2 Rank2's reify\nreify2 :: (forall r1. c' r1 :- c r1) -&gt; \n          (forall r2. c r2 =&gt; a) -&gt; \n          (forall r3. c' r3 =&gt; a)\nreify2 cons f = ???\n</code></pre>\n\n<p>But I'm unable to implement such a function, even though it must \"clearly\" be possible.</p>\n"}, {"tags": ["haskell", "hash", "hashmap", "hashable", "unordered-containers"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 2, "creation_date": 1543310078, "post_id": 53495133, "comment_id": 93861826, "body": "I feel like this is a better fit for the computer science stack exchange."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1543311372, "post_id": 53495133, "comment_id": 93862533, "body": "An issue I can see with this is that &quot;normal&quot; hashmaps store all data in a single linear array that might fit in cache, whereas this approach stores it in multiple. This means that going from one level to the next will usually require a main-memory access, which might make it slower than the usual implementations."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1543317923, "post_id": 53495133, "comment_id": 93866325, "body": "The strategy reminds me of <a href=\"https://en.wikipedia.org/wiki/Cuckoo_hashing\" rel=\"nofollow noreferrer\">cuckoo hashing</a>; it&#39;s not identical, but it might be worth checking out the literature on cuckoo hashing to see if there&#39;s a variant like this out there."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543325146, "post_id": 53495133, "comment_id": 93870579, "body": "I&#39;ll note that the space you allocate for the extra hash tables could be used to make the top-level hash table sparser, reducing the chances of collisions in the first hash in the first place."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543328693, "post_id": 53495133, "comment_id": 93872780, "body": "@chepner not really; keep in mind that hash collisions are subject to the birthday paradox."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1543329000, "post_id": 53495133, "comment_id": 93872980, "body": "@hnefatl right, though this might not matter for many applications. Since accessing elements in a hash map is generally unordered, you usually get plenty of cache misses even if the structure is a flat array."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543454562, "post_id": 53495133, "comment_id": 93929444, "body": "It&#39;s perfectly fine ... as long as you have sufficiently secure random functions. Otherwise, there are no guarantees, as Johan explained to us. And with sufficiently secure random functions, we probably don&#39;t <i>need</i> a multilevel collision scheme to get reasonably good performance."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1543330276, "creation_date": 1543330276, "answer_id": 53502284, "question_id": 53495133, "link": "https://stackoverflow.com/questions/53495133/is-this-approach-to-dealing-with-hash-collisions-new-unique/53502284#53502284", "title": "Is this approach to dealing with hash collisions new/unique?", "body": "<p>Your idea seems to be effectively the same as the one suggested in <a href=\"https://doi.org/10.1145/828.1884\" rel=\"nofollow noreferrer\">the Fredman, Koml\u00f3s &amp; Szemer\u00e9di paper from 1984</a>. As <a href=\"https://en.wikipedia.org/w/index.php?title=Static_hashing&amp;oldid=859057778#FKS_Hashing\" rel=\"nofollow noreferrer\">Wikipedia summarizes it</a>:</p>\n\n<blockquote>\n  <p>FKS Hashing makes use of a hash table with two levels in which the top level contains n buckets which each contain their own hash table.</p>\n</blockquote>\n\n<p>In contrast to your idea, the local hash maps aren't recursive, instead each of them chooses a salt that makes it a perfect hash. In practice, this will (as you say) usually be given already by the first salt you try, thus it's asymptotically constant-time.</p>\n"}], "owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 53502284, "answer_count": 1, "score": 5, "last_activity_date": 1543330276, "creation_date": 1543305689, "question_id": 53495133, "link": "https://stackoverflow.com/questions/53495133/is-this-approach-to-dealing-with-hash-collisions-new-unique", "title": "Is this approach to dealing with hash collisions new/unique?", "body": "<p>When dealing with hash maps, I have seen a few strategies to deal with hash collisions, but we have come up with something different.\nI was wondering if this is something new or not.</p>\n\n<p>This version of a hash map only works if the hash and the data structures that will be hashed are salteable.\n(This is the case in <a href=\"https://hackage.haskell.org/package/hashable\" rel=\"noreferrer\"><code>hashable</code></a> in Haskell, where we suggested implementing this approach.)</p>\n\n<p>The idea is that, instead of storing a list or array in each cell of the hash map, you store a recursive hash map. The only difference in this recursive hash map is that you use a different salt. \nThis way the hash collisions on one level of the hash map are most likely not hash collisions on the next level.\nAs a result, insertion into such a hash map is no longer O(number of collisions on this hash) but O(number of levels that the collisions on this happen at recursively), which is most likely better.</p>\n\n<p>A more detailed explanation and an implementation can be found here:</p>\n\n<p><a href=\"https://github.com/tibbe/unordered-containers/pull/217/files/58af4519ace34c5f7d3c1359907ff75e27b9cdb8#diff-ba23e0f18c79cb873ac5375367524cfaR114\" rel=\"noreferrer\">https://github.com/tibbe/unordered-containers/pull/217/files/58af4519ace34c5f7d3c1359907ff75e27b9cdb8#diff-ba23e0f18c79cb873ac5375367524cfaR114</a></p>\n"}, {"tags": ["haskell", "category-theory", "recursion-schemes", "fixpoint-combinators", "catamorphism"], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "edited": false, "score": 0, "creation_date": 1543349670, "post_id": 53495503, "comment_id": 93884666, "body": "Could you elaborate why Fix (ListF e) = ListF e (Fix (ListF e))                = NilF | ConsF e (Fix (ListF e))? According to the definition newtype Fix f = Fix (f (Fix f)), shouldn&#39;t data constructor Fix be applied to ((ListF e) Fix (ListF e))?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "edited": false, "score": 0, "creation_date": 1543354342, "post_id": 53495503, "comment_id": 93886816, "body": "I&#39;m using <code>X</code> as the <i>data</i> constructor, to avoid the confusion. <code>Fix</code> is the <i>type</i> constructor. So, type <code>Fix (ListF e)</code> fits the definition <code>newtype Fix f = X (f (Fix f))</code> with the type parameter <code>f</code> becoming <code>(ListF e)</code>. So by substitution we get that the type <code>f (Fix f)</code> is <code>ListF e (Fix (ListF e))</code>. And <code>ListF</code> has two data constructors cases. That&#39;s what I meant by those two informal &quot;equations&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "edited": false, "score": 0, "creation_date": 1543356409, "post_id": 53495503, "comment_id": 93887693, "body": "or possibly you have some confusion about the parentheses?  <code>((f a) (b))</code> is just <code>f a b</code>. Similarly, <code>(f (Fix f))</code> with <code>f = (ListF e)</code> becomes  <code>((ListF e) (Fix (ListF e)))</code> and then, dropping superfluous parentheses, it is just <code>ListF e (Fix (ListF e))</code>."}, {"owner": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "edited": false, "score": 0, "creation_date": 1543376051, "post_id": 53495503, "comment_id": 93892826, "body": "I think I got it by reading your above comment <i>those two informal &quot;equations&quot;</i>. I just took the very first line of code literally and didn&#39;t feel Haskell compiler would compile. Now I see they are indicative pseudo code, rather than real code. Thanks!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "edited": false, "score": 0, "creation_date": 1543394037, "post_id": 53495503, "comment_id": 93899195, "body": "the main block is all real code. and the derivation that you asked for uses it and follows its definitions specifically, step by step."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "edited": false, "score": 0, "creation_date": 1543394514, "post_id": 53495503, "comment_id": 93899461, "body": "&quot;[the accepted answer shows that] in order for Haskell compiler to figure out Functor A is a fixed point of Functor B, we need to be explicit&quot; no, that answer tells you the opposite: compiler doesn&#39;t know anything. the &quot;explicit&quot; bit just means we must provide the missing Functor instance ourselves explicitly. A <i>mathematician</i> looking at those definitions concludes the type <code>Fix f</code> is a <i>type-level fixed-point</i> of the type <code>f</code>. A <i>Haskell implementation</i> just follows the definitions, as I showed in my answer. For it the type <code>Fix (ListF e)</code>, or <code>ListF e (Fix (ListF e))</code>, is just another type."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "edited": false, "score": 0, "creation_date": 1543394789, "post_id": 53495503, "comment_id": 93899607, "body": "and &quot;<code>Fix</code>&quot; is just another type name. It could be named just &quot;<code>T</code>&quot; for all it cares. :) Same with the data constructors, that&#39;s why I used &quot;<code>X</code>&quot; there."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1543333103, "last_edit_date": 1543333103, "creation_date": 1543307383, "answer_id": 53495503, "question_id": 53492756, "link": "https://stackoverflow.com/questions/53492756/how-does-compiler-figure-out-fixed-point-of-a-functor-and-how-cata-work-at-leaf/53495503#53495503", "title": "How does compiler figure out fixed point of a functor and how cata work at leaf level?", "body": "<p>No, <code>unFix</code> exposes the structure, and then <code>fmap f</code> applies a function <code>f</code> on it. If it's a Leaf, <code>fmap f</code> will do its thing that it is defined to do for leaves - i.e., nothing. It's <code>fmap</code> that \"knows\" i.e. is defined to handle each case, as usual in Haskell's case-based  definitions. </p>\n\n<pre><code>Fix (ListF e) = ListF e (Fix (ListF e)) \n              = NilF | ConsF e (Fix (ListF e))\n</code></pre>\n\n<p>so renaming <code>Fix (ListF e)</code> to <code>Listof e</code> we get </p>\n\n<pre><code>Listof     e  = NilF | ConsF e (Listof e) \n</code></pre>\n\n<p><code>Listof e</code> is a recursive type. <strong><code>ListF e r</code> is a non-recursive type.</strong> <code>Fix</code> makes a recursive type out of it. <code>ListF e</code> being a Functor means <code>fmap</code> works on the <code>r</code> \"meat\", <code>ListF e</code> being the \"hard outer shell\" of this \"fruit\".</p>\n\n<pre><code>data ListF e a = NilF | ConsF e a\n\nnewtype Fix f = X { unFix    :: (f       (Fix f)) }\n\n-- unFix ::    Fix f          -&gt; f       (Fix f        )\n-- unFix (_ :: Fix (ListF e)) :: ListF e (Fix (ListF e))\n\nlenAlg :: ListF e Int -&gt; Int\nlenAlg (ConsF e n) = n + 1\nlenAlg NilF        = 0\n\ninstance Functor (ListF e) where\n    -- fmap :: (a -&gt; b) -&gt; (ListF e a) -&gt; (ListF e b)\n    fmap f NilF        = NilF\n    fmap f (ConsF e r) = ConsF e (f r)\n\ncata :: (ListF e Int -&gt; Int) -&gt; Fix (ListF e) -&gt; Int\ncata lenAlg x = (lenAlg . fmap (cata lenAlg) . unFix) x\n              =  lenAlg ( fmap (cata lenAlg) ( unFix  x ))\n--------\n        x       ::       Fix (ListF e)\n        unFix x ::            ListF e (Fix (ListF e))\n        fmap (cata lenAlg) :: ListF e (Fix (ListF e)) -&gt; ListF e (Int)\n              cata lenAlg  ::          Fix (ListF e)  -&gt;          Int\n\n        fmap (cata lenAlg)   (unFix  x              ) :: ListF e  Int \n lenAlg (_                                            :: ListF e  Int ) :: Int\n</code></pre>\n\n<p>See? All the wires go to their proper places. <code>fmap</code> transforms the inner part <code>r</code> recursively, and then <code>lenAlg</code> <em>algebra</em> applies <em>one</em> last transformation, <strong><em>one</em></strong> last <em>step</em> in collapsing the structure where all its inner parts were already collapsed into a <i>r</i>ecursive <i>r</i>esult. Thus producing the final <i>r</i>esult.</p>\n\n<hr>\n\n<p>As a concrete example, for a list of two numbers, <em>1</em> and <em>2</em>, we have</p>\n\n<pre><code>-- newtype Fix f  = X { unFix :: (f      (Fix f         )) }\n--             _\\_______       ____\\____      _\\________\nonetwo :: Fix (ListF Int) -- ~ ListF Int (Fix (ListF Int))\nonetwo = X (ConsF 1\n                  (X (ConsF 2\n                            (X NilF))))\n</code></pre>\n\n\n\n<pre><code>cata lenAlg :: Fix (ListF e) -&gt; Int\ncata lenAlg    onetwo\n  = {- definition of cata   -}\n    lenAlg . fmap (cata lenAlg) . unFix  $ onetwo\n  = {- definition of onetwo -}\n    lenAlg . fmap (cata lenAlg) . unFix  $ \n                           X (ConsF 1 (X (ConsF 2 (X NilF))))\n  = {- definition of unFix  -}\n    lenAlg . fmap (cata lenAlg) $ \n                              ConsF 1 (X (ConsF 2 (X NilF)))\n  = {- definition of fmap   -}\n    lenAlg $ ConsF 1 (cata lenAlg     (X (ConsF 2 (X NilF))))\n  = {- definition of lenAlg -}\n    (+ 1)  $          cata lenAlg     (X (ConsF 2 (X NilF)))\n  = {- definition of cata   -}\n    (+ 1)  $ lenAlg . fmap (cata lenAlg) . unFix $ \n                                       X (ConsF 2 (X NilF))\n  = {- definition of unFix  -}\n    (+ 1) $ lenAlg . fmap (cata lenAlg) $ ConsF 2 (X NilF)\n  = {- definition of fmap   -}\n    (+ 1) $ lenAlg $ ConsF 2 $ cata lenAlg        (X NilF)\n  = {- definition of lenAlg -}\n    (+ 1) $ (+ 1)  $           cata lenAlg        (X NilF)\n  = {- definition of cata   -}\n    (+ 1) $ (+ 1)  $ lenAlg . fmap (cata lenAlg) . unFix $ \n                                                  (X NilF)\n  = {- definition of unFix  -}\n    (+ 1) $ (+ 1)  $ lenAlg . fmap (cata lenAlg) $   NilF\n  = {- definition of fmap   -}\n    (+ 1) $ (+ 1)  $ lenAlg $                        NilF\n  = {- definition of lenAlg -}\n    (+ 1) $ (+ 1)  $ 0\n  = (+ 1) $ 1\n  = 2\n</code></pre>\n\n<p>Also,</p>\n\n<pre><code>squaringAlg :: ListF Int [Int] -&gt; [Int]\nsquaringAlg (ConsF e r) = e*e : r\nsquaringAlg NilF        = []\n\nfilteringAlg :: (e -&gt; Bool) -&gt; ListF e [e] -&gt; [e]\nfilteringAlg p (ConsF e r) | p e       = e : r\n                           | otherwise = r\nfilteringAlg _ NilF                    = []\n</code></pre>\n\n<p>etc.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 5, "last_activity_date": 1543307803, "last_edit_date": 1543307803, "creation_date": 1543307400, "answer_id": 53495510, "question_id": 53492756, "link": "https://stackoverflow.com/questions/53492756/how-does-compiler-figure-out-fixed-point-of-a-functor-and-how-cata-work-at-leaf/53495510#53495510", "title": "How does compiler figure out fixed point of a functor and how cata work at leaf level?", "body": "<p>The only way the compiler can know about the relationship between <code>ListF e</code> and <code>[e]</code> is if you tell it.  You haven't provided enough context to answer exactly how, but I can infer that <code>unFix</code> has type</p>\n\n<pre><code>unFix :: [e] -&gt; ListF e [e]\n</code></pre>\n\n<p>that is, it unrolls the top layer.  <code>unFix</code> may be more general, for example in <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.3/docs/Data-Functor-Foldable.html\" rel=\"noreferrer\"><code>recursion-schemes</code></a> a type family is used to associate data types with their underlying functors.  But this is where the two types are connected.</p>\n\n<hr>\n\n<p>As for your second question, you need to be clearer about when you have a list and when you have a <code>ListF</code>.  They are completely different.</p>\n\n<pre><code>fmap (cata lenAlg) Nil\n</code></pre>\n\n<p>Here the functor you are mapping over is <code>ListF e</code> for whatever <code>e</code> you like.   That is, it's this <code>fmap</code>:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; ListF e a -&gt; ListF e b\n</code></pre>\n\n<p>If you implement <code>instance Functor (ListF e)</code> yourself (always a good exercise) and get it to compile, you will find that <code>Nil</code> must map to <code>Nil</code>, so the <code>cata lenAlg</code> didn't matter at all.  </p>\n\n<hr>\n\n<p>Let's look at the type of <code>Cons 1 (Cons 2 Nil)</code>:</p>\n\n<pre><code>Nil                 :: ListF e a\nCons 2 Nil          :: ListF Int (ListF e a)\nCons 1 (Cons 2 Nil) :: ListF Int (ListF Int (ListF e a))\n</code></pre>\n\n<p>Something is awry here.  The trouble is that we are forgetting to do the opposite of <code>unFix</code> to roll the <code>ListF</code> back up into a regular list.  I will call this function</p>\n\n<pre><code>roll :: ListF e [e] -&gt; [e]\n</code></pre>\n\n<p>Now we have</p>\n\n<pre><code>Nil                                      :: ListF e a\nroll Nil                                 :: [e]\nCons 2 (roll Nil)                        :: ListF Int [Int]\nroll (Cons 2 (roll Nil))                 :: [Int]\nCons 1 (roll (Cons 2 (roll Nil)))        :: ListF Int [Int]\nroll (Cons 1 (roll (Cons 2 (roll Nil)))) :: [Int]\n</code></pre>\n\n<p>The types are staying nice and small now, it's a good sign.  For the execution trace, let's just note that <code>unFix . roll = id</code>, however they work. It's important here to notice that</p>\n\n<pre><code>fmap f (Cons a b) = Cons a (f b)\nfmap f Nil        = Nil\n</code></pre>\n\n<p>That is, <code>fmap</code> on <code>ListF</code> just applies the function on the \"recursive part\" of the type.</p>\n\n<p>I'm going to switch the <code>Cons</code> case to <code>lenAlg (ConsF e n) = 1 + n</code> to make the trace a tiny bit more readable.  Still kind of a mess, good luck.</p>\n\n<pre><code>cata lenAlg (roll (Cons 1 (roll (Cons 2 (roll Nil)))))\n(lenAlg . fmap (cata lenAlg) . unFix) (roll (Cons 1 (roll (Cons 2 (roll Nil)))))\nlenAlg (fmap (cata lenAlg) (unFix (roll (Cons 1 (roll (Cons 2 (roll Nil)))))))\nlenAlg (fmap (cata lenAlg) (Cons 1 (roll (Cons 2 (roll Nil)))))\nlenAlg (Cons 1 (cata lenAlg (roll (Cons 2 (roll Nil)))))\n1 + cata lenAlg (roll (Cons 2 (roll Nil)))\n1 + (lenAlg . fmap (cata lenAlg) . unFix) (roll (Cons 2 (roll Nil)))\n1 + lenAlg (fmap (cata lenAlg) (unFix (roll (Cons 2 (roll Nil)))))\n1 + lenAlg (fmap (cata lenAlg) (Cons 2 (roll Nil)))\n1 + lenAlg (Cons 2 (cata lenAlg (roll Nil)))\n1 + 1 + cata lenAlg (roll Nil)\n1 + 1 + (lenAlg . fmap (cata lenAlg) . unFix) (roll Nil)\n1 + 1 + lenAlg (fmap (cata lenAlg) (unFix (roll Nil)))\n1 + 1 + lenAlg (fmap (cata lenAlg Nil))\n1 + 1 + lenAlg Nil\n1 + 1 + 0\n2\n</code></pre>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/4434292/catamorphism-and-tree-traversing-in-haskell\">my other answer</a> about catamorphisms.</p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1543308735, "creation_date": 1543308735, "answer_id": 53495816, "question_id": 53492756, "link": "https://stackoverflow.com/questions/53492756/how-does-compiler-figure-out-fixed-point-of-a-functor-and-how-cata-work-at-leaf/53495816#53495816", "title": "How does compiler figure out fixed point of a functor and how cata work at leaf level?", "body": "<p>\"List is the fixed point of ListF\" is a fast-and-loose figure of speech. While <a href=\"http://www.cse.chalmers.se/~nad/publications/danielsson-et-al-popl2006.html\" rel=\"nofollow noreferrer\">fast and loose reasoning is morally correct</a>, you always need to keep in mind the boring correct thing. Which is as follows:</p>\n\n<p><em>any least fixpoint of <code>ListF e</code> is isomorphic to <code>[e]</code></em>.</p>\n\n<p>Now \"the compiler\" (that's a fast-and-loose word for \"the Haskell language\" by the way) is not aware of isomorphisms of this kind. You can write isomorphic types all day</p>\n\n<pre><code>data []    x = []   | (:)   x ([]    x)    -- the imaginary built-in definition of []\ndata ListA x = NilA | ConsA x (ListA x)\ndata ListB x = NilB | ConsB x (ListB x)\ndata ListC x = NilC | ConsC x (ListC x)\n</code></pre>\n\n<p>and the compiler will never treat them as \"the same type\". Nor will it know that the fixpoint of <code>ListF e</code> is the same as <code>[e]</code>, or indeed what a fixpoint is. If you want to use these isomorphisms,  you need to teach the compiler about them by writing some code (e.g. by defining instances of <code>Data.Types.Isomorphic</code>), and then specifying the isomorphism explicitly each time you want to use it!</p>\n\n<p>Having this is mind, let's look at <code>cata</code> you have defined. The first thing that mets the eye is that the attempt at defining the type signature is a syntax error. Let's remove it and just define the function in GHCi (I changed the name of the parameter to <code>f</code> to avoid confusion, and fixed a few typos in the definition of ListF)</p>\n\n<pre><code>Main&gt; data ListF e a = NilF | ConsF e a\nMain&gt; let lenAlg :: ListF e Int -&gt; Int\nMain|     lenAlg (ConsF e n) = n + 1\nMain|     lenAlg NilF = 0\nMain|\nMain&gt;\nMain&gt; :m + Data.Fix\nMain Data.Fix&gt; cata f = f . fmap (cata f) . unFix\nMain Data.Fix&gt; :t cata\ncata :: Functor f =&gt; (f b -&gt; b) -&gt; Fix f -&gt; b\nMain Data.Fix&gt; :t cata lenAlg\ncata lenAlg :: Functor (ListF e) =&gt; Fix (ListF e) -&gt; Int\n</code></pre>\n\n<p>This says that in order to use <code>lenAlg</code>, you need to:</p>\n\n<ul>\n<li>define an instance of <code>Functor</code> for <code>ListF e</code></li>\n<li>use <code>Fix (ListF e)</code> (which is <strong>a</strong> fixpoint of ListF) explicitly. Wishing \"the fixpoint of ListF\" into existence just doesn't work. There's no magic.</li>\n</ul>\n\n<p>So let's do this:</p>\n\n<pre><code>Main Data.Fix&gt; instance Functor (ListF e) where\nMain Data.Fix|     fmap f NilF = NilF\nMain Data.Fix|     fmap f (ConsF e a) = ConsF e (f a)\nMain Data.Fix&gt;\nMain Data.Fix&gt; :t cata lenAlg\ncata lenAlg :: Fix (ListF e) -&gt; Int\n</code></pre>\n\n<p>Great, now we can calculate the length of a ListF-based Fix-wrapped list. But let's define a few helper definitions first.</p>\n\n<pre><code>Main Data.Fix&gt; type List e = Fix (ListF e)\nMain Data.Fix&gt; nil = Fix (NilF)\nMain Data.Fix&gt; let infixr 7 ~~                   -- using an infix operator for cons\nMain Data.Fix|     h ~~ t = Fix (ConsF h t)\nMain Data.Fix|\nMain Data.Fix&gt;\nMain Data.Fix&gt; myList = (1::Int) ~~ 2 ~~ 3 ~~ 4 ~~ nil\nMain Data.Fix&gt; :t myList\nmyList :: Fix (ListF Int)\n</code></pre>\n\n<p>Here's our \"list\" (a member of a type that is isomorphic to <code>[Int]</code> to be precise). Let's <code>cata lenAlg</code> it:</p>\n\n<pre><code>Main Data.Fix&gt; cata lenAlg myList\n4\n</code></pre>\n\n<p>Success!</p>\n\n<p>Bottom line: the compiler knows nothing,you need to explain it everything. </p>\n"}], "owner": {"reputation": 143, "user_id": 4077515, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1130100597/picture?type=large", "display_name": "learnereveryday", "link": "https://stackoverflow.com/users/4077515/learnereveryday"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 53495816, "answer_count": 3, "score": 7, "last_activity_date": 1563168846, "creation_date": 1543292885, "last_edit_date": 1563168846, "question_id": 53492756, "link": "https://stackoverflow.com/questions/53492756/how-does-compiler-figure-out-fixed-point-of-a-functor-and-how-cata-work-at-leaf", "title": "How does compiler figure out fixed point of a functor and how cata work at leaf level?", "body": "<p>I feel like understanding the abstract concept of fixed point of a functor, however, I am still struggling to figure out the exact implementation of it and its catamorphism in Haskell.</p>\n\n<p>For example, if I define, as according to the book of \"Category Theory for Programers\" -- page 359, the following algebra</p>\n\n<pre><code>-- (Int, LiftF e Int -&gt; Int)\n\ndata ListF e a = NilF | ConsF e a\n\nlenAlg :: ListF e Int -&gt; Int\nlenAlg (ConsF e n) -&gt; n + 1\nlenAlg NilF = 0\n</code></pre>\n\n<p>by definition of catamorphism, the following function could be applied to ListF's fixed point, which is a List, to calculate its length.</p>\n\n<pre><code>cata lenAlg :: [e] -&gt; Int\ncata lenAlg = lenAlg . fmap (cata lenAlg) . unFix\n</code></pre>\n\n<p>I have two confusions. First, how does Haskell compiler know that List is <strong>THE</strong> fixed point of ListF? I know conceptually it is, but how does the compiler know, i.e., what if we define another List' that is everything the same as List, I bet compiler does not automatically infer that List' is the fixed point of ListF too, or does it? (I'd be amazed).</p>\n\n<p>Second, due to the recursive nature of cata lenAlg, it always tries to unFix the outer layer of data constructor to expose the inner layer of functor (is this interpretation of mine even correct by the way?). But, what if we are already at the leaf, how could we invoke this function call?</p>\n\n<pre><code>fmap (cata lenAlg) Nil\n</code></pre>\n\n<p>As an example, could someone help write an execution trace for the below function call to clarify?</p>\n\n<pre><code>cata lenAlg Cons 1 (Cons 2 Nil)\n</code></pre>\n\n<p>I am probably missing something that is obvious, however I hope this question still makes sense for other people that share similar confusions.</p>\n\n<hr>\n\n<p>answer summary</p>\n\n<hr>\n\n<p>@n.m. answered my first question by pointing out that in order for Haskell compiler to figure out Functor A is a fixed point of Functor B, we need to be explicit. In this case, it is</p>\n\n<pre><code>type List e = Fix (ListF e)\n</code></pre>\n\n<p>@luqui and @Will Ness pointed out that calling fmap (cata lenAlg) on the leaf, which is NilF in this case, will return NilF back, because of the definition of fmap.</p>\n\n<pre><code>-- f :: a -&gt; b\nfmap f (ConsF e a) = ConsF e (f b)\nfmap f NilF        = NilF\n</code></pre>\n\n<p>I'd accept @n.m.'s answer as it directly addressed my first (bigger) question, but I do like all three answers. Thanks a lot for all your help!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 2, "creation_date": 1543290270, "post_id": 53492295, "comment_id": 93854690, "body": "Hint: use <code>read</code> from Prelude."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543291671, "post_id": 53492295, "comment_id": 93854972, "body": "You say the file has a bunch of arrays (or lists?), but your sample input only shows one list. Where are the others? Might there (or must there) be whitespace or other characters between them? Does the listing of lists end with a particular character or string, or does it go to the end of the file? Can there be extra whitespace at the end of the file?"}, {"owner": {"reputation": 1, "user_id": 9831380, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ayOp0E_TobM/AAAAAAAAAAI/AAAAAAAAGbM/3QIVqvqH8fg/photo.jpg?sz=128", "display_name": "\u6589\u662d\u5fb3\u5ddd", "link": "https://stackoverflow.com/users/9831380/%e6%96%89%e6%98%ad%e5%be%b3%e5%b7%9d"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543292391, "post_id": 53492295, "comment_id": 93855123, "body": "@dfeuer Noted. there are new lines between them. Sorry for not clarifying."}, {"owner": {"reputation": 1, "user_id": 9831380, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ayOp0E_TobM/AAAAAAAAAAI/AAAAAAAAGbM/3QIVqvqH8fg/photo.jpg?sz=128", "display_name": "\u6589\u662d\u5fb3\u5ddd", "link": "https://stackoverflow.com/users/9831380/%e6%96%89%e6%98%ad%e5%be%b3%e5%b7%9d"}, "reply_to_user": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1543292439, "post_id": 53492295, "comment_id": 93855137, "body": "@DannyuNDos I&#39;ve tried to use the read function, but I&#39;m not sure how to do so correctly. Whenever I try, It says I need to create the types Float and Int."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543295983, "post_id": 53492295, "comment_id": 93856003, "body": "each list separated by newline <code>&quot;\\n&quot;</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 2, "last_activity_date": 1543304000, "creation_date": 1543304000, "answer_id": 53494762, "question_id": 53492295, "link": "https://stackoverflow.com/questions/53492295/convert-string-of-lists-of-floats-to-list-of-lists-of-floats-in-haskell/53494762#53494762", "title": "Convert String of lists of floats to List of Lists of floats in Haskell", "body": "<p>Since the lines of the file separated by newlines, it can be transformed into list of strings using <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:lines\" rel=\"nofollow noreferrer\">lines</a> function. Then <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:read\" rel=\"nofollow noreferrer\">read</a> function can be used on every element of that list:</p>\n\n<pre><code>readListOfFloats :: String -&gt; [Float]\nreadListOfFloats = read\n\nmain = do\n   let args = \"output.txt\"\n   content &lt;- readFile args\n   print $ map readListOfFloats $ lines content\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>main = do\n   let args = \"output.txt\"\n   content &lt;- readFile args\n   print $ map (read :: String -&gt; [Float]) $ lines content\n</code></pre>\n\n<p>Both options will work as long as the type of <code>read</code> function is explicitly specified. The compiler can't infer it, because the developer is the only one who knows, which type of input to expect.</p>\n"}], "owner": {"reputation": 1, "user_id": 9831380, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ayOp0E_TobM/AAAAAAAAAAI/AAAAAAAAGbM/3QIVqvqH8fg/photo.jpg?sz=128", "display_name": "\u6589\u662d\u5fb3\u5ddd", "link": "https://stackoverflow.com/users/9831380/%e6%96%89%e6%98%ad%e5%be%b3%e5%b7%9d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 53494762, "answer_count": 1, "score": -1, "last_activity_date": 1543304000, "creation_date": 1543289202, "last_edit_date": 1543292344, "question_id": 53492295, "link": "https://stackoverflow.com/questions/53492295/convert-string-of-lists-of-floats-to-list-of-lists-of-floats-in-haskell", "title": "Convert String of lists of floats to List of Lists of floats in Haskell", "body": "<p>I am trying to convert a string containing floats to a list. Basically, I have a text file with a bunch of arrays listed, and I don't know how to gather them in haskell.</p>\n\n<p>Input:</p>\n\n<pre><code>\"[0.0, 21.05263157894737, 450.56721805219945, 450.5625302466032]\n[0.0, 42.10526315789474, 350.6536813941797, 346.7624393708003]\n[0.0, 189.47368421052633, 447.5003638411328, 352.12736129109106]\n[0.0, 210.5263157894737, 351.9493076378216, 347.65906596838636]\"\n</code></pre>\n\n<p>Just a small snippit of the string.</p>\n\n<p>Desired Output:</p>\n\n<pre><code>[0.0, 21.05263157894737, 450.56721805219945, 450.5625302466032]\n[0.0, 42.10526315789474, 350.6536813941797, 346.7624393708003]\n[0.0, 189.47368421052633, 447.5003638411328, 352.12736129109106]\n[0.0, 210.5263157894737, 351.9493076378216, 347.65906596838636]\n</code></pre>\n\n<p>All as lists.</p>\n\n<p>I've tried going through and converting characters, but It's all broken down.</p>\n\n<p>The tiny bit I do have just lists all the values</p>\n\n<pre><code>main = do\n   let args = \"output.txt\"\n   content &lt;- readFile (args)\n   print(linesOfFiles)\n</code></pre>\n\n<p>Any input appreciated.</p>\n"}, {"tags": ["parsing", "haskell", "applicative", "alternative-functor"], "answers": [{"comments": [{"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1543316159, "post_id": 53496035, "comment_id": 93865355, "body": "Thanks for the well thought out answer!"}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 1, "last_activity_date": 1543313036, "last_edit_date": 1543313036, "creation_date": 1543309419, "answer_id": 53496035, "question_id": 53492106, "link": "https://stackoverflow.com/questions/53492106/haskell-parsing-an-object-that-could-be-multiple-types-into-one-single-type/53496035#53496035", "title": "Haskell: Parsing an object that could be multiple types into one single type", "body": "<p>Well, I try to play with the JSON as below:</p>\n\n<pre><code>\"root\": {\n     \"m1\": {\n      \"key1\": \"value1\",\n      \"key2\": 2\n       },\n     \"m2\": {\n       \"key1\": 1\n       },\n}\n</code></pre>\n\n<p>and parse it to the follow data types using <strong><a href=\"http://hackage.haskell.org/package/aeson-1.4.1.0/docs/Data-Aeson.html\" rel=\"nofollow noreferrer\">Data.Aeson</a></strong>:</p>\n\n<pre><code>data Root = Root (Map String Key) deriving (Show)\n\ndata NeededVal = NoValue | NumericValue | Needed String deriving (Show)\n\ndata Key = Key { key1 :: NeededVal , key2 :: NeededVal } deriving (Show)\n</code></pre>\n\n<p>To handle <code>NoValue</code>, I use  Alternative <code>&lt;|&gt;</code> as</p>\n\n<pre><code>instance FromJSON Key where\n    parseJSON = withObject \"Key\" $ \\obj -&gt; do\n        k1 &lt;- obj .: (pack \"key1\") &lt;|&gt; pure NoValue\n        k2 &lt;- obj .: (pack \"key2\") &lt;|&gt; pure NoValue\n        return(Key k1 k2)\n</code></pre>\n\n<p>To test <code>String</code> and <code>numeric</code> type, I use <code>Value</code> constructor as:</p>\n\n<pre><code>instance FromJSON NeededVal where\n    parseJSON (String txt) = return $ Needed $ unpack txt\n    parseJSON (Number _)   = return $ NumericValue\n    parseJSON _            = return NoValue\n</code></pre>\n\n<p>To skip <code>m1</code> and <code>m2</code> objects and read the <code>keys</code> value immediately as:</p>\n\n<pre><code>import Data.Map as Map (Map, fromList)\nimport Data.HashMap.Strict as HM (toList, lookup)\nimport Data.Aeson.Types (Parser)\n\nparseJSON = withObject \"Root\" \n                $ \\rootObj-&gt; case HM.lookup (pack \"root\") rootObj of\n                                Nothing  -&gt; fail \"no Root\"\n                                Just val -&gt; withObject \"Key List\" mkRoot val\n    where mkRoot obj =\n            let (ks, vs) =  unzip $ HM.toList obj\n                ks' = map unpack ks\n            in  do vs' &lt;- mapM parseJSON vs::Parser [Key]\n                   return $ Root $ Map.fromList $ zip ks' vs'\n</code></pre>\n\n<p>and the final result:</p>\n\n<pre><code>Right (Root (fromList [\n    (\"m1\",Key {key1 = Needed \"value1\", key2 = NumericValue}),\n    (\"m2\",Key {key1 = NumericValue, key2 = NoValue})]\n))\n</code></pre>\n\n<p>Side notes:</p>\n\n<blockquote>\n  <p>but I'm not sure how I'd go about making them an instance of\n  Applicative &amp; Alternative so that the idea would work out.</p>\n</blockquote>\n\n<p><strong>No</strong>, No need to make them as an instance of <code>Applicative and Alternative</code>, the <code>&lt;|&gt;</code> operator apply on <code>Parser</code> (defined in <code>Data.Aeson.Types</code>) not the user defined data type. <code>Parser</code> has already be an instance of <code>Alternative</code>. </p>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 53496035, "answer_count": 1, "score": 0, "last_activity_date": 1613970083, "creation_date": 1543287662, "last_edit_date": 1613970083, "question_id": 53492106, "link": "https://stackoverflow.com/questions/53492106/haskell-parsing-an-object-that-could-be-multiple-types-into-one-single-type", "title": "Haskell: Parsing an object that could be multiple types into one single type", "body": "<p>I'm a haskell beginner going through aeson, learning more about both by parsing some data files.</p>\n\n<p>Usually when there's a data file, may it be <code>.json</code>, a <code>lua</code> table, <code>.csv</code> format or others, and you want to parse them, there's always a chance of error.</p>\n\n<p>For example, a simple <code>.json</code> file like this</p>\n\n<pre><code>\"root\": {\n     \"m1\": {\n      \"key1\": \"value1\",\n      \"key2\": 2\n       },\n     \"m2\": {\n       \"key1\": 1\n       },\n}\n</code></pre>\n\n<p>Has two oddities: <code>\"m1\"</code> has two subkeys, one has a value in <code>String</code> and one in <code>Int</code>. <code>\"m2\"</code> has only one subkey, and it has same key as the one above it but the value has a different type ie. <code>Int</code>.</p>\n\n<hr>\n\n<p>If it were like this</p>\n\n<pre><code>\"root\": {\n     \"m1\": {\n      \"key1\": \"value1\",\n      \"key2\": 2\n       },\n     \"m2\": {\n      \"key1\": \"value1\",\n      \"key2\": 2 \n       },\n}\n</code></pre>\n\n<p>A simple way of parsing it with Aeson would be with these datatypes</p>\n\n<pre><code>data Root = Root { Map String Key\n                 } deriving (Show, Generic)\n\ndata Key = Key { key1 :: String\n               , key2 :: Int\n               } deriving (Show, Generic)\n</code></pre>\n\n<hr>\n\n<p>If a key was missing </p>\n\n<pre><code>\"root\": {\n     \"m1\": {\n      \"key1\": \"value1\",\n      \"key2\": 2\n       },\n     \"m2\": {\n      \"key1\": \"value1\"\n       },\n}\n</code></pre>\n\n<p>This could have done the job</p>\n\n<pre><code>data Root = Root { Map String Key\n                 } deriving (Show, Generic)\n\ndata Key = Key { key1 :: String\n               , key2 :: Maybe Int\n               } deriving (Show, Generic)\n</code></pre>\n\n<hr>\n\n<p>But what if it were like the first example where not only can the keys not have a value but also have completely different ones.</p>\n\n<p>What if in them you only cared about the numbers or the strings? Would there be a way of parsing them without going out of the type definitions?</p>\n\n<p>Going through some quick searches I found out the Alternative class is just meant for this kind of problems and operator like <code>*&gt;</code>, <code>&lt;&gt;</code>, <code>&lt;|&gt;</code> can prove useful, but I'm not sure how.</p>\n\n<p>I know I need to define a type that can encapsulate all three chances if I just wanted the text or numbers, like </p>\n\n<p><code>Data NeededVal = NoValue | TextValue | Needed Int</code></p>\n\n<p>or</p>\n\n<p><code>Data NeededVal = NoValue | NumericValue | Needed String</code></p>\n\n<p>but I'm not sure how I'd go about making them an instance of Applicative &amp; Alternative so that the idea would work out.</p>\n\n<p>This is a short follow-up of my previous <a href=\"https://stackoverflow.com/questions/53466541/haskell-aeson-parsing-nested-json-with-part-unnecessary-values\">question</a> </p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 0, "creation_date": 1543285539, "post_id": 53491778, "comment_id": 93853724, "body": "The second merges two lists pairwise. The third has no name?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1543285549, "post_id": 53491778, "comment_id": 93853727, "body": "I&#39;m afraid your interpretation is only right for the first function. The second function takes in two lists and pairs elements going down them (so <code>zip [1,2,3] [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</code> gives you <code>[(1,&#39;a&#39;), (2,&#39;b&#39;), (3,&#39;c&#39;)]</code>). The third function is an indexing function. For example, <code>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;] !! 1</code> gives you <code>&#39;b&#39;</code>."}, {"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1543286008, "post_id": 53491778, "comment_id": 93853841, "body": "Oh my apologies, I copy-pasted the lists in the wrong order."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1543325452, "post_id": 53491778, "comment_id": 93870784, "body": "Recursion in Haskell isn&#39;t any different than recursion in other languages, and doesn&#39;t really have any connection to immutability (other than that, as you point out, you <i>must</i> use recursion instead of the loops you are more familiar with)."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1543291066, "creation_date": 1543291066, "answer_id": 53492526, "question_id": 53491778, "link": "https://stackoverflow.com/questions/53491778/haskell-basics-of-recursion/53492526#53492526", "title": "Haskell Basics of Recursion", "body": "<p>Let's look at how one might construct two of these.</p>\n\n<h3><code>zip</code></h3>\n\n<p>We'll start with <code>zip</code>. The purpose of <code>zip</code> is to \"zip\" two lists into one. The name comes from the analogy of zipping two sides of a zipper together. Here's an example of how it functions:</p>\n\n<pre><code>zip [1,2,3] [\"a\", \"b\", \"c\"]\n  = [(1,\"a\"), (2,\"b\"), (3,\"c\")]\n</code></pre>\n\n<p>The <em>type signature</em> of <code>zip</code> (which is typically the first thing you'd write) is</p>\n\n<pre><code>zip :: [a] -&gt; [b] -&gt; [(a, b)]\n</code></pre>\n\n<p>That is, it takes a list of elements of type <code>a</code> and a list of elements of type <code>b</code> and produces a list of pairs with one component of each type.</p>\n\n<p>To construct this function, let's go for standard Haskell pattern matching. We have four cases:</p>\n\n<ol>\n<li>The first list is <code>[]</code> and the second list is <code>[]</code>.</li>\n<li>The first list is <code>[]</code> and the second list is a cons (constructed using <code>:</code>).</li>\n<li>The first list is a cons and the second list is <code>[]</code>.</li>\n<li>The first list is a cons and the second list is also a cons.</li>\n</ol>\n\n<p>Let's work out each of these.</p>\n\n<pre><code>zip [] [] = ?\n</code></pre>\n\n<p>If you zip together two empty lists, you have no elements to work with, so surely you get the empty list.</p>\n\n<pre><code>zip [] [] = []\n</code></pre>\n\n<p>In the next case, we have</p>\n\n<pre><code>zip [] (y : ys) = ?\n</code></pre>\n\n<p>We have an element, <code>y</code>, of type <code>b</code>, but no element of type <code>a</code> to pair it with. So we can only construct the empty list.</p>\n\n<pre><code>zip [] (y : ys) = []\n</code></pre>\n\n<p>The same happens in the other asymmetrical case:</p>\n\n<pre><code>zip (x : xs) [] = []\n</code></pre>\n\n<p>Now we get to the interesting case of two conses:</p>\n\n<pre><code>zip (x : xs) (y : ys) = ?\n</code></pre>\n\n<p>We have elements of the right types, so we can make a pair, <code>(x, y)</code>, of type <code>(a, b)</code>. That's the head of the result. What's the tail of the result? Well, that's the result of zipping the two tails together.</p>\n\n<pre><code>zip (x : xs) (y : ys) = (x, y) : zip xs ys\n</code></pre>\n\n<p>Putting all these together, we get</p>\n\n<pre><code>zip [] [] = []\nzip [] (y : ys) = []\nzip (x : xs) [] = []\nzip (x : xs) (y : ys) = (x, y) : zip xs ys\n</code></pre>\n\n<p>But the implementation you gave only has three cases! How's that? Look at what the first two cases have in common: the first list is empty. You can see that <em>whenever</em> the first list is empty, the result is empty. So you can combine these cases:</p>\n\n<pre><code>zip [] _ = []\nzip (x : xs) [] = []\nzip (x : xs) (y : ys) = (x, y) : zip xs ys\n</code></pre>\n\n<p>Now look at what's now the second case. We already know that the first list is a cons (because otherwise we'd have taken the first case), and we don't need to know anything more about its composition, so we can replace it with a wildcard:</p>\n\n<pre><code>zip [] _ = []\nzip _ [] = []\nzip (x : xs) (y : ys) = (x, y) : zip xs ys\n</code></pre>\n\n<p>That's produces the <code>zip</code> implementation you copied. Now it turns out that there's a <em>different</em> way to combine the patterns that I think explains itself a bit more clearly. Reorder the four patterns like this:</p>\n\n<pre><code>zip (x : xs) (y : ys) = (x, y) : zip xs ys\nzip [] [] = []\nzip [] (y : ys) = []\nzip (x : xs) [] = []\n</code></pre>\n\n<p>Now you can see that the first pattern produces a cons and <em>all the rest</em> produce empty lists. So you can collapse all three of the rest, producing the nicely compact</p>\n\n<pre><code>zip (x : xs) (y : ys) = (x, y) : zip xs ys\nzip _ _ = []\n</code></pre>\n\n<p>This explains what happens when both lists are conses, and what happens when that's not the case.</p>\n\n<h3><code>length</code></h3>\n\n<p>The naive way to implement <code>length</code> is very direct:</p>\n\n<pre><code>length :: [a] -&gt; Int\nlength [] = 0\nlength (_ : xs) = 1 + length xs\n</code></pre>\n\n<p>This will give you correct answers, but it's inefficient. When evaluating the recursive call, the implementation needs to keep track of the fact that once it's done, it needs to add 1 to the result. In practice, it likely pushes the <code>1+</code> onto some sort of stack, makes the recursive call, pops the stack, and performs the addition. If the list has length <code>n</code>, the stack will reach size <code>n</code>. That's not great for efficiency. The solution, which the code you copied obscures somewhat, is to write a <em>more general</em> function instead.</p>\n\n<pre><code>-- | A number plus the length of a list\n--\n-- &gt; lengthPlus n xs = n + length xs\nlengthPlus :: Int -&gt; [a] -&gt; Int\n-- n plus the length of an empty list\n-- is n.\nlengthPlus n [] = n\nlengthPlus n (_ : xs) = ?\n</code></pre>\n\n<p>Well, </p>\n\n<pre><code> lengthPlus n (x : xs)\n = -- the defining property of `lengthPlus`\n n + length (x : xs)\n = -- the naive definition of length\n n + (1 + length xs)\n = -- the associative law of addition\n (n + 1) + length xs\n = -- the defining property of lengthPlus, applied recursively\n lengthPlus (n + 1) xs\n</code></pre>\n\n<p>So we get</p>\n\n<pre><code>lengthPlus n [] = n\nlengthPlus n (_ : xs) = lengthPlus (n + 1) xs\n</code></pre>\n\n<p>Now the implementation can increment the counter argument on each recursive call instead of delaying them till afterwards. Well ... pretty much.</p>\n\n<p>Thanks to Haskell's call-by-need semantics, this isn't guaranteed to run in constant memory. Suppose we call</p>\n\n<pre><code>lengthPlus 0 [\"a\",\"b\"]\n</code></pre>\n\n<p>This reduces to the second case:</p>\n\n<pre><code>lengthPlus (0 + 1) [\"b\"]\n</code></pre>\n\n<p>But we haven't actually demanded the value of the sum. So the implementation could defer that addition work, creating a chain of deferrals that's just as bad as the stack seen earlier! In practice, the compiler is clever enough that it will work out how to do this right when optimizations are enabled. But if you don't want to rely on that, you can give it a hint:</p>\n\n<pre><code>lengthPlus n [] = n\nlengthPlus n (_ : xs) = n `seq` lengthPlus (n + 1) xs\n</code></pre>\n\n<p>This tells the compiler that the integer argument actually has to be evaluated. As long as the compiler isn't being intentionally obtuse, it will be sure to evaluate it first, clearing up any deferred additions.</p>\n"}, {"comments": [{"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1543352790, "post_id": 53498102, "comment_id": 93886116, "body": "While the answers below this one are especially helpful in my general understanding of Haskell and this is now a page I&#39;ll have bookmarked for probably a very long time, your answer is exactly what I was looking for; a step by step analysis of a simple recursion function taken apart and looked at piece-by-piece. Thank you!"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1543316180, "creation_date": 1543316180, "answer_id": 53498102, "question_id": 53491778, "link": "https://stackoverflow.com/questions/53491778/haskell-basics-of-recursion/53498102#53498102", "title": "Haskell Basics of Recursion", "body": "<p>I'm not sure exactly which part you're confused by. Perhaps you're just overthinking this? Let's walk through <code>zip</code> slowly.</p>\n\n<p>For arguments' sake, let's say we want to execute <code>zip [1, 2, 3] ['A', 'B', 'C']</code>. What do we do?</p>\n\n<ul>\n<li>We have <code>zip [1, 2, 3] ['A', 'B', 'C']</code>. What now?</li>\n<li><p>The first line (\"equation\") of the definition of <code>zip</code> says</p>\n\n<pre><code>zip [] _ = []\n</code></pre></li>\n</ul>\n\n<p>Is our first argument an empty list? No, it's <code>[1, 2, 3]</code>. OK, so skip this equation.</p>\n\n<ul>\n<li><p>The second equation of <code>zip</code> says</p>\n\n<pre><code>zip _ [] = []\n</code></pre></li>\n</ul>\n\n<p>Is our second argument an empty list? No, it's <code>['A', 'B', 'C']</code>. So ignore this equation too.</p>\n\n<ul>\n<li><p>The last equation says</p>\n\n<pre><code>zip (x:xs) (y:ys) = (x, y) : zip xs ys\n</code></pre></li>\n</ul>\n\n<p>Is our first argument a non-empty list? Yes! It's <code>[1, 2, 3]</code>. So the first element becomes <code>x</code>, and the rest become <code>xs</code>: <code>x = 1</code>, <code>xs = [2, 3]</code>.</p>\n\n<p>Is our second argument a non-empty list? Again, yes: <code>y = 'A'</code>, <code>ys = ['B', 'C']</code>.</p>\n\n<p>OK, what do we do now? Well, what the right-hand size says. If I put in some extra brackets, the right-hand side basically says</p>\n\n<pre><code>(x, y) : (zip xs ys)\n</code></pre>\n\n<p>So we're constructing a new list, which starts with <code>(x, y)</code> (a 2-tuple) and continues with whatever <code>zip xs ys</code> is. So our output is <code>(1, 'A') : ???</code>.</p>\n\n<p>What is the <code>???</code> part? Well, it's like we executed <code>zip [2, 3] ['B', 'C']</code>. Go back to the top, walk through again the same way as before. You'll find that this outputs <code>(2, 'B') : ???</code>.</p>\n\n<p>Now we started with <code>(1, 'A') : ???</code>. If we replace that with the thing we just got, we now have <code>(1, 'A') : (2, 'B') : ???</code>.</p>\n\n<p>Take this one step further and we have <code>(1, 'A') : (2, 'B') : (3, 'C') : ???</code>. Here the <code>???</code> part is now <code>zip [] []</code>. It should be clear that the first equation says this is <code>[]</code>, so our final result is</p>\n\n<pre><code>(1, 'A') : (2, 'B') : (3, 'C') : []\n</code></pre>\n\n<p>which can also be written as</p>\n\n<pre><code>[(1, 'A'), (2, 'B'), (3, 'C')]\n</code></pre>\n\n<p>You probably already knew that was what the answer would eventually be. I hope now you can see <em>how</em> we get that answer.</p>\n\n<p>If you understand what the three equations make <code>zip</code> do at each step, we can summarise the process like this:</p>\n\n<pre><code>zip [1, 2, 3] ['A', 'B', 'C']\n(1, 'A') : (zip [2, 3] ['B', 'C'])\n(1, 'A') : (2, 'B') : (zip [3] ['C'])\n(1, 'A') : (2, 'B') : (3, 'C') : (zip [] [])\n(1, 'A') : (2, 'B') : (3, 'C') : []\n</code></pre>\n\n<p>If you're still confused, try to put your finger on exactly what part confuses you. (Yeah, easier said than done...)</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543414778, "post_id": 53503508, "comment_id": 93911740, "body": "Insert mandatory reference to &quot;Debunking the &#39;Expensive Procedure Call&#39; Myth; or, Procedure Call Implementations Considered Harmful; or, Lambda: The Ultimate GOTO.&quot; Guy Lewis Steele Jr. October 1977. MIT AI Memo 443."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543415313, "post_id": 53503508, "comment_id": 93912108, "body": "@dfeuer people so hang up on the syntaxtual.... :) look from far enough, it&#39;s all the same. even Prolog. and it&#39;s not that far. :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1543415867, "last_edit_date": 1543415867, "creation_date": 1543334299, "answer_id": 53503508, "question_id": 53491778, "link": "https://stackoverflow.com/questions/53491778/haskell-basics-of-recursion/53503508#53503508", "title": "Haskell Basics of Recursion", "body": "<p>A loop is a function call is a loop. Reentering a loop body with updated loop parameters is the same as reentering a function body in a new recursive call with the updated function parameters. Or in other words, a function call is a <code>goto</code>, and the function name is the label to jump to:</p>\n\n<pre><code>    loop_label: \n         do stuff updating a, b, c,\n         go loop_label\n</code></pre>\n\n<p>is</p>\n\n<pre><code>    loop a b c = \n        let a2 = {- .... a ... b ... c ... -}\n            b2 = {- .... a ... b ... c ... -}\n            c2 = {- .... a ... b ... c ... -}\n        in\n           loop a2 b2 c2\n</code></pre>\n\n<p>You did say you're comfortable with loops.</p>\n\n<hr>\n\n<p>Let's give the translations of your example functions in terms of the more primitive construct, <code>case</code>, as defined in the Report:</p>\n\n<pre><code>length xs = go 0 xs\n    where\n    go a b = case (a , b) of\n               ( acc , []       )   -&gt;      acc\n               ( acc , (_ : xs) )   -&gt;  go (acc + 1) xs\n</code></pre>\n\n<p>so it's the same old plain linear recursion.</p>\n\n<p>Same goes to the other two definitions:</p>\n\n<pre><code>zip a b = case ( a  , b  ) of\n            (  []   , _     )  -&gt;  []\n            (  _    , []    )  -&gt;  []\n            (x : xs , y : ys)  -&gt;  (x,y) : zip xs ys\n</code></pre>\n\n<p>(the last one is left as an exercise). </p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1543335129, "creation_date": 1543335129, "answer_id": 53503764, "question_id": 53491778, "link": "https://stackoverflow.com/questions/53491778/haskell-basics-of-recursion/53503764#53503764", "title": "Haskell Basics of Recursion", "body": "<p>The key to recursion is to stop worrying about how your language provides support for recursion. You really only need to know three things, which I'll demonstrate using <code>zip</code> as the example.</p>\n\n<ol>\n<li><p>How to solve the base case</p>\n\n<p>The base case is zipping two lists when one is empty. In this case, we simply return an empty list.</p>\n\n<pre><code> zip _ [] = []\n zip [] _ = []\n</code></pre></li>\n<li><p>How to break a problem into one (or more) simpler problem(s).</p>\n\n<p>A non-empty list can be split into two parts, a head and a tail. The head is a single element; the tail is a (sub)list. To zip together two lists, we \"zip\" together the two heads using <code>(,)</code>, and we zip together the two tails. Since the tails are both lists, we already have a way to zip them together: use <code>zip</code>!</p>\n\n<p>(As a former professor of mine would say, \"Trust your recursion\".) </p>\n\n<p>You might object that we can't call <code>zip</code> because we haven't finished defining it yet. But we <em>aren't</em> calling it yet; we are just saying that at some point in the future, when we call this function, the name <code>zip</code> will be bound to a function that zips two lists together, so we'll use that.</p>\n\n<pre><code>   zip (x:xs) (y:ys) = let h = (x,y)\n                           t = zip xs ys\n                       in ...\n</code></pre></li>\n<li><p>How to put the pieces back together.</p>\n\n<p><code>zip</code> needs to return a list, and we have our head <code>h</code> and tail <code>t</code> of the new list. To put them together, just use <code>(:)</code>:</p>\n\n<pre><code>    zip (x:xs) (y:ys) = let h = (x,y)\n                            t = zip xs ys\n                        in h : t\n</code></pre>\n\n<p>Or more simply, <code>zip (x:xs) (y:ys) = (x,y) : zip xs ys</code></p></li>\n</ol>\n\n<hr>\n\n<p>When explaining recursion, it's usually simplest to start with the base case. However, the Haskell code is sometimes simpler if you can write the recursive case first, because it lets us simply the base case.</p>\n\n<pre><code>zip (x:xs) (y:ys) = (x,y) : zip xs ys\nzip _ _ = []  -- If the first pattern match failed, at least one input is empty\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543415158, "post_id": 53504809, "comment_id": 93912004, "body": "You mention that 1 is a fixed point of <code>square</code>, but <code>fix</code> won&#39;t find that one! Perhaps you should choose another example (e.g., <code>fix (1:)</code>) and/or explain in some fashion that <code>fix</code> only finds the &quot;least&quot; fixed point?"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1543339142, "last_edit_date": 1543339142, "creation_date": 1543338736, "answer_id": 53504809, "question_id": 53491778, "link": "https://stackoverflow.com/questions/53491778/haskell-basics-of-recursion/53504809#53504809", "title": "Haskell Basics of Recursion", "body": "<p>Taking a step further back, let's introduce the only recursive function you'll ever need:</p>\n\n<pre><code>fix :: (a -&gt; a) -&gt; a\nfix f = f (fix f)\n</code></pre>\n\n<p><code>fix</code> computes the <em>fixed point</em> of its argument. \nThe fixed point of a function is the value that, when you apply the function, you get back the fixed point. For instance, the fixed point of the square function <code>square x = x**2</code> is 1, since <code>square 1 == 1*1 == 1</code>.</p>\n\n<p><code>fix</code> doesn't look terribly useful, though, since it looks like it just gets stuck in an infinite loop:</p>\n\n<pre><code>fix f = f (fix f) = f (f (fix f)) = f (f (f (fix f))) = ...\n</code></pre>\n\n<p>However, as we'll see, laziness lets us take advantage of this infinite stream of calls to <code>f</code>.</p>\n\n<hr>\n\n<p>Ok, how do we actually make use of <code>fix</code>? Consider this nonrecursive version of <code>zip</code>:</p>\n\n<pre><code>zip' :: ([a] -&gt; [b] -&gt; [(a,b)]) -&gt; [a] -&gt; [b] -&gt; [(a,b)]\nzip' f (x:xs) (y:ys) = (x,y) : f xs ys\nzip' _ _ _ = []\n</code></pre>\n\n<p>Given two nonempty lists, <code>zip'</code> zips them together by using the help function <code>f</code> that it receives to zip the tails of its inputs. If either input list is empty, it ignores <code>f</code> and returns an empty list. Basically, we've left the hard work to whoever calls <code>zip'</code>. We'll trust them to provide an appropriate <code>f</code>.</p>\n\n<p>But how <em>do</em> we call <code>zip'</code>? What argument can we pass? This is where <code>fix</code> comes in. Look at the type of <code>zip'</code> again, but this time make the substitution <code>t ~ [a] -&gt; [b] -&gt; [(a,b)]</code>:</p>\n\n<pre><code>zip' :: ([a] -&gt; [b] -&gt; [(a,b)]) -&gt; [a] -&gt; [b] -&gt; [(a,b)]\n     ::           t             -&gt;          t\n</code></pre>\n\n<p>Hey, that's the type <code>fix</code> expects! What's the type of <code>fix zip'</code>?</p>\n\n<pre><code>&gt; :t fix zip'\nfix zip' :: [a] -&gt; [b] -&gt; [(a, b)]\n</code></pre>\n\n<p>As expected. So what happens if we pass <code>zip'</code> its own fixed point? We should get back... the fixed point, that is, <code>fix zip'</code> and <code>zip' (fix zip')</code> should be the same function. We still don't really know what the fixed point of <code>zip'</code> <em>is</em>, but just for kicks, what happens if we try to call it?</p>\n\n<pre><code>&gt; (fix zip') [1,2] ['a','b']\n[(1,'a'),(2,'b')]\n</code></pre>\n\n<p>It sure looks like we just found a definition of <code>zip</code>! But how? Let's use equational reasoning to figure out what just happened.</p>\n\n<pre><code>(fix zip') [1,2] ['a','b']\n  == (zip' (fix zip')) [1,2] ['a','b']  -- def'n of fix\n  == (1,'a') : (fix zip') [2] ['b']     -- def'n of zip'\n  == (1,'a') : (zip' (fix zip')) [2] ['b'] -- def'n of fix, but in the other direction\n  == (1,'a') : ((2,'b') : (fix zip') [] []) -- def'n of zip'\n  == (1,'a') : ((2,'b') : zip' (fix zip') [] []) -- def'n of fix\n  == (1,'a') : ((2,'b') : [])  -- def'n of zip'\n</code></pre>\n\n<p>Because Haskell is lazy, the last call to <code>zip'</code> doesn't need to evaluate <code>fix zip'</code>, because its value is never used. So <code>fix f</code> doesn't <em>need</em> to terminate; it just needs to provide another call to <code>f</code> on demand.</p>\n\n<p>And in then end, we see that our recursive function <code>zip</code> is simply the fixed point of the nonrecursive function <code>zip'</code>:</p>\n\n<pre><code>fix f = f (fix f)\nzip' f (x:xs) (y:ys) = (x,y) : f xs ys\nzip' _ _ _ = []\nzip = fix zip'\n</code></pre>\n\n<p>Let's briefly use <code>fix</code> to define <code>length</code> and <code>(!!)</code> as well.</p>\n\n<pre><code>length xs = fix go' 0 xs\n  where go' _ acc []     = acc\n        go' f acc (_:xs) = f (acc + 1) xs\n\nxs !! n = fix (!!!) xs n\n  where (!!!) _ [] _ = error \"Too big\"\n        (!!!) _ (x:_) 0 = x\n        (!!!) f (x:xs) n = f xs (n-1)\n</code></pre>\n\n<hr>\n\n<p>And in general, a recursive function is just the fixed point of a suitable nonrecursive function. Note that not all functions <em>have</em> a fixed point, though. Consider</p>\n\n<pre><code>incr x = x + 1\n</code></pre>\n\n<p>If you try to call its fixed point, you get</p>\n\n<pre><code>(fix incr) 1 = (incr (fix incr)) 1\n             = (incr (incr (fix incr))) 1\n             = ...\n</code></pre>\n\n<p>Since <code>incr</code> <em>always</em> needs its first argument, the attempt to calculate its fixed point always <em>diverges</em>. It should be obvious that <code>incr</code> has no fixed point, because there is no number <code>x</code> for which <code>x == x + 1</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 1, "last_activity_date": 1543346752, "creation_date": 1543346752, "answer_id": 53506765, "question_id": 53491778, "link": "https://stackoverflow.com/questions/53491778/haskell-basics-of-recursion/53506765#53506765", "title": "Haskell Basics of Recursion", "body": "<p>Here\u2019s a nice trick to show how to convert normal imperative loops into recursion. Here are the steps:</p>\n\n<ol>\n<li>Make data immutable by not mutating objects (e.g. no <code>x.y = z</code>, only <code>x = x { y = z }</code>)</li>\n<li>Make variables \u201cnearly immutable\u201d by moving all variable-changes to just before control flow</li>\n<li>Change into \u201cgoto form\u201d</li>\n<li>Work out the set of mutating variables</li>\n<li>Add \u201cvariable changes\u201d for mutating variables that don\u2019t change at each goto</li>\n<li>Replace labels with functions and goto with function (tail) calls</li>\n</ol>\n\n<p>Here is a simple example after step 1 but before anything else (made up syntax)</p>\n\n<pre><code>let sumOfList f list =\n  total = 0\n  done = False\n  while (not done) {\n    case list of\n    [] -&gt; done = True\n    (x : xs) -&gt; \n      list = xs\n      total = total + (f x)\n  }\n  total\n</code></pre>\n\n<p>Well this doesn\u2019t really do much other than change variables but there\u2019s one thing we can do for step 2:</p>\n\n<pre><code>let sumOfList f list =\n  total = 0\n  done = False\n  while (not done) {\n    case list of\n    [] -&gt; done = True\n    (x : xs) -&gt; \n      let y = f x in\n      list = xs\n      total = total + y\n  }\n  total\n</code></pre>\n\n<p>Step 3:</p>\n\n<pre><code>let sumOfList f list =\n  total = 0\n  done = False\n  loop:\n    if not done then goto body else goto finish\n  body:\n    case list of\n    [] -&gt; \n      done = True\n      goto loop\n    (x : xs) -&gt; \n      let y = f x in\n      list = xs\n      total = total + y\n      goto loop\n  finish:\n    total\n</code></pre>\n\n<p>Step 4: the mutating variables are <code>done</code>, <code>list</code>, and <code>total</code></p>\n\n<p>Step 5:</p>\n\n<pre><code>let sumOfList f list =\n  done = False\n  list = list\n  total = 0\n  goto loop\n  loop:\n    if not done then \n      total = total\n      done = done\n      list = list\n      goto body\n    else\n      total = total\n      done = done\n      list = list\n      goto finish\n  body:\n    case list of\n    [] -&gt; \n      done = True\n      total = total\n      list = list\n      goto loop\n    (x : xs) -&gt; \n      let y = f x in\n      done = done \n      total = total + y\n      list = xs\n      goto loop\n  finish:\n    total\n</code></pre>\n\n<p>Step 6:</p>\n\n<pre><code>let sumOfList f list = loop False list 0 where\n  loop done list total =\n    if not done\n    then body done list total\n    else finish done list total\n body done list total =\n   case list of\n   [] -&gt; loop True list total\n   (x : xs) -&gt; let y = f x in loop done list (total + y)\n finish done list total = total\n</code></pre>\n\n<p>We can now clean things up by removing some unused parameters:</p>\n\n<pre><code>let sumOfList f list = loop False list 0 where\n  loop done list total =\n    if not done\n    then body done list total\n    else finish total\n body done list total =\n   case list of\n   [] -&gt; loop True list total\n   (x : xs) -&gt; let y = f x in loop done list (total + y)\n finish total = total\n</code></pre>\n\n<p>And realising that in <code>body</code> done is always <code>False</code> and inlining <code>loop</code> and <code>finish</code></p>\n\n<pre><code>let sumOfList f list = body list 0 where\n body list total =\n   case list of\n   [] -&gt; total\n   (x : xs) -&gt; let y = f x in body list (total + y)\n</code></pre>\n\n<p>And now we can pull the <code>case</code> into multiple function definitions:</p>\n\n<pre><code>let sumOfList f list = body list 0 where\n body [] total = total\n body (x : xs) total =\n   let y = f x in body list (total + y)\n</code></pre>\n\n<p>Now inline the definition of <code>y</code> and give <code>body</code> a better name:</p>\n\n<pre><code>let sumOfList f list = go list 0 where\n go [] total = total\n go (x : xs) total = go list (total + f y)\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 0, "answer_count": 6, "score": 1, "last_activity_date": 1543415867, "creation_date": 1543284697, "last_edit_date": 1543354638, "question_id": 53491778, "link": "https://stackoverflow.com/questions/53491778/haskell-basics-of-recursion", "title": "Haskell Basics of Recursion", "body": "<p>I'm not exactly sure if I'm even supposed to ask more general, nonspecific questions on this platform, but I'm new to writing Haskell and writing code in general and an in-depth explanation would really be appreciated. I'm very used to the typical method of using loop systems in other languages, but as Haskell's variables are immutable, I've found recursion really difficult to wrap my head around. A few examples from the Haskell Wikibook include:</p>\n\n<pre><code>length xs = go 0 xs\n    where\n    go acc []     = acc\n    go acc (_:xs) = go (acc + 1) xs\n\nzip []     _      = []\nzip _      []     = []\nzip (x:xs) (y:ys) = (x,y) : zip xs ys\n\n[]     !! _ = error \"Index too large\" -- An empty list has no elements.\n(x:_)  !! 0 = x\n(x:xs) !! n = xs !! (n-1)\n</code></pre>\n\n<p>The first one is kind of self-explanatory, just writing a length function for strings from scratch. The second is like an index search that returns a char at a specified point, and the third I guess kind of transposes lists together.\nDespite somewhat knowing what these pieces of code do, I'm having a lot of trouble wrapping my head around how they function. Any and all step-by-step analysis of how these things actually process would be GREATLY appreciated.</p>\n\n<p>EDIT: Thank you all for the answers! I have yet to go through all of them thoroughly but after reading some this is exactly the kind of information I'm looking for. I don't have a lot of time to practice right now, finals soon and all, but during my break and decided to take another crack at recursion with this:</p>\n\n<pre><code>ood x \n    |rem x 2 == 1 = ood (x-1)\n    |x &lt;= 0 = _\n    |otherwise = ood (x-2)\n</code></pre>\n\n<p>I wanted to attempt to make a small function that prints every odd number starting from x down to 1. Obviously it does not work; it simply only prints 1. I believe it does hit every odd number on the way down, it just does not display it's answers intermittently. If any one of you could take my own attempt at code and show me how to create a successful recursion function it would really help me a lot!</p>\n"}, {"tags": ["haskell", "lambda", "anonymous-function"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1543290156, "post_id": 53491403, "comment_id": 93854672, "body": "<code>sortByFirst = sortOn fst</code>"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 7, "creation_date": 1543281519, "post_id": 53491426, "comment_id": 93852957, "body": "Even sweeter: with <code>comparing</code> from <code>Data.Ord</code>, <code>sortByFirst = sortBy (comparing fst)</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1543282264, "post_id": 53491426, "comment_id": 93853094, "body": "Oops, forgot about that specific function."}, {"owner": {"reputation": 886, "user_id": 2184449, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/a8fc41244d47a3aa594fdeea90983863?s=128&d=identicon&r=PG", "display_name": "Jere", "link": "https://stackoverflow.com/users/2184449/jere"}, "edited": false, "score": 0, "creation_date": 1543282701, "post_id": 53491426, "comment_id": 93853170, "body": "Thanks, thats exactly what I was looking for!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 886, "user_id": 2184449, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/a8fc41244d47a3aa594fdeea90983863?s=128&d=identicon&r=PG", "display_name": "Jere", "link": "https://stackoverflow.com/users/2184449/jere"}, "edited": false, "score": 1, "creation_date": 1545588274, "post_id": 53491426, "comment_id": 94656383, "body": "@Jere, <code>sortOn</code> is less efficient than the <code>sortByFirst</code> defined in this answer."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1543281381, "creation_date": 1543281381, "answer_id": 53491426, "question_id": 53491403, "link": "https://stackoverflow.com/questions/53491403/is-there-a-short-lambda-expression-for-a-a-ordering/53491426#53491426", "title": "Is there a short Lambda expression for a-&gt;a-&gt;Ordering?", "body": "<p>You could use the <code>on</code> function, from the <code>Data.Function</code> module.</p>\n\n<pre><code>import Data.List\n\nsortByFirst = sortBy (compare `on` fst)\n</code></pre>\n\n<p>The definition of <code>on</code> is roughly</p>\n\n<pre><code>on f g = \\x y -&gt; f (g x) (g y)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1545593277, "last_edit_date": 1545593277, "creation_date": 1543677443, "answer_id": 53572182, "question_id": 53491403, "link": "https://stackoverflow.com/questions/53491403/is-there-a-short-lambda-expression-for-a-a-ordering/53572182#53572182", "title": "Is there a short Lambda expression for a-&gt;a-&gt;Ordering?", "body": "<p>With <code>comparing</code> from <code>Data.Ord</code>, it can be spelled as...</p>\n\n<pre><code>sortByFirst = sortBy (comparing fst)\n</code></pre>\n\n<p>... which is equivalent to is equivalent to the <code>compare `on` fst</code> in <a href=\"https://stackoverflow.com/a/53491426/2751851\">chepner's answer</a>.</p>\n\n<p>(<code>Data.List</code> also offers a <code>sortOn :: Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]</code>, but that is a special purpose function which is only worth using if the involved <code>a -&gt; b</code> function is somewhat expensive, something that <code>fst</code> is not.)</p>\n"}], "owner": {"reputation": 886, "user_id": 2184449, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/a8fc41244d47a3aa594fdeea90983863?s=128&d=identicon&r=PG", "display_name": "Jere", "link": "https://stackoverflow.com/users/2184449/jere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 53491426, "answer_count": 2, "score": 1, "last_activity_date": 1545593277, "creation_date": 1543281170, "question_id": 53491403, "link": "https://stackoverflow.com/questions/53491403/is-there-a-short-lambda-expression-for-a-a-ordering", "title": "Is there a short Lambda expression for a-&gt;a-&gt;Ordering?", "body": "<p>Lambda Expressions can make life easier and I love the way, you can shorten expressions like <code>(\\x -&gt; x + 1)</code> to <code>(+1)</code>.</p>\n\n<p>That's why I'm wondering if there is anything similar for anonymous functions that take two arguments and return a <code>Ordering</code>.</p>\n\n<p>For example: Can you shorten this code:</p>\n\n<pre><code>sortByFirst :: Ord a =&gt; [(a, b)] -&gt; [(a, b)]\nsortByFirst = sortBy (\\x y -&gt; fst x `compare` fst y)\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "type-constructor"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1543278699, "post_id": 53491039, "comment_id": 93852332, "body": "<code>IO</code> is a primitive and has no constructors, so cannot be unwrapped."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 11, "last_activity_date": 1543278660, "creation_date": 1543278660, "answer_id": 53491100, "question_id": 53491039, "link": "https://stackoverflow.com/questions/53491039/how-does-the-haskell-compiler-know-that-io-cannot-be-unwrapped/53491100#53491100", "title": "How does the Haskell compiler &quot;know&quot; that IO cannot be unwrapped?", "body": "<p><code>Just</code> and <code>Nothing</code> are data constructors for the type <code>Maybe a</code>. <code>IO</code> has no data constructors to speak of (in GHC it actually has constructors but they're really implementation details of GHC, and other implementations might define <code>IO</code> differently).</p>\n\n<p><code>unwrapIO (IO str) = str</code> doesn't make sense in the same way <code>unwrapMaybe (Maybe str) = str</code> doesn't make sense. <code>IO</code> and <code>Maybe</code> are not data constructors, so you cannot pattern-match on them.</p>\n"}, {"tags": [], "owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "is_accepted": false, "score": 9, "last_activity_date": 1543279767, "last_edit_date": 1543279767, "creation_date": 1543278708, "answer_id": 53491110, "question_id": 53491039, "link": "https://stackoverflow.com/questions/53491039/how-does-the-haskell-compiler-know-that-io-cannot-be-unwrapped/53491110#53491110", "title": "How does the Haskell compiler &quot;know&quot; that IO cannot be unwrapped?", "body": "<p>It's because the data constructor of <code>IO</code> is not exported. I mean, you can think it's not exported.</p>\n\n<p>You can prevent your own type from being unwrapped by using the same strategy.</p>\n\n<pre><code>module Test (Test, test) where\n\ndata Test a = MkTest a\n\ntest :: a -&gt; Test a\ntest = MkTest\n</code></pre>\n\n<p>You can create a value of <code>Test</code> using <code>test</code>, but you cannot unwrap it using pattern-match because <code>MkTest</code> is not exported.</p>\n"}, {"tags": [], "owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "is_accepted": false, "score": 1, "last_activity_date": 1547325609, "creation_date": 1547325609, "answer_id": 54163674, "question_id": 53491039, "link": "https://stackoverflow.com/questions/53491039/how-does-the-haskell-compiler-know-that-io-cannot-be-unwrapped/54163674#54163674", "title": "How does the Haskell compiler &quot;know&quot; that IO cannot be unwrapped?", "body": "<p>I believe that while the existing answers are mostly true, there is a deeper reason why <code>IO</code> can not be unwrapped. <a href=\"https://wiki.haskell.org/IO_inside\" rel=\"nofollow noreferrer\">Conceptually</a>, <code>type IO a = RealWorld -&gt; (a, RealWorld)</code>. <code>IO</code> is a function type (in real implementations hidden behind a newtype wrapper or equivalent machinery).</p>\n\n<p>So, how would you go about unwrapping a function? Easy, you just call it!. But how are you going to get an instance of <code>RealWorld</code>? That is the truer primitive: you can not construct a <code>RealWorld</code>, there is only ever one.</p>\n\n<p>The monadic instance of course can just pass <code>RealWorld</code> as a state, kind of like <code>StateT</code> and in the end, the only instance ever constructed is at startup of the program, then it is passed down between the <code>IO</code>s.</p>\n\n<p>Coming back to reality again, this is (again) a lie. You actually can get hold of an instance of <code>RealWorld</code> and you can call an <code>IO a</code> action \"ahead of time\". There is a function that does exactly what you asked for. It is called <a href=\"https://www.stackage.org/haddock/lts-13.2/base-4.12.0.0/System-IO-Unsafe.html#v:unsafePerformIO\" rel=\"nofollow noreferrer\"><code>System.IO.Unsafe.unsafePerformIO :: IO a -&gt; a</code></a> though it is in an unsafe package for a reason.</p>\n"}], "owner": {"reputation": 10593, "user_id": 1233320, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Qq4JP.jpg?s=128&g=1", "display_name": "markasoftware", "link": "https://stackoverflow.com/users/1233320/markasoftware"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 1, "accepted_answer_id": 53491100, "answer_count": 3, "score": 8, "last_activity_date": 1547325609, "creation_date": 1543278184, "question_id": 53491039, "link": "https://stackoverflow.com/questions/53491039/how-does-the-haskell-compiler-know-that-io-cannot-be-unwrapped", "title": "How does the Haskell compiler &quot;know&quot; that IO cannot be unwrapped?", "body": "<p>Obviously, the following function is impossible, because it is impossible to unwrap an IO value permanently (ignoring unsafePerformIO or similar):</p>\n\n<pre><code>unwrapIO :: IO String -&gt; String\nunwrapIO (IO str) = str\n</code></pre>\n\n<p>However, similar functions such as the following are possible:</p>\n\n<pre><code>unwrapJust :: Maybe String -&gt; String\nunwrapJust (Just str) = str\nunwrapJust Nothing = \"ignore this plz\"\n</code></pre>\n\n<p>I fully understand the reasoning behind why #2 is possible but #1 is not, but I do not understand how. Can I also make my own types that are not unwrappable?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1543274332, "post_id": 53490241, "comment_id": 93851200, "body": "Aren&#39;t you on SO long enough to know to post proper <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>s?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1543275819, "post_id": 53490241, "comment_id": 93851638, "body": "No, there isn&#39;t a way to make this work, although it&#39;s maybe an interesting idea."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1543280350, "post_id": 53490241, "comment_id": 93852735, "body": "@leftaroundabout It&#39;s not necessary to condescend with &quot;you should know better&quot;. A comment like &quot;Please include an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>&quot; conveys the same message without putting the question-asker on the defensive. Or, simply use a close vote with the MCVE reason."}, {"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "edited": false, "score": 0, "creation_date": 1543354633, "post_id": 53490241, "comment_id": 93886954, "body": "Sorry, it&#39;s quite harder to get smaller without losing the motivation for the question."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1543285672, "creation_date": 1543285672, "answer_id": 53491891, "question_id": 53490241, "link": "https://stackoverflow.com/questions/53490241/way-to-have-a-common-function-in-an-instance-declaration/53491891#53491891", "title": "Way to have a common function in an instance declaration?", "body": "<p>Haskell doesn't allow local definitions in instance declaration <code>where</code> clauses. But suppose, hypothetically, that it did. Then what you're trying to do <em>still</em> wouldn't work. The compiler has no way to know how to instantiate the type variables in the calls to <code>convert</code>. You seem to want something like implicit parameters at the type level, and that sounds like an absolute nightmare to me. If proxy passing isn't to your taste, you can use <code>TypeApplications</code> instead.</p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 53491891, "answer_count": 1, "score": 0, "last_activity_date": 1543285672, "creation_date": 1543272238, "question_id": 53490241, "link": "https://stackoverflow.com/questions/53490241/way-to-have-a-common-function-in-an-instance-declaration", "title": "Way to have a common function in an instance declaration?", "body": "<p>I'm trying to make the following code work:</p>\n\n<pre><code>instance (Integral n, OffsetCalculator o, HexDirection d) =&gt; (IsoEvidence (Axial d n) (Offset d o n)) where\n    po :: Proxy o\n    po = Proxy\n    pd :: Proxy d\n    pd = Proxy\n    adj :: Vector2D n -&gt; n\n    adj p = adjustment po $ p ^. otherAxis pd\n    convert :: (n -&gt; n -&gt; n) -&gt; Vector2D n -&gt; Vector2D n\n    convert f p = (offsetAxis pd) %~ (flip f (adj p)) $ p\n\n    convertFrom (Offset p) = Axial $ convert (P.-) p\n    convertTo (Axial p) = Offset $ convert (P.+) p\n</code></pre>\n\n<p>I'm converting this from some previously compiling code, so I'm relatively confident the code is conceptually fine. My problem is that convertFrom and convertTo are the only exposed methods of the IsoEvidence class. Therefore, the rest of this doesn't compile.</p>\n\n<p>If I move \"convert\" out of the instance declaration, it starts to need Proxy parameters itself which makes the code uglier. Is there a way to make what I'm trying to do work?</p>\n"}, {"tags": ["haskell", "travis-ci", "haskell-stack"], "comments": [{"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1543278994, "post_id": 53489812, "comment_id": 93852412, "body": "I\u2019m going to assume your local builds are caching  artifacts, while Travis is not.  That would be the first thing I would look into."}, {"owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "reply_to_user": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1543318773, "post_id": 53489812, "comment_id": 93866801, "body": "I&#39;ve measured it with clean build, it took less than 3 minutes. As for external artifact (ghc itself and other libraries) - Travis managed to cache them as well."}, {"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1543342691, "post_id": 53489812, "comment_id": 93881234, "body": "Oh, that&#39;s really weird then.  Is the build log on Travis showing you that it&#39;s compiling things you are not locally?"}, {"owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "reply_to_user": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1543487776, "post_id": 53489812, "comment_id": 93941511, "body": "No, it compiles only project files. But this takes to long and compilation timed out. Long compilation time itself quite explainable: I use 4 core 4GHz processor to compile locally, Travis likely allocates 1 core server grade processor with much lower frequency. So 10x time difference does not looks weird to me. The question is how to deal with it. Starting Travis Enterprise seems to be overkill."}], "answers": [{"tags": [], "owner": {"reputation": 833, "user_id": 1007926, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dc0133e5980f0289b82d223562ec0a49?s=128&d=identicon&r=PG", "display_name": "Peter Becich", "link": "https://stackoverflow.com/users/1007926/peter-becich"}, "is_accepted": false, "score": 0, "last_activity_date": 1576639176, "creation_date": 1576639176, "answer_id": 59385024, "question_id": 53489812, "link": "https://stackoverflow.com/questions/53489812/travis-ci-bypass-50m-timeout-for-haskell-stack-builds/59385024#59385024", "title": "Travis CI - bypass 50m timeout for Haskell Stack builds", "body": "<p>This configuration uses stages: <a href=\"https://github.com/google/codeworld/blob/f20020ca78fee51afdf6a5ef13eacc6d15c15724/.travis.yml\" rel=\"nofollow noreferrer\">https://github.com/google/codeworld/blob/f20020ca78fee51afdf6a5ef13eacc6d15c15724/.travis.yml</a></p>\n\n<p>However, there are unpredictable problems with the cache, or perhaps problems with the Travis config: <a href=\"https://travis-ci.org/google/codeworld/builds/626216910\" rel=\"nofollow noreferrer\">https://travis-ci.org/google/codeworld/builds/626216910</a>  Also, I am not sure how Travis utilizes the cache(s) for simultaneous builds. </p>\n\n<p><a href=\"https://github.com/google/codeworld/blob/f20020ca78fee51afdf6a5ef13eacc6d15c15724/.travis.yml#L52-L63\" rel=\"nofollow noreferrer\">https://github.com/google/codeworld/blob/f20020ca78fee51afdf6a5ef13eacc6d15c15724/.travis.yml#L52-L63</a> , <a href=\"https://github.com/google/codeworld/blob/f20020ca78fee51afdf6a5ef13eacc6d15c15724/.travis.yml#L74\" rel=\"nofollow noreferrer\">https://github.com/google/codeworld/blob/f20020ca78fee51afdf6a5ef13eacc6d15c15724/.travis.yml#L74</a> , and the redundant calls to <code>stack upgrade --binary-only</code> are attempts to work around these issues.</p>\n"}], "owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1576639176, "creation_date": 1543269843, "question_id": 53489812, "link": "https://stackoverflow.com/questions/53489812/travis-ci-bypass-50m-timeout-for-haskell-stack-builds", "title": "Travis CI - bypass 50m timeout for Haskell Stack builds", "body": "<p>I have a Haskell project with 300+ files (mostly auto generated). I can build it in few minutes with my 4 yo. processor (by specifying ghc-options: $everything: -j in stack.yaml) but when it comes to Travis things becomes really slow. It seems that modules being processed sequentially and even single module compilation time much larger (about one second on my machine vs tens on seconds on Travis) Eventually I hit Travis timeout (50 min for single job). Is there any way to speed up Travis build or to split up compilation process to multiple jobs? I would accept paid plan from Travis, I need solution which just works without complex setup.</p>\n"}, {"tags": ["haskell", "io", "closures", "do-notation", "ioref"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1543261403, "post_id": 53487894, "comment_id": 93845664, "body": "A side note: you should not have an <code>IO (IO Int)</code> type, this is bad style."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1543262615, "post_id": 53487894, "comment_id": 93846217, "body": "@AJFarmar, I don&#39;t see anything bad about that style; it&#39;s just providing a counter with a restricted interface."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1543263038, "post_id": 53487894, "comment_id": 93846440, "body": "Well, I suppose it would actually be better to provide an abstract <code>Counter</code> type...."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543263289, "post_id": 53487894, "comment_id": 93846580, "body": "let-over-lambda to bind-over-return. :)"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1543437627, "post_id": 53487894, "comment_id": 93924262, "body": "@AJFarmar I wouldn&#39;t use <code>IO (IO Int)</code> just for a counter: but that pattern is often the best way of expressing something."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1543267292, "last_edit_date": 1543267292, "creation_date": 1543262752, "answer_id": 53488239, "question_id": 53487894, "link": "https://stackoverflow.com/questions/53487894/haskell-ioref-an-answer-vs-a-function-to-get-an-answer/53488239#53488239", "title": "Haskell IORef - an answer vs. a function to get an answer", "body": "<p>You can think of <code>IO</code> as a type of programs. <code>newCounter :: IO (IO Int)</code> is a program that outputs a program. More precisely, <code>newCounter</code> allocates a new counter, and returns a program that, when run, increments the counter and returns its old value. <code>newCounter</code> doesn't execute the program it returns. It would if you wrote instead:</p>\n\n<pre><code>newCounter :: IO (IO Int)\nnewCounter = do \n  r &lt;- newIORef 0\n  let p = do              -- name the counter program p\n        v &lt;- readIORef r\n        writeIORef r (v + 1)\n        return v\n  p          -- run the counter program once\n  return p   -- you can still return it to run again later\n</code></pre>\n\n<hr>\n\n<p>You can also use equational reasoning to unfold <code>printCounts</code> into a sequence of primitives. All versions of <code>printCounts</code> below are equivalent programs:</p>\n\n<pre><code>-- original definition\nprintCounts :: IO ()\nprintCounts = do\n  c &lt;- newCounter\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n\n-- by definition of newCounter...\n\nprintCounts = do\n  c &lt;- do\n    r &lt;- newIORef 0\n    return $ do\n      v &lt;- readIORef r\n      writeIORef r (v + 1)\n      return v\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n\n-- by the monad laws (quite hand-wavy for brevity)\n-- do\n--   c &lt;- do\n--     X\n--     Y\n--   .....\n-- =\n-- do\n--   X\n--   c &lt;- \n--     Y\n--   .....\n--\n-- (more formally,\n--  ((m &gt;&gt;= \\x -&gt; k x) &gt;&gt;= h) = (m &gt;&gt;= (\\x -&gt; k x &gt;&gt;= h)))\n\nprintCounts = do\n  r &lt;- newIORef 0\n  c &lt;-\n    return $ do\n      v &lt;- readIORef r\n      writeIORef r (v + 1)\n      return v\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n\n-- c &lt;- return X\n-- =\n-- let c = X\n--\n-- (more formally, ((return X) &gt;&gt;= (\\c -&gt; k c)) = (k X)\n\nprintCounts = do\n  r &lt;- newIORef 0\n  let c = do\n        v &lt;- readIORef r\n        writeIORef r (v + 1)\n        return v\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n\n-- let-substitution\n\nprintCounts = do\n  r &lt;- newIORef 0\n  print =&lt;&lt; do\n        v &lt;- readIORef r\n        writeIORef r (v + 1)\n        return v\n  print =&lt;&lt; do\n        v &lt;- readIORef r\n        writeIORef r (v + 1)\n        return v\n  print =&lt;&lt; do\n        v &lt;- readIORef r\n        writeIORef r (v + 1)\n        return v\n\n-- after many more applications of monad laws and a bit of renaming to avoid shadowing\n-- (in particular, one important step is ((return v &gt;&gt;= print) = (print v)))\n\nprintCounts = do\n  r &lt;- newIORef 0\n  v1 &lt;- readIORef r\n  writeIORef r (v1 + 1)\n  print v1\n  v2 &lt;- readIORef r\n  writeIORef r (v2 + 1)\n  print v2\n  v3 &lt;- readIORef r\n  writeIORef r (v3 + 1)\n  print v3\n</code></pre>\n\n<p>In the final version, you can see that <code>printCounts</code> quite literally allocates a counter and increments it three times, printing each intermediate value.</p>\n\n<p>One key step is the let-substitution one, where the counter program gets duplicated, which is why it gets to run three times. <code>let x = p; ...</code> is different from <code>x &lt;- p; ...</code>, which runs <code>p</code>, and binds <code>x</code> to the result rather than the program <code>p</code> itself.</p>\n"}], "owner": {"reputation": 85, "user_id": 9512450, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fU9_7FMLvGE/AAAAAAAAAAI/AAAAAAAAHt0/H2b5RELdnH0/photo.jpg?sz=128", "display_name": "David Jacobs", "link": "https://stackoverflow.com/users/9512450/david-jacobs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 53488239, "answer_count": 1, "score": 4, "last_activity_date": 1543267292, "creation_date": 1543261133, "last_edit_date": 1543263509, "question_id": 53487894, "link": "https://stackoverflow.com/questions/53487894/haskell-ioref-an-answer-vs-a-function-to-get-an-answer", "title": "Haskell IORef - an answer vs. a function to get an answer", "body": "<p>I'm trying to understand how <code>IORefs</code> are really used, and I'm having trouble following the sample code I found on <a href=\"https://www.seas.upenn.edu/~cis194/spring15/lectures/12-unsafe.html\" rel=\"nofollow noreferrer\">https://www.seas.upenn.edu/~cis194/spring15/lectures/12-unsafe.html</a></p>\n\n<pre><code>newCounter :: IO (IO Int)\nnewCounter = do\n  r &lt;- newIORef 0\n  return $ do\n    v &lt;- readIORef r\n    writeIORef r (v + 1)\n    return v\n\nprintCounts :: IO ()\nprintCounts = do\n  c &lt;- newCounter\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n  print =&lt;&lt; c\n</code></pre>\n\n<p>When <code>printCounts</code> executes \"<code>c &lt;- newCounter</code>\", why doesn't <code>c</code> get the result of doing the work in the <code>newCounter</code> \"<code>return $ do</code>\" block, which seems like it should get assigned to the constant \"<code>IO 0</code>\" the first time it is called and then never change?  Instead, <code>c</code> seems to get assigned the function defined in that \"<code>return $ do</code>\" block, which is then executed anew every time <code>printCounts</code> gets to another \"<code>print =&lt;&lt; c</code>.\"  It seems that the answer somehow lies in <code>newCounter</code> having the double nested \"<code>IO (IO Int)</code>\" type, but I can't follow why that makes <code>c</code> a function to be re-executed when called instead of a constant evaluated just once.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1543259559, "post_id": 53487566, "comment_id": 93844895, "body": "No that is correct, since <code>length :: [Int] -&gt; Int</code> is not the same function as <code>length :: [Char] -&gt; Int</code>. Here you thus force <code>f</code> to to have a specific type, but that is <i>not</i> applicable to both inputs <code>l1</code> and <code>l2</code>."}, {"owner": {"reputation": 193, "user_id": 4887503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16fea0aa45d3a606279504a80a3e3159?s=128&d=identicon&r=PG&f=1", "display_name": "SuperM4n", "link": "https://stackoverflow.com/users/4887503/superm4n"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543260306, "post_id": 53487566, "comment_id": 93845208, "body": "Oh, so I misunderstood it after all. Thank you. How can I fix it? I tried using <code>let</code> for one of the inputs so that they don&#39;t have the same type when using <code>length</code> function but that doesn&#39;t work."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1543272869, "post_id": 53487566, "comment_id": 93850712, "body": "Tuples handle multiple types. Lists are typed. Two types don&#39;t mix. <code>sequence [length.fst,length.snd] ([1,2], [&#39;a&#39;,&#39;b&#39;])</code>"}], "answers": [{"comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543275275, "post_id": 53488358, "comment_id": 93851479, "body": "Which language extension do you use for this to work out..?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1543276175, "post_id": 53488358, "comment_id": 93851739, "body": "@Redu Should be <code>RankNTypes</code>, I&#39;m pretty sure."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1543331456, "post_id": 53488358, "comment_id": 93874520, "body": "<code>RankNTypes</code> is what I used.  Thank you both for catching that missing piece of my answer."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 10, "last_activity_date": 1543263255, "creation_date": 1543263255, "answer_id": 53488358, "question_id": 53487566, "link": "https://stackoverflow.com/questions/53487566/using-haskell-addition-function-with-both-num-and-char-values/53488358#53488358", "title": "Using Haskell addition function with both Num and Char values", "body": "<p>When inferring types from your code, GHC will assume that you intend <code>f</code> to have a relatively simple type, and intend <code>l1</code> and <code>l2</code> to have the same type, so that both are suitable as input to <code>f</code>.</p>\n\n<p>You apparently want to pass a polymorphic <code>f</code>, that can work on both <code>[Int]</code> and <code>[Char]</code>.  Depending how general you want to get, here are some options:</p>\n\n<p>Works on lists, <code>f</code> must work on any list regardless of element type:</p>\n\n<pre><code>sum0 :: (forall x. [x] -&gt; Int) -&gt; [a] -&gt; [b] -&gt; Int\nsum0 f l1 l2 = f l1 + f l2\n</code></pre>\n\n<p>Works on lists &amp; other <code>Foldable</code> types (Vector, Set, Matrix), as long as both inputs are the same <code>Foldable</code>.  The first argument can be <code>length</code>, or something specific to the choice of <code>Foldable</code>, like <code>Set.size</code>.</p>\n\n<pre><code>sum1 :: (Num n, Foldable f) =&gt; (forall x. f x -&gt; n) -&gt; f a -&gt; f b -&gt; n\nsum1 f l1 l2 = f l1 + f l2\n</code></pre>\n\n<p>Allow <code>l1</code> and <code>l2</code> to be <em>different</em> <code>Foldable</code> types.  <code>f</code> must work for <em>any</em> foldable.  <code>length</code> still qualifies, but <code>Set.size</code> isn't general enough.</p>\n\n<pre><code>sum2 :: (Num n, Foldable s, Foldable t) =&gt; (forall f x. Foldable f =&gt; f x -&gt; n) -&gt; s a -&gt; t b -&gt; n\nsum2 f l1 l2 = f l1 + f l2\n</code></pre>\n\n<p>In practice, with a function this small, I think it's easier just to write <code>length l1 + length l2</code> at each use site than to define a function with any of the complex types above.  But it's nice to know we can write these types when we want to.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1543263997, "last_edit_date": 1543263997, "creation_date": 1543263330, "answer_id": 53488373, "question_id": 53487566, "link": "https://stackoverflow.com/questions/53487566/using-haskell-addition-function-with-both-num-and-char-values/53488373#53488373", "title": "Using Haskell addition function with both Num and Char values", "body": "<p>One approach (somewhat <em>ad hoc</em>) would be to alter the list values:</p>\n\n<pre><code>&gt; sum length (map Right [1,2]) (map Left ['a', 'b'])\n4\n</code></pre>\n\n<p>Instead of arguments of type <code>[Char]</code> and <code>Num a =&gt; [a]</code>, we have arguments of the common type <code>Num b =&gt; [Either b Char]</code>. This satisfies the inferred constraint (imposed by the fact that <code>f</code> is applied to both <code>l1</code> and <code>l2</code>) that the second and third arguments have the same type.</p>\n\n<pre><code>&gt; :t sum\nsum :: Num a =&gt; (t -&gt; a) -&gt; t -&gt; t -&gt; a\n</code></pre>\n\n<p>In fact, because we know that <code>length</code> doesn't care about the contents of its argument, we could discard any information about what is in the lists and map the same function over both:</p>\n\n<pre><code>&gt; let foo = const () in sum length (map foo [1,2]) (map foo ['a', 'b'])\n4\n</code></pre>\n\n<p>Since <code>const ()</code> ignores its argument and returns <code>()</code>, you simply replace each list with a equally long list of <code>()</code>:</p>\n\n<pre><code>&gt; map (const ()) [1,2]\n[(),()]\n&gt; map (const ()) ['a','b']\n[(),()]\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 4887503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16fea0aa45d3a606279504a80a3e3159?s=128&d=identicon&r=PG&f=1", "display_name": "SuperM4n", "link": "https://stackoverflow.com/users/4887503/superm4n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 53488358, "answer_count": 2, "score": 10, "last_activity_date": 1543263997, "creation_date": 1543259476, "question_id": 53487566, "link": "https://stackoverflow.com/questions/53487566/using-haskell-addition-function-with-both-num-and-char-values", "title": "Using Haskell addition function with both Num and Char values", "body": "<p>I have a problem with the following function</p>\n\n<pre><code>sum f l1 l2 = (f l1) + (f l2)\n</code></pre>\n\n<p>It doesn't work with <code>sum length [1,2] ['a','b']</code>. When I try this I get </p>\n\n<pre><code>No instance for (Num Char) arising from the literal \u20181\u2019 \n</code></pre>\n\n<p>error so the problem is with types. When I try <code>:t</code> function, I get <code>sum :: Num a =&gt; (t -&gt; a) -&gt; t -&gt; t -&gt; a</code>. So, if I understand this correctly, I can't just use <code>+</code> function with both numerical and character values at the same time but I lack the deeper understanding of why exactly is this the case and how to fix it.</p>\n\n<p>I tried a couple of things, like using <code>let</code> for one of the literals or <code>id</code> function, but this doesn't seem to work. Any help?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543248750, "post_id": 53485007, "comment_id": 93839738, "body": "You&#39;re calling <code>checkBoolean&#39;</code> in your code, but it isn&#39;t defined."}, {"owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543248917, "post_id": 53485007, "comment_id": 93839832, "body": "@Jorge Adriano edited"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543249126, "post_id": 53485007, "comment_id": 93839935, "body": "Currently <code>checkBoolean []</code> fails. Is that how it is supposed to behave?"}, {"owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543249346, "post_id": 53485007, "comment_id": 93840045, "body": "@ Jorge Adriano I didn&#39;t intend to pass <code>[]</code> to my function thats why I didn&#39;t write that. But I think I will go with answer bellow for now"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1543256591, "post_id": 53485007, "comment_id": 93843490, "body": "No need for creating a new data structure, why not just use <code>Maybe Bool</code>? This handles all 3 cases."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1543273258, "post_id": 53485007, "comment_id": 93850846, "body": "FYI: <code>all</code> handles <code>[ ]</code>. all (==True) [ ]` is <code>True</code>, <code>all (==False)</code> is <code>True</code>, <code>all (==True) [True]</code> is <code>True</code>. <code>all (==False) [True,False]</code> is <code>False</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 2, "creation_date": 1543249345, "post_id": 53485080, "comment_id": 93840044, "body": "Simple true, but surely in this kind of educational exercise he should try doing it with a single traversal."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 2, "creation_date": 1543249577, "post_id": 53485080, "comment_id": 93840165, "body": "It is worth discussing the use of <code>(== True)</code> and <code>(== False)</code>. While they are correct, they are unusual and it might be more expected or common to see <code>id</code> and <code>not</code> instead."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1543249639, "post_id": 53485080, "comment_id": 93840202, "body": "@DietrichEpp If you look at the edit history, you&#39;ll see that that&#39;s how the first version looked. I thought that the more explicit one would be a bit more readable for a beginner. In principle I agree that <code>== True</code> is a code smell."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1543249707, "post_id": 53485080, "comment_id": 93840240, "body": "@JorgeAdriano I am not sure about the &quot;surely&quot; part. I don&#39;t know what&#39;s the goal of the exercise, and I&#39;d probably write it in such a way was this my actual code."}, {"owner": {"reputation": 4376, "user_id": 1109583, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VsfzL.jpg?s=128&g=1", "display_name": "lambda.xy.x", "link": "https://stackoverflow.com/users/1109583/lambda-xy-x"}, "edited": false, "score": 0, "creation_date": 1543249993, "post_id": 53485080, "comment_id": 93840394, "body": "Shouldn&#39;t there be a case for the empty list? I wouldn&#39;t expect <code>checkBoolean [] = Just_True</code> to hold."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 4376, "user_id": 1109583, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VsfzL.jpg?s=128&g=1", "display_name": "lambda.xy.x", "link": "https://stackoverflow.com/users/1109583/lambda-xy-x"}, "edited": false, "score": 0, "creation_date": 1543250147, "post_id": 53485080, "comment_id": 93840486, "body": "@lambda.xy.x Hard to tell without asking OP, I suppose. Really depends on where this thing is supposed to be used, but I can mention it."}, {"owner": {"reputation": 4376, "user_id": 1109583, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VsfzL.jpg?s=128&g=1", "display_name": "lambda.xy.x", "link": "https://stackoverflow.com/users/1109583/lambda-xy-x"}, "edited": false, "score": 0, "creation_date": 1543250319, "post_id": 53485080, "comment_id": 93840579, "body": "Well, <code>all f []</code> is true for any f, so why not output <code>Just_False</code> instead?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1543252631, "post_id": 53485080, "comment_id": 93841767, "body": "What is the function supposed to do if the list is empty?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1543252737, "post_id": 53485080, "comment_id": 93841810, "body": "<code>all (== True)</code> same as <code>all id</code> same as <code>and</code>."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543273393, "post_id": 53485080, "comment_id": 93850897, "body": "@BartekBanachewicz I guess you&#39;re right. And indeed this short, very readable, and <code>all</code> is even in the Prelude, it is  a pretty neat solution."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 11, "last_activity_date": 1543841895, "last_edit_date": 1543841895, "creation_date": 1543248783, "answer_id": 53485080, "question_id": 53485007, "link": "https://stackoverflow.com/questions/53485007/checking-if-all-bolean-elements-in-a-list-are-the-same-in-haskell/53485080#53485080", "title": "Checking if all bolean elements in a list are the same in Haskell", "body": "<p>Oh wow, you kinda overcomplicated it.</p>\n\n<p>There's a very useful function called <a href=\"http://zvon.org/other/haskell/Outputprelude/all_f.html\" rel=\"noreferrer\"><code>all</code></a>:</p>\n\n<pre><code>all :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>It checks all elements for a predicate, which for booleans could be just a pair of <code>id</code> and <code>not</code> functions, but you can also explicitly check equality to a value, which makes for pretty readable code:</p>\n\n<pre><code>checkBoolean xs = \n    if all (== True) xs then Just_True\n    else if all (== False) xs then Just_False\n    else Both\n</code></pre>\n\n<p>It's probably also a good idea to be somewhat more explicit about the empty list (<code>[]</code>) case. Should it be <code>Just_True</code>, <code>Just_False</code>, <code>Both</code>, or perhaps another value altogether?</p>\n"}, {"tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": false, "score": 10, "last_activity_date": 1543249993, "last_edit_date": 1543249993, "creation_date": 1543249421, "answer_id": 53485236, "question_id": 53485007, "link": "https://stackoverflow.com/questions/53485007/checking-if-all-bolean-elements-in-a-list-are-the-same-in-haskell/53485236#53485236", "title": "Checking if all bolean elements in a list are the same in Haskell", "body": "<p>The functions <code>all</code> or <code>any</code> come to mind first:</p>\n\n<pre><code>any :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool\nall :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool\n</code></pre>\n\n<p>If we specialize for lists, we replace <code>t</code> with <code>[]</code>, which makes this looks like:</p>\n\n<pre><code>any :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>We can compare all of the elements to the first element to see if the list contains all the same value. If any elements are different, then we know that the list is mixed.</p>\n\n<pre><code>checkBoolean (x:xs)\n      -- Check if any elements are not equal to the first one.\n    | any (/= x) xs = Both\n    | x             = Just_True\n    | otherwise     = Just_False\n</code></pre>\n\n<p>We might want to handle the degenerate case as well:</p>\n\n<pre><code>-- \"Just_True\" is arbitrary... you could say \"Just_False\", too.\ncheckBoolean [] = Just_True\n</code></pre>\n\n<p>It is worth noting that as an exercise, you find it valuable to write the function recursively, without the use of higher-order functions like <code>all</code> or <code>any</code>, even though they are in the prelude. Here is an alternative, tail-recursive implementation:</p>\n\n<pre><code>checkBoolean [] = Just_True\ncheckBoolean (x:xs) = check xs\n  where\n    check [] = if x\n               then Just_True\n               else Just_False\n    check (y:ys) = if x == y\n                   then check ys\n                   else Both\n</code></pre>\n\n<p>I would not expect to see this longer version in actual project code.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543264973, "post_id": 53485331, "comment_id": 93847343, "body": "You may still traverse part of the list twice."}, {"owner": {"reputation": 4376, "user_id": 1109583, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VsfzL.jpg?s=128&g=1", "display_name": "lambda.xy.x", "link": "https://stackoverflow.com/users/1109583/lambda-xy-x"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543271205, "post_id": 53485331, "comment_id": 93850075, "body": "The first element of xs is either True or False, so one of the <code>elem</code>s terminates after one step. The other <code>elem</code> terminates at most after <code>length xs</code> steps (in case the list is uniform). @chepner&#39;s solution even needs to look at one element less."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543273098, "post_id": 53485331, "comment_id": 93850802, "body": "True. But you still retain the list longer than necessary."}, {"owner": {"reputation": 4376, "user_id": 1109583, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VsfzL.jpg?s=128&g=1", "display_name": "lambda.xy.x", "link": "https://stackoverflow.com/users/1109583/lambda-xy-x"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543273539, "post_id": 53485331, "comment_id": 93850951, "body": "In what way longer than necessary? Do you have an example in mind where the traversal could terminate earlier?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543273947, "post_id": 53485331, "comment_id": 93851079, "body": "If there are only <code>False</code> values and the <code>elem True xs</code> test is performed first, then the whole list/stream will be retained until the end, in case the other test is required."}], "tags": [], "owner": {"reputation": 4376, "user_id": 1109583, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VsfzL.jpg?s=128&g=1", "display_name": "lambda.xy.x", "link": "https://stackoverflow.com/users/1109583/lambda-xy-x"}, "is_accepted": false, "score": 2, "last_activity_date": 1543249802, "creation_date": 1543249802, "answer_id": 53485331, "question_id": 53485007, "link": "https://stackoverflow.com/questions/53485007/checking-if-all-bolean-elements-in-a-list-are-the-same-in-haskell/53485331#53485331", "title": "Checking if all bolean elements in a list are the same in Haskell", "body": "<p>The pattern matching can probably integrated into <code>checkBoolean</code> but the main observation is that we don't need check all elements twice: we check for membership of True and False anyway, so from <code>not (elem True xs)</code> we can conclude that the list is either empty or only contains False. For that I'll extend Answer3 by the <code>None</code> case.</p>\n\n<pre><code>data Answer3 = Just_True | Just_False | Both | None deriving (Eq, Ord, Show)\n\ncat True  True  = Both\ncat True  False = Just_True\ncat False True  = Just_False\ncat False False = None\n\ncheckBoolean xs = cat (elem True xs) (elem False xs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543265037, "post_id": 53485737, "comment_id": 93847384, "body": "This retains memory unnecessarily."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 3, "last_activity_date": 1543253330, "last_edit_date": 1543253330, "creation_date": 1543251317, "answer_id": 53485737, "question_id": 53485007, "link": "https://stackoverflow.com/questions/53485007/checking-if-all-bolean-elements-in-a-list-are-the-same-in-haskell/53485737#53485737", "title": "Checking if all bolean elements in a list are the same in Haskell", "body": "<p>If you want to use the pre-available functions on lists, you should consider, </p>\n\n<pre><code>partition :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])  \n</code></pre>\n\n<p>available in <code>Data.List</code>. Using this function you can partition your list into a pair <code>(ts,fs)</code> where <code>ts</code> and <code>fs</code> are respectively the list with all the <code>True</code> and all the <code>False</code> elements of the original list. Then you just have to check if neither is empty, or if only one of them is and which. You can also decide what to return in the case where both are empty. </p>\n\n<p>Note that with this implementation, the traversal of the list stops as soon as both a <code>True</code> and a <code>False</code> element are found. Because that's enough to know neither list in the partition pair is empty. This is a desirable property for a solution of this problem, i.e. once you have gathered enough information to know the answer, you should stop and return the result.  </p>\n\n<hr>\n\n<p>At this point though, considering your own attempt at solving the problem, I'd suggest you should perhaps be focusing on building your own recursive solution. </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543265176, "post_id": 53486090, "comment_id": 93847445, "body": "I&#39;m not a fan of this, because it&#39;s not tail recursive. The <code>&lt;&gt;</code> operations will stack up."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543265988, "post_id": 53486090, "comment_id": 93847830, "body": "One could use one of the various strict folds instead of <code>foldMap</code>, e.g. <code>foldl&#39; (&lt;&gt;) mempty . map lift</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1543255432, "last_edit_date": 1543255432, "creation_date": 1543252808, "answer_id": 53486090, "question_id": 53485007, "link": "https://stackoverflow.com/questions/53485007/checking-if-all-bolean-elements-in-a-list-are-the-same-in-haskell/53486090#53486090", "title": "Checking if all bolean elements in a list are the same in Haskell", "body": "<p>You're missing a case to handle empty lists:</p>\n\n<pre><code>-- checkBoolean [] = Neither\ndata Answer4 = Just_True | Just_False | Both | Neither\n</code></pre>\n\n<p><code>Answer4</code> has a simple, if long-winded, <code>Semigroup</code> instance. </p>\n\n<pre><code>instance Semigroup Answer4 where\n    -- like combines with like\n    Just_True &lt;&gt; Just_True = Just_True\n    Just_False &lt;&gt; Just_False = Just_False\n    -- Neither is \"like\" anything\n    x &lt;&gt; Neither = x\n    Neither &lt;&gt; x  = x\n    -- otherwise, you get Both\n    _ &lt;&gt; _ = Both\n</code></pre>\n\n<p>and a simple <code>Monoid</code> instance:</p>\n\n<pre><code>instance Monoid Answer4 where\n    mempty = Neither\n</code></pre>\n\n<p>Now, if you have a way of converting a <code>Bool</code> to an <code>Answer4</code></p>\n\n<pre><code>lift :: Bool -&gt; Answer4\nlift True = Just_True\nlift False = Just_False\n</code></pre>\n\n<p>you can reduce a list of <code>Bool</code> to a single <code>Answer4</code> value quickly:</p>\n\n<pre><code>-- foldMap :: (Foldable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m\n-- Here, t ~ [], a ~= Bool, and  m ~ Answer4, for a specialized type\n-- foldMap :: (Bool -&gt; Answer4) -&gt; [Bool] -&gt; Answer4\ncheckBoolean :: [Bool] -&gt; Answer4\ncheckBoolean = foldMap lift\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543282121, "post_id": 53486837, "comment_id": 93853072, "body": "@dfeuer, not really.  Since the first element is either <code>True</code> or <code>False</code>, one of the traversal will surely exit after the first element.  The worst case is all <code>True</code> or all <code>False</code> for which full traversal is required (but only once!)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543283761, "post_id": 53486837, "comment_id": 93853344, "body": "you&#39;re right that only one traversal will complete. But barring an extremely unlikely Haskell evaluation strategy, one of them will be chosen to run first. This means that under unfavorable circumstances, the entire list will be retained in memory so that the second one (sure to terminate immediately) can be run."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543285411, "post_id": 53486837, "comment_id": 93853688, "body": "so, it&#39;s a memory issue, or more precisely delays GC."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543285746, "post_id": 53486837, "comment_id": 93853782, "body": "yes. I initially thought it was more, but that&#39;s what it is."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1543256032, "creation_date": 1543256032, "answer_id": 53486837, "question_id": 53485007, "link": "https://stackoverflow.com/questions/53485007/checking-if-all-bolean-elements-in-a-list-are-the-same-in-haskell/53486837#53486837", "title": "Checking if all bolean elements in a list are the same in Haskell", "body": "<p>perhaps easier this way</p>\n\n<pre><code>checkBoolean xs | and xs        = Just_True\n                | (not . or) xs = Just_False\n                | otherwise     = Both\n</code></pre>\n"}], "owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4372, "favorite_count": 0, "accepted_answer_id": 53485080, "answer_count": 6, "score": 9, "last_activity_date": 1543841895, "creation_date": 1543248522, "last_edit_date": 1543248899, "question_id": 53485007, "link": "https://stackoverflow.com/questions/53485007/checking-if-all-bolean-elements-in-a-list-are-the-same-in-haskell", "title": "Checking if all bolean elements in a list are the same in Haskell", "body": "<p>I wanna check if boolean elements in a list are all True, all False, or both True and False. Here is my code for now: </p>\n\n<pre><code>data Answer3 = Just_True | Just_False | Both deriving (Eq, Ord, Show)\ntype A3 = Answer3\n\n\ncheckBoolean :: [Bool] -&gt; A3\ncheckBoolean (x:x1:xs) = if (length (x:x1:xs) `mod` 2) == 0  \n                            then if (x &amp;&amp; x1) &amp;&amp; checkBoolean'(x1:xs)== True\n                                     then Just_True\n                                     else if (x &amp;&amp; x1) == True\n                                             then Both\n                                             else if checkBoolean'(xs)== True\n                                                     then Both\n                                                     else Just_False\n\n\n                            else if x &amp;&amp; checkBoolean'(x1:xs) == True\n                                    then Just_True\n                                    else if x == False\n                                            then Just_False\n                                            else Both \n\ncheckBoolean':: [Bool] -&gt; Bool\ncheckBoolean' (x:xs) = x &amp;&amp; (checkBoolean'(xs))\ncheckBoolean' [] = True\n</code></pre>\n\n<p>Calling </p>\n\n<pre><code>*Main&gt; checkBoolean [False, False, False]\nJust_False\n</code></pre>\n\n<p>or </p>\n\n<pre><code>*Main&gt; checkBoolean [True, True, True]\nJust_True\n</code></pre>\n\n<p>or </p>\n\n<pre><code>*Main&gt; checkBoolean [True, False, False]\nBoth\n</code></pre>\n\n<p>gives correct result. But</p>\n\n<pre><code>*Main&gt; checkBoolean [False, False, True, False, True]\nJust_False\n</code></pre>\n\n<p>and </p>\n\n<pre><code>*Main&gt; checkBoolean [False, False, True]\nJust_False\n</code></pre>\n\n<p>do not work as I intended. <code>[False, False, True, False, True]</code> is Both, and  <code>[False, False, True]</code> is also Both</p>\n\n<p>I know I didn't think all possible cases and thats why this doesn't work, but is there an efficient way to write this without writing this much if else statements? </p>\n"}, {"tags": ["python", "python-3.x", "haskell"], "comments": [{"owner": {"reputation": 46136, "user_id": 3890632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hNkgF.png?s=128&g=1", "display_name": "khelwood", "link": "https://stackoverflow.com/users/3890632/khelwood"}, "edited": false, "score": 1, "creation_date": 1543233008, "post_id": 53480463, "comment_id": 93830618, "body": "<code>_</code> will give you the result of the last line evaluated (that wasn&#39;t <code>None</code>), in case that helps."}], "answers": [{"tags": [], "owner": {"reputation": 46136, "user_id": 3890632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hNkgF.png?s=128&g=1", "display_name": "khelwood", "link": "https://stackoverflow.com/users/3890632/khelwood"}, "is_accepted": true, "score": 4, "last_activity_date": 1543233245, "creation_date": 1543233245, "answer_id": 53480567, "question_id": 53480463, "link": "https://stackoverflow.com/questions/53480463/is-there-any-python-equivalent-of-haskells-it-to-get-last-successful-comman/53480567#53480567", "title": "Is there any python equivalent of haskell&#39;s &quot;it&quot; , to get last successful command in REPL", "body": "<p><code>_</code> will give you the result of the last line evaluated (that wasn't <code>None</code>).</p>\n\n<pre><code>Python 3.7.1 (default, Nov  8 2018, 09:08:57)\n[Clang 9.0.0 (clang-900.0.39.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; 2+5\n7\n&gt;&gt;&gt; _\n7\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 4564096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7079585cea082f042c85cd9d2c2385cf?s=128&d=identicon&r=PG&f=1", "display_name": "lightyagami1", "link": "https://stackoverflow.com/users/4564096/lightyagami1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 2, "closed_date": 1543233541, "accepted_answer_id": 53480567, "answer_count": 1, "score": -1, "last_activity_date": 1543233245, "creation_date": 1543232910, "question_id": 53480463, "link": "https://stackoverflow.com/questions/53480463/is-there-any-python-equivalent-of-haskells-it-to-get-last-successful-comman", "closed_reason": "Duplicate", "title": "Is there any python equivalent of haskell&#39;s &quot;it&quot; , to get last successful command in REPL", "body": "<p>In haskell ghci, \"it\" means last successful command, which can be used in next command arbitrarily as per need. Is some thing like this exist in python, not asking for history (reverse-i-search) </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1543229247, "post_id": 53479379, "comment_id": 93828687, "body": "The average of which list are you trying to find? Do you maybe want <code>average</code> to be a function, not a <code>Float</code>?"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1543229375, "post_id": 53479379, "comment_id": 93828744, "body": "firstly: <code>average</code> is not a <code>Float</code>. It is a function <code>[Int] -&gt; Float</code>. Also, you should explictly convert your <code>Int</code>s into <code>Float</code> when applying <code>(&#47;)</code>"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543242695, "post_id": 53479379, "comment_id": 93836293, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/2376981/haskell-types-frustrating-a-simple-average-function\">Haskell types frustrating a simple &#39;average&#39; function</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 4, "last_activity_date": 1544882845, "last_edit_date": 1544882845, "creation_date": 1543231449, "answer_id": 53480082, "question_id": 53479379, "link": "https://stackoverflow.com/questions/53479379/haskell-type-errors-with-division/53480082#53480082", "title": "Haskell Type Errors with division", "body": "<p>Summary: Haskell is a strongly typed language. </p>\n\n<p>You force the type of <code>sumlen</code> to be <code>[Int] -&gt; (Int,Int)</code>.</p>\n\n<p>The type of <code>(/)</code> is <code>Fractional a =&gt; a -&gt; a -&gt; a</code>.</p>\n\n<p>Let us typecheck your function. First we will try to infer its type:</p>\n\n<pre><code>average = (uncurry (/)) . sumlen \nuncurry :: (a -&gt; b -&gt; c) -&gt; (a,b) -&gt; c\n(/) :: Fractional d =&gt; d -&gt; d -&gt; d\n(.) :: (f -&gt; g) -&gt; (e -&gt; f) -&gt; e -&gt; g\nsumlen :: [Int] -&gt; (Int,Int)\nSo:\ne = [Int]\nf = (Int,Int) = (a,b) = (d,d)\ng = d = Int\naverage :: Fractional Int =&gt; [Int] -&gt; Int\n</code></pre>\n\n<p>Now you tell Haskell that <code>average :: Float</code> and Haskell tells you that a float is not a function. This is your error.</p>\n\n<p>If you remove the annotation then you will be told that there is no instance <code>Fractional Int</code>. This is because you can\u2019t represent or reasonably approximate <code>1 / 2</code> as an <code>Int</code>.</p>\n\n<p>How to fix this?</p>\n\n<p>Step 0 is to not write down a type signature that is wrong (ie <code>average :: Float</code>)</p>\n\n<p>One thing you could do is have a more general sumlen. Try <code>Num a =&gt; [a] -&gt; (a,a)</code> instead. You could even have <code>(Num a, Num b) =&gt; [a] -&gt; (a,b)</code>. Then you can have the sensible type <code>average :: Fractional a =&gt; [a] -&gt; a</code></p>\n\n<p>Another thing you could do is convert from integers:</p>\n\n<pre><code>average xs = fromIntegral s / fromIntegral l where\n  (s,l) = sumlen xs\n</code></pre>\n"}], "owner": {"reputation": 763, "user_id": 6419581, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7tmJu.png?s=128&g=1", "display_name": "Gakuo", "link": "https://stackoverflow.com/users/6419581/gakuo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 53480082, "answer_count": 1, "score": -1, "last_activity_date": 1544882845, "creation_date": 1543228997, "question_id": 53479379, "link": "https://stackoverflow.com/questions/53479379/haskell-type-errors-with-division", "title": "Haskell Type Errors with division", "body": "<p>I have the below simple program to find the average of a list. I know my error is related to the inference of types but I cannot correct it. Can I get a correction and a simple explanation for this? </p>\n\n<pre><code>average :: Float\naverage= uncurry (/) . sumlen\n\nsumlen ::[Int]-&gt; (Int,Int)\nsumlen = foldl f (0,0)\n         where f (s,n) x = (s+x,n+1)\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>  \u2022 Couldn't match expected type \u2018Float\u2019\n                      with actual type \u2018[Int] -&gt; Int\u2019\n   \u2022 Probable cause: \u2018(.)\u2019 is applied to too few arguments\n          In the expression: uncurry (/) . sumlen\n          In an equation for \u2018average\u2019: average = uncurry (/) . sumlen\n</code></pre>\n"}, {"tags": ["json", "haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 4, "last_activity_date": 1543247577, "last_edit_date": 1543247577, "creation_date": 1543228041, "answer_id": 53479116, "question_id": 53478455, "link": "https://stackoverflow.com/questions/53478455/aeson-parse-json-object-to-list/53479116#53479116", "title": "Aeson: Parse json object to list", "body": "<p><code>mapM parseJSON (elems o)</code> returns <code>Parser [Int]</code>, but you need <code>Parser (Test [Int])</code>, so the correct way to do that is:</p>\n\n<pre><code>instance FromJSON Test where\n    parseJSON (Object o) = Test &lt;$&gt; mapM parseJSON (elems o)\n</code></pre>\n\n<p>However, the type of argument of <code>parseJSON</code> is <code>Value</code>, the value of argument may not be <code>Object</code>, it can also be an <code>Array</code>, <code>String</code> or etc, so it is better to use <code>withObject</code> to check what is it as:</p>\n\n<pre><code>instance FromJSON Test where\n    parseJSON val = withObject \"Test\" \n                               (\\o -&gt; Test &lt;$&gt; mapM parseJSON (elems o))\n                               val\n</code></pre>\n\n<p><code>withObject</code> will print a meaningful error message when the value of type <code>Value</code> is not <code>Object</code>.</p>\n"}], "owner": {"reputation": 441, "user_id": 7569156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/983f040d03fd94ecddde895bf0968835?s=128&d=identicon&r=PG&f=1", "display_name": "Marius Melzer", "link": "https://stackoverflow.com/users/7569156/marius-melzer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 53479116, "answer_count": 1, "score": 1, "last_activity_date": 1543247577, "creation_date": 1543225817, "question_id": 53478455, "link": "https://stackoverflow.com/questions/53478455/aeson-parse-json-object-to-list", "title": "Aeson: Parse json object to list", "body": "<p>I would like to parse the values of a json object to a list.</p>\n\n<p>Here's my current approach (simplified and the newtype is based on the results of: <a href=\"https://stackoverflow.com/questions/53448958/aeson-derive-some-but-not-all-fields-of-a-struct\">Aeson: derive some (but not all) fields of a struct</a> (means I need it)):</p>\n\n<p>Json:</p>\n\n<pre><code>{\"v1\": 1, \"v2\": 2}\n</code></pre>\n\n<p>Wanted result:</p>\n\n<pre><code>Test [1,2]\n</code></pre>\n\n<p>Current approach:</p>\n\n<pre><code>import Data.Aeson\nimport Data.HashMap.Strict (elems)\n\nnewtype Test = Test [Int]\ninstance FromJSON Test where\n  parseJSON (Object o) =\n    mapM parseJSON (elems o)\n</code></pre>\n\n<p>Compilation error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018[b0]\u2019 with \u2018Test\u2019\n  Expected type: aeson-1.1.2.0:Data.Aeson.Types.Internal.Parser Test\n    Actual type: aeson-1.1.2.0:Data.Aeson.Types.Internal.Parser [b0]\n\u2022 In the expression: mapM parseJSON (elems o)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543226145, "post_id": 53478138, "comment_id": 93826941, "body": "I can&#39;t provide a detailed answer, but INIT and EXIT measure costs for the Haskell runtime system initialization/shutdown. GC measures the cost of garbage collection. MUT stands for &quot;mutator&quot;, and is the cost for actually running your program. In memory management algorithms, the standard terminology is indeed &quot;collector&quot; vs &quot;mutator&quot;. So, for your program we can see a minimal runtime system overhead, most of the work is done by the program itself."}], "answers": [{"comments": [{"owner": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "edited": false, "score": 0, "creation_date": 1543238463, "post_id": 53479701, "comment_id": 93833578, "body": "Thank you for your response. Do you have any information on what <code>TASKS</code> mean?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "edited": false, "score": 0, "creation_date": 1543238945, "post_id": 53479701, "comment_id": 93833895, "body": "@TheHoff Hmm, doesn&#39;t appear to be documented... OOC, which version of GHC are you running? Currently my best <i>guess</i> is that &quot;tasks&quot; are actually <i>threads</i>... but that&#39;s only a guess."}, {"owner": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "edited": false, "score": 0, "creation_date": 1543240312, "post_id": 53479701, "comment_id": 93834773, "body": "ghc version 8.0.2"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1543230042, "creation_date": 1543230042, "answer_id": 53479701, "question_id": 53478138, "link": "https://stackoverflow.com/questions/53478138/how-to-interpret-haskell-rts-s-summary-output/53479701#53479701", "title": "How to interpret Haskell +RTS -s summary output", "body": "<p>Have you looked at the GHC user manual?</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html#rts-options-to-produce-runtime-statistics\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html#rts-options-to-produce-runtime-statistics</a></p>\n\n<blockquote>\n  <p>[...] Next there is the CPU time and wall clock time elapsed broken down by what the runtime system was doing at the time. INIT is the runtime system initialisation. MUT is the mutator time, i.e. the time spent actually running your code. GC is the time spent doing garbage collection. RP is the time spent doing retainer profiling. PROF is the time spent doing other profiling. EXIT is the runtime system shutdown time. And finally, Total is, of course, the total.</p>\n  \n  <p>%GC time tells you what percentage GC is of Total. \u201cAlloc rate\u201d tells you the \u201cbytes allocated in the heap\u201d divided by the MUT CPU time. \u201cProductivity\u201d tells you what percentage of the Total CPU and wall clock elapsed times are spent in the mutator (MUT).</p>\n</blockquote>\n\n<p>So INIT is how long it took to start up the GHC runtime system, EXIT is how long it took to shut it down, GC is how long the garbage collector ran for, and MUT is how long <em>your actual program</em> was doing useful work.</p>\n\n<p>The \"elapsed\" time is actual wall-clock time, whereas the first number is CPU time. (If you have, e.g., a 4-core CPU, CPU time might be quite a bit longer than wall time. Unsure how time spent waiting for I/O factors into this.)</p>\n\n<p>For some reason I can't seem to find a quote from the manual, but I believe \"productivity\" is the percentage of wall-time spent running your code (as opposed to running the garbage collector, waiting for I/O, etc).</p>\n"}], "owner": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 53479701, "answer_count": 1, "score": 2, "last_activity_date": 1543230042, "creation_date": 1543224692, "question_id": 53478138, "link": "https://stackoverflow.com/questions/53478138/how-to-interpret-haskell-rts-s-summary-output", "title": "How to interpret Haskell +RTS -s summary output", "body": "<p>I've been doing some performance tests on code and found the <code>+RTS -s</code> flag which shows a bunch of metrics on what the program did. But I haven't been able to find a full explanation of how to interpret the output.</p>\n\n<p>I've found some resources on sparks and explaining how they're tasks for the thread pool.</p>\n\n<p>What does <code>Tasks</code> mean?</p>\n\n<p>How do I read the table with <code>INIT</code>, <code>MUT</code> etc?</p>\n\n<p>What does <code>Productivity</code> mean in this context?</p>\n\n<pre><code>10:23:12 decision-tree-haskell $ stack exec -- performance-test +RTS -A200M -N -s\n   4,952,803,088 bytes allocated in the heap\n       5,277,992 bytes copied during GC\n       1,438,264 bytes maximum residency (2 sample(s))\n          70,552 bytes maximum slop\n             816 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0        22 colls,    22 par    0.036s   0.011s     0.0005s    0.0058s\n  Gen  1         2 colls,     1 par    0.004s   0.001s     0.0006s    0.0010s\n\n  Parallel GC work balance: 8.43% (serial 0%, perfect 100%)\n\n  TASKS: 10 (1 bound, 9 peak workers (9 total), using -N4)\n\n  SPARKS: 48 (48 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.009s  (  0.009s elapsed)\n  MUT     time    9.846s  (  9.895s elapsed)\n  GC      time    0.040s  (  0.013s elapsed)\n  EXIT    time    0.001s  (  0.000s elapsed)\n  Total   time    9.963s  (  9.916s elapsed)\n\n  Alloc rate    503,030,959 bytes per MUT second\n\n  Productivity  99.5% of total user, 99.8% of total elapsed\n\ngc_alloc_block_sync: 808\nwhitehole_spin: 0\ngen[0].sync: 9\ngen[1].sync: 0\n</code></pre>\n"}, {"tags": ["haskell", "c2hs"], "answers": [{"comments": [{"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "edited": false, "score": 0, "creation_date": 1543295589, "post_id": 53478436, "comment_id": 93855876, "body": "That is what I am doing. But I wonder if it may be done in some way? Since many C docs can be in online(html) or man page, some information for the pre-processor to grab the C doc and generate haddock. May be able to do?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1543225748, "creation_date": 1543225748, "answer_id": 53478436, "question_id": 53477658, "link": "https://stackoverflow.com/questions/53477658/what-is-the-proper-way-to-write-doc-for-bindings/53478436#53478436", "title": "What is the proper way to write doc for bindings?", "body": "<p>I don't know of any tool for that. Since C docs can take many forms, I don't think there is any tool.</p>\n\n<p>If the binding is indeed plain, essentially everything in <code>IO</code>, same names as the C library, etc. there is a very lazy option: provide a link to the C docs and refer to that.</p>\n\n<p>Better: if the C docs are online, and each function/variable/entity has its own link, provide a link for each entity. In such way, the Haskell programmer can find your docs in Hackage, as usual, and then it's just one more click away to the real docs.</p>\n\n<p>Of course, ideally one should copy the C docs, so that it's immediately available. However, this can require a lot of work, and some care in handling copyright correctly.</p>\n"}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1543225748, "creation_date": 1543222903, "question_id": 53477658, "link": "https://stackoverflow.com/questions/53477658/what-is-the-proper-way-to-write-doc-for-bindings", "title": "What is the proper way to write doc for bindings?", "body": "<p>While writing a Haskell binding for some libs written in C, a thing has to do is writing docs in haddock format. But since normally the binding is just plain, the doc would be just reformat of original libs' doc.</p>\n\n<p>So my question is, is there some tools to help with this? Thanks.</p>\n"}, {"tags": ["regex", "haskell", "text", "pcre"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1543215864, "post_id": 53476110, "comment_id": 93822343, "body": "Do you see an error? If so, what is it"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1543217856, "post_id": 53476110, "comment_id": 93823096, "body": "I&#39;ve run the program successfully using stack (<a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>) with ghc 8.4.4 and stackage 12.19. How are you trying to run the program?"}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1543226066, "post_id": 53476110, "comment_id": 93826894, "body": "ghc 8.0.2 Haskell Platform on Windows 7 64 bit. pcre-light compiled with help of msys2"}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1543226118, "post_id": 53476110, "comment_id": 93826921, "body": "I&#39;ll try to install new Haskell Platform and see..."}], "answers": [{"tags": [], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "is_accepted": true, "score": 0, "last_activity_date": 1544095028, "creation_date": 1544095028, "answer_id": 53650238, "question_id": 53476110, "link": "https://stackoverflow.com/questions/53476110/how-to-work-with-data-text-via-pcre-heavy/53650238#53650238", "title": "How to work with Data.Text via pcre-heavy", "body": "<p>After reinstalling Haskell Platform to recent version and adding <code>pcre</code> library to <code>msys2</code> and some experiments, I can say, that this sample works well (Haskell Platform on Windows-7 (64-bit) with ghc 8.4.3, <code>msys2</code> with <code>pcre.h</code> and <code>libpcre.a</code> added via <code>pacman</code>, and <a href=\"https://github.com/Daniel-Diaz/pcre-light/issues/7\" rel=\"nofollow noreferrer\">installed carefully <code>pcre-light</code> and <code>pcre-heavy</code></a>). On Debian Linux (64-bit) it works well, too, and without any tricks. Why I saw a previous error -- I have no idea, maybe, except problem with older version.</p>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 53650238, "answer_count": 1, "score": 0, "last_activity_date": 1544095028, "creation_date": 1543215702, "last_edit_date": 1543220605, "question_id": 53476110, "link": "https://stackoverflow.com/questions/53476110/how-to-work-with-data-text-via-pcre-heavy", "title": "How to work with Data.Text via pcre-heavy", "body": "<p>I need a simple example to work with <code>Data.Text</code> via prce-heavy. My example is not working, why?</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, QuasiQuotes, FlexibleContexts #-}\n\nimport Data.Text\nimport Text.Regex.PCRE.Heavy\nimport qualified Data.Text.IO as TIO\n\nmain = do\n    let text = \"xxx@yahoo.com\" :: Text\n    let \n      text2 :: Text\n      text2 = gsub ([re|xxx|]) (\"yyy\" :: Text) text\n    TIO.putStrLn text2\n</code></pre>\n\n<p>But the same code with <code>String</code> work well:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, FlexibleContexts #-}\n\nimport Text.Regex.PCRE.Heavy\n\nmain = do\n    let text = \"xxx@yahoo.com\" :: String\n    let \n      text2 :: String\n      text2 = gsub ([re|xxx|]) (\"yyy\" :: String) text\n    putStrLn text2\n</code></pre>\n\n<hr>\n\n<p>Errror for 1st sampe:</p>\n\n<pre><code>textproblem.hs:11:15: error:\n    * No instance for (Data.String.Conversions.ConvertibleStrings\n                         Data.String.Conversions.SBS Text)\n        arising from a use of `gsub'\n    * In the expression:\n        gsub\n          ((Text.Regex.PCRE.Light.compile\n              (Data.String.Conversions.cs (\"xxx\" :: String))\n              [read \"PCREOption {unPCREOption = 2048}\" :: PCREOption]))\n          (\"yyy\" :: Text)\n          text\n      In an equation for `text2':\n          text2\n            = gsub\n                ((Text.Regex.PCRE.Light.compile\n                    (Data.String.Conversions.cs (\"xxx\" :: String))\n                    [read \"PCREOption {unPCREOption = 2048}\" :: PCREOption]))\n                (\"yyy\" :: Text)\n                text\n      In the expression:\n        do { let text = ...;\n             let text2 :: Text\n                 text2\n                   = gsub\n                       ((Text.Regex.PCRE.Light.compile\n                           (Data.String.Conversions.cs (...)) ...))\n                       (\"yyy\" :: Text)\n                       text;\n             TIO.putStrLn text2 }\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "fold"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1543214526, "post_id": 53475772, "comment_id": 93821856, "body": "Try using the foldr-based version on an infinite list. Did you have to wait infinite time.for the result? If not, this version doesn&#39;t traverse the entire list."}], "answers": [{"comments": [{"owner": {"reputation": 3051, "user_id": 499206, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1029df625f01f748fcad72987c1d0b4a?s=128&d=identicon&r=PG", "display_name": "wh1t3cat1k", "link": "https://stackoverflow.com/users/499206/wh1t3cat1k"}, "edited": false, "score": 0, "creation_date": 1543214644, "post_id": 53475807, "comment_id": 93821898, "body": "@sepp2k Eventually I understood what you mean, thank you! Would you mind adding an example though? I am sure it will be useful for future readers."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 4, "last_activity_date": 1543215553, "last_edit_date": 1543215553, "creation_date": 1543213988, "answer_id": 53475807, "question_id": 53475772, "link": "https://stackoverflow.com/questions/53475772/recursion-vs-fold-efficiency/53475807#53475807", "title": "Recursion vs fold efficiency", "body": "<ol>\n<li>No, when the function <code>\\(k,v) acc -&gt; ...</code> is called by <code>foldr</code>, the recursive call to <code>foldr</code> is supplied as the second argument (i.e. <code>acc</code>). So, keeping in mind that Haskell is lazy, if <code>acc</code> isn't used (i.e. if the <code>if</code> condition is true), the recursive call does not happen and the traversal stops.</li>\n<li>Both work fine with infinite lists.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1547092355, "post_id": 53475924, "comment_id": 95075419, "body": "<code>foldr</code> with <code>-O2</code> often ends up being more performant than doing the same thing with manual recursion thanks to <code>fold&#47;build</code> fusion."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1543214584, "creation_date": 1543214584, "answer_id": 53475924, "question_id": 53475772, "link": "https://stackoverflow.com/questions/53475772/recursion-vs-fold-efficiency/53475924#53475924", "title": "Recursion vs fold efficiency", "body": "<p><code>foldr</code> is defined such that</p>\n\n<pre><code>foldr cons z (x:xs) = cons x (foldr cons z xs)\n</code></pre>\n\n<p>so if <code>cons</code> doesn't use its second argument, its value isn't needed. Since Haskell is call-by-need, unneeded values are not evaluated.</p>\n\n<p>So no, both formulations have the same laziness characteristics. </p>\n\n<pre><code>findKey key (x:xs)\n  = foldr (\\(k,v) r -&gt; if key == k then Just v else r) Nothing (x:xs)\n  = (\\(k,v) r -&gt; if key == k then Just v else r) x\n      (foldr (\\(k,v) r -&gt; if key == k then Just v else r) Nothing xs)\n  = case x of (k,v) -&gt; if key == k then Just v else \n      (foldr (\\(k,v) r -&gt; if key == k then Just v else r) Nothing xs)\n</code></pre>\n\n<p>and so if <code>key == k</code> holds, the recursive call (to find out the <code>r</code>'s value) isn't triggered.</p>\n"}], "owner": {"reputation": 3051, "user_id": 499206, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1029df625f01f748fcad72987c1d0b4a?s=128&d=identicon&r=PG", "display_name": "wh1t3cat1k", "link": "https://stackoverflow.com/users/499206/wh1t3cat1k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 53475924, "answer_count": 2, "score": 4, "last_activity_date": 1543215553, "creation_date": 1543213772, "question_id": 53475772, "link": "https://stackoverflow.com/questions/53475772/recursion-vs-fold-efficiency", "title": "Recursion vs fold efficiency", "body": "<p>In the well-known <a href=\"http://learnyouahaskell.com/modules\" rel=\"nofollow noreferrer\">Haskell tutorial</a>, the function that finds a value-by-key in an associative list is first defined like that:</p>\n\n<pre><code>findKey :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v  \nfindKey key [] = Nothing  \nfindKey key ((k,v):xs) = if key == k  \n                            then Just v  \n                            else findKey key xs\n</code></pre>\n\n<p>However, the author then argues that this type of \"textbook recursion\" should better be implemented using a fold:</p>\n\n<pre><code>findKey key = foldr (\\(k,v) acc -&gt; if key == k then Just v else acc) Nothing  \n</code></pre>\n\n<p>I found that confusing. Am I right that:</p>\n\n<ol>\n<li>The <code>foldr</code>-based function will always traverse the whole list before producing a result, whereas the first one will immediately stop upon discovery?</li>\n<li>As a consequence, the first function will work on an infinite list, whereas the second one won't?</li>\n</ol>\n\n<p>It seems to me that the <em>really</em> equivalent definition would use a <code>scanr</code> instead and from that, take the first result that isn't <code>Nothing</code>. (?)</p>\n"}, {"tags": ["arrays", "haskell", "vector", "repa"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543229209, "post_id": 53473751, "comment_id": 93828667, "body": "<code>numpy&#39;s v[x1:x2,y1:y2]</code> means to get the elements of index (1,1), (1,2), (2,1), (2,2) and return the result as 2 x 2 metrix?"}, {"owner": {"reputation": 47, "user_id": 7724046, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TLUZn.png?s=128&g=1", "display_name": "Twisted Mersenne", "link": "https://stackoverflow.com/users/7724046/twisted-mersenne"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543250912, "post_id": 53473751, "comment_id": 93840888, "body": "It means getting all elements in the first dimension (which I&#39;m calling x) between indices <code>x1</code> and <code>x2</code>, and the second dimension (y) between <code>y1</code> and <code>y2</code>. In Python getting those elements you mention would be then x1,x2 = y1,y2 = 1,3, or v[1:3,1:3], which would be a 2x2 matrix indeed since <code>numpy</code> arrays don&#39;t include the last index. In Haskell <code>V.slice 1 2 v</code> would do the analogous operation for a single dimension, but doing that for 2 or more is not straightforwardly described in <code>Repa</code>&#39;s tutorial or documentation"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 7724046, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TLUZn.png?s=128&g=1", "display_name": "Twisted Mersenne", "link": "https://stackoverflow.com/users/7724046/twisted-mersenne"}, "edited": false, "score": 0, "creation_date": 1543638275, "post_id": 53486843, "comment_id": 94000995, "body": "Thanks. That seems to work alright.. Still pretty cumbersome compared to other languages and even to Vector.slice. I can deal with the array keeping the same number of dimensions and size 1 along the dimension of the slice, it&#39;s not ideal but workable in the absence of analog usage of Repa.slice."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 1, "last_activity_date": 1543256052, "creation_date": 1543256052, "answer_id": 53486843, "question_id": 53473751, "link": "https://stackoverflow.com/questions/53473751/is-there-usage-of-haskell-repa-slice-function-analogous-to-vector-and-other-lang/53486843#53486843", "title": "Is there usage of Haskell Repa slice function analogous to Vector and other languages?", "body": "<p>I believe the closest equivalent is <a href=\"https://hackage.haskell.org/package/repa-3.4.1.4/docs/Data-Array-Repa-Operators-IndexSpace.html#v:extract\" rel=\"nofollow noreferrer\">extract</a>, which takes a starting index (like <code>ix2 x1 y1</code>) and a size (like <code>ix2 (x2-x1) (y2-y1)</code>).</p>\n\n<p>The result of <code>extract</code> always has the same number of dimensions as the input, but can have different size in each dimension.  The result of <code>slice</code> can have a different number of dimensions, but in any given dimension it takes either all elements or exactly one.  (Based on the instances for <code>Shape</code> and <code>Slice</code>.)</p>\n"}], "owner": {"reputation": 47, "user_id": 7724046, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TLUZn.png?s=128&g=1", "display_name": "Twisted Mersenne", "link": "https://stackoverflow.com/users/7724046/twisted-mersenne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 53486843, "answer_count": 1, "score": 0, "last_activity_date": 1543256052, "creation_date": 1543196400, "last_edit_date": 1543205921, "question_id": 53473751, "link": "https://stackoverflow.com/questions/53473751/is-there-usage-of-haskell-repa-slice-function-analogous-to-vector-and-other-lang", "title": "Is there usage of Haskell Repa slice function analogous to Vector and other languages?", "body": "<p>I am trying to get a usable version of multidimensional arrays in Haskell, comparable to that of <code>numpy</code> arrays in Python and other languages.\nI found other questions about how to write custom functions for arrays of specific dimensions, but my objective it more to the point, get a similar behavior of <code>Data.Vector</code>'s <code>slice</code> function, which is intuitive and does the job of bracket-indexed arrays of other languages. </p>\n\n<p><code>Vector</code>'s <code>slice</code> function has type\n<code>V.slice :: Int -&gt; Int -&gt; V.Vector a -&gt; V.Vector a</code></p>\n\n<p>so slicing a vector <code>v</code> is as simple as</p>\n\n<pre><code>import Data.Vector as V\nlet v = V.fromList [1..10]\n    i = 1\n    j = 5\nV.slice i j v\n</code></pre>\n\n<p><code>Repa</code>'s <code>slice</code> on the other hand has type </p>\n\n<p><code>R.slice :: (R.Slice sl, R.Shape (R.FullShape sl), R.Source r e) =&gt; R.Array r (R.FullShape sl) e -&gt; sl -&gt; R.Array R.D (R.SliceShape sl) e</code></p>\n\n<p>so it takes a Repa array and a shape and return a delayed array.\nI understand that Repa does not take Integers as indices, but I am looking for a general use of the <code>slice</code> function for arbitrary dimension, whether using <code>Repa</code>'s <code>(Z :. i)</code> or <code>ixn</code> dimension specification.</p>\n\n<p>I'm not looking for a dimension-dependent function using <code>traverse</code>, and would prefer not to go into any template haskell to generalize that, although if it's not possible to use the <code>slice</code> function generally it is what it is.</p>\n\n<p>The question is, then: is it possible to use <code>Repa</code>'s <code>slice</code> function to get arbitrary slices of multidimensional arrays, like in <code>numpy</code>'s v[x1:x2,y1:y2] or C++ <code>Eigen</code>'s <code>matrix.block&lt;p,q&gt;(i,j)</code>?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543173067, "post_id": 53470945, "comment_id": 93812419, "body": "Hint: use <code>mod</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543173212, "post_id": 53470945, "comment_id": 93812470, "body": "@WillemVanOnsem, Hint 2: don&#39;t use <code>mod</code>. <code>mod</code> is relatively slow, so it&#39;s usually better to avoid it when you can. It&#39;s completely unnecessary in this case."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543173336, "post_id": 53470945, "comment_id": 93812515, "body": "@dfeuer: well I would not violate Knuth&#39;s optimization principle: &quot;<i>premature optimization is the root of all evil</i>&quot; :) As with many algorithms that are designed, once an inefficient algorithm is designed, then optimizing is typically more straightforward."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1543173610, "post_id": 53470945, "comment_id": 93812612, "body": "@WillemVanOnsem, that&#39;s certainly a valid point in general, but in this particular case the alternative is just as simple, so there&#39;s no reason to take the detour."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543246842, "post_id": 53470945, "comment_id": 93838636, "body": "So, we&#39;re just assuming that <code>wrap n x ys</code> is suppose to insert <code>x</code> into <code>ys</code> after every <code>n</code> characters? This question is woefully incomplete. (The edit history is quite long, so I&#39;m hesitant to simply rollback the last edit that appears to have destroyed the question.)"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 2246239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941427a49899a83fefd3b64419ebccb?s=128&d=identicon&r=PG", "display_name": "DavisR5", "link": "https://stackoverflow.com/users/2246239/davisr5"}, "edited": false, "score": 0, "creation_date": 1543179344, "post_id": 53471112, "comment_id": 93814346, "body": "Thank you for your help, but I am not supposed to change the given code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57, "user_id": 2246239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941427a49899a83fefd3b64419ebccb?s=128&d=identicon&r=PG", "display_name": "DavisR5", "link": "https://stackoverflow.com/users/2246239/davisr5"}, "edited": false, "score": 0, "creation_date": 1543181367, "post_id": 53471112, "comment_id": 93814930, "body": "@DavisR5, read the problem statement again. You got it backwards."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1543174378, "creation_date": 1543174378, "answer_id": 53471112, "question_id": 53470945, "link": "https://stackoverflow.com/questions/53470945/haskell-wrap-function-implementation/53471112#53471112", "title": "Haskell wrap function implementation", "body": "<p>I've taken the liberty of changing the argument you pass to <code>insertAfter</code>. It's very often a bit more convenient to count <em>down</em> than to count <em>up</em>, and that's true here as well.</p>\n\n<pre><code>wrap :: Int -&gt; a -&gt; [a] -&gt; [a]\nwrap _ _ [] = []\nwrap n delim = insertAfter n\n  where\n     -- We've reached zero. So we insert the delimiter and\n     -- reset the counter to n.\n     insertAfter 0 xs = delim : insertAfter n xs\n     -- All done\n     insertAfter _ [] = ???\n     -- Still some work to do\n     insertAfter k (y : ys) = ???\n</code></pre>\n\n<p>An aside: what you called a \"contract\" is what we call a <em>type signature</em>. An actual <em>contract</em> will generally give a lot more detail about what is expected of the arguments and what is guaranteed of the result. For example, the contract here would specify that the first argument to <code>wrap</code> must be positive, and would give an explanation of what the function does.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1543182453, "creation_date": 1543182453, "answer_id": 53472320, "question_id": 53470945, "link": "https://stackoverflow.com/questions/53470945/haskell-wrap-function-implementation/53472320#53472320", "title": "Haskell wrap function implementation", "body": "<p>You may do as follows</p>\n\n<pre><code>wrap :: Int -&gt; a -&gt; [a] -&gt; [a]\nwrap _ _ [] = []\nwrap n c cs | n == length cs = c:cs++[c]\n            | otherwise      = c:x ++ wrap n c y\n              where (x,y) = splitAt n cs\n</code></pre>\n\n<p><code>n == length cs</code> condition is required because both <code>splitAt 2..n \"a\"</code> and <code>splitAt 1 \"a\"</code> give <code>(\"a\",\"\")</code>. Also I assume <code>n &gt;= 1</code> always.</p>\n"}], "owner": {"reputation": 57, "user_id": 2246239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941427a49899a83fefd3b64419ebccb?s=128&d=identicon&r=PG", "display_name": "DavisR5", "link": "https://stackoverflow.com/users/2246239/davisr5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1543772071, "creation_date": 1543173004, "last_edit_date": 1543772071, "question_id": 53470945, "link": "https://stackoverflow.com/questions/53470945/haskell-wrap-function-implementation", "title": "Haskell wrap function implementation", "body": "<p>I have a problem with the implementation of this function:</p>\n\n<h3>TYPE SIGNATURE</h3>\n\n<pre><code>wrap :: Int -&gt; a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<h3>PURPOSE</h3>\n\n<p>Insert <code>x</code> at every <code>n</code>th position in the list <code>xs</code>.</p>\n\n<h3>EXAMPLES</h3>\n\n<pre><code>wrap 1 '+' \"a\" : \"+a+\"\n\nwrap 2 '+' \"a\" : \"+a\"\n\nwrap 2 '+' \"abcd\" : \"+ab+cd+\"\n</code></pre>\n\n<h3>DEFINITION</h3>\n\n<pre><code>wrap _ _ [] = []\nwrap n x xs = insertAfter 0 xs\n        where insertAfter = undefined\n</code></pre>\n\n<p>How can one implement this, I just can not figure it out. \nEDIT: </p>\n\n<p>Full question:\nImplement the function wrap, which generates a list that starts with wrap\u2019s second argument (x), followed by as many entries from wrap\u2019s third argument (xs) as dictated by wrap\u2019s \ufb01rst argument (n). Repeat until the third argument is empty. In the resulting list, every nth element should be equal to x. Insert an x in the end if the length of xs is evenly divisible by n.\nHint: Implement the function wrap in terms of the function insertAfter, which takes a number m and a listofelements xs, which decreases m as elements are removed from xs, and inserts x whenever m reaches 0.</p>\n\n<p>I almost got it: </p>\n\n<pre><code> wrap _ _ [] = []\n wrap n x xs = insertAfter 0 xs\n   where insertAfter 0 xs = x : insertAfter n xs\n         insertAfter _ [] = undefined\n         insertAfter n xs = take n xs ++ (wrap n x (drop n xs))\n</code></pre>\n\n<p>but using the example: wrap 2 '+' \"abcd\" : wrap 2 '+' \"abcd\" : \"+ab+cd+\"\nI get \"+ab+cd\" so theres a '+' missing.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 3, "creation_date": 1543172570, "post_id": 53470824, "comment_id": 93812278, "body": "<code>stack eval &#39;putStrLn &quot;hello world&quot;&#39;</code>"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543172791, "post_id": 53470824, "comment_id": 93812334, "body": "@Redu, this works, can you post as an answer I can accept?"}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1543172759, "post_id": 53470893, "comment_id": 93812329, "body": "Hmm, I get:  <code>$ stack ghci -e &#39;putStrLn &quot;hello world&quot;&#39; Invalid option </code>-e&#39; ` And don&#39;t otherwise have ghc installed outside of stack, if possible to keep it that way:  <code>$ ghc -e &#39;putStrLn &quot;hello world&quot;&#39;  Command &#39;ghc&#39; not found, but can be installed with: sudo apt install ghc </code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1543172829, "post_id": 53470893, "comment_id": 93812347, "body": "@Mittenchops: what version of <code>ghci</code> do you use? This is already supported since 7.6 (or even eariler) iirc."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1543172892, "post_id": 53470893, "comment_id": 93812368, "body": "<code>$ stack ghci Configuring GHCi with the following packages:  GHCi, version 8.4.3: http:&#47;&#47;www.haskell.org&#47;ghc&#47;  :? for help</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1543172962, "post_id": 53470893, "comment_id": 93812383, "body": "@Mittenchops: in 8.4.3, this flag is also supported: <a href=\"https://downloads.haskell.org/~ghc/8.4.3/docs/html/users_guide/flags.html#ghc-flag--e%20%E2%9F%A8expr%E2%9F%A9\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/8.4.3/docs/html/users_guide/&hellip;</a>, strange"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1543173914, "post_id": 53470893, "comment_id": 93812711, "body": "I have a resolution to the major question, but I am interested in this.  It doesn&#39;t seem to be the case on ubuntu somehow?  Let me add an edit in the question to clarify."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1543173961, "post_id": 53470893, "comment_id": 93812728, "body": "@Mittenchops: well I work with Ubuntu as well, so this makes it even more strange :S"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1543172886, "last_edit_date": 1543172886, "creation_date": 1543172643, "answer_id": 53470893, "question_id": 53470824, "link": "https://stackoverflow.com/questions/53470824/haskell-stack-command-line-flag-for-executing-an-expression/53470893#53470893", "title": "Haskell stack command line flag for executing an expression", "body": "<p>In fact you already have this <a href=\"https://downloads.haskell.org/~ghc/7.6.2/docs/html/users_guide/modes.html\" rel=\"nofollow noreferrer\">flag</a>: it is just:</p>\n\n<blockquote>\n<pre><code>-e expr\n</code></pre>\n  \n  <p>Evaluate <code>expr</code>; see eval-mode for details</p>\n</blockquote>\n\n<p>So you can write it like:</p>\n\n<pre><code>ghci <b>-e</b> 'putStrLn \"hello world\"'</code></pre>\n\n<p>In fact if you use <code>stack ghci</code>, you just open <code>ghci</code> with your application, but the <code>-e</code> flag is not \"stack-specific\".</p>\n\n<p>For example:</p>\n\n<pre><code>$ ghci -e 'putStrLn \"hello world\"'\nhello world\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": true, "score": 6, "last_activity_date": 1543173144, "creation_date": 1543173144, "answer_id": 53470959, "question_id": 53470824, "link": "https://stackoverflow.com/questions/53470824/haskell-stack-command-line-flag-for-executing-an-expression/53470959#53470959", "title": "Haskell stack command line flag for executing an expression", "body": "<p>If you check <code>$ stack --help</code> at one point you see that</p>\n\n<pre><code>eval                     Evaluate some haskell code inline. Shortcut for\n                         'stack exec ghc -- -e CODE'\n</code></pre>\n\n<p>So instead of doing like</p>\n\n<pre><code>$ stack exec ghc -- -e 'putStrLn \"hello world\"'\nhello world\n</code></pre>\n\n<p>you may do like</p>\n\n<pre><code>$ stack eval 'putStrLn \"hello world\"'\nhello world\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 53470959, "answer_count": 2, "score": 1, "last_activity_date": 1543178955, "creation_date": 1543172254, "last_edit_date": 1543178955, "question_id": 53470824, "link": "https://stackoverflow.com/questions/53470824/haskell-stack-command-line-flag-for-executing-an-expression", "title": "Haskell stack command line flag for executing an expression", "body": "<p>If I have a simple Haskell one-liner, what's the flag in ghc or ghci that could execute this from the command line?</p>\n\n<p>I'm looking for something like:</p>\n\n<pre><code>stack ghci -e 'putStrLn \"hello world\"'\n</code></pre>\n\n<p>Similar to</p>\n\n<pre><code>$ R --quiet -e \"cat('hello world')\"\n&gt; cat('hello world')\nhello world&gt; \n</code></pre>\n\n<p>or</p>\n\n<pre><code>$ python -c \"print('hello world')\"\nhello world\n</code></pre>\n\n<h2>Edit for 'ghci -e' debug</h2>\n\n<p>(This question is resolved  with an excellent answer already, but just debugging that the flag seems like it /should/ work above...)</p>\n\n<p>Weirdly couldn't get the seemingly supported <code>ghci -e</code> working for me.  Testing it is not just my machine, I also ran this on Ubuntu and had the same issue:</p>\n\n<pre><code>FROM ubuntu:18.04\nENV DEBIAN_FRONTEND=noninteractive\n\nRUN apt-get update \\\n &amp;&amp; apt-get install  --yes curl \\   \n &amp;&amp; curl -sSL https://get.haskellstack.org/ | sh \\\n &amp;&amp; export HOME=/root/.local/bin:$HOME \\\n &amp;&amp; stack ghci -e 'putStrLn \"hello world\"'\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>$ docker build .\n</code></pre>\n\n<p>Produced...</p>\n\n<pre><code>Stack has been installed to: /usr/local/bin/stack\n\nWARNING: '/root/.local/bin' is not on your PATH.\n    For best results, please add it to the beginning of PATH in your profile.\n\nInvalid option `-e'\n\nUsage: stack ghci [TARGET/FILE] [--ghci-options OPTIONS] [--ghc-options OPTIONS]\n                  [--flag PACKAGE:[-]FLAG] [--with-ghc GHC] [--[no-]load]\n                  [--package ARG] [--main-is TARGET] [--load-local-deps]\n                  [--[no-]package-hiding] [--only-main] [--trace] [--profile]\n                  [--no-strip] [--[no-]test] [--[no-]bench] [--help]\n  Run ghci in the context of package(s) (experimental)\nThe command '/bin/sh -c apt-get update  &amp;&amp; apt-get install  --yes curl  &amp;&amp; curl -sSL https://get.haskellstack.org/ | sh  &amp;&amp; export HOME=/root/.local/bin:$HOME  &amp;&amp; stack ghci -e 'putStrLn \"hello world\"'' returned a non-zero code: 1\n</code></pre>\n"}, {"tags": ["haskell", "compiler-errors"], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 10703003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d26a9511d26fb8f593dcb4948f3ddd?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tihoan", "link": "https://stackoverflow.com/users/10703003/andrei-tihoan"}, "edited": false, "score": 1, "creation_date": 1543172834, "post_id": 53470809, "comment_id": 93812349, "body": "Oh, that worked. I was almost certain I tried that. I must&#39;ve tried it without indenting it properly or something. Thank you for the very much for the detailed response."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 9, "user_id": 10703003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d26a9511d26fb8f593dcb4948f3ddd?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tihoan", "link": "https://stackoverflow.com/users/10703003/andrei-tihoan"}, "edited": false, "score": 0, "creation_date": 1543173068, "post_id": 53470809, "comment_id": 93812421, "body": "@AndreiTihoan, it&#39;s completely <i>optional</i> to indent module contents like that, and in my experience it&#39;s <i>rare</i>. The vast majority of Haskell programmers start their imports and top-level definitions in column 0 so they can make the best use of limited horizontal space. But whatever column you start the module contents in is the one you have to put the rest in."}, {"owner": {"reputation": 9, "user_id": 10703003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d26a9511d26fb8f593dcb4948f3ddd?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tihoan", "link": "https://stackoverflow.com/users/10703003/andrei-tihoan"}, "edited": false, "score": 0, "creation_date": 1543173633, "post_id": 53470809, "comment_id": 93812620, "body": "Thanks again @ForceBru. It does actually look better when not indented. Also, thank you for cleaning up my question. It was my first post, and I made it in a bit of a hurry, not realizing my code wasn&#39;t properly written under code."}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "reply_to_user": {"reputation": 9, "user_id": 10703003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d26a9511d26fb8f593dcb4948f3ddd?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tihoan", "link": "https://stackoverflow.com/users/10703003/andrei-tihoan"}, "edited": false, "score": 0, "creation_date": 1543173877, "post_id": 53470809, "comment_id": 93812697, "body": "@AndreiTihoan, you should thank defer for the idea about indentation, not me :D As for question formatting, you can find more information about how and what to post in the <a href=\"https://stackoverflow.com/help\">Help Centre</a>. Welcome to Stack Overflow!"}], "tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": true, "score": 1, "last_activity_date": 1543172178, "creation_date": 1543172178, "answer_id": 53470809, "question_id": 53470725, "link": "https://stackoverflow.com/questions/53470725/parse-error-on-input-module-when-importing-a-module/53470809#53470809", "title": "Parse error on input \u2018module\u2019 when importing a module", "body": "<p>Take a look at the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html\" rel=\"nofollow noreferrer\">grammar</a> (5.1):</p>\n\n<pre><code>module  \u2192   module modid [exports] where body\n       |    body\nbody    \u2192   { impdecls ; topdecls }\n       |    { impdecls }\n       |    { topdecls }\n\nimpdecls    \u2192   impdecl1 ; \u2026 ; impdecln     (n \u2265 1)\ntopdecls    \u2192   topdecl1 ; \u2026 ; topdecln     (n \u2265 1)\n</code></pre>\n\n<p>Also, in Section 5.3:</p>\n\n<blockquote>\n  <p>The entities exported by a module may be brought into scope in another module with an import declaration <em>at the beginning of the module</em>. </p>\n</blockquote>\n\n<p>As you can see, imports must be <em>inside</em> the module, so your code should be:</p>\n\n<pre><code>module Solitaire where\n    import MergeSort\n\n    a :: Int\n    a = 2\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 10703003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d26a9511d26fb8f593dcb4948f3ddd?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tihoan", "link": "https://stackoverflow.com/users/10703003/andrei-tihoan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 794, "favorite_count": 0, "accepted_answer_id": 53470809, "answer_count": 1, "score": 0, "last_activity_date": 1543172884, "creation_date": 1543171482, "last_edit_date": 1543172884, "question_id": 53470725, "link": "https://stackoverflow.com/questions/53470725/parse-error-on-input-module-when-importing-a-module", "title": "Parse error on input \u2018module\u2019 when importing a module", "body": "<p>This is the source code of the file Solitaire.hs:</p>\n\n<pre><code>import MergeSort\n\nmodule Solitaire where\n\n  a :: Int\n\n  a = 2\n</code></pre>\n\n<p>MergeSort.hs and Solitaire.hs are in the same directory.</p>\n\n<p>I'm using WinGhci.</p>\n\n<p>The error I'm getting when trying to load Solitaire.hs after changing to its directory and using the command :load Solitaire.hs is:</p>\n\n<pre><code>Solitaire.hs:3:1: error: parse error on input \u2018module\u2019\n  |\n3 | module Solitaire where   | ^^^^^^\nFailed, one module loaded.\n*MergeSort&gt; \n</code></pre>\n\n<p>What's curious is, that just removing the import statement: <code>import MergeSort</code> removes any error.</p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1543171226, "post_id": 53470608, "comment_id": 93811900, "body": "I only gave a quick look, but it seems that you want to read your &quot;number of statements&quot;, which currently is modeled with a writer monad. If so, don&#39;t use the writer monad since you need to <i>read</i>. Put your counter in your world state, and remove the writer layer."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1543182244, "last_edit_date": 1543182244, "creation_date": 1543181508, "answer_id": 53472213, "question_id": 53470608, "link": "https://stackoverflow.com/questions/53470608/haskell-monad-transformers-limit-number-of-evaluations-in-an-interpreter/53472213#53472213", "title": "Haskell - Monad Transformers - Limit number of evaluations in an interpreter", "body": "<p>Computations inside the <code>Writer</code> monad can't have access to their own accumulator. What's more: the accumulator is <em>never</em> forced while the computation runs, not even to WHNF. This applies to <em>both</em> the strict and lazy variants of <code>Writer</code>\u2014the strict variant is strict in a sense unrelated to the accumulator. This unavoidable laziness in the accumulator can be a source of space leaks if the computation runs for too long.</p>\n\n<hr>\n\n<p>Your <code>limit</code> function is not branching on the value of the \"mainline\" <code>WriterT</code> accumulator. The <code>get</code> action (you are using mtl) simply reads the state from the <code>StateT</code> layer, and performs no effects in the other layers: it adds <code>mempty</code> to its <code>WriterT</code> accumulator an throws no error.</p>\n\n<p>Then, the <code>listen</code> extracts the <code>Writer</code> accumulator of the <code>get</code> action (only of the <code>get</code>, not of the whole computation) and adds it to the \"mainline\" accumulator. But this extracted value (the one returned in the tuple) will always be <code>mempty</code>, that is, <code>Sum 0</code>!</p>\n\n<hr>\n\n<p>Instead of <code>WriterT</code>, you could put the counter in the <code>StateT</code> state, as @chi has mentioned. You could also use <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Accum.html\" rel=\"nofollow noreferrer\"><code>AccumT</code></a>, which is very similar to <code>WriterT</code> but lets you inspect the accumulator (it also lets you force it to WHNF using bang patterns). </p>\n\n<p><code>AccumT</code> doesn't seem to have a corresponding mtl typeclass though, so you'll need to sprinkle a few lifts in order to use it. </p>\n"}], "owner": {"reputation": 465, "user_id": 2580077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b58818b540ede79814842b1e8736e6c2?s=128&d=identicon&r=PG&f=1", "display_name": "duggi", "link": "https://stackoverflow.com/users/2580077/duggi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 53472213, "answer_count": 1, "score": 1, "last_activity_date": 1543182244, "creation_date": 1543170689, "last_edit_date": 1543171100, "question_id": 53470608, "link": "https://stackoverflow.com/questions/53470608/haskell-monad-transformers-limit-number-of-evaluations-in-an-interpreter", "title": "Haskell - Monad Transformers - Limit number of evaluations in an interpreter", "body": "<p>I'm learning Monad Transformers and decided to write an interpreter for a simple language(with loop constructs) similar to Brainfuck using Monad Transformers. I would like to terminate the interpreter after certain number of statements.</p>\n\n<p>This simple language is made of single memory cell capable of holding an Int and 5 instructions Input, Output, Increment, Decrement and Loop. A loop terminates when value in the memory is zero. Input is read from a list and similarly output is written to another list. Increment and Decrement does +1 and -1 to memory correspondingly.</p>\n\n<p>I'm using <code>World</code> type to keep track of input, output (streams) and memory, <code>Sum Int</code> to count number of instructions evaluated. <code>Except World</code> to terminate evaluation after certain statements.</p>\n\n<pre><code>module Transformers where\n\nimport qualified Data.Map                      as Map\nimport           Data.Maybe\nimport           Control.Monad.State.Lazy\nimport           Control.Monad.Writer.Lazy\nimport           Control.Monad.Except\n\n\ndata Term = Input\n  | Output\n  | Increment\n  | Decrement\n  | Loop [Term]\n  deriving (Show)\n\ndata World = World {\n  inp :: [Int],\n  out :: [Int],\n  mem :: Int\n} deriving Show\n\nop_limit = 5\n\nloop\n  :: [Term]\n  -&gt; StateT World (WriterT (Sum Int) (Except World)) ()\n  -&gt; StateT World (WriterT (Sum Int) (Except World)) ()\nloop terms sp = sp &gt;&gt; do\n  s &lt;- get\n  if mem s == 0 then put s else loop terms (foldM (\\_ t -&gt; eval t) () terms)\n\nlimit :: StateT World (WriterT (Sum Int) (Except World)) ()\nlimit = do\n  (s, count) &lt;- listen get\n  when (count &gt;= op_limit) $ throwError s\n\ntick :: StateT World (WriterT (Sum Int) (Except World)) ()\ntick = tell 1\n\neval :: Term -&gt; StateT World (WriterT (Sum Int) (Except World)) ()\neval Input =\n  limit &gt;&gt; tick &gt;&gt; modify (\\s -&gt; s { inp = tail (inp s), mem = head (inp s) })\neval Output       = limit &gt;&gt; tick &gt;&gt; modify (\\s -&gt; s { out = mem s : out s })\neval Increment    = limit &gt;&gt; tick &gt;&gt; modify (\\s -&gt; s { mem = mem s + 1 })\neval Decrement    = limit &gt;&gt; tick &gt;&gt; modify (\\s -&gt; s { mem = mem s - 1 })\neval (Loop terms) = loop terms (void get)\n\ntype Instructions = [Term]\n\ninterp :: Instructions -&gt; World -&gt; Either World (World, Sum Int)\ninterp insts w =\n  let sp = foldM (\\_ inst -&gt; eval inst) () insts\n  in  runExcept (runWriterT (execStateT sp w))\n</code></pre>\n\n<p>Example run in ghci:</p>\n\n<pre><code>*Transformers&gt; interp [Loop [Output, Decrement]]  $ World [] [] 5\nRight (World {inp = [], out = [1,2,3,4,5], mem = 0},Sum {getSum = 10})\n</code></pre>\n\n<p>The monad <code>limit</code> based on count and should decide to either Fail with current state or do nothing. But I noticed that <code>count</code> in <code>(s, count) &lt;- listen get</code> is always zero. I don't understand why is this happening. Please help me understand where I went wrong.</p>\n\n<ul>\n<li>Is my ordering of transformers in the stack correct? Are there any rules (informal) to decide the layering?</li>\n</ul>\n"}, {"tags": ["haskell", "websocket", "yesod"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543239935, "post_id": 53467385, "comment_id": 93834527, "body": "A blocking createProcess would not make any sense, so I strongly suspect this is not the case."}], "answers": [{"comments": [{"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1543234634, "post_id": 53480371, "comment_id": 93831457, "body": "thanks for your suggestion. It&#39;s still blocking, see my edit."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1543237060, "post_id": 53480371, "comment_id": 93832732, "body": "Hmm. Not sure what the problem is now... I&#39;ve tried all the things I would have tried. Unless the problem is at the web end somehow..."}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1543238269, "post_id": 53480371, "comment_id": 93833428, "body": "I tried using <code>createProcess</code> in <code>IO ()</code> . Still blocking, see my edit. So I don&#39;t think the problem is at the web side."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1543232569, "creation_date": 1543232569, "answer_id": 53480371, "question_id": 53467385, "link": "https://stackoverflow.com/questions/53467385/get-data-every-newline-from-endless-loop-c-program-in-haskell/53480371#53480371", "title": "Get data every newline from endless loop (C program) in Haskell", "body": "<p>Quoting the documentation for <code>readProcess</code>:</p>\n\n<blockquote>\n  <p><code>readProcess</code> forks an external process, reads its standard output strictly, <strong>blocking until the process terminates</strong>, and returns the output string. The external process inherits the standard error.</p>\n</blockquote>\n\n<p>(Note emphasis.) It appears that <code>readCreateProcess</code> works similarly.</p>\n\n<p>So basically when you call this function, it will sit there forever waiting for your external process to quit.</p>\n\n<p>I suggest you use <code>proc</code> to create a <code>CreateProcess</code> structure as before, change <code>std_in</code> to be <code>CreatePipe</code>, and then call <code>createProcess</code> which should return you a handle that you can <code>hGetLine</code> from as required.</p>\n"}, {"tags": [], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "is_accepted": true, "score": 1, "last_activity_date": 1543337842, "last_edit_date": 1543337842, "creation_date": 1543254856, "answer_id": 53486559, "question_id": 53467385, "link": "https://stackoverflow.com/questions/53467385/get-data-every-newline-from-endless-loop-c-program-in-haskell/53486559#53486559", "title": "Get data every newline from endless loop (C program) in Haskell", "body": "<p>From this <a href=\"https://stackoverflow.com/a/20504272/1276388\">answer</a> I must add <code>fflush(stdout);</code> to my C file.</p>\n\n<p><strong>Here's my solution:</strong></p>\n\n<pre><code>// gcc counter.c -o counter\n\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nint main(int argc, char *argv[]) {\n  unsigned int i = 0;\n  while(1) {\n    printf(\"%d\\n\", i);\n    sleep(1);\n    i++;\n    fflush(stdout);\n  }\n}\n</code></pre>\n\n<p>And here's how I read a process in Haskell:</p>\n\n<pre><code> ...\n import System.IO\n ...\n\ncounter :: MonadIO m =&gt; Source m TL.Text\ncounter = do\n  r &lt;- liftIO $ createProcess (proc \"./counter\" []){ std_out = CreatePipe, std_in = CreatePipe}\n  let (_, Just outp, _, _) = r\n  liftIO $ hSetBuffering outp LineBuffering\n  forever $ do \n    contents &lt;- liftIO $ hGetLine outp\n    yield $ TL.pack $ show (\"Stdout: \" ++ contents)\n    liftIO $ threadDelay 1000000 -- already put 1s delay in C file, so it's optional\n  liftIO $ hClose outp\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/s6vYe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/s6vYe.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 53486559, "answer_count": 2, "score": 4, "last_activity_date": 1543337842, "creation_date": 1543148543, "last_edit_date": 1543241519, "question_id": 53467385, "link": "https://stackoverflow.com/questions/53467385/get-data-every-newline-from-endless-loop-c-program-in-haskell", "title": "Get data every newline from endless loop (C program) in Haskell", "body": "<p>I'm having trouble getting data every newline from standard ouput. Data is produced by C program. This is the C code:</p>\n\n<pre><code>// gcc counter.c -o counter\n\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nint main(int argc, char *argv[]) {\n  unsigned int i = 0;\n  while(1) {\n    printf(\"%d\\n\", i);\n    sleep(1);\n    i++;\n  }\n}\n</code></pre>\n\n<p>My goal is to get the same behaviour as this haskell function below:</p>\n\n<pre><code>timeSource :: MonadIO m =&gt; Source m TL.Text\ntimeSource = forever $ do\n    now &lt;- liftIO getCurrentTime\n    yield $ TL.pack $ show now\n    liftIO $ threadDelay 1000000\n</code></pre>\n\n<p>I tried using <code>readProcess</code> and <code>readCreateProcess</code> from <code>System.Process</code> module. This is one of my tries: </p>\n\n<pre><code>counter :: MonadIO m =&gt; Source m TL.Text\ncounter = do\n    r &lt;- liftIO $ readCreateProcess (proc \"./counter\" []) \"\"\n    -- r &lt;- liftIO $ readProcess \"./counter\" [] [] \n    yield $ TL.pack $ show r\n    liftIO $ threadDelay 1000000\n</code></pre>\n\n<p>This is how I use <code>counter</code> function within <code>webSockets</code>:</p>\n\n<pre><code>    webSockets $ race_\n        (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n        -- (timeSource $$ sinkWSText)\n        (counter $$ sinkWSText)\n</code></pre>\n\n<p>When I open <a href=\"http://localhost:3000/\" rel=\"nofollow noreferrer\">http://localhost:3000/</a>, it doesn't work. Here's the complete code.</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell, TypeFamilies, OverloadedStrings #-}\n\nmodule Main where\n\nimport Yesod.Core\nimport Yesod.WebSockets\nimport qualified Data.Text.Lazy as TL\nimport Control.Monad (forever)\nimport Control.Concurrent (threadDelay)\nimport Data.Time\nimport Data.Conduit\nimport System.Process \nimport qualified Data.Conduit.List\n\ndata App = App\n\ninstance Yesod App\n\nmkYesod \"App\" [parseRoutes|\n/ HomeR GET\n|]\n\ntimeSource :: MonadIO m =&gt; Source m TL.Text\ntimeSource = forever $ do\n    now &lt;- liftIO getCurrentTime\n    yield $ TL.pack $ show now\n    liftIO $ threadDelay 1000000\n\ncounter :: MonadIO m =&gt; Source m TL.Text\ncounter = do\n  r &lt;- liftIO $ readCreateProcess (proc \"./counter\" []) \"\"\n  -- r &lt;- liftIO $ readProcess \"./counter\" [] [] \n  yield $ TL.pack $ show r\n  liftIO $ threadDelay 1000000\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    webSockets $ race_\n        (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n        (timeSource $$ sinkWSText)\n        -- (counter $$ sinkWSText)\n    defaultLayout $\n        toWidget\n            [julius|\n                var conn = new WebSocket(\"ws://localhost:3000/\");\n                conn.onopen = function() {\n                    document.write(\"&lt;p&gt;open!&lt;/p&gt;\");\n                    document.write(\"&lt;button id=button&gt;Send another message&lt;/button&gt;\")\n                    document.getElementById(\"button\").addEventListener(\"click\", function(){\n                        var msg = prompt(\"Enter a message for the server\");\n                        conn.send(msg);\n                    });\n                    conn.send(\"hello world\");\n                };\n                conn.onmessage = function(e) {\n                    document.write(\"&lt;p&gt;\" + e.data + \"&lt;/p&gt;\");\n                };\n                conn.onclose = function () {\n                    document.write(\"&lt;p&gt;Connection Closed&lt;/p&gt;\");\n                };\n            |]\n\nmain :: IO ()\nmain = warp 3000 App\n</code></pre>\n\n<p>So my question is how to access data every <code>printf</code> in infinite loop and use it in Haskell?</p>\n\n<p><strong>EDIT 1:</strong></p>\n\n<p>Based on MathematicalOrchid's suggestion, here's what I did so far.</p>\n\n<pre><code>counter :: MonadIO m =&gt; Source m TL.Text\ncounter = do\n  r &lt;- liftIO $ createProcess (proc \"./counter\" []){ std_out = CreatePipe, std_in = CreatePipe}\n  let (Just inp, Just outp, _, phandle) = r\n  liftIO $ hSetBuffering outp LineBuffering\n  contents &lt;- liftIO $ hGetLine outp\n  yield $ TL.pack $ show contents\n  liftIO $ threadDelay 1000000\n</code></pre>\n\n<p>I suppose it's still <em>blocking</em> until the process terminates.</p>\n\n<p><strong>EDIT 2:</strong></p>\n\n<p>For testing if <code>createProcess</code> works I tried this.</p>\n\n<pre><code>counterTest :: IO ()\ncounterTest = do\n  r &lt;- createProcess (proc \"./counter\" []){ std_out = CreatePipe, std_in = CreatePipe}\n  let (Just inp, Just outp, _, phandle) = r\n  hSetBuffering outp LineBuffering\n  contents &lt;- hGetLine outp\n  print contents\n</code></pre>\n\n<p>Apparently It's still blocking.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49, "user_id": 10701845, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eqch2ODGIlg/AAAAAAAAAAI/AAAAAAAAAAA/shPt2AfJ-zk/photo.jpg?sz=128", "display_name": "TryHardingProgrammingDude", "link": "https://stackoverflow.com/users/10701845/tryhardingprogrammingdude"}, "edited": false, "score": 0, "creation_date": 1543146059, "post_id": 53467046, "comment_id": 93804815, "body": "ah, or is it just that the &quot;h&quot; is just another functions which takes two variables and add them so f0 0 0 1 = x a b - x a c - x b c     where x b a = a + b  is just something like:  0+0 - 0+1 - 0+1 = -2 ?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1543146355, "post_id": 53467046, "comment_id": 93804866, "body": "Exactly. <code>x b a = a + b</code> is a function definition (that happens to have local scope). <code>f0 0 0 1 = x 0 0 - x 0 1 - x 0 1</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1543148555, "post_id": 53467046, "comment_id": 93805419, "body": "Also note that the variables <code>a,b</code> in <code>x a b = b + a</code> shadow the other variables <code>a,b</code> defined in <code>f0 a b c = ..</code>. I would recommend to rename them to avoid confusion between different variables with the same name, say <code>... where x v w = w + v</code>. Turning on warnings would also spot this shadowing issue."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543169422, "post_id": 53467046, "comment_id": 93811373, "body": "\u201cDoes it just translate to something like this? [\u2026]\u201d\u2014Close, it translates to <code>f0 a b c = (\\ b a -&gt; a + b) a b - (\\ b a -&gt; a + b) a c - (\\ b a -&gt; a + b) b c</code>, or more simply <code>(b + a) - (c + a) - (c + b)</code>. <code>x</code> is a local function equivalent to <code>flip (+)</code>, which of course is equivalent to <code>(+)</code>, since addition of integers is commutative. This is slightly awkward because it reuses the names <code>a</code> and <code>b</code>, <i>shadowing</i> the parameters of <code>f0</code>, which generates a warning if you enable <code>-Wall</code>; an (alpha-)equivalent definition would be <code>x m n = n + m</code>."}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 10701845, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eqch2ODGIlg/AAAAAAAAAAI/AAAAAAAAAAA/shPt2AfJ-zk/photo.jpg?sz=128", "display_name": "TryHardingProgrammingDude", "link": "https://stackoverflow.com/users/10701845/tryhardingprogrammingdude"}, "is_accepted": false, "score": 4, "last_activity_date": 1543146840, "last_edit_date": 1592644375, "creation_date": 1543146628, "answer_id": 53467129, "question_id": 53467046, "link": "https://stackoverflow.com/questions/53467046/haskell-local-definition-and-variables-confused/53467129#53467129", "title": "Haskell, Local definition and variables, confused :/", "body": "<blockquote>\n<blockquote>\n<p>[...] or is it just that the &quot;x&quot; is just another functions which takes two variables and add them [...]</p>\n</blockquote>\n<p>Exactly. <code>x b a = a + b</code> is a function definition (that happens to have local scope). <code>f0 0 0 1 = x 0 0 - x 0 1 - x 0 1</code>. \u2013 <a href=\"https://stackoverflow.com/questions/53467046/haskell-local-definition-and-variables-confused#comment93804866_53467046\">duplode</a></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1543227669, "creation_date": 1543227669, "answer_id": 53479012, "question_id": 53467046, "link": "https://stackoverflow.com/questions/53467046/haskell-local-definition-and-variables-confused/53479012#53479012", "title": "Haskell, Local definition and variables, confused :/", "body": "<p>In some other pseudo language this will look like this. </p>\n\n<pre><code>int function fo(int a, int b, int c){\n  int function x(int a, int b){\n     return a + b;\n  }\n  return x(a,b) - x(a,c) - x(b,c)\n}\n</code></pre>\n\n<p>The way you have put it as a question, </p>\n\n<blockquote>\n  <p>f0 a b c = (a + b) a b - (a + b) a c - (a + b) b c</p>\n</blockquote>\n\n<p>it looks like inline substitution like C macros. It is not simple code substitution. It is more like inline function. X is a function which gets called. </p>\n"}], "owner": {"reputation": 49, "user_id": 10701845, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eqch2ODGIlg/AAAAAAAAAAI/AAAAAAAAAAA/shPt2AfJ-zk/photo.jpg?sz=128", "display_name": "TryHardingProgrammingDude", "link": "https://stackoverflow.com/users/10701845/tryhardingprogrammingdude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1543227669, "creation_date": 1543145838, "last_edit_date": 1543146208, "question_id": 53467046, "link": "https://stackoverflow.com/questions/53467046/haskell-local-definition-and-variables-confused", "title": "Haskell, Local definition and variables, confused :/", "body": "<pre><code>f0 :: Int -&gt; Int -&gt; Int -&gt; Int\n        f0 a b c = x a b - x a c - x b c\n           where x b a = a + b\n</code></pre>\n\n<p>Can someone explain me how the functions knows what to do when it gets to the... </p>\n\n<pre><code>    where x b a = a + b\n</code></pre>\n\n<p>... statement? Does it just translate to something like this?</p>\n\n<pre><code>f0 a b c = (a + b) a b - (a + b) a c - (a + b) b c\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1543142110, "post_id": 53466606, "comment_id": 93803938, "body": "Because you create a function <code>val :: Product -&gt; String</code>, but in the next line you thus construct another function <code>val :: Price -&gt; Double</code>. there is however an extension to allow this: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields</a>"}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543142331, "post_id": 53466606, "comment_id": 93803992, "body": "Thanks, I forgot everything in Haskell is a function!, but in this case it makes my code soooo verbose, it makes you almost desire not to type primitives. But that hack that you link is recommendable or is going against of the Pure functional code?. If it is what it is I can accept that verbosity"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543147140, "post_id": 53466606, "comment_id": 93805042, "body": "Indeed, record fields have this issue in Haskell -- this is probably one of the aspects I dislike the most. The issue can be mitigated a bit with <code>DuplicateRecordFields</code>, which lets you use duplicates and <code>val (... :: Product)</code> and <code>(p :: Product) { val = ... }</code>. Not very good, but not unusable either. Note that type annotations here are in general required, to solve ambiguity. I&#39;d wish that GHC used type inference here, but alas, this is not the case."}], "answers": [{"comments": [{"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1543143318, "post_id": 53466719, "comment_id": 93804203, "body": "Great explanation. I use type class a lot, but for this particular case it feels too much does not it?."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1543143390, "post_id": 53466719, "comment_id": 93804228, "body": "@paul: yes, furthermore it looks like <code>val</code> of <code>Product</code> is not the same as <code>val</code> of <code>Price</code>, so then it is not very sensical to use a typeclass."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543146486, "post_id": 53466719, "comment_id": 93804899, "body": "The very last example can be shortened a bit using <code>val (Product &quot;foo&quot; :: Product)</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1543148582, "last_edit_date": 1543148582, "creation_date": 1543143055, "answer_id": 53466719, "question_id": 53466606, "link": "https://stackoverflow.com/questions/53466606/same-variable-name-in-data-types/53466719#53466719", "title": "Same variable name in Data types", "body": "<blockquote>\n  <p>Why using data types I cannot give same inner attribute name for those Data attributes?</p>\n</blockquote>\n\n<p>If you define a record type, you implicitly have constructed a \"getter\". If you define a record datatype like:</p>\n\n<pre><code>data Product = Product { val :: String } deriving (Show, Eq)\n</code></pre>\n\n<p>then Haskell will construct a function:</p>\n\n<pre><code>val :: Product -&gt; String\n</code></pre>\n\n<p>that obtains the <code>val</code> of a given <code>Product</code> object.</p>\n\n<p>If you then later define a new record datatype:</p>\n\n<pre><code>data Price = Price { val :: Double } deriving (Show, Eq)\n</code></pre>\n\n<p>then you thus define two versions of <code>val</code>, which thus results in name clashes.</p>\n\n<h1>The <code>DuplicateRecordFields</code> extension</h1>\n\n<p>The <em>Glasgow Haskell Compiler (GHC)</em> has, since 8.0.1, an extension <a href=\"https://downloads.haskell.org/~ghc/master/users-guide/glasgow_exts.html#duplicate-record-fields\" rel=\"nofollow noreferrer\"><strong><code>DuplicateRecordFields</code></strong></a> that allows to specify two record datatypes with the same field name.</p>\n\n<p>There is no problem to use the same record name for pattern matching, or when we construct records, for example:</p>\n\n<pre><code>productToPrice :: Product -&gt; Price\nproductToPrice (Product {val = x}) = Price { val = 3 }\n</code></pre>\n\n<p>creates no problems, since <code>val</code> in <code>Product { val = x }</code> clearly refers to the <code>val</code> defined in the <code>Product</code> data constructor, and <code>val</code> in <code>Price { val = 3 }</code> refers to the <code>val</code> of the <code>Price</code> data constructor.</p>\n\n<p>If we however use <code>val</code> as a function, it will create ambiguity:</p>\n\n<pre><code>Prelude&gt; val (Product \"foo\")\n\n&lt;interactive&gt;:15:1: error:\n    Ambiguous occurrence \u2018val\u2019\n    It could refer to either the field \u2018val\u2019,\n                             defined at &lt;interactive&gt;:1:25\n                          or the field \u2018val\u2019, defined at &lt;interactive&gt;:2:21\n</code></pre>\n\n<p>We can add the signature of the function to specify which <code>val</code> we want to use:</p>\n\n<pre><code>Prelude&gt; (val :: Product -&gt; String) (Product \"foo\")\n\"foo\"\n</code></pre>\n\n<p>or by specifying the type of <code>Product \"foo\"</code>, we obtain the same effect:</p>\n\n<pre><code>Prelude&gt; val (Product \"foo\" :: Product)\n\"foo\"\n</code></pre>\n\n<p>Given <code>val</code> however has the same type, or has some generic meaning, it might be better to introduce a typeclass, and thus define the <code>val</code> function there.</p>\n"}], "owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 53466719, "answer_count": 1, "score": 3, "last_activity_date": 1543148582, "creation_date": 1543141872, "last_edit_date": 1543143880, "question_id": 53466606, "link": "https://stackoverflow.com/questions/53466606/same-variable-name-in-data-types", "title": "Same variable name in Data types", "body": "<p>Why using data types I cannot give same inner attribute name for those Data attributes?</p>\n\n<p>Here I cannot reuse the variable name <code>val</code> in several Data</p>\n\n<p>Does not compile</p>\n\n<pre><code>data Product = Product {val::String}deriving (Show, Eq)\ndata Price = Price {val::Double}deriving (Show, Eq)\ndata Discount = Discount { val::Double }deriving (Show, Eq)\n</code></pre>\n\n<p>compile</p>\n\n<pre><code>data Product = Product {productVal::String}deriving (Show, Eq)\ndata Price = Price {priceVal::Double}deriving (Show, Eq)\ndata Discount = Discount { discountVal::Double }deriving (Show, Eq)\n</code></pre>\n"}, {"tags": ["json", "parsing", "haskell", "aeson"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1543144153, "post_id": 53466541, "comment_id": 93804389, "body": "You could construct two data types. One with all the fields, and the one you have. Use Aeson to transform the JSON to the complete data type, then another function to drop the unnecessary fields."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543148227, "post_id": 53466541, "comment_id": 93805319, "body": "One problem seems to be that <code>[Ability]</code> is parsed using the <code>FromJSON</code> instance for lists, which expects an array. But your json has an object instead, with the names of the abilities as the keys."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543149332, "post_id": 53466541, "comment_id": 93805606, "body": "Tip: when developing your parser, use <code>eitherDecodeFileStrict</code> instead of <code>decodeFileStrict</code>. The former gives you an error message than might be useful."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1543150278, "post_id": 53466541, "comment_id": 93805860, "body": "@mb21 I&#39;m not sure if it&#39;ll work. I only know for sure the key, values I need will be in the file. The other ones could be there or the key can be something completely different."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543150503, "post_id": 53466541, "comment_id": 93805926, "body": "@danidiaz Thanks for the suggestion. I rewrote the final statement with <code>eitherDecodeFileStrict</code> and got <code>Left &quot;Error in $.Abilities: expected [a], encountered Object&quot;</code>. Your first assertion was right. How should I fix it? Should I replace <code>[]</code> for <code>Object</code> type or something else? Maybe a <code>HashMap</code>?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1543151016, "post_id": 53466541, "comment_id": 93806040, "body": "@danidiaz I tried it with <code>Map String Ability</code> and got error <code>Left &quot;Error in $.Abilities[&#39;someAbility&#39;]: key \\&quot;Ammo\\&quot; not present&quot;</code>. Seems like I circled the question and got to the start again"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543154169, "post_id": 53466541, "comment_id": 93806838, "body": "@atis Should the <code>Ammo</code> field be optional? In that case you should declare it as something like <code>ammo :: Maybe Double</code> in your datatype, and parse it with <code>.:?</code> <a href=\"http://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson.html#v:.:-63-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson-1.4.2.0/docs/&hellip;</a>"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543155339, "post_id": 53466541, "comment_id": 93807181, "body": "@atis There is a way of composing <code>Parser</code>s with the <code>&lt;|&gt;</code> operator (from the <code>Alternative</code> typeclass) which means &quot;try this parser, if it fails, try this other parser for the same thing&quot;. You could devise a <code>Parser (Maybe Double)</code> that returned <code>Nothing :: Maybe Double</code> when the text is &quot;NA&quot;, and which failed with <code>fail</code> otherwise <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad.html#v:fail\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a> Then you could combine it with the other parser to get the full behaviour for that field."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543155599, "post_id": 53466541, "comment_id": 93807253, "body": "@danidiaz Sorry I accidentally deleted my previous comment trying to edit it. And thanks for the suggestion! I&#39;ll take a look at it!"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543155800, "post_id": 53466541, "comment_id": 93807305, "body": "do you just need the <code>Value</code> of <code>Prime</code> object? how about <code>Dual</code>?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543156805, "post_id": 53466541, "comment_id": 93807614, "body": "@assembly.jc All the objects that fall under <code>Abilities</code>"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543157174, "post_id": 53466541, "comment_id": 93807720, "body": "But <code>Dual</code> no <code>Ammo</code> , <code>Accuracy</code> fields, what value assign to these fields when parses <code>Dual</code> object?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543159789, "post_id": 53466541, "comment_id": 93808496, "body": "@assembly.jc That&#39;s the problem I&#39;m trying to figure out. The necessary value might be there or might not be. As danidiaz suggested, I may need to implement a <code>Parser (Maybe Double)</code> where if it encounters a <code>String</code> it&#39;ll have <code>Nothing</code> as a value, otherwise <code>Just x</code>"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543160767, "post_id": 53466541, "comment_id": 93808803, "body": "@danidiaz Could you possibly link some resources on implementing what you described? Looking around I found how to use <code>&lt;|&gt;</code> in functions but I&#39;m not sure how to implement something similar when defining a type or how to work it in <code>v .: &quot;Accuracy&quot;</code>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543169870, "post_id": 53466541, "comment_id": 93811510, "body": "Side note: you can avoid repeatedly typing <code>pack</code> by enabling the <code>OverloadedStrings</code> extension, which allows you to use string literals as <code>Text</code> (or anything with a <code>GHC.Exts.IsString</code> instance), i.e., <code>v .: &quot;Abilities&quot;</code>. <code>Data.Text</code> is meant to be imported <code>qualified</code>, like <code>import Data.Text (Text); import qualified Data.Text as Text</code> because it exports a lot of names that clash with <code>Prelude</code>."}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 282, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1543167906, "creation_date": 1543141165, "last_edit_date": 1543151311, "question_id": 53466541, "link": "https://stackoverflow.com/questions/53466541/haskell-aeson-parsing-nested-json-with-part-unnecessary-values", "title": "Haskell, Aeson: Parsing nested JSON with part unnecessary values", "body": "<p>I'm a beginner trying to learn more about Haskell and Aeson by parsing some json files I find online.</p>\n\n<p>I have a <code>.json</code> that looks like this</p>\n\n<pre><code>\"Abilities\": {\n    \"Prime\": {\n          \"Ammo\": 210,\n          \"Available\": true,\n          \"Diposition\": 3,\n          \"Type\": \"Secondary\",\n          \"Class\": \"Pistols\",\n          \"NormalAttack\": {\n            \"Chance\": 0.25,\n            \"Streak\": 2,\n            \"Rate\": 2.67,\n            \"ShotType\": \"Hit-Scan\",\n            \"Damage\": {\n              \"Front\": 15,\n              \"Back\": 15,\n              \"Up\": 120,\n              \"Down\": 40\n            },\n              \"Status\": 0.25\n            }\n          \"Accuracy\": 9.8,\n          \"Reload\": 3,\n          \"Name\": \"Prime\",\n          \"Magazine\": 16,\n            },\n    \"Dual\": {\n          \"Name\": \"Dual\",\n          \"Available\": true,\n          \"Diposition\": 4,\n          \"Class\": \"Swords\",\n          \"Type\": \"Melee\",\n          \"NormalAttack\": {\n            \"Chance\": 0.25,\n            \"Streak\": 3,\n            \"Rate\": 1.08,\n            \"Damage\": {\n              \"Down\": 35\n            },\n              \"Status\": 0.15\n      }\n    }\n}\n</code></pre>\n\n<p>The file contains some information that I need, but mostly the ones I don't.</p>\n\n<p>This is what I've tried so far</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nmodule Lib\n    ( someFunc\n    ) where\n\nimport           Data.Aeson\nimport           Data.HashMap.Strict as HS\nimport           Data.Maybe\nimport           Data.Text\nimport           Data.Map.Strict\nimport           GHC.Generics\n\n\nlocation = \"src/this.json\"\n\nsomeFunc :: IO ()\nsomeFunc = putStrLn \"someFunc\"\n\n\n\ndata Abilities = Abilities { abilities :: Map String Ability } deriving (Generic, Show)\n\ninstance FromJSON Abilities where\n  parseJSON = withObject \"Abilities\" $\n    \\v -&gt; Abilities\n    &lt;$&gt; v .: pack \"Abilities\"\n\n\ndata Ability = Ability { ammo         :: Double\n                       , normalAttack :: Effect\n                       , accuracy     :: Double\n                       , name         :: String\n                       , diposition   :: Double\n                       , reload       :: Double\n                       } deriving (Generic, Show)\n\ninstance FromJSON Ability where\n  parseJSON = withObject \"Ability\" $\n    \\v -&gt; Ability\n    &lt;$&gt; v .: pack \"Ammo\"\n    &lt;*&gt; v .: pack \"NormalAttack\"\n    &lt;*&gt; v .: pack \"Accuracy\"\n    &lt;*&gt; v .: pack \"Name\"\n    &lt;*&gt; v .: pack \"Diposition\"\n    &lt;*&gt; v .: pack \"Reload\"\n\n\ndata Effect = Effect { chance :: Double\n                     , streak :: Double\n                     , rate   :: Double\n                     , damage :: Damage\n                     , status :: Double\n                     } deriving (Generic, Show)\n\ninstance FromJSON Effect where\n  parseJSON = withObject \"Effect\" $\n    \\v -&gt; Effect\n    &lt;$&gt; v .: pack \"Chance\"\n    &lt;*&gt; v .: pack \"Streak\"\n    &lt;*&gt; v .: pack \"Rate\"\n    &lt;*&gt; v .: pack \"Damage\"\n    &lt;*&gt; v .: pack \"Status\"\n\n\ndata Damage = Damage { front :: Double\n                     , back  :: Double\n                     , up    :: Double\n                     , down  :: Double\n                     } deriving (Generic, Show)\n\ninstance FromJSON Damage where\n  parseJSON = withObject \"Damage\" $\n    \\v -&gt; Damage\n    &lt;$&gt; v .: pack \"Front\"\n    &lt;*&gt; v .: pack \"Back\"\n    &lt;*&gt; v .: pack \"Up\"\n    &lt;*&gt; v .: pack \"Down\"\n\n\nmain = do\n  x &lt;- eitherDecodeFileStrict location :: IO (Either String Abilities)\n  print x\n</code></pre>\n\n<hr>\n\n<p>I know of several different ways of parsing the info</p>\n\n<ol>\n<li><p>By parsing the file has <code>Aeson Value</code> or <code>Aeson Object</code> and applying <code>Data.HashMap.Strict.toList</code> to convert it in <code>[(k, v)]</code>. The trouble is that on a big file, this method gets really messy.</p></li>\n<li><p>By using several <code>unConstructor</code> functions which work like this</p></li>\n</ol>\n\n<p><code>unConstruct (Constructor x) = case (Constructor x) of</code>\n                              <code>Constructor x -&gt; x</code></p>\n\n<p>But same problem: it gets really unreadable and messy really fast.</p>\n\n<hr>\n\n<p>That's why I want to parse the <code>.json</code> file as shown in the code above.</p>\n\n<hr>\n\n<p>But the parsing is failing somewhere in the code because I'm getting <code>Nothing</code> as an output.</p>\n\n<p>The <code>.json</code> file seems to be fine since if I use</p>\n\n<pre><code>main = do\n  x &lt;- decodeFileStrict location :: IO (Maybe Object)\n  print x\n</code></pre>\n\n<p>it works just fine, printing file's contents with appropriate default aeson data types.</p>\n\n<hr>\n\n<p>What could I be doing wrong?</p>\n\n<hr>\n\n<p>Edit: Implemented fix suggested by @danidiaz in the comments.</p>\n\n<p>Error Msg: <code>Left \"Error in $.Abilities['someAbility']: key \\\"Ammo\\\" not present\"</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543139889, "post_id": 53466359, "comment_id": 93803485, "body": "The operator should be <i>associative</i>, so you can aim to proof that, and then it is a semigroup."}, {"owner": {"reputation": 2963, "user_id": 1528246, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f76f3e46a94eb011d85d14bf54425950?s=128&d=identicon&r=PG", "display_name": "rogergl", "link": "https://stackoverflow.com/users/1528246/rogergl"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543140683, "post_id": 53466359, "comment_id": 93803654, "body": "the operator is associative int this example for valid inputs but the &lt;&gt; operator (or function) is not total in this case and I do not know if this is relevant for the prove or not."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543240594, "post_id": 53466359, "comment_id": 93834982, "body": "The definition of <code>CurrencyAmount</code> would be helpful."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543143375, "post_id": 53466740, "comment_id": 93804225, "body": "Yeah. Division."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543143455, "post_id": 53466740, "comment_id": 93804243, "body": "@n.m. What about division?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1543143546, "post_id": 53466740, "comment_id": 93804264, "body": "Is it total? What&#39;s its domain? To what Haskell type does said domain correspond?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543144046, "post_id": 53466740, "comment_id": 93804367, "body": "@n.m. It&#39;s not uncommon in mathematics that functions can be <a href=\"https://en.wikipedia.org/wiki/Undefined_(mathematics)\" rel=\"nofollow noreferrer\">&quot;undefined&quot; at points not in its domain</a>. Do we consider the zero denominator part of the division function&#39;s domain?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543144137, "post_id": 53466740, "comment_id": 93804382, "body": "@n.m. Not that I don&#39;t get your point. In Haskell, division is clearly not total, so it does invalidate my argument. Do you, however, find the OP instance valid?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543144314, "post_id": 53466740, "comment_id": 93804427, "body": "That&#39;s what I&#39;m asking <i>you</i>. Do we consider the zero denominator part of the division function&#39;s domain? If we do, then it&#39;s a partial function. If we don&#39;t, then its totality is irrelevant for Haskell, because we cannot adequately represent its domain as a Haskell type."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543144501, "post_id": 53466740, "comment_id": 93804481, "body": "No I don&#39;t think it&#39;s valid, not at all. But it&#39;s not because mathematical functions must be total in Haskell, as there are exceptions to this rule. We don&#39;t expect division to be total for all (or any) instances of Num for example. It&#39;s because we always expect <i>this particular function</i> to be total, no exceptions."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543144849, "post_id": 53466740, "comment_id": 93804550, "body": "@n.m. I admit that exceptions exist. I also agree that we expect <code>&lt;&gt;</code> to be total. How can the OP tell? With my answer, I&#39;ve attempted to provide a heuristic."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543145035, "post_id": 53466740, "comment_id": 93804587, "body": "Your answer is mostly great, just instead of saying that all math functions should be total, say that most math function should be total, and exceptions should be drawn from math itself (e.g. division is not defined for zero denominator because field laws say so, not because our particular field has problems with division so we just leave it undefined)."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543145213, "post_id": 53466740, "comment_id": 93804638, "body": "@n.m. Good suggestion; I&#39;ve edited my answer. Thank you."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1543145182, "last_edit_date": 1543145182, "creation_date": 1543143201, "answer_id": 53466740, "question_id": 53466359, "link": "https://stackoverflow.com/questions/53466359/must-the-operator-for-a-semigroup-be-defined-for-all-arguments/53466740#53466740", "title": "Must the operator for a semigroup be defined for all arguments?", "body": "<p>I don't think it's valid.</p>\n\n<p>Most of the lawful type classes in Haskell (e.g. <code>Semigroup</code>, <code>Monoid</code>, <code>Functor</code>, <code>Monad</code>, etc.) derive their laws from mathematics (e.g. category theory).</p>\n\n<p>Mathematics is based on axioms; that is, assertions about the underlying fabric of numbers, geometry, and similar. By definition, axioms can't be proven, but you usually accept them because they make intuitive sense (e.g. the Peano axioms). In a sense, mathematics is built on a foundation of intuition.</p>\n\n<p>The reason that type classes like the above are lawful is that the laws ensure that the instances behave like you'd expect them to behave.</p>\n\n<p>In Haskell, there's great emphasis on being able to <strong>reason about the code</strong>, mostly by just looking at the type signatures of functions. One reason you, as a reader, can feel confident about doing this is that whenever a lawful type class is involved, you know that it'll behave in a non-surprising manner.</p>\n\n<p>Most mathematical functions are <strong>total</strong> (there are exceptions, e.g. division by zero, but exceptions should be drawn from mathematics itself). In light of the above, I'd argue that there's a strong implicit expectation that a type class that derives its laws from mathematics is expected to be total.</p>\n\n<p>The above instance isn't total, which means that it'll behave in a surprising manner for certain inputs. I wouldn't consider it a valid <code>Semigroup</code> instance.</p>\n"}, {"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543152836, "post_id": 53466937, "comment_id": 93806483, "body": "Well one can add a dollar to a pound, and have a dollar <i>and</i> a pound. (Like a vector space of currencies)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543158497, "post_id": 53466937, "comment_id": 93808103, "body": "I don&#39;t think including bottom is a useful approach in practice, as it&#39;s hard to manipulate diverging computations. Can you write a unit test that verifies <code>bottom &lt;&gt; bottom == bottom</code>?"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543160398, "post_id": 53466937, "comment_id": 93808697, "body": "You could say the same for any property involving <code>\u22a5</code> though, including strictness. Furthermore, it&#39;s not that simple to avoid <code>\u22a5</code>. Consider <code>&lt;&gt;</code> defined on function types. The resulting laws establish equalities on (partial) functions. The Semigroup module itself provides the instance <code>Semigroup b =&gt; Semigroup (a -&gt; b)</code>  where <code>f &lt;&gt; g = \\x -&gt; f x &lt;&gt; g x</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543161570, "post_id": 53466937, "comment_id": 93809034, "body": "I can, and I usually do ;) One can <i>reason</i> about the bottom, but one cannot <i>work</i> with it. It is not a useful value --- a program that tries to evaluate it is broken. A program can pass unevaluated bottoms around, but since it cannot look at them, one could replace these bottoms by any other value without affecting the meaning of the program."}, {"owner": {"reputation": 2963, "user_id": 1528246, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f76f3e46a94eb011d85d14bf54425950?s=128&d=identicon&r=PG", "display_name": "rogergl", "link": "https://stackoverflow.com/users/1528246/rogergl"}, "edited": false, "score": 0, "creation_date": 1543219638, "post_id": 53466937, "comment_id": 93823837, "body": "I think I like the vector of currencies approach best."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 3, "last_activity_date": 1543145346, "last_edit_date": 1543145346, "creation_date": 1543144864, "answer_id": 53466937, "question_id": 53466359, "link": "https://stackoverflow.com/questions/53466359/must-the-operator-for-a-semigroup-be-defined-for-all-arguments/53466937#53466937", "title": "Must the operator for a semigroup be defined for all arguments?", "body": "<p>I suppose this is a matter of semantics. The formal and classical mathematical definition of a Semigroup <code>(A,&lt;&gt;)</code> does requires <code>&lt;&gt;</code> to be a function <code>&lt;&gt;:A\u00d7A\u2192A</code>, therefore total. But what is your set <code>A</code>? You need to establish some (naive) set theoretical based semantics for the (Haskell) types and functions you're working with. </p>\n\n<ul>\n<li><p>If the denotation of your types are carrier sets that include <code>\u22a5</code> as an element, then your Haskell functions will be interpreted as total mathematical functions. In this case you just have to make sure the required laws hold for all elements including <code>\u22a5</code>. And in your case they do. </p></li>\n<li><p>If instead you consider a model of sets (without <code>\u22a5</code>) and partial functions, then to match the classic formal mathematical definition of <code>Semigroup</code> you'd need to make sure <code>&lt;&gt;</code> is total in that setting. And in your case it isn't. </p></li>\n</ul>\n\n<p>I don't know whether there is a fixed convention. The second, stricter interpretation seems preferable. But the first is a sensible generalisation.</p>\n\n<p>That said have you considered the possibility of using GADTs to distinguish between different currencies at the type level?  </p>\n"}], "owner": {"reputation": 2963, "user_id": 1528246, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f76f3e46a94eb011d85d14bf54425950?s=128&d=identicon&r=PG", "display_name": "rogergl", "link": "https://stackoverflow.com/users/1528246/rogergl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1543145346, "creation_date": 1543139505, "last_edit_date": 1543143240, "question_id": 53466359, "link": "https://stackoverflow.com/questions/53466359/must-the-operator-for-a-semigroup-be-defined-for-all-arguments", "title": "Must the operator for a semigroup be defined for all arguments?", "body": "<p>Is the example below a correct definition of a semigroup?</p>\n\n<pre><code>instance Semigroup (CurrencyAmount Fixed2) where\n  (&lt;&gt;) (CurrencyAmount a c) (CurrencyAmount _ EMPTY) = CurrencyAmount a c\n  (&lt;&gt;) (CurrencyAmount _ EMPTY) (CurrencyAmount a c) = CurrencyAmount a c\n  (&lt;&gt;) (CurrencyAmount a c1) (CurrencyAmount b c2) | c1 == c2 = CurrencyAmount (a + b) c1\n  (&lt;&gt;) _ _ = error \"currency mismatch\"\n</code></pre>\n"}, {"tags": ["list", "haskell", "map-function"], "comments": [{"owner": {"reputation": 1519, "user_id": 1486848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KNtLf.jpg?s=128&g=1", "display_name": "ShamPooSham", "link": "https://stackoverflow.com/users/1486848/shampoosham"}, "edited": false, "score": 1, "creation_date": 1543133669, "post_id": 53465667, "comment_id": 93802248, "body": "Can you give some example data, what you expect to get, and why it doesn&#39;t work as expected?"}, {"owner": {"reputation": 1519, "user_id": 1486848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KNtLf.jpg?s=128&g=1", "display_name": "ShamPooSham", "link": "https://stackoverflow.com/users/1486848/shampoosham"}, "edited": false, "score": 1, "creation_date": 1543134534, "post_id": 53465667, "comment_id": 93802407, "body": "For the second one, you could simply call sum on the result"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1543134547, "post_id": 53465667, "comment_id": 93802409, "body": "1. Find out what <code>map words [&quot;asd  qwe&quot;]</code> returns. Is this what you want? Is the <i>type</i> of the result OK? 2. How is the desired result of <code>countChars</code> related to the actual result? What is missing to transform one to the other?"}, {"owner": {"reputation": 81, "user_id": 6919456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78b6094b3396750e31b59c661285db9e?s=128&d=identicon&r=PG&f=1", "display_name": "Akos Fajszi", "link": "https://stackoverflow.com/users/6919456/akos-fajszi"}, "edited": false, "score": 0, "creation_date": 1543134886, "post_id": 53465667, "comment_id": 93802474, "body": "Words [&quot;asd qwe&quot;] should give back 2. My problem is that I can&#39;t iterate trough the list to count the words in each element and at the end sum these numbers. CountChars already knew this but I want give back one integer which is the sum of the resulting numbers."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1543137779, "post_id": 53465667, "comment_id": 93803059, "body": "1. <code>Words [&quot;asd qwe&quot;] should give back 2</code> I have asked you to figure out what it <i>does</i>, not what it <i>should do</i>. (And if it <i>should</i> return 2, what <code>length 2</code> is supposed to do then?) 2. Of course you can find a sum of numbers in a list. You just cannot use <code>map</code> for that."}], "answers": [{"tags": [], "owner": {"reputation": 1519, "user_id": 1486848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KNtLf.jpg?s=128&g=1", "display_name": "ShamPooSham", "link": "https://stackoverflow.com/users/1486848/shampoosham"}, "is_accepted": true, "score": 5, "last_activity_date": 1543165281, "last_edit_date": 1543165281, "creation_date": 1543137199, "answer_id": 53466100, "question_id": 53465667, "link": "https://stackoverflow.com/questions/53465667/combining-map-and-length-in-haskell/53466100#53466100", "title": "Combining map and length in Haskell", "body": "<p>For the second one, you just need to call <code>sum</code> on the result. </p>\n\n<pre><code>countChars xs = sum (map (\\w -&gt; length (w)) xs)\n</code></pre>\n\n<p>which can also be rewritten as</p>\n\n<pre><code>countChars xs = sum $ map length xs \n</code></pre>\n\n<p>For the first one, we'll have to calculate the number of words in each element, and finally sum the result. </p>\n\n<p><code>words</code> will give you a list of the words, so after doing <code>map (words) xs</code> (no need to have parentheses around words btw), you'll get the following:</p>\n\n<pre><code>map words [\"asd  qwe\", \"-- Foo\", \"\", \"\\thello world \"] \n=&gt; \n[[\"asd\",\"qwe\"],[\"--\",\"Foo\"],[],[\"hello\",\"world\"]]\n</code></pre>\n\n<p>The first thing you want to do is to get the length of each sublist, which you could fit into your <code>map</code></p>\n\n<pre><code>map (\\x -&gt; length (words x)) xs\n</code></pre>\n\n<p>Now, the result is:</p>\n\n<pre><code>[2,2,0,2]\n</code></pre>\n\n<p>And by running sum on the result, you get 6. So the end result is</p>\n\n<pre><code>countWords :: [String]-&gt; Int\ncountWords xs = sum $ map (\\x -&gt; length (words x)) xs\n</code></pre>\n\n<p>With some syntax sugar, you could do the following, but I find that most beginners are confused by it:</p>\n\n<pre><code>countWords xs = sum $ map (length . words) xs\n</code></pre>\n\n<p>or even better</p>\n\n<pre><code>countWords = sum . map (length . words)\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 6919456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78b6094b3396750e31b59c661285db9e?s=128&d=identicon&r=PG&f=1", "display_name": "Akos Fajszi", "link": "https://stackoverflow.com/users/6919456/akos-fajszi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 976, "favorite_count": 0, "accepted_answer_id": 53466100, "answer_count": 1, "score": -1, "last_activity_date": 1543165281, "creation_date": 1543132740, "last_edit_date": 1543134282, "question_id": 53465667, "link": "https://stackoverflow.com/questions/53465667/combining-map-and-length-in-haskell", "title": "Combining map and length in Haskell", "body": "<p>I have two problems both of them with using map and length\nThe first one should give me back the word count but instead it only count the elements in the list.</p>\n\n<pre><code>countWords :: [String]-&gt; Int\ncountWords xs = length (map (words) xs)\n\ncountWords [\"asd  qwe\", \"-- Foo\", \"\", \"\\thello world \"] =&gt; 4--instead it have six words\n</code></pre>\n\n<p>The second is trickier because it should give back one int for the whole list. I can only count the characters of the individual elements, not the whole.</p>\n\n<pre><code>countChars :: [String]-&gt; [Int] --it should be Int\ncountChars xs = map (\\w -&gt; length (w)) xs \n\ncountChars [\"asd  qwe\", \"-- Foo\", \"\", \"\\thello world \"] =&gt; [8,6,0,13]--it should give back the sum of this list which is 27\n</code></pre>\n"}, {"tags": ["haskell", "euterpea"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 7, "creation_date": 1543110126, "post_id": 53463934, "comment_id": 93799047, "body": "It sounds like there&#39;s some confusion here about how the web works broadly. Can you be a little more specific about what you want to do? You want to be able to load a web page and hear a note play from your browser?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1543113308, "post_id": 53463934, "comment_id": 93799435, "body": "You&#39;d probably be better off not using Haskell for front-end web development."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1543114860, "post_id": 53463934, "comment_id": 93799624, "body": "As @AJFarmar said, Haskell isn&#39;t the best language for this sort of thing, but if you do want to use it then the <a href=\"https://wiki.haskell.org/Threepenny-gui\" rel=\"nofollow noreferrer\">threepenny-gui</a> library is a very nice place to start"}, {"owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1543118173, "post_id": 53463934, "comment_id": 93800040, "body": "@jberryman - yes, for starters I want the note to be played upon page load.  I have broader ambitions, but that&#39;s my MVP."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1543133808, "post_id": 53463934, "comment_id": 93802270, "body": "load Haskell script equivalent to lunch <code>executed file</code> from browser, it may be a complex thing, see: <a href=\"https://stackoverflow.com/questions/31003412/launch-an-exe-from-browser-windows\" title=\"launch an exe from browser windows\">stackoverflow.com/questions/31003412/&hellip;</a>"}], "owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549938285, "creation_date": 1543109485, "last_edit_date": 1549938285, "question_id": 53463934, "link": "https://stackoverflow.com/questions/53463934/how-to-get-haskell-script-to-load-when-a-web-page-loads", "title": "How to get Haskell script to load when a web page loads", "body": "<p>I am super new to Haskell and I am trying to learn it by build a web music project.</p>\n\n<p>I successfully installed Euterpea and got the MIDI set up. I wrote a super basic script that imports Euterpea and plays a note.</p>\n\n<p>I now want to put my script onto my hosted site and have it -- for starters -- automatically run when the page is loaded.</p>\n\n<p>How would I start doing this? Do I need to have a Javascript that calls the Haskell script?</p>\n\n<p>And how do I configure a web-based MIDI to interact with my script?</p>\n"}, {"tags": ["haskell", "monad-transformers", "free-monad"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543095171, "post_id": 53462008, "comment_id": 93796480, "body": "In <code>zipsWith&#39;&#39;</code> and <code>zipsWithRemains</code>, what happens if both streams finish at the same time?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1543095391, "post_id": 53462008, "comment_id": 93796532, "body": "@danidiaz, if the first stream ends, we return its result immediately. That&#39;s necessary to get left catch for <code>mplus</code>, which is defined using <code>zipsWith&#39;</code>. <code>zipsWithRemains</code> helps clarify that somewhat with its asymmetrical result: note the <code>f (Stream f m r)</code> as opposed to the <code>Stream g m s</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543594553, "post_id": 53556266, "comment_id": 93988016, "body": "Hooray! I think I have a reasonably decent intuition for what your <code>Fold</code> types are about, but I get pretty lost in the <code>zipWith</code> and <code>zipsWith&#39;</code> helper functions. Do you think you might be able to add a few comments among them, and perhaps give them more evocative names?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543616565, "post_id": 53556266, "comment_id": 93997240, "body": "I should have realized that <code>zipsWith&#39;&#39;</code> could be gotten for free from <code>zipsWith&#39;</code> in the <code>FT</code> case, thanks to the way the return value is handled there. For <code>Stream</code> or <code>FreeT</code>, that would be expensive! I&#39;m quite curious how well your implementation is likely to be optimized compared to the naive one; I&#39;ll have to play around with that."}], "tags": [], "owner": {"reputation": 2582, "user_id": 2602809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81f4a2c4da5688bcce29b33437e2e0df?s=128&d=identicon&r=PG", "display_name": "abacabadabacaba", "link": "https://stackoverflow.com/users/2602809/abacabadabacaba"}, "is_accepted": true, "score": 7, "last_activity_date": 1543575824, "creation_date": 1543575824, "answer_id": 53556266, "question_id": 53462008, "link": "https://stackoverflow.com/questions/53462008/zipping-free-monad-transformers/53556266#53556266", "title": "Zipping free monad transformers", "body": "<p>I implemented <code>zipsWith'</code>, <code>zipsWith''</code> and <code>zipsWithRemains</code> for <code>FT</code>. My implementation closely mirrors the implementation of <code>zipWith</code> from <a href=\"https://doisinkidney.com/posts/2016-04-17-folding-two-at-once.html\" rel=\"noreferrer\">this blog post</a>.</p>\n\n<p>First, notice that, given <code>zipsWith'</code>, implementing <code>zipsWith''</code> is trivial:</p>\n\n<pre><code>zipsWith''\n  :: (Functor f, Functor g, Monad m)\n  =&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)\n  -&gt; FT f m r\n  -&gt; FT g m s\n  -&gt; FT h m (Either r s)\nzipsWith'' phi a b = zipsWith' phi (Left &lt;$&gt; a) (Right &lt;$&gt; b)\n</code></pre>\n\n<p>So let's implement <code>zipsWith'</code>.</p>\n\n<p>Begin with an expanded and annotated version of <code>zipWith</code> using folds:</p>\n\n<pre><code>newtype RecFold a r = RecFold { runRecFold :: BFold a r }\ntype AFold a r = RecFold a r -&gt; r\ntype BFold a r = a -&gt; AFold a r -&gt; r\n\nzipWith\n  :: forall f g a b c.\n  (Foldable f, Foldable g)\n  =&gt; (a -&gt; b -&gt; c)\n  -&gt; f a\n  -&gt; g b\n  -&gt; [c]\nzipWith c a b = loop af bf where\n  af :: AFold a [c]\n  af = foldr ac ai a\n  ai :: AFold a [c]\n  ai _ = []\n  ac :: a -&gt; AFold a [c] -&gt; AFold a [c]\n  ac ae ar bl = runRecFold bl ae ar\n  bf :: BFold a [c]\n  bf = foldr bc bi b\n  bi :: BFold a [c]\n  bi _ _ = []\n  bc :: b -&gt; BFold a [c] -&gt; BFold a [c]\n  bc be br ae ar = c ae be : loop ar br\n  loop :: AFold a [c] -&gt; BFold a [c] -&gt; [c]\n  loop al bl = al (RecFold bl)\n</code></pre>\n\n<p>And turn it into <code>zipsWith'</code>:</p>\n\n<pre><code>newtype RecFold f m r = RecFold { runRecFold :: BFold f m r }\ntype AFold f m r = m (RecFold f m r -&gt; r)\ntype BFold f m r = m (f (AFold f m r) -&gt; r)\n\nzipsWith'\n  :: forall f g h m r.\n  (Monad m, Functor f, Functor g)\n  =&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)\n  -&gt; FT f m r\n  -&gt; FT g m r\n  -&gt; FT h m r\nzipsWith' phi a b = loop af bf where\n  af :: AFold f m (FT h m r)\n  af = runFT a ai ac\n  ai :: r -&gt; AFold f m (FT h m r)\n  ai r = return $ const $ return r\n  ac :: (x -&gt; AFold f m (FT h m r)) -&gt; f x -&gt; AFold f m (FT h m r)\n  ac am ae = return $ effect . fmap ($ (fmap am ae)) . runRecFold\n  bf :: BFold f m (FT h m r)\n  bf = runFT b bi bc\n  bi :: r -&gt; BFold f m (FT h m r)\n  bi r = return $ const $ return r\n  bc :: (x -&gt; BFold f m (FT h m r)) -&gt; g x -&gt; BFold f m (FT h m r)\n  bc bm be = return $ wrap . flip (phi loop) (fmap bm be)\n  loop :: AFold f m (FT h m r) -&gt; BFold f m (FT h m r) -&gt; FT h m r\n  loop av bv = effect $ fmap ($ (RecFold bv)) av\n</code></pre>\n\n<p>Here, two auxiliary functions are used: <code>effect</code> and <code>wrap</code>.</p>\n\n<pre><code>effect :: Monad m =&gt; m (FT f m r) -&gt; FT f m r\neffect m = FT $ \\hr hy -&gt; m &gt;&gt;= \\r -&gt; runFT r hr hy\n\nwrap :: f (FT f m r) -&gt; FT f m r\nwrap s = FT $ \\hr hy -&gt; hy (\\v -&gt; runFT v hr hy) s\n</code></pre>\n\n<p>Note that the result could be any monad for which these functions are implemented.</p>\n\n<p>To implement <code>zipsWithRemains</code>, start by implementing <code>zipWithRemains</code> for ordinary <code>Foldable</code>s:</p>\n\n<pre><code>data ListWithTail a b = Nil b | Cons a (ListWithTail a b)\ntype Result a b c = ListWithTail c (Either [b] (a, [a]))\nnewtype RecFold a b c = RecFold { runRecFold :: BFold a b c }\ntype AFold a b c = (RecFold a b c -&gt; Result a b c, [a])\ntype BFold a b c = (a -&gt; AFold a b c -&gt; Result a b c, [b])\n\nzipWithRemains\n  :: forall f g a b c.\n  (Foldable f, Foldable g)\n  =&gt; (a -&gt; b -&gt; c)\n  -&gt; f a\n  -&gt; g b\n  -&gt; Result a b c\nzipWithRemains c a b = loop af bf where\n  af :: AFold a b c\n  af = foldr ac ai a\n  ai :: AFold a b c\n  ai = (\\bl -&gt; Nil $ Left $ snd (runRecFold bl), [])\n  ac :: a -&gt; AFold a b c -&gt; AFold a b c\n  ac ae ar = (\\bl -&gt; fst (runRecFold bl) ae ar, ae : snd ar)\n  bf :: BFold a b c\n  bf = foldr bc bi b\n  bi :: BFold a b c\n  bi = (\\ae ar -&gt; Nil $ Right (ae, snd ar), [])\n  bc :: b -&gt; BFold a b c -&gt; BFold a b c\n  bc be br = (\\ae ar -&gt; Cons (c ae be) (loop ar br), be : snd br)\n  loop :: AFold a b c -&gt; BFold a b c -&gt; Result a b c\n  loop al bl = fst al (RecFold bl)\n</code></pre>\n\n<p>Here, the result of a fold is not a function but a 2-tuple containing a function and a value. The latter is used to handle the \"remains\" case.</p>\n\n<p>This can also be adapted to <code>FT</code>:</p>\n\n<pre><code>type Result f g h m r s = FT h m (Either (r, FT g m s) (f (FT f m r), s))\nnewtype RecFold f g h m r s = RecFold { runRecFold :: BFold f g h m r s }\ntype AFold f g h m r s = m (RecFold f g h m r s -&gt; Result f g h m r s, FT f m r)\ntype BFold f g h m r s = m (f (AFold f g h m r s) -&gt; Result f g h m r s, FT g m s)\n\nzipsWithRemains\n  :: forall f g h m r s.\n  (Monad m, Functor f, Functor g)\n  =&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)\n  -&gt; FT f m r\n  -&gt; FT g m s\n  -&gt; Result f g h m r s\nzipsWithRemains phi a b = loop af bf where\n  af :: AFold f g h m r s\n  af = runFT a ai ac\n  ai :: r -&gt; AFold f g h m r s\n  ai r = return (return . Left . (r,) . effect . fmap snd . runRecFold, return r)\n  ac :: (x -&gt; AFold f g h m r s) -&gt; f x -&gt; AFold f g h m r s\n  ac am ae = return (effect . fmap (($ (fmap am ae)) . fst) . runRecFold, wrap $ fmap (effect . fmap snd . am) ae)\n  bf :: BFold f g h m r s\n  bf = runFT b bi bc\n  bi :: s -&gt; BFold f g h m r s\n  bi r = return (return . Right . (,r) . fmap (effect . fmap snd), return r)\n  bc :: (x -&gt; BFold f g h m r s) -&gt; g x -&gt; BFold f g h m r s\n  bc bm be = return (wrap . flip (phi loop) (fmap bm be), wrap $ fmap (effect . fmap snd . bm) be)\n  loop :: AFold f g h m r s -&gt; BFold f g h m r s -&gt; Result f g h m r s\n  loop av bv = effect $ fmap (($ (RecFold bv)) . fst) av\n</code></pre>\n\n<p>I wish Haskell had local types!</p>\n\n<p>This probably answers the question for <code>FT</code>. Regarding <code>FF</code>: this type is designed such that to do anything with it, you first have to convert it to some other monad. So, the question is, which one? It is possible to convert it to <code>Stream</code> or <code>FreeT</code>, and use the functions for those types. It is also possible to convert it to <code>FT</code> and use the above implementations on it. Is there a monad better suited for implementing <code>zipsWith</code>? Maybe.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1544121419, "last_edit_date": 1544121419, "creation_date": 1544033274, "answer_id": 53638282, "question_id": 53462008, "link": "https://stackoverflow.com/questions/53462008/zipping-free-monad-transformers/53638282#53638282", "title": "Zipping free monad transformers", "body": "<p>Applying a bit of <a href=\"https://hackage.haskell.org/package/kan-extensions-5.2/docs/Data-Functor-Coyoneda.html\" rel=\"nofollow noreferrer\">Coyoneda</a> to <a href=\"https://stackoverflow.com/a/53556266/1477667\">abacabadabacaba's answer</a> and doing some juggling yields an implementation that avoids <code>Functor f</code> and <code>Functor g</code> constraints. If those functors have expensive <code>fmap</code>s, this may improve performance. I doubt it's actually better in typical situations where <code>f</code> and <code>g</code> are things like <code>(,) a</code>. I also still don't properly understand what any of this does.</p>\n\n<pre><code>type AFold f m r = m (RecFold f m r -&gt; r)\nnewtype Fish f m r = Fish {unFish :: forall x. (x -&gt; AFold f m r) -&gt; f x -&gt; r}\ntype BFold f m r = m (Fish f m r)\nnewtype RecFold f m r = RecFold { runRecFold :: BFold f m r }\n\nzipsWith'\n  :: forall f g h m r.\n  Monad m\n  =&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)\n  -&gt; FT f m r\n  -&gt; FT g m r\n  -&gt; FT h m r\nzipsWith' phi a b = loop af bf where\n  af :: AFold f m (FT h m r)\n  af = runFT a ai ac\n\n  ai :: r -&gt; AFold f m (FT h m r)\n  ai r = return $ const $ return r\n\n  ac :: (x -&gt; AFold f m (FT h m r)) -&gt; f x -&gt; AFold f m (FT h m r)\n  ac am ae = return $ (lift &gt;=&gt; \\(Fish z) -&gt; z am ae) . runRecFold\n\n  bf :: BFold f m (FT h m r)\n  bf = runFT b bi bc\n\n  bi :: r -&gt; BFold f m (FT h m r)\n  bi r = return $ Fish $ \\_ _ -&gt; return r\n\n  bc :: (x -&gt; BFold f m (FT h m r)) -&gt; g x -&gt; BFold f m (FT h m r)\n  bc bm be = return $ Fish $ \\xa z -&gt; wrap $ phi (\\q -&gt; loop (xa q) . bm) z be\n\n  loop :: AFold f m (FT h m r) -&gt; BFold f m (FT h m r) -&gt; FT h m r\n  loop av bv = lift av &gt;&gt;= ($ (RecFold bv))\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 8, "accepted_answer_id": 53556266, "answer_count": 2, "score": 20, "last_activity_date": 1544121419, "creation_date": 1543090747, "last_edit_date": 1543264571, "question_id": 53462008, "link": "https://stackoverflow.com/questions/53462008/zipping-free-monad-transformers", "title": "Zipping free monad transformers", "body": "<p>The <code>streaming</code> package offers <a href=\"http://hackage.haskell.org/package/streaming-0.2.2.0/docs/Streaming.html#v:zipsWith\" rel=\"noreferrer\">a <code>zipsWith</code> function</a></p>\n\n<pre><code>zipsWith\n  :: (Monad m, Functor h)\n  =&gt; (forall x y. f x -&gt; g y -&gt; h (x, y))\n  -&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r\n</code></pre>\n\n<p>and a slightly more streamlined version,</p>\n\n<pre><code>zipsWith'\n  :: Monad m\n  =&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)\n  -&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r\n</code></pre>\n\n<p>These can be adapted very easily to <a href=\"http://hackage.haskell.org/package/free-5.1/docs/Control-Monad-Trans-Free.html#t:FreeT\" rel=\"noreferrer\"><code>FreeT</code></a> from the <code>free</code> package. But that package offers <a href=\"http://hackage.haskell.org/package/free-5.1/docs/Control-Monad-Trans-Free-Church.html#t:FT\" rel=\"noreferrer\">another version</a> of the free monad transformer:</p>\n\n<pre><code>newtype FT f m a = FT\n  { runFT\n      :: forall r.\n         (a -&gt; m r)\n      -&gt; (forall x. (x -&gt; m r) -&gt; f x -&gt; m r)\n      -&gt; m r }\n</code></pre>\n\n<p>There is also a third (rather simple) formulation:</p>\n\n<pre><code>newtype FF f m a = FF\n  { runFF\n      :: forall n. Monad n\n      =&gt; (forall x. f x -&gt; n x)  -- A natural transformation\n      -&gt; (forall x. m x -&gt; n x)  -- A monad morphism\n      -&gt; n a }\n</code></pre>\n\n<p>It is possible to convert back and forth between <code>FreeT</code> and either <code>FT</code> or <code>FF</code>, which offers an indirect way to implement <code>zipsWith</code> and its relatives for <code>FF</code> and <code>FT</code>. But that seems quite unsatisfying. I seek a more direct solution.</p>\n\n<p>The problem seems related to the challenge of zipping lists using folds. This has been addressed in a paper, <a href=\"https://arxiv.org/abs/1309.5135\" rel=\"noreferrer\">Coroutining Folds with Hyperfunctions</a>, by Launchbury et al, as well as a <a href=\"https://doisinkidney.com/posts/2016-04-17-folding-two-at-once.html\" rel=\"noreferrer\">blog post</a> by Donnacha Kidney. Neither of these are terribly simple, and I have no idea how they might be adapted to the <code>FT</code> or <code>FF</code> contexts.</p>\n\n<hr>\n\n<p>As I've looked into this problem, I've realized that <code>streaming</code> should really offer some more powerful versions. The simplest would be something like</p>\n\n<pre><code>zipsWith''\n  :: Monad m\n  =&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)\n  -&gt; Stream f m r -&gt; Stream g m s -&gt; Stream h m (Either r s)\n</code></pre>\n\n<p>but a more powerful option would include the remainder:</p>\n\n<pre><code>zipsWithRemains\n  :: Monad m\n  =&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)\n  -&gt; Stream f m r\n  -&gt; Stream g m s\n  -&gt; Stream h m (Either (r, Stream g m s)\n                        (f (Stream f m r), s))\n</code></pre>\n\n<p>I would guess that <code>zipsWith''</code> would be no harder than <code>zipsWith'</code>, but that <code>zipsWithRemains</code> might be a bigger challenge in the context of <code>FT</code> or <code>FF</code>, since the remainder will presumably have to be reconstituted somehow.</p>\n\n<h3>Note</h3>\n\n<p>Since there was some confusion previously, let me mention that I am <em>not</em> looking for help writing <code>zipsWithRemains</code> for <code>Stream</code> or <code>FreeT</code>; I am only looking for help with the functions on <code>FT</code> and <code>FF</code>.</p>\n"}, {"tags": ["string", "haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1543084591, "post_id": 53461230, "comment_id": 93793875, "body": "Use <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:words\" rel=\"nofollow noreferrer\"><b><code>words</code></b></a>."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 4, "creation_date": 1543084625, "post_id": 53461230, "comment_id": 93793880, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=String+-%3E+%5BString%5D\" rel=\"nofollow noreferrer\">Entering that type signature into hoogle</a> gives you two options: <code>lines</code> or <code>words</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1543087485, "post_id": 53461230, "comment_id": 93794599, "body": "<i>&quot;...Haskell doesn&#39;t have loops...&quot;</i> Yes, because recursion replaces loops. This is why recursion is helpful here."}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1543088462, "post_id": 53461489, "comment_id": 93794853, "body": "You can use <code>span</code> instead of <code>takeWhile</code> and <code>splitAt</code>"}, {"owner": {"reputation": 81, "user_id": 9842321, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZzCzZ.jpg?s=128&g=1", "display_name": "ClaireBookworm", "link": "https://stackoverflow.com/users/9842321/clairebookworm"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1543088530, "post_id": 53461489, "comment_id": 93794870, "body": "Wow! Thanks!. @4castle In the question, I was asking about using <code>takeWhile</code>, but I definitely think that <code>span</code> would be good too."}], "tags": [], "owner": {"reputation": 675, "user_id": 823070, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd4245c4f3fb543986bc24503177fb2b?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/823070/stefan"}, "is_accepted": true, "score": 5, "last_activity_date": 1543174574, "last_edit_date": 1543174574, "creation_date": 1543086354, "answer_id": 53461489, "question_id": 53461230, "link": "https://stackoverflow.com/questions/53461230/how-would-i-split-a-string-after-the-spaces-in-haskell/53461489#53461489", "title": "How would I split a string after the spaces in haskell?", "body": "<p>If you want to implement that yourself, first thing you need to do is find the first word.\nYou can do that with:</p>\n\n<pre><code>takeWhile (/=' ') s\n</code></pre>\n\n<p>If the string starts with delimiter characters you need to trim those first. We can do that with <code>dropWhile</code>.</p>\n\n<pre><code>takeWhile (/=' ') $ dropWhile (==' ') s\n</code></pre>\n\n<p>Now we have the first word, but we also need the rest of the string starting after the first word, on which we will recurse. We can use <code>splitAt</code>:</p>\n\n<pre><code>(_, rest) = splitAt (length word) s\n</code></pre>\n\n<p>And then we recurse with the <code>rest</code> of the string and cons the first word onto the result of that recursion giving us a list of all words.</p>\n\n<p>And we need to define the base case, the result for the empty string which will terminate the recursion once there are no more characters.</p>\n\n<pre><code>toSplit :: String -&gt; [String]\ntoSplit \"\" = []\ntoSplit s =\n  let word = takeWhile (/=' ') $ dropWhile (==' ') s\n      (_, rest) = splitAt (length word) s\n  in word : toSplit (dropWhile (==' ') rest)\n</code></pre>\n\n<p><strong>Edit:</strong> There is a bug in the code above and it's not handling an edge case properly.</p>\n\n<p>The bug is that it's calling splitAt on the original <code>s</code> but this gives a wrong result if <code>s</code> has leading spaces:</p>\n\n<pre><code>*Main&gt; toSplit \" foo\"\n[\"foo\",\"o\"]\n</code></pre>\n\n<p>This should fix the bug:</p>\n\n<pre><code>let trimmed = dropWhile (==' ') s\n    word = takeWhile (/=' ') trimmed\n    (_, rest) = splitAt (length word) trimmed\n</code></pre>\n\n<p>That leaves one edge case:</p>\n\n<pre><code>*Main&gt; toSplit \" \"\n[\"\"]\n</code></pre>\n\n<p>One possible solution is to use a helper function:</p>\n\n<pre><code>toSplit :: String -&gt; [String]\ntoSplit = splitWords . dropWhile (==' ') \n    where\n        splitWords \"\" = []\n        splitWords s = \n          let word = takeWhile (/=' ') s\n              (_, rest) = splitAt (length word) s\n          in word : splitWords (dropWhile (==' ') rest)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 1, "last_activity_date": 1543134135, "last_edit_date": 1543134135, "creation_date": 1543131161, "answer_id": 53465524, "question_id": 53461230, "link": "https://stackoverflow.com/questions/53461230/how-would-i-split-a-string-after-the-spaces-in-haskell/53465524#53465524", "title": "How would I split a string after the spaces in haskell?", "body": "<blockquote>\n  <p>I know Haskell doesn't have loops, so I can't do that. I also know\n  that recursion is \"helpful\" here...</p>\n</blockquote>\n\n<p><strong>Yes</strong>, Haskell use recursion rather then <code>for</code>, <code>while</code> loop structure that in imperative language. </p>\n\n<p>In stead of write recursive function by myself, it is more common use <code>map</code>, <code>foldr (foldl)</code>, <code>unfoldr</code> or etc recursively traverse the list. The advantage of these functions is that you can concentrate what want to do in <code>step</code> function. Like your question, is suitable use <code>unfoldr</code> to accomplish it.</p>\n\n<p>Here is an example with <code>takeWhile</code> and <code>dropWhile</code>:</p>\n\n<pre><code>import Data.Char (isSpace)\nimport Data.List (unfoldr)\n\ntoSplit::String-&gt;[String]\ntoSplit = unfoldr step \n    where step [] = Nothing\n          step xs = Just (takeWhile (not . isSpace) xs, \n                          (dropWhile isSpace . dropWhile (not . isSpace)) xs) \n</code></pre>\n\n<p>But a little bit verbose, use <code>break</code> function may be more readable like:</p>\n\n<pre><code>toSplit' = unfoldr step\n    where step [] = Nothing\n          step xs = let (word, rest) = break isSpace xs\n                    in  Just (word, dropWhile isSpace rest)\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 9842321, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZzCzZ.jpg?s=128&g=1", "display_name": "ClaireBookworm", "link": "https://stackoverflow.com/users/9842321/clairebookworm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2399, "favorite_count": 0, "accepted_answer_id": 53461489, "answer_count": 2, "score": 0, "last_activity_date": 1543174574, "creation_date": 1543084518, "last_edit_date": 1543085099, "question_id": 53461230, "link": "https://stackoverflow.com/questions/53461230/how-would-i-split-a-string-after-the-spaces-in-haskell", "title": "How would I split a string after the spaces in haskell?", "body": "<p>I know Haskell doesn't have loops, so I can't do that. I also know that recursion is \"helpful\" here, but that's about all I'm aware of. \nSo far, I've gotten a basic type signature, which is </p>\n\n<pre><code>toSplit :: String -&gt; [String]\n</code></pre>\n\n<p>Basically, it changes from a string into a list of words...</p>\n\n<p>Thanks!</p>\n\n<p>P.S. I want to use the <code>takeWhile</code> and <code>dropWhile</code> functions... not a library...</p>\n"}, {"tags": ["haskell", "foldable"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1543081633, "post_id": 53460772, "comment_id": 93793094, "body": "I think it should be read that these properties <b>do</b> need to hold for all well-behaved instances. Not quite sure though."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1543081680, "post_id": 53460772, "comment_id": 93793105, "body": "I think these properties all follow from the laws."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543112954, "post_id": 53460772, "comment_id": 93799394, "body": "That <code>foldl</code> law only works for finitary structures. For an infinite snoc-list, <code>foldl</code> should be better-defined than that."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1543146555, "post_id": 53460772, "comment_id": 93804918, "body": "I think &quot;For a general Foldable structure this should be semantically identical to&quot; is just a circumlocution for &quot;For any Foldable this should be semantically identical to&quot;, or even &quot;This should be semantically identical to&quot;."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1543347593, "post_id": 53460772, "comment_id": 93883653, "body": "Thanks for the comments! I think I&#39;ll try to suggest a less amiguous wording soon."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1543086028, "creation_date": 1543086028, "answer_id": 53461429, "question_id": 53460772, "link": "https://stackoverflow.com/questions/53460772/what-are-some-foldable-instances-that-are-not-general-foldable-structures-in/53461429#53461429", "title": "What are some Foldable instances that are _not_ &quot;general Foldable structures&quot; in the sense of Data.Foldable?", "body": "<p>As I understand it, these are rules that an instance <em>must</em> obey if it defines those optional functions. By default, a <code>Foldable</code> instance only has to define either <code>foldMap</code> or <code>foldr</code>. From one of those two definitions, all the other functions of the type class follow automatically.</p>\n\n<p>Often, however, type classes give you the option to define more of the type class' behaviour. This can be useful if the default, automatic definition of, say, <code>toList</code> is inefficient, and you wish to supply a more efficient implementation. This may be easier to understand for the <code>Monoid</code> type class, which defines <code>mconcat</code> as an optional function \"so that an optimized version can be provided for specific types\".</p>\n\n<p>The laws quoted in the OP are laws that an instance must obey if you choose to define some or all of these functions yourself. As an example of a (nonsensical) type that breaks the rules, consider this <code>Invalid</code> type:</p>\n\n<pre><code>import Data.Foldable\n\ndata Invalid a = Invalid a deriving (Show, Eq)\n\ninstance Foldable Invalid where\n  foldMap f (Invalid x) = f x\n  foldr _ x _ = x -- Unlawful!!\n  toList (Invalid x) = [x]\n</code></pre>\n\n<p>While it only has to define <code>foldMap</code> to be a <code>Foldable</code> instance, this one also defines <code>foldr</code> and <code>toList</code>. While the <code>toList</code> definition is fine, the <code>foldr</code> definition breaks the rules:</p>\n\n<pre><code>*Q53460772 Data.Monoid Data.Foldable&gt; toList $ Invalid 42\n[42]\n*Q53460772 Data.Monoid Data.Foldable&gt; foldMap Sum $ Invalid 42\nSum {getSum = 42}\n*Q53460772 Data.Monoid Data.Foldable&gt; f = \\x acc -&gt; x + acc\n*Q53460772 Data.Monoid Data.Foldable&gt; z = 0\n*Q53460772 Data.Monoid Data.Foldable&gt; (foldr f z . toList) $ Invalid 42\n42\n*Q53460772 Data.Monoid Data.Foldable&gt; foldr f z $ Invalid 42\n0\n</code></pre>\n\n<p>The <code>toList</code> and <code>foldMap</code> functions behave like you'd expect them to behave, but notice that <code>foldr f z</code> doesn't produce the same output as <code>foldr f z . toList</code>.</p>\n\n<p>While <code>Invalid</code> is a nonsensical example, it demonstrates that you can write code that compiles and looks like it provides an instance of <code>Foldable</code>. The laws and rules associated with each function, however, makes it clear that this is not a valid instance.</p>\n"}], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1543086028, "creation_date": 1543081060, "last_edit_date": 1592644375, "question_id": 53460772, "link": "https://stackoverflow.com/questions/53460772/what-are-some-foldable-instances-that-are-not-general-foldable-structures-in", "title": "What are some Foldable instances that are _not_ &quot;general Foldable structures&quot; in the sense of Data.Foldable?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html#t:Foldable\" rel=\"nofollow noreferrer\">documentation for <code>Foldable</code></a> lists several properties that are demanded of &quot;general Foldable structures&quot;:</p>\n<ul>\n<li><p>For <code>foldr</code>:</p>\n<blockquote>\n<p>For a general Foldable structure this should be semantically identical to,</p>\n<pre><code>foldr f z = foldr f z . toList\n</code></pre>\n</blockquote>\n</li>\n<li><p>For <code>foldl</code>:</p>\n<blockquote>\n<p>For a general Foldable structure this should be semantically identical to,</p>\n<pre><code>foldl f z = foldl f z . toList\n</code></pre>\n</blockquote>\n</li>\n<li><p>For <code>foldl'</code> (with what looks like a typo to me):</p>\n<blockquote>\n<p>For a general Foldable structure this should be semantically identical to,</p>\n<pre><code>foldl f z = foldl' f z . toList\n</code></pre>\n</blockquote>\n</li>\n</ul>\n<p>What are some instances of <code>Foldable</code> where these properties need not or cannot hold?</p>\n"}, {"tags": ["string", "list", "haskell", "concat"], "answers": [{"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 3, "last_activity_date": 1543081392, "creation_date": 1543081392, "answer_id": 53460817, "question_id": 53460700, "link": "https://stackoverflow.com/questions/53460700/concatenate-to-a-list-of-string-another-string/53460817#53460817", "title": "Concatenate to a list of string another string", "body": "<p>This</p>\n\n<pre><code>replaceTab' :: Int -&gt; [[Char]] -&gt; [Char]\n</code></pre>\n\n<p>is the same as,</p>\n\n<pre><code>replaceTab' :: Int -&gt; [String] -&gt; String\n</code></pre>\n\n<p>What you should focus on is implementing a function, </p>\n\n<pre><code>replaceTab :: Int -&gt; String -&gt; String\n</code></pre>\n\n<p>which \"fixes\" a single <code>String</code>. Then <code>replaceTabs</code> is simply, </p>\n\n<pre><code>replaceTabs :: Int -&gt; [String] -&gt; [String]\nreplaceTabs n = map (replaceTab n) \n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 6919456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78b6094b3396750e31b59c661285db9e?s=128&d=identicon&r=PG&f=1", "display_name": "Akos Fajszi", "link": "https://stackoverflow.com/users/6919456/akos-fajszi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 53460817, "answer_count": 1, "score": 0, "last_activity_date": 1543081392, "creation_date": 1543080656, "question_id": 53460700, "link": "https://stackoverflow.com/questions/53460700/concatenate-to-a-list-of-string-another-string", "title": "Concatenate to a list of string another string", "body": "<p>The below code gives back a list of String but I want it work on multiple cases. The problem is that I can't create the same exact result with recursion.\nThe program gives back the following result:</p>\n\n<pre><code>replaceTabs 6 [\"\\thello world\"]\n\n=&gt; [\"      hello world\"]\n</code></pre>\n\n<p>Now this should work with a longer list like:</p>\n\n<pre><code>replaceTabs 6 [\"asd dsa\",\"\\thello world\"]\n\n    =&gt; [\"asd dsa\",\"      hello world\"]\n</code></pre>\n\n<p>Simple concat doesn't work, because it will give back undefined pattern.</p>\n\n<pre><code>replaceTab' :: Int -&gt; [[Char]] -&gt; [Char]\nreplaceTab' n [[x]] =\n if x == '\\t' then replicate n ' '\n else [x]\n\nreplaceTabs :: Int -&gt; [String]-&gt; [String]\nreplaceTabs n [\"\"] = [\"\"]\nreplaceTabs n (x:xs) = (return . concat $ [replaceTab' n [a] | a &lt;- (map (:[]) (x))])\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "lua-table"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543081353, "post_id": 53460618, "comment_id": 93793030, "body": "You may check <a href=\"https://github.com/hslua/hslua-aeson\" rel=\"nofollow noreferrer\">hslua-aeson</a> package. It seems to have instances to push and receive Aeson&#39;s Value type to and from the Lua stack."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543089542, "post_id": 53460618, "comment_id": 93795141, "body": "@Redu From its README.md it seems like the package does JSON to Lua. Is converting Lua to JSON possible with that package?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543090328, "post_id": 53460618, "comment_id": 93795319, "body": "@Redu This is what I tried <code>main = do   openlibs    dofile &quot;src&#47;configfile.lua&quot;   wData &lt;- getglobal &quot;Data&quot; *&gt; peek (-1)   liftIO $ print (wData :: Value) </code> after removing <code>local</code> from the <code>.lua</code> file."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543091950, "post_id": 53460618, "comment_id": 93795711, "body": "Sorry.. i have no experience with Lua - Haskell workflow at all. It was just an idea. Have you tried going through the <a href=\"https://github.com/hslua/hslua-aeson/blob/master/src/Foreign/Lua/Aeson.hs\" rel=\"nofollow noreferrer\">code</a>?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1543130353, "post_id": 53460618, "comment_id": 93801720, "body": "No worries! The code you linked does seem to convert Lua table values to Haskell in <code>Peekable</code> instance. It might just work! I&#39;ll just need to work out how it operates."}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1543080105, "creation_date": 1543080105, "question_id": 53460618, "link": "https://stackoverflow.com/questions/53460618/haskell-converting-a-lua-table-to-haskell-workable-types", "title": "Haskell: Converting a .lua table to Haskell workable types", "body": "<p>I'm a beginner trying to practice coding haskell by translating some simple repo from different languages to Haskell.</p>\n\n<p>Many simple games use .lua to store character/ability data. </p>\n\n<p>What I want is to take that .lua table and convert it into haskell workable types.</p>\n\n<p>This is what the .lua file looks like</p>\n\n<pre><code>local Data =\n{\n[\"Weapons\"] = {\n    [\"AB\"] = {\n        Name = \"AB\",\n        Cost = {\n            Spells = 65000,\n            BCost = 15000,\n            MCost = 150,\n            sh = 35,\n            Time = 24,\n            Parts = {\n                { Name = \"Top\",Type = \"Item\",Count = 1,},},\n        },\n        Resist = 0.85,\n        Class = \"Shield\",\n        Attack = {\n            Damage = {\n                [\"First\"] = 5,\n                [\"Second\"] = 5,\n                [\"Third\"] = 40,},\n            Chance = 0.2,\n            X = 2,\n        },\n    },\n    [\"PG\"] = {\n    ...\n    ...\n    ...\n}\n\nreturn Data\n</code></pre>\n\n<p>When woking with Aeson, there's this simple function <code>decode</code> which you can use as <code>decode someJSON :: Maybe Object</code> and get the entirety of JSON file content put in default Aeson datatypes which you can work on with library functions. I haven't been able to find something similar for <code>.lua</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "edited": false, "score": 3, "creation_date": 1543068017, "post_id": 53458844, "comment_id": 93789400, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/9141794/how-does-one-call-on-this-haskell-function\">How does one call on this Haskell function?</a>"}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "edited": false, "score": 0, "creation_date": 1543068293, "post_id": 53458844, "comment_id": 93789495, "body": "@RobinGreen that post is not clear on how should I call the function."}, {"owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "edited": false, "score": 0, "creation_date": 1543068443, "post_id": 53458844, "comment_id": 93789536, "body": "What is unclear about the answer to that question?"}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "edited": false, "score": 0, "creation_date": 1543068620, "post_id": 53458844, "comment_id": 93789584, "body": "@RobinGreen my question is how do i call the function, more specifically the last parameter. The post you suggested talks about the Random function.   When I call my function I have NO IDEA on what to use in the third parameter.  Could you just help? It would be much easier ...  Check this: <a href=\"http://prntscr.com/lmeyyd\" rel=\"nofollow noreferrer\">prntscr.com/lmeyyd</a>"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1543069039, "post_id": 53458844, "comment_id": 93789707, "body": "<code>Random</code> from the linked post is not a function, it is a type class. It can be read as &#39;anything that a RNG can produce&#39;. Both your function and the function from the linked post use the same RNG, <code>StdGen</code>, and any source of these mentioned in answers there is applicable to your question as well."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543072330, "post_id": 53458844, "comment_id": 93790667, "body": "If all you want is to test your function from GHCi, you can use <code>g &lt;- getStdGen</code> and then <code>ran_lst 1.0 (1.0,100.0) g</code>. Note that this is a <i>function</i>, and because of that you&#39;ll get the same output if you call it with the same <code>g</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1543073451, "post_id": 53458844, "comment_id": 93790966, "body": "See <a href=\"http://hackage.haskell.org/package/random-1.1/docs/System-Random.html#t:StdGen\" rel=\"nofollow noreferrer\">the docs</a> for the definition of a <code>StdGen</code>."}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543082236, "post_id": 53458844, "comment_id": 93793249, "body": "@chi that was all I needed! Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "is_accepted": false, "score": -1, "last_activity_date": 1543082273, "creation_date": 1543082273, "answer_id": 53460934, "question_id": 53458844, "link": "https://stackoverflow.com/questions/53458844/haskell-randomize-float/53460934#53460934", "title": "Haskell - Randomize Float", "body": "<p>As @chi said, first I need to call <code>g &lt;- getStdGen</code> and only then run the function</p>\n"}], "owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1543082273, "creation_date": 1543067625, "question_id": 53458844, "link": "https://stackoverflow.com/questions/53458844/haskell-randomize-float", "title": "Haskell - Randomize Float", "body": "<p>I am trying to call this function that my professor has done but I don't understand how to call the last parameter!</p>\n\n<pre><code>ran_lst :: Float -&gt; (Float, Float) -&gt; StdGen -&gt; ([Float], StdGen)\n</code></pre>\n\n<p>I have tried something like:</p>\n\n<pre><code>ran_lst 1.0 (1.0,100.00) ?\n</code></pre>\n\n<p>The <strong>?</strong> denotes what should I call inside!</p>\n\n<p>Thanks!!</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "edited": false, "score": 0, "creation_date": 1543067232, "post_id": 53458611, "comment_id": 93789168, "body": "Thanks, How do I generate 1 and print to the console? I tried running arbitraryLetter and got an error :  \u2022 No instance for (Show (Gen Letter))         arising from a use of \u2018print\u2019     \u2022 In a stmt of an interactive GHCi command: print it"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "edited": false, "score": 1, "creation_date": 1543069250, "post_id": 53458611, "comment_id": 93789766, "body": "@Eyzuky - You can use <code>sample</code> in ghci: <code>sample arbitraryLetter</code>."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 1, "last_activity_date": 1543065996, "creation_date": 1543065996, "answer_id": 53458611, "question_id": 53458498, "link": "https://stackoverflow.com/questions/53458498/generate-choose-on-custom-data-type-with-2-options/53458611#53458611", "title": "Generate choose on custom data type with 2 options", "body": "<p><code>choose</code> has type <code>Random a =&gt; (a, a) -&gt; Gen a</code>, so <code>choose (G, B)</code> requires a <code>Random</code> instance for your <code>Letter</code> type. If you want to create a generator from a set of values you can use <code>elements</code> instead:</p>\n\n<pre><code>arbitraryLetter :: Gen Letter\narbitraryLetter = elements [G, B]\n</code></pre>\n"}], "owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 53458611, "answer_count": 1, "score": 0, "last_activity_date": 1543065996, "creation_date": 1543065148, "question_id": 53458498, "link": "https://stackoverflow.com/questions/53458498/generate-choose-on-custom-data-type-with-2-options", "title": "Generate choose on custom data type with 2 options", "body": "<p>I am trying to achieve something very simple.\nI have this data type :</p>\n\n<pre><code>import Test.QuickCheck\nimport System.Random\ndata Letter = G | B deriving(Show, Eq, Bounded)\n\narbitraryLetter :: Gen Letter\narbitraryLetter = choose (G,B)\n</code></pre>\n\n<p>I am compiling and getting this error</p>\n\n<pre><code>    \u2022 No instance for (Random Letter) arising from a use of \u2018choose\u2019\n    \u2022 In the expression: choose (G, B)\n      In an equation for \u2018arbitraryLetter\u2019:\n      arbitraryLetter = choose (G, B)\n</code></pre>\n\n<p>Why isn't this working?\nI want to be able to use QuickCheck on this data type.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1543062248, "post_id": 53458039, "comment_id": 93787934, "body": "How do you start your haskell program? What is its current working directory? If you use relative paths in source code, they will be resolved relative to the current working directory."}, {"owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1543063125, "post_id": 53458039, "comment_id": 93788132, "body": "I just do <code>cabal run</code>. I tried putting it everywhere though and it didn&#39;t work. I figured out what to do though."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1543130654, "post_id": 53458039, "comment_id": 93801761, "body": "If you figured it out, write your own answer, so people understand, what your problem was."}], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "is_accepted": false, "score": 5, "last_activity_date": 1543063335, "creation_date": 1543063335, "answer_id": 53458255, "question_id": 53458039, "link": "https://stackoverflow.com/questions/53458039/how-do-i-import-a-text-file-in-a-cabal-project/53458255#53458255", "title": "How do I import a text file in a cabal project?", "body": "<p>add</p>\n\n<pre><code>data-dir: data\n</code></pre>\n\n<p>in the top section of the cabal file.</p>\n\n<p>create the directory 'data' next to src and app, and put all files in there.</p>\n\n<p>Make sure your cabal file also has this line</p>\n\n<pre><code>other-modules:\n  Paths_CCompiler\n</code></pre>\n\n<p>with your project's name instead of CCompiler.</p>\n\n<p>My main function is now this</p>\n\n<pre><code>module Main where\n\nimport Lib\nimport System.IO\nimport Paths_CCompiler\n\nmain = do\n    filepath &lt;- getDataFileName \"return_2.c\"\n    contents &lt;- readFile filepath\n    print $ Lib.lex contents\n    return contents\n</code></pre>\n\n<p>Thanks to <a href=\"http://neilmitchell.blogspot.com/2008/02/adding-data-files-using-cabal.html\" rel=\"noreferrer\">this blog post</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 0, "last_activity_date": 1543130611, "creation_date": 1543130611, "answer_id": 53465482, "question_id": 53458039, "link": "https://stackoverflow.com/questions/53458039/how-do-i-import-a-text-file-in-a-cabal-project/53465482#53465482", "title": "How do I import a text file in a cabal project?", "body": "<p>I understand your question to be about finding files at runtime, which you want to process and aren't packaged with your package.</p>\n\n<p>Where are severals ways, how you could find files at runtime, which aren't packaged.</p>\n\n<p>Either add an command line flag and call your executable with the absolute path of the file you want to process.</p>\n\n<p>Or implement a file chooser dialog, with e.g. <code>gi-gtk</code>.</p>\n\n<p>Or hard coding relative paths which isn't advisable, as they are interpreted relative to the current working directory of your process, which can be different, depending on how the program did get started.</p>\n\n<p>If you want to determine, which current working directory your program runs in, if started with <code>cabal run</code>, just do a litte test project with the following cabal file:</p>\n\n<pre><code>name: test2\nbuild-type: Simple\ncabal-version: &gt;= 1.10\nversion: 0.0.0.1\n\nexecutable test2\n  hs-source-dirs: .\n  main-is: test2.hs\n  build-depends:\n      base\n    , directory\n</code></pre>\n\n<p>and the following <code>test2.hs</code>:</p>\n\n<pre><code>module Main where\n\nimport System.Directory\n\nmain :: IO ()\nmain = do\n  cwd &lt;- getCurrentDirectory\n  putStrLn cwd\n</code></pre>\n"}], "owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1543130611, "creation_date": 1543061645, "question_id": 53458039, "link": "https://stackoverflow.com/questions/53458039/how-do-i-import-a-text-file-in-a-cabal-project", "title": "How do I import a text file in a cabal project?", "body": "<p>In app/Main.hs, I want to open a text file, \"foo.txt\". I know how to open a text file in a plain Haskell program. In my cabal project, </p>\n\n<pre><code>import System.IO\n\nMain = do\n    contents &lt;- readFile \"foo.txt\"\n    print $ Main.lex contents\n    return contents\n\n\ntype Keyword = String\nlex :: String -&gt; [Keyword]\nlex \"\" = []\nlex x = words x\n</code></pre>\n\n<p>gives the error</p>\n\n<blockquote>\n  <p>openFile: does not exist (No such file or directory)</p>\n</blockquote>\n\n<p>What do I need to change in my cabal file, or the file path or location to be able to open the file? I've tried putting it next to the output binary, and that doesn't work either.</p>\n\n<p>This is my cabal file:</p>\n\n<pre><code>-- This file has been generated from package.yaml by hpack version 0.28.2.\n--\n-- see: https://github.com/sol/hpack\n--\n-- hash: baf2fc7e230f4b4937dfd918a13fefb55b66c7a4468b24d0e3e90cad675b26d5\n\nname:           CCompiler\nversion:        0.1.0.0\ndescription:    Please see the README on GitHub at &lt;https://github.com/githubuser/CCompiler#readme&gt;\nhomepage:       https://github.com/githubuser/CCompiler#readme\nbug-reports:    https://github.com/githubuser/CCompiler/issues\nauthor:         Author name here\nmaintainer:     example@example.com\ncopyright:      2018 Author name here\nlicense:        BSD3\nlicense-file:   LICENSE\nbuild-type:     Simple\ncabal-version:  &gt;= 1.10\nextra-source-files:\n    ChangeLog.md\n    README.md\n\nsource-repository head\n  type: git\n  location: https://github.com/githubuser/CCompiler\n\nlibrary\n  exposed-modules:\n      Lib\n  other-modules:\n      Paths_CCompiler\n  hs-source-dirs:\n      src\n  build-depends:\n      base &gt;=4.7 &amp;&amp; &lt;5\n  default-language: Haskell2010\n\nexecutable CCompiler-exe\n  main-is: Main.hs\n  other-modules:\n      Paths_CCompiler\n  hs-source-dirs:\n      app\n  ghc-options: -threaded -rtsopts -with-rtsopts=-N\n  build-depends:\n      CCompiler\n    , base &gt;=4.7 &amp;&amp; &lt;5\n  default-language: Haskell2010\n\ntest-suite CCompiler-test\n  type: exitcode-stdio-1.0\n  main-is: Spec.hs\n  other-modules:\n      Paths_CCompiler\n  hs-source-dirs:\n      test\n  ghc-options: -threaded -rtsopts -with-rtsopts=-N\n  build-depends:\n      CCompiler\n    , base &gt;=4.7 &amp;&amp; &lt;5\n  default-language: Haskell2010\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1063, "user_id": 4098186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NE30h.jpg?s=128&g=1", "display_name": "eozd", "link": "https://stackoverflow.com/users/4098186/eozd"}, "edited": false, "score": 0, "creation_date": 1543057990, "post_id": 53457521, "comment_id": 93786992, "body": "How do you plan to print the functions? Do you just want to not show them at all, or print some placeholder strings for the functions?"}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "reply_to_user": {"reputation": 1063, "user_id": 4098186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NE30h.jpg?s=128&g=1", "display_name": "eozd", "link": "https://stackoverflow.com/users/4098186/eozd"}, "edited": false, "score": 0, "creation_date": 1543058163, "post_id": 53457521, "comment_id": 93787028, "body": "I don\u2019t mind not showed"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 4, "creation_date": 1543058871, "post_id": 53457521, "comment_id": 93787194, "body": "see: <a href=\"https://wiki.haskell.org/Show_instance_for_functions\" rel=\"nofollow noreferrer\">Why is there no Show instance for functions</a>"}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1543059955, "post_id": 53457521, "comment_id": 93787418, "body": "Thanks for the link. I will keep the ticket open as a reference. If you rather response I will mark the question as answered"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543060430, "post_id": 53457521, "comment_id": 93787512, "body": "Okay, if it is useful, I post it as answer for other persons reference later."}], "answers": [{"tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 7, "last_activity_date": 1543059493, "creation_date": 1543059493, "answer_id": 53457726, "question_id": 53457521, "link": "https://stackoverflow.com/questions/53457521/deriving-show-eq-with-function-in-data-types/53457726#53457726", "title": "deriving (Show, Eq) with function in data types", "body": "<p>As already mentioned in the comments, you cannot derive a <code>Show</code> instance if your data type contains functions. The best you can do is to implement the instance yourself. E.g.:</p>\n\n<pre><code>instance Show Event where\n  show (BasketCreated x)   = \"BasketCreated \" ++ show x\n  show (ProductAdded x _)  = \"ProductAdded \"  ++ show x\n  show (DiscountAdded x _) = \"DiscountAdded \" ++ show x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 3, "last_activity_date": 1543060730, "creation_date": 1543060730, "answer_id": 53457908, "question_id": 53457521, "link": "https://stackoverflow.com/questions/53457521/deriving-show-eq-with-function-in-data-types/53457908#53457908", "title": "deriving (Show, Eq) with function in data types", "body": "<p>There is no <code>Show</code> instance for functions. the reason why it cannot be an instance of <code>Show</code>, please refers: <a href=\"https://wiki.haskell.org/Show_instance_for_functions\" rel=\"nofollow noreferrer\">Show instance for functions</a></p>\n"}], "owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 0, "accepted_answer_id": 53457908, "answer_count": 2, "score": -1, "last_activity_date": 1543060730, "creation_date": 1543057784, "last_edit_date": 1543060004, "question_id": 53457521, "link": "https://stackoverflow.com/questions/53457521/deriving-show-eq-with-function-in-data-types", "title": "deriving (Show, Eq) with function in data types", "body": "<p>I have some data types which as one argument I have functions</p>\n\n<pre><code>data Event =\n   BasketCreated{basket:: Basket}\n  | ProductAdded{ basket::Basket, addProductInBasket :: Basket -&gt; String -&gt; Int -&gt; Basket}\n  | DiscountAdded{ basket::Basket, addDiscountInBasket :: Basket  -&gt; Int -&gt; Basket }\n  deriving (Show, Eq)\n</code></pre>\n\n<p>unfortunately since my data type contains functions <code>deriving (Show, Eq)</code> is not compiling.</p>\n\n<p>Any idea how can I <code>deriving (Show)</code> with functions to be able to print that data type</p>\n"}, {"tags": ["haskell", "quickcheck"], "owner": {"reputation": 196, "user_id": 7091261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35bf483cee23e4cc151e0dd710f1fc5e?s=128&d=identicon&r=PG&f=1", "display_name": "Ak-Mo", "link": "https://stackoverflow.com/users/7091261/ak-mo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "closed_date": 1543055272, "answer_count": 0, "score": 1, "last_activity_date": 1543053564, "creation_date": 1543052051, "last_edit_date": 1543053564, "question_id": 53456880, "link": "https://stackoverflow.com/questions/53456880/haskell-quickcheck-for-testing-n-ary-tree-eval", "closed_reason": "Duplicate", "title": "Haskell QuickCheck for testing n-ary tree eval", "body": "<p>I have a n-ary tree defined as follows:</p>\n\n<pre><code>data Tree = Leaf1 | Leaf2 | Tree ([Tree]) \n</code></pre>\n\n<p>and I have a function</p>\n\n<pre><code>eval :: Tree -&gt; int\n</code></pre>\n\n<p>which returns the winner (<code>Leaf1</code> indicates that player one won, <code>Leaf2</code> indicates that player two won)</p>\n\n<p>I've been trying to write a test for <code>eval</code> using <a href=\"http://hackage.haskell.org/package/QuickCheck\" rel=\"nofollow noreferrer\">QuickCheck</a> but I  can't seem to understand how it works for recursive data types and how to write tests for this function</p>\n"}, {"tags": ["haskell", "testing", "quickcheck"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 5, "creation_date": 1543027414, "post_id": 53454691, "comment_id": 93781932, "body": "Welcome to Stack Overflow! Could you please explain your question some more so that it&#39;s more specific? What failing attempts have you made?"}, {"owner": {"reputation": 5, "user_id": 10667327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e23c761da4059b5288b375fc129ae8a8?s=128&d=identicon&r=PG&f=1", "display_name": "Goat2", "link": "https://stackoverflow.com/users/10667327/goat2"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1543028623, "post_id": 53454691, "comment_id": 93782078, "body": "I have to create a test function with the information about the function. I know how tests are structured, but I do not know what I can test on this function.  What should my test function show in this example?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1543053239, "creation_date": 1543053239, "answer_id": 53457007, "question_id": 53454691, "link": "https://stackoverflow.com/questions/53454691/test-for-positions-function/53457007#53457007", "title": "Test for positions- function", "body": "<p>A possible test could perform the following operations:</p>\n\n<ul>\n<li>randomly generate <code>xs, ys :: [Int]</code> and <code>y :: Int</code></li>\n<li>define <code>list = xs ++ y : ys</code></li>\n<li>test <code>length xs `elem` positions y list</code></li>\n</ul>\n\n<p>You might also want to write tests for missing elements.</p>\n\n<p>That being said, it's weird to craft tests from the code. One should design test using the <em>specification</em> used to write the code instead. Otherwise, if the code has some quirks, they end up in tests as well: instead of checking for what the code should do, we check for what the code does, which can be pointless.</p>\n"}, {"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 0, "last_activity_date": 1543100358, "creation_date": 1543100358, "answer_id": 53463105, "question_id": 53454691, "link": "https://stackoverflow.com/questions/53454691/test-for-positions-function/53463105#53463105", "title": "Test for positions- function", "body": "<p>Good question! I had a bit of trouble with this too when I started using <code>QuickCheck</code>, but as I used it more I started to get a feel for what sort of properties you should test. Often, a good place to start is to think about what sort of relationships should hold between the input(s) and output. Your function finds the indices of an element in a list; now what properties should hold in this case? Here's two which I can think of:</p>\n\n<ol>\n<li>The list of indices should have the same number of elements as there are occurrences of the value in the list.</li>\n<li>Each index should correspond to the correct value.</li>\n</ol>\n\n<p>And here's an outline of how these properties could be tested:</p>\n\n<ol>\n<li>Generate a random list, apply <code>positions</code> to it, then count the number of indices returned and check that it matches with the number of occurrences of the searched value.</li>\n<li>Generate a random list, then apply <code>positions</code> to it and check that the element at each of the returned indices is the value which was searched for.</li>\n</ol>\n\n<p>I also think that <a href=\"https://stackoverflow.com/a/53457007/7345298\">@chi's answer</a> makes a good point in saying that you should design tests from the specification rather than the code; this ties in with what I was saying above, in that a specification can help you find relationships between input(s) and output which may not be immediately apparent from the code.</p>\n"}], "owner": {"reputation": 5, "user_id": 10667327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e23c761da4059b5288b375fc129ae8a8?s=128&d=identicon&r=PG&f=1", "display_name": "Goat2", "link": "https://stackoverflow.com/users/10667327/goat2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1543100358, "creation_date": 1543026633, "last_edit_date": 1543027285, "question_id": 53454691, "link": "https://stackoverflow.com/questions/53454691/test-for-positions-function", "title": "Test for positions- function", "body": "<pre><code>positions :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions x xs = [i | (x',i) &lt;- zip xs [0..], x == x']\n</code></pre>\n\n<p>i need to create a Test function for the positions function, which passes the quickcheck.</p>\n\n<p>Does someone has an idea?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1543027361, "post_id": 53454632, "comment_id": 93781920, "body": "Please don&#39;t edit unrelated questions into your post. Ask them as separate questions instead."}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1543026594, "post_id": 53454663, "comment_id": 93781819, "body": "Thanks for letting me know, I was hoping I could use guards within do blocks because I much prefer their look and space-saving ability compared to if-then-else."}], "tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": false, "score": 2, "last_activity_date": 1543026194, "creation_date": 1543026194, "answer_id": 53454663, "question_id": 53454632, "link": "https://stackoverflow.com/questions/53454632/haskell-guards-involving-boolean-operations-and-do/53454663#53454663", "title": "Haskell Guards involving Boolean Operations and Do", "body": "<p>Guards can only be inserted in function definitions (in the form <code>func a b | condition = ...</code>) and <code>case</code> blocks (in the form <code>case x of pattern | condition -&gt; ...</code>); you can't insert them inside <code>do</code> blocks the way you're trying to.  You will need to use <code>if ... then ... else</code> here instead.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1543028527, "post_id": 53454778, "comment_id": 93782065, "body": "The second clause of your final segment should really just pattern-match on Koen, rather than using an == guard."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1543029106, "post_id": 53454778, "comment_id": 93782143, "body": "Could have done that, true. But not just in the final segment. Before I could also have done e.g. <code>foo &quot;Koen&quot;  = &quot;How is this a parse error&quot;</code> and then <code>foo  _  = &quot;Line 11 looks fine to me&quot;</code>. Just didn&#39;t think mixing pattern matching and guards was worth the added complication. Particularly since he seemed keen on using guards"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543051833, "post_id": 53454778, "comment_id": 93785672, "body": "I like these styles, but I have mixed feelings about the <code>n</code> in the last <code>case n</code>. On one hand, I&#39;d write <code>case ()</code> instead, since we ignore that value and only use guards. On the other hand, we are considering the possible values for <code>n</code> in the guards, so writing <code>n</code> there documents this fact."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543060354, "post_id": 53454778, "comment_id": 93787492, "body": "Not sure myself. I feel the <code>n</code> there adds readability, but I can see the arguments against it. A <code>case | cond -&gt; ...</code>  construct without the pattern matching would look nice, but I suppose not useful enough to justify yet another extension of the language."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543171444, "post_id": 53454778, "comment_id": 93811958, "body": "@JorgeAdriano: There is the <code>MultiWayIf</code> extension, which provides <code>if | cond1 -&gt; \u2026 | cond2 -&gt; \u2026 | cond3 -&gt; \u2026</code>, if that\u2019s what you mean by your <code>case | cond -&gt; \u2026</code> notation."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543172973, "post_id": 53454778, "comment_id": 93812389, "body": "@JonPurdy Yes, meanwhile I saw it on chi&#39;s answer to this question. Indeed it&#39;s a much nicer way to inline that piece of code."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 2, "last_activity_date": 1543027979, "creation_date": 1543027979, "answer_id": 53454778, "question_id": 53454632, "link": "https://stackoverflow.com/questions/53454632/haskell-guards-involving-boolean-operations-and-do/53454778#53454778", "title": "Haskell Guards involving Boolean Operations and Do", "body": "<p>There's many ways to go about this. I'd suggest you consider moving that piece of code out of the <code>do</code> block to its own function. </p>\n\n<pre><code>for n :: String -&gt; IO ()\nfoo n | n == \"Simon\" ||\n        n == \"John\"  ||\n        n == \"Phil\"  = putStrLn \"Help me make this stuff\"\n      | n == \"Koen\"  = putStrLn \"How is this a parse error\"\n      |otherwise     = putStrLn \"Line 11 looks fine to me\"\n</code></pre>\n\n<p>And then call it in your <code>do</code> block,</p>\n\n<pre><code>main = do\n    putStrLn \"What is your name?\"\n    n &lt;- getLine\n    foo n\n</code></pre>\n\n<p>Also it may be more sensible to make your auxiliary function \"pure\", </p>\n\n<pre><code>for n :: String -&gt; String\nfoo n | n == \"Simon\" ||\n        n == \"John\"  ||\n        n == \"Phil\"  = \"Help me make this stuff\"\n      | n == \"Koen\"  = \"How is this a parse error\"\n      |otherwise     = \"Line 11 looks fine to me\"\n</code></pre>\n\n<p>and call it via, </p>\n\n<pre><code>main = do\n    putStrLn \"What is your name?\"\n    n &lt;- getLine\n    putStrLn (foo n)\n</code></pre>\n\n<p>If you prefer you can also make the 1st guard simpler, </p>\n\n<pre><code>foo n | n `elem` [\"Simon\", \"John\", \"Phil\"] = \"Help me make this stuff\"\n      | n == \"Koen\" = \"How is this a parse error\"\n      |otherwise    = \"Line 11 looks fine to me\"\n</code></pre>\n\n<p>If you really want to inline it in the <code>do</code> block then you could adapt one of those solutions via a case construction, e.g. </p>\n\n<pre><code>main = do\n    putStrLn \"What is your name?\"\n    n &lt;- getLine\n    putStrLn $ case n of\n      _ | n `elem` [\"Simon\", \"John\", \"Phil\"] -&gt; \"Help me make this stuff\"\n      _ | n == \"Koen\" -&gt; \"How is this a parse error\"\n      _               -&gt; \"Line 11 looks fine to me\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1543115537, "post_id": 53456947, "comment_id": 93799720, "body": "Multiwayif sure looks interesting and useful, how do I enable this extension? Is it part of a library?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1543137766, "post_id": 53456947, "comment_id": 93803057, "body": "@Sagarmatha You need to add the line <code>{-# LANGUAGE MultiWayIf #-}</code> at the top of the file as I show above."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1543052633, "creation_date": 1543052633, "answer_id": 53456947, "question_id": 53454632, "link": "https://stackoverflow.com/questions/53454632/haskell-guards-involving-boolean-operations-and-do/53456947#53456947", "title": "Haskell Guards involving Boolean Operations and Do", "body": "<p>To complement the other answers, I'll add two alternatives (not necessarily better ones).</p>\n\n<pre><code>main = do\n    putStrLn \"What is your name?\"\n    n &lt;- getLine\n    case () of\n       _ | n == \"Simon\" || n == \"John\" || n == \"Phil\"\n            -&gt; putStrLn \"Help me make this stuff\"\n         | n == \"Koen\" \n            -&gt; putStrLn \"How is this a parse error\"\n         | otherwise\n            -&gt; putStrLn \"Line 11 looks fine to me\"\n</code></pre>\n\n<p>This requires the <code>MultiWayIf</code> extension to be turned on.</p>\n\n<pre><code>{-# LANGUAGE MultiWayIf #-}  --  at the top of the file\n\nmain = do\n    putStrLn \"What is your name?\"\n    n &lt;- getLine\n    if | n == \"Simon\" || n == \"John\" || n == \"Phil\"\n          -&gt; putStrLn \"Help me make this stuff\"\n       | n == \"Koen\" \n          -&gt; putStrLn \"How is this a parse error\"\n       | otherwise\n          -&gt; putStrLn \"Line 11 looks fine to me\"\n</code></pre>\n\n<p>Remember that even after <code>otherwise</code> we need <code>-&gt;</code>, or we trigger a parse error.</p>\n"}], "owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1545316349, "creation_date": 1543025596, "last_edit_date": 1545316349, "question_id": 53454632, "link": "https://stackoverflow.com/questions/53454632/haskell-guards-involving-boolean-operations-and-do", "title": "Haskell Guards involving Boolean Operations and Do", "body": "<p>I'm just starting to learn Haskell using the wikibook, doing fine so far since I have taken very basic courses in HS with Visual Basic and Java, but some of the exotic features of Haskell are confusing me when trying to combine more than one. One of the wikibooks has a exercise problem in writing three different strings based on certain names given as input for the user. This is fine when using if-then-else statements, but when I try to use guards I am getting a parsing error on row 6.</p>\n\n<pre><code>    main = do\n        putStrLn \"What is your name?\"\n        n &lt;- getLine\n        |(n == \"Simon\") || (n == \"John\") || (n == \"Phil\")\n            = putStrLn \"Help me make this stuff\"\n        |n == \"Koen\" = putStrLn \"How is this a parse error\"\n        |otherwise \"Line 11 looks fine to me\"\n\nWhich reads \" error: parse error on input \u2018|\u2019\"\nIs this a problem with the guard | or the operator ||? the error lists it is on 6:9 if that helps.\n</code></pre>\n\n<p>EDIT: I have another question regarding a very similar topic now that someone has answered my first question. Wikibooks Haskell tutorials has listed this as another solution to their exercise, using where statements instead of if-then-else:</p>\n\n<pre><code>main = do\n  putStrLn \"Hello, what is your name?\"\n  name &lt;- getLine\n  putStrLn (message name)\n    where\n    greatlanguage   = \"I think Haskell is a great programming language.\"\n    message \"Simon\" = greatlanguage\n    message \"John\"  = greatlanguage\n    message \"Phil\"  = greatlanguage\n    message \"Koen\"  = \"I think debugging Haskell is fun.\"\n    message _       = \"Sorry, I don't know you.\"\n</code></pre>\n\n<p>Is it possible to use the || operator to somehow condense the 3 Simon, John, and Phil lines that call greatlanguage into a single line? </p>\n"}, {"tags": ["haskell", "dependencies", "code-coverage", "haskell-stack", "quickcheck"], "answers": [{"tags": [], "owner": {"reputation": 126, "user_id": 4129231, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-S2wRYUYqhp8/AAAAAAAAAAI/AAAAAAAAAIE/KEqsaIbsJ34/photo.jpg?sz=128", "display_name": "David Baynard", "link": "https://stackoverflow.com/users/4129231/david-baynard"}, "is_accepted": true, "score": 3, "last_activity_date": 1543164555, "last_edit_date": 1543164555, "creation_date": 1543153546, "answer_id": 53468096, "question_id": 53454130, "link": "https://stackoverflow.com/questions/53454130/where-do-i-define-arbitrary-instances/53468096#53468096", "title": "Where do I define Arbitrary instances?", "body": "<p>I'd usually pick the separate package option \u2014 but then I don't use <code>stack test --coverage</code>. Thanks for introducing me to it!</p>\n\n<p>(Edit: I'd probably do this, and then use the test flag option only for running <code>stack test --coverage --flag thepackage:arbitrary</code> so that nobody else has to deal with the flags.)</p>\n\n<p>It may also be worth raising the <code>--coverage</code> issue on the <code>stack</code> issue tracker, as it would be good for the coverage check to work in this case.</p>\n\n<p>You ask for other options \u2014 the best one is probably a test flag.</p>\n\n<h1>A test flag</h1>\n\n<p>It is possible to define a flag in your cabal file (defaulting to false) which will only build the modules with your QuickCheck dependency if the flag is selected.</p>\n\n<p>Place the required code in the directory <code>arbitrary</code> (for example). Then add the equivalent of the following to the relevant parts of your <code>package.yaml</code> (1st snippet) or <code>the-library.cabal</code> (2nd snippet) file: </p>\n\n<pre><code>flags:\n  arbitrary:\n    description: Compile with arbitrary instances\n    default: false\n    manual: true\n\nlibrary:\n  \u205d\n  when:\n  - condition: flag(arbitrary)\n    dependencies:\n    - QuickCheck\n    source-dirs:\n    - arbitrary\n</code></pre>\n\n\n\n<pre><code>flag arbitrary\n  description: Compile with arbitrary instances\n  manual: True\n  default: False\n\nlibrary\n  \u205d\n  if flag(arbitrary)\n    hs-source-dirs:\n      arbitrary\n    build-depends:\n      QuickCheck\n</code></pre>\n\n<p>Then, packages which want to use the instances should add the following in their <code>stack.yaml</code> (1st) or <code>cabal.project</code> (2nd) files:</p>\n\n<pre><code>flag:\n  the-library:\n    arbitrary: true\n</code></pre>\n\n\n\n<pre><code>constraints: the-library +arbitrary\n</code></pre>\n\n<p>But there's a slight problem\u2026 there is currently no way for that library to only depend on the <code>+arbitrary</code> version in only its test suite, unless it also defines such a flag. This may be a price worth paying.</p>\n\n<p>Note: I haven't tested the downstream packaging, yet.</p>\n\n<p><a href=\"https://ivanmiljenovic.wordpress.com/2010/09/03/test-dependencies-in-cabal/\" rel=\"nofollow noreferrer\">Ivan Milenovic's blog</a> was useful as an initial resource.</p>\n\n<h1>DerivingVia/Generic instances</h1>\n\n<p>There may be another possibility, now that GHC 8.6 has been released, with <code>DerivingVia</code>. There's a case study in <a href=\"https://www.kosmikus.org/DerivingVia/deriving-via-paper.pdf\" rel=\"nofollow noreferrer\">Bl\u00f6ndal, L\u00f6h &amp; Scott (2018)</a> for <code>Arbitrary</code> instances.</p>\n\n<p>You would create newtype wrappers, and implement <code>Arbitrary</code> for those newtypes.</p>\n\n<p>It doesn't quite avoid the problem, as is. But you may be able to implement <code>Generic</code> for those newtypes in such a way that the instances derivable using <code>generic-arbitrary</code> match what you'd want.</p>\n\n<hr>\n\n<p>There may be some other options. In particular, <code>QuickCheck</code>'s dependencies aren't actually that heavy. And there are other testing libraries, too. Plus, note that there has been some discussion of separating an <code>Arbitrary</code>-like typeclass into a standalone library.</p>\n\n<p>I would also have suggested internal libraries, but that doesn't allow other packages to use your instances.</p>\n"}], "owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 53468096, "answer_count": 1, "score": 3, "last_activity_date": 1543164555, "creation_date": 1543018635, "last_edit_date": 1543115412, "question_id": 53454130, "link": "https://stackoverflow.com/questions/53454130/where-do-i-define-arbitrary-instances", "title": "Where do I define Arbitrary instances?", "body": "<p>I can't figure out where to define <code>Arbitrary</code> instances for my datatype. If I put it <em>in</em> the package, then the package unnecessarily has to have <code>QuickCheck</code> as a dependency. If I put it <em>in</em> the tests, then other packages can't make use of the instance. If I put it in a separate test-utils package then the tests <em>also</em> have to live in a separate package so it's an orphan instance and <em>also</em> <code>stack test --coverage</code> doesn't work.</p>\n\n<p>What other options are there?</p>\n"}, {"tags": ["haskell", "error-handling", "exception-handling", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 1030, "user_id": 521806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PaOw7.jpg?s=128&g=1", "display_name": "Juan Pablo Santos", "link": "https://stackoverflow.com/users/521806/juan-pablo-santos"}, "edited": false, "score": 3, "creation_date": 1543017447, "post_id": 53453944, "comment_id": 93780618, "body": "<code>ExceptT</code> is a monad transformer. When explaining monad transformers like <code>ExceptT</code>, I often find it useful to think of it as a lightweight wrapper around <code>m (Either e a)</code>, where <code>m</code> is any monad. For instance, using <code>ExceptT e IO a</code> rather than <code>IO (Either e a)</code> allows you to use <code>IO</code>&#39;s monad instance with <code>Either</code>&#39;s monad instance without composing them yourself (by <code>fmap</code>ping twice for example). I can add more details if nobody replies first."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 1030, "user_id": 521806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PaOw7.jpg?s=128&g=1", "display_name": "Juan Pablo Santos", "link": "https://stackoverflow.com/users/521806/juan-pablo-santos"}, "edited": false, "score": 0, "creation_date": 1543019418, "post_id": 53453944, "comment_id": 93780934, "body": "@JuanPabloSantos: One way of looking at this question is simply: which is better for potential consumers of my package and why? For my internal uses I don&#39;t really care much (I can easy convert) but what&#39;s the most flexible for potential users of my package&#39;s API: what, for example, can they do with the <code>Except</code> version that they can&#39;t do with the <code>Either</code> version?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1543046325, "post_id": 53453944, "comment_id": 93784609, "body": "For an example of the kind of problems addressed by <code>ExceptT</code> see e.g. this recent question and its answers: <a href=\"https://stackoverflow.com/q/53426475/126014\">stackoverflow.com/q/53426475/126014</a>"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1543063110, "post_id": 53456278, "comment_id": 93788126, "body": "[1/2] &quot;Retconning&quot; isn&#39;t a bad way to describe it. Originally there was <code>ErrorT</code>, but the  <code>Monad</code> instance for that transformer demanded a spurious <code>Error</code> constraint on the left type. <code>EitherT</code>, which is very much like the <code>MaybeT</code> you mention, was introduced, in a separate library, to avoid that. When <i>transformers</i> decided to correct the misstep, it was decided to not adopt <code>EitherT</code> wholesale, but rather rename it to <code>ExceptT</code> and introduce the <code>Except</code> synonym."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1543063117, "post_id": 53456278, "comment_id": 93788129, "body": "[2/2] Supporters of that choice argue that <code>Either</code> is supposed to be a neutral sum type that shouldn&#39;t be tied to exception semantics. It is a similar argument to that often made against instances of <code>Functor</code> and friends for tuples. For a closer look at the arguments, see <a href=\"https://mail.haskell.org/pipermail/libraries/2013-August/020565.html\" rel=\"nofollow noreferrer\">this thread in the libraries mailing list</a>. Personally, I think having <code>ExceptT</code> instead of <code>EitherT</code> just creates avoidable confusion, as seen in this very question."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1543082278, "post_id": 53456278, "comment_id": 93793254, "body": "This is very helpful. Online there&#39;s a lot of confusing and contradictory advice on how to approach errors in Haskell, some of it sounds out of date, and most of it veers towards dogma or at best deep theory. <code>Either</code> seems a pretty natural choice for most purposes. I expect that <code>ExceptT</code> is something that&#39;s useful when it&#39;s useful (and then the problem at hand makes it clear why it&#39;s useful)."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1543082345, "post_id": 53456278, "comment_id": 93793275, "body": "Could you elaborate a bit more on &quot;uneffectful&quot;? That&#39;s a big part fo what was confusing me."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1543084239, "post_id": 53456278, "comment_id": 93793788, "body": "@orome The <code>Identity</code> monad is a no-op monad that adds no additional &#39;effects&#39;. Haskell exists in relationship with mathematics (particularly category theory), so if a &#39;thing&#39; exists in mathematics, you can frequently find it in Haskell as well, even if it&#39;s, at first glance, of limited value. <code>Identity</code> fits that category well. At first glance, it&#39;s not evident how it adds any value, but it can be used to turn a monadic API into an API without effects, in case you need that."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1543084720, "post_id": 53456278, "comment_id": 93793910, "body": "Yes, that&#39;s a good way to characterize it. One of the things that&#39;s unfortunate here is the nomenclature. <code>Except</code> is pretty misleading (as is <code>ExceptT</code>). If it had been <code>EitherT</code> I think I&#39;d have seem the light sooner."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 10, "last_activity_date": 1543046211, "creation_date": 1543046211, "answer_id": 53456278, "question_id": 53453944, "link": "https://stackoverflow.com/questions/53453944/what-purpose-does-the-complexity-of-except-serve-in-haskell/53456278#53456278", "title": "What purpose does the complexity of `Except` serve in Haskell?", "body": "<h1>Abstract</h1>\n\n<p>Use <code>Either</code> for normal <em>success/error</em> APIs. It's defined in the <em>base</em> library, so it doesn't push other dependencies on a consumer. Also, this is one of the most basic Haskell types, so 'everyone' understands how it works.</p>\n\n<p>Only use <code>ExceptT</code> if you specifically need to combine <code>Either</code> with another monad (such as, for example <code>IO</code>). This type is defined in the <em>transformers</em> library, so pushes an extra dependency on consumers. Additionally, monad transformers is a more advanced feature of Haskell, so you can't expect everyone to understand how to use it.</p>\n\n<h1>Speculation on reasons</h1>\n\n<p>I wasn't around when those decisions were made, but <a href=\"https://www.reddit.com/r/haskell/comments/3ded39/why_cant_we_have_an_eithert_in_transformers/\" rel=\"noreferrer\">it seems that there are various historical reasons for the confusion</a>. Haskell is an <em>old</em> language (older than Java!), so even though efforts have been made to streamline it and rectify old mistakes, some still remain. As far as I can tell, the <code>Either</code>/<code>ExceptT</code> confusion is one of those situations.</p>\n\n<p>I'm <em>speculating</em> that <code>Either</code> is older than the concept of monad transformers, so I imagine that the type <code>Either</code> was introduced to the <em>base</em> library early in the history of Haskell.</p>\n\n<p>The same thing seems to be the case with <code>Maybe</code>.</p>\n\n<p>Other monads, likes e.g. <em>Reader</em> and <em>State</em> seem to have been introduced (or at least 'retconned') together with their monad transformers. For example, <code>Reader</code> is just a <em>special case</em> of <code>ReaderT</code>, where the 'other' <code>Monad</code> is <code>Identity</code>:</p>\n\n<pre><code>type Reader r = ReaderT r Identity\n</code></pre>\n\n<p>The same goes for <code>StateT</code>:</p>\n\n<pre><code>type State s = StateT s Identity\n</code></pre>\n\n<p>That's the general pattern for many of the monads defined in the <em>transformers</em> library. <code>ExceptT</code> just follows the pattern by defining <code>Except</code> as the special case of <code>ExceptT</code>.</p>\n\n<p>There are exceptions to that pattern. For example, <code>MaybeT</code> doesn't define <code>Maybe</code> as a special case. Again, I believe that this is for historical reasons; <code>Maybe</code> was probably around long before anyone started work on the <em>transformers</em> library.</p>\n\n<p>The story about <code>Either</code> seems even more convoluted. As far as I can tell, there <em>was</em>, originally, an <code>EitherT</code> monad transformer, but apparently (I forget the details) there was something wrong with the way that it behaved (it probably broke some laws), so it was replaced with another transformer called <code>ErrorT</code>, which again turned out to be wrong. Third time's the charm, I suppose, so <code>ExceptT</code> was introduced.</p>\n\n<p>The <code>Control.Monad.Trans.Except</code> module follows the pattern of most other monad transformers by defining the 'uneffectful' special case using a type alias:</p>\n\n<pre><code>type Except e = ExceptT e Identity\n</code></pre>\n\n<p>I suppose it does that because it can, but it may be unfortunate, because it's confusing. There's definitely prior art that suggests that a monad transformer doesn't have to follow that pattern (e.g. <code>MaybeT</code>), so I think it would have been better if the module hadn't done that, but it does, and that's where we are.</p>\n\n<p>I would essentially ignore the <code>Except</code> type and use <code>Either</code> instead, but use <code>ExceptT</code> if a transformer is required.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1144, "favorite_count": 1, "accepted_answer_id": 53456278, "answer_count": 1, "score": 8, "last_activity_date": 1543046211, "creation_date": 1543016527, "last_edit_date": 1543019513, "question_id": 53453944, "link": "https://stackoverflow.com/questions/53453944/what-purpose-does-the-complexity-of-except-serve-in-haskell", "title": "What purpose does the complexity of `Except` serve in Haskell?", "body": "<p>I <a href=\"https://stackoverflow.com/a/53192859/656912\">understand</a> (I think) that there is a close relationship between <code>Either</code> and <code>Except</code> in Haskell, and that it is easy to convert from one to the other. But I'm a bit confused about best practices for handling errors in Haskell and under what circumstances and scenarios I would choose one over the other. For example, in the <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Except.html#g:3\" rel=\"noreferrer\">example</a> provided in <code>Control.Monad.Except</code>, <code>Either</code> is used in the definition</p>\n\n<pre><code>type LengthMonad = Either LengthError\n</code></pre>\n\n<p>so that <code>calculateLength \"abc\"</code> is</p>\n\n<pre><code>Right 3\n</code></pre>\n\n<p>If instead one were to define</p>\n\n<pre><code>type LengthMonad = Except LengthError\n</code></pre>\n\n<p>then <code>calculateLength \"abc\"</code> would be</p>\n\n<pre><code>ExceptT (Identity (Right 3))\n</code></pre>\n\n<p>I'm confused about what purpose this would serve and when one one want it. Why does everything returned from <code>calculateLength</code> always have <code>Identity</code>; why not just <code>SomeExceptionType (Right 3)</code> or even <code>SomeSuccessType 3</code>?</p>\n\n<p>I'm a Haskell beginner when it comes to concepts like this, so a concrete example of when I'd want the latter over the former would be much appreciated, especially why it's so (apparently to me) complex. For example, what can a caller of a function that uses the <code>Except</code> version of <code>calculateLength</code> do, that they can't (or at least can't as easily) do with the <code>Either</code> version?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543015731, "post_id": 53452943, "comment_id": 93780334, "body": "Personally, I consider &quot;calling <code>foldr</code> with more than 3 arguments&quot; a Haskell antipattern, even if some haskellers apparently like that style. It isn&#39;t an horribly bad antipattern, but in such cases, I&#39;d rather use explicit recursion, which is easier to read."}, {"owner": {"reputation": 153, "user_id": 7519300, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70bdb81f265f9e2024b3ca01ad959737?s=128&d=identicon&r=PG&f=1", "display_name": "Eduard6421", "link": "https://stackoverflow.com/users/7519300/eduard6421"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543016237, "post_id": 53452943, "comment_id": 93780417, "body": "I completely agree. This implementation is only for educational purposes. Thank you for your feedback!"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543021034, "post_id": 53452943, "comment_id": 93781145, "body": "@chi I&#39;d write it that way in any case I want to participate in fusion. That&#39;s not a trivial improvement in the good cases."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1543023214, "post_id": 53452943, "comment_id": 93781402, "body": "In this particular case though I wouldn&#39;t say it&#39;s a case of <code>foldr</code> vs &quot;explicit recursion though&quot;. The <code>foldr</code> is calculating a function <code>\\n s -&gt;  (sum xs + s) &#47; (length xs + n)</code> to then obtain <code>(sum xs) &#47; (length xs)</code> via application to zeros. That&#39;s just not a very sensible thing to do. Essentially what it computes is <code>(sum xs, length xs)</code> and it would simpler to implement the fold so it returns that pair and then do the division."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543053520, "post_id": 53452943, "comment_id": 93786036, "body": "@JorgeAdriano Agreed, but I&#39;d use <code>foldl&#39;</code> to compute the pair <code>(sum xs, length xs)</code> since <code>foldr</code> would be inefficient for that."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543065255, "post_id": 53452943, "comment_id": 93788651, "body": "@chi sure I meant in terms of clarity only. For efficiency I think even <code>foldl&#39;</code> alone isn&#39;t enough since pairs aren&#39;t strict."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543069236, "post_id": 53452943, "comment_id": 93789763, "body": "@JorgeAdriano One can always use <code>foldl&#39; (\\ (!s,!len) x -&gt; (s+x, len+1)) (0,0) xs</code> which should run in constant space. Alternatively, force the pair components before constructing the pair."}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 7519300, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70bdb81f265f9e2024b3ca01ad959737?s=128&d=identicon&r=PG&f=1", "display_name": "Eduard6421", "link": "https://stackoverflow.com/users/7519300/eduard6421"}, "edited": false, "score": 0, "creation_date": 1543007844, "post_id": 53452978, "comment_id": 93778554, "body": "I meant that it firstly evaluates the operation <code>op</code> on last element of the list  <code>l</code> and the <code>unit</code> which I&#39;ve supplied. The question is related to how the accumulator parameters are sent to <code>unit</code> ."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1543008702, "post_id": 53452978, "comment_id": 93778821, "body": "No, it first evaluates op on the first element, and the result from the recursive call.  If the op ignores its second argument the recursive call never happens."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 153, "user_id": 7519300, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70bdb81f265f9e2024b3ca01ad959737?s=128&d=identicon&r=PG&f=1", "display_name": "Eduard6421", "link": "https://stackoverflow.com/users/7519300/eduard6421"}, "edited": false, "score": 1, "creation_date": 1543015362, "post_id": 53452978, "comment_id": 93780271, "body": "@Eduard6421 You are thinking that in, say, <code>f x (f y z)</code> we start from evaluating <code>f y z</code> but this is not correct. That would be the case in an eager language, but in a lazy language we really start from the first call to <code>f</code> passing <code>x</code> and a thunk representing an unevaluated <code>f y z</code>."}], "tags": [], "owner": {"reputation": 720, "user_id": 10696884, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TZLhm3qAv5U/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gTJ8AUH3mkzlYyEQgF0K4AqDVXLw/mo/photo.jpg?sz=128", "display_name": "Thomas Lang", "link": "https://stackoverflow.com/users/10696884/thomas-lang"}, "is_accepted": false, "score": 3, "last_activity_date": 1543007505, "creation_date": 1543007505, "answer_id": 53452978, "question_id": 53452943, "link": "https://stackoverflow.com/questions/53452943/how-is-the-accumulator-parameter-sent-to-the-function/53452978#53452978", "title": "How is the accumulator parameter sent to the function?", "body": "<p><code>foldr</code> will apply the function still from the beginning to the end of the collection, not in any reverse order.</p>\n\n<p>The definition of <code>foldr</code> gives you insight in how it works. Key difference to <code>foldl</code> is the order of parentheses.</p>\n\n<p><a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl%27\" rel=\"nofollow noreferrer\">More details here</a></p>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 4, "last_activity_date": 1543008474, "creation_date": 1543008474, "answer_id": 53453114, "question_id": 53452943, "link": "https://stackoverflow.com/questions/53452943/how-is-the-accumulator-parameter-sent-to-the-function/53453114#53453114", "title": "How is the accumulator parameter sent to the function?", "body": "<blockquote>\n  <p>I understand that foldr will firstly apply the operator op for the last element in the list </p>\n</blockquote>\n\n<p>I'm not completely sure you are understanding that bit either. Firstly lets look at the type of <code>foldr</code> (specialised to lists) and its definition.</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr f e []     = e \nfoldr f e (x:xs) = f x (foldr f xs)\n</code></pre>\n\n<p>The <code>a</code> in this case is <code>Double</code> and <code>b</code> is <code>Double -&gt; Double -&gt; Double</code>. The former you know it's <code>Double</code> because you are folding a list of doubles. The latter is the type of <code>unit</code>, which is what you return in the empty case. </p>\n\n<p>So what your <code>foldr</code> is doing is calculating a function of type <code>Double -&gt; Double -&gt; Double</code> from a list of doubles. In the empty case you simply return the function, </p>\n\n<pre><code>unit n sum = sum / n\n</code></pre>\n\n<p>which is the function that divides its second argument for the first. That is (/) but with its arguments swapped. In each step of the fold you modify that binary function using an element of the list. You modify it via <code>op</code></p>\n\n<pre><code>op :: Double -&gt; (Double -&gt;Double -&gt;Double) -&gt; (Double -&gt; Double -&gt; Double)\n(x `op` y ) n sum = y (n+1) (sum +x)\n</code></pre>\n\n<p>I really dislike the letter <code>y</code> there as it makes it look like a double. Let's rewrite that as an <code>h</code>. And lets abstract over <code>n</code> and <code>sum</code> too, using a lambda to make it easier to understand what's going on. </p>\n\n<pre><code>op :: Double -&gt; (Double -&gt;Double -&gt;Double) -&gt; (Double -&gt; Double -&gt; Double)\n(x `op` h) = \\n sum -&gt; h (n+1) (sum +x)\n</code></pre>\n\n<p>So given a double value <code>x</code> from the list, and a binary function <code>h</code> calculated thus far (which initially is <code>unit</code>) we are going calculate a new function, </p>\n\n<pre><code>\\n sum -&gt; h (n+1) (sum+x)\n</code></pre>\n\n<p>which is just like the previous function <code>h</code> except it sums <code>1</code> to the first argument and <code>x</code> to the second before applying <code>h</code>. </p>\n\n<p>So in the end for a list <code>[x1, x2, x3]</code> that fold will return the function, </p>\n\n<pre><code>\\n sum -&gt; (x1+x2+x3+sum) / (1+1+1+n)\n</code></pre>\n\n<p>And when you apply that to the two zeros you get, </p>\n\n<pre><code>  (\\n sum -&gt; (x1+x2+x3+sum) / (1+1+1+n)) 0 0 \n= (x1+x2+x3+0) / (1+1+1+0)\n= (x1+x2+x3) / (1+1+1)\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 7519300, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70bdb81f265f9e2024b3ca01ad959737?s=128&d=identicon&r=PG&f=1", "display_name": "Eduard6421", "link": "https://stackoverflow.com/users/7519300/eduard6421"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 53453114, "answer_count": 2, "score": 3, "last_activity_date": 1543008474, "creation_date": 1543007166, "question_id": 53452943, "link": "https://stackoverflow.com/questions/53452943/how-is-the-accumulator-parameter-sent-to-the-function", "title": "How is the accumulator parameter sent to the function?", "body": "<p>In the following code I am unable to understand how the accumulator parameters are sent.</p>\n\n<pre><code>meanFold :: [Double] -&gt; Double\nmeanFold l = (foldr op unit l) 0 0\n    where\n        unit :: Double -&gt; Double -&gt; Double\n        unit n sum = sum / n\n        op :: Double -&gt; (Double -&gt;Double -&gt;Double) -&gt; (Double -&gt; Double -&gt; Double)\n        (x `op` y ) n sum = y (n+1) (sum +x)\n</code></pre>\n\n<p>I understand that foldr will firstly apply the operator <code>op</code> for the last element in the list l and the unit which I've selected ( which would be the function \"unit\" ). \nBut how are the accumulator parameters of meanFold sent to the unit function so that sum and n are initially 0?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1542997200, "post_id": 53451323, "comment_id": 93775244, "body": "A side note: <code>forever</code> is not a monad, it is a function."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1542999595, "post_id": 53451323, "comment_id": 93776035, "body": "Your example has no variables, so we don&#39;t know why there&#39;s a variable out of scope. That just means you&#39;re referring to some variable that is unknown (in that context)."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1542999736, "post_id": 53451323, "comment_id": 93776069, "body": "Also while you can use <code>forever</code>, if running something forever is confusing you this much, maybe you should be trying to do it without resorting to <code>forever</code> first, for instructional purposes. All you need is to code an &quot;infinite loop&quot;, i.e. write a function that &quot;runs the code&quot; then calls itself."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 8, "last_activity_date": 1542996994, "creation_date": 1542996994, "answer_id": 53451360, "question_id": 53451323, "link": "https://stackoverflow.com/questions/53451323/how-should-the-forever-function-be-used/53451360#53451360", "title": "How should the forever function be used?", "body": "<p>You must import <code>forever</code> from <code>Control.Monad</code>. Add this to the top of your file:</p>\n\n<pre><code>import Control.Monad (forever)\n</code></pre>\n\n<p>When the compiler says <code>variable not in scope...</code>, it means \"I don't know what this is supposed to be; you haven't defined it.\" This can be caused by not having the required modules imported.</p>\n\n<p>How did I know this? If you <a href=\"https://www.haskell.org/hoogle/?hoogle=forever\" rel=\"noreferrer\">search for <code>forever</code> on Hoogle</a>, it says that it is in the <code>Control.Monad</code> module, in the <code>base</code> package. Hence, you must import it in order to use it. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1543000270, "creation_date": 1542996819, "last_edit_date": 1543000270, "question_id": 53451323, "link": "https://stackoverflow.com/questions/53451323/how-should-the-forever-function-be-used", "title": "How should the forever function be used?", "body": "<p>I have a function. Let's say it looks like this:</p>\n\n<pre><code>strangeFunc = do\n  putStrLn \"Welcome to the game! Please, enter the name of the file: \"\n --some more code\n</code></pre>\n\n<p>Then, I want it to run forever, so I do this</p>\n\n<pre><code>strangeFunc = forever $ do\n  putStrLn \"Welcome to the game! Please, enter the name of the file: \"\n  --some more code \n</code></pre>\n\n<p>But I have an error: <code>variable not in scope: forever</code>. How can I fix it?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1542993183, "creation_date": 1542993183, "answer_id": 53450682, "question_id": 53450533, "link": "https://stackoverflow.com/questions/53450533/haskell-iterate-tuple-with-different-functions/53450682#53450682", "title": "Haskell - Iterate Tuple with Different Functions", "body": "<p>Assuming</p>\n\n<pre><code>type Candidate = (Point, Point, [Point], Float)\n</code></pre>\n\n<p>you can use</p>\n\n<pre><code>candidate_to_string :: Candidate -&gt; String\ncandidate_to_string (p1, p2, ps, f) =\n   \"(\" ++\n   point_to_string p1 ++ \", \" ++\n   point_to_string p2 ++ \", \" ++\n   points_to_string ps ++ \", \" ++\n   show f ++\n   \")\"\n</code></pre>\n\n<p>which relies on</p>\n\n<pre><code>points_to_string :: [Point] -&gt; String\npoints_to_string ps = \"[\" ++ intercalate \", \" (map point_to_string ps) ++ \"]\"\n</code></pre>\n\n<p>exploiting <code>Data.List.intercalate</code> to add commas between the points.</p>\n\n<p>Also note that, if you simply want the standard list/tuple printing format, you can directly use</p>\n\n<pre><code>candidate_to_string :: Candidate -&gt; String\ncandidate_to_string = show\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 53450682, "answer_count": 1, "score": 0, "last_activity_date": 1542998589, "creation_date": 1542992427, "last_edit_date": 1542998589, "question_id": 53450533, "link": "https://stackoverflow.com/questions/53450533/haskell-iterate-tuple-with-different-functions", "title": "Haskell - Iterate Tuple with Different Functions", "body": "<p>I have been trying to to iterate the cand data in order to apply a function \"pt_string\".</p>\n\n<pre><code>Pt :: (Float, Float)\nPerson :: (Pt, Pt, [Pt], Float)\n</code></pre>\n\n<p>My idea is to call that function \"pt_string\" in a different way for each element of the tupple.</p>\n\n<p>For example:</p>\n\n<ol>\n<li>pt_string <code>Point</code> (first)</li>\n<li>map pt_string <code>[Point]</code></li>\n<li>pt_string <code>Point</code> (second)</li>\n<li>show \"Tmp\"</li>\n</ol>\n\n<p>So far, I got:</p>\n\n<pre><code>pt_string :: pt -&gt; String\npt_string pt =  \"(\" ++ show (fst pt) ++ \",\" ++ show (snd pt) ++ \")\\n\"\n</code></pre>\n\n<p>Which works fine. But how can I create <strong>cand_to_string :: cand -> String</strong> in the above order?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "numbers", "element"], "answers": [{"tags": [], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "is_accepted": true, "score": 3, "last_activity_date": 1543038480, "last_edit_date": 1543038480, "creation_date": 1542990616, "answer_id": 53450163, "question_id": 53449776, "link": "https://stackoverflow.com/questions/53449776/number-each-list-element-and-format-text-in-haskell/53450163#53450163", "title": "Number each list element and format text in haskell", "body": "<p>There are multiple built-in Haskell functions in <code>Prelude</code> that are good to learn and use them. <code>zip</code> and <code>zipWith</code> are two of them, when you think about something to be done using two different lists into one result list:</p>\n\n<p><code>[1..]</code>  will generate the list of indices for you, it's an infinite list </p>\n\n<pre><code>appendIndex :: String -&gt; Int -&gt; String\nappendIndex s i = (show i) ++ \" :\" ++ s\n\nindexThem :: [String] -&gt; [String] \nindexThem l = zipWith appendIndex l [1..]\n</code></pre>\n\n<p>if you wanted to use <code>zip</code>, which is more basic but a little more verbose:</p>\n\n<pre><code>appendIndex :: (String,Int) -&gt; String\nappendIndex (s,i) = (show i) ++ \" :\" ++ s\n\nindexThem :: [String] -&gt; [String] \nindexThem l = fmap appendIndex $ zip l [1..]  \n-- if you dont know about Functors yet, `fmap` is the generic way of doing `map` \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 3, "last_activity_date": 1542991511, "last_edit_date": 1542991511, "creation_date": 1542990973, "answer_id": 53450238, "question_id": 53449776, "link": "https://stackoverflow.com/questions/53449776/number-each-list-element-and-format-text-in-haskell/53450238#53450238", "title": "Number each list element and format text in haskell", "body": "<p>To get it right, it's important to understand why you're thinking wrong. Your recursion looks like this: </p>\n\n<pre><code>numberL (x:xs) = ... ++ numberL xs\n</code></pre>\n\n<p>So you calculate <code>numberL xs</code> and then put something in front of it. If  <code>numberL xs</code> were correct, then then it would be numbered from 1 onwards, like: <code>1:..., 2:..., 3:...</code>. So you could never build <code>numberL (x:xs)</code> from <code>numberL xs</code> just by adding new elements at the front. The whole numbering would be wrong. Instead you'd have to change the whole numbering of <code>numberL xs</code>.  </p>\n\n<p>The problem therefore is that it's not very useful to know <code>numberL xs</code> in order to calculate <code>numberL (x:xs)</code>, due to the fact <code>numberL</code> always starts numbering from 1. </p>\n\n<p>So lift that restriction. Build a function that numbers starting at <code>n</code>, </p>\n\n<pre><code>numberLFrom :: Int -&gt; [String] -&gt; [String]\nnumberLFrom n []     = ...\nnumberLFrom n (x:xs) = ...\n</code></pre>\n\n<p>Now the question you have to ask yourself is, in order to number <code>(x:xs)</code> starting at <code>n</code> you need to number <code>xs</code> starting at which number? And then how do you introduced the numbered <code>x</code> to that result? </p>\n"}], "owner": {"reputation": 81, "user_id": 6919456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78b6094b3396750e31b59c661285db9e?s=128&d=identicon&r=PG&f=1", "display_name": "Akos Fajszi", "link": "https://stackoverflow.com/users/6919456/akos-fajszi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 53450163, "answer_count": 2, "score": 1, "last_activity_date": 1543038480, "creation_date": 1542988946, "question_id": 53449776, "link": "https://stackoverflow.com/questions/53449776/number-each-list-element-and-format-text-in-haskell", "title": "Number each list element and format text in haskell", "body": "<p>I want to give each one a number from 1 to length(x:xs), like a book's page number. Unfortunately it only works backwards.</p>\n\n<pre><code>numberL :: [String] -&gt; [String]\nnumberL [] = []\nnumberL (x:xs) = ([show (length(x:xs)) ++ \": \" ++ x] ++ numberL (xs))\n</code></pre>\n\n<p>Also how do I remove any new line and tab from the text and replace it with the actual new line and tabulator?</p>\n"}, {"tags": ["sqlite", "haskell", "io", "monads"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 3, "creation_date": 1542989088, "post_id": 53449748, "comment_id": 93772234, "body": "for starters, the type should probably be <code>checkUniqueID :: IO Int</code> - you actually want to return something of type <code>Int</code>, besides executing an IO action. Then: <code>taskIDInt &lt;- checkUniqueID</code>, because <code>checkUniqueID</code> is in IO."}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1542999754, "post_id": 53450021, "comment_id": 93776077, "body": "I am not failing with your suggestion. I have a hard time seeing the forrest through the trees. You put me on the right track and it works! Sorry for this... Sometimes I feel a bit stupid trying monoids, applicatives, functors etc while the only thing I need to do is a simple bind of two monadic functions! Thanks"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 2, "last_activity_date": 1542990058, "creation_date": 1542990058, "answer_id": 53450021, "question_id": 53449748, "link": "https://stackoverflow.com/questions/53449748/haskell-transfer-between-monadic-functions/53450021#53450021", "title": "Haskell transfer between monadic functions", "body": "<p>First, <code>checkUniqueID</code> returns an <code>Int</code>, so its type should be <code>IO Int</code>, not <code>IO ()</code>:</p>\n\n<pre><code>checkUniqueID :: IO Int\n</code></pre>\n\n<p>Second, within the <code>do</code> notation, the left arrow <code>&lt;-</code> is what binds result of a monadic function to a name. You're already using it with <code>getLine</code>, so I'm not entirely sure why you would fail to use it with <code>checkUniqueID</code> as well:</p>\n\n<pre><code>taskIDInt &lt;- checkUniqueID\n</code></pre>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 53450021, "answer_count": 1, "score": -1, "last_activity_date": 1542990058, "creation_date": 1542988850, "question_id": 53449748, "link": "https://stackoverflow.com/questions/53449748/haskell-transfer-between-monadic-functions", "title": "Haskell transfer between monadic functions", "body": "<p>Feel I am never going to fully grasp Haskell now. Two functions: one that counts records in a SQlite DB, so it can produce incremental IDs (<code>checkUniqueID</code>). The other one to make the records, calling on <code>checkUniqueID</code>. I just need the value over to <code>taskEntry</code> as an <code>Int</code>. I guess I am missing the knowledge to stay in the monadic realm. Code below. </p>\n\n<pre><code>-- checkUniqueID :: IO ()\ncheckUniqueID = do\n  conn &lt;- open \"taglist.db\"\n  len &lt;- query_ conn \"SELECT (id) FROM task\" :: IO [Only Int]\n  let showLength = Data.List.length $ len\n  close conn\n  return (showLength + 1) -- for testing purposes\n\n-- fieldnames: id, task, date_in, date_out\ntaskEntry :: IO ()\ntaskEntry = do\n      putStrLn \"Provide task and date due: \"\n      let taskIDInt = checkUniqueID -- issue here!\n      task &lt;- getLine\n      date_out &lt;- getLine\n      let date_in = \"today\"\n      conn &lt;- open \"taglist.db\"\n      execute conn \"INSERT INTO task (id, task, date_in, date_out) VALUES (?,?,?,?)\"\n            (taskIDInt :: Int , task :: String , date_in :: String , date_out :: String)\n      close conn\n      return ()\n</code></pre>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542987779, "post_id": 53448958, "comment_id": 93771674, "body": "related: <a href=\"https://stackoverflow.com/questions/53352563/haskell-aeson-is-there-a-better-way-of-parsing-historical-data\" title=\"haskell aeson is there a better way of parsing historical data\">stackoverflow.com/questions/53352563/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 3, "last_activity_date": 1542985996, "creation_date": 1542985996, "answer_id": 53449107, "question_id": 53448958, "link": "https://stackoverflow.com/questions/53448958/aeson-derive-some-but-not-all-fields-of-a-struct/53449107#53449107", "title": "Aeson: derive some (but not all) fields of a struct", "body": "<p>You should create a <code>newtype</code> for your special field:</p>\n\n<pre><code>newtype MySpecialType = MySpecialType [Int]\n\ninstance FromJSON MySpecialType where ....\n\ndata MyStruct = MyStruct {\n      myobject:: MySpecialType,\n      ...\n   }\n</code></pre>\n\n<p>Now the instance for <code>MyStruct</code> becomes entirely regular and can be handed off to Template Haskell in the normal way.</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1543243445, "creation_date": 1543243445, "answer_id": 53483542, "question_id": 53448958, "link": "https://stackoverflow.com/questions/53448958/aeson-derive-some-but-not-all-fields-of-a-struct/53483542#53483542", "title": "Aeson: derive some (but not all) fields of a struct", "body": "<p>To avoid carrying the newtype from <a href=\"https://stackoverflow.com/a/53449107/6863749\">Paul Johnson's very good answer</a> all across the codebase, you can also generalize your type as follows, making the type of <code>myobject</code> a parameter:</p>\n\n<pre><code>data MyStruct_ intList = MyStruct {\n  myobject :: intlist,\n  ...\n} deriving (Functor, Generic)\n\ntype MyStruct = MyStruct [Int]\n\ninstance FromJSON MyStruct where\n  parseJSON = (fmap . fmap) (\\(MySpecialType i) -&gt; i)\n            . genericParseJSON defaultOptions\n</code></pre>\n\n<p><code>genericParseJSON</code> above gets instantiated with <code>MyStruct MySpecialType</code>, and then the field gets unwrapped via <code>fmap</code> (noting <code>MyStruct_</code> is a <code>Functor</code>)</p>\n\n<hr>\n\n<p>I also just wrote a <a href=\"http://blog.poisson.chat/posts/2018-11-26-type-surgery.html\" rel=\"nofollow noreferrer\">blogpost about \"type surgery\"</a>, applied to this kind of problem so that you can keep the original type unmodified.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/generic-data-surgery\" rel=\"nofollow noreferrer\">The generic-data-surgery library</a> can derive a generic type with the same <code>Generic</code> structure as <code>MyStruct_ MySpecialType</code> above, to be used by aeson's <code>genericParseJSON</code>. The surgery <code>modifyRField</code> then applies the function <code>\\(MySpecialType i) -&gt; i</code> to the <code>myobject</code> field, finally yielding <code>MyStruct</code>.</p>\n\n<pre><code>import Generic.Data.Surgery (fromOR, toOR', modifyRField)\n\n-- The original type\ndata MyStruct = MyStruct {\n  myobject :: [Int],\n  ...\n} deriving (Generic)\n\ninstance FromJSON MyStruct where\n  parseJSON = fmap (fromOR . modifyRField @\"myobject\" (\\(MySpecialType i) -&gt; i) . toOR')\n            . genericParseJSON defaultOptions\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 7569156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/983f040d03fd94ecddde895bf0968835?s=128&d=identicon&r=PG&f=1", "display_name": "Marius Melzer", "link": "https://stackoverflow.com/users/7569156/marius-melzer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 53449107, "answer_count": 2, "score": 2, "last_activity_date": 1543243445, "creation_date": 1542985284, "question_id": 53448958, "link": "https://stackoverflow.com/questions/53448958/aeson-derive-some-but-not-all-fields-of-a-struct", "title": "Aeson: derive some (but not all) fields of a struct", "body": "<p>I have a large struct which I need to be an instance of FromJSON so that I can parse my json data into it.</p>\n\n<p>I would like to derive automatically, but a single field needs \"special care\" in that it is an object in json and I want it to be an array of the values in my struct. How can I do this without writing a huge FromJson implementation repeating all the fields?</p>\n\n<p>Example json:</p>\n\n<pre><code>{\"myobject\": {\"one\": 1, \"two\": 2}, ...many_more_fields...}\n</code></pre>\n\n<p>Example struct:</p>\n\n<pre><code>data MyStruct = MyStruct {\n  myobject :: [Int],\n  ...many_more_fields,...\n} deriving (Generic)\n</code></pre>\n\n<p>How do I do this elegantly?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1542978863, "post_id": 53447330, "comment_id": 93767596, "body": "Why do you need that <code>fmap</code>?"}, {"owner": {"reputation": 23, "user_id": 10695619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cafa8ae7b35094bac44f6ad83bd654e?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Law", "link": "https://stackoverflow.com/users/10695619/andy-law"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1542979022, "post_id": 53447330, "comment_id": 93767678, "body": "@arrowd In order to traverse all elements, in fact, I am only testing the usage of <code>StateT</code> monad"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1542979227, "post_id": 53447330, "comment_id": 93767770, "body": "Try looking up <code>traverse</code>. The documentation says &quot;Map each element of a structure to an action, evaluate these actions from left to right, and collect the results&quot;."}, {"owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "edited": false, "score": 0, "creation_date": 1605593909, "post_id": 53447330, "comment_id": 114690722, "body": "Related: <a href=\"https://stackoverflow.com/questions/41522491/is-there-a-way-to-place-some-impure-code-inside-pure-functions\" title=\"is there a way to place some impure code inside pure functions\">stackoverflow.com/questions/41522491/&hellip;</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1542981848, "last_edit_date": 1542981848, "creation_date": 1542981294, "answer_id": 53448015, "question_id": 53447330, "link": "https://stackoverflow.com/questions/53447330/haskell-how-to-make-side-effects-in-pure-functions/53448015#53448015", "title": "Haskell: How to make side effects in pure functions", "body": "<p>For programmers coming from an imperative world, I think the most familiar answers are <code>for</code> and <code>for_</code>. Example:</p>\n\n<pre><code>import Data.Foldable\n\nsize :: [Int] -&gt; StateT Int IO ()\nsize xs = for_ xs $ \\x -&gt; do             -- similar to \"for x in xs do ...\"\n   num &lt;- get\n   -- IO example:\n   lift $ putStrLn $ \"Now incrementing \" ++ num\n   put (num + 1)\n</code></pre>\n\n<p>The above code as a side effect increments the <code>Int</code> state, but eventually returns a boring dummy value <code>()</code>. If we wanted to return the last <code>Int</code> state as well, we need to use:</p>\n\n<pre><code>size :: [Int] -&gt; StateT Int IO Int   -- return Int instead of ()\nsize xs = do\n   for_ xs $ \\x -&gt; do\n      num &lt;- get\n      lift $ putStrLn $ \"Now incrementing \" ++ num\n      put (num + 1)\n   get  -- return the last state\n</code></pre>\n\n<p>(Also note that the above will not compute the size/length if the initial <code>Int</code> state is not <code>0</code>. I'm not sure about why you are using a <code>StateT Int IO</code> here.)</p>\n\n<p>That being said, note that in Haskell we tend to avoid using side effects (even nicely wrapped in a monad like above) when we can avoid it. It is usually much better to keep code free from side effects, when possible.</p>\n\n<pre><code>size :: [Int] -&gt; Int\nsize = length\n-- or\nsize = foldl' (\\ s _ -&gt; s+1) 0\n</code></pre>\n\n<p>If you are a beginner, perhaps tinkering with monads and monad transformers is not the best way to start. I would recommend to learn the basics first (algebraic data types, pattern matching, recursion, higher order functions, ...), then moving to monads / functors / applicatives (e.g. <code>State Int</code>, not <code>StateT Int IO</code>), and then finally move to transformers (<code>StateT Int IO</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 5, "last_activity_date": 1543091392, "last_edit_date": 1543091392, "creation_date": 1542982912, "answer_id": 53448409, "question_id": 53447330, "link": "https://stackoverflow.com/questions/53447330/haskell-how-to-make-side-effects-in-pure-functions/53448409#53448409", "title": "Haskell: How to make side effects in pure functions", "body": "<p>Firstly, at this point in the learning process you probably shouldn't be worrying about \"side effects\". Also you're trying to mix two monads, <code>State</code> and <code>IO</code>, at a point where you don't seem to have mastered either. So you probably should take it easier. </p>\n\n<p>It is possible to perform stateful actions within the <code>IO</code> monad using <code>IORefs</code>, which you can think of as mutable variables. If I were you I wouldn't go there just yet. Then there is the <code>State</code> monad which, roughly speaking, is a handy way of <em>simulating</em> stateful functions in a pure setting. </p>\n\n<p>In theory, you can think of a stateful function <code>f :: a -&gt; b</code> as a pure function of type <code>f :: (a,s) -&gt; (b,s)</code>, where <code>s</code> represents some state which you can access and change. The above doesn't quite fit the monad framework, because in a monad <code>m</code> we want <code>a -&gt; m b</code> to represent effectful functions from <code>a</code> to <code>b</code>. But it's easy to adapt. The type  <code>(a,s) -&gt; (b,s)</code> can be uncurried to obtain  <code>a -&gt; s -&gt; (b,s)</code> and we take <code>m b</code> to be <code>s -&gt; (b,s)</code>, so <code>a -&gt; m b</code> represents <code>a -&gt; s -&gt; (b,s)</code>. </p>\n\n<p>So this is what the monad <code>State s</code> represents. For every type <code>b</code> the type <code>State s b</code> is <code>s -&gt; (b,s)</code>, which can be read as saying \"give me the missing initial state <code>s</code> so I can compute a <code>b</code> and a final state <code>s</code>. And a stateful function <code>a -&gt; State s b</code> is <code>a -&gt; s -&gt; (b,s)</code>, which can be read as saying \"this function takes an <code>a</code> and produces a computation which given an initial state <code>s</code> produces a result <code>b</code> and a final state <code>s</code>. </p>\n\n<p>This is just to give you a rough idea of how it works. Now here's some code that does what you want. Let's start with a simple approach.</p>\n\n<pre><code>size :: [Int] -&gt; State Int ()\nsize []     = put 0\nsize (x:xs) = do size xs\n                 num &lt;- get \n                 put (num + 1)\n</code></pre>\n\n<p>The type is <code>State Int ()</code> because you are simply updating an integer state and returning no value (the state is all we care about).</p>\n\n<p>The procedure is very similar to a usual recursive function for calculating size (without accumulator), but we do the work by updating state. To run this example just do, </p>\n\n<pre><code>runState (size list) 0 \n</code></pre>\n\n<p>for some <code>list</code>. Note the <code>0</code> which is the initial state is irrelevant here, because the algorithm works by setting the state as <code>0</code> for the empty list then adding <code>1</code> for each element. </p>\n\n<p>Now a version that works in an accumulating fashion,</p>\n\n<pre><code>sizeAc :: [Int] -&gt; State Int ()\nsizeAc []     = return ()\nsizeAc (x:xs) = do num &lt;- get \n                   put (num + 1)\n                   sizeAc xs\n</code></pre>\n\n<p>Again to run this example just do, </p>\n\n<pre><code>runState (sizeAc list) 0 \n</code></pre>\n\n<p>Note in this case you must use <code>0</code> as the initial state. What the function does is, for each element of the list it updates the state by adding one to the state's value. For an empty list it does nothing. </p>\n\n<p>Finally a version with <code>map</code>, since it appears in your initial attempt. First we implement the counting action. </p>\n\n<pre><code>count :: State Int ()\ncount = do num &lt;- get \n           put (num + 1)\n</code></pre>\n\n<p>This action consists of accessing the state and updating it with an added unit. Then build a list of such actions for each element in the list.</p>\n\n<pre><code>sizeAux'   :: [Int] -&gt; [State Int ()]\nsizeAux' xs = map (\\x -&gt; count) xs\n</code></pre>\n\n<p>Note the type of the result is a list. The result is a list where all elements are the action <code>count</code>. Then we execute those actions in sequence, using <code>sequence_</code>, whose type is as below (specialised to lists and to our particular monad).  </p>\n\n<pre><code> sequence_ :: [m a] -&gt; m ()\n sequence_ :: [State Int ()] -&gt; State Int ()\n</code></pre>\n\n<p>The resulting function is </p>\n\n<pre><code>size'   :: [Int] -&gt; State Int ()\nsize' xs = sequence_ (sizeAux' xs) \n</code></pre>\n\n<p>Which again can be run via, </p>\n\n<pre><code>runState (size' list) 0\n</code></pre>\n\n<p>and note again here the initial state <code>0</code> is essential. </p>\n\n<p>This might still feel somewhat complicated at this point. You'll need to have a better understanding of the monad class, the do notation and the particularities of the State monad. In any case this is where you should be heading, not mixing State with IO.  </p>\n"}], "owner": {"reputation": 23, "user_id": 10695619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cafa8ae7b35094bac44f6ad83bd654e?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Law", "link": "https://stackoverflow.com/users/10695619/andy-law"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 53448409, "answer_count": 2, "score": 2, "last_activity_date": 1543091392, "creation_date": 1542978532, "question_id": 53447330, "link": "https://stackoverflow.com/questions/53447330/haskell-how-to-make-side-effects-in-pure-functions", "title": "Haskell: How to make side effects in pure functions", "body": "<p>I'm a Haskell beginner and I feel trouble about how to present some side effects in some pure functions, i.e, a very easy <code>size</code> function...</p>\n\n<pre><code>size :: [Int] -&gt; StateT Int IO ()\nsize = fmap (\\x -&gt; do \n                     num &lt;- get\n                     put (num + 1)\n                   return x)    -- some pseudo code like this... \n</code></pre>\n\n<p>I know there're lots of errors... the <code>return</code> which I mean this lambda returns <code>x</code> itself so that the list's values may not be changed... In fact, I want to use <code>StateT</code> to present some side effect. How could I do this? Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 738, "user_id": 8075159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8709365a90d8a840b976b0f132f912e5?s=128&d=identicon&r=PG&f=1", "display_name": "Hogeyama", "link": "https://stackoverflow.com/users/8075159/hogeyama"}, "edited": false, "score": 2, "creation_date": 1542976429, "post_id": 53446501, "comment_id": 93766407, "body": "<code>text-format</code> can deal with Char and Float at the same time. See <a href=\"https://github.com/bos/text-format/blob/master/benchmarks/Benchmarks.hs#L37\" rel=\"nofollow noreferrer\">this example</a>. The <code>base</code> package also provides C like <code>printf</code> function (<a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Text-Printf.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/Text-Printf.&zwnj;&#8203;html</a>)."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542977320, "post_id": 53446501, "comment_id": 93766802, "body": "you maybe not need <code>text-format</code> to print list of tuples. <code>show</code> and use <code>intersperse</code> to insert <code>\\n</code> into list can output desired format for list of tuples. Anyway, Could you post what you have done so far? so that other users can learn what you want from the code."}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542977664, "post_id": 53446501, "comment_id": 93766977, "body": "@assembly.jc check update"}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 738, "user_id": 8075159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8709365a90d8a840b976b0f132f912e5?s=128&d=identicon&r=PG&f=1", "display_name": "Hogeyama", "link": "https://stackoverflow.com/users/8075159/hogeyama"}, "edited": false, "score": 0, "creation_date": 1542977737, "post_id": 53446501, "comment_id": 93767001, "body": "@Hogeyama I am a newbie newbie in functional programming, could you please provide me with a simple sample, instead of that whole like? Thanks!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1542982064, "post_id": 53446501, "comment_id": 93769124, "body": "Which type of strings are you using? <code>String</code>? <code>Text</code>? Have you tried to simply <code>show</code> a pair of floats/double so that the pair is converted to a string? E.g. <code>show (3.2,1.5)</code> Do you need another output format than the one of <code>show</code>?"}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542985321, "post_id": 53446501, "comment_id": 93770591, "body": "@assembly.jc how could I add then a ENTER &quot;\\n&quot;? Btw thanks for the full explanation!!"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542986087, "post_id": 53446501, "comment_id": 93770917, "body": "Just append &quot;\\n&quot; at the end of &quot;result&quot; <code>String</code>, the answer has updated to show how to do it, please see it."}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542986335, "post_id": 53446501, "comment_id": 93771038, "body": "@assembly.jc thanks for the quick answer! If you look at this image:   <a href=\"http://prntscr.com/lm3479\" rel=\"nofollow noreferrer\">prntscr.com/lm3479</a>  I tried before but instead of printing the ENTER it prints the &quot;\\n&quot; as a string"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542986492, "post_id": 53446501, "comment_id": 93771100, "body": "function <code>print</code> don&#39;t convert &quot;\\n&quot; to new-line, use <code>putStr</code> or <code>putStrLn</code> instead."}, {"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542986704, "post_id": 53446501, "comment_id": 93771182, "body": "@assembly.jc the problem is that I need to get a String as a output but putStrLn gives me a IO (), any thoughts on that?"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542986869, "post_id": 53446501, "comment_id": 93771251, "body": "comment is not suitable to discuss or chat, just ask an new question for that."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "edited": false, "score": 0, "creation_date": 1542985979, "post_id": 53447300, "comment_id": 93770876, "body": "It is, but the situation gets more complex!  Point = (Float, Float) Candidate = (Point, Point, [Point], Float)  - (Initial, Ending, [(Support)], Time)  So Basically I need to print something like (Imagine the shell): (InitialX, initialY) (Support1X, Support1Y), .... (SupportnX, SupportnY) (EndingX, EndingY), Time: TIME"}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": false, "score": 0, "last_activity_date": 1542978431, "creation_date": 1542978431, "answer_id": 53447300, "question_id": 53446501, "link": "https://stackoverflow.com/questions/53446501/haskell-format-string-output-x-y/53447300#53447300", "title": "Haskell Format String Output &quot;(x, y),&quot;", "body": "<p>Is this what you have in mind?</p>\n\n<pre><code>main = let ps = [\n                  (1.0,1.0), \n                  (2.0,2.0), \n                  (3.0,3.0), \n                  (4.0,4.0), \n                  (5.0,5.0), \n                  (6.0,6.0)\n                ]\n        in mapM print ps\n</code></pre>\n\n<p>output :</p>\n\n<pre><code>(1.0,1.0)\n(2.0,2.0)\n(3.0,3.0)\n(4.0,4.0)\n(5.0,5.0)\n(6.0,6.0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 1, "last_activity_date": 1542986296, "last_edit_date": 1542986296, "creation_date": 1542983011, "answer_id": 53448431, "question_id": 53446501, "link": "https://stackoverflow.com/questions/53446501/haskell-format-string-output-x-y/53448431#53448431", "title": "Haskell Format String Output &quot;(x, y),&quot;", "body": "<p>From the code of your question, I guess you want to convert a list of <code>Double</code> pair to a list of <code>String</code>, as said in comment, you may not need use <code>Data.Text.Format</code> package, since the basic function <code>show</code> can convert it to <code>String</code> properly as:</p>\n\n<pre><code>format_pts_string::[(Double, Double)]-&gt;[String]\nformat_pts_string cs = map (\\c-&gt; (show c) ++ \"\\n\") cs\n</code></pre>\n\n<p>or use list comprehension:</p>\n\n<pre><code>format_pts_string::[(Double, Double)]-&gt;[String]\nformat_pts_string cs =  [show c ++ \"\\n\" | c &lt;- cs]\n</code></pre>\n\n<p>Furthermore, if need to control output format, you can use <code>++</code> to concatenate the <code>String</code>, here is an example:</p>\n\n<pre><code>format_pts_string::[(Double, Double)]-&gt;[String]\nformat_pts_string cs = map formatPair cs\n    where formatPair (a, b) = \"(\" ++ (show a) ++ \", \" ++ (show b) ++ \")\" ++ \"\\n\"\n</code></pre>\n\n<p>if you still love to use module <strong>text-format</strong>, you may need to enable <code>OverloadedStrings</code> language extension to convert <code>String</code> to <code>Format</code> type for call <code>format</code> function as:</p>\n\n<pre><code>{-# Language OverloadedStrings #-}\nimport Data.Text.Lazy (unpack)\nimport Data.Text.Format (format)\n\nformat_pts_string::[(Double, Double)]-&gt;[String]\nformat_pts_string cs = [unpack $ format \"({}, {})\\n\" (c::(Double, Double))| c &lt;- cs]\n</code></pre>\n\n<p>or don't use <code>OverloadedStrings</code> language extension, use <code>formString</code> in <code>Data.String</code> instead, but it is verbose as:</p>\n\n<pre><code>...\nimport Data.String (fromString)\n...\n[unpack $ format (fromString \"({}, {})\\n\") (c::(Double, Double))| c &lt;- cs]\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "accepted_answer_id": 53448431, "answer_count": 2, "score": 1, "last_activity_date": 1542986296, "creation_date": 1542975094, "last_edit_date": 1542977651, "question_id": 53446501, "link": "https://stackoverflow.com/questions/53446501/haskell-format-string-output-x-y", "title": "Haskell Format String Output &quot;(x, y),&quot;", "body": "<p>So I am trying to output a list of Points \"(X,Y) \\n\" but I cant get it working.</p>\n\n<p>Both values X and Y are Floats. I tried the module <strong>text-format</strong> but I cant make it work with Char and Float and the same time.</p>\n\n<p>Anyone has an idea on how to make this work?</p>\n\n<p>BEst regards</p>\n\n<p>UPDATED:</p>\n\n<pre><code>format_pts_string cs = [\n    format (\"(\" % a % \", \" % b % \")\")\n    | c &lt;- cs]\n</code></pre>\n\n<ul>\n<li>This code is NOT working, Error -> <a href=\"http://prntscr.com/lm10p4\" rel=\"nofollow noreferrer\">Print Of Error</a></li>\n</ul>\n"}, {"tags": ["haskell", "z3", "smt", "sbv"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542976698, "post_id": 53444430, "comment_id": 93766516, "body": "The functions <code>abs</code>, <code>negate</code> and <code>signum</code> has not implemented for <code>class Num</code>. Otherwise, the code seems no problem."}, {"owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1542982498, "post_id": 53444430, "comment_id": 93769323, "body": "Hm, I&#39;ve implemented the missing methods, but it crashes all the same."}], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "edited": false, "score": 1, "creation_date": 1542991012, "post_id": 53449764, "comment_id": 93773047, "body": "Extremely helpful answer. Thank you for going into so much detail."}, {"owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "edited": false, "score": 0, "creation_date": 1543178344, "post_id": 53449764, "comment_id": 93814059, "body": "PS: in my case I am dealing with constraints over the semiring (Nat U {oo}, +, *, 0, 1), so I don&#39;t want to have to think about subtraction/inverses. Therefore, I think I will just leave out the irrelevant definitions and ignore that GHC is yelling at me... I also add the constraint <code>v .&gt;= 0</code> to the definition of <code>freeSIntX</code> (or more appropriately <code>freeSNatX</code>)."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "edited": false, "score": 1, "creation_date": 1543180695, "post_id": 53449764, "comment_id": 93814740, "body": "You can replace the &quot;irrelevant&quot; definitions with <code>error &quot;shouldn&#39;t be called!&quot;</code> just to be safe. And yes; adding <code>constrain $ v .&gt;= 0</code> to <code>freeSNatX</code> is a nice trick. One thing to worry about is that your modeling domain has &quot;junk&quot; in it, in the domain theoretic sense: A single infinity is modeled by (infinitely) many distinct elements. This can cause trouble in certain cases, but there are ways to deal with that should it be a problem."}, {"owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "edited": false, "score": 0, "creation_date": 1543188529, "post_id": 53449764, "comment_id": 93816538, "body": "If I understand your point right, I thought of this too, so I&#39;ve decided to use <code>xVal = -1</code> in the infinity case: <code>constrain $ ite i (v .== -1) (v .&gt;= 0)</code>. Of course this means that the boolean (<code>isInf</code>) constraints are sort of superfluous, because I could just denote infinity using the integer&#39;s sign bit. Not sure if that is a good idea though."}, {"owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "edited": false, "score": 0, "creation_date": 1543189533, "post_id": 53449764, "comment_id": 93816749, "body": "I know that originally I had called my type <code>IntX</code>, but really I want just <code>Nat</code>s, so using the sign bit of the <code>SInteger</code> seems fair.  I tried encoding infinity as <code>(-1)</code>, see this gist: <a href=\"https://gist.github.com/buggymcbugfix/1afea2d466e5dc21655a76037accccdd\" rel=\"nofollow noreferrer\">gist.github.com/buggymcbugfix/1afea2d466e5dc21655a76037acccc&zwnj;&#8203;dd</a>  Note the special case for 0 in my definition for <code>(*)</code>, which I need for my model (resource analysis: not using a computation that consumes arbitrary resources uses no resources)."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "edited": false, "score": 1, "creation_date": 1543198101, "post_id": 53449764, "comment_id": 93818248, "body": "I was thinking more along <code>allSat</code> like situations, where you want to find all satisfying assignments. Since the model contains junk, the SMT solver would return &quot;different&quot; results which are essentially the same for you. (The way to deal with that is to assert the negation of the equivalence class in a query.) But looks like that&#39;s not an issue for you, and perhaps the <code>&gt;= -1</code> constraint sufficient as it eliminates the junk and lack of subtraction avoids that space. So long as it works, all is good!"}], "tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": true, "score": 4, "last_activity_date": 1542989986, "last_edit_date": 1542989986, "creation_date": 1542988912, "answer_id": 53449764, "question_id": 53444430, "link": "https://stackoverflow.com/questions/53444430/encoding-extended-naturals-in-sbv/53449764#53449764", "title": "Encoding extended naturals in SBV", "body": "<p>The fundamental issue here is that your code is mixing Haskell's concrete <code>Maybe</code> type and trying to treat it as a symbolic object. But you're on the right track with how you implemented that in SMT-Lib2: You essentially need to write the corresponding code in SBV.</p>\n\n<p>I'd start with:</p>\n\n<pre><code>{-# LANGUAGE DeriveAnyClass  #-}\n{-# LANGUAGE DeriveGeneric   #-}\n{-# LANGUAGE NamedFieldPuns  #-}\n\nimport Data.SBV\nimport Data.SBV.Control\nimport GHC.Generics (Generic)\n</code></pre>\n\n<p>This is just boilerplate; and you don't need the <code>Data.SBV.Control</code> import unless you want to use the query mode, but it does come in handy as we shall see.</p>\n\n<p>The first thing to do is to encode your <code>IntX</code> type symbolically; just like you did in SMTLib:</p>\n\n<pre><code>data SIntX = SIntX { isInf :: SBool\n                   , xVal  :: SInteger\n                   }\n                   deriving (Generic, Mergeable)\n\ninstance Show SIntX where\n  show (SIntX inf val) = case (unliteral inf, unliteral val) of\n                           (Just True,  _)      -&gt; \"oo\"\n                           (Just False, Just n) -&gt; show n\n                           _                    -&gt; \"&lt;symbolic&gt;\"\n</code></pre>\n\n<p>Nothing above should be surprising, except perhaps the deriving of <code>Generic</code> and <code>Mergeable</code>. It simply enables SBV to be able to use <code>ite</code> on your extended naturals. Also note how the <code>Show</code> instance is careful in distinguishing concrete and symbolic values by using <code>unliteral</code>.</p>\n\n<p>Next, we add a few convenience functions, again nothing surprising:</p>\n\n<pre><code>inf :: SIntX\ninf = SIntX { isInf = true, xVal = 0 }\n\nnat :: SInteger -&gt; SIntX\nnat v = SIntX { isInf = false, xVal = v }\n\nliftU :: (SInteger -&gt; SInteger) -&gt; SIntX -&gt; SIntX\nliftU op a = ite (isInf a) inf (nat (op (xVal a)))\n\nliftB :: (SInteger -&gt; SInteger -&gt; SInteger) -&gt; SIntX -&gt; SIntX -&gt; SIntX\nliftB op a b = ite (isInf a ||| isInf b) inf (nat (xVal a `op` xVal b))\n</code></pre>\n\n<p>Now we can make <code>IntX</code> a number:</p>\n\n<pre><code>instance Num SIntX where\n  (+)         = liftB (+)\n  (*)         = liftB (*)\n  negate      = liftU negate\n  abs         = liftU abs\n  signum      = liftU signum\n  fromInteger = nat . literal\n</code></pre>\n\n<p>(Note that the semantics of this means <code>oo - oo = oo</code>, which is at best questionable. But that's besides the point. You might have to explicitly define <code>-</code> and deal with that as you wish. Similar comments apply for <code>signum</code>.)</p>\n\n<p>Since you want to test for equality, we also have to define the symbolic version of that:</p>\n\n<pre><code>instance EqSymbolic SIntX where\n  a .== b = ite (isInf a &amp;&amp;&amp; isInf b) true\n          $ ite (isInf a ||| isInf b) false\n          $ xVal a .== xVal b\n</code></pre>\n\n<p>Similarly, if you want to compare, you'll have to define an <a href=\"https://hackage.haskell.org/package/sbv-7.12/docs/Data-SBV.html#t:OrdSymbolic\" rel=\"nofollow noreferrer\"><code>OrdSymbolic</code></a> instance; but the idea remains the same.</p>\n\n<p>We need a way to create symbolic extended naturals. The following function does it nicely:</p>\n\n<pre><code>freeSIntX :: String -&gt; Symbolic SIntX\nfreeSIntX nm = do i &lt;- sBool    $ nm ++ \"_isInf\"\n                  v &lt;- sInteger $ nm ++ \"_xVal\"\n                  return $ SIntX { isInf = i, xVal = v }\n</code></pre>\n\n<p>Strictly speaking, you don't need to name the variables. (i.e., the <code>nm</code> parameter isn't needed.) But I find it helpful to always name my variables for obvious reasons.</p>\n\n<p>Now, we can code your example:</p>\n\n<pre><code>ex1 :: IO SatResult\nex1 = sat $ do x &lt;- freeSIntX \"x\"\n               return $ x .== x+1\n</code></pre>\n\n<p>When I run this, I get:</p>\n\n<pre><code>*Main&gt; ex1\nSatisfiable. Model:\n  x_isInf = True :: Bool\n  x_xVal  =    0 :: Integer\n</code></pre>\n\n<p>Which is what you were looking for, I believe.</p>\n\n<p>When you're dealing with larger programs, it's beneficial to be able to extract <code>IntX</code> values more directly and program further with them. This is when the query mode comes in handy. First, a helper:</p>\n\n<pre><code>data IntX = IntX (Maybe Integer) deriving Show\n\nqueryX :: SIntX -&gt; Query IntX\nqueryX (SIntX {isInf, xVal}) = do\n          b &lt;- getValue isInf\n          v &lt;- getValue xVal\n          return $ IntX $ if b then Nothing\n                               else Just v\n</code></pre>\n\n<p>Now we can code:</p>\n\n<pre><code>ex2 :: IO ()\nex2 = runSMT $ do x &lt;- freeSIntX \"x\"\n                  constrain $ x .== x+1\n\n                  query $ do cs &lt;- checkSat\n                             case cs of\n                               Unk   -&gt; error \"Solver said Unknown!\"\n                               Unsat -&gt; error \"Solver said Unsatisfiable!\"\n                               Sat   -&gt; do v &lt;- queryX x\n                                           io $ print v\n</code></pre>\n\n<p>And we get:</p>\n\n<pre><code>*Main&gt; ex2\nIntX Nothing\n</code></pre>\n\n<p>I hope this helps. I've put all this code in a gist: <a href=\"https://gist.github.com/LeventErkok/facfd067b813028390c89803b3a0e887\" rel=\"nofollow noreferrer\">https://gist.github.com/LeventErkok/facfd067b813028390c89803b3a0e887</a></p>\n"}], "owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 1, "accepted_answer_id": 53449764, "answer_count": 1, "score": 2, "last_activity_date": 1542989986, "creation_date": 1542967220, "last_edit_date": 1542982619, "question_id": 53444430, "link": "https://stackoverflow.com/questions/53444430/encoding-extended-naturals-in-sbv", "title": "Encoding extended naturals in SBV", "body": "<p>I'm experimenting with the following way of encoding extended naturals in SMT-LIB (I define a datatype analogous to <code>Maybe Integer</code>):</p>\n\n<pre><code>; extended integers -- if first field is true, then the value is infinity\n(declare-datatypes () ((IntX (mk-int-x (is-infty Bool) (not-infty Int)))))\n\n; addition\n(define-fun plus ((x IntX) (y IntX)) IntX\n  (ite (or (is-infty x) (is-infty y))\n           (mk-int-x true 0)\n           (mk-int-x false (+ (not-infty x) (not-infty y)))))\n\n(declare-fun x () IntX)\n(assert (= x (plus x (mk-int-x false 1))))\n; x = x+1 when x |-&gt; infty\n(get-model)\n(exit)\n</code></pre>\n\n<p>How would I go about to encode this in SBV? I tried the following, but that just crashed SBV. Also I somehow doubt that this would do what I want, but I'm not familiar enough with how SBV works.</p>\n\n<pre><code>!/usr/bin/env stack\n{- stack script\n  --resolver nightly-2018-11-23\n  --package sbv\n  --package syb\n-}\n\n{-# LANGUAGE DeriveAnyClass #-}\n{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Generics\nimport Data.SBV\n\ndata IntX = IntX (Maybe Integer) deriving (Eq, Ord, Data, Read, Show, SymWord, HasKind)\n\npretty :: IntX -&gt; String\npretty = \\case\n  IntX Nothing -&gt; \"\u221e\"\n  IntX n -&gt; show n\n\ninstance Num IntX where\n  (+) (IntX x) (IntX y) = IntX $ (+) &lt;$&gt; x &lt;*&gt; y\n  (*) (IntX x) (IntX y) = IntX $ (*) &lt;$&gt; x &lt;*&gt; y\n  fromInteger = IntX . Just\n\nex1 = sat $ do\n  x :: SBV IntX &lt;- free \"x\"\n  return $ x .== x + 1\n\nmain :: IO ()\nmain = print =&lt;&lt; ex1\n</code></pre>\n\n<hr>\n\n<pre><code>~/temp \u2718 ./sbv.hs\nsbv.hs: SBV.SMT.SMTLib2.cvtExp.sh: impossible happened; can't translate: s0 + s1\nCallStack (from HasCallStack):\n\n  error, called at ./Data/SBV/SMT/SMTLib2.hs:681:13 in sbv-7.12-9AiNAYtrUhB8YA6mr6BTn4:Data.SBV.SMT.SMTLib2\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "edited": false, "score": 0, "creation_date": 1542952325, "post_id": 53441203, "comment_id": 93755445, "body": "Is there a way to execute the side effect without using it? If the type in the left side of <code>&gt;&gt;</code> different from the right one, it will not work."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "edited": false, "score": 2, "creation_date": 1542952478, "post_id": 53441203, "comment_id": 93755482, "body": "For the first question answer is &quot;no&quot;. For the second: It should have type <code>IO a</code> with any <code>a</code> because <code>&gt;&gt;</code> ignores result of left argument."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 3, "last_activity_date": 1542951907, "creation_date": 1542951907, "answer_id": 53441203, "question_id": 53441113, "link": "https://stackoverflow.com/questions/53441113/haskell-how-to-print-some-value-in-a-function-for-debugging-purpose/53441203#53441203", "title": "Haskell - How to print some value in a function for debugging purpose?", "body": "<p>You created <code>m</code> but never used it. To fix that you can try:</p>\n\n<pre><code>i = 3.0\n\nmain :: IO ()\nmain = let m = print i in m &gt;&gt; putStrLn \"Hello world\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 4, "last_activity_date": 1542953405, "last_edit_date": 1542953405, "creation_date": 1542952568, "answer_id": 53441307, "question_id": 53441113, "link": "https://stackoverflow.com/questions/53441113/haskell-how-to-print-some-value-in-a-function-for-debugging-purpose/53441307#53441307", "title": "Haskell - How to print some value in a function for debugging purpose?", "body": "<p>For debugging, use <code>trace</code>  and friends.</p>\n\n<pre><code>import Debug.Trace\ni = 3.0\n\nmain :: IO ()\nmain = traceShow i $ putStrLn \"Hello world\"\n</code></pre>\n\n<p><a href=\"https://ideone.com/4RWp2P\" rel=\"nofollow noreferrer\">See it live</a></p>\n\n<p>Note the trace appears on the standard <em>error</em> stream, as debugging output should.</p>\n\n<p>The function you use <code>trace</code> in doesn't have to be IO-typed. This for example will also work:</p>\n\n<pre><code>add a b = a + traceShow i b\n</code></pre>\n\n<p>Trace functions are a bit foreign to Haskell because they are technically impure. However the side effects are limited in scope and not observable by the program itself, so it's kinda OK. </p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.12.0.0/Debug-Trace.html\" rel=\"nofollow noreferrer\">More info</a></p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 3, "last_activity_date": 1542957034, "creation_date": 1542957034, "answer_id": 53442096, "question_id": 53441113, "link": "https://stackoverflow.com/questions/53441113/haskell-how-to-print-some-value-in-a-function-for-debugging-purpose/53442096#53442096", "title": "Haskell - How to print some value in a function for debugging purpose?", "body": "<p>In an <code>IO</code> action, you can just use <code>putStrLn</code> or <code>print</code> as usual, like</p>\n\n<pre><code>do\n  print i\n  putStrLn \"Hello world\"\n</code></pre>\n\n<p>Which desugars to <code>print i &gt;&gt; putStrLn \"\u2026\"</code>. This is equivalent, but not really any better because the action <code>m</code> doesn\u2019t really need to be named:</p>\n\n<pre><code>let m = print i  -- define an action\nin do\n  m  -- ensure the action is actually executed\n  putStrLn \"Hello world\"\n</code></pre>\n\n<p>In a pure function, you can use <code>trace</code> or <code>traceShow</code> from <code>Debug.Trace</code>:</p>\n\n<pre><code>traceShow i (putStrLn \"Hello world\")\n</code></pre>\n\n<p>But be aware that these print when the expression is <em>forced</em>, which may be in a different order than you may expect due to lazy evaluation, or not at all if a value is never used. You can add strictness annotations with <code>seq</code> or <code>BangPatterns</code> as you tried for the monadic code to assist with making sure that things are forced when you expect\u2014the reason <code>!m = \u2026</code> didn\u2019t work for your <code>IO</code> action is that the strictness annotation only makes the expression <em>evaluated</em>, producing an <code>IO</code> action but not <em>executing</em> it because it\u2019s not sequenced with another action as part of <code>main</code>. Remember: you can only (purely) <em>construct</em> <code>IO</code> actions and bind them together; the runtime is what actually executes them.</p>\n\n<p>Finally, in a \u201cpure\u201d monad where you don\u2019t have <code>IO</code> available, you can still use <code>trace</code> &amp;c., for example in the list monad:</p>\n\n<pre><code>numbers :: [Int]\nnumbers = do\n  x &lt;- [1, 2, 3]\n  traceShow x (pure ())\n  y &lt;- [4, 5, 6]\n  traceShow y (pure ())\n  pure (x * y)\n</code></pre>\n"}], "owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 643, "favorite_count": 1, "accepted_answer_id": 53442096, "answer_count": 3, "score": 3, "last_activity_date": 1542957034, "creation_date": 1542951243, "question_id": 53441113, "link": "https://stackoverflow.com/questions/53441113/haskell-how-to-print-some-value-in-a-function-for-debugging-purpose", "title": "Haskell - How to print some value in a function for debugging purpose?", "body": "<p>I'm a Haskell newbie and I want to do something which has a side effect like this:</p>\n\n<pre><code>i = 3.0\n\nmain :: IO ()\nmain = let m = print i in putStrLn \"Hello world\"\n</code></pre>\n\n<p>Then I can know the value of <code>i</code> when <code>main</code> runs, but the <code>I</code> didn't print. I add <code>!</code> before <code>m</code> but it also doesn't work. I would like to know how to hack this, thanks in advance!</p>\n"}, {"tags": ["haskell", "typeclass", "polyvariadic"], "comments": [{"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1543009541, "post_id": 53439643, "comment_id": 93779023, "body": "My question was not correctly described. I have modified my question."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1542940199, "creation_date": 1542940199, "answer_id": 53439980, "question_id": 53439643, "link": "https://stackoverflow.com/questions/53439643/haskell-function-with-different-number-of-argument/53439980#53439980", "title": "Haskell function with different number of argument", "body": "<p>It works if you use the function you presented, <code>titleTeX</code>, and not some other function you have yet to show, <code>titleLaTeX</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "edited": false, "score": 0, "creation_date": 1543068943, "post_id": 53453563, "comment_id": 93789678, "body": "Perfect and well detailed answer!"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1543012551, "creation_date": 1543012551, "answer_id": 53453563, "question_id": 53439643, "link": "https://stackoverflow.com/questions/53439643/haskell-function-with-different-number-of-argument/53453563#53453563", "title": "Haskell function with different number of argument", "body": "<p>The error occurs because you have exactly two instances of <code>Titles</code> in your program:</p>\n\n<pre><code>instance Titles String\ninstance Titles (String -&gt; String)\n</code></pre>\n\n<p>These let you call <code>titleTeX</code> with one and two arguments respectively, but three arguments would require</p>\n\n<pre><code>instance Titles (String -&gt; String -&gt; String)\n</code></pre>\n\n<p>which doesn't exist. Or as ghc puts it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u2022 No instance for (Main.Titles ([Char] -&gt; [Char] -&gt; String))\n    arising from a use of \u2018titleTeX\u2019\n</code></pre>\n\n<p>(<code>[Char]</code> is the same as <code>String</code>.)</p>\n\n<p>It's as if you'd defined a function</p>\n\n<pre><code>foo :: [Int] -&gt; Int\nfoo [x] = ...\nfoo [x, y] = ...\n</code></pre>\n\n<p>but <code>foo [x, y, z]</code> is an error.</p>\n\n<p>To make this work for any number of arguments, we need to use recursion. As with list functions (where you'd typically have a base case <code>foo [] = ...</code> and a recursive case <code>foo (x : xs) = ...</code> that calls <code>foo xs</code> somewhere), we need to define a <code>Titles</code> instance in terms of other instances:</p>\n\n<pre><code>instance Titles String\ninstance (Titles a) =&gt; Titles (String -&gt; a)\n</code></pre>\n\n<p>The tricky bit is that I don't see a way to implement a <code>titleTeX</code> that fits the above declarations.</p>\n\n<p>I had to make other changes to your code to make it work:</p>\n\n<pre><code>{-# Language FlexibleInstances #-}\n\ntitleTeX :: (Titles a) =&gt; String -&gt; a\ntitleTeX str = titleTeXAccum [str]\n</code></pre>\n\n<p><code>titleTeX</code> isn't a method anymore. It's just a convenience front-end for the actual <code>titleTeXAccum</code> method.</p>\n\n<p>In principle we could have omitted the <code>String</code> parameter and defined <code>titleTeX :: (Titles a) =&gt; a</code> as <code>titleTeX = titleTexAccum []</code>, but then <code>titleTex :: String</code> would crash at runtime (because we end up calling <code>maximum</code> on an empty list).</p>\n\n<pre><code>class Titles a where\n  titleTeXAccum :: [String] -&gt; a\n</code></pre>\n\n<p>Our method now takes a list of strings that it (somehow) turns into a value of type <code>a</code>.</p>\n\n<pre><code>instance Titles String where\n  titleTeXAccum acc = titleWithFrame 1 \"%\" \"%\" \"%\" (reverse acc)\n</code></pre>\n\n<p>The implementation for <code>String</code> is easy: We just call <code>titleWithFrame</code>. We also pass <code>reverse acc</code> because the order of elements in the accumulator is backwards (see below).</p>\n\n<pre><code>instance (Titles a) =&gt; Titles (String -&gt; a) where\n  titleTeXAccum acc str = titleTeXAccum (str : acc)\n</code></pre>\n\n<p>This is the crucial part: The general <code>titleTeXAccum</code> method forwards to another <code>titleTeXAccum</code> method (of a different type / different <code>Titles</code> instance). It adds <code>str</code> to the accumulator. We could have written <code>acc ++ [str]</code> to add the new element at the end, but that's inefficient: Calling <code>titleTeXAccum</code> with N elements would take O(N^2) time (due to repeated list traversals in <code>++</code>). Using <code>:</code> and only calling <code>reverse</code> once at the end reduces this to O(N).</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "accepted_answer_id": 53453563, "answer_count": 2, "score": 2, "last_activity_date": 1543012551, "creation_date": 1542936016, "last_edit_date": 1543011377, "question_id": 53439643, "link": "https://stackoverflow.com/questions/53439643/haskell-function-with-different-number-of-argument", "title": "Haskell function with different number of argument", "body": "<p>I'm trying to create a Haskell function with a class to get this function to work with different numbers of arguments.</p>\n\n<pre><code>{-# Language FlexibleInstances #-}\n\nclass Titles a where\n  titleTeX ::  String -&gt; a\n\ninstance Titles String where\n  titleTeX str = titleWithFrame 1 \"%\" \"%\" \"%\" [str]\n\ninstance  Titles (String -&gt; String) where\n  titleTeX str = (\\s -&gt; titleWithFrame 1 \"%\" \"%\" \"%\" (s:[str]))\n\ntitleWithFrame::Int -&gt; String -&gt; String -&gt; String -&gt; [String] -&gt; String\ntitleWithFrame nb beg end com lstr =\n  cadr++cont++cadr\n    where\n          cadr = concat $ replicate nb (beg++rempl++end++\"\\n\")\n          cont = concatMap (\\s -&gt; beg++\" \"++s++\" \"++end++\"\\n\") lstr\n          rempl = take long $ concat $ replicate long com\n          long = (maximum $ map length lstr) + 2\n</code></pre>\n\n<p>When I try this function with ghci, I have the following results:</p>\n\n<pre><code>ghci&gt; putStr $ titleTeX \"Line 1\"\n%%%%%%%%%%\n% Line 1 %\n%%%%%%%%%%\nghci&gt; putStr $ titleTeX \"Line 1\" \"Line 2\"\n%%%%%%%%%%\n% Line 1 %\n% Line 2 %\n%%%%%%%%%%\nghci&gt; putStr $ titleTeX \"Line 1\" \"Line 2\" \"Line 3\"\n\n&lt;interactive&gt;:4:10: error:\n    \u2022 No instance for (Main.Titles ([Char] -&gt; [Char] -&gt; String))\n        arising from a use of \u2018titleTeX\u2019\n        (maybe you haven't applied a function to enough arguments?)\n    \u2022 In the second argument of \u2018($)\u2019, namely\n        \u2018titleTeX \"Line 1\" \"Line 2\" \"Line 3\"\u2019\n      In the expression: putStr $ titleTeX \"Line 1\" \"Line 2\" \"Line 3\"\n      In an equation for \u2018it\u2019:\n          it = putStr $ titleTeX \"Line 1\" \"Line 2\" \"Line 3\"\n</code></pre>\n\n<p>I don't understand where my error is and why my polyvariadic function doesn't work with more than 2 arguments.</p>\n\n<p><strong>Do you know where my error comes from? and How to make my function work with an arbitrary number of arguments?</strong></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1542912261, "creation_date": 1542912261, "answer_id": 53436643, "question_id": 53436536, "link": "https://stackoverflow.com/questions/53436536/haskell-sort-list-of-tuples-by-the-last-tuple-element/53436643#53436643", "title": "Haskell - Sort List of Tuples by the Last Tuple Element", "body": "<p>You can define your own projection</p>\n\n<pre><code>get4thOf4 :: (a,b,c,d) -&gt; d\nget4thOf4 (_,_,_,d) = d\n</code></pre>\n\n<p>after which you can use <code>sortBy (comparing get4thof4)</code>.</p>\n\n<p>Alternatively, use a lambda: <code>sortBy (comparing (\\(_,_,_,d) -&gt; d))</code></p>\n\n<p>(<code>comparing ...</code> means the same thing as <code>compare `on` ...</code>)</p>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "edited": false, "score": 0, "creation_date": 1542922930, "post_id": 53436647, "comment_id": 93750256, "body": "Thank you so much!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1542931061, "post_id": 53436647, "comment_id": 93751994, "body": "Or just <code>sortOn frth</code>."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1542957432, "post_id": 53436647, "comment_id": 93757147, "body": "<code>sortBy (compare `on` f)</code> = <code>sortBy (comparing f)</code> = <code>sortOn f</code>"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 6, "last_activity_date": 1542912286, "creation_date": 1542912286, "answer_id": 53436647, "question_id": 53436536, "link": "https://stackoverflow.com/questions/53436536/haskell-sort-list-of-tuples-by-the-last-tuple-element/53436647#53436647", "title": "Haskell - Sort List of Tuples by the Last Tuple Element", "body": "<p><code>fst</code> and <code>snd</code> are provided <em>specifically</em> for 2-tuples as convenience functions. However, you can very easily write a function that works for 4-tuples.</p>\n\n<pre><code>frth :: (a, b, c, d) -&gt; d\nfrth (_, _, _, d) = d\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>sortBy (compare `on` frth)\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 0, "closed_date": 1542968595, "accepted_answer_id": 53436647, "answer_count": 2, "score": -1, "last_activity_date": 1542912286, "creation_date": 1542911674, "question_id": 53436536, "link": "https://stackoverflow.com/questions/53436536/haskell-sort-list-of-tuples-by-the-last-tuple-element", "closed_reason": "Duplicate", "title": "Haskell - Sort List of Tuples by the Last Tuple Element", "body": "<p>I have been trying to find a way to sort a list [(a,b,c,d),(e,f,g,h)] by the <strong>d</strong> element.</p>\n\n<p>So far I have tried: <strong>sortBy (compare <code>on</code> snd)</strong> but I cant find a way to get the 4th element and <strong>not the 2nd</strong>.</p>\n\n<p>My output has to be the same but ordered instead.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["sqlite", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1542958657, "post_id": 53436402, "comment_id": 93757660, "body": "Hi @Chi with a little change it works. Thanks so much to get me on track again. Library is new for me too and on pulling in the entire table like I did, SQLite throws an error anyway. Maybe if others run into this &#39;problem&#39; and read your reply, here&#39;s the modified code that works:   <code>conn &lt;- open &quot;taglist.db&quot;\\n   len &lt;- query_ conn &quot;SELECT (id) FROM task&quot; :: IO [Only Int]   let showLength = Data.List.length $ len   print showLength   close conn   return ()</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1542976020, "post_id": 53436402, "comment_id": 93766224, "body": "@Madderote If you have a completely working code, you can post it answering your own question. StackOverflow&#39;s policy encourage self-answers, when they can be useful to others."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1542985581, "post_id": 53436402, "comment_id": 93770708, "body": "Thanks for the tip. Will do with future issues, which I will encounter for sure ;-)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 0, "last_activity_date": 1542910877, "creation_date": 1542910877, "answer_id": 53436402, "question_id": 53436097, "link": "https://stackoverflow.com/questions/53436097/haskell-sqlite3-query-all/53436402#53436402", "title": "Haskell SQLite3 query all", "body": "<p>I am not terribly familiar with these libraries. I check the docs\nof <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.6/docs/Database-PostgreSQL-Simple.html#t:ToRow\" rel=\"nofollow noreferrer\"><code>Database.PostgreSQL.Simple</code></a>\nand found out that, if you don't have arguments to your query, you can use <code>query_</code> and omit the argument tuple. The examples at the very beginning of the docs are quite helpful.</p>\n\n<p>That being said, your approach looks wrong. You are pulling the whole table from the DB only to count the entries. This is a waste: you should instead use something like <code>select count(*) from ..</code> so that you query for the length only.</p>\n\n<p>This might work: (again, I've never used that library)</p>\n\n<pre><code>[Only len] &lt;- query_ conn \"select count(*) from task\" :: IO [Only Int]\n</code></pre>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 53436402, "answer_count": 1, "score": 1, "last_activity_date": 1542910877, "creation_date": 1542909045, "question_id": 53436097, "link": "https://stackoverflow.com/questions/53436097/haskell-sqlite3-query-all", "title": "Haskell SQLite3 query all", "body": "<p>Would like to determine the size of a table (length) to avoid a user entering an incremental ID that already exists (Note: left all Haskell books to get my feet wet). Got a table with <code>id, task, date_in, date_out</code> and need to count the number id's. Using this function: </p>\n\n<pre><code>checkUniqueID = do\n  conn &lt;- open \"taglist.db\"\n  len &lt;- query conn \"SELECT * FROM task;\" (Only xxx) :: IO [id]\n  let showLength = length $ len\n  print showLength\n  close conn\n  return ()\n</code></pre>\n\n<p>However: omitting the '<code>Only</code>' will result in ghci mentioning too few arguments, but I really cannot figure out what to put at xxx. Too bad all Haskell doc is so fragmented, since it is such a cool language. \nThanks guys!</p>\n"}, {"tags": ["haskell", "types", "numbers"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1542897495, "post_id": 53433088, "comment_id": 93740221, "body": "You could write an <code>instance Num DataType</code> and define <code>fromInteger</code> so that it errors out on invalid values. I&#39;m not sure if that&#39;s a good idea, but it&#39;s the only way to achieve your goal."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1542898203, "post_id": 53433088, "comment_id": 93740599, "body": "@chi I actually suspect a transcription error there, given that it&#39;s ascribing function types to literals.  Not impossible, but I suspect that it&#39;s actually about creating a function to behave in such a way."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1542899542, "post_id": 53433088, "comment_id": 93741386, "body": "@Carl I&#39;m pretty sure the above <code>-&gt;</code> represents &quot;evaluates to&quot;, not function arrow. My comment assumed that interpretation, otherwise the question makes no sense. I&#39;m now replacing them with <code>==&gt;</code> to avoid confusion."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1542899769, "post_id": 53433088, "comment_id": 93741524, "body": "Beyond <code>instance Num DataType</code>, for real numbers we would also need <code>instance Fractional DataType</code>, and define a partial <code>fromRational</code> to reject invalid numbers."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1542900490, "post_id": 53433088, "comment_id": 93741910, "body": "You might want to use something like <a href=\"https://ucsd-progsys.github.io/liquidhaskell-blog/\" rel=\"nofollow noreferrer\">Liquid Haskell</a>, which provides support for dependent types on top of Haskell."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1542962964, "post_id": 53433088, "comment_id": 93759488, "body": "Have you considered using <i>smart constructors</i>. Might by a good idea here. <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">wiki.haskell.org/Smart_constructors</a>"}], "owner": {"reputation": 152, "user_id": 3832741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b2d9a1d01a90d056c75963e0c06fba?s=128&d=identicon&r=PG&f=1", "display_name": "Agilix", "link": "https://stackoverflow.com/users/3832741/agilix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 147, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1542899592, "creation_date": 1542896830, "last_edit_date": 1542899592, "question_id": 53433088, "link": "https://stackoverflow.com/questions/53433088/create-new-bounded-number-data-types-in-haskell", "title": "Create new bounded number data types in Haskell", "body": "<p>I need to create a data type, that represents only the real numbers between 0 and 1. How would i go about that? Expected Behavior:</p>\n\n<pre><code>0 :: DataType        ===&gt; DataType 0\n(-1) :: DataType     ===&gt; Error\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1542905706, "post_id": 53431706, "comment_id": 93744545, "body": "That&#39;s the same error you would get with <i>any</i> argument to <code>read</code>, because you haven&#39;t specified what type of value you want back."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 7, "last_activity_date": 1542894582, "last_edit_date": 1542894582, "creation_date": 1542892852, "answer_id": 53431931, "question_id": 53431706, "link": "https://stackoverflow.com/questions/53431706/read-ing-an-octal-number/53431931#53431931", "title": "read-ing an octal number", "body": "<p>The type of <code>read \"0o10\"</code> is:</p>\n\n<pre><code>GHCi&gt; :t read \"0o10\"\nread \"0o10\" :: Read a =&gt; a\n</code></pre>\n\n<p>In GHCi, the type variable <code>a</code> will be defaulted to <code>()</code>, <a href=\"https://downloads.haskell.org/~ghc/8.6.2/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"noreferrer\">as explained in the User's Guide</a>:</p>\n\n<pre><code>GHCi&gt; read \"()\"\n()\n</code></pre>\n\n<p>Note that the behaviour you describe is not limited to strings that would be parsed as octals...</p>\n\n<pre><code>GHCi&gt; read \"[1,2,3]\"\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>... and that <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Text-Read.html#v:lex\" rel=\"noreferrer\"><code>lex :: ReadS String</code></a>, unlike <code>read</code>, specifically produces <code>String</code> results, rather than allowing you to pick an instance of <code>Read</code>.</p>\n\n<p>To get the behaviour you expect, provide a suitable type annotation or signature:</p>\n\n<pre><code>GHCi&gt; read \"0o10\" :: Integer\n8\n</code></pre>\n"}], "owner": {"reputation": 10335, "user_id": 772868, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/dt3Kv.jpg?s=128&g=1", "display_name": "false", "link": "https://stackoverflow.com/users/772868/false"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 53431931, "answer_count": 1, "score": 1, "last_activity_date": 1542894582, "creation_date": 1542891966, "question_id": 53431706, "link": "https://stackoverflow.com/questions/53431706/read-ing-an-octal-number", "title": "read-ing an octal number", "body": "<p>Octal numbers are part of Haskell's integer syntax. Also <code>lex</code> recognizes it:</p>\n\n<pre><code>Prelude&gt; lex \"0o10\"\n[(\"0o10\",\"\")]\n</code></pre>\n\n<p>But <code>read</code> does not (ghc 8.0.2 on Ubuntu 18.04):</p>\n\n<pre><code>Prelude&gt; read \"0o10\"\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>The report is not very clear on this in 6.3.3. It just states that <code>lex</code> reads a lexeme and that <code>lex</code> is used by <code>read</code>. Is this intended?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1542875457, "post_id": 53426475, "comment_id": 93727573, "body": "Take a look to monad transformers. <code>EitherT</code> is what you are looking for."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 2, "creation_date": 1542876367, "post_id": 53426475, "comment_id": 93728013, "body": "@LuisMorillo There&#39;s no <code>EitherT</code> in the <code>transformers</code> package; it&#39;s called <code>ExceptT</code>. See e.g. <a href=\"https://www.reddit.com/r/haskell/comments/3ded39/why_cant_we_have_an_eithert_in_transformers/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/3ded39/&hellip;</a>"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1542877366, "post_id": 53426475, "comment_id": 93728557, "body": "@MarkSeemann my fault. I searched for EitherT and turns out that exists in <code>Control.Monad.Trans.Either </code>. Don&#39;t know if it has the same functionality"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 10, "last_activity_date": 1542878461, "creation_date": 1542878461, "answer_id": 53427527, "question_id": 53426475, "link": "https://stackoverflow.com/questions/53426475/how-to-simplify-the-error-handling-in-io-either-a-b/53427527#53427527", "title": "How to simplify the error handling in (IO (Either a b))", "body": "<p>You can use the <code>ExceptT</code> monad transformer for this. I haven't tried to run the following proposed changes, but it compiles, so I hope it works.</p>\n\n<p>First, import the module that contains <code>ExceptT</code>:</p>\n\n<pre><code>import Control.Monad.Trans.Except\n</code></pre>\n\n<p>Next, change the <code>printFile</code> function:</p>\n\n<pre><code>printFile :: IO (Either MissingError String)\nprintFile = runExceptT $ do\n  path &lt;- ExceptT $ getEnv' \"FOLDER\" (MissingEnv \"FOLDER\")\n  ExceptT $ readFile' path (MissingFile path)\n</code></pre>\n\n<p>You have functions that return <code>IO (Either MissingError String)</code>, so wrapping them in <code>ExceptT</code> gives you <code>do</code> notation that enables you to access the <code>String</code> embedded in what's effectively <code>ExcepT MissingError IO String</code>.</p>\n\n<p>Then unwrap the <code>ExceptT</code> return value with <code>runExceptT</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 224, "user_id": 10668680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c4996037684a7b9e963c7c3d19c260?s=128&d=identicon&r=PG&f=1", "display_name": "Erick Gonzalez", "link": "https://stackoverflow.com/users/10668680/erick-gonzalez"}, "is_accepted": false, "score": 7, "last_activity_date": 1542883035, "creation_date": 1542883035, "answer_id": 53429033, "question_id": 53426475, "link": "https://stackoverflow.com/questions/53426475/how-to-simplify-the-error-handling-in-io-either-a-b/53429033#53429033", "title": "How to simplify the error handling in (IO (Either a b))", "body": "<p>The suggestion to use <code>ExceptT</code> is of course a good one but IMHO the proposed answer is still somewhat verbose and you can go a bit farther by simply \"staying\" in the <code>ExceptT</code> monad throughout your code. Also I would not recommend handling IO exceptions all over the place. Even with a small code base you would lose oversight of your code quickly. <code>tryIOError</code> is useful in this regard. And finally rethinking the definition of your errors would also yield easier to understand and a more solid solution. The end result would look something like this:</p>\n\n<pre><code>module Main where\n\nimport Data.Bifunctor       (first)\nimport Control.Monad.Except (ExceptT(..), runExceptT)\nimport System.Environment   (getEnv)\nimport System.IO.Error      (tryIOError, isDoesNotExistError)\n\ndata MyError = MissingError String\n             | SomeIOError IOError\n               deriving (Show)\n\nmain :: IO ()\nmain = do\n  result &lt;- runExceptT printFile\n  print result\n\ngetEnv' :: String -&gt; ExceptT MyError IO String\ngetEnv' env = mapIOError (\"getting env var \" ++ env) $ getEnv env\n\nreadFile' :: FilePath -&gt; ExceptT MyError IO String\nreadFile' path = mapIOError (\"reading file \" ++ path) $ readFile path\n\nprintFile :: ExceptT MyError IO String\nprintFile = do\n  path &lt;- getEnv' \"FOLDER\"\n  readFile' path\n\nmapIOError :: String -&gt; IO a -&gt; ExceptT MyError IO a\nmapIOError msg = ExceptT . fmap (first mapError) . tryIOError\n    where mapError err | isDoesNotExistError err = MissingError msg\n          mapError err                           = SomeIOError err\n</code></pre>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1233, "favorite_count": 2, "accepted_answer_id": 53427527, "answer_count": 2, "score": 7, "last_activity_date": 1542883035, "creation_date": 1542874494, "last_edit_date": 1542878506, "question_id": 53426475, "link": "https://stackoverflow.com/questions/53426475/how-to-simplify-the-error-handling-in-io-either-a-b", "title": "How to simplify the error handling in (IO (Either a b))", "body": "<p>I'm using the following scenario as an example to learn how to handle errors in a simple way. The scenario is basically read a file path from an environment variable, then read and print the file with the file path. </p>\n\n<p>The following code works, but I don't like the <code>printFile</code> because it has nested <code>case of</code>, a bit hard to read. I wonder if there is a clean way to get rid of it and keep the <code>printFile</code> function flat without using <code>lookupEnv</code>?</p>\n\n<p>How would you simplify this error handling flow?</p>\n\n<pre><code>module Main where\n\nimport Control.Exception (IOException, handle, throw)\nimport System.Environment (getEnv)\nimport System.IO.Error (isDoesNotExistError)\n\ndata MissingError\n  = MissingEnv String\n  | MissingFile String\n  deriving (Show)\n\nmain :: IO ()\nmain = do\n  eitherFile &lt;- printFile\n  either print print eitherFile\n\ngetEnv' :: String -&gt; MissingError -&gt; IO (Either MissingError String)\ngetEnv' env err = handle (missingEnv err) $ Right &lt;$&gt; (getEnv env)\n\nreadFile' :: FilePath -&gt; MissingError -&gt; IO (Either MissingError String)\nreadFile' path err = handle (missingFile err) $ Right &lt;$&gt; (readFile path)\n\nmissingEnv :: MissingError -&gt; IOException -&gt; IO (Either MissingError String)\nmissingEnv err = const $ return $ Left err\n\nmissingFile :: MissingError -&gt; IOException -&gt; IO (Either MissingError String)\nmissingFile err e\n  | isDoesNotExistError e = return $ Left err\n  | otherwise = throw e\n\nprintFile :: IO (Either MissingError String)\nprintFile = do\n  eitherFilePath &lt;- getEnv' \"FOLDER\" (MissingEnv \"FOLDER\")\n  case eitherFilePath of\n    Left err -&gt; return $ Left err\n    Right path -&gt; readFile' path (MissingFile path)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "side-effects"], "comments": [{"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 0, "creation_date": 1542871265, "post_id": 53425231, "comment_id": 93725581, "body": "Not sure if it has the precise/clear/short answer you are looking for, but here /r/haskell discusses &quot;What is a side effect&quot; <a href=\"https://www.reddit.com/r/haskell/comments/2p9cvz/noob_question_what_is_exactly_side_effect/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/2p9cvz/&hellip;</a>"}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 3, "creation_date": 1542871460, "post_id": 53425231, "comment_id": 93725655, "body": "&quot;Monads can be considered an effect&quot; is a weird thing to say. The two concepts seem fairly orthogonal. As you say, monads provide an abstraction to deal with composition. Some monads (such as a List) have nothing to do with effects at all. Others (<code>IO</code>) provide a way to deal with effects in an otherwise pure world."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 1, "creation_date": 1542882659, "post_id": 53425231, "comment_id": 93731863, "body": "(1) Do let us know if you think the suggested question does not suffice. (2) The suggested question does not discuss monad transformers, but I don&#39;t think that is essential: the broader notion of effect generalises to applicative functors, which do not need transformers to be composed. (3) @Thilo : On the matter of orthogonality, I&#39;d say that &quot;effect&quot; has two meanings in common use -- a narrower meaning which is orthogonal, and a broader meaning that is not. My answer to the suggested question makes this case in some detail."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1542910096, "post_id": 53425231, "comment_id": 93746335, "body": "thanks for comments, just got home from work, gonna think about this a bit more and get back to your comments once I thought about this a bit more"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "closed_date": 1542881642, "answer_count": 0, "score": 1, "last_activity_date": 1542870867, "creation_date": 1542869042, "last_edit_date": 1542870867, "question_id": 53425231, "link": "https://stackoverflow.com/questions/53425231/what-is-an-composite-effect-possibly-represented-as-a-monadmonad-transformer", "closed_reason": "Duplicate", "title": "What is an (composite) effect (possibly represented as a Monad+Monad Transformers) ? Precise, clear, short answer/definition?", "body": "<p>Motivation : \"functional programs\" focus on being \"pure\", and we all know what \"pure\" is : referential transparency, \"no-effects\", etc...</p>\n\n<p>but the problem is that this only one side of the coin.</p>\n\n<p>I have not yet seen a clear definition of what an effect is.</p>\n\n<p>In Haskell for example practically every non trivial \"Monad\" can be considered as an \"effect\" and there gizillion types of specific monads out there ... the problem is I don't see what is the connection between them ?</p>\n\n<p>Say : <code>[]</code> (List) Monad vs <code>State</code> monad vs <code>IO</code> monad vs <code>Future</code> monad etc... <strong>how are these all effects ?</strong></p>\n\n<p>What do they have in common ?</p>\n\n<p>I understand intuitively that these are all \"effects\" but how ? Why ? What connects them ? When the values of these types (say <code>[a]</code>) are itself \"effect-less\"/pure/immutable ?</p>\n\n<p><strong>The answer I am looking for is not \"anything that is not referentially transparent\".</strong> </p>\n\n<p>That is a \"negative answer\", I am looking for the opposite \"type of answer\", something that tells me what IS an effect and not what is it NOT.</p>\n\n<p>Especially the question lies in : <code>IO</code> is the \"ultimate\" effect. Now, in what sense do we/can we/should we divide <code>IO</code> into \"sub-effects\" that are \"non-interacting\" => this brings us towards one possible answer: Monad Transformers. They try to solve the problem of composing effects BUT they do not themselves answer the question : what is an effect ? More importantly, how should I devide a \"large/wide effect\" (such as <code>IO</code>), into \"smaller\"/\"narrower\" effects, such as <code>[]</code>, <code>Future</code>, <code>Cont</code>, <code>Writer</code>, <code>Reader</code>, <code>State</code>, <code>Maybe</code> etc... ?</p>\n\n<p>The answer to the question : what is an effect should serve as a possible inspiration to solve problems such as the above \"how to divide <code>IO</code>\" into \"sub\"/simpler effects ?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 1, "creation_date": 1542865398, "post_id": 53424422, "comment_id": 93723320, "body": "What is your question?"}, {"owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "edited": false, "score": 3, "creation_date": 1542865499, "post_id": 53424422, "comment_id": 93723347, "body": "You can always look at the source of the built-in functions, so you shouldn&#39;t count those out."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10683523, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ALdOAg1Uvu0/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gXANU_xmNaDZPgjm9zVxHMX2YXRQ/mo/photo.jpg?sz=128", "display_name": "zhong zheng", "link": "https://stackoverflow.com/users/10683523/zhong-zheng"}, "edited": false, "score": 0, "creation_date": 1542896794, "post_id": 53424830, "comment_id": 93739821, "body": "Thank you for your answer!"}], "tags": [], "owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "is_accepted": false, "score": 1, "last_activity_date": 1542867400, "last_edit_date": 1542867400, "creation_date": 1542866980, "answer_id": 53424830, "question_id": 53424422, "link": "https://stackoverflow.com/questions/53424422/haskell-how-to-remove-a-list-from-a-list-in-haskell/53424830#53424830", "title": "Haskell: How to remove a List from a List in Haskell", "body": "<p>This is one simple way:</p>\n\n<pre><code>removeAll ignores = filter (\\x -&gt; notElem x ignores)\n</code></pre>\n\n<p>which makes use of:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#filter\" rel=\"nofollow noreferrer\"><code>filter</code></a></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Foldable.html#notElem\" rel=\"nofollow noreferrer\"><code>notElem</code></a></li>\n</ul>\n\n<p>If you wanted to write it in \"pure-pure\" Haskell, with no auxiliary functions... well, it sounds like it would be pretty ugly since we'd need to do some sort of nested for-loop. Here's a compromise:</p>\n\n<pre><code>myFilter _ [] = []\nmyFilter pred (x:xs)\n  | pred x = x : myFilter pred xs\n  | otherwise = myFilter pred xs\n\nmyNotElem e [] = True\nmyNotElem e (x:xs)\n  | e == x = False\n  | otherwise = myNotElem e xs\n\nremoveAll ignores = myFilter (\\x -&gt; myNotElem x ignores)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": true, "score": 0, "last_activity_date": 1542872168, "creation_date": 1542872168, "answer_id": 53425955, "question_id": 53424422, "link": "https://stackoverflow.com/questions/53424422/haskell-how-to-remove-a-list-from-a-list-in-haskell/53425955#53425955", "title": "Haskell: How to remove a List from a List in Haskell", "body": "<p>There is a pretty straightforward recursive definition</p>\n\n<pre><code>removeAll :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nremoveAll _        []     = []\nremoveAll toRemove (x:xs) \n  | x `belongs` toRemove = removeAll toRemove xs \n  | otherwise            = x:removeAll toRemove xs \n    where belongs _ [] = False\n          belongs a (y:ys)\n            | a == y    = True\n            | otherwise = belongs a ys \n</code></pre>\n\n<p>The <code>belongs</code> function is just the prelude defined <code>elem</code>. Since you don't want to use built-in functions you have to define it yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 3550, "user_id": 816999, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/190b7d54fa9bbcc29622ebd09fab3a2c?s=128&d=identicon&r=PG", "display_name": "Yongwei Wu", "link": "https://stackoverflow.com/users/816999/yongwei-wu"}, "is_accepted": false, "score": 0, "last_activity_date": 1542961370, "creation_date": 1542961370, "answer_id": 53442955, "question_id": 53424422, "link": "https://stackoverflow.com/questions/53424422/haskell-how-to-remove-a-list-from-a-list-in-haskell/53442955#53442955", "title": "Haskell: How to remove a List from a List in Haskell", "body": "<p>A problem of your current code is that you tried to recurse in two lists simultaneously in one function. You need to divide and conquer. If <code>elem</code> is allowed, you may write:</p>\n\n<pre><code>removeAll :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nremoveAll _ [] = []\nremoveAll x (y:ys)\n    | myElem y x = removeAll x ys\n    | otherwise = y:removeAll x ys\n</code></pre>\n\n<p>If you do not want to use the built-in <code>elem</code> as well, you can define it similarly:</p>\n\n<pre><code>myElem :: Eq a =&gt; a -&gt; [a] -&gt; Bool\nmyElem _ [] = False\nmyElem x (y:ys)\n    | x == y = True\n    | otherwise = myElem x ys\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10683523, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ALdOAg1Uvu0/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gXANU_xmNaDZPgjm9zVxHMX2YXRQ/mo/photo.jpg?sz=128", "display_name": "zhong zheng", "link": "https://stackoverflow.com/users/10683523/zhong-zheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 53425955, "answer_count": 3, "score": -1, "last_activity_date": 1542961370, "creation_date": 1542864644, "last_edit_date": 1542865164, "question_id": 53424422, "link": "https://stackoverflow.com/questions/53424422/haskell-how-to-remove-a-list-from-a-list-in-haskell", "title": "Haskell: How to remove a List from a List in Haskell", "body": "<p>I have a first list and a second list, and I want to write a function that takes two lists and returns a list containing only those elements in the second list that do not appear in the first. And I don't want to use built-in functions. For example:</p>\n\n<pre><code>&gt; removeAll [1..3] [0..10]\n[0,4,5,6,7,8,9,10]\n\n&gt; removeAll \"aeiou\" \"supercalifragilisticexpialidocious\"\n\"sprclfrglstcxpldcs\"\n\nremoveAll _ [] = [] \nremoveAll [] y = y\n\nremoveAll (x:xs) (y:ys)\n    | x==y = removeAll xs ys\n    | otherwise = y:removeAll xs ys\n</code></pre>\n"}, {"tags": ["haskell", "file-io", "huffman-code"], "comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 2, "creation_date": 1542867819, "post_id": 53424380, "comment_id": 93724128, "body": "Take a look at <a href=\"http://hackage.haskell.org/package/bytestring\" rel=\"nofollow noreferrer\">Data.ByteString</a>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1542878919, "post_id": 53424380, "comment_id": 93729472, "body": "See: <a href=\"https://wiki.haskell.org/Dealing_with_binary_data\" rel=\"nofollow noreferrer\">wiki.haskell.org/Dealing_with_binary_data</a>"}], "answers": [{"comments": [{"owner": {"reputation": 224, "user_id": 10668680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c4996037684a7b9e963c7c3d19c260?s=128&d=identicon&r=PG&f=1", "display_name": "Erick Gonzalez", "link": "https://stackoverflow.com/users/10668680/erick-gonzalez"}, "edited": false, "score": 0, "creation_date": 1542891212, "post_id": 53431397, "comment_id": 93736717, "body": "<i>obviously</i> this is some made up encoding.. I have no clue how you want to encode this ;-)"}], "tags": [], "owner": {"reputation": 224, "user_id": 10668680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c4996037684a7b9e963c7c3d19c260?s=128&d=identicon&r=PG&f=1", "display_name": "Erick Gonzalez", "link": "https://stackoverflow.com/users/10668680/erick-gonzalez"}, "is_accepted": false, "score": 2, "last_activity_date": 1542890882, "creation_date": 1542890882, "answer_id": 53431397, "question_id": 53424380, "link": "https://stackoverflow.com/questions/53424380/writing-raw-binary-to-a-file-in-haskell/53431397#53431397", "title": "Writing raw binary to a file in Haskell?", "body": "<p>You probably want to take a look at the <code>Put</code> monad in <code>Data.Binary.Put</code>. You didn't provide any code example but something to get you started:</p>\n\n<pre><code>-- just an example with some made up encoding  \n\nhuffmanEncode :: HTree -&gt; Put\nhuffmanEncode (Leaf c val) = do\n    putWord16be 0xf00\n    putCharUtf8 c\n    putWord32be $ fromIntegral val\nhuffmanEncode (Branch l r x) = do\n    putWord16be 0xbaf\n    putWord32be $ fromIntegral x\n    huffmanEncode l\n    huffmanEncode r\n</code></pre>\n\n<p>You would then \"run\" your encoder thus: <code>runPut $ huffmanEncode myTree</code></p>\n"}], "owner": {"reputation": 11, "user_id": 10689209, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-u6p8veZYlBI/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-g0I_gD2oohh-M4U07kqQvxS_bx5g/mo/photo.jpg?sz=128", "display_name": "Cameron Toy", "link": "https://stackoverflow.com/users/10689209/cameron-toy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542890882, "creation_date": 1542864332, "last_edit_date": 1542871009, "question_id": 53424380, "link": "https://stackoverflow.com/questions/53424380/writing-raw-binary-to-a-file-in-haskell", "title": "Writing raw binary to a file in Haskell?", "body": "<p>I'm trying to do some Huffman coding in Haskell, but am having a hard time figuring out how to save the resulting 1s and 0s as they are instead of as a string. So far, I've read the following--</p>\n\n<p><a href=\"https://wiki.haskell.org/Dealing_with_binary_data\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Dealing_with_binary_data</a></p>\n\n<p><a href=\"https://wiki.haskell.org/Binary_IO\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Binary_IO</a></p>\n\n<p><a href=\"http://hackage.haskell.org/package/binary-0.10.0.0/docs/Data-Binary.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/binary-0.10.0.0/docs/Data-Binary.html</a></p>\n\n<p>--but am still pretty confused as to how to deal with my specific situation. Similarly, I'm having difficulty figuring out how to write the tree structure </p>\n\n<pre><code>data HTree = Leaf Char Int\n           | Branch HTree HTree Int\n             deriving (Show)\n</code></pre>\n\n<p>used to decode the data to a file. (HTree is the structure I'm using to store the Huffman Tree).</p>\n"}]