[{"tags": ["haskell", "recursion", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1504151182, "post_id": 45971343, "comment_id": 78904588, "body": "You do it exactly the same way you&#39;ve done it in your concrete code; you generate <code>let r = .. in ..</code> and refer to that <code>r</code> to construct the recursive calls. Right now, you are just constructing the <code>\\case { .. }</code> portion. Keep in mind you can rewrite <code>recD</code> as <code>recD = let recD_ = \\rE rC -&gt; let r = recD_ rE rC in ... in recD_</code>."}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 3273130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b6a7fd1336f54f3da8bf99bafac2218?s=128&d=identicon&r=PG", "display_name": "Bolpat", "link": "https://stackoverflow.com/users/3273130/bolpat"}, "is_accepted": true, "score": 0, "last_activity_date": 1592193604, "last_edit_date": 1592193604, "creation_date": 1592171825, "answer_id": 62378704, "question_id": 45971343, "link": "https://stackoverflow.com/questions/45971343/define-a-recursive-function-in-template-haskell/62378704#62378704", "title": "Define a Recursive Function in Template Haskell", "body": "<p>You do it exactly the same way you've done it in your concrete code; you generate <code>let r = .. in ..</code> and refer to that <code>r</code> to construct the recursive calls. Right now, you are just constructing the <code>\\case { .. }</code> portion. Keep in mind you can rewrite <code>recD</code> as</p>\n\n<pre><code>recD =\n  let\n    recD_ = \\rE rC -&gt;\n      let r = recD_ rE rC\n      in ...\n  in recD_\n</code></pre>\n\n<p>Credit goes to user2407038 who answered the question in a comment.</p>\n\n<p>The general pattern is to use an additional <code>let</code> construct:</p>\n\n<pre><code>recursive = let recursive_ = expression in recursive_\n</code></pre>\n\n<p>so you can refer to <code>recursive_</code> in <code>expression</code>.</p>\n"}], "owner": {"reputation": 436, "user_id": 3273130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b6a7fd1336f54f3da8bf99bafac2218?s=128&d=identicon&r=PG", "display_name": "Bolpat", "link": "https://stackoverflow.com/users/3273130/bolpat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 62378704, "answer_count": 1, "score": 1, "last_activity_date": 1592193604, "creation_date": 1504137523, "question_id": 45971343, "link": "https://stackoverflow.com/questions/45971343/define-a-recursive-function-in-template-haskell", "title": "Define a Recursive Function in Template Haskell", "body": "<p>I want to implement a generic recursion operator for (at first simple) ADTs.\n(Simple means that only with constructors whose argument types are the defined one.) The general idea is to be able to use something as simple as <code>$(recop ''Alg)</code>.\nIt is easy to write down the recursion operator manually for a given type.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data D = E | C D D\n\nrecD :: t -&gt; ((D, t) -&gt; (D, t) -&gt; t) -&gt; D -&gt; t\nrecD rE rC = let r = recD rE rC in \\case\n    E         -&gt; rE\n    C pC0 pC1 -&gt; rC (pC0, r pC0) (pC1, r pC1)\n</code></pre>\n\n<p>I wanted to use templates for that. My problem is the recursive call e.g. <code>r pC0</code>. I got it working without the recursive call.</p>\n\n<pre><code>newNames :: String -&gt; Int -&gt; Q [Name]\nnewNames stem n = sequence [ newName (stem ++ show i) | i &lt;- [1::Int .. n] ]\nmatch' :: PatQ -&gt; ExpQ -&gt; MatchQ\nmatch' pat exp = match pat (normalB exp) []\n\nrecop :: Name -&gt; ExpQ\nrecop name = do\n    TyConI (DataD _ algName [] {-_-} ctors _) &lt;- reify name\n    let ctorNames = [ ctorName | NormalC ctorName _ &lt;- ctors ] :: [Name]\n    let ctorTypes = [ [ typ | (_, typ) &lt;- bts ] | NormalC _ bts &lt;- ctors ] \n    rs &lt;- newNames (\"r\" ++ nameBase algName) (length ctorNames)\n    pss &lt;- sequence [ newNames (\"p\" ++ nameBase algName ++ nameBase ctorName) (length ctorTypes) | (ctorName, ctorTypes) &lt;- zip ctorNames ctorTypes ]\n    let pats = zipWith conP ctorNames (map varP &lt;$&gt; pss) :: [PatQ]\n    let prs = zipWith (\\p r -&gt; tupE [varE p, r]) ps \"recursive calls\"\n    lamE (varP &lt;$&gt; rs) $ lamCaseE [ match' pat $ foldl appE (varE r) prs | (r, pat, ps) &lt;- zip3 rs pats pss ]\n</code></pre>\n\n<p>I don't know how to get the hole of <code>\"recursive calls\"</code> filled. I have no idea and suspect that it's not easily doable. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1504135720, "post_id": 45971057, "comment_id": 78901362, "body": "Yes ideas like this were tried early in Haskell&#39;s history.  You might enjoy <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/mark.pdf\" rel=\"nofollow noreferrer\">Tackling the Awkward Squad</a>, a paper motivating the design of monadic IO, and also <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/history.pdf?from=http%3A%2F%2Fresearch.microsoft.com%2Fen-us%2Fum%2Fpeople%2Fsimonpj%2Fpapers%2Fhistory-of-haskell%2Fhistory.pdf\" rel=\"nofollow noreferrer\">A Hisory of Haskell: Being Lazy with Class</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1504135758, "post_id": 45971057, "comment_id": 78901372, "body": "Why is it that you have the feeling that hiding the <code>IO</code> part from the programmer, I very much like to have <code>IO actions</code> tagged and know that I have to worry about execution order, and possible IO-Exceptions which might fail. I see no problems in coding your functions pure - which you named <code>operateOn</code> - and tie in the io actions as you did in your first example - if you want to you can use applicative notation to make it feel less imperative <code>putStrLn =&lt;&lt; (operateOn &lt;$&gt; getProgName &lt;*&gt; getArgs &lt;*&gt; contents)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1504136234, "post_id": 45971057, "comment_id": 78901475, "body": "Where does <code>readFile</code> fit in this model? What about <code>getHTTP</code>? <code>openGUIWindow</code>? <code>runSQLQuery</code>? Where do you draw the line and stop accepting more arguments to <code>main</code> when somebody comes along with another idea for a useful impure thing that should be turned pure by becoming an argument?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1504136348, "post_id": 45971057, "comment_id": 78901502, "body": "See also: <a href=\"http://r6.ca/blog/20110520T220201Z.html\" rel=\"nofollow noreferrer\">I/O is not a monad</a>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1504136690, "post_id": 45971057, "comment_id": 78901568, "body": "A <i>lot</i> of things wouldn&#39;t fit into that pattern, such as any interactive command line program."}, {"owner": {"reputation": 1042, "user_id": 3995712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/125124f1e508fe638c6fbe7bc9163ab8?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas Parker", "link": "https://stackoverflow.com/users/3995712/douglas-parker"}, "edited": false, "score": 0, "creation_date": 1504136706, "post_id": 45971057, "comment_id": 78901572, "body": "I understand that this model does not address file IO as a general concept. Reading and writing files directly would still need to be done using Haskell&#39;s existing syntax. IO actions are still necessary for those cases. My question is why the additional syntax and complexity is necessary specifically for the <code>main</code> function. I feel like it already fits the pure functional model, the Haskell committee just chose not to use it as such."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1504136804, "post_id": 45971057, "comment_id": 78901589, "body": "@DouglasParker You cannot &quot;take a value out of&quot; an IO action. That is an important aspect of how purity is maintained. So, it would be impossible to use any of those things in a <code>main</code> that isn&#39;t an IO action, such as the one you are suggesting."}, {"owner": {"reputation": 1042, "user_id": 3995712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/125124f1e508fe638c6fbe7bc9163ab8?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas Parker", "link": "https://stackoverflow.com/users/3995712/douglas-parker"}, "edited": false, "score": 0, "creation_date": 1504137208, "post_id": 45971057, "comment_id": 78901655, "body": "If I&#39;m understanding correctly, then a program which did standard file IO would require a <code>main</code> that returned an IO action. As a result, even programs which do <i>not</i> perform file IO still need to return an IO action. Ok, I think I get why stdout wouldn&#39;t work in this model. But couldn&#39;t you still do something like <code>main :: String -&gt; [String] -&gt; String -&gt; IO a</code> and still pass inputs as direct arguments?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1504144403, "post_id": 45971057, "comment_id": 78903047, "body": "<code>main</code> doesn&#39;t return an IO action; it <i>is</i> an IO action, one that you create by composing other IO actions together. Your last question assumes that such a function would obtain <i>all</i> of its standard input before the program begins executing; that wouldn&#39;t allow the input to change in response to anything the program does <i>while</i> executing. As an example, your program couldn&#39;t ask you for a number <code>n</code>, then ask you to enter <code>n</code> words."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1504159527, "post_id": 45971057, "comment_id": 78907258, "body": "@DouglasParker Yes, they could have done that. It would be more inconvenient when you&#39;re <i>not</i> writing I/O programs of course. You also can&#39;t pass standard input contents as a string because the program might not want to read the whole string before it does anything, and because lazy I/O is terrible."}, {"owner": {"reputation": 1042, "user_id": 3995712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/125124f1e508fe638c6fbe7bc9163ab8?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas Parker", "link": "https://stackoverflow.com/users/3995712/douglas-parker"}, "edited": false, "score": 0, "creation_date": 1504201731, "post_id": 45971057, "comment_id": 78934738, "body": "Ok, so interactive programs require input and output to be interleaved in a manner that wouldn&#39;t work in a call-return model. I see how stdin and stdout would be too limited to be practical. Is there any particular reason <code>progName</code> and <code>args</code> are applied as IO operations then? I don&#39;t see any technical reason why those values could not have been arguments to <code>main</code> directly."}], "owner": {"reputation": 1042, "user_id": 3995712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/125124f1e508fe638c6fbe7bc9163ab8?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas Parker", "link": "https://stackoverflow.com/users/3995712/douglas-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "closed_date": 1504136303, "answer_count": 0, "score": 0, "last_activity_date": 1504135143, "creation_date": 1504135143, "question_id": 45971057, "link": "https://stackoverflow.com/questions/45971057/why-does-haskells-main-function-require-io-operations", "closed_reason": "Duplicate", "title": "Why does Haskell&#39;s main function require IO operations?", "body": "<p>Haskell is a pure functional language, so aspects like File IO become a bit more complicated than most other programming languages because state can be stored in files. To address these issues, Haskell has a lot of additional syntax and operations to work with files. I understand that need and why it is necessary. What I am confused with, is why this is required for input and output from <code>main</code>?</p>\n\n<p>A Haskell program which reads command line arguments and standard input \nand writes to standard output looks something like this:</p>\n\n<pre><code>import System.Environment\n\nmain = do\n   progName &lt;- getProgName\n   args &lt;- getArgs\n   contents &lt;- getContents  \n   putStr (operateOn contents)\n</code></pre>\n\n<p>This is annoying because <code>main</code> is not a pure function and has to go through file IO operations in order to access inputs to the program. However, it is semantically \"pure\" in that it takes in a <code>progName</code>, <code>args</code>, and stdin while returning the stdout content. In my opinion, it would make far more sense for Haskell to recontextualize <code>main</code> to take the inputs as arguments and return the output. Consider the following hypothetical function:</p>\n\n<pre><code>pureMain :: String -&gt; [String] -&gt; String -&gt; String\npureMain progName args stdin = operateOn stdin\n</code></pre>\n\n<p>This version of <code>main</code> is pure and accepts its inputs as parameters directly while returning the result. The values of each input do not change throughout the program's execution, and stdin can be a potentially-infinite string lazily evaluated. Laziness also works for stdout as each line can be printed individually without the requiring the entire potentially-infinite stdout to be evaluated.</p>\n\n<p>I can understand some implementation details causing stdin and stdout to require file IO, as they are technically file descriptiors anyways. Things like logging also require the use of <code>putStr</code>, which would make this \"return stdout as a string\" model a little impractical.</p>\n\n<p>Even with those problems however, I see no reason why <code>progName</code> and <code>args</code> can't be passed in as arguments. For that matter, even start time or a random number seed could be passed in as well. As long as they don't change mid-execution and provide a hook in the Haskell runtime to specify a particular time or seed, then it should be completely pure and repeatable.</p>\n\n<p>This idea seems too obvious not to have been tried, so I'm curious why it was not done for Haskell? Is there something I'm missing that breaks down this model which requires these to be IO-aware calls?</p>\n"}, {"tags": ["git", "haskell", "hoogle", "git-grep"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504135532, "post_id": 45970886, "comment_id": 78901332, "body": "Hoogle though Git history? Very unlikely. Hoogling though previous <i>package versions</i>, much more feasible."}, {"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "edited": false, "score": 1, "creation_date": 1505666883, "post_id": 45970886, "comment_id": 79495503, "body": "Hoogle can take text files saying which functions are available. There is no restriction on those names being unique, so if you generated a suitable input file, Hoogle could certainly be used."}, {"owner": {"reputation": 33, "user_id": 5151261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aba72f8aed450579d1c7f5e2653e4da4?s=128&d=identicon&r=PG&f=1", "display_name": "E Bro", "link": "https://stackoverflow.com/users/5151261/e-bro"}, "reply_to_user": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "edited": false, "score": 0, "creation_date": 1505677889, "post_id": 45970886, "comment_id": 79499025, "body": "@NeilMitchell So, thinking out loud here, a git hook that generated hoogle files off each new commit?  Would there need to be some way to dedup function sigs that haven&#39;t changed?  Or does hoogle handle that internally?"}, {"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "edited": false, "score": 0, "creation_date": 1505937702, "post_id": 45970886, "comment_id": 79622497, "body": "Yep, a git hook could work. You would have to manually dedupe signatures, as you&#39;d need to give each one a complete link (including the git SHA1)."}], "owner": {"reputation": 33, "user_id": 5151261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aba72f8aed450579d1c7f5e2653e4da4?s=128&d=identicon&r=PG&f=1", "display_name": "E Bro", "link": "https://stackoverflow.com/users/5151261/e-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1504139329, "creation_date": 1504133737, "last_edit_date": 1504139329, "question_id": 45970886, "link": "https://stackoverflow.com/questions/45970886/hoogle-git-repository", "title": "Hoogle Git repository", "body": "<p>Is there a way to use type signature searches on not just the current working set, but the entire history of a project?  </p>\n\n<p>The purpose would be to find and possibly recycle Haskell functions that were previously written and tested, but removed due to lack of use/need.</p>\n"}, {"tags": ["haskell", "threepenny-gui"], "answers": [{"tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": true, "score": 0, "last_activity_date": 1504292867, "creation_date": 1504292867, "answer_id": 46006577, "question_id": 45969586, "link": "https://stackoverflow.com/questions/45969586/threepenny-gui-get-attribute-value-as-string/46006577#46006577", "title": "Threepenny-GUI: Get Attribute Value as String", "body": "<p>As of threepenny-gui v0.8.1.0, this is currently not implemented. It's certainly possible, I just haven't gotten around to do that yet. Feel free to open an issue on Github!</p>\n\n<p>(Note that you can always call JavaScript directly with the <code>runFunction</code> and <code>ffi</code> functions if you are missing functionality.)</p>\n"}], "owner": {"reputation": 115, "user_id": 3104709, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/1024e3e3b2fd978f7804c91aeea3b67d?s=128&d=identicon&r=PG&f=1", "display_name": "m0.o", "link": "https://stackoverflow.com/users/3104709/m0-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 46006577, "answer_count": 1, "score": 2, "last_activity_date": 1504292867, "creation_date": 1504126653, "question_id": 45969586, "link": "https://stackoverflow.com/questions/45969586/threepenny-gui-get-attribute-value-as-string", "title": "Threepenny-GUI: Get Attribute Value as String", "body": "<p>is there a way to get the attribute value (especially the id) of an element as a string?\nFor instance the following lines result in \"()\":</p>\n\n<pre><code>field &lt;- UI.new\n    # set (attr \"id\") \"some text\"\n\n\non UI.drop field $ \\_ -&gt; do\n\n    -- Some label to print the attribute value to   \n    label &lt;- getElementById window \"labelID\"\n\n    id &lt;- get (attr \"id\") field\n    (element (fromJust label)) # set text (show id)\n</code></pre>\n\n<p>Since <code>attr</code> returns a <code>WriteAttr</code>, <code>get</code> might not be working. Is there a workaround?</p>\n\n<p>Thanks in advance!</p>\n\n<p>Greetings </p>\n"}, {"tags": ["haskell", "ghc", "trace"], "comments": [{"owner": {"reputation": 321, "user_id": 8369843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b3d592956f00bc74e43be42e084015f?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Sievers", "link": "https://stackoverflow.com/users/8369843/christian-sievers"}, "edited": false, "score": 0, "creation_date": 1504132084, "post_id": 45967186, "comment_id": 78900431, "body": "Note that <code>trace</code> has type <code>String -&gt; a -&gt; a</code>. The type that gets substituted for <code>a</code> in the <code>f=</code> case is different from the one in the <code>f n=</code> case. That should also help explain the different behaviour."}], "answers": [{"comments": [{"owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 0, "creation_date": 1504117756, "post_id": 45967333, "comment_id": 78893866, "body": "Not really when defining: if you don&#39;t call it, you won&#39;t see any trace. In TIO, it appears once in the &quot;Debug&quot; box (stderr?). See my edit for another example."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 0, "creation_date": 1504117932, "post_id": 45967333, "comment_id": 78893969, "body": "No, you don&#39;t need to call the function to get this to print: you merely need to evaluate it. For example, <code>main = seq f $ return ()</code> also prints exactly once. The <code>seq</code> is necessary to force <code>f</code> to be evaluated even though it is not used. Like most things in Haskell, defining it but not using it has no side effects. But the side effects on your <code>f</code> do indeed attach to defining it, not calling it; you just have to make sure to force the side effects of its definition."}, {"owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 0, "creation_date": 1504118141, "post_id": 45967333, "comment_id": 78894086, "body": "@ammaloy I made the edit after the comment. Ok for &quot;evaluate&quot; vs &quot;call&quot;."}, {"owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 0, "creation_date": 1504118717, "post_id": 45967333, "comment_id": 78894414, "body": "@ammaloy. In other words, <code>trace &quot;f was called&quot;</code>is only evaluated once (laziness), but <code>trace &quot;f was called:&quot;++show n</code> needs a new evaluation per call. Can you confirm that ?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 0, "creation_date": 1504118820, "post_id": 45967333, "comment_id": 78894472, "body": "It&#39;s not about the expression itself, but where that expression is. If you wrote <code>f n = trace &quot;f was called&quot; n</code>, that would also be evaluated once per call, as I wrote in my answer."}, {"owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 0, "creation_date": 1504118860, "post_id": 45967333, "comment_id": 78894492, "body": "I still don&#39;t get it for the definition: <a href=\"https://tio.run/##y0gszk7Nyfn/PzO3IL@oRMElNak0XS@kKDE5lYsrTSHPtgTEVFBKUyhPLFZITszJSU1RUsnTNuTiyk3MzFOwVShKLSktytPQ/P8fAA\" title=\"Haskell \u2013 Try It Online\" rel=\"nofollow noreferrer\">if there is no call or forced evaluation, but just a definition, then nothing is printed</a>"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 2, "creation_date": 1504124471, "post_id": 45967333, "comment_id": 78897355, "body": "@jferard <code>f</code> is not recomputed. After its first evaluation, it is &quot;replaced&quot; with its value: in this case, the function <code>(+1)</code>. This is because, after <code>trace</code> shows something, it just gives back its second argument as its result. Its ultimately the same reason that <code>x :: Integer; x = product [1..50000]</code> will only evaluate its RHS once (you can see this by making the number just large enough to take a noticeable amount of time and then running it twice. The second time will be instant because it didn&#39;t recompute the <code>product</code> call)."}, {"owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1504126385, "post_id": 45967333, "comment_id": 78898302, "body": "@DavidYoung I understood, but amalloy wrote: &quot;When defining f, <code>trace &quot;f was called&quot; $ (+ 1)</code> needs to be evaluated&quot;, and I find it unclear. I would have say: &quot;When <i>evaluating</i> f, <code>trace &quot;f was called&quot;</code> and <code>(+ 1)</code> are evaluated. And as you say:  after its first evaluation, <code>f</code> is &quot;replaced&quot; with its value : in this case, the function <code>(+1)</code>."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1504118213, "last_edit_date": 1504118213, "creation_date": 1504117366, "answer_id": 45967333, "question_id": 45967186, "link": "https://stackoverflow.com/questions/45967186/two-function-calls-but-only-one-trace-displayed/45967333#45967333", "title": "Two function calls but only one trace displayed", "body": "<p>Your trace prints when defining <code>f</code>, not when calling it. If you want the trace to happen as part of the call, you should make sure it is not evaluated until a parameter is received:</p>\n\n<pre><code>f x = trace \"f was called\" $ x + 1\n</code></pre>\n\n<p>Also, when I run your TIO I don't see the trace appearing at all. <code>trace</code> is not really a reliable way to print things, because it cheats the IO model that the language is built on. The most subtle changes in evaluation order can disturb it. Of course for debugging you can use it, but as even this simple example demonstrates it is not guaranteed to help much.</p>\n\n<p>In your edit, you quote the documentation of <code>trace</code>:</p>\n\n<blockquote>\n  <p>The trace function outputs the trace message given as its first\n  argument, before returning the second argument as its result.</p>\n</blockquote>\n\n<p>And indeed this is exactly what happens in your program! When defining <code>f</code>,</p>\n\n<pre><code>trace \"f was called\" $ (+ 1)\n</code></pre>\n\n<p>needs to be evaluated. First, \"f was called\" is printed. Then, <code>trace</code> evaluates to, and returns, <code>(+ 1)</code>. This is the final value of the <code>trace</code> expression, and therefore <code>(+ 1)</code> is what <code>f</code> is defined as. The <code>trace</code> has vanished, see?</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 2, "last_activity_date": 1504142210, "creation_date": 1504142210, "answer_id": 45971829, "question_id": 45967186, "link": "https://stackoverflow.com/questions/45967186/two-function-calls-but-only-one-trace-displayed/45971829#45971829", "title": "Two function calls but only one trace displayed", "body": "<p>It is indeed a result of laziness.</p>\n\n<p>Laziness means that merely defining a value doesn't mean it will be evaluated; that will only happen if it's needed for something. If it's not needed, the code that would actually produce it doesn't \"do anything\". If a particular value <em>is</em> needed the code is run, but only the first time it would be needed; if there are other references to the same value and it is used again, those uses will just directly use the value that was produced the first time.</p>\n\n<p>You have to remember that <strong>functions are values</strong> in every sense of the term; everything that applies to ordinary values also applies to functions. So your definition of <code>f</code> is simply writing an expression for a value, the expression's evaluation will be deferred until the value of <code>f</code> is actually needed, and as it's needed twice the value (function) the expression computes will be saved and reused the second time.</p>\n\n<p>Lets look at it in more detail:</p>\n\n<pre><code>f=trace(\"f was called\")$(+1)\n</code></pre>\n\n<p>You're defining a value <code>f</code> with a simple equation (not using any syntactic sugar for writing arguments on the left hand side of the equation, or providing cases via multiple equations). So we can simply take the right hand side as a single expression that defines the value <code>f</code>. Just defining it does nothing, it sits there until you call:</p>\n\n<pre><code>print $ f 1\n</code></pre>\n\n<p>Now print needs its argument evaluated, so this is forcing the expression <code>f 1</code>. But we can't apply <code>f</code> to <code>1</code> without first forcing <code>f</code>. So we need to figure out what function the expression <code>trace \"f was called\" $ (+1)</code> evaluates to. So <code>trace</code> is actually called, does its unsafe IO printing and <code>f was called</code> appears at the terminal, and then <code>trace</code> returns its second argument: <code>(+1)</code>.</p>\n\n<p>So now we know what function <code>f</code> is: <code>(+1)</code>. <code>f</code> will now be a direct reference to that function, with no need to evaluate the original code <code>trace(\"f was called\")$(+1)</code> if <code>f</code> is called again. Which is why the second <code>print</code> does nothing.</p>\n\n<p>This case is quite different, even though it might look similar:</p>\n\n<pre><code>f n=trace(\"f was called:\"++show n)$n+1\n</code></pre>\n\n<p>Here we <em>are</em> using the syntactic sugar for defining functions by writing arguments on the left hand side. Let's desugar that to lambda notation to see more clearly what the actual value being bound to <code>f</code> is:</p>\n\n<pre><code>f = \\n -&gt; trace (\"f was called:\" ++ show n) $ n + 1\n</code></pre>\n\n<p>Here we've written a function value <em>directly</em>, rather than an expression that can be evaluated to result in a function. So when <code>f</code> needs to be evaluated before it can be called on <code>1</code>, the value of <code>f</code> is that whole function; the <code>trace</code> call is <em>inside</em> the function instead of being the thing that is called to <em>result</em> in a function. So <code>trace</code> isn't called as part of evaluating <code>f</code>, it's called as part of evaluating the application <code>f 1</code>. If you saved the result of that (say by doing <code>let x = f 1</code>) and then printed it multiple times, you'd only see the one trace. But the when we come to evaluate <code>f 2</code>, the <code>trace</code> call is still there inside the function that is the value of <code>f</code>, so when <code>f</code> is called again so is <code>trace</code>.</p>\n"}], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "accepted_answer_id": 45971829, "answer_count": 2, "score": 6, "last_activity_date": 1504142210, "creation_date": 1504116810, "last_edit_date": 1504119927, "question_id": 45967186, "link": "https://stackoverflow.com/questions/45967186/two-function-calls-but-only-one-trace-displayed", "title": "Two function calls but only one trace displayed", "body": "<p>With GHC  version 8.0.2 the following program:</p>\n\n<pre><code>import Debug.Trace\n\nf=trace(\"f was called\")$(+1)\n\nmain = do\n    print $ f 1\n    print $ f 2\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>f was called\n2\n3\n</code></pre>\n\n<p>Is it the expected behaviour? If yes, why? I expected the string <code>f was called</code> to be printed twice, one before <code>2</code> and one before <code>3</code>.</p>\n\n<p>Same result on TIO: <a href=\"https://tio.run/##y0gszk7Nyfn/PzO3IL@oRMElNak0XS@kKDE5lYsrzbYExNBQSlMoTyxWSE7MyUlNUdJU0dA21OTiyk3MzFOwVUjJ51IAgoKizLwSBRWFNAVDNL7R//8A\" rel=\"nofollow noreferrer\" title=\"Haskell \u2013 Try It Online\">Try it online!</a></p>\n\n<p><strong>EDIT</strong>\nBut this program:</p>\n\n<pre><code>import Debug.Trace\n\nf n=trace(\"f was called:\"++show n)$n+1\n\nmain = do\n    print $ f 1\n    print $ f 2\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>f was called:1\n2\nf was called:2\n3\n</code></pre>\n\n<p><a href=\"https://tio.run/##y0gszk7Nyfn/PzO3IL@oRMElNak0XS@kKDE5lYsrTSHPtgTE1FBKUyhPLFZITszJSU2xUtLWLs7IL1fI01TJ0zbk4spNzMxTsFVIyedSAIKCosy8EgUVhTQFQzS@0f//AA\" rel=\"nofollow noreferrer\" title=\"Haskell \u2013 Try It Online\">Try it online!</a></p>\n\n<p>I suspect those behaviours have something to do with laziness, but my questions remain: is this the expected behaviour and, if yes, why?</p>\n\n<p>Hackage asserts this:</p>\n\n<blockquote>\n  <p>The trace function outputs the trace message given as its first\n  argument, before returning the second argument as its result.</p>\n</blockquote>\n\n<p>I don't see it in the first example.</p>\n\n<p><strong>EDIT 2</strong> Third example based on @amalloy comments:</p>\n\n<pre><code>import Debug.Trace\n\nf n=trace \"f was called\"$n+1\n\nmain = do\n    print $ f 1\n    print $ f 2\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>f was called\n2\nf was called\n3\n</code></pre>\n"}, {"tags": ["windows", "haskell", "utf-8"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1504124377, "post_id": 45965471, "comment_id": 78897297, "body": "@DanielSanchez <code>\\EOT</code> is end-of-transmission, an ASCII control character (also called <code>^D</code> or <code>Control-D</code>, value <code>0x04</code>). It&#39;s not <code>\uc790</code>, <b><i>at all</i></b>. <code>\uc790</code> is <code>\\51088</code> (0xC790)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1504124686, "post_id": 45965471, "comment_id": 78897477, "body": "The behaviour can be reproduced in Win 8.1 using ConEmu, although you end up with a more drastic result: <code>getLine</code> will throw an exception, since the line ends prematurely."}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1504153143, "post_id": 45970416, "comment_id": 78905108, "body": "<code>&gt; hGetEncoding stdin</code> returns utf8... I tried <code>hSetEncoding stdin utf8</code> just to be sure but nothing changed."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1504132987, "last_edit_date": 1504132987, "creation_date": 1504130945, "answer_id": 45970416, "question_id": 45965471, "link": "https://stackoverflow.com/questions/45965471/haskell-winx-utf8-stdin-causes-problems/45970416#45970416", "title": "Haskell, WinX: UTF8 stdin causes problems", "body": "<p>I suspect GHC is operating on a latin1 encoding (or similar), and <code>putStrLn \"\uc790\"</code> only worked by accident. You can check this as follows:</p>\n\n<pre><code>&gt; import System.IO\nSystem.IO&gt; hGetEncoding stdin\n</code></pre>\n\n<p>If this replies with <code>UTF-8</code> my hypothesis is wrong. But if it replies with something other than <code>UTF-8</code>, you can explicitly declare which encoding the console is expecting with <code>hSetEncoding</code>:</p>\n\n<pre><code>System.IO&gt; hSetEncoding stdin utf8\n</code></pre>\n\n<p>You may also want to do this for <code>stdout</code> and <code>stderr</code>. See <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/System-IO.html\" rel=\"nofollow noreferrer\">the documentation</a> for more details.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1504132987, "creation_date": 1504110338, "question_id": 45965471, "link": "https://stackoverflow.com/questions/45965471/haskell-winx-utf8-stdin-causes-problems", "title": "Haskell, WinX: UTF8 stdin causes problems", "body": "<p>I use windows 10 and powershell, it seems that Haskell have some issues with UTF encoding from stdin:</p>\n\n<pre><code>&gt; chcp 65001\n&gt; stack ghci\n...\n\n&gt; putStrLn \"\uc790\"\n\uc790\n\n&gt; x &lt;- getLine\n\uc790\n&gt; x\n\"\\EOT\"\n\n&gt; interact id\n\uc790\n\u255d\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1504110111, "post_id": 45965113, "comment_id": 78889611, "body": "Are you running this in GHCi or is this part of a file you are compiling? In either case, you aren&#39;t running an <code>IO</code> action. At best, you are defining part of one."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1504110380, "post_id": 45965113, "comment_id": 78889784, "body": "<code>let x = print 3</code> does not print anything: it only defines <code>x</code> that, when executed, will print 3. To execute <code>x</code> it has to be run inside <code>main</code> or some other IO action that is called (not just defined) from <code>main</code>. Similarly, <code>let xs = [print 3, print 4]</code> does not print anything. In main, if we run <code>print (length xs)</code> we get 2 (the length), while the IO actions <code>print 3, print 4</code> are still ignored. If we instead use <code>main = sequence xs</code> then 3 and 4 are printed. (I&#39;d suggest to review an IO tutorial.)"}, {"owner": {"reputation": 437, "user_id": 5775622, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/64YBh.png?s=128&g=1", "display_name": "1234", "link": "https://stackoverflow.com/users/5775622/1234"}, "edited": false, "score": 0, "creation_date": 1504117684, "post_id": 45965113, "comment_id": 78893837, "body": "I do have main and run it."}], "answers": [{"comments": [{"owner": {"reputation": 437, "user_id": 5775622, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/64YBh.png?s=128&g=1", "display_name": "1234", "link": "https://stackoverflow.com/users/5775622/1234"}, "edited": false, "score": 0, "creation_date": 1504117984, "post_id": 45965414, "comment_id": 78894003, "body": "I can just run  renameFile (oldName newName), and I have no problem to rename a file."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 7, "last_activity_date": 1504118391, "last_edit_date": 1504118391, "creation_date": 1504110134, "answer_id": 45965414, "question_id": 45965113, "link": "https://stackoverflow.com/questions/45965113/rename-a-list-of-file-in-haskell/45965414#45965414", "title": "Rename a list of file in Haskell", "body": "<p>Haskell is lazily evaluated, so while the type of <code>outputList</code> is (probably; I haven't tried) <code>[IO ()]</code>, nothing further happens because your code never actually traverses the list.</p>\n\n<p>You'll probably need <code>mapM_</code> instead instead of <code>map</code>:</p>\n\n<pre><code>module Q45965113 where\n\nimport System.Directory\n\ngo = do\n  let listOfFullPath = [\"./oldFile.txt\"]\n  mapM_ (\\x -&gt; renameFile x  \"./newfile.txt\") listOfFullPath\n</code></pre>\n\n<p>You can load this into GHCi and run <code>go</code>:</p>\n\n<pre><code>Prelude&gt; :load 45965113.hs\n[1 of 1] Compiling Q45965113        ( 45965113.hs, interpreted )\nOk, modules loaded: Q45965113.\n*Q45965113&gt; :! ls *.txt\noldfile.txt\n*Q45965113&gt; go\n*Q45965113&gt; :! ls *.txt\nnewfile.txt\n</code></pre>\n\n<p>As you can see, the file has been renamed.</p>\n"}], "owner": {"reputation": 437, "user_id": 5775622, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/64YBh.png?s=128&g=1", "display_name": "1234", "link": "https://stackoverflow.com/users/5775622/1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 45965414, "answer_count": 1, "score": 1, "last_activity_date": 1504118391, "creation_date": 1504109203, "last_edit_date": 1504110395, "question_id": 45965113, "link": "https://stackoverflow.com/questions/45965113/rename-a-list-of-file-in-haskell", "title": "Rename a list of file in Haskell", "body": "<p>I try to rename a list of files in Haskell, and I use following code.</p>\n\n<pre><code>let listOfFullPath = [\"/home/name/oldFile.txt\"]\nlet outputList = map(\\x -&gt; renameFile x  \"/home/name/newfile.txt\") listOfFullPath\n</code></pre>\n\n<p>When I run the code, I did not see the file is renamed. </p>\n\n<p>Does anyone know why the <code>renameFile</code> is not working inside the map()? </p>\n\n<p>I know <code>renameFile :: FilePath -&gt; FilePath -&gt; IO ()</code> and I also try following:</p>\n\n<pre><code>let outputList = map(\\x -&gt; renameFile x \"/home/name/newfile.txt\" &gt;&gt; return ()) listOfFullpath\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1504110066, "post_id": 45964577, "comment_id": 78889582, "body": "Uhm, spaces is declared as the constant <code>fromIntegral (raknaBokstaver [] &#39; &#39;)</code> which does not depend on any input at all. Also, by definition, <code>medellangd</code> checks if the input list is empty, and returns the constant 0.0, otherwise it discards the input list (that&#39;s what <code>_</code> does) and returns another constant. I guess you want <code>medellangd xs = ...</code> where you do use the input list <code>xs</code> in some way."}, {"owner": {"reputation": 61, "user_id": 7840385, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ae8ff2b2f5c5430aa39b59a98181353b?s=128&d=identicon&r=PG&f=1", "display_name": "Augman", "link": "https://stackoverflow.com/users/7840385/augman"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1504367559, "post_id": 45964577, "comment_id": 78990993, "body": "Hello. Right, I got everything working as intended now, thank you very much for your response."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1504372259, "post_id": 45964577, "comment_id": 78992250, "body": "You&#39;re allowed to use &#229;&#228;&#246;, by the way, unless your editor is horribly outdated."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 7840385, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ae8ff2b2f5c5430aa39b59a98181353b?s=128&d=identicon&r=PG&f=1", "display_name": "Augman", "link": "https://stackoverflow.com/users/7840385/augman"}, "edited": false, "score": 0, "creation_date": 1504367705, "post_id": 45966555, "comment_id": 78991037, "body": "Thank you very much. I came across this <i>where</i> keyword and the meaning of it earlier this weekend but I&#39;ll be using it more. Thanks for the reply, it really did help me."}], "tags": [], "owner": {"reputation": 63078, "user_id": 220147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3881a28fe402dd2d1de44717486cae8?s=128&d=identicon&r=PG", "display_name": "Michael Kohl", "link": "https://stackoverflow.com/users/220147/michael-kohl"}, "is_accepted": false, "score": 1, "last_activity_date": 1504114463, "creation_date": 1504114463, "answer_id": 45966555, "question_id": 45964577, "link": "https://stackoverflow.com/questions/45964577/haskell-trouble-with-parsing-to-double/45966555#45966555", "title": "Haskell - Trouble with Parsing to Double", "body": "<p>You'll want something similar to this (I tried to keep it close to your current solution):</p>\n\n<pre><code>medellangd :: String -&gt; Double\nmedellangd [] = 0.0\nmedellangd xs = (listLength - spaces) / (spaces + 1) where\n  spaces = fromIntegral (raknaBokstaver xs) \n  listLength = fromIntegral (length xs)\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 7840385, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ae8ff2b2f5c5430aa39b59a98181353b?s=128&d=identicon&r=PG&f=1", "display_name": "Augman", "link": "https://stackoverflow.com/users/7840385/augman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504114463, "creation_date": 1504107476, "question_id": 45964577, "link": "https://stackoverflow.com/questions/45964577/haskell-trouble-with-parsing-to-double", "title": "Haskell - Trouble with Parsing to Double", "body": "<p>I hope you are doing very well.</p>\n\n<p>I started doing some Haskell yesterday and today I got stuck on a function where I want to make an average of the length of every word. The problem that I have is that medellangd is always evaluated to be 0.0, no matter what. Both the variable <em>spaces</em> as well as the variable <em>listLength</em> are always 0.0, no matter what input is given.</p>\n\n<pre><code>medellangd :: String -&gt; Double\nspaces = fromIntegral (raknaBokstaver [] ' ')\nlistLength = fromIntegral (length [])\n\nmedellangd [] = 0.0\nmedellangd _ = (listLength-spaces) / (spaces + 1)\n</code></pre>\n\n<p>I tested the function <em>raknaBokstaver :: String -> Char -> Int</em>, in the terminal, and it worked just fine. The <em>length</em> function worked just as one would expect aswell. </p>\n\n<p>Am I missusing the <em>fromIntegral</em> function? Why is it that <em>spaces</em> and <em>listLength</em> both are evaluated to 0.0?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["list", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1504106852, "post_id": 45964312, "comment_id": 78887502, "body": "What do you expect <code>..n</code> to do inside the pattern?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1504109815, "post_id": 45964312, "comment_id": 78889403, "body": "This is asking for too much magic. Haskell will not try all the possible values of <code>n</code> looking for one which works."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1504114986, "last_edit_date": 1504114986, "creation_date": 1504109483, "answer_id": 45965196, "question_id": 45964312, "link": "https://stackoverflow.com/questions/45964312/list-generate-through-pattern-match/45965196#45965196", "title": "List generate through pattern match", "body": "<p>This is not how Haskell works. Haskell is not that <em>declarative</em>. If you write something like:</p>\n\n<pre><code>patter = expression\n</code></pre>\n\n<p>it thus expects a pattern on the left, and an expression on the right. <code>sum [1,2..n]</code> is not a pattern: it is an expression.</p>\n\n<p>Next <code>=</code> is <em>not</em> equality*: it is a <em>declaration</em>: that means that you define a pattern in terms of an expression. Since you already defined <code>sumVal</code> in the head of the function, you can not define it in the <code>where</code> clause again.</p>\n\n<p>So how can we solve this? We can construct a recursive function that constructs a running sum until it reaches the requested sum <code>sumVal</code> and then returns the last number it added to it. Like:</p>\n\n<pre><code>findN :: Integer -&gt; Integer\nfindN sumVal = go 0 0\n    where go n s | s == sumVal = n\n                 | otherwise = go (n+1) (s+n+1)\n</code></pre>\n\n<p>So if we want to find the <code>n</code> for a sum, we call <code>go 0 0</code> with the first <code>0</code> the last element we added to the sum, and the second <code>0</code> the thus far obtained sum. Each time we check if the running sum <code>s</code> is equal to <code>sumVal</code>. If that is the case, we return <code>n</code>, the last added element. If the sum is not equal, we perform recursion with <code>go (n+1) (s+n+1)</code>: we update the element added to <code>n+1</code>, and do this for the running sum as well.</p>\n\n<p>The above solution is not very safe, nor is it generic. A first problem that arises is that we might call the function with a <code>sumVal</code> we can never obtain: for instance <code>findN 14</code>. In that case the program will keep looping forever: it will keep updating the sum, but never find an <code>n</code> for which the sum is <code>14</code>. We can solve this issue by constructing a function that returns a <code>Maybe Integer</code>: if the sum exists, we return <code>Just n</code>, otherwise we return <code>Nothing</code>.</p>\n\n<p>We know the sum does not exists if the running sum is larger than the requested sum. So we can alter the code to:</p>\n\n<pre><code>findN :: Integer -&gt; <b>Maybe</b> Integer\nfindN sumVal = go 0 0\n    where go n s | s == sumVal = <b>Just</b> n\n                 <b>| s &gt; sumVal = Nothing</b>\n                 | otherwise = go (n+1) (s+n+1)</code></pre>\n\n<p>We can also generalize the function to work with all numerical types <code>Num</code> that can be ordered <code>Ord</code>:</p>\n\n<pre><code>findN :: <b>(Num n, Ord n) =&gt;</b> n -&gt; Maybe n\nfindN sumVal = go 0 0\n    where go n s | s == sumVal = Just n\n                 | s &gt; sumVal = Nothing\n                 | otherwise = go (n+1) (s+n+1)</code></pre>\n\n<p>It might be an idea to add <code>Integral n</code> as a type constraint as well to prevent us to work with <code>Double</code>s and <code>Float</code>s where the precisions can be a problem.</p>\n\n<p>Finally the solution is not very efficient. We know that the sum of such list is:</p>\n\n<pre><code> n\n---\n\\        n * (n+1)\n/    i = --------- = s\n---         2\ni=0\n</code></pre>\n\n<p>So that means that:</p>\n\n<pre><code>     ________\n    V 8 s + 1 - 1\nn = -------------\n           2\n</code></pre>\n\n<p>So we calculate the square root of <code>8 * s + 1</code>, calculate whether that is an odd integral root, and then subtract one from it and divide it by two to obtain <code>n</code>. If the root is not integral or odd, we should return <code>Nothing</code>.</p>\n\n<p>For <code>Integer</code>s, we can use the integral square root that is available on the <a href=\"https://wiki.haskell.org/Generic_number_type#squareRoot\" rel=\"nofollow noreferrer\">Haskell Wiki</a>:</p>\n\n<blockquote>\n<pre><code>(^!) :: Num a =&gt; a -&gt; Int -&gt; a\n(^!) x n = x^n\n\nsquareRoot :: Integer -&gt; Integer\nsquareRoot 0 = 0\nsquareRoot 1 = 1\nsquareRoot n =\n   let twopows = iterate (^!2) 2\n       (lowerRoot, lowerN) =\n          last $ takeWhile ((n&gt;=) . snd) $ zip (1:twopows) twopows\n       newtonStep x = div (x + div n x) 2\n       iters = iterate newtonStep (squareRoot (div n lowerN) * lowerRoot)\n       isRoot r  =  r^!2 &lt;= n &amp;&amp; n &lt; (r+1)^!2\n   in  head $ dropWhile (not . isRoot) iters\n</code></pre>\n</blockquote>\n\n<p>Then we can use:</p>\n\n<pre><code>findN :: Integer -&gt; Maybe Integer\nfindN 0 = Just 0\nfindN sumVal | r * r == sq &amp;&amp; odd r = Just (div (r-1) 2)\n             | otherwise = Nothing\n    where sq = 8*sumVal+1\n          r = squareRoot sq\n</code></pre>\n\n<p>This then produces:</p>\n\n<pre><code>*Main&gt; findN 0\nJust 0\n*Main&gt; findN 1\nJust 1\n*Main&gt; findN 2\nNothing\n*Main&gt; findN 3\nJust 2\n*Main&gt; findN 4\nNothing\n*Main&gt; findN 5\nNothing\n*Main&gt; findN 6\nJust 3\n*Main&gt; findN 55\nJust 10\n</code></pre>\n"}], "owner": {"reputation": 2411, "user_id": 294785, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9c474f6dd69b520289a059eefaa8274c?s=128&d=identicon&r=PG", "display_name": "Kalinin", "link": "https://stackoverflow.com/users/294785/kalinin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 45965196, "answer_count": 1, "score": 0, "last_activity_date": 1504114986, "creation_date": 1504106736, "question_id": 45964312, "link": "https://stackoverflow.com/questions/45964312/list-generate-through-pattern-match", "title": "List generate through pattern match", "body": "<p>I need to find progression length. When the sum of this progression is equal to sumVal. Let's suppose this task always has answer.</p>\n\n<pre><code>findN :: Integer -&gt; Integer\nfindN sumVal = n where\n    sum [1,2..n] = sumVal\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>findN 55 --evaluates to 10\n</code></pre>\n\n<p>My solution has error</p>\n\n<blockquote>\n  <p>Parse error in pattern [1,2..n]</p>\n</blockquote>\n\n<p>How to fix my code? Is it possible to do it such way, with pattern match? I don't want to do it recursive: iterate through the list and accumulate sum until it not equal to sumVal.</p>\n\n<p>Maybe another elegant solution?</p>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1504109366, "post_id": 45964162, "comment_id": 78889121, "body": "Type inference will never infer a polymorphic type. In the pointfree version, you need a type variable in the type of <code>(.)</code> to be inferred as <code>End K&#39;</code> which is a polytype. Hence the error."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 1, "creation_date": 1504111128, "post_id": 45964162, "comment_id": 78890242, "body": "Furthermore to chi&#39;s point, is there any type <code>T</code> such that <code>((.) :: T) k2 k1</code> type checks?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1504111582, "post_id": 45964162, "comment_id": 78890467, "body": "@erisco T would cause the same instantiation. I used <code>(.) @ ...</code> to the same aim, and GHC told me &quot;no impredicativity, please&quot;. I believe this can&#39;t be made to work."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1504111825, "post_id": 45964162, "comment_id": 78890589, "body": "@chi this looks like an answer.  (with impredicativity, it could somehow pass along the &#39;freeness&#39; of variables along composition ?)"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1504112397, "post_id": 45964162, "comment_id": 78890870, "body": "one trick I use now : since polymorphism is easily destroyed, I capture it in a GADT constructor <code>Forall</code>, applied, in an auxiliary fonction, directly (no composition) to the polymorphic result of the original fonction... not sure it&#39;s the most elegant but that makes it sane"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1504118570, "last_edit_date": 1504118570, "creation_date": 1504118166, "answer_id": 45967579, "question_id": 45964162, "link": "https://stackoverflow.com/questions/45964162/could-not-match-polymorphic-type-in-haskell/45967579#45967579", "title": "Could not match polymorphic type in haskell", "body": "<p>The problem is that the GHC type system will never instantiate a type variable to a polymorphic type. Doing that would require impredicativity in the type system.</p>\n\n<p>In your concrete example, we have</p>\n\n<pre><code>(.) :: (b-&gt;c) -&gt; (a-&gt;b) -&gt; (a-&gt;c)\n</code></pre>\n\n<p>and, to type check <code>k2 . k1</code> we would need to instantiate <code>b ~ End K'</code> which is a polymorphic type.</p>\n\n<p>A typical workaround would be to make <code>End K'</code> into a monomorphic type which wraps a polymorphic type. E.g.</p>\n\n<pre><code>newtype End g = End { unEnd :: forall a. g a a }\n</code></pre>\n\n<p>The price to pay is to explicitly wrap / unwrap values of type <code>End g</code> at every usage. This can also be mitigated exploiting GHC's \"safe coercions\".</p>\n\n<p>Note that some other languages (like Agda, Coq, Idris) would handle your code (suitably translated) just fine, since they have an impredicative type system. However, their inference machinery are different from Haskell -- impredicativity makes it far harder. Sometimes, if not often, the type inference engine can't find the implicit type arguments, and types have to be explicitly provided.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 45967579, "answer_count": 1, "score": 2, "last_activity_date": 1504118570, "creation_date": 1504106305, "question_id": 45964162, "link": "https://stackoverflow.com/questions/45964162/could-not-match-polymorphic-type-in-haskell", "title": "Could not match polymorphic type in haskell", "body": "<p>I am not sure why <code>k4</code> below does not work, when <code>k3</code> does, its enough polymorphic. The error in <code>ghci</code> is </p>\n\n<blockquote>\n<pre><code>\u2022 Couldn't match type \u2018K' a0 a0\u2019 with \u2018End K'\u2019\n  Expected type: K' a0 a0 -&gt; K'' a a\n</code></pre>\n</blockquote>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE GADTs #-}\n#!/usr/bin/env stack\n-- stack --install-ghc --resolver lts-8.21 runghc --package http-conduit --package lens\n{-# LANGUAGE ExistentialQuantification, RankNTypes #-}\n\nmodule YonedaLan where\n\ntype End g = forall a. g a a \n\ndata K'  b c = K'\ndata K'' b c = K''\n\nk1 :: () -&gt; End K'\nk1 x = K'\n\nk2 :: End K' -&gt; End K''\nk2 x = case x of (K') -&gt; K''\n\nk3 :: () -&gt; End K''\nk3 x = k2 ( k1 x)\n\nk4 :: () -&gt; End K''\nk4 = k2 . k1\n</code></pre>\n\n<p>Beside not writing point free style, is there some best practice for dealing with this ?</p>\n"}, {"tags": ["haskell", "pretty-print", "string-interpolation"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504102908, "post_id": 45961624, "comment_id": 78884456, "body": "If all of your uses are &#39;lists&#39; of known length, then using heterogenous lists, e.g. something like <code>hfoldMap pretty [foo,bar,baz]</code> would have no more overhead than the simple solution. But if that&#39;s the case (only lists of known length), in my opinion, writing such code is more trouble than it&#39;s worth. For the string interpolation solution, see <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Text-Printf.html\" rel=\"nofollow noreferrer\">Text.Printf</a> - basically the exact same implementation should work for you. And I think e.g. <code>prettyPrintf &quot;%s %s %s&quot; foo bar baz</code> looks pretty nice."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1504103862, "post_id": 45961624, "comment_id": 78885243, "body": "You could define a custom typeclass with a custom operator <code>&lt;+++&gt; :: a -&gt; b  -&gt; Doc</code> which applies <code>pretty</code> as needed and calls <code>&lt;+&gt;</code>. Note that this is convenient only if you have a small amount of types, since you&#39;ll have to define the instance for every combination of e.g. <code>Int,Bool,String,Doc</code>, which grows quadratically. Or some <code>Typeable</code> check. I&#39;m not sure this is worth it, though. The original code is simple enough to justify solutions which are &quot;too clever&quot;."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1504105371, "post_id": 45961624, "comment_id": 78886429, "body": "You only need two instances, one for <code>Doc</code>, and one for all other <code>Pretty</code> types."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1504109058, "post_id": 45961624, "comment_id": 78888905, "body": "@Li-yaoXia Overlapping instances are quite fragile, and I&#39;d tend to avoid them if I can."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1504223021, "post_id": 45961624, "comment_id": 78943262, "body": "@chi What&#39;s wrong with <code>&lt;+++&gt; :: (Prettiable a, Prettiable b) =&gt; a -&gt; b -&gt; Doc</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1504251087, "post_id": 45961624, "comment_id": 78950384, "body": "@immibis That would require <code>Pretty Doc</code> but the library does not define that instance. I don&#39;t know why. If that can be added, with <code>pretty=id</code>, the approach you suggest would be the best, I think."}], "owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504099247, "creation_date": 1504099247, "question_id": 45961624, "link": "https://stackoverflow.com/questions/45961624/pretty-printing-list-of-heterogeneous-parameters", "title": "Pretty printing list of heterogeneous parameters", "body": "<p>I am using the <code>prettyprinter</code> Haskell library and I have a heterogeneous set of parameters. How can I abstract away these long chains of concatenation?</p>\n\n<pre><code>pretty foo &lt;+&gt; pretty bar &lt;+&gt; pretty baz\n</code></pre>\n\n<p>Note that I cannot get <code>foo</code>, <code>bar</code>, and <code>baz</code> into a list (for example, to <code>foldMap</code> them), since they may be different types. A heterogeneous list may be a  solution, but I worry about the potential typeclass overhead.</p>\n\n<p>Is there an idiom I can apply here? A proper method of string interpolation would also be useful.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 4, "creation_date": 1504091464, "post_id": 45958843, "comment_id": 78875417, "body": "This could really use more explicit types and signatures. The pictures are good, though, and the problem is understandable. I think if you expressed your data in the more readable way it would be easier for you to express the solution as well."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1504091729, "post_id": 45958843, "comment_id": 78875615, "body": "@BartekBanachewicz the data is pair of coordinates with and id (id, x, y) - (Int, Double, Double)"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1504091771, "post_id": 45958843, "comment_id": 78875639, "body": "The fact you had to explain it is enough to rethink how you store it. Create distinct types representing your points and your clusters."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1504092147, "post_id": 45958843, "comment_id": 78875933, "body": "Does the points and clusters need to converted to a new list in each phase?"}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504098593, "post_id": 45960647, "comment_id": 78880920, "body": "I don&#39;t think your <code>minMax</code> is correct. I&#39;m reading the question as the author wanting a bounding box (&quot;find the min max for <code>x</code> and <code>y</code>, then two dots (red points) created&quot;), whereas <code>minMaxPoints</code> selects the bottom-left-most and top-right-most points from the set."}, {"owner": {"reputation": 2784, "user_id": 1487843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1BFY8.jpg?s=128&g=1", "display_name": "Marc Lambrichs", "link": "https://stackoverflow.com/users/1487843/marc-lambrichs"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504099820, "post_id": 45960647, "comment_id": 78881977, "body": "@BenjaminHodgson the way I&#39;m reading the question, a red point can be part of the original set. The top right one is not really visibile in the picture, because the distance to the created red point is 0. ;-)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1504099908, "post_id": 45960647, "comment_id": 78882039, "body": "A red point <i>can be</i> part of the original set, but need not be."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504102447, "post_id": 45960647, "comment_id": 78884119, "body": "@BenjaminHodgson So I guess I got confused. I interpreted it precisely as wanting the bottom-left-most and top-right-most points. As in, the red points are strictly members of the input. I&#39;m still unclear whether the red points are part of the cluster proper (i.e. whether they count towards the 5 point maximum if they did not occur in the input set); perhaps this is also clear to you, or the OP can clarify. Thanks for pointing this out."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1504103066, "post_id": 45960647, "comment_id": 78884596, "body": "The thing that rang my alarm bell is &quot;bottom-left-most&quot;. That&#39;s an ill-defined notion in 2D space; not every set of points has a bottom-left-most element (eg <code>[(1, 0), (0, 1)]</code>)."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504166118, "post_id": 45960647, "comment_id": 78910846, "body": "I&#39;ve edited the question by putting in the original data (how it looks like). I&#39;m in the process of digesting your solution @user2407038. Sorry for being that slow ;-)))) I hope that I can be at your level one day and able to help others too."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504168518, "post_id": 45960647, "comment_id": 78912326, "body": "@SirDK See the edit (I omitted it originally for brevity)."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504177603, "post_id": 45960647, "comment_id": 78918687, "body": "@user2407038 Can you elaborate in detail the step 2? Because I couldn&#39;t get your points. But if that is the simplest explanation, than its me that have trouble to understand it.   Its the cluster1 function, between the let and in. I&#39;m not familiar with this way.  By the way the code works fine. Get the answer. I&#39;ve edited a bit at the end since I compiled it using Leksah."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 1, "creation_date": 1504178122, "post_id": 45960647, "comment_id": 78919058, "body": "@SirDK Are you asking what a <code>let .. in ..</code> blocks means? If so, see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-440003.12\" rel=\"nofollow noreferrer\">here</a>. If you&#39;re asking about the use of <code>partition</code>, then probably the easiest way to understand it is to play around with some simpler examples. E.g. <code>partition (&lt; 3) [8,5,3,1,-10,2] == ([1,-10,2], [8,5,3])</code>. One way to define <code>partition</code> is <code>partition p xs = (filter p xs, filter (not . p) xs)</code>. Does this help?"}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504179308, "post_id": 45960647, "comment_id": 78919936, "body": "@user2407038 Yes yes yes. That really help. And Ive just noticed about the partition function. Thought that it is a new function.   In step 3, there is &quot;cl@(Cluster c)&quot;. How does it work?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504179580, "post_id": 45960647, "comment_id": 78920148, "body": "@SirDK This is called an &quot;as pattern&quot; (see the section of the report on <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-580003.17\" rel=\"nofollow noreferrer\">pattern matching</a> - in general, I highly recommend you read sections 2-5 for an understanding of the basic syntax). When you write <code>\\cl -&gt; .. :: Cluster -&gt; ..</code> you have a variable <code>cl :: Cluster</code> in scope. When you write <code>\\(Cluster c) -&gt; ..</code> you have a variable <code>c :: [Point]</code> in scope. An as pattern combines both of these - writing <code>\\cl@(Cluster c) -&gt; ..</code> gives you both <code>cl::Cluster</code> and <code>c::[Point]</code> in scope of the pattern."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504181993, "post_id": 45960647, "comment_id": 78921774, "body": "@user2407038 partition does limit us into two &quot;partitions&quot; right (that fulfill the condition and not)? What if we change the condition from two red dots (bottom left and upper right) to four red dots (bottom left, upper left, bottom right and upper right). Will it still be possible to alter the condition?"}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504184304, "post_id": 45960647, "comment_id": 78923473, "body": "@user2407038 I tried to change the length c to &gt; 6 (which initially set to &gt; 5). And the result is not as it should be. And I&#39;m not sure why."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1504196582, "post_id": 45960647, "comment_id": 78932138, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/153391/discussion-between-user2407038-and-sir-dk\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1504168490, "last_edit_date": 1504168490, "creation_date": 1504096648, "answer_id": 45960647, "question_id": 45958843, "link": "https://stackoverflow.com/questions/45958843/haskell-recursion-in-recursion-for-loop-in-loop/45960647#45960647", "title": "Haskell :: Recursion in Recursion for Loop in Loop", "body": "<p>The basic principle to follow in writing such an algorithm is to write small, compositional programs; each program is then easy to reason about and test in isolation, and the final program can be written in terms of the smaller ones.</p>\n\n<p>The algorithm can be summarized as follows:</p>\n\n<ol>\n<li>Compute the points which bound the set of points.</li>\n<li>Split the rest of the points into two clusters, one containing points closer to the minimum point, the other containing all other points (equivalently, points closer to the maximum point).</li>\n<li>If any cluster contains more than 5 points, repeat the process on that cluster.</li>\n</ol>\n\n<p>The presence of a 'repeat the process' step indicates this to be a <a href=\"https://en.wikipedia.org/wiki/Divide_and_conquer_algorithm\" rel=\"nofollow noreferrer\">divide and conquer</a> problem.</p>\n\n<p>I see no need for an ID for each point, so I've dispensed with this.</p>\n\n<p>To begin, define datatypes for each <em>type</em> of <em>data</em> you will be working with:</p>\n\n<pre><code>import Data.List (partition)\n\ndata Point = Point { ptX :: Double, ptY :: Double }\ndata Cluster = Cluster { clusterPts :: [Point] }\n</code></pre>\n\n<p>This may seem silly for such simple data, but it can potentially save you quite a bit of confusion during debugging. Also note the import of a function we will be using later.</p>\n\n<p>The 1st step:</p>\n\n<pre><code>minMaxPoints :: [Point] -&gt; (Point, Point)\nminMaxPoints ps = \n   (Point minX minY\n   ,Point maxX maxY)\n     where minX = minimum $ map ptX ps\n           maxX = maximum $ map ptX ps\n           minY = minimum $ map ptY ps\n           maxY = maximum $ map ptY ps\n</code></pre>\n\n<p>This is essentially the same as your <code>createCluster</code> function.</p>\n\n<p>The 2nd step:</p>\n\n<pre><code>pointDistance :: Point -&gt; Point -&gt; Double\npointDistance (Point x1 y1) (Point x2 y2) = sqrt $ (x1-x2)^2 + (y1-y2)^2\n\ncluster1 :: [Point] -&gt; [Cluster]\ncluster1 ps =\n  let (mn, mx) = minMaxPoints ps\n      (psmn, psmx) = partition (\\p -&gt; pointDistance mn p &lt; pointDistance mx p) ps\n  in [ Cluster psmn, Cluster psmx ]\n</code></pre>\n\n<p>This function should clear - it is a direct translation of the above statement of this step into code. The <code>partition</code> function takes a predicate and a list and produces two lists, the first containing all elements for which the predicate is true, and the second all elements for which it is false. <code>pointDistance</code> is essentially the same as your <code>getDistance</code> function.</p>\n\n<p>The 3rd step:</p>\n\n<pre><code>cluster :: [Point] -&gt; [Cluster]\ncluster ps =\n  cluster1 ps &gt;&gt;= \\cl@(Cluster c) -&gt;\n  if length c &gt; 5\n  then cluster c\n  else [cl]\n</code></pre>\n\n<p>This also implements the statement above very directly. Perhaps the only confusing part is the use of <code>&gt;&gt;=</code>, which (here) has type <code>[a] -&gt; (a -&gt; [b]) -&gt; [b]</code>; it simply applies the given function to each element of the given list, and concatenates the result (equivalently, it is written <code>flip concatMap</code>).</p>\n\n<p>Finally your test case (which I hope I've translated correctly from pictures to Haskell data):</p>\n\n<pre><code>testPts :: [Point]\ntestPts = map (uncurry Point)\n  [ (0,0), (1,0), (2,1), (0,2)\n  , (5,2), (5,4), (4,3), (4,4)\n  , (8,2), (9,3), (10,2)\n  , (11,4), (12,3), (13,3), (13,5) ]\n\nmain = mapM_ (print . map (\\p -&gt; (ptX p, ptY p)) . clusterPts) $ cluster testPts\n</code></pre>\n\n<p>Running this program produces</p>\n\n<pre><code>[(0.0,0.0),(0.0,2.0),(2.0,1.0),(1.0,0.0)]\n[(4.0,4.0),(5.0,2.0),(5.0,4.0),(4.0,3.0)]\n[(10.0,2.0),(9.0,3.0),(8.0,2.0)]\n[(13.0,3.0),(12.0,3.0),(11.0,4.0),(13.0,5.0)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 108, "user_id": 6476589, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-OHBMKOvbfng/AAAAAAAAAAI/AAAAAAAADjw/5ye5MX8Sbzo/photo.jpg?sz=128", "display_name": "Brendan Murphy", "link": "https://stackoverflow.com/users/6476589/brendan-murphy"}, "edited": false, "score": 0, "creation_date": 1504115359, "post_id": 45965650, "comment_id": 78892495, "body": "Why do you bring up vector spaces? It doesn&#39;t seem to make your response any clearer, and you&#39;re only really working in R^2"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 108, "user_id": 6476589, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-OHBMKOvbfng/AAAAAAAAAAI/AAAAAAAADjw/5ye5MX8Sbzo/photo.jpg?sz=128", "display_name": "Brendan Murphy", "link": "https://stackoverflow.com/users/6476589/brendan-murphy"}, "edited": false, "score": 1, "creation_date": 1504115428, "post_id": 45965650, "comment_id": 78892546, "body": "@BrendanMurphy I&#39;m not just working in R^2. The questioneer wants to work with <code>Labelled</code> things. Also, if I were only working with R^2 in the form of <code>(Double, Double)</code> I&#39;d end up writing by hand all the code the machine wrote for me"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1504115755, "last_edit_date": 1504115755, "creation_date": 1504111019, "answer_id": 45965650, "question_id": 45958843, "link": "https://stackoverflow.com/questions/45958843/haskell-recursion-in-recursion-for-loop-in-loop/45965650#45965650", "title": "Haskell :: Recursion in Recursion for Loop in Loop", "body": "<p>Functional programmers love recursion, yet they go to great lengths to avoid writing it. Jeez, people, make up your minds!</p>\n\n<p>I like to structure my code, to the extent possible, using common, well-understood combinators. I want to demonstrate a style of Haskell programming which leans heavily on standard tools to implement the boring parts of a program (mapping, zipping, looping) as tersely and generically as possible, freeing you up to focus on the problem at hand.</p>\n\n<p>So don't worry if you don't understand everything here. I just want to show you what's possible! (And please ask if you have questions!)</p>\n\n<h2>Vectors</h2>\n\n<p>First things first: we're working with two-dimensional space, so we'll need two-dimensional vectors and some secondary school vector algebra to work with them.</p>\n\n<p>I'm going to parameterise my vector by the scalar on which our vector space is built. This'll allow me to work with standard type classes like <code>Functor</code>, so I can delegate a lot of the work of building a vector algebra to the machine. I've turned on <code>DeriveFunctor</code> and <code>DeriveFoldable</code>, which allow me to utter the magic words <em><code>deriving (Functor, Foldable)</code></em>.</p>\n\n<pre><code>data Pair a = Pair {\n    px :: a,\n    py :: a\n} deriving (Show, Functor, Foldable)\n</code></pre>\n\n<p>Hereafter I'm going to avoid working explicitly with <code>Pair</code>, and program to an interface, not an implementation. This'll allow me to build a simple linear algebra library in a manner that's independent of the dimensionality of the vector space. I'll give example type signatures in terms of <code>V2</code>:</p>\n\n<pre><code>type V2 = Pair Double\n</code></pre>\n\n<h3>Scalar multiplication: functors</h3>\n\n<p>A <a href=\"https://en.wikipedia.org/wiki/Vector_space\" rel=\"nofollow noreferrer\">vector space</a> is required to have two operations: scalar multiplication and vector addition. Scalar multiplication means multiplying each component of a vector by a constant scalar. If you view a vector as a <em>container</em> of components, it should be clear that this means \"do the same thing to every element in a container\" - that is, it's a <em>mapping</em> operation. That's what <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Functor.html#t:Functor\" rel=\"nofollow noreferrer\"><code>Functor</code></a> is for.</p>\n\n<pre><code>-- mul :: Double -&gt; V2 -&gt; V2\nmul :: (Functor f, Num n) =&gt; n -&gt; f n -&gt; f n\nmul k f = fmap (k *) f\n</code></pre>\n\n<h3>Vector addition: zippy applicatives</h3>\n\n<p>Vector addition involves adding up the components of a vector point-wise. Thinking of a vector as a container of components, addition is a <em>zipping</em> operation - match up each element of the two vectors and add them up.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#t:Applicative\" rel=\"nofollow noreferrer\">Applicative functors</a> are functors with an additional \"apply\" operation. Thinking of a functor <code>f</code> as a container, <code>Applicative</code>'s <code>&lt;*&gt; :: f (a -&gt; b) -&gt; f a -&gt; f b</code> gives you a way to take a container of functions and apply it to a container of values to get a new container of values. It should be clear that one way to make <code>Pair</code> into an <code>Applicative</code> is to use zipping to apply functions to values.</p>\n\n<pre><code>instance Applicative Pair where\n    pure x = Pair x x\n    Pair f g &lt;*&gt; Pair x y = Pair (f x) (g y)\n</code></pre>\n\n<p>(For another example of a zippy applicative, see <a href=\"https://stackoverflow.com/a/36480067/1523776\">this answer of mine</a>.)</p>\n\n<p>Now that we have a way to zip two pairs, we can leverage <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#v:liftA2\" rel=\"nofollow noreferrer\">a bit of standard <code>Applicative</code> machinery</a> to implement vector addition.</p>\n\n<pre><code>-- add :: V2 -&gt; V2 -&gt; V2\nadd :: (Applicative f, Num n) =&gt; f n -&gt; f n -&gt; f n\nadd = liftA2 (+)\n</code></pre>\n\n<p>Vector subtraction, which gives you a way to find the distance between two points, is defined in terms of multiplication and addition.</p>\n\n<pre><code>-- minus :: V2 -&gt; V2 -&gt; V2\nminus :: (Applicative f, Num n) =&gt; f n -&gt; f n -&gt; f n\nv `minus` u = v `add` mul (-1) u\n</code></pre>\n\n<h3>Dot products: foldable containers</h3>\n\n<p>2D Euclidean space is actually a <a href=\"https://en.wikipedia.org/wiki/Hilbert_space\" rel=\"nofollow noreferrer\">Hilbert space</a> - a vector space equipped with a way to measure lengths and angles in the form of a <a href=\"https://en.wikipedia.org/wiki/Dot_product\" rel=\"nofollow noreferrer\">dot product</a>. To take the dot product of two vectors, you multiply the components together and then add up the results. Once more, we'll be using <code>Applicative</code> to multiply the components, but that just gives us another vector: how do we implement \"adding up the results\"?</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Foldable.html#t:Foldable\" rel=\"nofollow noreferrer\"><code>Foldable</code></a> is the class of containers which admit an \"aggregation\" operation <code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; f a -&gt; b</code>. The standard prelude's <code>sum</code> is defined in terms of <code>foldr</code>, so:</p>\n\n<pre><code>-- dot :: V2 -&gt; V2 -&gt; Double\ndot :: (Applicative f, Foldable f, Num n) =&gt; f n -&gt; f n -&gt; n\nv `dot` u = sum $ liftA2 (*) v u\n</code></pre>\n\n<p>This gives us a way to find the absolute length of a vector: dot it with itself and take the square root.</p>\n\n<pre><code>-- modulus :: V2 -&gt; Double\nmodulus :: (Applicative f, Foldable f, Floating n) =&gt; f n -&gt; n\nmodulus v = sqrt $ v `dot` v\n</code></pre>\n\n<p>So the distance between two points is the modulus of the difference of the vectors.</p>\n\n<pre><code>dist :: (Applicative f, Foldable f, Floating n) =&gt; f n -&gt; f n -&gt; n\ndist v u = modulus (v `minus` u)\n</code></pre>\n\n<h3>N-ary zipping: traversable containers</h3>\n\n<p>An axis-aligned (hyper-)rectangle can be defined by just two points. We'll represent the  bounding box of a set of points as a <code>Pair</code> of vectors pointing to opposite corners of the bounding box.</p>\n\n<p>Given a collection of vectors of components, we can find the opposite corners of the bounding box by finding the maximum and minimum of each component across the collection. This requires us to zip up, or transpose, a <em>collection</em> of vectors of components into a vector of collections of components. For this I'll use <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Traversable.html#t:Traversable\" rel=\"nofollow noreferrer\"><code>Traversable</code></a>'s <code>sequenceA</code>.</p>\n\n<pre><code>-- boundingBox :: [V2] -&gt; Pair V2\nboundingBox :: (Traversable t, Applicative f, Ord n) =&gt; t (f n) -&gt; Pair (f n)\nboundingBox vs =\n    let components = sequenceA vs\n    in Pair (minimum &lt;$&gt; components) (maximum &lt;$&gt; components)\n</code></pre>\n\n<h2>Clustering</h2>\n\n<p>Now that we have a library for working with vectors, we can get down to the meaty part of the algorithm: dividing sets of points into clusters.</p>\n\n<h3>Partitioning</h3>\n\n<p>Let me rephrase the specification of the inner loop of your algorithm. You want to <em>partition</em> a set of points based on whether they're closer to the bottom-left corner of the set's bounding box or to the top-right corner. That's what <code>partition</code> does.</p>\n\n<p>We can write a function, <code>whichCluster</code> which uses <code>minus</code> and <code>modulus</code> to decide this for a single point, and then use <code>partition</code> to apply it to the whole set.</p>\n\n<pre><code>type Cluster = []\n-- cluster :: Cluster V2 -&gt; [Cluster V2]\ncluster :: (Applicative f, Foldable f, Ord n, Floating n) =&gt; Cluster (f n) -&gt; [Cluster (f n)]\ncluster vs =\n    let Pair bottomLeft topRight = boundingBox vs\n        whichCluster v = dist v bottomLeft &lt;= dist v topRight\n        (g1, g2) = partition whichCluster vs\n    in [g1, g2]\n</code></pre>\n\n<h3>Repetition, repetition, repetition</h3>\n\n<p>Now we want to repeatedly <code>cluster</code> until we don't have any groups larger than 5. Here's the plan. We'll keep track of two sets of clusters, those which are small enough, and those which require further sub-clustering. I'll use <code>partition</code> to sort a list of clusters into those which are small enough and those which need subclustering. I'll use the <em>list monad</em>'s <code>&gt;&gt;= :: [a] -&gt; (a -&gt; [b]) -&gt; [b]</code> (here <code>[Cluster V2] -&gt; ([V2] -&gt; [Cluster V2]) -&gt; [Cluster V2]</code>), which maps a function over a list and flattens the result, to implement the notion of subclustering. And I'll use <code>until</code> to repeatedly subcluster until the set of remaining too-large clusters is empty.</p>\n\n<pre><code>-- smallClusters :: Int -&gt; Cluster V2 -&gt; [Cluster V2]\nsmallClusters :: (Applicative f, Foldable f, Ord n, Floating n) =&gt; Int -&gt; Cluster (f n) -&gt; [Cluster (f n)]\nsmallClusters maxSize vs = fst $ until (null . snd) splitLarge ([], [vs])\n    where\n        smallEnough xs = length xs &lt;= maxSize\n        splitLarge (small, remaining) =\n            let (newSmall, large) = partition smallEnough remaining\n            in (small ++ newSmall, large &gt;&gt;= cluster)\n</code></pre>\n\n<p>A quick test, cribbed from <a href=\"https://stackoverflow.com/a/45960647/1523776\">@user2407038's answer</a>:</p>\n\n<pre><code>testPts :: [V2]\ntestPts = map (uncurry Pair)\n    [ (0,0), (1,0), (2,1), (0,2)\n    , (5,2), (5,4), (4,3), (4,4)\n    , (8,2), (9,3), (10,2)\n    , (11,4), (12,3), (13,3), (13,5) ]\n\nghci&gt; smallClusters 5 testPts\n[\n    [Pair {px = 0.0, py = 0.0},Pair {px = 1.0, py = 0.0},Pair {px = 2.0, py = 1.0},Pair {px = 0.0, py = 2.0}],\n    [Pair {px = 5.0, py = 2.0},Pair {px = 5.0, py = 4.0},Pair {px = 4.0, py = 3.0},Pair {px = 4.0, py = 4.0}],\n    [Pair {px = 8.0, py = 2.0},Pair {px = 9.0, py = 3.0},Pair {px = 10.0, py = 2.0}]\n    [Pair {px = 11.0, py = 4.0},Pair {px = 12.0, py = 3.0},Pair {px = 13.0, py = 3.0},Pair {px = 13.0, py = 5.0}]\n    ]\n</code></pre>\n\n<p>There you go. Small clusters in n-dimensional space, all without a single recursive function.</p>\n\n<h2>Labelling</h2>\n\n<p>Part of the point of working with the <code>Applicative</code> and <code>Foldable</code> <em>interfaces</em>, rather than working with <code>V2</code> directly, was so I could demonstrate the following little magic trick.</p>\n\n<p>Your original code represented points as 3-tuples consisting of two <code>Double</code>s for the location and an <code>Int</code> for the point's label, but my <code>V2</code> has no label. Can we recover this? Well, since the code doesn't at any point mention any concrete types - just standard type classes - we can just build a new type for labelled vectors. As long as said type is a <code>Foldable</code> <code>Applicative</code> all of the above code will continue to work without modification!</p>\n\n<pre><code>data Labelled m f a = Labelled m (f a) deriving (Show, Functor, Foldable)\n\ninstance (Monoid m, Applicative f) =&gt; Applicative (Labelled m f) where\n    pure = Labelled mempty . pure\n    Labelled m ff &lt;*&gt; Labelled n fx = Labelled (m &lt;&gt; n) (ff &lt;*&gt; fx)\n</code></pre>\n\n<p>The <code>Monoid</code> constraint is there because when combining actions you also need a way to combine their labels. I'm just going to use <code>First</code> - left-biased choice - because I'm not expecting the points' labels to be relevant to the zipping operations like <code>modulus</code> and <code>boundingBox</code>.</p>\n\n<pre><code>type LabelledV2 = Labelled (First Int) Pair Double\n\ntestPts :: [LabelledV2]\ntestPts = zipWith (Labelled . First . Just) [0..] $ map (uncurry Pair)\n    [ (0,0), (1,0), (2,1), (0,2)\n    , (5,2), (5,4), (4,3), (4,4)\n    , (8,2), (9,3), (10,2)\n    , (11,4), (12,3), (13,3), (13,5) ]\n\nghci&gt; traverse (traverse (getFirst . lbl)) $ smallClusters 5 testPts\nJust [[0,1,2,3],[4,5,6,7],[8,9,10],[11,12,13,14]]  -- try reordering testPts\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 45960647, "answer_count": 2, "score": 3, "last_activity_date": 1504168490, "creation_date": 1504091373, "last_edit_date": 1504165888, "question_id": 45958843, "link": "https://stackoverflow.com/questions/45958843/haskell-recursion-in-recursion-for-loop-in-loop", "title": "Haskell :: Recursion in Recursion for Loop in Loop", "body": "<p>How it goes: Based on the set of tuple (id, x, y), find the min max for x and y , then two dots (red points) created. Each element in tuple are grouped to two groups based on the distance towards the red dots.</p>\n\n<p><img src=\"https://i.stack.imgur.com/4aKmU.jpg\" alt=\"phase 1\"></p>\n\n<p>Each group cant exceed 5 dots. If exceed, new group should be computed. I've managed to do recursion for the first phase. But I have no idea how to do it for second phase. The second phase should look like this:</p>\n\n<p><img src=\"https://i.stack.imgur.com/oiWLo.jpg\" alt=\"phase 2\"></p>\n\n<p>Based on these two groups, again it need to find the min max for x and y (for each group), then four dots (red points) created. Each element in tuple are grouped to two groups based on the distance towards the red dots.</p>\n\n<pre><code>getDistance :: (Int, Double, Double) -&gt; (Int, Double, Double) -&gt; Double\ngetDistance (_,x1,y1) (_,x2,y2) = sqrt $ (x1-x2)^2 + (y1-y2)^2\ngetTheClusterID :: (Int, Double, Double) -&gt; Int\ngetTheClusterID  (id, _, _) = id\n\nidxy = [(id, x, y)]\ncreateCluster id cs = [(id, minX, minY),(id+1, maxX, minY), (id+2, minX, maxY), (id+3, maxX, maxY)]\n                        where minX = minimum $ map (\\(_,x,_,_) -&gt; x) cs\n                              maxX = maximum $ map (\\(_,x,_,_) -&gt; x) cs\n                              minY = minimum $ map (\\(_,_,y,_) -&gt; y) cs\n                              maxY = maximum $ map (\\(_,_,y,_) -&gt; y) cs\nidCluster = [1]\ncluster = createCluster (last idCluster) idxy\n\nclusterThis (id,a,b) = case (a,b) of\n  j | getDistance (a,b) (cluster!!0) &lt; getDistance (a,b) (cluster!!1) &amp;&amp;\n        -&gt; (getTheClusterID (cluster!!0), a, b) \n  j | getDistance (a,b) (cluster!!1) &lt; getDistance (a,b) (cluster!!0) &amp;&amp;\n        -&gt; (getTheClusterID (cluster!!1), a, b)\n  _ -&gt; (getTheClusterID (cluster!!0), a, b)\n\ngroupAll = map clusterThis idxy\n</code></pre>\n\n<p>I am moving from imperative to functional. Sorry if my way of thinking is still in imperative way. Still learning.        </p>\n\n<p><strong>EDIT:</strong>\nTo clarify, this is the original data looks like. </p>\n\n<p><a href=\"https://i.stack.imgur.com/RrlWE.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RrlWE.jpg\" alt=\"Phase 0\"></a></p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504090284, "post_id": 45958455, "comment_id": 78874580, "body": "Type sig please..."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504090395, "post_id": 45958455, "comment_id": 78874681, "body": "I&#39;m not sure of the correct type-signature and am letting the compiler infer the type-signature. I&#39;ll put the inferred type-signature in the question, and that will make it obvious why it&#39;s not type-checking. In that case please consider the intent of the question - I&#39;m trying to figure out HOW to write this piece of code."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504090610, "post_id": 45958455, "comment_id": 78874818, "body": "@leftaroundabout Done!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1504090757, "post_id": 45958455, "comment_id": 78874938, "body": "That signature can&#39;t match, it has too few arguments. (Also, as I have often said, I find it backwards to write some sort of implementation and then let the compiler infer its signature... you&#39;re not really interested in the implementation (and anyway you know it isn&#39;t quite right), what you know is <i>how you want to use this</i>, and that&#39;s how you should decide what the signature is supposed to be. Only <i>after</i> you&#39;ve settled on the signature, you should start to write any implementation code.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1504091423, "post_id": 45958455, "comment_id": 78875393, "body": "If you give your function a type signature (as a first approximation, you could use <code>(Int, Int) -&gt; t -&gt; Bar -&gt; BarError -&gt; BarError</code> since you don&#39;t know the required type of the Lens), and replace both occurrences of <code>l</code> with a typed hole, the 1st occurrence has type <code>ALens Bar t0 [a0] b0</code> (for some <code>t0,a0,b0</code>) and the 2nd <code>ALens BarError BarError [[Char]] [[Char]]</code>. Do you see how these types cannot possible unify? Maybe you want e.g. <code>forall a . ALens a a [String] [String]</code>, but this doesn&#39;t allow you to pass <code>field1</code> or <code>field2</code> to the function..."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504091545, "post_id": 45958455, "comment_id": 78875476, "body": "@leftaroundabout I agree with your approach in general. However, in the case of lenses, I just get a mind-block and I&#39;m unable to even express my intent in terms of a type-signature first."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504091612, "post_id": 45958455, "comment_id": 78875534, "body": "...Furthermore, based on the use case, this approach isn&#39;t really sensible.  Just because <code>(x :: Bar) ^. field1</code> and <code>(x :: BarError) ^. field1</code> both typecheck, doesn&#39;t mean there is a single term which corresponds to a lens which can be used on both <code>Bar</code> and <code>BarError</code> to manipulate the first field. In these two pieces of code, the two <code>field1</code>s are entirely different terms; if you pass <code>field1</code> as a parameter, you pick a specific instantiation, and neither instantiation can possibly apply to the other type."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504091841, "post_id": 45958455, "comment_id": 78875705, "body": "@user2407038 is there any other lens-hackery that can enable me to do what I want? Conceptually, what I&quot;m trying to do is to use a field-name as a first-class value -- once as a getter and once as a setter on two DIFFERENT records."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504092882, "post_id": 45958455, "comment_id": 78876520, "body": "&quot;is there any other lens-hackery that can enable me to do what I want?&quot; -for the reasons I&#39;ve stated, it isn&#39;t reasonable to expect lenses to do this - this is not what a &#39;lens&#39; is. A lens operates on a value of <i>a particular type</i> and the substructure it operates on must have <i>a particular type</i> (this is true of all optics, except perhaps the most exotic ones I&#39;m not aware of). Note this has nothing to do with wanting to use a lens as both a getter and setter. Your issue is wanting to use a lens at multiple different types, but there is no type of which both desired uses are instantiations."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1504097951, "creation_date": 1504097951, "answer_id": 45961136, "question_id": 45958455, "link": "https://stackoverflow.com/questions/45958455/how-to-apply-the-same-lens-on-two-different-records-or-record-field-names-as/45961136#45961136", "title": "How to apply the same lens on two different records? (or, record field-names as first-class values?)", "body": "<p>So essentially your problem has nothing to do with lenses, but with (accessor-) functions that can operate on different types, for each giving a different-typed result.</p>\n\n<p>That immediately means trouble: if the accessed-field type is supposed to depend on the containing-struct type, this is a <a href=\"https://en.wikipedia.org/wiki/Dependent_type\" rel=\"nofollow noreferrer\">dependent type</a>. Haskell is not a dependently-typed language. It's the kind of task you can easily do in e.g. Python by calling a field <em>by name</em> (in form of a string) and then operating on the field via <a href=\"https://en.wikipedia.org/wiki/Duck_typing\" rel=\"nofollow noreferrer\">duck typing</a>, but Haskell erases such expensive information as <em>record label strings</em> at runtime for very good reasons, and of course the compiler needs to know all the types so they can't be duck-inferred at runtime. In that sense, what you're asking is simply not possible.</p>\n\n<p>Or is it? GHC actually has become pretty good at dependent types. It has been possible for quite some time now to handle non-type-specific labels as <em>type-level string values</em>, called <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/GHC-TypeLits.html#t:Symbol\" rel=\"nofollow noreferrer\"><code>Symbol</code></a>s. And very recently, there has been <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields\" rel=\"nofollow noreferrer\">work on allowing fields of any record to be accessed <em>by name</em></a>, i.e. much like in Python but all at compile time, with whatever type is contained in the field.</p>\n\n<p>The essential thing is that you need to express the type-level function mapping a record-label and a record-type to a type of contained element. This is expressed by the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/GHC-Records.html#t:HasField\" rel=\"nofollow noreferrer\"><code>HasField</code> class</a>.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, FlexibleInstances, FlexibleContexts, FunctionalDependencies, ScopedTypeVariables, UnicodeSyntax, TypeApplications, AllowAmbiguousTypes #-}\n\nimport GHC.Records\nimport GHC.TypeLits (Symbol)\n\ndata Bar = Bar {barField1 :: Int, barField2 :: String}\n\ndata BarError = BarError {barerrField1 :: [String], barerrField2 :: [String]}\n deriving (Show)\n\ntype LensOn s a = (a, a -&gt; s)  -- poor man's lens focus\n\ninstance HasField \"Field2\" Bar (LensOn Bar String) where\n  getField (Bar i s) = (s, \\s' -&gt; Bar i s')\n\ninstance HasField \"Field2\" BarError (LensOn BarError [String]) where\n  getField (BarError f\u2081 f\u2082) = (f\u2082, \\f\u2082' -&gt; BarError f\u2081 f\u2082')\n\nvalidateLength :: \u2200 (f :: Symbol)\n                      . ( HasField f Bar (LensOn Bar String)\n                        , HasField f BarError (LensOn BarError [String]) )\n    =&gt; (Int,Int) -&gt; Bar -&gt; BarError -&gt; BarError\nvalidateLength (mn,mx) record errRecord\n    = let len = length . fst $ getField @f record\n      in if len &lt; mn || len &gt; mx\n          then case getField @f errRecord of\n                 (oldRec, setRec) -&gt; setRec $ \"incorrect length\" : oldRec\n          else errRecord\n\nmain :: IO ()\nmain = let x = Bar 10 \"hello there\"\n           xErr = BarError [] []\n       in print $ validateLength @\"Field2\" (3,10) x xErr\n</code></pre>\n\n<p>Tested with GHC-8.3.20170711, probably doesnt' work with significantly older versions.</p>\n"}, {"tags": [], "owner": {"reputation": 3088, "user_id": 2008899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc08db690c45406131e861e766b252c?s=128&d=identicon&r=PG", "display_name": "Boyd Stephen Smith Jr.", "link": "https://stackoverflow.com/users/2008899/boyd-stephen-smith-jr"}, "is_accepted": false, "score": 1, "last_activity_date": 1504110300, "creation_date": 1504110300, "answer_id": 45965461, "question_id": 45958455, "link": "https://stackoverflow.com/questions/45958455/how-to-apply-the-same-lens-on-two-different-records-or-record-field-names-as/45965461#45965461", "title": "How to apply the same lens on two different records? (or, record field-names as first-class values?)", "body": "<p>If you want a value passed as an argument to operate at two different types, you'll need <code>Rank2Types</code> (or the equivalent <code>RankNTypes</code>) extension.</p>\n\n<p>Then, since rank-2 or higher types are never inferred in GHC, you'll need to write the type signature explicitly.</p>\n\n<p>Our first pass might look something like: <code>IsString a =&gt; (Int, Int) -&gt; (forall s a. Lens' s a) -&gt; Bar -&gt; BarError -&gt; BarError</code>  But, that's <em>way</em> too general for that second argument, so general I tend to doubt a non-bottom value of that type exists.  We certainly can't pass <code>field1</code> or <code>field2</code> there.</p>\n\n<p>Since we want to pass <code>field1</code> or <code>field2</code> we need something that unifies their types: <code>HasField1 s a =&gt; Lens' s a</code> and <code>HasField2 s a =&gt; Lens' s a</code>.  Unfortunately, since <code>HasField1</code> and <code>HasField2</code> do not share (or have) any super classes, the only type that unifies these the the type given in the last paragraph.</p>\n\n<p>Note that even if <code>HasField1</code> and <code>HasField2</code> shared a super class, we still wouldn't be done.  Your implementation also requires that the field in <code>Bar</code> be a <code>Foldable</code> and that the field in <code>BarError</code> be a list of <code>IsString</code>.  Expressing those constraints is possible, but not exactly user-friendly.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504110300, "creation_date": 1504090119, "last_edit_date": 1504093625, "question_id": 45958455, "link": "https://stackoverflow.com/questions/45958455/how-to-apply-the-same-lens-on-two-different-records-or-record-field-names-as", "title": "How to apply the same lens on two different records? (or, record field-names as first-class values?)", "body": "<p>Consider the following records and their lenses:</p>\n\n<pre><code>data Bar = Bar {barField1 :: Int, barField2 :: String}\nmakeLensesWith abbreviatedFields ''Bar\n\ndata BarError = BarError {barerrField1 :: [String], barerrField2 :: [String]}\nmakeLensesWith abbreviatedFields ''BarError\n</code></pre>\n\n<p>Now, both of them have access to the lenses <code>field1</code> &amp; <code>field2</code> by virtue of implementing the <code>HasField1</code> and <code>HasField2</code> type-classes. However, I am unable to get the following piece of code to compile:    </p>\n\n<pre><code>-- Most-general type-signature inferred by the compiler, if I remove the\n-- KindSignatures from `record` &amp; `errRecord` below:\n--\n-- validateLength :: (IsString a) =&gt; (Int, Int) -&gt; ALens t t [a] [a] -&gt; t -&gt; t -&gt; t\n-- \nvalidateLength (mn, mx) l (record :: Bar)  (errRecord :: BarErr) =\n  let len = length (record ^# l)\n  in if ((len&lt;mn) || (len&gt;mx))\n  then errRecord &amp; l #%~ (\\x -&gt; (\"incorrect length\"):x)\n  else errRecord\n\n-- Usage scenario:\n--\n-- let x = Bar 10 \"hello there\"\n--     xErr = BarError [] []\n-- in validateLength (3, 10) field2 x xErr\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>/Users/saurabhnanda/projects/vl-haskell/src/TryLens.hs:18:20: error:\n    \u2022 Couldn't match type \u2018BarError\u2019 with \u2018Bar\u2019\n      Expected type: BarError -&gt; BarError\n        Actual type: Bar -&gt; BarError\n    \u2022 In the second argument of \u2018(&amp;)\u2019, namely\n        \u2018l #%~ (\\ x -&gt; (\"incorrect length\") : x)\u2019\n      In the expression:\n        errRecord &amp; l #%~ (\\ x -&gt; (\"incorrect length\") : x)\n      In the expression:\n        if ((len &lt; mn) || (len &gt; mx)) then\n            errRecord &amp; l #%~ (\\ x -&gt; (\"incorrect length\") : x)\n        else\n            errRecord\n</code></pre>\n\n<p><strong>Note:</strong> Instead of using <code>^.</code> and <code>%~</code> I'm using <code>^#</code> and <code>#%~</code> because I'd like to <a href=\"https://stackoverflow.com/questions/45618101/how-to-treat-a-lens-or-any-other-optic-as-a-getter-and-setter-simultaneously\">treat the lens (<code>l</code>) as a getter &amp; setter simultaneously.</a></p>\n\n<p><strong>Edit:</strong> A simpler snippet to demonstrate the problem is:</p>\n\n<pre><code>-- intended type signature:\n-- funkyLensAccess :: l -&gt; r1 -&gt; r2 -&gt; (t1, t2)\n--\n-- type signature inferred by the compiler\n-- funkyLensAccess :: Getting t s t -&gt; s -&gt; s -&gt; (t, t)\n--\nfunkyLensAccess l rec1 rec2 = (rec1 ^. l, rec2 ^. l)\n</code></pre>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504063414, "post_id": 45951290, "comment_id": 78861173, "body": "If you expect the last two expressions to have the same value, then it is due to a misunderstanding of what list comprehensions actually mean. You don&#39;t say what your understanding is (or even what you expect the output the expressions to be) so it&#39;s hard to see how it can be corrected (NB: the last expression is equivalent to <code>concatMap (\\ys -&gt; case ys of { y:xs -&gt; concatMap (\\z -&gt; [xs]) xs; [] -&gt; [] }) (tails [1,2,3])</code>)"}, {"owner": {"reputation": 69, "user_id": 8518830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0686188a48857e86628b32e04bdd0077?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Bregunci", "link": "https://stackoverflow.com/users/8518830/joao-bregunci"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504063754, "post_id": 45951290, "comment_id": 78861241, "body": "I thought that list comprehension in Haskell meant the set of values given by the expression before the guard which respect the constraints given in the right side of the guard. Is my idea wrong? Because according to this thought applying z &lt;- xs shouldn&#39;t change the value of xs in any way..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504064100, "post_id": 45951290, "comment_id": 78861316, "body": "Your vague intuition may be accurate in some cases, but as you&#39;ve seen it doesn&#39;t actually correspond the semantics of list comprehensions. See <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"nofollow noreferrer\">here</a> for the semantics of list comprehensions. You can use the semantics to translate your expressions to ones defined with regular functions, and then convince yourself that the two expressions are not equal."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1504079119, "post_id": 45951290, "comment_id": 78867273, "body": "The value of <code>xs</code> doesn&#39;t change, but list comprehensions give you a <i>list</i> of values, not a set. In particular, repeated values are possible if you have nested generators on the right-hand side."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1516203645, "last_edit_date": 1516203645, "creation_date": 1504079342, "answer_id": 45954814, "question_id": 45951290, "link": "https://stackoverflow.com/questions/45951290/beginner-doubts-on-list-comprehension-haskell/45954814#45954814", "title": "Beginner doubts on List Comprehension Haskell", "body": "<p>They have different results due to the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"nofollow noreferrer\">comprehension desugaring rules</a>. If we have</p>\n\n<pre><code>[ expression | a &lt;- as, b &lt;- bs ]\n</code></pre>\n\n<p>then we will get</p>\n\n<pre><code>concatMap (\\a -&gt; concatMap (\\b -&gt; [expression]) bs) as\n</code></pre>\n\n<p>Even if <code>b</code> isn't used in <code>expression</code>, we will still end up with more elements. For example <code>concatMap (const [1]) [1..10]</code> will lead to <code>replicate 10 1</code>. So if you add another list in your comprehension you change the number of <code>concatMap</code> and therefore also the number of outputs (unless the list contained exactly one element):</p>\n\n<pre><code>[a | a &lt;- [1..10]]             -- results in [1..10]\n[a | a &lt;- [1..10], _ &lt;- [1,2]] -- results in [1,1,2,2,3,3,4,4,...,9,9,10,10]\n[a | _ &lt;- [1,2], a &lt;- [1..10]] -- results in [1..10] ++ [1..10]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1516203433, "last_edit_date": 1516203433, "creation_date": 1504096034, "answer_id": 45960415, "question_id": 45951290, "link": "https://stackoverflow.com/questions/45951290/beginner-doubts-on-list-comprehension-haskell/45960415#45960415", "title": "Beginner doubts on List Comprehension Haskell", "body": "<p>The code</p>\n\n<pre><code>combinations n xs = [ y:ys | y:xs' &lt;- tails xs\n                           , ys &lt;- combinations (n-1) xs']\n</code></pre>\n\n<p>reads as: to choose <code>n</code> elements from <code>xs</code>, choose any <code>y</code> in <code>xs</code>, and name the tail of elements coming after <code>y</code> as <code>xs'</code>. Then recursively choose <code>n-1</code> elements from <code>xs'</code>, naming any such choice <code>ys</code>. The result is formed by all the <code>y:ys</code> that can be generated in this way.</p>\n\n<p>Convince yourself that this algorithm indeed takes all the possible choices (precisely: all the choices which respect the ordering given by the original list <code>xs</code>).</p>\n\n<p>Note a few corner cases, which are handled correctly.\nFirst, inside <code>tails xs</code> we also find the empty tail <code>[]</code>, but this is ignored since it is not of the form <code>y:xs'</code>. \nThen, the tail <code>xs'</code> could be shorter than <code>n-1</code> elements. In such case <code>ys &lt;- combinations (n-1) xs'</code> will find zero choices for <code>ys</code>, so no \"output\" will be generated for this <code>xs'</code>.</p>\n\n<p>Finally, about you last question. Consider this example:</p>\n\n<pre><code>[ 42 | x &lt;- [1,2,3 ] ] == [ 42, 42, 42 ]\n</code></pre>\n\n<p>The value of <code>x</code> does not affect the value of <code>42</code>, since <code>42</code> is constant, but it does affect its multiplicity. This is very similar to the imperative loop <code>for x in [1,2,3]: print(42)</code>, which produces its output several times.</p>\n"}], "owner": {"reputation": 69, "user_id": 8518830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0686188a48857e86628b32e04bdd0077?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Bregunci", "link": "https://stackoverflow.com/users/8518830/joao-bregunci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 45954814, "answer_count": 2, "score": 3, "last_activity_date": 1516203790, "creation_date": 1504062651, "last_edit_date": 1516203790, "question_id": 45951290, "link": "https://stackoverflow.com/questions/45951290/beginner-doubts-on-list-comprehension-haskell", "title": "Beginner doubts on List Comprehension Haskell", "body": "<p>I am currently doing the <em>99 Haskell problems</em> that are on the Wiki. Having said that, I was doing the problem number <em>26</em> that requires a program that can write all the combinations with <em>n</em> elements in a given set. I did my implementation with plenty of functions and the program seems correct. But my questions arise not from this, but from one of the solutions of the Haskell Wiki</p>\n\n<pre><code>combinations :: Int -&gt; [a] -&gt; [[a]]\ncombinations 0 _  = [ [] ]\ncombinations n xs = [ y:ys | y:xs' &lt;- tails xs\n                           , ys &lt;- combinations (n-1) xs']\n</code></pre>\n\n<p>I understood that <code>y:xs</code> is resolved for every list that is given by function <strong><code>tails</code></strong>, resulting in lists of possible values, but I can't understand how the <code>ys</code> value are made so that <code>y:ys</code> give me all the correct solutions.</p>\n\n<p>And another more important question that I have is why these two expressions have diferent results?</p>\n\n<pre><code>[xs | y:xs &lt;- tails [1,2,3]]\n[[2,3],[3],[]]\n\n[xs | y:xs &lt;- tails [1,2,3], z &lt;- xs]\n[[2,3],[2,3],[3]]\n</code></pre>\n\n<p>They may not have any practical use, but they demonstrated for me a Haskell beginner, a very strange behaviour. Why applying <code>z &lt;- xs</code> change the value of <code>xs</code>?</p>\n"}, {"tags": ["javascript", "haskell", "types", "polymorphism", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1504044678, "post_id": 45948894, "comment_id": 78856806, "body": "I do not know how this question can be answered in a specific way. Are there specifics (i.e. code) you can share from your type checker?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1504046270, "post_id": 45948894, "comment_id": 78857250, "body": "@erisco Unfortunately not, it would take too much code. You can get a link to the repository via my profile page, though. I am sorry if this question is too vague. I am hoping for some kind of theoretical answer that my reasoning is adequate/insufficient. Perhaps a counterexample, that simple exchanging of type annotations isn&#39;t enough."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 4, "creation_date": 1504046936, "post_id": 45948894, "comment_id": 78857453, "body": "The problem of polymorphism for parameteric polymorphism is type unification. When you observe that &quot;the <code>a</code>/<code>b</code> of the function argument are not the same as those of the higher order function&quot; it means that you need to unify the types together. This problem is called &quot;higher order unification&quot;. Here&#39;s a stackoverflow question about it: <a href=\"https://stackoverflow.com/questions/1936432/higher-order-unification\" title=\"higher order unification\">stackoverflow.com/questions/1936432/higher-order-unification</a> @jozefg has written a Haskell example of Huet&#39;s alogorithm: <a href=\"https://github.com/jozefg/higher-order-unification\" rel=\"nofollow noreferrer\">github.com/jozefg/higher-order-unification</a>"}, {"owner": {"reputation": 445, "user_id": 189176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/274a52c00e4f37979f33423fc8acf371?s=128&d=identicon&r=PG", "display_name": "Carter Tazio Schonwald", "link": "https://stackoverflow.com/users/189176/carter-tazio-schonwald"}, "edited": false, "score": 5, "creation_date": 1504059020, "post_id": 45948894, "comment_id": 78860277, "body": "That&#39;s not higher order unification.  It&#39;s just normal unification."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504063120, "post_id": 45948894, "comment_id": 78861106, "body": "From what I can tell, the issue is that your type checker incorrectly unifies the most general type of <code>f =&gt; x =&gt; f(x) + &quot;&quot;</code> (which could be something like <code>Show b =&gt; (a -&gt; b) -&gt; a -&gt; b</code> or <code>(a -&gt; String) -&gt; a -&gt; String</code> depending on the type of <code>(+ &quot;&quot;)</code>) with the specified type <code>(a -&gt; b) -&gt; a -&gt; b</code>. However you&#39;ve included no details of how you do typechecking, so it&#39;s impossible to say why your typechecker has this bug. Note this bug occurs before the application <code>apply(inc)</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1504076221, "post_id": 45948894, "comment_id": 78865594, "body": "@Cirdec Now I have a term that I can google for. It is a start. I really need some more theoretical background on the subject. Thanks."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1504093996, "post_id": 45948894, "comment_id": 78877257, "body": "Rough idea: given the polytypes of <code>f :: T</code> and <code>x :: V</code>, you need to compute the most general unifier <code>sigma</code> to make <code>T = V -&gt; c</code>, where <code>c</code> is a fresh type variable. If unification fails, that&#39;s a runtime type error. Otherwise the resulting polytype is <code>sigma(c)</code>. You can google for the known algorithms to compute the MGU. You&#39;ll probably want to use a more tree-like/AST notation for types instead of strings. You can pretty print them as strings for user convenience, and keep them as ASTs for type checking."}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504089976, "creation_date": 1504043793, "last_edit_date": 1504089976, "question_id": 45948894, "link": "https://stackoverflow.com/questions/45948894/how-to-solve-binding-issues-with-parametric-polymorphic-higher-order-functions", "title": "How to solve binding issues with parametric polymorphic higher order functions?", "body": "<p>I am building an extended run-time type system for Javascript and have some trouble implementing parametric polymorphism.</p>\n\n<p>I am already able to type polymorphic first order functions:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const append = Fun(\"append :: [a] -&gt; [a] -&gt; [a]\", xs =&gt; ys =&gt; xs.concat(ys));\n\nappend([1,2]) ([3,4]); // [1,2,3,4]\nappend([1,2]) ([\"a\",\"b\"]); // fails\n</code></pre>\n\n<p>There is state shared between the sequential function calls that enforces all <code>a</code>s in the type annotation to be bound to the same concrete type.</p>\n\n<p>However, things get much harder as soon as I try to type higher order functions:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const apply = Fun(\"apply :: (a -&gt; b) -&gt; a -&gt; b\", f =&gt; x =&gt; f(x));\nconst id = Fun(\"id :: a -&gt; a\", x =&gt; x);\n\napply(id) (2); // 2\n</code></pre>\n\n<p>The problem is that <code>a</code>/<code>b</code> of the function argument are not the same as those of the higher order function, because each function (a proxy with an apply trap behind the scene) has its on scope to bind type variables to concrete types. As a result the following unwanted implementation of <code>apply</code> with an explicit type cast doesn't fail:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const apply = Fun(\"apply :: (a -&gt; b) -&gt; a -&gt; b\", f =&gt; x =&gt; f(x) + \"\");\nconst inc = Fun(\"inc :: Number -&gt; Number\", x =&gt; x + 1);\n\napply(inc) (2); // \"3\"\n</code></pre>\n\n<p>Intuitively I tried to maintain state between all involved functions but this gets messy quickly.</p>\n\n<p>Another approach is to adapt the type annotations of higher order functions according to those of their function arguments. Function arguments are frequently monomorphic like <code>inc</code> but sometime polymorphic like <code>id</code> as well. To stick with my example here are examples for both scenarios:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>apply :: (a -&gt; b) -&gt; a -&gt; b \napply f x = f x\n\ninc :: Int -&gt; Int\ninc x = x + 1\n\n:t apply inc -- Int -&gt; Int (a becomes Int, b becomes Int)\n\nid :: a -&gt; a \nid x = x\n\n:t apply id -- b -&gt; b  (a becomes b, b remains b)\n</code></pre>\n\n<p>It seems as if all I need were two simple substitution rules for my type annotations - no additional state necessary. I know that my reasoning is rather simple. The question is if it is too naive in order to obtain reliable parametric polymorphism. Am I oversimplifying things?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 1, "creation_date": 1504033612, "post_id": 45946601, "comment_id": 78851646, "body": "(Out of curiosity, is <code>Constant</code> related to the built-in <code>Const</code> functor <a href=\"https://www.stackage.org/haddock/lts-9.2/base-4.9.1.0/Control-Applicative.html#t:Const?\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-9.2/base-4.9.1.0/&hellip;</a>)"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1504033673, "post_id": 45946601, "comment_id": 78851673, "body": "No no, it is just a exercise of the book."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1504035583, "post_id": 45946601, "comment_id": 78852621, "body": "@BalinKingOfMoria The two types work in exactly the same way (only the names are different)."}, {"owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1504036400, "post_id": 45946601, "comment_id": 78853028, "body": "@DavidYoung I was just making sure the OP wasn&#39;t reinventing the wheel :)"}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1504035771, "post_id": 45946761, "comment_id": 78852707, "body": "Also, if you run <code>:t foldMap id (Constant (Sum 34))</code>, you see that its type is <code>Monoid m =&gt; m</code>, so GHCi must be doing defaulting."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1504042691, "post_id": 45946761, "comment_id": 78856048, "body": "Is it <code>IO ()</code> or just <code>()</code>?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1504065806, "post_id": 45946761, "comment_id": 78861702, "body": "@ReinHenrichs That&#39;s a tricky question... <code>()</code> has a <code>Monoid</code> instance and <code>IO</code> has <code>instance Monoid a =&gt; Monoid (IO a)</code>. I think I saw a way to &quot;trick&quot; GHCi into showing what type it is defaulting to in situations like this, but I don&#39;t quite remember it (also, this was a couple years back, so it might not work on newer GHCis)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1504080241, "post_id": 45946761, "comment_id": 78867974, "body": "@ReinHenrichs I think GHCi would pick <code>IO ()</code> before <code>()</code> ? Not completely sure, though. Perhaps it&#39;s <code>()</code> after all."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1504088162, "post_id": 45946761, "comment_id": 78873148, "body": "what is a phantom index?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1504093396, "post_id": 45946761, "comment_id": 78876847, "body": "@zero_coding Some type parameter as <code>b</code> which is not used in the definition. E.g. <code>data T a = C</code> uses the phantom <code>a</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1504202588, "post_id": 45946761, "comment_id": 78935139, "body": "@DavidYoung Yeah, it turns out I should have just read my own answer to <a href=\"https://stackoverflow.com/questions/45558914/why-does-return-nothing-return-nothing/45558972#45558972\" title=\"why does return nothing return nothing\">stackoverflow.com/questions/45558914/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1504034156, "creation_date": 1504034156, "answer_id": 45946761, "question_id": 45946601, "link": "https://stackoverflow.com/questions/45946601/how-to-get-sum-getsum-0/45946761#45946761", "title": "How to get Sum {getSum = 0}?", "body": "<p>I guess GHCi is choosing <code>foldMap id (Constant (Sum 34)) :: IO ()</code>, which incidentally type checks because <code>Constant (Sum 34) :: Constant (Sum Int) b</code> for any <code>b</code>, including <code>b ~ IO ()</code>.</p>\n\n<p>Disambiguate the type, so that GHCi does not default it for you:</p>\n\n<pre><code>foldMap id (Constant (Sum 34)) :: Sum Int\n-- or\nfoldMap id (Constant (Sum 34) :: Constant (Sum Int) (Sum Int))\n</code></pre>\n\n<p>By the way, <code>foldMap id (Constant \"hello\" :: Constant String (Sum Int))</code> should also work -- there's no relation between the content of <code>Constant</code> and its phantom index.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 45946761, "answer_count": 1, "score": 2, "last_activity_date": 1504034156, "creation_date": 1504033471, "question_id": 45946601, "link": "https://stackoverflow.com/questions/45946601/how-to-get-sum-getsum-0", "title": "How to get Sum {getSum = 0}?", "body": "<p>I have following instances implementations: </p>\n\n<pre><code>newtype Constant a b =\n  Constant { getConstant :: a }\n  deriving (Eq, Ord, Show)\n\ntype TI a = Constant a\n\ninstance Functor (Constant a) where\n  fmap _ (Constant a) = Constant a\n\ninstance Foldable (Constant a) where\n  foldMap _ _ = mempty\n</code></pre>\n\n<p>and then I tried following:</p>\n\n<pre><code>*ExerciseTraversable Data.Monoid&gt; foldMap id (Constant (Sum 34))\n()\n</code></pre>\n\n<p>I do expect <code>Sum {getSum = 0}</code> instead of <code>()</code>. How to get <code>Sum {getSum = 0}</code> as the result?</p>\n"}, {"tags": ["haskell", "cabal", "ghci"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504063499, "post_id": 45945311, "comment_id": 78861189, "body": "Can you include a minimal sequence of steps necessary to reproduce the observed behaviour (the first step being the one which immediately follows a clean installation of Haskell)?"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 0, "last_activity_date": 1504066222, "creation_date": 1504066222, "answer_id": 45951785, "question_id": 45945311, "link": "https://stackoverflow.com/questions/45945311/cannot-load-vector-in-ghci-due-to-shadowed-dependencies/45951785#45951785", "title": "Cannot load vector in ghci due to shadowed dependencies", "body": "<p>I'm not sure what is causing that error message in your case, but one possibility is to use Stack's <code>ghci</code> command like so:</p>\n\n<pre><code>stack ghci --package vector\n</code></pre>\n\n<p>You can get Stack by following the instructions at <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">https://haskell-lang.org/get-started</a>, or since you're on OS X by running:</p>\n\n<pre><code>curl -sSL https://get.haskellstack.org/ | sh\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1507270796, "creation_date": 1507270796, "answer_id": 46599450, "question_id": 45945311, "link": "https://stackoverflow.com/questions/45945311/cannot-load-vector-in-ghci-due-to-shadowed-dependencies/46599450#46599450", "title": "Cannot load vector in ghci due to shadowed dependencies", "body": "<p>There was an issue with full 8.2.1 binary platform builds that's just been resolved: <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2017-October/127979.html\" rel=\"nofollow noreferrer\">https://mail.haskell.org/pipermail/haskell-cafe/2017-October/127979.html</a></p>\n\n<p>This was likely an instance of that.</p>\n"}], "owner": {"reputation": 1193, "user_id": 1024626, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1f3105b2e91741b91b5af4431e26a0d6?s=128&d=identicon&r=PG", "display_name": "pretobomba", "link": "https://stackoverflow.com/users/1024626/pretobomba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 264, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1507270796, "creation_date": 1504028704, "last_edit_date": 1504029505, "question_id": 45945311, "link": "https://stackoverflow.com/questions/45945311/cannot-load-vector-in-ghci-due-to-shadowed-dependencies", "title": "Cannot load vector in ghci due to shadowed dependencies", "body": "<p>Whenever I try to load the vector package in <code>ghci</code> I get the following:</p>\n\n<pre><code>Prelude&gt; :set -package vector\ncannot satisfy -package vector:\n    vector-0.12.0.1-6mmeV84KOvJADXavl6mOiY is unusable due to shadowed dependencies:\n      primitive-0.6.2.0\n    (use -v for more information)\n</code></pre>\n\n<p><code>vector</code> is installed in my cabal sandbox and I'm running <code>cabal repl</code> to get to <code>ghci</code>. Is importing vector simply not possible or is there a way around it? I'm on OSX.</p>\n"}, {"tags": ["haskell", "c2hs", "haskell-ffi"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1504015908, "post_id": 45941163, "comment_id": 78840879, "body": "Well, <code>Foreign.Storable.poke</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1504016920, "post_id": 45941163, "comment_id": 78841669, "body": "Why do you return another pointer? <code>ForeignPtr PropertyListT -&gt; IO (ForeignPtr PropertyListT)</code> reads like <code>property_list_t *read_params_for(property_list_t *props)</code>. Since the latter returns <code>void</code>, I&#39;d use <code>ForeignPtr PropertyListT -&gt; IO ()</code> instead. You  shouldn&#39;t need <code>newForeignPtr</code> for this."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504027092, "post_id": 45941163, "comment_id": 78848102, "body": "Your function can be written simply <code>readParamsFor p = withForeignPtr p readParamsFor&#39; &gt;&gt; return p</code>; if this doesn&#39;t work, there is a problem with your implementation somewhere else (and since there is no verifiable example given, it&#39;s impossible to determine where that is). This is no different from returning the pointer given as input in the C function itself."}, {"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504048518, "post_id": 45941163, "comment_id": 78857873, "body": "@user2407038 That&#39;s where I started from, but it didn&#39;t work and I assumed that it wasn&#39;t right. Looks like I have to check the actual C implementation."}], "answers": [{"tags": [], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "is_accepted": true, "score": 0, "last_activity_date": 1504862654, "creation_date": 1504862654, "answer_id": 46113038, "question_id": 45941163, "link": "https://stackoverflow.com/questions/45941163/haskell-ffi-return-updated-structure/46113038#46113038", "title": "Haskell FFI - return updated structure", "body": "<p>I realised that there was a bug in a C library that I wanted to use and that indeed, a simple <code>withForeignPtr</code> is sufficient if the bug is not there.</p>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 46113038, "answer_count": 1, "score": 0, "last_activity_date": 1504862654, "creation_date": 1504015353, "question_id": 45941163, "link": "https://stackoverflow.com/questions/45941163/haskell-ffi-return-updated-structure", "title": "Haskell FFI - return updated structure", "body": "<p>I have the following <code>C</code> function that I want to call from <code>Haskell</code>:</p>\n\n<pre><code>void read_params_for (property_list_t *props);\n</code></pre>\n\n<p>The function is supposed to receive some <code>property_list_t</code> and populate some values within it, so the caller then has an updated structure.</p>\n\n<p>I have all the necessary wrappers for <code>property_list_t</code> (like <code>Storable</code>, etc.), but I can't figure out how to wrap this function into something like</p>\n\n<pre><code>readParamsFor :: ForeignPtr PropertyListT -&gt; IO (ForeignPtr PropertyListT)\n</code></pre>\n\n<p>I tried using <code>C2HS</code>, and I also tried writing FFI bindings manually like:</p>\n\n<pre><code>foreign import ccall \"read_params_for\"\n    readParamsFor' :: Ptr PropertyListT -&gt; IO ()\n\nreadParamsFor :: ForeignPtr PropertyListT -&gt; IO (ForeignPtr PropertyListT)\nreadParamsFor ps = do\n    withForeignPtr ps $ \\ps' -&gt; do\n        res &lt;- readParamsFor' ps'\n        pl &lt;- newForeignPtr propertyListDestroy ps'\n        return pl\n</code></pre>\n\n<p>But in both cases, I get back my original \"underpopulated\" list.</p>\n\n<p>How do I get an updated structure back to Haskell?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504015587, "post_id": 45941034, "comment_id": 78840643, "body": "The problem is that <code>MyApp</code> is only generated with mkYesod by Template Haskell, i.e. you need to import not only the Yesod library but your own module in which you define <i>your yesod</i>.  I believe Yesod has some scaffolding scripts to make this setup stuff easy, but I&#39;ve never used them."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1504015791, "post_id": 45941034, "comment_id": 78840794, "body": "As for the library imports: you didn&#39;t write <code>import Yesod.WidgetT</code>, did you? That&#39;s not a module, only a type. the correct syntax is <code>import Yesod (WidgetT)</code>."}, {"owner": {"reputation": 55, "user_id": 5397052, "user_type": "registered", "profile_image": "https://graph.facebook.com/1029711010393985/picture?type=large", "display_name": "Dalta na bP&#237;ob", "link": "https://stackoverflow.com/users/5397052/dalta-na-bp%c3%adob"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504016958, "post_id": 45941034, "comment_id": 78841694, "body": "I tried both; neither works."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1504017227, "post_id": 45941034, "comment_id": 78841906, "body": "Well, <code>import Yesod (WidgetT, ToWidget)</code> <i>does</i> work."}, {"owner": {"reputation": 55, "user_id": 5397052, "user_type": "registered", "profile_image": "https://graph.facebook.com/1029711010393985/picture?type=large", "display_name": "Dalta na bP&#237;ob", "link": "https://stackoverflow.com/users/5397052/dalta-na-bp%c3%adob"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504018179, "post_id": 45941034, "comment_id": 78842648, "body": "That did it. I moved the <code>data</code> declaration that <code>mkYesod</code> uses into a <code>DataDeclarations</code> file (where I keep my own types anyway), left the <code>mkYesod</code> and the <code>instance</code> declarations in <code>Main.hs</code> and put the <code>type Widget = WidgetT MyApp IO ()</code> in the <code>Widgets.hs</code> file. Finally, <code>import DataDeclarations</code> makes it work. Thanks a bunch =)"}], "owner": {"reputation": 55, "user_id": 5397052, "user_type": "registered", "profile_image": "https://graph.facebook.com/1029711010393985/picture?type=large", "display_name": "Dalta na bP&#237;ob", "link": "https://stackoverflow.com/users/5397052/dalta-na-bp%c3%adob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504014995, "creation_date": 1504014995, "question_id": 45941034, "link": "https://stackoverflow.com/questions/45941034/widgets-in-separate-file", "title": "Widgets in separate file", "body": "<p>I've set up pretty much all my HTML with <code>Widget</code> declarations (about 250 lines of code) and my Main.hs file is getting a little to big for my taste. So naturally, I tried to move the whole widget business to a new <code>Widgets.hs</code> file.</p>\n\n<p>However, Yesod is somehow refusing to let me. The first thing I got was</p>\n\n<pre><code>Widgets.hs:17:30: error:\nNot in scope: type constructor or class \u2018Widget\u2019\nPerhaps you meant one of these:\n  \u2018WidgetT\u2019 (imported from Yesod), \u2018ToWidget\u2019 (imported from Yesod)\n</code></pre>\n\n<p>for each and every single one of my <code>Widget</code> declarations. I tried importing <code>Widget</code> and <code>ToWidget</code>, leading to the next error:</p>\n\n<pre><code>Widgets.hs:11:1: error:\nFailed to load interface for \u2018Yesod.WidgetT\u2019\nUse -v to see a list of the files searched for.\n\nWidgets.hs:12:1: error:\nFailed to load interface for \u2018Yesod.ToWidget\u2019\nPerhaps you meant Yesod.Core.Widget (from yesod-core-1.4.36)\nUse -v to see a list of the files searched for.\n</code></pre>\n\n<p>The Yesod book talks about <code>Widget</code> being just a type synonym:</p>\n\n<pre><code>type Widget = WidgetT MyApp IO ()\n</code></pre>\n\n<p>but I don't know how this might help me, or where to go from there. Do I need to do something with my <code>.cabal</code> file? I'm using the yesod-minimal stack template. </p>\n\n<p>Thanks in advance =) </p>\n"}, {"tags": ["haskell", "error-handling", "either"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1504005101, "post_id": 45937430, "comment_id": 78832927, "body": "The simplest solution would be to work in <code>Either (Either e1 e2) a</code> or <code>ExceptT (Either e1 e2) m a</code>, using eg <code>withExceptT</code> to embed each smaller computation into the bigger one. This approach starts to get clunky when you have lots of error types to deal with (though it seems you only have two for now)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1504027679, "post_id": 45937430, "comment_id": 78848410, "body": "It really depends on the context. If you want to write some code which works now without investing inordinate amounts of time into how &#39;good&#39; you can make it (this rabbit-hole is very deep), then your solution is fine. If you are using the library functions thousands of times in this way, then just define a few simple wrappers which have an appropriately general type and use those wrappers instead of the library functions directly."}], "answers": [{"tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": false, "score": 0, "last_activity_date": 1504070518, "creation_date": 1504070518, "answer_id": 45952467, "question_id": 45937430, "link": "https://stackoverflow.com/questions/45937430/dealing-with-different-error-types-in-exceptt-computation/45952467#45952467", "title": "Dealing with different error types in `ExceptT` computation", "body": "<p>If you want to handle the error only once, I'd transform <code>IO (Either e a)</code> into <code>IO a</code> with a utility function like this:</p>\n\n<pre><code>throwWhenLeft :: Exception e =&gt; IO (Either e a) -&gt; IO a\nthrowWhenLeft io = either throwIO return =&lt;&lt; io\n</code></pre>\n\n<p>This looks dangerous at a glance, but it's useful in some (very common, IMO) cases:</p>\n\n<ul>\n<li>You have to handle various Exception thrown/returned either by <code>IO a</code> or some <code>Either e a</code>.</li>\n<li>What exception handlers' do is almost always same.</li>\n</ul>\n"}], "owner": {"reputation": 2167, "user_id": 459877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdrXY.jpg?s=128&g=1", "display_name": "beta", "link": "https://stackoverflow.com/users/459877/beta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1504070518, "creation_date": 1504004440, "question_id": 45937430, "link": "https://stackoverflow.com/questions/45937430/dealing-with-different-error-types-in-exceptt-computation", "title": "Dealing with different error types in `ExceptT` computation", "body": "<p>(This question is similar to <a href=\"https://stackoverflow.com/q/27051454/459877\">this question</a> but that question only received a comment recommending the <code>errors</code> package, I would like some more details.)</p>\n\n<p>I'm working on a program that uses two different packages that both return types <code>IO (Either e a)</code> or <code>Either e a</code>. However the <code>e</code> is not the same between the libraries.</p>\n\n<p>I wonder how to structure functions that use both libraries. The hint that I should use <code>errors</code> led me to <code>hush</code> and <code>note</code>, but this doesn't feel quite right:</p>\n\n<pre><code>data MyError = Error1 | Error2 | Error3\n\nf :: IO (Either MyErrorType Text)\nf = do\n  now &lt;- someIoAction\n\n  runExceptT $ do\n    x &lt;- note Error1 $ hush LibraryA.f\n    y &lt;- ExceptT $ note Error2 . hush &lt;$&gt; LibraryB.IO.f\n    z &lt;- ExceptT $ note Error3 . hush &lt;$&gt; LibraryB.IO.g\n    pure (x, y, z)\n</code></pre>\n\n<p>How should one structure code like this? Should I match on results and convert the error types? Are there something else in the <code>errors</code> package that I should know about? I will be really grateful for an answer to the (somewhat) specific question about how to structure code like the one above and general pointers to dealing with non-uniform errors in Haskell.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 5, "creation_date": 1503987287, "post_id": 45931865, "comment_id": 78821845, "body": "Oh that was the issue! That does make sense, &#39;(&#39; will get parsed as a character of course."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 4, "creation_date": 1503998597, "post_id": 45931865, "comment_id": 78828599, "body": "@Clinton, here&#39;s a side tip: you will likely find it very useful to define <code>Fst</code> and <code>Snd</code> type families, and it can be important to use silly-looking constraints like <code>x ~ &#39;(Fst x, Snd x)</code>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1504001157, "post_id": 45931865, "comment_id": 78830305, "body": "@dfeuer: yep, already made a package for that a few months ago, I&#39;ll just update it to include type level tuples:: <a href=\"https://hackage.haskell.org/package/indextype-0.2.0.0\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/indextype-0.2.0.0</a>"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 12, "last_activity_date": 1503987171, "creation_date": 1503987171, "answer_id": 45931865, "question_id": 45931774, "link": "https://stackoverflow.com/questions/45931774/kind-polymorphic-tuples/45931865#45931865", "title": "Kind Polymorphic Tuples", "body": "<p>If you are already using <code>DataKinds</code>, you should just use the promoted version of built-in tuple <em>constructor</em>, as opposed to the type constructor:</p>\n\n<pre><code>type Test3 = '( 'Test, 'Test)\n</code></pre>\n\n<p>This has kind <code>(Test, Test)</code>.</p>\n\n<p>Note there must be a space between <code>(</code> and <code>'</code>; <code>'('Test, 'Test)</code> is a syntax error (a necessary edge case in the parser).</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 45931865, "answer_count": 1, "score": 9, "last_activity_date": 1503987171, "creation_date": 1503986831, "question_id": 45931774, "link": "https://stackoverflow.com/questions/45931774/kind-polymorphic-tuples", "title": "Kind Polymorphic Tuples", "body": "<p>I noticed with <code>PolyKinds</code> and <code>DataKinds</code> the following compiles fine:</p>\n\n<pre><code>data Pair a b\ndata Test = Test\ntype Test2 = Pair 'Test 'Test\n</code></pre>\n\n<p>However:</p>\n\n<pre><code>type Test3 = ('Test, 'Test)\n</code></pre>\n\n<p>fails, presumably as <code>(,)</code> is not kind polymorphic, which makes sense as it makes values out of it's type arguments and you can't make values of types which are not of kind <code>*</code>.</p>\n\n<p>Is there a library that has kind polymorphic tuples (to save me reinventing the wheel)?</p>\n\n<p>I do realise that that unlike real tuples, kind polymorphic tuples will only exist on the type level, but that's all I need for my purposes. </p>\n"}, {"tags": ["haskell", "svg", "sdl-2", "haskell-stack", "haskell-sdl"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503987393, "post_id": 45931747, "comment_id": 78821893, "body": "What have you tried? What do you mean by &quot;sdl2-image doesn&#39;t support this format&quot;? If you believe it should be possible with these libs, I&#39;m guessing that you can write the corresponding C program - if so, feel free to include that program."}, {"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503989090, "post_id": 45931747, "comment_id": 78822804, "body": "I&#39;ve added a C++ solution that uses nanosvg and quoted the supported image formats of SDL2 Image."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1504011317, "post_id": 45931747, "comment_id": 78837350, "body": "Voting to close for reason of this being a library recommendation question, which is off topic on SO. Just google &quot;Haskell SVG renderer&quot; and you should find some options."}, {"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504029284, "post_id": 45931747, "comment_id": 78849372, "body": "I was asked to provide an example in another language. My example is in C++ and requires another library nanosvg. You have to do a <code>static_cast&lt;void *&gt;</code> on the image data. Haskell&#39;s <code>SDL.createRGBSurfaceFrom</code> expects <code>Data.Vector.Storable.Mutable.VectorIO Word8</code> as image data. I don&#39;t know how to get image data of this type with or without library."}], "answers": [{"comments": [{"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504085894, "post_id": 45950531, "comment_id": 78871595, "body": "I&#39;ve added a running example to my question based on your suggestions. However, it is not rendering the correct result. I suppose I have to convert the pixel data somehow."}, {"owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "reply_to_user": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 1, "creation_date": 1504093746, "post_id": 45950531, "comment_id": 78877075, "body": "@maiermic I think you might simply need to set the pitch to 4 times the width, as in your C++ example"}, {"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504100954, "post_id": 45950531, "comment_id": 78882909, "body": "You are right. I overlooked that. I also overlooked to use <code>ABGR8888</code> instead of <code>RGBA8888</code>"}], "tags": [], "owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "is_accepted": false, "score": 1, "last_activity_date": 1504056376, "creation_date": 1504056376, "answer_id": 45950531, "question_id": 45931747, "link": "https://stackoverflow.com/questions/45931747/how-to-rasterize-svg-to-sdl-surface-in-haskell/45950531#45950531", "title": "How to rasterize SVG to SDL.Surface in Haskell?", "body": "<p>I haven't tested this with real code, but hopefully it's on the right track:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/rasterific-svg-0.3.3/docs/Graphics-Rasterific-Svg.html#v:renderSvgDocument\" rel=\"nofollow noreferrer\"><code>renderSvgDocument</code></a> gets you an <code>IO (Image PixelRGBA8)</code> where the result type is from the JuicyPixels image library.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/JuicyPixels-3.2.8.3/docs/Codec-Picture.html#g:16\" rel=\"nofollow noreferrer\"><code>imageData</code></a> gets you a (<code>Storable</code>) <code>Vector (PixelBaseComponent PixelRGBA8)</code> which I guess is a <code>Vector Word8</code> after chasing all the types.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Generic.html#v:thaw\" rel=\"nofollow noreferrer\"><code>thaw</code></a> or <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Generic.html#v:unsafeThaw\" rel=\"nofollow noreferrer\"><code>unsafeThaw</code></a> (read the docs for important safety information) get you a mutable copy (or view, for the unsafe variant) of an immutable <code>Vector</code>.</p>\n"}], "owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 819, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1504085641, "creation_date": 1503986726, "last_edit_date": 1504085641, "question_id": 45931747, "link": "https://stackoverflow.com/questions/45931747/how-to-rasterize-svg-to-sdl-surface-in-haskell", "title": "How to rasterize SVG to SDL.Surface in Haskell?", "body": "<p>I'm using <a href=\"https://hackage.haskell.org/package/sdl2-2.2.0\" rel=\"nofollow noreferrer\">sdl2@2.2.0</a> and <a href=\"https://hackage.haskell.org/package/sdl2-image-2.0.0\" rel=\"nofollow noreferrer\">sdl2-image@2.0.0</a>. I'd like to draw a SVG image, but sdl2-image doesn't support this format (see <a href=\"https://www.libsdl.org/projects/SDL_image/\" rel=\"nofollow noreferrer\">https://www.libsdl.org/projects/SDL_image/</a>):</p>\n\n<blockquote>\n  <p>SDL_image is an image file loading library.<br>\n  It loads images as SDL surfaces and textures, and supports the following formats: BMP, GIF, JPEG, LBM, PCX, PNG, PNM, TGA, TIFF, WEBP, XCF, XPM, XV</p>\n</blockquote>\n\n<p>How can I load a SVG, scale/resize it and rasterize it to a <code>SDL.Surface</code> or <code>SDL.Texture</code>?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>In C++ you can use <a href=\"https://github.com/memononen/nanosvg\" rel=\"nofollow noreferrer\">nanosvg</a> library:</p>\n\n<pre><code>NSVGimage * svg_image = nsvgParseFromFile(filepath.c_str(), \"px\", 96.0);\nstd::vector&lt;Uint8&gt; img_data;\nimg_data.resize(width * height * 4);\n\nNSVGrasterizer * rasterizer = nsvgCreateRasterizer()\nnsvgRasterize(rasterizer,\n              svg_image, 0,0,1,\n              img_data.data(),\n              width, height,\n              width * 4);\n\nSDL_Surface * surface = SDL_CreateRGBSurfaceFrom(\n                          static_cast&lt;void *&gt;(img_data.data()),\n                          width, height,\n                          32,         // depth\n                          4 * width,  // pitch\n                          0x000000FF, // red mask\n                          0x0000FF00, // green mask\n                          0x00FF0000, // blue mask\n                          0xFF000000  // alpha mask (alpha in this format)\n                        );\n</code></pre>\n\n<p>You have to do a <code>static_cast&lt;void *&gt;</code> on the image data you pass to <code>SDL_CreateRGBSurfaceFrom</code>. Haskell's <code>SDL.createRGBSurfaceFrom</code> (sdl2 version 2.2.0) expects <code>Data.Vector.Storable.Mutable.VectorIO Word8</code> as image data.</p>\n\n<p>I found a promising library <a href=\"https://hackage.haskell.org/package/rasterific-svg\" rel=\"nofollow noreferrer\">rasterific-svg</a></p>\n\n<blockquote>\n  <p>This package can render SVG to an image or transform it to a PDF.</p>\n</blockquote>\n\n<p>You can render using <a href=\"https://hackage.haskell.org/package/rasterific-svg-0.3.3/docs/Graphics-Rasterific-Svg.html#v:drawingOfSvgDocument\" rel=\"nofollow noreferrer\"><code>drawingOfSvgDocument</code></a> or <a href=\"https://hackage.haskell.org/package/rasterific-svg-0.3.3/docs/Graphics-Rasterific-Svg.html#v:renderSvgDocument\" rel=\"nofollow noreferrer\"><code>renderSvgDocument</code></a>. However, I don't know how to convert either of the results to <code>Data.Vector.Storable.Mutable.VectorIO Word8</code>.</p>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>I've a running <a href=\"https://github.com/maiermic/render-svg-in-sdl2-haskell/tree/2bfc83b990c4fe99f34b66279c461f0ecf913641\" rel=\"nofollow noreferrer\">example</a> now. However, the rendering result is not correct yet.</p>\n\n<p>This <a href=\"https://www.flaticon.com/free-icon/thumbs-up_506400\" rel=\"nofollow noreferrer\">SVG</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/R7gr8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/R7gr8.png\" alt=\"SVG image\"></a></p>\n\n<p>is rendered as</p>\n\n<p><a href=\"https://i.stack.imgur.com/mbQt0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mbQt0.png\" alt=\"rendering result\"></a></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Codec.Picture\nimport Codec.Picture.Types\nimport Data.Vector.Storable.Mutable (IOVector)\nimport Data.Vector.Generic (thaw)\nimport Graphics.Rasterific.Svg\n       (loadCreateFontCache, renderSvgDocument)\nimport Graphics.Svg (loadSvgFile)\n\nimport Data.Function (fix)\nimport Data.Word (Word8)\n\nimport Control.Monad as CM\nimport qualified Data.Vector.Generic.Mutable as GM\nimport Data.Vector.Storable (Vector)\nimport qualified Data.Vector.Storable as V\n\nimport Foreign.C.Types (CInt)\nimport qualified SDL\nimport SDL.Vect (Point(P), V2(V2), V4(V4))\n\nimport Control.Concurrent (threadDelay)\nimport SDL (($=))\n\nimport Paths_render_svg_in_sdl2_haskell (getDataFileName)\n\nscreenWidth, screenHeight :: CInt\n(screenWidth, screenHeight) = (1280, 720)\n\n-- SDL dependency: sudo apt-get install libsdl2-dev\nmain :: IO ()\nmain = do\n  SDL.initialize [SDL.InitVideo, SDL.InitTimer, SDL.InitEvents]\n    -- ensure render quality\n  SDL.HintRenderScaleQuality $= SDL.ScaleLinear\n  do renderQuality &lt;- SDL.get SDL.HintRenderScaleQuality\n     CM.when (renderQuality /= SDL.ScaleLinear) $\n       putStrLn \"Warning: Linear texture filtering not enabled!\"\n  window &lt;-\n    SDL.createWindow\n      \"Load and render SVG\"\n      SDL.defaultWindow\n      { SDL.windowPosition = SDL.Centered\n      , SDL.windowInitialSize = V2 screenWidth screenHeight\n      }\n  SDL.showWindow window\n  renderer &lt;-\n    SDL.createRenderer\n      window\n      (-1)\n      SDL.RendererConfig\n      { SDL.rendererType = SDL.AcceleratedVSyncRenderer\n      , SDL.rendererTargetTexture = True\n      }\n  SDL.rendererDrawColor renderer $= V4 maxBound maxBound maxBound maxBound\n  SDL.clear renderer\n  renderSvgExample renderer\n  SDL.present renderer\n  threadDelay 2000000\n  SDL.destroyRenderer renderer\n  SDL.destroyWindow window\n  SDL.quit\n\nrenderSvgExample :: SDL.Renderer -&gt; IO ()\nrenderSvgExample renderer = do\n  mimage &lt;- getDataFileName \"thumbs-up.svg\" &gt;&gt;= loadSVGImage\n  case mimage of\n    Nothing -&gt; putStrLn \"Image convertion failed.\"\n    (Just image) -&gt; do\n      let surfaceSize :: V2 CInt\n          surfaceSize = V2 screenWidth screenHeight\n      surface &lt;- createSurfaceFromSVG image surfaceSize\n      texture &lt;- SDL.createTextureFromSurface renderer surface\n      SDL.freeSurface surface\n      let source = SDL.Rectangle (P $ V2 0 0) surfaceSize\n          dest = SDL.Rectangle (P $ V2 0 0) surfaceSize\n          angle = 0.0\n          center = Nothing\n          flipNone = V2 False False\n      SDL.copyEx\n        renderer\n        texture\n        (Just source)\n        (Just dest)\n        angle\n        center\n        flipNone\n      SDL.destroyTexture texture\n\ncreateSurfaceFromSVG :: Image PixelRGBA8 -&gt; V2 CInt -&gt; IO SDL.Surface\ncreateSurfaceFromSVG image surfaceSize = do\n  let rawImageData :: Vector Word8\n      rawImageData = imageData image\n      imWidth :: Int\n      imWidth = imageWidth image\n      pitch :: CInt\n      pitch = fromIntegral imWidth\n  mutableVector &lt;- convertToMutableVector rawImageData\n  SDL.createRGBSurfaceFrom mutableVector surfaceSize pitch SDL.RGBA8888\n\nconvertToMutableVector :: Vector Word8 -&gt; IO (IOVector Word8)\nconvertToMutableVector= thaw\n\nloadSVGImage :: FilePath -&gt; IO (Maybe (Image PixelRGBA8))\nloadSVGImage filepath = do\n  mdoc &lt;- loadSvgFile filepath\n  case mdoc of\n    Nothing -&gt; return Nothing\n    Just doc -&gt; do\n      cache &lt;- loadCreateFontCache \"fonty-texture-cache\"\n      (finalImage, _) &lt;- renderSvgDocument cache Nothing 96 doc\n      return $ Just finalImage\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "subclass", "typeclass", "class-hierarchy"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503981109, "post_id": 45930253, "comment_id": 78819793, "body": "If you really wanted to, you could have two function; <code>isCollidingShape</code> in the <code>Shape</code> class and <code>isCollidingPolygon</code> in the <code>Polygon</code> class, and a default implementation of <code>isCollidingShape = isCollidingPolygon</code> for those <code>Shape</code>s which are also <code>Polygon</code>s. Generally, this isn&#39;t really a correct way to design interfaces - you&#39;ve begun with the interface and hope it is sufficient to implement a certain functionality; instead you should begin by trying to implement that functionality for some concrete cases, and then abstract similar functionality into an interface."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1503984567, "post_id": 45930253, "comment_id": 78820720, "body": "Object-oriented inheritance is often more naturally represented as a sum type. (The term &quot;class&quot; can mislead \u2013 in OOP, you&#39;re classifying objects; in Haskell, you&#39;re classifying types.)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1504017833, "post_id": 45930253, "comment_id": 78842370, "body": "&quot;Object-oriented inheritance is often more naturally represented as a sum type&quot;. I keep wondering where people are getting this strange idea from. There is literally nothing in common between them. BTW a classification on types naturally induces a classification on objects. @molbdnilo"}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 10, "last_activity_date": 1503979965, "creation_date": 1503979965, "answer_id": 45930565, "question_id": 45930253, "link": "https://stackoverflow.com/questions/45930253/using-subclass-implementation-in-the-definition-of-superclass-functions/45930565#45930565", "title": "Using subclass implementation in the definition of superclass functions", "body": "<p>Your current <code>Shape</code> class says \u201c<code>isColliding</code> can tell whether this shape intersects another shape <em>using only the methods of <code>Shape</code></em> on the other shape\u201d, because its signature <code>(Shape b) =&gt; a -&gt; b -&gt; Bool</code> only tells you that <code>b</code> has an instance of <code>Shape</code>. So you\u2019re right that this isn\u2019t quite what you want.</p>\n\n<p>One thing you can do is use <code>MultiParamTypeClasses</code> to describe a <em>relationship</em> between two types:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n\nclass Colliding a b where\n  collidesWith :: a -&gt; b -&gt; Bool\n</code></pre>\n\n<p>And then make instances for various concrete combinations of types:</p>\n\n<pre><code>instance Colliding Circle Box where\n  Circle p r `collidesWith` Box p1 p2 \u03b8 = {- \u2026 -}\n</code></pre>\n\n<p>Here you know the concrete types of both <code>a</code> and <code>b</code> when defining the implementation. That might be good enough for your use case.</p>\n\n<p>However, this leaves you with <em>n</em><sup>2</sup> instances if you have <em>n</em> types. And you\u2019ll run into problems if you try to define polymorphic instances like this:</p>\n\n<pre><code>instance (HasBoundingBox b) =&gt; Colliding Circle b where\n  collidesWith = {- \u2026 -}\n</code></pre>\n\n<p>Because this <em>overlaps</em> with all your other instances for <code>Colliding Circle</code>: <code>b</code> will match <em>any</em> type, and only add the constraint that <code>b</code> must have an instance of <code>HasBoundingBox</code>. That constraint is checked <em>after</em> instance resolution. You can work around this with <code>OverlappingInstances</code> or the newer <code>OVERLAPPABLE</code>/<code>OVERLAPPING</code>/<code>OVERLAPS</code> pragmas to tell GHC to choose the <em>most specific</em> matching instance, but this might be more trouble than it\u2019s worth if you\u2019re just getting familiar with Haskell.</p>\n\n<p>I\u2019d have to think on it more, but there are definitely alternative approaches. In the simplest case, if you only need to deal with a few different kinds of shape, then you can just make them a single sum type instead of separate data types:</p>\n\n<pre><code>data Shape\n  = Circle Point Radius\n  | Box Point Point Angle\n  | \u2026\n</code></pre>\n\n<p>Then your <code>isColliding</code> function can be of type <code>Shape -&gt; Shape -&gt; Bool</code> and just pattern-match on this type.</p>\n\n<p>Generally speaking, if you\u2019re writing a typeclass, it should come with <em>laws</em> for how instances should behave, like <code>mappend x mempty == mappend mempty x == x</code> from <code>Data.Monoid</code>. If you can\u2019t think of any equations that should always hold for instances of your class, you should prefer to represent things with plain old functions and data types instead.</p>\n"}], "owner": {"reputation": 500, "user_id": 6030440, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-3k0aSh3Ojgs/AAAAAAAAAAI/AAAAAAAAACg/Yn_hyfPJonk/photo.jpg?sz=128", "display_name": "Austin Garrett", "link": "https://stackoverflow.com/users/6030440/austin-garrett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1504007622, "creation_date": 1503977429, "last_edit_date": 1504007622, "question_id": 45930253, "link": "https://stackoverflow.com/questions/45930253/using-subclass-implementation-in-the-definition-of-superclass-functions", "title": "Using subclass implementation in the definition of superclass functions", "body": "<p>In my Haskell program I have some typeclasses representing abstract notions of \"shapes\", namely</p>\n\n<pre><code>-- | Class representing shapes.\nclass Shape a where\n  isColliding :: (Shape b) =&gt; a -&gt; b -&gt; Bool\n  centroid :: Point\n\n-- | Class representing shapes composed of a finite number of vertices \nand line segments connecting them.\nclass (Shape a) =&gt; Polygon a where\n  vertices :: a -&gt; Vertices \n</code></pre>\n\n<p>As you can see, <code>Polygon</code> is naturally a subclass of <code>Shape</code>. I also have some data types that are instances of these different typeclasses. For example:</p>\n\n<pre><code>data Box = Box Point Point Angle\n\ninstance Shape Box where\n  ...\n\ninstance Polygon Box where\n  ...\n\n---------------------------------\n\ndata Circle = Circle Point Radius\n\ninstance Shape Circle where\n  ...\n</code></pre>\n\n<p>I have many more possible shapes, such as <code>NGon</code>, <code>RegularNGon</code>, etc. I would like to be able to implement <code>isColliding</code>, but the information required to calculate whether two shapes are colliding is dependent upon the implementation of the specific instance of <code>Shape</code>. For example, to calculate if two boxes are colliding, I need their list of vertices. So I have a few questions:</p>\n\n<ol>\n<li>Is there anyway to \"specialize\" my function <code>isColliding</code> so that it is defined in a specific way for collisions of the type <code>isColliding :: (Polygon b) =&gt; Box -&gt; b -&gt; Bool</code>?</li>\n<li>Is the structuring of my datatypes the best way to approach this problem, or am I misusing typeclasses and datatypes when the whole thing could be restructured to eliminate this problem?</li>\n</ol>\n\n<p>I am rather new to Haskell, so if my question is worded poorly or any clarification is needed, please tell me.</p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1503938208, "post_id": 45923629, "comment_id": 78805830, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/30224796/how-should-the-general-type-of-a-lemma-function-be-understood\">How should the general type of a \u201clemma\u201d function be understood?</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503965466, "post_id": 45923629, "comment_id": 78816479, "body": "<code>withKnownNat</code> takes two arguments; the first is a singleton, and the second is a value of type <code>r</code> which is only valid in the context <code>KnownNat n</code>. The value <code>x :: Sing n</code> is being used to discharge the <code>KnownNat n</code> constraint, i.e. to prove that <code>KnownNat n</code> is satisfied. Another type that could be assigned to this function is <code>Sing n -&gt; Dict (KnownNat n)</code> where <code>data Dict p where Dict :: p =&gt; Dict p</code>. By pattern matching on a <code>Dict p</code>, you bring a constraint <code>p</code> into scope; the actual type just removes that middle step of pattern matching on the <code>Dict</code>."}, {"owner": {"reputation": 6934, "user_id": 2723943, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4KuJN.jpg?s=128&g=1", "display_name": "Imran Ali Khan", "link": "https://stackoverflow.com/users/2723943/imran-ali-khan"}, "edited": false, "score": 0, "creation_date": 1506085231, "post_id": 45923629, "comment_id": 79690311, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/30224796/how-should-the-general-type-of-a-lemma-function-be-understood\">How should the general type of a &quot;lemma&quot; function be understood?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1503953018, "last_edit_date": 1503953018, "creation_date": 1503939153, "answer_id": 45923883, "question_id": 45923629, "link": "https://stackoverflow.com/questions/45923629/how-to-read-this-strange-type-signature-foo-sing-n-knownnat-n-r-r/45923883#45923883", "title": "How to read this strange type signature foo :: Sing n -&gt; (KnownNat n =&gt; r) -&gt; r", "body": "<p><code>KnownNat n</code> is basically just a way of saying \u201cthere's a specific number\u201d associated to <code>n</code> (it \u201cis\u201d the number <code>n</code>). So if you have a constraint <code>KnownNat n =&gt; ...</code> to anything, it's equivalent to passing in one specific number.</p>\n\n<pre><code>withKnownNat' :: Sing n -&gt; (Integer -&gt; r) -&gt; r\n</code></pre>\n\n<p>That in turn is nothing else but a <a href=\"https://en.wikipedia.org/wiki/Continuation-passing_style\" rel=\"nofollow noreferrer\">CPS</a> way of writing</p>\n\n<pre><code>natVal :: Sing n -&gt; Integer\n</code></pre>\n\n<p>...which is essentially a specific instantiation of <a href=\"https://hackage.haskell.org/package/singletons-2.3.1/docs/Data-Singletons-TypeLits.html#v:natVal\" rel=\"nofollow noreferrer\">the actual</a></p>\n\n<pre><code>natVal :: KnownNat n =&gt; proxy n -&gt; Integer\n</code></pre>\n\n<p>except that the <code>Sing</code> has the typeclass constraint baked-in.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 4, "last_activity_date": 1503991674, "creation_date": 1503991674, "answer_id": 45933157, "question_id": 45923629, "link": "https://stackoverflow.com/questions/45923629/how-to-read-this-strange-type-signature-foo-sing-n-knownnat-n-r-r/45933157#45933157", "title": "How to read this strange type signature foo :: Sing n -&gt; (KnownNat n =&gt; r) -&gt; r", "body": "<p>The difference between these two signatures:</p>\n\n<pre><code>withKnownNat :: Sing n -&gt; (KnownNat n =&gt; r) -&gt; r\nwithKnownNat' :: KnownNat n =&gt; Sing n -&gt; r -&gt; r\n</code></pre>\n\n<p>is in who is required to provide evidence that the constraint <code>KnownNat n</code> holds.</p>\n\n<p>The hypothetical version with the constraint up front (\"after the <code>::</code> (hasType) symbol\") requires the caller of <code>withKnownNat'</code> to be able to prove <code>KnownNat n</code> in order to invoke the function. That type signature can be read as something like \"if you can prove <code>KnownNat n</code>, and give me both a <code>Sing n</code> and an <code>r</code>, I will give you back an <code>r</code>\".</p>\n\n<p>That's not particularly useful, as it could be implemented by simply ignoring the <code>KnownNat n</code> constraint and the <code>Sing n</code> argument and just returning the <code>r</code> its given. And without knowing what <code>r</code> is it couldn't really do much else to return an <code>r</code>; it could possibly do some operations with <code>n</code> and raise an error under some conditions, or do some nasty hacking with unsafe functions internally, but that's about it.</p>\n\n<p>In the actual version, it's not the whole <code>withKnownNat</code> function that is under the <code>KnownNat n</code> constraint, but rather one of its arguments has that constraint. This means the caller of <code>withKnownNat</code> <em>doesn't</em> have to be able to prove <code>KnownNat n</code>; instead the caller can pass an argument that <em>needs</em> a proof of <code>KnownNat n</code>. As an argument<sup>1</sup> to a function the type <code>KnownNat n =&gt; r</code> can be read as \"a value that is of type <code>r</code> <em>under the assumption</em> that <code>KnownNat n</code> holds\". So the whole signature can be read as something like \"if you give me both (1) a <code>Sing n</code> and (2) a value that is of type <code>r</code> under the assumption that <code>KnownNat n</code> holds, then I will give you a value of type <code>r</code>\".</p>\n\n<p>We can see that this is much more useful just from the type. Since it's polymorphic in <code>r</code>, the only way <code>withKnownNat</code> could get an <code>r</code> is from the <code>KnownNat n =&gt; r</code> we gave it. It can only actually use the <code>KnownNat n =&gt; r</code> value as a value of type <code>r</code> to return to us <em>if it can prove <code>KnownNat n</code></em>. So basically this type for <code>withKnownNat</code> amounts to a promise that whenever we have a <code>Sing n</code>, we can also use anything that needs <code>KnownNat n</code> for the same <code>n</code>; <code>withKnownNat</code> is just what we have to call to convert one into the other.</p>\n\n<hr>\n\n<p><sup>1</sup> It means the same thing as a return value of a function as well, but it turns out that getting a return value that needs a constraint works out to exactly the same thing as if the whole function needed the constraint, so GHC always converts types like <code>arg -&gt; (constraints =&gt; result)</code> to just <code>constraints =&gt; args -&gt; result</code>.</p>\n"}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 45933157, "answer_count": 2, "score": 6, "last_activity_date": 1503991674, "creation_date": 1503938067, "question_id": 45923629, "link": "https://stackoverflow.com/questions/45923629/how-to-read-this-strange-type-signature-foo-sing-n-knownnat-n-r-r", "title": "How to read this strange type signature foo :: Sing n -&gt; (KnownNat n =&gt; r) -&gt; r", "body": "<p>In the singletons package the function <a href=\"https://hackage.haskell.org/package/singletons-2.3.1/docs/Data-Singletons-TypeLits.html#v:withKnownNat\" rel=\"noreferrer\">withKnownNat</a> has the following strange type signature: </p>\n\n<p><code>withKnownNat :: Sing n -&gt; (KnownNat n =&gt; r) -&gt; r</code>.</p>\n\n<p>The <code>KnownNat n =&gt;</code> context is not after the <code>::</code> (hasType) symbol, but in the second function argument: <code>-&gt; (KnownNat n =&gt; r) -&gt;</code>.</p>\n\n<p>How do I read this signature? What does it exactly mean? Where is it documented?</p>\n"}, {"tags": ["haskell", "garbage-collection", "ghc"], "comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 2, "creation_date": 1503930932, "post_id": 45921432, "comment_id": 78801753, "body": "I&#39;d recommend using <a href=\"http://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a> for benchmarks like that. <code>getPOSIXTime</code> is a system call which can be expensive, therefore isn&#39;t a reliable way for measuring how long a very fast computation will take."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1503996204, "post_id": 45921432, "comment_id": 78827082, "body": "I&#39;m pretty sure that &quot;large&quot; objects get allocated in a dedicated special area, rather than going on the regular generational heap."}, {"owner": {"reputation": 43, "user_id": 8190669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3233cca518ea43fd12edc7c87867e80b?s=128&d=identicon&r=PG&f=1", "display_name": "yoda", "link": "https://stackoverflow.com/users/8190669/yoda"}, "edited": false, "score": 0, "creation_date": 1504019311, "post_id": 45921432, "comment_id": 78843456, "body": "Alexey I did look at the criterion benchmarks. Im having issues with typing as  the function i want to benchmark is of type    <code>(i, i) -&gt; e -&gt; IO (a i e)</code> and whnf or nf is of type    <code>(a-&gt;b)-&gt;a-&gt;benchmarkable</code>. It complains that I cant give it a function with 3 arguments. Moreover the <a href=\"http://hackage.haskell.org/package/criterion-0.8.0.1/docs/Criterion-Measurement.html\" rel=\"nofollow noreferrer\">time</a> function in Criterion.Measurement is apparently obsolete"}, {"owner": {"reputation": 43, "user_id": 8190669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3233cca518ea43fd12edc7c87867e80b?s=128&d=identicon&r=PG&f=1", "display_name": "yoda", "link": "https://stackoverflow.com/users/8190669/yoda"}, "edited": false, "score": 0, "creation_date": 1504020215, "post_id": 45921432, "comment_id": 78844082, "body": "MathematicalOrchid, even if large objects are allocated in an older gen like in quite a few generational GC allocation models, woudn&#39;t there be enough free allocation blocks for haskell  to resize the gen it is allocating the large object to (mentioned as an advantage of a block structured heap)? This should reduce the mutator pause time and there fore decrease time to allocate the object, right?"}], "owner": {"reputation": 43, "user_id": 8190669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3233cca518ea43fd12edc7c87867e80b?s=128&d=identicon&r=PG&f=1", "display_name": "yoda", "link": "https://stackoverflow.com/users/8190669/yoda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1503930578, "creation_date": 1503930578, "question_id": 45921432, "link": "https://stackoverflow.com/questions/45921432/measuring-gc-cost-in-a-fragmented-heap-haskell", "title": "Measuring GC cost in a fragmented heap - Haskell", "body": "<p>I am trying to benchmark fragmentation tolerance in haskell for an experiment.  I fill the heap up with small arrays and then deallocate every alternate one. I then try to allocate a large array of size equivalent to the size of the holes created by the deallocation and time this allocation. The outcome of this is to show that in a constrained heap setting, the cost of GCing is higher and more unpredictable than when there is a lot more free space on the heap. My code is as below. I use the large IO array of <code>SmallObj</code> to keep track of the small arrays which makes sure they are not optimized away and also makes it easier to deallocate every alternate one. </p>\n\n<pre><code>import Data.Array as AR\nimport Data.Array.IO as MA\nimport Control.Monad\nimport GHC.Stats\nimport System.Mem\nimport System.Environment\nimport System.IO\nimport Data.Time.Clock.POSIX\n\ndata SmallObj = SmallArray (IOArray Int Int) | Void\nallocateArray num = do\n    smallarr &lt;- MA.newArray (1,2) num\n    return smallarr\n\n--fillHeap :: Int -&gt; IO (IOArray Int (Maybe (IO(IOArray Int Int))))\nfillHeap n = do\n    temparr &lt;- MA.newArray(1,2) 10\n    let tempsarr = SmallArray (temparr)\n    arr &lt;- MA.newArray (1,n) tempsarr :: IO (IOArray Int SmallObj)\n    traverseArray arr 1 n\n    return arr\n\n\ntraverseArray arr n size\n    | n &lt;= size = do\n                    smallarr &lt;- allocateArray n\n                    let ssmallarr = SmallArray (smallarr)\n                    MA.writeArray arr n ssmallarr\n                    traverseArray arr (n+1) size\n    | otherwise = return arr\n\ntreadArray arr n size\n    | n&lt;=size = do\n            b &lt;- readArray arr n\n            treadArray arr (n+1) size\n    | otherwise = return ()\n\ngoThroughArray arr n size\n    | n&lt;=size = do\n            b &lt;- readArray arr n\n            goThroughArray arr (n+1) size\n    | otherwise = return ()\n\nfragmentHeap lref n size\n    | n &lt;= size = do \n                          writeArray lref n Void\n                          fragmentHeap lref (n+2) size\n    | otherwise = return lref\n\nputProgress :: Int -&gt; IO ()\nputProgress s = hPutStr stdout $ \"\\r\\ESC[K\" ++ show s\n\nmain = do\n    args &lt;- getArgs\n    let size = read $ args!!0 :: Int -- 233570\n    putStrLn \"fillHeap\"\n    arr &lt;- fillHeap size\n    putStrLn \"fragmentHeap\"\n    arr &lt;- fragmentHeap arr 2 size\n    putStrLn \"\\nmake small array\"\n    stats &lt;- getGCStats\n    putStrLn $ \"Bytes allocated \" ++ show(currentBytesUsed stats)\n    tStart &lt;- getPOSIXTime\n    arr2 &lt;- MA.newArray(1,1832957) 10 :: IO (IOUArray Int Int)\n    tStop &lt;- getPOSIXTime\n    putStrLn $ \"took \" ++ show (tStop - tStart)\n    treadArray arr2 1 1832957\n    goThroughArray arr 1 size    \n    stats &lt;- getGCStats\n    putStrLn $ \"Bytes allocated \" ++ show(currentBytesUsed stats)\n    putStrLn (\"done\")\n</code></pre>\n\n<p>The issue i am facing is that the time taken to allocate the large array on the fragmented heap is almost the same irrespective the amount of free space available. I pin the heap size to 32 megs initially and all the sizes of arrays are the max possible size to fill the heap. On increasing the heap size by ten megs each time keeping the size of array allocated same, the amount of time taken to allocate the large array on a fragmented(supposedly) heap does not reduce as one would expect.  Here are some sample outputs: </p>\n\n<pre><code>./fragger2 233570 +RTS -T -M32477184 -RTS                                                                                   \nfillHeap\nfragmentHeap\n\nmake small array\nBytes allocated 31596064\ntook 0.004635s\nBytes allocated 31511432\ndone\n</code></pre>\n\n<p>And when i increase the initial heap size by about 10 MB</p>\n\n<pre><code>./fragger2 233570 +RTS -T -M42477184 -RTS                                                                                     \nfillHeap\nfragmentHeap\nmake small array\nBytes allocated 17522368\ntook 0.004519s\nBytes allocated 31511432\ndone\n</code></pre>\n\n<p>Being relatively new to Haskell I would like to know if I am measuring the time right and if the array allocation being a monadic operation affects the timing in any way , which is why I get the same allocation time irrespective of the free space on the heap?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 5, "creation_date": 1503928585, "post_id": 45920664, "comment_id": 78800079, "body": "I might be missing something, but how would a function be equal to a value? Do you mean the return of a function?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1503928863, "post_id": 45920664, "comment_id": 78800279, "body": "Please add the full use case; this is probably an <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>. It never makes sense to compare whether \u201ca function is equal to <code>True</code>\u201d (except in a theoretical discussion with booleans in <a href=\"https://en.wikipedia.org/wiki/Church_encoding\" rel=\"nofollow noreferrer\">Church encoding</a>)."}, {"owner": {"reputation": 11, "user_id": 8520204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebc078920e7e5c815a4f9bb42dabb41f?s=128&d=identicon&r=PG&f=1", "display_name": "James Raquel", "link": "https://stackoverflow.com/users/8520204/james-raquel"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1503929164, "post_id": 45920664, "comment_id": 78800478, "body": "Oh yeah. I mean a return value of function. @Carcigenicate"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1503929257, "post_id": 45920664, "comment_id": 78800543, "body": "@JamesRaquel Your function takes 3 arguments, yet in your example, you don&#39;t supply any. What data needs to be given to the function? You can&#39;t get a value return without applying the function to something first."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1503929516, "creation_date": 1503929516, "answer_id": 45921076, "question_id": 45920664, "link": "https://stackoverflow.com/questions/45920664/how-to-check-if-function-is-equal-to-a-particular-value-in-haskell/45921076#45921076", "title": "How to check if function is equal to a particular value in Haskell", "body": "<p>You can simply call the function in your guard.\nExample:</p>\n\n<pre><code>bar :: Int -&gt; Int\nbar x = x*x\n\nbaz :: Int -&gt; Int\nbaz x = x+2\n\nbaw :: Int -&gt; Bool  -- note: this returns a Bool instead\nbaw x = x &lt; 12\n\nfoo :: Int -&gt; Int -&gt; String\nfoo x y\n  | x &gt; 2               = \"a\"\n  | bar x + baz y &lt; 100 = \"b\"\n  | baw x               = \"c\"\n  | otherwise           = \"d\"\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8520204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebc078920e7e5c815a4f9bb42dabb41f?s=128&d=identicon&r=PG&f=1", "display_name": "James Raquel", "link": "https://stackoverflow.com/users/8520204/james-raquel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503929516, "creation_date": 1503928254, "question_id": 45920664, "link": "https://stackoverflow.com/questions/45920664/how-to-check-if-function-is-equal-to-a-particular-value-in-haskell", "title": "How to check if function is equal to a particular value in Haskell", "body": "<p>For example, I have a function below.</p>\n\n<pre><code>function :: x -&gt; y -&gt; z -&gt; v -&gt; Bool\n</code></pre>\n\n<p>I want to do something if function is equal to True in guards like: </p>\n\n<pre><code>| something = do something\n| function == True = do something\n| something = something do something\n</code></pre>\n\n<p>How can I implement it using a correct syntax?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1503932269, "post_id": 45920612, "comment_id": 78802556, "body": "Any reason to not just use the <code>Generic</code> derived instance?"}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503933407, "post_id": 45920612, "comment_id": 78803279, "body": "Yeah, no <code>Generic1</code> for <code>HashMap</code>. Currently building something on top of <a href=\"https://github.com/ekmett/discrimination/blob/master/src/Data/Discrimination/Grouping.hs#L79\" rel=\"nofollow noreferrer\">github.com/ekmett/discrimination/blob/master/src/Data/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503933921, "post_id": 45920612, "comment_id": 78803595, "body": "<code>Generic1 (HashMap a)</code> shouldn&#39;t be needed, just <code>Grouping1 (HashMap.HashMap a)</code>."}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503934624, "post_id": 45920612, "comment_id": 78803999, "body": "It does need a <code>Generic1</code> for the full <code>JSONTypeF</code>, which apparently requires a <code>Generic</code> of the HashMap."}], "answers": [{"tags": [], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "is_accepted": true, "score": 1, "last_activity_date": 1503939703, "creation_date": 1503939703, "answer_id": 45924032, "question_id": 45920612, "link": "https://stackoverflow.com/questions/45920612/creating-instance-for-adt-with-contravariant-divisible-and-decidable/45924032#45924032", "title": "Creating instance for ADT with Contravariant, Divisible, and Decidable", "body": "<p>I did it the hard way, without any of the instance, although some nesting of <code>choose</code> might have made it possible.</p>\n\n<pre><code>instance Grouping1 JSONTypeF where\n  grouping1 g = Group $ \\k -&gt; do\n    kb &lt;- flip getGroup\n    kc &lt;- flip getGroup\n    kd &lt;- flip getGroup\n    ke &lt;- flip getGroup\n    pure (\\obj -&gt;\n            case obj of\n              (JObject map) -&gt; kb map\n              (JArray ary) -&gt; kc ary\n              (JInvalidArray ary) -&gt; kd ary\n              (JPrimitive primitive) -&gt; ke primitive\n            ) k\n</code></pre>\n"}], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 45924032, "answer_count": 1, "score": 1, "last_activity_date": 1503939703, "creation_date": 1503928088, "question_id": 45920612, "link": "https://stackoverflow.com/questions/45920612/creating-instance-for-adt-with-contravariant-divisible-and-decidable", "title": "Creating instance for ADT with Contravariant, Divisible, and Decidable", "body": "<p>I'm trying to create an instance for <a href=\"https://hackage.haskell.org/package/discrimination-0.2.1/docs/Data-Discrimination-Grouping.html\" rel=\"nofollow noreferrer\"><code>Grouping1</code></a></p>\n\n<pre><code>import Data.Discrimination\nimport Data.Discrimination.Grouping (hashing)\nimport Data.Text (Text)\nimport Data.Vector (Vector)\nimport GHC.Generics\nimport GHC.Exts (toList, fromList)\nimport qualified Data.HashMap.Lazy as HashMap\n\ndata JSONPrimitive = JString | JNumber | JBool | JNull deriving (Show, Eq, Generic, Hashable, Grouping)\ndata JSONTypeF a =\n    JObject (HashMap.HashMap Text a)\n  | JArray (Maybe a)\n  | JInvalidArray (Vector a)\n  | JPrimitive JSONPrimitive\n  deriving (Show, Eq, Functor, Generic)\n\ninstance (Grouping a, Eq a, Hashable a) =&gt; Grouping1 (HashMap.HashMap a) where\n  grouping1 g = contramap toList $ grouping1 (divide id grouping g)\ninstance Grouping1 Vector where\n  grouping1 g = contramap toList (grouping1 g)\ninstance Grouping Text where\n  grouping = hashing\n</code></pre>\n\n<p>However, I'm not sure how to define the instance <code>Grouping1 JSONTypeF</code> for the <code>JSONTypeF</code> ADT.</p>\n\n<pre><code>instance Grouping1 JSONTypeF where\n  grouping1 g = contramap fun _\n    where\n      fun (JObject map) = undefined\n      fun (JArray ary) = undefined\n      fun (JInvalidArray ary) = undefined\n      fun (JPrimitive primitive) = undefined\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1503928780, "post_id": 45920615, "comment_id": 78800214, "body": "cool- thank you for your help! could you maybe show me how that would look like? I&#39;m still really new to haskell"}, {"owner": {"reputation": 3088, "user_id": 2008899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc08db690c45406131e861e766b252c?s=128&d=identicon&r=PG", "display_name": "Boyd Stephen Smith Jr.", "link": "https://stackoverflow.com/users/2008899/boyd-stephen-smith-jr"}, "edited": false, "score": 0, "creation_date": 1503930300, "post_id": 45920615, "comment_id": 78801307, "body": "I thought <code>&lt;&gt;</code> got moved to Semigroup?"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 5, "last_activity_date": 1503928091, "creation_date": 1503928091, "answer_id": 45920615, "question_id": 45920385, "link": "https://stackoverflow.com/questions/45920385/haskell-couldnt-match-type-char-with-text/45920615#45920615", "title": "Haskell: Couldn&#39;t match type \u2018[Char]\u2019 with \u2018Text\u2019", "body": "<p>To convert from a <code>String</code> (which is what <code>FilePath</code> is) to a <code>Text</code> you need to explicitly use <code>pack</code>: a type annotation alone won't do.</p>\n\n<p>You will also need to use <code>append</code> (or <code>Monoid</code>'s <code>(&lt;&gt;)</code>) instead of <code>(++)</code> which is list specific.</p>\n"}, {"comments": [{"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1503931550, "post_id": 45921323, "comment_id": 78802120, "body": "man might have that fixed it- but now I&#39;m getting an error that this line <code>then (readable &lt;$&gt; getPermissions path)</code> in the function of the OP, is <code>Variable not in scope</code> :/"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1503944116, "post_id": 45921323, "comment_id": 78808703, "body": "You were already getting it (look at your screenshot) and the error message tells you exactly what you need to do: add it to the import list of <code>System.Directory</code>."}], "tags": [], "owner": {"reputation": 3088, "user_id": 2008899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc08db690c45406131e861e766b252c?s=128&d=identicon&r=PG", "display_name": "Boyd Stephen Smith Jr.", "link": "https://stackoverflow.com/users/2008899/boyd-stephen-smith-jr"}, "is_accepted": false, "score": 2, "last_activity_date": 1503930264, "creation_date": 1503930264, "answer_id": 45921323, "question_id": 45920385, "link": "https://stackoverflow.com/questions/45920385/haskell-couldnt-match-type-char-with-text/45921323#45921323", "title": "Haskell: Couldn&#39;t match type \u2018[Char]\u2019 with \u2018Text\u2019", "body": "<pre><code>when (not pathChecksOut) .\n    errorL' . T.pack $ \"Failed to access file at : \" ++ passPath\n</code></pre>\n\n<p>As the error message says, \"the first argument of <code>errorL'</code>\" is \"Expected type:  <code>Text</code>\", but you have passed an \"Actual type: <code>FilePath</code>\".  In this particular case, you want to convert, so you hoogle for <code>FilePath -&gt; Text</code> and if that doesn't find what you want you remember that <code>FilePath</code> is a type alias and hoogle for <code>String -&gt; Text</code> also.</p>\n"}], "owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1269, "favorite_count": 1, "accepted_answer_id": 45920615, "answer_count": 2, "score": 2, "last_activity_date": 1503930264, "creation_date": 1503927348, "question_id": 45920385, "link": "https://stackoverflow.com/questions/45920385/haskell-couldnt-match-type-char-with-text", "title": "Haskell: Couldn&#39;t match type \u2018[Char]\u2019 with \u2018Text\u2019", "body": "<p>For some reason- <em>which I'm hoping to find out by virtue of asking this question</em>- having recently implemented a cadre of updates to a haskell script, including the addition of: </p>\n\n<pre><code>import System.Directory (doesFileExist, removeFile,getPermissions)\n</code></pre>\n\n<p>which serves to facilitate the following function:</p>\n\n<pre><code>validFile :: FilePath -&gt; IO Bool\nvalidFile path = do\n    exists &lt;- (doesFileExist path)\n    if exists\n    then (readable &lt;$&gt; getPermissions path)\n    else return False\n</code></pre>\n\n<p>invoked as: </p>\n\n<pre><code>pwds &lt;- case cfgPasswords of\n    Just passPath -&gt; do\n         pathChecksOut &lt;- validFile passPath\n         when (not pathChecksOut) $ \n             errorL' (\"Failed to access file at : \" ++ passPath)\n         (map (Just . T.unpack) . lines) &lt;$&gt; readFileUtf8 passPath\n    Nothing       -&gt; return $ replicate (length cfgPublicKeys) Nothing\n</code></pre>\n\n<p>I'm not able to anymore build the project on my machine. </p>\n\n<p>The error I got was <code>Couldn't match type \u2018[Char]\u2019 with \u2018Text\u2019</code>, and it pointed me to the following line: </p>\n\n<p><code>errorL' (\"Failed to access file at : \" ++ passPath)</code></p>\n\n<p>It seems there's a question about StackOverflow that tries to address a similar issue, <a href=\"https://stackoverflow.com/questions/37894987/couldnt-match-expected-type-text-with-actual-type-char\">this one</a>. In an attempt to follow that advice I adapted the line like so <code>errorL' (\"Failed to access file at : \" ++ (passPath :: Text))</code>, but still I wan't able to build the project. </p>\n\n<p>The exact console output I received after implementing the changes you recommend in your last post looks like this: </p>\n\n<p><a href=\"https://i.stack.imgur.com/QrwX8.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QrwX8.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>The full file and the progress of adding this feature (rather <em>bug</em>!) is well encapsulated in <a href=\"https://gist.github.com/s-matthew-english/41e18c23d34009bd7b69ed925b4ed2d8\" rel=\"nofollow noreferrer\">this gist file</a>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1420, "user_id": 238650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QZGrg.jpg?s=128&g=1", "display_name": "Maciej Jureczko", "link": "https://stackoverflow.com/users/238650/maciej-jureczko"}, "edited": false, "score": 2, "creation_date": 1503925714, "post_id": 45919726, "comment_id": 78798001, "body": "Welcome to SO. Well then, if you don&#39;t want others to think you want the answer handed to you, please show the attempts you have already made."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1503925791, "post_id": 45919726, "comment_id": 78798056, "body": "&quot;I have tried ..&quot; - it is entirely appropriate and encouraged to include in your answer the literal code you have tried to compile and run (this includes multiple pieces of code), as well as the error which that code gave you."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 5, "creation_date": 1503925987, "post_id": 45919726, "comment_id": 78798197, "body": "What is <code>Matrix</code>?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1503926336, "post_id": 45919726, "comment_id": 78798456, "body": "<code>(== True)</code> is <code>id</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 1, "last_activity_date": 1503976739, "creation_date": 1503976739, "answer_id": 45930185, "question_id": 45919726, "link": "https://stackoverflow.com/questions/45919726/finding-the-number-of-elements-in-a-matrix/45930185#45930185", "title": "Finding the number of elements in a matrix", "body": "<p><strong>tl;dr</strong> You want something to the effect of <code>filter someCondition (toList matrix) == otherList</code>, with minor details varying depending on your matrix type and your specific needs.</p>\n\n<h1>The Full Answer</h1>\n\n<p>I don't know what <code>Matrix</code> type you're using, but the approach is going to be similar for any reasonably defined matrix type.</p>\n\n<p>For this answer, I'll assume you're using the <a href=\"https://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html\" rel=\"nofollow noreferrer\"><code>Data.Matrix</code></a> class from the package on Hackage called <code>matrix</code>.</p>\n\n<p>You are right to think you should use <code>filter</code>. Thinking functionally, you want to eliminate some elements from the matrix and keep others, based on a condition. However, a matrix does not provide a natural way to perform <code>filter</code> on it, as the idea is not really well-defined. So, instead, we want to extract the elements from our matrix into a list first. The <code>matrix</code> package provides the following function, which does just that.</p>\n\n<pre><code>toList :: Matrix a -&gt; [a]\n</code></pre>\n\n<p>Once you have a list representation, you can very easily use <code>filter</code> to get the elements that you want.</p>\n\n<p>A few caveats and notes.</p>\n\n<ul>\n<li>If the matrix package that you're using doesn't define <code>toList</code> itself, check if it defines a <code>Foldable</code> instance for the matrix type. If it does, then <code>Data.Foldable</code> has a general-purpose <code>toList</code> that works for all <code>Foldable</code> types.</li>\n<li>Be careful with the ordering here. It's not entirely clear what <em>order</em> the elements should be put into the list in, since matrices are two-dimensional and lists are inherently one-dimensional. If the ordering matters for whatever you're doing, you might have to put some additional effort into guaranteeing the desired order. If it does not matter, consider using <code>Data.Set</code> or some other unordered collection instead of lists.</li>\n<li>I don't see any constraints in your <code>checkMatrix</code> implementation. Remember that comparing elements of lists adds an <code>Eq a</code> constraint, and if you want to use an unordered collection then that's going to add <code>Ord a</code> instead.</li>\n</ul>\n"}], "owner": {"reputation": 11, "user_id": 8527445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81720e1b490e37c89d32d817818cc3e?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Blake", "link": "https://stackoverflow.com/users/8527445/tom-blake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503976739, "creation_date": 1503925319, "last_edit_date": 1503926444, "question_id": 45919726, "link": "https://stackoverflow.com/questions/45919726/finding-the-number-of-elements-in-a-matrix", "title": "Finding the number of elements in a matrix", "body": "<p>I'm a Haskell newcomer, so cut me a bit of slack  :P</p>\n\n<p>I need to write a Haskell function that goes through a matrix and outputs a list of all matching elements to a given element (like using filter) and then matches the list against another to check if they are the same.</p>\n\n<pre><code>checkMatrix :: Matrix a -&gt; a -&gt; [a] -&gt; Bool \n</code></pre>\n\n<p>I have tried variations of using filter, and using the !! operator and I can't figure it out. I don't really want to get the answer handed to me, just need some pointers for getting me on the right path</p>\n\n<pre><code>checkMatrix :: Matrix a -&gt; a -&gt; [a] -&gt; Bool \ncheckMatrix matr a lst = case matr of\n    x:xs | [] -&gt; (i don't really know what to put for the base case)\n         | filter (== True) (x:xs !! 0) -&gt; checkMatrix xs a lst\n</code></pre>\n\n<p>Thats all i got, I'm really very lost as to what to do next</p>\n"}, {"tags": ["haskell", "reactive-programming", "frp", "reactive-banana"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503926149, "post_id": 45918288, "comment_id": 78798319, "body": "This looks a lot like a recommendation for a resource (off-topic). Perhaps rephrase as &quot;does &lt;specific author&gt; recognize these FRP concepts?&quot; or &quot;here is my understanding of the semantics of Latch and Pulse - is this understanding correct?&quot;"}, {"owner": {"reputation": 3743, "user_id": 1107253, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b5217974ee6f5a6994b5c680168c07b1?s=128&d=identicon&r=PG", "display_name": "MitchellSalad", "link": "https://stackoverflow.com/users/1107253/mitchellsalad"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503936831, "post_id": 45918288, "comment_id": 78805127, "body": "@user2407038 Thanks, I didn&#39;t know recommendations for resources are off-topic. I tried to clarify the question by giving some more context."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1503945466, "post_id": 45918288, "comment_id": 78809376, "body": "&quot;<a href=\"https://github.com/HeinrichApfelmus/reactive-banana/blob/master/reactive-banana/src/Reactive/Banana/Prim.hs\" rel=\"nofollow noreferrer\">Reactive.Banana.Prim</a> - The efficient push-driven implementation used for production code. Contains hard to understand trade secrets. ;-)&quot;. Here&#39;s to hoping <a href=\"https://stackoverflow.com/users/403805/heinrich-apfelmus\">@heinrich-apfelmus</a> can elaborate more here."}], "answers": [{"tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": true, "score": 4, "last_activity_date": 1504004865, "creation_date": 1504004865, "answer_id": 45937580, "question_id": 45918288, "link": "https://stackoverflow.com/questions/45918288/what-are-latch-and-pulse-in-reactive-banana/45937580#45937580", "title": "What are &#39;Latch&#39; and &#39;Pulse&#39; in reactive-banana?", "body": "<p>Heinrich here. The <code>Pulse</code> and <code>Latch</code> types are probably best seen as \"lemmas\" that I came up with that are very useful for implementing the <code>Event</code> and <code>Behavior</code> type. I'm sure that they will prove useful when trying to justify the implementation more formally, but this is a formidable research project, and I have not found the time or resources to do so.</p>\n\n<p>The type <code>Pulse</code> is almost the same as <code>Event</code>, except that all functions are required to have a monadic type, e.g.</p>\n\n<pre><code>mapP :: (a \u2192 b) \u2192 Pulse a \u2192 Build (Pulse b)\n-- vs\nmapE :: (a \u2192 b) \u2192 Event a \u2192 Event b\n</code></pre>\n\n<p>The <code>Event</code> type is implemented by getting rid of the <code>Build</code> monad via black magic (= observable sharing). The name <code>Build</code> sounds like it's a utility monad, which it is if you look at the code, but this monad is also fundamental, because it has a semantic interpretation as \"moment of time\", and it's not obvious why you can remove it sometimes, and sometimes not.</p>\n\n<p>The type <code>Latch</code> is also very similar to <code>Behavior</code>, except that the latter also includes an <code>Event</code> for pragmatic reasons. Similar considerations apply concerning the <code>Build</code> monad.</p>\n\n<p>I hope this answers more questions than it raises. \ud83d\ude04 Sorry that I couldn't go into more detail as for the inner workings of reactive-banana, that would be beyond the scope of a StackOverflow answer.</p>\n"}], "owner": {"reputation": 3743, "user_id": 1107253, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b5217974ee6f5a6994b5c680168c07b1?s=128&d=identicon&r=PG", "display_name": "MitchellSalad", "link": "https://stackoverflow.com/users/1107253/mitchellsalad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 45937580, "answer_count": 1, "score": 2, "last_activity_date": 1504004865, "creation_date": 1503921001, "last_edit_date": 1503936798, "question_id": 45918288, "link": "https://stackoverflow.com/questions/45918288/what-are-latch-and-pulse-in-reactive-banana", "title": "What are &#39;Latch&#39; and &#39;Pulse&#39; in reactive-banana?", "body": "<p>Do the <a href=\"https://hackage.haskell.org/package/reactive-banana-1.1.0.1/docs/Reactive-Banana-Prim.html#g:8\" rel=\"nofollow noreferrer\">Latch</a> and <a href=\"https://hackage.haskell.org/package/reactive-banana-1.1.0.1/docs/Reactive-Banana-Prim.html#g:7\" rel=\"nofollow noreferrer\">Pulse</a> types exist in FRP literature, or are they an invention of the author of reactive-banana?</p>\n\n<p>Just looking at the types, they roughly correspond to Behavior and Event (respectively), but I'd like to know what the difference is, and whether their implementation is based on any formal research.</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1503916759, "post_id": 45917027, "comment_id": 78792438, "body": "&quot;not executing&quot; Please tell us what you&#39;re seeing, not what you&#39;re not seeing. If there&#39;s an error, post it."}, {"owner": {"reputation": 31, "user_id": 8526875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4979802c270ef37debfdb17feb06de57?s=128&d=identicon&r=PG&f=1", "display_name": "Harshit", "link": "https://stackoverflow.com/users/8526875/harshit"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503916844, "post_id": 45917027, "comment_id": 78792493, "body": "parse error on input &#39;|&#39;"}, {"owner": {"reputation": 31, "user_id": 8526875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4979802c270ef37debfdb17feb06de57?s=128&d=identicon&r=PG&f=1", "display_name": "Harshit", "link": "https://stackoverflow.com/users/8526875/harshit"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503916865, "post_id": 45917027, "comment_id": 78792506, "body": "I have ensured proper indentation just like in the above code"}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 2, "creation_date": 1503916988, "post_id": 45917027, "comment_id": 78792574, "body": "Yep, I get that parse error too. A quick comparison to <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">learnyouahaskell.com/syntax-in-functions</a> would suggest that the line before the pattern guards should not end with <code>=</code>."}, {"owner": {"reputation": 31, "user_id": 8526875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4979802c270ef37debfdb17feb06de57?s=128&d=identicon&r=PG&f=1", "display_name": "Harshit", "link": "https://stackoverflow.com/users/8526875/harshit"}, "reply_to_user": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1503917236, "post_id": 45917027, "comment_id": 78792731, "body": "@YannVernier : Such a silly mistake by my side. You were right. Removing &quot;=&quot; did the trick. Thankyou"}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1503944259, "post_id": 45917153, "comment_id": 78808787, "body": "It&#39;s still not ideal because unless haskell does some magic common expression elimination it&#39;s going to be exponential (<code>maximum xs</code> is called twice!)."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1503945778, "post_id": 45917153, "comment_id": 78809513, "body": "Crap. Somehow I didn&#39;t see it. My bad."}, {"owner": {"reputation": 205, "user_id": 10885908, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WfB8mwtOBNU/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcb9IPNC8Zs0heMA30HQ9qjIpHWceA/mo/photo.jpg?sz=128", "display_name": "13sen1", "link": "https://stackoverflow.com/users/10885908/13sen1"}, "edited": false, "score": 0, "creation_date": 1605545228, "post_id": 45917153, "comment_id": 114676476, "body": "if you factored it out, would that solve the problem? i.e. if you add <code>where myMax = maximum xs</code> at the bottom, then replace both the <code>maximum xs</code> with the new variable <code>myMax</code>. Made it much faster my side"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 205, "user_id": 10885908, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WfB8mwtOBNU/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcb9IPNC8Zs0heMA30HQ9qjIpHWceA/mo/photo.jpg?sz=128", "display_name": "13sen1", "link": "https://stackoverflow.com/users/10885908/13sen1"}, "edited": false, "score": 0, "creation_date": 1605548922, "post_id": 45917153, "comment_id": 114678056, "body": "@13sen1 Yes it should speed things up."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 4, "last_activity_date": 1503917018, "creation_date": 1503917018, "answer_id": 45917153, "question_id": 45917027, "link": "https://stackoverflow.com/questions/45917027/haskell-max-number-in-a-list/45917153#45917153", "title": "Haskell - Max number in a list", "body": "<p>You have an extra <code>=</code> before the first <code>|</code>.</p>\n\n<pre><code>maximum (x:xs) | (maximum xs) &gt; x = maximum xs\n               | otherwise        = x\n</code></pre>\n\n<p>Note that you compute <code>maximum xs</code> twice which will probably make your code run <strong>very</strong> slowly. </p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503945522, "post_id": 45917165, "comment_id": 78809392, "body": "It&#39;s perfectly commonplace to define functions whose names conflict with standard or even Prelude ones. Just <code>import Prelude hiding (maximum)</code>."}, {"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503989853, "post_id": 45917165, "comment_id": 78823269, "body": "Yes of course - just trying to reduce potential for confusion for those new to Haskell."}], "tags": [], "owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "is_accepted": false, "score": 0, "last_activity_date": 1503917065, "creation_date": 1503917065, "answer_id": 45917165, "question_id": 45917027, "link": "https://stackoverflow.com/questions/45917027/haskell-max-number-in-a-list/45917165#45917165", "title": "Haskell - Max number in a list", "body": "<p>Firstly there is a syntax error, you need to remove the <code>=</code> after <code>maximum (x:xs)</code>.</p>\n\n<p>Secondly, the function <code>maximum</code> conflicts with <code>Main.maximum</code>, I suggest you rename it, for example:</p>\n\n<pre><code>maximum' :: [Int] -&gt; Int\nmaximum' [x] = x\nmaximum' (x:xs)\n | (maximum' xs) &gt; x = maximum' xs\n | otherwise = x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 6, "last_activity_date": 1503943515, "last_edit_date": 1503943515, "creation_date": 1503943007, "answer_id": 45924834, "question_id": 45917027, "link": "https://stackoverflow.com/questions/45917027/haskell-max-number-in-a-list/45924834#45924834", "title": "Haskell - Max number in a list", "body": "<p>You should remove the <code>=</code> before the wards block.\nNow, for making your function properly:</p>\n\n<p>You can <code>fold</code> the list:</p>\n\n<pre><code>maximum' :: Ord a =&gt; [a] -&gt; a\nmaximum' = foldr1 (\\x y -&gt;if x &gt;= y then x else y)\n</code></pre>\n\n<p>For the recursive version (no double checking):</p>\n\n<pre><code>maximum'' :: Ord a =&gt; [a] -&gt; a\nmaximum'' [x]       = x\nmaximum'' (x:x':xs) = maximum' ((if x &gt;= x' then x else x'):xs)\n</code></pre>\n\n<p>If you want wards:</p>\n\n<pre><code>maximum'' :: Ord a =&gt; [a] -&gt; a\nmaximum'' [x]       = x\nmaximum'' (x:x':xs) | x &gt;= x'   = maximum' (x:xs)\nmaximum'' (x:x':xs) | otherwise = maximum' (x':xs)\n</code></pre>\n\n<p>Here you have a <a href=\"https://repl.it/K3qe/1\" rel=\"noreferrer\">live example</a></p>\n"}], "owner": {"reputation": 31, "user_id": 8526875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4979802c270ef37debfdb17feb06de57?s=128&d=identicon&r=PG&f=1", "display_name": "Harshit", "link": "https://stackoverflow.com/users/8526875/harshit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25553, "favorite_count": 3, "answer_count": 3, "score": 3, "last_activity_date": 1503943515, "creation_date": 1503916535, "last_edit_date": 1503916627, "question_id": 45917027, "link": "https://stackoverflow.com/questions/45917027/haskell-max-number-in-a-list", "title": "Haskell - Max number in a list", "body": "<p>I want to find the maximum integral value in a list of integers. The following is my code -</p>\n\n<pre><code>maximum :: [Int] -&gt; Int\nmaximum [x] = x\nmaximum (x:xs) =\n | (maximum xs) &gt; x = maximum xs\n | otherwise = x\n</code></pre>\n\n<p>I do NOT want to use the in-built function max. So, I have NOT used :\nmaximum (x:xs) = max x (maximum xs) </p>\n\n<p>Why is the code not executing ?</p>\n"}, {"tags": ["haskell", "monads", "free-monad", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503914807, "post_id": 45916299, "comment_id": 78791281, "body": "Try to compare that to the plain recursive type definition <code>data ToyR b = OutputR b (ToyR b) | BellR (ToyR b) | DoneR</code>. You&#39;ll find that they have the same values, except that the <code>Fix</code> variant has an additional <code>Fix</code> constructor after each <code>Toy</code> constructor. This is needed to fold the type from <code>Toy b (Fix (Toy b))</code> to <code>Fix (Toy b)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1614076518, "post_id": 45916939, "comment_id": 117268007, "body": "So how does an object of type <code>Cons a Int</code> ever get created, if all I have is a <code>Fix (Cons a)</code> and a function (<code>getLength</code>) <code>Cons a int -&gt; Int</code>? The only way I can get an <code>Int</code> from anything else is by using the <code>getLength</code> function, but for that, I already need a <code>Cons a Int</code>, which I don&#39;t have (I only have a <code>Fix (Cons a)</code>)."}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1614077235, "post_id": 45916939, "comment_id": 117268365, "body": "I get that if I have a <code>Nil</code> of ANY type, I can produce an <code>Int</code> 0, so in particular I could take a <code>Fix (Cons a)</code> and produce an <code>Int</code> if the value happens to be <code>Nil</code>. However, <code>getLength</code> is defined only for an input of type <code>Cons a Int</code>, even though <code>Nil</code> happens to be valid value for this type as well."}, {"owner": {"reputation": 731, "user_id": 3616714, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/sE5BR.png?s=128&g=1", "display_name": "domin", "link": "https://stackoverflow.com/users/3616714/domin"}, "edited": false, "score": 0, "creation_date": 1614086211, "post_id": 45916939, "comment_id": 117272243, "body": "Never mind, I found the answer by studying this post: <a href=\"https://medium.com/@olxc/catamorphisms-and-f-algebras-b4e91380d134\" rel=\"nofollow noreferrer\">medium.com/@olxc/catamorphisms-and-f-algebras-b4e91380d134</a>.  Essentially, I forgot about <code>fmap</code>. Given our <code>length</code> function (<code>Fix (Cons a) -&gt; Int</code>), it constructs a lifted function with type <code>Cons (Fix (Cons a)) -&gt; Cons a Int</code>, so the magic happens there, where a <code>Nil</code> of type <code>Fix (Cons a)</code> gets &quot;mapped&quot; to a <code>Nil</code> of type <code>Cons a Int</code> by essentially doing nothing. :)"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 20, "last_activity_date": 1503935299, "last_edit_date": 1503935299, "creation_date": 1503916214, "answer_id": 45916939, "question_id": 45916299, "link": "https://stackoverflow.com/questions/45916299/understanding-the-fix-datatype-in-haskell/45916939#45916939", "title": "Understanding the Fix datatype in Haskell", "body": "<p>I'll make a more familiar, simpler type using <code>Fix</code> to see if you'll understand it.</p>\n\n<p>Here's the list type in a normal recursive definition:</p>\n\n<pre><code>data List a = Nil | Cons a (List a)\n</code></pre>\n\n<p>Now, thinking back at how we use <code>fix</code> for functions, we know that we have to pass the function to itself as an argument. In fact, since <code>List</code> is recursive, we can write a simpler nonrecursive datatype like so:</p>\n\n<pre><code>data Cons a recur = Nil | Cons a recur\n</code></pre>\n\n<p>Can you see how this is similar to, say, the function <code>f a recur = 1 + recur a</code>? In the same way that <code>fix</code> would pass <code>f</code> as an argument to itself, <code>Fix</code> passes <code>Cons</code> as an argument to itself. Let's inspect the definitions of <code>fix</code> and <code>Fix</code> side-by-side:</p>\n\n<pre><code>fix :: (p -&gt; p) -&gt; p\nfix f = f (fix f)\n\n-- Fix :: (* -&gt; *) -&gt; *\nnewtype Fix f = Fix {nextFix :: f (Fix f)}\n</code></pre>\n\n<p>If you ignore the fluff of the constructor names and so on, you'll see that these are essentially exactly the same definition!</p>\n\n<hr>\n\n<p>For the example of the <code>Toy</code> datatype, one could just define it recursively like so:</p>\n\n<pre><code>data Toy a = Output a (Toy a) | Bell (Toy a) | Done\n</code></pre>\n\n<p>However, we could use <code>Fix</code> to pass itself into itself, replacing all instances of <code>Toy a</code> with a second type parameter:</p>\n\n<pre><code>data ToyStep a recur = OutputS a recur | BellS recur | DoneS\n</code></pre>\n\n<p>so, we can then just use <code>Fix (ToyStep a)</code>, which will be equivalent to <code>Toy a</code>, albeit in a different form. In fact, let's demonstrate them to be equivalent:</p>\n\n<pre><code>toyToStep :: Toy a -&gt; Fix (ToyStep a)\ntoyToStep (Output a next) = Fix (OutputS a (toyToStep next))\ntoyToStep (Bell next) = Fix (BellS (toyToStep next))\ntoyToStep Done = Fix DoneS\n\nstepToToy :: Fix (ToyStep a) -&gt; Toy a\nstepToToy (Fix (OutputS a next)) = Output a (stepToToy next)\nstepToToy (Fix (BellS next)) = Bell (stepToToy next)\nstepToToy (Fix (DoneS)) = DoneS\n</code></pre>\n\n<hr>\n\n<p>You might be wondering, \"Why do this?\" Well usually, there's not much reason to do this. However, defining these sort of simplified versions of datatypes actually allow you to make quite expressive functions. Here's an example:</p>\n\n<pre><code>unwrap :: Functor f =&gt; (f k -&gt; k) -&gt; Fix f -&gt; k\nunwrap f n = f (fmap (unwrap f) n)\n</code></pre>\n\n<p>This is really an incredible function! It surprised me when I first saw it! Here's an example using the <code>Cons</code> datatype we made earlier, assuming we made a <code>Functor</code> instance:</p>\n\n<pre><code>getLength :: Cons a Int -&gt; Int\ngetLength Nil = 0\ngetLength (Cons _ len) = len + 1\n\nlength :: Fix (Cons a) -&gt; Int\nlength = unwrap getLength\n</code></pre>\n\n<p>This essentially is <code>fix</code> for free, given that we use <code>Fix</code> on whatever datatype we use!</p>\n\n<p>Let's now imagine a function, given that <code>ToyStep a</code> is a functor instance, that simply collects all the <code>OutputS</code>s into a list, like so:</p>\n\n<pre><code>getOutputs :: ToyStep a [a] -&gt; [a]\ngetOutputs (OutputS a as) = a : as\ngetOutputs (BellS as) = as\ngetOutputs DoneS = []\n\noutputs :: Fix (ToyStep a) -&gt; [a]\noutputs = unwrap getOutputs\n</code></pre>\n\n<p>This is the power of using <code>Fix</code> rather than having your own datatype: generality.</p>\n"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1598, "favorite_count": 0, "accepted_answer_id": 45916939, "answer_count": 1, "score": 9, "last_activity_date": 1563167749, "creation_date": 1503914136, "last_edit_date": 1563167749, "question_id": 45916299, "link": "https://stackoverflow.com/questions/45916299/understanding-the-fix-datatype-in-haskell", "title": "Understanding the Fix datatype in Haskell", "body": "<p>In <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"noreferrer\">this article</a> about the Free Monads in Haskell we are given a Toy datatype defined by:</p>\n\n<pre><code>data Toy b next =\n    Output b next\n  | Bell next\n  | Done\n</code></pre>\n\n<p>Fix is defined as follows:</p>\n\n<pre><code>data Fix f = Fix (f (Fix f))\n</code></pre>\n\n<p>Which allows to nest Toy expressions by preserving a common type:</p>\n\n<pre><code>Fix (Output 'A' (Fix Done))              :: Fix (Toy Char)\nFix (Bell (Fix (Output 'A' (Fix Done)))) :: Fix (Toy Char)\n</code></pre>\n\n<p>I understand how fixed points work for regular functions but I'm failing to see how the types are reduced in here. Which are the steps the compiler follows to evaluate the type of the expressions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503911171, "post_id": 45915145, "comment_id": 78789145, "body": "You plan to conjure up your six Doubles out of what? And why six and not forty two?"}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503911518, "post_id": 45915145, "comment_id": 78789349, "body": "It is a set of coordinates (id, x, y, z). Thus I would like to extract the min and max for each x, y and z and put it into a value of 6."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503911965, "post_id": 45915145, "comment_id": 78789592, "body": "How should the compiler know it&#39;s a set of coordinates and not a set of, say, strings? It cannot read your mind. You use types to convey this information. What is the type of your coordinates value?"}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503912170, "post_id": 45915145, "comment_id": 78789724, "body": "The type for the coordinates is (Int, Double, Double, Double)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503912345, "post_id": 45915145, "comment_id": 78789817, "body": "So use it to define your function."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503912476, "post_id": 45915145, "comment_id": 78789889, "body": "Another problem of your definition is that your function will only ever work with a list with exactly one element (this is what <code>[(_, x, y, z)]</code> matches). So you need to change that."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503912659, "post_id": 45915145, "comment_id": 78789972, "body": "Tried and errors &quot;Couldnt match expected type  t0 double with actual type double&quot;. It happened at all minimum x, maximum x, minimum y, ......"}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1503913539, "post_id": 45915921, "comment_id": 78790517, "body": "Yes!! This is it. I like the way you explaining it. Steps shown according to the flow. Thanks!!!"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1503913879, "post_id": 45915921, "comment_id": 78790741, "body": "It&#39;s worth to say that this task can be solved for the constant memory space (in contrast to this)."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1503916930, "post_id": 45915921, "comment_id": 78792539, "body": "Can you elaborate (like you did previously) on how you define function minmax? Its hard for me to digest it. Sorry.  I&#39;ve tried to compile it but errors with max b h."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1503991186, "post_id": 45915921, "comment_id": 78824038, "body": "Thanks for the update. I got this message, Illegal bang-pattern (use bang patterns) : ! a. Did I missed some setting?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1503991988, "post_id": 45915921, "comment_id": 78824532, "body": "@SirDK: did you add the `{-# LANGUAGE ... #-} part at the top of the file?"}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1503993118, "post_id": 45915921, "comment_id": 78825254, "body": "@WillemVanOnsem When I did that, it goes back to the previous error: the function max is applied to two arguments, but its type Int has none."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1503996609, "post_id": 45915921, "comment_id": 78827320, "body": "@SirDK: I tested it locally. What happens if you use an empty file and put the last two code fragments in it?"}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1503998196, "post_id": 45915921, "comment_id": 78828321, "body": "@WillemVanOnsem I tried to create new file and build it in Leksah, but the error still there. I&#39;m not sure why and wondering. I&#39;m pretty sure that using min and max is better than maximum and minimum for large data sets."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1503954904, "last_edit_date": 1503954904, "creation_date": 1503912901, "answer_id": 45915921, "question_id": 45915145, "link": "https://stackoverflow.com/questions/45915145/haskell-finding-min-and-max-for-a-set-of-tuple/45915921#45915921", "title": "Haskell :: Finding Min and Max for a set of Tuple", "body": "<h1>First attempt</h1>\n\n<p>First of all, your current pattern:</p>\n\n<pre><code>fFindMinMax [(_, x, y, z)] = ...\n</code></pre>\n\n<p>means that it will only work if you pass a list with <em>one</em> element. So from the moment you pass an empty list, or a list with two or more elements, this will fail.</p>\n\n<p>What you need is a <code>map</code> to obtain all the second/third/fourth elements of the tuples. We can do this with:</p>\n\n<pre><code>fFindMinMax cs = ...\n    where cSnd = map (\\(_,x,_,_) -&gt; x) cs\n          cThr = map (\\(_,_,y,_) -&gt; y) cs\n          cFou = map (\\(_,_,_,z) -&gt; z) cs\n</code></pre>\n\n<p>So now the question is: <em>what</em> should we write as function predicate. You actually already made an attempt there that works: we can calculate the <code>minimum cSnd</code> and <code>maximum cSnd</code> and so on for every coordinate. So:</p>\n\n<pre><code>fFindMinMax cs = (minimum cSnd, maximum cSnd, minimum cThr, maximum cThr, minimum cFou, maximum cFou)\n    where cSnd = map (\\(_,x,_,_) -&gt; x) cs\n          cThr = map (\\(_,_,y,_) -&gt; y) cs\n          cFou = map (\\(_,_,_,z) -&gt; z) cs\n</code></pre>\n\n<p>Now what is the type of the function? We do not have to restrict us to <code>Double</code>, nor do we have to make sure that all coordinates have the same type, the type signature of <code>fFindMinMax</code> can be:</p>\n\n<pre><code><b>fFindMinMax :: (Ord x, Ord y, Ord z) =&gt; [(a, x, y, z)] -&gt; (x, x, y, y, z, z)</b>\nfFindMinMax cs = (minimum cSnd, maximum cSnd, minimum cThr, maximum cThr, minimum cFou, maximum cFou)\n    where cSnd = map (\\(_,x,_,_) -&gt; x) cs\n          cThr = map (\\(_,_,y,_) -&gt; y) cs\n          cFou = map (\\(_,_,_,z) -&gt; z) cs</code></pre>\n\n<p>Note that this program will error if you give it an empty list, since the <code>minimum</code> or <code>maximum</code> of an empty list is not defined.</p>\n\n<h1>Improve memory consumption</h1>\n\n<p>A problem with the above solution is that we construct lists with the second, third and fourth element. Since we do not calculate the minimum and maximum at the same time, this means that we will end up storing this lists into memory.</p>\n\n<p>We can improve the code by writing a helper function that calculates the <code>minimum</code> and the <code>maximum</code> concurrently for the same list:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nminmax :: Ord a =&gt; [a] -&gt; (a,a)\nminmax [] = error \"Empty list\"\nminmax (h:t) = minmax' h h t\n    where minmax' a b [] = (a,b)\n          minmax' !a !b (c:cs) = minmax' (min a c) (max b c) cs\n</code></pre>\n\n<p>How does this function works? Well the first line is rather straightforward: in case we are given an empty list, we can not calculate the minimum or the maximum, so we raise an error <em>Empty list</em>. In the latter case that list has a first item <code>h</code> and the rest of the items <code>t</code>. We consider <code>h</code> to be the thus far obtained minimum and maximum: if a list contains a single element, then that element is both the minimum and the maximum of that list. So we call an extra function <code>minmax' :: Ord a =&gt; a -&gt; a -&gt; [a] -&gt; a</code> that calculates the minimum and maximum by giving it the minimum and maximum obtained thus far (<code>h</code> and <code>h</code>) and the remaining of the list.</p>\n\n<p>Each iteration, it will take the next element <code>c</code> and calculate the minimum by calculated <code>min</code> with the thus far minimum <code>a</code> and the next element <code>c</code>, and calculate the maximum with the thus far maximum <code>b</code> and the next element <code>c</code>. We keep iterative doing this until we reach the end of the list. In that case the thus far obtained minimum and maximum are the final minimum and maximum. So we can return them as <code>(a,b)</code>.</p>\n\n<p>Then we can use the function like:</p>\n\n<pre><code>fFindMinMax :: (Ord x, Ord y, Ord z) =&gt; [(a, x, y, z)] -&gt; (x, x, y, y, z, z)\nfFindMinMax cs = (xmi, xma, ymi, yma, zmi, zma)\n    where (xmi, xma) = <b>minmax $</b> map (\\(_,x,_,_) -&gt; x) cs\n          (ymi, yma) = <b>minmax $</b> map (\\(_,_,y,_) -&gt; y) cs\n          (zmi, zma) = <b>minmax $</b> map (\\(_,_,_,z) -&gt; z) cs</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 1, "last_activity_date": 1503916661, "creation_date": 1503916661, "answer_id": 45917047, "question_id": 45915145, "link": "https://stackoverflow.com/questions/45915145/haskell-finding-min-and-max-for-a-set-of-tuple/45917047#45917047", "title": "Haskell :: Finding Min and Max for a set of Tuple", "body": "<h1>Constant space solution</h1>\n\n<pre><code>fFindMinMax :: (Ord x, Ord y, Ord z) =&gt; [(a, x, y, z)] -&gt; (x, x, y, y, z, z)\nfFindMinMax ((_, x, y, z):rest) = foldl' minmax (x, x, y, y, z, z) rest\nfFindMinMax []                  = error \"fFindMinMax: empty list\"\n  where\n    (xMin', xMax', yMin', yMax', zMin', zMax') `minmax` (_, x, y, z) =\n        let\n          !xMin = min xMin' x\n          !xMax = max xMax' x\n          !yMin = min yMin' y\n          !yMax = max yMax' y\n          !zMin = min zMin' z\n          !zMax = max zMax' z\n        in (xMin, xMax, yMin, yMax, zMin, zMax)\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1872, "favorite_count": 0, "accepted_answer_id": 45915921, "answer_count": 2, "score": 2, "last_activity_date": 1503954904, "creation_date": 1503910308, "last_edit_date": 1503913000, "question_id": 45915145, "link": "https://stackoverflow.com/questions/45915145/haskell-finding-min-and-max-for-a-set-of-tuple", "title": "Haskell :: Finding Min and Max for a set of Tuple", "body": "<p>I've tried to find min and max for tuple. Here the code goes:</p>\n\n<pre><code>fFindMinMax :: (Ord a, Ord b, Ord c, Ord d) =&gt; [(a, b, c, d)] -&gt; (Double,Double,Double,Double,Double,Double)\nfFindMinMax [(_, x, y, z)] = (minimum x, maximum x, minimum y, maximum y, minimum z, maximum z)   \n</code></pre>\n\n<p>And the errors come for maximum x, maximum y and maximum z. </p>\n\n<blockquote>\n  <p>Couldnt match expected type t1 Double with actual type b. </p>\n</blockquote>\n\n<p>Can someone enlighten me?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1503905229, "post_id": 45912272, "comment_id": 78786039, "body": "Probably a consequence of the monomorphism restriction. Non function bindings like <code>x=4</code> are only given monomorphic types if not explicitly annotated. <a href=\"https://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\" title=\"what is the monomorphism restriction\">stackoverflow.com/questions/32496864/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 253, "user_id": 8423622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e0fd3c2609ac77126477434153dcb440?s=128&d=identicon&r=PG&f=1", "display_name": "johnson", "link": "https://stackoverflow.com/users/8423622/johnson"}, "edited": false, "score": 0, "creation_date": 1503900089, "post_id": 45912328, "comment_id": 78783691, "body": "That&#39;s interesting. I forgot about nNotes. Haskell infers the type of it to be <code>Int</code>. Why?"}, {"owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "reply_to_user": {"reputation": 253, "user_id": 8423622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e0fd3c2609ac77126477434153dcb440?s=128&d=identicon&r=PG&f=1", "display_name": "johnson", "link": "https://stackoverflow.com/users/8423622/johnson"}, "edited": false, "score": 0, "creation_date": 1503900679, "post_id": 45912328, "comment_id": 78783931, "body": "@johnson When I load the source file in ghci, it looks like it assumes nNotes is <code>Integer</code>. When you had something else of type <code>Int</code> in the code, the compiler probably realised nNotes had to be <code>Int</code>. My guess is that, unless contradicted, the compiler assumes integer literal definitions should be <code>Integer</code>. In which case it might be a bug with GHC if it can&#39;t automatically infer that you want nNotes to be of type <code>Integral a =&gt; a</code> (but I don&#39;t know much about compilers)."}], "tags": [], "owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "is_accepted": false, "score": 1, "last_activity_date": 1503898734, "creation_date": 1503898734, "answer_id": 45912328, "question_id": 45912272, "link": "https://stackoverflow.com/questions/45912272/haskell-type-specifier-issue-using-integral-and-int/45912328#45912328", "title": "Haskell type specifier issue using integral and int", "body": "<p>I believe the problem here is you have to also declare nNotes to be of type <code>nNotes :: Integral a =&gt; a</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1503905471, "creation_date": 1503905471, "answer_id": 45913854, "question_id": 45912272, "link": "https://stackoverflow.com/questions/45912272/haskell-type-specifier-issue-using-integral-and-int/45913854#45913854", "title": "Haskell type specifier issue using integral and int", "body": "<p>When you use a literal like <code>7</code>, GHC tries to guess which type you meant. You can reproduce this with a <code>.hs</code> file that (apart from a <code>module</code> declaration) contains only</p>\n\n<pre><code>nNotes = 7\n</code></pre>\n\n<p>This will give you the compiler warning:</p>\n\n<pre><code>* Defaulting the following constraint to type `Integer'\n    Num t0 arising from the literal `7'\n* In the expression: 7\n  In an equation for `nNotes': nNotes = 7\n</code></pre>\n\n<p>From there, the compiler will infer all the other types.</p>\n\n<p>You can generalise your code by explicitly annotate <code>nNotes</code> with a type, like this:</p>\n\n<pre><code>nNotes :: Num a =&gt; a\nnNotes = 7\n</code></pre>\n\n<p>Once you do that, your functions get these automatically inferred types:</p>\n\n<pre><code>\u03bb: :type pitchLimit\npitchLimit :: (Ord a, Num a) =&gt; a -&gt; Bool\n\u03bb: :type getOctave\ngetOctave :: Integral t =&gt; t -&gt; t\n</code></pre>\n\n<p>As you can see, <code>getOctave</code> can take any <code>Integral</code> as input, including both <code>Integer</code> and <code>Int</code>.</p>\n\n<p>The reason that <code>getOctave</code> infers <code>t</code> to be of the class <code>Integral</code> is because <code>div</code> is defined for <code>Integral</code>.</p>\n"}], "owner": {"reputation": 253, "user_id": 8423622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e0fd3c2609ac77126477434153dcb440?s=128&d=identicon&r=PG&f=1", "display_name": "johnson", "link": "https://stackoverflow.com/users/8423622/johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1503908606, "creation_date": 1503898392, "last_edit_date": 1503908606, "question_id": 45912272, "link": "https://stackoverflow.com/questions/45912272/haskell-type-specifier-issue-using-integral-and-int", "title": "Haskell type specifier issue using integral and int", "body": "<p>I have the following Haskell definitions in a source file</p>\n\n<pre><code>nNotes=7\n\npitchLimit k = k &lt; 0 || k &gt; 20  \npitcherror = error \"Invalid Pitch\"\n\ngetOctave k\n    | pitchLimit k = pitcherror\n    | otherwise = k `div` nNotes\n</code></pre>\n\n<p>I do not declare the type of <code>getOctave</code>. Now here is my issue regarding types. Later on in the same source file, I used <code>getOctave</code> with an <code>Int</code>. I load the source file into GHCI and Haskell infers that the type of <code>getOctave</code> is <code>Int-&gt;Int</code>. Now I comment out the code that uses <code>getOctave</code> as an <code>Int</code>. I reload the source file and now Haskell infers <code>getOctave</code> to be of type <code>Integer-&gt;Integer</code>. Seems to me now that the default of <code>div</code> is <code>Integer-&gt;Integer</code>. Now I uncomment that code and specify the type of <code>getOctave</code> to be <code>(Integral a) =&gt; a  -&gt;a</code>. And Haskell reports an error. What's wrong with using <code>(Integral a) =&gt; a -&gt; a</code>.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1503896043, "post_id": 45911469, "comment_id": 78782513, "body": "<code>foo | condition = True | otherwise = False</code> can be shortened to just <code>foo = condition</code>."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 1, "last_activity_date": 1503897418, "last_edit_date": 1503897418, "creation_date": 1503891307, "answer_id": 45911469, "question_id": 45911270, "link": "https://stackoverflow.com/questions/45911270/given-coordinates-of-map/45911469#45911469", "title": "Given Coordinates of Map", "body": "<p>Since <code>XCoord</code> and <code>YCoord</code> are just integers, you can simply check if both are in range of <code>[0, 9]</code>:</p>\n\n<pre><code>type Coordinate = (XCoord, YCoord)\ntype XCoord = Coord\ntype YCoord = Coord\ntype Coord = Integer\n\ncoordInBound :: Coordinate -&gt; Bool\ncoordInBound (x, y) =\n  x &gt;= 0 &amp;&amp; x &lt;= 9 &amp;&amp; y &gt;= 0 &amp;&amp; y &lt;= 9\n\nmain = print $ coordInBound (9, 0)\n</code></pre>\n\n<p>But if you wish <code>XCoord</code> and <code>YCoord</code> were types, then you'd need the following type definition and usage:</p>\n\n<pre><code>data XCoord = XCoord Int\ndata YCoord = YCoord Int\ntype Coordinate = (XCoord, YCoord)\n\ncoordInBound :: Coordinate -&gt; Bool\ncoordInBound (XCoord x, YCoord y) =\n  x &gt;= 0 &amp;&amp; x &lt;= 9 &amp;&amp; y &gt;= 0 &amp;&amp; y &lt;= 9\n\nmain = print $ coordInBound (XCoord 9, YCoord 0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 1, "last_activity_date": 1503891314, "creation_date": 1503891314, "answer_id": 45911472, "question_id": 45911270, "link": "https://stackoverflow.com/questions/45911270/given-coordinates-of-map/45911472#45911472", "title": "Given Coordinates of Map", "body": "<p>Try breaking the problem into two pieces: Is the x coordinate in bounds? Is the y coordinate in bounds? And combining those together to figure out if they're both in bounds.</p>\n\n<pre><code>xInBounds :: XCoord -&gt; Bool\nxInBounds x | x &gt;= 0 &amp;&amp; x &lt;= 9 = True\n            | otherwise = False\n\nyInBounds :: YCoord -&gt; Bool\n???\n</code></pre>\n\n<p>What you have right now won't compile because, among other things, the names of variables in patterns <code>(XCoord, YCoord)</code> can't start with capital letters. Names that start with capital letters in haskell are reserved for types like <code>Coordinate</code> and constructors like <code>True</code>. Variables have lower case names like <code>coordInBound</code>.</p>\n\n<p>With <code>xInBounds</code> and <code>yInBounds</code> try to complete <code>coordInBound</code> using lower case variable names</p>\n\n<pre><code>coordInBound :: Coordinate -&gt; Bool\ncoordInBound (x, y) = ???\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8525332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4da0a0c7718161c658dc82543753ea64?s=128&d=identicon&r=PG&f=1", "display_name": "xxxKillerxxx", "link": "https://stackoverflow.com/users/8525332/xxxkillerxxx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 45911472, "answer_count": 2, "score": -1, "last_activity_date": 1582429508, "creation_date": 1503889395, "last_edit_date": 1582429508, "question_id": 45911270, "link": "https://stackoverflow.com/questions/45911270/given-coordinates-of-map", "title": "Given Coordinates of Map", "body": "<pre><code>type Coordinate = (XCoord, YCoord)\ntype XCoord = Coord\ntype YCoord = Coord\ntype Coord = Integer\n\ncoordInBound :: Coordinate -&gt; Bool\n\ncoordInBound (XCoord, YCoord) =\n\nXCoord\n\n        |x &gt;= 0 &amp;&amp; x &lt;= 9 = True\n        |otherwise = False\nYCoord\n\n        |y &gt;= 0 &amp;&amp; y &lt;= 9 = True\n        |otherwise = False\n</code></pre>\n\n<p>I'm Trying to write a function that returns True if the coordinates are in a 10 by 10 grid from 0,0 -> 9,9</p>\n"}, {"tags": ["haskell", "hakyll"], "owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503867156, "creation_date": 1503867156, "question_id": 45909250, "link": "https://stackoverflow.com/questions/45909250/hakyll-template-list-of-rows", "title": "Hakyll template list of rows", "body": "<p>I am moving my blog to hakyll.</p>\n\n<p>In my webdesign at the index page there are horizontal rows with 3 post previews in each. Css/js is made in such a way, that I'd better populate this row not with all posts I have, allowing them to flow automatically, but I'd better cut posts list to chunks of 3 posts in each and generate separate row with 3 posts for each chunk.</p>\n\n<p>So instead of</p>\n\n<pre><code>- row\n   - col-sm-4 - col-sm-4 - col-sm-4\n   - col-sm-4 ...\n</code></pre>\n\n<p>I want to have</p>\n\n<pre><code>- row\n   - col-sm-4 - col-sm-4 - col-sm-4\n- row\n   - col-sm-4 - col-sm-4 - col-sm-4\n...\n</code></pre>\n\n<p>In my <code>site.hs</code> I have quite typical</p>\n\n<pre><code>match \"blog.html\" $ do\n  route cleanRoute\n  compile $ do\n    posts &lt;- recentFirst =&lt;&lt; loadAll \"posts/**\"\n    let indexCtx =\n            listField \"posts\" postCtxWithCat (return posts) `mappend`\n            favCtx\n\n    getResourceBody\n      &gt;&gt;= applyAsTemplate indexCtx\n      &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" indexCtx\n      &gt;&gt;= relativizeUrls\n      &gt;&gt;= cleanIndexUrls\n</code></pre>\n\n<p>And now I want to cut posts to chunks of 3.</p>\n\n<pre><code>    posts &lt;- recentFirst =&lt;&lt; loadAll \"posts/**\"\n    let postsBy3 = chunksOf 3 posts -- from split package\n</code></pre>\n\n<p>But how to feed this <code>postsBy3 :: [[Item String]]</code> further to template and how to use it... is a big question.</p>\n\n<p>Just doing</p>\n\n<pre><code>listField \"postsBy3\" postCtxWithCat (return postsBy3) `mappend`...\n</code></pre>\n\n<p>is clearly a type mismatch.</p>\n\n<p>Stuck.</p>\n"}, {"tags": ["haskell", "window", "x11", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 3919, "user_id": 3132718, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Dv45L.png?s=128&g=1", "display_name": "Al.G.", "link": "https://stackoverflow.com/users/3132718/al-g"}, "edited": false, "score": 0, "creation_date": 1503917802, "post_id": 45910971, "comment_id": 78793089, "body": "Thank you very much for every part of your so detailed answer!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1503889121, "last_edit_date": 1503889121, "creation_date": 1503886109, "answer_id": 45910971, "question_id": 45908110, "link": "https://stackoverflow.com/questions/45908110/start-applications-on-specific-workspace-if-not-yet-started-there/45910971#45910971", "title": "Start applications on specific workspace if not yet started there", "body": "<p>You might like <a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Actions-DynamicProjects.html\" rel=\"noreferrer\">dynamic projects</a> or <a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Actions-TopicSpace.html\" rel=\"noreferrer\">topic spaces</a> as prebaked alternatives. They don't do <em>exactly</em> what you propose, but perhaps one of them is close enough to still be useful, and require less configuration work.</p>\n\n<blockquote>\n  <p>I want to map spawn over the strings in filtered_commands, any idea why this doesn't work?</p>\n</blockquote>\n\n<p>Yep, you need to lift <code>mapM_</code> to handle a monadic argument (as opposed to a monadic function or return value). Thus:</p>\n\n<pre><code>filtered_commands &gt;&gt;= mapM_ spawn\n</code></pre>\n\n<p>Or, since you are already in a <code>do</code> block:</p>\n\n<pre><code>result_of_filtered_commands &lt;- filtered_commands\nmapM_ spawn result_of_filtered_commands\n</code></pre>\n\n<blockquote>\n  <p>So, how can I get a window's <code>className</code> (or any other attributes) outside of <code>ManageHook</code>?</p>\n</blockquote>\n\n<p>Look at <a href=\"http://hackage.haskell.org/package/xmonad-0.13/docs/src/XMonad-ManageHook.html#className\" rel=\"noreferrer\">the source of <code>className</code></a>:</p>\n\n<pre><code>className = ask &gt;&gt;= (\\w -&gt; liftX $ withDisplay $ \\d -&gt; fmap resClass $ io $ getClassHint d w)\n</code></pre>\n\n<p>You can take just the argument to <code>liftX</code> as an <code>X</code> action rather than a <code>Query</code> action. The key function is <a href=\"https://hackage.haskell.org/package/X11-1.8/docs/Graphics-X11-Xlib-Extras.html#v:getClassHint\" rel=\"noreferrer\"><code>getClassHint</code></a> from the X11 package, which also offers access to other attributes of windows.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 12320244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P2Qki.png?s=128&g=1", "display_name": "Pierre", "link": "https://stackoverflow.com/users/12320244/pierre"}, "is_accepted": false, "score": 0, "last_activity_date": 1584222878, "last_edit_date": 1584222878, "creation_date": 1584125431, "answer_id": 60675814, "question_id": 45908110, "link": "https://stackoverflow.com/questions/45908110/start-applications-on-specific-workspace-if-not-yet-started-there/60675814#60675814", "title": "Start applications on specific workspace if not yet started there", "body": "<p>Install wmctrl</p>\n\n<pre><code>sudo apt install wmctrl\n</code></pre>\n\n<p>And create a script (in this example thunderbird on the second workspace (<code>-t 1</code>)):</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/sh\n\n (thunderbird &amp;)  &amp; sleep 5 &amp;&amp; \nsh -c \"wmctrl -i -r `wmctrl -l | grep Thunderbird` -t 1\"\n</code></pre>\n\n<p>To know your application name on wmctrl you can view it by taping on your terminal :</p>\n\n<pre><code>wmctrl -l\n</code></pre>\n\n<p>And replace it with the correct name in the script.</p>\n\n<p>Be carrefull with the capital letter (\"Thunderbird\" not \"thunderbird\") !!</p>\n\n<p>Other example with firefox on the 3d workspace (<code>-t 2</code>):</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/sh\n(firefox &amp;)  &amp; sleep 5 &amp;&amp; \nsh -c \"wmctrl -i -r `wmctrl -l | grep Firefox` -t 2\"\n</code></pre>\n\n<h1>Bonus :</h1>\n\n<p>Here is the command to execute at start-up :</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>sh -c \"thunderbird  &amp; sleep 5 &amp;&amp; wmctrl -i -r `wmctrl -l | grep Thunderbird` -t 1\"\n</code></pre>\n\n<p>Work on Debain 10 with Cinnamon. But should work for all</p>\n"}], "owner": {"reputation": 3919, "user_id": 3132718, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Dv45L.png?s=128&g=1", "display_name": "Al.G.", "link": "https://stackoverflow.com/users/3132718/al-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 0, "accepted_answer_id": 45910971, "answer_count": 2, "score": 2, "last_activity_date": 1584222878, "creation_date": 1503858804, "question_id": 45908110, "link": "https://stackoverflow.com/questions/45908110/start-applications-on-specific-workspace-if-not-yet-started-there", "title": "Start applications on specific workspace if not yet started there", "body": "<p>In short: when I switch to workspace <em>X</em>, I want some programs to autostart, but only if they're not already started.</p>\n\n<p>This is different from <a href=\"https://stackoverflow.com/q/13279791/3132718\">XMonad startup on different workspaces</a> as I don't want to move windows to specific workspaces (like always moving xterm to workspace 2).<br>\nThis doesn't work for me, either: <a href=\"https://stackoverflow.com/q/10976044/3132718\">xmonad spawn on startup in different workspace</a>. I don't want all applications to start immediately as I log in, also this won't autostart e.g. xterm if I close it and switch to workspace 2 again.</p>\n\n<hr>\n\n<p>Enough about what doesn't work, here is what <em>does</em> work:<br>\n<sub>(almost)</sub></p>\n\n<p>In my workspace list I hold touples with the workspace name and a list programs to start when I switch there:</p>\n\n<pre><code>myWorkspaces = [ (\"VIM\", [\"gvim\"]), (\"TERM\",[myTerminal ++ \" -e tmux\"]) ]\n\n-- In my keybindings:\n[ ((mod4Mask, key), loadWorkspace workspace cmd)\n  | (key, (workspace, cmd)) &lt;- zip [xK_1..] myWorkspaces\n]\n</code></pre>\n\n<p>I defined a function to switch to a workspace and spawn the given programs:</p>\n\n<pre><code>loadWorkspace :: String -&gt; [String] -&gt; X()\nloadWorkspace workspace commands =\n    do windows $ W.greedyView workspace\n       mapM_ spawn filtered_commands\n           where filtered_commands :: X [String]\n                 filtered_commands = filterM isNotOpen commands\n\n                 isNotOpen :: String -&gt; X Bool\n                 isNotOpen command = return True\n</code></pre>\n\n<p>(For some reason <code>mapM_</code> requires the second argument to be a <em>String</em> instead of <em>[String]</em>. I want to map <code>spawn</code> over the strings in <em>filtered_commands</em>, any idea why this doesn't work?)</p>\n\n<p>The last missing piece is the <code>isNotOpen</code> function, which should search the <code>className</code>s of the windows in the current workspace and return whether <code>command</code> is already there.</p>\n\n<hr>\n\n<p>I find it extremely hard (compared to other languages and technologies) to search for the XMonad way to do things. For this case I could only find how to get the windows in the current WS - <a href=\"https://superuser.com/a/852152/481701\">https://superuser.com/a/852152/481701</a>. Ok, I think, this gives me a Window object, I can query it for some attributes.</p>\n\n<p>But no. The Window is actually... alias for <code>Word64</code>!!! Ok, I think. Google <em>xmonad get window attributes</em>. Nothing. <em>xmonad get classname from window id</em>. Nothing. <em>xmonad window information</em>. And a dozen other ways to say something similar - no helpful results. All I get is the xmonad homepage, the FAQ, or \"Xmonad configuration tips\".<br>\nI tried these in <em>hayoo!</em>, too, and the closest I could get was \"fromClassName - Colorize a window depending on it's className.\". Haha.</p>\n\n<h1>So, how can I get a window's className (or any other attributes) outside of <em>ManageHook</em>?</h1>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1503859042, "post_id": 45908060, "comment_id": 78774906, "body": "Hello @Jimbo welcome to the haskell section of stackoverflow - right now your question is very broad and unclear. What have you tried? What (compiler) errors do you face? Also stackoverflow questions should be self-contained, so please include your script instead of linking to a file."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503859286, "post_id": 45908060, "comment_id": 78774969, "body": "What do you want to use servant for? writing a client/server/documentation/swagger-interface description/... There is a good paper on servant <a href=\"https://haskell-servant.github.io/posts/2015-05-25-servant-paper-wgp-2015.html\" rel=\"nofollow noreferrer\">here</a> also the <a href=\"https://haskell-servant.readthedocs.io/en/stable/\" rel=\"nofollow noreferrer\">documentation</a> is quite extensive and includes several examples as well as some tutorials."}, {"owner": {"reputation": 327, "user_id": 6651168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2b45f362ea8f2d6346f9008a1df0afff?s=128&d=identicon&r=PG&f=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/6651168/jimbo"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503859562, "post_id": 45908060, "comment_id": 78775050, "body": "I want to use servant to make API requests and build a GUI with reflex-frp. I read though 13 chapters of learnyouahaskell.com and I have never written haskell. I&#39;m trying to get the simplest tutorial of servant working so I can play with it."}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 6651168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2b45f362ea8f2d6346f9008a1df0afff?s=128&d=identicon&r=PG&f=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/6651168/jimbo"}, "edited": false, "score": 0, "creation_date": 1503860983, "post_id": 45908327, "comment_id": 78775497, "body": "Thanks for the response. Even when I cut down the script to just the imports in an .hs file, I can&#39;t import Servant."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 327, "user_id": 6651168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2b45f362ea8f2d6346f9008a1df0afff?s=128&d=identicon&r=PG&f=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/6651168/jimbo"}, "edited": false, "score": 0, "creation_date": 1503862343, "post_id": 45908327, "comment_id": 78775814, "body": "I don&#39;t have my scrying ball with me - without concrete errors I cannot help you."}, {"owner": {"reputation": 327, "user_id": 6651168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2b45f362ea8f2d6346f9008a1df0afff?s=128&d=identicon&r=PG&f=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/6651168/jimbo"}, "edited": false, "score": 0, "creation_date": 1503885926, "post_id": 45908327, "comment_id": 78780575, "body": "For anybody reading this, I solved my problem because I didn&#39;t understand how stack works!  <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1503860264, "creation_date": 1503860264, "answer_id": 45908327, "question_id": 45908060, "link": "https://stackoverflow.com/questions/45908060/servant-implementation/45908327#45908327", "title": "Servant Implementation", "body": "<p>First of all - if you have not written any haskell code - starting with servant and is I'd say quite ambitious - as it leverages several high level concepts/mechanisms provided by several language extensions like <code>TypeFamilies</code> and <code>DataKinds</code> ...</p>\n\n<p>What you are writing is no literate haskell file - at least it violates the syntax as described <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17900010.4\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>I recommend either sticking to normal haskell files or reading the document I linked to first.</p>\n\n<p>Here is a translation of your file into valid literate haskell:</p>\n\n<pre><code># Serving an API\n\nEnough chit-chat about type-level combinators and representing an API as a\ntype. Can we have a webservice already?\n\n## A first example\n\nEquipped with some basic knowledge about the way we represent APIs, let's now write our first webservice.\n\nThe source for this tutorial section is a literate haskell file, so first we need to have some language extensions and imports:\n\n``` haskell\n&gt; {-# LANGUAGE DataKinds #-}\n&gt; {-# LANGUAGE DeriveGeneric #-}\n&gt; {-# LANGUAGE FlexibleInstances #-}\n&gt; {-# LANGUAGE GeneralizedNewtypeDeriving #-}\n&gt; {-# LANGUAGE MultiParamTypeClasses #-}\n&gt; {-# LANGUAGE OverloadedStrings #-}\n&gt; {-# LANGUAGE ScopedTypeVariables #-}\n&gt; {-# LANGUAGE TypeOperators #-}\n\n&gt; module Server where\n\n&gt; import Prelude ()\n&gt; import Prelude.Compat\n\n&gt; import Control.Monad.Except\n&gt; import Control.Monad.Reader\n&gt; import Data.Aeson.Compat\n&gt; import Data.Aeson.Types\n&gt; import Data.Attoparsec.ByteString\n&gt; import Data.ByteString (ByteString)\n&gt; import Data.List\n&gt; import Data.Maybe\n&gt; import Data.String.Conversions\n&gt; import Data.Time.Calendar\n&gt; import GHC.Generics\n&gt; import Lucid\n&gt; import Network.HTTP.Media ((//), (/:))\n&gt; import Network.Wai\n&gt; import Network.Wai.Handler.Warp\n&gt; import Servant\n&gt; import System.Directory\n&gt; import Text.Blaze\n&gt; import Text.Blaze.Html.Renderer.Utf8\n&gt; import qualified Data.Aeson.Parser\n&gt; import qualified Text.Blaze.Html\n```\n\n**Important**: the `Servant` module comes from the **servant-server** package, the one that lets us run webservers that implement a particular API type. It reexports all the types from the **servant** package that let you declare API types as well as everything you need to turn your request handlers into a fully-fledged webserver. This means that in your applications, you can just add **servant-server** as a dependency, import `Servant` and not worry about anything else.\n\nWe will write a server that will serve the following API.\n\n``` haskell\n&gt; type UserAPI1 = \"users\" :&gt; Get '[JSON] [User]\n```\n\nHere's what we would like to see when making a GET request to `/users`.\n\n``` javascript\n[ {\"name\": \"Isaac Newton\", \"age\": 372, \"email\": \"isaac@newton.co.uk\", \"registration_date\": \"1683-03-01\"}\n, {\"name\": \"Albert Einstein\", \"age\": 136, \"email\": \"ae@mc2.org\", \"registration_date\": \"1905-12-01\"}\n]\n```\n\nNow let's define our `User` data type and write some instances for it.\n\n``` haskell\n&gt; data User = User\n&gt;   { name :: String\n&gt;   , age :: Int\n&gt;   , email :: String\n&gt;   , registration_date :: Day\n&gt;   } deriving (Eq, Show, Generic)\n\n&gt; instance ToJSON User\n```\n\nNothing funny going on here. But we now can define our list of two users.\n\n``` haskell\n&gt; users1 :: [User]\n&gt; users1 =\n&gt;   [ User \"Isaac Newton\"    372 \"isaac@newton.co.uk\" (fromGregorian 1683  3 1)\n&gt;   , User \"Albert Einstein\" 136 \"ae@mc2.org\"         (fromGregorian 1905 12 1)\n&gt;   ]\n```\n\nLet's also write our API type.\n\n``` haskell ignore\ntype UserAPI1 = \"users\" :&gt; Get '[JSON] [User]\n```\n\nWe can now take care of writing the actual webservice that will handle requests to such an API. This one will be very simple, being reduced to just a single endpoint. The type of the web application is determined by the API type, through a *type family* named `Server`. (Type families are just functions that take types as input and return types.)  The `Server` type family will compute the right type that a bunch of request handlers should have just from the\ncorresponding API type.\n\nThe first thing to know about the `Server` type family is that behind the\nscenes it will drive the routing, letting you focus only on the business\nlogic. The second thing to know is that for each endpoint, your handlers will by default run in the `Handler` monad. This is overridable very\neasily, as explained near the end of this guide. Third thing, the type of the value returned in that monad must be the same as the second argument of the HTTP method combinator used for the corresponding endpoint. In our case, it means we must provide a handler of type `Handler [User]`. Well,\nwe have a monad, let's just `return` our list:\n\n``` haskell\n&gt; server1 :: Server UserAPI1\n&gt; server1 = return users1\n```\n\nThat's it. Now we can turn `server` into an actual webserver using\n[wai](http://hackage.haskell.org/package/wai) and\n[warp](http://hackage.haskell.org/package/warp):\n\n``` haskell\n&gt; userAPI :: Proxy UserAPI1\n&gt; userAPI = Proxy\n```\n\n'serve' comes from servant and hands you a WAI Application,\nwhich you can think of as an \"abstract\" web application,\nnot yet a webserver.\n\n```haskell\n&gt; app1 :: Application\n&gt; app1 = serve userAPI server1\n```\n\nThe `userAPI` bit is, alas, boilerplate (we need it to guide type inference).\nBut that's about as much boilerplate as you get.\n\nAnd we're done! Let's run our webservice on the port 8081.\n\n```haskell\n&gt; main :: IO ()\n&gt; main = run 8081 app1\n```\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 6651168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2b45f362ea8f2d6346f9008a1df0afff?s=128&d=identicon&r=PG&f=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/6651168/jimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1503862639, "creation_date": 1503858485, "last_edit_date": 1503862639, "question_id": 45908060, "link": "https://stackoverflow.com/questions/45908060/servant-implementation", "title": "Servant Implementation", "body": "<p>I would like to use servant, in particular implement a literate haskell file. I cannot figure out how to use the literate haskell file. I've been searching for documentation but nothing helpful has come up.</p>\n\n<p>So far I have named the file correctly with the extension <code>.lhs</code> and I have executed <code>runhaskell filename.lhs</code>. I am receiving the following error:</p>\n\n<pre><code>servantfinaltest.lhs line 150: unlit: No definitions in file (perhaps you forgot the '&gt;'s?)\n`unlit' failed in phase `Literate pre-processor'. (Exit code: 1)\n</code></pre>\n\n<p>This is my .lhs file below:</p>\n\n<pre><code># Serving an API\n\nEnough chit-chat about type-level combinators and representing an API as a\ntype. Can we have a webservice already?\n\n## A first example\n\nEquipped with some basic knowledge about the way we represent APIs, let's now\nwrite our first webservice.\n\nThe source for this tutorial section is a literate haskell file, so first we\nneed to have some language extensions and imports:\n\n``` haskell\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule Server where\n\nimport Prelude ()\nimport Prelude.Compat\n\nimport Control.Monad.Except\nimport Control.Monad.Reader\nimport Data.Aeson.Compat\nimport Data.Aeson.Types\nimport Data.Attoparsec.ByteString\nimport Data.ByteString (ByteString)\nimport Data.List\nimport Data.Maybe\nimport Data.String.Conversions\nimport Data.Time.Calendar\nimport GHC.Generics\nimport Lucid\nimport Network.HTTP.Media ((//), (/:))\nimport Network.Wai\nimport Network.Wai.Handler.Warp\nimport Servant\nimport System.Directory\nimport Text.Blaze\nimport Text.Blaze.Html.Renderer.Utf8\nimport qualified Data.Aeson.Parser\nimport qualified Text.Blaze.Html\n```\n\n**Important**: the `Servant` module comes from the **servant-server** package,\nthe one that lets us run webservers that implement a particular API type.  It\nreexports all the types from the **servant** package that let you declare API\ntypes as well as everything you need to turn your request handlers into a\nfully-fledged webserver. This means that in your applications, you can just add\n**servant-server** as a dependency, import `Servant` and not worry about anything\nelse.\n\nWe will write a server that will serve the following API.\n\n``` haskell\ntype UserAPI1 = \"users\" :&gt; Get '[JSON] [User]\n```\n\nHere's what we would like to see when making a GET request to `/users`.\n\n``` javascript\n[ {\"name\": \"Isaac Newton\", \"age\": 372, \"email\": \"isaac@newton.co.uk\", \"registration_date\": \"1683-03-01\"}\n, {\"name\": \"Albert Einstein\", \"age\": 136, \"email\": \"ae@mc2.org\", \"registration_date\": \"1905-12-01\"}\n]\n```\n\nNow let's define our `User` data type and write some instances for it.\n\n``` haskell\ndata User = User\n  { name :: String\n  , age :: Int\n  , email :: String\n  , registration_date :: Day\n  } deriving (Eq, Show, Generic)\n\ninstance ToJSON User\n```\n\nNothing funny going on here. But we now can define our list of two users.\n\n``` haskell\nusers1 :: [User]\nusers1 =\n  [ User \"Isaac Newton\"    372 \"isaac@newton.co.uk\" (fromGregorian 1683  3 1)\n  , User \"Albert Einstein\" 136 \"ae@mc2.org\"         (fromGregorian 1905 12 1)\n  ]\n```\n\nLet's also write our API type.\n\n``` haskell ignore\ntype UserAPI1 = \"users\" :&gt; Get '[JSON] [User]\n```\n\nWe can now take care of writing the actual webservice that will handle requests\nto such an API. This one will be very simple, being reduced to just a single\nendpoint. The type of the web application is determined by the API type,\nthrough a *type family* named `Server`. (Type families are just functions that\ntake types as input and return types.)  The `Server` type family will compute\nthe right type that a bunch of request handlers should have just from the\ncorresponding API type.\n\nThe first thing to know about the `Server` type family is that behind the\nscenes it will drive the routing, letting you focus only on the business\nlogic. The second thing to know is that for each endpoint, your handlers will\nby default run in the `Handler` monad. This is overridable very\neasily, as explained near the end of this guide. Third thing, the type of the\nvalue returned in that monad must be the same as the second argument of the\nHTTP method combinator used for the corresponding endpoint. In our case, it\nmeans we must provide a handler of type `Handler [User]`. Well,\nwe have a monad, let's just `return` our list:\n\n``` haskell\nserver1 :: Server UserAPI1\nserver1 = return users1\n```\n\nThat's it. Now we can turn `server` into an actual webserver using\n[wai](http://hackage.haskell.org/package/wai) and\n[warp](http://hackage.haskell.org/package/warp):\n\n``` haskell\nuserAPI :: Proxy UserAPI1\nuserAPI = Proxy\n\n-- 'serve' comes from servant and hands you a WAI Application,\n-- which you can think of as an \"abstract\" web application,\n-- not yet a webserver.\napp1 :: Application\napp1 = serve userAPI server1\n```\n\nThe `userAPI` bit is, alas, boilerplate (we need it to guide type inference).\nBut that's about as much boilerplate as you get.\n\nAnd we're done! Let's run our webservice on the port 8081.\n\n``` haskell\nmain :: IO ()\nmain = run 8081 app1\n```\n</code></pre>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 1, "creation_date": 1503857607, "post_id": 45907435, "comment_id": 78774490, "body": "With <code>IO</code>, you could just make it throw. Better solution: Switch it to <code>io (Maybe a)</code>."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1503941839, "post_id": 45907435, "comment_id": 78807554, "body": "So, when I was down-voted, is that because the answer is too short or does it contain factually incorrect information? I did not elaborate on what to do because the questioner demonstrated they already knew of <code>Control.Foldl</code>. Therefore, the question to me was only why that particular signature was not part of the library. @Reactormonk does suggest that my wording of &quot;not possible&quot; may be too strong. My opinion on exceptions is not much different than my opinion on <code>undefined</code>."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 3, "last_activity_date": 1503854196, "creation_date": 1503854196, "answer_id": 45907435, "question_id": 45907307, "link": "https://stackoverflow.com/questions/45907307/haskell-turtle-get-a-return-value-out-of-a-shell/45907435#45907435", "title": "Haskell: Turtle: get a return value out of a Shell", "body": "<p><code>sh' :: MonadIO io =&gt; Shell a -&gt; io a</code> is not possible because <code>Shell a</code> may be constructed from <code>[a]</code> (evidenced by <code>select :: [a] -&gt; Shell a</code>) which can be empty.</p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 313553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfaab1fc6bdf9adb3c9ed75aa814aad6?s=128&d=identicon&r=PG", "display_name": "damien.courousse", "link": "https://stackoverflow.com/users/313553/damien-courousse"}, "edited": false, "score": 0, "creation_date": 1504037119, "post_id": 45916871, "comment_id": 78853426, "body": "Thanks you! I was looking for something like this!"}, {"owner": {"reputation": 61, "user_id": 313553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfaab1fc6bdf9adb3c9ed75aa814aad6?s=128&d=identicon&r=PG", "display_name": "damien.courousse", "link": "https://stackoverflow.com/users/313553/damien-courousse"}, "edited": false, "score": 0, "creation_date": 1504037250, "post_id": 45916871, "comment_id": 78853497, "body": "BTW, it looks like a more idiomatic way to handle errors in Turtle is to use Exceptions. Then the code would more look like: ``` Tt.sh cmds         <code>catches</code>         [ Handler (&#40;e::Tt.ProcFailed) -&gt;  Log.error $ show e)         , Handler (&#40;e::Tt.ShellFailed) -&gt; Log.error $ show e)         , -- etc.         ]  ``` Do you agree? (sorry for the bad code layout, I don&#39;t know how to do this in a comment)"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 5, "last_activity_date": 1503934007, "last_edit_date": 1503934007, "creation_date": 1503915975, "answer_id": 45916871, "question_id": 45907307, "link": "https://stackoverflow.com/questions/45907307/haskell-turtle-get-a-return-value-out-of-a-shell/45916871#45916871", "title": "Haskell: Turtle: get a return value out of a Shell", "body": "<p><code>Turtle.Shell</code> provides you with a <a href=\"https://hackage.haskell.org/package/turtle-1.4.2/docs/Turtle-Shell.html#v:fold\" rel=\"nofollow noreferrer\"><code>fold ::  MonadIO io =&gt; Shell a -&gt; Fold a b -&gt; io b</code></a> and <code>Control.Foldl</code> gives you a bunch of <code>Fold</code>s amongst which: <a href=\"https://hackage.haskell.org/package/foldl-1.3.0/docs/Control-Foldl.html#v:last\" rel=\"nofollow noreferrer\"><code>last :: Fold a (Maybe a)</code></a>. You can combine the two to extract the last <code>ExitCode</code> your command returns like so:</p>\n\n<pre><code>import Control.Monad.IO.Class\nimport Turtle.Shell  as TS\nimport Control.Foldl as CF\n\nsh' :: MonadIO io =&gt; Shell a -&gt; io (Maybe a)\nsh' c = TS.fold c CF.last\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 313553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfaab1fc6bdf9adb3c9ed75aa814aad6?s=128&d=identicon&r=PG", "display_name": "damien.courousse", "link": "https://stackoverflow.com/users/313553/damien-courousse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1503934007, "creation_date": 1503853342, "question_id": 45907307, "link": "https://stackoverflow.com/questions/45907307/haskell-turtle-get-a-return-value-out-of-a-shell", "title": "Haskell: Turtle: get a return value out of a Shell", "body": "<p>How do you extract a value out of the Shell monad? </p>\n\n<p>I would like to sequence a list of commands <em>\u00e0 la</em> bash's <code>&amp;&amp;</code>, but I would also like to extract the final <code>ExitCode</code> value.</p>\n\n<p>Say I have the following code:</p>\n\n<pre><code>import           Turtle\n\ntype Commands = [Shell ExitCode]\nrun :: (MonadIO io) =&gt; Commands -&gt; io ExitCode\nrun cs = whatIsThisFunction $ Prelude.foldl (.&amp;&amp;.) (return ExitSuccess) cs\n\nwhatIsThisFunction :: (MonadIO io) =&gt; Shell a -&gt; io a\nwhatIsThisFunction = undefined\n</code></pre>\n\n<p>I tried to see if I could implement this with Control.Foldl, but did not find a solution.</p>\n\n<p>Any ideas?  </p>\n\n<p>More generally, why doesn't Turtle provide a function with such signature:</p>\n\n<pre><code>sh' :: MonadIO io =&gt; Shell a -&gt; io a \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 1, "creation_date": 1503846681, "post_id": 45906389, "comment_id": 78771167, "body": "Please indicate how the code deviates from your expectation. Is there a compiler error? What is that error? Does the program give incorrect output? What is an example of an input and incorrect output?"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503846702, "post_id": 45906389, "comment_id": 78771172, "body": "Start simpler: can you write a function <code>f from to x</code> that evaluates to <code>to</code> if <code>x</code> is equal to <code>from</code> and <code>x</code> unchanged otherwise?"}, {"owner": {"reputation": 45, "user_id": 8470124, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlyHW.jpg?s=128&g=1", "display_name": "RNee", "link": "https://stackoverflow.com/users/8470124/rnee"}, "edited": false, "score": 0, "creation_date": 1503846941, "post_id": 45906389, "comment_id": 78771248, "body": "On compilation, I am getting a parse error and the compiler is suggesting me to add &#39;let&#39; in the &#39;do block&#39;"}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1503847049, "post_id": 45906389, "comment_id": 78771277, "body": "@RNee please edit your question to include the exact text of the parse error."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1503847476, "post_id": 45906389, "comment_id": 78771413, "body": "@RNee And also the code the error points to. There is no do block in the function above, for instance."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1503848357, "post_id": 45906389, "comment_id": 78771649, "body": "Note that single quotes delimit a character whereas double quotes delimit a list of characters. I made this small correction for sake of clarity to other beginners with a similar question."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1503849480, "post_id": 45906389, "comment_id": 78771987, "body": "Not specific to Haskell but in every functional language you have a <code>map</code> function for this task. Such as <code>map (\\c -&gt; if c == &#39;n&#39; then &#39;i&#39; else c) &quot;pink&quot; </code> will give you <code>&quot;piik&quot;</code>"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1503917040, "post_id": 45906389, "comment_id": 78792609, "body": "A good first step into Haskell is forgetting that you ever heard of assignments."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1503847526, "creation_date": 1503847526, "answer_id": 45906531, "question_id": 45906389, "link": "https://stackoverflow.com/questions/45906389/haskell-replace-a-value-in-a-list-with-another-value/45906531#45906531", "title": "Haskell Replace a value in a list with another value", "body": "<p>Your program looks rather \"<em>imperative</em>\" whereas Haskell aims to be more \"<em>declarative</em>\". So you can not set a variable <code>z</code> in a list: once a list is constructed, you can not alter it anymore. So you have to construct a new list where elements that are equal to <code>x</code> are set to <code>y</code>.</p>\n\n<p>Next you make use of the <code>(==)</code> function. That function is defined in the <code>Eq</code> typeclass, so you need to add <code>Eq t</code> as a type constraint to the signature.</p>\n\n<p>So now we can start to construct such function. Usually when working with a list, we make use of recursion. The base case of the recursion is usually the empty list. In case we encounter the empty list, we should return an empty list, regardless what <code>x</code> and <code>y</code> are. So we use underscores as \"<em>don't care</em>\" patterns, and use <code>[]</code> as the list pattern, and write:</p>\n\n<pre><code>repOcc _ _ [] = []\n</code></pre>\n\n<p>The recursive case is when the list contains a head <code>h</code> and a tail <code>t</code> in a <code>(h:t)</code> pattern. In that case we check whether <code>h</code> is equal to <code>x</code>. In case it is, we construct a list with <code>y</code> as head, otherwise <code>h</code> is still the head.</p>\n\n<pre><code>repOcc x y (h:t) | x == h = y : tl\n                 | otherwise = h : tl\n</code></pre>\n\n<p>Now the question remains what the tail of the result list <code>tl</code> should be. Here we use recursion, so we call <code>repOcc</code> with <code>x y t</code>:</p>\n\n<pre><code>    where tl = repOcc x y t\n</code></pre>\n\n<p>Or putting it together:</p>\n\n<pre><code>repOcc :: Eq t =&gt; t -&gt; t -&gt; [t] -&gt; [t]\nrepOcc _ _ [] = []\nrepOcc x y (h:t) | x == h = y : tl\n                 | otherwise = h : tl\n    where tl = repOcc x y t\n</code></pre>\n\n<p>We can write such recursive functions, but the above is actually a special case of a <code>map</code> function: we map every character in such way that we check whether it is equal to <code>x</code> and if it is, we return <code>y</code>, otherwise we return <code>h</code>. So we can rewrite the above as:</p>\n\n<pre><code>repOcc :: Eq t =&gt; t -&gt; t -&gt; [t] -&gt; [t]\nrepOcc x y ls = map (\\h -&gt; if h == x then y else h) ls\n</code></pre>\n\n<p>We can further improve the code by making use of <em>eta</em>-reduction:</p>\n\n<pre><code>repOcc :: Eq t =&gt; t -&gt; t -&gt; [t] -&gt; [t]\nrepOcc x y = map (\\h -&gt; if h == x then y else h)\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 8470124, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlyHW.jpg?s=128&g=1", "display_name": "RNee", "link": "https://stackoverflow.com/users/8470124/rnee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1654, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503848180, "creation_date": 1503846505, "last_edit_date": 1503848180, "question_id": 45906389, "link": "https://stackoverflow.com/questions/45906389/haskell-replace-a-value-in-a-list-with-another-value", "title": "Haskell Replace a value in a list with another value", "body": "<p>I am pretty new to Haskell. I am trying to write a program that takes two values and a list and replaces every instance of the first value in the list with the second. E.g. <code>repOcc 'n' 'i' \"pink\"</code> would return <code>\"piik\"</code>.</p>\n\n<p>The following is my code:</p>\n\n<pre><code>repOcc :: t -&gt; t -&gt; [t] -&gt; [t]\nrepOcc x y (z:zs) = if z == x\n                      then z = y\n                      subst x y zs\n                      else subst x y zs\n</code></pre>\n\n<p>The error I am receiving at compile time is:</p>\n\n<pre><code>rev.hs:3 :32: error: \n   parse error on input '='\n   Perhaps you need a 'let' in a 'do' block?\n   e.g. 'let x = 5' instead of 'x = 5'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "pandoc", "hakyll"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1503906328, "post_id": 45905951, "comment_id": 78786618, "body": "what input/output are you expecting? about bare_uris extension: <code>Makes all absolute URIs into links, even when not surrounded by pointy braces</code> (from the MANUAL)"}, {"owner": {"reputation": 237, "user_id": 604502, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c443b9c020c90b311683fd25c0c33f95?s=128&d=identicon&r=PG", "display_name": "wmnorth", "link": "https://stackoverflow.com/users/604502/wmnorth"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1503910503, "post_id": 45905951, "comment_id": 78788771, "body": "Well, the input is an absolute URL in a markdown file, and the output I expected was that absolute URL, but clickable, in the HTML output. Instead what I get is the URL enclosed in <code>&lt;p&gt;&lt;&#47;p&gt;</code> tags."}], "answers": [{"tags": [], "owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "is_accepted": false, "score": 0, "last_activity_date": 1532440037, "creation_date": 1532440037, "answer_id": 51500296, "question_id": 45905951, "link": "https://stackoverflow.com/questions/45905951/hakyll-enabling-pandoc-extensions/51500296#51500296", "title": "Hakyll: enabling pandoc extensions?", "body": "<p>Question is a bit old now, but maybe this will help someone.</p>\n\n<p>Newer Hakyll releases use <a href=\"https://github.com/jgm/pandoc/releases/tag/2.0\" rel=\"nofollow noreferrer\">Pandoc 2.x</a> which changed a lot of things (see <a href=\"https://github.com/jaspervdj/hakyll/pull/557/files\" rel=\"nofollow noreferrer\">PR #557</a> especially). Notably the <code>Set</code> model for extensions is gone, in favour of custom types.</p>\n\n<p>Anyway, here's a fairly customised setup that works well for us - disabling one default reader extension, and adding a few extra ones. There's probably a neater way of doing this still.</p>\n\n<pre><code>customRenderPandoc :: Item String -&gt; Compiler (Item String)\ncustomRenderPandoc = renderPandocWith customReaderOptions defaultHakyllWriterOptions\n    where customReaderOptions = def { readerExtensions = extraReaderExts &lt;&gt; customReaderExts }\n          extraReaderExts = extensionsFromList [Ext_auto_identifiers, Ext_ascii_identifiers, Ext_emoji, Ext_backtick_code_blocks]\n          customReaderExts = disableExtension Ext_implicit_figures $ pandocExtensions\n</code></pre>\n\n<p>Note also I found it's not always obvious (nor typesafe) which extensions are reader and which writer. I guess some can be both... but check you've put yours in the right place as it's an easy mistake.</p>\n"}], "owner": {"reputation": 237, "user_id": 604502, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c443b9c020c90b311683fd25c0c33f95?s=128&d=identicon&r=PG", "display_name": "wmnorth", "link": "https://stackoverflow.com/users/604502/wmnorth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 384, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1532440037, "creation_date": 1503843478, "question_id": 45905951, "link": "https://stackoverflow.com/questions/45905951/hakyll-enabling-pandoc-extensions", "title": "Hakyll: enabling pandoc extensions?", "body": "<p>I wanted to enable the <a href=\"https://hackage.haskell.org/package/pandoc-1.10.0.4/docs/Text-Pandoc-Options.html\" rel=\"nofollow noreferrer\">Ext_autolink_bare_uris pandoc</a> extension for Hakyll posts. I followed the instructions given <a href=\"https://nickcharlton.net/posts/custom-pandoc-options-hakyll-4.html\" rel=\"nofollow noreferrer\">here</a>, and everything seems to be working... except that extension! The bare URI's in posts are not transformed into a link. Everything else seems to function as normal. Here's the code in <code>site.hs</code>:</p>\n\n<pre><code>import qualified Data.Set as S\nimport           Text.Pandoc.Options\n\n...\n\ncustomPandocCompiler :: Compiler (Item String)\ncustomPandocCompiler =\n  let customExtensions = [Ext_autolink_bare_uris]\n      defaultExtensions = writerExtensions defaultHakyllWriterOptions\n      newExtensions = foldr S.insert defaultExtensions customExtensions\n      writerOptions = defaultHakyllWriterOptions {\n                        writerExtensions = newExtensions\n                      }\n  in pandocCompilerWith defaultHakyllReaderOptions writerOptions\n</code></pre>\n\n<p>The <code>customPandocCompiler</code> is used in all the relevant places. The code compiles normally, but does not yield the desired effect. Can anyone help me discover why?</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["haskell", "singleton", "type-theory"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506671752, "post_id": 45905744, "comment_id": 79922860, "body": "This brings out everything I hate about GHC&#39;s built-in <code>Nat</code> type. The impossibility of proving things like <code>(n + 1) - 1 ~ n</code>, as well as the awkwardness around checking if <code>n ~ 0</code>. <code>replicateV2</code> is a fundamentally recursive operation for which you need induction over the vector length. Without having an inductive definition for <code>Nat</code> you go nowhere. Let me make this explicit: any solution to your problem will <i>have</i> to use something that bypasses the type system (either via a plugin or <code>unsafeCoerce</code>). On the other hand, you can do everything safely and easily with <code>data Nat = Z | S Nat</code>."}, {"owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506693739, "post_id": 45905744, "comment_id": 79935391, "body": "This is what I was starting to fear for, that there actually is no solution to this problem. Yet I was hoping there was some common workaround that I did not know of. I&#39;ll wait until the bounty is over hoping for a miracle. But if not, then I guess your comment answers my question, and I&#39;ll resort to using <code>unsafeCoerce</code>."}, {"owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506694159, "post_id": 45905744, "comment_id": 79935649, "body": "The reason I am so keen on using the built-in <code>Nat</code> is that some of the libraries I am using also use the built-in <code>Nat</code> types. Especially <code>Numeric.LinearAlgebra.Static</code> from <code>hmatrix</code>. I am constantly encountering problems with proofs involving <code>Nat</code>s when trying even the simplest things such as iterating over matrix rows, etc."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506697171, "post_id": 45905744, "comment_id": 79937602, "body": "Even then, you&#39;ll probably want to try <code>unsafeCoerce</code>ing your way through some minimal set of arithmetic axioms. I suggest starting from &lt;<a href=\"https://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint-Nat.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/constraints-0.9.1/docs/&hellip;</a>&gt;."}, {"owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506701689, "post_id": 45905744, "comment_id": 79940352, "body": "Hey, your links does not seem to work :)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506701782, "post_id": 45905744, "comment_id": 79940395, "body": "Sorry. I think SO may not support angle-bracketed links in comments. <a href=\"https://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint-Nat.html\" rel=\"nofollow noreferrer\">Here</a> is the link."}, {"owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506702592, "post_id": 45905744, "comment_id": 79940840, "body": "Hmm, looks interesting. I&#39;m not immediately sure how to use this package, but I&#39;ll take a better look at it this weekend as I am working on something else now. If you believe this package can be used to actually implement <code>replicateV</code>, then I&#39;d be much obliged to see how it works out (and I&#39;d give you due credit for it). If not I&#39;ll see what I can come up with this weekend."}, {"owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506764282, "post_id": 45905744, "comment_id": 79957178, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/155651/discussion-between-sam-de-meyer-and-alec\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 4, "last_activity_date": 1503933276, "last_edit_date": 1503933276, "creation_date": 1503844306, "answer_id": 45906072, "question_id": 45905744, "link": "https://stackoverflow.com/questions/45905744/how-to-deconstruct-an-snat-singletons/45906072#45906072", "title": "How to deconstruct an SNat (singletons)", "body": "<p>There are two notions of naturals at play here. One is \"literal naturals\" (i.e. 0, 1, 2, and so on) and the other is \"Peano naturals\" (i.e. Z, S Z, S (S Z), and so on). The one the paper is using is clearly Peano naturals but the one singletons uses is literal naturals.</p>\n\n<p>Thankfully there is another package called <a href=\"https://hackage.haskell.org/package/type-natural-0.7.1.3\" rel=\"nofollow noreferrer\">type-natural</a> which defines Peano naturals as well as <a href=\"https://hackage.haskell.org/package/type-natural-0.7.1.3/docs/Data-Type-Natural-Builtin.html#v:sFromPeano\" rel=\"nofollow noreferrer\">conversion to literal naturals</a> and <a href=\"https://hackage.haskell.org/package/type-natural-0.7.1.3/docs/Data-Type-Natural-Builtin.html#v:sToPeano\" rel=\"nofollow noreferrer\">conversion from literal naturals</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "edited": false, "score": 0, "creation_date": 1506724740, "post_id": 46495696, "comment_id": 79950338, "body": "It seems to be me who has missed something terribly obvious---that is, using typeclasses. In fact your answer is so simple that I am embarrassed it didn&#39;t cross my mind. On first sight it seems that this workaround can be used wherever you would normally try to use a pattern match on an <code>SNat</code> (if it were defined inductively). Having to use an extra typeclass is a bit ugly but it solves the practical problems I had. I guess after staring at it for too long I developed some kind of tunnel vision. Anyway, unless a better solution pops up in the coming days I&#39;ll happily give you the bounty."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1506714551, "last_edit_date": 1506714551, "creation_date": 1506713227, "answer_id": 46495696, "question_id": 45905744, "link": "https://stackoverflow.com/questions/45905744/how-to-deconstruct-an-snat-singletons/46495696#46495696", "title": "How to deconstruct an SNat (singletons)", "body": "<p>From the comments, I'm worried I must be missing something terrifically obvious, but here's my take on it.  The whole point of:</p>\n\n<pre><code>replicate2 :: forall n a. SingI n =&gt; a -&gt; Vec a n\nreplicate2 a = case (sing :: Sing n) of\n  SZero -&gt; VNil\n  SSucc _ -&gt; VCons a (replicate2 a)\n</code></pre>\n\n<p>is that, in order to return <code>VNil :: Vec a 0</code> when the function has general return type <code>Vec a n</code>, you need to specialize the <code>n</code> to <code>0</code>, and pattern-matching on GADTs provides a way to do this, as long as you have a constructor, like <code>SZero</code>, that implies <code>n ~ 0</code>.</p>\n\n<p>Now the <code>SNat</code>s in the singleton package have no such constructor.  The only way to get one, as far as I can see, is to build a whole new singleton type for naturals and implement the necessary type families.  Maybe you can do it in a way that wraps the <code>Nat</code>s, so you're closer to <code>SZero :: Sing (SN 0)</code>, <code>SNonZero :: Sing (SN n)</code> than a Peano construction, but I don't know.</p>\n\n<p>Of course, there's another way to specialize a function that returns <code>Vec a n</code> to return <code>Vec a 0</code>, namely type classes.</p>\n\n<p>If you are willing to abandon some of the explicit singleton machinery and switch to type classes (and also allow overlapping and undecidable instances), the following seems to work.  I had to slightly modify the definition of <code>V</code> to use <code>n :- 1</code> instead of <code>n :+ 1</code>, but I don't <em>think</em> that poses a problem.</p>\n\n<pre><code>{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE GADTs                 #-}\n{-# LANGUAGE KindSignatures        #-}\n{-# LANGUAGE TypeOperators         #-}\n{-# LANGUAGE RankNTypes            #-}\n{-# LANGUAGE ScopedTypeVariables   #-}\n\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE OverlappingInstances  #-}\n{-# LANGUAGE UndecidableInstances  #-}\n\nimport           Data.Singletons\nimport           Data.Singletons.Prelude\nimport           Data.Singletons.TypeLits\n\ndata V :: Nat -&gt; * -&gt; * where\n  Nil  :: V 0 a\n  (:&gt;) :: a -&gt; V (n :- 1) a -&gt; V n a\n\ninfixr 5 :&gt;\n\nclass VC n a where\n  replicateV :: a -&gt; V n a\n\ninstance VC 0 a where\n  replicateV _ = Nil\n\ninstance VC (n :- 1) a =&gt; VC n a where\n  replicateV x = x :&gt; replicateV x\n\ninstance (Show a) =&gt; Show (V n a) where\n  show Nil = \"Nil\"\n  show (x :&gt; v) = show x ++ \" :&gt; \" ++ show v\n\nheadV :: V (n :+ 1) a -&gt; a\nheadV (x :&gt; _) = x\n\ntailV :: ((n :+ 1) :- 1) ~ n =&gt; V (n :+ 1) a -&gt; V n a\ntailV (_ :&gt; v) = v\n\nmain = do print (replicateV False   :: V 0 Bool)\n          print (replicateV 1       :: V 1 Int)\n          print (replicateV \"Three\" :: V 3 String)\n</code></pre>\n"}], "owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 46495696, "answer_count": 2, "score": 9, "last_activity_date": 1506714551, "creation_date": 1503842254, "last_edit_date": 1506211481, "question_id": 45905744, "link": "https://stackoverflow.com/questions/45905744/how-to-deconstruct-an-snat-singletons", "title": "How to deconstruct an SNat (singletons)", "body": "<p>I am experimenting with depedent types in Haskell and came across the following in the <a href=\"http://cs.brynmawr.edu/~rae/papers/2012/singletons/paper.pdf\" rel=\"nofollow noreferrer\">paper</a> of the 'singletons' package:</p>\n\n<pre><code>replicate2 :: forall n a. SingI n =&gt; a -&gt; Vec a n\nreplicate2 a = case (sing :: Sing n) of\n  SZero -&gt; VNil\n  SSucc _ -&gt; VCons a (replicate2 a)\n</code></pre>\n\n<p>So I tried to implement this myself, just toget a feel of how it works:</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE GADTs               #-}\n{-# LANGUAGE KindSignatures      #-}\n{-# LANGUAGE TypeOperators       #-}\n{-# LANGUAGE RankNTypes          #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport           Data.Singletons\nimport           Data.Singletons.Prelude\nimport           Data.Singletons.TypeLits\n\ndata V :: Nat -&gt; * -&gt; * where\n  Nil  :: V 0 a\n  (:&gt;) :: a -&gt; V n a -&gt; V (n :+ 1) a\n\ninfixr 5 :&gt;\n\nreplicateV :: SingI n =&gt; a -&gt; V n a\nreplicateV = replicateV' sing\n  where replicateV' :: Sing n -&gt; a -&gt; V n a\n        replicateV' sn a = case sn of\n            SNat -&gt; undefined -- what can I do with this?\n</code></pre>\n\n<p>Now the problem is that the <code>Sing</code> instance for <code>Nat</code> does not have <code>SZero</code> or <code>SSucc</code>. There is only one constructor called <code>SNat</code>.</p>\n\n<pre><code>&gt; :info Sing\ndata instance Sing n where\n  SNat :: KnownNat n =&gt; Sing n\n</code></pre>\n\n<p>This is different than other singletons that allow matching, such as <code>STrue</code> and <code>SFalse</code>, such as in the following (useless) example:</p>\n\n<pre><code>data Foo :: Bool -&gt; * -&gt; * where\n  T :: a -&gt; Foo True a\n  F :: a -&gt; Foo False a\n\nfoo :: forall a b. SingI b =&gt; a -&gt; Foo b a\nfoo a = case (sing :: Sing b) of\n  STrue -&gt; T a\n  SFalse -&gt; F a\n</code></pre>\n\n<p>You can use <code>fromSing</code> to get a base type, but this of course does allow GHC to check the type of the output vector:</p>\n\n<pre><code>-- does not typecheck\nreplicateV2 :: SingI n =&gt; a -&gt; V n a\nreplicateV2 = replicateV' sing\n  where replicateV' :: Sing n -&gt; a -&gt; V n a\n        replicateV' sn a = case fromSing sn of\n              0 -&gt; Nil\n              n -&gt; a :&gt; replicateV2 a\n</code></pre>\n\n<p>So my question: how to implement <code>replicateV</code>?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>The answer given by erisco explains why my approach of deconstructing an <code>SNat</code> does not work. But even with the <code>type-natural</code> library, I am unable to implement <code>replicateV</code> for the <code>V</code> data type <strong>using GHC's build-in <code>Nat</code> types</strong>.</p>\n\n<p>For example the following code compiles:</p>\n\n<pre><code>replicateV :: SingI n =&gt; a -&gt; V n a\nreplicateV = replicateV' sing\n  where replicateV' :: Sing n -&gt; a -&gt; V n a\n        replicateV' sn a = case TN.sToPeano sn of\n            TN.SZ       -&gt; undefined\n            (TN.SS sn') -&gt; undefined\n</code></pre>\n\n<p>But this does not seem to give enough information to the compiler to infer whether <code>n</code> is <code>0</code> or not. For example the following gives a compiler error:</p>\n\n<pre><code>replicateV :: SingI n =&gt; a -&gt; V n a\nreplicateV = replicateV' sing\n  where replicateV' :: Sing n -&gt; a -&gt; V n a\n        replicateV' sn a = case TN.sToPeano sn of\n            TN.SZ       -&gt; Nil\n            (TN.SS sn') -&gt; undefined\n</code></pre>\n\n<p>This gives the following error:</p>\n\n<pre><code>src/Vec.hs:25:28: error:\n    \u2022 Could not deduce: n1 ~ 0\n      from the context: TN.ToPeano n1 ~ 'TN.Z\n        bound by a pattern with constructor:\n                   TN.SZ :: forall (z0 :: TN.Nat). z0 ~ 'TN.Z =&gt; Sing z0,\n                 in a case alternative\n        at src/Vec.hs:25:13-17\n      \u2018n1\u2019 is a rigid type variable bound by\n        the type signature for:\n          replicateV' :: forall (n1 :: Nat) a1. Sing n1 -&gt; a1 -&gt; V n1 a1\n        at src/Vec.hs:23:24\n      Expected type: V n1 a1\n        Actual type: V 0 a1\n    \u2022 In the expression: Nil\n      In a case alternative: TN.SZ -&gt; Nil\n      In the expression:\n        case TN.sToPeano sn of {\n          TN.SZ -&gt; Nil\n          (TN.SS sn') -&gt; undefined }\n    \u2022 Relevant bindings include\n        sn :: Sing n1 (bound at src/Vec.hs:24:21)\n        replicateV' :: Sing n1 -&gt; a1 -&gt; V n1 a1 (bound at src/Vec.hs:24:9)\n</code></pre>\n\n<p>So, my original problem still remains, I am still unable to do anything usefull with the <code>SNat</code>.</p>\n"}, {"tags": ["haskell", "sublimetext3", "haskell-stack", "hsdev"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1503871458, "post_id": 45905528, "comment_id": 78778152, "body": "The <code>Win32-notify</code> package is just broken. It places no upper bound on <code>Win32</code>, and that package has at some point begun to export the symbol <code>fILE_LIST_DIRECTORY</code>. (I don&#39;t see how <code>hsdev</code> could build on any recent GHC without explicitly giving a specific version of <code>Win32</code> to use, so arguably it is broken as well). As far as building broken packages goes: best you can do is contact the maintainer, and in the meantime, download the source and fix it yourself."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1517122825, "creation_date": 1517122825, "answer_id": 48483981, "question_id": 45905528, "link": "https://stackoverflow.com/questions/45905528/cabal-install-hsdev-fails-on-win32-notify-0-3-0-1/48483981#48483981", "title": "cabal install hsdev fails on win32-notify-0.3.0.1", "body": "<p>This is fixed in recent versions of <code>Win32-notify</code>:</p>\n\n<p><a href=\"https://github.com/haskell-fswatch/win32-notify/commit/0b14cf7065adf80928ab98d7e1a3abd5f992d0c3\" rel=\"nofollow noreferrer\">https://github.com/haskell-fswatch/win32-notify/commit/0b14cf7065adf80928ab98d7e1a3abd5f992d0c3</a></p>\n"}], "owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1517122825, "creation_date": 1503841023, "last_edit_date": 1517122823, "question_id": 45905528, "link": "https://stackoverflow.com/questions/45905528/cabal-install-hsdev-fails-on-win32-notify-0-3-0-1", "title": "cabal install hsdev fails on win32-notify-0.3.0.1", "body": "<p>I'm trying to install hsdev and it is failing on <code>win32-notify-0.3.0.1</code></p>\n\n<pre><code>Failed to install Win32-notify-0.3.0.1\nBuild log ( C:\\Users\\Chris\\AppData\\Roaming\\cabal\\logs\\ghc-8.2.1\\Win32-notify-0.3.0.1-4SkPzVSpsVh3tD4JgoFSXp.log ):\nPreprocessing library for Win32-notify-0.3.0.1..\nBuilding library for Win32-notify-0.3.0.1..\n[1 of 2] Compiling System.Win32.FileNotify ( dist\\build\\System\\Win32\\FileNotify.hs, dist\\build\\System\\Win32\\FileNotify.o )\n\nsrc\\System\\Win32\\FileNotify.hsc:29:9: error:\n    Ambiguous occurrence `fILE_LIST_DIRECTORY'\n    It could refer to either `System.Win32.File.fILE_LIST_DIRECTORY',\n                             imported from `System.Win32.File' at src\\System\\Win32\\FileNotify.hsc:13:1-24\n                          or `System.Win32.FileNotify.fILE_LIST_DIRECTORY',\n                             defined at src\\System\\Win32\\FileNotify.hsc:66:1\n   |\n29 |         fILE_LIST_DIRECTORY -- Access mode\n   |         ^^^^^^^^^^^^^^^^^^^\ncabal: Leaving directory 'C:\\Users\\Chris\\AppData\\Local\\Temp\\cabal-tmp-11528\\Win32-notify-0.3.0.1'\nInstalled unix-compat-0.4.3.1\ncabal.exe: Error: some packages failed to install:\nWin32-notify-0.3.0.1-4SkPzVSpsVh3tD4JgoFSXp failed during the building phase.\nThe exception was:\nExitFailure 1\nfsnotify-0.2.1.1-JyIc8LmykhYJl0khTEfcky depends on fsnotify-0.2.1.1 which\nfailed to install.\n</code></pre>\n\n<p>This is the first time that I have tried to use <code>cabal</code> so any help with debugging this would be appreciated.</p>\n\n<p>Additionally the reason I'm trying to install this is for the SublimeHaskell, it is saying that hsdev cannot be found (I installed haskell via the Haskell-Platform). </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1503839973, "post_id": 45905339, "comment_id": 78769138, "body": "please include the definition of <code>myPredicate</code> - also right now your code is contains multiple errors (<code>MyFunction</code> should be <code>myFunction</code>) , if you are filtering <code>People</code> by <code>[[String]]</code> you need to convert the latter to <code>People</code> by applying the constructor."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 6, "creation_date": 1503840067, "post_id": 45905339, "comment_id": 78769166, "body": "<code>People</code> is defined in terms of <code>[[String]]</code> but is not the same as, nor interchangeable with, <code>[[String]]</code>. It is most definitely not defined <b>as</b> <code>[[String]]</code>."}, {"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503840191, "post_id": 45905339, "comment_id": 78769197, "body": "@epsilonhalbe I&#39;ve edited my post to include the type definition of <code>MyPredicate</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1503840616, "post_id": 45905339, "comment_id": 78769309, "body": "If you want a name that is <i>defined as</i> some type, use a <code>type</code> declaration: <code>type People = [[String]]</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1503840635, "post_id": 45905339, "comment_id": 78769312, "body": "<code>type People = [[String]]</code> creates the alias you are expecting; <code>data People = People [[String]]</code> create an <i>isomorphic</i>, but distinct, type."}], "answers": [{"comments": [{"owner": {"reputation": 2784, "user_id": 1487843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1BFY8.jpg?s=128&g=1", "display_name": "Marc Lambrichs", "link": "https://stackoverflow.com/users/1487843/marc-lambrichs"}, "edited": false, "score": 0, "creation_date": 1503841096, "post_id": 45905489, "comment_id": 78769435, "body": "Actually, is not the myPredicate the compiler is complaining about, but the filter function that expects an array as second argument. I agree with you suggested options, though."}, {"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503890391, "post_id": 45905489, "comment_id": 78781410, "body": "Trying <code>myFunction (strs, People ps) (a1, a2) = filter ((myPredicate a1 strs) (state))</code> results in an error: <code>* Couldn&#39;t match type [Char] with Char Expected type: [String] Actual type: [[String]]</code>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 3, "last_activity_date": 1503842724, "last_edit_date": 1503842724, "creation_date": 1503840682, "answer_id": 45905489, "question_id": 45905339, "link": "https://stackoverflow.com/questions/45905339/x-is-defined-as-y-but-compiler-can-not-match-y-with-x-why/45905489#45905489", "title": "&#39;x&#39; is defined as &#39;y&#39;, but compiler can not match &#39;y&#39; with &#39;x&#39;, why?", "body": "<p>First of all function names as well as variable names have to begin with a lower case letter. So</p>\n\n<ul>\n<li><code>MyFunction</code> => <code>myFunction</code></li>\n<li><code>MyPredicate</code> => <code>myPredicate</code></li>\n</ul>\n\n<p>As you defined</p>\n\n<pre><code>myPredicate :: Int -&gt; [String] -&gt; [String] -&gt; Bool\n</code></pre>\n\n<p><strike>The third argument of <code>myPredicate</code> should be <code>[String]</code>, where you supply a <code>People</code> when you use the function.</strike>\nYou use this function with <code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code> - <code>a</code> is specialized to <code>[String]</code> thus the 2nd argument of <code>filter</code> must be <code>[[String]]</code> but you supply <code>People</code> which is something different.</p>\n\n<p>Now you have 3 options</p>\n\n<ol>\n<li>Change <code>data People..</code> to <code>type People = [[String]]</code></li>\n<li><p>Use pattern matching in the function definition</p>\n\n<pre><code>myFunction :: ([String], People) -&gt; (Int, Int) -&gt; People\nmyFunction (strs,People ps) (x,_) = filter (myPredicate x strs) ps\n</code></pre></li>\n<li><p>write a custom <code>filterPeople</code> function where</p>\n\n<pre><code>filterPeople :: ([String] -&gt; Bool) -&gt; People -&gt; People\n</code></pre></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 3, "last_activity_date": 1503841407, "creation_date": 1503841407, "answer_id": 45905589, "question_id": 45905339, "link": "https://stackoverflow.com/questions/45905339/x-is-defined-as-y-but-compiler-can-not-match-y-with-x-why/45905589#45905589", "title": "&#39;x&#39; is defined as &#39;y&#39;, but compiler can not match &#39;y&#39; with &#39;x&#39;, why?", "body": "<p><code>People</code> is defined in terms of <code>[[String]]</code> but is not the same as, nor interchangeable with, <code>[[String]]</code>.</p>\n\n<p>A data type declaration creates a type that is distinct from all other types. In this simple case, <code>People</code> can be thought of as a wrapped and tagged <code>[[String]]</code>. You need explicit wrapping and unwrapping in order to go from <code>People</code> to <code>[[String]]</code> and back.</p>\n\n<p>Very briefly, the wrapping operation is spelled <code>People</code>:</p>\n\n<pre><code>p = People [[\"Mary\", \"Smith\"], [\"John\", \"Starke\"]]\n</code></pre>\n\n<p>and unnwrapping is done with pattern matching:</p>\n\n<pre><code>printPeople (People ppl) = print ppl\n</code></pre>\n\n<p>If you want a named type that is <em>defined as</em> some other type, use a type declaration:</p>\n\n<pre><code>type People = [[String]]\n</code></pre>\n\n<p>In this case, <code>People</code> becomes fully synonymous with <code>[[String]]</code>.</p>\n"}], "owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1503842724, "creation_date": 1503839668, "last_edit_date": 1503840384, "question_id": 45905339, "link": "https://stackoverflow.com/questions/45905339/x-is-defined-as-y-but-compiler-can-not-match-y-with-x-why", "title": "&#39;x&#39; is defined as &#39;y&#39;, but compiler can not match &#39;y&#39; with &#39;x&#39;, why?", "body": "<p>I have a type defined as such:</p>\n\n<p><code>data People = People [[String]]</code></p>\n\n<p>and a function definition that looks like this:</p>\n\n<pre><code>myFunction :: ([String], People) -&gt; (Int, Int) -&gt; People\nmyFunction first_tuple second_tuple = filter (myPredicate (fst second_tuple) (fst first_tuple)) (snd first_tuple)\n</code></pre>\n\n<p>This gives me the following error:</p>\n\n<pre><code>error:\n* Couldn't match expected type `[[String]]'\n              with actual type `People'\n* In the second argument of `filter', namely `(snd first_tuple)'\n</code></pre>\n\n<p>This has me truly stumped because I tried to be explicit as possible with my brackets and <code>People</code> is clearly defined as <code>[[String]]</code>. What is causing this and why is it the case?</p>\n\n<p>Here is the type signature of <code>myPredicate</code>:</p>\n\n<pre><code>myPredicate :: Int -&gt; [String] -&gt; [String] -&gt; Bool\n</code></pre>\n"}, {"tags": ["haskell", "migration", "renaming"], "owner": {"reputation": 674, "user_id": 7478655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UL7XU.jpg?s=128&g=1", "display_name": "vrom911", "link": "https://stackoverflow.com/users/7478655/vrom911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1503837198, "creation_date": 1503836918, "last_edit_date": 1503837198, "question_id": 45904959, "link": "https://stackoverflow.com/questions/45904959/safecopy-migration-for-data-type-renaming", "title": "Safecopy migration for data type renaming", "body": "<p>I'm working on the project which already have some migration history with libraries <a href=\"http://hackage.haskell.org/package/safecopy\" rel=\"nofollow noreferrer\"><code>safecopy</code></a> and <a href=\"https://hackage.haskell.org/package/safecopy-migrate-0.1.0.0\" rel=\"nofollow noreferrer\"><code>safecopy-migrate</code></a>.\nCurrently the data type is</p>\n\n<pre><code>data Foo = Foo { bar :: String\n               , baz :: String\n               }\n\nderiveSafeCopy 8 'extension ''Foo\n\nchangelog ''Foo (Current 8, Past 7) [\n  Added \"baz\" [hs|mempty|]\n  ]\n\nderiveSafeCopy 7 'base ''Foo_v7\n</code></pre>\n\n<p>I would like just to rename data type name and constructor name </p>\n\n<pre><code>data NewFoo = NewFoo { bar :: String\n                     , baz :: String\n                     }\n</code></pre>\n\n<p>all other stuff is staying the same. What should I change to perform such migration?</p>\n"}, {"tags": ["haskell", "utf-8", "overloaded-strings"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503838677, "post_id": 45904902, "comment_id": 78768796, "body": "Strings (and Text as well, I believe) in GHCi are printed after escaping &quot;funny&quot; chars: this is done as if the user typed <code>putStrLn (show string)</code> where <code>show</code> does the escaping and adds quotes. You can print the naked string/text by <code>putStrLn string</code> (remember to use <code>Data.Text.putStrLn</code> for text, instead of the prelude one)"}, {"owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503842185, "post_id": 45904902, "comment_id": 78769767, "body": "putStrLn in ghci shows the accent correctly, so it must be writeFile?"}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "edited": false, "score": 0, "creation_date": 1503842026, "post_id": 45905054, "comment_id": 78769708, "body": "I opened test.txt in an editor and set the encoding manually to utf8. Still I do not get the accent. How can I tell what encoding writeFile uses?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "edited": false, "score": 0, "creation_date": 1503842752, "post_id": 45905054, "comment_id": 78769958, "body": "I thought it was always UTF-8, but <a href=\"http://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text-IO.html#g:2\" rel=\"nofollow noreferrer\">as per the documentation</a> it actually uses your locale to decide. I strongly recommend you set your locale to UTF-8 and never need to worry about it again. Alternatively you can of course create a bytestring in any encoding you like (just, nowadays <a href=\"http://utf8everywhere.org/\" rel=\"nofollow noreferrer\">you should <i>never</i> use anything but UTF-8</a>, so...)."}, {"owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "edited": false, "score": 0, "creation_date": 1503845260, "post_id": 45905054, "comment_id": 78770736, "body": "Indeed, my locale for my stack haskell installation is not set to utf8. I have no idea how to change that, but one can use &quot;setLocaleEncoding utf8&quot; to change it in the code."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1503842939, "last_edit_date": 1503842939, "creation_date": 1503837640, "answer_id": 45905054, "question_id": 45904902, "link": "https://stackoverflow.com/questions/45904902/utf8-and-overloaded-strings-in-haskell/45905054#45905054", "title": "Utf8 and overloaded strings in Haskell", "body": "<p>This has nothing to do with <code>Data.Text</code>, and certainly not with <code>OverloadedStrings</code> \u2013 both handle UTF-8\u2013Unicode just fine.</p>\n\n<p>However <code>Data.Text.IO</code> will not write a <a href=\"https://en.wikipedia.org/wiki/Byte_order_mark\" rel=\"noreferrer\">BOM</a> or anything that indicates the encoding, i.e. the file really just contains the text as-is. On any modern system, this means it will be in raw UTF-8 form:</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:~$ xxd test.txt \n00000000: 556e 6976 6572 7369 74c3 a9              Universit..\nsagemuej@sagemuej-X302LA:~$ cat test.txt \nUniversit\u00e9\n</code></pre>\n\n<p>So depending on what editor you open the file with, it may guess a wrong encoding, and that's apparently your issue. On Linux, UTF-8 has long been the standard, so no issue here, but Windows isn't so up-to-date. It should be possible to manually select the encoding in any editor, though.</p>\n\n<p>In fact, <code>Data.Text.IO.writeFile</code> will use your <a href=\"https://en.wikipedia.org/wiki/Locale_(computer_software)\" rel=\"noreferrer\">locale</a> to decide how to encode the file. <a href=\"http://utf8everywhere.org/\" rel=\"noreferrer\">Everybody should have UTF-8</a> as their locale nowadays, if you don't please change that.</p>\n\n<p>To get a BOM in your file and thus preclude such issues, use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/System-IO.html#v:utf8_bom\" rel=\"noreferrer\"><code>utf8_bom</code></a>.</p>\n\n<p>Regarding the output you see in GHCi: that's the <code>Show</code> instance at work; it escapes any string-like values to the safest conceivable form, i.e. anything that's not ASCII to an escape sequence, which for <code>'\u00e9'</code> happens to be <code>'\\233'</code>. Again not specific to <code>Text</code>, in fact you get this even for single characters:</p>\n\n<pre><code>Prelude&gt; '\u00e9'\n'\\233'\nPrelude&gt; putChar '\\233'\n\u00e9\n</code></pre>\n\n<p>This escaping never happens when you use the direct-IO-output actions for your string types, i.e. <code>putChar</code>, <code>putStr</code> or <code>putStrLn</code>.</p>\n\n<pre><code>Prelude&gt; import qualified Data.Text.IO as Txt\nPrelude Txt&gt; Txt.putStrLn \"Universit\u00e9\"\nUniversit\u00e9\n</code></pre>\n"}], "owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 0, "accepted_answer_id": 45905054, "answer_count": 1, "score": 3, "last_activity_date": 1503842939, "creation_date": 1503836526, "question_id": 45904902, "link": "https://stackoverflow.com/questions/45904902/utf8-and-overloaded-strings-in-haskell", "title": "Utf8 and overloaded strings in Haskell", "body": "<p>I realized that accents in my texts get converted to \ufffd.\nI boiled it down, to the following example, which\nwrites (and overwrites) the file test.txt.</p>\n\n<p>It uses exclusively methods from Data.Text, which are supposed\nto handle unicode texts. I checked that both the source file \nas well the output file are encoded in utf8. </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Prelude hiding (writeFile)\nimport Data.Text\nimport Data.Text.IO\n\nsomeText :: Text\nsomeText = \"Universit\u00e9\"\n\nmain :: IO ()\nmain = do \n    writeFile \"test.txt\" someText\n</code></pre>\n\n<p>After running the code, test.txt contains: Universit\ufffd.\nIn ghci, I get the following</p>\n\n<pre><code>*Main&gt; someText\n\"Universit\\233\"\n</code></pre>\n\n<p>Is this already encoded incorrectly? I also found a comment on \ufffd in\n<a href=\"https://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text.html</a>,\nbut I still do not know how to correct the example above.</p>\n\n<p>How do I use accents in an OverloadedString and correctly write them to a file?</p>\n"}, {"tags": ["haskell", "integer", "primitive-types", "integer-arithmetic"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503838360, "post_id": 45904898, "comment_id": 78768715, "body": "This could be a bit opinionated, but my criterion would be &quot;if you&#39;d prefer a runtime error to a negative result, choose <code>Natural</code>&quot;"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503841292, "post_id": 45904898, "comment_id": 78769508, "body": "@chi Agree. While we have <code>negate</code> and <code>(-)</code> inside <code>Num</code> type class not much we can do to not allow subtractions."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503839405, "post_id": 45905029, "comment_id": 78768975, "body": "I don&#39;t know what parts (if any) of this are meant sarcastically. I think you should better write clearly what your opinion is."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503840562, "post_id": 45905029, "comment_id": 78769299, "body": "@leftaroundabout I encourage you to add a second answer in a different rhetorical style."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1503841181, "post_id": 45905029, "comment_id": 78769462, "body": "@erisco The reason to pick <code>Natural</code> because of semantic sense is a good reason. But then: why not <code>newtype Natural = Natural Integer</code>? <code>Rational</code> is much-much slower than <code>Integer</code> or <code>Natural</code> because of constant calls to <code>gcd</code> function. But it&#39;s not clear which one \u2014 <code>Natural</code> or <code>Integer</code> \u2014 is slower because of compiler optimizations and inlining and all that stuff. My question is not just &#171;duh, I have two types, emm... what should I use? I&#39;m so stupid, I can&#39;t choose&#187;. But why create such <code>Natural</code> type with such semantic. Why exception instead saturation? What benefits I can gain?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503841710, "post_id": 45905029, "comment_id": 78769621, "body": "@erisco I don&#39;t have a clear opinion on this yet that I could could write. Haskell traditionally does not distinguish positive and general integers through the type system and has fared pretty well with it. I furthermore tend to use only integers that could actually adress/index something in memory, and fast, hence my go-to type is actually <code>Int</code>. But that&#39;s not to say I don&#39;t see why it might make sense to opt for <code>Integer</code> or indeed <code>Natural</code> in some applications, I just don&#39;t know when this is worth it."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1503842180, "post_id": 45905029, "comment_id": 78769765, "body": "@Shersh you offered good reasons based on the implementation of <code>Integer</code> and <code>Natural</code> to be unconvinced that <code>Natural</code> has a use. I have no reason or interest to argue with that. You broadly asked &quot;when and why&quot; to use Natural, however, and so I gave the reason I think is important. This reason has nothing to do with implementation. I have no reason against <code>newtype Natural = Natural Integer</code>. The benefit to me is semantics, not the implementation."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 5, "last_activity_date": 1503837479, "creation_date": 1503837479, "answer_id": 45905029, "question_id": 45904898, "link": "https://stackoverflow.com/questions/45904898/when-to-pick-natural-over-integer-in-haskell/45905029#45905029", "title": "When to pick &#39;Natural&#39; over &#39;Integer&#39; in Haskell?", "body": "<p>I do not see why you want to use <code>Natural</code> or <code>Integer</code>. Why not use <code>Rational</code> instead? It is arbitrary precision, has an optimised runtime representation, and works for naturals, integers, <em>and</em> rationals!</p>\n\n<p>My point is that we should choose a type which makes sense semantically. Lets count the houses on the street with naturals, record our next golf game with integers, and divide a fresh blueberry pie with rationals.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 564, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1503837479, "creation_date": 1503836487, "question_id": 45904898, "link": "https://stackoverflow.com/questions/45904898/when-to-pick-natural-over-integer-in-haskell", "title": "When to pick &#39;Natural&#39; over &#39;Integer&#39; in Haskell?", "body": "<p>Not long ago I've discovered <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Numeric-Natural.html\" rel=\"noreferrer\"><code>Natural</code></a> data type in <code>base</code>. It's supposed to be taken (as it seems to me) when you intend to use non-negative integer type. But it's not exactly clear why should I prefer <code>Natural</code> to <code>Integer</code>. Both types have arbitrary precision, both have quite optimized runtime representation \u2014 <a href=\"http://hackage.haskell.org/package/integer-gmp-1.0.0.1/docs/src/GHC.Integer.Type.html#Integer\" rel=\"noreferrer\"><code>Integer</code> representation</a> and <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.Natural.html#Natural\" rel=\"noreferrer\"><code>Natural</code> representation</a>. But <code>Natural</code> <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.Natural.html#minusNatural\" rel=\"noreferrer\">can throw pure exceptions</a> when you subtract natural numbers and this doesn't really add more typesafety to your code. While <code>Integer</code> is more popular across all packages.</p>\n\n<p>So when and why should I use <code>Natural</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503829466, "post_id": 45903799, "comment_id": 78766449, "body": "It has mothing to do with MyMaybe specifically,  you will get the same result with the standard Maybe. <a href=\"https://ideone.com/VOeZak\" rel=\"nofollow noreferrer\">Demo</a>."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1503829793, "creation_date": 1503829793, "answer_id": 45903979, "question_id": 45903799, "link": "https://stackoverflow.com/questions/45903799/haskell-ambiguous-type-variable-error-on-making-my-data-an-instance-of-eq/45903979#45903979", "title": "Haskell - &quot;Ambiguous&#160;type&#160;variable&quot; error on making my data an instance of Eq", "body": "<p>The problem is that <code>MyMaybe</code> is a parametrised type, but in the expression <code>MyNothing == MyNothing</code>, the compiler can't figure out if you meant <code>MyMaybe Int</code>, <code>MyMaybe String</code>, <code>MyMaybe (Int -&gt; Bool)</code>, or something else.</p>\n\n<p>You can help it with a type annotation like this:</p>\n\n<pre><code>let b1 = MyNothing == (MyNothing :: MyMaybe Int)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 2, "last_activity_date": 1531762009, "last_edit_date": 1531762009, "creation_date": 1503830062, "answer_id": 45904013, "question_id": 45903799, "link": "https://stackoverflow.com/questions/45903799/haskell-ambiguous-type-variable-error-on-making-my-data-an-instance-of-eq/45904013#45904013", "title": "Haskell - &quot;Ambiguous&#160;type&#160;variable&quot; error on making my data an instance of Eq", "body": "<p>The problem is that <code>MyNothing</code> has type <code>MyMaybe a</code> with no restrictions on what <code>a</code> can be.</p>\n\n<p>When you write <code>MyNothing == MyNothing</code>, then the type of <code>(==) :: (Eq b) =&gt; b -&gt; b -&gt; Bool</code> restricts the two <code>MyNothing</code> to have the same type (the compiler initially starts out with <code>MyNothing :: MyMaybe a0</code> and <code>MyNothing :: MyMaybe a1</code>, but then realizes that <code>a0 == a1</code>).</p>\n\n<p>But to resolve <code>==</code> itself, the compiler needs to find the right <code>Eq</code> instance (because that's where <code>==</code> is defined). Our type is <code>MyMaybe a</code>, which is good: We have an <code>Eq (MyMaybe a)</code> instance right there. But it also requires an <code>Eq a</code> instance, which cannot be resolved because we don't know what <code>a</code> is. (It doesn't matter that <code>(Eq a)</code> isn't actually used in the <code>MyNothing == MyNothing</code> case; type checking doesn't pay attention to runtime values.)</p>\n\n<p>This is the point where the compiler gives up, saying it can't resolve the constraint <code>(Eq a0)</code> because the type variable <code>a0</code> is ambiguous.</p>\n\n<hr>\n\n<p>Fixing this is easy. Just give the compiler a hint which type should be used:</p>\n\n<pre><code>let b1 = MyNothing == (MyNothing :: MyMaybe Integer)   -- for example\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>let b1 = MyNothing == (MyNothing :: MyMaybe (Double, [String]))\n</code></pre>\n\n<p>The actual type doesn't really matter (as long as it has an <code>Eq</code> instance).</p>\n\n<hr>\n\n<p>This ambiguity isn't limited to your <code>MyMaybe</code> type. You should get the same error with <code>Maybe</code> (<code>Nothing == Nothing</code>) or <code>[]</code> (<code>[] == []</code>). In all cases there's a polymorphic constant involved (<code>Nothing :: Maybe a</code>, <code>[] :: [a]</code>).</p>\n\n<hr>\n\n<p>Your example does actually work in ghci. This is because ghci uses <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">extended defaulting rules</a> and ends up converting <code>a</code> to <code>()</code>; i.e. the comparison is done as <code>MyNothing == (MyNothing :: MyMaybe ())</code>.</p>\n"}], "owner": {"reputation": 13, "user_id": 4013569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c35bef5a6b69a8a29413518d713fe19?s=128&d=identicon&r=PG&f=1", "display_name": "Nori", "link": "https://stackoverflow.com/users/4013569/nori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "accepted_answer_id": 45903979, "answer_count": 2, "score": 1, "last_activity_date": 1531762009, "creation_date": 1503828299, "last_edit_date": 1592644375, "question_id": 45903799, "link": "https://stackoverflow.com/questions/45903799/haskell-ambiguous-type-variable-error-on-making-my-data-an-instance-of-eq", "title": "Haskell - &quot;Ambiguous&#160;type&#160;variable&quot; error on making my data an instance of Eq", "body": "<p>I'm now learning Haskell and trying to make my data (which is similar to Maybe) an instance of <code>Eq</code>, as follows.</p>\n<pre><code>module Main where\n\ndata MyMaybe a = MyNothing | MyJust a\n\ninstance (Eq a) =&gt; Eq (MyMaybe a) where\n  MyNothing == MyNothing = True\n  MyJust x == MyJust y = x == y\n  _ == _ = False\n\nmain :: IO ()\nmain = do\n  let b0 = MyJust 42 == MyJust 42 -- OK\n  print b0                        -- True\n  let b1 = MyNothing == MyNothing -- Build error!\n  print b1\n</code></pre>\n<p>But the complier returns an error in the line <code>let b1 = MyNothing == MyNothing</code> as follows.</p>\n<blockquote>\n<p>\u00a0\u00a0\u00a0\u00a0?\u00a0Ambiguous\u00a0type\u00a0variable\u00a0\u2018a0\u2019\u00a0arising\u00a0from\u00a0a\u00a0use\u00a0of\u00a0\u2018==\u2019\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0prevents\u00a0the\u00a0constraint\u00a0\u2018(Eq\u00a0a0)\u2019\u00a0from\u00a0being\u00a0solved.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Probable\u00a0fix:\u00a0use\u00a0a\u00a0type\u00a0annotation\u00a0to\u00a0specify\u00a0what\u00a0\u2018a0\u2019\u00a0should\u00a0be.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0These\u00a0potential\u00a0instances\u00a0exist:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0instance\u00a0Eq\u00a0Ordering\u00a0--\u00a0Defined\u00a0in\u00a0\u2018GHC.Classes\u2019</p>\n<p>...</p>\n</blockquote>\n<p>How can I fix it?</p>\n<p>... And I have searched existing questions and answers. The following one seemed close to mine, but I think that my code has already solved the points that the answer suggested.</p>\n<p><a href=\"https://stackoverflow.com/questions/43975200/how-to-instance-eq-without-deriving\">how to instance Eq without deriving</a></p>\n"}, {"tags": ["list", "haskell", "filter"], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 1, "last_activity_date": 1503831691, "last_edit_date": 1503831691, "creation_date": 1503828952, "answer_id": 45903884, "question_id": 45903657, "link": "https://stackoverflow.com/questions/45903657/filter-with-a-predicate-that-takes-more-than-one-argument/45903884#45903884", "title": "Filter with a predicate that takes more than one argument", "body": "<p>Try to move the arguments around a bit:</p>\n\n<pre><code>myFilter :: Int -&gt; [String] -&gt; [[String]] -&gt; [[String]]\n</code></pre>\n\n<p>If I understand the question correctly, you want to filter a <code>[[String]]</code> and return a <code>[[String]]</code>. That fits well with <code>filter</code>, which has the type:</p>\n\n<pre><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Concretely, in this case, <code>a</code> is <code>[String]</code>, so now you need a function with the type <code>[String] -&gt; Bool</code>.</p>\n\n<p>You do, however, need more data than that: the number of matches, and the names to search for, so write a function that also takes these arguments:</p>\n\n<pre><code>pred :: Int -&gt; [String] -&gt; [String] -&gt; Bool\n</code></pre>\n\n<p>You can now <em>partially apply</em> <code>pred</code> with the values you want to search for, e.g. <code>(pred 2 [\"a\", \"f\", \"b\"])</code>. That function will have the type <code>[String] -&gt; Bool</code>, which matches the requirement of <code>filter</code>.</p>\n\n<p>In other words, you should be able to write something like this:</p>\n\n<pre><code>myFilter i target names = filter (pred i target) names\n</code></pre>\n\n<p>You can, if you want to, define <code>pred</code> inside the <code>myFilter</code> function using the <code>where</code> keyword, or using <code>let..in</code> syntax.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1503834039, "creation_date": 1503834039, "answer_id": 45904563, "question_id": 45903657, "link": "https://stackoverflow.com/questions/45903657/filter-with-a-predicate-that-takes-more-than-one-argument/45904563#45904563", "title": "Filter with a predicate that takes more than one argument", "body": "<p>I guess you may do as follows;</p>\n\n<pre><code>myFilter :: Int -&gt; [[String]] -&gt; [String] -&gt; [[String]]\nmyFilter n ass bs = filter (\\as -&gt; n &lt;= length (filter (True ==) ((==) &lt;$&gt; as &lt;*&gt; bs))) ass\n\n*Main&gt; myFilter 2 [[\"a\", \"b\", \"c\"],[\"d\", \"e\", \"f\"]] [\"a\", \"f\", \"b\"]\n[[\"a\",\"b\",\"c\"]]\n</code></pre>\n\n<p>So the <code>as</code> is each item of <code>[[String]]</code> list.</p>\n\n<p><code>(==) &lt;$&gt; as &lt;*&gt; bs)</code> part works like; <code>(==) &lt;$&gt; as</code> would convert <code>as</code> into an applicative list functor like <code>[(==\"a\"), (==\"b\"), (==\"c\")]</code> and then we apply each function in the applicative to every item of <code>bs</code> like <code>[(==\"a\"), (==\"b\"), (==\"c\")] &lt;*&gt; [\"a\", \"f\", \"b\"]</code> which results <code>[True,False,False,False,False,True,False,False,False]</code> and we filter True values and check the length to see if it's <code>&gt;= n</code>.</p>\n\n<p>I hope it is clear.</p>\n"}], "owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 45903884, "answer_count": 2, "score": 2, "last_activity_date": 1503834039, "creation_date": 1503827195, "last_edit_date": 1503832045, "question_id": 45903657, "link": "https://stackoverflow.com/questions/45903657/filter-with-a-predicate-that-takes-more-than-one-argument", "title": "Filter with a predicate that takes more than one argument", "body": "<p>I have a list of items that need to be filtered based on a predicate function. The predicate function requires more than one argument to successfully return a result.</p>\n\n<p>Here is my function type declaration, for the function that needs to return the filtered list:</p>\n\n<p><code>myFilter :: Int -&gt; [[String]] -&gt; [String] -&gt; [[String]]</code></p>\n\n<p><code>[[String]]</code> is the list that needs to be filtered, and is a list of names of people. A name of a person is represented as follows <code>[\"FirstName\", \"MiddleName\", \"LastName\"]</code>.</p>\n\n<p><code>[String]</code> is the name of an individual, for example <code>[\"Bob\", \"Jane\", \"Alice\"]</code>.</p>\n\n<p>What I need is to <strong>filter out all names that do not have at least Int number of same names as the individual name</strong>.</p>\n\n<p>For example, if I were to call</p>\n\n<p><code>myFilter 2 [[\"a\", \"b\", \"c\"],[\"d\", \"e\", \"f\"]] [\"a\", \"f\", \"b\"]</code></p>\n\n<p>I would get </p>\n\n<p><code>[[\"a\", \"b\", \"c\"]]</code> because <code>[\"d\", \"e\", \"f\"]</code> does not have at least 2 names in common with <code>[\"a\", \"f\", \"b\"]</code>.</p>\n\n<p>I plan to use this as part of a larger program that allows a user to manage a list of people. One of the functions of this program will be searching by name, returning a list of all people that have name matches based on a user entered integer parameter.</p>\n\n<p>I know of the <code>filter</code> function, but it seems like the predicate function should only ever be of the type <code>p :: Bool</code>. As you can see my predicate is more complex.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 2, "creation_date": 1503804843, "post_id": 45901387, "comment_id": 78761662, "body": "The moment your parser looks for a <code>Chunk</code>, it is going to slurp up all remaining characters, since its rule is <code>many1 anyChar</code>.  You will need to change the rule to disallow the sequence <code>&lt;&lt;</code>, which is the start of a <code>Key</code>.  However, if while parsing a <code>Key</code>, you encounter something other than a letter before seeing the <code>&gt;&gt;</code>, you have to decide if that&#39;s an error or if you want to back-track and just treat it as another <code>Chunk</code>."}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1503805124, "post_id": 45901387, "comment_id": 78761690, "body": "@pat I understand how that <code>many1 anyChar</code> is too greedy, but, correct me if I&#39;m wrong, wouldn&#39;t it be weird for <code>Chunk</code> to need to encode a concept of <code>Key</code>&#39;s syntax (IE stop on <code>&lt;&lt;</code>)?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503810390, "post_id": 45901387, "comment_id": 78762365, "body": "@Josh.F It depends on your desired semantics. Is <code>&quot;&lt;&lt;&quot;</code> a valid string? How about <code>&quot;&lt;&lt; &lt;&lt; &gt;&gt;&quot;</code> or <code>&quot;&lt;&lt; foo&quot;</code>? Regardless, separate parsing/lexing steps are the way to go here (in reality, this simple example consists only of lexing and a little bit of cleanup on the result; if this isn&#39;t a vastly oversimplified version of what you&#39;re trying to do, forgo a parser altogether). Lexing should produce something like <code>[Tok &quot;hi&quot;, OpenBrace, Tok &quot;x&quot;, CloseBrace, ...]</code> after which the &#39;parsing&#39; step is entirely trivial."}], "answers": [{"comments": [{"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1503848830, "post_id": 45903930, "comment_id": 78771780, "body": "works! hey also, I know for more involved parsing, things that look ahead or backtrack are inefficient, and obviated by doing multiple passes. I&#39;ve tried multiple pass approaches, but then I haven&#39;t been able to figure out how to use Parsec on tokens, instead of chars/strings. Could you point me in the right direction?"}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 1, "last_activity_date": 1503829727, "last_edit_date": 1503829727, "creation_date": 1503829267, "answer_id": 45903930, "question_id": 45901387, "link": "https://stackoverflow.com/questions/45901387/how-can-i-interpolate-values-into-a-string-based-on-a-key-token-using-parsec-ha/45903930#45903930", "title": "How can I interpolate values into a string based on a key token using Parsec (Haskell)?", "body": "<p>You can use <code>notFollowedBy</code> to say that you want a chunk to include a\ncharacter as long as it isn't a key.  <code>notFollowedBy</code> doesn't consume\ninput so <code>prose</code> will still go on to parse the key again as its own item.</p>\n\n<pre><code>chunk = Chunk &lt;$&gt; many1 (notFollowedBy key &gt;&gt; anyChar)\n</code></pre>\n\n<p>This will allow even things like <code>aaa&lt;&lt;bbbbbb</code> to be parsed as a chunk,\nby going all the way to the end of the file, not finding a closing\n<code>&gt;&gt;</code>, deciding that it must not have been a key and therefore it can\nbe part of the chunk.</p>\n\n<p>If you would rather have <code>&lt;&lt;</code> always be the start of a key and fail if\nit isn't closed, disallow <code>&lt;&lt;</code> from the chunk:</p>\n\n<pre><code>chunk = Chunk &lt;$&gt; many1 (notFollowedBy (string \"&lt;&lt;\") &gt;&gt; anyChar)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 0, "last_activity_date": 1568077012, "last_edit_date": 1568077012, "creation_date": 1567180915, "answer_id": 57729994, "question_id": 45901387, "link": "https://stackoverflow.com/questions/45901387/how-can-i-interpolate-values-into-a-string-based-on-a-key-token-using-parsec-ha/57729994#57729994", "title": "How can I interpolate values into a string based on a key token using Parsec (Haskell)?", "body": "<p><a href=\"https://hackage.haskell.org/package/replace-megaparsec/\" rel=\"nofollow noreferrer\">replace-megaparsec</a>\nis a library for doing search-and-replace with parsers. The\nsearch-and-replace function is\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:streamEdit\" rel=\"nofollow noreferrer\"><code>streamEdit</code></a>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Replace.Megaparsec\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport Data.Char\n\nkey = between (string \"&lt;&lt;\") (string \"&gt;&gt;\") (many letterChar) :: Parsec Void String String\neditor k = \"Key \" ++ (fmap toUpper k)\n\nstreamEdit key editor \"hi &lt;&lt;x&gt;&gt; ! Do you like &lt;&lt;y&gt;&gt;?\"\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\"hi Key X ! Do you like Key Y?\"\n</code></pre>\n\n<p>You can also get the intermediate separated strings with the\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:sepCap\" rel=\"nofollow noreferrer\"><code>sepCap</code></a>\nparser combinator, which returns a structure equivalent to the <code>[Merge]</code>\nthat you were trying to build.</p>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 45903930, "answer_count": 2, "score": 1, "last_activity_date": 1568077012, "creation_date": 1503803887, "last_edit_date": 1503804390, "question_id": 45901387, "link": "https://stackoverflow.com/questions/45901387/how-can-i-interpolate-values-into-a-string-based-on-a-key-token-using-parsec-ha", "title": "How can I interpolate values into a string based on a key token using Parsec (Haskell)?", "body": "<p>I'm new to the world of parsing, and have a fairly simple-seeming problem:</p>\n\n<p>I have a long string comprised of <code>Chunk</code>s of normal text, and <code>Key</code>s that are encoded like <code>&lt;&lt;key-label&gt;&gt;</code>.</p>\n\n<pre><code>data Merge a = Chunk a\n             | Key a\n  deriving (Show)\n\nkey :: Parser (Merge String)\nkey = Key &lt;$&gt; between (string \"&lt;&lt;\") (string \"&gt;&gt;\") (many1 letter)\n\nchunk :: Parser (Merge String)\nchunk = Chunk &lt;$&gt; many1 anyChar\n\nprose = many1 $ key &lt;|&gt; chunk\n\nex = parseTest prose \"hi &lt;&lt;x&gt;&gt; ! Do you like &lt;&lt;y&gt;&gt;?\"\n\n-- Returns: \n-- [Chunk \"hi &lt;&lt;x&gt;&gt; ! Do you like &lt;&lt;y&gt;&gt;?\"]\n\n-- I'd like:\n-- [Chunk \"hi \", Key \"x\", Chunk \" !\", ...]\n</code></pre>\n\n<p>I'd like to replace those keys with values, but I can solve that if I can  parse a string into my tokens, IE <code>String -&gt; [Merge]</code>.</p>\n\n<p>I've dived into the boundless depths that is lexing/parsing, and while I hope to learn all of it eventually, any guidance on solving this problem now?</p>\n\n<p>This is the simplest instantiation of my attempts, although I have tried separate passes over the data, including separate lexing/parsing steps, and I'd <em>like</em> to use <code>parsec</code> instead of a more concrete interpolation lib.</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503803359, "post_id": 45901314, "comment_id": 78761477, "body": "What should the actual output of your function be, as well as its type? If you know your input is always the same input, why even have input at all? It seems to me this can be reduced to taking all the permutations with replacement of a certain length of a list (e.g. <code>[&quot;1&quot;, &quot;2&quot;]</code>), then just zipping each of those with the other input."}, {"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503803896, "post_id": 45901314, "comment_id": 78761535, "body": "@user2407038 I&#39;ve added some extra information to the post. The &quot;input&quot; won&#39;t really be input but rather hardcoded into the <code>init</code> function."}, {"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503808911, "post_id": 45901314, "comment_id": 78762192, "body": "Explain the downvotes please?"}], "answers": [{"comments": [{"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503815791, "post_id": 45902110, "comment_id": 78763264, "body": "This is helpful but not exactly correct. There are more combinations than just what the cartesian product gives. The cartesian product would result in <code>[[&quot;A1&quot;,&quot;B1&quot;,&quot;C1&quot;],[&quot;A2&quot;,&quot;B2&quot;,&quot;C2&quot;]]</code>. However, the letters need not be in order, and some letters might not appear in one of the results at all. <code>[&quot;C1&quot;, &quot;B2&quot;, &quot;B1&quot;]</code> is also a valid combination."}, {"owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "reply_to_user": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503816962, "post_id": 45902110, "comment_id": 78763510, "body": "@JavascriptLoser Just <a href=\"https://stackoverflow.com/a/30285491/8387889\">pick 3</a> from the list of six"}, {"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503818031, "post_id": 45902110, "comment_id": 78763724, "body": "I&#39;m not sure I understand what you mean, but using code from the question you linked, <code>arrange 3 [&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;1&quot;,&quot;2&quot;]</code> gives me ALMOST what I need. An example of a list generated by that function is <code>[&quot;1&quot;, &quot;B&quot;, &quot;A&quot;]</code>. I need 3 pairs, where a pair is one letter and one number. I&#39;m not sure how to combine the code you&#39;ve written and the code from that question."}, {"owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "reply_to_user": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503818226, "post_id": 45902110, "comment_id": 78763768, "body": "<code>import Control.Monad;  pick :: Int -&gt; [a] -&gt; [[a]]; pick 0 _ = [[]]; pick _ [] = []; pick n (x:xs) = map (x:) (pick (n-1) xs) ++ pick n xs;  combos = liftM2 (++); init = pick 3 $ combos [&quot;A&quot;,&quot;B&quot;,&quot;C&quot;] [&quot;1&quot;,&quot;2&quot;];</code>"}, {"owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "reply_to_user": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503818297, "post_id": 45902110, "comment_id": 78763783, "body": "Hm, don&#39;t know how to do line breaks here. But the important part is <code>init = pick 3 $ combos [&quot;A&quot;,&quot;B&quot;,&quot;C&quot;] [&quot;1&quot;,&quot;2&quot;]</code>."}, {"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503818474, "post_id": 45902110, "comment_id": 78763820, "body": "My compiler is giving me a type error for the <code>combos</code> function. What is the type declaration?"}, {"owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "reply_to_user": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503818538, "post_id": 45902110, "comment_id": 78763838, "body": "<code>combos :: [String] -&gt; [String] -&gt; [[String]]</code>"}, {"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503818823, "post_id": 45902110, "comment_id": 78763913, "body": "This gives me ` * Couldn&#39;t match type Char with [Char]       Expected type: [String] -&gt; [String] -&gt; [[String]]         Actual type: [[String]] -&gt; [[String]] -&gt; [[String]]     * In the expression: liftM2 (++)       In an equation for combos&#39;: combos = liftM2 (++)`"}, {"owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "reply_to_user": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503818983, "post_id": 45902110, "comment_id": 78763960, "body": "Oops, that was wrong. It&#39;s actually <code>combos :: Monad m =&gt; m [a] -&gt; m [a] -&gt; m [a]</code>"}, {"owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "reply_to_user": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503819148, "post_id": 45902110, "comment_id": 78764015, "body": "Oh, although specifically in this instance <code>combos :: [String] -&gt; [String] -&gt; String]</code> should be what actually works. Your input should be something like [&quot;A&quot;,&quot;B&quot;,&quot;C&quot;]."}], "tags": [], "owner": {"reputation": 335, "user_id": 8387889, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytIoDLa0WGg/AAAAAAAAAAI/AAAAAAAAAcg/PoU425sbyWw/photo.jpg?sz=128", "display_name": "Andrew Lei", "link": "https://stackoverflow.com/users/8387889/andrew-lei"}, "is_accepted": true, "score": 1, "last_activity_date": 1503813622, "creation_date": 1503813622, "answer_id": 45902110, "question_id": 45901314, "link": "https://stackoverflow.com/questions/45901314/combine-two-tuples-with-a-nested-list-comprehension/45902110#45902110", "title": "Combine two tuples with a nested list comprehension", "body": "<p>Is it always a 3-tuple and a 2-tuple? If so, you might as well just do a direct computation:</p>\n\n<pre><code>getInit (a,b,c) (x,y) =\n  [ (a++x,b++x,c++y)\n  , (a++y,b++y,c++y)\n  ]\n</code></pre>\n\n<p>But if you can use lists instead, there are several ways of performing a <a href=\"https://stackoverflow.com/questions/4119730/cartesian-product-of-2-lists-in-haskell\">Cartesian product</a>:</p>\n\n<pre><code>[[x++y | x &lt;- [\"A\",\"B\",\"C\"]] | y &lt;- [\"1\",\"2\"]]\n</code></pre>\n\n<p>Or, if you prefer monads to list comprehensions:</p>\n\n<pre><code>import Control.Monad\n\ncombos = liftM2 (++)\ninit = combos [\"A\",\"B\",\"C\"] [\"1\",\"2\"]\n</code></pre>\n"}], "owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1081, "favorite_count": 0, "accepted_answer_id": 45902110, "answer_count": 1, "score": 0, "last_activity_date": 1503816225, "creation_date": 1503802485, "last_edit_date": 1503816225, "question_id": 45901314, "link": "https://stackoverflow.com/questions/45901314/combine-two-tuples-with-a-nested-list-comprehension", "title": "Combine two tuples with a nested list comprehension", "body": "<p>I have an interesting problem to figure out involving nested list comprehensions. I will redact unnecessary details for this post, as such the problem I'm trying to solve may seem a little peculiar. </p>\n\n<p>I have two tuples as follows <code>(\"X\", \"Y\", \"Z\")</code> and <code>(\"1\", \"2\")</code>. The contents of these will only ever be as written above.</p>\n\n<p>Using these two lists, I need to construct a list of 3-tuples, <strong>with every combination of the contents of the above two lists</strong>. An example of one of these tuples would be <code>(\"X2\", \"Z2\", \"Y1)</code>. Note the numbers always come after the letters.</p>\n\n<p>I know I need to use a list comprehension for this, but it seems like I need to have a nested list comprehension somehow, which I am not familiar with.</p>\n\n<p>I started with this:</p>\n\n<p><code>[(comb1, comb2, comb2) | {- What goes here? -}]</code></p>\n\n<p>I am not sure how to proceed. How can I solve this problem with a nested list comprehension? I believe a nested list comprehension is the best way to solve this problem but if you know of a better way please explain that instead.</p>\n\n<p><strong>EDIT with some further details:</strong></p>\n\n<p>This list of tuples will be output by a function that would look something like this:</p>\n\n<pre><code>init :: [(String, String, String)]\ninit = [(comb1, comb2, comb3) | {- What goes here? -}]\n</code></pre>\n\n<p>The return value from the init function will be used in the context of a larger program that will need to perform tasks on this list of 3-tuples. The actual two tuples, <code>(\"X\", \"Y\", \"Z\")</code> and <code>(\"1\", \"2\")</code>, will be hardcoded into the list comprehension of the <code>init</code> function. </p>\n\n<p>There are more combinations than just what a cartesian product gives. The cartesian product would result in <code>[[\"X1\",\"Y1\",\"Z1\"],[\"X2\",\"Y2\",\"Z2\"]]</code>. However, the letters need not be in order, and some letters might not appear in one of the results at all. <code>[\"Z1\", \"X2\", \"X1\"]</code> is also a valid combination</p>\n"}, {"tags": ["haskell", "haskeline"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503801627, "post_id": 45900897, "comment_id": 78761266, "body": "<code>displayS</code> will work on Windows only if the terminal supports it and <code>ansi-terminal</code> is able to detect that fact. This is also true of <code>displayIO</code>, the difference being that <code>displayIO</code> lives in <code>IO</code> and so can more aggressively attempt to cajole whatever <code>Handle</code> you&#39;ve given it into a form where the ANSI code will work. Whether either one works in practice is a matter of exactly how you end up using your program."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503801746, "post_id": 45900897, "comment_id": 78761283, "body": "Anyways, if you want the best chance of things working, you should probably write your own display function - it will be like <a href=\"https://hackage.haskell.org/package/ansi-wl-pprint-0.6.8.1/docs/src/Text-PrettyPrint-ANSI-Leijen-Internal.html#displayIO\" rel=\"nofollow noreferrer\"><code>displayIO</code></a>, but replacing calls with <code>hPutStr</code> with the print function given to you by haskeline."}, {"owner": {"reputation": 813, "user_id": 1333945, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5ba8a397763592097387117373dbb13a?s=128&d=identicon&r=PG", "display_name": "Nathan Ringo", "link": "https://stackoverflow.com/users/1333945/nathan-ringo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503801969, "post_id": 45900897, "comment_id": 78761315, "body": "I thought the issue was that if the user enters input when an SGR is set, there&#39;ll be garbling; I don&#39;t think that&#39;ll be fixed by reimplementing <code>displayIO</code>, right?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503803033, "post_id": 45900897, "comment_id": 78761448, "body": "<code>hSetSGR</code> is already checking if it will actually work; if that check happens to be a false positive, there is nothing you can really do to prevent garbling (this problem isn&#39;t related to haskeline at all). I suppose you could have a flag to explicitly disable <code>hSetSGR</code>, to be very sure you can avoid garbling if you happen to be using a terminal which won&#39;t support ANSI codes, but for which the checks done by <code>ansi-terminal</code> are likely to be false positives."}, {"owner": {"reputation": 813, "user_id": 1333945, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5ba8a397763592097387117373dbb13a?s=128&d=identicon&r=PG", "display_name": "Nathan Ringo", "link": "https://stackoverflow.com/users/1333945/nathan-ringo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503803294, "post_id": 45900897, "comment_id": 78761473, "body": "I can try to reproduce the issue I can foresee happening on Monday, but I&#39;m still pretty sure that the user&#39;s input could still get mis-styled as a result of mixing the two."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503803626, "post_id": 45900897, "comment_id": 78761502, "body": "Indeed, a minimal verifiable example complete with the environment in which you run it is a much more concrete question than this current one. The behaviour of the functions in question is extremely sensitive to the environment they run in, so there simply isn&#39;t a solution which will work in every possible situation."}], "owner": {"reputation": 813, "user_id": 1333945, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5ba8a397763592097387117373dbb13a?s=128&d=identicon&r=PG", "display_name": "Nathan Ringo", "link": "https://stackoverflow.com/users/1333945/nathan-ringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1503796188, "creation_date": 1503796188, "question_id": 45900897, "link": "https://stackoverflow.com/questions/45900897/using-ansi-wl-pprint-with-haskeline", "title": "Using ansi-wl-pprint with haskeline", "body": "<p>How does one use <a href=\"https://hackage.haskell.org/package/ansi-wl-pprint\" rel=\"nofollow noreferrer\">ansi-wl-pprint</a> with <a href=\"https://hackage.haskell.org/package/haskeline\" rel=\"nofollow noreferrer\">haskeline</a>, without losing Windows support?</p>\n\n<p>ansi-wl-pprint has two ways to output a <code>SimpleDoc</code>:</p>\n\n<pre><code>(\\doc -&gt; displayS doc \"\") :: SimpleDoc -&gt; String\ndisplayIO stdout :: SimpleDoc -&gt; IO ()\n</code></pre>\n\n<p>However, the documentation warns that <code>displayS</code> does not work on Windows (<code>cmd.exe</code> doesn't implement ANSI escape sequences?).</p>\n\n<p><code>displayIO</code> doesn't use haskeline's print functions, however:</p>\n\n<pre><code>outputStr :: MonadIO m =&gt; String -&gt; InputT m ()\noutputStrLn :: MonadIO m =&gt; String -&gt; InputT m ()\ngetExternalPrint :: MonadException m =&gt; InputT m (String -&gt; IO ())\n</code></pre>\n\n<p>The closest thing to a solution I can see right now is:</p>\n\n<pre><code>outputPretty :: (MonadException m, MonadIO m, Pretty p) =&gt; p -&gt; InputT m ()\noutputPretty p = getExternalPrint &gt;&gt;= doPrint \n  where doc = renderPretty 0.4 80 $ pretty p\n        doPrint print = liftIO . print $ displayS doc \"\"\n</code></pre>\n\n<p>However, if <code>displayS</code> doesn't work on Windows, I'd prefer not to use it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1503792612, "post_id": 45900408, "comment_id": 78760282, "body": "Why do you care how fast something never happens?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503793868, "post_id": 45900408, "comment_id": 78760447, "body": "As far as I know, strict and non-strict types have different in-memory representations, so the <code>unsafeCoerce</code> hack will basically never work."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1503797590, "post_id": 45900408, "comment_id": 78760836, "body": "@Cirdec, <code>never</code> never <i>returns</i>, but that&#39;s okay. For <code>Stream (a,) m r</code>, <code>never</code> is an infinite stream of <code>mempty</code> values. Is it <i>important</i>? That I couldn&#39;t say."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503797933, "post_id": 45900408, "comment_id": 78760861, "body": "@user2407038, I&#39;ll have to experiment, but that doesn&#39;t sound right (except when there&#39;s unboxing, which there isn&#39;t here). Each non-unboxed field containing a value of a lifted type is a pointer to a closure representing a value of that type. The runtime keeps track of whether it&#39;s evaluated or not, but I don&#39;t <i>think</i> it knows if it&#39;s a strict field."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503798149, "post_id": 45900408, "comment_id": 78760880, "body": "I just realized one possible safe compromise would be to use a longer loop: <code>never = fix $ Step . pure . Step . pure . ... . Effect . return</code>. This follows more pointers than I&#39;d like and I don&#39;t know what a CPU will think of it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503799580, "post_id": 45900408, "comment_id": 78761032, "body": "It looks like I was wrong (at least, I can&#39;t find an example for which I was right). I thought that evaluating <code>never</code> would use the semantics of <code>Stream</code> and not <code>StreamL</code>, but in hindsight this couldn&#39;t possibly make sense - the runtime knows nothing of types, so the <code>unsafeCoerce</code>d value can&#39;t magically change its evaluation semantics. (I suppose things could still break if some other library code assumes that it takes input which is strict in <code>Step</code>, but I don&#39;t see how one could make use of such an assumption)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503804077, "post_id": 45900408, "comment_id": 78761556, "body": "@user2407038, I think <code>pure</code> would have to reach into the <code>StepL</code>. The only ways I can think of doing that are with <code>unsafeCoerce</code> and with the magical version of <code>deepseq</code> used for compact regions. It&#39;s hard to imagine why <code>pure</code> would ever do either of these to its argument."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503960317, "post_id": 45900408, "comment_id": 78815280, "body": "What I would worry about with <code>Never</code> is not the small overhead of monadic actions (which are often even optimized away) but of an asymptotic bad case like <code>msum [never, never, never, never, something, never, never, never, never]</code> (etc) which does a lot of work maintaining the nevers because it can&#39;t see into the future.  To solve this you could adapt <code>Stream</code> (wrap it up in a transfomer of sorts) to explicitly represent <code>Never</code> so that you can collapse them away when they are combined.  I wouldn&#39;t try this without an actual performance problem case and a profiler, though."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503998239, "post_id": 45900408, "comment_id": 78828343, "body": "@luqui, I acknowledge that this may not be the most practically important efficiency concern, but it&#39;s kind of sad. With my generality hat on, I imagine inefficient monads, like strict-spined lists without rewrite rules."}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 7, "last_activity_date": 1503865067, "creation_date": 1503789070, "last_edit_date": 1503865067, "question_id": 45900408, "link": "https://stackoverflow.com/questions/45900408/can-i-tie-a-knot-in-a-strict-data-type", "title": "Can I tie a knot in a strict data type?", "body": "<p>The streaming package defines</p>\n\n<pre><code>data Stream f m r = Step !(f (Stream f m r))\n                  | Effect (m (Stream f m r))\n                  | Return r\n</code></pre>\n\n<p>Its implementation of <code>empty</code>, called <code>never</code>, is defined</p>\n\n<pre><code>never :: (Monad m, Applicative f)\n      =&gt; Stream f m r\nnever = let loop = Effect (return (Step (pure loop))) in loop\n</code></pre>\n\n<p>That's all very monadic for something essentially pure, something the library generally tries to avoid for performance reasons. The obvious pure version would be</p>\n\n<pre><code>never = let loop = Step (pure loop) in loop\n</code></pre>\n\n<p>Unfortunately, since <code>Step</code> is strict, this will blow up for a functor with a strict <code>pure</code>, such as <code>Identity</code>. Is there any way around this? My only idea is absurdly unsafe, and I don't know if it can go horribly wrong.</p>\n\n<pre><code>data StreamL f m r = StepL (f (StreamL f m r))\n                   | EffectL (m (StreamL f m r))\n                   | ReturnL r\n\nnever :: forall f m r. Applicative f =&gt; Stream f m r\nnever = case loop of\n          StepL x -&gt; x `pseq` unsafeCoerce loop\n   where\n     loop :: StreamL f m r\n     loop = StepL (pure loop)\n     {-# NOINLINE loop #-}\n{-# NOINLINE never #-}\n</code></pre>\n\n<p>The idea is to build something just like <code>never</code>, but with a lazy <code>StepL</code> constructor. Then make sure everything is actually forced and magic it into the stricter type.</p>\n"}, {"tags": ["haskell", "recursion", "algebra", "algebraic-data-types", "category-theory"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1503798246, "post_id": 45900358, "comment_id": 78760891, "body": "Sure, you can write <code>RoseF(A,-) = A * List(-)</code> where <code>List(A)= \u03bc (ListF(A))</code>, but I&#39;m guessing you&#39;re looking for a non-recursive algebra. If so, there is no such algebra (in <code>Set-&gt;Set</code>). Perhaps it exists in another category (consider your statement: &quot;there are two recursions&quot;)? This property of lacking a non-recursive algebra makes a type <i>non-regular</i> (or <i>non-uniform</i>, or <i>nested</i>, perhaps others..). Note this has nothing to do with mutual recursion (and <code>Rose</code> is only mutually recursive in a trivial way, since <code>Forest</code> is the identity)."}, {"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "edited": false, "score": 2, "creation_date": 1503822490, "post_id": 45900358, "comment_id": 78764732, "body": "Thanks for the comments, but I&#39;m a bit confused because <a href=\"https://books.google.ro/books?id=MN6kjutl2BcC&amp;lpg=PA77&amp;ots=xddEU9qtIc&amp;dq=rose%20tree%20non%20regular%20data%20types&amp;pg=PA77#v=onepage&amp;q=rose%20tree%20non%20regular%20data%20types&amp;f=false\" rel=\"nofollow noreferrer\">this reference</a> suggests that rose trees are a regular data type (&quot;a recursive, parameterised type whose recursive definition does not involve a change of the type parameter&quot;)."}, {"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503822525, "post_id": 45900358, "comment_id": 78764752, "body": "My motivation for looking for the initial algebra of the rose trees was to help me derive properties of rose tree, such as, the universal property of fold or the fusion law. @user2407038 Is your formulation based on the recursive algebra sufficient in this regard?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503838173, "post_id": 45900358, "comment_id": 78768666, "body": "The type above is indeed regular (I misread it, first -- I deleted my misleading comments)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1503858142, "post_id": 45900358, "comment_id": 78774650, "body": "You got <i>Jeremy Gibbons</i> to join SO to remark on your question. You should be proud."}, {"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503868526, "post_id": 45900358, "comment_id": 78777553, "body": "@dfeuer Ha-ha :-) I was indeed very pleasantly surprised to see Prof. Gibbons answer, especially since my inquiry into the world of initial algebras and rose trees started with his <a href=\"https://www.cs.ox.ac.uk/jeremy.gibbons/publications/origami.pdf\" rel=\"nofollow noreferrer\">Origami Programming</a> paper and his <a href=\"https://skillsmatter.com/skillscasts/5787-categories-for-the-working-haskeller\" rel=\"nofollow noreferrer\">Categories for the Working Programmer</a> talk. Maybe this is a good time to thank Prof. Gibbons for his work, which I always find interesting and highly instructive :-)"}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 4956000, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a58e7c6cf4b4a3756deffa6711867adc?s=128&d=identicon&r=PG&f=1", "display_name": "fsestini", "link": "https://stackoverflow.com/users/4956000/fsestini"}, "is_accepted": false, "score": 2, "last_activity_date": 1503837550, "creation_date": 1503837550, "answer_id": 45905045, "question_id": 45900358, "link": "https://stackoverflow.com/questions/45900358/initial-algebra-for-rose-trees/45905045#45905045", "title": "Initial algebra for rose trees", "body": "<p>As you noticed, the definition of the functor for <code>Rose a</code> is trickier due to the fact that the recursive occurrence of the type is fed into a <code>List</code>. The problem is that <code>List</code> is itself a recursive type obtained as a fixed point. <code>List (Rose a)</code> basically corresponds to an \"arbitrary number of elements of <code>Rose a</code>\", something that you cannot express with a signature of products and sums alone, hence the need for additional abstraction over these multiple recursive points.</p>\n\n<p>A functor <code>F A - : * -&gt; *</code> will not work, as we would need to find something such that </p>\n\n<pre><code>F A X \u2243 A \u00d7 (1 + X \u00d7 List X)\nF A X \u2243 A \u00d7 (1 + X \u00d7 (1 + X \u00d7 List X))\nF A X \u2243 A \u00d7 (1 + X \u00d7 (1 + X \u00d7 (1 + X \u00d7 List X)))\n...\n</code></pre>\n\n<p>One way to do it is to just treat <code>List</code> as primitive. Then <code>Rose a</code> is just the fixed point of </p>\n\n<pre><code>RoseF A : * -&gt; * = \u03bb X . A \u00d7 List X\n</code></pre>\n\n<p>Another, more interesting way is to follow the suggestion in the reference you posted, and notice that the type of <code>Rose a</code> can be generalized to abstract over the functor in which the recursive occurrence is fed into</p>\n\n<pre><code>GRose F A \u2243 A \u00d7 F (GRose F A)\n</code></pre>\n\n<p>now <code>GRose</code> has type <code>(* -&gt; *) -&gt; (* -&gt; *)</code>, hence it is an higher order functor mapping an endofunctor into another one. In our example, it would map the functor <code>List</code> into the type of rose trees.</p>\n\n<p>Notice however that GRose is still recursive, so the above is actually stating an isomorphism rather than a solution to our problem. We can try to fix (wink wink) this by additionally abstracting over the recursive point</p>\n\n<pre><code>HRose G F A = A \u00d7 F (G F A)\n</code></pre>\n\n<p>Notice that now <code>HRose</code> is a regular higher-order functor of type <code>((* -&gt; *) -&gt; (* -&gt; *)) -&gt; (* -&gt; *) -&gt; (* -&gt; *)</code>, hence it maps higher-order functors into higher-order functors. Computing the least fixed point of <code>HRose</code> gives us</p>\n\n<pre><code>\u03bc(HRose) F A \u2243 A \u00d7 F (\u03bc(HRose) F A)\n</code></pre>\n\n<p>So if we put <code>Rose \u2261 \u03bc(HRose) List</code>, we get</p>\n\n<pre><code>Rose A \u2243 A \u00d7 List (Rose A)\n</code></pre>\n\n<p>which is exactly the defining equation for rose trees.\nYou can find many further examples of the theory and practice of generic programming using fixed points over higher-order functors. <a href=\"http://www.staff.city.ac.uk/~ross/papers/gfold.html\" rel=\"nofollow noreferrer\">Here</a>, for example, Bird and Paterson develop it in the context of nested datatypes (but the definitions clearly hold in general). They also show the systematic construction of folds over datatypes defined in such way, as well as various laws.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503859363, "post_id": 45905082, "comment_id": 78774993, "body": "Could you elaborate on why <code>Rose :: Type -&gt; Type</code> was lost in the first definition?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503865786, "post_id": 45905082, "comment_id": 78776839, "body": "When you write <i>something</i> :: <i>Sometype</i>, you assert that the <i>something</i> is a thing. When you define <code>Rose a</code> as a <code>type</code> synonym, you define all the substitution instances of <code>Rose a</code>, but you do not define <code>Rose</code> itself. Similarly, <code>Functor Rose</code> is ill formed, as <code>Rose</code> is unapplied. If you define unapplied <code>Rose</code> by <code>type</code> or <code>Rose a</code> as a <code>data</code> type, then you do get that <code>Rose</code> itself is a thing and has type <code>Type -&gt; Type</code>."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 14, "last_activity_date": 1503837851, "creation_date": 1503837851, "answer_id": 45905082, "question_id": 45900358, "link": "https://stackoverflow.com/questions/45900358/initial-algebra-for-rose-trees/45905082#45905082", "title": "Initial algebra for rose trees", "body": "<p>I would discourage talk of \"the Hask Category\" because it subconsciously conditions you against looking for other categorical structure in Haskell programming.</p>\n\n<p>Indeed, rose trees can be seen as the fixpoint of an endofunctor on types-and-functions, a category which we might be better to call <code>Type</code>, now that <code>Type</code> is the type of types. If we give ourselves some of the usual functor kit...</p>\n\n<pre><code>newtype K a   x = K a deriving Functor           -- constant functor\nnewtype P f g x = P (f x, g x) deriving Functor  -- products\n</code></pre>\n\n<p>...and fixpoints...</p>\n\n<pre><code>newtype FixF f = InF (f (FixF f))\n</code></pre>\n\n<p>...then we may take</p>\n\n<pre><code>type Rose a = FixF (P (K a) [])\npattern Node :: a -&gt; [Rose a] -&gt; Rose a\npattern Node a ars = InF (P (K a, ars))\n</code></pre>\n\n<p>The fact that <code>[]</code> is itself recursive does not prevent its use in the formation of recursive datatypes via <code>Fix</code>. To spell out the recursion explicitly, we have nested fixpoints, here with bound variable names chosen suggestively:</p>\n\n<pre><code>Rose a = \u03bcrose. a * (\u03bclist. 1 + (rose * list))\n</code></pre>\n\n<p>Now, by the time we've arrived in the second fixpoint, we have a type formula</p>\n\n<pre><code>1 + (rose * list)\n</code></pre>\n\n<p>which is functorial (indeed, strictly positive) in both <code>rose</code> and <code>list</code>. One might say it is a <code>Bifunctor</code>, but that's unnecessary terminology: it's a functor from <code>(Type, Type)</code> to <code>Type</code>. You can make a <code>Type -&gt; Type</code> functor by taking a fixpoint in the second component of the pair, and that's just what happened above. </p>\n\n<p>The above definition of <code>Rose</code> loses an important property. It is not true that</p>\n\n<pre><code>Rose :: Type -&gt; Type   -- GHC might say this, but it's lying\n</code></pre>\n\n<p>merely that <code>Rose x :: Type</code> if <code>x :: Type</code>. In particular,</p>\n\n<pre><code>Functor Rose\n</code></pre>\n\n<p>is not a well typed constraint, which is a pity, as intuitively, rose trees ought to be functorial in the elements they store.</p>\n\n<p>You can fix this by building <code>Rose</code> as itself being the fixpoint of a <code>Bifunctor</code>. So, in effect, by the time we get to lists, we have <em>three</em> type variables in scope, <code>a</code>, <code>rose</code> and <code>list</code>, and we have functoriality in all of them. You need a <em>different</em> fixpoint type constructor, and a <em>different</em> kit for building <code>Bifunctor</code> instances: for <code>Rose</code>, life gets easier because the <code>a</code> parameter is not used in the inner fixpoint, but in general, to define bifunctors as fixpoints requires trifunctors, and off we go!</p>\n\n<p><a href=\"https://stackoverflow.com/a/45257691/828361\">This answer</a> of mine shows how to fight the proliferation by showing how <em>indexed</em> types are <em>closed</em> under a fixpoint-of-functor construction. That's to say, work not in <code>Type</code> but in <code>i -&gt; Type</code> (for the full variety of index types <code>i</code>) and you're ready for mutual recursion, GADTs, and so on.</p>\n\n<p>So, zooming out, rose trees are given by mutual fixpoints, which have a perfectly sensible categorical account, provided you see which categories are actually at work.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1503838017, "creation_date": 1503838017, "answer_id": 45905104, "question_id": 45900358, "link": "https://stackoverflow.com/questions/45900358/initial-algebra-for-rose-trees/45905104#45905104", "title": "Initial algebra for rose trees", "body": "<p>You seem to understand how this is modelled</p>\n\n<pre><code>data List a = Nil | Cons a (List a)\n</code></pre>\n\n<p>by taking, for any given <code>A</code>, the initial algebra of the endofunctor <code>F(A, -) = 1 + A \u00d7 (-)</code>. Let's call this initial algebra <code>L(A)</code>.</p>\n\n<p>If we forget the morphism in <code>L(A)</code>, we can sat that <code>L(A)</code> is an object of our category. Better, <code>L(-)</code> is not only a mapping from objects to objects, but can be seen as an endofunctor.</p>\n\n<p>Once <code>L</code> is seed as an endofunctor, the recursive type</p>\n\n<pre><code>data Rose a = Node a (List (Rose a))\n</code></pre>\n\n<p>is interpreted by taking, for any <code>A</code>m the initial algebra of the functor</p>\n\n<pre><code>G A = A * L A\n</code></pre>\n\n<p>which is a functor obtained by composing <code>L</code> and <code>*</code> (and the diagonal functor).\nHence, the same approach works.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1503858312, "post_id": 45906904, "comment_id": 78774697, "body": "How far can you go with the commutativity of <code>*</code>? Can you end up with performance problems rearranging too much?"}, {"owner": {"reputation": 381, "user_id": 878141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29cf867724b176bf0db8b9d4609f5de7?s=128&d=identicon&r=PG", "display_name": "Jeremy Gibbons", "link": "https://stackoverflow.com/users/878141/jeremy-gibbons"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1503953642, "post_id": 45906904, "comment_id": 78813076, "body": "This transformation certainly changes complexity. You can see it as a &quot;spine representation&quot; of a binary trees - for example, the &quot;right spine representation&quot; splits the tree along all the right edges, into a list of left children (each itself a tree) and one last element. Then you can get fast access to the &quot;bottom right corner&quot; of the tree."}], "tags": [], "owner": {"reputation": 381, "user_id": 878141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29cf867724b176bf0db8b9d4609f5de7?s=128&d=identicon&r=PG", "display_name": "Jeremy Gibbons", "link": "https://stackoverflow.com/users/878141/jeremy-gibbons"}, "is_accepted": false, "score": 5, "last_activity_date": 1503850367, "creation_date": 1503850367, "answer_id": 45906904, "question_id": 45900358, "link": "https://stackoverflow.com/questions/45900358/initial-algebra-for-rose-trees/45906904#45906904", "title": "Initial algebra for rose trees", "body": "<p>This is not really an answer to the question you're asking, but perhaps interesting anyway. Note that with</p>\n\n<pre><code>Rose a = a * List (Rose a)\nList a = 1 + a * List a\n</code></pre>\n\n<p>and the fact that <code>*</code> distributes over <code>+</code>, you have</p>\n\n<pre><code>  Rose a \n=   {- definition of `Rose` -}\n  a * List (Rose a)\n=   {- definition of `List` -}\n  a * (1 + Rose a * List (Rose a))\n=   {- `*` distributes over `+` -}\n  a + a * Rose a * List (Rose a)\n=   {- `*` is commutative -}\n  a + Rose a * a * List (Rose a)\n=   {- definition of `Rose` -}\n  a + Rose a * Rose a\n</code></pre>\n\n<p>(the equality really denotes isomorphism). So you might as well have defined</p>\n\n<pre><code>Rose a = a + Rose a * Rose a\n</code></pre>\n\n<p>or in Haskell,</p>\n\n<pre><code>data Rose a = Leaf a | Bin (Rose a) (Rose a)\n</code></pre>\n\n<p>Which is to say, rose trees are isomorphic to ordinary (leaf-labelled) binary trees, and which clearly form a normal initial algebra. </p>\n"}], "owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 781, "favorite_count": 3, "accepted_answer_id": 45905082, "answer_count": 4, "score": 9, "last_activity_date": 1503850367, "creation_date": 1503788556, "question_id": 45900358, "link": "https://stackoverflow.com/questions/45900358/initial-algebra-for-rose-trees", "title": "Initial algebra for rose trees", "body": "<p>As far as I understand, recursive data types from Haskell correspond to initial algebras of endofunctors from the <code>Hask</code> category [<a href=\"https://en.wikipedia.org/wiki/Initial_algebra#Use_in_computer_science\" rel=\"noreferrer\">1</a>, <a href=\"https://bartoszmilewski.com/2017/02/28/f-algebras/\" rel=\"noreferrer\">2</a>]. For example:</p>\n\n<ul>\n<li>Natural numbers, <code>data Nat = Zero | Succ Nat</code>, correspond to the initial algebra of the endofunctor <code>F(-) = 1 + (-)</code>.</li>\n<li>Lists, <code>data List a = Nil | Cons a (List a)</code>, correspond to the initial algebra of the endofunctor <code>F(A, -) = 1 + A \u00d7 (-)</code>.</li>\n</ul>\n\n<p>However, it's not clear to me what the endofunctor corresponding to the rose trees should be:</p>\n\n<pre><code>data Rose a = Node a (List (Rose a))\n</code></pre>\n\n<p>What confuses me is that there are two recursions: one for the rose tree and the other for the list. According to my calculations, I would get the following functor, but it doesn't seem right:</p>\n\n<pre><code>F(A, \u2022, -) = A \u00d7 (1 + (-) \u00d7 (\u2022))\n</code></pre>\n\n<hr>\n\n<p>Alternatively, rose trees can be defined as mutually recursive data types:</p>\n\n<pre><code>data Rose a   = Node a (Forest a)\ntype Forest a = List (Rose a)\n</code></pre>\n\n<p>Do mutually recursive data types have an interpretation in category theory?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1503785696, "post_id": 45900076, "comment_id": 78759156, "body": "Probably stack compiles with some flags. Can you show the stack file?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1503785713, "post_id": 45900076, "comment_id": 78759164, "body": "Can you please link the package you used for this, and also post your (minimal) <code>Main.hs</code> that you are compiling?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8521857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb05890bf8f9b4e99c4f1747714d051?s=128&d=identicon&r=PG&f=1", "display_name": "Marilyn", "link": "https://stackoverflow.com/users/8521857/marilyn"}, "edited": false, "score": 0, "creation_date": 1503970063, "post_id": 45901048, "comment_id": 78817391, "body": "I realized that ghc and stack were using different versions of the same package. Thanks!"}], "tags": [], "owner": {"reputation": 231, "user_id": 5824635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c43dd400f3c9c2cbaeb8986532cd359b?s=128&d=identicon&r=PG&f=1", "display_name": "homura", "link": "https://stackoverflow.com/users/5824635/homura"}, "is_accepted": true, "score": 1, "last_activity_date": 1503798314, "creation_date": 1503798314, "answer_id": 45901048, "question_id": 45900076, "link": "https://stackoverflow.com/questions/45900076/why-is-it-possible-to-build-a-haskell-program-with-hs-files-that-fail-to-compil/45901048#45901048", "title": "Why is it possible to build a Haskell program with .hs files that fail to compile individually?", "body": "<p>The .cabal file specifies several language extensions: <code>other-extensions:    BangPatterns, FlexibleInstances, MultiParamTypeClasses, TypeSynonymInstances</code></p>\n\n<p>You can enabled these on a per file basis by putting: <code>{-# LANGUAGE BangPatterns, FlexibleInstances, ... #-}</code> at the top of your source file. You can also pass <code>-XBangPatterns -XFlexibleInstances ...</code> to ghc, although this is discouraged.</p>\n"}], "owner": {"reputation": 13, "user_id": 8521857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb05890bf8f9b4e99c4f1747714d051?s=128&d=identicon&r=PG&f=1", "display_name": "Marilyn", "link": "https://stackoverflow.com/users/8521857/marilyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 45901048, "answer_count": 1, "score": 0, "last_activity_date": 1503798314, "creation_date": 1503785542, "last_edit_date": 1503793259, "question_id": 45900076, "link": "https://stackoverflow.com/questions/45900076/why-is-it-possible-to-build-a-haskell-program-with-hs-files-that-fail-to-compil", "title": "Why is it possible to build a Haskell program with .hs files that fail to compile individually?", "body": "<p>I am relatively new to Haskell and the compile/build process. I cloned a Haskell package from Github that builds using a cabal file. I can build the program no problem using <code>stack build</code>, <code>stack install</code> etc. </p>\n\n<p>Currently I am interested in using the functions in only the Rewrite.hs file in the Haskell package, but I cannot successfully compile it by importing Rewrite to my own Main.hs and calling <code>ghc Main.hs</code>. I get the following type errors:</p>\n\n<pre><code>Rewrite.hs:73:13: error:\n    \u2022 Expecting one more argument to \u2018Module\u2019\n      Expected a type, but \u2018Module\u2019 has kind \u2018* -&gt; *\u2019\n    \u2022 In the type signature:\n        stripTop :: Module -&gt; Module\n\nRewrite.hs:16:29: error:\n    \u2022 Expecting one more argument to \u2018Pat\u2019\n      Expected a type, but \u2018Pat\u2019 has kind \u2018* -&gt; *\u2019\n    \u2022 In the type signature:\n        findPats :: Data a =&gt; a -&gt; [Pat]\n</code></pre>\n\n<p>I thought that building a package basically compiles and links files together - Why is it possible to have compiler errors for parts of a program when compiling by hand? Alternatively, should I not be attempting to use a .hs file from a part of a program like this?</p>\n\n<p>EDITED:</p>\n\n<p>The package is <a href=\"https://github.com/Genetic-Strictness/Autobahn\" rel=\"nofollow noreferrer\">https://github.com/Genetic-Strictness/Autobahn</a></p>\n\n<p>An example of Main:</p>\n\n<pre><code>import Rewrite\nimport System.FilePath\nimport Language.Haskell.Exts\n\nfile ::FilePath\nfile = \"test.hs\"\n\nmain = placesToStrict file\n</code></pre>\n\n<p>where the function <code>placesToStrict</code> is from Rewrite which calls on <code>findPats</code>, which causes the compiler errors above.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1503776205, "post_id": 45899009, "comment_id": 78757214, "body": "Did you just put that <code>comb letters numbers</code> expression in the middle of your file?"}, {"owner": {"reputation": 133, "user_id": 5338731, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ds9sU.jpg?s=128&g=1", "display_name": "remington howell", "link": "https://stackoverflow.com/users/5338731/remington-howell"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1503776347, "post_id": 45899009, "comment_id": 78757245, "body": "It is at the very bottom of my file. I declare the lists, write the code, and then have the comb letters numbers line"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 4, "last_activity_date": 1503776737, "creation_date": 1503776737, "answer_id": 45899091, "question_id": 45899009, "link": "https://stackoverflow.com/questions/45899009/haskell-zip-two-lists-together/45899091#45899091", "title": "Haskell zip two lists together", "body": "<p>You can't just put expressions in a file. In other words, you don't need <code>comb</code>; your problem could be reduced to</p>\n\n<pre><code>2 + 2\n</code></pre>\n\n<p>What you probably should do is load the file in the interactive interpreter of your choice (<code>ghci</code>) and then type expressions there, which will work.</p>\n\n<p>Or you could provide a definition for <code>main</code> in your file:</p>\n\n<pre><code>main = print (comb letters numbers)\n</code></pre>\n\n<p>This should allow it to be compiled into an executable successfully.</p>\n\n<p>But the point is, a file is a series of declarations. The entry point for your program is a symbol called <code>main</code>. Whatever you define <code>main</code> as is what gets run when you start your program (and that thing must be an IO action, such as the one returned by <code>print</code>).</p>\n"}], "owner": {"reputation": 133, "user_id": 5338731, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ds9sU.jpg?s=128&g=1", "display_name": "remington howell", "link": "https://stackoverflow.com/users/5338731/remington-howell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1197, "favorite_count": 0, "accepted_answer_id": 45899091, "answer_count": 1, "score": 0, "last_activity_date": 1503776737, "creation_date": 1503776112, "question_id": 45899009, "link": "https://stackoverflow.com/questions/45899009/haskell-zip-two-lists-together", "title": "Haskell zip two lists together", "body": "<p>I'm trying to zip two lists together but I cannot for the life of me figure out why it won't run the code. I have two lists declared as variables, and I've written a function to combine them together.</p>\n\n<pre><code>letters = [\"a\",\"b\",\"c\"]\nnumbers = [\"1\",\"2\",\"3\"]\n\ncomb :: [a] -&gt; [b] -&gt; [(a,b)]\ncomb _ [] = []\ncomb [] _ = []\ncomb (x:xs)(y:ys) = (x,y):comb xs ys\n</code></pre>\n\n<p>My hope here is that this code will recursively combine the pairs into tuples, but I'm very new to Haskell so I'm not even sure if what I've written is functional (the compiler doesn't complain about it). </p>\n\n<p>My issue comes up when I try to run the code with this line,</p>\n\n<pre><code>comb letters numbers\n</code></pre>\n\n<p>and the compiler tells me \"Parse error: module header, import declaration or top-level declaration expected.\" I'm not sure what I'm supposed to declare here. Can I please have some assistance?</p>\n"}, {"tags": ["string", "list", "haskell", "combinations"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1503769918, "last_edit_date": 1503769918, "creation_date": 1503769296, "answer_id": 45898097, "question_id": 45897994, "link": "https://stackoverflow.com/questions/45897994/how-to-combine-two-different-type-of-lists-in-haskell/45898097#45898097", "title": "How to combine two different type of lists in haskell", "body": "<p><code>show :: Char -&gt; String</code> will indeed put single quotes around the character:</p>\n\n<pre><code>*Main&gt; show 'A'\n\"'A'\"\n</code></pre>\n\n<p>But since a <code>type String = [Char]</code>, we can use:</p>\n\n<pre><code>combine :: Int -&gt; Char -&gt; String\ncombine i c = c : show i\n</code></pre>\n\n<p>So here we construct a list of characters with <code>c</code> as the head (the first character), and <code>show i</code> (the representation of the integer) as tail.</p>\n\n<p>Now we can use list comprehension to make a combination of two lists:</p>\n\n<pre><code>combine_list :: [Int] -&gt; [Char] -&gt; [String]\ncombine_list is cs = [combine i c | c &lt;- cs, i &lt;- is]\n</code></pre>\n\n<p>This then generates the output:</p>\n\n<pre><code>*Main&gt; combine_list [1,2,3]  ['A','B','C']\n[\"A1\",\"A2\",\"A3\",\"B1\",\"B2\",\"B3\",\"C1\",\"C2\",\"C3\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1503770652, "last_edit_date": 1503770652, "creation_date": 1503770318, "answer_id": 45898248, "question_id": 45897994, "link": "https://stackoverflow.com/questions/45897994/how-to-combine-two-different-type-of-lists-in-haskell/45898248#45898248", "title": "How to combine two different type of lists in haskell", "body": "<p>You may do as follows;</p>\n\n<pre><code>combiner :: [Char] -&gt; [Int] -&gt; [String]\ncombiner cs xs = (:) &lt;$&gt; cs &lt;*&gt; (show &lt;$&gt; xs)\n\n*Main&gt; combiner ['A','B','C'] [1,2,3]\n[\"A1\",\"A2\",\"A3\",\"B1\",\"B2\",\"B3\",\"C1\",\"C2\",\"C3\"]\n</code></pre>\n\n<p>Here <code>(:) &lt;$&gt; cs</code> (where <code>&lt;$&gt;</code> is infix <code>fmap</code>) will construct an applicative list functor while <code>show &lt;$&gt; xs</code> is like <code>map show xs</code> yielding <code>[\"1\",\"2\",\"3\"]</code> and by <code>&lt;*&gt;</code> we just apply the applicative list to <code>[\"1\",\"2\",\"3\"]</code> resulting <code>[\"A1\",\"A2\",\"A3\",\"B1\",\"B2\",\"B3\",\"C1\",\"C2\",\"C3\"]</code></p>\n"}], "owner": {"reputation": 63, "user_id": 8397335, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-c0MK9xQXSLc/AAAAAAAAAAI/AAAAAAAAAF4/-nKKH3p-4K4/photo.jpg?sz=128", "display_name": "Clark16", "link": "https://stackoverflow.com/users/8397335/clark16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 527, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1503772451, "creation_date": 1503768528, "last_edit_date": 1503772451, "question_id": 45897994, "link": "https://stackoverflow.com/questions/45897994/how-to-combine-two-different-type-of-lists-in-haskell", "title": "How to combine two different type of lists in haskell", "body": "<p>How can I combine two different types of lists and traverse the result in Haskell?</p>\n\n<p>For example:</p>\n\n<pre><code>input: [1,2,3]  ['A','B','C'],\noutput: [\"A1\",\"A2\",\"A3\",\"B1\",\"B2\",\"B3\",\"C1\",\"C2\",\"C3\"].\n</code></pre>\n\n<p>I tried making an example using <code>Int</code> and <code>Char</code>, like:</p>\n\n<pre><code>combine :: Int -&gt; Char -&gt; String\ncombine a b = show b ++ show a\n</code></pre>\n\n<p>This doesn't work, however, because if I use this function for <code>combine 3 'A'</code>, the output will be <code>\"'A'3\"</code>, not <code>\"A3\"</code>.</p>\n"}, {"tags": ["haskell", "compilation", "linker", "ghc", "archlinux"], "comments": [{"owner": {"reputation": 1, "user_id": 8516102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l4tPj.jpg?s=128&g=1", "display_name": "Python Bin", "link": "https://stackoverflow.com/users/8516102/python-bin"}, "edited": false, "score": 0, "creation_date": 1503760993, "post_id": 45896933, "comment_id": 78752616, "body": "it passed using GHCi."}, {"owner": {"reputation": 1, "user_id": 8516102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l4tPj.jpg?s=128&g=1", "display_name": "Python Bin", "link": "https://stackoverflow.com/users/8516102/python-bin"}, "edited": false, "score": 0, "creation_date": 1503761029, "post_id": 45896933, "comment_id": 78752625, "body": "the content of trace.hs seems doesn&#39;t matter at all."}, {"owner": {"reputation": 1, "user_id": 8516102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l4tPj.jpg?s=128&g=1", "display_name": "Python Bin", "link": "https://stackoverflow.com/users/8516102/python-bin"}, "edited": false, "score": 0, "creation_date": 1503761054, "post_id": 45896933, "comment_id": 78752635, "body": "It failed to compile just today."}, {"owner": {"reputation": 1, "user_id": 8516102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l4tPj.jpg?s=128&g=1", "display_name": "Python Bin", "link": "https://stackoverflow.com/users/8516102/python-bin"}, "edited": false, "score": 0, "creation_date": 1503761184, "post_id": 45896933, "comment_id": 78752677, "body": "the reinstallation was succeed."}, {"owner": {"reputation": 1, "user_id": 8516102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l4tPj.jpg?s=128&g=1", "display_name": "Python Bin", "link": "https://stackoverflow.com/users/8516102/python-bin"}, "edited": false, "score": 0, "creation_date": 1503761207, "post_id": 45896933, "comment_id": 78752681, "body": "reinstall with no new updates."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1503763596, "post_id": 45896933, "comment_id": 78753385, "body": "Link errors on arch are not uncommon iirc, there is something broken about the way arch is packaging Haskell libraries.  I think <a href=\"https://bugs.archlinux.org/task/54561\" rel=\"nofollow noreferrer\">this bug</a> is related."}], "owner": {"reputation": 1, "user_id": 8516102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l4tPj.jpg?s=128&g=1", "display_name": "Python Bin", "link": "https://stackoverflow.com/users/8516102/python-bin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1503761478, "creation_date": 1503760930, "last_edit_date": 1503761478, "question_id": 45896933, "link": "https://stackoverflow.com/questions/45896933/failed-to-compile-haskell-source-using-ghc-link-error", "title": "Failed to compile haskell source using GHC, link error", "body": "<p>I'm new to Haskell. with GHC, I tried to compile:</p>\n\n<p>trace.hs, a simple ray tracer (content may doesn't matter):</p>\n\n<pre><code>import System.IO\nimport System.Process\nimport Linear.V3\nimport Linear.Metric\nimport Linear.Vector\nimport Control.Applicative\nimport Control.Monad\n\ntype Scalar = Double\ntype Vector = V3 Scalar\ntype Distance = Scalar\ntype Position = Vector\ntype Direction = Vector\ntype Arrow = Vector\ntype Color = Vector\ndata Ray = Ray Position Direction\n\n\ntrace :: Ray -&gt; Color\ntrace (Ray origin direction) = direction\n\ncolorToInt x = round $ 255 * sqrt x\n\nmain = do\n  let image = \"image.ppm\"\n      (nx, ny) = (40, 40)\n      eyepos = V3 0 0 0\n      genRay dir = Ray eyepos $ normalize dir\n      rayGen sx sy = genRay $ V3 sx sy 1\n      rayOf x y = let fi = fromIntegral in\n                      rayGen (fi x / fi nx + 0.5)\n                             (fi y / fi ny + 0.5)\n      rays = rayOf &lt;$&gt; [0..nx-1] &lt;*&gt; [0..ny-1]\n      result = map (fmap colorToInt) . map trace $ rays\n\n  handle &lt;- openFile image WriteMode\n  let put = hPutStrLn handle\n\n  put \"P3\"\n  put $ show nx ++ ' ' : show ny\n  put \"255\"\n\n  forM_ result $ \\(V3 r g b) -&gt; do\n    put $ show r ++ ' ' : show g ++ ' ' : show b\n\n  hClose handle\n  system $ \"display \" ++ image\n  return ()\n</code></pre>\n\n<p><strong>but error occurred</strong>:</p>\n\n<pre><code>bate@archbin:~/hsrt/vuee$ ghc --make trace.hs\nLinking trace ...\n/usr/local/bin/ld: cannot find -lHSlens-4.15.4-L23zn92GAPI1hUmidWzY63\n/usr/local/bin/ld: cannot find -lHSvector-0.12.0.1-692PQMDMB6pIQ1uGwefDcQ\n/usr/local/bin/ld: cannot find -lHSth-abstraction-0.2.5.0-IQJC3onXzKuCarhyL6pEOQ\n/usr/local/bin/ld: cannot find -lHSreflection-2.1.2-1Oix9U9tVVU4sCEhxeh8Kr\n/usr/local/bin/ld: cannot find -lHSparallel-3.2.1.1-KQJHWCcq2Ka569Stb10nhx\n\n...\n\n/usr/local/bin/ld: cannot find -lHSStateVar-1.1.0.4-8WOljMLP9CI2EkNoKyIopY\n/usr/local/bin/ld: cannot find -lHSstm-2.4.4.1-iSYwp3RMY11sHCifJ3gtR\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\nbate@archbin:~/hsrt/vuee$ \nbate@archbin:~/hsrt/vuee$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 8.0.2\nbate@archbin:~/hsrt/vuee$ \nbate@archbin:~/hsrt/vuee$ ls /usr/lib/libHS*\n/usr/lib/libHSadjunctions-4.3-IiXaMJ9VhRwGggTqHGtSLU-ghc8.0.2.so\n/usr/lib/libHSaeson-1.1.2.0-8R262j8BseM7FTnCfGfbwu-ghc8.0.2.so\n/usr/lib/libHSaeson-compat-0.3.7.1-BegDnMRPSO7KSvclD5A4Lc-ghc8.0.2.so\n/usr/lib/libHSansi-wl-pprint-0.6.8-442hsaqSoAVL7JUQ0ogC39-ghc8.0.2.so\n\n...\n</code></pre>\n\n<p>I'm on Arch Linux, i686, with package ghc, ghc-static installed.</p>\n\n<p>The error occur since I've reinstalled GHC using\n<code>sudo pacman -S ghc ghc-static</code></p>\n\n<p>the error seems to be caused by Linear.*</p>\n\n<p>I've tried remove /usr/local/bin $PATH, but nothing well.</p>\n\n<p>In /usr/lib, I found libHS<em>ghc-8.0.2.so.\nIt seems ghc didn't tell ld to -lHS</em>ghc-8.0.2, why?</p>\n\n<p>How should I fix this?</p>\n"}, {"tags": ["haskell", "drag-and-drop", "threepenny-gui"], "answers": [{"tags": [], "owner": {"reputation": 115, "user_id": 3104709, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/1024e3e3b2fd978f7804c91aeea3b67d?s=128&d=identicon&r=PG&f=1", "display_name": "m0.o", "link": "https://stackoverflow.com/users/3104709/m0-o"}, "is_accepted": true, "score": 3, "last_activity_date": 1503757549, "creation_date": 1503757549, "answer_id": 45896430, "question_id": 45896067, "link": "https://stackoverflow.com/questions/45896067/threepenny-gui-dragndrop-access-dragdata/45896430#45896430", "title": "Threepenny-GUI: Drag&#39;n&#39;Drop - Access DragData", "body": "<p>I got it:</p>\n\n<pre><code>on UI.drop field $ \\dragData -&gt; do\n    d &lt;- read dragData\n</code></pre>\n\n<p>Maybe it helps someone else ;)</p>\n"}], "owner": {"reputation": 115, "user_id": 3104709, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/1024e3e3b2fd978f7804c91aeea3b67d?s=128&d=identicon&r=PG&f=1", "display_name": "m0.o", "link": "https://stackoverflow.com/users/3104709/m0-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 45896430, "answer_count": 1, "score": 4, "last_activity_date": 1503757549, "creation_date": 1503755116, "question_id": 45896067, "link": "https://stackoverflow.com/questions/45896067/threepenny-gui-dragndrop-access-dragdata", "title": "Threepenny-GUI: Drag&#39;n&#39;Drop - Access DragData", "body": "<p>I am currently struggling with getting access to the <code>DragData</code> of the dragged element when the <code>on UI.drop</code> is called. I have something like this:</p>\n\n<pre><code>tile &lt;- UI.new\n    # set UI.draggable True\n    # set UI.dragData (show player)\n\nfield &lt;- UI.new\n    # set UI.droppable True\n\non UI.drop field $ \\_ -&gt; do\n    -- How to receive the DragData here?\n</code></pre>\n\n<p>Can somebody help me? Thanks in advance!</p>\n\n<p>Greetings,\nMoritz</p>\n"}, {"tags": ["user-interface", "haskell"], "comments": [{"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1503736012, "post_id": 45893402, "comment_id": 78745972, "body": "There&#39;s nothing called <code>option</code> in your code. What do you want the <code>option</code> function to do exactly?"}, {"owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "reply_to_user": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1503736340, "post_id": 45893402, "comment_id": 78746031, "body": "I just wanted to loop back before &quot;case&quot; If user enters bad option, so he can enter a new option"}, {"owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "reply_to_user": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1503736366, "post_id": 45893402, "comment_id": 78746035, "body": "I didnt want to call whole main function again."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "edited": false, "score": 0, "creation_date": 1503736550, "post_id": 45893471, "comment_id": 78746081, "body": "I wanted to loop back. Thank you. :]"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1503736238, "last_edit_date": 1503736238, "creation_date": 1503735884, "answer_id": 45893471, "question_id": 45893402, "link": "https://stackoverflow.com/questions/45893402/haskell-seperate-main-do-into-blocks/45893471#45893471", "title": "Haskell - seperate main = do into blocks", "body": "<p>I don't completely understand the question but perhaps you are looking for something like this.</p>\n\n<pre><code>main = do\n  putStrLn \"Enter expression:\"\n  expression &lt;- getLine\n\n  putStrLn \"Enter a number from 1 to 5:\"\n  putStrLn \"1. Convert to Postfix\"\n  putStrLn \"2. Convert to Prefix\"\n  putStrLn \"3. Convert to Binary Expression Tree\"\n  putStrLn \"4. Substitution\"\n  putStrLn \"5. Evaluate Expression\"\n  choice &lt;- getLine\n\n  let option = do \n        { putStrLn \"Enter a variable: \"\n        ; variable &lt;- getLine\n        ; putStrLn \"Enter a number: \" \n        ; number &lt;- getLine\n        ; print (sub expression variable number)\n        ; print (solvePostfix (toPostfix (sub expression variable number))) }\n\n  case (choice) of\n      \"1\" -&gt; putStrLn $ toPostfix expression\n      \"2\" -&gt; putStrLn $ toPrefix expression\n      \"3\" -&gt; print (parse expression)\n      \"4\" -&gt; option\n      \"5\" -&gt; print (solvePostfix (toPostfix expression))\n      otherwise -&gt; putStrLn \"This is not a number from 1 to 5!\"\n</code></pre>\n\n<p>or, if you want a loop instead:</p>\n\n<pre><code>main = do\n  putStrLn \"Enter expression:\"\n  expression &lt;- getLine\n\n  let loop = do\n        putStrLn \"Enter a number from 1 to 5:\"\n        putStrLn \"1. Convert to Postfix\"\n        putStrLn \"2. Convert to Prefix\"\n        putStrLn \"3. Convert to Binary Expression Tree\"\n        putStrLn \"4. Substitution\"\n        putStrLn \"5. Evaluate Expression\"\n        choice &lt;- getLine\n\n        case (choice) of\n          \"1\" -&gt; putStrLn $ toPostfix expression\n          \"2\" -&gt; putStrLn $ toPrefix expression\n          \"3\" -&gt; print (parse expression)\n          \"4\" -&gt; do\n            { putStrLn \"Enter a variable: \"\n            ; variable &lt;- getLine\n            ; putStrLn \"Enter a number: \" \n            ; number &lt;- getLine\n            ; print (sub expression variable number)\n            ; print (solvePostfix (toPostfix (sub expression variable number))) }\n          \"5\" -&gt; print (solvePostfix (toPostfix expression))\n          otherwise -&gt; putStrLn \"This is not a number from 1 to 5!\"\n\n        loop -- restart loop from start\n\n  -- in main, start loop\n  loop\n</code></pre>\n\n<p>This loop could be achieved using the <code>forever</code> helper from the library, but it's important to understand the basic recursive solution.</p>\n"}], "owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 45893471, "answer_count": 1, "score": 0, "last_activity_date": 1503736238, "creation_date": 1503735395, "question_id": 45893402, "link": "https://stackoverflow.com/questions/45893402/haskell-seperate-main-do-into-blocks", "title": "Haskell - seperate main = do into blocks", "body": "<p>I want to make a program to jump back to the option part and don't assign a value in to variable \"expression\" </p>\n\n<p>I tried to make like nested do function:</p>\n\n<pre><code>main = do \n...\noption = do\n</code></pre>\n\n<p>and then I would call in some case only do \"option\", but it doesn't seem to work this way and I couldn't find anywhere any different solution. Would someone give an advice, please? </p>\n\n<pre><code>main = do\nputStrLn \"Enter expression:\"\nexpression &lt;- getLine\n\nputStrLn \"Enter a number from 1 to 5:\"\nputStrLn \"1. Convert to Postfix\"\nputStrLn \"2. Convert to Prefix\"\nputStrLn \"3. Convert to Binary Expression Tree\"\nputStrLn \"4. Substitution\"\nputStrLn \"5. Evaluate Expression\"\nchoice &lt;- getLine\n\ncase (choice) of\n    \"1\" -&gt; putStrLn $ toPostfix expression\n    \"2\" -&gt; putStrLn $ toPrefix expression\n    \"3\" -&gt; print (parse expression)\n    \"4\" -&gt; do { putStrLn \"Enter a variable: \"\n              ; variable &lt;- getLine\n              ; putStrLn \"Enter a number: \" \n              ; number &lt;- getLine\n              ; print (sub expression variable number)\n              ; print (solvePostfix (toPostfix (sub expression variable number))) }\n    \"5\" -&gt; print (solvePostfix (toPostfix expression))\n    otherwise -&gt; putStrLn \"This is not a number from 1 to 5!\"\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 3, "creation_date": 1503724446, "post_id": 45892008, "comment_id": 78743467, "body": "Have you tried calling the function yourself? For example in GHCi?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1503731194, "post_id": 45892008, "comment_id": 78744774, "body": "According to the doc (if you follow the link on Google) The deleteFirstsBy function takes a predicate and two lists and returns the first list with the first occurrence of each element of the second list removed. What don&#39;t you understand ?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1503736929, "creation_date": 1503736929, "answer_id": 45893608, "question_id": 45892008, "link": "https://stackoverflow.com/questions/45892008/haskell-can-anyone-explains-how-the-deletefirstsby-function-works-with-example/45893608#45893608", "title": "Haskell Can anyone explains how the deleteFirstsBy function works with example?", "body": "<p>The docs are not completely clear, but after reading the description of <code>deleteBy</code>, the meaning should be clearer.</p>\n\n<p>Suppose we have</p>\n\n<pre><code>deleteFirstsBy eq [x1,...,xn] [y1,...,ym]\n</code></pre>\n\n<p>then, we take <code>y1</code> and try to remove it from the <code>xs</code>, using <code>eq</code> as our equality predicate. Concretely, we search for some <code>i</code> such that <code>eq y1 xi</code> is true. If there is none, we do nothing. If there is at least one, we delete the <em>first</em> such <code>xi</code> we find (the one with minimum <code>i</code>).</p>\n\n<p>Then, we delete <code>y2</code> from the remaining <code>xs</code> list (which might have one element fewer now). And so on for each <code>yj</code>.</p>\n"}], "owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 0, "accepted_answer_id": 45893608, "answer_count": 1, "score": 2, "last_activity_date": 1503753997, "creation_date": 1503722672, "last_edit_date": 1503753997, "question_id": 45892008, "link": "https://stackoverflow.com/questions/45892008/haskell-can-anyone-explains-how-the-deletefirstsby-function-works-with-example", "title": "Haskell Can anyone explains how the deleteFirstsBy function works with example?", "body": "<p>I was looking for some documentation on <a href=\"https://www.haskell.org/hoogle/?hoogle=deleteFirstsBy\" rel=\"nofollow noreferrer\">Hoogle</a> and there is a function called <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:deleteFirstsBy\" rel=\"nofollow noreferrer\"><code>deleteFirstsBy</code></a> with this signature:</p>\n\n<pre><code>deleteFirstsBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>The explanation says:</p>\n\n<blockquote>\n  <p><em>The deleteFirstsBy function takes a predicate and two lists and returns the first list with the first occurrence of each element of the second list removed.</em></p>\n</blockquote>\n\n<p>I don't quite understand what it means. Can anyone give me an example?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-backpack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1503728200, "post_id": 45891937, "comment_id": 78744163, "body": "As far as I can tell, cabal will emit a warning (<i>not</i> an error) when it encounters a field it doesn&#39;t recognize in the cabal file; so e.g. <code>if impl(ghc &gt;= 8.2) { signatures: foo }</code> will work work on v2.0 and on older versions (at least on 1.24; I don&#39;t know if this produced an error on some other version). As far as actual Haskell source files, I think at some point you&#39;d still need to resort to CPP - but without specific examples (and I understand that these may be hard to come by given that the exploration of this feature has just begun) it&#39;s hard to say."}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 1, "creation_date": 1503925790, "post_id": 45891937, "comment_id": 78798053, "body": "This is definitely tricky to do, not least because Hackage is unconditionally rejecting packages that use Backpack features. The most likely thing to work is write two Cabal files and upload them separately. A pain? Yes. It might be possible to write an autogenerator for the compat version, but this hasn&#39;t been done yet..."}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 373, "favorite_count": 1, "answer_count": 0, "score": 6, "last_activity_date": 1503721821, "creation_date": 1503721821, "question_id": 45891937, "link": "https://stackoverflow.com/questions/45891937/using-cabal-backpack-in-a-backwards-compatible-fashion", "title": "Using Cabal backpack in a backwards compatible fashion", "body": "<p>Backpack promises to let us solve the string problem by parametrizing packages over signatures. The idea is that this will allow us to change the ecosystem in a backwards compatible way: we can simply deprecate particular instantiations without changes rippling down the dependency graph.</p>\n\n<p>What I am struggling to see is how I can use <em>Backpack</em> in a backwards compatible way. AFAICT, a backpacked project has to use Cabal 2.0 (previous versions of Cabal won't support all the new fields in <code>.cabal</code> files). That would mean that I can only use backpack in projects that support GHC 8.2+.</p>\n\n<p>Is there any hack around this? I'm looking for a way to use backpack such that:</p>\n\n<ul>\n<li>users on GHC 8.2+ can take advantage of a fully backpacked package</li>\n<li>users on older versions can still compile and use the project (but are stuck with some default instantiation of the signatures)</li>\n</ul>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": false, "score": 3, "last_activity_date": 1503721945, "creation_date": 1503721945, "answer_id": 45891948, "question_id": 45891910, "link": "https://stackoverflow.com/questions/45891910/couldnt-match-expected-type-x-with-actual-type-char-char-char/45891948#45891948", "title": "Couldn&#39;t match expected type &#39;x&#39; with actual type `([Char], [Char], [Char])&#39;", "body": "<p>The <code>:</code> operator has lower priority than applying the <code>People</code> constructor. So your expression is actually:</p>\n\n<pre><code>all_people = (People (\"Bob\",\"Alice\",\"George\")) : []\n</code></pre>\n\n<p>It is indicated in the error message, saying what did <code>People</code> constructor apply to:</p>\n\n<pre><code>...first argument of `People', namely `(\"Bob\", \"Alice\", \"George\")'\n</code></pre>\n\n<p>You will have to make it explicit:</p>\n\n<pre><code>all_people = People ((\"Bob\",\"Alice\",\"George\")) : [])\n</code></pre>\n\n<p>Or, with the list notation:</p>\n\n<pre><code>all_people = People [(\"Bob\",\"Alice\",\"George\")]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": true, "score": 1, "last_activity_date": 1503740476, "creation_date": 1503740476, "answer_id": 45894038, "question_id": 45891910, "link": "https://stackoverflow.com/questions/45891910/couldnt-match-expected-type-x-with-actual-type-char-char-char/45894038#45894038", "title": "Couldn&#39;t match expected type &#39;x&#39; with actual type `([Char], [Char], [Char])&#39;", "body": "<p>There are two problems in your code.</p>\n\n<p>First one is, <code>People</code> data type accepts a <code>Names</code> data type but you are trying to feed it with a <code>[(String,String,String)]</code> data type.</p>\n\n<p>Second is, as mentioned in @Koterpillar's answer the precedence of the value constructor (here <code>People</code> and/or <code>Names</code>) are higher than the list value constructor <code>:</code> (left association).</p>\n\n<p>Another point is your data types can be defined by <code>newtype</code> yielding a more efficient code.</p>\n\n<p>So by keeping in mind that the value constructors are also functions, if you wanted to use the <code>:</code> constructor to create your lists  you may as well do like;</p>\n\n<pre><code>newtype Names  = Names [(String, String, String)]\nnewtype People = People Names\n\ninitiallist :: ([String], People)\ninitiallist = (first_name, all_people)\n    where first_name = \"Bob\" : \"Alice\" : \"George\" : []\n          all_people = People $ Names $ (\"Bob\",\"Alice\",\"George\") : []\n</code></pre>\n\n<p>or of course you may preferably do like</p>\n\n<pre><code>all_people = People (Names [(\"Bob\",\"Alice\",\"George\")])\n</code></pre>\n"}], "owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 45894038, "answer_count": 2, "score": 0, "last_activity_date": 1503740476, "creation_date": 1503721410, "question_id": 45891910, "link": "https://stackoverflow.com/questions/45891910/couldnt-match-expected-type-x-with-actual-type-char-char-char", "title": "Couldn&#39;t match expected type &#39;x&#39; with actual type `([Char], [Char], [Char])&#39;", "body": "<p>I have created a data type that is to store information about a group of people: their names and date of birth. The data type is simply two lists of 3-tuples, the first list holds names <code>(first, middle, last)</code> and the second holds DOB (Day, Month, Year). You can see the data type below (I've omitted the DOB type because it's irrelevant to this question):</p>\n\n<pre><code>data Names = Names [(String, String, String)]\ndata People = People Names\n</code></pre>\n\n<p>I'm trying to write a function that creates the initial list, so it returns the name of the first person and then the list of <code>People</code>. Here it is so far:</p>\n\n<pre><code>initiallist :: ([String], People)\ninitiallist = (first_name, all_people)\n    where first_name = \"Bob\" : \"Alice\" : \"George\" : []\n        all_people = People (\"Bob\",\"Alice\",\"George\") : []\n</code></pre>\n\n<p>This results in</p>\n\n<pre><code>error:\n* Couldn't match expected type `Names'\n     with actual type `([Char], [Char], [Char])'\n* In the first argument of `People', namely `(\"Bob\", \"Alice\", \"George\")'\n  In the first argument of `(:)', namely\n    `People (\"Bob\", \"Alice\", \"George\")'\n  In the expression: People (\"Bob\", \"Alice\", \"George\") : []\n</code></pre>\n\n<p>Now, in my knowledge of Haskell, I thought that <code>String</code> is just a <code>[Char]</code>. So I figured my code would work fine, but it has me absolutely stumped.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503712685, "post_id": 45890964, "comment_id": 78741892, "body": "What is the purpose of <code>byCompare</code> returning a <code>(Int, [String])</code> instead of just <code>Int</code>? A general strategy to approach this: represent your data as <code>[(Char, Int)]</code> instead of <code>[String]</code> to reflect the intended contents of the data; use <code>unzip :: [(a,b)] -&gt; ([a], [b])</code> to get the two lists separately; write a function <code>Eq a =&gt; [a] -&gt; [a] -&gt; [a]</code> which returns a list with those elements occurring in both input lists; compose this with <code>length</code>; and finally call this function on both components of the pair produced by <code>unzip</code>."}], "answers": [{"tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": false, "score": 0, "last_activity_date": 1503775268, "creation_date": 1503775268, "answer_id": 45898905, "question_id": 45890964, "link": "https://stackoverflow.com/questions/45890964/haskell-how-can-i-compare-the-occurrence-between-two-strings-based-on-the-first/45898905#45898905", "title": "Haskell how can I compare the occurrence between two strings based on the first and second character?", "body": "<p>There are two parts in your question. The first part seems easy: you've got a list of Strings of two chars and you want to do some comparison on the first char and then some comparison on the second char.</p>\n\n<p>You just have to isolate the first char and the second char:</p>\n\n<pre><code>Prelude&gt; a = [\"A2\",\"B3\",\"A1\"]\nPrelude&gt; head&lt;$&gt;a\n\"ABA\"\nPrelude&gt; last&lt;$&gt;a\n\"231\"\n</code></pre>\n\n<p><code>&lt;$&gt;</code> is the <code>fmap</code> operator : the function (<code>head</code> or <code>last</code>) is applied to every element of the list <code>a</code>.</p>\n\n<p>Now you've got two separated lists. How to \"compare\" the chars from the two lists? This part seems more complex because what you are trying to achieve is not clear to me.</p>\n\n<p>Here's a proposal: 1. count the number of each char in the two lists, 2. for every char present in the two lists, keep the number of times that char is present in both lists, that is the minimum of the count of that char in both  list. An example will be more easy to undestand: if you have three <code>A</code>s in the first list and two in the second, you keep two as value for <code>A</code>.</p>\n\n<p>To get a count of every character, you can use an associative array (or \"hash map\"):</p>\n\n<pre><code>Prelude&gt; import Data.Map\nPrelude Data.Map&gt; f l = fromListWith (+) [(x, 1) | x &lt;-head&lt;$&gt;l]\nPrelude Data.Map&gt; f a\nfromList [('A',2),('B',1)]\n</code></pre>\n\n<p>You recognize <code>head&lt;$&gt;a</code>: it is simply the list of the first chars in <code>a</code>, that is <code>\"ABA\"</code> (=<code>['A', 'B', 'A']</code>). Now you build an associative array with the elements of the array as keys. The values are computed as the the number of times each key is present. (<code>1</code> if the key appear once, <code>1 + 1</code> if it appears twice, and so on): that's the <code>With (+)</code> part that applies to the <code>1</code>s of the pairs.</p>\n\n<p>For the list <code>b</code>, you have:</p>\n\n<pre><code>Prelude Data.Map&gt; b = [\"C1\",\"A3\",\"A6\"]\nPrelude Data.Map&gt; f b\nfromList [('A',2),('C',1)]\n</code></pre>\n\n<p>It's time to compare the two associative arrays.</p>\n\n<pre><code>Prelude Data.Map&gt; g l1 l2 = intersectionWithKey(\\c n1 n2-&gt;min n1 n2)(f l1)(f l2)\nPrelude Data.Map&gt; g a b\nfromList [('A',2)]\n</code></pre>\n\n<p><code>intersectionWithKey</code> keeps only the keys that exists in both lists. The lambda function takes the minimum of counts and assigns it as value for that key.</p>\n\n<p>Finally, you just have to compute the sum of the values of the resulting map:</p>\n\n<pre><code>Prelude Data.Map&gt; Data.Map.foldl(+)0(g a b)\n2\n</code></pre>\n\n<p><code>foldl</code> makes the sum of the values.</p>\n\n<p>You just have to repeat the process for the numbers (use <code>last</code>).</p>\n"}], "owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503775268, "creation_date": 1503708572, "last_edit_date": 1503723388, "question_id": 45890964, "link": "https://stackoverflow.com/questions/45890964/haskell-how-can-i-compare-the-occurrence-between-two-strings-based-on-the-first", "title": "Haskell how can I compare the occurrence between two strings based on the first and second character?", "body": "<p>Sorry for asking a trivial question, I am new for Haskell programming,\nI qm struggling with comparison between two strings</p>\n\n<p>the two lists are </p>\n\n<pre><code>a :: [String]\na = [\"A2\",\"B3\",\"A1\"]\n\nb::[String]\nb= [\"C1\",\"A3,\"A6\"]\n</code></pre>\n\n<p>and I want to compare the same part based on the first character and second character and return two Int, that is (2,2)\nbecause there are 2 strings the first character are the same, based on list b,that is 2 As both exist in two lists,based on the comparison,</p>\n\n<pre><code>list a [\"A2\",\"A1\"]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>list b[\"A3\",\"A6\"]\n</code></pre>\n\n<p>base on list b, there are 2 As, each occurred in list a once, so the first Int would return 2</p>\n\n<p>and second Int comes from the comparison between the second character  based on list b, the concept is basically the same as the first Int, </p>\n\n<blockquote>\n  <p>by comparing list a and list b, elements in a [\"B3\",\"A1\"], and elements in b [\"C1\",\"A3\"] ,1 occurred once in list a, increment 1 and ignored, 3 is occurred in list a, increment, and the return would be 2</p>\n</blockquote>\n\n<p>and final return would be (2,2)\nand my achieve is :\nI was trying to return two Int using two functions my first one is this:\nit return the first Int</p>\n\n<pre><code>byCompare ::[String]-&gt;[String] -&gt; (Int,[String])  \nbyCompare [] x = (0, x)\nbyCompare x [] = (0, [])    \nbyCompare (x:xs)(y:ys)\n  | comparehead x y == True =  increment (byCompare xs ys)\n  | otherwise = append y (byCompare [x] ys) \n  where \n    increment (count, results) = (count + 1,results)\n    append y (count, results) = (count, y:results)\n    comparehead a b \n      | head a == head b = True\n      | otherwise = False\n</code></pre>\n\n<p>The return String is what I want to figure out what is going on with my code, and It returns me a wrong answer (1,[\"C1\",\"A6\"]) the desired Int return should be 2 ,and String return should be [\"C1\",\"A3,\"A6\"], probably,and I want to use those result to my calculation of second Int, \nbut I have no idea about how to fix this code to yield the right answer,</p>\n\n<p>Can I combine the two codes together like </p>\n\n<pre><code>bigCombine ::[String] -&gt;[String] -&gt;(Int,Int)?\n</code></pre>\n\n<p>Thank you so much for helping!</p>\n"}, {"tags": ["haskell", "gcc", "cabal", "hackage"], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 1, "last_activity_date": 1503712029, "last_edit_date": 1503712029, "creation_date": 1503706848, "answer_id": 45890833, "question_id": 45890738, "link": "https://stackoverflow.com/questions/45890738/specify-gcc-compiler-flags-while-downloading-haskell-bindings-to-a-c-library-fro/45890833#45890833", "title": "Specify gcc compiler flags while downloading Haskell bindings to a c-library from Hackage", "body": "<p><a href=\"https://www.mankier.com/1/cabal#--gcc-option\" rel=\"nofollow noreferrer\"><code>--gcc-option</code></a> might do the trick. </p>\n\n<p>It's also found in <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#programs-used-for-building\" rel=\"nofollow noreferrer\">here</a> as <code>--prog-option</code> where prog is any program known to cabal(such as gcc)  </p>\n\n<p>Another option is to download the package yourself then modify its build configuration.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 45890833, "answer_count": 1, "score": 1, "last_activity_date": 1503712029, "creation_date": 1503705751, "question_id": 45890738, "link": "https://stackoverflow.com/questions/45890738/specify-gcc-compiler-flags-while-downloading-haskell-bindings-to-a-c-library-fro", "title": "Specify gcc compiler flags while downloading Haskell bindings to a c-library from Hackage", "body": "<p>I want to install bindings to the <a href=\"http://minisat.se/\" rel=\"nofollow noreferrer\">Minisat</a> solver for satisfiability problems available <a href=\"https://hackage.haskell.org/package/minisat-solver\" rel=\"nofollow noreferrer\">here</a> on Hackage. </p>\n\n<p>When I tried doing <code>cabal install minisat-solver</code> at the command-line on a Linux work-station, I got the following output</p>\n\n<pre><code>user@home: $ cabal install minisat-solver\nResolving dependencies...\nConfiguring minisat-solver-0.1...\nBuilding minisat-solver-0.1...\nFailed to install minisat-solver-0.1\nBuild log ( /home/gaurish/.cabal/logs/minisat-solver-0.1.log ):\ncabal: Entering directory '/tmp/cabal-tmp-6317/minisat-solver-0.1'\nConfiguring minisat-solver-0.1...\nBuilding minisat-solver-0.1...\nPreprocessing library minisat-solver-0.1...\n[1 of 7] Compiling SAT.MiniSat.Literals ( SAT/MiniSat/Literals.hs, dist/build/SAT/MiniSat/Literals.o )\n[2 of 7] Compiling SAT.MiniSat.LowLevel ( SAT/MiniSat/LowLevel.hs, dist/build/SAT/MiniSat/LowLevel.o )\n[3 of 7] Compiling SAT.MiniSat.Monadic ( SAT/MiniSat/Monadic.hs, dist/build/SAT/MiniSat/Monadic.o )\n[4 of 7] Compiling SAT.MiniSat.Functional ( SAT/MiniSat/Functional.hs, dist/build/SAT/MiniSat/Functional.o )\n[5 of 7] Compiling SAT.MiniSat.Variable ( SAT/MiniSat/Variable.hs, dist/build/SAT/MiniSat/Variable.o )\n[6 of 7] Compiling SAT.MiniSat.Formula ( SAT/MiniSat/Formula.hs, dist/build/SAT/MiniSat/Formula.o )\n[7 of 7] Compiling SAT.MiniSat      ( SAT/MiniSat.hs, dist/build/SAT/MiniSat.o )\nc-sources/solver.c: In function \u2018solver_simplification\u2019:\n\nc-sources/solver.c:901:3:\n     error: \u2018for\u2019 loop initial declarations are only allowed in C99 mode\n       for (int i = solver_dlevel(s); i &gt;= 0; i--) {\n       ^\n\nc-sources/solver.c:901:3:\n     note: use option -std=c99 or -std=gnu99 to compile your code\n\nc-sources/solver.c:907:3:\n     error: \u2018for\u2019 loop initial declarations are only allowed in C99 mode\n       for (int c = s-&gt;qtail - 1; c &gt;= 0; c--) {\n       ^\n</code></pre>\n\n<p>Clearly, I need to tell cabal to tell gcc to use ansi-c99 mode while compiling the embedded C-sources. in other words to pass -std=c99 to the gcc compiler. </p>\n\n<p>How do I do that? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1503704498, "post_id": 45890528, "comment_id": 78740829, "body": "You&#39;re unlikely to find any standard combinators to do this, as all generic code will be written for the standard assumption that Haskell functions return the same result for the same arguments. The facilities that you&#39;ve thrown away by using <code>unsafePerformIO</code> are where you would find code that would allow you to turn &quot;generate a random number&quot; into &quot;generate a list of random numbers&quot;."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 6, "creation_date": 1503706083, "post_id": 45890528, "comment_id": 78741104, "body": "I second @Ben&#39;s point. (We Bens have got to stick together.) <code>unsafePerformIO</code> is the source of your confusion. I very strongly recommend forgetting that <code>unsafePerformIO</code> exists. It&#39;s meant for expert users - the name is meant to scare you off! The situations where you need it are very rare indeed and this is not one of them. Expend your efforts on learning how to work with the <code>IO</code> type instead. It&#39;s worth it!"}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1503716170, "post_id": 45890929, "comment_id": 78742252, "body": "Or if you don&#39;t care about the final generator state you can cleanly use <code>evalState</code> - which is much like <code>fst</code> composed with <code>runState</code>.  For example: <code>evalState (replicateM 3 (state (randomR (5,7)))) (mkStdGen 0) [7,7,5]</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1503708127, "creation_date": 1503708127, "answer_id": 45890929, "question_id": 45890528, "link": "https://stackoverflow.com/questions/45890528/run-multiple-times-a-function-in-haskell/45890929#45890929", "title": "Run Multiple Times a Function in Haskell", "body": "<p>Forget <code>unsafePerformIO</code>; admit that you are doing something stateful. Here's how:</p>\n\n<pre><code>Control.Monad System.Random&gt; replicateM 3 (randomRIO (5,7))\n[6,7,5]\n</code></pre>\n\n<p>If you must not do IO, you can also make the statefulness explicit with the <code>State</code> monad:</p>\n\n<pre><code>Control.Monad.State System.Random&gt; runState (replicateM 3 (state (randomR (5,7)))) (mkStdGen 0)\n([7,7,5],1346387765 2103410263)\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 8518830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0686188a48857e86628b32e04bdd0077?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Bregunci", "link": "https://stackoverflow.com/users/8518830/joao-bregunci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 0, "accepted_answer_id": 45890929, "answer_count": 1, "score": 0, "last_activity_date": 1503708127, "creation_date": 1503703544, "last_edit_date": 1503706300, "question_id": 45890528, "link": "https://stackoverflow.com/questions/45890528/run-multiple-times-a-function-in-haskell", "title": "Run Multiple Times a Function in Haskell", "body": "<p>I have previously created this function to generated integers random numbers in a range <code>(m,n)</code>.</p>\n\n<pre><code>giveRand :: Random c =&gt; c -&gt; c -&gt; c\ngiveRand m n = unsafePerformIO . getStdRandom $ randomR (m,n)\n</code></pre>\n\n<p>From this situation I wanted to run it multiple times with the same parameters, so that it would return me a list of randomly generated values in the given range. I tried the replicate function, but it only did copy the result of giveRand. It did not create multiple copies of the function and reevaluate it.</p>\n\n<p>From this problem I wondered if there is a function that allows me to run any function multiple times with the same parameters. I ask this for cases such as this one, that even with the same inputs of range, different values may arise.</p>\n\n<p>So, is there any function in Haskell that enables me to run a function multiple times with the same parameters?</p>\n"}, {"tags": ["haskell", "unicode"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1503696173, "post_id": 45889571, "comment_id": 78738665, "body": "Does your file system supports filenames in cyrillic?"}, {"owner": {"reputation": 53, "user_id": 3979775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c5485d5e0b3c63d66326cc710a6099?s=128&d=identicon&r=PG&f=1", "display_name": "Valentin Shirokov", "link": "https://stackoverflow.com/users/3979775/valentin-shirokov"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1503696483, "post_id": 45889571, "comment_id": 78738760, "body": "Yes, of course. So goes for my locale."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1503696847, "post_id": 45889571, "comment_id": 78738870, "body": "That <i>is</i> how you write to a file whose name contains Unicode characters. Something else is wrong."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503697063, "post_id": 45889571, "comment_id": 78738955, "body": "This works just fine on MacOS. What are you running this on?"}, {"owner": {"reputation": 53, "user_id": 3979775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c5485d5e0b3c63d66326cc710a6099?s=128&d=identicon&r=PG&f=1", "display_name": "Valentin Shirokov", "link": "https://stackoverflow.com/users/3979775/valentin-shirokov"}, "edited": false, "score": 0, "creation_date": 1503697773, "post_id": 45889571, "comment_id": 78739165, "body": "Thanks for feedback. The problem actually is in running program from stack, not in haskell or anything else. Just needed to execute binary directly."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503699266, "post_id": 45889571, "comment_id": 78739621, "body": "@ValentinShirokov That is still worrisome. What exactly did you do to trigger that behavior from <code>stack</code>?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1503734583, "post_id": 45889571, "comment_id": 78745643, "body": "Do you have your source file encoded in UTF-8?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1503736109, "post_id": 45889571, "comment_id": 78745991, "body": "How exactly are you running from Stack ? Also did you try to use plain Cabal and was the problem not reproducible there ?"}, {"owner": {"reputation": 53, "user_id": 3979775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c5485d5e0b3c63d66326cc710a6099?s=128&d=identicon&r=PG&f=1", "display_name": "Valentin Shirokov", "link": "https://stackoverflow.com/users/3979775/valentin-shirokov"}, "edited": false, "score": 0, "creation_date": 1503736800, "post_id": 45889571, "comment_id": 78746141, "body": "<code>$ stack new test simple; cd test; echo &#39;  writeFile &quot;\u0439\u0446\u0443&quot; &quot;qwe&quot;&#39; &gt;&gt; src&#47;Main.hs; stack --nix build; stack --nix exec test</code>. Plain <code>cabal run</code> works just fine. Please note that there are two spaces before <code>writeFile</code>, stackoverflow just ate one of them."}, {"owner": {"reputation": 53, "user_id": 3979775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c5485d5e0b3c63d66326cc710a6099?s=128&d=identicon&r=PG&f=1", "display_name": "Valentin Shirokov", "link": "https://stackoverflow.com/users/3979775/valentin-shirokov"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1503738318, "post_id": 45889571, "comment_id": 78746454, "body": "@arrowd Yes, file is in UTF-8."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1503745735, "post_id": 45889571, "comment_id": 78748258, "body": "Are you using nix os ?"}, {"owner": {"reputation": 53, "user_id": 3979775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c5485d5e0b3c63d66326cc710a6099?s=128&d=identicon&r=PG&f=1", "display_name": "Valentin Shirokov", "link": "https://stackoverflow.com/users/3979775/valentin-shirokov"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1503747435, "post_id": 45889571, "comment_id": 78748708, "body": "@Sibi yes, I am. I currently don&#39;t have currently any &quot;pure&quot; Linux machine at hand to test. This reproduces on any of my NixOS machines. I tested on stack versions 1.5.1 and 1.3.2."}], "owner": {"reputation": 53, "user_id": 3979775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c5485d5e0b3c63d66326cc710a6099?s=128&d=identicon&r=PG&f=1", "display_name": "Valentin Shirokov", "link": "https://stackoverflow.com/users/3979775/valentin-shirokov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1503696139, "creation_date": 1503696139, "question_id": 45889571, "link": "https://stackoverflow.com/questions/45889571/haskell-write-file-with-unicode-charactes-in-name", "title": "Haskell: write file with Unicode charactes in name", "body": "<p>I need to write a file with Unicode characters in name:</p>\n\n<pre><code>module Main where\n\nmain :: IO ()\nmain = do\n  writeFile \"\u0439\u0446\u0443\" \"qwe\"\n</code></pre>\n\n<p>It crashes with run-time error: <code>openFile: invalid argument (invalid character)</code></p>\n\n<p>How do I write file with Unicode characters in name?</p>\n"}, {"tags": ["haskell", "microbenchmark"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1503682092, "post_id": 45886535, "comment_id": 78732377, "body": "The more fundamental issue here is that you have to have a notion of what it means for something to be &quot;evaluated&quot; in your monad. In a lot of cases, <code>nf</code> may be all you want."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1503694821, "post_id": 45886535, "comment_id": 78738176, "body": "You&#39;ll need to turn your <code>JSM</code> computation into an <code>IO</code> one using <a href=\"https://hackage.haskell.org/package/jsaddle-dom-0.9.2.0/docs/JSDOM-Types.html#v:runJSM\" rel=\"nofollow noreferrer\"><code>runJSM</code></a>. From reading the docs I can&#39;t figure out how you&#39;re supposed to call <code>runJSM</code> - it needs a <code>JSContextRef</code> argument but I can&#39;t see any way to get hold of one. Hopefully this is a good enough pointer for you though."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504816463, "post_id": 45886535, "comment_id": 79172204, "body": "@BenjaminHodgson I cannot figure out how to get a <code>JSContextRef</code> either. The docs for this library could really use some work."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1504816930, "post_id": 45886535, "comment_id": 79172446, "body": "Just found it in <code>Language.Javascript.JSaddle.Null</code>. The function is named <code>run</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 1, "creation_date": 1504817035, "post_id": 45886535, "comment_id": 79172507, "body": "@AndrewThaddeusMartin Good find! I wouldn&#39;t have though to look there, it&#39;s a very strange module name. I think that would make a good answer."}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503694481, "creation_date": 1503681414, "question_id": 45886535, "link": "https://stackoverflow.com/questions/45886535/how-to-run-a-criterion-benchmark-for-a-monadic-function", "title": "How to run a criterion benchmark for a monadic function", "body": "<p>With the <a href=\"https://hackage.haskell.org/package/criterion-1.2.2.0/docs/Criterion-Main.html\" rel=\"nofollow noreferrer\">criterion</a> library I want to benchmark functions with a type of <code>Monad m =&gt; a -&gt; m b</code>.</p>\n\n<p>Here is a typical example with the <em>JSM</em> monad from the <a href=\"https://hackage.haskell.org/package/jsaddle\" rel=\"nofollow noreferrer\">jsaddle</a> library:</p>\n\n<pre><code>import           Criterion.Main\nimport           JSDOM.Types (JSM)\nimport           GHCJS.Buffer (Buffer(..))\nimport qualified Data.ByteString as BS (ByteString)\n\nmain :: IO ()\nmain = defaultMain [\n  bgroup \"Image\" [ bench \"buildBS\"  $ nf buildBS 256\n                 , bench \"toJsBuff\" $ nfIO (toJsBuff img)\n                 ] ]\n\nimg :: BS.ByteString\nimg = id $! buildBS 256\n\nbuildBS :: Int -&gt; BS.ByteString\nbuildBS = undefined\n\ntoJsBuff :: BS.ByteString -&gt; JSM Buffer\ntoJsBuff bs = undefined\n</code></pre>\n\n<p>Now this does not compile because the function <code>nfIO</code> works only for the IO monad and not for any monad. </p>\n\n<p>How can I benchmark such a monadic function? </p>\n\n<p>Note: There is also a compile time error when I use <code>nf</code> instead of <code>nfIO</code>.</p>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "interpreter", "typeclass", "monoids"], "comments": [{"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 1, "creation_date": 1503675097, "post_id": 45884762, "comment_id": 78728419, "body": "As an aside, it is also possible to generalize the <code>Foo</code> type <a href=\"https://gist.github.com/cdepillabout/b49b640dcf8d2066260a4dbe42f56000#file-example-hs-L45\" rel=\"nofollow noreferrer\">for any</a> <code>Monoid</code>.  It is also possible to write a type like <code>Foo</code> for <i>any</i> <a href=\"https://gist.github.com/cdepillabout/b49b640dcf8d2066260a4dbe42f56000#file-example-hs-L76\" rel=\"nofollow noreferrer\">typeclass</a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1503678726, "post_id": 45884762, "comment_id": 78730567, "body": "Not really an answer to your question as a whole, but if you wanted <code>O(1)</code> list appends (which apply to strings) in a <code>Monoid</code>, check out <a href=\"https://hackage.haskell.org/package/dlist-0.8.0.3/docs/Data-DList.html#t:DList\" rel=\"nofollow noreferrer\"><code>DList</code></a>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1503681224, "post_id": 45884762, "comment_id": 78731924, "body": "You <i>can</i> make <code>Foo</code> law abiding by adding another constructor: <code>data Foo = FooEmpty | FooString String | FooAppend Foo Foo</code>, then <code>foo :: String -&gt; Foo; foo = FooString</code> and <code>instance Monoid Foo where { mempty = FooEmpty; mappend FooEmpty m = m ; mappend m FooEmpty = m ; mappend m m&#39; = FooAppend m m&#39; }</code>.  If you didn&#39;t want to add another constructor, you could pull the same trick by comparing inputs to <code>mappend</code> to <code>FooEmpty &quot;&quot;</code>, but your semantics are a little different."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 4, "creation_date": 1503686325, "post_id": 45884762, "comment_id": 78734595, "body": "@rampion Doesn&#39;t that instance violate associativity, anyway?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1503687826, "post_id": 45884762, "comment_id": 78735315, "body": "chi: You&#39;re right, it does."}], "answers": [{"comments": [{"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1503682497, "post_id": 45885875, "comment_id": 78732572, "body": "Thanks a lot for this answer.  When writing the question, I really felt myself falling into the &quot;eh, it&#39;s okay this one time&quot; camp.  So I really appreciate the opposite view.  Would you be able to come up with specific examples of how it raises the cognitive burden on users?  Or how it can lead to potential bugs?  I know it is really tough to come up with specific examples off the top of your head to a somewhat abstract question, but I really want to make sure I have a good idea of the downsides I&#39;d be dealing with."}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1503683294, "post_id": 45885875, "comment_id": 78733019, "body": "Also, I just added a third question: &quot;Is there an alternative way to write code that uses something like Foo? Some way to enable interpretation of a monoidal structure instead of using mappend on a type directly?&quot;  I&#39;m interested in your answer to this question."}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1503718815, "post_id": 45885875, "comment_id": 78742622, "body": "Thanks for expanding your answer.  Unlike the other two answers, this answer really answered all of my questions.  However, I&#39;m not quite satisfied with the &quot;How it can lead to potential bugs?&quot; part.  I agree with you that most of the time it is not good to write non-law-abiding instances for the reasons you give.  And my <code>Foo</code> type is not law-abiding if you&#39;re using structural equality.  However, I think @li-yao-xia brings up a good point that it is &quot;good enough&quot; as long as we use a module system to force the user to use <code>fooInterp</code>."}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1503718878, "post_id": 45885875, "comment_id": 78742633, "body": "However, you would be able to win me over if you could come up with a way that <code>Foo</code> and <code>fooInterp</code> could lead to potential bugs or increased cognitive overhead."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 1, "creation_date": 1503748298, "post_id": 45885875, "comment_id": 78748952, "body": "@illabout Actually, I agree. Encapsulating the implementation details and providing only a law-abiding interface is completely fine."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 8, "last_activity_date": 1503694120, "last_edit_date": 1503694120, "creation_date": 1503678835, "answer_id": 45885875, "question_id": 45884762, "link": "https://stackoverflow.com/questions/45884762/non-lawful-monoid-instances-for-building-up-ast-not-considered-harmful/45885875#45885875", "title": "non-lawful Monoid instances for building up AST not considered harmful?", "body": "<blockquote>\n  <p>Is it ever okay to use these types of non-lawful instances to build up an AST?</p>\n</blockquote>\n\n<p>This is a matter of opinion. (I'm firmly in the 'never ok' camp.)</p>\n\n<blockquote>\n  <p>Are there any specific problems that need to be watched for when using these types of non-lawful instances?</p>\n</blockquote>\n\n<ul>\n<li>cognitive burden placed on potential users and future maintainers</li>\n<li>potential bugs because we use the type in a place that makes assumptions based on the broken law(s)</li>\n</ul>\n\n<p>edit to answer questions in comments:</p>\n\n<blockquote>\n  <p>Would you be able to come up with specific examples of how it raises the cognitive burden on users?</p>\n</blockquote>\n\n<p>Imagine how annoyed you would be if someone did this in C:</p>\n\n<pre><code> // limit all while loops to 10 iterations\n #define while(exp) for(int i = 0; (exp) &amp;&amp; i &lt; 10; ++i)\n</code></pre>\n\n<p>Now we have to keep track of the scope of this pseudo-while definition and its implications. It's a non-Haskell example, but I think the principle is the same. We shouldn't expect the semantics of <code>while</code> to be different in a particular source file just like we shouldn't expect the semantics of <code>Monoid</code> to be different for a particular data type.</p>\n\n<p>When we say something is an X, then it should be a X because people understand the semantics of X. The principle here is <strong>don't create exceptions to well understood concepts</strong>.</p>\n\n<p>I think the point of using lawful abstractions (like monoid) in the first place is to alleviate the need for programmers to learn and remember a myriad of different semantics. Thus, every exception we create undermines this goal. In fact, it makes it worse; we have to remember the abstraction and on top of that remember all the exceptions. (As an aside, I admire but pity those who learned English as a second language.) </p>\n\n<blockquote>\n  <p>Or how it can lead to potential bugs?</p>\n</blockquote>\n\n<p>some library:</p>\n\n<pre><code>-- instances of this class must have property P\nclass AbidesByP where\n   ...\n\n-- foo relies on the property P\nfoo :: AbidesByP a =&gt; a -&gt; Result\nfoo a = ... \n</code></pre>\n\n<p>my code:</p>\n\n<pre><code>data MyData = ...\n\n-- note: AbidesByP's are suppose to have property P, but this one doesn't\ninstance AbidesByP MyData where\n   ...\n</code></pre>\n\n<p>some other programmer (or me in a few months):</p>\n\n<pre><code>doSomethingWithMyData :: MyData -&gt; SomeResult\ndoSomethingWithMyData x = let ...\n                              ...\n                              ...\n                              r = foo x      -- potential bug\n                              ...\n                              ...\n                           in ...\n</code></pre>\n\n<blockquote>\n  <p>Is there an alternative way to write code that uses something like Foo?</p>\n</blockquote>\n\n<p>I'd probably just use the constructor to contruct:</p>\n\n<pre><code>(foo \"hello\" `FooAppend` foo \" reallylongstringthatislong\") `FooAppend` (foo \" world\" `FooAppend` foo \"\")\n</code></pre>\n\n<p>or make an operator:</p>\n\n<pre><code>(&lt;++&gt;) = FooAppend\n\n(foo \"hello\" &lt;++&gt; foo \" reallylongstringthatislong\") &lt;++&gt; (foo \" world\" &lt;++&gt; foo \"\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1503682880, "post_id": 45886102, "comment_id": 78732789, "body": "The comment you quoted says &quot;Try proving fmap id = id for [] as opposed to forall x . fmap id x = id x&quot;.  I don&#39;t quite understand what difference they are implying between <code>fmap id</code> and <code>forall x. fmap id x</code>.  Aren&#39;t they the same thing?  Are the proofs for these two equalities different?"}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1503683215, "post_id": 45886102, "comment_id": 78732982, "body": "Also, I&#39;m not 100% sure what you&#39;re saying with the <code>Endo</code> example.  Maybe you&#39;re saying that unlike my <code>Foo</code> type, <code>Endo String</code> <b>is</b> a <code>Monoid</code>.  It will also give us optimal appends.  However, reassociating after the fact will not work.  So maybe <code>Endo String</code> should be used instead of my <code>Foo</code> type?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1503683436, "post_id": 45886102, "comment_id": 78733096, "body": "illabout: It comes down how you define equivalence between functions. <code>fmap id [1...n] == id [1..n]</code>, but it takes O(n) time to run the <code>fmap id</code> on the left hand side and O(1) time to run the <code>id</code> on the right hand side. The functions produce the same output, but with different complexity so they must be different functions. But we still say <code>fmap id == id</code> because we define equivalence of functions as equality of outputs for the law."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503686763, "post_id": 45886102, "comment_id": 78734817, "body": "I think that the <code>fmap id</code> example is confusing. In the linked question, the issue was Double rounding errors, which break some laws if interpreted strictly. Here we do not have rounding errors to consider. I also see no difference between <code>fmap id=id</code> and its extensional variant <code>forall x. forall id x = id x</code>, so I&#39;m unsure why this is mentioned. (Eta expansion holds on non-bottom function values, in Haskell.)"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503700812, "post_id": 45886102, "comment_id": 78740051, "body": "@chi I think we can prove <code>forall Eq x . fmap id x == id x</code> where <code>x</code> is an instance of <code>Eq</code> and using its <code>==</code> equality, but we cannot prove <code>fmap id \u2261 id</code> with <code>Eq</code> since there is no function instance. So we have to choose ourselves what <code>\u2261</code> means. We can choose our own equality for <code>Foo</code> as well - like <code>instance Eq Foo where (==) = (==) `on` fooInterp</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1503700975, "post_id": 45886102, "comment_id": 78740097, "body": "@Bergi I usually take such equality to mean denotational equality, not Eq&#39;s one. Possibly ignoring some bottoms. But I agree that &quot;equality&quot; in these laws is quite unspecified."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503701049, "post_id": 45886102, "comment_id": 78740125, "body": "@chi Yes, exactly that&#39;s the point of this answer. What are the denotational semantics of <code>Foo</code>? Structural equality doesn&#39;t fit us so we don&#39;t use it here."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 15, "last_activity_date": 1503679613, "creation_date": 1503679613, "answer_id": 45886102, "question_id": 45884762, "link": "https://stackoverflow.com/questions/45884762/non-lawful-monoid-instances-for-building-up-ast-not-considered-harmful/45886102#45886102", "title": "non-lawful Monoid instances for building up AST not considered harmful?", "body": "<p>Quoting <a href=\"https://stackoverflow.com/questions/45805440/floating-points-wrapped-in-sum-and-product-even-if-it-breaks-associativity#comment78571015_45805440\">this answer on a similar question</a>:</p>\n\n<blockquote>\n  <p>You can think of it from this alternative point of view: the law (a &lt;> b) &lt;> c = a &lt;> (b &lt;> c) doesn't specify which equality should be used, i.e. what specific relation the = denotes. It is natural to think of it in terms of structural equality, but note that very few typeclass laws actually hold up to structural equality (e.g. try proving fmap id = id for [] as opposed to forall x . fmap id x = id x).</p>\n</blockquote>\n\n<p>For example, it's mostly fine if you do not export the constructors of <code>Foo</code>, and only export functions that, from the point of view of users, behave as if <code>Foo</code> were a monoid. But most of the time it is possible to come up with a representation that's structurally a monoid, good enough in practice, though maybe not as general (below, you cannot reassociate arbitrarily after the fact, because interpretation is mixed with construction).</p>\n\n<pre><code>type Foo = Endo String\n\nfoo :: String -&gt; Foo\nfoo s = Endo (s &lt;&gt;)\n\nunFoo :: Foo -&gt; String\nunFoo (Endo f) = f \"\"\n</code></pre>\n\n<p>(<a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Monoid.html#t:Endo\" rel=\"noreferrer\"><code>Data.Monoid.Endo</code></a>)</p>\n\n<hr>\n\n<p><a href=\"https://stackoverflow.com/questions/45647253/structurally-enforced-free-alternative-without-left-distributivity\">Here is another SO question where a non-structural structure (<code>Alternative</code>) is considered at first.</a></p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1503686478, "post_id": 45887133, "comment_id": 78734666, "body": "Yeah, but none of this is relevant for a <code>Monoid</code> instance like the OP&#39;s. A tree structure that does balancing or something would most certainly <i>not</i> just wrap <code>mappend</code> always in the same constructor, as that would easily lead to totally degenerate structure. The only reason to implement such a constructor is to make the exact associativity of expressions visible, but that&#39;s exactly what must not be possible according to the monoid rules. A structure that does <i>not</i> care for associativity should just have a constructor like <code>MConcat :: Seq Foo -&gt; Foo</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503686637, "post_id": 45887133, "comment_id": 78734747, "body": "@leftaroundabout, the <code>Monoid</code> instance will look different, but it also won&#39;t be (strictly) associative. Isn&#39;t that the real point?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503687511, "post_id": 45887133, "comment_id": 78735184, "body": "@leftaroundabout, I don&#39;t understand what you&#39;re getting at."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1503688485, "post_id": 45887133, "comment_id": 78735564, "body": "In <a href=\"http://comonad.com/reader/2015/free-monoids-in-haskell/\" rel=\"nofollow noreferrer\">&quot;Free Monoids In Haskell&quot;</a> Dan Doel touches upon this when he talks about mimicking quotients in Haskell by hiding implementation details within a module."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1503738560, "post_id": 45887133, "comment_id": 78746513, "body": "@dfeuer I&#39;m saying, these types you mention are not designed to in any way reflect the <i>way the values were built</i> at all. On the contrary, they smartly restructure in such a way that <i>no matter</i> how the value was defined, you&#39;ll get an efficient representation. This is in great contrast to the OP&#39;s example, which exactly replicates the <code>mappend</code> associativity in its ADT tree, even if this associativity is degenerate in list-form."}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504113966, "post_id": 45887133, "comment_id": 78891750, "body": "@leftaroundabout What do you mean by the associativity in my example being &quot;degenerate in list-form&quot;?  What does &quot;degenerate&quot; mean in this context?  (Also, what do you mean by &quot;list-form&quot;?  I was under the impression that my example is creating an AST for <code>mappend</code>, which is different from Haskell&#39;s list type and the <code>Monoid</code> instance for list.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 1, "creation_date": 1504118363, "post_id": 45887133, "comment_id": 78894218, "body": "@illabout by \u201cdegenerate in list-form\u201d I mean expressions of the form <code>a &lt;&gt; (b &lt;&gt; (c &lt;&gt; ... (p &lt;&gt; (q &lt;&gt; r))...))</code>. If you construct that with <code>FooAppent</code>, the structure will be <i>O</i> (<i>n</i>) deep, whereas the tree structures that David refers to always strive to keep a depth of only <i>O</i> (log <i>n</i>)."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 9, "last_activity_date": 1503685032, "last_edit_date": 1503685032, "creation_date": 1503684072, "answer_id": 45887133, "question_id": 45884762, "link": "https://stackoverflow.com/questions/45884762/non-lawful-monoid-instances-for-building-up-ast-not-considered-harmful/45887133#45887133", "title": "non-lawful Monoid instances for building up AST not considered harmful?", "body": "<p>This will come up for <em>most</em> non-trivial data structures. The only exceptions I can think of off the top of my head are (some) trie-like structures.</p>\n\n<ol>\n<li><p>Balanced tree data structures allow multiple balancings of most values. This is true of AVL trees, red-black trees, B-trees, 2-3 finger trees, etc.</p></li>\n<li><p>Data structures designed around \"rebuilding\", such as Hood-Melville queues, allow variable amounts of duplication within structures representing most values.</p></li>\n<li><p>Data structures implementing efficient priority queues allow multiple arrangements of elements.</p></li>\n<li><p>Hash tables will arrange elements differently depending on when collisions occur.</p></li>\n</ol>\n\n<p>None of these structures can be asymptotically as efficient without this flexibility. The flexibility, however, always breaks laws under the strictest interpretation. In Haskell, the only good way to deal with this is by using the module system to make sure no one can detect the problem. In experimental dependently typed languages, researchers have been working on things like observational type theory and homotopy type theory to find better ways to talk about \"equality\", but that research is pretty far from becoming practical.</p>\n"}], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 2, "accepted_answer_id": 45886102, "answer_count": 3, "score": 9, "last_activity_date": 1503694120, "creation_date": 1503674773, "last_edit_date": 1503683366, "question_id": 45884762, "link": "https://stackoverflow.com/questions/45884762/non-lawful-monoid-instances-for-building-up-ast-not-considered-harmful", "title": "non-lawful Monoid instances for building up AST not considered harmful?", "body": "<p>I've seen a data type defined like the following with a corresponding <code>Monoid</code> instance:</p>\n\n<pre><code>data Foo where\n  FooEmpty :: String -&gt; Foo\n  FooAppend :: Foo -&gt; Foo -&gt; Foo\n\n-- | Create a 'Foo' with a specific 'String'.\nfoo :: String -&gt; Foo\nfoo = FooEmpty\n\ninstance Monoid Foo where\n  mempty :: Foo\n  mempty = FooEmpty \"\"\n\n  mappend :: Foo -&gt; Foo -&gt; Foo\n  mappend = FooAppend\n</code></pre>\n\n<p>You can find the full code in a <a href=\"https://gist.github.com/cdepillabout/b49b640dcf8d2066260a4dbe42f56000\" rel=\"noreferrer\">gist</a> on Github.</p>\n\n<p>This is how <code>Foo</code> can be used:</p>\n\n<pre><code>exampleFoo :: Foo\nexampleFoo =\n  (foo \"hello\" &lt;&gt; foo \" reallylongstringthatislong\") &lt;&gt;\n  (foo \" world\" &lt;&gt; mempty)\n</code></pre>\n\n<p><code>exampleFoo</code> ends up as a tree that looks like this:</p>\n\n<pre><code>FooAppend\n  (FooAppend\n    (FooEmpty \"hello\")\n    (FooEmpty \" reallylongstringthatislong\"))\n  (FooAppend\n    (FooEmpty \" world\")\n    (FooEmpty \"\"))\n</code></pre>\n\n<p><code>Foo</code> can be used to turn sequences of <code>Monoid</code> operations (<code>mempty</code> and <code>mappend</code>) into an AST.  This AST can then be interpreted into some other <code>Monoid</code>.</p>\n\n<p>For instance, here is a translation of <code>Foo</code> into a <code>String</code> that makes sure the string appends will happen optimally:</p>\n\n<pre><code>fooInterp :: Foo -&gt; String\nfooInterp = go \"\"\n  where\n    go :: String -&gt; Foo -&gt; String\n    go accum (FooEmpty str) = str ++ accum\n    go accum (FooAppend foo1 foo2) = go (go accum foo2) foo1\n</code></pre>\n\n<p>This is really nice. It is convenient that we can be sure <code>String</code> appends will happen in the right order.  We don't have to worry about left-associated <code>mappend</code>s.</p>\n\n<p>However, the one thing that worries me is that the <code>Monoid</code> instance for <code>Foo</code> is not a legal <code>Monoid</code> instance.</p>\n\n<p>For instance, take the first <code>Monoid</code> law:</p>\n\n<pre><code>mappend mempty x = x\n</code></pre>\n\n<p>If we let <code>x</code> be <code>FooEmpty \"hello\"</code>, we get the following:</p>\n\n<pre><code>mappend mempty (FooEmpty \"hello\") = FooEmpty \"hello\"\nmappend (FooEmpty \"\") (FooEmpty \"hello\") = FooEmpty \"hello\"  -- replace mempty with its def\nFooAppend (FooEmpty \"\") (FooEmpty \"hello\") = FooEmpty \"hello\" -- replace mappend with its def\n</code></pre>\n\n<p>You can see that <code>FooAppend (FooEmpty \"\") (FooEmpty \"hello\")</code> does not equal <code>FooEmpty \"hello\"</code>.  The other <code>Monoid</code> laws also don't hold for similar reasons.</p>\n\n<p>Haskellers are usually against non-lawful instances.  But I feel like this is a special case. We are just trying to build up a structure that can be interpreted into another <code>Monoid</code>.  In the case of <code>Foo</code>, we can make sure that the <code>Monoid</code> laws hold for <code>String</code> in the <code>fooInterp</code> function.</p>\n\n<ol>\n<li><em>Is it ever okay to use these types of non-lawful instances to build up an AST?</em></li>\n<li>Are there any specific problems that need to be watched for when using these types of non-lawful instances?</li>\n<li>Is there an alternative way to write code that uses something like <code>Foo</code>?  Some way to enable interpretation of a monoidal structure instead of using <code>mappend</code> on a type directly?</li>\n</ol>\n"}, {"tags": ["haskell", "either"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1503672842, "post_id": 45883960, "comment_id": 78727032, "body": "Is <code>Either fmap</code> valid Haskell code?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1503673036, "post_id": 45883960, "comment_id": 78727163, "body": "Have you tried asking <a href=\"https://www.haskell.org/hoogle\" rel=\"nofollow noreferrer\">Hoogle</a>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503709666, "post_id": 45883960, "comment_id": 78741540, "body": "I have absolutely no idea what this question is asking. <code>Either fmap</code> means what? What is <code>p</code>? What&#39;s it mean for a function to &quot;stop&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1503673104, "creation_date": 1503673104, "answer_id": 45884243, "question_id": 45883960, "link": "https://stackoverflow.com/questions/45883960/either-fmap-which-continues-until-a-right-result-has-been-reached/45884243#45884243", "title": "&quot;Either Fmap&quot; which Continues until a Right Result has been Reached", "body": "<pre><code>Data.Bifunctor.first :: (a -&gt; b) -&gt; Either a c -&gt; Either b c\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>Data.Bifunctor&gt; first (+1) (Left 0)\nLeft 1\nData.Bifunctor&gt; first (+1) (Right 0)\nRight 0\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 3264325, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/86146abd707f94ed1fc249a76adf3ace?s=128&d=identicon&r=PG&f=1", "display_name": "user3264325", "link": "https://stackoverflow.com/users/3264325/user3264325"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 45884243, "answer_count": 1, "score": -2, "last_activity_date": 1503673104, "creation_date": 1503672208, "question_id": 45883960, "link": "https://stackoverflow.com/questions/45883960/either-fmap-which-continues-until-a-right-result-has-been-reached", "title": "&quot;Either Fmap&quot; which Continues until a Right Result has been Reached", "body": "<p>If <code>Either fmap</code> is</p>\n\n<p><code>(a -&gt; b) -&gt; p a a -&gt; p a b</code></p>\n\n<p>which stops mapping once a <code>Left</code> is returned.</p>\n\n<p>What's name or type signature for a function which doesn't stop until it gets a <code>Right</code> result.</p>\n\n<p>I suspect a bifunctor, but I really need it spelled out - don't quite get the subtlety of the logic of these things yet.</p>\n\n<p>Perhaps some sort of <code>fold</code> fits also...</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503666740, "post_id": 45882140, "comment_id": 78722851, "body": "I think you should try to use a recursive helper function and put the &quot;mismatched&quot; elements in an accumulator list, moreover you should think what should happen if the list-lengths are different. The first number i guess is the number of elements in the accumulator list - use <code>length</code> for that."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503666787, "post_id": 45882140, "comment_id": 78722890, "body": "also your sample is not correct haskell code - <code>where</code> .. <code>in</code> is incorrect."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1503686841, "post_id": 45882140, "comment_id": 78734864, "body": "Can you offer more explanation for what you want to achieve? We begin with &quot;two strings&quot; <code>a</code> and <code>b</code> but these are in fact lists of strings. What are some examples of &quot; the difference between two strings based on the first character and second character and combination of two characters&quot;?"}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "edited": false, "score": 0, "creation_date": 1503671544, "post_id": 45882504, "comment_id": 78726158, "body": "Thank you so much! that`s so helpful!!"}, {"owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "edited": false, "score": 0, "creation_date": 1503671677, "post_id": 45882504, "comment_id": 78726252, "body": "What does the results do in this?"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "edited": false, "score": 0, "creation_date": 1503677088, "post_id": 45882504, "comment_id": 78729665, "body": "<code>results</code> is just the list to accumulate the difference. It&#39;s <code>[&quot;B2&quot;,&quot;D5&quot;]</code> in the resulting tuple."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 1, "last_activity_date": 1503667518, "creation_date": 1503667518, "answer_id": 45882504, "question_id": 45882140, "link": "https://stackoverflow.com/questions/45882140/calculating-the-difference-between-two-strings/45882504#45882504", "title": "Calculating the difference between two strings", "body": "<p>What about doing it recursively? If two elements are the same, the first element of the resulting tuple is incremented; otherwise, the second element of the resulting tuple is appended by the mismatched element:</p>\n\n<pre><code>calcP :: [String] -&gt; [String] -&gt; (Int,[String])\ncalcP (x:xs) (y:ys)\n  | x == y = increment (calcP xs ys)\n  | otherwise = append y (calcP xs ys)\n  where\n    increment (count, results) = (count + 1, results)\n    append y (count, results) = (count, y:results)\n\ncalcP [] x = (0, x)\ncalcP x [] = (0, [])\n\na = [\"A1\",\"A2\",\"B3\",\"C3\"]\nb = [\"A1\",\"B2\",\"B3\",\"D5\"]\n\nmain = print $ calcP a b\n</code></pre>\n\n<p>The printed result is <code>(2,[\"B2\",\"D5\"])</code></p>\n\n<p>Note, that</p>\n\n<pre><code>calcP [] x = (0, x)\ncalcP x [] = (0, [])\n</code></pre>\n\n<p>are needed to provide exhaustiveness for the pattern matching. In other words, you need to provide the case when one of the passed elements is an empty list. This also provides the following logic:</p>\n\n<p>If the first list is greater than the second one on <code>n</code> elements, these <code>n</code> last elements are ignored.</p>\n\n<p>If the second list is greater than the first one on <code>n</code> elements, these <code>n</code> last elements are appended to the second element of the resulting tuple.</p>\n"}, {"tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": false, "score": 2, "last_activity_date": 1503688330, "last_edit_date": 1503688330, "creation_date": 1503680619, "answer_id": 45886332, "question_id": 45882140, "link": "https://stackoverflow.com/questions/45882140/calculating-the-difference-between-two-strings/45886332#45886332", "title": "Calculating the difference between two strings", "body": "<p>I assume that the lists have the same size.</p>\n\n<h1>The differences between the two lists</h1>\n\n<p>Let's focus on the main part of the problem:</p>\n\n<pre><code>Prelude&gt; a=[\"A1\",\"A2\",\"B3\",\"C3\"]\nPrelude&gt; b=[\"A1\",\"B2\",\"B3\",\"D5\"]\n</code></pre>\n\n<p>First, notice that the <code>zip</code> method zips two lists. If you use it on <code>a</code> and <code>b</code>, you get:</p>\n\n<pre><code>Prelude&gt; zip a b\n[(\"A1\",\"A1\"),(\"A2\",\"B2\"),(\"B3\",\"B3\"),(\"C3\",\"D5\")]\n</code></pre>\n\n<p>Ok. It's now time to compare the terms one to one. There are many ways to do it.</p>\n\n<h2>Filter</h2>\n\n<pre><code>Prelude&gt; filter(\\(x,y)-&gt;x/=y)(zip a b)\n[(\"A2\",\"B2\"),(\"C3\",\"D5\")]\n</code></pre>\n\n<p>The lambda function returns True if the elements of the pair are different (<code>/=</code> operator). Thus, the filter keeps only the pairs that don't match.\nIt's ok, but you have to do a little more job to keep only the second element of each pair.</p>\n\n<pre><code>Prelude&gt; map(snd)(filter(\\(x,y)-&gt;x/=y)(zip a b))\n[\"B2\",\"D5\"]\n</code></pre>\n\n<p><code>map(snd)</code> applies <code>snd</code>, which keeps only the second element of a pair, to every discordant pair.</p>\n\n<h2>Fold</h2>\n\n<p>A fold is more generic, and may be used to implement a filter. Let's see how:</p>\n\n<pre><code>Prelude&gt; foldl(\\l(x,y)-&gt;if x==y then l else l++[y])[](zip a b)\n[\"B2\",\"D5\"]\n</code></pre>\n\n<p>The lambda function takes every pair <code>(x,y)</code> and compares the two elements. If they have the same value, the accumulator list remains the identical, but if the values are different, the accumulator list is augmented by the second element.</p>\n\n<h2>List comprehension</h2>\n\n<p>This is more compact, and should seem obvious to every Python programmer:</p>\n\n<pre><code>Prelude&gt; [y|(x,y)&lt;-zip a b, x/=y] -- in Python [y for (x,y) in zip(a,b) if x!= y]\n[\"B2\",\"D5\"]\n</code></pre>\n\n<h1>The number of elements</h1>\n\n<p>You want a pair with the number of elements and the elements themselves. </p>\n\n<h2>Fold</h2>\n\n<p>With a fold, it's easy but cumbersome: you will use a slightly more complicated accumulator, that stores simultaneously the differences (<code>l</code>) and the number of those differences (<code>n</code>).</p>\n\n<pre><code>Prelude&gt; foldl(\\(n,l)(x,y)-&gt;if x==y then (n,l) else (n+1,l++[y]))(0,[])$zip a b\n(2,[\"B2\",\"D5\"])\n</code></pre>\n\n<h2>Lambda</h2>\n\n<p>But you can use the fact that your output is redundant: you want a list preceeded by the length of that list. Why not apply a lambda that does the job?</p>\n\n<pre><code>Prelude&gt; (\\x-&gt;(length x,x))[1,2,3]\n(3,[1,2,3])\n</code></pre>\n\n<p>With a list comprehension, it gives:</p>\n\n<pre><code>Prelude&gt; (\\x-&gt;(length x,x))[y|(x,y)&lt;-zip a b, x/=y]\n(2,[\"B2\",\"D5\"])\n</code></pre>\n\n<h2>Bind operator</h2>\n\n<p>Finally, and for the fun, you don't need to build the lambda this way. You could do:</p>\n\n<pre><code>Prelude&gt; ((,)=&lt;&lt;length)[y|(x,y)&lt;-zip a b,x/=y]\n(2,[\"B2\",\"D5\"])\n</code></pre>\n\n<p>What happens here? <code>(,)</code> is a operator that makes a pair from two elements:</p>\n\n<pre><code>Prelude&gt; (,) 1 2\n(1,2)\n</code></pre>\n\n<p>and <code>((,)=&lt;&lt;length)</code> : 1. takes a list (technically a <code>Foldable</code>) and passes it to the <code>length</code> function; 2. the list and the length are then passed by <code>=&lt;&lt;</code> (the \"bind\" operator) to the <code>(,)</code> operator, hence the expected result.</p>\n\n<h1>Partial conclusion</h1>\n\n<ul>\n<li>\"There is more than than one way to do it\" (but it's not Perl!)</li>\n<li>Haskell offers a lot of builtins functions and operators to handle this kind of basic manipulation.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1503684504, "creation_date": 1503684504, "answer_id": 45887227, "question_id": 45882140, "link": "https://stackoverflow.com/questions/45882140/calculating-the-difference-between-two-strings/45887227#45887227", "title": "Calculating the difference between two strings", "body": "<p>I'd like to propose a very different method than the other folks: namely, compute a \"summary statistic\" for each pairing of elements between the two lists, and then combine the summaries into your desired result.</p>\n\n<p>First some imports.</p>\n\n<pre><code>import Data.Monoid\nimport Data.Foldable\n</code></pre>\n\n<p>For us, the summary statistic is how many matches there are, together with the list of mismatches from the second argument:</p>\n\n<pre><code>type Statistic = (Sum Int, [String])\n</code></pre>\n\n<p>I've used <code>Sum Int</code> instead of <code>Int</code> to specify how statistics should be combined. (Other options here include <code>Product Int</code>, which would multiply together the values instead of adding them.) We can compute the summary of a single pairing quite simply:</p>\n\n<pre><code>summary :: String -&gt; String -&gt; Statistic\nsummary a b | a == b    = (1, [ ])\n            | otherwise = (0, [b])\n</code></pre>\n\n<p>Combining the summaries for all the elements is just a <code>fold</code>:</p>\n\n<pre><code>calcP :: [String] -&gt; [String] -&gt; Statistic\ncalcP as bs = fold (zipWith summary as bs)\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>&gt; calcP [\"A1\", \"A2\", \"B3\", \"C3\"] [\"A1\", \"B2\", \"B3\", \"D5\"]\n(Sum {getSum = 2},[\"B2\",\"D5\"])\n</code></pre>\n\n<p>This general pattern (of processing elements one at a time into a <code>Monoid</code>al type) is frequently useful, and spotting where it's applicable can greatly simplify your code.</p>\n"}], "owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1065, "favorite_count": 0, "accepted_answer_id": 45882504, "answer_count": 3, "score": 2, "last_activity_date": 1503688330, "creation_date": 1503666335, "last_edit_date": 1503668394, "question_id": 45882140, "link": "https://stackoverflow.com/questions/45882140/calculating-the-difference-between-two-strings", "title": "Calculating the difference between two strings", "body": "<p>I have two strings</p>\n\n<pre><code>a :: [String]\na = [\"A1\",\"A2\",\"B3\",\"C3\"]\n</code></pre>\n\n<p>and </p>\n\n<pre><code>b :: [String]\nb = [\"A1\",\"B2\",\"B3\",\"D5\"]\n</code></pre>\n\n<p>And I want to calculate the difference between two strings based on the first character and second character and combination of two characters.\nIf the combination of two elements are the same, it would be calculate as 1</p>\n\n<p>The function I declared is </p>\n\n<pre><code>calcP :: [String] -&gt; [String] -&gt; (Int,[String])\ncalcP (x:xs) (y:ys) = (a,b)\n  where\n    a = 0 in\n      ???\n    b = ????\n</code></pre>\n\n<p>I know that I should have a increment variable to count the correct element, and where I should put it in? For now I totally have no idea about how to do that, can anyone give me some hint??</p>\n\n<p>The desired result would be </p>\n\n<pre><code>(2,[\"B2\",\"D5\"])\n</code></pre>\n\n<p>How should I do that?</p>\n"}, {"tags": ["haskell", "state", "yesod"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1503652929, "post_id": 45877090, "comment_id": 78714776, "body": "Yes, there are better ways to do that. For example, you can keep pretty much all of the client state in a database and retrieve/change it upon a clients request (get would only require an ID, post an ID  + changeset). <a href=\"https://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\"><code>persistent</code></a> is the &quot;default&quot; way to do this with <code>Yesod</code>, but you can roll your own solution or use something else if you want to."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 4, "last_activity_date": 1503653446, "creation_date": 1503653446, "answer_id": 45878456, "question_id": 45877090, "link": "https://stackoverflow.com/questions/45877090/keeping-state-around-in-yesod/45878456#45878456", "title": "Keeping state around in Yesod", "body": "<p>This is pretty easy. Yesod's machinery spins around a data type called <code>Foundation</code>. In scaffolding this data type has the same name, even.</p>\n\n<p>What you need to do is to extend this data type with a record representing your state, <code>MVar YourState</code>, for instance.</p>\n\n<p>Now, in <code>Handler</code> actions you can use <code>y &lt;- getYesod</code> to get the Foundation value, extract a MVar out of it and use/modify it at your will.</p>\n"}], "owner": {"reputation": 55, "user_id": 5397052, "user_type": "registered", "profile_image": "https://graph.facebook.com/1029711010393985/picture?type=large", "display_name": "Dalta na bP&#237;ob", "link": "https://stackoverflow.com/users/5397052/dalta-na-bp%c3%adob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 45878456, "answer_count": 1, "score": 0, "last_activity_date": 1503653446, "creation_date": 1503648830, "question_id": 45877090, "link": "https://stackoverflow.com/questions/45877090/keeping-state-around-in-yesod", "title": "Keeping state around in Yesod", "body": "<p>I'm trying to implement a Pachisi-like boardgame with Yesod. Currently, the Haskell code receives the current state of the board via Ajax, does some stuff with it (e.g. calculate if a new piece can enter the board, whether the game ends and so on) and returns it as JSON that the client can use to update the view.</p>\n\n<p>In effect, I'm keeping state in the client to circumvent the problem that Haskell has no mutability. In other languages I'd probably declare a variable <code>gameState</code> and have server-side code modify it before returning it to the client, but in Haskell... I may be missing something entirely; I'm far from experienced when it comes to Haskell. </p>\n\n<p>I want to do as little as possible client-side since this is supposed to be an exercise in haskelling. I've found <a href=\"https://stackoverflow.com/questions/10007497/haskell-yesod-and-state\">Haskell: Yesod and state</a> but couldn't really make sense of it. So the question remains: is there any better way to handle the game state than my solution? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1503644272, "post_id": 45875955, "comment_id": 78710148, "body": "The type you want is just <code>[(String, String, String)]</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503650427, "post_id": 45875955, "comment_id": 78713406, "body": "Good answers already.  Also consider <code>[[String]]</code>, which may be more convenient if you treat the three inner strings uniformly."}], "answers": [{"comments": [{"owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503652859, "post_id": 45876093, "comment_id": 78714723, "body": "How can I use a type like this? For example if I cons a list like this <code>&quot;abc&quot;:&quot;def&quot;:&quot;ghi&quot;:[]</code>, how can I construct a new <code>MyType</code> with this list as the first entry?"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "edited": false, "score": 0, "creation_date": 1503653118, "post_id": 45876093, "comment_id": 78714883, "body": "For example, <code>(&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;) : []</code> gives <code>[(&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;)]</code>. To construct <code>MyType</code>, simply <code>Lists (&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</code>"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 1, "last_activity_date": 1503644902, "creation_date": 1503644902, "answer_id": 45876093, "question_id": 45875955, "link": "https://stackoverflow.com/questions/45875955/define-a-data-type-to-represent-a-nested-list-of-strings/45876093#45876093", "title": "Define a data type to represent a nested list of strings", "body": "<blockquote>\n  <p>the inner lists will always have a length of 3</p>\n</blockquote>\n\n<p>The data structure you're looking for is tuple. Its fundamental difference from list is that tuple's type depends on the number of elements in it. You can read about it <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>It's going to look like:</p>\n\n<pre><code>[(\"abc\", \"def\", \"ghi\"), (\"abc\", \"def\", \"ghi\"), (\"abc\", \"def\", \"ghi\")]\n</code></pre>\n\n<p>The type of this structure is <code>[(String, String, String)]</code></p>\n\n<p>Therefore, <code>MyType</code> will be something like:</p>\n\n<pre><code>data MyType = Lists (String, String, String) | List [MyType]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 2, "last_activity_date": 1503645845, "last_edit_date": 1503645845, "creation_date": 1503645165, "answer_id": 45876152, "question_id": 45875955, "link": "https://stackoverflow.com/questions/45875955/define-a-data-type-to-represent-a-nested-list-of-strings/45876152#45876152", "title": "Define a data type to represent a nested list of strings", "body": "<p>You only need to define the type, data is used for other purpouses:</p>\n\n<pre><code>type MyType = [(String, String, String)]\n</code></pre>\n\n<p>Check this <a href=\"https://stackoverflow.com/a/7916394/1695172\">answer</a>\nIf you really want to create a new Algebraic data type, for example:</p>\n\n<pre><code>data MyType = Tup3 String String String | List [MyType] deriving Show\n</code></pre>\n\n<p><a href=\"https://repl.it/KZ1v/1\" rel=\"nofollow noreferrer\">Live example</a></p>\n"}, {"tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": false, "score": 0, "last_activity_date": 1503711407, "creation_date": 1503711407, "answer_id": 45891167, "question_id": 45875955, "link": "https://stackoverflow.com/questions/45875955/define-a-data-type-to-represent-a-nested-list-of-strings/45891167#45891167", "title": "Define a data type to represent a nested list of strings", "body": "<p>If you just want a type of lists whose elements are \"three element lists\", then you can just use a list of triples (tuples of three elements).</p>\n\n<p><code>type MyType = [(String, String, String)]</code></p>\n\n<p>For example, <code>[]</code>, <code>[(\"a\",\"b\",\"c\")]</code> or <code>[(\"abc\", \"def\", \"ghi\"), (\"abc\", \"def\", \"ghi\"), (\"abc\", \"def\", \"ghi\")]</code> are inhabitants of <code>MyType</code>.</p>\n\n<p>Comment aside: As other anwers stated, if the lenght of the lists is fixed, then it's not a list what you are talking about, it's rather a vector or tuple. </p>\n"}], "owner": {"reputation": 1713, "user_id": 3989939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/530734853101ecc62e278406ed5b9065?s=128&d=identicon&r=PG&f=1", "display_name": "JavascriptLoser", "link": "https://stackoverflow.com/users/3989939/javascriptloser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 586, "favorite_count": 0, "accepted_answer_id": 45876093, "answer_count": 3, "score": 0, "last_activity_date": 1503711407, "creation_date": 1503644198, "last_edit_date": 1503644223, "question_id": 45875955, "link": "https://stackoverflow.com/questions/45875955/define-a-data-type-to-represent-a-nested-list-of-strings", "title": "Define a data type to represent a nested list of strings", "body": "<p>I am just starting out learning haskell and I find myself challenged trying to define a data type to represented a list of lists of <code>String</code>'s. That sounds a little confusing but this is essentially what a data type of this form would look like:</p>\n\n<pre><code>[[\"abc\", \"def\", \"ghi\"], [\"abc\", \"def\", \"ghi\"], [\"abc\", \"def\", \"ghi\"]]\n</code></pre>\n\n<p>Each of the inner lists will always have a length of 3, but the strings inside can be of arbitrary length greater than one.</p>\n\n<p>I tried this:</p>\n\n<pre><code>data MyType = Lists [String] | List [MyType]\n</code></pre>\n\n<p>But I'm not sure if its correct, or maybe that I don't know how to use it. If it is correct, how would I go about constructing a list of lists of these words, or if it is incorrect, what would be the correct way of defining this type?</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "wreq"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 4, "creation_date": 1503639432, "post_id": 45874798, "comment_id": 78708316, "body": "Couldn&#39;t you flatten <code>Either e (Maybe b)</code> into <code>Either e b</code>, where the <code>e</code> can also carry information about deserialization failures? <code>Maybe b</code> is isomorphic to <code>Either () b</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1503661970, "post_id": 45874798, "comment_id": 78719809, "body": "I&#39;d consider using a custom data type <code>data ResourceResult b = Error e | NotModified | Result b</code>. Library sum and product types are fine, but are flavorless: they are so generic that they convey no meaning. It&#39;s better to use a custom type with proper, evocative names."}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503695061, "post_id": 45874798, "comment_id": 78738269, "body": "Thank you for this recommendation @chi.  I will keep this in mind."}], "answers": [{"comments": [{"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 0, "creation_date": 1503694821, "post_id": 45882698, "comment_id": 78738177, "body": "I will try this tonight and get back to you."}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 0, "creation_date": 1503708548, "post_id": 45882698, "comment_id": 78741412, "body": "After doing some reading on <code>MonadThrow</code> at <a href=\"https://www.schoolofhaskell.com/user/commercial/content/exceptions-best-practices\" rel=\"nofollow noreferrer\">schoolofhaskell.com/user/commercial/content/&hellip;</a>  It looks like MonadThrow will hide the exception that gets thrown.  I don&#39;t want this to happen because if the exception is a 304 response code the consumer will need to know so they can serve what data they have cached.  The idea of using a custom type sounds appealing."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 1, "creation_date": 1503724338, "post_id": 45882698, "comment_id": 78743453, "body": "@NickAcosta Yes, a custom type may be what you want, but it&#39;s hardly correct to say that <code>MonadThrow</code> will hide the exception. This is true for <code>Maybe</code>, because <code>Nothing</code> throws away the error cause, but for <code>Either e</code>, the exception is right there in the <code>Left</code> case, and can be handled with <code>catch</code>."}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 0, "creation_date": 1503726312, "post_id": 45882698, "comment_id": 78743769, "body": "True. Im going to tinker some more later. Thanks for the time, effort and explanations. Have a good weekend."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 1, "creation_date": 1503730324, "post_id": 45882698, "comment_id": 78744583, "body": "@NickAcosta FWIW, using <code>MonadThrow</code> with exceptions <i>enables</i> a client to handle exceptions using <code>catch</code>, but it doesn&#39;t <i>force</i> it to do so. OTOH, if you use <code>Either</code> or a custom sum type like the one suggested by @chi, then you <i>force</i> the client to handle all outcomes of the operation. I tend to lean towards the latter, but it does depend on which goal you&#39;re trying to reach."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1503668228, "creation_date": 1503668228, "answer_id": 45882698, "question_id": 45874798, "link": "https://stackoverflow.com/questions/45874798/haskell-wreq-advice-on-complicated-type-signatures-for-http-requests/45882698#45882698", "title": "Haskell / Wreq - Advice on complicated type signatures for http requests", "body": "<p>This may not be quite what you want, but <code>asJSON</code> has the return type <code>m (Response a)</code>, where <code>m</code> is a <code>MonadThrow</code>. While <code>Maybe</code> is a <code>MonadThrow</code> instance, then so is <code>Either e</code>. This means that you don't <em>have</em> to use <code>Maybe</code> in order to handle if anything goes wrong with <code>asJSON</code>. You can 'stay' in the <code>Either</code> monad instead:</p>\n\n<pre><code>getPayload :: FromJSON b =&gt; Either SomeException (Response L.ByteString)\n                         -&gt; Either SomeException b\ngetPayload = ((fmap (^. responseBody) . asJSON) =&lt;&lt;)\n</code></pre>\n\n<p>Clearly, this puts an additional constraint on the type of error on the left side, so I'm not sure that this is acceptable. If not, please leave a comment.</p>\n"}], "owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 1, "accepted_answer_id": 45882698, "answer_count": 1, "score": 6, "last_activity_date": 1503668228, "creation_date": 1503638022, "question_id": 45874798, "link": "https://stackoverflow.com/questions/45874798/haskell-wreq-advice-on-complicated-type-signatures-for-http-requests", "title": "Haskell / Wreq - Advice on complicated type signatures for http requests", "body": "<p>I'm a Haskell beginner and am currently using <a href=\"http://www.serpentine.com/wreq/\" rel=\"noreferrer\">wreq</a> to make a simple wrapper around an api.  I want to send an <code>if-modified-since</code> header if provided with a time.  I am doing so in the following manner.</p>\n\n<pre><code>getResponse :: (FormatTime t, Exception e) =&gt; File -&gt; Maybe t -&gt; IO (Either e (Response L.ByteString))\ngetResponse file (Just t) =\n  let formattedTime = (B.pack . formatTime defaultTimeLocale rfc822DateFormat) t\n      opts = defaults &amp; header \"if-modified-since\" .~ [formattedTime]\n  in try $ getWith opts $ buildUrl file\n\ngetResponse file Nothing = try $ (get $ buildUrl file)\n</code></pre>\n\n<p>I noticed that <code>304 (not modified)</code> responses are coming back as exceptions so that was my justification for using the <code>Either</code> type.  I wanted to provide visibility to errors for people that might use this api wrapper.</p>\n\n<p>Assuming the request is successful, I want to parse the response body into a corresponding type defined in my library. There is a chance deserialization might not work correctly if something changes on the server I'm making requests to so I chose to use the <code>Maybe</code> type to account for this.</p>\n\n<pre><code>getPayload :: FromJSON b =&gt; (Either e (Response L.ByteString)) -&gt; Either e (Maybe b)\ngetPayload (Left _)  = return Nothing\ngetPayload (Right a) = return $ fmap Just (^. responseBody) =&lt;&lt; asJSON a\n</code></pre>\n\n<p>The signatures of these functions are starting to seem like an eyesore to me, something in my gut is telling me there is a better way but I am unsure. One thing I did was make another function to put them together with the hopes it would be easier to use.  This is the function I plan on using to create other functions to make more specific requests to individual resources.</p>\n\n<pre><code>getResource :: (Exception e, FormatTime t, FromJSON b) =&gt; File -&gt; Maybe t -&gt; IO (Either e (Maybe b))\ngetResource f t =  getPayload &lt;$&gt; (getResponse f t)\n</code></pre>\n\n<p>I now have to deal with 3 layers of structure when dealing with an http request.  <code>IO</code>, <code>Either</code>, and <code>Maybe</code>.  Am I making this too complicated? What can I do to make this less of a pain to work with from a usage and maintainability perspective? How can I improve this?</p>\n"}, {"tags": ["haskell", "conduit", "attoparsec"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1503617967, "post_id": 45872285, "comment_id": 78703632, "body": "Does <code>sourcePort port .| dropC 4 &gt;&gt; dropWhileC B.null &gt;&gt;  conduitParser (parseMeasurement &lt;* endOfLine) $$ .....</code> work?"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1503618114, "post_id": 45872285, "comment_id": 78703660, "body": "Unfortunately not: <code>Couldn&#39;t match type `ByteString&#39; with `()&#39;</code>"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1503619360, "post_id": 45872285, "comment_id": 78703935, "body": "How about with parentheses, like <code>sourcePort port .| (dropC 4 &gt;&gt; dropWhileC B.null &gt;&gt; conduitParser (parseMeasurement &lt;* endOfLine)) $$ ..... </code>"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1503619456, "post_id": 45872285, "comment_id": 78703960, "body": "Yeah, that <i>does</i> work, Thank you!"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1503619474, "post_id": 45872285, "comment_id": 78703966, "body": "@danidiaz Would you like to write an answer explaining where I went wrong?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1503620200, "post_id": 45872285, "comment_id": 78704149, "body": "It is explained in this other answer <a href=\"https://stackoverflow.com/a/10836477/1364288\">stackoverflow.com/a/10836477/1364288</a> Basically, <code>dropC</code> and <code>dropWhileC</code> are <code>Consumer</code>s, a more polymorphic form of <code>Sink</code>s which can also be used as <code>Conduit</code>s. The thing is that, by themselves, they just stop after dropping the specified elements, and terminate the stream. If you want to &quot;keep doing something with the stream&quot;, for example parse it, you have to use monadic composition. When you composed the <code>drop</code>&#39;s and <code>conduitParser</code> using <code>.|</code>, you made the parser wait for elements which never would arrive, because <code>drop</code>s never yield anything."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1503621788, "post_id": 45872285, "comment_id": 78704501, "body": "<code>conduit</code>, <code>pipes</code> and <code>streaming</code> all handle <code>drop</code> differently. In <code>pipes</code>, <code>drop</code> returns an intermediate <code>Pipe</code> stage which (unlike conduit&#39;s <code>drop</code>) does yield the rest of the stream automatically <a href=\"http://hackage.haskell.org/package/pipes-4.3.4/docs/Pipes-Prelude.html#v:drop\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pipes-4.3.4/docs/&hellip;</a> And in <code>streaming</code>, <code>drop</code> returns a function from <code>Stream</code> to <code>Stream</code>: <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.5/docs/Streaming-Prelude.html#v:drop\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/streaming-0.1.4.5/docs/&hellip;</a>"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1503623274, "post_id": 45872285, "comment_id": 78704817, "body": "@danidiaz One final question: it seems to me like dropping some items from a list and feeding the remainder to another conduit should be a fairly common use-case. Do you happen to know if I could rewrite my function more elegantly with other operators (apart from wrapping <code>dropC</code> like @MichaelSnoyman showed)?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1503642669, "post_id": 45872285, "comment_id": 78709460, "body": "That I don&#39;t know."}], "answers": [{"tags": [], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "is_accepted": true, "score": 2, "last_activity_date": 1506602414, "last_edit_date": 1506602414, "creation_date": 1503684453, "answer_id": 45887214, "question_id": 45872285, "link": "https://stackoverflow.com/questions/45872285/conduit-parser-is-interrupted-prematurely/45887214#45887214", "title": "Conduit parser is interrupted prematurely", "body": "<p>@danidiaz has explained in the comments that <code>dropC</code> et.al. do not yield any values, which is why you must use monadic composition instead of piping (<code>.|</code>).</p>\n\n<p>To anyone who stumbles upon this question, see <a href=\"https://stackoverflow.com/a/10836477/1364288\">this answer</a> for details.</p>\n\n<p>This code works as expected:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parseSerialStream :: RingBuffer VU.Vector (Int, Int) -&gt; SerialPort -&gt; IO () -- ConduitM a c IO ()\nparseSerialStream buffer port = sourcePort port\n                             .| (dropC 4\n                             &gt;&gt; dropWhileC B.null\n                             &gt;&gt; conduitParser (parseMeasurement &lt;* endOfLine))\n                             $$ mapM_C (\\item -&gt; RB.append (snd item) buffer)\n</code></pre>\n\n<p>I liked how the pipes looked though. Oh well...</p>\n"}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 45887214, "answer_count": 1, "score": 2, "last_activity_date": 1506602414, "creation_date": 1503616918, "last_edit_date": 1503619501, "question_id": 45872285, "link": "https://stackoverflow.com/questions/45872285/conduit-parser-is-interrupted-prematurely", "title": "Conduit parser is interrupted prematurely", "body": "<p>I'm working on a program where I need to parse data from a USB connection and write it to a circular buffer.</p>\n\n<p>The issue I keep running into is that the parser is not consuming the input. Do I need to use another operator to connect the parser conduit to the stream of <code>ByteString</code>s?</p>\n\n<p>If I remove the two 'filters' <code>dropC</code> and <code>dropWhileC</code>, the parser consumes some of the input but fails, because the first few chunks of data are junk.</p>\n\n<p>Clearly my mental model of how the library works is off somehow (I've never used it before).</p>\n\n<p>I'd also like to know if empty strings are treated as EOF markers by <code>conduitParser</code>, as with <code>attoparsec</code>s own <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.2.0/docs/Data-Attoparsec-ByteString-Char8.html#v:parseWith\" rel=\"nofollow noreferrer\"><code>parseWith</code></a>.</p>\n\n<pre><code>-- |\nsourcePort :: SerialPort -&gt; Producer IO ByteString\nsourcePort port = repeatMC (recv port 16)\n\n\n-- |\nparseSerialStream :: (Vector v (Int, Int)) =&gt; RingBuffer v (Int, Int) -&gt; SerialPort -&gt; IO () -- ConduitM a c IO ()\nparseSerialStream buffer port = sourcePort port\n                             .| dropC 4\n                             .| dropWhileC B.null\n                             .| conduitParser (parseMeasurement &lt;* endOfLine)\n                             $$ mapM_C (\\item -&gt; print item &gt;&gt; RB.append (snd item) buffer)\n</code></pre>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1503598760, "post_id": 45867892, "comment_id": 78695626, "body": "The question is based on a faulty premise: the implementation of <code>random</code> for <code>Bool</code> need not (and does not) call the implementation of <code>random</code> for <code>Int</code>."}, {"owner": {"reputation": 55, "user_id": 8351855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6ac0e0979c346e6a9a18fbf4203e24c?s=128&d=identicon&r=PG&f=1", "display_name": "user38352", "link": "https://stackoverflow.com/users/8351855/user38352"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1503599148, "post_id": 45867892, "comment_id": 78695878, "body": "I am basing my example code on a tutorial series called &quot;Learn You a Haskell for Great Good!&quot;. As I am a beginner, I wouldn&#39;t even know my premise is faulty"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503601814, "post_id": 45867892, "comment_id": 78697325, "body": "Can you explain what you expect the output to be, and why?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1503607233, "post_id": 45867892, "comment_id": 78699991, "body": "The premise is not really faulty: A <code>RandomGen</code> produces <code>Int</code>\u2019s (see <code>next</code>), and the other instances are built on that."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1503621992, "post_id": 45867892, "comment_id": 78704544, "body": "@user38352 That&#39;s why Daniel Wagner is telling you that. He&#39;s not saying &quot;gosh you should have known better&quot;, but &quot;the behavior you noticed doesn&#39;t have the cause that you guessed it did&quot;. Clearly you couldn&#39;t know by yourself that the premise was faulty, but now that you&#39;ve been told, you do. Hurrah, learning for everyone."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1503696857, "post_id": 45867892, "comment_id": 78738874, "body": "For what it&#39;s worth, this isn&#39;t a property of Haskell, but a property of the implementation of the <code>random</code> package, separate from the base module."}, {"owner": {"reputation": 55, "user_id": 8351855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6ac0e0979c346e6a9a18fbf4203e24c?s=128&d=identicon&r=PG&f=1", "display_name": "user38352", "link": "https://stackoverflow.com/users/8351855/user38352"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1503880115, "post_id": 45867892, "comment_id": 78779628, "body": "@DanielWagner, Could you provide an example of how <code>random</code> is implemented for <code>Bool</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1503883358, "post_id": 45867892, "comment_id": 78780181, "body": "@user38352 The answer you accepted includes the complete source for the <code>random @Bool</code>."}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 8, "last_activity_date": 1503607414, "last_edit_date": 1503607414, "creation_date": 1503596809, "answer_id": 45867979, "question_id": 45867892, "link": "https://stackoverflow.com/questions/45867892/how-does-haskell-determine-what-kind-of-boolean-a-randomly-generated-number-is/45867979#45867979", "title": "How does Haskell determine what kind of boolean a randomly generated number is?", "body": "<p>The <code>Instance Bool</code> shares the implementation with <code>Instance Int</code>, but the code that is shared is the one for <code>randomR</code>, which takes a range. We can verify this using QuickCheck:</p>\n\n<pre><code>Prelude&gt; import Test.QuickCheck\nPrelude Test.QuickCheck&gt; import System.Random\nPrelude Test.QuickCheck System.Random&gt; :{\nPrelude Test.QuickCheck System.Random| prop seed = let\nPrelude Test.QuickCheck System.Random|   gen = mkStdGen seed\nPrelude Test.QuickCheck System.Random|   b = fst (random gen)\nPrelude Test.QuickCheck System.Random|   i = fst (randomR (0,1) gen)\nPrelude Test.QuickCheck System.Random|  in if b then i == 1 else i == 0\nPrelude Test.QuickCheck System.Random| :}\nPrelude Test.QuickCheck System.Random&gt; quickCheck prop\n+++ OK, passed 100 tests.\n</code></pre>\n\n<p>You can also look at the <a href=\"http://hackage.haskell.org/package/random-1.1/docs/src/System-Random.html#instance%20Random%20Bool\" rel=\"nofollow noreferrer\">definition of the <code>instance Random Bool</code></a> where you will find this code:</p>\n\n<pre><code>instance Random Bool where\n  randomR (a,b) g = \n      case (randomIvalInteger (bool2Int a, bool2Int b) g) of\n        (x, g') -&gt; (int2Bool x, g')\n       where\n         bool2Int :: Bool -&gt; Integer\n         bool2Int False = 0\n         bool2Int True  = 1\n\n     int2Bool :: Int -&gt; Bool\n     int2Bool 0 = False\n     int2Bool _ = True\n\n  random g    = randomR (minBound,maxBound) g\n</code></pre>\n\n<p>so essential, you are calling <code>randomR (0,1)</code> and then mapping <code>0</code> to <code>False</code> and <code>1</code> to <code>True</code>:</p>\n\n<pre><code>&gt; random (mkStdGen 949488) :: (Bool, StdGen)\n(False,1485632275 40692)\n&gt; randomR (0,1) (mkStdGen 949488) :: (Int, StdGen)\n(0,1485632275 40692)\n&gt; random (mkStdGen 1) :: (Bool, StdGen)\n(True,80028 40692)\n&gt; randomR (0,1) (mkStdGen 1) :: (Int, StdGen)\n(1,80028 40692)\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8351855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6ac0e0979c346e6a9a18fbf4203e24c?s=128&d=identicon&r=PG&f=1", "display_name": "user38352", "link": "https://stackoverflow.com/users/8351855/user38352"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 45867979, "answer_count": 1, "score": 1, "last_activity_date": 1503610305, "creation_date": 1503596510, "last_edit_date": 1503610305, "question_id": 45867892, "link": "https://stackoverflow.com/questions/45867892/how-does-haskell-determine-what-kind-of-boolean-a-randomly-generated-number-is", "title": "How does Haskell determine what kind of boolean a randomly generated number is?", "body": "<p>Consider the following two groups of code:</p>\n\n<pre><code>random (mkStdGen 1) :: (Int, StdGen) \n-- returns (7918028818325808681,545291967 2103410263)\nrandom (mkStdGen 1) :: (Bool, StdGen) \n-- returns (True,80028 40692)\n\n\nrandom (mkStdGen 949488) :: (Int, StdGen) \n-- returns (9159618695640234475,587416689 2103410263)\nrandom (mkStdGen 949488) :: (Bool, StdGen)\n-- returns (False,1485632275 40692)\n</code></pre>\n\n<p>Why does <code>7918028818325808681</code> translate to <code>True</code> but <code>9159618695640234475</code> translates to <code>False</code>?</p>\n"}, {"tags": ["haskell", "gtk", "togglebutton", "glade"], "comments": [{"owner": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "edited": false, "score": 2, "creation_date": 1503598173, "post_id": 45863032, "comment_id": 78695348, "body": "Sorry, I don&#39;t have Haskell code to show you. At any rate you have to connect to the renderer <code>toggled</code> signal and change the store yourself. The renderer will show the current state automatically."}, {"owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "reply_to_user": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "edited": false, "score": 0, "creation_date": 1504170746, "post_id": 45863032, "comment_id": 78913856, "body": "Seems it worked when I bind the store change to a <code>clicked</code> button, but the <code>toggled</code> signal is somewhat buggy (having some messing types here)"}], "answers": [{"tags": [], "owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "is_accepted": true, "score": 0, "last_activity_date": 1504179955, "creation_date": 1504179955, "answer_id": 45980716, "question_id": 45863032, "link": "https://stackoverflow.com/questions/45863032/use-toggle-button-with-haskell-and-glade/45980716#45980716", "title": "Use toggle button with Haskell and Glade", "body": "<p>Solved thanks to the comment of theGtknerd and some serious digging in the documentation (altough I still do not understand why the lambda expression: <a href=\"http://hackage.haskell.org/package/glib-0.13.4.1/docs/System-Glib-Signals.html#t:Signal\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/glib-0.13.4.1/docs/System-Glib-Signals.html#t:Signal</a>):</p>\n\n<pre><code>toggleStuff t m = do\n    tvwS &lt;- treeViewGetSelection t\n    tvwP &lt;- treeSelectionGetSelectedRows tvwS\n    if tvwP == []\n        then return()\n    else\n        do let s = Prelude.head (Prelude.head tvwP)\n           v &lt;- listStoreGetValue m s\n           listStoreSetValue m s (fst v, not (snd v))\n[...]\na &lt;- treeViewGetSelection treeview\nb &lt;- treeSelectionGetSelectedRows a\n\non celltg cellToggled $ \\(b::[Char]) -&gt; do toggleStuff treeview store\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 45980716, "answer_count": 1, "score": 4, "last_activity_date": 1504179955, "creation_date": 1503581542, "question_id": 45863032, "link": "https://stackoverflow.com/questions/45863032/use-toggle-button-with-haskell-and-glade", "title": "Use toggle button with Haskell and Glade", "body": "<p>I have some trouble understanding how to use toggle buttons for GTK+ binding with Haskell. </p>\n\n<p>What I want to do is to display a <code>treeView</code> with two column: one containing strings and the other containing toggle buttons. The user must tick the toggle buttons to select the inputs he wants to use in another the part of the program. </p>\n\n<p>My model is a list of tuples <code>(String,Bool)</code>, the boolean supposed to reflect the state of the toggle button. Initialy, all are False.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>treeview &lt;- builderGetObject builder castToTreeView \"diffDisplayTreeView\"\ntreeviewselect &lt;- treeViewGetSelection difftreeview\ndcolumn &lt;- builderGetObject builder castToTreeViewColumn \"dcolumn\"\nselcolumn &lt;- builderGetObject builder castToTreeViewColumn \"selcolumn\"\ndcell &lt;- builderGetObject builder castToCellRendererText \"dcell\"\nselcell &lt;- builderGetObject builder castToCellRendererToggle \"selcell\"\n[...]\nstore &lt;- listStoreNew modelFromSomewhereElse\ncellLayoutSetAttributes dcolumn dcell store $ \\x -&gt; [cellText := fst(x)]\ncellLayoutSetAttributes selcolumn selcell store $ \\x -&gt; [cellToggleActivate := snd(x)]\ntreeViewSetModel treeview store\n</code></pre>\n\n<p>It works well at initating the treeView, but when I click on a toggle button, it remains on the state it was initalized. I'd like to catch the <code>cellToggled</code> for a specific cell and change the model properly, but I don't quite understand how to navigate within a treeView selection.</p>\n\n<p>Any help would be greatly appreciated :) </p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1503593196, "last_edit_date": 1503593196, "creation_date": 1503587174, "answer_id": 45865055, "question_id": 45860759, "link": "https://stackoverflow.com/questions/45860759/confusion-about-composing-indexed-lens/45865055#45865055", "title": "Confusion about composing indexed lens", "body": "<p><code>(&lt;.)</code> expects an indexed optic on its left, but <code>cloneLens</code> gives it an unindexed lens.</p>\n\n<p>One partial fix is to use <code>Lens.cloneIndexedLens</code> instead of <code>cloneLens</code>.</p>\n\n<p>However, <code>A_</code>/<code>An_</code> variants of optics (<code>AnIndexedLens</code>) are meant to be argument types, not result types, which can use regular optics (<code>IndexedLens</code>). With that, <code>cloneIndexedLens</code> becomes unnecessary.</p>\n\n<pre><code>constIndex :: i -&gt; Lens.IndexedLens i a b a b\nconstIndex i f = Lens.indexed f i\n\nconstIndexedList :: i -&gt; Lens.IndexedTraversal i [a] [b] a b\nconstIndexedList i = constIndex i &lt;. traverse\n</code></pre>\n\n<hr>\n\n<p>Monomorphic inputs and polymorphic outputs improve composability.</p>\n\n<p><code>IndexedLens</code> is a polymorphic type (notice the <code>forall</code> keyword in the type definition).</p>\n\n<pre><code>type IndexedLens i s t a b = forall f p. (Indexable i p, Functor f) =&gt; p a (f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p><code>AnIndexedLens</code> is monomorphic.</p>\n\n<pre><code>type AnIndexedLens i s t a b = Optical (Indexed i) (-&gt;) (Pretext (Indexed i) a b) s t a b\n</code></pre>\n\n<p>Every <code>IndexedLens</code> is <code>AnIndexedLens</code>, but the conversion the other way must go through an explicit <code>cloneIndexedLens</code>.</p>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 45865055, "answer_count": 1, "score": 1, "last_activity_date": 1503593196, "creation_date": 1503575084, "question_id": 45860759, "link": "https://stackoverflow.com/questions/45860759/confusion-about-composing-indexed-lens", "title": "Confusion about composing indexed lens", "body": "<p>I can create an <code>IndexedTraversal</code> for lists with a constant index like so:</p>\n\n<pre><code>constIndexedList :: i -&gt; Lens.AnIndexedTraversal i [a] [b] a b\nconstIndexedList _ _ [] = pure []\nconstIndexedList index f (x:xs) = (:) &lt;$&gt; Lens.indexed f index x &lt;*&gt; constListIndex index f xs\n</code></pre>\n\n<p>I'd rather create it by composing two simpler lens:</p>\n\n<pre><code>constIndex :: i -&gt; Lens.AnIndexedLens i a b a b\nconstIndex index f = Lens.indexed f index\n\nconstIndexedList :: i -&gt; Lens.AnIndexedTraversal i [a] [b] a b\nconstIndexedList index = Lens.cloneLens (constIndex index) &lt;. traverse\n</code></pre>\n\n<p>However this fails to type-check, and the type errors from <code>lens</code> are not ones that I easily understand:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018Lens.Indexed\n                         i (t0 a) (Lens.Bazaar (Lens.Indexed i) a b (t0 b))\u2019\n                 with \u2018[a] -&gt; Lens.Bazaar (Lens.Indexed i) a b [b]\u2019\n  Expected type: Lens.Indexed\n                   i (t0 a) (Lens.Bazaar (Lens.Indexed i) a b (t0 b))\n                 -&gt; [a] -&gt; Lens.Bazaar (Lens.Indexed i) a b [b]\n    Actual type: ([a] -&gt; Lens.Bazaar (Lens.Indexed i) a b [b])\n                 -&gt; [a] -&gt; Lens.Bazaar (Lens.Indexed i) a b [b]\n\u2022 In the first argument of \u2018(&lt;.)\u2019, namely\n    \u2018Lens.cloneLens (constIndex index)\u2019\n  In the expression: Lens.cloneLens (constIndex index) &lt;. traverse\n</code></pre>\n\n<p>Why can't I compose indexed lens like so?</p>\n\n<p>I ended up finding a different modular way to do it (<code>Lens.reindexed (const index) Lens.traversed</code>, but I still wonder why the method mentioned above doesn't work..</p>\n"}, {"tags": ["haskell", "let"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1503576301, "post_id": 45860716, "comment_id": 78680189, "body": "Name / identifier / variable shadowing is generally allowed in many programming languages. If forbidden, <code>f x = x+1</code> would stop working only because someone added a global <code>x=42</code> somewhere, or only because a newer version of some imported library now exports <code>x</code>. Even in the lambda calculus <code>\\x. \\x. ...</code> is allowed (and this simplifies the semantics a bit). ML even allows <code>let x = x+1 in ...</code>, which is <i>not</i> recursive in ML, which became idiomatic. Now, I&#39;m not arguing that shadowing is good, but IMO a compiler warning for that is better than an error."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1503586053, "post_id": 45860716, "comment_id": 78687694, "body": "In a highly recursive language like Haskell, it might be difficult to separate accidental reuse of a variable name from intentional recursion..."}, {"owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1503586740, "post_id": 45860716, "comment_id": 78688219, "body": "@MathematicalOrchid indeed. I just fixed a bug in my code with the same issue which caused an infinite loop in the program."}], "answers": [{"comments": [{"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 0, "creation_date": 1503579283, "post_id": 45860867, "comment_id": 78682542, "body": "Good advice! But you didn&#39;t answer the question &quot;why is such a thing allowed in haskell?&quot;"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 1, "creation_date": 1503580952, "post_id": 45860867, "comment_id": 78683772, "body": "@LudvigH that&#39;s asking for opinion, really. I think Chad&#39;s answer answers it between the lines. If it&#39;s a warning, then Haskell/GHC creators have realized that it&#39;s potentially dangerous, but didn&#39;t feel that&#39;s necessary to forbid it entirely."}, {"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 3, "creation_date": 1503581287, "post_id": 45860867, "comment_id": 78684041, "body": "Fair enough. But I&#39;m too often astounded by people at SO who manages to find design documents and specification which explain the line of reasoning leading up to decisions such as shadowing, so I thought such an answer would be valid and not a question of opinion.  In either case - I think Chad provides the answer to the practical question of how to deal with it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 3, "creation_date": 1503592181, "post_id": 45860867, "comment_id": 78691958, "body": "@LudvigH, Haskell almost certainly allows it simply because it&#39;s allowed in lambda calculus and the chain of LC descendants that led to Haskell. LC itself was intended as a formal logical system rather than a programming language; Alonzo Church probably didn&#39;t even consider the potential for human error."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 1, "creation_date": 1503593191, "post_id": 45860867, "comment_id": 78692568, "body": "@LudvigH Maybe it&#39;s the other way, Nobody designed anything explicitely against name shadowing, because that would require an extra step (or effort to do). For example it&#39;s probably hard (maybe impossible) to exclude name shadowing using BNF, therefore the normal definition of a let expression allows it (until someone complains and adds it as a warning)."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 10, "last_activity_date": 1503575937, "last_edit_date": 1503575937, "creation_date": 1503575411, "answer_id": 45860867, "question_id": 45860716, "link": "https://stackoverflow.com/questions/45860716/name-capture-in-haskell-let-expression/45860867#45860867", "title": "name capture in Haskell `let` expression", "body": "<p>You can enable warnings for this type of name shadowing with the compiler flag </p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/7.0.3/docs/html/users_guide/options-sanity.html#id538931\" rel=\"noreferrer\"><code>-fwarn-name-shadowing</code></a></p>\n\n<blockquote>\n  <p>This option causes a warning to be emitted whenever an inner-scope value has the same name as an outer-scope value, i.e. the inner value shadows the outer one. This can catch typographical errors that turn into hard-to-find bugs, e.g., in the inadvertent capture of what would be a recursive call in f = ... let f = id in ... f ....</p>\n</blockquote>\n\n<p>However, it is more common to compile with <code>-Wall</code>, which includes a lot of other warnings that will help you avoid bad practices.</p>\n"}], "owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 45860867, "answer_count": 1, "score": 2, "last_activity_date": 1503580206, "creation_date": 1503574956, "last_edit_date": 1503580206, "question_id": 45860716, "link": "https://stackoverflow.com/questions/45860716/name-capture-in-haskell-let-expression", "title": "name capture in Haskell `let` expression", "body": "<p>I was writing a function something similar to this:</p>\n\n<pre><code>f x = let\n  x = ...\n  in\n    e\n</code></pre>\n\n<p>Due to scoping rules in Haskell any use of x in e will resolve to the definition of x in the <code>let</code> construct.</p>\n\n<p>Why is such a thing allowed in Haskell?\nShouldn't the compiler reject such a program telling we cannot bind a value that has the same name as argument of the function.</p>\n\n<p>(This example may be simplistic, but in real world context where variables have semantic meaning associated with them it is easy to make such mistake) </p>\n"}, {"tags": ["sql", "haskell", "persistent", "haskell-persistent"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1503571698, "post_id": 45859554, "comment_id": 78676950, "body": "use <code>primary sourceId targetId</code> in the <code>EntityLink</code>."}, {"owner": {"reputation": 833, "user_id": 1007926, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dc0133e5980f0289b82d223562ec0a49?s=128&d=identicon&r=PG", "display_name": "Peter Becich", "link": "https://stackoverflow.com/users/1007926/peter-becich"}, "edited": false, "score": 0, "creation_date": 1533106406, "post_id": 45859554, "comment_id": 90218481, "body": "Some more discussion here: <a href=\"https://www.reddit.com/r/haskell/comments/4nneia/how_to_use_persistent_with_tables_without_id/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/4nneia/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1503598417, "last_edit_date": 1503598417, "creation_date": 1503571831, "answer_id": 45859655, "question_id": 45859554, "link": "https://stackoverflow.com/questions/45859554/using-an-sql-table-without-an-id-column-in-haskell-persistent/45859655#45859655", "title": "Using an SQL table without an ID column in Haskell/Persistent", "body": "<p>You can use <code>Primary</code> and specify the columns that belong to the primary key. Like:</p>\n\n<pre><code>EntityLink sql=entity_links\n  sourceId EntityId\n  targetId EntityId\n  <b>Primary sourceId targetId</b>\n  deriving Show</code></pre>\n"}], "owner": {"reputation": 462, "user_id": 2068056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/845g4.jpg?s=128&g=1", "display_name": "eugenk", "link": "https://stackoverflow.com/users/2068056/eugenk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 45859655, "answer_count": 1, "score": 5, "last_activity_date": 1503598417, "creation_date": 1503571520, "last_edit_date": 1503571858, "question_id": 45859554, "link": "https://stackoverflow.com/questions/45859554/using-an-sql-table-without-an-id-column-in-haskell-persistent", "title": "Using an SQL table without an ID column in Haskell/Persistent", "body": "<p>I want to use an <em>existing</em> database with <a href=\"http://yesodweb.com/book/persistent\" rel=\"noreferrer\">Persistent</a> using this simplified schema:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nEntity sql=entities\n  deriving Show\n\nEntityLink sql=entity_links\n  sourceId EntityId\n  targetId EntityId\n  deriving Show\n|]\n</code></pre>\n\n<p>The <code>entities</code> table has an <code>id</code> column, which is just fine. However, the <code>entity_links</code> table does not have one and I do not want to add one. Instead, it has the primary key <code>(source_id, target_id)</code>. Whenever I want insert an <code>EntityLink</code>, I get this runtime error:</p>\n\n<pre><code>SqlError {sqlState = \"42703\", sqlExecStatus = FatalError, sqlErrorMsg = \"column \\\"id\\\" does not exist\", sqlErrorDetail = \"\", sqlErrorHint = \"\"}\n</code></pre>\n\n<p>Here's how I insert an <code>EntityLink</code> in the code, given valid <code>sourceId</code> and <code>targetId</code>:</p>\n\n<pre><code>      insert $ EntityLink { entityLinkSourceId = sourceId\n                          , entityLinkTargetId = targetId\n                          }\n</code></pre>\n\n<p>How can I disable the <code>id</code> column in Persistent for the type <code>EntityLink</code>?</p>\n"}, {"tags": ["haskell", "macos-sierra", "cabal", "hakyll", "cabal-sandbox"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1503571620, "post_id": 45855587, "comment_id": 78676896, "body": "Try installing via stack and see if that works."}, {"owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "edited": false, "score": 1, "creation_date": 1503575441, "post_id": 45855587, "comment_id": 78679592, "body": "You can also use Nix to install it. The hakyll build for darwin succeeds in the latest version of nixpkgs. Sadly, I can&#39;t test it because I don&#39;t have an OS X machine at my disposal. You can get Nix at <a href=\"https://nixos.org/nix/\" rel=\"nofollow noreferrer\">nixos.org/nix</a> and try: <code>nix-build -iA haskellPackages.hakyll -I nixpkgs=https:&#47;&#47;github.com&#47;NixOS&#47;nixpkgs&#47;archive&#47;6bbc3a0b245&zwnj;&#8203;ccf392a8ddbce41b372c&zwnj;&#8203;17409f0e9.tar.gz</code>"}, {"owner": {"reputation": 2784, "user_id": 1487843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1BFY8.jpg?s=128&g=1", "display_name": "Marc Lambrichs", "link": "https://stackoverflow.com/users/1487843/marc-lambrichs"}, "edited": false, "score": 0, "creation_date": 1503593031, "post_id": 45855587, "comment_id": 78692476, "body": "can you show your website.hs?"}, {"owner": {"reputation": 3352, "user_id": 98600, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5738c02070833b70609a7fe8f0b75eef?s=128&d=identicon&r=PG", "display_name": "John J. Camilleri", "link": "https://stackoverflow.com/users/98600/john-j-camilleri"}, "reply_to_user": {"reputation": 2784, "user_id": 1487843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1BFY8.jpg?s=128&g=1", "display_name": "Marc Lambrichs", "link": "https://stackoverflow.com/users/1487843/marc-lambrichs"}, "edited": false, "score": 0, "creation_date": 1503644535, "post_id": 45855587, "comment_id": 78710262, "body": "@mlambrichs I&#39;ve updated the question to specify that this happens with a completely fresh site generated using <code>hakyll-init</code>."}, {"owner": {"reputation": 3352, "user_id": 98600, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5738c02070833b70609a7fe8f0b75eef?s=128&d=identicon&r=PG", "display_name": "John J. Camilleri", "link": "https://stackoverflow.com/users/98600/john-j-camilleri"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1503647479, "post_id": 45855587, "comment_id": 78711755, "body": "@Sibi just tried with stack and indeed it works great. I guess I will post this as an answer"}], "answers": [{"tags": [], "owner": {"reputation": 3352, "user_id": 98600, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5738c02070833b70609a7fe8f0b75eef?s=128&d=identicon&r=PG", "display_name": "John J. Camilleri", "link": "https://stackoverflow.com/users/98600/john-j-camilleri"}, "is_accepted": false, "score": 2, "last_activity_date": 1503647850, "creation_date": 1503647850, "answer_id": 45876820, "question_id": 45855587, "link": "https://stackoverflow.com/questions/45855587/cannot-run-hakyll-on-macos-sierra-malformed-mach-o-load-commands-size/45876820#45876820", "title": "Cannot run Hakyll on macOS Sierra: malformed mach-o: load commands size", "body": "\n\n<p>Although not exactly a solution to my problem, I managed to get around this by installing Hakyll through stack instead. For the record, these were my steps:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>brew install haskell-stack\nstack setup\nstack install hakyll\n</code></pre>\n\n<p>Then to build the website:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack exec -- runghc site.hs build\n</code></pre>\n"}], "owner": {"reputation": 3352, "user_id": 98600, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5738c02070833b70609a7fe8f0b75eef?s=128&d=identicon&r=PG", "display_name": "John J. Camilleri", "link": "https://stackoverflow.com/users/98600/john-j-camilleri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1503647850, "creation_date": 1503560163, "last_edit_date": 1503644476, "question_id": 45855587, "link": "https://stackoverflow.com/questions/45855587/cannot-run-hakyll-on-macos-sierra-malformed-mach-o-load-commands-size", "title": "Cannot run Hakyll on macOS Sierra: malformed mach-o: load commands size", "body": "<p>I can compile Hakyll, but when I try to run it I get a linking error.<br>\nFirst I install Hakyll in a sandbox:</p>\n\n<pre><code>cabal sandbox init\ncabal install Hakyll\n</code></pre>\n\n<p>This completes successfully.\nThen I create a plain site using <code>hakyll-init</code> and move the files up a directory:</p>\n\n<pre><code>.cabal-sandbox/bin/hakyll-init mysite\nmv mysite/* .\nrm -rf mysite\n</code></pre>\n\n<p>Then I try to run it with <code>cabal exec -- runghc site.hs build</code> and I get:</p>\n\n<pre><code>site.hs: &lt;command line&gt;: can't load .so/.DLL for: /Users/john/repositories/CP/principles-of-concurrent-programming/Website/.cabal-sandbox/lib/x86_64-osx-ghc-8.2.1/libHSpandoc-citeproc-0.10.5.1-97wWmtk04v65Etcjop52Rs-ghc8.2.1.dylib (dlopen(/Users/john/repositories/CP/principles-of-concurrent-programming/Website/.cabal-sandbox/lib/x86_64-osx-ghc-8.2.1/libHSpandoc-citeproc-0.10.5.1-97wWmtk04v65Etcjop52Rs-ghc8.2.1.dylib, 5): no suitable image found.  Did find:\n    /Users/john/repositories/CP/principles-of-concurrent-programming/Website/.cabal-sandbox/lib/x86_64-osx-ghc-8.2.1/libHSpandoc-citeproc-0.10.5.1-97wWmtk04v65Etcjop52Rs-ghc8.2.1.dylib: malformed mach-o: load commands size (32992) &gt; 32768\n    /Users/john/repositories/CP/principles-of-concurrent-programming/Website/.cabal-sandbox/lib/x86_64-osx-ghc-8.2.1/libHSpandoc-citeproc-0.10.5.1-97wWmtk04v65Etcjop52Rs-ghc8.2.1.dylib: malformed mach-o: load commands size (32992) &gt; 32768)\n</code></pre>\n\n<ul>\n<li>The contents of <code>site.hs</code> are completely standard. I've uploaded the file to <a href=\"https://gist.github.com/johnjcamilleri/1c363c6f6cdea98ab278d680c46bf272\" rel=\"nofollow noreferrer\">gist</a>.</li>\n<li><strong>GHC 8.2.1</strong>, installed via Homebrew. I initially had this problem with 7.10.3b, and upgraded GHC to see if that would help. It didn't.  </li>\n<li><strong>macOS Sierra 10.12.6</strong></li>\n</ul>\n\n<p>Any help would be appreciated!</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503552666, "post_id": 45852941, "comment_id": 78665030, "body": "You should include the code which causes the error and the error itself."}, {"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 0, "creation_date": 1503579579, "post_id": 45852941, "comment_id": 78682761, "body": "You mention <code>list1</code> in the text, but not in the code. Please correct the typo."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 3, "last_activity_date": 1503554427, "creation_date": 1503554427, "answer_id": 45854002, "question_id": 45852941, "link": "https://stackoverflow.com/questions/45852941/haskell-show-should-i-exclude-the-list-based-on-other-list/45854002#45854002", "title": "Haskell show should I exclude the list based on other List?", "body": "<p>You're right about using <code>not</code>, but you might use it incorrectly. <code>not</code> should be used in composition to the existing function that is passed to <code>filter</code>:</p>\n\n<pre><code>filter (not . (any (`elem` b))) a\n</code></pre>\n\n<p>Or by using <code>de Morgan Laws</code>:</p>\n\n<pre><code>filter (all (`notElem` b)) a\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 45854002, "answer_count": 1, "score": -2, "last_activity_date": 1503565126, "creation_date": 1503548737, "last_edit_date": 1503565126, "question_id": 45852941, "link": "https://stackoverflow.com/questions/45852941/haskell-show-should-i-exclude-the-list-based-on-other-list", "title": "Haskell show should I exclude the list based on other List?", "body": "<p>I have two lists; one is the list I want to exclude from the other list,\nIt is like this one </p>\n\n<pre><code>a::[String]\na = [[\"A1\",\"B2\",\"C5\"],[\"A3\",\"B1\",\"C2\"]]\n</code></pre>\n\n<p>And I have another list that I want to exclude every element that contains either one of three elements on <code>a</code></p>\n\n<pre><code>b :: [[String]] \nb = [[\"A1\",\"B1\",\"H5\"],[\"A3\",\"C2\",\"B1\"],[\"A1\",\"B2\",\"H5\"],[\"H2\",\"H3\",\"B2\"],[\"H5\",\"B1\",\"H4\"]]\n</code></pre>\n\n<p>The expected result would be :</p>\n\n<pre><code>[[\"H5\",\"B1\",\"H4\"]]\n</code></pre>\n\n<p>Here is my approach:</p>\n\n<pre><code>excludeList ::[[String]]-&gt; [[String]] -&gt; [[String]]\nexcludeList a b = filter (any (`elem` b)) a\n</code></pre>\n\n<p>I know the code above will keep the elements that contain any of the elements in <code>list1</code>, but I don't know how to do it the opposite way, using <code>not</code>? But wherever I put not, my IDE always gives me an error. How can I fix it? And it seems <code>elem</code> can't handle the <code>[[String]]</code> type, what should I do?\nThanks a lot!</p>\n"}]