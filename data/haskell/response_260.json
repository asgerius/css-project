[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 3716, "user_id": 3334862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QlVz8.jpg?s=128&g=1", "display_name": "DevNebulae", "link": "https://stackoverflow.com/users/3334862/devnebulae"}, "edited": false, "score": 1, "creation_date": 1577829507, "post_id": 59548601, "comment_id": 105266451, "body": "What&#39;s the definition of the <code>step</code> function?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1577829648, "post_id": 59548601, "comment_id": 105266479, "body": "It makes perfect sense that you always get exactly the same error. But with the current state of the question, we can not help much. Please post the <i>relevant parts</i> of your code file (that means that <code>step</code> function, and all other functions that depend on <code>step</code> directly or indirectly)."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1577829794, "post_id": 59548601, "comment_id": 105266495, "body": "Why? <code>step</code> has nothing to do with this error. It could be <code>undefined</code> and you&#39;d still have the same type error."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577838388, "post_id": 59548601, "comment_id": 105267683, "body": "@Joseph It&#39;s always good to provide code that reproduces the exact error asked about, to make it easier to diagnose. Without the definition of <code>step</code>, it&#39;s clear that you get a <i>different</i> error: step is not in scope. Potential answerers may not be inclined to spend time realizing that <code>step = undefined</code> reproduces the issue."}, {"owner": {"reputation": 952, "user_id": 12521158, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8e745b4953a3ecbe3a1f7147089a7a7?s=128&d=identicon&r=PG&f=1", "display_name": "kopecs", "link": "https://stackoverflow.com/users/12521158/kopecs"}, "edited": false, "score": 0, "creation_date": 1577839522, "post_id": 59548601, "comment_id": 105267805, "body": "@mia that&#39;s just the type of <code>step</code>, he&#39;s asking for the definition (i.e., what instructions it actually performs)"}, {"owner": {"reputation": 33, "user_id": 12634055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68fcfb96cafee37ce39dfafc04b28cce?s=128&d=identicon&r=PG&f=1", "display_name": "mia", "link": "https://stackoverflow.com/users/12634055/mia"}, "edited": false, "score": 0, "creation_date": 1577840767, "post_id": 59548601, "comment_id": 105267954, "body": "Sorry I am kind of new to this prolog thing and keep getting confused I hope this is what this what you mean by the definition.                                                                step (x:y:ys) &quot;*&quot; = (x * y):ys step (x:y:ys) &quot;+&quot; = (x + y):ys step (x:y:ys) &quot;-&quot; = (y - x):ys step xs numberString = read numberString:xs"}, {"owner": {"reputation": 952, "user_id": 12521158, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8e745b4953a3ecbe3a1f7147089a7a7?s=128&d=identicon&r=PG&f=1", "display_name": "kopecs", "link": "https://stackoverflow.com/users/12521158/kopecs"}, "edited": false, "score": 1, "creation_date": 1577841337, "post_id": 59548601, "comment_id": 105268007, "body": "@mia I&#39;m pretty sure that&#39;s haskell and not prolog, but no worries!"}, {"owner": {"reputation": 33, "user_id": 12634055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68fcfb96cafee37ce39dfafc04b28cce?s=128&d=identicon&r=PG&f=1", "display_name": "mia", "link": "https://stackoverflow.com/users/12634055/mia"}, "edited": false, "score": 0, "creation_date": 1577841416, "post_id": 59548601, "comment_id": 105268022, "body": "yes I meant Haskell I am also in the process of learning prolog that&#39;s why I mixed it up haha"}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1577848262, "last_edit_date": 1577848262, "creation_date": 1577829717, "answer_id": 59548729, "question_id": 59548601, "link": "https://stackoverflow.com/questions/59548601/i-always-get-this-error-in-haskell-when-i-try-to-do-load-rpn-hs/59548729#59548729", "title": "I always get this error in Haskell when I try to do :load Rpn.hs", "body": "<p>When you have a function like <code>f = foo . bar . baz</code>, it can be written in a pointful way as <code>f x = foo (bar (baz x))</code>. In your case, you'd have <code>rpn x = head (foldl step [] (words x))</code>. The problem is now apparent: you're calling <code>words x</code>, and <code>words</code> has type <code>String -&gt; [String]</code>, so <code>x</code> should have type <code>String</code>. However, <code>rpn :: [String] -&gt; Int</code>, and <code>x</code> is the first argument to <code>rpn</code>, so <code>x</code> should have type <code>[String]</code>. Since <code>x</code> can only have one type, it can't be both <code>String</code> and <code>[String]</code>, so the compiler is making you fix this discrepancy. There are two different ways to fix this, depending on what you want <code>rpn</code> to do:</p>\n\n<ol>\n<li>Change the type of <code>rpn</code> to <code>String -&gt; Int</code>, and leave its definition alone</li>\n<li>Remove <code>. words</code> from the definition of <code>rpn</code>, and leave its type alone</li>\n</ol>\n"}], "owner": {"reputation": 33, "user_id": 12634055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68fcfb96cafee37ce39dfafc04b28cce?s=128&d=identicon&r=PG&f=1", "display_name": "mia", "link": "https://stackoverflow.com/users/12634055/mia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 59548729, "answer_count": 1, "score": -1, "last_activity_date": 1577848262, "creation_date": 1577828136, "last_edit_date": 1577841128, "question_id": 59548601, "link": "https://stackoverflow.com/questions/59548601/i-always-get-this-error-in-haskell-when-i-try-to-do-load-rpn-hs", "title": "I always get this error in Haskell when I try to do :load Rpn.hs", "body": "<p>This is the code I have for trying to implement a reverse Polish notation evaluator:</p>\n\n<pre><code>step :: [Int] -&gt; String -&gt; [Int] \nstep (x:y:ys) \"*\" = (x * y):ys \nstep (x:y:ys) \"+\" = (x + y):ys \nstep (x:y:ys) \"-\" = (y - x):ys \nstep xs numberString = read numberString:xs\n\nrpn :: [String] -&gt; Int\nrpn = head . foldl step[] . words\n</code></pre>\n\n<p>and this is error I keep getting when I do :load Rpn.hs :</p>\n\n<pre><code>Rpn.hs:9:7: error:\n    \u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Char\u2019\n      Expected type: [String] -&gt; Int\n        Actual type: String -&gt; Int\n    \u2022 In the expression: head . foldl step [] . words\n      In an equation for \u2018rpn\u2019: rpn = head . foldl step [] . words\n  |\n9 | rpn = head . foldl step[] . words\n  |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>I think the problem is with the foldl function but I am not quite sure about how to resolve it. Please, kindly guide me on what to do.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1577788362, "post_id": 59542775, "comment_id": 105254741, "body": "Problem is that this prevents \u201coutside in\u201d type inference. In practice, this tends to make everything <i>very</i> unwieldy, requiring lots of local type signatures. At any rate you should make it <code>instance (a~b) =&gt; RuleOperator (Rule a) (Symbol b)</code> etc., then at least the type can be inferred from one argument to the other, but still not from the result to either of the arguments. (This is assuming that the <code>a</code> parameter is actually made use of; if it&#39;s almost always <code>()</code> or something then it&#39;ll be fine, but arguably useless.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1577790126, "post_id": 59542775, "comment_id": 105255422, "body": "@leftaroundabout True. Please see my last edit, which seems to work. (It could be overcomplicated, though.)"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1577820865, "post_id": 59542775, "comment_id": 105264772, "body": "Looks like it also works to use functional dependencies instead of a type family: <code>class Foo t1 t2 a | t1 -&gt; a, t2 -&gt; a</code> with <code>instance Foo (Symbol a) (Symbol a) a</code>, etc."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1577821116, "post_id": 59542775, "comment_id": 105264827, "body": "@K.A.Buhr Indeed it does. That is a much simpler way of making inference work."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1577830272, "post_id": 59542775, "comment_id": 105266569, "body": "@K.A.Buhr Doesn&#39;t that have the problem leftaroundabout described above? Namely, outside-in does not work? Did you try the tests for inference I wrote above?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1577831663, "post_id": 59542775, "comment_id": 105266801, "body": "@chi, yes, I tried your tests, and both outside-in and inside-out inference seemed to work fine."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1577831946, "post_id": 59542775, "comment_id": 105266865, "body": "I&#39;ve added my alternative as an edit -- if you spot a problem with it, feel free to revert."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1577831897, "last_edit_date": 1577831897, "creation_date": 1577787724, "answer_id": 59542775, "question_id": 59542658, "link": "https://stackoverflow.com/questions/59542658/how-to-overload-operator-with-type-synonyms/59542775#59542775", "title": "How to overload operator with type synonyms?", "body": "<p>If you don't want to use a newtype wrapper, you could use a type family for this:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances, MultiParamTypeClasses #-}\n\ntype Rule a = [Symbol a]\n\ndata Symbol a = Empty | End | LangSym a\n\nclass RuleOperator t1 t2 where\n   type Elem t1 t2\n   (&lt;.&gt;) :: t1 -&gt; t2 -&gt; Rule (Elem t1 t2)\n\ninstance RuleOperator (Symbol a) (Symbol a) where\n   type Elem (Symbol a) (Symbol a) = a\n   s1 &lt;.&gt; s2 = [s1, s2]\n\ninstance RuleOperator (Symbol a) (Rule a) where\n   type Elem (Symbol a) (Rule a) = a\n   (&lt;.&gt;) = (:)\n\ninstance RuleOperator (Rule a) (Symbol a) where\n   type Elem (Rule a) (Symbol a) = a\n   r &lt;.&gt; s = r ++ [s]\n\ninstance RuleOperator (Rule a) (Rule a) where\n   type Elem (Rule a) (Rule a) = a\n   (&lt;.&gt;) = (++)\n</code></pre>\n\n<p>Make the class take the fully applied type, so that type synonyms are not an issue, and then use the <code>Elem</code> type family to recover the <code>a</code> argument.</p>\n\n<hr>\n\n<p>Here are two alternative which allow both inside-out and outside-in type inference.  One using type families and constraints:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances, MultiParamTypeClasses #-}\n\ntype Rule a = [Symbol a]\n\ndata Symbol a = Empty | End | LangSym a\n\nclass (a ~ Elem t1 t2) =&gt; RuleOperator t1 t2 a where\n   type Elem t1 t2\n   (&lt;.&gt;) :: t1 -&gt; t2 -&gt; Rule (Elem t1 t2)\n\ninstance (a ~ b, a ~ c) =&gt; RuleOperator (Symbol a) (Symbol b) c where\n   type Elem (Symbol a) (Symbol b) = a\n   s1 &lt;.&gt; s2 = [s1, s2]\n\ninstance (a ~ b, a ~ c) =&gt; RuleOperator (Symbol a) (Rule b) c where\n   type Elem (Symbol a) (Rule b) = a\n   (&lt;.&gt;) = (:)\n\ninstance (a ~ b, a ~ c) =&gt; RuleOperator (Rule a) (Symbol b) c where\n   type Elem (Rule a) (Symbol b) = a\n   r &lt;.&gt; s = r ++ [s]\n\ninstance (a ~ b, a ~ c) =&gt; RuleOperator (Rule a) (Rule b) c where\n   type Elem (Rule a) (Rule b) = a\n   (&lt;.&gt;) = (++)\n</code></pre>\n\n<p>and another using functional dependencies (which act a bit like type functions/families with constraints):</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies, FlexibleInstances, MultiParamTypeClasses #-}\n\ntype Rule a = [Symbol a]\ndata Symbol a = Empty | End | LangSym a\n\nclass RuleOperator t1 t2 a | t1 -&gt; a, t2 -&gt; a where\n  (&lt;.&gt;) :: t1 -&gt; t2 -&gt; Rule a\ninstance RuleOperator (Symbol a) (Symbol a) a where\n   s1 &lt;.&gt; s2 = [s1, s2]\ninstance RuleOperator (Rule a) (Symbol a) a where\n   r &lt;.&gt; s = r ++ [s]\ninstance RuleOperator (Symbol a) (Rule a) a where\n  (&lt;.&gt;) = (:)\ninstance RuleOperator (Rule a) (Rule a) a where\n  (&lt;.&gt;) = (++)\n</code></pre>\n\n<p>A few tests for inference:</p>\n\n<pre><code>sym1, sym2 :: Symbol Int\nsym1 = undefined\nsym2 = undefined\n\nrule :: Rule Int\nrule = undefined\n\ntestInsideOut = sym1 &lt;.&gt; rule  -- type is inferred\n\npolySym :: Show a =&gt; Symbol a\npolySym = Empty\n\npolyRule :: Show a =&gt; Rule a\npolyRule = [Empty]\n\ntestOutSideIn :: Rule Int\ntestOutSideIn = polySym &lt;.&gt; polyRule  -- Show instances are resolved to Int\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 59542775, "answer_count": 1, "score": 3, "last_activity_date": 1577831897, "creation_date": 1577787178, "question_id": 59542658, "link": "https://stackoverflow.com/questions/59542658/how-to-overload-operator-with-type-synonyms", "title": "How to overload operator with type synonyms?", "body": "<p>I want to construct a rule using operator and the definition of rule as below:</p>\n\n<pre><code>type Rule a = [Symbol a]\n</code></pre>\n\n<p>and the definition of symbol as :</p>\n\n<pre><code>data Symbol a = Empty | End | LangSym a\n</code></pre>\n\n<p>and now to define an operator <code>&lt;.&gt;</code> which can apply to four situations as below:</p>\n\n<pre><code>(&lt;.&gt;)::Symbol a-&gt;Symbol a-&gt;Rule a\n(&lt;.&gt;)::Rule a-&gt;Symbol a-&gt;Rule a\n(&lt;.&gt;)::Symbol a-&gt;Rule a-&gt;Rule a\n(&lt;.&gt;)::Rule a-&gt;Rule a-&gt;Rule a\n</code></pre>\n\n<p>Obviously, we need to overload the operator <code>&lt;.&gt;</code> using typeclass as</p>\n\n<pre><code>class RuleOperator s1 s2 where\n    (&lt;.&gt;)::s1 a-&gt;s2 a-&gt;Rule a\n</code></pre>\n\n<p>It is no problem when instances the typeclass with <code>Symbol</code> as </p>\n\n<pre><code>instance RuleOperator Symbol Symbol where\n    x &lt;.&gt; y = [x, y]\n</code></pre>\n\n<p>but when the instance has <code>Rule a</code>, since the <code>Rule a</code> is type synonyms, we cannot do that as </p>\n\n<pre><code>instance RuleOperator Symbol Rule where\n    ....\n</code></pre>\n\n<p>and the restriction is that we cannot change the definition of <code>Rule a</code> to</p>\n\n<pre><code>newtype Rule a = R [Symbol a]\n</code></pre>\n\n<p>Since other modules has depended on the original definition of <code>Rule a</code>.</p>\n\n<p>Any suggestion for implements such operator with overload without change the definition of <code>Rule</code> ? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "edited": false, "score": 0, "creation_date": 1577788796, "post_id": 59542878, "comment_id": 105254920, "body": "But data UTCTime has show instance. check here <a href=\"http://hackage.haskell.org/package/time-1.9.3/docs/Data-Time-Clock.html#t:UTCTime\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/time-1.9.3/docs/&hellip;</a>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577788826, "post_id": 59542878, "comment_id": 105254932, "body": "I&#39;m curious as to why, in that case, GHCi is seemingly doing nothing in the OP&#39;s session. I would expect it to give an error regarding the lack of a <code>Show</code> instance, exactly as you quoted from your session."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577789547, "post_id": 59542878, "comment_id": 105255210, "body": "@RobinZigmond GHCi runs any <code>IO T</code> action. Then, if <code>T</code> is showable (but not <code>()</code>), it calls <code>print</code> on the result. I guess it can be more convenient this way if you want to run the action and observe its side effects, and do not care for the result (?). Otherwise, we would need to bind the result <code>_ &lt;- action</code> every time an IO action returns a non printable. I do not have a strong opinion on this one."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "edited": false, "score": 1, "creation_date": 1577789723, "post_id": 59542878, "comment_id": 105255278, "body": "@Saurabhkukade Ah, right. See the edit. The issue is that the instance is in another module (a so-called &quot;orphan&quot; instance)."}, {"owner": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "edited": false, "score": 0, "creation_date": 1577789808, "post_id": 59542878, "comment_id": 105255305, "body": "Oh! Now I understand it. Thanks!!"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577793815, "post_id": 59542878, "comment_id": 105256612, "body": "@chi thanks, I thought GHCi always implicitly called <code>print</code> on the result, and therefore gives an error if the type isn&#39;t an instance of <code>Show</code>. I guess I&#39;ve got that wrong, although I&#39;m sure I remember seeing <code>no instance of Show</code> errors in GHCi in similar situations :shrug:"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577797251, "post_id": 59542878, "comment_id": 105257795, "body": "@RobinZigmond That happens when the expression type is not inside IO. GHCi is rather magic: on non-IO value, it prints it (or errors out), on IO actions it runs them and prints the result when possible (except <code>()</code>). More magic happens in defaulting types. See e.g. <a href=\"https://stackoverflow.com/questions/30464891/in-ghci-why-cant-i-show-pure-1-in-repl/30464979#30464979\" title=\"in ghci why cant i show pure 1 in repl\">stackoverflow.com/questions/30464891/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1577789672, "last_edit_date": 1577789672, "creation_date": 1577788266, "answer_id": 59542878, "question_id": 59542614, "link": "https://stackoverflow.com/questions/59542614/why-getcurrenttime-function-from-data-time-clock-posix-does-not-work-as-expected/59542878#59542878", "title": "why getCurrentTime function from Data.Time.Clock.POSIX does not work as expected?", "body": "<p>The issue here is that <code>getCurrentTime</code> returns (inside <code>IO</code>) <code>UTCTime</code>, which has no <code>Show</code> instance, hence GHCi runs the IO action, but does not print the result.</p>\n\n<pre><code>&gt; t &lt;- getCurrentTime\n&gt; :t t\nt :: time-1.8.0.2:Data.Time.Clock.Internal.UTCTime.UTCTime\n&gt; t\n\n&lt;interactive&gt;:14:1: error:\n    * No instance for (Show\n                         time-1.8.0.2:Data.Time.Clock.Internal.UTCTime.UTCTime)\n        arising from a use of `print'\n    * In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I have no idea about why <code>UTCTime</code> has no <code>Show</code> instance.</p>\n\n<hr>\n\n<p>Update: the instance exists but it is an orphan! So, we need to import another module to bring it into scope.</p>\n\n<pre><code>&gt; import Data.Time.Clock.POSIX\n&gt; getCurrentTime\n&gt; import Data.Time.Clock  -- bring Show instance into scope!\n&gt; getCurrentTime\n2019-12-31 10:53:03.6132023 UTC\n</code></pre>\n"}], "owner": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 59542878, "answer_count": 1, "score": 2, "last_activity_date": 1577789672, "creation_date": 1577786963, "last_edit_date": 1577787373, "question_id": 59542614, "link": "https://stackoverflow.com/questions/59542614/why-getcurrenttime-function-from-data-time-clock-posix-does-not-work-as-expected", "title": "why getCurrentTime function from Data.Time.Clock.POSIX does not work as expected?", "body": "<p>I am trying to get UTC time into my program by using <strong>Data.Time.Clock.POSIX</strong> library but <strong>getCurrentTime</strong> function is not working as expected but <strong>getPOSIXTime</strong> is working fine?</p>\n\n<pre><code>Prelude&gt; import Data.Time.Clock.POSIX\nPrelude Data.Time.Clock.POSIX&gt; getPOSIXTime\n1577786745.6127777s\nPrelude Data.Time.Clock.POSIX&gt; getCurrentTime\nPrelude Data.Time.Clock.POSIX&gt;\n</code></pre>\n\n<p>Is this known behaviour or I am missing something here?</p>\n"}, {"tags": ["haskell", "compiler-construction", "type-constraints"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 12556322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aKjQW.png?s=128&g=1", "display_name": "\uc784\uae30\uc815", "link": "https://stackoverflow.com/users/12556322/%ec%9e%84%ea%b8%b0%ec%a0%95"}, "edited": false, "score": 0, "creation_date": 1577787613, "post_id": 59542040, "comment_id": 105254428, "body": "Thank you very much to your kind answer. Your links are very helpful. Ashamed, I thought that (||-) must be implemented firstly."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1577787773, "last_edit_date": 1592644375, "creation_date": 1577783962, "answer_id": 59542040, "question_id": 59540558, "link": "https://stackoverflow.com/questions/59540558/how-to-make-the-constraint-entailment-function-associated-type-synonyms/59542040#59542040", "title": "How to make the constraint-entailment function (||-)? (associated type synonyms)", "body": "<blockquote>\n<p>I read the paper Associated Type Synonyms right then tried to make the constraint-entailment function (||-).</p>\n<p>But I failed to do it, because it is too hard for me to have (||-) apply the inference rule &quot;EQ_subst&quot; and not fall into infinite loop.</p>\n</blockquote>\n<p>It sounds like trying to implement the typing rules directly (Figure 2), but those alone don't give an effective type checking procedure. The paper also presents a type inference algorithm (Section 5; Figures 4, 5), that's what should be implemented. To follow that section, you might want to first have a good grasp of Hindley-Milner type inference and unification.</p>\n<ul>\n<li>How GHC's type inference actually works (<a href=\"https://www.youtube.com/watch?v=x3evzO8O9e8\" rel=\"nofollow noreferrer\">talk</a>), Simon Peyton Jones</li>\n<li>The Essence of ML type inference (<a href=\"http://gallium.inria.fr/%7Efpottier/publis/emlti-final.pdf\" rel=\"nofollow noreferrer\">PDF</a>), Fran\u00e7ois Pottier and Didier R\u00e9my</li>\n</ul>\n"}], "owner": {"reputation": 33, "user_id": 12556322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aKjQW.png?s=128&g=1", "display_name": "\uc784\uae30\uc815", "link": "https://stackoverflow.com/users/12556322/%ec%9e%84%ea%b8%b0%ec%a0%95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "closed_date": 1577788377, "accepted_answer_id": 59542040, "answer_count": 1, "score": 2, "last_activity_date": 1577787773, "creation_date": 1577774526, "last_edit_date": 1577783508, "question_id": 59540558, "link": "https://stackoverflow.com/questions/59540558/how-to-make-the-constraint-entailment-function-associated-type-synonyms", "closed_reason": "Not suitable for this site", "title": "How to make the constraint-entailment function (||-)? (associated type synonyms)", "body": "<p>I am just a hobbier who doesn't major in Computational Science and Engineering.</p>\n\n<p>Recently, I made a tiny functional programming language: <a href=\"https://github.com/mecheng98/nabi\" rel=\"nofollow noreferrer\">https://github.com/mecheng98/nabi</a></p>\n\n<p>But nabi is untyped, so I want to add a type-checker to it.</p>\n\n<p>It is a concrete goal that I implement a type-checker which is based on haskell98 but supports the only extension \"associated type synonyms\".</p>\n\n<p>I read the paper <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.113.5909&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">Associated Type Synonyms</a> right then tried to make the constraint-entailment function (||-).</p>\n\n<p>But I failed to do it, because it is too hard for me to have (||-) apply the inference rule \"EQ_subst\" and not fall into infinite loop.</p>\n\n<p>Would you please to give me a hint to make (||-) and teach me how to achieve my goal?</p>\n\n<p>+) I hope to represent types in <a href=\"https://web.cecs.pdx.edu/~mpj/thih/thih.pdf\" rel=\"nofollow noreferrer\">THIH</a> style.</p>\n\n<p>Thank you very much to read my question. Happy New Year.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 2, "creation_date": 1577755655, "post_id": 59537969, "comment_id": 105247229, "body": "I currently don&#39;t have time to write a full answer but if you are fine with <code>error</code> you could make the pattern match with an irrefutable pattern match, say if you have <code>Just foo &lt;- bar</code> you could instead write <code>~(Just foo) &lt;- bar</code>, This relaxes the constraint to <code>Monad</code> but results in a runtime error should the match fail. you could also write your own monad transformer to replace <code>ErrorT</code>, or use an explicit <code>case ... of ...</code> and call <code>error</code> on failure, or <code>throwError</code> if you use <code>ExceptT</code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1577762594, "post_id": 59537969, "comment_id": 105248233, "body": "Newtype wrap ExceptT and define your desired MonadFail instance."}, {"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 0, "creation_date": 1577770799, "post_id": 59537969, "comment_id": 105249560, "body": "<a href=\"https://stackoverflow.com/questions/31221410/adapting-error-to-except\" title=\"adapting error to except\">stackoverflow.com/questions/31221410/adapting-error-to-excep&zwnj;&#8203;t</a>"}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1577799098, "post_id": 59537969, "comment_id": 105258413, "body": "@M.Aroosi drat. I thought I tried that already. Sounds like my perfect least-effort path. Thanks a lot!"}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1577799137, "post_id": 59537969, "comment_id": 105258429, "body": "@ThomasM.DuBuisson I&#39;m not quite sure why I&#39;d need an ExceptT if I&#39;m to provide a MonadFail instance on my own anyway."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 0, "creation_date": 1577799390, "post_id": 59537969, "comment_id": 105258530, "body": "@boran I&#39;m aware of that question (it was the google match before I asked mine.)  But unless I misread it, it specifically doesn&#39;t address what I&#39;m asking for: a default MonadFail instance. The section on do pattern matching failure more or less boils down to \u201cremove pattern match failures\u201d."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1577807271, "post_id": 59537969, "comment_id": 105261100, "body": "Because building on ExceptT allows you to derive the vast majority of instances you&#39;ll probably want."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 0, "creation_date": 1577807736, "post_id": 59537969, "comment_id": 105261242, "body": "Ah, good point. My current intermediate status was this: <a href=\"http://dpaste.com/0SHKHSE\" rel=\"nofollow noreferrer\">dpaste.com/0SHKHSE</a> and indeed, writing instances was most of the work."}], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 181, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1577748815, "creation_date": 1577748815, "question_id": 59537969, "link": "https://stackoverflow.com/questions/59537969/errort-is-deprecated-but-exceptt-doesnt-fit", "title": "ErrorT is deprecated, but ExceptT doesn&#39;t fit", "body": "<p>I had a monadic computation.  At some point it started requiring a MonadFail constraint because of a monadic pattern-match.</p>\n\n<p>My easy fix was to run it with this:</p>\n\n<pre><code>fmap (either error id) . runErrorT\n</code></pre>\n\n<p>Yet ouch:</p>\n\n<pre><code>Deprecated: \"Use Control.Monad.Trans.Except instead\"\n</code></pre>\n\n<p>So it appears that <code>ErrorT</code> is deprecated, and I'm to use <code>ExceptT</code> instead.  That sounds fine from the outside, but it doesn't appear like ExceptT is a drop-in replacement <em>at all!</em>  Just look at the instance declarations:</p>\n\n<pre><code>instance (Monad m, Error e) =&gt; MonadFail (ErrorT e m)\ninstance MonadFail m =&gt; MonadFail (ExceptT e m)\n</code></pre>\n\n<p><code>ErrorT</code> <em>provides</em> a MonadFail implementation.  <code>ExceptT</code> merely <em>lifts</em> it.</p>\n\n<p>I'm not quite sure where to go from this point.</p>\n\n<ul>\n<li><p>my code eventually won't have the refutable bind at all.  It's one of those cases where it's statically known to work, yet not proven to the type checker yet.  I'll get there, but it'll take a while.  (Like, I'm going to need dependent types, so I'm going to need to learn dependent types.  It'll take a while.)</p></li>\n<li><p>yet in the meantime, my code needs to bind, and really I'm fine with <code>error</code> being called if I mess up.</p></li>\n</ul>\n\n<p>It seems what I'm looking for is some generic <code>MonadFail</code> implementation that allows me to\u2026 well, do what I want with a pattern failing to match.  <code>ErrorT</code> did this, and <code>ExceptT</code> doesn't.</p>\n\n<p>What are my non-deprecated options?</p>\n"}, {"tags": ["multithreading", "haskell", "resources"], "answers": [{"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1577739250, "post_id": 59536340, "comment_id": 105243083, "body": "As @ChrisSmith points out, you need to wait for the child thread to complete, or there&#39;s going to be a race condition.  (You can see the race condition by adding a short <code>threadDelay</code> before printing <code>&quot;Closing handle&quot;</code>.)"}], "tags": [], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "is_accepted": true, "score": 6, "last_activity_date": 1577736692, "creation_date": 1577736692, "answer_id": 59536340, "question_id": 59536339, "link": "https://stackoverflow.com/questions/59536339/bracket-doesnt-release-resource-when-inside-thread/59536340#59536340", "title": "bracket doesn&#39;t release resource when inside thread", "body": "<h1>using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#v:throwTo\" rel=\"noreferrer\"><code>throwTo</code></a></h1>\n\n<p>Apparently the thread created with <code>forkFinally</code> never gets an exception thrown at and thus the resource-releasing code of <code>bracket</code> never gets executed.</p>\n\n<p>We can fix this by doing this manually using <code>throwTo threadId ThreadKilled</code>:</p>\n\n<pre><code>import           Control.Exception              ( bracket\n                                                , throwTo\n                                                , AsyncException(ThreadKilled)\n                                                )\n\nimport           Control.Concurrent             ( forkFinally\n                                                , threadDelay\n                                                )\nmain = do\n  threadId &lt;- forkFinally\n    (writeToFile \"first_file\")\n    (\\ex -&gt; putStrLn $ \"Exception occurred: \" ++ show ex)\n  putStrLn \"Press enter to exit\"\n  _ &lt;- getLine\n  throwTo threadId ThreadKilled\n  putStrLn \"Bye!\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "is_accepted": false, "score": 6, "last_activity_date": 1577739094, "creation_date": 1577739094, "answer_id": 59536718, "question_id": 59536339, "link": "https://stackoverflow.com/questions/59536339/bracket-doesnt-release-resource-when-inside-thread/59536718#59536718", "title": "bracket doesn&#39;t release resource when inside thread", "body": "<p>The root cause of the problem here is that when <code>main</code> exits, your process just dies.  It doesn't wait on any other threads that you've created to finish.  So in your original code, you created a thread to write to the file, but it was not allowed to finish.</p>\n\n<p>If you want to kill the thread but force it to clean up, then use <code>throwTo</code> as you did here.  If you want the thread to finish, you'll need to wait for that before <code>main</code> returns.  See <a href=\"https://stackoverflow.com/questions/28169297/how-to-force-main-thread-to-wait-for-all-its-child-threads-finish-in-haskell\">How to force main thread to wait for all its child threads finish in Haskell</a></p>\n"}, {"tags": [], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "is_accepted": false, "score": 2, "last_activity_date": 1594116428, "last_edit_date": 1594116428, "creation_date": 1578850497, "answer_id": 59706426, "question_id": 59536339, "link": "https://stackoverflow.com/questions/59536339/bracket-doesnt-release-resource-when-inside-thread/59706426#59706426", "title": "bracket doesn&#39;t release resource when inside thread", "body": "<h1>using <a href=\"https://hackage.haskell.org/package/async\" rel=\"nofollow noreferrer\"><code>async</code></a></h1>\n<p>Making <code>getLine</code> block the main thread indefinitely doesn't play nice with <a href=\"https://linux.die.net/man/1/nohup\" rel=\"nofollow noreferrer\"><code>nohup</code></a>: It will fail with</p>\n<pre><code>&lt;stdin&gt;: hGetLine: invalid argument (Bad file descriptor)\n</code></pre>\n<p>As an alternative to <code>getLine</code> and <code>throwTo</code>, you can use <a href=\"https://hackage.haskell.org/package/async-2.2.2/docs/Control-Concurrent-Async.html#v:withAsync\" rel=\"nofollow noreferrer\"><code>async</code>'s functions</a>:</p>\n<pre><code>import           Control.Concurrent.Async       ( withAsync, wait )\n\nmain = withAsync (writeToFile &quot;first_file&quot;) wait\n</code></pre>\n<p>This enables running the program with <code>nohup ./theProgram-exe &amp;</code>\u00b9, for example <a href=\"https://linuxhandbook.com/nohup-command/\" rel=\"nofollow noreferrer\">on a server via SSH</a>.</p>\n<p><code>async</code> also shines when running multiple tasks concurrently:</p>\n<pre><code>import           Control.Concurrent.Async       ( race_ )\n\nmain = race_ (writeToFile &quot;first_file&quot;) (writeToFile &quot;second_file&quot;)\n</code></pre>\n<p>The function <a href=\"https://hackage.haskell.org/package/async-2.2.2/docs/Control-Concurrent-Async.html#v:race_\" rel=\"nofollow noreferrer\"><code>race_</code></a> runs two tasks concurrently and waits until the first result arrives. With our non-terminating <code>writeToFile</code> there won't ever be a regular result, but if one of the tasks throws an exception, the other will be cancelled too. This is useful for running an HTTP and an HTTPS server simultaneously, for example.</p>\n<p>To shut down the program cleanly \u2014 giving threads a chance to free resources in <code>bracket</code> \u2014 I send it the <a href=\"https://en.wikipedia.org/wiki/Signal_(IPC)#SIGINT\" rel=\"nofollow noreferrer\">SIGINT</a> signal:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>pkill --signal SIGINT theProgram-exe\n</code></pre>\n<h2>Handling SIGTERM</h2>\n<p>To also end threads gracefully on a <a href=\"https://en.wikipedia.org/wiki/Signal_(IPC)#SIGTERM\" rel=\"nofollow noreferrer\">SIGTERM</a>, we can <a href=\"https://hackage.haskell.org/package/unix-2.7.2.2/docs/System-Posix-Signals.html#v:installHandler\" rel=\"nofollow noreferrer\">install a handler</a> that will catch the signal:</p>\n<pre><code>import           Control.Concurrent.Async       ( withAsync\n                                                , wait\n                                                , cancel\n                                                , Async\n                                                )\nimport           System.Posix.Signals\n\nmain = withAsync\n  (writeToFile &quot;first_file&quot;)\n  (\\asy -&gt; do\n    cancelOnSigTerm asy\n    wait asy\n  )\n\ncancelOnSigTerm :: Async a -&gt; IO Handler\ncancelOnSigTerm asy = installHandler\n  sigTERM\n  (Catch $ do\n    putStrLn &quot;Caught SIGTERM&quot;\n    -- Throws an AsyncCancelled exception to the forked thread, allowing\n    -- it to release resources via bracket\n    cancel asy\n  )\n  Nothing\n</code></pre>\n<p>Now, our program will release its resources in <code>bracket</code> when receiving SIGTERM:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>pkill theProgram-exe\n</code></pre>\n<p>Here's the equivalent for two concurrent tasks supporting SIGTERM:</p>\n<pre><code>import           Control.Concurrent.Async       ( withAsync\n                                                , wait\n                                                , cancel\n                                                , Async\n                                                , waitEither_\n                                                )\nimport           System.Posix.Signals\n\nmain = raceWith_ cancelOnSigTerm\n                 (writeToFile &quot;first_file&quot;)\n                 (writeToFile &quot;second_file&quot;)\n\nraceWith_ :: (Async a -&gt; IO b) -&gt; IO a -&gt; IO a -&gt; IO ()\nraceWith_ f left right = withAsync left $ \\a -&gt; withAsync right $ \\b -&gt; do\n  f a\n  f b\n  waitEither_ a b\n</code></pre>\n<p>For more on the topic of asynchronous Haskell, have a peek at <a href=\"https://www.oreilly.com/library/view/parallel-and-concurrent/9781449335939/\" rel=\"nofollow noreferrer\">Parallel and Concurrent Programming in Haskell</a> by Simon Marlow.</p>\n<hr />\n<p>\u00b9<sub>Call <code>stack build</code> to get an executable at, for example, <code>.stack-work/dist/x86_64-linux-tinfo6/Cabal-2.4.0.1/build/theProgram-exe/theProgram-exe</code>. You can get the path of this directory with <code>stack path --local-install-root</code>. </sub></p>\n"}], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 59536340, "answer_count": 3, "score": 8, "last_activity_date": 1594116428, "creation_date": 1577736692, "question_id": 59536339, "link": "https://stackoverflow.com/questions/59536339/bracket-doesnt-release-resource-when-inside-thread", "title": "bracket doesn&#39;t release resource when inside thread", "body": "<p>I'm having trouble with Haskell's <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#v:bracket\" rel=\"noreferrer\"><code>bracket</code></a>: When being run inside a forked thread (using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Concurrent.html#v:forkFinally\" rel=\"noreferrer\"><code>forkFinally</code></a>) <code>bracket</code>'s second argument, the computation that releases resources is not run when the program ends.</p>\n\n<p>Here's code illustrating the issue (I'm aware that in this specific case I could disable buffering to write to the file immediately):</p>\n\n<pre><code>import           System.IO\nimport           Control.Exception              ( bracket\n                                                , throwTo\n                                                )\n\nimport           Control.Concurrent             ( forkFinally\n                                                , threadDelay\n                                                )\nmain = do\n  threadId &lt;- forkFinally\n    (writeToFile \"first_file\")\n    (\\ex -&gt; putStrLn $ \"Exception occurred: \" ++ show ex)\n  putStrLn \"Press enter to exit\"\n  _ &lt;- getLine\n  putStrLn \"Bye!\"\n\nwriteToFile :: FilePath -&gt; IO ()\nwriteToFile file = bracket\n  (openFile file AppendMode)\n  (\\fileHandle -&gt; do\n    putStrLn $ \"\\nClosing handle \" ++ show fileHandle\n    hClose fileHandle\n  )\n  (\\fileHandle -&gt; mapM_ (addNrAndWait fileHandle) [1 ..])\n\naddNrAndWait :: Handle -&gt; Int -&gt; IO ()\naddNrAndWait fileHandle nr =\n  let nrStr = show nr\n  in  do\n        putStrLn $ \"Appending \" ++ nrStr\n        hPutStrLn fileHandle nrStr\n        threadDelay 1000000\n</code></pre>\n\n<p>The computation that releases resources (and writes to the console) is never called:</p>\n\n<pre><code>putStrLn $ \"\\nClosing handle \" ++ show fileHandle\nhClose fileHandle\n</code></pre>\n\n<p>Making the program single threaded by removing the forking code from <code>main</code> gets rid of the issue and the file handle is closed when ending the program with <kbd>Ctrl</kbd> + <kbd>c</kbd>:</p>\n\n<pre><code>main = writeToFile \"first_file\"\n</code></pre>\n\n<p>How do I ensure that the resource-releasing code in <code>bracket</code> is executed when using multiple threads?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1577716129, "post_id": 59532296, "comment_id": 105234376, "body": "Yes I completely overlooked the fact I was already using it somehow to fetch the &quot;data&quot; key......"}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 3, "last_activity_date": 1577734787, "last_edit_date": 1577734787, "creation_date": 1577716088, "answer_id": 59532422, "question_id": 59532296, "link": "https://stackoverflow.com/questions/59532296/how-to-get-value-from-key-using-aesons-parser-from-very-simple-object/59532422#59532422", "title": "How to get value from key using Aeson&#39;s Parser from very simple Object`", "body": "<pre><code>d .: \"test\"\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/aeson-1.4.6.0/docs/Data-Aeson.html#v:.:\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/aeson-1.4.6.0/docs/Data-Aeson.html#v:.:</a></p>\n\n<blockquote>\n  <p>Retrieve the value associated with the given key of an Object. The\n  result is empty if the key is not present or the value cannot be\n  converted to the desired type.</p>\n</blockquote>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 59532422, "answer_count": 1, "score": 2, "last_activity_date": 1577734787, "creation_date": 1577715482, "last_edit_date": 1577734707, "question_id": 59532296, "link": "https://stackoverflow.com/questions/59532296/how-to-get-value-from-key-using-aesons-parser-from-very-simple-object", "title": "How to get value from key using Aeson&#39;s Parser from very simple Object`", "body": "<p>I'm trying to parse some JSON.</p>\n\n<p>Given a very simple <code>[Object]</code> how can I get the <code>Value</code> under a string key? </p>\n\n<p><strong>Attempt one (guessing):</strong></p>\n\n<p><code>d . key \"test\"</code></p>\n\n<p>Errors with:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Parser [Object]\u2019\n                  with actual type \u2018(Value -&gt; f0 Value) -&gt; c0\u2019\n</code></pre>\n\n<p><strong>Attempt two (from reading <a href=\"https://hackage.haskell.org/package/aeson-lens-0.5.0.0/docs/Data-Aeson-Lens.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/aeson-lens-0.5.0.0/docs/Data-Aeson-Lens.html</a>):</strong></p>\n\n<pre><code>d ^. key \"test\"\n</code></pre>\n\n<p>Errors with:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Parser [Object]\u2019\n              with actual type \u2018Value\u2019\n</code></pre>\n\n<hr>\n\n<p>Full code:</p>\n\n<pre><code>{-# Language OverloadedStrings #-}\nmodule JobManagerApi where\n\nimport Network.Wreq\nimport Job\nimport Control.Lens\nimport Data.Aeson\nimport Data.Aeson.Lens (_String, key)\nimport Data.Aeson.Types\nimport Data.ByteString.Lazy\n\n-- parseResponse :: ByteString -&gt; Either String String\nparseResponse z = do\n  result &lt;- eitherDecode z\n  flip parseEither result (\\obj -&gt; do\n          d &lt;- obj .: \"data\"\n          -- k &lt;- d . key \"test\"\n          return (d :: [Object])\n        )\n\napiPendingJobs :: IO [Job]\napiPendingJobs = do\n  r &lt;- get \"http://localhost:3000/user_job_queue\"\n  let x = (r ^. responseBody)\n  print $ parseResponse x\n  pure []\n</code></pre>\n\n<p>The relavent bit being:</p>\n\n<pre><code>  flip parseEither result (\\obj -&gt; do\n          d &lt;- obj .: \"data\"\n          -- k &lt;- d . key\n          return (d :: [Object])\n        )\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 1, "creation_date": 1577713582, "post_id": 59531785, "comment_id": 105233256, "body": "One way is <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Traversable.html#line-237\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/src/&hellip;</a> If you have any question about this implementation fell free to ask."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1577718305, "post_id": 59531785, "comment_id": 105235291, "body": "Not completely relevant, but your <code>concatMonads</code> sequences the monadic effects right-to-left, which is unusual. E.g. <code>concatMonads [print 1&gt;&gt;pure 1 , print 2&gt;&gt;pure 2]</code> returns the list <code>[1,2]</code> but prints 2 and 1 in that order, AFAICS. The answer by Chris below would print 1 and 2 instead."}, {"owner": {"reputation": 4211, "user_id": 309334, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ccb6132ce896551124c59844c306c632?s=128&d=identicon&r=PG", "display_name": "Eponymous", "link": "https://stackoverflow.com/users/309334/eponymous"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577734679, "post_id": 59531785, "comment_id": 105241556, "body": "@chi Good point. That book does not teach monads in terms of side-effects - so I wasn&#39;t thinking about them. The monad laws it gives are r &amp; l identity and associativity, they don&#39;t include sequencing. They probably should since people expect it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577736162, "post_id": 59531785, "comment_id": 105242043, "body": "Technically, sequencing is not an equational law, but rather the <i>absence</i> of a commutative law which lets us reorder the effects."}], "answers": [{"tags": [], "owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "is_accepted": true, "score": 3, "last_activity_date": 1577714762, "creation_date": 1577714762, "answer_id": 59532152, "question_id": 59531785, "link": "https://stackoverflow.com/questions/59531785/how-do-i-answer-chapter-18-exercise-5-haskell-from-first-principles-not-in-ter/59532152#59532152", "title": "How do I answer Chapter 18, Exercise 5, Haskell From First Principles not in terms of &quot;flipType&quot; from Exercise 6", "body": "<pre><code>meh :: Monad m =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]\n</code></pre>\n\n<p>The first argument can be <code>[]</code>, and that's easy.</p>\n\n<pre><code>meh [] _ = pure []\n</code></pre>\n\n<p>The main case should perform the action provided by f, then recursively <code>meh</code> the rest of the list, and collect the results:</p>\n\n<pre><code>meh (x:xs) f = do\n    r &lt;- f x\n    rs &lt;- meh xs f\n    pure (r:rs)\n</code></pre>\n\n<p>or without <code>do</code> notation:</p>\n\n<pre><code>meh (x:xs) f =\n    f x &gt;&gt;= \\r -&gt; meh xs f &gt;&gt;= \\rs -&gt; pure (r:rs)\n</code></pre>\n\n<p>or in <code>Applicative</code> terms:</p>\n\n<pre><code>meh (x:xs) f = (:) &lt;$&gt; f x &lt;*&gt; meh xs f\n</code></pre>\n"}], "owner": {"reputation": 4211, "user_id": 309334, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ccb6132ce896551124c59844c306c632?s=128&d=identicon&r=PG", "display_name": "Eponymous", "link": "https://stackoverflow.com/users/309334/eponymous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 59532152, "answer_count": 1, "score": 1, "last_activity_date": 1577714762, "creation_date": 1577712959, "question_id": 59531785, "link": "https://stackoverflow.com/questions/59531785/how-do-i-answer-chapter-18-exercise-5-haskell-from-first-principles-not-in-ter", "title": "How do I answer Chapter 18, Exercise 5, Haskell From First Principles not in terms of &quot;flipType&quot; from Exercise 6", "body": "<p>The exercise is to define the function <code>meh</code>, which I did as follows:</p>\n\n<pre><code>meh :: Monad m =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]\nmeh input_list transform = concatMonads transformed_input\n  where \n    transformed_input = fmap transform input_list\n\nconcatMonads :: Monad m =&gt; [m b] -&gt; m [b]\nconcatMonads [] = pure []\nconcatMonads (first:rest) = (concatMonads rest) &gt;&gt;= (appendListToMonadContent first)\n\nappendListToMonadContent :: Monad m =&gt; m b -&gt; [b] -&gt; m [b]\nappendListToMonadContent cur to_append = fmap (\\first -&gt; first:to_append) cur\n</code></pre>\n\n<p>The next exercise is to define <code>flipType :: Monad m =&gt; [m b] -&gt; m [b]</code> and the hint is \"reuse <code>meh</code>\" (which is easy: <code>flipType l = meh l id</code>). However, my answer to question 5 uses <code>flipType</code>, it is just called <code>concatMonads</code>, so it is obvious that I did it differently than the authors were intending.</p>\n\n<p>How can I define <code>meh</code> without using <code>flipType</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1577712056, "post_id": 59530758, "comment_id": 105232562, "body": "I see a speed up (1CPU=1s vs 2CPU=0.7s for the parallelizable section) <a href=\"https://gist.github.com/Lysxia/51bd5e25371366184c59cc8223b4f2dd\" rel=\"nofollow noreferrer\">gist.github.com/Lysxia/51bd5e25371366184c59cc8223b4f2dd</a> How are you benchmarking?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577712487, "post_id": 59530758, "comment_id": 105232738, "body": "Minor things to try: <code>foldl</code> is almost always bad, try <code>foldl&#39;</code>. Further, <code>transpose</code> looks suspicious. You can convert a <code>Bool</code> to an <code>Int</code> with <code>fromEnum</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 12624758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b95d71f75d116cdf9d19c211c30acfdf?s=128&d=identicon&r=PG&f=1", "display_name": "Filip Federowicz", "link": "https://stackoverflow.com/users/12624758/filip-federowicz"}, "edited": false, "score": 0, "creation_date": 1577828837, "post_id": 59536526, "comment_id": 105266327, "body": "Thanks for the explanation -- I see I need to go differently about generating and traversing the list. Also the <code>rseq</code> comment was very helpful,"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1577737797, "creation_date": 1577737797, "answer_id": 59536526, "question_id": 59530758, "link": "https://stackoverflow.com/questions/59530758/data-set-member-lookup-in-parallel/59536526#59536526", "title": "Data.Set member lookup in parallel", "body": "<p>You do not need to recompile <code>Data.Set</code>.  It is sufficient to compile the final program with the <code>-threaded</code> flag and run it with <code>+RTS -N</code> or similar.</p>\n\n<p>However, a big problem with your test case is that I believe the execution time is entirely dominated by the traversal of the <code>xs</code> list by <code>chunksOf</code> with the subsequent <code>transpose</code>.  You saw a difference with list lookups because they're so slow, but set lookups in any set of realistic size will be too fast for you to observe any benefits.</p>\n\n<p>Also, as a side note, <code>parMap rpar</code> doesn't really make sense.  <code>parMap</code> already sparks the computations in parallel, so the <code>rpar</code> is redundant (and introduces some additional trivial overhead, since it probably re-sparks the computations).  Instead, use <code>parMap rseq</code>, which is a strategy to calculate the list elements in parallel (<code>parMap</code>) by evaluating each of them to WHNF (<code>rseq</code>).</p>\n\n<p>To see some benefit, you can try something like the following.  This passes in lists of lists to define the chunks which avoids traversing (and probably even actually creating) the lists.  Compiled with <code>-O2 -threaded</code> and run with <code>+RTS -N</code> on my 16-core machine, it runs the serial and one-chunk parallel versions in about 90ms.  The parallel version with ten chunks runs substantially faster, in about 30ms, and the 100 chunk version runs in 20ms.</p>\n\n<pre><code>import           Criterion.Main\nimport           Data.List (transpose)\nimport           Data.List.Split (chunksOf)\nimport           Control.Parallel.Strategies (parMap, rseq)\nimport qualified Data.Set as S\n\ncntSeq :: S.Set Int -&gt; [Int] -&gt; Int\ncntSeq set xs = sum (map (mmbr set) xs)\n  where\n    mmbr st x | S.member x st = 1\n              | otherwise = 0\n\ncntPar :: S.Set Int -&gt; [[Int]] -&gt; Int\ncntPar set = sum . parMap rseq (cntSeq set)\n\nmain = do\n  let evens = S.fromList [0,2..200000000]\n  defaultMain\n    [ bench \"serial\"      $ whnf (cntSeq evens) [0..999999]\n    , bench \"parallel1\"   $ whnf (cntPar evens) [[0..999999]]   -- one chunk\n    , bench \"parallel10\"  $ whnf (cntPar evens) [[i..i+99999] | i &lt;- [0,100000..900000]]  -- 10 chunks\n    , bench \"parallel100\" $ whnf (cntPar evens) [[i..i+9999]  | i &lt;- [0,10000..990000]]   -- 100 chunks\n    ]\n</code></pre>\n\n<p>The benchmark output on my machine:</p>\n\n<pre><code>benchmarking serial\ntime                 90.63 ms   (90.21 ms .. 91.02 ms)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 92.47 ms   (91.81 ms .. 93.48 ms)\nstd dev              1.372 ms   (807.8 \u03bcs .. 2.023 ms)\n\nbenchmarking parallel1\ntime                 91.13 ms   (90.50 ms .. 91.77 ms)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 91.73 ms   (91.38 ms .. 92.26 ms)\nstd dev              696.0 \u03bcs   (427.3 \u03bcs .. 905.7 \u03bcs)\n\nbenchmarking parallel10\ntime                 31.25 ms   (23.77 ms .. 37.88 ms)\n                     0.897 R\u00b2   (0.745 R\u00b2 .. 0.987 R\u00b2)\nmean                 54.53 ms   (43.81 ms .. 81.93 ms)\nstd dev              29.69 ms   (18.88 ms .. 40.02 ms)\n\nbenchmarking parallel100\ntime                 19.99 ms   (19.81 ms .. 20.19 ms)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 20.13 ms   (19.99 ms .. 20.62 ms)\nstd dev              536.7 \u03bcs   (111.9 \u03bcs .. 1.043 ms)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12624758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b95d71f75d116cdf9d19c211c30acfdf?s=128&d=identicon&r=PG&f=1", "display_name": "Filip Federowicz", "link": "https://stackoverflow.com/users/12624758/filip-federowicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 59536526, "answer_count": 1, "score": 1, "last_activity_date": 1577737797, "creation_date": 1577708433, "question_id": 59530758, "link": "https://stackoverflow.com/questions/59530758/data-set-member-lookup-in-parallel", "title": "Data.Set member lookup in parallel", "body": "<p>I'm trying to do a parallel (multiple cores) lookup in Data.Set using <code>member</code> function as in the code below:</p>\n\n<pre><code>import           Control.Parallel.Strategies (parMap, rpar)\nimport qualified Data.Set as S\n\ncntSeq :: S.Set Int -&gt; [Int] -&gt; Int\ncntSeq set xs = foldl (\\c x -&gt; c + (mmbr set x)) 0 xs\n  where\n    mmbr st x | S.member x st = 1\n              | otherwise = 0\n\ncntPar :: Int -&gt; S.Set Int -&gt; [Int] -&gt; Int\ncntPar n set xs =\n  let\n    chnks = chunksOf n xs\n    tr = transpose chnks\n  in sum $ parMap rpar (cntSeq set) tr \n</code></pre>\n\n<p>but seems like <code>cntPar</code> is not actually benefiting from multiple cores.</p>\n\n<p>If I replace Set with just a regular list lookup the speedup for the parallel version is significant.</p>\n\n<p>Do I need to recompile Data.Set with something like <code>-threaded</code> option?</p>\n\n<p>(BTW, I do realize that <code>intersection</code> would be an option it's just that I'm interested in parallelizing set lookups -- that's just a simplified version of a different problem.)</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1577708934, "post_id": 59530041, "comment_id": 105231213, "body": "What packages do you have listed under <code>dependencies</code> in your <code>packages.yaml</code>? It looks to me like you only have <code>base</code> there. You will need to add <code>containers</code> in order to use <code>Data.Set</code> and <code>Data.Map.Strict</code>."}, {"owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577709837, "post_id": 59530041, "comment_id": 105231592, "body": "@RobinZigmond I don&#39;t have additional files, just the one I posted above. But you nugded my in the right direction, starting ghci with <code>stack ghci --resolver lts-12.5 --package raw-strings-qq containers</code> works! Since I didn&#39;t need to list <code>containers</code> for <code>runghc</code> I didn&#39;t expect to need it for ghci..."}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1577705885, "creation_date": 1577705184, "last_edit_date": 1577705885, "question_id": 59530041, "link": "https://stackoverflow.com/questions/59530041/ghci-cant-load-script-that-imports-data-set-or-data-maybe-if-external-packa", "title": "GHCi can&#39;t load script that imports `Data.Set` or `Data.Maybe` if external package is imported", "body": "<p>I have a script </p>\n\n<pre><code>#!/usr/bin/env stack\n\n{-# LANGUAGE QuasiQuotes #-}\n\nmodule Script where\n\nimport qualified Data.Set as Set (Set, fromList)\nimport           Data.Maybe             (fromJust)\n{- import Text.RawString.QQ not neccessary for demonstration -}\n\nmain :: IO()\nmain = print \"foo\"\n</code></pre>\n\n<p>That I run with <code>stack --resolver lts-12.5 runghc --package raw-strings-qq Script.hs</code></p>\n\n<p>But I can't load it in GHCi:</p>\n\n<pre><code>$ stack ghci --resolver lts-12.5 --package raw-strings-qq \n\nNote: No local targets specified, so a plain ghci will be started with no package hiding or package options.\n\n      If you want to use package hiding and options, then you can try one of the following:\n\n      * If you want to start a different project configuration than /home/t/.stack/global-project/stack.yaml, then you can use stack init to create a new\n        stack.yaml for the packages in the current directory. \n\n      * If you want to use the project configuration at /home/t/.stack/global-project/stack.yaml, then you can add to its 'packages' field.\n\nConfiguring GHCi with the following packages: \nGHCi, version 8.4.3: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /tmp/haskell-stack-ghci/2a3bbd58/ghci-script\nPrelude&gt; :load Script.hs\n[1 of 1] Compiling Script           ( Script.hs, interpreted )\n\nStacko.hs:7:1: error:\n    Could not find module \u2018Data.Set\u2019\n    Perhaps you meant Data.Int (from base-4.11.1.0)\n    Use -v to see a list of the files searched for.\n  |\n7 | import qualified Data.Set as Set (Set, fromList)\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<h2>Own research:</h2>\n\n<p>I can load the file if I start ghci with just <code>stack ghci --resolver lts-12.5</code>.<br>\nInterestingly, when I import <code>Data.Set</code> 'unqualified' as I do with <code>Data.Maybe</code>: </p>\n\n<pre><code>import Data.Set\nimport Data.Maybe\n</code></pre>\n\n<p>the error persists, but when I drop the <code>Data.Set</code> import all together I can load <code>Script.hs</code>  </p>\n\n<p>Imports that don't work: <code>Data.Set</code>, <code>Data.Map.Strict</code><br>\nImports that work: <code>Data.List</code>, <code>Data.Function</code>, <code>Data.Maybe</code><br>\npackages that produce the error: <code>raw-strings-qq</code>, <code>HUnit</code></p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 6, "creation_date": 1577703893, "post_id": 59529744, "comment_id": 105229137, "body": "Sounds like you want the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:permutations\" rel=\"nofollow noreferrer\">permutations</a> function"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1577704519, "creation_date": 1577704519, "answer_id": 59529898, "question_id": 59529744, "link": "https://stackoverflow.com/questions/59529744/is-there-a-way-to-get-all-the-possible-rearrangements-of-a-list-in-haskell/59529898#59529898", "title": "Is there a way to get all the possible rearrangements of a list in Haskell?", "body": "<p><strong>Yes</strong>. The <code>Data.List</code> module has a <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:permutations\" rel=\"noreferrer\"><strong><code>permutations :: [a] -&gt; [[a]]</code></strong></a> function to generate all permutations. This does not only work on three or more elements, but it does not use an <code>Eq</code> typeconstraint. If a list contains two items that are equal, then you can still consider it a different permutation when we swap the two.</p>\n\n<p>We can furthermore implement such function ourself. We can first make a helper function that is given a list and returns a list of 2-tuples where the first item contains the value we \"picked\", and the second item a list of remaining elements:</p>\n\n<pre><code>pick :: [a] -&gt; [(a, [a])]\npick [] = []\npick (x:xs) = (x, xs) : map prep (pick xs)\n    where prep (y, ys) = (y, x:ys)\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; pick [1,4,2,5]\n[(1,[4,2,5]),(4,[1,2,5]),(2,[1,4,5]),(5,[1,4,2])]\n</code></pre>\n\n<p>Next we can use recursion to each time pick an element, and recurse on the remaining elements:</p>\n\n<pre><code>perms :: [a] -&gt; [[a]]\nperms [] = [[]]\nperms xs = [ p : ps | (p, ys) &lt;- pick xs, ps &lt;- perms ys ]\n</code></pre>\n\n<p>This then yields:</p>\n\n<pre><code>Prelude&gt; perms [1,4,2,5]\n[[1,4,2,5],[1,4,5,2],[1,2,4,5],[1,2,5,4],[1,5,4,2],[1,5,2,4],[4,1,2,5],[4,1,5,2],[4,2,1,5],[4,2,5,1],[4,5,1,2],[4,5,2,1],[2,1,4,5],[2,1,5,4],[2,4,1,5],[2,4,5,1],[2,5,1,4],[2,5,4,1],[5,1,4,2],[5,1,2,4],[5,4,1,2],[5,4,2,1],[5,2,1,4],[5,2,4,1]]\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 9852094, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bu8XCTVNdck/AAAAAAAAAAI/AAAAAAAAADc/4m5GZFVcPfI/photo.jpg?sz=128", "display_name": "Jordan Sapida", "link": "https://stackoverflow.com/users/9852094/jordan-sapida"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 59529898, "answer_count": 1, "score": 1, "last_activity_date": 1577704519, "creation_date": 1577703816, "question_id": 59529744, "link": "https://stackoverflow.com/questions/59529744/is-there-a-way-to-get-all-the-possible-rearrangements-of-a-list-in-haskell", "title": "Is there a way to get all the possible rearrangements of a list in Haskell?", "body": "<p>I want to create a function that rearranges the elements of a list.</p>\n\n<p>For example the list [1,2,3] will produce:</p>\n\n<pre><code>[1,2,3]\n[1,3,2]\n[2,1,3]\n[2,3,1]\n[3,1,2]\n[3,2,1]\n</code></pre>\n\n<p>The order isn't important. \nIf I write this list comprehension:</p>\n\n<pre><code>[[a,b,c] | a &lt;- l, b &lt;- l, c &lt;- l, a /= b, a /= c, b /= c]\n</code></pre>\n\n<p>It works (where l is the desired list). Problem is I want to do this for an undefined number of list elements</p>\n"}, {"tags": ["haskell", "haskell-stack", "macos-mojave"], "comments": [{"owner": {"reputation": 21, "user_id": 12623756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af4d5c44505edf6b7249c93130e8c7e7?s=128&d=identicon&r=PG&f=1", "display_name": "Angus Davis", "link": "https://stackoverflow.com/users/12623756/angus-davis"}, "edited": false, "score": 1, "creation_date": 1577727532, "post_id": 59528039, "comment_id": 105239085, "body": "The solution seems to be to remove the ~/.ghc/x86_64-darwin-8.6.5 folder."}], "owner": {"reputation": 21, "user_id": 12623756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af4d5c44505edf6b7249c93130e8c7e7?s=128&d=identicon&r=PG&f=1", "display_name": "Angus Davis", "link": "https://stackoverflow.com/users/12623756/angus-davis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1577740381, "creation_date": 1577696072, "last_edit_date": 1577740381, "question_id": 59528039, "link": "https://stackoverflow.com/questions/59528039/how-to-fix-haskell-stack-setup-failed-to-compile-sanity-check-on-mac-os-10-14-6", "title": "how to fix haskell stack setup failed to compile sanity check on Mac OS 10.14.6", "body": "<p>I've somehow messed up my haskell installation on MacOs 10.14.6\nI've removed the ~/.stack and ~/.cabal folders and ran <code>brew uninstall haskell-stack</code>\nI've installed ghc using \n<code>curl https://get-ghcup.haskell.org -sSf | sh</code>\nand then installed stack using\n<code>brew install haskell-stack</code></p>\n\n<blockquote>\n  <p><code>stack --version: Version 2.1.3 x86_64</code></p>\n  \n  <p><code>cabal --version: cabal-install version 3.0.0.0</code></p>\n</blockquote>\n\n<p>When I run <code>stack setup</code>, I get this: </p>\n\n<pre><code>The GHC located at /Users/angudavi/.stack/programs/x86_64-osx/ghc-8.6.5/bin/ghc-8.6.5 failed to compile a sanity check. Please see:\n\n    http://docs.haskellstack.org/en/stable/install_and_upgrade/\n\nfor more information. Exception was:\n\nReceived ExitFailure 1 when running\nRaw command: /Users/angudavi/.stack/programs/x86_64-osx/ghc-8.6.5/bin/ghc-8.6.5 /private/var/folders/rc/05xmxx2d1z94wfq8gjy5g8640000gn/T/stack-sanity-check-18076106c692e89a/Main.hs -no-user-package-db\nRun from: /private/var/folders/rc/05xmxx2d1z94wfq8gjy5g8640000gn/T/stack-sanity-check-18076106c692e89a/\n\nStandard error:\n\nLoaded package environment from /Users/angudavi/.ghc/x86_64-darwin-8.6.5/environments/default\nghc: can't find a package database at /Users/angudavi/.cabal/store/ghc-8.6.5/package.db\n</code></pre>\n"}, {"tags": ["haskell", "command-line", "io"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1577697976, "post_id": 59527932, "comment_id": 105226785, "body": "That&#39;s an ansi escape code, not anything to do with Haskell. Looks like the terminal you&#39;re using doesn&#39;t support them."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1577698211, "post_id": 59527932, "comment_id": 105226869, "body": "This will only work if the terminal you work in supports ANSI escape codes."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1577698284, "post_id": 59527932, "comment_id": 105226894, "body": "Apparently you can use the Ubuntu subshell for ANSI terminal support: <a href=\"https://en.wikipedia.org/wiki/ANSI_escape_code#DOS_and_Windows\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/ANSI_escape_code#DOS_and_Windows</a>"}, {"owner": {"reputation": 3, "user_id": 12623948, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-23Wki0mygZc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdIhjPROs5v_2yMgqpUw0KDVLgvIg/mo/photo.jpg?sz=128", "display_name": "pieterinjapan", "link": "https://stackoverflow.com/users/12623948/pieterinjapan"}, "edited": false, "score": 0, "creation_date": 1577698492, "post_id": 59527932, "comment_id": 105226971, "body": "Thank you so much for your advice Carl and Willem."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 12623948, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-23Wki0mygZc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdIhjPROs5v_2yMgqpUw0KDVLgvIg/mo/photo.jpg?sz=128", "display_name": "pieterinjapan", "link": "https://stackoverflow.com/users/12623948/pieterinjapan"}, "edited": false, "score": 0, "creation_date": 1577699049, "post_id": 59528515, "comment_id": 105227190, "body": "Thank you so much for your suggestion! I could run the code successfully using ConEmu."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1577705411, "last_edit_date": 1577705411, "creation_date": 1577698341, "answer_id": 59528515, "question_id": 59527932, "link": "https://stackoverflow.com/questions/59527932/the-command-esc-in-haskell-is-showing-incorrect-behavior-how-do-i-resolve-this/59528515#59528515", "title": "The command \\ESC in Haskell is showing incorrect behavior. How do I resolve this?", "body": "<p>You need to use a console/terminal program which supports such escape sequences.</p>\n\n<p>On Unix-like systems, like Linux, that's the default.</p>\n\n<p>On windows, the standard console probably does not support them (?). Using a more advanced terminal like <a href=\"https://conemu.github.io/\" rel=\"nofollow noreferrer\">ConEmu</a> should work. I just tried ConEmu on a windows 8 machine and it respected the escape sequence, clearing the screen as wanted.</p>\n"}], "owner": {"reputation": 3, "user_id": 12623948, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-23Wki0mygZc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdIhjPROs5v_2yMgqpUw0KDVLgvIg/mo/photo.jpg?sz=128", "display_name": "pieterinjapan", "link": "https://stackoverflow.com/users/12623948/pieterinjapan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 59528515, "answer_count": 1, "score": 0, "last_activity_date": 1577705411, "creation_date": 1577695412, "question_id": 59527932, "link": "https://stackoverflow.com/questions/59527932/the-command-esc-in-haskell-is-showing-incorrect-behavior-how-do-i-resolve-this", "title": "The command \\ESC in Haskell is showing incorrect behavior. How do I resolve this?", "body": "<p>I'm currently  working through the textbook \"Programming in Haskell\"\nby Graham Hutton (2nd Edition). In his section on the Game of Life, he\ndefines a function </p>\n\n<pre><code>cls :: IO ()\ncls = putStr \"\\ESC[2J\"\n</code></pre>\n\n<p>which is supposed to clear the terminal screen when run.</p>\n\n<p>This is not the behavior I'm observing. When I run the code \nthe terminal window shows [2J, and is not cleared.</p>\n\n<p>I'm running the code on an HP laptop with windows 10 and using the \nGHC compiler. </p>\n\n<p>Any advice on this problem would be greatly appreciated.  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 6, "creation_date": 1577674502, "post_id": 59525155, "comment_id": 105221267, "body": "You didn\u2019t provide a value for <code>numberString</code>. <code>step [2, 6] &quot;+&quot;</code>?"}, {"owner": {"reputation": 1055, "user_id": 593298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51e634a7316f1a4101f65519d2110cce?s=128&d=identicon&r=PG", "display_name": "keep_learning", "link": "https://stackoverflow.com/users/593298/keep-learning"}, "edited": false, "score": 0, "creation_date": 1577674529, "post_id": 59525155, "comment_id": 105221274, "body": "Try using step [2+6] &quot;&quot; (notice a empty string as your accumulator)."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1577698078, "post_id": 59525155, "comment_id": 105226825, "body": "As @Ry says, you need to apply <code>step</code> to 2 arguments if you want to actually see some output directly. The only reason I&#39;m repeating that here is to point out that GHCi already pointed this out to you: <code>maybe you haven&#39;t applied a function to enough arguments?</code>. Always read the whole of any error message, it&#39;s not infrequent that, as here, it will tell you exactly how to fix it."}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 12433225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b31543ef5eba6ed494b5ad07f14a0a23?s=128&d=identicon&r=PG&f=1", "display_name": "JonathanArns", "link": "https://stackoverflow.com/users/12433225/jonathanarns"}, "is_accepted": true, "score": 1, "last_activity_date": 1577708076, "creation_date": 1577708076, "answer_id": 59530681, "question_id": 59525155, "link": "https://stackoverflow.com/questions/59525155/error-in-haskell-please-guide-me-on-how-to-fix-this/59530681#59530681", "title": "Error in haskell. Please guide me on how to fix this", "body": "<p>With <code>step [2+6]</code> you are only partially applying your function, so the return value is not a list <code>[Int]</code>, but a function <code>String -&gt; [Int]</code>. (Partially applying a function means to only provide some of the arguments it needs and getting a function back that takes the rest of the arguments. Yes, you can do this in Haskell!)</p>\n\n<p>The error you see, will only arise in the terminal, because ghci tries to apply <code>show</code> to every statement, but functions are not showable.</p>\n\n<p>So if you want to fully apply your function to see it in action, you need to provide all the arguments it needs, i.e.</p>\n\n<pre><code>step [1, 2, 3] \"+\"\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 10554824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c35fb82393dc13b50b10b122769c59?s=128&d=identicon&r=PG&f=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10554824/ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 59530681, "answer_count": 1, "score": -2, "last_activity_date": 1577708076, "creation_date": 1577674253, "question_id": 59525155, "link": "https://stackoverflow.com/questions/59525155/error-in-haskell-please-guide-me-on-how-to-fix-this", "title": "Error in haskell. Please guide me on how to fix this", "body": "<pre><code>import Data.List\nstep :: [Int] -&gt; String -&gt; [Int] \nstep (x:y:ys) \"*\" = (x * y):ys\nstep (x:y:ys) \"+\" = (x + y):ys\nstep (x:y:ys) \"-\" = (y - x):ys\nstep xs numberString = read numberString:xs\n</code></pre>\n\n<p>This my code and error i keep getting is below, please any help is appreciated. Thank you.</p>\n\n<pre><code>*Main&gt; step [2+6]: this is what i put into my terminal\n\n&lt;interactive&gt;:5:1: error:\n    \u2022 No instance for (Show (String -&gt; [Int]))\n        arising from a use of \u2018print\u2019\n        (maybe you haven't applied a function to enough arguments?)\n    \u2022 In a stmt of an interactive GHCi command: print it\n*Main&gt; \n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 7, "last_activity_date": 1577647872, "creation_date": 1577647872, "answer_id": 59522629, "question_id": 59522572, "link": "https://stackoverflow.com/questions/59522572/this-error-keeps-occurring-in-haskell-any-idea-on-how-to-fix-it/59522629#59522629", "title": "This error keeps occurring in haskell any idea on how to fix it?", "body": "<p>There are a number of problems here.</p>\n\n<ol>\n<li>Do not use two type signatures for a single function.  You have <code>step :: ...</code> twice, pick one signatures and delete the other.</li>\n<li><code>where</code> must be indented.</li>\n<li>Your function isn't type-correct so you'll still have things to work through.</li>\n</ol>\n"}], "owner": {"reputation": 29, "user_id": 10554824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c35fb82393dc13b50b10b122769c59?s=128&d=identicon&r=PG&f=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10554824/ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 59522629, "answer_count": 1, "score": 0, "last_activity_date": 1577647872, "creation_date": 1577647393, "question_id": 59522572, "link": "https://stackoverflow.com/questions/59522572/this-error-keeps-occurring-in-haskell-any-idea-on-how-to-fix-it", "title": "This error keeps occurring in haskell any idea on how to fix it?", "body": "<pre><code>step :: [Int] -&gt; String -&gt; [Int]\nstep :: (Num a, Read a) =&gt; String -&gt; a\nstep = head . foldl foldingFunction [] . words\nwhere   foldingFunction (x:y:ys) \"*\" = (x * y):ys\n        foldingFunction (x:y:ys) \"+\" = (x + y):ys\n        foldingFunction (x:y:ys) \"/\" = (x / y):ys\n        foldingFunction (x:y:ys) \"-\" = (y - x):ys\n        foldingFunction xs numberString = read numberString:xs\n</code></pre>\n\n<p>The code above keeps giving this error: I have tried to fix it by changing step to solveRPN and tried taking out the square brackets [], but i keep getting this error.</p>\n\n<pre><code>haskell.hs:4:1: error: parse error on input \u2018where\u2019\n  |\n4 | where   foldingFunction (x:y:ys) \"*\" = (x * y):ys\n  | ^^^^^\nFailed, no modules loaded.\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "parsec", "parser-combinators"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1577629721, "post_id": 59519872, "comment_id": 105211524, "body": "you could check if <code>rest</code> has at least 1 word/tag/due (<code>filter</code> and then <code>null</code> check, for example) and use <code>guard</code> from <code>Control.Monad</code> to make sure the parser fails in such cases."}, {"owner": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "reply_to_user": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1577632283, "post_id": 59519872, "comment_id": 105212191, "body": "I&#39;m not sure to fully understand what you say. Could you provide me an example?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1577645276, "post_id": 59519872, "comment_id": 105215507, "body": "Don&#39;t add the answer to the question..."}, {"owner": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "edited": false, "score": 0, "creation_date": 1577645439, "post_id": 59519872, "comment_id": 105215550, "body": "Did you read ALL the comments? I found the solution thanks to the help I received. I asked the owner (M. Aroosi) to update his answer with what I&#39;ve found, then I will validate it."}], "answers": [{"comments": [{"owner": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "edited": false, "score": 0, "creation_date": 1577637984, "post_id": 59520931, "comment_id": 105213575, "body": "I see what you mean. I achieved the same with <code>isJust $ find atLeastOne rest</code>. But it leads to another problem. If I type <code>create --opt</code>, I have <code>[([SetCmd &quot;create&quot;,AddWord &quot;--json&quot;],&quot;&quot;)]</code>. I guess it&#39;s because <code>optExpr</code> fails, it falls back to <code>wordExpr</code>."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "edited": false, "score": 0, "creation_date": 1577639809, "post_id": 59520931, "comment_id": 105214107, "body": "@soywod this sounds like your <code>wordExpr</code> and <code>optExpr</code> both accept <code>&quot;--json&quot;</code>, in which case the parser <code>(AddWord &lt;$&gt; wordExpr) &lt;|&gt; (AddTag &lt;$&gt; addTagExpr) &lt;|&gt; (SetDue &lt;$&gt; dueExpr) &lt;|&gt; (AddOpt &lt;$&gt; optExpr)</code> tries both <code>wordExpr</code> and <code>optExpr</code> both of which succeed."}, {"owner": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "edited": false, "score": 0, "creation_date": 1577641582, "post_id": 59520931, "comment_id": 105214539, "body": "What do you mean by tries both? It will try one only if the first fail, isn&#39;t it? Indeed, <code>wordExpr</code> is like &quot;the trash&quot;. Everything that does not match opt/tag/due will end up as a word."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "edited": false, "score": 0, "creation_date": 1577644269, "post_id": 59520931, "comment_id": 105215234, "body": "<code>(&lt;|&gt;)</code> is defined as <code>(+++)</code> for <code>ReadP</code> which is commutative, it tries all the options and returns all the results. for example try to see the result of parsing &quot;hello&quot; with the parser <code>(0 &lt;$ string &quot;hello&quot;) &lt;|&gt; (1 &lt;$ string &quot;hello&quot;)</code>. you can use <code>(&lt;++)</code> for a left-biased choice, that is if the left parser succeeds it won&#39;t try the right one."}, {"owner": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "edited": false, "score": 0, "creation_date": 1577644405, "post_id": 59520931, "comment_id": 105215259, "body": "Yes indeed, <code>(&lt;++)</code> seems to better fit my needs. I will play a bit with and come back to you."}, {"owner": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "edited": false, "score": 0, "creation_date": 1577645199, "post_id": 59520931, "comment_id": 105215486, "body": "Thanks a lot, I was able to do what I was looking for :) I would like to validate your answer: could you please update it with the solution I found (I edited my post with)?"}], "tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 1, "last_activity_date": 1577634976, "creation_date": 1577634976, "answer_id": 59520931, "question_id": 59519872, "link": "https://stackoverflow.com/questions/59519872/haskell-readp-parse-at-least-one-of-the-list/59520931#59520931", "title": "Haskell ReadP parse at least one of the list", "body": "<p>A simple solution would be to use <code>guard</code> from <code>Control.Monad</code>.<br>\nAssuming a function like <code>isOpt :: Arg -&gt; Bool</code> which is along the lines of</p>\n\n<pre><code>isOpt :: Arg -&gt; Bool\nisOpt (AddOpt _) = True\nisOpt _          = False \n</code></pre>\n\n<p>then your definition of <code>createExpr</code> changes to</p>\n\n<pre><code>createExpr :: ReadP [Arg]\ncreateExpr = do\n    skipSpaces\n    cmd &lt;- SetCmd &lt;$&gt; cmdAliasExpr [\"create\", \"add\"]\n    skipSpaces\n    rest &lt;-\n      many1\n      $   (AddWord &lt;$&gt; wordExpr)\n      &lt;|&gt; (AddTag &lt;$&gt; addTagExpr)\n      &lt;|&gt; (SetDue &lt;$&gt; dueExpr)\n      &lt;|&gt; (AddOpt &lt;$&gt; optExpr)\n    guard $ at_least_one_non_optional rest\n    skipSpaces\n    return $ cmd : rest\n  where at_least_one_non_optional = not . null . filter (not . isOpt)\n</code></pre>\n\n<p><code>guard</code> basically fails the parser when its argument is <code>False</code>, and more generally it works with any <code>Alternative</code> by returning <code>empty</code> when the argument is <code>False</code>.  </p>\n"}], "owner": {"reputation": 3695, "user_id": 6213048, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8fcf68f42b160a352e7fa157dba36392?s=128&d=identicon&r=PG", "display_name": "soywod", "link": "https://stackoverflow.com/users/6213048/soywod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 59520931, "answer_count": 1, "score": 0, "last_activity_date": 1577645099, "creation_date": 1577626269, "last_edit_date": 1577645099, "question_id": 59519872, "link": "https://stackoverflow.com/questions/59519872/haskell-readp-parse-at-least-one-of-the-list", "title": "Haskell ReadP parse at least one of the list", "body": "<p>I try to parse a command (create) with the ReadP standard lib. My command should start by the string <code>create</code>, then contains at least one word/tag/due, and potentially an option. Here my actual expression:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>createExpr :: ReadP [Arg]\ncreateExpr = do\n  skipSpaces\n  cmd &lt;- SetCmd &lt;$&gt; cmdAliasExpr [\"create\", \"add\"]\n  skipSpaces\n  rest &lt;-\n    many1\n    $   (AddWord &lt;$&gt; wordExpr)\n    &lt;|&gt; (AddTag &lt;$&gt; addTagExpr)\n    &lt;|&gt; (SetDue &lt;$&gt; dueExpr)\n    &lt;|&gt; (AddOpt &lt;$&gt; optExpr)\n  skipSpaces\n  return $ cmd : rest\n</code></pre>\n\n<p>The problem is, if I call <code>create</code> with just one option, it parses well. But it shouldn't, since I expect at least one word/tag/due. How can I express this?</p>\n\n<p><hr></p>\n\n<h3><strong>[EDIT] I found the solution, thanks to <a href=\"https://stackoverflow.com/users/8491228/m-aroosi\">@M. Aroosi</a>.</strong></h3>\n\n<p>In fact, I used the wrong operator. <code>&lt;++</code>, <em>the local, exclusive, left-biased choice</em>, fits better my needs. Once an expression is matched, it should not check for the other ones:</p>\n\n<pre><code>notAnOpt arg = case arg of\n  AddOpt _ -&gt; False\n  _        -&gt; True\n\n\ncreateExpr :: ReadP [Arg]\ncreateExpr = do\n  skipSpaces\n  cmd &lt;- SetCmd &lt;$&gt; cmdAliasExpr [\"create\", \"add\"]\n  skipSpaces\n  rest &lt;-\n    many1\n    $   (AddTag &lt;$&gt; addTagExpr)\n    &lt;++ (SetDue &lt;$&gt; dueExpr)\n    &lt;++ (AddOpt &lt;$&gt; optExpr)\n    &lt;++ (AddWord &lt;$&gt; wordExpr)\n  skipSpaces\n  guard $ isJust $ find notAnOpt rest\n  return $ cmd : rest\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 0, "creation_date": 1577623036, "post_id": 59519037, "comment_id": 105209826, "body": "it seems to me like you want <code>(?~)</code> maybe?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1577743031, "post_id": 59519037, "comment_id": 105244382, "body": "Your description of what you&#39;re &quot;looking for&quot; is confusing.  <code>x</code> has two levels of <code>Maybe</code> -- are you trying to influence the outer, inner, or both?  Also, the <code>Monoid</code> instance for <code>MyRecord</code> is incomplete and seems irrelevant anyway if you want to use a <code>_Just.foo</code> optic to focus on the <code>Maybe Int</code> field.  It doesn&#39;t help that you&#39;re perhaps missing a <code>Just</code> in <code>myrecordFoo = 10</code>.  You might need to clarify what you&#39;re trying to do in order to get an answer."}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1577619393, "creation_date": 1577619393, "question_id": 59519037, "link": "https://stackoverflow.com/questions/59519037/lens-setter-analogous-to-monoidal-lens-getter", "title": "Lens setter analogous to &quot;monoidal&quot; lens getter?", "body": "<p>In some cases, the <code>^.</code> lens <strong>getter</strong> defaults to <code>mempty</code> if the field being accessed is not present. Example:</p>\n\n<pre><code>let x = Nothing :: Maybe String\n\nx ^. _Just == \"\"\n</code></pre>\n\n<p>What is the analogous lens <strong>setter</strong> with a similar behaviour? Here's what I'm looking for:</p>\n\n<pre><code>data MyRecord = MyRecord  { myrecordFoo :: Maybe Int  }\ninstance Monoid MyRecord where\n  mempty = MyRecord { myRecordFee = Nothing }\n\n$(makeLensesWith abbreviatedFields ''MyRecord)\n\n\nlet x = Nothing :: Maybe MyRecord\n\nx &amp; _Just . foo `someLensSetter` 10 == (Just $ MyRecord { myRecordFoo = 10 })\n</code></pre>\n\n<p>I've tried playing around with <code>&lt;&gt;~</code> and <code>&lt;&gt;=</code>, but couldn't get them to work in the way I expect above. Is this even possible? Is there some other standard combinator I should look at? Any custom combinator that can achieve this?</p>\n"}, {"tags": ["haskell", "generics", "ghc-generics"], "answers": [{"tags": [], "owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "is_accepted": true, "score": 3, "last_activity_date": 1577625549, "last_edit_date": 1577625549, "creation_date": 1577624499, "answer_id": 59519641, "question_id": 59518275, "link": "https://stackoverflow.com/questions/59518275/defining-an-mempty-like-function-with-ghc-generics/59519641#59519641", "title": "Defining an &quot;mempty&quot;-like function with GHC Generics?", "body": "<p>There is no point defining <code>GEmptyZohoStructure Maybe</code> in a typeclass for generics.  </p>\n\n<pre><code>class G f where \n  gempty' :: f p\ninstance (G f, G g) =&gt; G ( f :*: g) where \n  gempty' = gempty' :*: gempty'\n\ninstance G c =&gt; G (D1 x c) where\n  gempty' = M1 gempty'\ninstance G s =&gt; G (C1 x s) where\n  gempty' = M1 gempty'    \ninstance E t =&gt; G (S1 m (Rec0 t)) where -- the key instance\n  gempty' = M1 (K1 gempty)\n\nclass E a where\n  gempty :: a\n  default gempty :: (Generic a, G (Rep a)) =&gt; a\n  gempty = to gempty'    \ninstance E (Maybe a) where \n  gempty = Nothing\n</code></pre>\n\n<p>After that you can define any product type consisting of Maybe values. </p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 59519641, "answer_count": 1, "score": 2, "last_activity_date": 1577625549, "creation_date": 1577612375, "question_id": 59518275, "link": "https://stackoverflow.com/questions/59518275/defining-an-mempty-like-function-with-ghc-generics", "title": "Defining an &quot;mempty&quot;-like function with GHC Generics?", "body": "<p>I am writing a client library for the Zoho REST API and have a bunch of different record types that have all <code>Maybe a</code> fields, i.e:</p>\n\n<pre><code>data Approval = Approval\n  { apDelegate :: Maybe Bool\n  , apApprove :: Maybe Bool\n  , apReject :: Maybe Bool\n  , apResubmit :: Maybe Bool\n  } deriving (Eq, Show, Generic)\n\ndata ContactSpecialFields = ContactSpecialFields\n  { csfCurrencySymbol :: Maybe Text -- $currency_symbol\n  , csfState :: Maybe Text -- $state\n  , csfProcessFlow :: Maybe Bool -- $process_flow\n  , csfApproved :: Maybe Bool -- $approved\n  , csfApproval :: Approval  -- $approval\n  , csfEditable :: Maybe Bool -- $editable\n  } deriving (Eq, Show)\n\n-- and so on\n</code></pre>\n\n<p>I need an way to define \"empty\" records of such types, eg:</p>\n\n<pre><code>emptyApproval :: Approval\nemptyApproval = Approval\n  { apDelegate = Nothing\n  , apApprove = Nothing\n  , apReject = Nothing\n  , apResubmit = Nothing\n  }\n</code></pre>\n\n<p>Therefore, I reached out for <code>GHC.Generics</code> and got something working (which is buggy!):</p>\n\n<pre><code>-- These parts seem logically correct to me...\n\nclass GEmptyZohoStructure f where\n  gEmptyZohoStructure :: f p\n\ninstance (GEmptyZohoStructure f, GEmptyZohoStructure g) =&gt; GEmptyZohoStructure (f :*: g) where\n  gEmptyZohoStructure = (gEmptyZohoStructure :: f p) :*: (gEmptyZohoStructure :: g p)\n\ninstance GEmptyZohoStructure Maybe where\n  gEmptyZohoStructure = Nothing\n\nclass EmptyZohoStructure a where\n  emptyZohoStructure :: a\n\n  default emptyZohoStructure :: (Generic a, (GEmptyZohoStructure (Rep a))) =&gt; a\n  emptyZohoStructure = GHC.Generics.to gEmptyZohoStructure\n\n-- Whereas these parts are random type-class instances that I've written, just \n-- to get the code to compile.\n\ninstance (GEmptyZohoStructure f) =&gt; GEmptyZohoStructure (M1 i t f) where\n  gEmptyZohoStructure = (gEmptyZohoStructure :: f p)\n\ninstance (GEmptyZohoStructure f) =&gt; GEmptyZohoStructure (K1 i (f p)) where\n  gEmptyZohoStructure = gEmptyZohoStructure\n\ninstance EmptyZohoStructure Approval\n</code></pre>\n\n<p>while the code compiles, the following (understandably) results in a stack overflow during runtime:</p>\n\n<pre><code>ghci&gt; emptyZohoStructure  :: Approval\n*** Exception: stack overflow\n</code></pre>\n\n<p>I was following the <code>encode</code> tutorial given at <a href=\"https://www.stackage.org/haddock/lts-12.1/base-4.11.1.0/GHC-Generics.html#g:12\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-12.1/base-4.11.1.0/GHC-Generics.html#g:12</a> , where due to the argument being passed to the <code>encode</code> function, it allows one the opportunity to unwrap the <code>M1</code> / <code>K1</code> constructor and build some meaningful recursion hierarchy. <strong>How do I write generic for <code>M1</code> and <code>K1</code> for my use-case (where the generic function doesn't really have any arguments)?</strong> </p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1577609067, "post_id": 59517539, "comment_id": 105207120, "body": "Looks like a bug to me."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 2, "creation_date": 1577632095, "post_id": 59517539, "comment_id": 105212144, "body": "Sounds like you are on older ghc (possibly ghc-8.2), cause ghc-8.4 onward I haven&#39;t seen this particular issue. So, my question is what&#39;s your ghc version?"}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1577640347, "post_id": 59517539, "comment_id": 105214221, "body": "@lehins - good point!  This is with ghc-8.6.5 ."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1577642472, "post_id": 59517539, "comment_id": 105214772, "body": "@user3416536 From your description it does look like it is a ghc bug, but you don&#39;t paint the full picture:  * what is the definition of <code>unsnoc</code>? * where <code>||&gt;</code> comes from and what is its definition? * what is the actual error and the reported missing pattern?  In any case, have you tried replacing the unicode character with some common ascii allowed with infix, I would not be surprised that unicode is tripping something up up. Also could be worth switching to a regular function instead of an infix operator, just as an extra debugging step."}], "owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 0, "score": 9, "last_activity_date": 1577604064, "creation_date": 1577604064, "question_id": 59517539, "link": "https://stackoverflow.com/questions/59517539/haskell-patternsynonyms-complete-pragma-and-view-patterns", "title": "Haskell, PatternSynonyms, COMPLETE pragma, and View Patterns", "body": "<p>I have a class, <code>SeqNE</code>, representing non-empty Sequences:</p>\n\n<pre><code>newtype SeqNE \u03b1 = SeqNE { unSeqNE \u2237 NonNull (Seq \u03b1) }\n  deriving Eq\n\ntype instance Element (SeqNE \u03b1) = \u03b1\n</code></pre>\n\n<p>where <code>NonNull</code> is from Michael Snoyman's <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.15.1/docs/Data-NonNull.html\" rel=\"noreferrer\">mono-traversable</a> package, and <code>Sequence</code> is from the <a href=\"https://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Sequence.html\" rel=\"noreferrer\">containers</a> package.</p>\n\n<p>I have a (unicode) pattern to (de)compose <code>SeqNE</code> instances:</p>\n\n<pre><code>infixl 5 :\u2af8\n{- | (de)compose a `SeqNE \u03b1` from a `Seq \u03b1` and an `\u03b1` (rightwards) -}\npattern (:\u2af8) \u2237 Seq \u03b1 -&gt; \u03b1 -&gt; SeqNE \u03b1\npattern xs :\u2af8 x &lt;- (unsnoc -&gt; (xs,x))\n  where xs :\u2af8 x = xs ||&gt; x\n{-# COMPLETE (:\u2af8) #-}\n</code></pre>\n\n<p>where <code>unsnoc</code> has type <code>unsnoc \u2237 SeqNE \u03b1 \u2192 (Seq \u03b1, \u03b1)</code>.</p>\n\n<p>As shown, I have used the <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/pattern-synonyms/complete-sigs\" rel=\"noreferrer\"><code>COMPLETE</code> pragma</a> to tell GHC that this pattern is total.\nHowever, in practice, if I use such a pattern match within a view pattern (e.g., <code>foo</code>, below); then I am rewarded with a \"Pattern match(es) are non-exhaustive\" warning; whereas, if I use what I believe is morally the same code, but within an explicit case statement (e.g., <code>bar</code>, below), then the warning is elided (I have tested removing the <code>COMPLETE</code> pragma, and as expected, I then get the warning with <code>bar</code> also).</p>\n\n<pre><code>foo \u2237 NonEmpty.NonEmpty \u03b1 \u2192 Seq \u03b1\nfoo (fromNonEmpty \u2192 xs :\u2af8 _) = xs\n\nbar \u2237 NonEmpty.NonEmpty \u03b1 \u2192 Seq \u03b1\nbar ss = case fromNonEmpty ss of\n           xs :\u2af8 _ \u2192 xs\n</code></pre>\n\n<p>I have found a similar question <a href=\"https://stackoverflow.com/questions/58401723/complete-pragma-doesnt-prevent-incomplete-patterns-warning\">here</a>, but the answer to that was that <code>COMPLETE</code> is ineffectual for type /classes/; I'm not using a typeclass here.</p>\n\n<p>So I think this may be a legit. bug with GHC, <code>COMPLETE</code> pragmas. vs. view-patterns - but I'd like a second (and third) opinion, as I tend to be wrong a lot more often than GHC is...</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 27886, "user_id": 3337070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8974b88c4bd084f5928ad99d4e8033da?s=128&d=identicon&r=PG", "display_name": "sshashank124", "link": "https://stackoverflow.com/users/3337070/sshashank124"}, "edited": false, "score": 0, "creation_date": 1577598844, "post_id": 59517152, "comment_id": 105205678, "body": "<a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions#packageimports\" rel=\"nofollow noreferrer\">schoolofhaskell.com/school/to-infinity-and-beyond/&hellip;</a>"}, {"owner": {"reputation": 233, "user_id": 8479490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w1cgq.png?s=128&g=1", "display_name": "stone-zeng", "link": "https://stackoverflow.com/users/8479490/stone-zeng"}, "reply_to_user": {"reputation": 27886, "user_id": 3337070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8974b88c4bd084f5928ad99d4e8033da?s=128&d=identicon&r=PG", "display_name": "sshashank124", "link": "https://stackoverflow.com/users/3337070/sshashank124"}, "edited": false, "score": 0, "creation_date": 1577602975, "post_id": 59517152, "comment_id": 105206221, "body": "I have tried <code>import qualified &quot;regex-compat-tdfa&quot; Text.Regex as Regex</code>, but it still doesn&#39;t work."}, {"owner": {"reputation": 27886, "user_id": 3337070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8974b88c4bd084f5928ad99d4e8033da?s=128&d=identicon&r=PG", "display_name": "sshashank124", "link": "https://stackoverflow.com/users/3337070/sshashank124"}, "edited": false, "score": 0, "creation_date": 1577603064, "post_id": 59517152, "comment_id": 105206229, "body": "What do you mean it doesn&#39;t work? Doesn&#39;t work how?"}, {"owner": {"reputation": 233, "user_id": 8479490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w1cgq.png?s=128&g=1", "display_name": "stone-zeng", "link": "https://stackoverflow.com/users/8479490/stone-zeng"}, "reply_to_user": {"reputation": 27886, "user_id": 3337070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8974b88c4bd084f5928ad99d4e8033da?s=128&d=identicon&r=PG", "display_name": "sshashank124", "link": "https://stackoverflow.com/users/3337070/sshashank124"}, "edited": false, "score": 0, "creation_date": 1577603744, "post_id": 59517152, "comment_id": 105206347, "body": "@sshashank124 For example <code>(\\w+?)</code> will lead to an exception <code>unexpected &quot;?&quot; expecting empty () or anchor ^ or $, an atom, &quot;|&quot; or &quot;)&quot;</code>, which should not occur if <code>regex-compat-tdfa</code> were loaded."}, {"owner": {"reputation": 233, "user_id": 8479490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w1cgq.png?s=128&g=1", "display_name": "stone-zeng", "link": "https://stackoverflow.com/users/8479490/stone-zeng"}, "reply_to_user": {"reputation": 27886, "user_id": 3337070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8974b88c4bd084f5928ad99d4e8033da?s=128&d=identicon&r=PG", "display_name": "sshashank124", "link": "https://stackoverflow.com/users/3337070/sshashank124"}, "edited": false, "score": 0, "creation_date": 1577604109, "post_id": 59517152, "comment_id": 105206409, "body": "And more explicitly, the callstack shows <code>error, called at lib&#47;Text&#47;Regex&#47;TDFA&#47;Common.hs:29:3 in rgx-tdf-1.3.1.0-e1a6a9ce:Text.Regex.TDFA.Common</code>."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1577636277, "post_id": 59517152, "comment_id": 105213133, "body": "The call stack does point at <code>TDFA</code>"}, {"owner": {"reputation": 233, "user_id": 8479490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w1cgq.png?s=128&g=1", "display_name": "stone-zeng", "link": "https://stackoverflow.com/users/8479490/stone-zeng"}, "edited": false, "score": 0, "creation_date": 1577642389, "post_id": 59517152, "comment_id": 105214747, "body": "Oh I see, the real problem is that I always use the regex syntax incorrectly (it seems <code>regex-tdfa</code> does not support <code>(\\w+?)</code>)."}], "owner": {"reputation": 233, "user_id": 8479490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w1cgq.png?s=128&g=1", "display_name": "stone-zeng", "link": "https://stackoverflow.com/users/8479490/stone-zeng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "closed_date": 1577642217, "answer_count": 0, "score": 0, "last_activity_date": 1577598709, "creation_date": 1577598709, "question_id": 59517152, "link": "https://stackoverflow.com/questions/59517152/how-to-use-regex-compat-tdfa-instead-of-regex-compat", "closed_reason": "Duplicate", "title": "How to use regex-compat-tdfa instead of regex-compat", "body": "<p>I need to use regular expression in Haskell, and I find <code>regex-compat-tdfa</code> and <code>regex-compat</code> are two possible choices. The previous one can support Unicode and more regex syntax. Unfortunately, they provide the same interface <code>Text.Regex</code>. So while I hope to use <code>regex-compat-tdfa</code>, GHC actually load <code>regex-compat</code>. I also try to use a <code>.cabal</code> file, but it also doesn't work. Is there any way to force GHC to use <code>regex-compat-tdfa</code>?</p>\n"}, {"tags": ["haskell", "memory-management", "ghc", "thunk"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577576846, "post_id": 59515770, "comment_id": 105203158, "body": "The suspect here is <code>new = ...</code> which is not evaluated until needed because of laziness. Try forcing that before returning the result, as in <code>updateFirst cur val = new `seq` Aggregate new (updateFirst new)</code>. A bang pattern could also work, alternatively. (Maybe more forcing is needed but I&#39;d start from this.)"}, {"owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577576997, "post_id": 59515770, "comment_id": 105203178, "body": "The module which contains the <code>updateFirst</code> is using the <code>Strict</code> extension - my understanding was that it automagically forces all thunks - is that not the case?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577578730, "post_id": 59515770, "comment_id": 105203443, "body": "It could be the case, if that&#39;s also the module which defines <code>Aggregate</code>. Still, I&#39;d try to test it."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1577580712, "post_id": 59515770, "comment_id": 105203699, "body": "@DanielLovasko &quot;my understanding was that it automagically forces all thunks &quot; The <code>Strict</code> extension is humbler than that. It&#39;s equivalent to making the fields of all datatypes defined within the module strict. And a field being strict simply means that, whenever the value of the datatype is evaluated to WHNF\u2014say, as the accumulator of a <code>foldl&#39;</code>\u2014the field will also be evaluated to WHNF. Notice that, in particular, <code>Maybe</code> doesn&#39;t become strict,  as it is defined elsewhere. Perhaps that&#39;s part of the problem. Try forcing the value inside the <code>Just</code>, not only the outer <code>Maybe</code>."}, {"owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 1, "creation_date": 1577585216, "post_id": 59515770, "comment_id": 105204213, "body": "Are there any tools apart from a pencil and a paper that would help me find which expression is causing the thunk creation? Or rather, is there a way for GHC to print all the thunks that it creates? As for <code>Strict</code>, I think that you are describing <code>StrictData</code> which makes the types strict, but the pure <code>Strict</code> extension should reach function arguments as well."}, {"owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1577588221, "post_id": 59515770, "comment_id": 105204558, "body": "@danidiaz - you were right - forcing the value within the <code>Just</code> constructor with <code>BangPatterns</code> was indeed the key to fixing the memory leak. Thanks! Would you like to post your comment as an answer so that I can accept it please?"}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1577607974, "post_id": 59517762, "comment_id": 105206945, "body": "Related: <a href=\"https://stackoverflow.com/questions/23280936/how-do-experienced-haskell-developers-approach-laziness-at-design-time\" title=\"how do experienced haskell developers approach laziness at design time\">stackoverflow.com/questions/23280936/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1577629239, "last_edit_date": 1577629239, "creation_date": 1577606658, "answer_id": 59517762, "question_id": 59515770, "link": "https://stackoverflow.com/questions/59515770/memory-usage-oddity-memory-leak/59517762#59517762", "title": "Memory usage oddity (memory leak?)", "body": "<p>Strictness annotations in Haskell are <a href=\"https://apfelmus.nfshost.com/blog/2013/08/21-space-invariants.html\" rel=\"nofollow noreferrer\">\"relational\"</a> so to speak. They say that something must be evaluated to WHNF (<a href=\"https://wiki.haskell.org/Weak_head_normal_form\" rel=\"nofollow noreferrer\">weak head normal form</a>) whenever something else is evaluated to WHNF. </p>\n\n<p>For function arguments, it means that a function argument will be evaluated to WHNF before the function application itself is evaluated to WHNF.</p>\n\n<p>For strict fields, it means the field will be evaluated to WHNF whenever the containing value is evaluated to WHNF. This is useful for maintaining the \"chain of strictness\" in datatypes that serve as accumulators (for example a datatype working as the accumulator of a <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-List.html#v:foldl-39-\" rel=\"nofollow noreferrer\"><code>foldl'</code></a>). Otherwise, thunks can hide behind lazy fields even as the containing value remains in WHNF, and cause a space leak. In particular, tuples don't have strict components, and are a common source of space leaks in accumulators. </p>\n\n<p><code>Maybe</code> also isn't strict on the value contained in the <code>Just</code> constructor. In fact, this was the cause of the problem. The value inside the <code>Just</code> was never forced during the course of the <code>foldl'</code>, and thunks accumulated there.</p>\n\n<p>Why didn't <a href=\"https://downloads.haskell.org/ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=strictdata#strict-by-default-pattern-bindings\" rel=\"nofollow noreferrer\"><code>Strict</code></a> prevent the problem? Because it only affects function and datatype definitions in the current module, and <code>Maybe</code> was defined elsewhere. The solution is to manually force the value inside the <code>Just</code> at each iteration, or perhaps define your own <a href=\"http://hackage.haskell.org/package/strict-0.3.2/docs/Data-Strict-Maybe.html\" rel=\"nofollow noreferrer\">\"strict <code>Maybe</code>\"</a>.</p>\n"}], "owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 59517762, "answer_count": 1, "score": 1, "last_activity_date": 1577629239, "creation_date": 1577575934, "last_edit_date": 1577576681, "question_id": 59515770, "link": "https://stackoverflow.com/questions/59515770/memory-usage-oddity-memory-leak", "title": "Memory usage oddity (memory leak?)", "body": "<p>I have the following type and two relevant functions that I intend to measure as a part of a large list fold:</p>\n\n<p>Type and access functions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Aggregate a = Aggregate (Maybe a) (a -&gt; Aggregate a)\n\nget :: Aggregate a -&gt; Maybe a\nget (Aggregate get' _) = get'\n\nput :: Aggregate a -&gt; a -&gt; Aggregate a\nput (Aggregate _ put') = put'\n</code></pre>\n\n<p>First function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>updateFirst :: Maybe a -&gt; a -&gt; Aggregate a\nupdateFirst cur val = Aggregate new (updateFirst new)\n  where new = mplus cur (Just val)\n\nfirst :: Aggregate a\nfirst = Aggregate Nothing (updateFirst Nothing)\n</code></pre>\n\n<p>Second function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>updateMinimum :: Ord a =&gt; Maybe a -&gt; a -&gt; Aggregate a\nupdateMinimum cur val = Aggregate new (updateMinimum new)\n  where new = min &lt;$&gt; (mplus cur (Just val)) &lt;*&gt; Just val\n\nminimum :: Ord a =&gt; Aggregate a\nminimum = Aggregate Nothing (updateMinimum Nothing)\n</code></pre>\n\n<p>The functions are written in a way that the memory should be constant. Therefore, I have opted in to use the <code>Strict</code> language extension in GHC, which forces the thunks to be evaluated. The <code>Weigh</code> library was used to perform the allocation measurements:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>test :: A.Aggregate Double -&gt; Int -&gt; Maybe Double\ntest agg len = A.get $ F.foldl' A.put agg (take len $ iterate (+0.3) 2.0)\n\ntestGroup :: String -&gt; A.Aggregate Double -&gt; Weigh ()\ntestGroup name agg = sequence_ $ map (\\cnt -&gt; func (str cnt) (test agg) cnt) counts\n  where\n    counts  = map (10^) [0 .. 6]\n    str cnt = name ++ (show cnt)\n\nmain :: IO ()\nmain =\n  mainWith\n    (do setColumns [Case, Allocated, Max, GCs]\n        testGroup \"fst\" A.first\n        testGroup \"min\" A.minimum\n    )\n</code></pre>\n\n<p>The <code>Weigh</code> output is as follows:</p>\n\n<pre><code>Case          Allocated          Max  GCs\nfst1                304           96    0\nfst10             2,248           96    0\nfst100           21,688           96    0\nfst1000         216,088           96    0\nfst10000      2,160,088           96    2\nfst100000    21,600,088           96   20\nfst1000000  216,000,088           96  207\nmin1                552           96    0\nmin10             4,728           96    0\nmin100           46,488           96    0\nmin1000         464,088           96    0\nmin10000      4,967,768           96    4\nmin100000    49,709,656    6,537,712   44\nmin1000000  497,226,840  103,345,512  445\n</code></pre>\n\n<p>Why does GHC suddenly allocate way more memory in the inputs of size 10^5 and 10^6? My GHC version is <code>8.4.4</code>. </p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 12615021, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-H8BzmWRpFlM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdUq9pzEoWQ7eiXabF9pyyk7Jyk_w/photo.jpg?sz=128", "display_name": "Haskell bit", "link": "https://stackoverflow.com/users/12615021/haskell-bit"}, "edited": false, "score": 0, "creation_date": 1577736576, "post_id": 59514794, "comment_id": 105242183, "body": "Really robust answer, thank you. I gonna improve my comprehension using tutorial referred by you."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1577566591, "creation_date": 1577566591, "answer_id": 59514794, "question_id": 59513494, "link": "https://stackoverflow.com/questions/59513494/how-to-block-inconsistent-floating-point-inputs-using-haskell-parsec/59514794#59514794", "title": "How to block inconsistent floating point inputs using Haskell Parsec?", "body": "<p>As a general rule, Parsec parsers <strong>should</strong> be written to consume a valid prefix of the input stream and stop at the first character they don't recognize.</p>\n\n<p>So, the string <code>\"123h.578\"</code> should be successfully parsed by <code>fp_number</code> or <code>number</code> because the prefix <code>\"123\"</code> is acceptable input for those parsers.  So, your existing parsers <code>fp_number</code> and <code>number</code> have the correct behavior:</p>\n\n<pre><code>&gt; parseTest fp_number \"123h.578\"\n123.0      -- this is correct\n&gt; parseTest number \"123h.578\"\n123        -- this is also correct\n</code></pre>\n\n<p>Checking for this invalid <code>h</code> character should take place at a higher level.  Normally, you will have a top-level parser that tries to parse the entire stream and uses the <code>eof</code> parser to ensure that no unparseable characters remain.  For example, the parser:</p>\n\n<pre><code>fp_expression :: Parser Double\nfp_expression =\n  (try fp_addition &lt;|&gt; fp_number) &lt;* eof\n</code></pre>\n\n<p>will parse these:</p>\n\n<pre><code>&gt; parseTest fp_expression \"123+0.578\"\n123.578\n&gt; parseTest fp_expression \"123.578\"\n123.578\n</code></pre>\n\n<p>while rejecting your other examples:</p>\n\n<pre><code>&gt; parseTest fp_expression \"123h.578\"\nparse error at (line 1, column 4):\nunexpected 'h'\nexpecting \".\" or end of input\n&gt; parseTest fp_expression \"600.w57\"\nparse error at (line 1, column 5):\nunexpected \"w\"\n</code></pre>\n\n<p>You should not need an explicit <code>isValidInput</code> function.  If you were to define one, it would probably be implemented by running a parser like <code>fp_expression</code> to see if it does or doesn't succeed in parsing the entire stream.</p>\n\n<p>Also, you might find it helpful to study <a href=\"http://jakewheat.github.io/intro_to_parsing/\" rel=\"nofollow noreferrer\">this tutorial</a>.  Working through the chapter on \"Very simple expression parsing\" will help you quite a bit in learning the far-from-obvious basics of writing this kind of parser. </p>\n"}], "owner": {"reputation": 141, "user_id": 12615021, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-H8BzmWRpFlM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdUq9pzEoWQ7eiXabF9pyyk7Jyk_w/photo.jpg?sz=128", "display_name": "Haskell bit", "link": "https://stackoverflow.com/users/12615021/haskell-bit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 59514794, "answer_count": 1, "score": 1, "last_activity_date": 1577566591, "creation_date": 1577555986, "question_id": 59513494, "link": "https://stackoverflow.com/questions/59513494/how-to-block-inconsistent-floating-point-inputs-using-haskell-parsec", "title": "How to block inconsistent floating point inputs using Haskell Parsec?", "body": "<p>I'm assigned to make a rather simple calculator parser using Haskell Parser Combinators (namely, by importing Parsec.Text). This parser needs to operate both over integer and floating point inputs. There is an essential code to introduce into the matter of what I'm looking for:</p>\n\n<pre><code>import Text.Parsec hiding(digit)\nimport Data.Functor\n\ntype Parser a = Parsec String () a\n\ndigit :: Parser Char\ndigit = oneOf ['0'..'9']\n\nnumber :: Parser Integer\nnumber = read &lt;$&gt; many1 digit\n\nfp_char :: Parser String \nfp_char = many1 digit\n\nfp_number :: Parser Double\nfp_number = read &lt;$&gt; parser where\n    parser = (++) &lt;$&gt; fp_char &lt;*&gt; (option \"\" $ (:) &lt;$&gt; char '.' &lt;*&gt; fp_char)   \n\naddition :: Parser Integer\naddition = do\n    lhv &lt;- number\n    spaces\n    char '+'\n    spaces\n    rhv &lt;- number\n    return $ lhv + rhv\n\nfp_addition :: Parser Double\naddition = do\n    lhv &lt;- fp_number\n    spaces\n    char '+'\n    spaces\n    rhv &lt;- fp_number\n    return $ lhv + rhv\n</code></pre>\n\n<p>So, there is a case I'm stumbled at: how to block fp input like instances here:</p>\n\n<pre><code>\"123h.578\" \"600.w57\"\n</code></pre>\n\n<p>Both to be considered as error triggers, but in the code above it turns out to accepting a part of false input: in fact parser casts away a wrong character like a letter once occurring it, following characters are eiminated too. So, the problem appears as same or similar inputs remain valid input data, even though it goes partially. My solution has to do with such a function:</p>\n\n<pre><code>isValidInput :: Parser String -&gt; Bool\nisValidInput (x:xs) = if x `elem` ['0'..'9'] then isValidInput xs else False\n</code></pre>\n\n<p>It doesn't work due to an inappropriate type resulted from <code>isValidInput</code>. What's more, I miss understanding how to use this auxiliary code adding it to core calculation functions, let say to fp_addition given here.       </p>\n"}, {"tags": ["haskell", "postgresql-simple"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577539939, "post_id": 59510913, "comment_id": 105194447, "body": "I don&#39;t know anything about this library, but I would expect that <code>?</code> placeholders in queries are replaced with proper escaped and quoted strings to prevent SQL injection."}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1577615841, "creation_date": 1577615841, "answer_id": 59518638, "question_id": 59510913, "link": "https://stackoverflow.com/questions/59510913/sqlerror-due-to-single-quotes-around-parameterized-value-for-create-database/59518638#59518638", "title": "SqlError due to single quotes around parameterized value for `CREATE DATABASE`", "body": "<p>According to <a href=\"https://nikita-volkov.github.io/hasql-benchmarks/\" rel=\"nofollow noreferrer\">https://nikita-volkov.github.io/hasql-benchmarks/</a></p>\n\n<blockquote>\n  <p>Unlike \u201cpostgresql-simple\u201d, the library utilizes prepared statements,\n  which allows the database to parse the SQL statements only once per\n  connection.</p>\n</blockquote>\n\n<p>So I wrongly assumed postgresql-simple would be using prepared statements, and hence it'll add single quotes around seemingly any string value.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577615841, "creation_date": 1577536383, "last_edit_date": 1577536745, "question_id": 59510913, "link": "https://stackoverflow.com/questions/59510913/sqlerror-due-to-single-quotes-around-parameterized-value-for-create-database", "title": "SqlError due to single quotes around parameterized value for `CREATE DATABASE`", "body": "<p>I'm using the \"postgresql-simple\" library and running into a SqlError with the following:</p>\n\n<pre><code>_ &lt;- execute con \"CREATE DATABASE ?\" (Only (\"example\" :: String))\n</code></pre>\n\n<p>Results in an error of:</p>\n\n<pre><code>SqlError {sqlState = \"42601\", sqlExecStatus = FatalError, sqlErrorMsg = \"syntax error at or near \\\"'example'\\\"\", sqlErrorDetail = \"\", sqlErrorHint = \"\"}\n</code></pre>\n\n<p>With the db logs being:</p>\n\n<pre><code>[postgres-db-b6f75998b-5qnnx db] 2019-12-28 12:28:40.062 UTC [100] ERROR:  syntax error at or near \"'example'\" at character 17 \n[postgres-db-b6f75998b-5qnnx db] 2019-12-28 12:28:40.062 UTC [100] STATEMENT:  CREATE DATABASE 'example' \n</code></pre>\n\n<p>Why are single quotes being added around the value? </p>\n\n<p>Is this possibly due to postgresql-simple not using prepared statements?</p>\n"}, {"tags": ["haskell", "f#"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577534986, "post_id": 59510695, "comment_id": 105193406, "body": "I don&#39;t know F#, but having just googled for it and found <a href=\"https://theburningmonk.com/2011/09/fsharp-pipe-forward-and-pipe-backward/\" rel=\"nofollow noreferrer\">this</a>, it appears that it is indeed identical and has a similar main use in avoiding parentheses. (I note that Elm also has both forward and backward pipe operators, and in that language I can confirm the <code>&lt;|</code> operator is identical to Haskell&#39;s <code>$</code>.)"}, {"owner": {"reputation": 11019, "user_id": 418488, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/625af9d6f5c5062f65a43582b57c041d?s=128&d=identicon&r=PG", "display_name": "Just another metaprogrammer", "link": "https://stackoverflow.com/users/418488/just-another-metaprogrammer"}, "edited": false, "score": 1, "creation_date": 1577556597, "post_id": 59510695, "comment_id": 105198894, "body": "It&#39;s the same idea but IIRC I think Haskell &#180;$` has lower precendence and is right associative to enable mixing of forward and backwards piping. In F# since <code>|&gt;</code> and <code>&lt;|</code> has the same and are both left associative makes <code>&lt;|</code> less useful I think. Also because type inferrence in F# usally flows from top-left to bottom-right from what I have read the idiom is to prefer forward piping. With that said, I do use <code>&lt;|</code> sometimes."}, {"owner": {"reputation": 24134, "user_id": 179081, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/TJ9hg.png?s=128&g=1", "display_name": "Lyndon White", "link": "https://stackoverflow.com/users/179081/lyndon-white"}, "edited": false, "score": 0, "creation_date": 1577560311, "post_id": 59510695, "comment_id": 105199880, "body": "Why not make that an answer?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1599274470, "post_id": 59510812, "comment_id": 112731744, "body": "Haskell got the <code>:</code>/<code>::</code> backwards compared to just about everything else. Oh well."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 10, "last_activity_date": 1577535499, "creation_date": 1577535499, "answer_id": 59510812, "question_id": 59510695, "link": "https://stackoverflow.com/questions/59510695/is-haskells-dollar-operator-and-fs-backwards-pipe-the-same-idea/59510812#59510812", "title": "Is Haskell&#39;s dollar $ operator, and F#&#39;s backwards-pipe &lt;| the same idea?", "body": "<p>Yes \u2014 they are equivalent. I don\u2019t know F#, but in Haskell this operator gets used a lot to simplify long parenthesised expressions: the precedence of <code>$</code> is lower than that of any other operator, so e.g. <code>f x + y</code> gets interpreted as <code>(f x) + y</code>, but <code>f $ x + y</code> gets interpreted as <code>f (x + y)</code>. Similarly a long chain of <code>f (g (h x))</code> can be written as <code>f $ g $ h x</code>.</p>\n\n<p>Looking through a <a href=\"https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/symbol-and-operator-reference/\" rel=\"noreferrer\">list of F# operators</a>, here\u2019s some more correspondences which could help you:</p>\n\n<ul>\n<li>F# <code>f &lt;&lt; g</code> \u2194 Haskell <code>f . g</code></li>\n<li>F# <code>::</code> \u2194 Haskell <code>:</code>, while F# <code>:</code> \u2194 Haskell <code>::</code></li>\n<li>F# <code>&lt;&gt;</code> \u2194 Haskell <code>/=</code></li>\n<li>F# <code>|&gt;</code> and <code>&gt;&gt;</code> don\u2019t have any corresponding operators in <code>Prelude</code> \u2014 I wish they did! But you can use <code>Data.Function.&amp;</code> and <code>Control.Category.&gt;&gt;&gt;</code> to replace them if you want.</li>\n<li>(will add some more if I find any; feel free to comment if anyone has something to add to this list!)</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4258082, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-botytyu_IVU/AAAAAAAAAAI/AAAAAAAAAgM/kE70Y3MIKqs/photo.jpg?sz=128", "display_name": "Alexander Sudarikov", "link": "https://stackoverflow.com/users/4258082/alexander-sudarikov"}, "is_accepted": false, "score": 0, "last_activity_date": 1599263189, "creation_date": 1599263189, "answer_id": 63749147, "question_id": 59510695, "link": "https://stackoverflow.com/questions/59510695/is-haskells-dollar-operator-and-fs-backwards-pipe-the-same-idea/63749147#63749147", "title": "Is Haskell&#39;s dollar $ operator, and F#&#39;s backwards-pipe &lt;| the same idea?", "body": "<p>Haskell allows you to define custom operators.\nF# |&gt; operator can be defined as such:</p>\n<pre><code>(|&gt;) :: a -&gt; (a -&gt; b) -&gt; b\na |&gt; f = f a\n</code></pre>\n<p>F# &lt;|</p>\n<pre><code>(&lt;|) :: (a -&gt; b) -&gt; a -&gt; b\nf &lt;| a = f a\n</code></pre>\n<p>and F# &gt;&gt;</p>\n<pre><code>(&gt;&gt;) :: (a -&gt; b) -&gt; (b -&gt; c) -&gt; (a -&gt; c)\nf &gt;&gt; g = (.) g f\n</code></pre>\n"}], "owner": {"reputation": 24134, "user_id": 179081, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/TJ9hg.png?s=128&g=1", "display_name": "Lyndon White", "link": "https://stackoverflow.com/users/179081/lyndon-white"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 1, "accepted_answer_id": 59510812, "answer_count": 2, "score": 1, "last_activity_date": 1599263189, "creation_date": 1577534452, "question_id": 59510695, "link": "https://stackoverflow.com/questions/59510695/is-haskells-dollar-operator-and-fs-backwards-pipe-the-same-idea", "title": "Is Haskell&#39;s dollar $ operator, and F#&#39;s backwards-pipe &lt;| the same idea?", "body": "<p>Its been years since I used F#,\nand now I am trying to learn a bit of Haskell,\nand spot which ideas I can transfer.</p>\n"}, {"tags": ["haskell", "geometry"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1577534334, "post_id": 59510676, "comment_id": 105193288, "body": "You first work out a mathematical formula when two lines/planes intersect."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1577535646, "post_id": 59510676, "comment_id": 105193517, "body": "To expand on @WillemVanOnsem\u2019s excellent point: once you have a formula, you can rewrite it as a Haskell function <code>linesIntersection :: Line -&gt; Line -&gt; Point</code> (or something along those lines). You can then call this function from the rest of your program."}], "answers": [{"tags": [], "owner": {"reputation": 45496, "user_id": 436560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/2GESV.jpg?s=128&g=1", "display_name": "Lajos Arpad", "link": "https://stackoverflow.com/users/436560/lajos-arpad"}, "is_accepted": false, "score": 2, "last_activity_date": 1577541372, "last_edit_date": 1577541372, "creation_date": 1577538863, "answer_id": 59511220, "question_id": 59510676, "link": "https://stackoverflow.com/questions/59510676/intersection-of-two-lines-and-two-planes/59511220#59511220", "title": "Intersection of two lines and two planes", "body": "<p>There are formulas for lines and planes in 3 dimensions.</p>\n\n<h1>Line</h1>\n\n<p><a href=\"https://i.stack.imgur.com/WW7dv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WW7dv.png\" alt=\"enter image description here\"></a></p>\n\n<p>If you have a v vector parallel with the L line (hopefully passing the O(0, 0, 0) point) and v = (a, b, c) and we also know of a P point on L where P = (x0, y0, z0) then:</p>\n\n<p><strong>L &lt;=> (x - x0) / a = (y - y0) / b = (z - z0) / c</strong></p>\n\n<h1>Plane</h1>\n\n<p><a href=\"https://i.stack.imgur.com/neMVE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/neMVE.png\" alt=\"enter image description here\"></a></p>\n\n<p>If we want to define a Pl plane, then we need a point (x0, y0, z0) on the plane and a perpendicular vector to the plane, v = (a, b, c) to do so. The equation is now:</p>\n\n<p><strong>Pl &lt;=> a * x + b * y + c * z + d,</strong></p>\n\n<p>where</p>\n\n<p><strong>d = -(a * x0 + b * y0 + z * z0)</strong></p>\n\n<h1>Haskell functions</h1>\n\n<p>Now that you know what the functions are, you only need to implement them:</p>\n\n<p><a href=\"https://www.tutorialspoint.com/haskell/haskell_functions.htm\" rel=\"nofollow noreferrer\">https://www.tutorialspoint.com/haskell/haskell_functions.htm</a></p>\n\n<p>Using the information you have learned above you should be able to implement it.</p>\n\n<h1>Intersections of lines and planes</h1>\n\n<p>The intersection of two metrical formulas is the set of points which fulfills both the equations. In case of lines the intersection is a point in most cases. If the two lines are the same, then their intersection is themselves.</p>\n\n<p>The intersection of two planes is a line in most cases. It can also be a plane if we intersect a plane with itself.</p>\n\n<p>You will need to program the evaluation of a system of equations, having two equations as input and an equation/point as output.</p>\n\n<hr>\n\n<p>Illustrations were inspired from <a href=\"https://brilliant.org\" rel=\"nofollow noreferrer\">https://brilliant.org</a></p>\n"}], "owner": {"reputation": 71, "user_id": 12343906, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CImMvX3gej8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd4IEhoUpJFCPA8KHrW-xV5-axIVw/photo.jpg?sz=128", "display_name": "device", "link": "https://stackoverflow.com/users/12343906/device"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "closed_date": 1577966445, "answer_count": 1, "score": -1, "last_activity_date": 1577541372, "creation_date": 1577534277, "last_edit_date": 1577537824, "question_id": 59510676, "link": "https://stackoverflow.com/questions/59510676/intersection-of-two-lines-and-two-planes", "closed_reason": "Needs more focus", "title": "Intersection of two lines and two planes", "body": "<p>I am trying to implement intersection of two lines and intersection of two planes in Haskell without using Haskell library. How should I start doing it? Any template or implementation would be helpful for learning. I am a beginner in Haskell</p>\n"}, {"tags": ["scala", "haskell", "types", "algebraic-data-types"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 8, "creation_date": 1577522228, "post_id": 59509294, "comment_id": 105190818, "body": "Exponentiation is also represented in ADTs, via function types <code>A -&gt; B</code>. (PS I&#39;m coming to this question from a Haskell background. I don&#39;t know Scala at all.)"}, {"owner": {"reputation": 30038, "user_id": 16673, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2bd7c0e93b52c224e284d18ac34752b8?s=128&d=identicon&r=PG", "display_name": "Suma", "link": "https://stackoverflow.com/users/16673/suma"}, "edited": false, "score": 0, "creation_date": 1577612180, "post_id": 59509294, "comment_id": 105207612, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/44991429/what-is-an-algebraic-data-type-adt\">What is an Algebraic Data Type (ADT)?</a>"}, {"owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "reply_to_user": {"reputation": 30038, "user_id": 16673, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2bd7c0e93b52c224e284d18ac34752b8?s=128&d=identicon&r=PG", "display_name": "Suma", "link": "https://stackoverflow.com/users/16673/suma"}, "edited": false, "score": 0, "creation_date": 1577612756, "post_id": 59509294, "comment_id": 105207729, "body": "@Suma - thanks for the link, it has a similar, but broader question. The answeres provided here are specific to non-sum/product algebraic types and their implementation. Also for abbreviation, ADT is usually reserved for abstract data types <a href=\"https://wiki.haskell.org/Abstract_data_type\" rel=\"nofollow noreferrer\">wiki.haskell.org/Abstract_data_type</a>, not algebraic data types."}], "answers": [{"comments": [{"owner": {"reputation": 34814, "user_id": 5249621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lLtZV.jpg?s=128&g=1", "display_name": "Dmytro Mitin", "link": "https://stackoverflow.com/users/5249621/dmytro-mitin"}, "edited": false, "score": 4, "creation_date": 1577531803, "post_id": 59509403, "comment_id": 105192758, "body": "I guess <code>(A + B)^C = A^C &#215; B^C</code> is incorrect. Do you mean <code>(A &#215; B)^C = A^C &#215; B^C</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 34814, "user_id": 5249621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lLtZV.jpg?s=128&g=1", "display_name": "Dmytro Mitin", "link": "https://stackoverflow.com/users/5249621/dmytro-mitin"}, "edited": false, "score": 0, "creation_date": 1577548104, "post_id": 59509403, "comment_id": 105196526, "body": "@DmytroMitin, oops, got mixed up. Fixed it."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 14, "last_activity_date": 1577548044, "last_edit_date": 1577548044, "creation_date": 1577523009, "answer_id": 59509403, "question_id": 59509294, "link": "https://stackoverflow.com/questions/59509294/are-there-algebraic-data-types-outside-of-sum-and-product/59509403#59509403", "title": "Are there algebraic data types outside of sum and product?", "body": "<p>\"Algebraic\" comes from category theory.  Every algebraic data type is an <a href=\"https://en.wikipedia.org/wiki/Initial_algebra\" rel=\"noreferrer\">initial algebra</a> of a functor.  So you could in principle call anything that comes from a functor in this way algebraic, and I think it's quite a large class.</p>\n\n<p>Interpreting \"algebraic\" to mean \"high-school algebra\" (I don't mean to be condescending, that's just <a href=\"http://blog.sigfpe.com/2009/11/memoizing-polymorphic-functions-with.html\" rel=\"noreferrer\">how we refer to it</a>) as you have, there are some nice analogies.</p>\n\n<ul>\n<li>Arbitrary powers, not just integer powers, are closely analogous to function types, that is,  <code>A -&gt; B</code> is analogous to <code>B<sup>A</sup></code>.  In category theory, when you consider a function (\"morphism\") as an object of a category, it's called an <em>exponential object</em>, and the latter notation is used.  For fun, see if you can prove the law <code>C<sup>A+B</sup> = C<sup>A</sup> &times; C<sup>B</sup></code> by writing a bijection between the corresponding types.</li>\n<li>Division is analogous to <em>quotient types</em>, which is a fascinating area of research that reaches into things as hott and trendy as homotopy type theory.  The analogy of quotients to division is not as strong as product types with multiplication, as you have to divide by an equivalence relation.</li>\n<li>At this rate, you would expect subtraction to have some beautiful analogy to go with it, but alas I know of none.  Dan Piponi has explored it a little through <a href=\"http://blog.sigfpe.com/2007/09/type-of-distinct-pairs.html\" rel=\"noreferrer\">the antidiagonal</a>, but it is far from a general analogy.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 3, "last_activity_date": 1577603874, "last_edit_date": 1577603874, "creation_date": 1577566639, "answer_id": 59514801, "question_id": 59509294, "link": "https://stackoverflow.com/questions/59509294/are-there-algebraic-data-types-outside-of-sum-and-product/59514801#59514801", "title": "Are there algebraic data types outside of sum and product?", "body": "<p>The conventional answer is as given by @luqui, and I have nothing to add to that. The downside is that whilst you distinguish the alternants of the sum by tag ('constructor' in Haskell), you must access the components of the product by position. For homogeneous components as in a vector/array that's fine; but for typical data structures (record types) you want to access by 'field label' and abstract away the position. Haskell's record/label system a) does a very bad job of that; and b) is so deeply ingrained into the language it's proving almost impossible to improve -- see endless proposals and endless discussions resulting so far in no change.</p>\n\n<p>Then an unconventional answer is <a href=\"https://en.wikipedia.org/wiki/Indexed_family\" rel=\"nofollow noreferrer\">indexed families</a> aka 'indexed sets'. The idea has been developed mostly around the 'Set-Theoretic Data Structures' of D.L.Childs, for example <a href=\"https://en.wikipedia.org/wiki/MICRO_Relational_Database_Management_System\" rel=\"nofollow noreferrer\">this one</a>. Childs'approach got a mention in the seminal paper on the Relational (database) Model <a href=\"https://dl.acm.org/citation.cfm?doid=362384.362685\" rel=\"nofollow noreferrer\">Codd 1970</a>.</p>\n\n<p>The critical feature is that you can use any type to index the collection of components;  the components are heterogeneous; and the compiler supports type-safe access (read and update) both by-component and whole-structure. The components might well be organised positionally within the structure, but that's an implementation detail hidden from the programmer. (Haskell's record system fails on this point.)</p>\n\n<blockquote>\n  <p>Do any programming languages have algebraic data types implemented that are not sum and product types?</p>\n</blockquote>\n\n<p>You might or might not accept that SQL is a programming language. I might but mostly don't accept that SQL 'column names' are an implementation of 'Indexed families'. SQL's columns and rows are far too much oriented to physical layout (and indeed most vendors' SQL still allows positional notation for columns, even though it's been deprecated by the standard). That said, SQL is the nearest you'll find.</p>\n\n<p>There's been a few extensible/anonymous record systems proposed/developed in Haskell (especially HList) or Haskell-like languages (like Ur/web), or even dear old Hugs' <a href=\"https://www.haskell.org/hugs/pages/hugsman/exts.html#sect7.2\" rel=\"nofollow noreferrer\">TRex</a>. (See <a href=\"https://www.semanticscholar.org/paper/A-Polymorphic-Type-System-for-Extensible-Records-Gaster-Jones/710be560f3074f6e6c491c05b6af8b3bcc13b8f0\" rel=\"nofollow noreferrer\">the Gaster &amp; Jones paper</a> for links to other attempts in FP languages.) All of them are limited because they're trying to put lipstick on Haskell's sum-of-product types.</p>\n"}], "owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "accepted_answer_id": 59509403, "answer_count": 2, "score": 7, "last_activity_date": 1577611303, "creation_date": 1577521771, "last_edit_date": 1577611303, "question_id": 59509294, "link": "https://stackoverflow.com/questions/59509294/are-there-algebraic-data-types-outside-of-sum-and-product", "title": "Are there algebraic data types outside of sum and product?", "body": "<p>By most definitons the common or basic algebraic data types in Haskell or Scala are sum and product. Examples: <a href=\"https://github.com/hemanth/functional-programming-jargon#algebraic-data-type\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://nrinaudo.github.io/scala-best-practices/definitions/adt.html\" rel=\"nofollow noreferrer\">2</a>. </p>\n\n<p>Sometimes a definition just says <a href=\"https://wiki.haskell.org/Algebraic_data_type\" rel=\"nofollow noreferrer\">algebraic data types are sum and product</a>, perhaps for simplicity.</p>\n\n<p>However, the definitions leave an impression that other algebraic data types are possible, and sum and product are just the most useful to describe selection or combination of elements.</p>\n\n<p>Given there are subtraction, division, raising to an integer power operations in a basic algebra - is it correct some implementation of other alternative algebraic types in programming is possible, but they are not useful?</p>\n\n<p>Do any programming languages have algebraic data types implemented that are not sum and product types?</p>\n"}, {"tags": ["haskell", "hindley-milner"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1577512820, "post_id": 59508450, "comment_id": 105189502, "body": "Right, I don\u2019t think it\u2019s possible for that expression to be valid in current Haskell."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1577520722, "post_id": 59508450, "comment_id": 105190581, "body": "@Ry why not? Looks valid to me."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1577525478, "post_id": 59508450, "comment_id": 105191449, "body": "@RobinZigmond Unless <code>f</code> is polymorphic and some type arguments are being implicitly added by the compiler, you can&#39;t apply <code>f</code> to itself and have the expression to be typed. You need something like a recursive type to wrap <code>f</code> with, say a <code>newtype</code>. Otherwise you get <code>f :: T -&gt; U</code> and <code>f f</code> triggers <code>T ~ T -&gt; U</code> which is rejected since unification fails in the &quot;occurs check&quot; step, since it would produce an infinite type. (Again, polymorphic functions like <code>f = id</code> can make <code>f f</code> to be typed since each <code>f</code> is actually a different instantiation.)"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1577526404, "post_id": 59508450, "comment_id": 105191634, "body": "@chi - fair point, and I think for some reason I misread the expression as being f (f (x - 1)) which is of course very different. But even as written, as you yourself point out, it works for certain polymorphic functions <code>f</code>, so I would still question the statement that &quot;it\u2019s (not) possible for that expression to be valid in current Haskell&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1577552085, "post_id": 59508522, "comment_id": 105197615, "body": "I disagree with your claim about the <code>Num</code> constraint. For now, set aside the <code>f f</code> business and pretend you&#39;re just calling <code>f (x-1)</code>. Now, <code>f</code> could be <code>abs</code>, which has the <code>Num</code> constraint as you claim, or it could be <code>id</code>, which has no constraints at all, or it could be <code>take</code>, which only accepts an <code>Int</code>."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 0, "last_activity_date": 1577512705, "creation_date": 1577512705, "answer_id": 59508522, "question_id": 59508450, "link": "https://stackoverflow.com/questions/59508450/hindley-milner-type-of-a-function-that-takes-itself-as-an-argument/59508522#59508522", "title": "Hindley-Milner type of a function that takes itself as an argument", "body": "<p>To answer the question you could apply a type-inference algorithm. Going about it informally, you can start by stating that <code>f :: a -&gt; b -&gt; c</code> because it takes two curried arguments. You can also infer the constraint <code>Num b</code> because of <code>x - 1</code>, so <code>f :: Num b =&gt; a -&gt; b -&gt; c</code>. Possibly more if you know what type <code>x</code> is. But that's about it.</p>\n\n<p>For example, the function could be defined as <code>f g x = undefined</code>, in which case both of its arguments are discarded, and the return type does not unify with any of the input types. If <code>f</code> had a function body then you could infer a lot more.</p>\n"}, {"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1577607044, "post_id": 59512932, "comment_id": 105206810, "body": "I think the &quot;not very useful&quot; bit might be decently debatable. Consider, for instance, <code>(.) (.)</code> or <code>fmap fmap</code>."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1577633902, "post_id": 59512932, "comment_id": 105212518, "body": "@David Fair point, but unless you have a <b>really</b> bizarre <code>Num</code> instance in play, I don&#39;t think any of those more useful functions would typecheck with <code>(x-1)</code> after them."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1577578132, "last_edit_date": 1577578132, "creation_date": 1577551942, "answer_id": 59512932, "question_id": 59508450, "link": "https://stackoverflow.com/questions/59508450/hindley-milner-type-of-a-function-that-takes-itself-as-an-argument/59512932#59512932", "title": "Hindley-Milner type of a function that takes itself as an argument", "body": "<p>If an argument to a function is that function itself, then the type would have to be recursive and infinite in a way that's illegal in Haskell. There's one loophole, however: if the function is polymorphic in that argument, then it's fine (although probably not very useful as a function). Two examples of a valid <code>f</code> are <code>id</code> and <code>const id</code> (with either of them, <code>f f (x-1)</code> would just evaluate to <code>x-1</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1577571425, "creation_date": 1577571425, "answer_id": 59515337, "question_id": 59508450, "link": "https://stackoverflow.com/questions/59508450/hindley-milner-type-of-a-function-that-takes-itself-as-an-argument/59515337#59515337", "title": "Hindley-Milner type of a function that takes itself as an argument", "body": "<p>In your title, you ask about the \"Hindley-Milner type\" of <code>f</code>.  In usual parlance, the HM type of an expression is the principal (most general) type inferred for the expression through the formal HM type inference rules applied to a particular context.  So, <code>f</code> has no type without a context, and the expression <code>f f (x-1)</code> doesn't provide enough information about the context to type <code>f</code>.  Contexts can be given \"at the start\" or can develop through the use of lambda or <code>let</code> expressions.  The context that develops will determine if an HM type can be inferred for <code>f</code> and, if so, what that type is.</p>\n\n<p>For example, the larger expression:</p>\n\n<pre><code>let f = \\y -&gt; y in \\x -&gt; f f (x-1)\n</code></pre>\n\n<p>can be typed in the empty context.  Without going through the details, it infers the type <code>forall a. a -&gt; a</code> for <code>f</code> and the type <code>Integer -&gt; Integer</code> for the whole expression, provided the <code>-</code> operator is <code>Integer</code> subtraction.  (The HM type system doesn't have a concept of type classes and constraints, like <code>Num</code>.)  So, here, the HM type for <code>f</code> is <code>forall a. a -&gt; a</code>, and its use in the expression <code>f f (x-1)</code> doesn't really affect its type.  This is typical for expressions where <code>f</code> is introduced with a <code>let</code> expression.  For example, the larger expression:</p>\n\n<pre><code>let f = \\y -&gt; \\z -&gt; y in \\x -&gt; f f (x-1)\n</code></pre>\n\n<p>is also well typed.  The type inferred for <code>f</code> is <code>forall a b. a -&gt; b -&gt; a</code> (which is the obvious type for <code>\\y -&gt; \\z -&gt; y</code> and is not influenced by the rest of the expression).  The overall expression has type <code>forall a b. Integer -&gt; a -&gt; b -&gt; a</code>.</p>\n\n<p>In contrast, if <code>f</code> is introduced through a lambda expression, then things are different, and the expression <code>f f (x-1)</code> does influence the inferred type for <code>f</code>.  For example, the larger expression:</p>\n\n<pre><code>\\f -&gt; \\x -&gt; f f (x-1)\n</code></pre>\n\n<p>is ill-typed in HM and so doesn't infer a type for <code>f</code> or for the expression as a whole.  If the body of the double-lambda is changed, then different HM types can be inferred for <code>f</code> depending on the expression:</p>\n\n<pre><code>\\f -&gt; \\x -&gt; f (f x x) (x-1)   -- f :: Integer -&gt; Integer -&gt; Integer\n\\f -&gt; \\x -&gt; f x + f x         -- f :: forall a. a -&gt; Integer\n</code></pre>\n\n<p>Sooooo...  to sum up, no type is inferred for <code>f</code> from the expression <code>f f (x-1)</code> alone because the context is insufficient.  In a context where <code>f</code> is introduced by a <code>let</code> expression, the type of <code>f</code> will be inferred strictly from the definition of <code>f</code>, and as long as the type is compatible with the expression <code>f f (x-1)</code>, type inference will succeed.  Conversely, in a context where <code>f</code> is introduced by a lambda expression, the expression <code>f f (x-1)</code> is ill-typed, so no type for <code>f</code> <em>can</em> be inferred.</p>\n"}], "owner": {"reputation": 111, "user_id": 790102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe684d254409bcf186f2424552065e49?s=128&d=identicon&r=PG", "display_name": "YOLT", "link": "https://stackoverflow.com/users/790102/yolt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1577578132, "creation_date": 1577511721, "question_id": 59508450, "link": "https://stackoverflow.com/questions/59508450/hindley-milner-type-of-a-function-that-takes-itself-as-an-argument", "title": "Hindley-Milner type of a function that takes itself as an argument", "body": "<p>Suppose you had a function f that would be used as follows:</p>\n\n<pre><code>(f f (x-1)) \n</code></pre>\n\n<p>What can you deduce about the type of f?</p>\n\n<p>It seems to be recursive, ie, f :: (ftype) -> int -> int.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577503051, "post_id": 59507751, "comment_id": 105188311, "body": "Indeed the signature matches, and that is relevant because it means that there is something else that I am looking for in my particular case, even if I don&#39;t know yet why.  The implementation is not what I want, though. By using <code>pure</code>, you&#39;re in some way not using the potential ways in which the function <code>f</code> may look at the monadic aspects of its argument.  Example I worked through coming in next comment."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577503197, "post_id": 59507751, "comment_id": 105188327, "body": "Please put the example in the question itself. Comments are terrible for this."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577503416, "post_id": 59507751, "comment_id": 105188347, "body": "Adding in question."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 1, "creation_date": 1577505126, "post_id": 59507751, "comment_id": 105188537, "body": "Your example is exactly what the second half of my answer addresses. The short answer is: I think it&#39;s way too specific to be generally useful. If I have enough time, I&#39;ll try to expand on why I think that later."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577505992, "post_id": 59507751, "comment_id": 105188646, "body": "You&#39;re right. I read it but didn&#39;t add it up. My specific example is too complicated, specially since this is not my actual problem, rather an obstacle on the way of a potential solution to my problem.  My real problem is that I have a <code>StateT</code> transformation over a custom monad <code>m</code>, and I have a function <code>f :: m a -&gt; m b -&gt; m c</code> that I want to transform into a function <code>ff :: StateT s m a -&gt; StateT s m b -&gt; StateT s m c</code>. If it was a one argument function, <code>hoist</code> would do the job, but, &quot;hoisting twice&quot; will not even close to do the job. Combining <code>(&gt;&gt;=!)</code> with <code>hoist</code> would go around this."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577508722, "post_id": 59507751, "comment_id": 105188967, "body": "I added another section, please check it out."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577510773, "post_id": 59507751, "comment_id": 105189261, "body": "Couldn&#39;t you just do <code>(ra,s&#39;) &lt;- ma</code> and <code>(rb,s&#39;&#39;) &lt;- mb</code>, respectively, and then use <code>ra</code> and <code>rb</code> instead of doing <code>fst</code>? In any case, I do not think your original solution produced double-running effects, because yes, you used <code>ma</code> and <code>mb</code> twice, but in alternative data-flows, never monadically composed with themselves.  In fact that would not happen because the argument types for the monads would not match, and in my case it would make absolutely no sense to be able to &quot;run them twice&quot;.  There is yet another twist to my real example that I forgot, but I&#39;ll leave that out of here."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 2, "creation_date": 1577510910, "post_id": 59507751, "comment_id": 105189280, "body": "No, I can&#39;t use <code>ra</code> and <code>rb</code> instead of <code>fst &lt;$&gt;</code>, because <code>ra</code> and <code>rb</code> are of the wrong type. I would have to use <code>f (pure ra) (pure rb)</code>, in which case we&#39;re right back to the very first simple solution."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 2, "last_activity_date": 1577508705, "last_edit_date": 1577508705, "creation_date": 1577501628, "answer_id": 59507751, "question_id": 59507652, "link": "https://stackoverflow.com/questions/59507652/lifting-a-complete-monadic-action-to-a-transformer-but-for-monad-transforme/59507751#59507751", "title": "Lifting a complete monadic action to a transformer (&gt;&gt;= but for Monad Transformers)", "body": "<p>This can be very trivially implemented via <code>bind</code> + <code>pure</code>. Consider the signature:</p>\n\n<pre><code>(&gt;&gt;=!) :: (Monad m, MonadTrans t) =&gt; t m a -&gt; (m a -&gt; t m a) -&gt; t m a\n</code></pre>\n\n<p>If you use <code>bind</code> on the first argument, you get yourself a naked <code>a</code>, and since <code>m</code> is a <code>Monad</code>, you can trivially turn that naked <code>a</code> into an <code>m a</code> via <code>pure</code>. Therefore, the straightforward implementation would be:</p>\n\n<pre><code>(&gt;&gt;=!) x f = x &gt;&gt;= \\a -&gt; f (pure a)\n</code></pre>\n\n<p>And because of this, <code>bind</code> is always strictly more powerful than your proposed new operation <code>(&gt;&gt;=!)</code>, which is probably the reason it doesn't exist in the standard libraries.</p>\n\n<hr>\n\n<p>I think it may be possible to propose more clever interpretations of <code>(&gt;&gt;=!)</code> for some specific transformers or specific underlying monads. For example, if <code>m ~ []</code>, one might imagine passing the whole list as <code>m a</code> instead of its elements one by one, as my generic implementation above would do. But this sort of thing seems too specific to be implemented in general. </p>\n\n<p>If you have a very specific example of what you're after, and you can show that my above general implementation doesn't work, then perhaps I can provide a better answer.</p>\n\n<hr>\n\n<p>Ok, to address your actual problem from the comments:</p>\n\n<blockquote>\n  <p>I have a function <code>f :: m a -&gt; m b -&gt; m c</code> that I want to transform into a function <code>ff :: StateT s m a -&gt; StateT s m b -&gt; StateT s m c</code></p>\n</blockquote>\n\n<p>I think looking at this example may illustrate the difficulty better. Consider the required signature:</p>\n\n<pre><code>liftish :: Monad m =&gt; (m a -&gt; m b -&gt; m c) -&gt; StateT m a -&gt; StateT m b -&gt; StateT m c\n</code></pre>\n\n<p>Presumably, you'd want to keep the effects of <code>m</code> that are already \"imprinted\" within the <code>StateT m a</code> and <code>StateT m b</code> parameters (because if you don't - my simple solution above will work). To do this, you can \"unwrap\" the <code>StateT</code> via <code>runStateT</code>, which will get you <code>m a</code> and <code>m b</code> respectively, which you can then use to obtain <code>m c</code>:</p>\n\n<pre><code>liftish f sa sb = do\n  s &lt;- get\n  let ma = fst &lt;$&gt; runStateT sa s\n      mb = fst &lt;$&gt; runStateT sb s\n  lift $ f ma mb\n</code></pre>\n\n<p>But here's the trouble: see those <code>fst &lt;$&gt;</code> in there? They are throwing away the resulting state. The call to <code>runStateT sa s</code> results not only in the <code>m a</code> value, but also in the new, modified state. And same goes for <code>runStateT sb s</code>. And presumably you'd want to get the state that resulted from <code>runStateT sa</code> and pass it to <code>runStateT sb</code>, right? Otherwise you're effectively dropping some state mutations.</p>\n\n<p>But you can't get to the resulting state of <code>runStateT sa</code>, because it's \"wrapped\" inside <code>m</code>. Because <code>runStateT</code> returns <code>m (a, s)</code> instead of <code>(m a, s)</code>. If you knew how to \"unwrap\" <code>m</code>, you'd be fine, but you don't. So the only way to get that intermediate state is to run the effects of <code>m</code>:</p>\n\n<pre><code>liftish f sa sb = do\n  s &lt;- get\n  (c, s'') &lt;- lift $ do\n    let ma = runStateT sa s\n    (_, s') &lt;- ma\n    let mb = runStateT sb s'\n    (_, s'') &lt;- mb\n    c &lt;- f (fst &lt;$&gt; ma) (fst &lt;$&gt; mb)\n    pure (c, s'')\n  put s''\n  pure c\n</code></pre>\n\n<p>But now see what happens: I'm using <code>ma</code> and <code>mb</code> twice: once to get the new states out of them, and second time by passing them to <code>f</code>. This may lead to double-running effects or worse.</p>\n\n<p>This problem of \"double execution\" will, I think, show up for any monad transformer, simply because the transformer's effects are always wrapped inside the underlying monad, so you have a choice: either drop the transformer's effects or execute the underlying monad's effects twice.</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577507935, "post_id": 59508098, "comment_id": 105188854, "body": "I&#39;m still processing this answer but just so you know. The monad in the category of monads already exists: <a href=\"http://hackage.haskell.org/package/mmorph-1.1.3/docs/Control-Monad-Morph.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/mmorph-1.1.3/docs/&hellip;</a> (class <code>MMonad</code>)  I have been looking at that all day long, trying to see if it works for me. One reason I didn&#39;t dig in too deep in it is that there is no predefined implementation for <code>StateT</code>, but you just provided one!  The example I wrote may not work because, as you said, it is too strange, but it may well solve my actual real problem, which is not so convoluted, even if larger. Still thinking."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1577508044, "post_id": 59508098, "comment_id": 105188868, "body": "Oh, whoops. If that package doesn&#39;t define an instance then that probably means there is no lawful one. The one here is probably broken, then."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1577508072, "last_edit_date": 1577508072, "creation_date": 1577507079, "answer_id": 59508098, "question_id": 59507652, "link": "https://stackoverflow.com/questions/59507652/lifting-a-complete-monadic-action-to-a-transformer-but-for-monad-transforme/59508098#59508098", "title": "Lifting a complete monadic action to a transformer (&gt;&gt;= but for Monad Transformers)", "body": "<p>I think what you \"really want\" is</p>\n\n<pre><code>(&gt;&gt;&gt;==) :: MyTrans m a -&gt; (forall b. m b -&gt; MyTrans n b) -&gt; MyTrans n a\n-- (=&lt;&lt;) = flip (&gt;&gt;=) is nicer to think about, because it shows that it's a form of function application\n-- so let's think about\n(==&lt;&lt;&lt;) :: (forall a. m b -&gt; MyTrans n b) -&gt; (forall a. MyTrans m a -&gt; MyTrans n a)\n-- hmm...\ntype (~&gt;) a b = forall x. a x -&gt; b x\n(==&lt;&lt;&lt;) :: (m ~&gt; MyTrans n) -&gt; MyTrans m ~&gt; MyTrans n\n-- look familiar?\n</code></pre>\n\n<p>That is, you are describing monads on the category of monads.</p>\n\n<pre><code>class MonadTrans t =&gt; MonadMonad t where\n    -- returnM :: m ~&gt; t m\n    -- but that's just lift, therefore the MonadTrans t superclass\n    -- note: input must be a monad homomorphism or else all bets are off\n    -- output is also a monad homomorphism\n    (==&lt;&lt;&lt;) :: (Monad m, Monad n) =&gt; (m ~&gt; t n) -&gt; t m ~&gt; t n\n\ninstance MonadMonad (StateT s) where\n    -- fairly sure this is lawful\n    -- EDIT: probably not\n    f ==&lt;&lt;&lt; StateT x = do\n        (x, s) &lt;- f &lt;$&gt; x &lt;$&gt; get\n        x &lt;$ put s\n</code></pre>\n\n<p>However, making your example work is just not going to happen. It is too unnatural. <code>StateT Int []</code> is the monad for programs that nondeterministically evolve the state. It is an important property of that monad that each \"parallel universe\" receives no communication from the others. The specific operation you are performing will probably not be provided by <em>any</em> useful typeclass. You can only do part of it:</p>\n\n<pre><code>f :: [] ~&gt; StateT Int []\nf l = StateT \\s -&gt; if odd s &amp;&amp; even (length l) then fmap (\\x -&gt; (x, s)) l else []\n\nf ==&lt;&lt;&lt; x1 = []\nf ==&lt;&lt;&lt; x2 = [(1,1),(2,1),(3,1),(4,1)]\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 59507751, "answer_count": 2, "score": 0, "last_activity_date": 1577508705, "creation_date": 1577499927, "last_edit_date": 1577503756, "question_id": 59507652, "link": "https://stackoverflow.com/questions/59507652/lifting-a-complete-monadic-action-to-a-transformer-but-for-monad-transforme", "title": "Lifting a complete monadic action to a transformer (&gt;&gt;= but for Monad Transformers)", "body": "<p>I looked hard to see if this may be a duplicate question but couldn't find anything that addressed specifically this. My apologies if there actually is something.</p>\n\n<p>So, I get how <code>lift</code> works, it lifts a monadic action (fully defined) from the outer-most transformer into the transformed monad. Cool.</p>\n\n<p>But what if I want to apply a <code>(&gt;&gt;=)</code> from one level under the transformer into the transformer? I'll explain with an example.</p>\n\n<p>Say <code>MyTrans</code> is a <code>MonadTrans</code>, and there is also an instance <code>Monad m =&gt; Monad (MyTrans m)</code>. Now, the <code>(&gt;&gt;=)</code> from this instance will have this signature:</p>\n\n<pre><code>instance Monad m =&gt; Monad (MyTrans m) where\n   (&gt;&gt;=) :: MyTrans m a -&gt; (a -&gt; MyTrans m b) -&gt; MyTrans m b\n</code></pre>\n\n<p>but what I need is something like this:</p>\n\n<pre><code>(&gt;&gt;=!) :: Monad m =&gt; MyTrans m a -&gt; (m a -&gt; MyTrans m b) -&gt; MyTrans m b\n</code></pre>\n\n<p>In general:</p>\n\n<pre><code>(&gt;&gt;=!) :: (MonadTrans t, Monad m) =&gt; t m a -&gt; (m a -&gt; t m b) -&gt; t m b\n</code></pre>\n\n<p>It looks like a combination of the original <code>(&gt;&gt;=)</code> and <code>lift</code>, except it really isn't. <code>lift</code> can only be used on covariant arguments of type <code>m a</code> to transform them into a <code>t m a</code>, not the other way around. In other words, the following has the wrong type:</p>\n\n<pre><code>(&gt;&gt;=!?) :: Monad m =&gt; MyTrans m a -&gt; (a -&gt; m b) -&gt; MyTrans m b\nx &gt;&gt;=!? f = x &gt;&gt;= (lift . f)\n</code></pre>\n\n<p>Of course a general <code>colift :: (MonadTrans t, Monad m) =&gt; t m a -&gt; m a</code> makes absolutely zero sense, because surely the transformer is doing something that we cannot just throw away like that in all cases.</p>\n\n<p>But just like <code>(&gt;&gt;=)</code> introduces contravariant arguments into the monad by ensuring that they will always \"come back\", I thought something along the lines of the <code>(&gt;&gt;=!)</code> function would make sense: Yes, it in some way makes an <code>m a</code> from a <code>t m a</code>, but only because it does all of this within <code>t</code>, just like <code>(&gt;&gt;=)</code> makes an <code>a</code> from an <code>m a</code> in some way.</p>\n\n<p>I've thought about it and I don't think <code>(&gt;&gt;=!)</code> can be in general defined from the available tools. In some sense it is more than what <code>MonadTrans</code> gives. I haven't found any related type classes that offer this either. <code>MFunctor</code> is related but it is a different thing, for changing the inner monad, but not for chaining exclusively transformer-related actions.</p>\n\n<p>By the way, here is an example of why you would want to do this:</p>\n\n<p>EDIT: I tried to present a simple example but I realized that that one could be solved with the regular <code>(&gt;&gt;=)</code> from the transformer. My real example (I think) cannot be solved with this. If you think every case can be solved with the usual <code>(&gt;&gt;=)</code>, please do explain how.</p>\n\n<p>Should I just define my own type class for this and give some basic implementations? (I'm interested in <code>StateT</code>, and I'm almost certain it can be implemented for it) Am I doing something in a twisted way? Is there something I overlooked?</p>\n\n<p>Thanks.</p>\n\n<p>EDIT: The answer provided by Fyodor matches the types, but does not do what I want, since by using <code>pure</code>, it is ignoring the monadic effects of the <code>m</code> monad. Here is an example of it giving the wrong answer:</p>\n\n<p>Take <code>t</code> = <code>StateT Int</code> and <code>m</code> = <code>[]</code>.</p>\n\n<pre><code>x1 :: StateT Int [] Int\nx1 = StateT (\\s -&gt; [(1,s),(2,s),(3,s)])\n\nx2 :: StateT Int [] Int\nx2 = StateT (\\s -&gt; [(1,s),(2,s),(3,s),(4,s))])\n\nf :: [Int] -&gt; StateT Int [] Int\nf l = StateT (\\s -&gt; if (even s) then [] else (if (even (length l)) then (fmap (\\z -&gt; (z,z+s)) l) else [(123,123)]))\n</code></pre>\n\n<p><code>runStateT (x1 &gt;&gt;= (\\a -&gt; f (pure a))) 1</code> returns <code>[(123,123),(123,123),(123,123)]</code> as expected, since both <code>1</code> is odd and the list in <code>x1</code> has odd length.</p>\n\n<p>But <code>runStateT (x2 &gt;&gt;= (\\a -&gt; f (pure a))) 1</code> returns <code>[(123,123),(123,123),(123,123),(123,123)]</code>, whereas I would have expected it to return <code>[(1,2),(2,3),(3,4),(4,5)]</code>, since the <code>1</code> is odd and the length of the list is even. Instead, the evaluation of <code>f</code> is happening on the lists <code>[(1,1)]</code>, <code>[(2,1)]</code>, <code>[(3,1)]</code> and <code>[(4,1)]</code> independently, due to the <code>pure</code> call.</p>\n"}, {"tags": ["algorithm", "list", "haskell", "compression", "finite-group-theory"], "comments": [{"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 1, "creation_date": 1577482878, "post_id": 59506253, "comment_id": 105185137, "body": "What is the question here? It seems you&#39;re inviting to a discussion, more than asking a question."}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "reply_to_user": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 1, "creation_date": 1577483884, "post_id": 59506253, "comment_id": 105185413, "body": "i&#39;m asking for a better implementation than the one i privided, and sharing some of my thoughts as some may find contexts like that helpful."}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "reply_to_user": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1577485425, "post_id": 59506253, "comment_id": 105185761, "body": "Shall I remove my implementation and thoughts and only leave the question?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1577486075, "post_id": 59506253, "comment_id": 105185905, "body": "FWIW I think this is a reasonable question. People ask all the time &quot;How do I do x?&quot;, and we ask in return &quot;What have you tried?&quot;. This question asks how to do x, and says &quot;Here is what I tried: I got an implementation that is clearly awful, and am looking for a good one instead.&quot;"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577489383, "post_id": 59506253, "comment_id": 105186597, "body": "Personally, I would implement this by using <code>group</code> (from <code>Data.List</code>) to group the input (e.g. <code>group &quot;AAABBBBAB = [&quot;AAA&quot;,&quot;BBBB&quot;,&quot;A&quot;,&quot;B&quot;]</code>), and then map <code>fst &amp;&amp;&amp; ((`mod` 4) . length)</code> over that to get the output (using <code>&amp;&amp;&amp;</code> from <code>Control.Arrow</code>). Full program: <code>fmap (fst &amp;&amp;&amp; ((`mod` 4) . length)) . group</code>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577489749, "post_id": 59506253, "comment_id": 105186675, "body": "Explanation: <code>group</code> groups the characters to get a list of substrings. Then <code>fmap</code> applies a function to each element of that list (i.e. on each substring), that function being <code>fst &amp;&amp;&amp; ((`mod` 4) . length)</code>. This gets the first character of the substring (<code>fst</code>), gets the length mod 4 <code>((`mod` 4) . length)</code>, and puts both in a tuple (<code>&amp;&amp;&amp;</code>)."}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577489996, "post_id": 59506253, "comment_id": 105186729, "body": "Just tried @bradrn&#39;s solution after <code>:module + Control.Arrow</code> in GHCi only to get a type error. Besides, can it handle the long distance merging (in above example, the first <code>A</code> doesn&#39;t get <code>group</code>ed until the next <code>B</code> is merged then canceled)?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577490205, "post_id": 59506253, "comment_id": 105186765, "body": "Sorry @hyiltiz \u2014 I didn\u2019t notice the long distance merging. That makes this problem a lot more interesting! And I don\u2019t see any easy solution once that\u2019s taken into account."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577493180, "post_id": 59506253, "comment_id": 105187180, "body": "You should include an example where merging does not happen, e.g. <code>AAABABBBC</code> does not yield <code>[(&#39;C&#39;,1)]</code> (right?). Otherwise, we could simply disregard the order of the characters, sort the strings, and compute from there."}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577493427, "post_id": 59506253, "comment_id": 105187206, "body": "@chi sure, added."}, {"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 1, "creation_date": 1577509848, "post_id": 59506253, "comment_id": 105189129, "body": "This is really similar to the <a href=\"https://leetcode.com/problems/zuma-game/\" rel=\"nofollow noreferrer\">Zuma game</a> problem."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1577521054, "last_edit_date": 1577521054, "creation_date": 1577510866, "answer_id": 59508390, "question_id": 59506253, "link": "https://stackoverflow.com/questions/59506253/modular-run-length-encoding/59508390#59508390", "title": "Modular run-length encoding", "body": "<h2>Algorithm</h2>\n\n<p>I think you are making this problem much harder by thinking of it in terms of character strings at all. Instead, do a preliminary pass that just does the boring RLE part. This way, a second pass is comparatively easy, because you can work in \"tokens\" that represent a run of a certain length, instead of having to work one character at a time.</p>\n\n<p>The only data structure we need to maintain as we do the second pass through the list is a stack, and we only ever need to look at its top element. We compare each token that we're examining with the top of the stack. If they're the same, we blend them into a single token representing their concatenation; otherwise, we simply push the next token onto the stack. In either case, we reduce token sizes mod N and drop tokens with size 0.</p>\n\n<h2>Performance</h2>\n\n<ul>\n<li>This algorithm runs in linear time: it processes each input token exactly once, and does a constant amount of work for each token.</li>\n<li>It cannot produce output lazily. There is no prefix of the input that is sufficient to confidently produce a prefix of the output, so we have to wait till we have consumed the entire input to produce any output. Even something that \"looks bad\" like ABCABCABCABCABC can eventually be cancelled out if the rest of the string is <code>CCCBBBAAA...</code>.</li>\n<li>The reverse at the end is a bummer, but amortized over all the tokens it is quite cheap, and in any case does not worsen our linear-time guarantee. It likewise does not change our space requirements, since we already require O(N) space to buffer the output (since as the previous note says, it's never possible to emit a partial result).</li>\n</ul>\n\n<h2>Correctness</h2>\n\n<p>Writing down my remark about laziness made me think of your <code>reduce</code> solution, which appears to produce output lazily, which I thought was impossible. The explanation, it turns out, is that your implementation is not just inelegant, as you say, but also incorrect. It produces output too soon, missing chances to cancel with later elements. The simplest test case I can find that you fail is <code>reduce \"ABABBBBAAABBBAAA\" == [('A',1),('A',3)]</code>. We can confirm that this is due to yielding results too early, by noting that <code>take 1 $ reduce (\"ABAB\" ++ undefined)</code> yields <code>[(1, 'A')]</code> even though elements might come later that cancel with that first A.</p>\n\n<h2>Minutiae</h2>\n\n<p>Finally note that I use a custom data type <code>Run</code> just to give a name to the concept; of course you can convert this to a tuple cheaply, or rewrite the function to use tuples internally if you prefer.</p>\n\n<h2>Implementation</h2>\n\n<pre><code>import Data.List (group)\n\ndata Run a = Run Int a deriving Show\n\nmodularRLE :: Eq a =&gt; Int -&gt; [a] -&gt; [Run a]\nmodularRLE groupSize = go [] . tokenize\n  where go stack [] = reverse stack\n        go stack (Run n x : remainder) = case stack of\n          [] -&gt; go (blend n []) remainder\n          (Run m y : prev) | x == y -&gt; go (blend (n + m) prev) remainder\n                           | otherwise -&gt; go (blend n stack) remainder\n          where blend i s = case i `mod` groupSize of\n                              0 -&gt; s\n                              j -&gt; Run j x : s\n        tokenize xs = [Run (length run) x | run@(x:_) &lt;- group xs]\n\u03bb&gt; modularRLE 4 \"AAABBBBABCCCCBBBDAAA\"\n[Run 1 'D',Run 3 'A']\n\u03bb&gt; modularRLE 4 \"ABABBBBAAABBBAAA\"\n[]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1577512799, "post_id": 59508509, "comment_id": 105189499, "body": "Glad to see a similar solution to the one I included in <b>Thoughts</b>."}], "tags": [], "owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "is_accepted": false, "score": 2, "last_activity_date": 1577512593, "creation_date": 1577512593, "answer_id": 59508509, "question_id": 59506253, "link": "https://stackoverflow.com/questions/59506253/modular-run-length-encoding/59508509#59508509", "title": "Modular run-length encoding", "body": "<p>My first observation will be that you only need to code one step of the resolution, since you can pass that step to a function that will feed it its own output until it stabilizes. This function was discussed in <a href=\"https://stackoverflow.com/questions/7442892/repeatedly-applying-a-function-until-the-result-is-stable/\">this SO question</a> and was given a clever answer by @galva:</p>\n\n<pre><code>--from https://stackoverflow.com/a/23924238/7096763\nconverge :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nconverge = until =&lt;&lt; ((==) =&lt;&lt;)\n</code></pre>\n\n<p>This is the entrypoint of the algorithm:</p>\n\n<pre><code>--               |-------------step----------------------|    |---------------process------|   \nsolve = converge (filter (not . isFullTuple) . collapseOne) . fmap (liftA2 (,)  head length) . group\n</code></pre>\n\n<p>Starting from the end of the line and moving backwards (following the order of execution), we first process a <code>String</code> into a <code>[(Char, Int)]</code> using <code>fmap (liftA2 (,) head length) . group</code>. Then we get to a bracketed block that contains our step function. The <code>collapseOne</code> takes a list of tuples and collapses at most one pair of tuples, deleting the resulting tuple if necessary (if mod 4 == 0) (<code>[('A', 1), ('A', 2), ('B', 2)] ==&gt; [('A', 3), ('B', 2)]</code>):</p>\n\n<pre><code>collapseOne [x] = [x]\ncollapseOne [] = []\ncollapseOne (l:r:xs)\n  | fst l == fst r = (fst l, (snd l + snd r) `mod` 4):xs\n  | otherwise          = l:(collapseOne (r:xs))\n</code></pre>\n\n<p>You also need to know if tuples are \"ripe\" and need to be filtered out:</p>\n\n<pre><code>isFullTuple = (==0) . (`mod` 4) . snd\n</code></pre>\n\n<p>I would argue that these 8 lines of code are significantly easier to read.</p>\n"}], "owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 2, "accepted_answer_id": 59508390, "answer_count": 2, "score": 5, "last_activity_date": 1577521054, "creation_date": 1577482586, "last_edit_date": 1577507969, "question_id": 59506253, "link": "https://stackoverflow.com/questions/59506253/modular-run-length-encoding", "title": "Modular run-length encoding", "body": "<h3>Question</h3>\n\n<p>How to implement a run length encoding modulus <code>n&gt;=1</code>? For <code>n=4</code>, considering the input<code>AAABBBBABCCCCBBBDAAA</code>, we want an output of <code>[('D', 1), ('A', 3)]</code>. Note the long-distance merging due to the modulus operation. See Explanation. </p>\n\n<h3>Explanation</h3>\n\n<p>The first occurance of <code>BBBB</code> encodes to <code>(B, 4)</code> whose <code>modulus 4</code> is <code>(B, 0)</code>, thus canceling itself out. See the diagram (ignore spaces; they are simply for illustrative purposes):</p>\n\n<pre><code>AAABBBBABCCCCBBBDAAA\nA3  B4 ABCCCCBBBDAAA\nA3  B0 ABCCCCBBBDAAA\nA3     ABCCCCBBBDAAA\nA4      BCCCCBBBDAAA\nA0      BCCCCBBBDAAA\n        BCCCCBBBDAAA\n        ... \n                DA3\n</code></pre>\n\n<p>A simpler example when no merging happens since none gets canceled by <code>modulus 4</code>: input <code>AAABABBBC</code> produces output <code>[('A',3),('B',1),('A',1),('B',3),('C',1)]</code>.</p>\n\n<h3>Requirements</h3>\n\n<ul>\n<li>Haskell implementations are preferred but others are welcome too!</li>\n<li>Prefer standard/common library functions over 3rd party libraries.</li>\n<li>Prefer readable and succint programs utilizing higher-order functions.</li>\n<li>Prefer efficiency (do not loop over the whole list whenever unnecessary)</li>\n</ul>\n\n<h3>My program</h3>\n\n<p>I implemented this in Haskell, but it looks too verbose and awful to read. The key idea is to check three tuples at a time, and <em>only advance one tuple forward if we can neither</em> cancel out <code>0</code> tuples nor merge a pair of tuples among the three tuples at hand.</p>\n\n<pre><code>import Data.List (group)\n\ntest = [('A', 1), ('A', 2), ('B', 2), ('B', 2), ('A', 1), ('B', 1), ('C', 1), ('C', 3), ('B', 3), ('D', 1), ('A', 3)] :: [(Char, Int)]\nexpected = [('D', 1), ('A', 3)] :: [(Char, Int)]\n\n\nreduce' :: [(Char, Int)] -&gt; [(Char, Int)]\nreduce' [           ] = []                                           -- exit\nreduce' (   (_,0):xs) = reduce' xs\nreduce' (x1:(_,0):xs) = reduce' (x1:xs)\nreduce' (   (x,n):[]) = (x,n):[]                                     -- exit\n\nreduce' (        (x1,n1):(x2,n2):[])              -- [previous,current,NONE]\n  | x1 == x2  = reduce' ((x1, d4 (n1+n2)):[])\n  | otherwise = (x1,n1):(                                         -- advance\n                reduce' ((x2, d4     n2 ):[]))\n\nreduce' ((x1,n1):(x2,n2):(x3,n3):xs)              -- [previous,current,next]\n  | n3 == 0   = reduce' ((x1, d4  n1    ):(x2, d4  n2    ):xs)\n  | n2 == 0   = reduce' ((x1, d4  n1    ):(x3, d4     n3 ):xs)\n  | x2 == x3  = reduce' ((x1, d4  n1    ):(x2, d4 (n2+n3)):xs)\n  | x1 == x2  = reduce' ((x2, d4 (n1+n2)):(x3, d4     n3 ):xs)\n  | otherwise = (x1,n1):(                                         -- advance\n                reduce' ((x2, d4  n2    ):(x3, d4     n3 ):xs)\n                )\n\n-- Helpers\nflatten :: [(Char, Int)] -&gt; String\nflatten nested = concat $ (\\(x, n) -&gt; replicate n x) &lt;$&gt; nested\n\nnest :: String -&gt; [(Char, Int)]\nnest flat = zip (head &lt;$&gt; xg) (d4 .length &lt;$&gt; xg)\n  where xg = group flat\n\nreduce = reduce' . nest\nd4 = (`rem` 4)\n</code></pre>\n\n<h3>Thoughts</h3>\n\n<p>My inputs are like the <code>test</code> variable in the snipped above. We could keep doing <code>flatten</code> then <code>nest</code> until its result doesn't change, and would definitely look simpler. But it feels it is scanning the whole list many times, while my 3-pointer implementation scans the whole list only once. Maybe we can pop an element from left and add it to a new stack while merging identical consecutive items? Or maybe use Applicative Functors? E.g. this works but not sure about its efficiency/performance: <code>reduce = (until =&lt;&lt; ((==) =&lt;&lt;)) (nest . flatten)</code>.</p>\n"}, {"tags": ["haskell", "roles", "coerce"], "comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1577475103, "post_id": 59504876, "comment_id": 105182944, "body": "<code>a</code> in <code>Id</code> is a phantom variable and has no impact on the actual value inside. If you had <code>newtype Id a = Id a</code>, then coercion would have failed."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1577475266, "post_id": 59504876, "comment_id": 105183001, "body": "@lehins The point of the <code>type role</code> was to make that not be the case. This question is asking why that didn&#39;t work."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 12, "last_activity_date": 1577560769, "last_edit_date": 1577560769, "creation_date": 1577475414, "answer_id": 59505323, "question_id": 59504876, "link": "https://stackoverflow.com/questions/59504876/type-roles-and-confusing-behavior-by-coerce/59505323#59505323", "title": "Type roles and confusing behavior by `coerce`", "body": "<p><a href=\"https://www.stackage.org/haddock/lts-8.12/ghc-prim-0.5.0.0/GHC-Types.html#t:Coercible\" rel=\"nofollow noreferrer\"><code>Coercible</code></a> has three possible \"types\" of instances (which are automagically generated by the compiler, not defined by the user). Only <em>one</em> of them is actually affected by <a href=\"https://downloads.haskell.org/ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=roles#roles\" rel=\"nofollow noreferrer\">roles</a>.</p>\n\n<ul>\n<li>Every type is coercible to itself.</li>\n<li>You can coerce \"under\" a type constructor, provided the affected type variables are <code>representational</code> or <code>phantom</code>. For example, you can coerce a <code>Map Char Int</code> into a <code>Map Char (Data.Monoid.Sum Int)</code> because for <a href=\"http://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Map-Strict.html#t:Map\" rel=\"nofollow noreferrer\"><code>Map</code></a> we have <code>type role Map nominal representational</code>.</li>\n<li>You can <em>always</em> coerce a newtype to the underlying type and vice versa, provided the newtype constructor is in scope. This ignores all roles! The rationale is that, given that the constructor is available, you could always wrap and unwrap manually, so the role doesn't give you any safety anyway.</li>\n</ul>\n\n<p>In your example, the third rule applies. Had the newtype been defined in another module and the constructor not imported, the coercion would have failed (to make it work again, you would need to switch the role to <code>phantom</code>). </p>\n\n<p>The somewhat surprising special behaviour for newtypes is explained in <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/13598\" rel=\"nofollow noreferrer\">this</a> GHC issue.</p>\n"}], "owner": {"reputation": 831, "user_id": 3371760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/09370cd5d499c9f0f75b54aa1b4daa17?s=128&d=identicon&r=PG", "display_name": "Fried Brice", "link": "https://stackoverflow.com/users/3371760/fried-brice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 59505323, "answer_count": 1, "score": 11, "last_activity_date": 1577560769, "creation_date": 1577472474, "last_edit_date": 1577493712, "question_id": 59504876, "link": "https://stackoverflow.com/questions/59504876/type-roles-and-confusing-behavior-by-coerce", "title": "Type roles and confusing behavior by `coerce`", "body": "<p>I have a type <code>Id a</code> and I'm trying to prevent accidentally coercing, e.g., an <code>Id Double</code> to an <code>Id Int</code>.</p>\n\n<p>If I understand type roles correctly, the following should not compile.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE RoleAnnotations #-}\nimport Data.Coerce (coerce)\n\ntype role Id nominal\nnewtype Id a = Id String\n\nbadKey :: Id Int\nbadKey = coerce (Id \"I point to a Double\" :: Id Double)\n</code></pre>\n\n<p>Unfortunately, it does:</p>\n\n<pre><code>Prelude&gt; :load Id.hs\n[1 of 1] Compiling Main             ( Id.hs, interpreted )\nOk, one module loaded.\n*Main&gt; :type badKey\nbadKey :: Id Int\n</code></pre>\n\n<p>What am I missing about type roles?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 6, "creation_date": 1577464750, "post_id": 59503546, "comment_id": 105179562, "body": "<code>ord &#39;a&#39;</code> should have single quotes, not backticks. Backticks are used to make a function into an infix operator, so if you include something in backticks the parser expects an identifier afterwards."}], "answers": [{"tags": [], "owner": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "is_accepted": true, "score": 2, "last_activity_date": 1577489017, "creation_date": 1577489017, "answer_id": 59506929, "question_id": 59503546, "link": "https://stackoverflow.com/questions/59503546/parse-error-in-the-code-but-cant-spot-the-error/59506929#59506929", "title": "parse error in the code but can&#39;t spot the error", "body": "<p>Others have pointed this out in the comments but I thought I'd explain a little more.</p>\n\n<p>The Haskell interpreter is useful here. Let's try and see what the type of \n`a` is.</p>\n\n<pre><code>$ ghci\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :t `a`\n\n&lt;interactive&gt;:1:1: error: parse error on input \u2018`\u2019\n</code></pre>\n\n<p>That's not good... So let's try single and double quotes</p>\n\n<pre><code>Prelude&gt; :t 'a'\n'a' :: Char\nPrelude&gt; :t \"a\"\n\"a\" :: [Char]\n</code></pre>\n\n<p>Thus,</p>\n\n<pre><code>let2int :: Char -&gt; Int\nlet2int c = ord c - ord `a`\n\nint2let :: Int -&gt; Char\nint2let n = chr(ord `a` + n)\n</code></pre>\n\n<p>Should be</p>\n\n<pre><code>let2int :: Char -&gt; Int\nlet2int c = ord c - ord 'a'\n\nint2let :: Int -&gt; Char\nint2let n = chr(ord 'a' + n)\n</code></pre>\n\n<p>For reference, here's some documentation on the <a href=\"https://wiki.haskell.org/Infix_operator\" rel=\"nofollow noreferrer\">infix operator</a></p>\n"}], "owner": {"reputation": 45, "user_id": 12581991, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-W2Z7CQiKets/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcjIg30eoPcBqymLfaIsHgh0Qjneg/photo.jpg?sz=128", "display_name": "123456frank", "link": "https://stackoverflow.com/users/12581991/123456frank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 59506929, "answer_count": 1, "score": -2, "last_activity_date": 1577489017, "creation_date": 1577464566, "question_id": 59503546, "link": "https://stackoverflow.com/questions/59503546/parse-error-in-the-code-but-cant-spot-the-error", "title": "parse error in the code but can&#39;t spot the error", "body": "<pre><code>import Data.Char\n\nshift :: Int -&gt; Char -&gt; Char\nshift n c | isLower c = int2let((let2int c + n) `mod` 26)\n          | otherwise = c\n\nlet2int :: Char -&gt; Int\nlet2int c = ord c - ord `a`\n\nint2let :: Int -&gt; Char\nint2let n = chr(ord `a` + n)\n</code></pre>\n\n<p>This is the code for the Caesar cipher where I have experienced a problem in parse error with the line <code>int2let :: Int -&gt; Char</code>. I'm not sure why it's wrong. </p>\n"}, {"tags": ["haskell", "functional-programming", "operators", "operator-precedence", "function-composition"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1577462038, "post_id": 59503058, "comment_id": 105178480, "body": "<code>(a . b) $ c</code> is the same thing as <code>a $ (b $ c)</code> - or without the explicit <code>$</code>, which only is syntactical sugar for grouping: <code>(a . b) c</code> = <code>a (b c)</code>"}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1577465391, "post_id": 59503058, "comment_id": 105179803, "body": "Why did I get down voted?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1577481467, "post_id": 59503058, "comment_id": 105184800, "body": "I&#39;m not a downvoter, but <code>($)</code> vs <code>(.)</code> is a topic we already discussed several times. Just to mention one question: <a href=\"https://stackoverflow.com/questions/3030675/haskell-function-composition-and-function-application-idioms-correct-us?rq=1\" title=\"haskell function composition and function application idioms correct us\">stackoverflow.com/questions/3030675/&hellip;</a>"}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 0, "creation_date": 1577486839, "post_id": 59503058, "comment_id": 105186072, "body": "I tried searching around a bit before posting but I didn&#39;t see it. Sorry I missed it. At first glance, I still think my question is still relevant because the line of code involves more complexity and noise. It&#39;s harder for me to boil down to the answer. Also, the topic is a bit different. The other post wasn&#39;t confused about how they were working, just which style was preferred. My question is specifically how it works that way.  But thanks for the link, for sure. I&#39;ll be going through that too and looking for more resources."}], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 3, "last_activity_date": 1577462232, "creation_date": 1577462232, "answer_id": 59503135, "question_id": 59503058, "link": "https://stackoverflow.com/questions/59503058/haskell-function-composition-vs-function-application/59503135#59503135", "title": "Haskell Function Composition (.) vs Function Application ($)", "body": "<p><code>.</code> has a higher precedence than <code>$</code>:</p>\n\n<pre><code>&gt; :info ($)\n($) :: (a -&gt; b) -&gt; a -&gt; b   -- Defined in \u2018GHC.Base\u2019\ninfixr 0 $\n&gt; :info (.)\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c   -- Defined in \u2018GHC.Base\u2019\ninfixr 9 .\n</code></pre>\n\n<p>So <code>a $ b $ c $ d</code> is <code>a $ (b $ (c $ d))</code>, but <code>a . b . c $ d</code> is <code>(a . (b . c)) $ d</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 0, "creation_date": 1577470038, "post_id": 59503283, "comment_id": 105181322, "body": "I see I mixed up two lines of code. Thanks for pointing that out. I&#39;ll review this more when I get home from work."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1577465914, "last_edit_date": 1577465914, "creation_date": 1577463047, "answer_id": 59503283, "question_id": 59503058, "link": "https://stackoverflow.com/questions/59503058/haskell-function-composition-vs-function-application/59503283#59503283", "title": "Haskell Function Composition (.) vs Function Application ($)", "body": "<p>They are not interchangeable.</p>\n\n<p>What you have is</p>\n\n<pre><code>MaybeT . fmap Just $ locked\nMaybeT $ fmap Just $ locked        -- you had `dead` here\n</code></pre>\n\n<p>but because of operator precedence it is really parsed as</p>\n\n<pre><code>(MaybeT . fmap Just) locked  -- and\n MaybeT $ fmap Just  locked\n</code></pre>\n\n<p>the <code>.</code> and <code>$</code> participate in differently structured expressions here. To be interchangeable would mean you could replace</p>\n\n<pre><code>(MaybeT . fmap Just) locked  -- with\n(MaybeT $ fmap Just) locked\n</code></pre>\n\n<p>and clearly this is not the case.</p>\n\n<p>So, swapping <code>.</code> for <code>$</code> in the <em>same</em> expression produces different results, just as you expected. At the same time two <em>different</em> expressions happen to produce the same result. Nothing strange there at all, expressions get simplified into equivalent different expressions all the time.</p>\n"}], "owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 59503135, "answer_count": 2, "score": 0, "last_activity_date": 1577469949, "creation_date": 1577461837, "last_edit_date": 1577469949, "question_id": 59503058, "link": "https://stackoverflow.com/questions/59503058/haskell-function-composition-vs-function-application", "title": "Haskell Function Composition (.) vs Function Application ($)", "body": "<p>I'm going through <a href=\"https://github.com/samtay/snake/blob/master/src/Snake.hs\" rel=\"nofollow noreferrer\">this source code</a> for learning.</p>\n\n<p>On line 81 I see the following code:</p>\n\n<pre><code>MaybeT . fmap Just $ locked .= False\n</code></pre>\n\n<p>I was puzzled by the use of the function composition so I loaded it in my repl and replaced it with function application</p>\n\n<pre><code>MaybeT $ fmap Just $ locked .= False\n</code></pre>\n\n<p>I'm very surprised these two pieces of code give the exact result.</p>\n\n<pre><code>Control.Monad.State.Class.MonadState Game m =&gt; MaybeT m ()\n</code></pre>\n\n<p>In fact, I can understand how function application <code>($)</code> is producing this result but I'm floored as to how function composition <code>(.)</code> is producing this result. The signatures of these two functions are different and I think they should clearly produce different results if one replaces the other.</p>\n\n<pre><code>:t (.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n:t ($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>Can someone explain to me why the <code>($)</code> and <code>(.)</code> are interchangeable in this case.</p>\n"}, {"tags": ["haskell", "io", "stdout", "double-quotes"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1577443334, "post_id": 59499339, "comment_id": 105171666, "body": "The quotes are not in the <i>content</i> of the string. These are in the <i>representation</i> of the string, since <code>print</code> calls <code>show</code>."}], "answers": [{"tags": [], "owner": {"reputation": 134, "user_id": 8340774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1a41e8b46427e6d9fa135838d91b38d?s=128&d=identicon&r=PG&f=1", "display_name": "MANJURUL HAQUE", "link": "https://stackoverflow.com/users/8340774/manjurul-haque"}, "is_accepted": true, "score": 7, "last_activity_date": 1577443188, "creation_date": 1577443188, "answer_id": 59499504, "question_id": 59499339, "link": "https://stackoverflow.com/questions/59499339/suppress-quotes-in-stdout-hackerrank/59499504#59499504", "title": "Suppress quotes in stdout (hackerrank)", "body": "<p>You write:</p>\n\n<pre><code>putStrLn result\n</code></pre>\n\n<p>instead of last line:</p>\n\n<pre><code> print $ filter (/='\"') result\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 59499504, "answer_count": 1, "score": -1, "last_activity_date": 1577443188, "creation_date": 1577442519, "question_id": 59499339, "link": "https://stackoverflow.com/questions/59499339/suppress-quotes-in-stdout-hackerrank", "title": "Suppress quotes in stdout (hackerrank)", "body": "<p>I'm working on a <a href=\"https://www.hackerrank.com/challenges/string-compression/problem\" rel=\"nofollow noreferrer\">string compression problem</a> in Hackerrank in Haskell, and stuck on the IO.  I am trying to be explicit about removing quotes.</p>\n\n<pre><code>compress :: [Char] -&gt; [Char]\ncompress = ...\n\nmain :: IO ()\nmain = do\n    input &lt;- getLine\n    let result = compress input\n    print $ filter (/='\"') result \n</code></pre>\n\n<p>The code compiles and returns the correct response, albeit surrounded in quotes.</p>\n\n<pre><code>Compiler Message\nWrong Answer\n\nInput (stdin)\nabcaaabbb\n\nYour Output (stdout)\n\"abca3b3\"\n\nExpected Output\nabca3b3\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "functional-dependencies", "type-level-computation"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1577436811, "post_id": 59495874, "comment_id": 105169350, "body": "The key trouble seems to be <code>bs cs -&gt; as</code>, because we need non-local information about <code>bs</code> and <code>cs</code> to decide if <code>as</code> should be a cons or a nil.  We need to find out how to represent this information; what context would we add to a type signature to guarantee it when it can&#39;t be directly deduced?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1577451675, "post_id": 59495874, "comment_id": 105174664, "body": "To expand what luqui said: imagine we know <code>bs</code> and <code>cs</code>, and we want to exploit the fundep, i.e. we want to reconstruct <code>as</code>. To do it in a deterministic way, we expect to be able to commit to a single instance and follow that recipe. Concretely, assume <code>bs = (Int &#39;: bs2)</code> and <code>cs = (Int &#39;: cs2)</code>. Which instance do we choose? It is possible that such <code>Int</code> in <code>cs</code> comes from <code>bs</code> (and <code>as</code> is empty). It is also possible that is comes from (nonempty) <code>as</code> instead, and that <code>Int</code> will appear again in <code>cs</code> later on. We need to dig deeper in <code>cs</code> to know and GHC won&#39;t do that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1577452141, "post_id": 59495874, "comment_id": 105174820, "body": "Very roughly put, GHC will accept fundeps that can be proved using a simple form of induction from the instances. Here, one of them requires a kind of double induction to be proved (or so it seems), and the compiler won&#39;t go that far."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1577475096, "post_id": 59504553, "comment_id": 105182941, "body": "Well done!  I even suspected this might be impossible but you solved it transparently and elegantly."}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 10, "last_activity_date": 1577470429, "creation_date": 1577470429, "answer_id": 59504553, "question_id": 59495874, "link": "https://stackoverflow.com/questions/59495874/creating-a-completely-dependent-concatenation/59504553#59504553", "title": "Creating a completely dependent concatenation", "body": "<p>So, as comments suggest, GHC is not gonna figure it out on it's own, but we can help it with a bit of type level programming. Let's introduce some <code>TypeFamilies</code>. All of these functions are pretty straightforward translations of list manipulation lifted to the type level:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- | This will produce the suffix of `cs` without `as`\ntype family DropPrefix (as :: [Type]) (cs :: [Type]) where\n  DropPrefix '[] cs = cs\n  DropPrefix (a ': as) (a ': cs) = DropPrefix as cs\n\n-- Similar to the logic in the question itself: list concatenation. \ntype family Concat (as :: [Type]) (bs :: [Type]) where\n  Concat '[] bs = bs\n  Concat (head ': tail) bs = head ': Concat tail bs\n\n-- | Naive list reversal with help of concatenation.\ntype family Reverse (xs :: [Type]) where\n  Reverse '[] = '[]\n  Reverse (x ': xs) = Concat (Reverse xs) '[x]\n\n-- | This will produce the prefix of `cs` without `bs`\ntype family DropSuffix (bs :: [Type]) (cs :: [Type]) where\n  DropSuffix bs cs = Reverse (DropPrefix (Reverse bs) (Reverse cs))\n\n-- | Same definition of `HList` as in the question\ndata HList (as :: [Type]) where\n  HEmpty :: HList '[]\n  HCons :: a -&gt; HList as -&gt; HList (a ': as)\n\n-- | Definition of concatenation at the value level\nconcatHList :: (cs ~ Concat as bs) =&gt; HList as -&gt; HList bs -&gt; HList cs\nconcatHList HEmpty bs = bs\nconcatHList (HCons head tail) bs = HCons head (concatHList tail bs)\n</code></pre>\n\n<p>With this tools at our disposal we can actually get to hour goal, but first let's define a function with the desired properties:</p>\n\n<ul>\n<li>Ability to deduce <code>cs</code> from <code>as</code> and <code>bs</code></li>\n<li>Ability to deduce <code>as</code> from <code>bs</code> and <code>cs</code></li>\n<li>Ability to deduce <code>bs</code> from <code>as</code> and <code>cs</code></li>\n</ul>\n\n<p>Voila:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>concatH ::\n     (cs ~ Concat as bs, bs ~ DropPrefix as cs, as ~ DropSuffix bs cs)\n  =&gt; HList as\n  -&gt; HList bs\n  -&gt; HList cs\nconcatH = concatHList\n</code></pre>\n\n<p>Let's test it:</p>\n\n<pre><code>foo :: HList '[Char, Bool]\nfoo = HCons 'a' (HCons True HEmpty)\n\nbar :: HList '[Int]\nbar = HCons (1 :: Int) HEmpty\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; :t concatH foo bar\nconcatH foo bar :: HList '[Char, Bool, Int]\n\u03bb&gt; :t concatH bar foo\nconcatH bar foo :: HList '[Int, Char, Bool]\n</code></pre>\n\n<p>And finally the end goal:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Concatable (m :: k -&gt; Type) (as :: k) (bs :: k) (cs :: k)\n  | as bs -&gt; cs\n  , as cs -&gt; bs\n  , bs cs -&gt; as\n  where\n  concat' :: m as -&gt; m bs -&gt; m cs\n\ninstance (cs ~ Concat as bs, bs ~ DropPrefix as cs, as ~ DropSuffix bs cs) =&gt;\n         Concatable HList as bs cs where\n  concat' = concatH\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; :t concat' HEmpty bar\nconcat' HEmpty bar :: HList '[Int]\n\u03bb&gt; :t concat' foo bar\nconcat' foo bar :: HList '[Char, Bool, Int]\n\u03bb&gt; :t concat' bar foo\nconcat' bar foo :: HList '[Int, Char, Bool]\n</code></pre>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 59504553, "answer_count": 1, "score": 10, "last_activity_date": 1577470429, "creation_date": 1577419687, "last_edit_date": 1577455979, "question_id": 59495874, "link": "https://stackoverflow.com/questions/59495874/creating-a-completely-dependent-concatenation", "title": "Creating a completely dependent concatenation", "body": "<p>A nice true fact about concatenation is that if I know any two variables in the equation:</p>\n\n<pre><code>a ++ b = c\n</code></pre>\n\n<p>Then I know the third.</p>\n\n<p>I would like to capture this idea in my own concat so I use a functional dependency.  </p>\n\n<pre><code>{-# Language DataKinds, GADTs, FlexibleContexts, FlexibleInstances, FunctionalDependencies, KindSignatures, PolyKinds, TypeOperators, UndecidableInstances #-}\nimport Data.Kind (Type)\n\nclass Concatable\n   (m  :: k -&gt; Type)\n   (as :: k)\n   (bs :: k)\n   (cs :: k)\n   | as bs -&gt; cs\n   , as cs -&gt; bs\n   , bs cs -&gt; as\n   where\n     concat' :: m as -&gt; m bs -&gt; m cs\n</code></pre>\n\n<p>Now I conjure heterogeneous list like so:</p>\n\n<pre><code>data HList ( as :: [ Type ] ) where\n  HEmpty :: HList '[]\n  HCons  :: a -&gt; HList as -&gt; HList (a ': as)\n</code></pre>\n\n<p>But when I try to declare these as <code>Concatable</code> I have an issue</p>\n\n<pre><code>instance Concatable HList '[] bs bs where\n  concat' HEmpty bs = bs\ninstance\n  ( Concatable HList as bs cs\n  )\n    =&gt; Concatable HList (a ': as) bs (a ': cs)\n  where\n    concat' (HCons head tail) bs = HCons head (concat' tail bs)\n</code></pre>\n\n<p>I don't satisfy my third functional dependency.  Or rather the compiler believes we do not.\nThis is because the compiler believes that in our second instance it might be the case that <code>bs ~ (a ': cs)</code>.  And it could be the case if <code>Concatable as (a ': cs) cs</code>.</p>\n\n<p>How can I adjust my instances so that all three of the dependencies are satisfied?</p>\n"}, {"tags": ["haskell", "runtime", "ghc", "hint", "haskell-polysemy"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1577464406, "post_id": 59495357, "comment_id": 105179411, "body": "It isn&#39;t clear to me.  Does it help to set language extensions in hint?  I&#39;m guessing not and would call this a bug."}, {"owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1577465852, "post_id": 59495357, "comment_id": 105179982, "body": "@ThomasM.DuBuisson: No, I&#39;ve just tried adding <code>set [languageExtensions := [DataKinds, TypeOperators]]</code> to the beginning of each of the Interpreter monad expressions; it doesn&#39;t change the behavior."}], "answers": [{"comments": [{"owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "edited": false, "score": 0, "creation_date": 1578439549, "post_id": 59571777, "comment_id": 105437433, "body": "Hi @luqui; I&#39;ve been able to track this further: Basically Hint is using the <code>Show</code> instance of <code>TypeRef</code> in a way that wasn&#39;t intended (<a href=\"https://github.com/haskell-hint/hint/issues/88\" rel=\"nofollow noreferrer\">ticket</a>). Changing Hint to leave out the kind specifications isn&#39;t hard, but do you think that&#39;s the right solution?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "edited": false, "score": 0, "creation_date": 1578991306, "post_id": 59571777, "comment_id": 105609574, "body": "@ShapeOfMatter, I&#39;m looking over that thread and I appreciate both of you for helping to improve the whole ecosystem."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1578025623, "last_edit_date": 1578025623, "creation_date": 1578011305, "answer_id": 59571777, "question_id": 59495357, "link": "https://stackoverflow.com/questions/59495357/hint-interpret-gives-a-compiler-error-when-used-on-a-polysemy-sem-value/59571777#59571777", "title": "Hint.interpret gives a compiler error when used on a Polysemy.Sem value", "body": "<p>Not an answer, but I've made some discoveries which you might find helpful.</p>\n\n<p>I thought it might be the bogus prefix type operator syntax <code>': x xs</code> which is not valid Haskell (you would have to either write it infix or use <code>(':)</code>).  So I implemented a <code>SemWorkaround</code> wrapper module which used <code>Cons</code> and <code>Nil</code> instead of the standard list syntax.  Seemed like mostly the same problem with a more verbose error message (hmm).</p>\n\n<p>Then I thought it might be the explicit kind application, since the error messages keep talking about things being given too many arguments.  So I tried changing the type-level list representation to the way we used to do it back in the old days.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeOperators, TypeFamilies #-}\n\nmodule SemWorkaround where\n\nimport Polysemy (Sem, Embed)\nimport Data.Kind (Type)\n\ndata Nil \ndata Cons (a :: (Type -&gt; Type) -&gt; Type -&gt; Type) (as :: Type)\n\ntype family ListToList xs where\n    ListToList Nil = '[]\n    ListToList (Cons x xs) = x ': ListToList xs\n\nnewtype Sem' l a = Sem' { getSem' :: Sem (ListToList l) a }\n</code></pre>\n\n<p>And used <code>Sem'</code> to marshal the hint boundary.  E.g.</p>\n\n<pre><code>type MyEffect' = Sem' (Cons (Embed IO) Nil) ()\n\n...\n\ns &lt;- interpret \"Sem' . embed $ print \\\"Success\\\"\" (as :: MyEffect')\npure $ getSem' s\n</code></pre>\n\n<p>This worked.  So it seems like whoever is producing the type is emitting an explicit kind argument for polymorphic lifted constructors, but the consumer is expecting it to be implicit.  To confirm I changed the workaround module to use a monomorphic datakind <code>List</code>.</p>\n\n<pre><code>data List\n    = Nil\n    | Cons ((Type -&gt; Type) -&gt; Type -&gt; Type) List\n</code></pre>\n\n<p>Which again worked.</p>\n\n<p>Finally, I tested the infix problem just to be sure by changing it to:</p>\n\n<pre><code>data List\n    = Nil\n    | ((Type -&gt; Type) -&gt; Type -&gt; Type) ::: List\n</code></pre>\n\n<p>Which, to my surprise, <strong>failed</strong> with your familiar error message <code>Operator applied to too few arguments</code>.  So it seems you have found <em>two</em> bugs.  Somebody doesn't understand polykinds who should, and somebody doesn't understand type operators who should.  I haven't dug deep enough to find out who is wrong.</p>\n"}], "owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1591454463, "creation_date": 1577413635, "last_edit_date": 1591454463, "question_id": 59495357, "link": "https://stackoverflow.com/questions/59495357/hint-interpret-gives-a-compiler-error-when-used-on-a-polysemy-sem-value", "title": "Hint.interpret gives a compiler error when used on a Polysemy.Sem value", "body": "<p>I'm trying to compile <a href=\"https://hackage.haskell.org/package/polysemy-1.2.3.0/docs/Polysemy.html\" rel=\"nofollow noreferrer\">Polysemy</a> monad values at runtime using Hint (<a href=\"https://hackage.haskell.org/package/hint-0.9.0.2/docs/Language-Haskell-Interpreter.html\" rel=\"nofollow noreferrer\">Language.Haskell.Interpreter</a>).</p>\n\n<p>When I try to do this I reliably get an error about improper use of the <code>:</code> operator in \"interactive\" code; it seems as if the text hint is passing to GHC has a syntax error in it.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DataKinds #-}\n\nmodule Main where\n\nimport Polysemy (Embed, embed, runM, Sem)\nimport Language.Haskell.Interpreter (as, interpret, Interpreter, runInterpreter, setImportsQ)\nimport Data.Typeable (typeOf)\nimport Control.Monad.IO.Class (liftIO)\n\nmain :: IO ()\nmain = do\n  -- Hint works fine to interpret a String:\n  m &lt;- interpretWithErrors exampleHint\n  print m\n  -- And Sem works fine:\n  runM exampleSem\n  -- But notice the weird detected type:\n  print $ typeOf exampleSem\n  -- And now Hint fails to interpret a Sem:\n  s &lt;- interpretWithErrors exampleBoth\n  print $ typeOf s\n  runM s\n\ntype MyEffect = Sem '[Embed IO] ()\n\nexampleSem :: MyEffect\nexampleSem = embed $ print \"Successful Sem!\"\n\nexampleHint :: Interpreter String\nexampleHint = do\n  setImportsQ [(\"Prelude\", Nothing)]\n  interpret \"\\\"Successful Hint!\\\"\" (as :: String)\n\nexampleBoth :: Interpreter MyEffect\nexampleBoth = do\n  setImportsQ [(\"Prelude\", Nothing), (\"Polysemy\", Nothing)]\n  liftIO $ print \"Successfully imported!\"\n  -- This is where it fails:\n  s &lt;- interpret \"embed $ print \\\"Success!\\\"\" (as :: MyEffect)\n  liftIO $ print \"Successfully interpreted!\"\n  return s\n\ninterpretWithErrors :: Interpreter a -&gt; IO a\ninterpretWithErrors i_a = do\n  e_e_a &lt;- runInterpreter i_a\n  either (ioError . userError . show) (return) e_e_a\n</code></pre>\n\n<p>Running the above prints:</p>\n\n<pre><code>\"Successful Hint!\"\n\"Successful Sem!\"\nSem (': ((* -&gt; *) -&gt; * -&gt; *) (Embed IO) ('[] ((* -&gt; *) -&gt; * -&gt; *))) ()\n\"Successfully imported!\"\nHint-Polysemy: user error (WontCompile [GhcError {errMsg = \"&lt;interactive&gt;:3:41: error: Operator applied to too few arguments: :\"}])\n</code></pre>\n\n<p>Some notes:</p>\n\n<ul>\n<li>I'm using cabal, and in order to pass the <code>import</code> line within the interpreter monad I have to run this from within a cabal sandboxed shell because Polysemy isn't installed to my machine at large.</li>\n<li>That said, I don't think cabal or importing Polysemy is the problem. I can get the exact same error message as above if I just neglect to import Polysemy and just <code>setImportsQ [(\"Prelude\", Nothing)]</code>.</li>\n<li>The string I'm interpreting doesn't even need to be a valid expression; I can put jibberish in there without changing the error. This suggests to me that the problem is with <code>(as :: MyEffect)</code>.</li>\n<li>I include <code>typeOf</code> to demonstrate that <code>MyEffect</code> is in fact <code>Typeable</code>. </li>\n<li>I have no idea why <code>typeOf exampleSem</code> is giving such a long and weird type signature. I do think that this somehow is the problem. Rearranging <code>MyEffect</code> to <code>type MyEffect = Sem ((Embed IO) : []) ()</code> has no effect.</li>\n</ul>\n\n<p><strong>Is it clear to anyone if I'm doing something wrong? How should I try to debug this problem?</strong><br>\nSupposing this were a bug in hint, polysemy, or (less likely) in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Type-Reflection.html#t:Typeable\" rel=\"nofollow noreferrer\">Type.Reflection.Typeable</a>, what would my next step be to try to fix it? I assume I'd somehow have to pin down which library it is that having the problem?</p>\n\n<p>This is a refinement of an earlier question. <a href=\"https://stackoverflow.com/questions/59446654/debug-ghc-compilation-error-returned-at-runtime-by-hints-language-haskell-inte\">Here's the original.</a></p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 3855, "user_id": 342882, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/c13b4dc095a1bcc25e008effdd5cf07a?s=128&d=identicon&r=PG", "display_name": "Daneel Yaitskov", "link": "https://stackoverflow.com/users/342882/daneel-yaitskov"}, "edited": false, "score": 0, "creation_date": 1577422100, "post_id": 59494862, "comment_id": 105165762, "body": "if it is so simple why GHC.Prim module doesn&#39;t define helper methods to Int -&gt; Int# and back?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577428844, "post_id": 59494862, "comment_id": 105167272, "body": "The &quot;back&quot; method does exist: <code>I#</code> itself."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3855, "user_id": 342882, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/c13b4dc095a1bcc25e008effdd5cf07a?s=128&d=identicon&r=PG", "display_name": "Daneel Yaitskov", "link": "https://stackoverflow.com/users/342882/daneel-yaitskov"}, "edited": false, "score": 1, "creation_date": 1577445856, "post_id": 59494862, "comment_id": 105172564, "body": "@DaneelS.Yaitskov because you&#39;re not supposed to ever need to handle the unboxed primitive types yourself. See my answer."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 4, "last_activity_date": 1577408178, "last_edit_date": 1577408178, "creation_date": 1577407723, "answer_id": 59494862, "question_id": 59494731, "link": "https://stackoverflow.com/questions/59494731/how-to-operate-with-unboxed-types-in-haskell/59494862#59494862", "title": "How to operate with unboxed types in Haskell", "body": "<p><code>Int</code>, <code>Float</code>, etc. are just <code>data</code> types in GHC:</p>\n\n<pre><code>data Int = I# Int#\ndata Float = F# Float#\n-- etc.\n</code></pre>\n\n<p>The constructors are only exported by <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Exts.html\" rel=\"nofollow noreferrer\"><code>GHC.Exts</code></a>. Import it and use the constructors to convert:</p>\n\n<pre><code>{-# LANGUAGE MagicHash #-}\n\nimport GHC.Exts\n\nmain = do I# x &lt;- readLn\n          I# y &lt;- readLn\n          print (I# (x +# y))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1577445592, "creation_date": 1577445592, "answer_id": 59500024, "question_id": 59494731, "link": "https://stackoverflow.com/questions/59494731/how-to-operate-with-unboxed-types-in-haskell/59500024#59500024", "title": "How to operate with unboxed types in Haskell", "body": "<blockquote>\n  <p>I know about code built on them is running with less overhead</p>\n</blockquote>\n\n<p>Though this is true in a sense, it's nothing you should normally worry about. GHC tries very hard to optimise away the boxes of built-in types, and I'd expect that it manages to do it well in most cases where you could do that manually as well.</p>\n\n<p>In practice, what you should be more careful about is to ensure</p>\n\n<ul>\n<li>that it actually sees the concrete <code>Int</code> or <code>Float</code> type for which it knows the unboxed form. In particular, this does <em>not</em> work for polymorphic functions (polymorphism generally relies on the boxes, like it does in OO languages).<br>If you want a function to be polymorphic and still run fast with the primitive types, make sure you add a <code>SPECIALIZE</code> annotation and/or rewrite rules.</li>\n<li>that laziness doesn't get in the way. Unboxed types are always strict, so strictness annotations can make it a lot easier for GHC to remove the boxes.</li>\n</ul>\n\n<p>And of course profile your code.</p>\n\n<p>Only if you're <em>really</em> sure you want it (e.g. to ensure that the boxes won't re-appear when a new GHC that optimises differently), or maybe if you'd like to get SIMD instructions in, should you actually do manual accesses to unboxed primitive types.</p>\n"}], "owner": {"reputation": 3855, "user_id": 342882, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/c13b4dc095a1bcc25e008effdd5cf07a?s=128&d=identicon&r=PG", "display_name": "Daneel Yaitskov", "link": "https://stackoverflow.com/users/342882/daneel-yaitskov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 59494862, "answer_count": 2, "score": 1, "last_activity_date": 1577445592, "creation_date": 1577406011, "question_id": 59494731, "link": "https://stackoverflow.com/questions/59494731/how-to-operate-with-unboxed-types-in-haskell", "title": "How to operate with unboxed types in Haskell", "body": "<p>There is unboxed types GHC for Int, Float, etc.\nI know about code built on them is running with less overhead,\nbut I don't see a way how to input and output data to/from a function based on unboxed Int i.e.</p>\n\n<p>GHC.Exts defines functions (+#) and (*#), but I cannot find function boxing/unboxy</p>\n\n<pre><code>  readInt:: String -&gt; Int#\n  showInt:: Int# -&gt; String\n\n  boxInt :: Int# -&gt; Int\n  unboxInt :: Int -&gt; Int#\n</code></pre>\n\n<p>instance Show Int# and instance Read Int# cannot exist because show and read polymorphic. </p>\n\n<p>Without these function how could I integrated optimized code block on unboxed types with the rest of application?</p>\n"}, {"tags": ["haskell", "io", "haskell-stack", "ghci", "args"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "edited": false, "score": 0, "creation_date": 1577406841, "post_id": 59494722, "comment_id": 105163501, "body": "It solved the first error but now it gives me a new one."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "edited": false, "score": 2, "creation_date": 1577406970, "post_id": 59494722, "comment_id": 105163522, "body": "Well, if you have a different question, feel free to post it to StackOverflow. I&#39;m sure somebody will be able to answer."}, {"owner": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "edited": false, "score": 0, "creation_date": 1577408827, "post_id": 59494722, "comment_id": 105163789, "body": "Couldn&#39;t match expected type \u2018String -&gt; String\u2019           with actual type \u2018[Char]\u2019 In the first argument of \u2018mainWith\u2019, namely \u2018myFunction\u2019   In the expression: mainWith myFunction   In an equation for \u2018main\u2019:       main         = mainWith myFunction         where             mainWith function               = do args &lt;- getArgs | 34 | main = mainWith myFunction | Variable not in scope: input :: String  | 41 | myFunction = concat (map (++&quot;\\n&quot;) (map head (map words (lines input))))"}, {"owner": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "edited": false, "score": 0, "creation_date": 1577408986, "post_id": 59494722, "comment_id": 105163817, "body": "Sorry, something weird is happening with my internet, the other comment wasn&#39;t being posted. Also sorry for the horrible formatting"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 3, "last_activity_date": 1577405920, "creation_date": 1577405920, "answer_id": 59494722, "question_id": 59494645, "link": "https://stackoverflow.com/questions/59494645/why-am-i-getting-a-parse-error-and-how-can-i-solve-this-error-in-haskell/59494722#59494722", "title": "Why am i getting a parse error and how can i solve this error in haskell?", "body": "<p>Your indentation is off. </p>\n\n<p>Haskell is sensitive to whitespace. In particular, among other things, the \"inside\" of a \"block\" must generally be indented farther to the right than the beginning of that block. In your case this means that the inside of <code>do</code> must be indented to the right of <code>mainWith</code> on the preceding line.</p>\n\n<p>Try this:</p>\n\n<pre><code>main = mainWith myFunction\n  where mainWith function = do\n          args &lt;- getArgs\n          case args of\n            [input,output] -&gt; interactWith function input output\n            _ -&gt; putStrLn \"error: exactly two arguments needed\"\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1577405920, "creation_date": 1577405088, "question_id": 59494645, "link": "https://stackoverflow.com/questions/59494645/why-am-i-getting-a-parse-error-and-how-can-i-solve-this-error-in-haskell", "title": "Why am i getting a parse error and how can i solve this error in haskell?", "body": "<p>I'm new to Haskell and while reading real-world Haskell I came across a problem:</p>\n\n<p>Q) Using the command framework from the earlier section \u201cA Simple Command-Line Framework\u201d on page 71, write a program that prints the first word of each line of its input.</p>\n\n<p>The command framework is:</p>\n\n<pre><code>-- file: ch04/InteractWith.hs\n-- Save this in a source file, e.g., Interact.hs\n\nimport System.Environment (getArgs)\n\ninteractWith function inputFile outputFile = do\n  input &lt;- readFile inputFile\n  writeFile outputFile (function input)\n\nmain = mainWith myFunction\n  where mainWith function = do\n      args &lt;- getArgs\n      case args of\n        [input,output] -&gt; interactWith function input output\n        _ -&gt; putStrLn \"error: exactly two arguments needed\"\n-- replace \"id\" with the name of our function below\nmyFunction = id\n</code></pre>\n\n<p>My solution to the problem is:</p>\n\n<pre><code>-- file: ch04/InteractWith.hs\n-- Save this in a source file, e.g., Interact.hs\n\nimport System.Environment (getArgs)\n\ninteractWith function inputFile outputFile = do\n  input &lt;- readFile inputFile\n  writeFile outputFile (function input)\n\nmain = mainWith myFunction\n  where mainWith function = do\n      args &lt;- getArgs\n      case args of\n        [input,output] -&gt; interactWith function input output\n        _ -&gt; putStrLn \"error: exactly two arguments needed\"\n-- replace \"id\" with the name of our function below\nmyFunction = concat (map (++\"\\n\") (map head (map words (lines input))))\n</code></pre>\n\n<p>As per instructions, whenever I try to compile this program using <code>ghc --make filename</code> I get a parse error i.e. </p>\n\n<pre><code>error: parse error on input \u2018args\u2019\n   |\n36 |       args &lt;- getArgs\n   |       ^^^^\n</code></pre>\n"}, {"tags": ["haskell", "purescript"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1577400728, "post_id": 59494203, "comment_id": 105162462, "body": "Is this about having PS type information at runtime? I know nothing about PS, but I would assume PS types are erased at compilation time."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1577554710, "post_id": 59494203, "comment_id": 105198355, "body": "This smells like, &quot;I want to do the thing the thing I&#39;m used to doing, in the new model I&#39;m learning.&quot; Tell us what problem you are trying to solve, and there&#39;s likely a Haskell-y way of solving it."}, {"owner": {"reputation": 1103, "user_id": 10941102, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-K7mEqTZGvGw/AAAAAAAAAAI/AAAAAAAAAgQ/TOgjnWfCfiM/photo.jpg?sz=128", "display_name": "szatkus", "link": "https://stackoverflow.com/users/10941102/szatkus"}, "edited": false, "score": 0, "creation_date": 1577633135, "post_id": 59494203, "comment_id": 105212368, "body": "The library must expose JS classes (i.e. functions with prototypes) and objects returned by the library&#39;s functions must be instances of these classes. To make things more fun those objects must have methods. I think I&#39;ll try to create some helpers in JS and call them by FFI. If it will end badly I&#39;ll just stay with TypeScript."}], "answers": [{"comments": [{"owner": {"reputation": 41648, "user_id": 108359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8a34d29224f05cd8bd1f480c89cf112?s=128&d=identicon&r=PG", "display_name": "Brian McKenna", "link": "https://stackoverflow.com/users/108359/brian-mckenna"}, "edited": false, "score": 2, "creation_date": 1577685532, "post_id": 59494363, "comment_id": 105223274, "body": "&quot;PureScript simply makes no promises about runtime representation&quot; as someone who has worked on PureScript, I disagree with that. Part of the point of PureScript is to have simple rules to get to the runtime presentation. I WOULD totally use instanceof on data constructors, I have no problem with that. I don&#39;t consider it to be an implementation detail, I consider it to be a core part of PureScript."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 6, "last_activity_date": 1577499562, "last_edit_date": 1577499562, "creation_date": 1577402212, "answer_id": 59494363, "question_id": 59494203, "link": "https://stackoverflow.com/questions/59494203/exposing-purescript-types-to-javascript/59494363#59494363", "title": "Exposing PureScript types to JavaScript", "body": "<p>In general the answer is \"no\". The runtime representation really depends on what the type is exactly. </p>\n\n<p>For <code>data</code> declarations, every constructor would be represented by a JS \"class\", like this:</p>\n\n<pre><code>-- PureScript:\ndata T = A Int | B\n\nx :: T\nx = A 42\n\n// JS:\nfunction A(value0) { this.value0 = value0; }\nA.create = function(value0) { return new A(value0); }\n\nfunction B() { }\nB.value = new B();\n\nvar x = A.create(42);\n</code></pre>\n\n<p>So you can technically use <code>instanceof</code> to distinguish between cases, but not to determine the type itself.</p>\n\n<p>For a <code>newtype</code>, on the other hand, the type wrapper will be completely erased, because that's the whole point of <code>newtype</code>:</p>\n\n<pre><code>-- PureScript:\nnewtype T = T Int\n\nx :: T\nx = T 42\n\n// JS:\nvar x = 42;\n</code></pre>\n\n<p>And for type synonyms (declared with the <code>type</code> keyword), there is no distinct representation. That is, the way such types are represented at runtime is the same as their right-hand side representation:</p>\n\n<pre><code>-- PureScript\ntype T = Int\n\nx :: T\nx = 42\n\n// JS:\nvar x = 42;\n</code></pre>\n\n<p>This also applies to naked records, because they are merely type synonyms too:</p>\n\n<pre><code>-- PureScript\ntype R = { x :: Int, y :: String }\n\nr :: R\nr = { x: 42, y: \"foo\" }\n\n// JS:\nvar r = { x: 42, y: \"foo\" }\n</code></pre>\n\n<hr>\n\n<p><strong>So the bottom line is:</strong> there is no good way to do this. PureScript simply makes no promises about runtime representation. It makes very good promises about program behavior, but not about how it would be implemented in JS (or whatever other backend you happen to be using).</p>\n\n<p><strong>And this is another problem:</strong> because PureScript doesn't make any promises like that, it's a very bad idea to rely on your (mine) knowledge of the current implementation, because the next version of the compiler may change it completely. PureScript can do this, because it made no promises. See how that works?</p>\n\n<p>For example, I know there is a pull request in the pipeline somewhere that would switch <code>data</code> representation to arrays, like this:</p>\n\n<pre><code>-- PureScript:\ndata T = A Int | B\n\nx, y :: T\nx = A 42\ny = B\n\n// JS:\nvar x = [\"A\", 42]\nvar y = [\"B\"]\n</code></pre>\n\n<p>If this pull request is ever accepted, your program will be broken.</p>\n\n<hr>\n\n<p>In conclusion I can also tell you that neither Elm, nor Haskell, nor Idris will exhibit the property you're after. Runtime type information is generally not a thing valued in the ML universe. One can argue it's effectively present in Idris, in a way, but not in the way you expect.</p>\n\n<p>You may want to try <a href=\"https://fable.io/\" rel=\"nofollow noreferrer\">F#/Fable</a>: it's a little bit stronger in this regard, but still not as good as on its native .NET runtime. I don't think you can just check types of F# objects from JS out of the blue, but I know that Fable does support accessing RTTI from F# itself (at extra performance cost), so you can at least make functions to do that and export them to JS.</p>\n\n<p>If you can expand a bit on what your actual problem is, then perhaps I (or someone else) would be able to suggest an alternative solution.</p>\n"}], "owner": {"reputation": 1103, "user_id": 10941102, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-K7mEqTZGvGw/AAAAAAAAAAI/AAAAAAAAAgQ/TOgjnWfCfiM/photo.jpg?sz=128", "display_name": "szatkus", "link": "https://stackoverflow.com/users/10941102/szatkus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 59494363, "answer_count": 1, "score": 2, "last_activity_date": 1577499562, "creation_date": 1577400350, "question_id": 59494203, "link": "https://stackoverflow.com/questions/59494203/exposing-purescript-types-to-javascript", "title": "Exposing PureScript types to JavaScript", "body": "<p>Can I use PureScript types in JS? For example:</p>\n\n<pre><code>type SomeType = /*type declaration*/\n\nfunc :: SomeType\nfunc = /*type construction*/\n</code></pre>\n\n<p>And then in JS do something like this:</p>\n\n<pre><code>let a = module.func()\na instanceof module.SomeType === true\n</code></pre>\n\n<p>If not if there is any Haskellish language where I can achieve it (Elm, GHCJS, Idris?)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1577398665, "post_id": 59494015, "comment_id": 105161947, "body": "Can you please add the function body you&#39;re getting errors with as well?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1577398766, "post_id": 59494015, "comment_id": 105161976, "body": "Sounds like you should be explicitly using <code>MaybeT m</code>."}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1577398820, "post_id": 59494015, "comment_id": 105161993, "body": "Also note: if <code>m</code> accepts one type argument (<code>m :: * -&gt; *</code>), then <code>m Maybe</code> is invalid, did you mean <code>m (Maybe ())</code> or a composition of <code>m</code> and <code>MaybeT</code>?"}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 1, "creation_date": 1577399455, "post_id": 59494015, "comment_id": 105162176, "body": "Still looks like <code>MaybeT</code> - what do you want to do inside the function? What are the error messages, if any?"}], "answers": [{"comments": [{"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "edited": false, "score": 0, "creation_date": 1577439150, "post_id": 59494297, "comment_id": 105170128, "body": "Thankyou, it really wasn&#39;t obvious to me how MaybeT would help, but this makes it clear."}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 5, "last_activity_date": 1577401488, "creation_date": 1577401488, "answer_id": 59494297, "question_id": 59494015, "link": "https://stackoverflow.com/questions/59494015/how-to-declare-that-the-composition-of-two-types-is-a-monad/59494297#59494297", "title": "How to declare that the composition of two types is a monad", "body": "<blockquote>\n  <p>But opCode returns a <code>m (Maybe a)</code> and I want <code>full</code> to be an <code>a</code></p>\n</blockquote>\n\n<p>Looks like you want to use the <a href=\"https://www.stackage.org/haddock/lts-14.18/transformers-0.5.6.2/Control-Monad-Trans-Maybe.html#v:runMaybeT\" rel=\"noreferrer\"><code>MaybeT</code> <em>monad transformer</em></a>, which is <code>m (Maybe a)</code> under the hood, with its <code>Monad</code> instance doing what you need:</p>\n\n<blockquote>\n  <p>The MaybeT monad transformer extends a monad with the ability to exit the computation without returning a value.</p>\n  \n  <p>A sequence of actions produces a value only if all the actions in the sequence do. If one exits, the rest of the sequence is skipped and the composite action exits.</p>\n</blockquote>\n\n<p>Here are the types:</p>\n\n<pre><code>MaybeT :: m (Maybe a) -&gt; MaybeT m a\n\nrunMaybeT :: MaybeT m a -&gt; m (Maybe a)\n</code></pre>\n\n<p>This will also be helpful, specialised from <code>MonadTrans</code>:</p>\n\n<pre><code>lift :: m a -&gt; MaybeT m a \n</code></pre>\n\n<p>So in your case:</p>\n\n<pre><code>step :: forall m . (MonadState IntCodeState m) =&gt; m (Maybe ())\nstep = runMaybeT $ do\n    full &lt;- MaybeT opCode -- :: MaybeT opCode :: MaybeT m a, full :: a\n    let len = length (snd full) + 1\n    lift $ process full &lt;* (next += len)\n</code></pre>\n\n<p>I've assumed <code>process</code> returns an <code>m ()</code> and used <code>lift</code> to change it into <code>MaybeT m ()</code>.</p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 59494297, "answer_count": 1, "score": 2, "last_activity_date": 1577401488, "creation_date": 1577398574, "last_edit_date": 1577400802, "question_id": 59494015, "link": "https://stackoverflow.com/questions/59494015/how-to-declare-that-the-composition-of-two-types-is-a-monad", "title": "How to declare that the composition of two types is a monad", "body": "<p>I have function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>step :: forall m . (MonadState IntCodeState m) =&gt; m (Maybe ())\n</code></pre>\n\n<p>When I use <code>do</code> notation in the body of the function, it uses <code>m</code> as the monad. As you might expect, I actually want it to be using <code>m Maybe</code>. But, it doesn't understand that <code>m Maybe</code> is a monad. How do I express that to Haskell?</p>\n\n<p>EDIT: This may be slightly malformed at the moment. The concrete type should be\n<code>StateT IntCodeState Maybe ()</code>, but I'm trying not to declare the concrete type, so the question is: how do I declare that?</p>\n\n<p>EDIT 2: Another attempt: I've got some functions that look like this:</p>\n\n<pre><code>getValueIndex :: (MonadState IntCodeState m) =&gt; Int -&gt; m (Maybe Int)\n</code></pre>\n\n<p>Here, I'm working on the level of the state monad. However, I now want to be able to act \"as if\" <code>m Maybe</code> was the monad. I was hoping this was simple but I can't figure out a way of expressing it. The code I want to write looks like this</p>\n\n<pre><code>step :: forall m . (MonadState IntCodeState m) =&gt; m (Maybe ())\nstep = do\n    full &lt;- opCode\n    let len = length (snd full) + 1\n    process full &lt;* (next += len)\n</code></pre>\n\n<p>But opCode returns a <code>m (Maybe a)</code> and I want <code>full</code> to be an <code>a</code></p>\n"}, {"tags": ["haskell", "design-patterns", "pattern-matching", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577416394, "post_id": 59490601, "comment_id": 105164902, "body": "Would this approach become &quot;cleaner&quot; if we removed the <code>new</code> function from the type class and have something like this: <code>data Quantile a = Quantile a &lt;state&gt;</code>, with a constructor method <code>quantile :: Floating f =&gt; f -&gt; Quantile f</code> and then only define <code>get</code> and <code>put</code> for each? Now that I am thinking about this further: wouldn&#39;t this approach prevent having something like a <code>Data.Map</code> of <code>String -&gt; Aggregate</code> since it is not a single type? I think that is a drawback worthy of mentioning."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577437213, "post_id": 59490601, "comment_id": 105169496, "body": "@DanielLovasko Yes, that&#39;s a drawback which could be overcome with existential types, but in such case we fall into this antipattern: <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">lukepalmer.wordpress.com/2010/01/24/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1577375395, "creation_date": 1577375395, "answer_id": 59490601, "question_id": 59490429, "link": "https://stackoverflow.com/questions/59490429/design-pattern-for-subclass-like-structure/59490601#59490601", "title": "Design pattern for subclass-like structure", "body": "<p>It's hard to give a general recommendation. I tend to prefer approach 1. Note that you could use</p>\n\n<pre><code>data Aggregate a\n  = Average    AverageState\n  | Variance   VarianceState\n  | Quantile a QuantileState\n</code></pre>\n\n<p>and export every constructor above, keeping only the <code>...State</code> types private to the module.</p>\n\n<p>This might be feasible in some contexts, but not in others, so it has to be evaluated on a case by case basis.</p>\n\n<p>About approach 2, this could be more convenient if you have many constructors / types around. To fix the <code>new</code> problem, one could use type families (or fundeps) as in</p>\n\n<pre><code>class Floating f =&gt; Aggregate a f where\n  type AggregateNew a f\n  new :: AggregateNew a f -&gt; a f\n  get :: a f -&gt; Maybe f\n  put :: ...\n\ninstance Floating f =&gt; Aggregate Average f where\n  type AggregateNew (Average a) f = ()\n  new () = ...\n\ninstance Floating f =&gt; Aggregate Quantile f where\n  type AggregateNew (Quantile a) f = a\n  new x = ...\n</code></pre>\n\n<p>The naming above is horrible, but I used it to make the point. <code>new</code> takes an argument of type <code>AggregateNew k f</code> which can be <code>()</code> if <code>new</code> needs no information, or some more informative type when it is needed, like <code>a</code> for creating a <code>Quantile</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1577383437, "post_id": 59491774, "comment_id": 105158066, "body": "Not just a close match to the paradigm; it is also a close analogue to how many OO languages implement their object system. The set of functions associated with the type are its &quot;vtable&quot;, allowing for dispatch to any number of &quot;subclass&quot; implementations."}, {"owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577416441, "post_id": 59491774, "comment_id": 105164913, "body": "What&#39;s the behaviour of this solution with respect to laziness? Wouldn&#39;t the new <code>Aggregate</code> instance create a new thunk upon each invocation?"}, {"owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577416790, "post_id": 59491774, "comment_id": 105164981, "body": "This is really interesting, as you have completely avoided using ADTs to represent the different choice and essentially you lock the user in their choice of aggregate, which is really clever. Is this solution more performant as there is no pattern matching that needs to be performed?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577417461, "post_id": 59491774, "comment_id": 105165080, "body": "@DanielLovasko, with each call to <code>put</code> a closure (not quite the same as a thunk) is created.  And thunks for <code>n+1</code> and <code>total+x</code> will also be created, but you could make those strict.  In fact if you put in a lot of data before <code>get</code>ting, you should make those strict so you don&#39;t get thunk buildup: <code>go !n !total x = ...</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577417757, "post_id": 59491774, "comment_id": 105165134, "body": "@DanielLovasko, Of course you should always use measurements to assess performance; however I don&#39;t suspect the performance of this to be significantly different from the ADT solution (as long as you avoid the thunk buildup problem)\u2013\u2013they are almost the same thing, except this uses a closure call instead of a pattern match.  danidiaz&#39;s solution is the same as this, except, because it avoids recursion, the optimizer might have an easier time with it (the optimizer can&#39;t always &quot;flatten&quot; recursive abstractions because they might diverge)."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1577388758, "last_edit_date": 1577388758, "creation_date": 1577382819, "answer_id": 59491774, "question_id": 59490429, "link": "https://stackoverflow.com/questions/59490429/design-pattern-for-subclass-like-structure/59491774#59491774", "title": "Design pattern for subclass-like structure", "body": "<p>You are missing the \"codata\" encoding, which sounds like it might be the best fit for your problem.</p>\n\n<pre><code>data Aggregate a = Aggregate \n    { get :: Maybe a\n    , put :: a -&gt; Aggregate a\n    }\n\n-- Use the closure to keep track of local state.\nnewAverage :: (Floating a) =&gt; Aggregate a\nnewAverage = Aggregate { get = Nothing, put = go 0 0 }\n    where\n    go n total x = Aggregate { get = Just ((total + x) / (n+1))\n                             , put = go (n+1) (total+x)\n                             }\n\n-- Parameters are not a problem.\nnewQuantile :: (Floating a) =&gt; a -&gt; Aggregate a\nnewQuantile p = Aggregate { get = ... ; put = \\x -&gt; ... }\n\n...\n</code></pre>\n\n<p>For some reason this approach always slips under the radar of people with OO backgrounds, which is strange because it is a pretty close match to that paradigm.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1577398476, "post_id": 59492178, "comment_id": 105161907, "body": "Just want to mention that this is equivalent in expressivity to my codata version (<code>Aggregator a ~ Fold a (Maybe a)</code>), though i think <code>Fold</code>s are easier for the compiler to optimize because they are non recursive.  In fact, TIL every recursive type <code>Mu f</code> has an equivalent non-recursive existential version <code>\u2203s. s &#215; (s \u2192 f s)</code> (when <code>f</code> is a <code>Functor</code>)."}, {"owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577416538, "post_id": 59492178, "comment_id": 105164937, "body": "I am definitely aware that the problem I am describing is similar to a fold, but is my thinking correct to say that this wouldn&#39;t allow intermediate <code>get</code> of the value, only once the fold is completed?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577418851, "post_id": 59492178, "comment_id": 105165280, "body": "@DanielLovasko, that&#39;s not correct, it <i>is</i> possible to get intermediate values by repeatedly sending the intermediate states to the observer function. <a href=\"https://gist.github.com/luqui/ed51bd523e025a5f4b98feaffcdec8f6\" rel=\"nofollow noreferrer\">Here is an example</a>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1577429251, "post_id": 59492178, "comment_id": 105167382, "body": "@luqui Is there a paper or post that explains the equivalence of the recursive and existential versions?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "edited": false, "score": 0, "creation_date": 1577430293, "post_id": 59492178, "comment_id": 105167683, "body": "@DanielLovasko To extract intermediate values, besides converting the fold into a scan like @luqui explains, another option would be to use the <code>duplicate :: Fold a b -&gt; Fold a (Fold a b)</code> function from <code>Comonad</code>. The idea is that it lets you run a <code>Fold</code> with partial input. You can then keep feeding the resulting <code>Fold</code> with additional input, extract the result right away, or both."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1577434510, "post_id": 59492178, "comment_id": 105168710, "body": "@danidiaz not that I know of; I was just messing around after reading your post and found a bijection"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1577385350, "creation_date": 1577385350, "answer_id": 59492178, "question_id": 59490429, "link": "https://stackoverflow.com/questions/59490429/design-pattern-for-subclass-like-structure/59492178#59492178", "title": "Design pattern for subclass-like structure", "body": "<p>There is a third approach for defining \u201caggregators\u201d that neither requires an inextensible  sum type nor multiple datatypes + a typeclass.</p>\n\n<p><strong>Approach 3: Single-constructor datatype that puts state behind an existential</strong> </p>\n\n<p>Consider this type:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\ndata Fold a b = forall x. Fold (x -&gt; a -&gt; x) x (x -&gt; b)\n</code></pre>\n\n<p>It represents an aggregator that ingests values of type <code>a</code> and eventually \"returns\" a value of type <code>b</code> while carrying an internal state <code>x</code>.</p>\n\n<p>The constructor has type <code>(x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b</code>. It takes a step function, an initial state and a final \"summary\" function. Notice that the state is decoupled from the return value <code>b</code>. They can be the same, but it's not required.</p>\n\n<p>Also, the state is <a href=\"https://downloads.haskell.org/ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=existentialquantification#extension-ExistentialQuantification\" rel=\"nofollow noreferrer\">existentially quantified</a>. We know the type of the state when we create a <code>Fold</code>, and we can work with it when we pattern-match on the <code>Fold</code>\u2014in order to feed it data through the step function\u2014but it's not reflected in the <code>Fold</code>'s type. We can put <code>Fold</code> values with different inner states in the same container without problems, as long as they ingest and return the same types.</p>\n\n<p>This pattern is sometimes called a \u201cbeautiful fold\u201d. There is a library called <a href=\"http://hackage.haskell.org/package/foldl\" rel=\"nofollow noreferrer\">foldl</a> that is based on it, and provides may premade folds and utility functions.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/foldl-1.4.5/docs/Control-Foldl.html\" rel=\"nofollow noreferrer\"><code>Fold</code></a> type in <a href=\"http://hackage.haskell.org/package/foldl\" rel=\"nofollow noreferrer\">foldl</a> has many useful instances. In particular, the <code>Applicative</code> instance lets us create composite folds that still traverse the input data a single time, instead of requiring multiple passes.</p>\n"}], "owner": {"reputation": 427, "user_id": 4585063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10205618035027960/picture?type=large", "display_name": "Daniel Lovasko", "link": "https://stackoverflow.com/users/4585063/daniel-lovasko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 59491774, "answer_count": 3, "score": 3, "last_activity_date": 1577388758, "creation_date": 1577374345, "question_id": 59490429, "link": "https://stackoverflow.com/questions/59490429/design-pattern-for-subclass-like-structure", "title": "Design pattern for subclass-like structure", "body": "<p>My goal is to represent a set of types with a similar behaviour in a elegant and performant manner. To achieve this, I have created a solution that utilises a single type, followed by a set of functions that perform pattern matching.</p>\n\n<p>My first question is: is there a way how to represent the same ideas using a single type-class and instead of having a constructor per each variation to have a type that implements said type-class?</p>\n\n<p>Which of the two approaches below is:\n - a better recognised design pattern in Haskell?\n - more memory efficient?\n - more performant?\n - more elegant and why?\n - easier to use for consumers of the code? </p>\n\n<h2>Approach 1: Single type and pattern matching</h2>\n\n<p>Suppose there is a following structure:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Aggregate a\n  = Average    &lt;some necessary state keeping&gt;\n  | Variance   &lt;some necessary state keeping&gt;\n  | Quantile a &lt;some necessary state keeping&gt;\n</code></pre>\n\n<p>It's constructors are not public as that would expose the internal state keeping. Instead, a set of constructor functions exist:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newAverage :: Floating a\n  =&gt; Aggregate a\nnewAverage = Average ...\n\nnewVariance :: Floating a\n  =&gt; Aggregate a\nnewVariance = Variance ...\n\nnewQuantile :: Floating a\n  =&gt; a                     -- ! important, a parameter to the function\n  -&gt; Aggregate a\nnewQuantile p = Quantile p ...\n</code></pre>\n\n<p>Once the object is created, we can perform two functions: <code>put</code> values into it, and once we are satisfied, we can <code>get</code> the current value:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>get :: Floating a\n  =&gt; Aggregate a\n  -&gt; Maybe a\nget (Average &lt;state&gt;) = getAverage &lt;state&gt;\nget (Variance &lt;state&gt;) = getVariance &lt;state&gt;\nget (Quantile _ &lt;state&gt;) = getQuantile &lt;state&gt;\n\nput :: Floating a\n  =&gt; a\n  -&gt; Aggregate a\n  -&gt; Aggregate a\nput newVal (Average &lt;state&gt;) = putAverage newVal &lt;state&gt;\nput newVal (Variance &lt;state&gt;) = putVariance newVal &lt;state&gt;\nput newVal (Quantile p &lt;state&gt;) = putQuantile newVal p &lt;state&gt;\n</code></pre>\n\n<h2>Approach 2: Type-classes and instances</h2>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Aggregate a where\n  new :: a\n  get :: Floating f =&gt; a f -&gt; Maybe f\n  put :: Floating f =&gt; \n\ndata Average a = Average Word64 a\ndata Variance a ...\n\ninstance Aggregate Average where\n\ninstance Aggregate Variance where\n\ninstance Aggregate Quantile where\n</code></pre>\n\n<p>The obvious problem here is the fact that <code>new</code> is not parametric and thus <code>Quantile</code> can't be initialised with the <code>p</code> parameter. Adding a parameter to <code>new</code> is possible, but it would result in all other non-parametric constructors to ignore the value, which is not a good design.</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577375685, "post_id": 59489494, "comment_id": 105155592, "body": "It can be read as &quot;many means either some or none at all&quot; and &quot;some means one item followed by many&quot;. This recursive definition makes &quot;many&quot; mean &quot;0 or more&quot; and &quot;some&quot; mean &quot;1 or more&quot;. Very close to a context-free-grammar definition."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1577384731, "post_id": 59489494, "comment_id": 105158418, "body": "The execution of the <code>v</code> parameter\u2014an Alternative action\u2014is expected to &quot;fail&quot; eventually, putting an end to the recursion."}], "answers": [{"tags": [], "owner": {"reputation": 1148, "user_id": 11619101, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pgyla3H7sk4/AAAAAAAAAAI/AAAAAAAAABc/XQ20NuIAEmM/photo.jpg?sz=128", "display_name": "Yuri Kovalenko", "link": "https://stackoverflow.com/users/11619101/yuri-kovalenko"}, "is_accepted": false, "score": 2, "last_activity_date": 1577372003, "creation_date": 1577372003, "answer_id": 59490015, "question_id": 59489494, "link": "https://stackoverflow.com/questions/59489494/mutual-reference-in-function-definition/59490015#59490015", "title": "mutual reference in function definition", "body": "<p>Let's look at <code>some_v = (:) &lt;$&gt; v &lt;*&gt; many_v</code>. We know</p>\n\n<pre><code>v :: f a\n(:) :: a -&gt; [a] -&gt; [a]\n(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>(:) &lt;$&gt; v :: f ([a] -&gt; [a])\n</code></pre>\n\n<p>Let's now look at <code>&lt;*&gt; :: Applicative f =&gt; f (x -&gt; y) -&gt; f x -&gt; f y</code>. First arg is <code>(:) &lt;$&gt; v :: f ([a] -&gt; [a])</code>, so <code>x ~ [a]</code> and <code>y ~ [a]</code>. And that means, that <code>many_v :: f [a]</code> and <code>some_v :: f [a]</code>.</p>\n\n<p>Also let's check <code>many_v = some_v &lt;|&gt; pure []</code> definition. We have:</p>\n\n<pre><code>pure :: Applicative f =&gt; a -&gt; f a\n(&lt;|&gt;) :: Alternative f =&gt; f a -&gt; f a -&gt; f a\n</code></pre>\n\n<p>So:</p>\n\n<pre><code>pure [] :: f [a]\nsome_v :: f [a]\n-- so we have:\nsome_v &lt;|&gt; pure [] :: f [a]\n-- and by definition\nmany_v :: f [a]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "is_accepted": true, "score": 4, "last_activity_date": 1577372849, "creation_date": 1577372849, "answer_id": 59490167, "question_id": 59489494, "link": "https://stackoverflow.com/questions/59489494/mutual-reference-in-function-definition/59490167#59490167", "title": "mutual reference in function definition", "body": "<p>both of the functions have signatures like </p>\n\n<pre><code>many_v :: (Alternative f) =&gt; f [a]\nsome_v :: (Alternative f) =&gt; f [a]\n</code></pre>\n\n<p>Replacing bindings with their definitions you can simplify </p>\n\n<pre><code>some v = some_v\n  where\n    some_v = (:) &lt;$&gt; v &lt;*&gt; (some_v &lt;|&gt; pure [])\n\nmany v = many_v\n  where\n    many_v = ( (:) &lt;$&gt; v &lt;*&gt; many_v) &lt;|&gt; pure []\n</code></pre>\n\n<hr>\n\n<pre><code>some v = (:) &lt;$&gt; v &lt;*&gt; (some v &lt;|&gt; pure [])\nmany v = ((:) &lt;$&gt; v &lt;*&gt; many v) &lt;|&gt; pure []\n</code></pre>\n\n<hr>\n\n<p>Normally you define these functions simply as</p>\n\n<pre><code>many v = some v &lt;|&gt; pure []\nsome v = (:) &lt;$&gt; v &lt;*&gt; many v\n</code></pre>\n\n<p>In most projects recursive functions are defined worker wrapper functions in order to enable compiler do more optimizations</p>\n"}], "owner": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 59490167, "answer_count": 2, "score": 3, "last_activity_date": 1577372849, "creation_date": 1577368883, "question_id": 59489494, "link": "https://stackoverflow.com/questions/59489494/mutual-reference-in-function-definition", "title": "mutual reference in function definition", "body": "<p><code>some</code> &amp; <code>many</code> defined <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Applicative.html#v:some\" rel=\"nofollow noreferrer\">here</a> have internal expressions which refer to each other. I'm finding this difficult to understand. </p>\n\n<pre><code>some :: f a -&gt; f [a]\nsome v = some_v\n  where\n    many_v = some_v &lt;|&gt; pure []\n    some_v = (:) &lt;$&gt; v &lt;*&gt; many_v\n\n-- | Zero or more.\nmany :: f a -&gt; f [a]\nmany v = many_v\n  where\n    many_v = some_v &lt;|&gt; pure []\n    some_v = (:) &lt;$&gt; v &lt;*&gt; many_v\n</code></pre>\n\n<p>What would be the type signatures of <code>many_v</code> and <code>some_v</code>?</p>\n\n<p>How does the following get evaluated (using <code>parsec</code>)?</p>\n\n<pre><code>Prelude Text.Parsec&gt; parse (many (oneOf \"abc\")) mempty \"abc\"\nRight \"abc\"\n</code></pre>\n"}]