[{"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "edited": false, "score": 0, "creation_date": 1449098857, "post_id": 34054758, "comment_id": 55864326, "body": "Thanks very much - quick response. I&#39;ll give this a go tomorrow when I&#39;ve got some time to play."}], "tags": [], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "is_accepted": true, "score": 4, "last_activity_date": 1449097310, "creation_date": 1449097310, "answer_id": 34054758, "question_id": 34054556, "link": "https://stackoverflow.com/questions/34054556/mapm-of-fn-returning-m-either-over-either-parameter-ends-up-with-nested-either/34054758#34054758", "title": "mapM of fn returning m (Either) over Either parameter ends up with nested Eithers", "body": "<p>You've got two ways to handle it. The first is to use <code>EitherT</code> isntead of <code>Either</code>, so you can use it as a monad. This way you can just write monadic code and the <code>Either's</code> will merge into one.</p>\n\n<p>The second one (simplier to introduce into existing code) is using the <code>Control.Monad.join :: Monad m =&gt; m (m a) -&gt; m a</code> which for nested monads (like <code>Eithers</code>) gives you a single one.</p>\n"}], "owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 2, "accepted_answer_id": 34054758, "answer_count": 1, "score": 1, "last_activity_date": 1449097310, "creation_date": 1449096295, "question_id": 34054556, "link": "https://stackoverflow.com/questions/34054556/mapm-of-fn-returning-m-either-over-either-parameter-ends-up-with-nested-either", "title": "mapM of fn returning m (Either) over Either parameter ends up with nested Eithers", "body": "<p>An application takes user-input as arguments (say text that might be a numeric ID).\nWe then want to e.g. fetch something from the database using that ID.\nBoth of these operations might fail (so we reach for Either) and both involve interaction with the outside world (so IO).</p>\n\n<p>Mapping a monadic action over some structure - <code>mapM</code>, easy!</p>\n\n<pre><code>type E1 = Either String Int \n\nfetchFromDb :: Int -&gt; IO E1 \nfetchFromDb i = do   \n    return $ case (i `mod` 2 == 0) of \n        True  -&gt; Left \"Error - evens not allowed\" \n        False -&gt; Right (100 + i) \n\nmain :: IO () \nmain = do \n    n1 &lt;- fetchFromDb 1 \n    n2 &lt;- fetchFromDb 2 \n    n3 &lt;- mapRight fetchFromDb ((Right 3)::E1) \n    n4 &lt;- mapM fetchFromDb ((Right 4)::E1) \n    n5 &lt;- mapM fetchFromDb ((Left \"No Int at all\")::E1) \n    putStrLn $ \"n1 = \" ++ (show n1) \n    putStrLn $ \"n2 = \" ++ (show n2) \n    putStrLn $ \"n3 = \" ++ (show n3)\n    putStrLn $ \"n4 = \" ++ (show n4)\n    putStrLn $ \"n5 = \" ++ (show n5)\n\nn1 = Right 101\nn2 = Left \"Error - evens not allowed\"\nn3 = Right (Right 103)\nn4 = Right (Left \"Error - evens not allowed\")\nn5 = Left \"No Int at all\"\n</code></pre>\n\n<p>As can be seen above - in the event of the user supplying a bad <code>Int</code> we get the <code>Left</code> error you would expect. If we have a valid Int though the <code>Either</code> gets nested (which once I thought about the <code>Monad</code> instance definition for <code>Either</code> made sense).</p>\n\n<p>So - some sort of reduction or folding needs to take place, but I can't quite see how to hook it up and what my initial value would be.</p>\n\n<p>Footnote: I can of course simply extract the desired Int with a suitable <code>case</code> expression in this case, but I'm looking at several parameters.</p>\n"}, {"tags": ["haskell", "monads", "free-monad"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1449092600, "post_id": 34052377, "comment_id": 55861439, "body": "A bunch of functors in a chain? That&#39;s basically it... I&#39;ve always seen it as a kind of nested box of functors that you push others along. The features of the functor itself could make it a tree or fractal-like structure, but on a type level, that&#39;s not relevant."}], "answers": [{"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 15, "last_activity_date": 1449171133, "last_edit_date": 1449171133, "creation_date": 1449097349, "answer_id": 34054766, "question_id": 34052377, "link": "https://stackoverflow.com/questions/34052377/visualizing-the-free-monad/34054766#34054766", "title": "Visualizing the Free Monad", "body": "<blockquote>\n  <p>Right now, I just think of [the free monad] as the most general abstract syntax tree that you can imagine. Is that essentially it? Or am I oversimplifying it?</p>\n</blockquote>\n\n<p>You're oversimplifying it:</p>\n\n<ol>\n<li>\"Free monad\" is short for \"the free monad <strong>over a specific functor</strong>\" or the <code>Free f a</code> data type, which in reality is a different free monad for each choice of <code>f</code>.</li>\n<li>There is no one general structure that all free monads have.  Their structure breaks down into:\n\n<ul>\n<li>What is contributed by <code>Free</code> itself</li>\n<li>What is contributed by different choices for <code>f</code></li>\n</ul></li>\n</ol>\n\n<p>But let's take a different approach.  I learned free monads by first studying the closely related <a href=\"http://apfelmus.nfshost.com/articles/operational-monad.html\" rel=\"noreferrer\">operational monad</a> instead, which has a more uniform, easier-to-visualize structure.  I highly recommend you study that from the link itself.</p>\n\n<p>The simplest way to define the operational monad is like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Program instr a where\n  Return :: a -&gt; Program instr a\n  Bind :: instr x                  -- an \"instruction\" with result type `x`\n       -&gt; (x -&gt; Program instr a)   -- function that computes rest of program\n       -&gt; Program instr a          -- a program with result type `a`\n</code></pre>\n\n<p>...where the <code>instr</code> type parameter represents the \"instruction\" type of the monad, usually a GADT.  For example (taken from the link):</p>\n\n<pre><code>data StackInstruction a where\n    Pop  :: StackInstruction Int\n    Push :: Int -&gt; StackInstruction ()\n</code></pre>\n\n<p>So a <code>Program</code> in the operational monad, informally, I'd visualize it as a \"dynamic list\" of instructions, where the result produced by the execution of any instruction is used as input to the function that decides what the \"tail\" of the \"instruction list\" is.  The <code>Bind</code> constructor pairs an instruction with a \"tail chooser\" function.</p>\n\n<p>Many free monads can also be visualized in similar terms\u2014you can say that the functor chosen for a given a free monad serves as its \"instruction set.\"  But with free monads the \"tails\" or \"children\" of the \"instruction\" are managed by the <code>Functor</code> itself.  So a simple example (taken from <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"noreferrer\">Gabriel Gonz\u00e1lez's popular blog entry on the topic</a>):</p>\n\n<pre><code>data Free f r = Free (f (Free f r)) | Pure r\n\n-- The `next` parameter represents the \"tails\" of the computation.\ndata Toy b next =\n    Output b next\n  | Bell next\n  | Done\n\ninstance Functor (Toy b) where\n  fmap f (Output b next) = Output b (f next)\n  fmap f (Bell next) = Bell (f next)\n  fmap _ Done = Done\n</code></pre>\n\n<p>While in the operational monad the function used to generate the \"tail\" belongs to the <code>Program</code> type (in the <code>Bind</code> constructor), in free monads the tails belong to the \"instruction\"/<code>Functor</code> type.  This allows the free monad's \"instructions\" (an analogy that is now breaking down) to have a single \"tail\" (like <code>Output</code> or <code>Bell</code>), zero tails (like <code>Done</code>) or multiple tails if you so chose to.  Or, in another common pattern, the <code>next</code> parameter can be the result type of an embedded function:</p>\n\n<pre><code>data Terminal a next = \n    PutStrLn String next\n  | GetLine (String -&gt; next)  -- can't access the next \"instruction\" unless\n                              -- you supply a `String`.\n\ninstance Functor Terminal where\n    fmap f (PutStrLn str next) = PutStrLn str (f next)\n    fmap f (GetLine g) = GetLine (fmap f g)\n</code></pre>\n\n<p>This, incidentally, is an objection I've long had to people who refer to free or operational monads as \"syntax trees\"\u2014practical use of them requires that \"children\" of a node be opaquely hidden inside a function.  You generally can't fully inspect this \"tree\"!</p>\n\n<p>So really, when you get down to it, how to visualize a free monad comes down entirely to the structure of the <code>Functor</code> that you use to parametrize it.  Some look like lists, some look like trees, and some look like \"opaque trees\" with functions as nodes.  (Somebody once responded to my objection above with a line like \"a function is a tree node with as many children as there are possible arguments.\")</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 2, "last_activity_date": 1449177746, "last_edit_date": 1449177746, "creation_date": 1449102215, "answer_id": 34055665, "question_id": 34052377, "link": "https://stackoverflow.com/questions/34052377/visualizing-the-free-monad/34055665#34055665", "title": "Visualizing the Free Monad", "body": "<p>You may have heard</p>\n\n<blockquote>\n  <p>Monad is a monoid in a category of endofunctors</p>\n</blockquote>\n\n<p>And you mentioned already that monoids are just lists. So there you are.</p>\n\n<hr>\n\n<p>Expanding on that a bit:</p>\n\n<pre><code>data Free f a = Pure a\n              | Free (f (Free f a))\n</code></pre>\n\n<p>It's not a normal list of <code>a</code>, but a list where tail is wrapped inside <code>f</code>. You'll see it if you write a structure of value of multiple nested binds:</p>\n\n<pre><code>pure x &gt;&gt;= f &gt;&gt;= g &gt;&gt;= h :: Free m a\n</code></pre>\n\n<p>might result into</p>\n\n<pre><code>Free $ m1 $ Free $ m2 $ Free $ m3 $ Pure x\n  where m1, m2, m3 :: a -&gt; m a -- Some underlying functor \"constructors\"\n</code></pre>\n\n<p>If <code>m</code> in example above is sum type:</p>\n\n<pre><code>data Sum a = Inl a | Inr a\n  deriving Functor\n</code></pre>\n\n<p>Then the list is actually a tree, as at each constructor we can branch left or right.</p>\n\n<hr>\n\n<p>You may have heard that</p>\n\n<blockquote>\n  <p>Applicative is a monoid in a category of endofunctors</p>\n</blockquote>\n\n<p>... the category is just different. There are nice visualisations of different free applicative encodings in <a href=\"https://ro-che.info/articles/2013-03-31-flavours-of-free-applicative-functors\" rel=\"nofollow\">Roman Cheplyaka's blog post</a>.</p>\n\n<p>So free <code>Applicative</code> is also a list. I imagine it as a heterogenous list of <code>f a</code> values, and single function:</p>\n\n<pre><code> x :: FreeA f a\n x = FreeA g [ s, t, u, v]\n    where g :: b -&gt; c -&gt; d -&gt; e -&gt; a\n          s :: f b\n          t :: f c\n          u :: f d\n          v :: f e\n</code></pre>\n\n<p>In this case the the tail itself isn't wrapped in <code>f</code>, but each element separately. This might or might not help understand the difference between <code>Applicative</code> and <code>Monad</code>.</p>\n\n<p>Note, that <code>f</code> doesn't need to be <code>Functor</code> to make <code>Applicative (FreeA f a)</code>, controrary to <code>Free</code> monad above.</p>\n\n<hr>\n\n<p>There is also free <code>Functor</code></p>\n\n<pre><code>data Coyoneda f a = Coyoneda :: (b -&gt; a) -&gt; f b -&gt; Coyoneda f a  \n</code></pre>\n\n<p>which makes any <code>* -&gt; *</code> type <code>Functor</code>. Compare it with free <code>Applicative</code> above.\nIn applicative case we had a heterogenous list of length <em>n</em> of <code>f a</code> values and a n-ary function combining them.\nCoyoneda is 1-ary special case of above.</p>\n\n<hr>\n\n<p>We can combine <code>Coyoneda</code> and <code>Free</code> to make <code>Operational</code> free monad. And as other answer mentions, that one is hardy imaginable as tree, as there is functions involved. OTOH you can imagine those continuations as different, magical arrows in your picture :)</p>\n"}], "owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1923, "favorite_count": 13, "accepted_answer_id": 34054766, "answer_count": 2, "score": 19, "last_activity_date": 1542197886, "creation_date": 1449088127, "last_edit_date": 1542197886, "question_id": 34052377, "link": "https://stackoverflow.com/questions/34052377/visualizing-the-free-monad", "title": "Visualizing the Free Monad", "body": "<p>I think I have rough idea of what the free monad is, but I would like to have a better way to visualize it.</p>\n\n<p>It makes sense that free magmas are just binary trees because that's as \"general\" as you can be without losing any information.</p>\n\n<p>Similarly, it makes sense that free monoids are just lists, because the order of operations doesn't matter. There is now a redundancy in the \"binary tree\", so you can just flatten it, if that makes sense.</p>\n\n<p>It makes sense that free groups kind of look like fractals, for a similar reason: <a href=\"https://en.wikipedia.org/wiki/Cayley_graph#/media/File:Cayley_graph_of_F2.svg\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Cayley_graph#/media/File:Cayley_graph_of_F2.svg</a>\nand to get other groups, we just identify different elements of the group as being the \"same\" and we get other groups.</p>\n\n<p>How should I be visualizing the free monad? Right now, I just think of it as the most general abstract syntax tree that you can imagine. Is that essentially it? Or am I oversimplifying it?</p>\n\n<p>Also, similarly, what do we lose in going from a free monad to a list or other monads? What are we identifying to be the \"same\"?</p>\n\n<p>I appreciate all comments that shed light into this. Thanks!</p>\n"}, {"tags": ["haskell", "coding-style", "do-notation"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1449079444, "post_id": 34049703, "comment_id": 55854187, "body": "What&#39;s wrong with <code>let y = fb x</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1449080638, "post_id": 34049703, "comment_id": 55854862, "body": "Parens around a single variable are always superfluous, in <code>return (z)</code> as well as they would be in <code>fa a</code>. It is generally considered good style in Haskell to only use parentheses when they are necessary (unless of course <a href=\"http://www.willamette.edu/~fruehr/haskell/evolution.html\" rel=\"nofollow noreferrer\">you&#39;re an MIT sophomore</a>)!"}, {"owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1449082338, "post_id": 34049703, "comment_id": 55855790, "body": "@leftaroundabout right you are!"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1449079446, "creation_date": 1449079446, "answer_id": 34049844, "question_id": 34049703, "link": "https://stackoverflow.com/questions/34049703/mixing-up-monadic-functions-with-pure-functions-in-do-notation/34049844#34049844", "title": "Mixing up monadic functions with pure functions in do notation", "body": "<p>Use <code>let</code> for non-monadic bindings:</p>\n\n<pre><code>z :: a -&gt; IO c\nz a = do x &lt;- fa a\n         let y = fb x\n         z &lt;- fc y\n         return (z)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "edited": false, "score": 0, "creation_date": 1449082319, "post_id": 34049848, "comment_id": 55855775, "body": "Thanks for the options, how would you personally decide how to write it?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1449079459, "creation_date": 1449079459, "answer_id": 34049848, "question_id": 34049703, "link": "https://stackoverflow.com/questions/34049703/mixing-up-monadic-functions-with-pure-functions-in-do-notation/34049848#34049848", "title": "Mixing up monadic functions with pure functions in do notation", "body": "<p>Probably the smallest change you can make and have it still work is this:</p>\n\n<pre><code>z a = do x &lt;- fa a\n         let y = fb x\n         z &lt;- fc y\n         return z\n</code></pre>\n\n<p>There are a number of things you can do in this specific case that may not work in the more general case. You can \"inline\" the call to <code>fb</code>; eliminate the bind/return pair; and use monadic composition instead of do-notation. Putting all three of these into practice would yield</p>\n\n<pre><code>z = fa &gt;=&gt; fc . fb\n</code></pre>\n\n<p>although you can pick just the transformations that seem reasonable/readable/aesthetically pleasing for your specific case.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1449080418, "creation_date": 1449080418, "answer_id": 34050153, "question_id": 34049703, "link": "https://stackoverflow.com/questions/34049703/mixing-up-monadic-functions-with-pure-functions-in-do-notation/34050153#34050153", "title": "Mixing up monadic functions with pure functions in do notation", "body": "<p>I'd write this particular example thus:</p>\n\n<pre><code>z a = do x &lt;- fa a\n         fc $ fb x\n</code></pre>\n\n<p>or</p>\n\n<pre><code>z a = fa a &gt;&gt;= fc . fb\n</code></pre>\n"}], "owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 1, "accepted_answer_id": 34049848, "answer_count": 3, "score": 3, "last_activity_date": 1449082349, "creation_date": 1449078986, "last_edit_date": 1449082349, "question_id": 34049703, "link": "https://stackoverflow.com/questions/34049703/mixing-up-monadic-functions-with-pure-functions-in-do-notation", "title": "Mixing up monadic functions with pure functions in do notation", "body": "<p>I'm having trouble mixing up pure and monadic functions inside of do notation. I've got the feeling I am missing something obvious.</p>\n\n<p>For example, say I got these functions</p>\n\n<pre><code>fa :: a -&gt; IO b\nfb :: b -&gt; c\nfc :: c -&gt; IO d\n\nz :: a -&gt; IO c\nz a = do x &lt;- fa a\n         y &lt;- fb x\n         z &lt;- fc y\n         return z\n</code></pre>\n\n<p>This doesn't work because of the </p>\n\n<pre><code>y &lt;- fb x\n</code></pre>\n\n<p>line in z, but what is an elegant way of combining the pure fb function, with the monadic fa and fc functions?</p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1449072073, "post_id": 34047168, "comment_id": 55849139, "body": "Do you want a random sequence or a specific sequence from <code>n</code> to <code>m</code>?"}, {"owner": {"reputation": 630, "user_id": 4913220, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/NjkLC.jpg?s=128&g=1", "display_name": "Vlad Balanescu", "link": "https://stackoverflow.com/users/4913220/vlad-balanescu"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1449072137, "post_id": 34047168, "comment_id": 55849182, "body": "I want to move the first two cards which are in sequence, so those two should be returned, else, if the SEVEN is C, then nothing, because that would mean I have only 1 card, so no sequence. I can move them only from the begining, not from any other part of the list, so the head should pe on 0"}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1449072263, "post_id": 34047168, "comment_id": 55849281, "body": "you take the first two with <code>take 2 seq</code>. I don&#39;t understand the rest of your question and comment, you need to give a better explanation."}, {"owner": {"reputation": 630, "user_id": 4913220, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/NjkLC.jpg?s=128&g=1", "display_name": "Vlad Balanescu", "link": "https://stackoverflow.com/users/4913220/vlad-balanescu"}, "edited": false, "score": 0, "creation_date": 1449072638, "post_id": 34047168, "comment_id": 55849555, "body": "I am trying to see if the card on position 0 is the predecessor of the next one, if so, take it, and continue until I have a sequence of cards, else, return just []. So [(SIX,H),(SEVEN,H),(EIGHT,H),(NINE,C)] would return only the ordered sequence from the head, which is [(SIX,H),(SEVEN,H),(EIGHT,H)]"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1449072825, "post_id": 34047168, "comment_id": 55849679, "body": "If I&#39;m understanding your question now, you can use <code>Data.List.inits</code> to get all of the possible prefixes in your list and then filter that sequence based on whether or not the order is correct. Although I&#39;m still not sure what order you&#39;re looking for here."}, {"owner": {"reputation": 630, "user_id": 4913220, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/NjkLC.jpg?s=128&g=1", "display_name": "Vlad Balanescu", "link": "https://stackoverflow.com/users/4913220/vlad-balanescu"}, "edited": false, "score": 0, "creation_date": 1449073110, "post_id": 34047168, "comment_id": 55849878, "body": "And how can I do that. I only want a filter to see if the card is the predecessor otf the next one, and if so, cons it to reminder and so on..."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1449073409, "post_id": 34047168, "comment_id": 55850106, "body": "<a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example</a>"}], "answers": [{"comments": [{"owner": {"reputation": 630, "user_id": 4913220, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/NjkLC.jpg?s=128&g=1", "display_name": "Vlad Balanescu", "link": "https://stackoverflow.com/users/4913220/vlad-balanescu"}, "edited": false, "score": 0, "creation_date": 1449332318, "post_id": 34047743, "comment_id": 55965354, "body": "See the function I am having so far. That one is returning me even the first element, if there is no sequence. How can I return nothing if there is no sequence of cards?"}, {"owner": {"reputation": 630, "user_id": 4913220, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/NjkLC.jpg?s=128&g=1", "display_name": "Vlad Balanescu", "link": "https://stackoverflow.com/users/4913220/vlad-balanescu"}, "edited": false, "score": 0, "creation_date": 1449333341, "post_id": 34047743, "comment_id": 55965715, "body": "Also tried that findSeq lis@(h:(q:_))=takeWhile (sameCards h q) lis where                       sameCards crd1 crd2= Just crd1==pCard crd2 pack, but apparently I get an error of too many arguments!"}], "tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": true, "score": 3, "last_activity_date": 1449073378, "creation_date": 1449073378, "answer_id": 34047743, "question_id": 34047168, "link": "https://stackoverflow.com/questions/34047168/how-do-i-get-a-sequence-of-cards-in-haskell/34047743#34047743", "title": "How do I get a sequence of cards in haskell", "body": "<p>Note how <code>zip cards (tails cards)</code> gives you a list of sequential pairs of cards form list <code>cards</code>.</p>\n\n<p>Now you only need to <code>takeWhile</code> from this list, comparing your values and suits:</p>\n\n<pre><code>findSeq cards = takeWhile sameCards $ zip cards (tails cards) where\n  sameCards (value1, suit1) (value2, suit2) = \n     suit1 == suit2 &amp; value1 `precedes` value2\n</code></pre>\n\n<p>I suppose you have a function like <code>precedes</code> defined already.</p>\n\n<p>Note: I don't have a Haskell compiler around at the moment; the code is untried.</p>\n"}], "owner": {"reputation": 630, "user_id": 4913220, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/NjkLC.jpg?s=128&g=1", "display_name": "Vlad Balanescu", "link": "https://stackoverflow.com/users/4913220/vlad-balanescu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "closed_date": 1449643406, "accepted_answer_id": 34047743, "answer_count": 1, "score": -4, "last_activity_date": 1449332284, "creation_date": 1449071792, "last_edit_date": 1449332284, "question_id": 34047168, "link": "https://stackoverflow.com/questions/34047168/how-do-i-get-a-sequence-of-cards-in-haskell", "closed_reason": "Needs details or clarity", "title": "How do I get a sequence of cards in haskell", "body": "<p>How can I take a sequence of ordered cards in haskel, for example, if I have this sequence </p>\n\n<pre><code>findSeq [(SIX,H),(SEVEN,H),(EIGHT,C),(NINE,H)]\n</code></pre>\n\n<p>I am using a function with explicit patterns which returns a single card as well. I know to use filter, but I cannot think of a way of doing it:D I want to display something like`</p>\n\n<pre><code>[(SIX,H),(SEVEN,H)]\n</code></pre>\n\n<p>Update: I have this now</p>\n\n<pre><code>findSeq::[Card]-&gt;[Card]\nfindSeq [] = []\nfindSeq (h:t)\n|null t = [h]\n|Just h==(pCard (head t) pack)=h:findSeq t\n|otherwise=[h]\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 1, "creation_date": 1449072065, "post_id": 34047126, "comment_id": 55849132, "body": "Not <i>all</i> but many of the prelude functions concerning lists can be written in terms of <code>Foldable.foldr</code>. For example: <code>map</code>, <code>filter</code>, <code>concat</code>, <code>and</code>, <code>all</code>, <code>maximum</code>, <code>length</code>..."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 9, "creation_date": 1449072604, "post_id": 34047126, "comment_id": 55849524, "body": "I think what you are looking for are modules like <code>GHC.Prim</code> or <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html\" rel=\"nofollow noreferrer\"><code>GHC.Base</code></a> that basically define the implementation interface of built-in data types. Everything else in the prelude is bootstrapped from them, defined in terms of Haskell itself."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1449078457, "creation_date": 1449078457, "answer_id": 34049539, "question_id": 34047126, "link": "https://stackoverflow.com/questions/34047126/can-the-haskell-prelude-functions-be-reduced-to-a-set-of-core-functions/34049539#34049539", "title": "Can the Haskell prelude functions be reduced to a set of core functions?", "body": "<p>I have just walked through the <code>Prelude</code> documentation on Hackage. The only two operations I couldn't imagine implementing in \"unadorned\" Haskell are <code>error</code> and <code>seq</code>. In the case of <code>error</code>, I could even imagine implementing something in unadorned Haskell with the right denotational semantics, but which did not share the operational semantics of printing to the console.</p>\n\n<p>There would of course need to be some cooperation between the execution engine for <code>IO</code> actions and the implementation of <code>IO</code> operations, but the operations themselves could reasonably be implemented in unadorned Haskell, e.g. with a free monad over the actions available in the Prelude.</p>\n\n<p>It should not be surprising that such a tiny core is possible; after all, even the boring old lambda calculus can emulate all manner of interesting data types.</p>\n"}], "owner": {"reputation": 1193, "user_id": 886266, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/J2NM3.jpg?s=128&g=1", "display_name": "S0rin", "link": "https://stackoverflow.com/users/886266/s0rin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1449078457, "creation_date": 1449071685, "question_id": 34047126, "link": "https://stackoverflow.com/questions/34047126/can-the-haskell-prelude-functions-be-reduced-to-a-set-of-core-functions", "title": "Can the Haskell prelude functions be reduced to a set of core functions?", "body": "<p>Can the Haskell prelude functions be reduced to a set of core functions, such that all other functions can be defined in terms of the core set? If so, what are the core functions?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1449064700, "post_id": 34044366, "comment_id": 55843560, "body": "how should your function behave on the input [1,1,2,3]?"}, {"owner": {"reputation": 157, "user_id": 4817532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-J9x2IROrVFs/AAAAAAAAAAI/AAAAAAAAABA/Lct15HbADb0/photo.jpg?sz=128", "display_name": "Negar Alinaghi", "link": "https://stackoverflow.com/users/4817532/negar-alinaghi"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1449064937, "post_id": 34044366, "comment_id": 55843750, "body": "it never happens. Because the elements in the list are all unique."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 4817532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-J9x2IROrVFs/AAAAAAAAAAI/AAAAAAAAABA/Lct15HbADb0/photo.jpg?sz=128", "display_name": "Negar Alinaghi", "link": "https://stackoverflow.com/users/4817532/negar-alinaghi"}, "edited": false, "score": 0, "creation_date": 1449065079, "post_id": 34044460, "comment_id": 55843847, "body": "Many thanks! That&#39;s exactly what I was looking for :)"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 157, "user_id": 4817532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-J9x2IROrVFs/AAAAAAAAAAI/AAAAAAAAABA/Lct15HbADb0/photo.jpg?sz=128", "display_name": "Negar Alinaghi", "link": "https://stackoverflow.com/users/4817532/negar-alinaghi"}, "edited": false, "score": 0, "creation_date": 1449066348, "post_id": 34044460, "comment_id": 55844745, "body": "@NegarAlinaghi if elements of <code>l</code> are unique, using <code>nub</code> here is useless."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 0, "creation_date": 1449066626, "post_id": 34044460, "comment_id": 55844942, "body": "@lisyarus But, in general, if the list does have duplicate elements, <code>nub</code> will be needed to get unique pairs."}], "tags": [], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "is_accepted": false, "score": 2, "last_activity_date": 1449064341, "creation_date": 1449064341, "answer_id": 34044460, "question_id": 34044366, "link": "https://stackoverflow.com/questions/34044366/how-to-extract-all-unique-pairs-of-a-list-in-haskell/34044460#34044460", "title": "How to extract all unique pairs of a list in Haskell?", "body": "<p>You can use the <code>nub</code> function:</p>\n\n<pre><code>import Data.List\nuniq_pairs l = nub [(x,y) | x &lt;-l, y&lt;-l, x &lt; y]\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>*Main&gt; uniq_pairs  [1,2,3,4]\n[(1,2),(1,3),(1,4),(2,3),(2,4),(3,4)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": false, "score": 2, "last_activity_date": 1449064554, "creation_date": 1449064554, "answer_id": 34044555, "question_id": 34044366, "link": "https://stackoverflow.com/questions/34044366/how-to-extract-all-unique-pairs-of-a-list-in-haskell/34044555#34044555", "title": "How to extract all unique pairs of a list in Haskell?", "body": "<p>Looking at your example, this seems to be what you want</p>\n\n<pre><code>unique_pairs l = [(x,y) | x &lt;- l, y &lt;- l, x &lt; y]\n</code></pre>\n\n<p>By the way, these are not just <em>unique pairs</em>, but <em>unique pairs up to transposition</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 2, "creation_date": 1449066768, "post_id": 34045121, "comment_id": 55845031, "body": "This should be the answer. The other answers require the list&#39;s elements to be have an <code>Ord</code> or <code>Eq</code> instance."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 32, "last_activity_date": 1573276399, "last_edit_date": 1573276399, "creation_date": 1449066230, "answer_id": 34045121, "question_id": 34044366, "link": "https://stackoverflow.com/questions/34044366/how-to-extract-all-unique-pairs-of-a-list-in-haskell/34045121#34045121", "title": "How to extract all unique pairs of a list in Haskell?", "body": "<p>Using a list comprehension is the easiest way.</p>\n\n<pre><code>import Data.List\n\npairs :: [a] -&gt; [(a, a)]\npairs l = [(x,y) | (x:ys) &lt;- tails l, y &lt;- ys]\n</code></pre>\n\n<p>This only generates the relevant pairs so you don't have to filter out any duplicates as a separate step. <code>tails [1,2,3,4]</code> generates the lists of tails <code>[[1,2,3,4], [2,3,4], [3,4], [4], []]</code> and the list comprehension picks the first element from each tail and pairs it with the rest of the elements in that tail.</p>\n"}], "owner": {"reputation": 157, "user_id": 4817532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-J9x2IROrVFs/AAAAAAAAAAI/AAAAAAAAABA/Lct15HbADb0/photo.jpg?sz=128", "display_name": "Negar Alinaghi", "link": "https://stackoverflow.com/users/4817532/negar-alinaghi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5038, "favorite_count": 1, "closed_date": 1449079824, "answer_count": 3, "score": 7, "last_activity_date": 1573276399, "creation_date": 1449064104, "last_edit_date": 1449087954, "question_id": 34044366, "link": "https://stackoverflow.com/questions/34044366/how-to-extract-all-unique-pairs-of-a-list-in-haskell", "closed_reason": "Duplicate", "title": "How to extract all unique pairs of a list in Haskell?", "body": "<p>I am pretty new to Haskell and I have a question. How can I write a function to return all the unique possible pairs of a list? Like: \n[1,2,3,4] -> [(1,2),(1,3),(1,4),(2,3),(2,4),(3,4)] </p>\n"}, {"tags": ["java", "haskell"], "comments": [{"owner": {"reputation": 496316, "user_id": 57695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/53ee9941b3fefef67175daf212e62d41?s=128&d=identicon&r=PG", "display_name": "Peter Lawrey", "link": "https://stackoverflow.com/users/57695/peter-lawrey"}, "edited": false, "score": 0, "creation_date": 1449054696, "post_id": 34041214, "comment_id": 55837107, "body": "It sounds like you really want Java 8. Java 7 isn&#39;t publicly supported any more."}, {"owner": {"reputation": 559, "user_id": 3389669, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a013398fd6031b9d738643f8c75b7cf?s=128&d=identicon&r=PG&f=1", "display_name": "user3389669", "link": "https://stackoverflow.com/users/3389669/user3389669"}, "reply_to_user": {"reputation": 496316, "user_id": 57695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/53ee9941b3fefef67175daf212e62d41?s=128&d=identicon&r=PG", "display_name": "Peter Lawrey", "link": "https://stackoverflow.com/users/57695/peter-lawrey"}, "edited": false, "score": 0, "creation_date": 1449054728, "post_id": 34041214, "comment_id": 55837126, "body": "I have a restriction to use Java 7 in my project."}, {"owner": {"reputation": 88, "user_id": 4143637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZGvTT.png?s=128&g=1", "display_name": "Karpinski", "link": "https://stackoverflow.com/users/4143637/karpinski"}, "edited": false, "score": 0, "creation_date": 1449055070, "post_id": 34041214, "comment_id": 55837362, "body": "Actually there is not any function in Java 7 equivalent to Haskell. There is a java.util.Map in Java that works with key and value. The same way you can use an object into value, and so on..."}], "answers": [{"tags": [], "owner": {"reputation": 12492, "user_id": 1613867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06bf2dd010ad3df73fb77fe9d3a33f2e?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/1613867/dan"}, "is_accepted": false, "score": 1, "last_activity_date": 1449054917, "creation_date": 1449054917, "answer_id": 34041364, "question_id": 34041214, "link": "https://stackoverflow.com/questions/34041214/equivalent-to-map-from-haskell-in-java-7/34041364#34041364", "title": "Equivalent to map (from haskell) in Java 7", "body": "<p>I don't know such a library, but what is wrong using the plain java, like:</p>\n\n<pre><code>List&lt;String&gt; m;\nMap&lt;Key,String&gt; map = new HashMap&lt;Key,String&gt;();\nint c=1;\nfor (String i : m) map.put(i,c++);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1449115153, "post_id": 34041379, "comment_id": 55869117, "body": "That&#39;s... actually a lot less fluent than a foreach loop."}], "tags": [], "owner": {"reputation": 4726, "user_id": 185031, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ad8a20b3340cc87a7648fc1e80249811?s=128&d=identicon&r=PG", "display_name": "spa", "link": "https://stackoverflow.com/users/185031/spa"}, "is_accepted": true, "score": 12, "last_activity_date": 1449054969, "creation_date": 1449054969, "answer_id": 34041379, "question_id": 34041214, "link": "https://stackoverflow.com/questions/34041214/equivalent-to-map-from-haskell-in-java-7/34041379#34041379", "title": "Equivalent to map (from haskell) in Java 7", "body": "<p>You are asking for Java 7 (with Java 8 it's easier):</p>\n\n<p>You can use <a href=\"https://github.com/google/guava\">Guava</a> and there specifically <a href=\"http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/FluentIterable.html\">FluentIterable</a></p>\n\n<pre><code>    final List&lt;String&gt; strings = Arrays.asList(\"a\", \"b\", \"c\");\n    final List&lt;Integer&gt; integers = FluentIterable\n            .from(strings)\n            .transform(new Function&lt;String, Integer&gt;() {\n                @Nullable\n                @Override\n                public Integer apply(@Nullable String input) {\n                    return input.equals(\"a\") ? 1 : input.equals(\"b\") ? 2 : input.equals(\"c\") ? 3 : -1;\n                }\n            })\n            .toList();\n</code></pre>\n\n<p>Bonus question: A collection is an iterable :-)</p>\n"}, {"tags": [], "owner": {"reputation": 49404, "user_id": 4318868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p6Tpv.jpg?s=128&g=1", "display_name": "Slava Vedenin", "link": "https://stackoverflow.com/users/4318868/slava-vedenin"}, "is_accepted": false, "score": 2, "last_activity_date": 1449061300, "last_edit_date": 1495541697, "creation_date": 1449055237, "answer_id": 34041459, "question_id": 34041214, "link": "https://stackoverflow.com/questions/34041214/equivalent-to-map-from-haskell-in-java-7/34041459#34041459", "title": "Equivalent to map (from haskell) in Java 7", "body": "<p>You need use Stream APi from Java 8. Using official API you cann't using Stream APi in Java 7, but using:</p>\n\n<ol>\n<li><a href=\"https://github.com/orfjackal/retrolambda\" rel=\"nofollow noreferrer\">retrolambda</a>,</li>\n<li><a href=\"https://github.com/bodar/totallylazy\" rel=\"nofollow noreferrer\">totallylazy</a>,</li>\n<li><a href=\"https://github.com/evant/gradle-retrolambda\" rel=\"nofollow noreferrer\">gradle-retrolambda</a>, or</li>\n<li><a href=\"https://github.com/aNNiMON/Lightweight-Stream-API\" rel=\"nofollow noreferrer\">Lightweight-Stream-API</a></li>\n</ol>\n\n<p>you can. More info see <a href=\"https://stackoverflow.com/questions/30055585/java-streams-in-java-7\">this post</a> and documentation retrolambda, totallylazy, gradle-retrolambda or  Lightweight-Stream-API. But if you can using Java 8, it's much more easy than using non official API.  </p>\n\n<p>Or you can use </p>\n\n<ol start=\"5\">\n<li><a href=\"https://github.com/google/guava/wiki/FunctionalExplained\" rel=\"nofollow noreferrer\">FunctionalExplained Guava</a></li>\n<li><a href=\"http://www.functionaljava.org/\" rel=\"nofollow noreferrer\">Functional Java lib</a></li>\n</ol>\n\n<p>to use functional programming in Java 7, but Stream API more offical and general.</p>\n"}, {"tags": [], "owner": {"reputation": 60632, "user_id": 823393, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6a37a096cfb6f7b8e40e4950dc1a9658?s=128&d=identicon&r=PG", "display_name": "OldCurmudgeon", "link": "https://stackoverflow.com/users/823393/oldcurmudgeon"}, "is_accepted": false, "score": 3, "last_activity_date": 1449055546, "creation_date": 1449055546, "answer_id": 34041569, "question_id": 34041214, "link": "https://stackoverflow.com/questions/34041214/equivalent-to-map-from-haskell-in-java-7/34041569#34041569", "title": "Equivalent to map (from haskell) in Java 7", "body": "<p>You can write yourself an <code>Iterator</code> that takes a <code>map</code> object that does the transformation.</p>\n\n<pre><code>static class Transformer&lt;F, T&gt; implements Iterator&lt;T&gt; {\n\n    final Iterator&lt;F&gt; source;\n    final Map&lt;F, T&gt; map;\n\n    public Transformer(Iterator&lt;F&gt; source, Map&lt;F, T&gt; map) {\n        this.source = source;\n        this.map = map;\n    }\n\n    @Override\n    public boolean hasNext() {\n        return source.hasNext();\n    }\n\n    @Override\n    public T next() {\n        return map.map(source.next());\n    }\n\n    public interface Map&lt;F, T&gt; {\n\n        public T map(F f);\n    }\n}\n\nprivate static final String[] numbers = {\"Zero\", \"One\", \"Two\", \"Three\", \"Four\", \"Five\"};\n\npublic void test() {\n    List&lt;Integer&gt; ints = Arrays.asList(1, 2, 3, 4, 5);\n    Transformer t = new Transformer&lt;&gt;(ints.iterator(), new Transformer.Map&lt;Integer, String&gt;() {\n        @Override\n        public String map(Integer f) {\n            return numbers[f];\n        }\n\n    });\n    while (t.hasNext()) {\n        System.out.println(t.next());\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21095, "user_id": 822588, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/7bVy8.jpg?s=128&g=1", "display_name": "Sleiman Jneidi", "link": "https://stackoverflow.com/users/822588/sleiman-jneidi"}, "is_accepted": false, "score": 4, "last_activity_date": 1449056101, "last_edit_date": 1449056101, "creation_date": 1449055781, "answer_id": 34041651, "question_id": 34041214, "link": "https://stackoverflow.com/questions/34041214/equivalent-to-map-from-haskell-in-java-7/34041651#34041651", "title": "Equivalent to map (from haskell) in Java 7", "body": "<p>Functional transformations were added to Java 8 and they are not available for Java 7. For example, a map function that transforms a String to an integer looks like this Java 8 </p>\n\n<pre><code>List&lt;String&gt; list = Arrays.asList(\"1\",\"2\",\"3\");\nList&lt;Integer&gt; nums = list.stream().map(Integer::parseInt).collect(Collectors.toList());\n</code></pre>\n\n<p>Unlike Haskell, Java collections are strict, however <code>Streams</code> ( Java 8) are <code>lifted</code> ( ~ lazy).</p>\n\n<p>There are libraries that support <code>higher order functions</code> for <code>Java 7</code> like <code>Guava</code>. Guava has a <code>transform</code> function that transforms T -> U, for ex:</p>\n\n<pre><code>Collection&lt;Integer&gt; ints = Collections2.transform(list, new Function&lt;String, Integer&gt;() {\n        @Override\n        public Integer apply(String s) {\n            return Integer.parseInt(s);\n        }\n    });\n</code></pre>\n\n<p>But as you can tell ,due to the lack of lambda expressions in Java 7, it doesn't look concise</p>\n"}], "owner": {"reputation": 559, "user_id": 3389669, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a013398fd6031b9d738643f8c75b7cf?s=128&d=identicon&r=PG&f=1", "display_name": "user3389669", "link": "https://stackoverflow.com/users/3389669/user3389669"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 835, "favorite_count": 1, "accepted_answer_id": 34041379, "answer_count": 5, "score": 9, "last_activity_date": 1449061300, "creation_date": 1449054440, "last_edit_date": 1449060948, "question_id": 34041214, "link": "https://stackoverflow.com/questions/34041214/equivalent-to-map-from-haskell-in-java-7", "title": "Equivalent to map (from haskell) in Java 7", "body": "<p>In Haskell there is a function called <code>map</code>, which takes a List of Type <code>A</code> and a function <code>f</code>, mapping values of type <code>A</code> to values of type <code>B</code>. It returns a list of type <code>B</code>, such that each element of the result list originates from a call of <code>f</code> to a value in the input list.</p>\n\n<p>For example, given</p>\n\n<ul>\n<li>a list <code>m = ['a', 'b', 'c']</code>,</li>\n<li>and a function <code>f = {'a' -&gt; 1, 'b' -&gt; 2, 'c' -&gt; 3}</code>,</li>\n<li>then <code>map(m, f) = [1, 2, 3]</code>.</li>\n</ul>\n\n<p>Is there a library, usable with Java 7, that offers something like the <code>map</code> function? I already viewed <a href=\"https://commons.apache.org/proper/commons-collections/javadocs/api-release/index.html\" rel=\"noreferrer\">apache CollectionUtils</a> and found things like <a href=\"https://commons.apache.org/proper/commons-collections/javadocs/api-release/org/apache/commons/collections4/CollectionUtils.html#forAllDo(java.lang.Iterable,%20C)\" rel=\"noreferrer\">forAllDo</a> and <a href=\"https://commons.apache.org/proper/commons-collections/javadocs/api-release/org/apache/commons/collections4/CollectionUtils.html#transform%28java.util.Collection,%20org.apache.commons.collections4.Transformer%29\" rel=\"noreferrer\">transform</a>, but they don't allow retuning a collection of a completely different type. Googling for other libraries failed for the same reason.</p>\n\n<p>To be clear: I know how to solve the problem by myself, but I strongly feel that there must already exist a good library that performs this task more generally.</p>\n\n<p>Bonus question: Is there some equivalent to Haskell functors (i.e. move from collections to iterables) usable in Java 7? Further explanation: Is there a map function which takes an <code>Iterable&lt;A&gt;</code> instead of <code>Collection&lt;A&gt;</code> and returns an <code>Iterable&lt;B&gt;</code> instead of <code>Collection&lt;B&gt;</code> (provided by a fitting function <code>f</code>)?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 515, "user_id": 3295845, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/pIM7R.png?s=128&g=1", "display_name": "donth77", "link": "https://stackoverflow.com/users/3295845/donth77"}, "edited": false, "score": 0, "creation_date": 1449049528, "post_id": 34039226, "comment_id": 55833693, "body": "Ok thanks for helping me out. I&#39;m still new to the language."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 515, "user_id": 3295845, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/pIM7R.png?s=128&g=1", "display_name": "donth77", "link": "https://stackoverflow.com/users/3295845/donth77"}, "edited": false, "score": 0, "creation_date": 1449049667, "post_id": 34039226, "comment_id": 55833775, "body": "no problem - keep going it&#39;s worth it - btw: this is such a minor detail - the rest of your code is working after all ;)"}, {"owner": {"reputation": 2862, "user_id": 1343488, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c3ee657e2498d831dd1cd055b11f0620?s=128&d=identicon&r=PG&f=1", "display_name": "zhirzh", "link": "https://stackoverflow.com/users/1343488/zhirzh"}, "edited": false, "score": 0, "creation_date": 1516877506, "post_id": 34039226, "comment_id": 83873287, "body": "how can I print a <code>Leaf</code> alone?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 2862, "user_id": 1343488, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c3ee657e2498d831dd1cd055b11f0620?s=128&d=identicon&r=PG&f=1", "display_name": "zhirzh", "link": "https://stackoverflow.com/users/1343488/zhirzh"}, "edited": false, "score": 0, "creation_date": 1516883754, "post_id": 34039226, "comment_id": 83877293, "body": "@zhirzh you mean you want to see only the values of the leaves? - Just change the <code>show (Branch v l r)</code> case accordingly"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 10, "last_activity_date": 1449049133, "last_edit_date": 1449049133, "creation_date": 1449048827, "answer_id": 34039226, "question_id": 34039159, "link": "https://stackoverflow.com/questions/34039159/haskell-no-instance-arising-from-a-use-of-print/34039226#34039226", "title": "Haskell No instance arising from a use of &#39;print&#39;", "body": "<p>just add </p>\n\n<pre><code>data Tree a = Leaf | Branch a (Tree a) (Tree a)\n            deriving Show\n</code></pre>\n\n<p>the error just says that Haskell does not know how to <em>show</em> a value of type <code>Tree a0</code> (<code>print</code> is using <code>show</code> from the <code>Show</code> type-class)</p>\n\n<p>And the easiest way is to auto-derive it</p>\n\n<p>Or you have to implement it yourself using something like this:</p>\n\n<pre><code>instance (Show a) =&gt; Show (Tree a) where\n  show Leaf = \"leaf\"\n  show (Branch v l r) = \"(left: \" ++ show l ++ \") \" ++ show v ++ \" (right: \" ++ show r ++ \")\"\n</code></pre>\n\n<p>where I just made something up to give you something like this:</p>\n\n<pre><code>\u03bb&gt; toTree [1,2,3]\n(left: (left: leaf) 2 (right: leaf)) 1 (right: (left: leaf) 3 (right: leaf))\n</code></pre>\n"}], "owner": {"reputation": 515, "user_id": 3295845, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/pIM7R.png?s=128&g=1", "display_name": "donth77", "link": "https://stackoverflow.com/users/3295845/donth77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4749, "favorite_count": 1, "accepted_answer_id": 34039226, "answer_count": 1, "score": 6, "last_activity_date": 1449049133, "creation_date": 1449048626, "question_id": 34039159, "link": "https://stackoverflow.com/questions/34039159/haskell-no-instance-arising-from-a-use-of-print", "title": "Haskell No instance arising from a use of &#39;print&#39;", "body": "<p>I want to write a function toTree that converts a list of values to a binary tree:</p>\n\n<pre><code>data Tree a = Leaf | Branch a (Tree a) (Tree a)\ntree = Branch 6 (Branch 3 Leaf Leaf) (Branch 9 Leaf Leaf)\n\nsplit :: [a] -&gt; ([a], [a])\nsplit lst = splitAt (((length lst) + 1) `div` 2) lst\ntoTree :: [a] -&gt; Tree a\ntoTree (x: xs) = Branch x (toTree xm) (toTree xl) where (xm, xl) = split xs\ntoTree [] = Leaf\n</code></pre>\n\n<p>I cannot figure why I get this error on <code>toTree [1,2,3]</code></p>\n\n<pre><code> No instance for (Show (Tree a0)) arising from a use of `print'\n In the first argument of `print', namely `it'\n In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I know this  is a simple error to fix but I cannot seem to find what is causing it. How can I resolve this issue?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1449035287, "post_id": 34035520, "comment_id": 55826719, "body": "If the code in the literate haskell file works (which you should link, by the way) then it shouldn&#39;t be too much work to find your difference.  Have you tried that?"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 9, "last_activity_date": 1449034736, "last_edit_date": 1495541711, "creation_date": 1449034736, "answer_id": 34035654, "question_id": 34035520, "link": "https://stackoverflow.com/questions/34035520/why-my-haskell-code-copying-from-the-book-functional-programming-in-haskell-ca/34035654#34035654", "title": "Why my haskell code copying from the book &quot;Functional Programming in Haskell&quot; can&#39;t be successfully interpreted?", "body": "<p><a href=\"https://stackoverflow.com/a/5310487/477476\"><code>(-&gt;) String</code> has a Monad instance</a> but it is not what you are looking for. When you use <code>do</code>-notation in the definition of <code>p</code>, this instance is the one that is picked up.</p>\n\n<p>What you want to do is make your own <code>Monad</code> instance for <code>Parser</code> (this requires changing it from a type synonym to a <code>newtype</code> wrapper over <code>String -&gt; [(a, String)]</code>) and then let that be picked up in the definition of <code>p</code>.</p>\n\n<p>Note that your example code already has an implementation of <code>return</code> (under the name of <code>retrn</code>) which does the right thing, and it is also very different from what <code>return</code> for <code>(-&gt;) String</code> is (which would be <code>retrn v = \\inp -&gt; v</code>.</p>\n"}], "owner": {"reputation": 337, "user_id": 4181082, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b1bdfc81d39aa426ee87f7d8edeb091?s=128&d=identicon&r=PG&f=1", "display_name": "AhSeng Fan", "link": "https://stackoverflow.com/users/4181082/ahseng-fan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 1, "accepted_answer_id": 34035654, "answer_count": 1, "score": 4, "last_activity_date": 1449034736, "creation_date": 1449033897, "last_edit_date": 1449034359, "question_id": 34035520, "link": "https://stackoverflow.com/questions/34035520/why-my-haskell-code-copying-from-the-book-functional-programming-in-haskell-ca", "title": "Why my haskell code copying from the book &quot;Functional Programming in Haskell&quot; can&#39;t be successfully interpreted?", "body": "<p>The code is as below:</p>\n\n<pre><code>type Parser a = String -&gt; [(a, String)]\n\nretrn :: a -&gt; Parser a\nretrn v = \\inp -&gt; [(v, inp)]\n\nparse :: Parser a -&gt; String -&gt; [(a, String)]\nparse p inp = p inp\n\nitem :: Parser Char\nitem = \\inp -&gt; case inp of\n        []        -&gt; []\n        (x:xs)    -&gt; [(x, xs)]\n\n--problem code\np :: Parser (Char, Char)\np = do x &lt;- item\n       item\n       y &lt;- item\n       retrn (x, y)\n</code></pre>\n\n<p>It gives the following type error:</p>\n\n<pre><code>SO-34035520.hs:19:8:\n    Couldn't match type `[(Char, String)]' with `Char'\n    Expected type: String -&gt; [((Char, Char), String)]\n      Actual type: Parser ([(Char, String)], [(Char, String)])\n    In a stmt of a 'do' block: retrn (x, y)\n    In the expression:\n      do { x &lt;- item;\n           item;\n           y &lt;- item;\n           retrn (x, y) }\n</code></pre>\n\n<p>What noteworthy is, the sample code that is on official website of the book can be interpreted smoothly, which is *.lhs format.</p>\n\n<p>So, can somebody tell me why? I've been working on this struggle for days.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 2, "creation_date": 1449017124, "post_id": 34032976, "comment_id": 55821265, "body": "I believe the <code>|</code> in the guard needs to be indents past the <code>b</code> in <code>bmiTell</code>."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1449021569, "post_id": 34032976, "comment_id": 55822533, "body": "Scroll to the right. What&#39;s that extra bit doing there?"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 5, "last_activity_date": 1449017966, "creation_date": 1449017966, "answer_id": 34033127, "question_id": 34032976, "link": "https://stackoverflow.com/questions/34032976/syntax-error-in-haskell/34033127#34033127", "title": "Syntax error in Haskell", "body": "<p>Two problems</p>\n\n<ul>\n<li><p>As remarked in comments, your guards need to be indented one extra space at least (so the pipe is more indented that the <code>b</code>)</p></li>\n<li><p>You need more than just a <code>let</code> inside the <code>do</code> block. For example, you might want to test out your function!</p></li>\n</ul>\n\n<p>With those problems fixed:</p>\n\n<pre><code>main = do\n  let bmiTell weight height\n       | weight / height ^ 2 &lt;= 18.5 = \"You're underweight, you emo, you!\"\n       | weight / height ^ 2 &lt;= 25.0 = \"You're supposedly normal. Pffft, I bet you're ugly!\"\n       | weight / height ^ 2 &lt;= 30.0 = \"You're fat! Lose some weight, fatty!\"\n       | otherwise                   = \"You're a whale, congratulations!\"  \n  putStrLn $ bmiTell 6 1\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 4118196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98b8fb1cd28936551703b78fbeeab935?s=128&d=identicon&r=PG&f=1", "display_name": "Chuong Lam", "link": "https://stackoverflow.com/users/4118196/chuong-lam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1522155396, "creation_date": 1449017020, "last_edit_date": 1522155396, "question_id": 34032976, "link": "https://stackoverflow.com/questions/34032976/syntax-error-in-haskell", "title": "Syntax error in Haskell", "body": "<p>I got an error when compiling a Haskell script. Please help:</p>\n\n<pre><code>main = do\nlet bmiTell weight height\n    | weight / height ^ 2 &lt;= 18.5 = \"You're underweight, you emo, you!\"\n    | weight / height ^ 2 &lt;= 25.0 = \"You're supposedly normal. Pffft, I bet you're ugly!\"\n    | weight / height ^ 2 &lt;= 30.0 = \"You're fat! Lose some weight, fatty!\"\n    | otherwise                   = \"You're a whale, congratulations!\"                = \"You're a whale, congratulations!\"\n</code></pre>\n\n<blockquote>\n  <p>Error:(3, 5) ghc: parse error (possibly incorrect indentation or mismatched brackets)</p>\n</blockquote>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 5977, "user_id": 498892, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/033ed066b8bf63ccfa7c37b852a91dcb?s=128&d=identicon&r=PG", "display_name": "Alleo", "link": "https://stackoverflow.com/users/498892/alleo"}, "edited": false, "score": 0, "creation_date": 1449012048, "post_id": 34031864, "comment_id": 55819549, "body": "please post an error you get from compiler"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1449012383, "post_id": 34031864, "comment_id": 55819673, "body": "In do blocks you need <code>let</code> syntax."}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 5627057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53d0527f0db915c8e13633d664b3cdc8?s=128&d=identicon&r=PG&f=1", "display_name": "T Burnside", "link": "https://stackoverflow.com/users/5627057/t-burnside"}, "is_accepted": false, "score": 2, "last_activity_date": 1449013586, "creation_date": 1449013586, "answer_id": 34032433, "question_id": 34031864, "link": "https://stackoverflow.com/questions/34031864/printing-intermediate-value-in-recursive-function-in-haskell/34032433#34032433", "title": "Printing intermediate value in recursive function in Haskell", "body": "<p>As PyRulez says in his comment, you need to use <code>let</code> syntax in do blocks. However, you are also going to run into issues because your function parameters, like all values in Haskell, are immutable. You will need to do something like:</p>\n\n<pre><code>let b' = b + 5\nlet c' = b' + 2 * a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 572866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d567d587d5444181119f1972f2df8bd3?s=128&d=identicon&r=PG", "display_name": "dchagniot", "link": "https://stackoverflow.com/users/572866/dchagniot"}, "is_accepted": false, "score": 2, "last_activity_date": 1449158336, "creation_date": 1449158336, "answer_id": 34070540, "question_id": 34031864, "link": "https://stackoverflow.com/questions/34031864/printing-intermediate-value-in-recursive-function-in-haskell/34070540#34070540", "title": "Printing intermediate value in recursive function in Haskell", "body": "<p>If you only want to print some intermediate value, you don't need to have your function in the IO world:\nyou can use the Debug.Trace module:</p>\n\n<pre><code>import Debug.Trace\n\nfunc :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nfunc 0 _ _ _ = 0\nfunc t a b c = trace (\"a=\"++(show a)++\" b=\"++(show b)++\" c=\"++(show c)) $ recurs\n    where recurs = func (t-1) (a+1) (b+50) (b+2*a)\n</code></pre>\n\n<p>it gives me:</p>\n\n<pre><code>&gt; func 5 1 1 1\na=1 b=1 c=1\na=2 b=51 c=3\na=3 b=101 c=55\na=4 b=151 c=107\na=5 b=201 c=159\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5627838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62f156c6af58372c99904b828374a92?s=128&d=identicon&r=PG&f=1", "display_name": "user5627838", "link": "https://stackoverflow.com/users/5627838/user5627838"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1449158336, "creation_date": 1449010876, "question_id": 34031864, "link": "https://stackoverflow.com/questions/34031864/printing-intermediate-value-in-recursive-function-in-haskell", "title": "Printing intermediate value in recursive function in Haskell", "body": "<p>I am new to Haskel and want to learn it. I want to print intermediate value in recursive function in haskell but i am stuck in parse error on input \"=\" on line b= b+50. </p>\n\n<pre><code>`main' t s a b c  \n    | t &gt; s    = 0  \n    | otherwise = do \n        print a\n        print b\n        print c\n        b = b + 50\n        c = b + 2 * a\n        main' (t+1) s (a+1) b c `\n</code></pre>\n\n<p>the C equivalent for this code is </p>\n\n<pre><code> int calculate(t,s,a,b,c)\n {\n     printf( \"%d,%d,%d\",a,b,c);\n     if(t &gt; s)\n        return 0;\n     else\n      {\n           b = b + 50;\n           c = b + 2 * a;\n           return calculate (t+1,s,a,b,c);\n       }\n\n    }\n    int main()\n    {\n         calculate(0,10,2,6,7);\n         return 0;  \n    }`\n</code></pre>\n\n<p>Please help me to resolve this problem. It is not so difficult to do in C but I could not figure out how to do it in Haskel.</p>\n"}, {"tags": ["haskell", "types", "functional-programming"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1449012509, "post_id": 34031860, "comment_id": 55819717, "body": "Try existential types."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449013210, "post_id": 34031860, "comment_id": 55819984, "body": "The problems you describe sound quite similar to the problems solved in the snap server framework by snaplets; which essentially use lenses to run snaplets with their own state. You could consider reading up on how snaplets work to see if their approach will work for you."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1449013314, "post_id": 34031860, "comment_id": 55820033, "body": "I&#39;m looking for that kind of recommendation, thanks for the pointer!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449014689, "post_id": 34031860, "comment_id": 55820538, "body": "It&#39;s unclear to me what you&#39;re asking. If the data inside a list depends on the current time, then the value of the list certainly depends on the time too. In a purely functional setting there&#39;s no way to &#39;hide&#39; that sort of dependency."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449016587, "post_id": 34031860, "comment_id": 55821116, "body": "You could &quot;hide&quot; the internal state of something by making it an argument of a function, and passing the state down the tree. For example, <code>listOfWords = (&quot;lih&quot;, \\ x -&gt; div [ (&quot;foo&quot;, \\ x -&gt; div (str x)), (&quot;bar&quot;, \\ x -&gt; div (str (x+x))), (&quot;biz&quot;, \\ x -&gt; div (str (x*3)))])</code>. Here, each component ha an id (&quot;foo&quot;, &quot;bar&quot;...) and an internal state <code>x</code>. <code>listOfWords</code> is not aware of the state of its children. A function <code>runComponent</code> would pass down the state environment so that each node receives its own state, based on its id. That&#39;d hide in the sense it&#39;d allow modularization, @BenjaminHodgson."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449017333, "post_id": 34031860, "comment_id": 55821340, "body": "The list has a type of <code>Num n =&gt; [(String, n -&gt; Html)]</code>. The parameter <code>n</code> is not hidden, you can see it right there!"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449017665, "post_id": 34031860, "comment_id": 55821446, "body": "@BenjaminHodgson It is modular, which is the point. If I say <code>widget :: Int -&gt; [(String, Int -&gt; Html)]</code>, I can create a <code>list :: [Widget] -&gt; Widget</code> component which renders an HTML list of stateful widgets inside it (as long as the state is an Int). Without it, how&#39;d you create a widget that is a list of stateful widgets? I can&#39;t see any way. You&#39;d have to create a &quot;listOfClocks&quot;, a &quot;listOfBottoms&quot;, a &quot;listOfGames&quot;, etc - a different code for each widget, because the parent needs to manually provide the state. No reuse of code, no modularization."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449017725, "post_id": 34031860, "comment_id": 55821460, "body": "The way you describe it sounds like you want to equip each clock in the list with its own timekeeping device and have them update themselves autonomously. This is an imperative way of thinking, not a functional one. The current time in the real world is not a local piece of data - it&#39;s as global as they come (it is literally universal!). The information has to come from the outside of your program and make its way inwards, not the other way around."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449018001, "post_id": 34031860, "comment_id": 55821555, "body": "This has nothing to do with imperative thinking, I need modularization of stateful web components, @BenjaminHodgson. In the current, &quot;Elm&quot; approach of writing UIs, the parent of a component must record the state of every children. It means that, in a large site, you&#39;ll end up with a root model having the state of the innermost innermost buttons. Imagine that: <code>data MyAppState = { ......................, stateOfThatButtonInsideThatDivInsideThatList :: Bool ............. }</code>. And that inner button can alter that global state with no sort of isolation. How is <b>that</b> functional?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449018527, "post_id": 34031860, "comment_id": 55821690, "body": "Ah, I think we are getting to the core of your question: &quot;that inner button can alter that global state with no sort of isolation&quot;. It sounds like you really have a problem of <i>composition</i> - you want to be able to take a <code>Widget CurrentTime</code> and a <code>Widget Username</code> (where <code>Widget</code>&#39;s argument denotes &quot;the thing it depends upon&quot;) and somehow mash them together into a <code>Widget (CurrentTime, Username)</code>. Have I understood you correctly? If so, you&#39;re in luck - I wrote a <a href=\"https://themonadreader.files.wordpress.com/2015/08/issue24.pdf\" rel=\"nofollow noreferrer\">whole article</a> about a very similar problem."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1449018728, "post_id": 34031860, "comment_id": 55821738, "body": "... although you may not need all the machinery I built in that article. If the shape of your data is the same as the shape of your hierarchical widgets, you can probably just use <a href=\"https://hackage.haskell.org/package/contravariant-1.3.3/docs/Data-Functor-Contravariant.html\" rel=\"nofollow noreferrer\"><code>contramap</code></a> to change the size of your environment. <a href=\"https://www.reddit.com/r/haskell/comments/3hov5w/the_monadreader_miniissue_24_predicates_trees_and/\" rel=\"nofollow noreferrer\">Discussion in the Reddit comments on the article</a>."}, {"owner": {"reputation": 633, "user_id": 5107759, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/33e659c0770221780a6fd21960909b6d?s=128&d=identicon&r=PG", "display_name": "joanbm", "link": "https://stackoverflow.com/users/5107759/joanbm"}, "edited": false, "score": 0, "creation_date": 1449088647, "post_id": 34031860, "comment_id": 55859258, "body": "It may be the confusing nature of the question but why should be held time(s) independently ? Why don&#39;t define data type of clock with color and <code>State</code> monad for time ? Manipulation of list (or array) of clocks then needn&#39;t care about internal time states. Wrapping in a typeclass, use GADTs to loose type restrictions as another ideas. Recursive instance to enable operation with arbitrary widget types, like. heterogenous containers."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 633, "user_id": 5107759, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/33e659c0770221780a6fd21960909b6d?s=128&d=identicon&r=PG", "display_name": "joanbm", "link": "https://stackoverflow.com/users/5107759/joanbm"}, "edited": false, "score": 0, "creation_date": 1449141361, "post_id": 34031860, "comment_id": 55882178, "body": "I&#39;m just not sure I visualize what you are doing, but it might be the answer (or not)... @joanbm"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1449125803, "creation_date": 1449010861, "last_edit_date": 1449125803, "question_id": 34031860, "link": "https://stackoverflow.com/questions/34031860/is-it-possible-to-encode-heterogeneous-trees-of-stateful-nodes-in-haskell", "title": "Is it possible to encode heterogeneous trees of stateful nodes in Haskell?", "body": "<p>Modeling modular, static web components is very easy in Haskell. A view is a document, a component is just a function that returns a view:</p>\n\n<pre><code>-- Renders a pretty clock\nclock :: Color -&gt; Html\nclock color = div ...\n\n-- Renders a list of views prettily \nlist :: [Html] -&gt; Html\nlist elements = div ...\n\n-- A blue clock\nblueClock :: Html\nblueClock = clock Blue\n\n-- A list with a Blue, a Yellow, and a Red clock\nclockList :: Html\nclockList = list [\n    clock Blue,\n    clock Yellow,\n    clock Red]\n</code></pre>\n\n<p>The issue with this approach is when you add <strong>local state</strong> to things. For example:</p>\n\n<pre><code>-- Added \"Time\" to clock's type\nclock :: Color -&gt; Time -&gt; Html\nclock color time = div ...\n\n-- A blue clock now has a local state: its time.\nblueClock :: Time -&gt; Clock\nblueClock = clock Blue\n\n-- A list of clock must be aware of the local state of each child clock.\nclockList :: [Time] -&gt; Html\nclockList times = list [\n    clock Blue   (times !! 0),\n    clock Yellow (times !! 1),\n    clock Green  (times !! 2)]\n</code></pre>\n\n<p>A parent node must be aware of the local state of each children, breaking modularization. Instead of pure views, we need a way to encode self-contained components, each of which would define how to deal with its own internal state. For example:</p>\n\n<pre><code>type Component state = ... ??? ...\n\nclock :: Color -&gt; Component Time\nclock = ...\n\nlist :: [Component a] -&gt; Component ()\nlist = ...\n\nclocks :: Component ()\nclocks = list [\n    clock Yellow (0, (+ 1)),\n    clock Red    (0, (- 1)),\n    clock Blue   (0, (+ 2))]\n\nrunComponent :: Component a -&gt; IO HtmlNode\n</code></pre>\n\n<p>Notice that: </p>\n\n<ol>\n<li><p>Clock is a component with a local state of type Time. An instance needs an initial state (here, always 0), and a function, <code>state -&gt; state</code>, which is called each \"tick\" to update its local state. Some clocks run backwards, some run in double speed...</p></li>\n<li><p>A <code>list</code> is a component without a local state. It just creates some pretty HTML list with many components. It isn't aware of the local states of the internal clocks at all.</p></li>\n<li><p><code>runComponent</code> is responsible for giving life to the final app, which include calling the state of each sub component correctly.</p></li>\n</ol>\n\n<p>I've tried countless ways of formalizing this intuition with types, but I couldn't find anything satisfactory. Problems include the fact that components can have different types of states, and the fact that \"callbacks\" (on, for example, pure buttons) must affect the state of the component that contains it. How can such systems be encoded in Haskell's type system?</p>\n"}, {"tags": ["haskell", "dictionary", "io", "monads", "pandoc"], "comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449008422, "post_id": 34031192, "comment_id": 55818100, "body": "Well, the premise and title of your question is false; the result of <code>map</code> will depend on the whole list.  There are no exceptions to that. So I can assure you that <i>something else</i> is the problem. Maybe the lists that you think have multiple items only have one?"}, {"owner": {"reputation": 355, "user_id": 2286520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7KqMh.jpg?s=128&g=1", "display_name": "D&#225;niel Stein", "link": "https://stackoverflow.com/users/2286520/d%c3%a1niel-stein"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449008731, "post_id": 34031192, "comment_id": 55818253, "body": "@LuisCasillas I&#39;ve printed the content of the map and it was correct, 5 Strings. I&#39;ve also printed the name of the file and the AST in the <code>getContent</code> function and it was called only once (then once again for the next include block)."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449009123, "post_id": 34031192, "comment_id": 55818440, "body": "The result of applying <code>map</code> to a list of 5 items is going to be a list of 5 items, period. Now, Haskell has lazy evaluation, so not all items in the result list may be computed for whatever reason, and this might produce an illusion like what you describe. But really, trust me when I tell you this: the problem isn&#39;t in <code>map</code>. You are either giving <code>map</code> a different list than what you think you are, or you are consuming its result in a way other than what you think."}, {"owner": {"reputation": 355, "user_id": 2286520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7KqMh.jpg?s=128&g=1", "display_name": "D&#225;niel Stein", "link": "https://stackoverflow.com/users/2286520/d%c3%a1niel-stein"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449009896, "post_id": 34031192, "comment_id": 55818695, "body": "@LuisCasillas I understand, thank you. I only tried to write down what I&#39;ve noticed, it may be easier to find worded like this by someone else also learning the language. However I&#39;ve tried replacing every <code>return $</code> and alike with <code>return $!</code> and it still does not evaulate eagerly. Do you have any advice?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449010206, "post_id": 34031192, "comment_id": 55818817, "body": "That&#39;s understandable D&#225;niel."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449010310, "post_id": 34031192, "comment_id": 55818854, "body": "Daniel, most of the <code>return</code>s in <code>doInclude</code> are unnecessary.  Any line that goes <code>var &lt;- return $ expr</code> can be replaced with <code>let var = expr</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449010336, "post_id": 34031192, "comment_id": 55818862, "body": "Those <code>x &lt;- return$ foo</code> perform no IO, they are equivalent to <code>let x = foo</code>. I guess your <code>msum contents</code> is supposed to concatenate the contents list, i.e. to work in the list monad, when instead is accidentally used in the IO monad &quot;thanks&quot; to overloading and typeclass instance selection."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449010381, "post_id": 34031192, "comment_id": 55818884, "body": "@chi I was about the point out the same thing, but I don&#39;t see where this <code>MonadPlus IO</code> instance would be coming from."}, {"owner": {"reputation": 355, "user_id": 2286520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7KqMh.jpg?s=128&g=1", "display_name": "D&#225;niel Stein", "link": "https://stackoverflow.com/users/2286520/d%c3%a1niel-stein"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449010842, "post_id": 34031192, "comment_id": 55819068, "body": "@LuisCasillas Thank you, I was aware of that, it was only temporary solution for debugging. I&#39;ve replaced the whole do block with <code>msum $! map getContent (wordsBy (==&#39;\\n&#39;) list)</code>."}, {"owner": {"reputation": 355, "user_id": 2286520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7KqMh.jpg?s=128&g=1", "display_name": "D&#225;niel Stein", "link": "https://stackoverflow.com/users/2286520/d%c3%a1niel-stein"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449010920, "post_id": 34031192, "comment_id": 55819098, "body": "@chi I&#39;d like the <code>[IO [Block]]</code> to be concatenated into <code>IO [Block]</code>. Isn&#39;t the <code>msum</code> function the right choice?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 2, "creation_date": 1449011077, "post_id": 34031192, "comment_id": 55819156, "body": "@D&#225;nielStein Try <code>sequence contents</code>.  Should give you an <code>IO [[Block]]</code>.  Or <code>fmap concat (sequence contents) :: IO [Block]</code>"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449011245, "post_id": 34031192, "comment_id": 55819215, "body": "@D&#225;nielStein: Also, read <a href=\"http://stackoverflow.com/questions/4504489/monadplus-definition-for-haskell-io\">this question and its top answer</a>."}, {"owner": {"reputation": 355, "user_id": 2286520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7KqMh.jpg?s=128&g=1", "display_name": "D&#225;niel Stein", "link": "https://stackoverflow.com/users/2286520/d%c3%a1niel-stein"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449011297, "post_id": 34031192, "comment_id": 55819239, "body": "@LuisCasillas <code>sequence contents</code> unfortunately does not solve the problem, <code>Expected type: [IO Block]   Actual type: [IO [Block]]</code>"}, {"owner": {"reputation": 355, "user_id": 2286520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7KqMh.jpg?s=128&g=1", "display_name": "D&#225;niel Stein", "link": "https://stackoverflow.com/users/2286520/d%c3%a1niel-stein"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1449011519, "post_id": 34031192, "comment_id": 55819342, "body": "@LuisCasillas <code>fmap concat (sequence contents)</code> works perfectly, thank you very much. (Could you please extend your answer with this?) Also thank you @chi."}], "answers": [{"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 6, "last_activity_date": 1449017697, "last_edit_date": 1495540891, "creation_date": 1449010738, "answer_id": 34031832, "question_id": 34031192, "link": "https://stackoverflow.com/questions/34031192/haskell-map-does-not-iterate-over-the-whole-list/34031832#34031832", "title": "Haskell map does not iterate over the whole list", "body": "<p>I can spot the following error in your <code>doInclude</code> function:</p>\n\n<pre><code>doInclude :: Block -&gt; IO [Block]\ndoInclude cb@(CodeBlock (_, classes, _) list) =\n  if \"include\" `elem` classes\n    then do\n      let files = wordsBy (=='\\n') list\n      let contents = map getContent files\n      let result = msum contents            -- HERE\n      result \n    else\n        return [cb]\ndoInclude x = return [x]\n</code></pre>\n\n<p>Since the type of the result of this whole function is <code>IO [Block]</code>, we can work backward:</p>\n\n<ol>\n<li><code>result</code> has type <code>IO [Block]</code></li>\n<li><code>contents</code> has type <code>[IO [Block]]</code></li>\n<li><code>msum</code> is being used with type <code>[IO [Block]] -&gt; IO [Block]</code></li>\n</ol>\n\n<p>And that third part is the problem\u2014somehow in your program, there is a non-standard <code>MonadPlus</code> instance being loaded for <code>IO</code>, and I bet that what it does on <code>msum contents</code> is this:</p>\n\n<ul>\n<li>Execute the first action\n\n<ul>\n<li>If that succeeds, produce the same result as that and <strong>discard the rest of the list</strong>.  (This is the cause of the behavior you observe.)</li>\n<li>If it fails with an exception, try the rest of the list.</li>\n</ul></li>\n</ul>\n\n<p>This isn't a standard <code>MonadPlus</code> instance so it's coming from one of the libraries that you're importing.  I don't know which.</p>\n\n<p>A general recommendation here would be:</p>\n\n<ol>\n<li>Split your program into smaller functions</li>\n<li>Write type signatures for those functions</li>\n</ol>\n\n<p>Because the problem here seems to be that <code>msum</code> is being used with a different type than the one you expect.  Normally this would produce a type error, but here you got unlucky and it interacted with a strange type class instance in some library.</p>\n\n<hr>\n\n<p>From the comments, your intent with <code>msum contents</code> was to create an <code>IO</code> action that executes all of the subactions in sequence, and collects their result as a list.  Well, <a href=\"https://stackoverflow.com/questions/4504489/monadplus-definition-for-haskell-io\">the <code>MonadPlus</code> class isn't normally defined for <code>IO</code>, and when it is it does something else</a>.  So the correct function to use here is <code>sequence</code>:</p>\n\n<pre><code>-- Simplified version, the real one is more general:\nsequence :: Monad m =&gt; [m a] -&gt; m [a]\nsequence [] = return []\nsequence (ma:mas) = do\n  a &lt;- ma\n  as &lt;- mas\n  return (a:as)\n</code></pre>\n\n<p>That gets you from <code>[IO [Block]]</code> to <code>IO [[Block]]</code>.  To eliminate the double nested lists then you just use <code>fmap</code> to apply <code>concat</code> inside <code>IO</code>.</p>\n"}], "owner": {"reputation": 355, "user_id": 2286520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7KqMh.jpg?s=128&g=1", "display_name": "D&#225;niel Stein", "link": "https://stackoverflow.com/users/2286520/d%c3%a1niel-stein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 34031832, "answer_count": 1, "score": 3, "last_activity_date": 1449043160, "creation_date": 1449007945, "last_edit_date": 1449043160, "question_id": 34031192, "link": "https://stackoverflow.com/questions/34031192/haskell-map-does-not-iterate-over-the-whole-list", "title": "Haskell map does not iterate over the whole list", "body": "<p>I'm trying to learn the basics of Haskell while developing a filter for Pandoc to recursively include additional markdown files.</p>\n\n<p>Based on the scripting guide I was able to create a somewhat working filter. This looks for CodeBlocks with the <code>include</code> class and tries to include the ASTs of the referenced files.</p>\n\n<pre><code>```include\nsection-1.md\nsection-2.md\n#pleasedontincludeme.md\n```\n</code></pre>\n\n<p>The whole filter and the input sources could be found in the following repository: <a href=\"https://github.com/steindani/pandoc-include\" rel=\"nofollow\">steindani/pandoc-include</a> (or see below)</p>\n\n<p>One could run pandoc with the filter and see the output in markdown format using the following command: <code>pandoc -t json input.md | runhaskell IncludeFilter.hs | pandoc --from json --to markdown</code></p>\n\n<p>I've noticed that the <code>map</code> function (<a href=\"https://github.com/steindani/pandoc-include/blob/8329e6e348ec8b5b5d15c5280911e947b62063c6/IncludeFilter.hs#L38\" rel=\"nofollow\">at line 38</a>) \u2014 although gets the list of files to include \u2014 only calls the function for the first element. And this is not the only strange behavior. The included file could also have an include block that is processed and the referenced file is included; but it won't go deeper, the include blocks of the last file are ignored.</p>\n\n<p>Why does not the map function iterate over the whole list? Why does it stop after 2 levels of hierarchy?</p>\n\n<p><em>Please note that I'm just starting to learn Haskell, I'm sure I made mistakes, but I'm happy to learn.</em></p>\n\n<p>Thank you</p>\n\n<p>Full source code:</p>\n\n<pre><code>module Text.Pandoc.Include where\n\nimport Control.Monad\nimport Data.List.Split\n\nimport Text.Pandoc.JSON\nimport Text.Pandoc\nimport Text.Pandoc.Error\n\nstripPandoc :: Either PandocError Pandoc -&gt; [Block]\nstripPandoc p =\n  case p of\n    Left _ -&gt; [Null]\n    Right (Pandoc _ blocks) -&gt; blocks\n\nioReadMarkdown :: String -&gt; IO(Either PandocError Pandoc)\nioReadMarkdown content = return (readMarkdown def content)\n\ngetContent :: String -&gt; IO [Block]\ngetContent file = do\n  c &lt;- readFile file\n  p &lt;- ioReadMarkdown c\n  return (stripPandoc p)\n\ndoInclude :: Block -&gt; IO [Block]\ndoInclude cb@(CodeBlock (_, classes, _) list) =\n  if \"include\" `elem` classes\n    then do\n      files &lt;- return $ wordsBy (=='\\n') list\n      contents &lt;- return $ map getContent files\n      result &lt;- return $ msum contents\n      result\n    else\n        return [cb]\ndoInclude x = return [x]\n\nmain :: IO ()\nmain = toJSONFilter doInclude\n</code></pre>\n"}, {"tags": ["haskell", "scotty", "haskell-warp"], "comments": [{"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 1, "creation_date": 1449008148, "post_id": 34031053, "comment_id": 55817968, "body": "You can use the function <code>scottyApp</code> instead of <code>scotty</code> to get a WAI <code>Application</code>. From there it&#39;s Scotty independent and you can pass it to warp&#39;s <code>runTLS</code> function."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1449019843, "post_id": 34031053, "comment_id": 55822056, "body": "<code>\\p s -&gt; run p =&lt;&lt; scottyApp s</code> = <code>scotty</code> :)"}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1449046045, "post_id": 34031053, "comment_id": 55831530, "body": "/me stupid If you lift your comment into an answer I will accept it :-)"}], "answers": [{"tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": true, "score": 2, "last_activity_date": 1449078343, "last_edit_date": 1449078343, "creation_date": 1449076484, "answer_id": 34048900, "question_id": 34031053, "link": "https://stackoverflow.com/questions/34031053/how-to-use-warp-tls-instead-of-warp-with-scotty/34048900#34048900", "title": "How to use warp-tls instead of warp with scotty?", "body": "<p>You can use the <code>scottyApp</code> function instead of <code>scotty</code>, to get a WAI <code>Application</code> which you can pass to warp's <code>runTLS</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wai.Handler.WarpTLS (runTLS, tlsSettings)\nimport Network.Wai.Handler.Warp (defaultSettings, setPort)\nimport Network.Wai.Middleware.RequestLogger (logStdoutDev)\nimport Web.Scotty\n\nmain :: IO ()\nmain = do\n    let tlsConfig = tlsSettings \"your.crt\" \"your.key\"\n        config    = setPort 3443 defaultSettings\n    waiApp &lt;- scottyApp $ do\n        get \"/\"      (text \"hello\")\n        get \"/hello\" (text \"hello again\")\n    runTLS tlsConfig config (logStdoutDev waiApp)\n</code></pre>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 586, "favorite_count": 0, "accepted_answer_id": 34048900, "answer_count": 1, "score": 1, "last_activity_date": 1449078343, "creation_date": 1449007382, "question_id": 34031053, "link": "https://stackoverflow.com/questions/34031053/how-to-use-warp-tls-instead-of-warp-with-scotty", "title": "How to use warp-tls instead of warp with scotty?", "body": "<p>I need to start my scotty application with warp-tls instead of plain warp server but is seems running warp is hardwired in scotty's source code. Am I missing something obvious?</p>\n"}, {"tags": ["haskell", "ghc", "epoll"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449009999, "post_id": 34031039, "comment_id": 55818743, "body": "Can you describe what &quot;doesn&#39;t compile any more&quot; means, and include the code you&#39;re trying to compile directly in your question here? (As evidence that I&#39;m not just trying to enforce arbitrary rules: I stuck the code from the section titled &quot;Basic concurrent server&quot; in a file, and it compiled fine on my machine. So further details on what you&#39;re trying to do are really necessary.)"}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449013935, "post_id": 34031039, "comment_id": 55820281, "body": "@DanielWagner Hi Daniel. Sure. If you look at the last example, the one that actually uses <code>epoll</code>, it makes use of a <code>loop</code> function but that isn&#39;t even in the example. I get the error <code>app3&#47;Main.hs:14:5: Not in scope: \u2018loop\u2019</code>. That&#39;s after I changed <code>System.Event</code> to <code>GHC.Event</code> which is not noted anywhere."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1449023832, "post_id": 34031039, "comment_id": 55823162, "body": "The wiki page is out of date. GHC&#39;s IO manager uses epoll/kqueue under the hood without any special programmer effort (and <a href=\"https://ghc.haskell.org/trac/ghc/ticket/635\" rel=\"nofollow noreferrer\">has for five years</a>). So just write the naive threaded version at the top of the page."}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449030356, "post_id": 34031039, "comment_id": 55825084, "body": "@DanielWagner I just wanted to be clear. The <code>forkIO</code> example with an <code>accept</code> call in each thread, uses epoll/kqueue under the hood already? Cool."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1449033926, "post_id": 34031039, "comment_id": 55826235, "body": "Yes, the <code>forkIO</code> example with a <code>body</code> call in each thread will use epoll/kqueue."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1471964700, "post_id": 34031039, "comment_id": 65556340, "body": "@DanielWagner looks like you&#39;ve answered this question with your comment starting &quot;The wiki page is out of date&quot;. You might want to plonk it in as the answer so that this question is complete."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 0, "creation_date": 1471968357, "post_id": 34031039, "comment_id": 65558949, "body": "@StevenShaw Done."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1471968347, "creation_date": 1471968347, "answer_id": 39106000, "question_id": 34031039, "link": "https://stackoverflow.com/questions/34031039/how-to-use-the-epoll-kqueue-enabled-version-of-ghc-haskell-for-network-connectio/39106000#39106000", "title": "How to use the epoll/kqueue enabled version of GHC/Haskell for network connections?", "body": "<p>GHC's IO manager uses epoll/kqueue under the hood without any special programmer effort. Just write the naive threaded program -- that puts each concurrent blocking IO call in a separate thread -- and GHC will make sure it works out the way you want it to.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1471968347, "creation_date": 1449007334, "last_edit_date": 1449007787, "question_id": 34031039, "link": "https://stackoverflow.com/questions/34031039/how-to-use-the-epoll-kqueue-enabled-version-of-ghc-haskell-for-network-connectio", "title": "How to use the epoll/kqueue enabled version of GHC/Haskell for network connections?", "body": "<p>There is a lot of old information on the net regarding an epoll/kqueue enabled GHC. For example, the code on the <a href=\"https://wiki.haskell.org/Simple_Servers\" rel=\"nofollow\">Simple Servers wiki page</a> doesn't compile anymore.</p>\n\n<p>Could someone provide a basic example of how to use this feature with a modern GHC version to build, e.g. a TCP server that just responds with \"Hello\" on connect?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "lazy-evaluation", "state-monad"], "comments": [{"owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "edited": false, "score": 1, "creation_date": 1450204299, "post_id": 34030388, "comment_id": 56335144, "body": "If your question isn&#39;t getting enough attention on SO, feel free to ping package authors such as myself! Issue trackers and maintainer contact info can usually be found on hackage, e.g. <a href=\"http://hackage.haskell.org/package/rev-state\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/rev-state</a>"}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1450177557, "post_id": 34287498, "comment_id": 56316489, "body": "I&#39;ve reported this as a bug to upstream: <a href=\"https://github.com/DanBurton/rev-state/issues/2\" rel=\"nofollow noreferrer\">github.com/DanBurton/rev-state/issues/2</a>"}, {"owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "edited": false, "score": 8, "creation_date": 1450203641, "post_id": 34287498, "comment_id": 56334775, "body": "Author of Tardis and rev-state here. Can confirm, this was a bug. I just uploaded rev-state-0.1.1 with Cactus&#39;s suggested fix, and turned this example into a test case. Thanks for looking into that!"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 15, "last_activity_date": 1503650705, "last_edit_date": 1503650705, "creation_date": 1450177294, "answer_id": 34287498, "question_id": 34030388, "link": "https://stackoverflow.com/questions/34030388/retrocausality-in-haskell-from-tardis-to-revstate/34287498#34287498", "title": "Retrocausality in Haskell: From Tardis to RevState", "body": "<p>I have now downloaded the source of both <code>Tardis</code> and <code>RevState</code>, and I started hacking on them until they are almost the same:</p>\n\n<ul>\n<li>I ignored everything outside the <code>Trans.{Tarids,RevState}</code> modules, so that I don't have to bother with the typeclasses</li>\n<li>I removed the forward-propagating state of <code>Tardis</code></li>\n<li>I renamed <code>Tardis</code> to <code>State</code></li>\n</ul>\n\n<p>After a bit of reordering of code, I ended up in a situation where your <code>Tardis</code>-using example still works and your <code>RevState</code>-using example still doesn't work, and their difference is minimal.</p>\n\n<p>What is that minimal difference, you ask? Unsurprisingly, the <code>MonadFix</code> instance. <a href=\"https://hackage.haskell.org/package/tardis-0.3.0.0/docs/src/Control-Monad-Trans-Tardis.html#line-133\" rel=\"nofollow noreferrer\"><code>Tardis</code> has this</a>:</p>\n\n<pre><code>instance MonadFix m =&gt; MonadFix (TardisT bw fw m) where\n  mfix f = TardisT $ \\s -&gt; do\n    rec (x, s') &lt;- runTardisT (f x) s\n    return (x, s')\n</code></pre>\n\n<p>whereas <a href=\"https://hackage.haskell.org/package/rev-state-0.1/docs/src/Control-Monad-Trans-RevState.html#line-73\" rel=\"nofollow noreferrer\"><code>RevState</code> has this</a>:</p>\n\n<pre><code>instance MonadFix m =&gt; MonadFix (StateT s m) where\n  mfix f = StateT $ \\s -&gt;\n    mfix (\\(x, _) -&gt; runStateT (f x) s)\n</code></pre>\n\n<p>While they seem similar, the big difference is that the <code>RevState</code> one is strict in the tuple constructor, whereas the <code>Tardis</code> one is lazy. (see e.g. the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#recursive-do-notation\" rel=\"nofollow noreferrer\">GHC documentation on <code>RecursiveDo</code></a> to see that the <code>Tardis</code> one desugars into an irrefutable pattern match in the lambda passed to <code>mfix</code>).</p>\n\n<p>Indeed, changing the implementation of <code>RevState</code> so that</p>\n\n<pre><code>instance MonadFix m =&gt; MonadFix (StateT s m) where\n  mfix f = StateT $ \\s -&gt; do\n    mfix (\\ ~(x, _) -&gt; runStateT (f x) s)\n</code></pre>\n\n<p>fixes your original <code>RevState</code>-using program.</p>\n"}], "owner": {"reputation": 1315, "user_id": 3780931, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7ed60a7e72a67346cacc5173dd359c65?s=128&d=identicon&r=PG&f=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/3780931/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 561, "favorite_count": 1, "accepted_answer_id": 34287498, "answer_count": 1, "score": 15, "last_activity_date": 1503650705, "creation_date": 1449004794, "last_edit_date": 1450003462, "question_id": 34030388, "link": "https://stackoverflow.com/questions/34030388/retrocausality-in-haskell-from-tardis-to-revstate", "title": "Retrocausality in Haskell: From Tardis to RevState", "body": "<p>The following program uses a backwards-traveling state as provided by the <a href=\"https://hackage.haskell.org/package/tardis\">Tardis</a> monad.</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n\nimport Control.Monad.Tardis\n\nlastOccurrence :: Int -&gt; Tardis [Int] () Bool\nlastOccurrence x = mdo\n  sendPast (x : xs)\n  xs &lt;- getFuture\n  return (not (elem x xs))\n\nlastOccurrences :: [Int] -&gt; Tardis [Int] () [Bool]\nlastOccurrences xs = mapM lastOccurrence xs\n\nmain :: IO ()\nmain =\n  print $ flip evalTardis ([], ()) $ lastOccurrences [3,4,6,7,4,3,5,7]\n</code></pre>\n\n<p>How can I replace the Tardis monad with the <a href=\"https://hackage.haskell.org/package/rev-state\">reverse State</a> monad?\nWith my following proposal, <code>main</code> loops forever instead of printing\n<code>[False,False,True,False,True,True,True,True]</code> as with the above program.</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n\nimport Control.Monad.RevState\n\nlastOccurrence :: Int -&gt; State [Int] Bool\nlastOccurrence x = mdo\n  put (x : xs)\n  xs &lt;- get\n  return (not (elem x xs))\n\nlastOccurrences :: [Int] -&gt; State [Int] [Bool]\nlastOccurrences xs = mapM lastOccurrence xs\n\nmain :: IO ()\nmain =\n  print $ flip evalState [] $ lastOccurrences [3,4,6,7,4,3,5,7]\n</code></pre>\n"}, {"tags": ["haskell", "monads", "memoization"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1449004407, "post_id": 34030173, "comment_id": 55815880, "body": "Since memoization is stateful, using monadic binding looks like a reasonable way to represent its sequential nature; the same trick works for I/O. I wonder if <code>State</code> monad is directly applicable in your case: it&#39;s specifically built for passing the changes of state (memory) around."}, {"owner": {"reputation": 269, "user_id": 4038547, "user_type": "registered", "accept_rate": 18, "profile_image": "https://graph.facebook.com/100006406093905/picture?type=large", "display_name": "Rodrigo Stv", "link": "https://stackoverflow.com/users/4038547/rodrigo-stv"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1449005172, "post_id": 34030173, "comment_id": 55816314, "body": "so is this a monadic computation? I really have trouble understanding monads from tutorials but may be they are just this"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1449005717, "post_id": 34030173, "comment_id": 55816617, "body": "Monads have a handy function <code>&gt;&gt;=</code> (aka &#39;bind&#39; aka &#39;and then&#39;) which computes a function using the one monadic value and returning another: <code>foo &gt;&gt;= \\x -&gt; retrun bar</code>, cf. <code>foo().andThen(function(x) {return bar;})</code> in JS. So <code>&gt;&gt;=</code>s are easy to chain, and they are guaranteed to run in the order specified. This fact is used to implement imperative programming, which is especially apparent with <code>do</code>-notation. Monads are not <i>limited</i> to this, though; they are just a pattern that emerges in many different circumstances (not a coincidence)."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1449134857, "post_id": 34030173, "comment_id": 55877598, "body": "Note that checking for <code>key `elem` (Data.Map.keys memo)</code> and then using <code>Data.Map.lookup key memo</code> is an anti-pattern. Instead. you should do a <code>lookup</code> and then just pattern match on it -- you learn if <code>key</code> wasn&#39;t an element of the <code>Map</code> by <code>lookup</code> returning <code>Nothing</code>. Moreover, you are always returning <code>Just</code> a value in the first coordinate (either the <code>key</code> is in the <code>memo</code> and <code>lookup</code> returns <code>Just</code>, or it is not, and you return <code>Just (fun key)</code>); so the type of <code>computeMemo</code> is unnecessarily loose and should just reutrn an <code>(Int, Map Int Int)</code>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1449134954, "post_id": 34030173, "comment_id": 55877664, "body": "Also, if <code>key</code> is not in the <code>memo</code>, you compute <code>fun key</code> twice. This may be optimized away by a sufficiently eager CSE optimizer, but you shouldn&#39;t rely on that here; just do something like <code>let result = fun key in (result, Map.insert key result memo)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": false, "score": 2, "last_activity_date": 1449135368, "last_edit_date": 1449135368, "creation_date": 1449008532, "answer_id": 34031350, "question_id": 34030173, "link": "https://stackoverflow.com/questions/34030173/is-implementation-of-memoization-in-haskell-a-monad/34031350#34031350", "title": "Is implementation of memoization in Haskell a monad?", "body": "<p>It's an ad-hoc reimplementation of parts of the internals of the <code>State</code> monad in the sense that it creates and executes functions that takes and returns an additional argument in a way that simulates state.</p>\n\n<p>The main differences between your code and <code>State</code> is:</p>\n\n<ul>\n<li><p>You hard-code the logic of passing around state for a certain type of function in your <code>solve</code> method.</p>\n\n<p><code>State</code> provides a function <code>&gt;&gt;=</code> (bind) that defines how to combine two stateful functions, or how to call one stateful function from another (all monads are required to do this).</p></li>\n<li><p>You hard-code the process of creating a stateful function from a stateless one taking and returning an <code>Int</code>.</p>\n\n<p><code>State</code> provides a function <code>return</code> that can be used to make any stateless function stateful (all monads are required to do this).</p></li>\n<li><p>You hard-code the operations you can do on your state, specifically memoizing functions in a <code>Map Int Int</code>.</p>\n\n<p><code>State</code> provides some functions to <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html#v:get\" rel=\"nofollow\"><code>get</code></a>, <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html#v:set\" rel=\"nofollow\"><code>set</code></a> and <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html#v:modify\" rel=\"nofollow\"><code>modify</code></a> the state that together with <code>&gt;&gt;=</code> can be used to create functions being stateful in all sorts of ways (this is specific to <code>State</code>, and not to monads in general).</p></li>\n</ul>\n\n<p>So yes, you have basically defined a very, very specific and narrow case of one specific monad!</p>\n\n<p>If you want to formally make it a true monad, you can define analogs to <code>&gt;&gt;=</code> and <code>return</code>, and perhaps even implement the <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#t:Monad\" rel=\"nofollow\"><code>Monad</code></a> typeclass so you can use Haskell's combinators and syntactic sugar on them.</p>\n"}], "owner": {"reputation": 269, "user_id": 4038547, "user_type": "registered", "accept_rate": 18, "profile_image": "https://graph.facebook.com/100006406093905/picture?type=large", "display_name": "Rodrigo Stv", "link": "https://stackoverflow.com/users/4038547/rodrigo-stv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1449135368, "creation_date": 1449004127, "last_edit_date": 1449134687, "question_id": 34030173, "link": "https://stackoverflow.com/questions/34030173/is-implementation-of-memoization-in-haskell-a-monad", "title": "Is implementation of memoization in Haskell a monad?", "body": "<p>I tried to solve <a href=\"https://projecteuler.net/problem=14\" rel=\"nofollow\">Project Euler's Problem 14</a> (involving length of a Collatz sequence) using memoization, and this is how I did to keep the results from previous calculations. I have this function, <code>collatzSequence</code>, that I want to memoized, and I memoize it with <code>computeWithMemo</code>, which takes a function, a value to calculate the function on, a <code>Map</code>, and returns the function's value at that point and an updated <code>Map</code>. Is this what a Monad pattern is? Thanks!</p>\n\n<pre><code>import Data.Map                                                                   \n\ncomputeWithMemo :: (Int -&gt; Int) -&gt; Int -&gt; Map Int Int -&gt; (Maybe Int, (Map Int Int)\ncomputeWithMemo fun key memo                                                      \n  | elem key (Data.Map.keys memo) = (Data.Map.lookup key memo, memo)              \n  | otherwise = (Just (fun key), Data.Map.insert key (fun key) memo)              \n\ncollatzSequence :: Int -&gt; Int                                                     \ncollatzSequence x                                                                 \n  | x == 1 = 1                                                                    \n  | even x = 1 + collatzSequence (x `div` 2)                                      \n  | odd x = 1 + collatzSequence (x*3 + 1)                                         \n\nmemoize f = computeWithMemo f                                                     \n\nmemoizedCollatz = memoize collatzSequence                                         \n\nsolve x m                                                                         \n  | x &gt; 1 = solve (x-1) (snd (computeWithMemo (collatzSequence) x m))             \n  | otherwise = m                                                                 \n\nsolution = solve 10000 Data.Map.empty                                             \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 1, "creation_date": 1449003258, "post_id": 34029594, "comment_id": 55815221, "body": "GHC&#39;s <code>Constraint</code> system expects solvability to be *monomorphically decidable (in that all types with kind <code>Constraint</code> are predicated by one or more <i>known</i> types - that is, a typeclass higherarchy can&#39;t be variadic in its typeclass header), I think that might be a lead"}], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 11, "last_activity_date": 1449003731, "creation_date": 1449003731, "answer_id": 34030068, "question_id": 34029594, "link": "https://stackoverflow.com/questions/34029594/could-we-abstract-over-type-classes/34030068#34030068", "title": "Could we abstract over type classes?", "body": "<p>You can <em>almost</em> do this with <code>ConstraintKinds</code>:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds, RankNTypes #-}\n\nimport Data.Proxy\n\ngzip :: (g b, g c) =&gt; Proxy g -&gt; (forall a . g a =&gt; [a] -&gt; [a]) -&gt; [b] -&gt; [c] -&gt; [(b,c)]\ngzip _ f xs ys = zip (f xs) (f ys)\n\ntest1 = gzip (Proxy :: Proxy Enum) (map succ) [1 .. 100] ['a' .. 'z']\ntest2 = gzip (Proxy :: Proxy Num) (map (5*)) [1 .. 100] [1.5, 2.3, 4.7]\n</code></pre>\n\n<p>The main difference is that you need the <code>Proxy</code> argument, because GHC is unable to infer the right instantiation for <code>g</code> without help.</p>\n"}, {"comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1449004205, "post_id": 34030100, "comment_id": 55815770, "body": "Interesting use of <code>PartialTypeSignatures</code>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1449004307, "post_id": 34030100, "comment_id": 55815822, "body": "@kosmikus I&#39;m tired of double Proxies :P"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1449004421, "post_id": 34030100, "comment_id": 55815889, "body": "Yes. I&#39;ll certainly keep this in mind. Although I still don&#39;t really like that <code>PartialTypeSignatures</code> are somewhat conflating type-level holes with type-level code inference. I wish they&#39;d be syntactically different like in Agda."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1449004512, "post_id": 34030100, "comment_id": 55815944, "body": "I hope that explicit type application in GHC 8.0 would let us get rid of <code>Proxy</code> and <code>KProxy</code> altogether (I wonder though what&#39;ll happen to the current &quot;ambiguous types&quot; error)."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1449004597, "post_id": 34030100, "comment_id": 55815993, "body": "Yes, there&#39;ll hopefully be lots of new possibilities :)"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 8, "last_activity_date": 1449003859, "creation_date": 1449003859, "answer_id": 34030100, "question_id": 34029594, "link": "https://stackoverflow.com/questions/34029594/could-we-abstract-over-type-classes/34030100#34030100", "title": "Could we abstract over type classes?", "body": "<p>Add a <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Proxy.html\"><code>Proxy</code></a> argument for the constraint:</p>\n\n<pre><code>{-# LANGUAGE PartialTypeSignatures #-}\n\nimport Data.Proxy\n\ngzip :: (g b, g c) =&gt; Proxy g -&gt; (forall a. g a =&gt; [a] -&gt; [a]) -&gt; [b] -&gt; [c] -&gt; [(b,c)]\ngzip _ f bs cs = zip (f bs) (f cs)\n\n&gt; gzip (Proxy :: _ Enum) [0, 1] \"ab\"\n[(1,'b'),(2,'c')]\n</code></pre>\n\n<p>GHC considers constraint parameters that only occur in constraints ambiguous, so we need to record them explicitly in a Proxy.</p>\n"}], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1449003859, "creation_date": 1449002059, "question_id": 34029594, "link": "https://stackoverflow.com/questions/34029594/could-we-abstract-over-type-classes", "title": "Could we abstract over type classes?", "body": "<p>I wonder if ithere is a deeper reason that we cannot abstract over type classes (or can we?).</p>\n\n<p>For example, when we have</p>\n\n<pre><code>fzip :: (forall a.[a] -&gt; [a]) -&gt; [b] -&gt; [c] -&gt; [(b,c)]\nfzip f xs ys = zip (f xs) (f ys)\n</code></pre>\n\n<p>then we can say</p>\n\n<pre><code>fzip (drop 42) [1..100] ['a'..'z']\nfzip reverse   [1..100] ['a'..'z']\n</code></pre>\n\n<p>and so on. But we cannot</p>\n\n<pre><code>fzip (map succ) [1..100] ['a'..'z']\n</code></pre>\n\n<p>which we can fix with:</p>\n\n<pre><code>ezip :: (Enum b, Enum c) =&gt; (forall a.Enum a =&gt; [a] -&gt; [a]) -&gt; [b] -&gt; [c] -&gt; [(b,c)]\nezip f xs ys = zip (f xs) (f ys)\n</code></pre>\n\n<p>and likewise we can fix</p>\n\n<pre><code>fzip (map (5*)) [1..100] [1.5, 2.3, 4.7]\n</code></pre>\n\n<p>with </p>\n\n<pre><code>nzip :: (Num b, Num c) =&gt; (forall a.Num a =&gt; [a] -&gt; [a]) -&gt; [b] -&gt; [c] -&gt; [(b,c)]\nnzip f xs ys = zip (f xs) (f ys)\n</code></pre>\n\n<p>But is it not embarassing that we cannot subsume <code>ezip</code> and <code>nzip</code> with something like:</p>\n\n<pre><code>gzip :: (g b, g c) =&gt; (forall a. g a =&gt; [a] -&gt; [a]) -&gt; [b] -&gt; [c] -&gt; [(b,c)]\n</code></pre>\n\n<p>though the code is absolutly identical, up to the name of the class?\nOr can we somehow?</p>\n\n<p>Interestingly, when instances were just records that contained functions, this would be easily possible.</p>\n"}, {"tags": ["macos", "haskell", "haskell-platform", "haddock"], "answers": [{"tags": [], "owner": {"reputation": 5099, "user_id": 53744, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3239a9b21ef06fa6983b461b742e6017?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/53744/will"}, "is_accepted": true, "score": 0, "last_activity_date": 1449968637, "creation_date": 1449968637, "answer_id": 34246891, "question_id": 34028926, "link": "https://stackoverflow.com/questions/34028926/is-haskell-platform-7-10-2-a1-missing-documents/34246891#34246891", "title": "Is Haskell Platform 7.10.2-a1 missing documents?", "body": "<p>(Answer applies to version 7.10.3.)</p>\n\n<p>You didn\u2019t do anything wrong.</p>\n\n<p>Yes, the <a href=\"https://haskell.org/platform/download/7.10.3/Haskell%20Platform%207.10.3%2064bit.pkg\" rel=\"nofollow\">Haskell Platform 7.10.3 64bit.pkg</a> installer really is missing HTML Haddock documentation for all non-GHC packages. You can quickly verify this by opening up the installer, choosing File > Show Files (\u2318I), and searching for <code>Data-Text.html</code>; the only result will be <code>.../src/Data-Text.html</code>, which is just the prettyprinted source code (produced by hscolour), not the Haddock documentation.</p>\n\n<p>I'm not sure why the documentation is missing from the official packages. As a workaround you could do your own build of Haskell Platform. When I tried it, it worked for me, and all the documentation was there.</p>\n\n<pre><code>git clone https://github.com/haskell/haskell-platform.git\ncd haskell-platform\ngit checkout tags/7.10.3\ncurl -OL http://downloads.haskell.org/~ghc/7.10.3/ghc-7.10.3-x86_64-apple-darwin.tar.xz\n./platform.sh ghc-7.10.3-x86_64-apple-darwin.tar.xz\n</code></pre>\n\n<p>After several minutes, the package ended up in the <code>build/product</code> directory.</p>\n"}], "owner": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 34246891, "answer_count": 1, "score": 0, "last_activity_date": 1449968637, "creation_date": 1448999629, "last_edit_date": 1449101024, "question_id": 34028926, "link": "https://stackoverflow.com/questions/34028926/is-haskell-platform-7-10-2-a1-missing-documents", "title": "Is Haskell Platform 7.10.2-a1 missing documents?", "body": "<p>I installed <strong>Haskell Platform 7.10.2-a1 64bit-signed.pkg</strong> on a MacBook Pro running OS X 10.11.1. </p>\n\n<p>It brought up a nice display in Safari. When I click on 'Libraries' and the 'Codec.Compression.Zlib', i get a page of  <code>Safari can't find the file</code> with the url <code>file:///Library/Haskell/ghc-7.10.2-x86_64/lib/zlib-0.5.4.2/doc/html/Codec-Compression-Zlib.html</code></p>\n\n<p>I searched the output of \"ghc-pkg\" and found a bunch more missing, including <code>vector</code>, <code>syb</code>, <code>split</code>, <code>parsec</code>, <code>parallel</code>, <code>QuickCheck</code> -- 42 in all.</p>\n\n<p>What did I do wrong?\nThanks!</p>\n"}, {"tags": ["php", "haskell", "vim", "text-editor"], "comments": [{"owner": {"reputation": 8169, "user_id": 2602732, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aFcDy.png?s=128&g=1", "display_name": "cmorrissey", "link": "https://stackoverflow.com/users/2602732/cmorrissey"}, "edited": false, "score": 1, "creation_date": 1448998846, "post_id": 34028626, "comment_id": 55812741, "body": "seeing that <code>-&gt;</code> is two characters I think your out of luck as there is a recording mode to record and then execute your common keys but it is two characters as well."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1448998958, "post_id": 34028626, "comment_id": 55812808, "body": "Are you using a keyboard layout that doesn&#39;t have <code>&lt;</code> and <code>&gt;</code> anywhere convenient? Otherwise I really don&#39;t see what bothers you about those three keystrokes, on a US keyboard it&#39;s really no issue."}, {"owner": {"reputation": 2728, "user_id": 761035, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/326ac920e6a668887ffffd4e7a569a0d?s=128&d=identicon&r=PG", "display_name": "Shiraaz.M", "link": "https://stackoverflow.com/users/761035/shiraaz-m"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1448999109, "post_id": 34028626, "comment_id": 55812891, "body": "@leftaroundabout I think I am using standard us layout (&lt;, &gt; is near the shift key) ... my problem is sort of needing to rely on shift to get to the &lt;,&gt; ...  but like i said I&#39;m new to haskell so maybe it&#39;s something that will grow on me naturally?? ... I also realize that I am probably being petty about it (should rather focus on learning the language first than these typing gains  :)) ... but it was a question that was lingering ever since I started"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1449074383, "post_id": 34029504, "comment_id": 55850854, "body": "Given that there isn&#39;t any difference between <code>-v</code> and <code>- v</code> in Haskell, I guess that OP can just use <code>- v</code> instead of <code>-&lt;ESC&gt;av</code> :)."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1449007002, "last_edit_date": 1449007002, "creation_date": 1449001746, "answer_id": 34029504, "question_id": 34028626, "link": "https://stackoverflow.com/questions/34028626/common-keyboard-shortcut-binding-template-for-quickly-typing-in-text/34029504#34029504", "title": "Common keyboard shortcut/binding/template for quickly typing &#39;-&gt;&#39; &amp; &#39;&lt;-&#39; in texteditor (vim)", "body": "<p>If using Vim, you could try to define some easier to type abbreviation, like this (in command mode):</p>\n\n<pre><code>:ia -v -&gt;\n</code></pre>\n\n<p>After this, any <code>-v</code> you type while in insert mode will be automatically transformed into a <code>-&gt;</code>.</p>\n\n<p>See</p>\n\n<pre><code>:h abbreviations\n</code></pre>\n\n<p>If at any moment you actually want to type the <code>-v</code>, the manual says:</p>\n\n<pre><code>To avoid the abbreviation in insert mode: Type part of\nthe abbreviation, exit insert mode with &lt;Esc&gt;, re-enter\ninsert mode with \"a\" and type the rest.  Or type CTRL-V\nbefore the character after the abbreviation.\n</code></pre>\n\n<p>It would also be best to limit these abbreviation to haskell files only, by putting something like this in the .vimrc file:</p>\n\n<pre><code>autocmd FileType haskell ia -v -&gt;\n</code></pre>\n"}], "owner": {"reputation": 2728, "user_id": 761035, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/326ac920e6a668887ffffd4e7a569a0d?s=128&d=identicon&r=PG", "display_name": "Shiraaz.M", "link": "https://stackoverflow.com/users/761035/shiraaz-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "closed_date": 1450936870, "answer_count": 1, "score": 2, "last_activity_date": 1449007002, "creation_date": 1448998580, "question_id": 34028626, "link": "https://stackoverflow.com/questions/34028626/common-keyboard-shortcut-binding-template-for-quickly-typing-in-text", "closed_reason": "Opinion-based", "title": "Common keyboard shortcut/binding/template for quickly typing &#39;-&gt;&#39; &amp; &#39;&lt;-&#39; in texteditor (vim)", "body": "<p>What are some common keyboard shortcuts/bindings for typing '->' in the texteditor? Texteditor of choice is vim if that matters.</p>\n\n<p>Where this is coming from: I'm learning Haskell and typing '->' and '&lt;-' seems to be very annoying for me and I was wondering whether there are any common templates/keybindings/shortcuts that seasoned users use in their editors?</p>\n\n<p>I presume that people that use PHP would also be of help here.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1448988908, "post_id": 34025520, "comment_id": 55806907, "body": "It looks OK to me. Which line exactly is it complaining about? Can we see the rest of the where-block?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1448989958, "post_id": 34025520, "comment_id": 55807581, "body": "Are you sure you aren&#39;t calling <code>rgb2cmyk (233, 123, 123)</code>? I would expect that to cause the error you&#39;re reporting. You need to construct a <code>Color</code> value e.g. <code>rgb2cmyk (Rgb (233, 123, 123))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 5536215, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34b3d920e62ece3a722bbd9fdb908d25?s=128&d=identicon&r=PG&f=1", "display_name": "04k", "link": "https://stackoverflow.com/users/5536215/04k"}, "edited": false, "score": 0, "creation_date": 1448989375, "post_id": 34025586, "comment_id": 55807224, "body": "Thank you! But is it possible to test without <code>$ Rgb</code> ? I got my error by: <code>test1 = rgb2cmyk 233 123 123</code>"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 53, "user_id": 5536215, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34b3d920e62ece3a722bbd9fdb908d25?s=128&d=identicon&r=PG&f=1", "display_name": "04k", "link": "https://stackoverflow.com/users/5536215/04k"}, "edited": false, "score": 0, "creation_date": 1448989536, "post_id": 34025586, "comment_id": 55807316, "body": "adding explanation about this @04k"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "reply_to_user": {"reputation": 53, "user_id": 5536215, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34b3d920e62ece3a722bbd9fdb908d25?s=128&d=identicon&r=PG&f=1", "display_name": "04k", "link": "https://stackoverflow.com/users/5536215/04k"}, "edited": false, "score": 0, "creation_date": 1448989895, "post_id": 34025586, "comment_id": 55807531, "body": "@04k: You apparently forgot the parens. You defined <code>Rgb (Int, Int, Int)</code> as a constructor accepting a 3-tuple of ints, so pass them: <code>Rgb (233, 123, 123)</code>. The answer suggests to remove them. If you don&#39;t want <code>$</code>, use <code>rgb2cmyk (Rgb ...)</code>."}, {"owner": {"reputation": 53, "user_id": 5536215, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34b3d920e62ece3a722bbd9fdb908d25?s=128&d=identicon&r=PG&f=1", "display_name": "04k", "link": "https://stackoverflow.com/users/5536215/04k"}, "edited": false, "score": 0, "creation_date": 1448990042, "post_id": 34025586, "comment_id": 55807636, "body": "Thank you! Everything is fine now!"}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 2, "last_activity_date": 1448989746, "last_edit_date": 1448989746, "creation_date": 1448988461, "answer_id": 34025586, "question_id": 34025520, "link": "https://stackoverflow.com/questions/34025520/haskell-function-not-accepting-argument/34025586#34025586", "title": "Haskell Function not accepting argument", "body": "<p>I would suggest to keep the syntax, keep <code>Rgb Int Int Int</code> instead of <code>Rgb (Int,Int,Int</code>)</p>\n\n<pre><code>data Color = Rgb Int Int Int | Cmyk Double Double Double Double deriving (Show)\n\nrgb2cmyk :: Color -&gt; Color\nrgb2cmyk (Rgb 0 0 0) = (Cmyk 0 0 0 1)\nrgb2cmyk (Rgb r g b) = (Cmyk c m y k)\n    where \n    (...)\n\n\n*Main&gt; rgb2cmyk $ Rgb 0 0 0\nCmyk 0.0 0.0 0.0 1.0\n</code></pre>\n\n<p><strong>Explaining the comment:</strong></p>\n\n<p>You cant call <code>rgb2cmyk</code> as <code>rgb2cmyk x y z</code>, the function is expecting an <code>Rgb x y z</code> so you must call it as <code>rgb2cmyk Rgb 10 10 10</code> for example. <code>Rgb</code> is a <code>Color</code> is a constructor and either <code>Rgb</code> or <code>Cmyk</code> must be called if your function takes a <code>Color</code>.</p>\n"}], "owner": {"reputation": 53, "user_id": 5536215, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34b3d920e62ece3a722bbd9fdb908d25?s=128&d=identicon&r=PG&f=1", "display_name": "04k", "link": "https://stackoverflow.com/users/5536215/04k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 34025586, "answer_count": 1, "score": 2, "last_activity_date": 1448989814, "creation_date": 1448988273, "last_edit_date": 1448989814, "question_id": 34025520, "link": "https://stackoverflow.com/questions/34025520/haskell-function-not-accepting-argument", "title": "Haskell Function not accepting argument", "body": "<p>I wrote a simple code to convert rgb to cmyk. Then I defined the datatype <code>Color</code>.\nnow I got this error:</p>\n\n<pre><code>Couldn't match expectet type `Color' with actual type `(t0, t1, t2)'\n</code></pre>\n\n<p>I thought <code>Color</code> would refer to <code>Rgb(Int,Int,Int)</code>. What I have done wrong?</p>\n\n<p>My code:</p>\n\n<pre><code>data Color = Rgb (Int,Int,Int) | Cmyk Double Double Double Double deriving (Show)\n\nrgb2cmyk :: Color -&gt; Color\nrgb2cmyk (Rgb (0,0,0)) = (Cmyk 0 0 0 1)\nrgb2cmyk (Rgb (r,g,b)) = (Cmyk c m y k)\n    where \n            rd = (fromIntegral r)/255\n            gd = (fromIntegral g)/255\n            bd = (fromIntegral b)/255\n            w = max3 rd gd bd\n            c = w - rd/w\n            m = w - gd/w\n            y = w - bd/w\n            k = 1 - w\n\nmax3 :: Double -&gt; Double -&gt; Double -&gt; Double\nmax3 a b c  | a&gt;=b &amp;&amp; a&gt;=c  = a\n            | b&gt;=a &amp;&amp; b&gt;=c  = b\n            | otherwise     = c\n\ntest1 = rgb2cmyk 233 123 123\n</code></pre>\n\n<p>Error occours in <code>test1</code> line. Do I have to write <code>rgb2cmyk $ Rgb</code>?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1448986712, "post_id": 34024368, "comment_id": 55805351, "body": "A typical way to pass a value for returning from the base recursion case is to use an &#39;accumulator&#39; parameter (used heavily in SICP). Think what <code>fold</code> does to return the value in the base case. Can you add a parameter to your recursive function that you build out during recursive steps and return in the base case?"}], "owner": {"reputation": 21, "user_id": 3494865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df4b48de738486ae4fd94fdb2c071b66?s=128&d=identicon&r=PG&f=1", "display_name": "GifflarN", "link": "https://stackoverflow.com/users/3494865/gifflarn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1448985039, "creation_date": 1448984876, "last_edit_date": 1448985039, "question_id": 34024368, "link": "https://stackoverflow.com/questions/34024368/returning-the-temporary-values-of-a-recursion-function-at-base-case-in-haskell", "title": "Returning the temporary values of a recursion function at base case in Haskell", "body": "<p>I am new to Haskell and am trying to learn by implementing the <em>Needleman-Wunsch</em> algorithm.</p>\n\n<p>Right now, I'm building the table and then the algorithm recursively goes backwards taking the optimal letter for a better score. \nHowever, the base case returns an empty string at the moment.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>type AlignmentType = (String, String)\noptAlignments :: String -&gt; String -&gt; [AlignmentType]\noptAlignments xs ys = optLen (length xs) (length ys)\nwhere\n    optLen i j = optTable!!i!!j\n    optTable = [[ optEntry i j | j&lt;-[0..]] | i&lt;-[0..] ]\n\n    optEntry :: Int -&gt; Int -&gt; [AlignmentType]\n    optEntry _ 0 = []\n    optEntry 0 _ = []\n    optEntry i j\n        | x == y = [([b],[c]) | (b:bs,c:cs) &lt;- optLen (i-1) (j-1)]\n        | otherwise = max (optLen i (j-1)) (optLen (i-1) j) --to be fixed\n\n        where \n            x = xs!!(i-1)\n            y = ys!!(j-1)\n</code></pre>\n\n<p>So my question is, how can I return the values in <code>[([b],[c]) | (b:bs,c:cs) &lt;- optLen (i-1) (j-1)]</code> after the recursion has ended?</p>\n"}, {"tags": ["haskell", "module"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 1, "last_activity_date": 1449042680, "last_edit_date": 1449042680, "creation_date": 1448985035, "answer_id": 34024427, "question_id": 34023924, "link": "https://stackoverflow.com/questions/34023924/haskell-change-the-order-of-a-list/34024427#34024427", "title": "Haskell change the order of a list", "body": "<p>So, <code>add</code> checks whether <code>x</code> is in the list, and if it isn't, it adds it to the <em>start</em> of the list. Presumably you meant to add it to the <em>end</em> of the list?</p>\n\n<p>Why not do it like this:</p>\n\n<pre><code>add :: Eq a =&gt; a -&gt; ListFav a -&gt; ListFav a\nadd x Empty = Elem (x, False) Empty\nadd x ys@(Elem (y,t) ys2) = if x == y then ys else Elem (y,t) (add x ys2)\n</code></pre>\n\n<p>That is, see if the first element is the one you're asked to add. If it is, we're done. If it isn't, recursively look at the next item. If you get to the end without finding the item, then add it.</p>\n"}, {"tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 0, "last_activity_date": 1448985050, "creation_date": 1448985050, "answer_id": 34024440, "question_id": 34023924, "link": "https://stackoverflow.com/questions/34023924/haskell-change-the-order-of-a-list/34024440#34024440", "title": "Haskell change the order of a list", "body": "<p>You explicitly put the last added result at the top of your list in the very last line: <code>Elem (x, False) xs</code>.</p>\n\n<p>If you just want to <em>print</em> the result in \"chronological\" order, you can implement <code>Show</code> on your own and reverse the list there.</p>\n\n<p>Also, you could potentially add your element at the end rather economically, since you scan the entire list for duplicates anyway. You could do the scanning and rebuilding in the same go.</p>\n"}, {"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 0, "last_activity_date": 1448992036, "creation_date": 1448992036, "answer_id": 34026737, "question_id": 34023924, "link": "https://stackoverflow.com/questions/34023924/haskell-change-the-order-of-a-list/34026737#34026737", "title": "Haskell change the order of a list", "body": "<p>Maybe I am missing the point, but you can solve this simply with base functions. Try <code>reverse . nub</code> or <code>nub . reverse</code>.</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:nub\" rel=\"nofollow\">nub</a></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:reverse\" rel=\"nofollow\">reverse</a></li>\n</ul>\n"}], "owner": {"reputation": 23, "user_id": 4236885, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-iV4bAx3qf88/AAAAAAAAAAI/AAAAAAAAACE/iJAw05gZQwc/photo.jpg?sz=128", "display_name": "Sir Hadez", "link": "https://stackoverflow.com/users/4236885/sir-hadez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 34024427, "answer_count": 3, "score": 2, "last_activity_date": 1449042680, "creation_date": 1448983596, "question_id": 34023924, "link": "https://stackoverflow.com/questions/34023924/haskell-change-the-order-of-a-list", "title": "Haskell change the order of a list", "body": "<p>so I have this module that creates a list of favorites, when i add something to the list i want it to appear in the end of the list. For example</p>\n\n<pre><code>let l1 = foldr add empty \"bacaaced\"\n</code></pre>\n\n<p>The result should be {'d', 'e', 'c', 'a', 'b'} </p>\n\n<p>Note : The result appear that way cause i have a Show instance implemented.</p>\n\n<p>And my result is { 'b' , 'a' , 'c', 'e', 'd'}</p>\n\n<p>I have tried to reverse the input string but didnt managed to make it work, can anyone help me with this?</p>\n\n<pre><code>module MyModule\n( ListFav(..)\n, empty\n, add\n) where\n\ndata ListFav a = Elem (a,Bool) (ListFav a ) | Empty deriving (Show)\n\nempty :: ListFav a\nempty = Empty\n\ninList :: Eq a =&gt; a -&gt; ListFav a -&gt; Bool\ninList y (Elem (x,_) (xs))\n   | y == x = True\n   | xs == Empty = False\n   | otherwise = inList y xs\n\nadd :: Eq a =&gt; a -&gt; ListFav a -&gt; ListFav a\nadd x Empty = Elem(x,False) Empty\nadd x xs \n   | inList x xs == True = xs   \n   | otherwise = Elem (x,False) xs\n</code></pre>\n"}, {"tags": ["haskell", "types", "type-families"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1448986908, "post_id": 34023912, "comment_id": 55805513, "body": "You are probably crazy to want it, but then again I think overlapping instances (and related tricks with closed type families) are very suspicious."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448993159, "post_id": 34023912, "comment_id": 55809470, "body": "What goes wrong if you simply omit the clause <code>type instance Pull a = &#39;[]</code>? (You haven&#39;t talked much about how <code>Pull</code> is used!)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1448993954, "post_id": 34023912, "comment_id": 55809917, "body": "Can you distinguish the different APIs by kind? If so, you could write <code>type family Pull (x :: k) :: [*]; type instance Pull (x :: SomeAPIKind) = SomeClosedTypeFamily x</code>, which gives you the full power of a closed type family but still allows the user to always extend the <code>Pull</code> type family by defining their own kind of API with data kinds."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448995133, "post_id": 34023912, "comment_id": 55810570, "body": "@DanielWagner I added an example which I hopes help to justify the question. If the pull clause is omitted then the type family will get stuck and litter the API tree with <code>Pull</code> clauses that have no meaning. I&#39;d like it just to be, essentially, a kind morphism. Except that both kinds are (a) not represented in the system and (b) &quot;open&quot;."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1448995234, "post_id": 34023912, "comment_id": 55810625, "body": "@user2407038 I didn&#39;t realize that worked! It won&#39;t solve the problem since I can&#39;t distinguish kind, but it&#39;s interesting."}], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1448995015, "creation_date": 1448983553, "last_edit_date": 1448995015, "question_id": 34023912, "link": "https://stackoverflow.com/questions/34023912/can-we-accomplish-type-level-scrap-your-boilerplate-with-open-type-families", "title": "Can we accomplish type level &quot;Scrap Your Boilerplate&quot; with open type families?", "body": "<p>Is it possible to define a total type family open to refinements? Or, can we have \"scrap your boilerplate\" (and a little bit more) at the type level?</p>\n\n<p>What I mean by this is a type family which has as it's base case</p>\n\n<pre><code>type family F a\ntype instance F a = a\n</code></pre>\n\n<p>but which allows refinement</p>\n\n<pre><code>-- later\ntype instance F X = Y\n</code></pre>\n\n<p>This is obviously overlapping and overlapping type families are disallowed for type safety. The nice property of this, however, is that <code>F</code> could apply over arbitrary types ignoring most of them and only \"firing\" against certain redexes.</p>\n\n<p>There may be no direct answer. In that case, here is the use case I have. Perhaps there is a different answer possible.</p>\n\n<p>I'd like to make a function for Servant which transforms API declarations. For those unfamiliar with Servant API declarations, they're a type constructed under something like the following rules (but open to extension by new rules)</p>\n\n<pre><code>x is a Symbol       |- Seg x is an API     (representing a static segment in the URI)\nm is a Symbol       |- Capture m is an API (capturing data from the URI)\nm is a Symbol       |- Header m is an API  (pulling in header info)\nx and y are APIs    |- x :&lt;|&gt; y is an API  (biased choice)\nx and y are APIs    |- x :&gt; y is an API    (segment concatenation)\nm is an HTTP method |- Verb m is an API    (endpoint, leaf)\n</code></pre>\n\n<p>This is a bit of a loosely typed tree and could be made more specific, but you get the idea.</p>\n\n<pre><code>Header \"X-API-Version\" :&gt; \"users\" :&gt; Capture \"id\" :&gt; \n  (     Verb GET\n   :&lt;|&gt; Verb POST\n   :&lt;|&gt; Verb DELETE )\n</code></pre>\n\n<p>I'd like to extend this API tree with the following rules</p>\n\n<pre><code> |- OptionsStub is an API\n ms is a list of Symbols |- Options ms is an API\n</code></pre>\n\n<p>where <code>Options ms</code> is an endpoint for <code>OPTIONS</code> which reports the CORS header <code>Access-Control-Allowed-Headers</code> describing the set of all request headers allowed for use at this endpoint. Given a tree which contains some <code>OptionsStub</code> endpoints within it, I can presumably push the <code>Header</code>s I see down the tree and replace <code>OptionsStub</code> types with <code>Options</code> types.</p>\n\n<pre><code>Header \"If-Range\" :&gt; \nSeg \"users\" :&gt; \n(      OptionsStub \n  :&lt;|&gt; Verb Get \n  :&lt;|&gt; Capture \"id\" ( OptionsStub :&lt;|&gt; Verb Get ) )\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>Header \"If-Range\" :&gt; \nSeg \"users\" :&gt; \n(      Options [\"If-Range\"]\n  :&lt;|&gt; Verb Get \n  :&lt;|&gt; Capture \"id\" ( Options [\"If-Range\"] :&lt;|&gt; Verb Get ) )\n</code></pre>\n\n<p>enabling local reasoning around demonstration of <code>Options</code>.</p>\n\n<pre><code>type family Push hdrs api\n\n-- interesting rules\ntype instance Push hdrs OptionsStub = Options hdrs\ntype instance Push hdrs (a :&gt; b) = a :&gt; Push (Pull a ++ hdrs) b\n\n-- boring, but for completeness\ntype instance Push hdrs (Verb x) = Verb x\ntype instance Push hdrs (Seg s) = Seg s\ntype instance Push hdrs (Capture m) = Capture m\ntype instance Push hdrs (Header m) = Header m\ntype instance Push hdrs (x :&lt;|&gt; y) = Push hdrs x :&lt;|&gt; Push hdrs y\n\ntype family Pull api :: [*]\n\ntype instance Pull (Header m) = '[m]\ntype instance Pull a = '[]  -- OVERLAPPING\n</code></pre>\n\n<p>Crucially, I can define <code>Push</code> by doing complete analysis of the types that valid APIs are made of, but I decided not to do that for <code>Pull</code> and therefore am stuck with an overlapping instance.</p>\n\n<p>More realistically, the overlapping instance is desirable because APIs are, as a kind, open to extension (or really, they're monokinded, but that has the same effect in practice) and yet my <code>Header</code> collection system is fixed. Presumably, nobody will ever extend API types with a new way of representing request headers (one already exists!) so my code may as well be closed for extension.</p>\n\n<p>But if I use closed type families then, like this problem, type elaboration would get stuck.</p>\n\n<p>I'd prefer to specify my type families simply</p>\n\n<pre><code>type instance Push hdrs OptionsStub = Options hdrs\ntype instance Push hdrs (a :&gt; b) = a :&gt; Push (Pull a ++ hdrs) b\n\ntype instance Pull (Header m) = '[m]\ntype instance Pull a = '[]\n</code></pre>\n\n<p>and then allow users to extend their API description rules without needing to extend the coverage of these type families.</p>\n\n<p>Is there any mechanism to achieve this sort of end? Am I crazy to want it?</p>\n"}, {"tags": ["haskell", "agda", "st-monad"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1448984392, "post_id": 34023712, "comment_id": 55803564, "body": "You might want to look at Bernardy et al, &quot;Proofs for Free&quot;, which considers parametricity in Agda. Apparently, adding a parametricity postulate does not change the consistency strength. But even if you don&#39;t want to do that, the paper may give you some ideas."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1448986250, "post_id": 34023712, "comment_id": 55804997, "body": "Don&#39;t you just want a global state extendable with unique names? Linear types, nominal logics, another <code>State</code> on top of the existing... I&#39;d stick to the indexed <code>State</code> monad as in one of the answers to the mentioned SO question. Also, there is a very similar construction in the Wouter Swiestra&#39;s <a href=\"http://www.staff.science.uu.nl/~swier004/Publications/Thesis.pdf\" rel=\"nofollow noreferrer\">thesis</a> (note that now we have instance arguments to which we can delegate the proving work (I haven&#39;t tried this though))."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1448987156, "post_id": 34023712, "comment_id": 55805705, "body": "@user3237465 I&#39;d like to have some notion of &quot;older/newer version of the same state&quot;. With indexed state monads, we have to prove each time that a reference can be weakened to the possibly extended new state. There&#39;s no necessary relation between the state in which we allocate a ref and the state in which we use it. Which is justified, I guess, since references can come from anywhere in the absence of <code>runST</code> tricks."}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1449095218, "post_id": 34032387, "comment_id": 55862815, "body": "Thanks. I get the main idea, but this&#39;ll require some effort to digest."}, {"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1561616806, "post_id": 34032387, "comment_id": 100124259, "body": "The link is now dead. Is there an up to date version?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 1, "creation_date": 1598354045, "post_id": 34032387, "comment_id": 112425295, "body": "@WorldSEnder: here&#39;s a hopefully <a href=\"https://github.com/AndrasKovacs/misc-stuff/blob/2e72234ea7d9d6c51063732ee61b2929ce00ee08/agda/ST/ST.agda\" rel=\"nofollow noreferrer\">persistent link</a> to a comparable Agda file."}], "tags": [], "owner": {"reputation": 1351, "user_id": 1207745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08000b9f8b263fa903b99fc645e5e924?s=128&d=identicon&r=PG", "display_name": "Saizan", "link": "https://stackoverflow.com/users/1207745/saizan"}, "is_accepted": true, "score": 5, "last_activity_date": 1449013297, "creation_date": 1449013297, "answer_id": 34032387, "question_id": 34023712, "link": "https://stackoverflow.com/questions/34023712/modeling-the-st-monad-in-agda/34032387#34032387", "title": "Modeling the ST monad in Agda", "body": "<p>Here's some form of a solution done by postulating a parametricity theorem.\nIt also ensures that the postulate does not get in the way of computation.</p>\n\n<p><a href=\"http://code.haskell.org/~Saizan/ST/ST.agda\" rel=\"noreferrer\">http://code.haskell.org/~Saizan/ST/ST.agda</a></p>\n\n<p>\"darcs get <a href=\"http://code.haskell.org/~Saizan/ST/\" rel=\"noreferrer\">http://code.haskell.org/~Saizan/ST/</a>\" for the full source</p>\n\n<p>I'm not happy about the closed universe of types but it's the easy way to tailor the parametricity theorem to what we actually need.</p>\n"}], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 4, "accepted_answer_id": 34032387, "answer_count": 1, "score": 11, "last_activity_date": 1449013297, "creation_date": 1448982969, "last_edit_date": 1495541733, "question_id": 34023712, "link": "https://stackoverflow.com/questions/34023712/modeling-the-st-monad-in-agda", "title": "Modeling the ST monad in Agda", "body": "<p>This recent <a href=\"https://stackoverflow.com/questions/33975270/can-a-st-like-monad-be-executed-purely-without-the-st-library\">SO question</a> prompted me to write an unsafe and pure emulation of the ST monad in Haskell, a slightly modified version of which you can see below:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor, GeneralizedNewtypeDeriving, RankNTypes #-}\n\nimport Control.Monad.Trans.State\nimport GHC.Prim (Any)\nimport Unsafe.Coerce (unsafeCoerce)\nimport Data.List\n\nnewtype ST s a = ST (State ([Any], Int) a) deriving (Functor, Applicative, Monad)\nnewtype STRef s a = STRef Int deriving Show\n\nnewSTRef :: a -&gt; ST s (STRef s a)\nnewSTRef a = ST $ do\n  (env, i) &lt;- get\n  put (unsafeCoerce a : env, i + 1)\n  pure (STRef i)\n\nupdate :: [a] -&gt; (a -&gt; a) -&gt; Int -&gt; [a]\nupdate as f i = case splitAt i as of\n  (as, b:bs) -&gt; as ++ f b : bs\n  _          -&gt; as\n\nreadSTRef :: STRef s a -&gt; ST s a\nreadSTRef (STRef i) = ST $ do\n  (m, i') &lt;- get\n  pure (unsafeCoerce (m !! (i' - i - 1)))\n\nmodifySTRef :: STRef s a -&gt; (a -&gt; a) -&gt; ST s ()\nmodifySTRef (STRef i) f = ST $\n  modify $ \\(env, i') -&gt; (update env (unsafeCoerce f) (i' - i - 1), i')\n\nrunST :: (forall s. ST s a) -&gt; a\nrunST (ST s) = evalState s ([], 0)\n</code></pre>\n\n<p>It would be good if we could present the usual ST monad API without <code>unsafeCoerce</code>. Specifically, I'd like to formalize the reasons why the usual GHC ST monad and the above emulation works. It seems to me that they work because:</p>\n\n<ul>\n<li>Any <code>STRef s a</code> with the right <code>s</code> tag <em>must have been</em> created in the current ST computation, since <code>runST</code> ensures that different states can't be mixed up. </li>\n<li>The previous point together with the fact that ST computations can only ever extend the environment of references implies that any <code>STRef s a</code> with the right <code>s</code> tag refers to a valid <code>a</code>-typed location in the environment (after possibly weakening the reference at runtime). </li>\n</ul>\n\n<p>The above points enable a remarkably proof-obligation-free programming experience. Nothing really comes close in safe and pure Haskell that I can think of; we can do a rather poor imitation with indexed state monads and heterogeneous lists, but that doesn't express any of the above points and thus requires proofs at each use site of <code>STRef</code>-s.</p>\n\n<p>I'm at a loss how we could formalize this properly in Agda. For starters, \"allocated in <em>this</em> computation\" is tricky enough. I thought about representing <code>STRef</code>-s as proofs that a particular allocation is contained in a particular <code>ST</code> computation, but that seems to result in an endless recursion of type indexing. </p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 552, "user_id": 1941519, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c056e7677c157248af7f91a2c118a7d?s=128&d=identicon&r=PG", "display_name": "Jacob", "link": "https://stackoverflow.com/users/1941519/jacob"}, "edited": false, "score": 0, "creation_date": 1448983004, "post_id": 34023614, "comment_id": 55802518, "body": "Try renaming <code>a</code> on those last three lines?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1448987008, "post_id": 34023614, "comment_id": 55805586, "body": "There are no arrays here. <code>[a]</code> is a <i>list</i> type."}], "answers": [{"comments": [{"owner": {"reputation": 546, "user_id": 3197684, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/HiplD.jpg?s=128&g=1", "display_name": "nonsequiter", "link": "https://stackoverflow.com/users/3197684/nonsequiter"}, "edited": false, "score": 0, "creation_date": 1448983792, "post_id": 34023806, "comment_id": 55803096, "body": "What would be the solution for the inner declaration?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 546, "user_id": 3197684, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/HiplD.jpg?s=128&g=1", "display_name": "nonsequiter", "link": "https://stackoverflow.com/users/3197684/nonsequiter"}, "edited": false, "score": 0, "creation_date": 1448984463, "post_id": 34023806, "comment_id": 55803630, "body": "@nonsequiter I would expect you could remove the <code>insert</code> type declaration and have it be inferred. If you want to specify it explicitly, you need to be consistent. <code>isort</code> is declared to work for <i>any/every</i> <code>a</code> that is comparable, but <code>insert</code> is declared to only work for <code>Int</code> which is one particular comparable type. <code>Ord a =&gt; a -&gt; [a] -&gt; [a]</code> could work."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 546, "user_id": 3197684, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/HiplD.jpg?s=128&g=1", "display_name": "nonsequiter", "link": "https://stackoverflow.com/users/3197684/nonsequiter"}, "edited": false, "score": 0, "creation_date": 1448984730, "post_id": 34023806, "comment_id": 55803817, "body": "@nonsequiter Also, it appears there is a bug as the <code>a</code> (variable, not type) in the base case of <code>insert</code> is ignored and should probably be <code>a:[]</code>."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 11, "last_activity_date": 1448983204, "creation_date": 1448983204, "answer_id": 34023806, "question_id": 34023614, "link": "https://stackoverflow.com/questions/34023614/haskell-what-does-the-type-ord-a-mean/34023806#34023806", "title": "Haskell - What does the type Ord a mean?", "body": "<p>The <code>Ord a</code> is a typeclass constraint that indicates your function works for any type <code>a</code>, so long as <code>a</code> is comparable (<code>Ord</code>erable). The error message you're getting is due to the conflict between your outer declaration that says it works for any <code>Ord a =&gt; a</code>, and the inner <code>insert</code> that \"only\" works for <code>Int</code>'s.</p>\n"}], "owner": {"reputation": 546, "user_id": 3197684, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/HiplD.jpg?s=128&g=1", "display_name": "nonsequiter", "link": "https://stackoverflow.com/users/3197684/nonsequiter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7330, "favorite_count": 1, "accepted_answer_id": 34023806, "answer_count": 1, "score": 3, "last_activity_date": 1448983204, "creation_date": 1448982707, "question_id": 34023614, "link": "https://stackoverflow.com/questions/34023614/haskell-what-does-the-type-ord-a-mean", "title": "Haskell - What does the type Ord a mean?", "body": "<p>I'm creating a merge sort function in Haskell that is recursive. I have been told as part of my assessment that I must define the type as:</p>\n\n<pre><code>isort :: Ord a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>I assumed the function expects an array as input and outputs an array. I know that <code>ord</code> is a class. </p>\n\n<p>In the context above what does the <code>Ord a</code> mean?</p>\n\n<p>This is my function:</p>\n\n<pre><code>isort :: Ord a =&gt; [a] -&gt; [a]\nisort [x] = [x]\nisort (x:xs) = insert x (isort xs)\n    where\n        insert :: Int -&gt; [Int] -&gt; [Int]\n        insert a [] = []\n        insert a (b:c) | a &lt; b      = a:b:c\n                       | otherwise  = b : insert a c\n</code></pre>\n\n<p>When I try to load my functions file into ghci I get the error:</p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018Int\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n      the type signature for isort :: Ord a =&gt; [a] -&gt; [a]\n      at LabSheet2.hs:17:10\nExpected type: [a]\nActual type: [Int]\n...\n</code></pre>\n"}, {"tags": ["haskell", "middleware", "haskell-wai"], "comments": [{"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 1, "creation_date": 1448990394, "post_id": 34021617, "comment_id": 55807849, "body": "Michael Snoyman discussed some of the reasons for the WAI API changes in <a href=\"http://www.yesodweb.com/blog/2014/04/disemboweling-wai\" rel=\"nofollow noreferrer\">this blog article</a>. There was also a <a href=\"http://www.yesodweb.com/blog/2014/05/wai-3-0-alpha\" rel=\"nofollow noreferrer\">follow up</a>."}, {"owner": {"reputation": 12813, "user_id": 40569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e536b92667e2150c01628f4031974fa2?s=128&d=identicon&r=PG", "display_name": "yogsototh", "link": "https://stackoverflow.com/users/40569/yogsototh"}, "reply_to_user": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 0, "creation_date": 1449047654, "post_id": 34021617, "comment_id": 55832558, "body": "Thanks! It was indeed harder to write my middleware."}], "answers": [{"tags": [], "owner": {"reputation": 12813, "user_id": 40569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e536b92667e2150c01628f4031974fa2?s=128&d=identicon&r=PG", "display_name": "yogsototh", "link": "https://stackoverflow.com/users/40569/yogsototh"}, "is_accepted": false, "score": 2, "last_activity_date": 1448981156, "creation_date": 1448981156, "answer_id": 34023131, "question_id": 34021617, "link": "https://stackoverflow.com/questions/34021617/wai-request-copying/34023131#34023131", "title": "Wai Request Copying", "body": "<p>I finally found how to do it using the requestLogger as example:</p>\n\n<p><a href=\"http://haddock.stackage.org/lts-3.15/wai-extra-3.0.13/src/Network.Wai.Middleware.RequestLogger.html#logStdout\" rel=\"nofollow\">http://haddock.stackage.org/lts-3.15/wai-extra-3.0.13/src/Network.Wai.Middleware.RequestLogger.html#logStdout</a></p>\n\n<p>Mainly you need to copy back the request body...</p>\n\n<pre><code>getRequestBody :: Request -&gt; IO (Request, [S8.ByteString])\ngetRequestBody req = do\n  let loop front = do\n         bs &lt;- requestBody req\n         if S8.null bs\n             then return $ front []\n             else loop $ front . (bs:)\n  body &lt;- loop id\n  -- logging the body here consumes it, so fill it back up\n  -- obviously not efficient, but this is the development logger\n  --\n  -- Note: previously, we simply used CL.sourceList. However,\n  -- that meant that you could read the request body in twice.\n  -- While that in itself is not a problem, the issue is that,\n  -- in production, you wouldn't be able to do this, and\n  -- therefore some bugs wouldn't show up during testing. This\n  -- implementation ensures that each chunk is only returned\n  -- once.\n  ichunks &lt;- newIORef body\n  let rbody = atomicModifyIORef ichunks $ \\chunks -&gt;\n         case chunks of\n             [] -&gt; ([], S8.empty)\n             x:y -&gt; (y, x)\n  let req' = req { requestBody = rbody }\n  return (req', body)\n</code></pre>\n"}], "owner": {"reputation": 12813, "user_id": 40569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e536b92667e2150c01628f4031974fa2?s=128&d=identicon&r=PG", "display_name": "yogsototh", "link": "https://stackoverflow.com/users/40569/yogsototh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1449230749, "creation_date": 1448976484, "last_edit_date": 1449230749, "question_id": 34021617, "link": "https://stackoverflow.com/questions/34021617/wai-request-copying", "title": "Wai Request Copying", "body": "<p>I would like to be able to use the content of the body of a request to be used as part of a cache key.</p>\n\n<p>My current code looks like:</p>\n\n<pre><code>caching app req respond =\n    -- Request Body is consumed here\n    cacheKey &lt;- strictRequestBody req\n    -- the req object is no more usable as body was consumed\n    maybe (app req (addToCacheAndRespond cacheKey))\n        (sendResponse . responseFromCachedValue)\n        (lookup cacheKey cacheContainer)\n</code></pre>\n\n<p>I don't see any solution here. How could I either copy the request or generate another request from the cacheKey and the req object?</p>\n\n<p>Or event better is there another better solution?</p>\n\n<p>As bonus point, could someone point me the rationale from changing the type of Wai Application from <code>Request -&gt; IO Response</code> to <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code>.</p>\n"}, {"tags": ["variables", "haskell", "records", "clause", "generalization"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 7, "creation_date": 1448966117, "post_id": 34018112, "comment_id": 55791622, "body": "You want <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/a-little-lens-starter-tutorial\" rel=\"nofollow noreferrer\">lenses</a>."}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1448968615, "post_id": 34018112, "comment_id": 55793151, "body": "@n.m.Thanks for your proposal. It can be a solution, but I would like to know if there is an alternative way to do this using the Haskell syntax or standard libraries."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1448971896, "post_id": 34018112, "comment_id": 55795172, "body": "No, there is not, but there are a variety of lens implementations."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1448976499, "post_id": 34018112, "comment_id": 55798033, "body": "Don&#39;t think so. That&#39;s why lenses where invented in the first place. Not because doing it with standard libraries would be too easy."}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1448988605, "post_id": 34018112, "comment_id": 55806685, "body": "@ReinHenrichs you are right. Using Lenses is a very nice way to achieve my goal. On the other hand, it seems that the compilation time has grown considerably after importing Lenses library and adding TemplateHaskell directive."}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1448988616, "post_id": 34018112, "comment_id": 55806690, "body": "@n.m. You were right. :)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1448998815, "post_id": 34018112, "comment_id": 55812722, "body": "@SalvadorTamarit You may be interested in a lighter weight lens library, but after lens itself is compiled the compilation times for your project shouldn&#39;t be that much higher."}], "owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1448965752, "creation_date": 1448965752, "question_id": 34018112, "link": "https://stackoverflow.com/questions/34018112/how-to-make-a-record-assignment-parametric-in-haskell", "title": "How to make a record assignment parametric in Haskell?", "body": "<p>Suppose we have a datatype like this:</p>\n\n<pre><code>data NodeProperties = \n    NodeProperties\n    { \n        p1 :: PropertyInfo Bool,\n        p2 :: PropertyInfo [String],\n        p3 :: PropertyInfo [String],\n        p4 :: PropertyInfo Bool,\n        p5 :: PropertyInfo [String]\n    } \n    deriving (Show, Data, Typeable)\n</code></pre>\n\n<p>and we have a modify function that has this kind of clauses:</p>\n\n<pre><code>| p1Prefix /= Nothing =\n    let \n        value = readBoolean p1Prefix\n        newProperties = \n            properties\n            { \n                p1 = (p1 properties){value = Just value}\n            }\n    in \n        modifyPropertiesNode pragmas newProperties\n| p2Prefix /= Nothing =\n    let \n        value = readStringList p2Prefix\n        newProperties = \n            properties\n            { \n                p2 = (p2 properties){value = Just value}\n            }\n    in \n        modifyPropertiesNode pragmas newProperties\n</code></pre>\n\n<p>In my opinion, it would be better to have code above generalized to something like the code below.</p>\n\n<pre><code>| p1Prefix /= Nothing =\n    updateProperty p1 readBoolean p1Prefix pragmas\n| p2Prefix /= Nothing =\n    updateProperty p2 readStringList p2Prefix pragmas\n</code></pre>\n\n<p>In order to do something like this I would need to use variables at the left hand side of a record assignment, and it seems that Haskell does not like the idea. Is there any alternative to achieve this? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1448970991, "post_id": 34016644, "comment_id": 55794652, "body": "I think is a good (util) answer but I can&#39;t get suggested reduction (testing <code>echo &#39;f = getSum . foldMap Sum&#39; | hlint -</code>). Can you show some similar behavior?"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1448971151, "post_id": 34016644, "comment_id": 55794747, "body": "@josejuan Is the only thing I knew about that more or less fit in for your question, I havent used it myself, just the atom plugin. Cant go further my friend."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 1, "last_activity_date": 1448961338, "creation_date": 1448961338, "answer_id": 34016644, "question_id": 34016436, "link": "https://stackoverflow.com/questions/34016436/equivalent-function-search-function-usage-deduction/34016644#34016644", "title": "&quot;Equivalent function&quot; search (function usage deduction)", "body": "<p>There is <a href=\"https://hackage.haskell.org/package/hlint\" rel=\"nofollow\">Hlint</a>, it really works well.</p>\n\n<p>There is a <a href=\"https://atom.io/packages/linter-hlint\" rel=\"nofollow\">plugin</a> for <a href=\"https://atom.io/\" rel=\"nofollow\">atom</a>.\nI've been using it for a while and It really helps, you can even learn from it sometimes.</p>\n"}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 1, "accepted_answer_id": 34016644, "answer_count": 1, "score": 2, "last_activity_date": 1448961338, "creation_date": 1448960728, "question_id": 34016436, "link": "https://stackoverflow.com/questions/34016436/equivalent-function-search-function-usage-deduction", "title": "&quot;Equivalent function&quot; search (function usage deduction)", "body": "<p>When coding, we write code using our own knowledge about available machinery. That knowledge is (obviously) partial. Would be great some tool (e.g. like <code>pointfree</code>) say to us if exists some function equivalent to our code. That work looks be, in general, NP-complete (subgraph isomorphism) but may be practical in some cases.</p>\n\n<p>I'm thinking in some like:</p>\n\n<ol>\n<li>search code signature (and perhaps sub-search) using Hoogle.</li>\n<li>test equivalence using some proof tooling or empirically using <code>Test.QuickCheck</code>.</li>\n</ol>\n\n<p>Example:</p>\n\n<pre><code>&gt; :t getSum . foldMap Sum\ngetSum . foldMap Sum :: (Num c, Foldable t) =&gt; t c -&gt; c\n&gt; :t sum\nsum :: (Num a, Foldable t) =&gt; t a -&gt; a\n&gt;\n</code></pre>\n\n<p>Then, when writes the former, the later is suggested automatically. Using <code>pointfree</code> style:</p>\n\n<pre><code>$ search-equivalence 'getSum . foldMap Sum'\nsum\n</code></pre>\n\n<p>Exists some tooling doing this?</p>\n"}, {"tags": ["haskell", "ghc", "type-variables"], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1448963376, "post_id": 34012129, "comment_id": 55789901, "body": "what&#39;s the rationale behind this?"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1449000714, "post_id": 34012129, "comment_id": 55813796, "body": "@ErikAllik: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/other-type-extensions.html#scoped-type-variables\" rel=\"nofollow noreferrer\">The manual</a> doesn&#39;t say, but I expect it&#39;s so that existing code doesn&#39;t have its behavior changed simply by turning on <code>ScopedTypeVariables</code>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 10, "last_activity_date": 1448940831, "creation_date": 1448940831, "answer_id": 34012129, "question_id": 34012115, "link": "https://stackoverflow.com/questions/34012115/scopedtypevariables-doesnt-bring-type-variables-into-scope/34012129#34012129", "title": "ScopedTypeVariables doesn&#39;t bring type variables into scope", "body": "<p>Even with <code>ScopedTypeVariables</code> turned on, type variables are not put in scope unless you explicitly quantify them, i.e.</p>\n\n<pre><code>ptrAlign1 :: forall a. (Storable a) =&gt; Ptr a -&gt; Int\nptrAlign1 _ = alignment (undefined :: a) \n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 1, "accepted_answer_id": 34012129, "answer_count": 1, "score": 7, "last_activity_date": 1449027174, "creation_date": 1448940740, "last_edit_date": 1449027174, "question_id": 34012115, "link": "https://stackoverflow.com/questions/34012115/scopedtypevariables-doesnt-bring-type-variables-into-scope", "title": "ScopedTypeVariables doesn&#39;t bring type variables into scope", "body": "<p>Here's a simple function to return the alignment of a pointer:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Foreign.Ptr (Ptr)\nimport Foreign.Storable (Storable, alignment)\n\nmain = return ()\n\nptrAlign1 :: (Storable a) =&gt; Ptr a -&gt; Int\nptrAlign1 _ = alignment (undefined :: a) \n</code></pre>\n\n<p>But I get the following error:</p>\n\n<pre><code>Could not deduce (Storable a0) arising from a use of `alignment'\nfrom the context (Storable a)\n  bound by the type signature for\n             ptrAlign1 :: Storable a =&gt; Ptr a -&gt; Int\n  at prog.hs:8:14-41\nThe type variable `a0' is ambiguous\n</code></pre>\n\n<p>If I rewrite <code>ptrAlign</code> in a more messy faction like so:</p>\n\n<pre><code>ptrAlign2 :: (Storable a) =&gt; Ptr a -&gt; Int\nptrAlign2 = ptrAlign3 undefined where\n  ptrAlign3 :: (Storable a) =&gt; a -&gt; Ptr a -&gt; Int\n  ptrAlign3 x _ = alignment x\n</code></pre>\n\n<p>It works fine (of course this version doesn't even need <code>ScopedTypeVariables</code>).</p>\n\n<p>But I'm still curious about why the first version is throwing an error, and what can be done to resolve it?</p>\n"}, {"tags": ["haskell", "redis"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1448928231, "post_id": 34010291, "comment_id": 55776635, "body": "<code>len &lt;- fmap (fmap length) res</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1009, "user_id": 851170, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/91849b553c2c0c05e4decc50a70ecffc?s=128&d=identicon&r=PG", "display_name": "Dave Collins", "link": "https://stackoverflow.com/users/851170/dave-collins"}, "edited": false, "score": 0, "creation_date": 1448938456, "post_id": 34011777, "comment_id": 55779392, "body": "Thanks for the answer.  When I try that, I get an error on the Right line:library/Redis.hs:66:24:     Couldn&#39;t match expected type \u2018Redis Int\u2019 with actual type \u2018Int\u2019     In the expression: length allKeys     In a case alternative: Right allKeys -&gt; length allKeys"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 1009, "user_id": 851170, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/91849b553c2c0c05e4decc50a70ecffc?s=128&d=identicon&r=PG", "display_name": "Dave Collins", "link": "https://stackoverflow.com/users/851170/dave-collins"}, "edited": false, "score": 0, "creation_date": 1448938522, "post_id": 34011777, "comment_id": 55779404, "body": "Dave Collins: d&#39;oh. That&#39;s what I get for answering w/o compiling. Fixed (hopefully)"}, {"owner": {"reputation": 1009, "user_id": 851170, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/91849b553c2c0c05e4decc50a70ecffc?s=128&d=identicon&r=PG", "display_name": "Dave Collins", "link": "https://stackoverflow.com/users/851170/dave-collins"}, "edited": false, "score": 0, "creation_date": 1448938625, "post_id": 34011777, "comment_id": 55779429, "body": "Thank you so much!! I&#39;m Cargo-culting the Haskell in a big way now!"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 4, "last_activity_date": 1448938511, "last_edit_date": 1448938511, "creation_date": 1448938294, "answer_id": 34011777, "question_id": 34010291, "link": "https://stackoverflow.com/questions/34010291/haskell-extract-the-length-from-an-io-either-reply-data-bytestring-internal-by/34011777#34011777", "title": "Haskell Extract the Length from an IO (Either Reply [Data.ByteString.Internal.ByteString])", "body": "<p>You're close! The key is to make your pattern match for <code>response</code> match its type. Since <code>keys keypattern :: IO (Either Reply [ByteString])</code>, <code>response</code> has the type <code>Either Reply [ByteString]</code>.</p>\n\n<p><code>Either a b</code> has two constructors - <code>Left :: a -&gt; Either a b</code> and <code>Right :: b -&gt; Either a b</code>, and these are the patterns we can match when we use <code>case</code> to deconstruct an <code>Either a b</code> value.</p>\n\n<pre><code>redisKeyCount :: Connection -&gt; BSC.ByteString -&gt; IO Int\nredisKeyCount conn keypattern =\n  runRedis conn $ do\n    response &lt;- keys keypattern\n    return $ case response of\n      Left _reply -&gt; 0\n      Right allKeys -&gt; length allKeys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1448959036, "creation_date": 1448959036, "answer_id": 34015982, "question_id": 34010291, "link": "https://stackoverflow.com/questions/34010291/haskell-extract-the-length-from-an-io-either-reply-data-bytestring-internal-by/34015982#34015982", "title": "Haskell Extract the Length from an IO (Either Reply [Data.ByteString.Internal.ByteString])", "body": "<p>A little elaboration starting from @rampion's answer:</p>\n\n<pre><code>redisKeyCount :: Connection -&gt; BSC.ByteString -&gt; IO Int\nredisKeyCount conn keypattern =\n  runRedis conn $ do\n    response &lt;- keys keypattern\n    return $ case response of\n      Left _reply -&gt; 0\n      Right allKeys -&gt; length allKeys\n</code></pre>\n\n<p>The last <code>case</code> can be shortened using the <code>either</code> eliminator:</p>\n\n<pre><code>redisKeyCount :: Connection -&gt; BSC.ByteString -&gt; IO Int\nredisKeyCount conn keypattern =\n  runRedis conn $ do\n    response &lt;- keys keypattern\n    return $ either (const 0) length response\n</code></pre>\n\n<p>Then, the <code>x &lt;- ... ; return $ f x</code> pattern is <code>fmap</code> (AKA <code>&lt;$&gt;</code>):</p>\n\n<pre><code>redisKeyCount :: Connection -&gt; BSC.ByteString -&gt; IO Int\nredisKeyCount conn keypattern =\n  runRedis conn (either (const 0) length &lt;$&gt; keys keypattern)\n</code></pre>\n"}], "owner": {"reputation": 1009, "user_id": 851170, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/91849b553c2c0c05e4decc50a70ecffc?s=128&d=identicon&r=PG", "display_name": "Dave Collins", "link": "https://stackoverflow.com/users/851170/dave-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 1, "accepted_answer_id": 34011777, "answer_count": 2, "score": 2, "last_activity_date": 1448959036, "creation_date": 1448927977, "question_id": 34010291, "link": "https://stackoverflow.com/questions/34010291/haskell-extract-the-length-from-an-io-either-reply-data-bytestring-internal-by", "title": "Haskell Extract the Length from an IO (Either Reply [Data.ByteString.Internal.ByteString])", "body": "<p>Need to Patch a Haskell project from a developer that has left, but I'm a complete Haskell Noob.</p>\n\n<p>Trying to write a function that will return the COUNT of all Redis keys matching a pattern.  Interactively, it looks like this:</p>\n\n<pre><code>*MyProj S R U&gt;let res = runRedis conn $ keys \"MP:Users*\"\n*MyProj S R U&gt; res\nRight [\"MP:Users:00:13:95:12:7D:85\",\"MP:Users:00:13:95:12:7D:84\",\"MP:Users:APP\"]\n*MyProj S R U&gt; :t res\nres :: IO (Either Reply [Data.ByteString.Internal.ByteString])\n</code></pre>\n\n<p>So in this case I simply want the length of the Right ByteString array response from Redis.  <em>3</em> in this case.  Any problems or no response and this function can just return 0.</p>\n\n<p>I really don't have a clue how to do this in Haskell,  The closest thing I can think of is this:</p>\n\n<pre><code>redisKeyCount :: Connection -&gt; BSC.ByteString -&gt; IO Int\nredisKeyCount conn keypattern =\n  runRedis conn $ do\n    response &lt;- keys keypattern\n    case response of\n      [BSC.ByteString] allkeys -&gt;\n        case length allkeys of\n          Just (n, _) -&gt; return n\n          _           -&gt; return 0\n      _ -&gt; return 0\n</code></pre>\n\n<p>But, of course that does not work.  I've tried dozens of variations of the above.  How to extract and return <strong>just the length</strong> of the Right-hand side of this res :: IO (Either Reply [Data.ByteString.Internal.ByteString]) ?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "haskell-stack", "wxhaskell"], "answers": [{"comments": [{"owner": {"reputation": 2108, "user_id": 2200817, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/4c13d246cf5226bf581cbfd451d9a50d?s=128&d=identicon&r=PG", "display_name": "allidoiswin", "link": "https://stackoverflow.com/users/2200817/allidoiswin"}, "edited": false, "score": 0, "creation_date": 1448928897, "post_id": 34009989, "comment_id": 55776848, "body": "In my .cabal, I could simply add &quot;wx -any&quot; to my build deps. With stack, I cannot just add &quot;- wxdirect -any&quot;, but rather I seem to have to actually specify the version number, which is ... annoying. Is there no way around this, i.e. is there an equivalent to &quot;-any&quot;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1448935386, "post_id": 34009989, "comment_id": 55778584, "body": "Don&#39;t badger Ed Kmett with Stack issues. That&#39;s Michael Snoyman&#39;s domain, if I&#39;m not mistaken."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 2108, "user_id": 2200817, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/4c13d246cf5226bf581cbfd451d9a50d?s=128&d=identicon&r=PG", "display_name": "allidoiswin", "link": "https://stackoverflow.com/users/2200817/allidoiswin"}, "edited": false, "score": 0, "creation_date": 1448946745, "post_id": 34009989, "comment_id": 55781699, "body": "@allidoiswin There is not, to the best of my knowledge. Stack&#39;s philosophy is to fix every package at a specific version, as it eliminates a wide class of dependency management problems. If wx is added to Stackage, of course, you won&#39;t ever have type the version number again."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 7, "last_activity_date": 1448926428, "creation_date": 1448926428, "answer_id": 34009989, "question_id": 34009800, "link": "https://stackoverflow.com/questions/34009800/why-does-stack-not-recognize-the-dependency-it-just-installed/34009989#34009989", "title": "Why does Stack not recognize the dependency it just installed?", "body": "<p>The difference between stack and cabal install is that stack requires a curated list of (package, version). The upshot is that stack will make sure that those packages at those version will all compile and be cheerful. It seems like wxdirect isn't in the curated list yet though. You should <a href=\"https://github.com/fpco/stackage\" rel=\"noreferrer\">file a PR with stackage</a>, which is a great thing to do as it'll fix this problem for other users as well.</p>\n\n<p>You can also take the advice given in the last couple lines:</p>\n\n<pre><code>Recommended action: try adding the following to your extra-deps in {project root}/stack.yaml\n- wxdirect-0.92.1.0\n</code></pre>\n\n<p>And modify your stack.yaml file. Change the default</p>\n\n<pre><code># Packages to be pulled from upstream that are not in the resolver (e.g., acme-missiles-0.3)\nextra-deps: []\n</code></pre>\n\n<p>To</p>\n\n<pre><code>extra-deps:\n- wxdirect-0.92.1.0\n</code></pre>\n\n<p>stack will now attempt an install pretending as if that (package, version) had made it onto the curated list.</p>\n\n<p>You might still run into the following problems though.</p>\n\n<h2>I don't have a stack.yaml</h2>\n\n<p>If you aren't in a a project (and you want to stack install a package to the user database, a thing that cabal install would do silently), you'll run into this. This is one of the differences between stack and cabal install, but it's a good one: cabal installing a package just puts it into the global database. This is great until packages need to be updated. With stack, you're <em>always</em> in a project. If you run stack outside a project with a stack.yaml, stack will consult your <code>~/.stack/global/stack.yaml</code>. Just stick the extra-deps there.</p>\n\n<h2>It won't build</h2>\n\n<p>Make sure you stack upgrade and you're using the latest LTS version in <code>resolver:</code>, another field in <code>stack.yaml</code>. This ensures you have the most recent curation.</p>\n\n<h2>It still won't build</h2>\n\n<p>You might have to try an older version of wxdirect. Stackage packages are sometimes, but not usually, lagging behind the last release on every package.</p>\n\n<h2>It still still won't build</h2>\n\n<p>You might have run into an issue with stack. I've seen stack bugs before. You can ask on the <a href=\"https://groups.google.com/forum/#!topic/commercialhaskell/ptG_EyWwNOs\" rel=\"noreferrer\">IRC channel</a> too. And if that doesn't work, just badger Edward Kmett on /r/haskell and he'll solve it with mathematics.</p>\n"}], "owner": {"reputation": 2108, "user_id": 2200817, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/4c13d246cf5226bf581cbfd451d9a50d?s=128&d=identicon&r=PG", "display_name": "allidoiswin", "link": "https://stackoverflow.com/users/2200817/allidoiswin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1785, "favorite_count": 2, "accepted_answer_id": 34009989, "answer_count": 1, "score": 4, "last_activity_date": 1448926428, "creation_date": 1448925377, "question_id": 34009800, "link": "https://stackoverflow.com/questions/34009800/why-does-stack-not-recognize-the-dependency-it-just-installed", "title": "Why does Stack not recognize the dependency it just installed?", "body": "<p>So I'm trying to use reactive-banana + wxHaskell for GUI programming. As a newbie to Haskell and its dev tools, I'm very perplexed by stack. </p>\n\n<p>So I try <code>stack install wx</code>, which prompts me to install <code>wxcore</code>, which prompts me to install <code>wxc</code> and <code>wxdirect</code>. After I <code>stack install wxdirect</code>, I try running <code>stack install wxc</code> , but lo and behold: </p>\n\n<pre><code>While constructing the BuildPlan the following exceptions were encountered:\n\n--  Failure when adding dependencies:    \n  wxdirect: needed (&gt;=0.90.1.1), not present in build plan (latest is 0.92.1.0)\nneeded for package: wxc-0.92.1.1\n\n--  While attempting to add dependency,\nCould not find package wxdirect in known packages\n\nRecommended action: try adding the following to your extra-deps in {project root}/stack.yaml\n- wxdirect-0.92.1.0\n</code></pre>\n\n<p>In short I'm trying to use <code>stack</code> like <code>cabal-install</code>. And I'm not sure why this is wrong. And if it is wrong, then what's the difference between <code>stack</code> and <code>cabal-install</code>? </p>\n"}, {"tags": ["haskell", "io", "order-of-execution"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1448924109, "post_id": 34009127, "comment_id": 55775117, "body": "By the way, I actually didn&#39;t believe you until I tried running the code myself. Then I actually said &quot;whaaaaa...?!&quot; aloud in my cubicle. Nice work distilling your question into such a nice, digestible, surprising form!"}, {"owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448945412, "post_id": 34009127, "comment_id": 55781276, "body": "Thank you. It was surprising to me as well. Actually I was beginning to believe that it&#39;s not Haskell&#39;s &quot;fault&quot; after all, but some other shell/terminal/OS pitfall that I didn&#39;t know about before. :)"}], "answers": [{"comments": [{"owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1448945514, "post_id": 34009356, "comment_id": 55781311, "body": "Strikingly simple explanation! I&#39;m already wondering how couldn&#39;t I think of it myself. I turns out, that Haskell still has more pitfalls for me than I expected. Thanks a lot. :)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1448923193, "creation_date": 1448923193, "answer_id": 34009356, "question_id": 34009127, "link": "https://stackoverflow.com/questions/34009127/haskell-io-execution-order/34009356#34009356", "title": "Haskell IO execution order", "body": "<p>Actually, the <code>putStr</code> and <code>hFlush</code> actions <em>are</em> being executed before the <code>getLine</code> action -- however, <code>isEOF</code> is being executed before either, and it doesn't return until it knows whether the input is <code>EOF</code> or not, that is, until you enter a line. You might consider moving the <code>isEOF</code> to right before the <code>getLine</code>, like this:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    putStr \"$ \"\n    hFlush stdout\n    unlessFinished $ do\n        getLine &gt;&gt;= putStrLn\n        main\n    where\n    unlessFinished action = isEOF &gt;&gt;= flip unless action\n</code></pre>\n"}], "owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 3, "accepted_answer_id": 34009356, "answer_count": 1, "score": 5, "last_activity_date": 1448923193, "creation_date": 1448922170, "question_id": 34009127, "link": "https://stackoverflow.com/questions/34009127/haskell-io-execution-order", "title": "Haskell IO execution order", "body": "<p>I've got the following code:</p>\n\n<pre><code>import Control.Monad (unless)\nimport System.IO (isEOF, hFlush, stdout)\n\nmain :: IO ()\nmain = unlessFinished $ do\n        putStr \"$ \"\n        hFlush stdout\n        getLine &gt;&gt;= putStrLn\n        main\n    where\n    unlessFinished action = isEOF &gt;&gt;= flip unless action\n</code></pre>\n\n<p>When I compile and run this code, it displays a cursor at the begining of the blank line and only after I hit [Enter] it outputs <code>$</code> and whatever I'd written.</p>\n\n<p>It would seem that <code>getLine</code> gets called before <code>putStr \"$ \"</code> even though <code>IO</code> monad guarantees that it's actions are called in the order they're sequenced in the code (or so I understand what is written <a href=\"https://wiki.haskell.org/IO_inside\">here</a>). So why it doesn't work correctly?</p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1448917930, "post_id": 34007324, "comment_id": 55772066, "body": "Can you make this more specific and concrete? Perhaps include some more relevant definitions and code?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1448924261, "post_id": 34007324, "comment_id": 55775191, "body": "I&#39;m having a hard time understanding the question as well, but maybe <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Compose</code></a> is the answer.  It is a <code>newtype</code> though and requires wrapping and unwrapping."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1448926125, "post_id": 34007324, "comment_id": 55775920, "body": "@LuisCasillas: That is likely the best answer, I had found it before but discounted it since it wasn&#39;t a clean solution, but it is better than a <code>newtype</code> that is defined."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1448933070, "post_id": 34007324, "comment_id": 55777940, "body": "As Haskell code becomes more abstract, newtype wrapping becomes more common.  Maybe just take the hit... using <a href=\"https://hackage.haskell.org/package/newtype\" rel=\"nofollow noreferrer\">newtype</a> library to make your life easier if you like."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1448993380, "post_id": 34007324, "comment_id": 55809596, "body": "@LuisCasillas: I went with Compose so added it as an answer, if you want to create an answer I will mark it as correct, since an ideal answer doesn&#39;t look to be possible."}], "answers": [{"tags": [], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "is_accepted": true, "score": 0, "last_activity_date": 1448993292, "creation_date": 1448993292, "answer_id": 34027142, "question_id": 34007324, "link": "https://stackoverflow.com/questions/34007324/name-a-functor-of-functor/34027142#34027142", "title": "Name a functor of functor", "body": "<p><a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Data-Functor-Compose.html\" rel=\"nofollow\"><code>Data.Functor.Compose</code></a> is a straightforward way of indirectly avoiding the <code>newtype</code>. It still involves a <code>newtype</code>, since that is how <code>Compose</code> is defined, but a new one doesn't need to be defined.</p>\n\n<p>The example above becomes <code>DMap k (Compose [] WeakSubscriber)</code>.</p>\n"}], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 34027142, "answer_count": 1, "score": 4, "last_activity_date": 1448993292, "creation_date": 1448914969, "last_edit_date": 1448920368, "question_id": 34007324, "link": "https://stackoverflow.com/questions/34007324/name-a-functor-of-functor", "title": "Name a functor of functor", "body": "<p>I have been playing around with updating <a href=\"https://hackage.haskell.org/package/reflex\" rel=\"nofollow\">Reflex</a> to <a href=\"https://hackage.haskell.org/package/dependent-map-0.2.0.1\" rel=\"nofollow\">DMap 0.2</a> and ran into an issue translating one of the embedded functors.</p>\n\n<p>Specifically it previously used a GADT to encode an <code>a -&gt; [WeakSubscriber a]</code> relationship like so:</p>\n\n<pre><code>data FanSubscriberKey k a where\n  FanSubscriberKey :: k a -&gt; FanSubscriberKey k [WeakSubscriber a]\n</code></pre>\n\n<p>However in the newest version of DMap you can just embed a functor directly. I initially lifted the <code>[]</code> out of the above but realized that since I had a functor of a functor, I had a functor and wanted to eliminate the extra data all together. Unfortunately I cannot figure out a way to describe the above mapping without using a newtype. <code>newtype WeakSubscriberList a = WeakSubscriberList [WeakSubscriber a]</code> would solve the problem but would require wrapping and unwrapping the newtype.</p>\n\n<p>Previous research points to this being considered a type-level lambda which is usually disallowed but the transformation here seemed simple enough that it could be possible, especially since I am not looking to define an instance or anything like that.</p>\n\n<p>Using DMap 0.1 we can store a <code>FanSubscriberKey k</code> and have its value be a <code>[WeakSubscriber a]</code> in a <code>DMap (FanSubscriberKey k)</code> with its key being wrapped in the <code>FanSubscriberKey</code> constructor. In DMap 0.2 if I defined the above <code>newtype</code> I could similarly say <code>DMap k WeakSubscriberList</code> and get a similar result having an unwrapped key but a value wrapped in <code>WeakSubscriberList</code>. However what I would like to say is <code>DMap k [WeakSubscriber]</code> but that obviously won't work since <code>[]</code> is kind <code>* -&gt; *</code> and <code>WeakSubscriber</code> is kind <code>* -&gt; *</code>. If there were a type level <code>.</code> such that <code>[] '. WeakSubscriber</code> compiled that would do the trick but it similarly does not exist. I also tried a type alias but <code>type WeakSubscriberList a = [WeakSubscriber a]</code> requires that <code>a</code> be specified wherever <code>WeakSubscriberList</code> is used.</p>\n"}, {"tags": ["haskell", "ssl", "openssl", "happstack"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1448913241, "post_id": 34006711, "comment_id": 55769486, "body": "Interesting find.  A friend of mine ran into this with a snap based server but didn&#39;t get to an answer and instead ran the TLS on another server and locally proxied the connection.  Your exact situation is a little different - his problem was that every once in a while a connection would hang - leaving the client in limbo - and he would see a few of the same messages you are posting (in general the server still worked)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1448913315, "post_id": 34006711, "comment_id": 55769536, "body": "My working theory is that the non-thread-safe (as in, not green thread safe due to thread local storage) values inside of OpenSSL and the manner in which the TLS support depends on OpenSSL is resulting in race conditions.  If you go in and put a mutex around every openssl (foreign) call does the situation improve?  (This was not practical last time I heard about the bug, but if it is practical for you then it would provide a small amount of additional data with which to continue debugging)."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1448915432, "post_id": 34006711, "comment_id": 55770742, "body": "@ThomasM.DuBuisson Thanks for your response. That&#39;s a shame that you&#39;ve heard of this with another server since I was leaning towards just trying something other than Happstack. When you say &quot;ran the TLS on another server...&quot; do you mean like throwing something like nginx in front of it? Because that was another option I was considering. Currently I&#39;m using <code>happstack-server-tls</code> so I&#39;m not sure your idea about wrapping OpenSSL calls is practical but I will keep the thought in mind as I move forward."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1448916425, "post_id": 34006711, "comment_id": 55771290, "body": "Yes, throwing nginx in front is exactly what I was talking about and should be a functional, though admittedly hackish, solution."}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1448912806, "creation_date": 1448912806, "question_id": 34006711, "link": "https://stackoverflow.com/questions/34006711/happstack-seemingly-random-ssl-failure", "title": "Happstack seemingly random SSL failure", "body": "<p>I have a Haskell application using Happstack that will run fine for anywhere from 1-5 days and then suddenly become unresponsive, with the log looking something like this:</p>\n\n<pre><code>ProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:140A1175:SSL routines:ssl_bytes_to_cipher_list:inappropriate fallback\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:140A1175:SSL routines:ssl_bytes_to_cipher_list:inappropriate fallback\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:140A1175:SSL routines:ssl_bytes_to_cipher_list:inappropriate fallback\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:140A1175:SSL routines:ssl_bytes_to_cipher_list:inappropriate fallback\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\nProtocolError \"error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac\"\n</code></pre>\n\n<p>Terminating and restarting the application gets it working then for another few days.</p>\n\n<p>What are some possible causes of this situation, and/or what can I do to trace/debug this issue?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 1, "creation_date": 1448905498, "post_id": 34004669, "comment_id": 55765128, "body": "A node in a tree can only have one parent. This is a graph, not a tree."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1448906077, "post_id": 34004669, "comment_id": 55765467, "body": "Would it make more sense to convert your list of edges to an actual tree structure?  It&#39;d certainly make it easier to recurse on."}, {"owner": {"reputation": 145, "user_id": 5322201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d29b9fafdcc656aa3caef7da31a533?s=128&d=identicon&r=PG", "display_name": "Richard Kelly", "link": "https://stackoverflow.com/users/5322201/richard-kelly"}, "reply_to_user": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 0, "creation_date": 1448906290, "post_id": 34004669, "comment_id": 55765576, "body": "@VincentSavard: Thank you. Have changed references from &quot;tree&quot; to &quot;graph&quot;"}, {"owner": {"reputation": 145, "user_id": 5322201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d29b9fafdcc656aa3caef7da31a533?s=128&d=identicon&r=PG", "display_name": "Richard Kelly", "link": "https://stackoverflow.com/users/5322201/richard-kelly"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1448906480, "post_id": 34004669, "comment_id": 55765690, "body": "@bheklilr: This data structure happened to be the easiest to build, and I thought it would work. But yes, maybe I need to switch to a different structure."}], "answers": [{"tags": [], "owner": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "is_accepted": true, "score": 3, "last_activity_date": 1448912429, "creation_date": 1448912429, "answer_id": 34006606, "question_id": 34004669, "link": "https://stackoverflow.com/questions/34004669/how-to-list-all-paths-through-graph-using-haskell/34006606#34006606", "title": "How to list all paths through graph using Haskell", "body": "<p>Here's my attempt:</p>\n\n<pre><code>allPaths :: Int -&gt; [(Int,Int)] -&gt; [[Int]]\nallPaths start graph = nextLists\n    where\n      curNodes = filter (\\(f,_) -&gt; f == start) graph\n      nextStarts = map snd curNodes\n      nextLists = if curNodes == []\n                  then [[start]]\n                  else map ((:) start) $ concat $ map (\\nextStart -&gt; allPaths nextStart graph) nextStarts\n</code></pre>\n\n<p>In practice:</p>\n\n<pre><code>*Main&gt; allPaths 1 [(1,6),(1,8),(6,9),(6,10),(6,13),(8,13)]\n[[1,6,9],[1,6,10],[1,6,13],[1,8,13]]\n*Main&gt; allPaths 8 [(1,6),(1,8),(6,9),(6,10),(6,13),(8,13)]\n[[8,13]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 145, "user_id": 5322201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d29b9fafdcc656aa3caef7da31a533?s=128&d=identicon&r=PG", "display_name": "Richard Kelly", "link": "https://stackoverflow.com/users/5322201/richard-kelly"}, "edited": false, "score": 1, "creation_date": 1448930907, "post_id": 34006667, "comment_id": 55777351, "body": "@Simon, your code works nicely but results in an error &quot;Not in scope: &#39;start&#39;&quot; as written. I believe you mean for the two &quot;start&quot; references to read &quot;startNode&quot;. ie: allPaths startNode graph = map (startNode:) (go startNode)."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1448957037, "last_edit_date": 1448957037, "creation_date": 1448912662, "answer_id": 34006667, "question_id": 34004669, "link": "https://stackoverflow.com/questions/34004669/how-to-list-all-paths-through-graph-using-haskell/34006667#34006667", "title": "How to list all paths through graph using Haskell", "body": "<p>The problem occurs in the recursive call to <code>allPaths</code>.</p>\n\n<p>A shorter example of failing to construct an <em>infinite type</em> is: <code>f x = [f x]</code>.</p>\n\n<p>Here, the return type of <code>f</code> must be list of whatever <code>f</code> returns. The same goes for <code>allPaths</code>.</p>\n\n<p>This problem can typically be solved with a single call to <code>concat</code>. In your case, since you use list comprehensions instead of list combinators, this corresponds to unpacking the result from your recursive call:</p>\n\n<pre><code>allPaths :: Int -&gt; [(Int, Int)] -&gt; [[Int]]\nallPaths startNode graph = map (startNode:) (go startNode)\n  where\n    go curNode =\n      case [ snd node | node &lt;- graph, fst node == curNode ] of\n        [] -&gt; [[]]\n        nextNodes -&gt; [ nextNode : path | nextNode &lt;- nextNodes, path &lt;- go nextNode ]\n</code></pre>\n\n<p>Here, <code>path &lt;- go nextNode</code> covers the <code>concatMap</code> you're missing.</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 5, "last_activity_date": 1448913551, "creation_date": 1448913551, "answer_id": 34006890, "question_id": 34004669, "link": "https://stackoverflow.com/questions/34004669/how-to-list-all-paths-through-graph-using-haskell/34006890#34006890", "title": "How to list all paths through graph using Haskell", "body": "<p>If you switch to a different representation of a graph this becomes much easier.  The structure I'm using here is not necessarily the best or most efficient, and I'm not doing any checking against cyclic relationships, but it is simpler to work with than lists of edges.</p>\n\n<p>First, some imports</p>\n\n<pre><code>import qualified Data.Map as M\n</code></pre>\n\n<p>The structure we have is a relationship between an <code>Int</code> node label and its child nodes, so</p>\n\n<pre><code>type Node = Int\ntype Children = [Node]\ntype Graph = M.Map Node Children\n</code></pre>\n\n<p>Now we can write down our test graph:</p>\n\n<pre><code>testGraph :: Graph\ntestGraph = M.fromList\n    [ (1,  [6, 8])\n    , (6,  [9, 10, 13])\n    , (8,  [13])\n    , (9,  [])\n    , (10, [])\n    , (13, [])\n    ]\n</code></pre>\n\n<p>To make this even simpler, you can write a function to go from your list of edges to this structure pretty easily:</p>\n\n<pre><code>fromEdges :: [(Node, Node)] -&gt; Graph\nfromEdges = M.fromListWith (++) . map (fmap (:[]))\n</code></pre>\n\n<p>(This does not add them in the same order, you could use a <code>Data.Set.Set</code> mitigate this issue.)</p>\n\n<p>Now you simply have</p>\n\n<pre><code>testGraph = fromEdges [(1,6),(1,8),(6,9),(6,10),(6,13),(8,13)]\n</code></pre>\n\n<p>For implementing the function <code>allPaths :: Node -&gt; Graph -&gt; [[Node]]</code> things are now pretty straightforward.  We have only three cases to consider:</p>\n\n<ol>\n<li>When looking up a node in the graph, the node does not exist.  Should return the empty list.</li>\n<li>The node exists in the graph, but has no children.  Should return the paths <code>[[node]]</code>.</li>\n<li>The node exists in the graph and has children.  Should return all paths of all children prepended with the current node.</li>\n</ol>\n\n<p>So</p>\n\n<pre><code>allPaths startingNode graph =\n    case M.lookup startingNode graph of\n        Nothing -&gt; []                -- Case 1\n        Just [] -&gt; [[startingNode]]  -- Case 2\n        Just kids -&gt;                 -- Case 3\n            map (startingNode:) $    -- All paths prepended with current node\n                concatMap (`allPaths` graph) kids  -- All kids paths\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 495, "user_id": 5279218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dc10585e371730006a4ca8d41d8918e?s=128&d=identicon&r=PG&f=1", "display_name": "Himanshu Singh", "link": "https://stackoverflow.com/users/5279218/himanshu-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1504683568, "creation_date": 1504683568, "answer_id": 46069437, "question_id": 34004669, "link": "https://stackoverflow.com/questions/34004669/how-to-list-all-paths-through-graph-using-haskell/46069437#46069437", "title": "How to list all paths through graph using Haskell", "body": "<p>WolfeFan has given a good approach above for finding all paths in a graph. But it goes in infinite loop when there is a cycle in the graph. I am just modifying his code a bit so that it can also give cyclic path if there is any.</p>\n\n<pre><code>allPaths :: Int -&gt; [(Int,Int)]-&gt;[Int] -&gt; [[Int]]\nallPaths start graph visited = nextLists\n    where\n         curNodes = filter (\\(f,_) -&gt; f == start) graph\n         nextStarts = map snd curNodes\n         nextLists |any (\\x-&gt; x `elem` visited) nextStarts = [[start]] -- Responsible for prinitng cyclic paths\n                   |otherwise = if curNodes == []\n                         then [[start]] -- Responsible for printing non-cyclic paths\n                                else map ((:) start) $ concat $ map (\\nextStart -&gt; allPaths nextStart graph (start:visited)) nextStarts\n</code></pre>\n\n<p>In Practice:\n*Main> allPaths 1 [(1,6),(1,8),(6,9),(6,10),(6,13),(8,13),(9,8),(8,1)] []</p>\n\n<p>[[1,6,9,8],[1,6,10],[1,6,13],[1,8]]</p>\n"}], "owner": {"reputation": 145, "user_id": 5322201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d29b9fafdcc656aa3caef7da31a533?s=128&d=identicon&r=PG", "display_name": "Richard Kelly", "link": "https://stackoverflow.com/users/5322201/richard-kelly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1481, "favorite_count": 2, "accepted_answer_id": 34006606, "answer_count": 4, "score": 4, "last_activity_date": 1504683568, "creation_date": 1448905235, "last_edit_date": 1448906721, "question_id": 34004669, "link": "https://stackoverflow.com/questions/34004669/how-to-list-all-paths-through-graph-using-haskell", "title": "How to list all paths through graph using Haskell", "body": "<p>I'm a beginning Haskeller. This is a script I thought would take a few minutes to build, but it's caused me quite a bit of difficulty.</p>\n\n<p>Say we have a graph composed of nodes and edges. The data structure is a list of node-to-node pairs, like this:</p>\n\n<pre><code>[(1,6),(1,8),(6,9),(6,10),(6,13),(8,13)]\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/mCVb8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mCVb8.png\" alt=\"Graphical Representation\"></a></p>\n\n<p>I want to build a function that walks through the graph and shows all possible paths from a starting node to all reachable nodes at the bottom.</p>\n\n<p>So a couple ideal executions of the function might look like this:</p>\n\n<pre><code>&gt; allPaths 1 [(1,6),(1,8),(6,9),(6,10),(6,13),(8,13)]\n[[1,6,9],[1,6,10],[1,6,13],[1,8,13]]\n&gt; allPaths 8 [(1,6),(1,8),(6,9),(6,10),(6,13),(8,13)]\n[[8,13]]\n</code></pre>\n\n<p>Here's my initial attempt which just starts to build the list of paths:</p>\n\n<pre><code>allPaths start graph = [start : [snd edge] | edge &lt;- graph, fst edge == start]\n\n&gt; allPaths 8 [(1,6),(1,8),(6,9),(6,10),(6,13),(8,13)]\n[[1,6],[1,8]]\n</code></pre>\n\n<p>The problem is I don't know how to make this solution use recursion to finish the paths. This is one of several lame attempts which doesn't pass a type check:</p>\n\n<pre><code>allPaths start graph = [start : (snd edge : allPaths (snd edge) graph) | edge &lt;- graph, fst edge == start]\n\n    Occurs check: cannot construct the infinite type: a ~ [a]\n    Expected type: [a]\n      Actual type: [[a]]\n    Relevant bindings include\n      edge :: (a, a) (bound at allpaths.hs:5:72)\n      graph :: [(a, a)] (bound at allpaths.hs:5:16)\n      start :: a (bound at allpaths.hs:5:10)\n      allPaths :: a -&gt; [(a, a)] -&gt; [[a]]\n        (bound at allpaths.hs:5:1)\n    In the second argument of `(:)', namely `allPaths (snd edge) graph'\n    In the second argument of `(:)', namely\n      `(snd edge : allPaths (snd edge) graph)'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>What does this mean? Is my list nesting going too deep.</p>\n\n<p>Does anyone have a solution or a better approach?</p>\n"}, {"tags": ["macos", "sockets", "haskell"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1448900013, "post_id": 34002720, "comment_id": 55761631, "body": "This basically means that your server closes the connection without completing the exchange; this should not be intended behavior. The wiki page you linked to says about this code: <i>&#171;Relies on the runtime scheduler to wake up the main thread in a timely fashion&#187;</i>. Maybe this is not always happening."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1448900201, "post_id": 34002720, "comment_id": 55761754, "body": "How did you compile your program? Did you use the <code>-threaded</code> runtime?"}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1448904390, "post_id": 34002720, "comment_id": 55764443, "body": "@Zeta Yes, I used <code>-threaded -rtsopts -with-rtsopts=-N</code>."}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 588, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1448899177, "creation_date": 1448899177, "question_id": 34002720, "link": "https://stackoverflow.com/questions/34002720/why-am-i-getting-hputchar-resource-vanished-errors-from-simple-haskell-networ", "title": "Why am I getting &quot;hPutChar: resource vanished&quot; errors from simple Haskell networking code?", "body": "<p>I tried to run some sample code from the <a href=\"https://wiki.haskell.org/Simple_Servers\">Haskell \"Simple Servers\" wiki page</a> today:</p>\n\n<pre><code>import Network\nimport Control.Concurrent\nimport System.IO\n\nmain = withSocketsDo $ do\n    sock &lt;- listenOn $ PortNumber 5002\n    loop sock\n\nloop sock = do\n   (h,_,_) &lt;- accept sock\n   forkIO $ body h\n   loop sock\n  where\n   body h = do\n       hPutStr h msg\n       hFlush h\n       hClose h\n\nmsg = \"HTTP/1.0 200 OK\\r\\nContent-Length: 5\\r\\n\\r\\nPong!\\r\\n\"\n</code></pre>\n\n<p>I'm doing this on a Mac with El Capitan installed.</p>\n\n<p>When I tried to run this code using <code>httperf</code> as indicated on the web page, I got the following error messages on the console:</p>\n\n<pre><code>ep1: &lt;socket: 29&gt;: hPutChar: resource vanished (Broken pipe)\nep1: &lt;socket: 29&gt;: hPutChar: resource vanished (Broken pipe)\nep1: &lt;socket: 29&gt;: hPutChar: resource vanished (Broken pipe)\nep1: &lt;socket: 29&gt;: hPutChar: protocol error (Protocol wrong type for socket)\n</code></pre>\n\n<p>Different runs will give different numbers of these messages. Am I doing something wrong, is this a bug, or is this normal, expected behavior?</p>\n"}, {"tags": ["scala", "haskell", "turing-complete"], "comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 5, "creation_date": 1448899215, "post_id": 34002061, "comment_id": 55761120, "body": "Your question is largely answered in <a href=\"http://stackoverflow.com/questions/3787960/what-makes-haskells-type-system-more-powerful-than-other-languages-type-syst\">What makes Haskell&#39;s type system more \u201cpowerful\u201d than other languages&#39; type systems?</a> -- it even uses Scala as a comparison, discusses Turing-completeness and gives examples."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1448899903, "post_id": 34002061, "comment_id": 55761546, "body": "Basically, it means you can calculate stuff at compile-time. The canonical example being containers with static sizes fixed at compile-time, and being able to statically calculate the result of concatenating two such containers."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1448903782, "post_id": 34003628, "comment_id": 55764032, "body": "I completely agree on Haskell highlighting being dull. I&#39;d love if at least <code>Uppercase</code> words got a different color. however, I must also confess that I really dislike those highlighters who insist on coloring non-keywords such as <code>print</code> as if they were &quot;special&quot;."}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "edited": false, "score": 2, "creation_date": 1448904365, "post_id": 34003628, "comment_id": 55764420, "body": "That you have to spend so much effort convincing the type system to prove stuff for you is isomorphic to a statement that the language for specifying type computations is not as powerful as you&#39;d like."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "edited": false, "score": 4, "creation_date": 1448911797, "post_id": 34003628, "comment_id": 55768650, "body": "@RexKerr I&#39;m not so sure. I think any professor will tell you that it can take quite some convincing to get a grad student to do a particular bit of work for you; and the language for communicating with grad students is quite rich and powerful indeed. Or, grounding ourselves back in type systems for a moment: some proofs are just hard!"}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "edited": false, "score": 1, "creation_date": 1448912966, "post_id": 34003628, "comment_id": 55769320, "body": "Some proofs are hard, but that&#39;s not an excuse for making easy tasks hardto express.  As an existence proof: I generally find it a lot easier to write proofs in Mathematica than in types in Scala or Haskell."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "edited": false, "score": 1, "creation_date": 1448914804, "post_id": 34003628, "comment_id": 55770359, "body": "@RexKerr If your real claim is that Haskell&#39;s proof language is subpar, well, I&#39;m certainly not going to argue with that! It was very much bolted on after-the-fact."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "edited": false, "score": 2, "creation_date": 1448915741, "post_id": 34003628, "comment_id": 55770916, "body": "@RexKerr, informal proofs in Mathematica aren&#39;t really comparable to formal ones. It&#39;s somewhat more fair to judge Haskell against something like Agda, although Haskell is not intended to be entirely sound in the same sense."}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1448922714, "post_id": 34003628, "comment_id": 55774485, "body": "@dfeuer - Mathematica does formal proofs and has since version 6.  Or else what do you call <a href=\"https://www.wolfram.com/products/mathematica/newin6/content/EquationalTheoremProving/ProveAnAbstractAlgebraicTheorem.html\" rel=\"nofollow noreferrer\">wolfram.com/products/mathematica/newin6/content/&hellip;</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 31, "last_activity_date": 1448915403, "last_edit_date": 1448915403, "creation_date": 1448901894, "answer_id": 34003628, "question_id": 34002061, "link": "https://stackoverflow.com/questions/34002061/what-is-the-reason-for-a-turing-complete-type-system/34003628#34003628", "title": "What is the reason for a Turing complete type system", "body": "<blockquote>\n  <p>What does it really mean in the context of types?</p>\n</blockquote>\n\n<p>It means the type system has enough features in it to represent arbitrary computations. As a very short proof, I present below a type-level implementation of the <code>SK</code> calculus; there are many places that discuss the Turing-completeness of this calculus and what it means, so I won't rehash that here.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE TypeOperators #-}\n\ninfixl 1 `App`\ndata Term = S | K | App Term Term\n\ntype family Reduce t where\n    Reduce S = S\n    Reduce K = K\n    Reduce (S `App` x `App` y `App` z) = Reduce (x `App` z `App` (y `App` z))\n    Reduce (K `App` x `App` y) = Reduce x\n    Reduce (x `App` y) = Reduce (Reduce x `App` y)\n</code></pre>\n\n<p>You can see this in action at a ghci prompt; for example, in the <code>SK</code> calculus, the term <code>SKSK</code> reduces (eventually) to just <code>K</code>:</p>\n\n<pre><code>&gt; :kind! Reduce (S `App` K `App` S `App` K)\nReduce (S `App` K `App` S `App` K) :: Term\n= 'K\n</code></pre>\n\n<p>Here's a fun one to try as well:</p>\n\n<pre><code>&gt; type I = S `App` K `App` K\n&gt; type Rep = S `App` I `App` I\n&gt; :kind! Reduce (Rep `App` Rep)\n</code></pre>\n\n<p>I won't spoil the fun -- try it yourself. But know how to terminate programs with extreme prejudice first.</p>\n\n<blockquote>\n  <p>Could some one give an example how a programmer can benefit from it?</p>\n</blockquote>\n\n<p>Arbitrary type-level computation allows you to express arbitrary invariants on your types, and have the compiler verify (at compile-time) that they are preserved. Want a red-black tree? How about a red-black tree that the compiler can check preserves the red-black-tree invariants? That would be handy, right, since that rules out a whole class of implementation bugs? How about a type for XML values that is statically known to match a particular schema? In fact, why not go a step further and write down a parameterized type whose parameter represents a schema? Then you could read in a schema at runtime, and have your compile-time checks guarantee that your parameterized value can only represent well-formed values in that schema. Nice!</p>\n\n<p>Or, perhaps a more prosaic example: what if you wanted your compiler to check that you never indexed your dictionary with a key that wasn't there? With a sufficiently advanced type system, you can.</p>\n\n<p>Of course, there's always a price. In Haskell (and probably Scala?), the price of a very exciting compile-time check is spending a great deal of programmer time and effort convincing the compiler that the thing you're checking is true -- and this is often both a high up-front cost as well as a high ongoing maintenance cost.</p>\n"}], "owner": {"reputation": 5410, "user_id": 2586315, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/761b7f991d4ebf05b3f85f77e55e771a?s=128&d=identicon&r=PG", "display_name": "Sayat Satybald", "link": "https://stackoverflow.com/users/2586315/sayat-satybald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2096, "favorite_count": 10, "closed_date": 1448916645, "accepted_answer_id": 34003628, "answer_count": 1, "score": 25, "last_activity_date": 1448916528, "creation_date": 1448897247, "last_edit_date": 1495540794, "question_id": 34002061, "link": "https://stackoverflow.com/questions/34002061/what-is-the-reason-for-a-turing-complete-type-system", "closed_reason": "Duplicate", "title": "What is the reason for a Turing complete type system", "body": "<p>Scala and Haskell have \"Turing complete type systems\". Usually, Turing completeness refers to <a href=\"https://stackoverflow.com/questions/7284/what-is-turing-complete\">computations and languages</a>. What does it really mean in the context of types?</p>\n\n<p>Could some one give an example of how a programmer can benefit from it?</p>\n\n<p>PS I don't want to compare Haskell's vs Scala's type systems. It's more about the term in general.</p>\n\n<p>PSS If it's possible more Scala examples.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1448861002, "post_id": 33987499, "comment_id": 55739657, "body": "Based on the example, I think the asker wants <code>(a + b) + c</code>, <code>a + (b + c)</code> and <code>a + b + c</code> to parse to three different trees."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1448828899, "last_edit_date": 1448828899, "creation_date": 1448827843, "answer_id": 33987499, "question_id": 33987104, "link": "https://stackoverflow.com/questions/33987104/parsing-non-binary-operators-with-parsec/33987499#33987499", "title": "Parsing non binary operators with Parsec", "body": "<p>Yes! The key is to first solve a simpler problem, which is to model <code>+</code> and <code>*</code> as tree nodes with only two children. To add four things, we'll just use <code>+</code> three times.</p>\n\n<p>This is a great problem to solve since there's a <code>Text.Parsec.Expr</code> module for just this problem. Your example is actually parseable by the <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Expr.html\" rel=\"nofollow\">example code in the documentation</a>. I've slightly simplified it here:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Lib where\n\nimport Text.Parsec\nimport Text.Parsec.Language\nimport qualified Text.Parsec.Expr as Expr\nimport qualified Text.Parsec.Token as Tokens\n\ndata Expr =\n    Identifier String\n  | Multiply Expr Expr\n  | Add Expr Expr\n\ninstance Show Expr where\n  show (Identifier s) = s\n  show (Multiply l r) = \"(* \" ++ (show l) ++ \" \" ++ (show r) ++ \")\"\n  show (Add l r) = \"(+ \" ++ (show l) ++ \" \" ++ (show r) ++ \")\"\n\n-- Some sane parser combinators that we can plagiarize from the Haskell parser.\nparens = Tokens.parens haskell\nidentifier = Tokens.identifier haskell\nreserved = Tokens.reservedOp haskell\n\n-- Infix parser.\ninfix_ operator func =\n  Expr.Infix (reserved operator &gt;&gt; return func) Expr.AssocLeft\n\nparser =\n  Expr.buildExpressionParser table term &lt;?&gt; \"expression\"\n  where\n    table = [[infix_ \"*\" Multiply], [infix_ \"+\" Add]]\n\nterm =\n  parens parser\n  &lt;|&gt; (Identifier &lt;$&gt; identifier)\n  &lt;?&gt; \"term\"\n</code></pre>\n\n<p>Running this in GHCi:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; runParser parser () \"\" \"(a + b) + c + d * e + f\"\nRight (+ (+ (+ (+ a b) c) (* d e)) f)\n</code></pre>\n\n<p>There are lots of ways of converting this tree to the desired form. Here's a hacky gross slow one:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Expr' =\n    Identifier' String\n  | Add' [Expr']\n  | Multiply' [Expr']\n  deriving (Show)\n\ncollect :: Expr -&gt; (Expr -&gt; Bool) -&gt; [Expr]\ncollect e f | (f e == False) = [e]\ncollect e@(Add l r) f =\n  collect l f ++ collect r f\ncollect e@(Multiply l r) f =\n  collect l f ++ collect r f\n\nisAdd :: Expr -&gt; Bool\nisAdd (Add _ _) = True\nisAdd _ = False\n\nisMultiply :: Expr -&gt; Bool\nisMultiply (Multiply _ _) = True\nisMultiply _ = False\n\noptimize :: Expr -&gt; Expr'\noptimize (Identifier s) = Identifier' s\noptimize e@(Add _ _) = Add' (map optimize (collect e isAdd))\noptimize e@(Multiply _ _) = Multiply' (map optimize (collect e isMultiply))\n</code></pre>\n\n<p>I will note, however, that almost always <code>Expr</code> is Good Enough\u2122 for the purposes of a parser or compiler.</p>\n"}], "owner": {"reputation": 1479, "user_id": 4673683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/106a6b52825462b10ef0904466351c00?s=128&d=identicon&r=PG", "display_name": "user19018", "link": "https://stackoverflow.com/users/4673683/user19018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1448828899, "creation_date": 1448825607, "question_id": 33987104, "link": "https://stackoverflow.com/questions/33987104/parsing-non-binary-operators-with-parsec", "title": "Parsing non binary operators with Parsec", "body": "<p>Traditionally, arithmetic operators are considered to be binary (left or right associative), thus most tools are dealing only with binary operators.</p>\n\n<p>Is there an easy way to parse arithmetic operators with Parsec, which can have an arbitrary number of arguments?</p>\n\n<p>For example, the following expression should be parsed into the tree</p>\n\n<pre><code>(a + b) + c + d * e + f\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/Ifn4P.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Ifn4P.png\" alt=\"parsed expression\"></a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 287, "user_id": 1381516, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e49827a890f6397fd9409baca18af216?s=128&d=identicon&r=PG", "display_name": "Infinity", "link": "https://stackoverflow.com/users/1381516/infinity"}, "reply_to_user": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1448820325, "post_id": 33986050, "comment_id": 55727698, "body": "It is a sort of project. Why?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448820863, "post_id": 33986050, "comment_id": 55727893, "body": "Well, at least it shows effort, unlike most SO homework questions. It does not simply ask &quot;gimme code&quot;, but provides an attempt at a solution."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1448821003, "post_id": 33986050, "comment_id": 55727948, "body": "Transposition is a good technique at simplifying these sorts of generate-a-matrix questions, but in this case I think there exists a simple solution for the original non-transposed form. Perhaps this will help: there&#39;s a way to generate the matrix you want using a list comprehension nested inside another list comprehension (a.k.a. a map nested in another map). Another hint: precompute the maximum and store it around, so as not to pay that cost over and over again."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1448821153, "post_id": 33986050, "comment_id": 55728008, "body": "<a href=\"http://ideone.com/rYIXX3\" rel=\"nofollow noreferrer\">ideone.com/rYIXX3</a>"}], "answers": [{"comments": [{"owner": {"reputation": 287, "user_id": 1381516, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e49827a890f6397fd9409baca18af216?s=128&d=identicon&r=PG", "display_name": "Infinity", "link": "https://stackoverflow.com/users/1381516/infinity"}, "edited": false, "score": 0, "creation_date": 1448905305, "post_id": 33986282, "comment_id": 55765006, "body": "It works perfectly. Thanks for the detailed explanation :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1448821267, "creation_date": 1448821267, "answer_id": 33986282, "question_id": 33986050, "link": "https://stackoverflow.com/questions/33986050/how-to-transform-a-list-of-integers-to-a-matrix-of-true-and-false-in-haskell/33986282#33986282", "title": "How to Transform a List of Integers to a Matrix of True and False in Haskell", "body": "<p>I'd use the following approach, which is compatible with yours.</p>\n\n<p>As you proposed, we use <code>transpose</code> at the end, since the transposed matrix looks easier to generate.</p>\n\n<pre><code>f :: [Int] -&gt; [[Bool]]\nf xs = transpose (...)\n</code></pre>\n\n<p>Then, each element of <code>xs</code> has to generate a new row. We can either use a list comprehension (done below), or alternatively use <code>map</code>.</p>\n\n<pre><code>f :: [Int] -&gt; [[Bool]]\nf xs = transpose [ row x | x &lt;- xs ]\n  where row :: Int -&gt; [Bool]\n        row x = ...\n</code></pre>\n\n<p>As you suggest, we also need <code>maximum</code> to generate each row, so we compute it once:</p>\n\n<pre><code>f :: [Int] -&gt; [[Bool]]\nf xs = transpose [ row x | x &lt;- xs ]\n  where m = maximum xs\n        row :: Int -&gt; [Bool]\n        row x = ...   -- we know x and m, we need m-x Falses and x Trues\n</code></pre>\n\n<p>Now, you just need to adapt your code.</p>\n"}, {"comments": [{"owner": {"reputation": 1420, "user_id": 693416, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b40373fe8f75f5eed0609e695042d528?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/693416/greg"}, "edited": false, "score": 1, "creation_date": 1448858295, "post_id": 33987701, "comment_id": 55738896, "body": "This is a nice answer, a summary of why you structured it the way you did would make it even nicer."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1448877017, "post_id": 33987701, "comment_id": 55746992, "body": "This generates the matrix upside down from the example in the OP&#39;s post. If instead of counting the individual elements of the source array down, you pass an additional countdown that starts at the maximum and eventually reaches 0, and fill each element with whether this countdown is smaller or equal to the source element, you get the right ordering."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1448888518, "post_id": 33987701, "comment_id": 55753975, "body": "@SebastianRedl No. It generates the matrix the right side up. I know it because I wrote the function and tested it. You should test it yourself."}, {"owner": {"reputation": 1420, "user_id": 693416, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b40373fe8f75f5eed0609e695042d528?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/693416/greg"}, "edited": false, "score": 0, "creation_date": 1448950549, "post_id": 33987701, "comment_id": 55783114, "body": "Good addition.  +1 for completeness!"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 3, "last_activity_date": 1448901029, "last_edit_date": 1448901029, "creation_date": 1448828936, "answer_id": 33987701, "question_id": 33986050, "link": "https://stackoverflow.com/questions/33986050/how-to-transform-a-list-of-integers-to-a-matrix-of-true-and-false-in-haskell/33987701#33987701", "title": "How to Transform a List of Integers to a Matrix of True and False in Haskell", "body": "<p>This is how I would do it:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>toMatrix' :: [[Bool]] -&gt; [Int] -&gt; [[Bool]]\ntoMatrix' acc xs\n    | or  bools = toMatrix' (bools : acc) (map pred xs)\n    | otherwise = acc\n    where bools = map (&gt; 0) xs\n\ntoMatrix :: [Int] -&gt; [[Bool]]\ntoMatrix = toMatrix' []\n</code></pre>\n\n<p>Simple and straightforward. No need to transpose.</p>\n\n<p>Here's the visualization of my program. I'll use <code>0</code> and <code>1</code> for <code>False</code> and <code>True</code> respectively.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>toMatrix [2,4,1] = toMatrix' []                                [ 2, 4, 1]\n                 = toMatrix' [[1,1,1]]                         [ 1, 3, 0]\n                 = toMatrix' [[1,1,0],[1,1,1]]                 [ 0, 2,-1]\n                 = toMatrix' [[0,1,0],[1,1,0],[1,1,1]]         [-1, 1,-2]\n                 = toMatrix' [[0,1,0],[0,1,0],[1,1,0],[1,1,1]] [-2, 0,-3]\n                 = [[0,1,0],\n                    [0,1,0],\n                    [1,1,0],\n                    [1,1,1]]\n</code></pre>\n\n<p>When we call <code>toMatrix' acc xs</code> we first compute <code>bools = map (&gt; 0) xs</code>. If all the elements of <code>bools</code> are <code>False</code> then we're done. We simple return <code>acc</code>. Otherwise we add <code>bools</code> to the beginning of <code>acc</code> and subtract one from each element of <code>xs</code>. Rinse and repeat.</p>\n\n<p>No need to keep track of the biggest element of <code>xs</code> and no need to transpose the matrix. Simple.</p>\n"}], "owner": {"reputation": 287, "user_id": 1381516, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e49827a890f6397fd9409baca18af216?s=128&d=identicon&r=PG", "display_name": "Infinity", "link": "https://stackoverflow.com/users/1381516/infinity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 1, "accepted_answer_id": 33986282, "answer_count": 2, "score": 6, "last_activity_date": 1448901029, "creation_date": 1448819898, "last_edit_date": 1448875867, "question_id": 33986050, "link": "https://stackoverflow.com/questions/33986050/how-to-transform-a-list-of-integers-to-a-matrix-of-true-and-false-in-haskell", "title": "How to Transform a List of Integers to a Matrix of True and False in Haskell", "body": "<p>In this exercise I should write a function which receives a list of integers as argument and gives a matrix or list of lists. The point in making the matrix is that the integers represent the number of <code>True</code>s in each <em>column</em> of the matrix. For example</p>\n\n<pre><code>[2,4,1]\n</code></pre>\n\n<p>must be translated to: </p>\n\n<p><a href=\"https://i.stack.imgur.com/F2ywA.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/F2ywA.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>which in the system is represented as a list of lists:</p>\n\n<pre><code>[ [0,1,0], [0,1,0], [1,1,0], [1,1,1] ]\n</code></pre>\n\n<p>As it's not easy to manipulate matrices (list of lists) by columns I used a trick and rotate the matrix by 90 degree to the left using <code>transpose</code> which makes the matrix looks like below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/MAO6T.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MAO6T.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Then I developed the following algorithm to solve the problem:</p>\n\n<ol>\n<li>Take the first element of the input list</li>\n<li>Create a list of length <code>maximum xs</code> (the length of each list is equal to the maximum element in the list) </li>\n<li>Put so many <code>True</code> in the list as the first element determines.</li>\n<li>Fill in the the rest of the list with <code>False</code> </li>\n<li>Do the same for all elements and rotate the matrix</li>\n</ol>\n\n<p>I have tried to implement two solutions but each one has a problem which I cannot solve:</p>\n\n<ol>\n<li><p>This one works for the first element just fine but I do not know how to apply it to all elements of the input list</p>\n\n<pre><code>listToMatrix x = (replicate ((maximum x) - (head x)) False) ++ (replicate (head x) True)`\n</code></pre></li>\n<li><p>This works for all elements but can not keep the length of the inner list so the lists have different lengths.</p>\n\n<pre><code>listToMatrix lst@(x:xs) = ((replicate ((maximum lst) - x) False) ++ (replicate x True)) : listToMatrix xs`\n</code></pre></li>\n</ol>\n\n<p><strong>Question 1</strong>: How can I make these functions work with minimal changes?</p>\n\n<p><strong>Question 2</strong>: Are more elegant and compact solutions?</p>\n\n<p>P.S. I used 1 and 0 in the matrices to make them more readable but they are in fact True and False</p>\n"}, {"tags": ["haskell", "functional-programming", "polymorphism"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1448808202, "post_id": 33983905, "comment_id": 55723607, "body": "How were you expecting to use that function <code>getVar</code>?"}, {"owner": {"reputation": 737, "user_id": 2954382, "user_type": "registered", "accept_rate": 61, "profile_image": "https://graph.facebook.com/100003305975398/picture?type=large", "display_name": "Frank Tian", "link": "https://stackoverflow.com/users/2954382/frank-tian"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1448808398, "post_id": 33983905, "comment_id": 55723664, "body": "@Bergi The actual logic of this function is more complex than this, I am just trying to at lease get the input and output format right before proceeding"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1448808491, "post_id": 33983905, "comment_id": 55723699, "body": "@Bergi it does actually make sense if you take into account type inference. see the examples down my answer"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1448808500, "post_id": 33983905, "comment_id": 55723703, "body": "No, I don&#39;t mean the logic of the function itself, that&#39;s irrelevant. But how do you think would you call <code>getVar</code>?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1448808561, "post_id": 33983905, "comment_id": 55723722, "body": "@behzad.nouri: Yeah, but you&#39;ve changed the result type to a <code>Maybe</code>, so that it can fail when the input is unexpected."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1448808710, "post_id": 33983905, "comment_id": 55723758, "body": "@Bergi that is not the point"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1448809113, "post_id": 33983905, "comment_id": 55723879, "body": "@behzad.nouri: It was <i>my</i> point :-) One just cannot do <code>if getVar (IntVal 5) then \u2026</code> or <code>getVar (BoolVal False) + 5</code>, so I was asking the OP for his use case."}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1448808865, "last_edit_date": 1448808865, "creation_date": 1448807933, "answer_id": 33983992, "question_id": 33983905, "link": "https://stackoverflow.com/questions/33983905/how-to-write-a-function-returns-either-integer-or-bool-based-on-a-user-defined-d/33983992#33983992", "title": "How to write a function returns either Integer or Bool based on a user defined data type?", "body": "<p><em>One</em> way to do it is to use type-classes, to make a function <em>polymorphic in return value</em>:</p>\n\n<pre><code>\\&gt; :t getVal\ngetVal :: GetValue a =&gt; Value -&gt; Maybe a\n</code></pre>\n\n<p>by a simple code as in bellow:</p>\n\n<pre><code>data Value = IntVal Integer\n           | BoolVal Bool\n             deriving Show\n\nclass GetValue a where\n    getVal :: Value -&gt; Maybe a\n\ninstance GetValue Integer where\n    getVal (IntVal i) = Just i\n    getVal          _ = Nothing\n\ninstance GetValue Bool where\n    getVal (BoolVal b) = Just b\n    getVal           _ = Nothing\n</code></pre>\n\n<p>and let the type-inference decide the right function:</p>\n\n<pre><code>\\&gt; import Data.Maybe (fromJust)\n\\&gt; (3 +) .fromJust . getVal $ IntVal 5  -- getVal :: Value -&gt; Maybe Integer\n8\n\\&gt; not . fromJust . getVal $ BoolVal False  -- getVal :: Value -&gt; Maybe Bool\nTrue\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1448809327, "creation_date": 1448809327, "answer_id": 33984201, "question_id": 33983905, "link": "https://stackoverflow.com/questions/33983905/how-to-write-a-function-returns-either-integer-or-bool-based-on-a-user-defined-d/33984201#33984201", "title": "How to write a function returns either Integer or Bool based on a user defined data type?", "body": "<p>That's a job for <code>GADT</code>s:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Value a where\n    IntVal  :: Integer -&gt; Value Integer\n    BoolVal :: Bool    -&gt; Value Bool\n\ngetVal :: Value a -&gt; a\ngetVal (IntVal  i) = i\ngetVal (BoolVal b) = b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1448810504, "creation_date": 1448810504, "answer_id": 33984377, "question_id": 33983905, "link": "https://stackoverflow.com/questions/33983905/how-to-write-a-function-returns-either-integer-or-bool-based-on-a-user-defined-d/33984377#33984377", "title": "How to write a function returns either Integer or Bool based on a user defined data type?", "body": "<p>user3237465 and behzad.nouri have provided answers to your specific question. However I wonder if you are thinking by analogy with OO and dynamically typed languages. If you are taking \"Value\" as an argument to a function then you should use pattern matching to do the Right Thing with the value it holds.  So suppose you are writing a function \"showValue\" to return the value as a string. I guess you are trying to do something like:</p>\n\n<pre><code>showValue :: Value -&gt; String\nshowValue v = let v1 = getValue v in &lt;something&gt;\n</code></pre>\n\n<p>But that won't work in Haskell because the type system insists on knowing what type \"v1\" is. Instead you write it like this:</p>\n\n<pre><code>showValue (IntVal i) = \"The Value is an integer \" ++ show i\nshowValue (BoolVal b) = \"The Value is a boolean \" ++ show b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 10, "last_activity_date": 1448813665, "creation_date": 1448813665, "answer_id": 33984924, "question_id": 33983905, "link": "https://stackoverflow.com/questions/33983905/how-to-write-a-function-returns-either-integer-or-bool-based-on-a-user-defined-d/33984924#33984924", "title": "How to write a function returns either Integer or Bool based on a user defined data type?", "body": "<p>Yes, this can be handled with help of type classes or GADTs or you can even use <code>cast</code> leveraging <code>Data.Typeable</code>. But all those thing are useful when you know Haskell well, and when you know what you're doing exactly.</p>\n\n<p>In your case, you should really try to understand how Haskell works in general. Haskell is about imposing wise invariants that make it impossible to write \u201cbad\u201d programs (well, that's how I put it). This is done via type system, and without those invariants attached you cannot really do anything.</p>\n\n<p>So now, you cannot do much with a thing of type <code>a</code>, because you don't know much about it. If you want to return value from function that can be either <code>Int</code> or <code>Bool</code> (that's actually possible see existential quantification), you will be able to perform actions on that value that can be performed on <code>Int</code> <em>and</em> on <code>Bool</code>. You can get textual representation of that value for example.</p>\n\n<p>Chances are you want more than that. In this case you probably shouldn't try to return <code>Int</code> <em>and</em> <code>Bool</code> at the same time without a way to understand what exactly you have as a result.</p>\n\n<p>So, you can do the following for example:</p>\n\n<pre><code>getVar :: Value -&gt; Either Int Bool\n</code></pre>\n\n<p>Or you can just dispatch:</p>\n\n<pre><code>case Value of\n  IntVal  x -&gt; doWhatYouWantToDoWithInteger x\n  BoolVal x -&gt; doWhatYouWantToDoWithBoolean x\n</code></pre>\n\n<p>This is natural flow of Haskell. In every branch of program you now know what you're dealing with.</p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 737, "user_id": 2954382, "user_type": "registered", "accept_rate": 61, "profile_image": "https://graph.facebook.com/100003305975398/picture?type=large", "display_name": "Frank Tian", "link": "https://stackoverflow.com/users/2954382/frank-tian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1263, "favorite_count": 0, "accepted_answer_id": 33983992, "answer_count": 4, "score": 3, "last_activity_date": 1448813665, "creation_date": 1448807397, "question_id": 33983905, "link": "https://stackoverflow.com/questions/33983905/how-to-write-a-function-returns-either-integer-or-bool-based-on-a-user-defined-d", "title": "How to write a function returns either Integer or Bool based on a user defined data type?", "body": "<p>I am given a data type like the following</p>\n\n<pre><code>data Value = IntVal Integer |\n             BoolVal Bool\n             deriving Show\n</code></pre>\n\n<p>I am trying to write a function <code>getVal</code> that takes a Value and returns the actual value inside. I was trying to achieve with pattern matching</p>\n\n<pre><code>getVal (IntVal val) = val\ngetVal (Bool bool) = bool\n</code></pre>\n\n<p>But Haskell complains about the returning types\n    Couldn't match expected type 'Integer' with actuall type 'Bool'</p>\n\n<p>So I gave it a signature returns a type variable</p>\n\n<pre><code>getVar :: Value -&gt; a\n</code></pre>\n\n<p>But it won't work either</p>\n"}, {"tags": ["http", "haskell", "post", "functional-programming", "network-programming"], "answers": [{"comments": [{"owner": {"reputation": 757, "user_id": 5083453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52685bd3fa5ba092cb58f2aa426dcd92?s=128&d=identicon&r=PG&f=1", "display_name": "Jessica Nowak", "link": "https://stackoverflow.com/users/5083453/jessica-nowak"}, "edited": false, "score": 1, "creation_date": 1448818668, "post_id": 33984750, "comment_id": 55727070, "body": "Thank you very much, this makes a lot more sense now. Just got another question about this: Why is it required to use Overloaded Strings, or asked differently: What do they do?"}, {"owner": {"reputation": 757, "user_id": 5083453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52685bd3fa5ba092cb58f2aa426dcd92?s=128&d=identicon&r=PG&f=1", "display_name": "Jessica Nowak", "link": "https://stackoverflow.com/users/5083453/jessica-nowak"}, "edited": false, "score": 0, "creation_date": 1448897326, "post_id": 33984750, "comment_id": 55759848, "body": "Thank you again, this helped a lot, I got one last question: I modified your example so it takes the url it is supposed to post to as a String <code>send :: RequestBody -&gt; String -&gt; IO ()</code> and tried to write another function which takes a random text from a file and sends it. I got the line <code>q &lt;- rndPick $ lines qs</code> inside it, then <code>send q ur</code> in the last line, this gives me the error <code>Couldn&#39;t match type </code>[Char]&#39; with <code>RequestBody&#39;</code>. I assume that I am supposed to pack my String to a RequestBody in this situation, or am I wrong?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 757, "user_id": 5083453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52685bd3fa5ba092cb58f2aa426dcd92?s=128&d=identicon&r=PG&f=1", "display_name": "Jessica Nowak", "link": "https://stackoverflow.com/users/5083453/jessica-nowak"}, "edited": false, "score": 2, "creation_date": 1448925348, "post_id": 33984750, "comment_id": 55775645, "body": "Yes. In that case, you&#39;ll need to pack the string into a bytestring and then wrap the bytestring with one of <a href=\"http://hackage.haskell.org/package/http-client-0.4.24/docs/Network-HTTP-Client-Internal.html#t:RequestBody\" rel=\"nofollow noreferrer\">these RequestBody constructors</a>."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 10, "last_activity_date": 1470416872, "last_edit_date": 1470416872, "creation_date": 1448812616, "answer_id": 33984750, "question_id": 33983629, "link": "https://stackoverflow.com/questions/33983629/basic-way-of-sending-http-post-in-haskell-using-http-conduit/33984750#33984750", "title": "Basic way of sending HTTP/POST in Haskell using http-conduit", "body": "<p>Sure! The weird Haskell thing here to note is Haskell's record system. When you call <code>parseUrl</code> with a URL string, <code>http-conduit</code> is giving you back a <code>Request</code> record with some default values filled out, but the library expects you to fill out the rest.</p>\n\n<p>For example, <code>parseUrl</code> always returns a <code>Request</code> with the HTTP method set to GET. It's up to us to overwrite that value by using the record update syntax \u2013 the thing where you append curly braces with new keys and values.</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Lib where\n\nimport Data.Aeson\nimport Network.HTTP.Client\n\nbuildRequest :: String -&gt; RequestBody -&gt; IO Request\nbuildRequest url body = do\n  nakedRequest &lt;- parseRequest url\n  return (nakedRequest { method = \"POST\", requestBody = body })\n\nsend :: RequestBody -&gt; IO ()\nsend s = do\n  manager &lt;- newManager defaultManagerSettings\n  request &lt;- buildRequest \"http://httpbin.org/post\" s\n  response &lt;- httpLbs request manager\n  let Just obj = decode (responseBody response)\n  print (obj :: Object)\n</code></pre>\n\n<p>If you run this in GHCi, you should be able to send POSTs to httpbin:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; :set -XOverloadedStrings\n\u03bb&gt; send \"hello there\"\nfromList [(\"origin\",String \"&lt;snip&gt;\")\n         ,(\"args\",Object (fromList []))\n         ,(\"json\",Null)\n         ,(\"data\",String \"hello there\")\n         ,(\"url\",String \"http://httpbin.org/post\")\n         ,(\"headers\",Object (fromList [(\"Accept-Encoding\",String \"gzip\")\n         ,(\"Host\",String \"httpbin.org\")\n         ,(\"Content-Length\",String \"11\")]))\n         ,(\"files\",Object (fromList []))\n         ,(\"form\",Object (fromList []))]\n</code></pre>\n\n<p>You'll also need the OverloadedStrings extension. Without it, two things will happen:</p>\n\n<ul>\n<li><p><code>nakedRequest { method = \"POST\" }</code> won't typecheck because the library expects a (strict) <code>ByteString</code> from the <code>bytestring</code> library. By default, <code>\"POST\"</code> and all string literals have type <code>String</code> a.k.a <code>[Char]</code>. While there is a function called <code>pack</code> that takes <code>String</code> and returns <code>ByteString</code>, it's much simpler to turn on overloaded strings. The compiler automatically calls <code>pack</code> on your behalf. There's more to it than that; see <a href=\"https://ocharles.org.uk/blog/posts/2014-12-17-overloaded-strings.html\" rel=\"noreferrer\">Oliver's blog post</a> for the nitty gritty details.</p></li>\n<li><p>Another expression that won't typecheck is <code>send \"hello there\"</code>. <code>send</code> expects a <code>RequestBody</code>. And while again there's a function somewhere that would have type <code>String -&gt; RequestBody</code>, it's much easier to turn on overloaded strings and have the compiler call it for you.</p></li>\n</ul>\n"}], "owner": {"reputation": 757, "user_id": 5083453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52685bd3fa5ba092cb58f2aa426dcd92?s=128&d=identicon&r=PG&f=1", "display_name": "Jessica Nowak", "link": "https://stackoverflow.com/users/5083453/jessica-nowak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2412, "favorite_count": 3, "accepted_answer_id": 33984750, "answer_count": 1, "score": 4, "last_activity_date": 1470416872, "creation_date": 1448805581, "last_edit_date": 1495535370, "question_id": 33983629, "link": "https://stackoverflow.com/questions/33983629/basic-way-of-sending-http-post-in-haskell-using-http-conduit", "title": "Basic way of sending HTTP/POST in Haskell using http-conduit", "body": "<p>I'm trying to learn how to send simple string via HTTP/POST using Haskell and <code>http-conduit</code> (so that it works with https as well), reading the target url from a file, but it still seems all a bit overwhelming to me.</p>\n\n<p>Basically the equivalent of what I learned to do with Racket here:\n<a href=\"https://stackoverflow.com/questions/31236374/sending-http-post-in-racket\">Sending HTTP POST in Racket</a></p>\n\n<p>Could someone give me a small or most basic example of doing this?</p>\n\n<p>I tried reading <a href=\"https://stackoverflow.com/a/13465653/5083453\">https://stackoverflow.com/a/13465653/5083453</a> </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1448802984, "post_id": 33983151, "comment_id": 55722117, "body": "You cannot use <code>deriving</code> with (or define instances for) a type synonym."}, {"owner": {"reputation": 53, "user_id": 5335978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3fdxG.jpg?s=128&g=1", "display_name": "Ingvaru", "link": "https://stackoverflow.com/users/5335978/ingvaru"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1448803142, "post_id": 33983151, "comment_id": 55722171, "body": "what do you mean? what is synonym?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1448803786, "post_id": 33983151, "comment_id": 55722343, "body": "A thing that you define wirh <code>type x = y</code> is called a type synonym."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1448804358, "post_id": 33983151, "comment_id": 55722491, "body": "There&#39;s no need to use <code>deriving Show</code> after <code>type Code = [ASM]</code> -- the types <code>Code</code> and <code>[ASM]</code> are exactly the same, so the standard instance for <code>[ASM]</code> will be used."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448804428, "post_id": 33983151, "comment_id": 55722512, "body": "About &quot;I can&#39;t use the translate function&quot; -- can you expand that?"}, {"owner": {"reputation": 53, "user_id": 5335978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3fdxG.jpg?s=128&g=1", "display_name": "Ingvaru", "link": "https://stackoverflow.com/users/5335978/ingvaru"}, "edited": false, "score": 0, "creation_date": 1448805352, "post_id": 33983151, "comment_id": 55722775, "body": "here&#39;s what I tried... translate (parse_imp &quot;x := x + 1&quot;) []...the result is  [Push (Bind (&quot;x&quot;, ***Exception: .... : Irrefutable pattern failed for pattern Just v"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 5335978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3fdxG.jpg?s=128&g=1", "display_name": "Ingvaru", "link": "https://stackoverflow.com/users/5335978/ingvaru"}, "edited": false, "score": 0, "creation_date": 1448850459, "post_id": 33984528, "comment_id": 55736959, "body": "how could I implement it? does it have to do with this? <code>case lookup x m of Just v -&gt; v Nothing -&gt; ...</code> and if it is, where should I put it?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 53, "user_id": 5335978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3fdxG.jpg?s=128&g=1", "display_name": "Ingvaru", "link": "https://stackoverflow.com/users/5335978/ingvaru"}, "edited": false, "score": 0, "creation_date": 1448851232, "post_id": 33984528, "comment_id": 55737163, "body": "That should have been an application if the lambda, so what I needn&#39;t was"}, {"owner": {"reputation": 53, "user_id": 5335978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3fdxG.jpg?s=128&g=1", "display_name": "Ingvaru", "link": "https://stackoverflow.com/users/5335978/ingvaru"}, "edited": false, "score": 0, "creation_date": 1448883961, "post_id": 33984528, "comment_id": 55751262, "body": "I tried inputting <code>translate (parse_exp &quot;x + 1&quot;) [(x,1)]</code> and it results to <code>*Not in scope: &#39;x&#39;</code>"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1448811326, "creation_date": 1448811326, "answer_id": 33984528, "question_id": 33983151, "link": "https://stackoverflow.com/questions/33983151/implementing-abstract-stack-machine-in-haskell/33984528#33984528", "title": "implementing Abstract Stack Machine in Haskell", "body": "<p>Notice the code <code>Just v = lookup x m</code> only works when the variable name referred to by <code>x</code> exists in map <code>m</code>.  However, your translate function never adds variable to the environment so <code>m</code> is always empty and your Assign code will always throw an exception.</p>\n\n<p>Solution?  Well that depends on the specifics of your effort, but I'd add a way to bind variables such as lambda's.  This won't make <code>x +1</code> parse because <code>x</code> is still not in the environment, but it could make <code>lambda x. x + 1</code> parse if you'd like. Notice you'll need to figure out how to get variables off the stack.</p>\n"}], "owner": {"reputation": 53, "user_id": 5335978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3fdxG.jpg?s=128&g=1", "display_name": "Ingvaru", "link": "https://stackoverflow.com/users/5335978/ingvaru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "accepted_answer_id": 33984528, "answer_count": 1, "score": 1, "last_activity_date": 1448850612, "creation_date": 1448802662, "last_edit_date": 1448850612, "question_id": 33983151, "link": "https://stackoverflow.com/questions/33983151/implementing-abstract-stack-machine-in-haskell", "title": "implementing Abstract Stack Machine in Haskell", "body": "<p>I don't know what's wrong but when I tried to compile it, it will say \"parse error on input 'deriving' \". when I tried to remove the <code>deriving Show</code> on the <code>type Code</code> the error will gone but I cant use the translate function. Why is this? I'm still new sorry. </p>\n\n<pre><code>&gt; module Imp where\n&gt;\n&gt; import Parsing\n&gt;\n&gt; type Ide = String\n&gt; data Imp\n&gt;   = Skip\n&gt;   | Assign Ide Imp\n&gt;   | Begin Imp\n&gt;   | Seq Imp Imp\n&gt;   | Ifz Imp Imp Imp\n&gt;   | While Imp Imp\n&gt;   | Num Int\n&gt;   | Var Ide\n&gt;   | Add Imp Imp\n&gt;   | Sub Imp Imp\n&gt;   | Mul Imp Imp\n&gt;   | Div Imp Imp\n&gt;   | Eq Imp Imp\n&gt;   deriving Show\n\n&gt; type Binding = (String, Int)\n\n&gt; data StackVal = N Int | Bind Binding deriving Show\n\n&gt; type Stack = [StackVal]\n\n&gt; type Env = [Binding]\n\n&gt; data ASM  --Abstract Stack Machine\n&gt;   = Push StackVal\n&gt;   | Pop StackVal\n&gt;   | ADD | SUB | MUL | DIV | EQUIV\n&gt;   | Jmp Int\n&gt;   | Jnz Int\n&gt;   | Lab Int\n&gt;   | Halt\n&gt;   deriving Show\n\n&gt; type Code = [ASM]\n\n\n\n\nTranslator\n----------\n\n&gt; translate :: Imp -&gt; Env -&gt; Code\n&gt; translate (Num n) m               = [Push (N n)]\n&gt; translate (Var x) m               = [Push (Bind (x, v))] where Just v = lookup x m\n&gt; translate (Skip) m                = []   \n&gt; translate (Assign x exp) m        = translate exp m ++ [Pop (Bind (x, v))] where Just v = lookup x m\n&gt; translate (Seq c1 c2) m           = translate c1 m ++ translate c2 m\n&gt; translate (Ifz exp c1 c2) m       = translate exp m ++ [Jmp 1] ++ translate c1 m ++ [Jnz 2] \n&gt;                                     ++ [Lab 1] ++ translate c2 m ++ [Lab 2]\n&gt; translate (While exp c) m         = [Lab 1] ++ translate exp m ++ [Jmp 2] ++ translate c m ++ [Jnz 1] ++ [Lab 2]\n&gt; translate (Add x y) m             = translate x m ++ translate y m ++ [ADD]\n&gt; translate (Sub x y) m             = translate x m ++ translate y m ++ [SUB]\n&gt; translate (Mul x y) m             = translate x m ++ translate y m ++ [MUL]\n&gt; translate (Div x y) m             = translate x m ++ translate y m ++ [DIV]\n&gt; translate (Eq x y) m              = translate x m ++ translate y m ++ [EQUIV]\n\n\n\n\n\n\nGrammar\n--------\n\n&gt; asgn :: Parser Imp\n&gt; asgn = eqimp +++ expr\n&gt;\n&gt; expr :: Parser Imp\n&gt; expr = addimp +++ subimp +++ term\n&gt;\n&gt; term :: Parser Imp\n&gt; term = mulimp +++ divimp +++ factor\n&gt;\n&gt; factor :: Parser Imp\n&gt; factor = (do symbol \"(\"; e &lt;- expr; symbol \")\"; return e)\n&gt;   +++ number +++ idnt\n&gt;\n&gt; number :: Parser Imp\n&gt; number = (do n &lt;- natural; return (Num n))\n&gt;\n&gt; idnt :: Parser Imp\n&gt; idnt = (do i &lt;- identifier; return (Var i))\n&gt; \n&gt; ide :: Parser Ide\n&gt; ide = (do i &lt;- identifier; return (i))\n\n\nExpressions\n-----------\n\n&gt; eqimp :: Parser Imp\n&gt; eqimp = (do i &lt;- idnt; symbol \"=\"; a &lt;- asgn; return (Eq i a))\n&gt;   +++ (do i &lt;- idnt; symbol \"=\"; e &lt;- expr; return (Eq i e))\n&gt;   +++ (do i &lt;- idnt; symbol \"=\"; i &lt;- idnt; return (Eq i i))\n&gt;   +++ (do e1 &lt;- expr; symbol \"=\"; e2 &lt;- expr; return (Eq e1 e2))\n\n&gt; addimp :: Parser Imp\n&gt; addimp = (do t &lt;- term; symbol \"+\"; e &lt;- expr; return (Add t e))\n&gt;           +++ (do i &lt;- idnt; symbol \"+\"; t &lt;- term; return (Add i t))\n\n&gt; subimp :: Parser Imp\n&gt; subimp = (do t &lt;- term; symbol \"-\"; e &lt;- expr; return (Sub t e))\n&gt;           +++ (do i &lt;- idnt; symbol \"-\"; t &lt;- term; return (Sub i t))\n\n&gt; mulimp :: Parser Imp\n&gt; mulimp = (do f &lt;- factor; symbol \"*\"; t &lt;- term; return (Mul f t))\n&gt;           +++ (do i &lt;- idnt; symbol \"*\"; f &lt;- factor; return (Mul i f))\n\n&gt; divimp :: Parser Imp\n&gt; divimp = (do f &lt;- factor; symbol \"/\"; t &lt;- term; return (Div f t))\n&gt;           +++ (do i &lt;- idnt; symbol \"/\"; f &lt;- factor; return (Div i f))\n\n\nCommands\n---------\n\n&gt;\n&gt; skipimp :: Parser Imp\n&gt; skipimp = (do symbol \"skip\"; return Skip)\n&gt;\n&gt; assignimp :: Parser Imp\n&gt; assignimp = (do i &lt;- ide; symbol \":=\"; e &lt;- expr; return (Assign i e))\n&gt;\n&gt; assignimp2 :: Parser Imp\n&gt; assignimp2 = (do i &lt;- ide; symbol \":=\"; e &lt;- expr; symbol \";\"; return (Assign i e))\n&gt;            +++ (do i &lt;- ide; symbol \":=\"; e &lt;- expr; return (Assign i e))\n&gt;\n&gt; seqimp :: Parser Imp\n&gt; seqimp = (do w &lt;- whileimp; symbol \";\"; s2 &lt;- seqimp; return (Seq w s2))\n&gt;           +++ (do w &lt;- whileimp; symbol \";\"; c2 &lt;- com3; return (Seq w c2))\n&gt;           +++ (do i &lt;- ifzimp; symbol \";\"; s2 &lt;- seqimp; return (Seq i s2))\n&gt;           +++ (do i &lt;- ifzimp; symbol \";\"; c2 &lt;- com3; return (Seq i c2))\n&gt;           +++ (do c1 &lt;- com2; symbol \";\"; s2 &lt;- seqimp; return (Seq c1 s2))\n&gt;           +++ (do c1 &lt;- com2; symbol \";\"; c2 &lt;- com2; symbol \";\"; return (Seq c1 c2))\n&gt;           +++ (do c1 &lt;- com2; symbol \";\"; c2 &lt;- com2; return (Seq c1 c2))\n&gt;\n&gt; ifzimp :: Parser Imp\n&gt; ifzimp =  (do symbol \"if\"; e &lt;- expr; symbol \"then\"; c1 &lt;- com;  \n&gt;                    symbol \"else\"; symbol \"(\"; c2 &lt;- com; symbol \")\"; return (Ifz e c1 c2))\n&gt;        +++ (do symbol \"if\"; e &lt;- expr; symbol \"then\"; c1 &lt;- com; \n&gt;                    symbol \"else\"; c2 &lt;- com; return (Ifz e c1 c2))\n&gt;\n&gt; whileimp :: Parser Imp\n&gt; whileimp = (do symbol \"while\"; e &lt;- expr; symbol \"do\"; \n&gt;                       symbol \"(\"; c2 &lt;- com; symbol \")\"; return (While e c2))\n&gt;           +++ (do symbol \"while\"; e &lt;- expr;\n&gt;                       symbol \"do\"; c2 &lt;- com; return (While e c2))\n&gt;\n&gt; beginimp :: Parser Imp\n&gt; beginimp = (do symbol \"begin\"; c &lt;- com; symbol \"end\"; return (Begin c))\n&gt;\n&gt;\n&gt; com :: Parser Imp\n&gt; com = seqimp \n&gt;       +++ whileimp \n&gt;       +++ ifzimp \n&gt;       +++ beginimp\n&gt;       +++ assignimp \n&gt;       +++ skipimp\n&gt;       +++ (do symbol \"(\"; c &lt;- com; symbol \")\"; return c)\n&gt;\n&gt; com2 :: Parser Imp\n&gt; com2 = beginimp\n&gt;       +++ whileimp \n&gt;       +++ ifzimp \n&gt;       +++ assignimp \n&gt;       +++ skipimp\n&gt;       +++ (do symbol \"(\"; c &lt;- com2; symbol \")\"; return c)\n&gt;\n&gt; com3 :: Parser Imp\n&gt; com3 = beginimp\n&gt;       +++ whileimp \n&gt;       +++ ifzimp\n&gt;       +++ assignimp2 \n&gt;       +++ skipimp\n&gt;       +++ (do symbol \"(\"; c &lt;- com2; symbol \")\"; return c)\n\n\nParsers\n-------\n\n&gt; parse_imp :: String -&gt; Imp\n&gt; parse_imp str =\n&gt;   case parse com str of\n&gt;       [(result, [])] -&gt; result\n&gt;       [(_, out)] -&gt; error (\"unused input: \" ++ out)\n&gt;       [] -&gt; error (\"invalid input: \" ++ str)\n&gt;\n&gt; parse_exp :: String -&gt; Imp\n&gt; parse_exp str =\n&gt;   case parse asgn str of\n&gt;       [(result, [])] -&gt; result\n&gt;       [(_, out)] -&gt; error (\"unused input: \" ++ out)\n&gt;       [] -&gt; error (\"invalid input: \" ++ str)\n</code></pre>\n\n<p>UPDATE: I removed the <code>deriving Show</code> at the <code>type Code</code> part. The <code>translate</code> function seems to be working if the parsed input does not involved variables...example: <code>translate (parse_exp \"1\") []</code> results <code>[Push (N 1)]</code>. The remaining problem is that when I try something like <code>translate (parse_exp \"x + 1\")</code> because it will error about irrefutable pattern failed for pattern <code>Just v</code>. that line on <code>translate  (Assign x exp) m = ... where Just v = lookup x m</code> I guess has the problem:</p>\n\n<blockquote>\n<pre><code>*Imp&gt; translate (parse_exp \"1 + 5\") []\n[Push (N 1), Push (N 5), ADD]\n*Imp&gt; translate (parse_exp \"x + 1\") []\n[Push (Bind (\"x\",*** Exception: imp.lhs:50:66-84: Irrefutable pattern failed for pattern Just v\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1448812874, "post_id": 33982549, "comment_id": 55725043, "body": "To the best of my knowledge, there is no better way of doing this than the <code>10, 9..1</code> trick given below. It&#39;s a wart of the language design. See <a href=\"http://stackoverflow.com/questions/6806455/decrementing-ranges-in-haskell\" title=\"decrementing ranges in haskell\">stackoverflow.com/questions/6806455/&hellip;</a>, which arrived at the same answer."}], "answers": [{"tags": [], "owner": {"reputation": 11854, "user_id": 34685, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0739b6f28c705c894f21ac3a2617ece7?s=128&d=identicon&r=PG", "display_name": "Paul Hollingsworth", "link": "https://stackoverflow.com/users/34685/paul-hollingsworth"}, "is_accepted": false, "score": 3, "last_activity_date": 1448798871, "creation_date": 1448798871, "answer_id": 33982587, "question_id": 33982549, "link": "https://stackoverflow.com/questions/33982549/enumfromto-that-goes-in-reverse/33982587#33982587", "title": "enumFromTo that goes in reverse", "body": "<p>The best way I have found so far is:</p>\n\n<pre><code>[10,9..1]\n</code></pre>\n\n<p>which calls the enumFromThenTo function:</p>\n\n<pre><code>enumFromThenTo 10 9 1\n -&gt; [10,9,8,7,6,5,4,3,2,1]\n[10,9..1]\n -&gt; [10,9,8,7,6,5,4,3,2,1]\n</code></pre>\n\n<p>But is there a wrapper in the standard prelude that will do this? </p>\n"}, {"tags": [], "owner": {"reputation": 387, "user_id": 3821616, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ks3v3.png?s=128&g=1", "display_name": "magamig", "link": "https://stackoverflow.com/users/3821616/magamig"}, "is_accepted": false, "score": 1, "last_activity_date": 1448906118, "creation_date": 1448906118, "answer_id": 34004905, "question_id": 33982549, "link": "https://stackoverflow.com/questions/33982549/enumfromto-that-goes-in-reverse/34004905#34004905", "title": "enumFromTo that goes in reverse", "body": "<p>You can also write your own function:</p>\n\n<pre><code>reverseEnum :: Int -&gt; Int -&gt; [Int]\nreverseEnum a b\n    | a == b = [a]\n    | a &gt;= b = a : reverseEnum (a-1) b\n    | a &lt;= b = []\n</code></pre>\n\n<p>Here is an example of use:</p>\n\n<pre><code>reverseEnum 10 1\n-&gt; [10,9,8,7,6,5,4,3,2,1]\n</code></pre>\n"}], "owner": {"reputation": 11854, "user_id": 34685, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0739b6f28c705c894f21ac3a2617ece7?s=128&d=identicon&r=PG", "display_name": "Paul Hollingsworth", "link": "https://stackoverflow.com/users/34685/paul-hollingsworth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1448906118, "creation_date": 1448798628, "question_id": 33982549, "link": "https://stackoverflow.com/questions/33982549/enumfromto-that-goes-in-reverse", "title": "enumFromTo that goes in reverse", "body": "<p>I want to generate a sequence from 10 to 1 descending.</p>\n\n<p>The simplest way using standard library functions is</p>\n\n<pre><code>reverse [1..10]\n</code></pre>\n\n<p>However, this is implemented in an inefficient way - it's generating the list and then reversing it. However,</p>\n\n<pre><code>[10..1]\n</code></pre>\n\n<p>generates the empty list.</p>\n\n<p>I know that [1..10] is just syntactic sugar for</p>\n\n<pre><code>enumFromTo 1 10\n</code></pre>\n\n<p>Is there a standard library \"enum*\" function which enumerates from a higher element down to the lower one?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1448786175, "post_id": 33980754, "comment_id": 55717683, "body": "You cannot simply compose those two functions with <code>(.)</code>. Let&#39;s pretend for a minute that <code>g = (\\z -&gt; mod z 3) . (\\x y -&gt; x + y)</code> is legal. It would be equivalent to <code>g = \\x -&gt; mod (\\y -&gt; x + y) 3</code>. Of course, <code>mod</code> expects an <code>Integral a =&gt; a</code> (e.g. <code>5</code>), not a <code>Num a =&gt; a -&gt; a</code> (e.g. \\y -&gt; 2 + y`); that is what the two error messages tell you. <a href=\"http://stackoverflow.com/a/5821236/2541573\">This answer</a> explains the general problem and a solution to it in more details."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448789028, "post_id": 33980754, "comment_id": 55718293, "body": "Look up &quot;currying&quot;. What happens is that Haskell has no binary functions, and things like <code>\\x y -&gt;...</code> are functions taking <i>one</i> argument and returning another function. Since the result is a function, your composition fails."}], "owner": {"reputation": 589, "user_id": 697851, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/441dec9cb577f181f1ce4bb75667146a?s=128&d=identicon&r=PG", "display_name": "Charles Gao", "link": "https://stackoverflow.com/users/697851/charles-gao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "closed_date": 1448786053, "answer_count": 0, "score": 0, "last_activity_date": 1448784904, "creation_date": 1448784904, "question_id": 33980754, "link": "https://stackoverflow.com/questions/33980754/defining-fx-y-x-y-3-in-haskell", "closed_reason": "Duplicate", "title": "Defining f(x,y) = (x + y) % 3 in Haskell", "body": "<p>I'm learning Haskell and am trying to define a function that takes two numbers, add them and then mod 3. I can do it in the following way:</p>\n\n<pre><code>Prelude&gt; let g :: Int -&gt; Int -&gt; Int; g = (\\x y -&gt; mod (x+y) 3)\n</code></pre>\n\n<p>But when I try to write it as a composition of two functions, I'm getting an error and am having a hard time interpreting the error message:</p>\n\n<pre><code>Prelude&gt; let g :: Int -&gt; Int -&gt; Int; g = (\\x -&gt; mod x 3) . (\\x y -&gt; x + y)\n\n&lt;interactive&gt;:72:40:\n    No instance for (Integral (Int -&gt; Int))\n      (maybe you haven't applied enough arguments to a function?)\n      arising from a use of \u2018mod\u2019\n    In the expression: mod x 3\n    In the first argument of \u2018(.)\u2019, namely \u2018(\\ x -&gt; mod x 3)\u2019\n    In the expression: (\\ x -&gt; mod x 3) . (\\ x y -&gt; x + y)\n\n&lt;interactive&gt;:72:46:\n    No instance for (Num (Int -&gt; Int))\n      (maybe you haven't applied enough arguments to a function?)\n      arising from the literal \u20183\u2019\n    In the second argument of \u2018mod\u2019, namely \u20183\u2019\n    In the expression: mod x 3\n    In the first argument of \u2018(.)\u2019, namely \u2018(\\ x -&gt; mod x 3)\u2019\n</code></pre>\n\n<p>What's wrong here? Can't we compose like this?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 15, "user_id": 4168576, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RH0pr.jpg?s=128&g=1", "display_name": "michaeladrian39", "link": "https://stackoverflow.com/users/4168576/michaeladrian39"}, "edited": false, "score": 1, "creation_date": 1448788318, "post_id": 33980632, "comment_id": 55718119, "body": "Awesome! Welcome to Stack Overflow! (You accept an answer by checking the checkbox to the side of the answer)"}, {"owner": {"reputation": 704, "user_id": 939572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aadfb25285dc4e9a3caf81e2277d77b?s=128&d=identicon&r=PG", "display_name": "GarethR", "link": "https://stackoverflow.com/users/939572/garethr"}, "edited": false, "score": 0, "creation_date": 1448797208, "post_id": 33980632, "comment_id": 55720547, "body": "You might also consider returning the empty list instead of an error in the empty list case. After all, delete is supposed to ensure that the given number isn&#39;t in the list and that is trivially true for the empty list. In most cases where you would use this function, that would be a little more convenient than the Maybe solution. Maybe is best for when there really isn&#39;t an answer. For example, Maybe would be a good return type for the head function because there is really no answer to the head of an empty list."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 2, "last_activity_date": 1448784170, "last_edit_date": 1448784170, "creation_date": 1448783785, "answer_id": 33980632, "question_id": 33980587, "link": "https://stackoverflow.com/questions/33980587/haskell-delete-function-doesnt-work/33980632#33980632", "title": "Haskell - delete function doesn&#39;t work", "body": "<p>When you traverse the queue in <code>delete</code> you remove all items until you find the one you want. You'll need to reinsert the elements that you want to keep:</p>\n\n<pre><code>delete :: Int -&gt; BoundedQueue -&gt; BoundedQueue\ndelete int (BoundedQueue [] c) = error \"Not found\"\ndelete int (BoundedQueue (x:xs) c) \n  | int == x  = (BoundedQueue xs c)                                  \n  | otherwise = \n    let BoundedQueue xs' _ = delete int (BoundedQueue xs c)\n    in BoundedQueue (x:xs') c \n --                  ^-- keep the current element as well\n</code></pre>\n\n<p>Works as intended:</p>\n\n<pre><code>\u03bb&gt; delete 2 bq1\nBoundedQueue [1,3,4,5] 5\n</code></pre>\n\n<hr>\n\n<p>You might also want to remove the <code>error</code> call and make the types say that <code>delete</code> is a partial operation:</p>\n\n<pre><code>delete :: Int -&gt; BoundedQueue -&gt; Maybe BoundedQueue\ndelete int (BoundedQueue [] c) = Nothing\ndelete int (BoundedQueue (x:xs) c)\n  | int == x  = Just (BoundedQueue xs c)\n  | otherwise = do\n    BoundedQueue xs' _ &lt;- delete int (BoundedQueue xs c)\n    Just (BoundedQueue (x:xs') c)\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 4168576, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RH0pr.jpg?s=128&g=1", "display_name": "michaeladrian39", "link": "https://stackoverflow.com/users/4168576/michaeladrian39"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 33980632, "answer_count": 1, "score": 0, "last_activity_date": 1448784170, "creation_date": 1448783399, "question_id": 33980587, "link": "https://stackoverflow.com/questions/33980587/haskell-delete-function-doesnt-work", "title": "Haskell - delete function doesn&#39;t work", "body": "<p>I'm working on a bounded queue. The bounded queue consists of two parts, the queue itself (a queue of numbers) and its capacity.</p>\n\n<pre><code>type Queue = [Int]\ntype Capacity = Int\ndata BoundedQueue = BoundedQueue Queue Capacity deriving (Show)\n</code></pre>\n\n<p>Examples of the BoundedQueue:</p>\n\n<pre><code>bq1 :: BoundedQueue\nbq1 = BoundedQueue [1,2,3,4,5] 5\nbq2 :: BoundedQueue\nbq2 = BoundedQueue [] 5\n</code></pre>\n\n<p>I want to create a delete function. The function is to delete a number from a specified bounded queue.</p>\n\n<pre><code>delete :: Int -&gt; BoundedQueue -&gt; BoundedQueue\ndelete int (BoundedQueue [] ys) = error \"Not found\"\ndelete int (BoundedQueue (x:xs) ys) | int == x = (BoundedQueue xs ys)\n                                    | otherwise = delete int (BoundedQueue xs ys)\n</code></pre>\n\n<p>But the delete function doesn't work properly. It also deletes everything that preceded the deleted item. Here's a example:</p>\n\n<pre><code>*Main&gt; delete 2 bq1\nBoundedQueue [3,4,5] 5\n</code></pre>\n\n<p>when it should be</p>\n\n<pre><code>BoundedQueue [1,3,4,5] 5\n</code></pre>\n\n<p>How to fix this problem?</p>\n"}, {"tags": ["haskell", "io", "memoization"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1448793866, "post_id": 33980196, "comment_id": 55719633, "body": "Do you want to re-run the action, or do you want to return the result of the last action? This is an important difference. If the latter, you want to memoize the return value of the last action, while if the former, you want to remember the whole action. For example, if you want to read a file and return its content, do you want to read the file again (possibly getting updated data), or just return the cached content?"}, {"owner": {"reputation": 51, "user_id": 5617054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?s=128&d=identicon&r=PG", "display_name": "Sandy Maguire", "link": "https://stackoverflow.com/users/5617054/sandy-maguire"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1448811332, "post_id": 33980196, "comment_id": 55724546, "body": "I want to replay the action (in arbitrary BigMonadStackT IO), with cached (returning just the result of) IO calls inside of it. The intended use case is to implement the <a href=\"http://vim.wikia.com/wiki/Repeat_last_change\" rel=\"nofollow noreferrer\">repeat last change</a> operator in vim, which asks for input only the first time you run it."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1448828776, "post_id": 33980196, "comment_id": 55730968, "body": "I believe this gets a bit problematic. If you decide to memoize only some calls, what if the other, non-memoized calls, change the control flow? For example, what if the user&#39;s input is which file should be read?"}, {"owner": {"reputation": 51, "user_id": 5617054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?s=128&d=identicon&r=PG", "display_name": "Sandy Maguire", "link": "https://stackoverflow.com/users/5617054/sandy-maguire"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1448900868, "post_id": 33980196, "comment_id": 55762150, "body": "This doesn&#39;t strike me as being problematic, but maybe I&#39;m misguided about this. Compare two functions:  <code>memoizedFilename = do { filename &lt;- memoize getLine; readFile filename }</code>   vs  <code>memoizedFile = do { filename &lt;- getLine; memoize $ readFile filename }</code>   Here, memoizeFilename reads the file each time, but only prompts for the filename once, while memoizeFile prompts for a filename each time, but just returns the cached contents of the first file it was asked to."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 5617054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?s=128&d=identicon&r=PG", "display_name": "Sandy Maguire", "link": "https://stackoverflow.com/users/5617054/sandy-maguire"}, "edited": false, "score": 0, "creation_date": 1448811198, "post_id": 33980772, "comment_id": 55724503, "body": "Cool, thanks for the answer! Unfortunately, I&#39;m not sure that&#39;s going to scale to my real application (a vim clone), though. Is there a way to define them in place like in my example?   Some of my actions are recursive, with each iteration performing an IO that I&#39;d like to memoize. One action takes input from the user getChar-by-getChar until the user decides to stop, and I&#39;d like to be able to replay that in entirety."}], "tags": [], "owner": {"reputation": 402, "user_id": 4674225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f4e8f49f5ccc43297b4b185cd3866b?s=128&d=identicon&r=PG&f=1", "display_name": "No_signal", "link": "https://stackoverflow.com/users/4674225/no-signal"}, "is_accepted": false, "score": 5, "last_activity_date": 1448816033, "last_edit_date": 1448816033, "creation_date": 1448785030, "answer_id": 33980772, "question_id": 33980196, "link": "https://stackoverflow.com/questions/33980196/memoizing-and-repeating-io-monads/33980772#33980772", "title": "Memoizing and repeating IO monads", "body": "<p>the problem is in main you are creating a new memo each time you call the action</p>\n\n<p>you need to move <code>memoized &lt;- memoIO getName</code> up above the action</p>\n\n<pre><code>main :: IO ()\nmain = do\n    memoized &lt;- memoIO getName --moved above repeatable $ do\n    repeatable $ do\n                               --it was here \n        name &lt;- memoized\n        putStr \"hello \"\n        putStrLn name\n        return name\n    doRepeat\n    return ()\n</code></pre>\n\n<p>edit: is this acceptable</p>\n\n<pre><code>import Data.IORef\nimport System.IO.Unsafe\n\n{-# NOINLINE actionToRepeat #-}\nactionToRepeat :: IORef (IO String)\nactionToRepeat = unsafePerformIO . newIORef $ return \"\"\n\ntype Repeatable a = IO (IO a)\n\n-- Run an action and store the Repeatable part of the action\nrepeatable :: Repeatable String -&gt; IO String\nrepeatable action = do\n    repeatAction &lt;- action\n    writeIORef actionToRepeat repeatAction\n    repeatAction\n\n-- Run the last action stored by repeatable\ndoRepeat :: IO String\ndoRepeat = do\n    x &lt;- readIORef actionToRepeat\n    x\n\n-- everything before (return $ do) is run just once\nhello :: Repeatable String\nhello = do\n    putStr \"name&gt; \"\n    name &lt;- getLine\n    return $ do\n        putStr \"hello \"\n        putStrLn name\n        return name\n\nmain :: IO ()\nmain = do\n    repeatable hello\n    doRepeat\n    return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 5617054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?s=128&d=identicon&r=PG", "display_name": "Sandy Maguire", "link": "https://stackoverflow.com/users/5617054/sandy-maguire"}, "is_accepted": true, "score": 0, "last_activity_date": 1449396537, "creation_date": 1449396537, "answer_id": 34116208, "question_id": 33980196, "link": "https://stackoverflow.com/questions/33980196/memoizing-and-repeating-io-monads/34116208#34116208", "title": "Memoizing and repeating IO monads", "body": "<p>I came up with a solution. It requires wrapping the original monad in a new transformer which records the results of IO and injects them the next time the underlying monad is run.</p>\n\n<p>Posting it here so my answer is complete.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE LambdaCase #-}\n\nimport Control.Applicative (Applicative(..))\nimport Data.Dynamic\nimport Data.Maybe (fromJust)\nimport Control.Monad.RWS\n\n-- | A monad transformer adding the ability to record the results\n-- of IO actions and later replay them.\nnewtype ReplayT m a =\n    ReplayT { runReplayT :: RWST () [Dynamic] [Dynamic] m a }\n    deriving ( Functor\n             , Applicative\n             , Monad\n             , MonadIO\n             , MonadState  [Dynamic]\n             , MonadWriter [Dynamic]\n             , MonadTrans\n             )\n\n-- | Removes the first element from a list State and returns it.\ndequeue :: MonadState [r] m\n        =&gt; m (Maybe r)\ndequeue = do\n    get &gt;&gt;= \\case\n        []     -&gt; return Nothing\n        (x:xs) -&gt; do\n            put xs\n            return $ Just x\n\n-- | Marks an IO action to be memoized after its first invocation.\nsample :: ( MonadIO m\n          , Typeable r)\n       =&gt; IO r\n       -&gt; ReplayT m r\nsample action = do\n    a &lt;- dequeue &gt;&gt;= \\case\n        Just x  -&gt; return . fromJust $ fromDynamic x\n        Nothing -&gt; liftIO action\n    tell [toDyn a]\n    return a\n\n-- | Runs an action and records all of its sampled IO. Returns a\n-- action which when invoked will use the recorded IO.\nrecord :: Monad m\n       =&gt; ReplayT m a\n       -&gt; m (m a)\nrecord action = do\n    (a, w) &lt;- evalRWST (runReplayT action) () []\n    return $ do\n        evalRWST (runReplayT action) () w\n        return a\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5617054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?s=128&d=identicon&r=PG", "display_name": "Sandy Maguire", "link": "https://stackoverflow.com/users/5617054/sandy-maguire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 1, "accepted_answer_id": 34116208, "answer_count": 2, "score": 5, "last_activity_date": 1449396537, "creation_date": 1448779602, "last_edit_date": 1495541243, "question_id": 33980196, "link": "https://stackoverflow.com/questions/33980196/memoizing-and-repeating-io-monads", "title": "Memoizing and repeating IO monads", "body": "<p><strong>EDITED 2015-11-29</strong>: see bottom</p>\n\n<p>I'm trying to write an application that has a do-last-action-again button. The command in question can ask for input, and my thought for how to accomplish this was to just rerun the resulting monad with memoized IO.</p>\n\n<p>There are lots of posts on SO with similar questions, but none of the solutions seem to work here.</p>\n\n<p>I lifted the <code>memoIO</code> code from <a href=\"https://stackoverflow.com/questions/1091629/haskell-generic-ioref-mvar\">this SO answer</a>, and changed the implementation to run over <code>MonadIO</code>.</p>\n\n<pre><code>-- Memoize an IO function\nmemoIO :: MonadIO m =&gt; m a -&gt; m (m a)\nmemoIO action = do\n  ref &lt;- liftIO $ newMVar Nothing\n  return $ do\n      x &lt;- maybe action return =&lt;&lt; liftIO (takeMVar ref)\n      liftIO . putMVar ref $ Just x\n      return x\n</code></pre>\n\n<p>I've got a small repro of my app's approach, the only real difference being my app has a <em>big</em> transformer stack instead of just running in <code>IO</code>:</p>\n\n<pre><code>-- Global variable to contain the action we want to repeat\nactionToRepeat :: IORef (IO String)\nactionToRepeat = unsafePerformIO . newIORef $ return \"\"\n\n-- Run an action and store it as the action to repeat\nrepeatable :: IO String -&gt; IO String\nrepeatable action = do\n    writeIORef actionToRepeat action\n    action\n\n-- Run the last action stored by repeatable\ndoRepeat :: IO String\ndoRepeat = do\n    x &lt;- readIORef actionToRepeat\n    x\n</code></pre>\n\n<p>The idea being I can store an action with memoized <code>IO</code> in an <code>IORef</code> (via <code>repeatable</code>) when I record what was last done, and then do it again it out with <code>doRepeat</code>.</p>\n\n<p>I test this via:</p>\n\n<pre><code>-- IO function to memoize\ngetName :: IO String\ngetName = do\n    putStr \"name&gt; \"\n    getLine\n\nmain :: IO ()\nmain = do\n    repeatable $ do\n        memoized &lt;- memoIO getName\n        name &lt;- memoized\n        putStr \"hello \"\n        putStrLn name\n        return name\n    doRepeat\n    return ()\n</code></pre>\n\n<p>with expected output:</p>\n\n<pre><code>name&gt; isovector\nhello isovector\nhello isovector\n</code></pre>\n\n<p>but actual output:</p>\n\n<pre><code>name&gt; isovector\nhello isovector\nname&gt; wasnt memoized\nhello wasnt memoized\n</code></pre>\n\n<p>I'm not entirely sure what the issue is, or even how to go about debugging this. Gun to my head, I'd assume lazy evaluation is biting me somewhere, but I can't figure out where.</p>\n\n<p>Thanks in advance!</p>\n\n<hr>\n\n<p><strong>EDIT 2015-11-29</strong>: My intended use case for this is to implement the <a href=\"http://vim.wikia.com/wiki/Repeat_last_change\" rel=\"nofollow noreferrer\">repeat last change</a> operator in a vim-clone. Each action can perform an arbitrary number of arbitrary IO calls, and I would like it to be able to specify which ones should be memoized (reading a file, probably not. asking the user for input, yes).</p>\n"}, {"tags": ["string", "haskell", "io", "ghc", "ghci"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 2, "creation_date": 1448767784, "post_id": 33979052, "comment_id": 55714463, "body": "This is a failing of the GHC error message. The real problem is this: <code>calculate</code> cannot return just a list type (specifically <code>[(Char, Int)]</code>). You&#39;re reading a file, which means you&#39;ve &quot;infected&quot; the function with IO. The way I think about it is that any function that calls into an IO function also then becomes another IO function. Try instead <code>IO [(Char, Int)]</code> for the return type."}, {"owner": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1448768120, "post_id": 33979052, "comment_id": 55714530, "body": "If I change the return type it says <code>Couldn&#39;t match expected type \u2018IO [(Char, Int)]&#39; with actual type \u2018[(Char, Int)]\u2019</code>"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1448770829, "post_id": 33979052, "comment_id": 55714943, "body": "We&#39;ve now moved on to failings of Haskell&#39;s learning curve. A hint: there is a function with type <code>a -&gt; IO a</code>, but it&#39;s disguised as <code>(Monad m) =&gt; a -&gt; m a</code>."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1448774581, "post_id": 33979052, "comment_id": 55715531, "body": "^^ @astiefel: if you change <code>calculate</code>&#39;s return type to <code>IO [(Char, Int)]</code>, you have to <code>return $ charCount c</code> because you want the value of the calculation be wrapped in <code>IO</code> monad."}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 4644931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5b788bbae7eb06a706019fa76a5bdd?s=128&d=identicon&r=PG&f=1", "display_name": "eliasmacielr", "link": "https://stackoverflow.com/users/4644931/eliasmacielr"}, "is_accepted": true, "score": 1, "last_activity_date": 1448806803, "creation_date": 1448806803, "answer_id": 33983817, "question_id": 33979052, "link": "https://stackoverflow.com/questions/33979052/haskell-readfile-couldnt-match-expected-type-string-with-actual-type-io-s/33983817#33983817", "title": "Haskell readFile: Couldn&#39;t match expected type \u2018[String]\u2019 with actual type \u2018IO String\u2019", "body": "<p>Since <code>calculate</code> calls the <code>readFile</code> function which returns a value wrapped in the <code>IO</code> monad the function <code>calculate</code> must return a <code>IO</code> value too, and the result of the call to <code>charCount</code> (a pure computation) has to be <code>return</code>ed in order to wrap the <code>[(Char, Int)]</code> into a monad.</p>\n\n<p>The next example worked in <code>ghc 7.10.1</code>:</p>\n\n<pre><code>import qualified Data.Map as M\n\ncharCount :: String -&gt; [(Char, Int)]\ncharCount input = M.toList $ M.fromListWith (+) [(c, 1) | c &lt;- input]\n\ncalculate :: FilePath -&gt; IO [(Char, Int)]\ncalculate fp =\n    readFile fp &gt;&gt;= \\c -&gt;\n    return (charCount c)\n</code></pre>\n"}], "owner": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3718, "favorite_count": 1, "accepted_answer_id": 33983817, "answer_count": 1, "score": 3, "last_activity_date": 1448806803, "creation_date": 1448767212, "question_id": 33979052, "link": "https://stackoverflow.com/questions/33979052/haskell-readfile-couldnt-match-expected-type-string-with-actual-type-io-s", "title": "Haskell readFile: Couldn&#39;t match expected type \u2018[String]\u2019 with actual type \u2018IO String\u2019", "body": "<p>I am trying to read a file into a function to calculate the frequencies of characters in a file. So I am trying the following:</p>\n\n<pre><code>charCount :: String -&gt; [(Char, Int)]\ncharCount input = M.toList $ M.fromListWith (+) [(c, 1) | c &lt;- input]\n\ncalculate :: FilePath -&gt; [(Char, Int)]\ncalculate fp = do\n  c &lt;- readFile fp\n  charCount c\n</code></pre>\n\n<p>But I am getting the following error:</p>\n\n<pre><code>FileWriter.hs:13:8: Couldn't match expected type \u2018[String]\u2019 \u2026\n                with actual type \u2018IO String\u2019\n    In a stmt of a 'do' block: c &lt;- readFile fp\n    In the expression:\n      do { c &lt;- readFile fp;\n           charCount c }\nCompilation failed.\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1420, "user_id": 693416, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b40373fe8f75f5eed0609e695042d528?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/693416/greg"}, "edited": false, "score": 1, "creation_date": 1448749902, "post_id": 33976930, "comment_id": 55710746, "body": "Simpler and more readable.  I did not realize that <code>:</code> could be chained like that in pattern matching."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1448753731, "post_id": 33976930, "comment_id": 55711825, "body": "This solution is, IMHO, <i>vastly</i> superior to the original code. More efficient: 1) it will not scan the whole list only to count its length; 2) it avoids the slow index <code>!! n</code> (which needs to follow <code>n</code> pointers).  Also safer: <code>!! 2</code> can crash the whole program (!) if the list is too short -- the code correctly checks that beforehand, but it&#39;s easy to forget the check/perform the wrong check; instead (exhaustive) pattern match never leads to crashes."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 1420, "user_id": 693416, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b40373fe8f75f5eed0609e695042d528?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/693416/greg"}, "edited": false, "score": 0, "creation_date": 1448766794, "post_id": 33976930, "comment_id": 55714269, "body": "@Greg That&#39;s just a nested pattern, just like e.g. <code>foo (x, 0) = x</code> or <code>bar ((Just 0, n):mns) = ...</code>"}, {"owner": {"reputation": 1420, "user_id": 693416, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b40373fe8f75f5eed0609e695042d528?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/693416/greg"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1448776938, "post_id": 33976930, "comment_id": 55715935, "body": "@jberryman, the code I posted is part of an exercise in learning more about the language.  I&#39;ve subbed similar nested patterns into some earlier learning work and it&#39;s hugely clarified things.  Thank you for the extra clarification."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1448748191, "creation_date": 1448748191, "answer_id": 33976930, "question_id": 33976879, "link": "https://stackoverflow.com/questions/33976879/convert-a-list-to-individual-parameters/33976930#33976930", "title": "Convert a list to individual parameters", "body": "<blockquote>\n  <p>Is there a better/more general way to split a list into individual parameters other than calling them out individually? </p>\n</blockquote>\n\n<p>A more readable one could be:</p>\n\n<pre><code>triples :: [Int] -&gt; [Int]\ntriples (a:b:c:rest) = triple_count a b c: triples rest\ntriples            _ = []\n</code></pre>\n"}], "owner": {"reputation": 1420, "user_id": 693416, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b40373fe8f75f5eed0609e695042d528?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/693416/greg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 33976930, "answer_count": 1, "score": 2, "last_activity_date": 1448748191, "creation_date": 1448747836, "last_edit_date": 1495539880, "question_id": 33976879, "link": "https://stackoverflow.com/questions/33976879/convert-a-list-to-individual-parameters", "title": "Convert a list to individual parameters", "body": "<p>I have a function <code>triple_count</code> which computes the sum of 3 integers.  I am attempting to use this function to construct a new function which takes an input list of integers and returns a list of sums.</p>\n\n<p>Originally I tried:</p>\n\n<pre><code>triples :: [Int] -&gt; [Int]\ntriples xs\n  | length xs &lt; 3 = []\n  | otherwise = triple_count (take 3 xs) : triples (drop 3 xs)\n</code></pre>\n\n<p>Which fails because triple count's signature is <code>Int -&gt; Int -&gt; Int  -&gt; [Int]</code> and not <code>[Int] -&gt; [Int]</code>.</p>\n\n<p>Thanks to <a href=\"https://stackoverflow.com/questions/5217171/how-can-i-get-nth-element-from-the-list-in-haskell\">SO</a> and <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> I was able to make this work using <code>!!</code>.</p>\n\n<pre><code>triples :: [Int] -&gt; [Int]\ntriples xs\n  | length xs &lt; 3 = []\n  | otherwise = (triple_count p1 p2 p3) : triples (drop 3 xs)\n  where params = take 3 xs\n        p1     = params !! 0 \n        p2     = params !! 1 \n        p3     = params !! 2\n</code></pre>\n\n<p>Is there a better/more general way to split a list into individual parameters other than calling them out individually? </p>\n"}, {"tags": ["haskell", "state", "monads", "ghc", "purely-functional"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1448738891, "post_id": 33975270, "comment_id": 55707319, "body": "You could let <code>s ~ Const Int</code> in <code>runPF</code> and keep a <code>Map</code> with <code>Int</code> keys and <code>a</code> values."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1448739026, "post_id": 33975270, "comment_id": 55707349, "body": "Can we assume <code>Typeable a</code> in each <code>PT s a</code>? If so, it&#39;s a matter of adapting <a href=\"http://hackage.haskell.org/package/IOSpec\" rel=\"nofollow noreferrer\">IOSpec</a>, I guess."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1448739276, "post_id": 33975270, "comment_id": 55707422, "body": "Or even more simply, if everything is <code>Typeable</code>, a <code>Map Int Dynamic</code> should suffice to represent the <code>STRef</code>s backstore. Reads/writes will need to be implemented through partial (but pure) functions, in that case."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448739597, "post_id": 33975270, "comment_id": 55707534, "body": "@chi That makes it too easy."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448740934, "post_id": 33975270, "comment_id": 55707940, "body": "Perhaps with <a href=\"http://hackage.haskell.org/package/dependent-map-0.2.0.1\" rel=\"nofollow noreferrer\">dependent-map</a>, then one could define the store. AFAICS, that package uses to casts from <code>Dynamic</code> or <code>Typeable</code>-style casts (not so sure about this, just did a quick scan of the source, only). A <code>GCompare</code> instance is needed, but only on the keys (refs), and we can provide it, I think."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1448743566, "post_id": 33975270, "comment_id": 55708811, "body": "@DavidYoung Not all refs contain <code>a</code>s."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 1, "creation_date": 1449044008, "post_id": 33975270, "comment_id": 55830442, "body": "The closest I know of is Andrea Vezzosi&#39;s safe ST monad in Agda.  <a href=\"http://code.haskell.org/~Saizan/ST/ST.agda\" rel=\"nofollow noreferrer\">code.haskell.org/~Saizan/ST/ST.agda</a>  My understanding is that in Haskell you need to compromise on one of 3 things without using out of the box ST: Either a.) you need a simpler universe of ref types, e.g. Typeable, b.) you need to accept unsafeCoerce, or c.) you need to use some form of an indexed monad."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 7, "creation_date": 1448751305, "post_id": 33977350, "comment_id": 55711170, "body": "<code>unsafeCoerce</code> is cheating!"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1448751361, "post_id": 33977350, "comment_id": 55711189, "body": "@BenjaminHodgson Yea, I was thinking that."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448751605, "post_id": 33977350, "comment_id": 55711265, "body": "@PyRulez: this should work anywhere with the equivalent of <code>unsafeCoerce</code>. The use of <code>Any</code> is not  essential here; it&#39;s just a bit of a defensive programming thing."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1448751802, "post_id": 33977350, "comment_id": 55711328, "body": "Also, if we outlaw <code>unsafeCoerce</code>, we can still do an indexed state monad with type-level variable contexts and singleton references. It&#39;s quite a bit of boilerplate and not as nearly as convenient or performant as the unsafe solution. I could present something like it though if you&#39;re interested..."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448751867, "post_id": 33977350, "comment_id": 55711346, "body": "@Andr&#225;sKov&#225;cs The problem is that both <code>unsafeCoerce</code> and <code>Any</code> are sort of magical. You could not have either without baking it into the compiler."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1448751923, "post_id": 33977350, "comment_id": 55711361, "body": "@Andr&#225;sKov&#225;cs I&#39;ve been hacking away at making that approach work, but I don&#39;t think it&#39;s possible without indexing <code>PT</code> by the set of types in the system. See my forthcoming answer"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1448752046, "post_id": 33977350, "comment_id": 55711384, "body": "@BenjaminHodgson That should be exciting."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448752078, "post_id": 33977350, "comment_id": 55711387, "body": "@Andr&#225;sKov&#225;cs Also, if segfaults in Haskell is a great sin, then <code>unsafeCoerce</code> is dancin&#39; with the devil."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448752391, "post_id": 33977350, "comment_id": 55711484, "body": "@Andr&#225;sKov&#225;cs Since the <code>s</code> and <code>a</code> in <code>STRef s a</code> are phantom types, <code>coerce</code> could wreak havoc (which is itself a safe function)."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448753000, "post_id": 33977350, "comment_id": 55711643, "body": "@PyRulez that&#39;s solved by adding role annotations to ST (see my edit)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 8, "creation_date": 1448756195, "post_id": 33977350, "comment_id": 55712319, "body": "@PyRulez The <code>unsafe</code> in <code>unsafeCoerce</code> is, in some sense, <i>merely</i> a reminder that there is a proof burden on the user: namely, that there is a typing property too complicated for the normal type system to understand and it is up to the user to guarantee that the property holds. It should be easy enough to guarantee that property here, assuming the guarantee that the type-checker gives us about <code>PTRef</code>s from their interface (namely, that a value of type <code>PTRef s a</code> is not given type <code>PTRef t b</code> by some other part of the program with <code>a &#47;~ b</code>)."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 11, "last_activity_date": 1448886970, "last_edit_date": 1448886970, "creation_date": 1448751067, "answer_id": 33977350, "question_id": 33975270, "link": "https://stackoverflow.com/questions/33975270/can-a-st-like-monad-be-executed-purely-without-the-st-library/33977350#33977350", "title": "Can a `ST`-like monad be executed purely (without the `ST` library)?", "body": "<p>A simple solution is to wrap a <code>State</code> monad and present the same API as <code>ST</code>. In this case there's no need to store runtime type information, since it can be determined from the type of <code>STRef</code>-s, and the usual <code>ST s</code> quantification trick lets us prevent users from messing up the container storing the references. </p>\n\n<p>We keep ref-s in an <code>IntMap</code> and increment a counter each time we allocate a new ref. Reading and writing just modifies the <code>IntMap</code> with some <code>unsafeCoerce</code> sprinkled atop. </p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor, GeneralizedNewtypeDeriving, RankNTypes, RoleAnnotations #-}\n\nmodule PureST (ST, STRef, newSTRef, readSTRef, modifySTRef, runST) where\n\nimport Data.IntMap (IntMap, (!))\nimport qualified Data.IntMap as M\n\nimport Control.Monad\nimport Control.Applicative\nimport Control.Monad.Trans.State\nimport GHC.Prim (Any)\nimport Unsafe.Coerce (unsafeCoerce)\n\ntype role ST nominal representational\ntype role STRef nominal representational\nnewtype ST s a = ST (State (IntMap Any, Int) a) deriving (Functor, Applicative, Monad)\nnewtype STRef s a = STRef Int deriving Show\n\nnewSTRef :: a -&gt; ST s (STRef s a)\nnewSTRef a = ST $ do\n  (m, i) &lt;- get\n  put (M.insert i (unsafeCoerce a) m, i + 1)\n  pure (STRef i)\n\nreadSTRef :: STRef s a -&gt; ST s a\nreadSTRef (STRef i) = ST $ do\n  (m, _) &lt;- get\n  pure (unsafeCoerce (m ! i))\n\nwriteSTRef :: STRef s a -&gt; a -&gt; ST s ()\nwriteSTRef (STRef i) a = ST $ \n  modify $ \\(m, i') -&gt; (M.insert i (unsafeCoerce a) m, i')\n\nmodifySTRef :: STRef s a -&gt; (a -&gt; a) -&gt; ST s ()\nmodifySTRef (STRef i) f = ST $\n  modify $ \\(m, i') -&gt; (M.adjust (unsafeCoerce f) i m, i')                      \n\nrunST :: (forall s. ST s a) -&gt; a\nrunST (ST s) = evalState s (M.empty, 0)\n\nfoo :: Num a =&gt; ST s (a, Bool)\nfoo = do\n  a &lt;- newSTRef 0 \n  modifySTRef a (+100)\n  b &lt;- newSTRef False\n  modifySTRef b not\n  (,) &lt;$&gt; readSTRef a &lt;*&gt; readSTRef b\n</code></pre>\n\n<p>Now we can do:</p>\n\n<pre><code>&gt; runST foo\n(100, True)\n</code></pre>\n\n<p>But the following fails with the usual <code>ST</code> type error:</p>\n\n<pre><code>&gt; runST (newSTRef True)\n</code></pre>\n\n<p>Of course, the above scheme never garbage collects references, instead it frees up everything on each <code>runST</code> call. I think a more complex system could implement multiple distinct regions, each tagged by a type parameter, and allocate/free resources in a more fine-grained manner. </p>\n\n<p>Also, the use of <code>unsafeCoerce</code> means here that using internals directly is every bit as dangerous as using <code>GHC.ST</code> internals and <code>State#</code> directly, so we should make sure to present a safe API, and also test our internals thoroughly (or else we may get segfaults in Haskell, a great sin). </p>\n"}, {"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448755215, "post_id": 33977814, "comment_id": 55712122, "body": "Remember, you have access to <code>(forall s. PT s a)</code>. In particular, it <i>can</i> be instantiated to different types."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1448755369, "post_id": 33977814, "comment_id": 55712155, "body": "The rank-two type is only useful on the surface of the API. Sooner or later, I have to decide that I&#39;m running my computation in the context of a certain type of tuple with a fixed set of types inside it."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448755504, "post_id": 33977814, "comment_id": 55712184, "body": "Also, type level difference lists might be easier to deal with."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448755702, "post_id": 33977814, "comment_id": 55712229, "body": "Also, this does not rule out an approach using existential types."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1448755705, "post_id": 33977814, "comment_id": 55712230, "body": "I don&#39;t even want to think about how horrible type-level difference lists would be to work with! Haskell&#39;s type language lacks lambdas and partial application, so higher-order representations of data are not going to be fun"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448756048, "post_id": 33977814, "comment_id": 55712293, "body": "@PyRulez We could attempt to use existential quantification to allow us to grow the tuple in the environment while we interpret the <code>PT</code> request. But what would you put inside the existentially-quantified thing? An existentially-quantified <code>Tuple</code> is of no use to anyone, so you&#39;d have to wrap it up along with a singleton representation of its list parameter so you can recover the discarded information. But to give a singleton list you have to give singletons for the elements; the tuple would be restricted to things admitting singleton representations (<i>not</i> types of kind <code>*</code>)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448756150, "post_id": 33977814, "comment_id": 55712310, "body": "Thus the only way to do it would be to restrict yourself to a known finite set of types and use <code>Elem</code> as the kinda-sorta-singleton representation of a type of kind <code>*</code>. Back to square one."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448756625, "post_id": 33977814, "comment_id": 55712399, "body": "What if, instead of <code>MkRef :: a -&gt; PT s (PTRef s a)</code>, we had <code>MkRef :: a -&gt; (PTRef s a -&gt; PT s b) -&gt; PT s b</code>, and used polymorphic recursion in <code>interp</code> (so that the sub-action need not have the same tuple in its <code>State</code> type)?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448757959, "post_id": 33977814, "comment_id": 55712702, "body": "@DanielWagner I like your idea. I just tried it; unfortunately it didn&#39;t work. The problem is that <code>s</code> here is <code>Elem as</code>. So as long as <code>s</code> in the sub-action is tied to same <code>s</code> in the return type of <code>MkRef</code>, we aren&#39;t allowed to vary the list. Again, this&#39;d be tractable if <code>PT</code> were indexed by the list itself. The fundamental issue is that the type of the tuple is determined by the value of the <code>PT</code>. <code>interp</code> doesn&#39;t get to choose what <code>as</code> is, it has to come from the index of <code>PT</code>."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448758357, "post_id": 33977814, "comment_id": 55712768, "body": "What if you had a type level doubly ended queue. Then you erase the type information, leaving only a function to get it from one end. You provide a proof that adding things does change elem from the other end. Would this work?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448759045, "post_id": 33977814, "comment_id": 55712877, "body": "@PyRulez That <i>might</i> be doable (but certainly not fun) if we could be sure that <code>PT</code> was only going to access elements in the same order that it stored them. In general that&#39;s not going to be true, and in any case a version of <code>PT</code> with such a restriction wouldn&#39;t be very useful. (Intuition tells me you might need linear types to implement it anyway.)"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448761193, "post_id": 33977814, "comment_id": 55713350, "body": "@BenjaminHodgson Could you make this literate (or provide a link to the code). I think I see a way to finagle it using type classes."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448763922, "post_id": 33977814, "comment_id": 55713834, "body": "@BenjaminHodgson Oh, well, that&#39;s easily fixed with <code>MkRef :: a -&gt; (PTRef s a -&gt; PT (Cons a s) b) -&gt; PT s b</code> with a suitable <code>type instance Cons a (Elem as) = Elem (a &#39;: as)</code> type family..."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448791598, "post_id": 33977814, "comment_id": 55718997, "body": "@DanielWagner that&#39;d work, and it&#39;s slightly more flexible, but I don&#39;t see it as a materially different idea. You&#39;re indexing the reference by the set of types instead of the monad, but the important part is the type parameter which grows when you add something to the environment. And anyhow you still have to add it into the definition of <code>PT</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1448792613, "post_id": 33977814, "comment_id": 55719280, "body": "@PyRulez As a rule, a program that can&#39;t be written with explicit evidence-passing won&#39;t be saved by type classes. Type classes are &quot;just&quot; a mechanism for making certain values implicit. A classy program can always be transformed into a program which explicitly passes around dictionaries. Indeed, this is what GHC does during compilation."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448826007, "post_id": 33977814, "comment_id": 55729908, "body": "@BenjaminHodgson You have two complaints in that comment; one seems to be that my idea is too similar to the existing solution, and the other that it is too different!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448827673, "post_id": 33977814, "comment_id": 55730570, "body": "@DanielWagner The existing solution doesn&#39;t work! ;)"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1448850877, "post_id": 33977814, "comment_id": 55737082, "body": "Can&#39;t you use <code>do</code> notation with indexed monads via <code>RebindableSyntax</code>?"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 14, "last_activity_date": 1461710355, "last_edit_date": 1495542743, "creation_date": 1448754840, "answer_id": 33977814, "question_id": 33975270, "link": "https://stackoverflow.com/questions/33975270/can-a-st-like-monad-be-executed-purely-without-the-st-library/33977814#33977814", "title": "Can a `ST`-like monad be executed purely (without the `ST` library)?", "body": "<p>tl;dr: It's not possible without adjustments to the definition of <code>PT</code>. Here's the core problem: you'll be running your stateful computation in the context of some sort of storage medium, but said storage medium has to know how to store <em>arbitrary</em> types. This isn't possible without packaging up some sort of evidence into the <code>MkRef</code> constructor - either an existentially wrapped <code>Typeable</code> dictionary as others have suggested, or a proof that the value belongs to one of a known finite set of types.</p>\n\n<p>For a first attempt, let's try using a list as the storage medium and integers to refer to elements of the list.</p>\n\n<pre><code>newtype Ix a = MkIx Int  -- the index of an element in a list\n\ninterp :: PT Ix a -&gt; State [b] a\ninterp (MkRef x) = modify (++ [x]) &gt;&gt; gets (Ref . MkIx . length)\n-- ...\n</code></pre>\n\n<p>When storing a new item in the environment, we make sure to add it to the end of the list, so that <code>Ref</code>s we've previously given out stay pointing at the correct element.</p>\n\n<p>This ain't right. I can make a reference to <em>any</em> type <code>a</code>, but the type of <code>interp</code> says that the storage medium is a homogeneous list of <code>b</code>s. GHC has us bang to rights when it rejects this type signature, complaining that it can't match <code>b</code> with the type of the thing inside <code>MkRef</code>.</p>\n\n<hr>\n\n<p>Undeterred, let us have a go at using a <em>heterogeneous</em> list as the environment for the <code>State</code> monad in which we'll interpret <code>PT</code>.</p>\n\n<pre><code>infixr 4 :&gt;\ndata Tuple as where\n    E :: Tuple '[]\n    (:&gt;) :: a -&gt; Tuple as -&gt; Tuple (a ': as)\n</code></pre>\n\n<p>This is one of my personal favourite Haskell data types. It's an <em>extensible tuple</em> indexed by a list of the types of the things inside it. Tuples are heterogeneous linked lists with type-level information about the types of the things inside it. (It's often called <code>HList</code> following <a href=\"http://okmij.org/ftp/Haskell/HList-ext.pdf\" rel=\"nofollow noreferrer\">Kiselyov's paper</a> but I prefer <code>Tuple</code>.) When you add something to the front of a tuple, you add its type to the front of the list of types. In a poetic mood, <a href=\"https://themonadreader.files.wordpress.com/2015/08/issue24.pdf\" rel=\"nofollow noreferrer\">I once put it this way</a>: \"The tuple and its type grow together, like a vine creeping up a bamboo plant.\"</p>\n\n<p>Examples of <code>Tuple</code>s:</p>\n\n<pre><code>ghci&gt; :t 'x' :&gt; E\n'x' :&gt; E :: Tuple '[Char]\nghci&gt; :t \"hello\" :&gt; True :&gt; E\n\"hello\" :&gt; True :&gt; E :: Tuple '[[Char], Bool]\n</code></pre>\n\n<p>What do references to values inside tuples look like? We have to prove to GHC that the type of the thing we're getting out of the tuple is indeed the type we expect.</p>\n\n<pre><code>data Elem as a where  -- order of indices arranged for convenient partial application\n    Here :: Elem (a ': as) a\n    There :: Elem as a -&gt; Elem (b ': as) a\n</code></pre>\n\n<p>The definition of <code>Elem</code> is structurally that of the natural numbers (<code>Elem</code> values like <code>There (There Here)</code> look similar to natural numbers like <code>S (S Z)</code>) but with extra types - in this case, proving that the type <code>a</code> is in the type-level list <code>as</code>. I mention this because it's suggestive: <code>Nat</code>s make good list indices, and likewise <code>Elem</code> is useful for indexing into a tuple. In this respect it'll be useful as a replacement for the <code>Int</code> inside our reference type.</p>\n\n<pre><code>(!) :: Tuple as -&gt; Elem as a -&gt; a\n(x :&gt; xs) ! Here = x\n(x :&gt; xs) ! (There ix) = xs ! ix\n</code></pre>\n\n<p>We need a couple of functions to work with tuples and indices.</p>\n\n<pre><code>type family as :++: bs where\n    '[] :++: bs = bs\n    (a ': as) :++: bs = a ': (as :++: bs)\n\nappendT :: a -&gt; Tuple as -&gt; (Tuple (as :++: '[a]), Elem (as :++: '[a]) a)\nappendT x E = (x :&gt; E, Here)\nappendT x (y :&gt; ys) = let (t, ix) = appendT x ys\n                      in (y :&gt; t, There ix)\n</code></pre>\n\n<p>Let's try and write an interpreter for a <code>PT</code> in a <code>Tuple</code> environment.</p>\n\n<pre><code>interp :: PT (Elem as) a -&gt; State (Tuple as) a\ninterp (MkRef x) = do\n    t &lt;- get\n    let (newT, el) = appendT x t\n    put newT\n    return el\n-- ...\n</code></pre>\n\n<p>No can do, buster. The problem is that the type of the <code>Tuple</code> in the environment changes when we obtain a new reference. As I mentioned before, adding something to a tuple adds its type to the tuple's type, a fact belied by the type <code>State (Tuple as) a</code>. GHC's not fooled by this attempted subterfuge: <code>Could not deduce (as ~ (as :++: '[a1]))</code>.</p>\n\n<hr>\n\n<p>This is where the wheels come off, as far as I can tell. What you really want to do is keep the size of the tuple constant throughout a <code>PT</code> computation. This would require you to index <code>PT</code> itself by the list of types to which you can obtain references, proving every time you do so that you're allowed to (by giving an <code>Elem</code> value). The environment would then look like a tuple of lists, and a reference would consist an <code>Elem</code> (to select the right list) and an <code>Int</code> (to find the particular item in the list).</p>\n\n<p>This plan breaks the rules, of course (you need to change the definition of <code>PT</code>), but it also has engineering problems. When I call <code>MkRef</code>, the onus is on me to give an <code>Elem</code> for the value I'm making a reference to, which is pretty tedious. (That said, you can usually convince GHC to find <code>Elem</code> values by proof search using a hacky type class.)</p>\n\n<p>Another thing: composing <code>PT</code>s becomes difficult. All the parts of your computation have to be indexed by the <em>same</em> list of types. You could attempt to introduce combinators or classes which allow you to grow the environment of a <code>PT</code>, but you'd also have to update all the references when you do that. Using the monad would be quite difficult.</p>\n\n<p>A possibly-cleaner implementation would allow the list of types in a <code>PT</code> to vary as you walk around the datatype: every time you encounter a <code>MkRef</code> the type gets one longer. Because the type of the computation changes as it progresses, you can't use a regular monad - you have to resort to <a href=\"https://hackage.haskell.org/package/indexed-0.1/docs/Control-Monad-Indexed.html\" rel=\"nofollow noreferrer\"><code>IxMonad</code> </a>. If you want to know what that program looks like, see my <a href=\"https://stackoverflow.com/a/33977350/1523776\">other answer</a>.</p>\n\n<p>Ultimately, the sticking point is that the type of the tuple is determined by the value of the <code>PT</code> request. The environment <em>is</em> what a given request decides to store in it. <code>interp</code> doesn't get to choose what's in the tuple, it must come from an index on <code>PT</code>. Any attempt to cheat that requirement is going to crash and burn. Now, in a true dependently-typed system we could examine the <code>PT</code> value we were given and figure out what <code>as</code> should be. Alas, Haskell is not a dependently-typed system.</p>\n"}, {"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1448972263, "post_id": 34019380, "comment_id": 55795365, "body": "Huzzah! A win for abstract nonsense! (This provides an interesting foil to Andr&#225;s Kov&#225;cs, I must say.)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1448983379, "post_id": 34019380, "comment_id": 55802797, "body": "You can use <code>RebindableSyntax</code> if you add <code>fail</code> to your <code>MonadIx</code>. Also, you could use some class magic to implicitly weaken <code>Elem</code>-s into extended contexts."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1448983629, "post_id": 34019380, "comment_id": 55802972, "body": "Anyway, this is roughly what I meant by &quot;indexed state monad&quot; solution. The issue is that this expresses none of the reasons why classic ST works (we could say this is not ST per se, but rather just a specific usage of the indexed state monad). I tried to do a proper embedding of pure ST in Agda, but so far <a href=\"http://stackoverflow.com/questions/34023712/modeling-st-monad-in-agda\">I&#39;ve had little success</a>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1448984208, "post_id": 34019380, "comment_id": 55803413, "body": "FYI, here&#39;s <a href=\"http://lpaste.net/146287\" rel=\"nofollow noreferrer\">my version</a> with a bit of magical sugar for <code>Elem</code>-s."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1448987829, "post_id": 34019380, "comment_id": 55806132, "body": "@Andr&#225;sKov&#225;cs &quot;this expresses none of the reasons why classic ST works&quot; &lt;- could you elaborate on what you mean by this? Also, yes, I did write a class to transport an <code>Elem</code> to an arbitrarily-larger list, which looked just like your <code>Weaken</code>, but I didn&#39;t fancy explaining it ;)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1448988356, "post_id": 34019380, "comment_id": 55806521, "body": "@BenjaminHodgson see my Agda SO question that I linked above. In short, the indexed state monad doesn&#39;t know or enforce that all our references point to older versions of the same state. Which is one reason why it quickly gets very hard to write code in the indexed state monad that does statically unknown state extensions."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1449023523, "post_id": 34019380, "comment_id": 55823087, "body": "Can my <code>PT</code> be compiled into this <code>PT</code>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1449045591, "post_id": 34019380, "comment_id": 55831246, "body": "@PyRulez In principle, yes, though I don&#39;t know why you&#39;d want to. You&#39;ll have to use the usual trick of building something in an existential wrapper (<code>data APT ref a = forall as bs. APT (PT ref as bs a)</code>). The hard part would be inserting the right calls to <code>expand</code> in the compiled code. When you unwrap and <code>run</code> it you&#39;ll have to prove <code>as ~ &#39;[]</code>. It won&#39;t be pretty, and it&#39;s a lot more work than just using the indexed version in the first place with <code>RebindableSyntax</code>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 9, "last_activity_date": 1455235552, "last_edit_date": 1495542743, "creation_date": 1448969529, "answer_id": 34019380, "question_id": 33975270, "link": "https://stackoverflow.com/questions/33975270/can-a-st-like-monad-be-executed-purely-without-the-st-library/34019380#34019380", "title": "Can a `ST`-like monad be executed purely (without the `ST` library)?", "body": "<p>Since I posted my <a href=\"https://stackoverflow.com/a/33977814/1523776\">earlier answer</a>, you've indicated that you don't mind making changes to your definition of <code>PT</code>. I am happy to report: relaxing that restriction changes the answer to your question from <strong>no</strong> to <strong>yes</strong>! I've already argued that you need to index your monad by the set of types in your storage medium, so here's some working code showing how to do that. (I originally had this as an edit to my previous answer but it got too long, so here we are.)</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE PatternSynonyms #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE RebindableSyntax #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport Prelude\n</code></pre>\n\n<p>We're going to need a smarter <code>Monad</code> class than the one in the Prelude: that of <a href=\"http://bentnib.org/paramnotions-jfp.pdf\" rel=\"nofollow noreferrer\">indexed monad-like things</a> describing paths through a directed graph. For reasons that should become apparent, I'm going to define indexed functors as well.</p>\n\n<pre><code>class FunctorIx f where\n    imap :: (a -&gt; b) -&gt; f i j a -&gt; f i j b\n\nclass FunctorIx m =&gt; MonadIx m where\n    ireturn :: a -&gt; m i i a\n    (&gt;&gt;&gt;=) :: m i j a -&gt; (a -&gt; m j k b) -&gt; m i k b\n\n(&gt;&gt;&gt;) :: MonadIx m =&gt; m i j a -&gt; m j k b -&gt; m i k b\nma &gt;&gt;&gt; mb = ma &gt;&gt;&gt;= \\_ -&gt; mb\n\nreplicateM_ :: MonadIx m =&gt; Int -&gt; m i i a -&gt; m i i ()\nreplicateM_ 0 _ = ireturn ()\nreplicateM_ n m = m &gt;&gt;&gt; replicateM_ (n - 1) m\n</code></pre>\n\n<p>An indexed monad uses the type system to track the progress of a stateful computation. <code>m i j a</code> is a monadic computation which requires an input state of <code>i</code>, changes the state to <code>j</code>, and produces a value of type <code>a</code>. Sequencing indexed monads with <code>&gt;&gt;&gt;=</code> is like playing dominoes. You can feed a computation which takes the state from <code>i</code> to <code>j</code> into a computation which goes from <code>j</code> to <code>k</code>, and get a bigger computation from <code>i</code> to <code>k</code>. (There's a richer version of this indexed monad described in <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Kleisli.pdf\" rel=\"nofollow noreferrer\"><em>Kleisli Arrows of Outrageous Fortune</em></a> (<a href=\"https://stackoverflow.com/a/28696299/1523776\">and elsewhere</a>) but this one is quite enough for our purposes.)</p>\n\n<p>One possibility with <code>MonadIx</code> is a <code>File</code> monad which tracks the state of a file handle, ensuring you don't forget to free resources. <code>fOpen :: File Closed Open ()</code> starts with a closed file and opens it, <code>fRead :: File Open Open String</code> returns the contents of an opened file, and <code>fClose :: File Open Closed ()</code> takes a file from open to closed. The <code>run</code> operation takes a computation of type <code>File Closed Closed a</code>, which ensures that your file handles always get cleaned up.</p>\n\n<p>But I digress: here we are concerned not with a file handle but with a set of typed \"memory locations\"; the types of the things in the virtual machine's memory bank are what we'll use for the monad's indices. I like to get my \"program/interpreter\" monads <a href=\"https://softwareengineering.stackexchange.com/a/242803/103810\">for free</a> because it expresses the fact that results live at the leaves of a computation, and promotes composability and code reuse, so here's the functor which will produce <code>PT</code> when we plug it into <code>FreeIx</code> below:</p>\n\n<pre><code>data PTF ref as bs r where\n    MkRef_ :: a -&gt; (ref (a ': as) a -&gt; r) -&gt; PTF ref as (a ': as) r\n    GetRef_ :: ref as a -&gt; (a -&gt; r) -&gt; PTF ref as as r\n    PutRef_ :: a -&gt; ref as a -&gt; r -&gt; PTF ref as as r\n\ninstance FunctorIx (PTF ref) where\n    imap f (MkRef_ x next) = MkRef_ x (f . next)\n    imap f (GetRef_ ref next) = GetRef_ ref (f . next)\n    imap f (PutRef_ x ref next) = PutRef_ x ref (f next)\n</code></pre>\n\n<p><code>PTF</code> is parameterised by the type of reference <code>ref :: [*] -&gt; * -&gt; *</code> - references are allowed to know which types are in the system - and indexed by the list of types being stored in the interpreter's \"memory\". The interesting case is <code>MkRef_</code>: making a new reference adds a value of type <code>a</code> to the memory, taking <code>as</code> to <code>a ': as</code>; the continuation expects a <code>ref</code> in the extended environment. The other operations don't change the list of types in the system.</p>\n\n<p>When I create references sequentially (<code>x &lt;- mkRef 1; y &lt;- mkRef 2</code>), they'll have different types: the first will be a <code>ref (a ': as) a</code> and the second will be a <code>ref (b ': a ': as) b</code>. To make the types line up, I need a way to use a reference in a bigger environment than the one it was created in. In general, this operation depends on the type of reference, so I'll put it in a class.</p>\n\n<pre><code>class Expand ref where\n    expand :: ref as a -&gt; ref (b ': as) a\n</code></pre>\n\n<p>One possible generalisation of this class would wrap up the pattern of repeated applications of <code>expand</code>, with a type like <code>inflate :: ref as a -&gt; ref (bs :++: as) a</code>.</p>\n\n<p>Here's another reusable bit of infrastructure, the <em>indexed free monad</em> I mentioned earlier. <code>FreeIx</code> turns an indexed functor into an indexed monad by providing a type-aligned joining operation <code>Free</code>, which ties the recursive knot in the functor's parameter, and a do-nothing operation <code>Pure</code>.</p>\n\n<pre><code>data FreeIx f i j a where\n    Pure :: a -&gt; FreeIx f i i a\n    Free :: f i j (FreeIx f j k a) -&gt; FreeIx f i k a\n\nlift :: FunctorIx f =&gt; f i j a -&gt; FreeIx f i j a\nlift f = Free (imap Pure f)\n\ninstance FunctorIx f =&gt; MonadIx (FreeIx f) where\n    ireturn = Pure\n    Pure x &gt;&gt;&gt;= f = f x\n    Free love {- , man -} &gt;&gt;&gt;= f = Free $ imap (&gt;&gt;&gt;= f) love\n\ninstance FunctorIx f =&gt; FunctorIx (FreeIx f) where\n    imap f x = x &gt;&gt;&gt;= (ireturn . f)\n</code></pre>\n\n<p>One disadvantage of free monads is the boilerplate you have to write to make <code>Free</code> and <code>Pure</code> easier to work with. Here are some single-action <code>PT</code>s which form the basis of the monad's API, and some <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#pattern-synonyms\" rel=\"nofollow noreferrer\">pattern synonyms</a> to hide the <code>Free</code> constructors when we unpack <code>PT</code> values.</p>\n\n<pre><code>type PT ref = FreeIx (PTF ref)\n\nmkRef :: a -&gt; PT ref as (a ': as) (ref (a ': as) a)\nmkRef x = lift $ MkRef_ x id\n\ngetRef :: ref as a -&gt; PT ref as as a\ngetRef ref = lift $ GetRef_ ref id\n\nputRef :: a -&gt; ref as a -&gt; PT ref as as ()\nputRef x ref = lift $ PutRef_ x ref ()\n\npattern MkRef x next = Free (MkRef_ x next)\npattern GetRef ref next = Free (GetRef_ ref next)\npattern PutRef x ref next = Free (PutRef_ x ref next)\n</code></pre>\n\n<p>That's everything we need to be able to write <code>PT</code> computations. Here's your <code>fib</code> example. I'm using <code>RebindableSyntax</code> and locally redefining the monad operators (to their indexed equivalents) so I can use <code>do</code> notation on my indexed monad.</p>\n\n<pre><code>-- fib adds two Ints to an arbitrary environment\nfib :: Expand ref =&gt; Int -&gt; PT ref as (Int ': Int ': as) Int\nfib n = do\n    rold' &lt;- mkRef 0\n    rnew &lt;- mkRef 1\n    let rold = expand rold'\n    replicateM_ n $ do\n        old &lt;- getRef rold\n        new &lt;- getRef rnew\n        putRef new rold\n        putRef (old+new) rnew\n    getRef rold\n        where (&gt;&gt;=) = (&gt;&gt;&gt;=)\n              (&gt;&gt;) = (&gt;&gt;&gt;)\n              return :: MonadIx m =&gt; a -&gt; m i i a\n              return = ireturn\n              fail :: MonadIx m =&gt; String -&gt; m i j a\n              fail = error\n</code></pre>\n\n<p>This version of <code>fib</code> looks just like the one you wanted to write in the original question. The only difference (apart from the local bindings of <code>&gt;&gt;=</code> and so on) is the call to <code>expand</code>. Every time you create a new reference, you have to <code>expand</code> all the old ones, which is a bit tedious.</p>\n\n<p>Finally we can finish the job we set out to do and build a <code>PT</code>-machine which uses a <code>Tuple</code> as the storage medium and <code>Elem</code> as the reference type.</p>\n\n<pre><code>infixr 5 :&gt;\ndata Tuple as where\n    E :: Tuple '[]\n    (:&gt;) :: a -&gt; Tuple as -&gt; Tuple (a ': as)\n\ndata Elem as a where\n    Here :: Elem (a ': as) a\n    There :: Elem as a -&gt; Elem (b ': as) a\n\n(!) :: Tuple as -&gt; Elem as a -&gt; a\n(x :&gt; xs) ! Here = x\n(x :&gt; xs) ! There ix = xs ! ix\n\nupdateT :: Elem as a -&gt; a -&gt; Tuple as -&gt; Tuple as\nupdateT Here x (y :&gt; ys) = x :&gt; ys\nupdateT (There ix) x (y :&gt; ys) = y :&gt; updateT ix x ys\n</code></pre>\n\n<p>To use an <code>Elem</code> in a larger tuple than the one you built it for, you just need to make it look further down the list.</p>\n\n<pre><code>instance Expand Elem where\n    expand = There\n</code></pre>\n\n<p>Note that this deployment of <code>Elem</code> is rather like a de Bruijn index: more-recently-bound variables have smaller indices.</p>\n\n<pre><code>interp :: PT Elem as bs a -&gt; Tuple as -&gt; a\ninterp (MkRef x next) tup = let newTup = x :&gt; tup\n                            in interp (next $ Here) newTup\ninterp (GetRef ix next) tup = let x = tup ! ix\n                              in interp (next x) tup\ninterp (PutRef x ix next) tup = let newTup = updateT ix x tup\n                                in interp next newTup\ninterp (Pure x) tup = x\n</code></pre>\n\n<p>When the interpreter encounters a <code>MkRef</code> request, it increases the size of its memory by adding <code>x</code> to the front. The type checker will remind you that any <code>ref</code>s from before the <code>MkRef</code> must be correctly <code>expand</code>ed, so existing references don't get out of whack when the tuple changes size. We paid for an interpreter without unsafe casts, but we got referential integrity to boot.</p>\n\n<p>Running from a standing start requires that the <code>PT</code> computation expects to begin with an empty memory bank, but we allow it to end in any state.</p>\n\n<pre><code>run :: (forall ref. Expand ref =&gt; PT ref '[] bs a) -&gt; a\nrun x = interp x E\n</code></pre>\n\n<p>It typechecks, but does it work?</p>\n\n<pre><code>ghci&gt; run (fib 5)\n5\nghci&gt; run (fib 3)\n2\n</code></pre>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 10, "answer_count": 3, "score": 32, "last_activity_date": 1461710355, "creation_date": 1448737452, "last_edit_date": 1448899119, "question_id": 33975270, "link": "https://stackoverflow.com/questions/33975270/can-a-st-like-monad-be-executed-purely-without-the-st-library", "title": "Can a `ST`-like monad be executed purely (without the `ST` library)?", "body": "<p>This post is literate Haskell. Just put in a file like \"pad.lhs\" and <code>ghci</code> will be able to run it.</p>\n\n<pre><code>&gt; {-# LANGUAGE GADTs, Rank2Types #-}\n&gt; import Control.Monad\n&gt; import Control.Monad.ST\n&gt; import Data.STRef\n</code></pre>\n\n<p>Okay, so I was able to figure how to represent the <code>ST</code> monad in pure code. First we start with our reference type. Its specific value is not really important. The most important thing is that <code>PT s a</code> should not be isomorphic to any other type <code>forall s</code>. (In particular, it should be isomorphic to neither <code>()</code> nor <code>Void</code>.)</p>\n\n<pre><code>&gt; newtype PTRef s a = Ref {unref :: s a} -- This is defined liked this to make `toST'` work. It may be given a different definition.\n</code></pre>\n\n<p>The kind for <code>s</code> is <code>*-&gt;*</code>, but that is not really important right now. It could be <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/kind-polymorphism.html\" rel=\"noreferrer\">polykind</a>, for all we care.</p>\n\n<pre><code>&gt; data PT s a where\n&gt;     MkRef   :: a -&gt; PT s (PTRef s a)\n&gt;     GetRef  :: PTRef s a -&gt; PT s a\n&gt;     PutRef  :: a -&gt; PTRef s a -&gt; PT s ()\n&gt;     AndThen :: PT s a -&gt; (a -&gt; PT s b) -&gt; PT s b\n</code></pre>\n\n<p>Pretty straight forward. <code>AndThen</code> allows us to use this as a <code>Monad</code>. You may be wondering how <code>return</code> is implemented. Here is its monad instance (it only respects monad laws with respect to <code>runPF</code>, to be defined later):</p>\n\n<pre><code>&gt; instance Monad (PT s) where\n&gt;     (&gt;&gt;=)    = AndThen\n&gt;     return a = AndThen (MkRef a) GetRef --Sorry. I like minimalism.\n&gt; instance Functor (PT s) where\n&gt;     fmap = liftM\n&gt; instance Applicative (PT s) where\n&gt;     pure  = return\n&gt;     (&lt;*&gt;) = ap\n</code></pre>\n\n<p>Now we can define <code>fib</code> as a test case.</p>\n\n<pre><code>&gt; fib :: Int -&gt; PT s Integer\n&gt; fib n = do\n&gt;     rold &lt;- MkRef 0\n&gt;     rnew &lt;- MkRef 1\n&gt;     replicateM_ n $ do\n&gt;         old &lt;- GetRef rold\n&gt;         new &lt;- GetRef rnew\n&gt;         PutRef      new  rold\n&gt;         PutRef (old+new) rnew\n&gt;     GetRef rold\n</code></pre>\n\n<p>And it type checks. Hurray! Now, I was able to convert this to <code>ST</code> (we now see why <code>s</code> had to be <code>* -&gt; *</code>)</p>\n\n<pre><code>&gt; toST :: PT (STRef s) a -&gt; ST s a\n&gt; toST (MkRef  a        ) = fmap Ref $ newSTRef a\n&gt; toST (GetRef   (Ref r)) = readSTRef r\n&gt; toST (PutRef a (Ref r)) = writeSTRef r a\n&gt; toST (pa `AndThen` apb) = (toST pa) &gt;&gt;= (toST . apb)\n</code></pre>\n\n<p>Now we can define a function to run <code>PT</code> without referencing <code>ST</code> at all:</p>\n\n<pre><code>&gt; runPF :: (forall s. PT s a) -&gt; a\n&gt; runPF p = runST $ toST p\n</code></pre>\n\n<p><code>runPF $ fib 7</code> gives <code>13</code>, which is correct.</p>\n\n<hr>\n\n<h2>My question is can we define <code>runPF</code> without reference using <code>ST</code> at all?</h2>\n\n<p>Is there a pure way to define <code>runPF</code>? <code>PTRef</code>'s definition is completely unimportant; it's only a placeholder type anyway. It can be redefined to whatever makes it work.</p>\n\n<p>If you <em>cannot</em> define <code>runPF</code> purely, give a proof that it cannot.</p>\n\n<p>Performance is not a concern (if it was, I would not have made every <code>return</code> have its own ref).</p>\n\n<p>I'm thinking that existential types may be useful.</p>\n\n<p>Note: It's trivial if we assume is <code>a</code> is dynamicable or something. I'm looking for an answer that works with all <code>a</code>.</p>\n\n<p>Note: In fact, an answer does not even necessarily have much to do with <code>PT</code>. It just needs to be as powerful as <code>ST</code> without using magic. (Conversion from <code>(forall s. PT s)</code> is sort of a test of if an answer is valid or not.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1448731758, "post_id": 33974188, "comment_id": 55704748, "body": "Try capitalizing listOfFav to <code>ListOfFav</code> everywhere it appears. You&#39;ll also need to replace Vazia with Empty to resolve an unknown-type error. You&#39;ll also need to remove the <code>deriving (Show)</code>, as it conflicts with your hand-spun one."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5615715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48de9a9523e3f61a8f069782440075e7?s=128&d=identicon&r=PG&f=1", "display_name": "GDuartept", "link": "https://stackoverflow.com/users/5615715/gduartept"}, "edited": false, "score": 0, "creation_date": 1448734105, "post_id": 33974588, "comment_id": 55705577, "body": "Thanks for pointing the capital letter, I&#39;m so stupid lost 30 mins on that, the orginal problem was that ListOfFav was written with a capital L on the data, with a &#39;l&#39; on the instance. Thank You :)"}], "tags": [], "owner": {"reputation": 3961, "user_id": 176015, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/398c96f77ec9b99b1e8122214227305d?s=128&d=identicon&r=PG", "display_name": "svenningsson", "link": "https://stackoverflow.com/users/176015/svenningsson"}, "is_accepted": false, "score": 2, "last_activity_date": 1448733682, "creation_date": 1448733682, "answer_id": 33974588, "question_id": 33974188, "link": "https://stackoverflow.com/questions/33974188/haskell-illegal-instance-declaration-for-show-recursive-data-type/33974588#33974588", "title": "Haskell: Illegal Instance declaration for show / recursive data type", "body": "<p>Haskell requires that data types start with a capital letter. Your code should look like this:</p>\n\n<pre><code>data ListOfFav a = Insert (a,Bool) (ListOfFav a) | Empty\n\ninstance Show a =&gt; Show (ListOfFav a) where\n  show = ('{' :) . go\n   where\n      go Empty                 = \"}\"\n      go (Insert (x,y) Empty)  = show x ++ show y ++ \"}\"\n      go (Insert (x,y) xs)     = show x ++ show y ++\", \" ++ go xs\n</code></pre>\n\n<p>Furthermore, Haskell only allows one <code>Show</code> instance per datatype. Either you use <code>deriving Show</code> to let the Haskell compiler create one for you or you write your own, but you cannot do both. In the code above I removed the <code>deriving Show</code> to let the handwritten instance take precedence.</p>\n"}], "owner": {"reputation": 11, "user_id": 5615715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48de9a9523e3f61a8f069782440075e7?s=128&d=identicon&r=PG&f=1", "display_name": "GDuartept", "link": "https://stackoverflow.com/users/5615715/gduartept"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1448733682, "creation_date": 1448731391, "question_id": 33974188, "link": "https://stackoverflow.com/questions/33974188/haskell-illegal-instance-declaration-for-show-recursive-data-type", "title": "Haskell: Illegal Instance declaration for show / recursive data type", "body": "<p>I've been searching a lot for this but I've not found something solid.</p>\n\n<p>I'm making my own module with my own data type, and then I tried to make a show instance, and that was when things got messy. I'll show you </p>\n\n<pre><code>data listOfFav a = Insert (a,Bool) (listOfFav a) | Empty deriving (Show)\n\ninstance Show a =&gt; Show (listOfFav a) where\n  show = ('{' :) . go\n   where\n      go Empty                 = \"}\"\n      go (Insert (x,y) Vazia)  = show x ++ show y ++ \"}\"\n      go (Insert (x,y) xs)     = show x ++ show y ++\", \" ++ go xs\n</code></pre>\n\n<p>And for some reason I got this error:</p>\n\n<pre><code>Illegal instance declaration for \u2018Show (listaFavoritos a)\u2019\n  (All instance types must be of the form (T a1 ... an)\n   where a1 ... an are *distinct type variables*,\n   and each type variable appears at most once in the instance head.\n   Use FlexibleInstances if you want to disable this.)\nIn the instance declaration for \u2018Show (listaFavoritos a)\u2019\n</code></pre>\n\n<p>I would be very thankfull if someone could help me</p>\n"}, {"tags": ["scala", "haskell", "haskell-lens", "lenses", "monocle-scala"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 8, "creation_date": 1448724285, "post_id": 33972337, "comment_id": 55702163, "body": "I remember a reddit discussion about a similar question from some way back. In it, Edward Kmett <a href=\"https://www.reddit.com/r/haskell/comments/34igpj/hypothetical_lens_xml_parsing_that_documents/cqv346w\" rel=\"nofollow noreferrer\">mentioned the notion</a> of &quot;coindexed prisms&quot; that would be able to report error information while remaining composable with normal lenses. Apparently, they were difficult to fit into the lens framework because of type inference issues, so they weren&#39;t implemented."}, {"owner": {"reputation": 1500, "user_id": 176876, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5f615cec8ac153c98d2082610137df59?s=128&d=identicon&r=PG", "display_name": "Jon Schoning", "link": "https://stackoverflow.com/users/176876/jon-schoning"}, "edited": false, "score": 0, "creation_date": 1482446487, "post_id": 33972337, "comment_id": 69788163, "body": "I think the concept of a Traversal would be appropriate here."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 6, "last_activity_date": 1493499096, "creation_date": 1493499096, "answer_id": 43700350, "question_id": 33972337, "link": "https://stackoverflow.com/questions/33972337/lens-prism-with-error-handling/43700350#43700350", "title": "Lens / Prism with error handling", "body": "<p>I have recently written <a href=\"http://oleg.fi/gists/posts/2017-04-26-indexed-poptics.html#coindexed\" rel=\"noreferrer\">a blog post</a> about indexed optics; which explores a bit how we can do coindexed optics as well.</p>\n\n<p>In short: Coindexed-optics are possible, but we have yet to do some further research there. Especially, because if we try to translate that approach into <code>lens</code> encoding of lenses (from Profunctor to VL) it gets even more hairy (but I think we can get away with <em>only</em> 7 type-variables).</p>\n\n<p>And we <strong>cannot</strong> really do this without altering how indexed optics are currently encoded in <code>lens</code>. So for now, you'll better to use validation specific libraries.</p>\n\n<p>To give a hint of the difficulties: When we try to compose with <code>Traversal</code>s, should we have</p>\n\n<pre><code>-- like `over` but also return an errors for elements not matched\nvalidatedOver :: CoindexedOptic' s a -&gt; (a -&gt; a) -&gt; s -&gt; (ValidationErrors, s)\n</code></pre>\n\n<p>or something else? If we could only compose Coindexed Prisms their value won't justify their complexity; they won't \"fit\" into optics framework.</p>\n"}], "owner": {"reputation": 9174, "user_id": 64923, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfab0edbc971a92ada9c0d74bf93cc42?s=128&d=identicon&r=PG", "display_name": "James Davies", "link": "https://stackoverflow.com/users/64923/james-davies"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 792, "favorite_count": 4, "answer_count": 1, "score": 20, "last_activity_date": 1493499096, "creation_date": 1448720461, "question_id": 33972337, "link": "https://stackoverflow.com/questions/33972337/lens-prism-with-error-handling", "title": "Lens / Prism with error handling", "body": "<p>Let's say I have a pair of conversion functions </p>\n\n<pre><code>string2int :: String -&gt; Maybe Int\nint2string :: Int -&gt; String\n</code></pre>\n\n<p>I could represent these fairly easily using Optics.</p>\n\n<p><code>stringIntPrism :: Prism String Int</code></p>\n\n<p>However if I want to represent failure reason, I'd need to keep these as two separate functions.</p>\n\n<pre><code>string2int :: String -&gt; Validation [ParseError] Int\nint2string :: Int -&gt; String`\n</code></pre>\n\n<p>For this simple example <code>Maybe</code> is perfectly fine, since we can always assume that a failure is a parse failure, thus we don't actually have to encode this using an Either or Validation type.</p>\n\n<p>However imagine, in addition to my parsing Prism, I want to perform some validation</p>\n\n<pre><code>isOver18 :: Int -&gt; Validation [AgeError] Int\nisUnder55 :: Int -&gt; Validation [AgeError] Int\n</code></pre>\n\n<p>It would be ideal to be able compose these things together, such that I could have</p>\n\n<p><code>ageField = isUnder55 . isOver18 . string2Int :: ValidationPrism [e] String Int</code></p>\n\n<p>This is fairly trivial to build by hand, however it seems like a common enough concept that there might be something lurking in the field of Lenses/Optics that does this already. Is there an existing abstraction that handles this?</p>\n\n<p>tl;dr</p>\n\n<p>Is there a standard way of implementing a partial lens / prism / iso that can be parameterised over an arbitrary functor instead of being tied directly to Maybe?.</p>\n\n<p>I've used Haskell notation above since it's more straight forward, however I'm actually using Monocle in Scala to implement this. I would, however, be perfectly happy with an answer specific to i.e. ekmett's Lens library.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1448702088, "post_id": 33969601, "comment_id": 55695956, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/28011292/reading-numbers-from-input-haskell\">Reading numbers from input Haskell</a>"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "edited": false, "score": 0, "creation_date": 1448755159, "post_id": 33969601, "comment_id": 55712111, "body": "That code does what you describe (assuming <code>getInt :: IO Int; getInt = fmap read getLine</code> or equivalent). Either you&#39;re not showing us all your code or you&#39;re trying to do something else."}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1448704856, "creation_date": 1448704856, "answer_id": 33970032, "question_id": 33969601, "link": "https://stackoverflow.com/questions/33969601/haskell-keep-adding-user-input-ints-until-a-negative-is-encountered/33970032#33970032", "title": "Haskell - keep adding user input ints until a negative is encountered", "body": "<p>Try writing a function which gets the next number and returns a \"IO (Maybe Integer)\" with \"Just\" for a positive input and \"Nothing\" for a negative one. Then use that in a recursive function to create a list of integers (hint: one of its arguments will be the list of integers so far). Then use that in a function that adds up all the integers in the list.</p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1448706241, "post_id": 33970055, "comment_id": 55697007, "body": "Your source says that <code>getLine</code> is provided by the prelude, not <code>getInt</code>. There is no <code>getInt</code> in the prelude."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1448715352, "post_id": 33970055, "comment_id": 55699549, "body": "You can write that much more concisely: <code>getInt = getLine &gt;&gt;= read</code>. Obviously it still needs the type signature."}], "tags": [], "owner": {"reputation": 2709, "user_id": 3125280, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/860ebed1ff170bd374da265129c099f4?s=128&d=identicon&r=PG&f=1", "display_name": "user3125280", "link": "https://stackoverflow.com/users/3125280/user3125280"}, "is_accepted": false, "score": 0, "last_activity_date": 1448707112, "last_edit_date": 1448707112, "creation_date": 1448704982, "answer_id": 33970055, "question_id": 33969601, "link": "https://stackoverflow.com/questions/33969601/haskell-keep-adding-user-input-ints-until-a-negative-is-encountered/33970055#33970055", "title": "Haskell - keep adding user input ints until a negative is encountered", "body": "<p>I don't think it is broken, but I don't know your definition of getInt. For me this one works fine:</p>\n\n<pre><code>getInt :: IO Int\ngetInt = do str &lt;- getLine\n        return (read str)\n</code></pre>\n\n<p>taken from <a href=\"http://www.haskellforall.com/2013/01/introduction-to-haskell-io.html\" rel=\"nofollow\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1448706196, "creation_date": 1448706196, "answer_id": 33970231, "question_id": 33969601, "link": "https://stackoverflow.com/questions/33969601/haskell-keep-adding-user-input-ints-until-a-negative-is-encountered/33970231#33970231", "title": "Haskell - keep adding user input ints until a negative is encountered", "body": "<blockquote>\n  <p>I'm trying to create a program in Haskell that takes in user inputs,\n  adds each input line up, and spits out the final sum once the user\n  inputs a negative number</p>\n</blockquote>\n\n<p>If this is the only thing you want, then you can simply write</p>\n\n<pre><code>main = getContents &gt;&gt;= print . sum . takeWhile (&gt;= 0) . map read . lines\n</code></pre>\n\n<p>Otherwise you can use this combinator</p>\n\n<pre><code>repeatWhile :: Monad m =&gt; (a -&gt; Bool) -&gt; m a -&gt; m [a]\nrepeatWhile p a = do\n    x &lt;- a\n    if p x\n        then (x:) &lt;$&gt; repeatWhile p a\n        else return []\n</code></pre>\n\n<p>like this</p>\n\n<pre><code>main = repeatWhile (&gt;= 0) readLn &gt;&gt;= print . sum\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 5437872, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9b86372b45d2179b5bb6f7cf039252dc?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey", "link": "https://stackoverflow.com/users/5437872/jeffrey"}, "edited": false, "score": 0, "creation_date": 1448733145, "post_id": 33971868, "comment_id": 55705195, "body": "That&#39;s the implementation I&#39;m also using. My code still has problems where it takes in each line as input and prints each line back out to me (kinda like echoing) instead of actually functioning properly"}], "tags": [], "owner": {"reputation": 26, "user_id": 4644931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5b788bbae7eb06a706019fa76a5bdd?s=128&d=identicon&r=PG&f=1", "display_name": "eliasmacielr", "link": "https://stackoverflow.com/users/4644931/eliasmacielr"}, "is_accepted": false, "score": 0, "last_activity_date": 1448717293, "creation_date": 1448717293, "answer_id": 33971868, "question_id": 33969601, "link": "https://stackoverflow.com/questions/33969601/haskell-keep-adding-user-input-ints-until-a-negative-is-encountered/33971868#33971868", "title": "Haskell - keep adding user input ints until a negative is encountered", "body": "<p>The definitions for the functions <code>sumF1</code> and <code>sumF2</code> seem to work well, probably the issue is with the <code>getInt</code> function you use to get <code>n</code> each time.</p>\n\n<p>Try adding this line for the definition of <code>getInt</code>:</p>\n\n<pre><code>getInt = getLine &gt;&gt;= \\n -&gt; return (read n :: Int)\n</code></pre>\n\n<p>Which uses <code>getLine</code> from the prelude.</p>\n"}], "owner": {"reputation": 13, "user_id": 5437872, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9b86372b45d2179b5bb6f7cf039252dc?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey", "link": "https://stackoverflow.com/users/5437872/jeffrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 1, "answer_count": 4, "score": 0, "last_activity_date": 1448717293, "creation_date": 1448701795, "question_id": 33969601, "link": "https://stackoverflow.com/questions/33969601/haskell-keep-adding-user-input-ints-until-a-negative-is-encountered", "title": "Haskell - keep adding user input ints until a negative is encountered", "body": "<p>I'm trying to create a program in Haskell that takes in user inputs, adds each input line up, and spits out the final sum once the user inputs a negative number (the total sum not including the negative number, to be specific). I attempt</p>\n\n<pre><code>    sumF1 :: IO ()\n    sumF1 = do\n        totSum &lt;- sumF2 0\n        print totSum\n\n    sumF2 :: Int -&gt; IO Int\n    sumF2 prev = do \n        n&lt;-getInt\n        if n&lt;0\n            then return prev\n            else sumF2 (prev+n)\n</code></pre>\n\n<p>However, when I try this, I just get a function that prints on every single line and always repeats the input as opposed to summing it up. How do I fix it so that it only prints a sum at the end and that it adds properly.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1448702032, "post_id": 33969538, "comment_id": 55695935, "body": "I guess <code>n</code> multiplications is faster than chasing an <code>n</code>-deep pointer chain (hence doing <code>n</code> memory probes). No big surprise there. Possibly if you switch from a list to a more suitable data structure -- like a <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.4/docs/Data-MemoTrie.html\" rel=\"nofollow noreferrer\">trie</a> -- you will get better performance from the memoized version."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1448706352, "post_id": 33969538, "comment_id": 55697030, "body": "@DanielWagner Or if you calculate fibs in one go per <a href=\"http://stackoverflow.com/questions/11466284/how-is-this-fibonacci-function-memoized\" title=\"how is this fibonacci function memoized\">stackoverflow.com/questions/11466284/&hellip;</a>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1448718308, "post_id": 33969538, "comment_id": 55700357, "body": "you may also be interested in <code>shared_fact = (scanl (*) 1 [1..] !!)</code>. <code>shared_fact n</code> is as expensive as <code>mem_fact n</code>, but <code>shared_fact n + shared_fact m</code> is cheaper than <code>mem_fact n + mem_fact m</code>."}], "answers": [{"comments": [{"owner": {"reputation": 589, "user_id": 697851, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/441dec9cb577f181f1ce4bb75667146a?s=128&d=identicon&r=PG", "display_name": "Charles Gao", "link": "https://stackoverflow.com/users/697851/charles-gao"}, "edited": false, "score": 0, "creation_date": 1448742431, "post_id": 33975966, "comment_id": 55708459, "body": "I&#39;m also wondering why the first call to <code>mem_fact</code> takes so much time. Isn&#39;t it just calling <code>fact</code> and store it in the n-th location? What am I missing?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 589, "user_id": 697851, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/441dec9cb577f181f1ce4bb75667146a?s=128&d=identicon&r=PG", "display_name": "Charles Gao", "link": "https://stackoverflow.com/users/697851/charles-gao"}, "edited": false, "score": 0, "creation_date": 1448743460, "post_id": 33975966, "comment_id": 55708775, "body": "Well it is building a 3 million element linked list, 2999999 of which are thunks (unevaluated computations).  Do you care to investigate it further than that?"}, {"owner": {"reputation": 589, "user_id": 697851, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/441dec9cb577f181f1ce4bb75667146a?s=128&d=identicon&r=PG", "display_name": "Charles Gao", "link": "https://stackoverflow.com/users/697851/charles-gao"}, "edited": false, "score": 0, "creation_date": 1448744100, "post_id": 33975966, "comment_id": 55708971, "body": "I see what&#39;s going on. Thanks for the detailed answer!"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1448741622, "creation_date": 1448741622, "answer_id": 33975966, "question_id": 33969538, "link": "https://stackoverflow.com/questions/33969538/weird-execution-time-in-haskell/33975966#33975966", "title": "Weird Execution Time in Haskell", "body": "<p>I agree with Daniel, much as I hate to (/s), that looking up the nth element in a linked list is slow and thus not the right way to memoize.  One solution is to use a map or trie, but since this has already been done we can just leverage one of the many trie memoization packages on hackage.</p>\n\n<p>Cutting to the chase:</p>\n\n<ul>\n<li><code>fact</code> takes ~ <em>300 us</em></li>\n<li>Your list memoization takes ~ <em>1000 to 2000 us</em></li>\n<li>Using MemoTrie results in runtimes of ~ <em>0.4 us</em></li>\n</ul>\n\n<p>This was determined by using your code and memotrie with Criterion:</p>\n\n<pre><code>import Data.MemoTrie\nimport Criterion.Main\n\nend :: Int\nend = 300000\n\ntmdMemo :: Int -&gt; Int\ntmdMemo x = memo2 go 1 x\n where\n   go :: Int -&gt; Int -&gt; Int\n   go acc 1 = acc\n   go acc n = let new = n*acc in new `seq` memo2 go new (n-1)\n\n\n-- test function\nfact :: Int -&gt; Int\nfact n = product [1..n]\n\nmem :: (Int -&gt; Int) -&gt; Int -&gt; Int\nmem f = (map f [0..] !!)\n\ngaoMemo :: Int -&gt; Int\ngaoMemo = mem fact\n\nmain :: IO ()\nmain = defaultMain [ bench \"Normal\"   $ nf fact end\n                   , bench \"TMD-Memo\" $ nf tmdMemo end\n                   , bench \"Gao-Memo\" $ nf gaoMemo end\n                   ]\n</code></pre>\n\n<p>With the results of:</p>\n\n<pre><code>benchmarking Normal\ntime                 270.7 \u03bcs   (268.8 \u03bcs .. 272.7 \u03bcs)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 271.7 \u03bcs   (270.4 \u03bcs .. 273.6 \u03bcs)\nstd dev              4.997 \u03bcs   (3.971 \u03bcs .. 6.812 \u03bcs)\nvariance introduced by outliers: 11% (moderately inflated)\n\nbenchmarking TMD-Memo\ntime                 379.3 ns   (376.2 ns .. 382.3 ns)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 381.5 ns   (378.0 ns .. 386.3 ns)\nstd dev              13.66 ns   (10.74 ns .. 17.59 ns)\nvariance introduced by outliers: 52% (severely inflated)\n\nbenchmarking Gao-Memo\ntime                 1.439 ms   (1.408 ms .. 1.469 ms)\n                     0.996 R\u00b2   (0.994 R\u00b2 .. 0.998 R\u00b2)\nmean                 1.446 ms   (1.430 ms .. 1.467 ms)\nstd dev              63.31 \u03bcs   (53.75 \u03bcs .. 74.26 \u03bcs)\nvariance introduced by outliers: 31% (moderately inflated)\n</code></pre>\n"}], "owner": {"reputation": 589, "user_id": 697851, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/441dec9cb577f181f1ce4bb75667146a?s=128&d=identicon&r=PG", "display_name": "Charles Gao", "link": "https://stackoverflow.com/users/697851/charles-gao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 33975966, "answer_count": 1, "score": 2, "last_activity_date": 1448741622, "creation_date": 1448701363, "question_id": 33969538, "link": "https://stackoverflow.com/questions/33969538/weird-execution-time-in-haskell", "title": "Weird Execution Time in Haskell", "body": "<p>I defined a memorized version of the factorial function. I observed that the second time I ran with the same parameter again, the execution time got greatly improved. But what confuses me is that both of them are much slower than the factorial function itself. For example, one run of the following program</p>\n\n<pre><code>import Text.Printf\nimport Control.Exception\nimport System.CPUTime\n\n-- test function\nfact :: Int -&gt; Int\nfact n = product [1..n]\n\nmem :: (Int -&gt; Int) -&gt; Int -&gt; Int\nmem f = (map f [0..] !!)\n\nmem_fact = mem fact\n\ntime :: IO t -&gt; IO t\ntime a = do\n    start &lt;- getCPUTime\n    v &lt;- a\n    end &lt;- getCPUTime\n    let diff = (fromIntegral (end - start)) / (10^12)\n    printf \"Computation time: %0.3f sec\\n\" (diff :: Double)\n    return v\n\nmain = do\n    putStrLn \"Starting...\"\n    time $ fact 3000000 `seq` return ()\n    time $ mem_fact 3000000 `seq` return ()\n    time $ mem_fact 3000000 `seq` return ()\n    putStrLn \"Done.\"\n</code></pre>\n\n<p>produces the following output:</p>\n\n<pre><code>Starting...\nComputation time: 0.008 sec\nComputation time: 0.621 sec\nComputation time: 0.047 sec\nDone.\n</code></pre>\n\n<p>Why is calling <code>fact</code> so much faster than <code>mem_fact</code>? Any explanations?</p>\n"}, {"tags": ["haskell", "fold", "pointfree"], "answers": [{"comments": [{"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 0, "creation_date": 1448700361, "post_id": 33969308, "comment_id": 55695557, "body": "Mmmh, it reminds me of the thrush combinator Txy = yx. Looks like a general approach. Thank you."}], "tags": [], "owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "is_accepted": true, "score": 3, "last_activity_date": 1448699410, "creation_date": 1448699410, "answer_id": 33969308, "question_id": 33969249, "link": "https://stackoverflow.com/questions/33969249/pointfree-function-for-fold-left-operation/33969308#33969308", "title": "Pointfree function for fold left operation", "body": "<p>You can use <code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</code> for this:</p>\n\n<pre><code>fourth :: (a, b, c, Int) -&gt; Int\nfourth (a, b, c, d) = d\n\nsummerLeft :: Int -&gt; (a, b, c, Int) -&gt; Int\nsummerLeft = flip ((+) . fourth)\n\nmain :: IO ()\nmain = print $ summerLeft 1 (2, 3, 4, 5)\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>6\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1448704313, "creation_date": 1448704313, "answer_id": 33969967, "question_id": 33969249, "link": "https://stackoverflow.com/questions/33969249/pointfree-function-for-fold-left-operation/33969967#33969967", "title": "Pointfree function for fold left operation", "body": "<p>Here is another solution:</p>\n\n<pre><code>summerLeft n tuple = n + fourth tuple\nsummerLeft n = (n +) . fourth\nsummerLeft = (. fourth) . (+)\n</code></pre>\n"}], "owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 33969308, "answer_count": 2, "score": 2, "last_activity_date": 1448704313, "creation_date": 1448698938, "question_id": 33969249, "link": "https://stackoverflow.com/questions/33969249/pointfree-function-for-fold-left-operation", "title": "Pointfree function for fold left operation", "body": "<p>I have this function that extracts the fourth element, which happens to be an integer, out of a tuple:</p>\n\n<pre><code>fourth :: (a, b, c, Int) -&gt; Int\nfourth (a, b, c, d) = d\n</code></pre>\n\n<p>I want to sum all the fourth integers of a list of tuples. I can use <code>fourth</code> inside a fold right operation by composing it with <code>(+)</code> into a suitable <code>foldr</code> operator:</p>\n\n<pre><code>summerRight :: (a, b, c, Int) -&gt; Int -&gt; Int\nsummerRight tuple n = fourth tuple + n\n</code></pre>\n\n<p>the whole thing can be written pointfree:</p>\n\n<pre><code>summerRight = (+) . fourth\n</code></pre>\n\n<p>Now, if I want to express the sum as a fold left, I need an operator:</p>\n\n<pre><code>summerLeft :: Int -&gt; (a, b, c, Int) -&gt; Int\nsummerLeft n tuple = n + fourth tuple\n</code></pre>\n\n<p>I cannot manage to write this last function pointfree.</p>\n\n<p>Is it possible to write <code>summerLeft</code> pointfree?</p>\n\n<p>If it's not, is there some possible reasoning that relates fold right with pointfree programming?</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 633, "user_id": 5107759, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/33e659c0770221780a6fd21960909b6d?s=128&d=identicon&r=PG", "display_name": "joanbm", "link": "https://stackoverflow.com/users/5107759/joanbm"}, "edited": false, "score": 0, "creation_date": 1448732363, "post_id": 33966747, "comment_id": 55704958, "body": "I&#39;ve no experience with <code>persistent</code> but think &quot;undefined behavior&quot; is database type/implementation dependent. In most cases it simply calls sql&#39;s <code>UPDATE</code>, so it would work as you do expect. If unsure, put both record existence check and replace into a single transaction. Hope it supports transactions."}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 142, "favorite_count": 1, "answer_count": 0, "score": 6, "last_activity_date": 1448674396, "creation_date": 1448674396, "question_id": 33966747, "link": "https://stackoverflow.com/questions/33966747/replace-a-record-if-it-exists-and-gracefully-fail-if-it-doesnt", "title": "Replace a record if it exists and gracefully fail if it doesn&#39;t?", "body": "<p>Persistent comes with two operations for wholesale replacement of records: <code>replace</code> and <code>repsert</code>. With <code>repsert</code>, a new record is inserted into the database if the record to be replaced did not originally exist. With <code>replace</code>, if the record to be replaced does not exist, <em>the behavior is undefined</em>.</p>\n\n<p>Both of these options are insufficient for my use-case: I want to replace a record if (and only if) a record already exists for that key. I <em>could</em> check if the record exists first and only attempt an insertion if this returns a record, but this seems like it would have the potential for race conditions (though admittedly such race conditions would be unlikely to have harmful effects in this case).</p>\n\n<p>Is there any function that attempts to do a replacement and returns a useful result depending on success or failure?</p>\n"}, {"tags": ["haskell", "input"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448660533, "post_id": 33965089, "comment_id": 55687645, "body": "are you sure you should use <code>type</code>? On Linux the <code>type</code> command means: <i>&quot;indicate how a command would be interpreted&quot;</i>. What about I/O redirect: <code>programma.exe &lt; invoer.txt</code> or <code>cat invoer.txt | programma.exe</code>?"}, {"owner": {"reputation": 79, "user_id": 3464048, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b5e81596cd52df434b0685816fb7eb0d?s=128&d=identicon&r=PG&f=1", "display_name": "StijnB", "link": "https://stackoverflow.com/users/3464048/stijnb"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448660827, "post_id": 33965089, "comment_id": 55687762, "body": "I&#39;m using windows, i thought i needed to use type. The commands you said did the same, it get stuck.  Thanks"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448660854, "post_id": 33965089, "comment_id": 55687776, "body": "What is the output of <code>type invoer.txt</code>? After all this is what you feed <code>programma.exe</code>..."}, {"owner": {"reputation": 79, "user_id": 3464048, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b5e81596cd52df434b0685816fb7eb0d?s=128&d=identicon&r=PG&f=1", "display_name": "StijnB", "link": "https://stackoverflow.com/users/3464048/stijnb"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448661070, "post_id": 33965089, "comment_id": 55687871, "body": "With the &quot;type invoer.txt&quot;, I get my txt file in my command screen."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448661272, "post_id": 33965089, "comment_id": 55687946, "body": "Well if I run the program with <code>runhaskell file.hs &lt; input</code>, I get output: <code>GEEN PRIEMGETAL GEVONDEN 2 2 241 GEEN PRIEMGETAL GEVONDEN 5 31 17 113 7333</code> (removed new lines). But it it taking some time (approx 20 seconds). I think it is not very efficient to calculate all <i>delers</i> first: from the moment you found another one, you can safely assume it is not a prime number."}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 0, "creation_date": 1448661323, "post_id": 33965089, "comment_id": 55687964, "body": "I get a similar thing from the command line inside ghci; the last input, <code>5200 7341</code> takes a while. But the rest works fast."}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 0, "creation_date": 1448661670, "post_id": 33965089, "comment_id": 55688073, "body": "...sorry,  not able to reproduce. <code>type invoer.txt | programma.exe</code> works fine on my machine. (Compiled using GHC version 7.6.3). On the bright side, it seems that the problem is not with your Haskell code."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448661741, "post_id": 33965089, "comment_id": 55688103, "body": "Well most shells allow IO redirection, so <code>programma.exe &lt; invoer.txt</code> should do the trick; unless something went wrong when compiling to <code>programma.txt</code>. You probably can also run it with the <code>runhaskell</code> interpreter."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448661925, "post_id": 33965089, "comment_id": 55688155, "body": "Furthermore when looking to the source code (since I&#39;m a Belgian, my native language is <i>Dutch</i>), I think this code is &quot;overdesigned&quot;."}, {"owner": {"reputation": 79, "user_id": 3464048, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b5e81596cd52df434b0685816fb7eb0d?s=128&d=identicon&r=PG&f=1", "display_name": "StijnB", "link": "https://stackoverflow.com/users/3464048/stijnb"}, "edited": false, "score": 2, "creation_date": 1448663490, "post_id": 33965089, "comment_id": 55688648, "body": "Thanks for the help.  I find it strange it don&#39;t work with me, I&#39;m running the .exe file now for around 10minutes and I get no return. So it&#39;s weird, I&#39;am already very happy it works with you guys.  I&#39;am new  to haskell, so I&#39;am trying to make some random excerses. Because I&#39;m new to this, I used functions and variables in my native language, wherefor my apologies. Next time, I have a problem, I will translate it all.  I will look and try to make my problem more efficient."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448664112, "post_id": 33965089, "comment_id": 55688829, "body": "@user3464048: If you can explain what you aim to do with <code>kleinsteVerschil...</code> we can perhaps improve the quality of the program."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448664487, "post_id": 33965089, "comment_id": 55688952, "body": "@user3464048: furthermore what happens if you use I/O redirection: <code>.&#47;programma.exe &lt; invoer.txt</code> instead?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1448668401, "last_edit_date": 1448668401, "creation_date": 1448664082, "answer_id": 33965636, "question_id": 33965089, "link": "https://stackoverflow.com/questions/33965089/haskell-input-with-txt-file/33965636#33965636", "title": "Haskell input with txt file", "body": "<p>Your program works, but is not that efficient and personally I find it not that elegant (sorry :S) because you introduce a lot of \"noise\". As a result it takes a lot of time before output is written.</p>\n\n<p>If I understand the problem statement correctly, each line (except the first), contains two integers, and you need to count the amount of prime numbers between these two numbers (bounds inclusive?)</p>\n\n<p>First of all, you can do this more elegantly by defining a function: <code>cPrime :: Int -&gt; Int -&gt; Int</code> that takes as input the two numbers and returns the amount of prime numbers:</p>\n\n<pre><code>cPrime :: Int -&gt; Int -&gt; Int\ncPrime a b = count $ filter isPrime [a .. b]\n</code></pre>\n\n<p>You can improve performance by improving your prime checking algorithm. First of all, you do not need to check whether <code>1</code> is a divisor, since <code>1</code> is always a divisor. Furthermore, you can prove mathematically that there is no divisor greater than <em>sqrt(n)</em> (except for <em>n</em>) that divides <em>n</em>; unless there is another divider that is smaller than <em>sqrt(n)</em>. So that means that you can simply enumerate all numbers between <code>2</code> and <code>sqrt n</code> and from the moment one of these is a divisor, you can stop: you have proven the number is not prime:</p>\n\n<pre><code>isPrime :: Int -&gt; Bool\nisPrime 1 = False\nisPrime 2 = True\nisPrime n = all ((0 /=) . mod n) (2:[3,5..m])\n    where m = floor $ sqrt $ fromIntegral n\n</code></pre>\n\n<p>Now I'm not sure what you aim to do with <code>kleinsteVerschilF</code>.</p>\n"}], "owner": {"reputation": 79, "user_id": 3464048, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b5e81596cd52df434b0685816fb7eb0d?s=128&d=identicon&r=PG&f=1", "display_name": "StijnB", "link": "https://stackoverflow.com/users/3464048/stijnb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1448668401, "creation_date": 1448660357, "last_edit_date": 1448660868, "question_id": 33965089, "link": "https://stackoverflow.com/questions/33965089/haskell-input-with-txt-file", "title": "Haskell input with txt file", "body": "<p>I am working on a program to get the closest prime number by the exponent of 2, this is between an interval.</p>\n\n<pre><code>module Main where\n\nimport Data.Char\nimport System.IO\nimport Control.Monad (liftM)\n\ndata PGetal =  G Bool | P Int\ninstance Show PGetal where\n          show (P n) = show n\n          show (G False) = \"GEEN PRIEMGETAL GEVONDEN\"\n\nmPriem::(Int, Int) -&gt; PGetal\nmPriem (x,y) | (x &gt; y) = G False\n         | (x &gt; 1000000) = G False\n         | (y &gt; 1000000) = G False\n         | (null (getAllPriem(x,y))) = G False\n         | otherwise = P (kleinsteVerschilF(getAllPriem(x,y),1000000,1))\n\n\nkleinsteVerschilF:: ([Int], Int , Int) -&gt; Int\nkleinsteVerschilF ([],_, priemGetal) = priemGetal\nkleinsteVerschilF (priem1:priemcss, kleinsteVerschil,priemGetal)=\n                                        if(kleinsteVerschil &lt;= kleinsteVerschilMetLijst (priem1,(getMachtenVanTwee(0)),1000000))then kleinsteVerschilF(priemcss, kleinsteVerschil,priemGetal)\n                                                                                                                          else kleinsteVerschilF (priemcss,kleinsteVerschilMetLijst(priem1,(getMachtenVanTwee(0)),1000000), priem1)\n\n\n\nkleinsteVerschilMetLijst :: (Int,[Int],Int) -&gt; Int\nkleinsteVerschilMetLijst ( _,[],kleinsteVerschil) = kleinsteVerschil\nkleinsteVerschilMetLijst (x,tweeMachten1:tweeMachtencss,kleinsteverschil)=\n                         if((abs(x-tweeMachten1)) &lt; kleinsteverschil)\n                                                  then kleinsteVerschilMetLijst(x,tweeMachtencss, (abs(x-tweeMachten1)))\n                                                  else kleinsteVerschilMetLijst(x,tweeMachtencss, kleinsteverschil)\n\n\ngetAllPriem :: (Int, Int) -&gt;[Int]\ngetAllPriem (x,y) = filter isPriem [x..y]\n\n\ngetMachtenVanTwee ::(Int) -&gt; [Int]\ngetMachtenVanTwee (macht)\n                  |(functieMachtTwee(macht)&lt; 1000000) = (functieMachtTwee(macht)) : (getMachtenVanTwee ((macht+1)))\n                  | otherwise = []\n\nfunctieMachtTwee:: (Int) -&gt; Int\nfunctieMachtTwee (x) = 2^x\n\n\nisPriem n = (aantalDelers n)==2\n\naantalDelers n = telAantalDelersVanaf n 1\ntelAantalDelersVanaf n kandidaatDeler\n  | n == kandidaatDeler       = 1\n  | mod n kandidaatDeler == 0\n      = 1 + telAantalDelersVanaf n (kandidaatDeler+1)\n  | otherwise\n      = telAantalDelersVanaf n (kandidaatDeler+1)\n\naantalDelers2 getal = telDelers getal 1 0\n  where telDelers n kandidaat teller\n          | n == kandidaat = 1+teller\n          | mod n kandidaat == 0\n              = telDelers n (kandidaat+1) (teller+1)\n          | otherwise\n              = telDelers n (kandidaat+1) teller\n\ntransform :: [String] -&gt; [PGetal]\ntransform [] = []\ntransform (cs:css) =\n  let (a : b: _ ) = words cs\n     in (mPriem ((read(a)),(read(b))): transform css)\n\nmain :: IO ()\nmain = do\n  n &lt;- read `liftM` getLine :: IO Int\n  lss &lt;- lines `liftM` getContents\n\n  let cases = take n lss\n  let vs = (transform (lss))\n\n  putStr $ unlines $ map show vs\n</code></pre>\n\n<p>When I use the mPriem function, it works fine.\nBut it needs to work with an input txt file, so I made a .exe file with the ghc command. I also added this .txt file in the folder.</p>\n\n<pre><code>10\n1 1\n1 3\n1 100\n200 250\n14 16\n5 10\n20 31\n16 50\n100 120\n5200 7341\n</code></pre>\n\n<p>When I use in command line this command, it does nothing. There is no output. I can't CTRL+C to stop the program, so I think it crashes. But I don't know what's wrong.</p>\n\n<pre><code>type invoer.txt | programma.exe\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1448663868, "post_id": 33964712, "comment_id": 55688768, "body": "Writing your problem clearly is a good first step to solving it. For instance:  &quot;<code>replicate&#39;</code> on a list <code>(x:xs)</code> is (the number <code>x</code> at the head of the list, repeated <code>x</code> times) prepended to (the tail of the list <code>replicate&#39;</code>-ed)&quot;. If we state the problem in a <i>declarative</i> way (by describing what our functions <i>are</i>) we end up with something we can translate directly into haskell (replace &quot;is&quot; with <code>=</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "edited": false, "score": 0, "creation_date": 1448659034, "post_id": 33964764, "comment_id": 55687112, "body": "It&#39;s not double them, it depends on the variable. Like <code>replicate&#39; [1,2,3]</code> would output <code>[1,2,2,3,3,3]</code>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1448659621, "post_id": 33964764, "comment_id": 55687296, "body": "@ig-melnyk Your <code>duplicate</code> function is equivalent to <code>replicate</code> (from the Prelude)."}, {"owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1448659704, "post_id": 33964764, "comment_id": 55687328, "body": "@Jubobs sure, I know. I think in that assignment it&#39;s not supposed to use library functions"}, {"owner": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "edited": false, "score": 0, "creation_date": 1448659830, "post_id": 33964764, "comment_id": 55687373, "body": "Ugh, why didn&#39;t I think of that? Thank you"}], "tags": [], "owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "is_accepted": true, "score": 3, "last_activity_date": 1448659522, "last_edit_date": 1448659522, "creation_date": 1448658244, "answer_id": 33964764, "question_id": 33964712, "link": "https://stackoverflow.com/questions/33964712/any-way-to-save-values-in-haskell/33964764#33964764", "title": "Any way to save values in Haskell?", "body": "<pre><code>replicate' [] = []\nreplicate' (x:xs) = x:x:replicate' xs\n</code></pre>\n\n<p>You can simply add two items immediately.</p>\n\n<pre><code>*Main&gt; replicate' [1,2,3]\n[1,1,2,2,3,3]\n</code></pre>\n\n<p><strong>UPD:</strong></p>\n\n<pre><code>duplicate::Int-&gt;Int-&gt;[Int]\nduplicate 0 x = []\nduplicate n x = x:duplicate (n-1) x\n\nreplicate' [] = []\nreplicate' (x:xs) = duplicate x x ++(replicate' xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1448659462, "last_edit_date": 1448659462, "creation_date": 1448658287, "answer_id": 33964768, "question_id": 33964712, "link": "https://stackoverflow.com/questions/33964712/any-way-to-save-values-in-haskell/33964768#33964768", "title": "Any way to save values in Haskell?", "body": "<blockquote>\n  <p>I know I have to save x into some other variable</p>\n</blockquote>\n\n<p>No, you don't.  This sentence indicates you have some misunderstanding.  I suggest you think about why you believe this is true and fix that understanding.</p>\n\n<p>As for your problem you have a good start showing you know about recursion, base cases, and basic syntax. Nice work.  The code you provided was:</p>\n\n<pre><code>replicate' [] = []\nreplicate' (x:xs)\n          | x == 1    = x: replicate' xs\n          | otherwise = x: replicate'(x-1:xs)\n</code></pre>\n\n<p>The base case is good, but why are you subtracting one from x? and why does it appear (again) in the replicate call?  Just think about the operation you want, there is no need for any arithmetic on the elements - you want to construct a list that repeats every element and the syntax is like <code>newelement : rest</code> - we can read <code>:</code> as \"cons\".  So your second case should be:</p>\n\n<pre><code>replicate' (x:xs) = x : x : replicate' xs\n</code></pre>\n\n<p>Edit again, since you've clarified that the elements are numbers that indicate how many times they must appear.  Well, the obvious solution is to use replicate (from base) as part of <code>replicate'</code>:</p>\n\n<pre><code>replicate' [] = []\nreplicate' (x:xs) = replicate x x ++ replicate' xs\n</code></pre>\n\n<p>In the above we replicate each element the number of times equal to the value of the element then concatenate that list, via <code>++</code>, to the recursive call.  A simpler version is:</p>\n\n<pre><code>replicate' = concatMap (\\x -&gt; replicate x x)\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; concatMap (\\x -&gt; replicate x x) [1..3]\n[1,2,2,3,3,3]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "edited": false, "score": 0, "creation_date": 1448659403, "post_id": 33964893, "comment_id": 55687209, "body": "This is what I&#39;m looking for, but for my assignment I don&#39;t know if we&#39;re allowed to use <code>take</code> or <code>repeat</code>. Is it possible to rewrite them in a recursive form maybe? It specifically says &quot;You may use a nested helper definition&quot; Works perfect btw"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1448659821, "post_id": 33964893, "comment_id": 55687368, "body": "You could replace <code>repeat&#39; n</code> by <code>replicate n n</code>. However, you might want to make the &quot;concatenate vanish&quot;, for better efficiency."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1448659677, "last_edit_date": 1448659677, "creation_date": 1448659037, "answer_id": 33964893, "question_id": 33964712, "link": "https://stackoverflow.com/questions/33964712/any-way-to-save-values-in-haskell/33964893#33964893", "title": "Any way to save values in Haskell?", "body": "<p>Based on your logic (but poor example) I'm guessing you want to repeat each element as many times the value indicates (<code>[2,3] -&gt; [2,2,3,3,3]</code>).</p>\n\n<p>You can write a <code>repeat'</code> function as <code>repeat' n = take n $ repeat n</code> and use in your replicate function</p>\n\n<pre><code>replicate' :: [Int] -&gt; [Int]\nreplicate' [] = []\nreplicate' (x:xs) = repeat' x ++ replicate' xs\n</code></pre>\n\n<p>UPDATE:</p>\n\n<p>You can write a repeat' function recursively as well, you need to use an auxiliary function to carry the additional count information.  Something like this should work</p>\n\n<pre><code> rep :: Int -&gt; [Int]\n rep x = rep' x x\n   where rep' x 0 = []\n         rep' x n = x: rep' x (n-1)\n</code></pre>\n\n<p>here instead of saving the state (count) you pass as a decreasing argument, similar to a loop count.</p>\n"}], "owner": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 828, "favorite_count": 0, "accepted_answer_id": 33964764, "answer_count": 3, "score": -3, "last_activity_date": 1448659677, "creation_date": 1448657983, "last_edit_date": 1448659000, "question_id": 33964712, "link": "https://stackoverflow.com/questions/33964712/any-way-to-save-values-in-haskell", "title": "Any way to save values in Haskell?", "body": "<p>I'm writing a very simple replicate function that takes a LIST of numbers and returns a list with each number duplicated. The replicate function that takes a value and an element is more trivial to me, since it doesn't require saving state.</p>\n\n<p>But in Haskell, I got this so far:</p>\n\n<pre><code>&gt; replicate' [] = []\n&gt; replicate' (x:xs)\n&gt;           | x == 1    = x: replicate' xs\n&gt;           | otherwise = x: replicate'(x-1:xs)\n</code></pre>\n\n<p>which is obviously wrong, since for <code>replicate' [2,2]</code>, it'd print <code>[2,1,2,1]</code> instead of <code>[2,2,2,2]</code></p>\n\n<p>I know I have to save x into some other variable and decrement it but I don't believe I know the syntax for that. </p>\n\n<p>Whoops, people got a little confused with the question.</p>\n\n<p>For example, a call <code>replicate' [2,3,1]</code>, should return <code>[2,2,3,3,3,1]</code>, not just <code>[2,2,3,3,1,1]</code>, like I think you guys are thinking</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1448663076, "last_edit_date": 1448663076, "creation_date": 1448652776, "answer_id": 33963815, "question_id": 33963740, "link": "https://stackoverflow.com/questions/33963740/haskell-cannot-match-type/33963815#33963815", "title": "Haskell cannot match type", "body": "<p>The only thing you can multiply by an <code>Int</code> using <code>*</code> is another <code>Int</code>. You need to either restrict your type signature to</p>\n\n<pre><code>moltiply :: QT Int -&gt; Int -&gt; QT Int\n</code></pre>\n\n<p>or generalize it to</p>\n\n<pre><code>moltiply :: Num a =&gt; QT a -&gt; a -&gt; QT a\n</code></pre>\n\n<p>or change the implementation to something like</p>\n\n<pre><code>moltiply :: (Num a, Integral b) =&gt; QT a -&gt; b -&gt; QT a\nmoltiply (C a) x = (C (a * fromIntegral x))\nmoltiply (Q a b c d) x = Q (moltiply a x) (moltiply b x) (moltiply c x) (moltiply d x)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 8, "last_activity_date": 1448665061, "last_edit_date": 1448665061, "creation_date": 1448652784, "answer_id": 33963817, "question_id": 33963740, "link": "https://stackoverflow.com/questions/33963740/haskell-cannot-match-type/33963817#33963817", "title": "Haskell cannot match type", "body": "<p>When you write </p>\n\n<pre><code>moltiply :: QT a -&gt; Int -&gt; QT a\n</code></pre>\n\n<p>you're telling GHC that this function will work with any type <code>a</code> inside your <code>QT</code> type, but then you write</p>\n\n<pre><code>moltiply (C a) x = (C (a * x))\n</code></pre>\n\n<p>and try to multiply the value <code>a</code> which can be of any type with an <code>Int</code>. This does not seem right does it?</p>\n\n<p>You can fix this in two ways:</p>\n\n<ol>\n<li><p>Ask GHCi what the most general type of <code>moltiply</code> is by removing the type signature and loading the file in GHCi:</p>\n\n<pre><code>\u03bb&gt; :t moltiply\nmoltiply :: Num a =&gt; QT a -&gt; a -&gt; QT a\n</code></pre>\n\n<p>Then you can add this type signature to your source file (good for documentation) or leave the function without a type signature.</p></li>\n<li><p>Stick to <code>Int</code> by saying that <code>moltiply</code> requires <code>QT</code> to contain an <code>Int</code>:</p>\n\n<pre><code>moltiply :: QT Int -&gt; Int -&gt; QT Int\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 935, "user_id": 3365063, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/f85ec976ad1f53d8d6e885a174d9e335?s=128&d=identicon&r=PG&f=1", "display_name": "zeb", "link": "https://stackoverflow.com/users/3365063/zeb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 33963817, "answer_count": 2, "score": 4, "last_activity_date": 1448665061, "creation_date": 1448652432, "question_id": 33963740, "link": "https://stackoverflow.com/questions/33963740/haskell-cannot-match-type", "title": "Haskell cannot match type", "body": "<p>I'm still a beginner with Haskell and I've this piece of code, but ghc doesn't compile and gives me an error</p>\n\n<p>This is the code:</p>\n\n<pre><code>data QT a = C a | Q (QT a) (QT a) (QT a) (QT a) deriving (Show)\n\nmoltiply :: QT a -&gt; Int -&gt; QT a\nmoltiply (C a) x = (C (a * x))\nmoltiply (Q a b c d) x = Q (moltiply a x) (moltiply b x) (moltiply c x) (moltiply d x)\n</code></pre>\n\n<p>And this is the error I get:</p>\n\n<pre><code>Couldn't match expected type \u2018a\u2019 with actual type \u2018Int\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for multiply :: QT a -&gt; Int -&gt; QT a\n          at file.hs:12:15\n    Relevant bindings include\n      a :: a (bound at file.hs:13:15)\n      multiply :: QT a -&gt; Int -&gt; QT a\n        (bound at file.hs:13:1)\n    In the second argument of \u2018(*)\u2019, namely \u2018x\u2019\n    In the first argument of \u2018C\u2019, namely \u2018(a * x)\u2019\n</code></pre>\n"}, {"tags": ["haskell", "let", "do-notation"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1448649256, "post_id": 33963063, "comment_id": 55683589, "body": "Mind you do not write <code>in</code>..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1448649694, "post_id": 33963063, "comment_id": 55683740, "body": "This is clearly an indentation problem, but I&#39;m not a sufficiently powerful indentation master to answer it without GHC in front of me."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1448652482, "post_id": 33963206, "comment_id": 55684767, "body": "I much prefer to lift <code>let</code>s out of <code>do</code> blocks whenever possible. <code>let x = ... in print x</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1448654498, "post_id": 33963206, "comment_id": 55685535, "body": "@dfeuer: Which is the default translation according to <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">3.14</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1448656842, "post_id": 33963206, "comment_id": 55686408, "body": "Oh, I know it does the same thing; I just prefer to pull out any <code>let</code>s that don&#39;t depend on the results of monadic actions, to make their independence visually obvious."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1616269943, "post_id": 33963206, "comment_id": 117951319, "body": "It\u2019s also possible to avoid having to align things like this by just putting a newline+indent after <code>let</code>, same as any other layout keyword like <code>do</code>, <code>of</code>, or <code>where</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 8, "last_activity_date": 1448650066, "last_edit_date": 1448650066, "creation_date": 1448649727, "answer_id": 33963206, "question_id": 33963063, "link": "https://stackoverflow.com/questions/33963063/monadic-do-notation-inside-let-is-it-possible/33963206#33963206", "title": "Monadic do notation inside let, is it possible?", "body": "<blockquote>\n  <p>Am I correct that inside <code>let</code> I am forced to resort to <code>(&gt;&gt;=)</code>?</p>\n</blockquote>\n\n<p>No:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let x = do\n      a &lt;- Just 3\n      b &lt;- Just 5\n      return (a, b)\n  print x\n</code></pre>\n\n<p>Haskell's <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3\">layout</a> rule dictates that the body of the binding <code>e</code> in <code>p = e</code> mus be intended at least as much as the beginning of <code>p</code> (or the first binding, if you're using multiple at once). Since <code>let</code> in <code>do</code> follows (almost) the same rules as <code>let \u2026 in</code>, you can verify this with the following function:</p>\n\n<pre><code>f :: Int\nf = \n  let x =\n    3 + 5\n  in x\n</code></pre>\n\n<p>This doesn't work, since <code>3 + 5</code> doesn't have the same or greater indentation level as <code>x</code>. However,</p>\n\n<pre><code>f :: Int\nf =\n  let x =\n       3 + 5\n  in x\n</code></pre>\n\n<p>works. Also, while the <code>main</code> above works, it doesn't really convey that <code>a</code> and <code>b</code> are things in <code>x</code>'s <code>do</code> block, so it's a little bit better to indent them slightly more:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let x = do\n        a &lt;- Just 3\n        b &lt;- Just 5\n        return (a, b)\n  print x\n</code></pre>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 33963206, "answer_count": 1, "score": 5, "last_activity_date": 1448650066, "creation_date": 1448649036, "question_id": 33963063, "link": "https://stackoverflow.com/questions/33963063/monadic-do-notation-inside-let-is-it-possible", "title": "Monadic do notation inside let, is it possible?", "body": "<p>Consider the following valid Haskell code</p>\n\n<pre><code>module Main where\n\nmain :: IO ()\nmain = do\n  let x = f\n  print x\n\nf :: Maybe (Int, Int)\nf =\n  Just 3 &gt;&gt;= (\\a -&gt;\n    Just 5 &gt;&gt;= (\\b -&gt;\n      return (a, b)))\n</code></pre>\n\n<p>where the function <code>f</code> can be rewritten equivalently with do-notation like this</p>\n\n<pre><code>f :: Maybe (Int, Int)\nf = do\n  a &lt;- Just 3\n  b &lt;- Just 5\n  return (a, b)\n</code></pre>\n\n<p>What annoys me, the do notation won't work when I put the contents of <code>f</code> inline. The following code does not even parse:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let x = do\n    a &lt;- Just 3\n    b &lt;- Just 5\n    return (a, b)\n  print x\n</code></pre>\n\n<p>Am I correct that inside <code>let</code> I am forced to resort to <code>(&gt;&gt;=)</code>?</p>\n\n<p>While I'm at it, the following code does not parse, either:</p>\n\n<pre><code>module Main where\n\nmain :: IO ()\nmain = do\n  let x =\n    Just 3 &gt;&gt;= (\\a -&gt;\n      Just 5 &gt;&gt;= (\\b -&gt;\n        return (a, b)))\n  print x\n</code></pre>\n\n<p>I don't see an obvious reason other than an unnecessary limited power of <code>let</code>. Is there an elegant way to use <code>bind</code> inside <code>let</code>?</p>\n"}, {"tags": ["haskell", "scrap-your-boilerplate"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1448647033, "post_id": 33962652, "comment_id": 55682685, "body": "for the record, what version of GHC are you using?"}, {"owner": {"reputation": 262, "user_id": 3935114, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e568cf9e13feb22225b1ef324949b3d7?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo Bonifacio", "link": "https://stackoverflow.com/users/3935114/rodrigo-bonifacio"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1448647074, "post_id": 33962652, "comment_id": 55682700, "body": "The Glorious Glasgow Haskell Compilation System, version 7.8.3"}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 3, "last_activity_date": 1448647221, "creation_date": 1448647221, "answer_id": 33962723, "question_id": 33962652, "link": "https://stackoverflow.com/questions/33962652/syb-libraries-functions/33962723#33962723", "title": "SYB Libraries functions", "body": "<p><a href=\"http://hayoo.fh-wedel.de/?query=mkT\" rel=\"nofollow\"><code>mkT</code></a> and <a href=\"http://hayoo.fh-wedel.de/?query=everywhere\" rel=\"nofollow\"><code>everywhere</code></a> are part of the <code>syb</code> package. I don't know that they've ever been part of base.</p>\n"}], "owner": {"reputation": 262, "user_id": 3935114, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e568cf9e13feb22225b1ef324949b3d7?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo Bonifacio", "link": "https://stackoverflow.com/users/3935114/rodrigo-bonifacio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 33962723, "answer_count": 1, "score": 1, "last_activity_date": 1448854886, "creation_date": 1448646913, "last_edit_date": 1448854886, "question_id": 33962652, "link": "https://stackoverflow.com/questions/33962652/syb-libraries-functions", "title": "SYB Libraries functions", "body": "<p>I've been working with some scrap-your-boilerplate functions for a while. Nevertheless, I tried to compile a module that imports <code>Data.Data</code> and <code>Data.Typeable</code>, though some functions like <code>everywhere</code> and <code>mkT</code> could not be found by the compiler. Where are these functions in the new versions of GHC? </p>\n"}, {"tags": ["haskell", "erlang", "idioms"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1448640292, "post_id": 33960957, "comment_id": 55679724, "body": "Any reason you want to use a list in erlang? Why not a <a href=\"http://www.erlang.org/doc/man/dict.html\" rel=\"nofollow noreferrer\">dict</a>? <code>update</code> seems the most economical way to do this."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1448640377, "post_id": 33960957, "comment_id": 55679776, "body": "Please don&#39;t ask for code review on Stack Overflow."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1448640398, "post_id": 33960957, "comment_id": 55679791, "body": "I&#39;m voting to close this question as off-topic because it is about code review."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1448640725, "post_id": 33960957, "comment_id": 55679934, "body": "Jubobs: perhaps move to <a href=\"http://codereview.stackexchange.com/\">codereview.stackexchange.com</a>"}, {"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 1, "creation_date": 1448640974, "post_id": 33960957, "comment_id": 55680043, "body": "Sorry guys. I&#39;m still relatively new to StackOverflow, I didn&#39;t know that you didn&#39;t do code review here. I&#39;ll move the question."}, {"owner": {"reputation": 12004, "user_id": 988678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a073cbc871c26b0fb4f1cc1f808e9749?s=128&d=identicon&r=PG", "display_name": "zxq9", "link": "https://stackoverflow.com/users/988678/zxq9"}, "edited": false, "score": 1, "creation_date": 1448646672, "post_id": 33960957, "comment_id": 55682531, "body": "@ChristopherDumas Post a link to the new version of the question, maybe in the erlang chatroom here on SO (not sure if moving the questions here makes them disappear). The Erlang community is pretty small, and I think I&#39;ve only seen Erlang questions really dealt with here on the main one, ever."}, {"owner": {"reputation": 25491, "user_id": 49197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15ebf24a33a29b9efbf9924f530dd736?s=128&d=identicon&r=PG", "display_name": "Hynek -Pichi- Vychodil", "link": "https://stackoverflow.com/users/49197/hynek-pichi-vychodil"}, "edited": false, "score": 0, "creation_date": 1448798774, "post_id": 33960957, "comment_id": 55721007, "body": "Moved to <a href=\"http://codereview.stackexchange.com/q/112057/15041\">Code Review</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 1, "creation_date": 1448650040, "post_id": 33962254, "comment_id": 55683891, "body": "wow. thats insane coding right there."}, {"owner": {"reputation": 13614, "user_id": 1635979, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pZRUz.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/1635979/pascal"}, "reply_to_user": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 0, "creation_date": 1448655184, "post_id": 33962254, "comment_id": 55685783, "body": "I agree that I didn&#39;t spent a lot of time to have a nice looking code :o). Nevertheless I think it should be more performant if the input proplist is big enough (need some benchmark to verify it)."}], "tags": [], "owner": {"reputation": 13614, "user_id": 1635979, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pZRUz.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/1635979/pascal"}, "is_accepted": false, "score": 1, "last_activity_date": 1448645100, "creation_date": 1448645100, "answer_id": 33962254, "question_id": 33960957, "link": "https://stackoverflow.com/questions/33960957/is-this-erlang-code-idiomatic/33962254#33962254", "title": "Is this Erlang code idiomatic?", "body": "<p>I would write it this way (tested in the shell with version >= 17), to limit the number of list creation/copy:</p>\n\n<pre><code>1&gt; F = fun F([],L,_)-&gt; L; F([{K,V}|T],[{K,V1}|T1],Func) -&gt; F(T,[{K,Func(V,V1)}|T1],Func); F([{K,V}|T],L,Func) -&gt; F(T,[{K,V}|L],Func) end.\n#Fun&lt;erl_eval.42.54118792&gt;\n2&gt; MR = fun(L,Func) -&gt; F(lists:sort(L),[],Func) end.                                                                                     \n#Fun&lt;erl_eval.12.54118792&gt;\n3&gt; MR([{1,2},{2,5},{1,6},{8,5},{2,1}],fun(A,B)-&gt; A+B end).                                                                               \n[{8,5},{2,6},{1,8}]\n4&gt; MR([{1,2},{2,5},{1,6},{8,5},{2,1}],fun(A,B)-&gt; A*B end).\n[{8,5},{2,5},{1,12}]\n5&gt; MR([{1,2},{2,5},{1,6},{8,5},{2,1}],fun(A,B)-&gt; max(A,B) end).\n[{8,5},{2,5},{1,6}]\n10&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25491, "user_id": 49197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15ebf24a33a29b9efbf9924f530dd736?s=128&d=identicon&r=PG", "display_name": "Hynek -Pichi- Vychodil", "link": "https://stackoverflow.com/users/49197/hynek-pichi-vychodil"}, "is_accepted": false, "score": 0, "last_activity_date": 1448664802, "last_edit_date": 1495540340, "creation_date": 1448659285, "answer_id": 33964930, "question_id": 33960957, "link": "https://stackoverflow.com/questions/33960957/is-this-erlang-code-idiomatic/33964930#33964930", "title": "Is this Erlang code idiomatic?", "body": "<p>More idiomatic Erlang would use pattern matching in function clause head <code>add_to_key({Key, Value}, Sum)</code> but when you are using <code>Data.Map</code> in Haskell you should use a similar key/value storage in Erlang as well. In pre R17 releases, it would be mostly <code>dict</code> but now we have maps as well. There is also not common to make extra function as <code>add_to_key/2</code> (Personally, I would prefer it, but it is not idiomatic.):</p>\n\n\n\n<pre class=\"lang-erlang prettyprint-override\"><code>map_reduce(L) -&gt;\n    F = fun({K, V}, M) -&gt;\n            maps:put(K, V + maps:get(K, M, 0), M)\n        end,\n    maps:to_list(lists:foldl(F, #{}, L)).\n</code></pre>\n\n<p>Anyway it would not be rare to use approach with sorting list as in <a href=\"https://stackoverflow.com/users/1635979/pascal\">Pascal</a>'s <a href=\"https://stackoverflow.com/a/33962254/49197\">answer</a>:</p>\n\n<pre class=\"lang-erlang prettyprint-override\"><code>map_reduce(L) -&gt;\n    F = fun({K, V1}, [{K, V2}|Acc]) -&gt;\n            [{K, V1 + V2}|Acc];\n           ({K, V}, Acc) -&gt;\n            [{K, V}|Acc]\n        end,\n    lists:foldl(F, [], lists:sort(L)).\n</code></pre>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "closed_date": 1448662131, "answer_count": 2, "score": -2, "last_activity_date": 1448664802, "creation_date": 1448639704, "question_id": 33960957, "link": "https://stackoverflow.com/questions/33960957/is-this-erlang-code-idiomatic", "closed_reason": "Not suitable for this site", "title": "Is this Erlang code idiomatic?", "body": "<p>I'm doing a comparison of Erlang, Haskell, Elixir and ES6, and I'm less farmiliar with Erlang and Elixir, but I want to represent all of these languages fairly, so is this good Erlang code?</p>\n\n<pre><code>-module(mapreduce).\n-export([map_reduce/1]).\n\nadd_to_key(KV, Sum) -&gt; {Key, Value} = KV,\n                       Tmp = proplists:get_value(Key, Sum, 0),\n                       Newlist = proplists:delete(Key, Sum),\n                       lists:append([{Key, Value + Tmp}], Newlist).\n\nmap_reduce(Pl) -&gt; lists:foldl(fun add_to_key/2, [], Pl).\n</code></pre>\n\n<p>- Thanks guys!</p>\n\n<p>By the way, if you guys want to see, here's the Haskell version:</p>\n\n<pre><code>module MapReduce where\nimport qualified Data.Map as M\n\nmapReduce :: [(String, Int)] -&gt; [(String, Int)]\nmapReduce = foldl addToKey []\n    where addToKey hl (k, v) = M.toList . M.insertWith (+) k v $ M.fromList hl\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 1301, "user_id": 5037799, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yhFaw.jpg?s=128&g=1", "display_name": "Richard Dally", "link": "https://stackoverflow.com/users/5037799/richard-dally"}, "edited": false, "score": 2, "creation_date": 1448639296, "post_id": 33960739, "comment_id": 55679160, "body": "What have you done so far ?"}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1448639217, "post_id": 33960793, "comment_id": 55679102, "body": "I think you read the problem specs wrong: you are given a list and needs to perform some kind of filtering operation on it if I understand it correctly."}, {"owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448639240, "post_id": 33960793, "comment_id": 55679119, "body": "sorry - just reread your post and you want to pass in a list, I&#39;ll leave the answer here for reference though"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1448639345, "post_id": 33960793, "comment_id": 55679193, "body": "was not my post, but anyway ;)."}, {"owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1448639423, "post_id": 33960793, "comment_id": 55679247, "body": "Haha - I think we commented at basically the same time ;)"}], "tags": [], "owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "is_accepted": false, "score": 0, "last_activity_date": 1448639089, "creation_date": 1448639089, "answer_id": 33960793, "question_id": 33960739, "link": "https://stackoverflow.com/questions/33960739/writing-a-recursive-inrange-function-in-haskell/33960793#33960793", "title": "Writing a recursive inRange function in haskell", "body": "<p>How about this?</p>\n\n<pre><code>inRange :: Int -&gt; Int -&gt; [Int]\ninRange x y | x == y = [x]\n            | x &lt; y = x : inRange (x + 1) y\n</code></pre>\n\n<p>You don't actually have to pass the list as a parameter for this</p>\n"}, {"comments": [{"owner": {"reputation": 37, "user_id": 5597193, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/795fb21f32a72075a327924717c0ff89?s=128&d=identicon&r=PG&f=1", "display_name": "condog", "link": "https://stackoverflow.com/users/5597193/condog"}, "edited": false, "score": 0, "creation_date": 1448639469, "post_id": 33960819, "comment_id": 55679275, "body": "Thanks, this solution is perfect! Thanks for making everything much clearer."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1448639476, "last_edit_date": 1448639476, "creation_date": 1448639170, "answer_id": 33960819, "question_id": 33960739, "link": "https://stackoverflow.com/questions/33960739/writing-a-recursive-inrange-function-in-haskell/33960819#33960819", "title": "Writing a recursive inRange function in haskell", "body": "<p>As always recursions consists out of two parts:</p>\n\n<ul>\n<li><p>one or more <strong>base cases</strong>, here for instance the empty list:</p>\n\n<pre><code>inRange _ _ [] = []\n</code></pre></li>\n<li><p>on or more <strong>recursive cases</strong> (or inductive cases). Evidently, this is the case when the list is <em>not</em> empty.</p></li>\n</ul>\n\n<p>Now for the latter, there are two options: either the first number of the list is in the range, or it is not. In case it is, we enumerate it, in case it is not, we do not enumerate:</p>\n\n<pre><code>inRange a b (x:xs) | a &lt;= x &amp;&amp; x &lt;= b = x : tl\n                   | otherwise = tl\n                   where tl = inRange a b xs\n</code></pre>\n\n<p>So the full implementation reads:</p>\n\n<pre><code>inRange a b (x:xs) | a &lt;= x &amp;&amp; x &lt;= b = x : tl\n                   | otherwise = tl\n                   where tl = inRange a b xs\ninRange _ _ _ = []\n</code></pre>\n\n<p>Here we have written the base case at the bottom: the advantage is that - at least conceptually - Haskell evaluates from top to bottom, and evidently it is less likely the list will be empty.</p>\n\n<p>Furthermore we can use don't cares (<code>_</code>) on all parameters such that we are certain all possible cases are covered and thus that the function is at least total (meaning for any kind of input, you will always receive output, although this evidently does not prove correctness).</p>\n"}], "owner": {"reputation": 37, "user_id": 5597193, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/795fb21f32a72075a327924717c0ff89?s=128&d=identicon&r=PG&f=1", "display_name": "condog", "link": "https://stackoverflow.com/users/5597193/condog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 33960819, "answer_count": 2, "score": 2, "last_activity_date": 1448639476, "creation_date": 1448638887, "question_id": 33960739, "link": "https://stackoverflow.com/questions/33960739/writing-a-recursive-inrange-function-in-haskell", "title": "Writing a recursive inRange function in haskell", "body": "<p>I've been given an exercise to write an inRange function via recursion ie: give two numbers (signifying the range) with a list and it should return a new list with all the numbers between those two, including the two supplied range numbers.</p>\n\n<p>obviously one of the base cases should be if the list is empty ie \ninRange a b []=[], however beyond this I'm completely lost. I've tried using guarded statements, however I'm still very lost.</p>\n"}, {"tags": ["haskell", "github", "travis-ci"], "answers": [{"comments": [{"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1448730250, "post_id": 33973362, "comment_id": 55704192, "body": "thanks for the hint! I actually tried running the exact same commands that travis runs on my machine, in a sandbox, and it works fine on my machine (or to be exact, it fails with a different error, but I know how to handle that one). That said, I use ghc 7.10 &amp; travis uses 7.4 and I don&#39;t understand why. I asked for 7.10 in my travis.yml. About your advice, I&#39;m not sure how could I ask travis to run different commands (eg configure to install for instance)."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1448771652, "post_id": 33973362, "comment_id": 55715078, "body": "I&#39;d recommend following one of these guides: <a href=\"https://github.com/hvr/multi-ghc-travis\" rel=\"nofollow noreferrer\">github.com/hvr/multi-ghc-travis</a> <a href=\"http://docs.haskellstack.org/en/stable/GUIDE.html#travis-with-caching\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/GUIDE.html#travis-with-cachi&zwnj;&#8203;ng</a>"}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1448825540, "post_id": 33973362, "comment_id": 55729695, "body": "there are several things. first I&#39;m on the legacy travis system, I guess I need to go on the new one. But that one requires much more thorough config I think. Second on the legacy system, ghc 7.10 is not supported: <a href=\"http://stackoverflow.com/questions/29516932/does-travis-ci-allow-ghc-versions-larger-than-7-8#comment55387942_29517437\" title=\"does travis ci allow ghc versions larger than 7 8%23comment55387942_29517437\">stackoverflow.com/questions/29516932/&hellip;</a> so I reverted to 7.8 for now. I may just give up as it seems it won&#39;t be a simple fix. Probably not worth it for an after-work project on which I&#39;m the sole contributor."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1448726512, "creation_date": 1448726512, "answer_id": 33973362, "question_id": 33960423, "link": "https://stackoverflow.com/questions/33960423/travis-haskell-builds-failing-with-linking-error/33973362#33973362", "title": "travis haskell builds failing with linking error", "body": "<p>In my experience, this is usually caused by having multiple versions of a library in your dependency tree, which <code>cabal configure</code> allows while <code>cabal install</code> will not. I don't see evidence of that in your build log, but it might theoretically be happening. You can try changing <code>cabal configure</code> to <code>cabal install</code> and see what happens.</p>\n"}, {"tags": [], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "is_accepted": true, "score": 0, "last_activity_date": 1449918275, "creation_date": 1449918275, "answer_id": 34239095, "question_id": 33960423, "link": "https://stackoverflow.com/questions/33960423/travis-haskell-builds-failing-with-linking-error/34239095#34239095", "title": "travis haskell builds failing with linking error", "body": "<p>So, first I'm on the legacy travis system, I guess I need to go on the new one. But that one requires much more thorough config I think. Second on the legacy system, ghc 7.10 is not supported: stackoverflow.com/questions/29516932/\u2026 I had configured 7.10 but didn't realize that didn't work, and since travis didn't recognize the ghc version, it just put me the oldest, 7.4. So I reverted to 7.8 for now, and the error is now different and more understandable.\nSo the root cause for weird error was being fallback to the relatively ancient ghc 7.4 due to my misconfiguration.</p>\n"}], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 34239095, "answer_count": 2, "score": 2, "last_activity_date": 1449918275, "creation_date": 1448637734, "question_id": 33960423, "link": "https://stackoverflow.com/questions/33960423/travis-haskell-builds-failing-with-linking-error", "title": "travis haskell builds failing with linking error", "body": "<p>for some time, the <a href=\"https://travis-ci.org/emmanueltouzery/cigale-timesheet/builds/93536873\" rel=\"nofollow\">travis builds</a> of my little haskell app are failing with a cryptic link error:</p>\n\n<pre><code>$ cabal configure --enable-tests &amp;&amp; cabal build &amp;&amp; cabal test\nResolving dependencies...\n[1 of 1] Compiling Main             ( Setup.hs, dist/setup/Main.o )\nLinking ./dist/setup/setup ...\n/usr/lib/ghc/unix-2.5.1.0/libHSunix-2.5.1.0.a(execvpe.o): In function `pPrPr_disableITimers':\n(.text+0x320): multiple definition of `pPrPr_disableITimers'\n/home/travis/.cabal/lib/x86_64-linux-ghc-7.4.1/unix-2.7.1.0/libHSunix-2.7.1.0.a(ghcrts.o):ghcrts.c:(.text+0x0): first defined here\ncollect2: ld returned 1 exit status\nThe command \"cabal configure --enable-tests &amp;&amp; cabal build &amp;&amp; cabal test\" exited with 1.\nDone. Your build exited with 1.\n</code></pre>\n\n<p>The builds work fine on my machine. Is there anything I can tune in my <a href=\"https://github.com/emmanueltouzery/cigale-timesheet/blob/master/.travis.yml\" rel=\"nofollow\">.travis.yml</a> file to fix the issue there?</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1448636320, "post_id": 33959274, "comment_id": 55677502, "body": "Why don&#39;t you just take <code>Lens s s a a</code> or simply <code>Simple Lens s a</code>?"}, {"owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 0, "creation_date": 1448636536, "post_id": 33959274, "comment_id": 55677621, "body": "Because I need to change the types of both the container and the values."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 5, "last_activity_date": 1448637855, "last_edit_date": 1448637855, "creation_date": 1448637750, "answer_id": 33960428, "question_id": 33959274, "link": "https://stackoverflow.com/questions/33959274/getting-value-with-a-lens-s-t-a-b/33960428#33960428", "title": "Getting value with a Lens s t a b", "body": "<p>The problem with using <code>^.</code> isn't <a href=\"http://hackage.haskell.org/package/lens-4.13/docs/src/Control-Lens-Getter.html#%5E.\" rel=\"nofollow\">its implementation</a>, but its type signature. If we lift its definition, we can use it for <code>f</code>:</p>\n\n<pre><code>f :: Lens s t a b -&gt; s -&gt; a \nf l s = getConst $ l Const s\n</code></pre>\n\n<p>This is most easily understood if you expand the definition of <code>Lens</code> : <code>forall (f :: * -&gt; *). Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1448644650, "post_id": 33960463, "comment_id": 55681683, "body": "I suspect the more generic signature makes type inference harder and thus necessitates some ugly signatures that <code>^.</code> doesn&#39;t require."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1448637880, "creation_date": 1448637880, "answer_id": 33960463, "question_id": 33959274, "link": "https://stackoverflow.com/questions/33959274/getting-value-with-a-lens-s-t-a-b/33960463#33960463", "title": "Getting value with a Lens s t a b", "body": "<p>There is a way.</p>\n\n<pre><code>f :: Lens s t a b -&gt; s -&gt; a\nf l s = getConst (l Const s)\n</code></pre>\n\n<p>This is also exactly the definition of <code>(^.)</code>. I'm not sure why the type of <code>(^.)</code> is restricted in this way, possibly just for simplicity.</p>\n"}], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 33960428, "answer_count": 2, "score": 4, "last_activity_date": 1448637880, "creation_date": 1448633692, "last_edit_date": 1448635122, "question_id": 33959274, "link": "https://stackoverflow.com/questions/33959274/getting-value-with-a-lens-s-t-a-b", "title": "Getting value with a Lens s t a b", "body": "<p>I would like write a function which turns a function (a -> b) into a function (s -> t) with the help of a Lens s t a b <strong>(edit: I realised that this function already exists with <code>Setter s t a b</code> and is called <code>over</code> or <code>%~</code>, but it doesn't answer the question below of using a Lens to get a value)</strong>. It seems simple, but I'm getting a confusing type error. To make an even more minimal example, consider the following function which simply returns the value extracted from the second argument by the lens:</p>\n\n<pre><code>f :: Lens s t a b -&gt; s -&gt; a\nf l s = s ^. l\n</code></pre>\n\n<p>This doesn't compile. There are 2 errors, both in the second argument of ^. (namely l):</p>\n\n<ul>\n<li>Couldn't match type 't' with 's'</li>\n<li>Couldn't match type 'a' with 'b'</li>\n</ul>\n\n<p>However, the following compiles:</p>\n\n<pre><code>f :: Getter s a -&gt; s -&gt; a\nf l s = s ^. l\n</code></pre>\n\n<p>Then, I realised that in the <a href=\"http://haddock.stackage.org/lts-3.8/lens-4.12.3/index.html\" rel=\"nofollow\">hierarchy of lens types</a>, the arrow between Lens and Getter specifies s=t, a=b. Is there no way to use a general <code>Lens s t a b</code> to get a value of type <code>a</code> from a value of type <code>s</code>?</p>\n"}, {"tags": ["haskell", "ambiguous", "explicit-specialization"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1448631510, "post_id": 33958506, "comment_id": 55674864, "body": "Is adding a <code>Proxy b</code> argument (or even <code>proxy b</code>) to <code>witness</code> an option?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 3, "creation_date": 1448632562, "post_id": 33958506, "comment_id": 55675428, "body": "Alternatively, is adding a functional dependency <code>a -&gt; b</code> an option?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1448633381, "post_id": 33958506, "comment_id": 55675852, "body": "Or change it to <code>witness :: Constant a b</code>"}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 4288267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11e0bea6e3bd4072485f0efdcfc1c262?s=128&d=identicon&r=PG&f=1", "display_name": "abitbol", "link": "https://stackoverflow.com/users/4288267/abitbol"}, "edited": false, "score": 0, "creation_date": 1449158402, "post_id": 33959366, "comment_id": 55894180, "body": "Thank you all! But what Constant and proxy type constructors are for?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 327, "user_id": 4288267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11e0bea6e3bd4072485f0efdcfc1c262?s=128&d=identicon&r=PG&f=1", "display_name": "abitbol", "link": "https://stackoverflow.com/users/4288267/abitbol"}, "edited": false, "score": 0, "creation_date": 1449165132, "post_id": 33959366, "comment_id": 55898772, "body": "They bring the <code>b</code> type into scope, so the compiler knows which instance of <code>Test a b</code> to use. If only <code>a</code> is in scope, it has no way of determining which instance to use, since there may be <code>Test a b</code> instances for multiple different <code>b</code>s, given an <code>a</code>."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1448634040, "last_edit_date": 1495539916, "creation_date": 1448634040, "answer_id": 33959366, "question_id": 33958506, "link": "https://stackoverflow.com/questions/33958506/specify-context-from-where-comes-term-in-haskell/33959366#33959366", "title": "Specify context from where comes term in Haskell", "body": "<p>Fleshing out <a href=\"https://stackoverflow.com/questions/33958506/specify-context-from-where-comes-term-in-haskell#comment55674864_33958506\">Joachim Breitner's suggestion</a>, you could use <code>witness</code> if you can alter its type signature to be <code>proxy b -&gt; a</code> argument or <code>Constant a b</code>.</p>\n\n<p>The two approaches are mostly equivalent, so it's a matter of preference:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nmodule SO33958506 where\n\nimport Data.Functor.Constant\nimport Data.Proxy\n\nclass Test a b where\n  constantWitness :: Constant a b\n  proxyWitness :: proxy b -&gt; a\n\nconstantWitnessWithProxy :: forall proxy a b. Test a b =&gt; proxy b -&gt; a\nconstantWitnessWithProxy _ = getConstant $ (constantWitness :: Constant a b)\n\nproxyWitnessAsConstant :: forall a b. Test a b =&gt; Constant a b\nproxyWitnessAsConstant = Constant $ proxyWitness (Proxy :: Proxy b)\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 4288267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11e0bea6e3bd4072485f0efdcfc1c262?s=128&d=identicon&r=PG&f=1", "display_name": "abitbol", "link": "https://stackoverflow.com/users/4288267/abitbol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1448634040, "creation_date": 1448631020, "question_id": 33958506, "link": "https://stackoverflow.com/questions/33958506/specify-context-from-where-comes-term-in-haskell", "title": "Specify context from where comes term in Haskell", "body": "<p>Here is a dummy example:</p>\n\n<pre><code>class Test a b where\n  witness :: a\n\nf :: Test a b =&gt; a\nf = witness\n</code></pre>\n\n<p>Haskell then say</p>\n\n<pre><code>Could not deduce (Test a b0) arising from a use of \u2018witness\u2019\nfrom the context (Test a b)\n  bound by the type signature for f :: Test a b =&gt; a\n  at test.hs:8:6-18\nThe type variable \u2018b0\u2019 is ambiguous\nRelevant bindings include f :: a (bound at test.hs:9:1)\nIn the expression: witness\nIn an equation for \u2018f\u2019: f = witness\n</code></pre>\n\n<p>Error comes from the fact that Haskell cannot infer type variable <code>b0</code> and a solution would be to remove parameter <code>b</code> from definition of the typeclass <code>Test</code>. But, in reality, I cannot. </p>\n\n<p>My question is : Does it exist a way to explicity identify <code>b0</code> with explicit parameter <code>b</code> given in line <code>f :: Test a b =&gt; a</code>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 1, "creation_date": 1448619202, "post_id": 33955026, "comment_id": 55667937, "body": "<code>getLine</code> is a built-in function in haskell, consider naming your variable something else? Also <code>do</code> notation doesn&#39;t need <code>{}</code>"}], "answers": [{"tags": [], "owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "is_accepted": false, "score": 0, "last_activity_date": 1448620058, "creation_date": 1448620058, "answer_id": 33955348, "question_id": 33955026, "link": "https://stackoverflow.com/questions/33955026/reading-line-by-line-in-haskell/33955348#33955348", "title": "Reading line by line in Haskell", "body": "<p>You may use the function <code>lines</code> to convert the String into [String]. Afterwards <code>map</code> your <code>foo</code> over this list of lines.</p>\n\n<p>Regarding the edit: Your program printing the length works for me. Try either inputting a file or - if entering input interactively - terminating it correctly (via Ctrl-d).</p>\n\n<p>Sidenote: curly brackets and semicolons are rarely seen usually. But this is just style.</p>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 2, "last_activity_date": 1448621452, "creation_date": 1448621452, "answer_id": 33955760, "question_id": 33955026, "link": "https://stackoverflow.com/questions/33955026/reading-line-by-line-in-haskell/33955760#33955760", "title": "Reading line by line in Haskell", "body": "<p>The main example of doing that will look as this:</p>\n\n<pre><code>main = do\n    line &lt;- getLine\n    yourfunction line\n    main\n</code></pre>\n\n<p>this will take lines forever and process them with your function, in case you want it to stop sometime, just check for a command for example:</p>\n\n<pre><code>main = do\n    line &lt;- getLine\n    let res = yourfunction line\n    if res == \"Exit\" then IO () else main\n</code></pre>\n"}], "owner": {"reputation": 842, "user_id": 1275924, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0998797102819c53fd6f5876bf975c92?s=128&d=identicon&r=PG", "display_name": "Artem", "link": "https://stackoverflow.com/users/1275924/artem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 608, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1448621452, "creation_date": 1448619001, "last_edit_date": 1448620197, "question_id": 33955026, "link": "https://stackoverflow.com/questions/33955026/reading-line-by-line-in-haskell", "title": "Reading line by line in Haskell", "body": "<p>I'm trying to read from standard input line by line, and process each line with the function of the type <code>foo :: String -&gt; Int</code>. Is there any way to do that provided that we don't know the number of lines we want to read OR given that the number of lines is provided on the first line?</p>\n\n<p><strong>What I've tried</strong>\nA lot of things that give meaningless errors, such as \"parser error\".\nFor example</p>\n\n<pre><code>main = do {\n    getLine &lt;- getContents;\n    let result = show (foo getLine);\n    putStrLn (foo result);\n}\n</code></pre>\n\n<p><strong>Edit</strong>\nStrange, but this does not print the length of a</p>\n\n<pre><code>main = do {\n    a &lt;- getContents;\n    putStrLn (show (length a));\n}\n</code></pre>\n\n<p>but, this does print 5.</p>\n\n<pre><code>main = do {\n    a &lt;- getContents;\n    putStrLn (show 5);\n}\n</code></pre>\n"}, {"tags": ["haskell", "io", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1448601713, "post_id": 33949602, "comment_id": 55659888, "body": "You can try searching for your type signature on Hoogle: <a href=\"http://haskell.org/hoogle\" rel=\"nofollow noreferrer\">haskell.org/hoogle</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448614475, "post_id": 33949602, "comment_id": 55664960, "body": "The signature you suggest implies <code>show</code> will be called anyway. Hence I can&#39;t understand the purpose of doing this. Did you, perhaps, want to save your data in a binary format instead?"}], "answers": [{"comments": [{"owner": {"reputation": 755, "user_id": 5323311, "user_type": "registered", "accept_rate": 74, "profile_image": "https://lh5.googleusercontent.com/-v8SDvlJNQBU/AAAAAAAAAAI/AAAAAAAAAD4/IT0tDo9PwT4/photo.jpg?sz=128", "display_name": "Tshimanga", "link": "https://stackoverflow.com/users/5323311/tshimanga"}, "edited": false, "score": 0, "creation_date": 1448837707, "post_id": 33953545, "comment_id": 55734002, "body": "I&#39;d mentioned this &quot;solution&quot; already. The problem with this is you end up with a file of Strings, not bare tuples. The reason for overloading the function with the class constraint is because in order to read from the file I figured it must be a showable type. That&#39;s probably more so just because of the file format I&#39;d not thought too hard about choosing carefully."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1448614434, "creation_date": 1448614434, "answer_id": 33953545, "question_id": 33949602, "link": "https://stackoverflow.com/questions/33949602/an-appendfile-function-for-non-string-inputs/33953545#33953545", "title": "an appendFile function for non-string inputs", "body": "<p>A <a href=\"https://www.haskell.org/hoogle/?hoogle=Show+a+%3D%3E+FilePath+-%3E+a+-%3E+IO+%28%29\" rel=\"nofollow\">quick hoogle search</a> reveals that there isn't a function with type <a href=\"http://hayoo.fh-wedel.de/?query=Show+a+%3D%3E+FilePath+-%3E+a+-%3E+IO+%28%29\" rel=\"nofollow\"><code>Show a =&gt; FilePath -&gt; a -&gt; IO ()</code></a>. However, it's not really hard to write it yourself:</p>\n\n<pre><code>showAppendFile :: Show a =&gt; FilePath -&gt; a -&gt; IO ()\nshowAppendFile p x = appendFile p (show x)\n</code></pre>\n"}], "owner": {"reputation": 755, "user_id": 5323311, "user_type": "registered", "accept_rate": 74, "profile_image": "https://lh5.googleusercontent.com/-v8SDvlJNQBU/AAAAAAAAAAI/AAAAAAAAAD4/IT0tDo9PwT4/photo.jpg?sz=128", "display_name": "Tshimanga", "link": "https://stackoverflow.com/users/5323311/tshimanga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1448614434, "creation_date": 1448592576, "question_id": 33949602, "link": "https://stackoverflow.com/questions/33949602/an-appendfile-function-for-non-string-inputs", "title": "an appendFile function for non-string inputs", "body": "<p>I want to write a file consisting of a list of tuples, but <code>appendFile</code> demands string inputs. I imagine I could just <code>show</code> or quote the tuples to stringify them and <code>read</code> them later; however, I'd like to just be able to save the list of n-tuples to skip the \"<code>show</code> now and <code>read</code> later\" part. Is there a <code>Show a=&gt;FilePath -&gt; a -&gt; IO ()</code> version of the <code>appendFile</code> function?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "edited": false, "score": 3, "creation_date": 1448599004, "post_id": 33949401, "comment_id": 55659229, "body": "<a href=\"https://www.haskell.org/cabal/proposal/x138.html\" rel=\"nofollow noreferrer\">haskell.org/cabal/proposal/x138.html</a> tells us that &quot;Each package has a globally-unique package name, containing no spaces. [...] How unique package names are handed out is not part of this specification [...].&quot; but there is also <a href=\"https://wiki.haskell.org/Hierarchical_module_names\" rel=\"nofollow noreferrer\">wiki.haskell.org/Hierarchical_module_names</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448614047, "post_id": 33949401, "comment_id": 55664749, "body": "I don&#39;t know if there&#39;s a written guide. I believe most developers choose the point in the current hackage hierarchy where the most similar libraries are found. Of course, exceptions exist: e.g. <code>Web</code> could have been <code>Network.Web</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448614311, "post_id": 33949401, "comment_id": 55664888, "body": "Some languages (e.g. Java) prod the developers in using separate namespaces as in <code>producer-name.a.b.c</code>. In Haskell this convention is surely not followed: every package usually grafts its modules in the existing hierarchy."}], "answers": [{"comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1546340110, "post_id": 33963034, "comment_id": 94827062, "body": "What about <code>Numeric</code>?"}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 6, "last_activity_date": 1448648892, "creation_date": 1448648892, "answer_id": 33963034, "question_id": 33949401, "link": "https://stackoverflow.com/questions/33949401/is-there-any-standard-module-namespace-naming-convention-in-haskell/33963034#33963034", "title": "Is there any standard module / namespace naming convention in haskell?", "body": "<p>The package name, the package tags, and the module names are all independent things.</p>\n\n<p>The package name is an arbitrary identifier (as long as it doesn't clash with anyone else). Its conventional to make it all lower case with hyphens between words. If several packages are part of a family then the format is e.g. \"llvm-base\" with the family name first. According to the Cabal manual package names can have letters, numbers and hyphens but not spaces. I don't know about any other punctuation, but I'd avoid it even if Cabal lets it through. Also thanks to the different rules about capital letters in pathnames between Windows and Linux there can be confusion, so its best to stick to lower case.</p>\n\n<p>The tags are used to help sites like Hackage organise the list of packages into useful groups, and have no other significance.</p>\n\n<p>Within a package will be one or more modules. These are what the client source code will import. Modules exist in a hierarchical name space. So for example the \"parsec\" package includes a module \"Text.Parsec.Combinator\". You can think of the dots as akin to Linux \"/\" in a path name (and in fact the source will be in a file at \"src/Text/Parsec/Combinator.hs\"). </p>\n\n<p>There are a few top-level conventional module names, such as \"Control\", \"Data\", \"Text\" and \"System\", which you can use according to the primary job of the module. Its good style to use them, but not obligatory. The appearance of the package name in the module name (e.g \"Parsec\") is only there to avoid name clashes; there is no formal relationship between the package name and the modules it holds.</p>\n\n<p>It is quite possible to have a package with modules in different top-level hierarchies. For instance you might have a package containing \"System.Foo\" and \"Data.Foo\".</p>\n\n<p>Broadly speaking \"Control\" is used for monads and related stuff, especially monadic and arrow combinators. But since a monad is also a data type you shouldn't feel the need to put a monadic type in a separate module just to get it into \"Control\".</p>\n\n<p>\"Data\" is a catch-all. If in doubt, put it in Data.</p>\n\n<p>\"System\" is used for operating system facilities, especially stuff that might not be portable.</p>\n\n<p>\"Text\" is used for manipulating text, parsing, printing and so on. Anything with a lot of string manipulation probably belongs here.</p>\n\n<p>\"Graphics\": obviously.</p>\n\n<p>Its optional to have a module name at one level and then other modules below it. So \"Text.Parsec\" is a module, and so is \"Text.Parsec.Combinators\", but the designer of Parsec did not need to include \"Text.Parsec\". When this is done it usually means that the top level module (in this case \"Text.Parsec\") exports a common subset of its child modules, so in many cases the client code just needs to import \"Text.Parsec\" rather than the whole family.</p>\n"}], "owner": {"reputation": 1719, "user_id": 4523477, "user_type": "registered", "accept_rate": 84, "profile_image": "https://lh4.googleusercontent.com/-w3FDa9MFDfo/AAAAAAAAAAI/AAAAAAAACKM/6aLKRIznz1w/photo.jpg?sz=128", "display_name": "June", "link": "https://stackoverflow.com/users/4523477/june"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1044, "favorite_count": 3, "accepted_answer_id": 33963034, "answer_count": 1, "score": 11, "last_activity_date": 1546317070, "creation_date": 1448590502, "last_edit_date": 1448609544, "question_id": 33949401, "link": "https://stackoverflow.com/questions/33949401/is-there-any-standard-module-namespace-naming-convention-in-haskell", "title": "Is there any standard module / namespace naming convention in haskell?", "body": "<p>I'm basically from python world and have been playing around with haskell for few days.</p>\n\n<p>As an python user, namespaces of libraries from hackage / stackage was the most confusing. </p>\n\n<p>For example, in python, we will import <code>Scotty</code> module like <code>import scotty</code>, while haskell will do <code>import Web.Scotty</code>.</p>\n\n<p>Haskellers who upload their libraries on stackage or hackage seems to prefer putting their libraries under namespaces of a category (e.g. <code>Web</code>, <code>Language</code>, ...).</p>\n\n<p>Leaving whether it's a good approach or not in perspective view of dependency control outside of discussion, is there any de-facto convention on this categorization? </p>\n\n<p>Is there any community-consented guide like \"Put these kind of libraries under <code>Network</code> category and put those kind of libraries under <code>Web</code> category or <code>Data</code> category.\" ?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1448573662, "post_id": 33946912, "comment_id": 55653495, "body": "Minor variants: we can use <code>intercalate &quot;, &quot;</code> instead. Also <code>(stared)</code> does not need parentheses. If this were an obfuscation contest, I&#39;d write <code>stared (c,star) = show c ++ [&#39;*&#39;|star]</code>, but I&#39;d frown a little to read that in actual code (and much in code suggested to beginners ;-))."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1448600913, "post_id": 33946912, "comment_id": 55659687, "body": "@chi thanks for the points (both good ones) - indeed the the <code>(...)</code> is just me editing the repeated line in GHCi (I saw/edited in the first occurrence but forgot the second) - <code>intercalate</code> I just forgot about ..."}, {"owner": {"reputation": 41, "user_id": 5609937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e45b59279056903ea3b256421f842267?s=128&d=identicon&r=PG&f=1", "display_name": "Luxzero", "link": "https://stackoverflow.com/users/5609937/luxzero"}, "edited": false, "score": 0, "creation_date": 1448645109, "post_id": 33946912, "comment_id": 55681861, "body": "Sorry if I was a bit ambigous, should have known better. Yes the* is in there because the second part of the tuple is true and the FavoriteList was not a typo but a data-constructor. Thank you very much!"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1448600799, "last_edit_date": 1448600799, "creation_date": 1448571611, "answer_id": 33946912, "question_id": 33946783, "link": "https://stackoverflow.com/questions/33946783/displaying-a-list-with-another-aspect/33946912#33946912", "title": "Displaying a list with another aspect", "body": "<p>assuming you are talking about</p>\n\n<pre><code>favoriteList :: [(Char, Bool)]\nfavoriteList = [('d',False), ('e',True), ('c',False)]\n</code></pre>\n\n<p>and you want a list <code>['d','e','c']</code> (I hope the <code>*</code> got there by accident)\nthen it's just</p>\n\n<pre><code>\u03bb&gt; map fst favoriteList\n\"dec\"\n</code></pre>\n\n<p>(where a list of characters is displayed as as string).</p>\n\n<hr>\n\n<p>assuming you want the <code>{...}</code> format then you have to work a bit more.\nUsing <code>Data.List.intersperse</code> to <em>weave</em> in the <code>\", \"</code>s and an additional <code>show</code> to get the <code>' '</code> you can do it with:</p>\n\n<pre><code>\u03bb&gt; import Data.List(intersperse)\n\u03bb&gt; \"{\" ++ (concat . intersperse \", \" $ map (show . fst) favoriteList) ++ \"}\"\n\"{'d', 'e', 'c'}\"\n</code></pre>\n\n<p>in case you are interested in the steps:</p>\n\n<pre><code>\u03bb&gt; map fst favoriteList\n\"dec\"\n\u03bb&gt; map (show . fst) favoriteList\n[\"'d'\",\"'e'\",\"'c'\"]\n\u03bb&gt; intersperse \", \" $ map (show . fst) favoriteList\n[\"'d'\",\", \",\"'e'\",\", \",\"'c'\"]\n\u03bb&gt; concat . intersperse \", \" $ map (show . fst) favoriteList\n\"'d', 'e', 'c'\"\n</code></pre>\n\n<p>the <code>\"{\" ++ (..) ++ \"}\"</code> should be obvious I hope</p>\n\n<hr>\n\n<p>assuming the <code>*</code> is in there because the second part of the tuple was <code>true</code> then you can do it like this:</p>\n\n<pre><code>\u03bb&gt; let stared (c,star) = if star then show c ++ \"*\" else show c\n\u03bb&gt; \"{\" ++ (concat . intersperse \", \" $ map stared favoriteList) ++ \"}\"\n\"{'d', 'e'*, 'c'}\"\n</code></pre>\n\n<hr>\n\n<p>further assuming the <code>FavoriteList</code> was not a typo but a data-constructor:</p>\n\n<pre><code>data FavoriteList = FavoriteList [(Char, Bool)]\n\nmyList :: FavoriteList\nmyList = FavoriteList [('d',False), ('e',True), ('c',False)]\n</code></pre>\n\n<p>it's</p>\n\n<pre><code>\u03bb&gt; let stared (c,star) = if star then show c ++ \"*\" else show c\n\u03bb&gt; let (FavoriteList xs) = myList in \"{\" ++ (concat . intersperse \", \" $ map (stared) xs) ++ \"}\"\n\"{'d', 'e'*, 'c'}\"\n</code></pre>\n\n<p>where I just used pattern-matching to get out the list again</p>\n\n<hr>\n\n<h3>complete code</h3>\n\n<pre><code>import Data.List(intercalate)\n\ndata FavoriteList = FavoriteList [(Char, Bool)]\n\nmyList :: FavoriteList\nmyList = FavoriteList [('d',False), ('e',True), ('c',False)]\n\nprintList :: FavoriteList -&gt; String\nprintList (FavoriteList xs) = \n  \"{\" ++ (intercalate \", \" $ map stared xs) ++ \"}\"\n  where  stared (c,star) = if star then show c ++ \"*\" else show c\n</code></pre>\n\n<p>(<strong>PS</strong>: as Chi pointed out I should have used <code>intercalate = concat . intersperse</code> instead)\nexample</p>\n\n<pre><code>\u03bb&gt; printList myList\n\"{'d', 'e'*, 'c'}\"\n</code></pre>\n\n<p>*I hope that was all ;) *</p>\n"}], "owner": {"reputation": 41, "user_id": 5609937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e45b59279056903ea3b256421f842267?s=128&d=identicon&r=PG&f=1", "display_name": "Luxzero", "link": "https://stackoverflow.com/users/5609937/luxzero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 33946912, "answer_count": 1, "score": 1, "last_activity_date": 1448600799, "creation_date": 1448570938, "question_id": 33946783, "link": "https://stackoverflow.com/questions/33946783/displaying-a-list-with-another-aspect", "title": "Displaying a list with another aspect", "body": "<p>I would like to know if it's possible for a list like this:</p>\n\n<pre><code>FavoriteList [('d',False), ('e',True), ('c',False)]\n</code></pre>\n\n<p>To be simply displayed like this:</p>\n\n<pre><code>{'d', 'e'*, 'c'}\n</code></pre>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1448559421, "post_id": 33944276, "comment_id": 55647796, "body": "The types don&#39;t really match. Your description states <code>([Int], Bool)</code>, your code <code>(Bool, [Int])</code>. Why not <code>Maybe [Int]</code>?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1448559522, "post_id": 33944276, "comment_id": 55647841, "body": "Use <code>Maybe</code> instead of a tuple."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1448559932, "post_id": 33944276, "comment_id": 55648032, "body": "By the way, <code>t1</code> doesn&#39;t even contain <code>7</code> or <code>9</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1448566128, "creation_date": 1448566128, "answer_id": 33945816, "question_id": 33944276, "link": "https://stackoverflow.com/questions/33944276/how-to-get-path-from-root-to-desired-node-i-e-includes-first-number-as-rooth-th/33945816#33945816", "title": "how to get path from root to desired node i.e. includes first number as rooth then child -&gt; child-&gt;upto parent of child", "body": "<p>Firstly, why is the path to 9 in the given tree equal to [1,3]? Should it not be [1,1] - you go down the 1st branch from 1 to 3, and then the 1st branch again from 3 to 9. </p>\n\n<p>Secondly, there may be 0 or more occurrences of any element in any tree - therefore, your function should return a list (which contains 0 or more occurrences of some type) of paths. You don't need an additional boolean - to check if there are no paths, check that the list is <code>null</code>. </p>\n\n<pre><code>type Path = [Int] \n\npaths :: Eq a =&gt; a -&gt; Tree a -&gt; [Path] \n</code></pre>\n\n<p>The function itself is quite simple at the correct type:</p>\n\n<pre><code>paths a = go where \n  go (Tree b ts) = \n    [ [] | a == b ] ++ \n    concat [ map (i:) (go t) | (i,t) &lt;- zip [0..] ts ]\n</code></pre>\n\n<p>The first line of <code>go</code> checks if the element <code>a</code> is at the root - if so, there is a path (namely the empty path) to that element. The second line checks the subtrees - first it associates each subtree with its index with <code>zip [0..]</code>, then it recurses on the subtree and extends each path in that subtree with the index of the subtree (<code>map (i:)</code>). </p>\n\n<p>And finally:</p>\n\n<pre><code>member :: Eq a =&gt; a -&gt; Tree a -&gt; Bool\nmember a t = not $ null $ paths a t\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5609452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/574e7bcfd383e65eddde7ced367abe77?s=128&d=identicon&r=PG&f=1", "display_name": "andy", "link": "https://stackoverflow.com/users/5609452/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1448566128, "creation_date": 1448558892, "last_edit_date": 1448559606, "question_id": 33944276, "link": "https://stackoverflow.com/questions/33944276/how-to-get-path-from-root-to-desired-node-i-e-includes-first-number-as-rooth-th", "title": "how to get path from root to desired node i.e. includes first number as rooth then child -&gt; child-&gt;upto parent of child", "body": "<pre><code>t1 = Tree 1[ Tree 2  [  Tree 4[],  Tree 5 []  ], Tree 3[Tree 6 []]]\n\n       1\n      / \\\n     /   \\\n    2    3\n   /\\    /\\\n  /  \\  /  \\\n 4   6  7   9\n</code></pre>\n\n<p>if asked for 9 it should return (True,[1,3]) (if exits)\nif doesnt exist the should return   (False,[])</p>\n\n<pre><code>data Tree = Tree Int [Tree]  deriving (Show , Eq)\n\nisPrsnt num (Tree nnum ls:xs) parents | (nnum==num) = (True,parents)  \n                                      | (fst (isPrsnt num( ls ) (parents ++[nnum])) == False) = isPrsnt nnum xs (init parents)   \n                                      | otherwise = isPrsnt nnum xs parents\n\n\nisPrsnt num ([]) parents = (False,parents)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 4, "creation_date": 1448558345, "post_id": 33943953, "comment_id": 55647309, "body": "the 2nd one is not valid Haskell."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1448566337, "post_id": 33943953, "comment_id": 55650645, "body": "The second case is almost valid syntax with <code>MultiWayIf</code>: <code>if | x &lt; y -&gt; x; | otherwise -&gt; y</code>. Of course if your <code>if</code> only has two branches, just use a regular <code>if</code>..."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 6, "last_activity_date": 1448558321, "creation_date": 1448558321, "answer_id": 33944112, "question_id": 33943953, "link": "https://stackoverflow.com/questions/33943953/whats-the-difference-between-these-haskell-function-definitions/33944112#33944112", "title": "What&#39;s the difference between these haskell function definitions?", "body": "<p>the reason the second one <em>don't work</em> is simply that the <em>syntax</em> is not valid Haskell.</p>\n\n<p><em>Guards</em>  (<code>| x &lt; y ..</code>) are no syntax replacement for <code>if</code> - they only work in specific places. For example here you have to use them like this:</p>\n\n<pre><code>mymin [a] = a\nmymin (x:y:xs)\n  | x &lt; y     = mymin (x:xs)\n  | otherwise = mymin (y:xs)\n</code></pre>\n\n<p>there is a very nice explanation on this in <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"noreferrer\">LYAH</a> (look for <strong>Guards, Guards!</strong>) in case you want to know more</p>\n"}], "owner": {"reputation": 85, "user_id": 4876147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d9fbf38e85bc452496b97fc15134fef?s=128&d=identicon&r=PG&f=1", "display_name": "HalfGod", "link": "https://stackoverflow.com/users/4876147/halfgod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 33944112, "answer_count": 1, "score": -3, "last_activity_date": 1448594144, "creation_date": 1448557716, "last_edit_date": 1448594144, "question_id": 33943953, "link": "https://stackoverflow.com/questions/33943953/whats-the-difference-between-these-haskell-function-definitions", "title": "What&#39;s the difference between these haskell function definitions?", "body": "<p>I don't really understand what the problem is with the second one...</p>\n\n<pre><code>--ver1\nmymin [a]=a\nmymin (x:y:xs) = mymin ((if x &lt; y then x else y):xs)\n\n--ver2\nmymin [a]=a\nmymin (x:y:xs) = mymin ((\n    | x&lt;y  x\n    | otherwise  y\n):xs)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1448556161, "post_id": 33936535, "comment_id": 55646125, "body": "There is no vanilla Haskell way. You need some fancy type manipulation to do this."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1448548326, "post_id": 33936676, "comment_id": 55641297, "body": "In fact, a point could be made that only 2-tuples should ever be used at all and everything bigger should be either a record or a list (with a variant type or heterogeneous)."}, {"owner": {"reputation": 8549, "user_id": 898400, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/USXuI.jpg?s=128&g=1", "display_name": "Riccardo T.", "link": "https://stackoverflow.com/users/898400/riccardo-t"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1448553102, "post_id": 33936676, "comment_id": 55644290, "body": "Could you point me to some reference explaining better this statement, please? It sounds interesting! Thanks!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1448554272, "post_id": 33936676, "comment_id": 55645009, "body": "Well, it&#39;s just that when you stay with pairs, all you need to build concise pipelines etc. is <code>fst</code>, <code>snd</code> and the arrow combinators <code>first</code>, <code>second</code>, <code>&amp;&amp;&amp;</code> and <code>***</code>. When you allow for bigger tuples, the number of helpers grows quadratically (if not exponentially), or else you need polymorphic signatures, which overcomplicate type inference. You can use lenses (<code>_1</code>, <code>_2</code>), but that quickly becomes confusing. Named record fields are much clearer, no matter if you use lenses or not. <i>If</i> you use bigger tuples, then <code>((a,b),c)</code> actually tends to be more convenient than <code>(a,b,c)</code>!"}, {"owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 0, "creation_date": 1448621527, "post_id": 33936676, "comment_id": 55669352, "body": "Thanks! Moved to HList, I wanted to make conversion without much additional work (adding new library), but end up there anyway"}], "tags": [], "owner": {"reputation": 8549, "user_id": 898400, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/USXuI.jpg?s=128&g=1", "display_name": "Riccardo T.", "link": "https://stackoverflow.com/users/898400/riccardo-t"}, "is_accepted": true, "score": 17, "last_activity_date": 1448535314, "last_edit_date": 1495535231, "creation_date": 1448534985, "answer_id": 33936676, "question_id": 33936535, "link": "https://stackoverflow.com/questions/33936535/generalized-tuple-reduce/33936676#33936676", "title": "Generalized tuple reduce", "body": "<p>It appears there are some solutions to similar problems (e.g., <a href=\"https://stackoverflow.com/questions/13436366/manipulating-arbitrary-tuples\">Manipulating &quot;arbitrary&quot; tuples</a>), but I'd strongly advise you to consider changing data types instead because tuples are not meant to be used in a context such as this one. Tuples are not meant to somehow iterate on the elements, but rather to pattern match against (a fixed number of) them.\nAn alternative could be an <a href=\"http://hackage.haskell.org/package/HList\" rel=\"nofollow noreferrer\">HList</a> data type, as mentioned in one of the answers to the question I linked you.</p>\n"}], "owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 33936676, "answer_count": 1, "score": 3, "last_activity_date": 1448535314, "creation_date": 1448534573, "question_id": 33936535, "link": "https://stackoverflow.com/questions/33936535/generalized-tuple-reduce", "title": "Generalized tuple reduce", "body": "<p>How can I write function that reduce n-tuple to (n-m)-tuple?</p>\n\n<p>For example, I have <code>(a, b, c, d, e)</code> and want to get <code>(a, b, c)</code>\nwhich is used like</p>\n\n<pre><code>let ntup  = (1, \"a\", \"b\", 5, \"c\")\n    nmtup = reduce ntup 3 \n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 5, "creation_date": 1448544150, "post_id": 33935835, "comment_id": 55638660, "body": "I have not used it myself, but it sounds very much like <code>lens</code>\u2019s <code>zoom</code>: <a href=\"http://hackage.haskell.org/package/lens-4.13/docs/Control-Lens-Zoom.html#v:zoom\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lens-4.13/docs/&hellip;</a>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1448558498, "post_id": 33935835, "comment_id": 55647374, "body": "That should be easy with dependent types, but not hasochistic."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1448562909, "post_id": 33935835, "comment_id": 55649260, "body": "<code>lens</code> + <a href=\"https://hackage.haskell.org/package/vinyl\" rel=\"nofollow noreferrer\"><code>vinyl</code></a> makes for a halfway decent hasochistic experience."}], "answers": [{"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1448559797, "post_id": 33943972, "comment_id": 55647968, "body": "Thanks, that\u2019s what I was aiming for :-)"}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": false, "score": 9, "last_activity_date": 1448557803, "creation_date": 1448557803, "answer_id": 33943972, "question_id": 33935835, "link": "https://stackoverflow.com/questions/33935835/mix-and-match-stateful-computations-within-the-state-monad/33943972#33943972", "title": "Mix and match stateful computations within the State monad", "body": "<p>You can do it by using zoom from <a href=\"http://hackage.haskell.org/package/lens-family-1.2.0/docs/Lens-Family2-State-Lazy.html#v:zoom\" rel=\"noreferrer\"><code>lens-family</code></a> or the <a href=\"http://hackage.haskell.org/package/lens-4.13/docs/Control-Lens-Zoom.html#v:zoom\" rel=\"noreferrer\"><code>lens</code></a> package with the <a href=\"http://hackage.haskell.org/package/tuple-lenses-0.1.0.2/docs/Data-Tuple-Lens.html\" rel=\"noreferrer\"><code>tuple-lenses</code></a> package: the simplified type of <code>zoom</code> is:</p>\n\n<pre><code>zoom :: Lens' s a -&gt; State a x -&gt; State s x\n</code></pre>\n\n<p>So <code>zoom</code> runs a computation using a smaller state. The <code>Lens</code> is used to specify the location of smaller state <code>a</code> inside the larger state <code>s</code>.</p>\n\n<p>With these two packages, you can run <code>g</code>, <code>h</code> and <code>i</code> as follows:</p>\n\n<pre><code>f :: State (A,B,C) x\nf = do\n  zoom _12 g -- _12 :: Lens' (A,B,C) (A,B)\n  zoom _23 h -- _23 :: Lens' (A,B,C) (B,C)\n  zoom _13 i -- _13 :: Lens' (A,B,C) (A,C)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4100, "user_id": 972499, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f0f65f88aac6e2a6d19e92950194955b?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/972499/jordan"}, "edited": false, "score": 0, "creation_date": 1449226941, "post_id": 33946180, "comment_id": 55925748, "body": "Common use case of mine: <code>f :: State (A, A) ()</code> and <code>g :: State A ()</code>. Within <code>f</code>, I want to be able to call <code>g</code> on either the first or the second piece of <code>f</code>&#39;s state. <code>g</code> should not know which of those two pieces is being passed into it. <code>g</code> should not even know it is part of a bigger application. But with the classy solution, <code>f</code> and <code>g</code> would have the same state type (a <code>Game</code> value) and use the same getters/setters to access any given piece of that state, right? While that lets me hide information from a function with few responsibilities, it seems to make my functions unreusable."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1448646879, "last_edit_date": 1448646879, "creation_date": 1448567963, "answer_id": 33946180, "question_id": 33935835, "link": "https://stackoverflow.com/questions/33935835/mix-and-match-stateful-computations-within-the-state-monad/33946180#33946180", "title": "Mix and match stateful computations within the State monad", "body": "<p>If you don't want to fuss around with tuples, you can use a \"classy\" approach with a record. There's some fancy Template Haskell to support this in the <code>lens</code> package, but you can also do it by hand. The idea is to create at least one class for each piece of the state:</p>\n\n<pre><code>class HasPoints s where\n  points :: Lens' s Int\n\nclass ReadsPoints s where\n  getPoints :: Getter s Int\n  default getPoints :: HasPoints s =&gt; Getter s Int\n  getPoints = points\n\nclass SetsPoints s where\n  setPoints :: Setter' s Int\n  ...\n</code></pre>\n\n<p>Then each function that manipulates the state will have a type signature like</p>\n\n<pre><code>fight :: (HasPoints s, ReadsHealth s) =&gt; StateT s Game Player\n</code></pre>\n\n<p>An action with this particular signature has full access to the points, and read-only access to the health.</p>\n"}], "owner": {"reputation": 4100, "user_id": 972499, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f0f65f88aac6e2a6d19e92950194955b?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/972499/jordan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 3, "answer_count": 2, "score": 14, "last_activity_date": 1448646879, "creation_date": 1448532711, "question_id": 33935835, "link": "https://stackoverflow.com/questions/33935835/mix-and-match-stateful-computations-within-the-state-monad", "title": "Mix and match stateful computations within the State monad", "body": "<p>The state of my program consists of three values, <code>a</code>, <code>b</code>, and <code>c</code>, of types <code>A</code>, <code>B</code>, and <code>C</code>. Different functions need access to different values. I want to write functions using the <code>State</code> monad so that each function can only access the pieces of the state that it needs to access.</p>\n\n<p>I have four functions of the following types:</p>\n\n<pre><code>f :: State (A, B, C) x\ng :: y -&gt; State (A, B) x\nh :: y -&gt; State (B, C) x\ni :: y -&gt; State (A, C) x\n</code></pre>\n\n<p>Here is how I call <code>g</code> within <code>f</code>:</p>\n\n<pre><code>f = do\n    -- some stuff\n    -- y is bound to an expression somewhere in here\n    -- more stuff\n    x &lt;- g' y\n    -- even more stuff\n\n    where g' y = do\n              (a, b, c) &lt;- get\n              let (x, (a', b')) = runState (g y) (a, b)\n              put (a', b', c)\n              return x\n</code></pre>\n\n<p>That <code>g'</code> function is an ugly piece of boilerplate that does nothing but bridge the gap between the types <code>(A, B, C)</code> and <code>(A, B)</code>. It is basically a version of <code>g</code> that operates on a 3-tuple state, but leaves the 3rd tuple item unchanged. I am looking for a way to write <code>f</code> without that boilerplate. Maybe something like this:</p>\n\n<pre><code>f = do\n    -- stuff\n    x &lt;- convert (0,1,2) (g y)\n    -- more stuff\n</code></pre>\n\n<p>Where <code>convert (0,1,2)</code> converts a computation of type <code>State (a, b) x</code> to type <code>State (a, b, c) x</code>. Likewise, for all types <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>:</p>\n\n<ul>\n<li><code>convert (2,0,1)</code> converts <code>State (c,a) x</code> to <code>State (a,b,c) x</code></li>\n<li><code>convert (0,1)</code> converts <code>State b x</code> to <code>State (a,b) x</code></li>\n<li><code>convert (0,2,1,0)</code> converts <code>State (c,b) x</code> to <code>State (a,b,c,d) x</code></li>\n</ul>\n\n<p><strong>My questions:</strong></p>\n\n<ol>\n<li>Is there a better solution than putting state values in tuples? I thought about using a monad transformer stack. However, I think that only works if, for any two functions <code>f</code> and <code>g</code>, either <code>F</code> \u2286 <code>G</code> or <code>G</code> \u2286 <code>F</code>, where <code>F</code> is the set of state values needed by <code>f</code> and <code>G</code> is the set of state values needed by <code>g</code>. Am I wrong about that? (Note that my example does not satisfy this property. For example, <code>G</code> = <code>{a, b}</code> and <code>H</code> = <code>{b, c}</code>. Neither is a subset of the other.)</li>\n<li>If there is no better way than tuples, then is there a good way to avoid the boilerplate I mentioned? I am even willing to write a file with a bunch of boilerplate functions (see below) as long as the file can be automatically generated once and then forgotten about. Is there a better way? (I have read about lenses, but their complexity, ugly syntax, enormous set of unnecessary features, and seeming reliance on Template Haskell are off-putting. Is that a misconception of mine? Can lenses solve my problem in a way that avoids those problems?)</li>\n</ol>\n\n<p>(The functions I mentioned would look something like this.)</p>\n\n<pre><code>convert_0_1_2 :: State (a, b) x -&gt; State (a, b, c) x\nconvert_0_1_2 f = do\n    (a, b, c) &lt;- get\n    let (x, (a', b')) = runState f (a, b)\n    put (a', b', c)\n    return x\n\nconvert_0_2_1_0 :: State (c, b) x -&gt; State (a, b, c, d) x\nconvert_0_2_1_0 f = do\n    (a, b, c, d) &lt;- get\n    let (x, (b', c')) = runState f (b, c)\n    put (a, b', c', d)\n    return x\n</code></pre>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1448525874, "post_id": 33933388, "comment_id": 55627064, "body": "it&#39;s one of these things that&#39;s hard from afar - but I don&#39;t think you need the <code>liftIO $ return row</code> at all - just <code>runDB $ get (toSqlKey recordId)</code> should be enough"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1448526180, "post_id": 33933388, "comment_id": 55627242, "body": "@Carsten Ah! You&#39;re quite right about that second point\u2014I was doing more before I stripped it down in an attempt to debug the issue. As for the code, I think this is pretty much everything that&#39;s relevant, given that it doesn&#39;t actually depend on any aspect of my model. Let me know if you need more context, but I was able to drop this into an isolated sandbox and reproduce the error pretty trivially."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1448526548, "post_id": 33933388, "comment_id": 55627424, "body": "would you mind trying something (it would take me some time to get everything into a sandbox): change <code>runDB</code> to just <code>SqlPersistT IO a -&gt; IO a</code> and remove the type-signature from <code>recordByKey</code> because I am really sure that this should work and it&#39;s most likely some of the nasty type stuff in there with the monad-transformers"}, {"owner": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "edited": false, "score": 0, "creation_date": 1448526672, "post_id": 33933388, "comment_id": 55627494, "body": "did you try <code>toPersistKey</code> from <code>Database.Persist.Base</code>?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "edited": false, "score": 0, "creation_date": 1448527266, "post_id": 33933388, "comment_id": 55627853, "body": "@JanGreve <code>Database.Persist.Base</code> doesn&#39;t seem to exist in any remotely recent version of persist...?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1448527403, "post_id": 33933388, "comment_id": 55627927, "body": "@Carsten I can&#39;t easily do that because <code>runSqlite</code> includes those monad transformers, so I don&#39;t really have control over that type."}, {"owner": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "edited": false, "score": 0, "creation_date": 1448527426, "post_id": 33933388, "comment_id": 55627943, "body": "@AlexisKing, oops. My bad. Sorry. Google had some deep link into a old haddock."}, {"owner": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "edited": false, "score": 0, "creation_date": 1448528041, "post_id": 33933388, "comment_id": 55628297, "body": "To test @Carstens hinch, could you remove the type signature and test if the inferencer can figure it out and if there is something wrong?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "edited": false, "score": 0, "creation_date": 1448528124, "post_id": 33933388, "comment_id": 55628363, "body": "@JanGreve yep that was the idea - and yep it works (in my experience that&#39;s the best way to use persistent: don&#39;t give signatures and look afterwards)"}, {"owner": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1448528237, "post_id": 33933388, "comment_id": 55628423, "body": "@Carsten That is mine, too :) Glad to see not being alien with that approach :)"}], "answers": [{"comments": [{"owner": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "edited": false, "score": 0, "creation_date": 1448528175, "post_id": 33934146, "comment_id": 55628390, "body": "Ah, I see, we have the same approach to complex type definitions;)"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1448528774, "post_id": 33934146, "comment_id": 55628787, "body": "Well, that&#39;s one way to do it... and probably the better way. As a result of this, though, I think I found out what the original problem was: <code>get</code> doesn&#39;t return a <code>Maybe (Entity Record)</code>, it returns a <code>Maybe Record</code>. After all that, <i>that</i> was the problem. Even with that knowledge, the error message is still incomprehensible, but hey, so it goes. :P"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1448528925, "post_id": 33934146, "comment_id": 55628888, "body": "Ohh, I see it now. The issue was that <code>PersistEntityBackend (Entity Record)</code> doesn&#39;t exist, but <code>PersistEntityBackend Record</code> does, and it is a <code>SqlBackend</code>. Thanks for your help!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1448529490, "post_id": 33934146, "comment_id": 55629275, "body": "no problem: happens to me all the time - don&#39;t judge me but for persistent and co. I let ghc-mod/emacs write the signatures (it&#39;s much smarter than me ^^)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1448528000, "creation_date": 1448528000, "answer_id": 33934146, "question_id": 33933388, "link": "https://stackoverflow.com/questions/33933388/fetch-a-persistent-record-given-its-integral-key/33934146#33934146", "title": "Fetch a Persistent record given its integral key?", "body": "<p>this works for me (may depend on the versions of your packages ... sadly):</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nmodule Stackoverlflow where\n\nimport Control.Monad.IO.Class (MonadIO, liftIO)\nimport Control.Monad.Logger(NoLoggingT)\nimport Control.Monad.Trans.Control (MonadBaseControl)\nimport Control.Monad.Trans.Resource (ResourceT)\nimport Data.Int (Int64)\nimport Data.Text (pack)\nimport Database.Persist.Class (ToBackendKey, get)\nimport Database.Persist.Sql (SqlBackend, SqlPersistT, toSqlKey)\nimport Database.Persist.Sqlite(runSqlite)\nimport Database.Persist.Types (Entity)\nimport System.Environment (getEnv)\n\nrunDB :: (MonadBaseControl IO m, MonadIO m) =&gt;\n        (SqlPersistT (NoLoggingT (ResourceT m))) a -&gt; m a\nrunDB actions = do\n  filename &lt;- liftIO $ getEnv \"SQLITE_FILENAME\"\n  runSqlite (pack filename) actions\n\ngetRecordByKey :: (MonadIO m, ToBackendKey SqlBackend val, MonadBaseControl IO m) =&gt;\n                 Int64 -&gt; m (Maybe val)\ngetRecordByKey recordId = runDB $ get (toSqlKey recordId)\n</code></pre>\n\n<p>as you can see I just added alot of types annotations (well GHC did after I removed the signatures and ask it to tell me ;))</p>\n\n<p>also note that I don't have your <code>Record</code> so you should easily be able to get rid of the <code>... val</code> stuff!</p>\n"}, {"tags": [], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "is_accepted": false, "score": 1, "last_activity_date": 1448803915, "creation_date": 1448803915, "answer_id": 33983364, "question_id": 33933388, "link": "https://stackoverflow.com/questions/33933388/fetch-a-persistent-record-given-its-integral-key/33983364#33983364", "title": "Fetch a Persistent record given its integral key?", "body": "<p>And what about making <code>Key record</code> directly an instance of <code>FromText</code>/<code>ToText</code> and use the keys in the URL directly?</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts               #-}\n{-# LANGUAGE UndecidableInstances               #-}\ninstance ToBackendKey SqlBackend record =&gt; FromText (Key record) where\n  fromText k = toSqlKey &lt;$&gt; fromText k\ninstance ToBackendKey SqlBackend record =&gt; ToText (Key record) where\n  toText = toText . fromSqlKey\n</code></pre>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 33934146, "answer_count": 2, "score": 0, "last_activity_date": 1448803915, "creation_date": 1448525284, "last_edit_date": 1495541710, "question_id": 33933388, "link": "https://stackoverflow.com/questions/33933388/fetch-a-persistent-record-given-its-integral-key", "title": "Fetch a Persistent record given its integral key?", "body": "<p>I'm trying to use Persistent with Servant, so I don't have the luxury of automatically parsing URL segments into Persistent keys. Instead, I've set up my routes to require an <code>Int64</code>, and I want to retrieve a record using that to perform primary key lookup.</p>\n\n<p><a href=\"https://stackoverflow.com/q/8639414/465378\">Everything I've found</a> <a href=\"https://stackoverflow.com/q/28068447/465378\">points to using <code>toSqlKey</code></a> to convert an integer to a key, so I tried to write a very simple function that would do that for me:</p>\n\n<pre><code>runDB :: (MonadBaseControl IO m, MonadIO m) =&gt; (SqlPersistT (NoLoggingT (ResourceT m))) a -&gt; m a\nrunDB actions = do\n  filename &lt;- liftIO $ getEnv \"SQLITE_FILENAME\"\n  runSqlite (pack filename) actions\n\ngetRecordByKey :: Int64 -&gt; IO (Maybe (Entity Record))\ngetRecordByKey recordId = runDB $ get (toSqlKey recordId)\n</code></pre>\n\n<p>Unfortunately, this didn't work; I got the following type error:</p>\n\n<pre><code>Couldn't match expected type \u2018PersistEntityBackend\n                                (Entity Record)\u2019\n            with actual type \u2018SqlBackend\u2019\nIn the second argument of \u2018($)\u2019, namely \u2018get (toSqlKey recordId)\u2019\nIn the expression: runDB $ get (toSqlKey recordId)\nIn an equation for \u2018getRecordByKey\u2019:\n    getRecordByKey recordId = runDB $ get (toSqlKey recordId)\n</code></pre>\n\n<p>I <em>sort of</em> understand this error\u2014I looked up the types for <code>get</code> and <code>toSqlKey</code>, and they include the relevant constraints:</p>\n\n<pre><code>get :: (MonadIO m, backend ~ PersistEntityBackend val, PersistEntity val) =&gt; Key val -&gt; ReaderT backend m (Maybe val)\ntoSqlKey :: ToBackendKey SqlBackend record =&gt; Int64 -&gt; Key record\n</code></pre>\n\n<p>If I understand correctly, <code>backend</code> and <code>PersistEntityBackend val</code> need to be the same type, but <code>toSqlKey</code> enforces the <code>SqlBackend</code> constraint, so the types mismatch. My intuition tells me that <code>PersistentEntityBackend (Entity Record)</code> <em>should be</em> <code>SqlBackend</code>, but evidently I'm wrong there. I don't know why or how, though.</p>\n\n<p>Anyway, I don't know if I'm right or wrong in that analysis, but either way, I'm not sure how to fix this or what the proper way of doing this is. How can/should I be getting a record from my database given an integer?</p>\n"}, {"tags": ["haskell", "indirection"], "answers": [{"comments": [{"owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "edited": false, "score": 0, "creation_date": 1448526979, "post_id": 33933202, "comment_id": 55627675, "body": "So, there is no way to unpack <code>T</code> to <code>T&#39;&#39;</code> i.e. remove two levels of constructors?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1448528322, "post_id": 33933202, "comment_id": 55628479, "body": "@Zeta Thanks for the edit. How did you produce those beautiful diagrams? TikZ? The <code>diagrams</code> library?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 6, "creation_date": 1448542105, "post_id": 33933202, "comment_id": 55637302, "body": "@Jubobs: I used <code>dot</code> aka GraphViz: <code>digraph {  node[shape=record];  con[label=&quot;U|&lt;f0&gt;&quot;];  p[label=&quot;&lt;p0&gt;P|&lt;p1&gt;|&lt;p2&gt;&quot;];  q[label=&quot;&lt;q0&gt;P|&lt;q1&gt;|&lt;q2&gt;&quot;];  i1[label=&quot;&lt;i1&gt;I#|Int#&quot;];  i2[label=&quot;&lt;i2&gt;I#|Int#&quot;];  i3[label=&quot;&lt;i3&gt;I#|Int#&quot;];  con:f0 -&gt; p:p0  p:p1 -&gt; i1:i1  p:p2 -&gt; q:q0  q:q1 -&gt; i2:i2  q:q2 -&gt; i3:i3 }</code>. Not really really what I would call best practice graphviz, but it did the job."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1448542557, "post_id": 33933202, "comment_id": 55637599, "body": "@Zeta Thanks for that."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "edited": false, "score": 0, "creation_date": 1448608207, "post_id": 33933202, "comment_id": 55662025, "body": "@AlexeyVagarenko It seems that polymorphic fields (e.g. <code>a</code> and <code>b</code> in the data declaration of <code>P</code>) cannot (<a href=\"https://ghc.haskell.org/trac/ghc/ticket/7647\" rel=\"nofollow noreferrer\">yet?</a>) be unpacked. I may be wrong, but I don&#39;t think you can unpack <code>T</code> so that it has the same memory footprint as <code>T&#39;&#39;</code>."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 26, "last_activity_date": 1448818576, "last_edit_date": 1448818576, "creation_date": 1448524529, "answer_id": 33933202, "question_id": 33931991, "link": "https://stackoverflow.com/questions/33931991/what-does-the-unpack-pragma-do-in-this-case/33933202#33933202", "title": "What does the UNPACK pragma do, in this case?", "body": "<p>The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/pragmas.html#unpack-pragma\" rel=\"noreferrer\">GHC documentation</a> describes the <code>UNPACK</code> pragma as follows:</p>\n\n<blockquote>\n  <p>The <code>UNPACK</code> indicates to the compiler that it should unpack the contents of a constructor field into the constructor itself, removing a level of indirection.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>How will datatype <code>T</code> be unpacked?</p>\n</blockquote>\n\n<p><code>data T = T (P Int Int)</code> corresponds to</p>\n\n<p><a href=\"https://i.stack.imgur.com/IdaU6.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/IdaU6.png\" alt=\"non-unpacked data\"></a></p>\n\n<p>Therefore, <code>data T = T {-# UNPACK #-} !(P Int Int)</code> corresponds to</p>\n\n<p><a href=\"https://i.stack.imgur.com/DEjSQ.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/DEjSQ.png\" alt=\"pair unpacked\"></a></p>\n\n<p>In plain English, <code>UNPACK</code> has unpacked the contents of constructor <code>P</code> into the field of constructor <code>T</code>, removing one level of indirection and one constructor header (<code>P</code>).</p>\n\n<p><code>data T = T {-# UNPACK #-} !(P Int Int)</code> isn't as \"compact\" as <code>data T'' = T'' Int# Int#</code>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/xRky8.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/xRky8.png\" alt=\"completely unpacked\"></a></p>\n\n<hr>\n\n<blockquote>\n  <p>What about</p>\n\n<pre><code>data U = U {-# UNPACK #-} !(P Int (P Int Int))\n</code></pre>\n  \n  <p>?</p>\n</blockquote>\n\n<p>Similarly, <code>data U = U (P Int (P Int Int))</code> corresponds to</p>\n\n<p><a href=\"https://i.stack.imgur.com/7L8mL.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/7L8mL.png\" alt=\"pair of pairs\"></a></p>\n\n<p>and <code>data U = U {-# UNPACK #-} !(P Int (P Int Int))</code> corresponds to</p>\n\n<p><a href=\"https://i.stack.imgur.com/VINBa.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/VINBa.png\" alt=\"unpacked pair of pairs\"></a></p>\n\n<p>In plain English, <code>UNPACK</code> has unpacked the contents of constructor <code>P</code> into the field of constructor <code>U</code>, removing one level of indirection and one constructor header (<code>P</code>).</p>\n\n<h1>Resources</h1>\n\n<ul>\n<li><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/pragmas.html#unpack-pragma\" rel=\"noreferrer\">GHC manual (section 7.22)</a></li>\n<li><a href=\"https://github.com/tibbe/talks/blob/master/zurihac-2015/slides.md\" rel=\"noreferrer\">Johann Tibell's ZuriHac 2015 slides</a></li>\n</ul>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1553, "favorite_count": 9, "accepted_answer_id": 33933202, "answer_count": 1, "score": 22, "last_activity_date": 1448818576, "creation_date": 1448519655, "last_edit_date": 1448790450, "question_id": 33931991, "link": "https://stackoverflow.com/questions/33931991/what-does-the-unpack-pragma-do-in-this-case", "title": "What does the UNPACK pragma do, in this case?", "body": "<p>I have trouble understanding how <code>UNPACK</code> works in Haskell.\nConsider, for example, the following data declarations:</p>\n\n<pre><code>data P a b = P !a !b\ndata T = T {-# UNPACK #-} !(P Int Int)\n</code></pre>\n\n<p>How will datatype <code>T</code> be unpacked? Will it be equivalent to</p>\n\n<pre><code>data T' = T' !Int !Int\n</code></pre>\n\n<p>or will the <code>Int</code>s be further unpacked:</p>\n\n<pre><code>data T'' = T'' Int# Int#\n</code></pre>\n\n<p>? What about</p>\n\n<pre><code>data U = U {-# UNPACK #-} !(P Int (P Int Int))\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1448509462, "post_id": 33930175, "comment_id": 55621163, "body": "What do you think the <i>type</i> of <code>isOfTypeFoo</code>? Also, that name is a misnomer because the <i>type</i> of <code>Foo x</code> is <code>MyType</code>. The function should really be named <code>isFoo</code> or similar."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1448509742, "post_id": 33930175, "comment_id": 55621226, "body": "You can write the desired function quite nicely with <code>LambdaCase</code>: <code>\\case { Foo _ -&gt; True; _ -&gt; False }</code>, you can of course use <code>foldl</code>, or you can write <code>all $ \\case { Foo _ -&gt; True; _ -&gt; False }</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1448513060, "post_id": 33930175, "comment_id": 55622073, "body": "@user2407038, <code>foldl</code> is inappropriate here. <code>foldr</code> would make good sense, or, as you mentioned, <code>all</code>."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1448514865, "post_id": 33930175, "comment_id": 55622640, "body": "@dfeuer Why is foldr better than foldl?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1448521282, "post_id": 33930175, "comment_id": 55625008, "body": "@MarkKaravan, <code>foldr</code> allows short-circuiting; <code>foldl</code> does not."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 1, "creation_date": 1448566272, "post_id": 33931364, "comment_id": 55650617, "body": "@MarkKaravan, there is no type check here. Haskell types are erased in compilation. You should stop thinking of what happens at runtime as checking for a type and start thinking of it as matching on constructors."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 1, "creation_date": 1448574064, "post_id": 33931364, "comment_id": 55653635, "body": "@MarkKaravan: In C terms, you essentially have <code>union MyType { int tag; struct { int tag; int *value; } as_foo; struct { int tag; string *value; } as_bar; };</code> and <code>case x of { Foo y -&gt; \u2026 }</code> is simply saying <code>if (x.tag == FOO_TAG) { y = x.as_foo.value; \u2026 }</code>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 10, "last_activity_date": 1448516608, "creation_date": 1448516608, "answer_id": 33931364, "question_id": 33930175, "link": "https://stackoverflow.com/questions/33930175/checking-all-values-in-a-list-have-a-specific-constructor/33931364#33931364", "title": "Checking all values in a list have a specific constructor", "body": "<p>You can start with writing the predicate for a single <code>MyType</code>:</p>\n\n<pre><code>isFoo :: MyType -&gt; Bool\nisFoo (Foo _) = True\nisFoo _       = False\n</code></pre>\n\n<p>then you can extend it to lists using <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#v:all\" rel=\"noreferrer\"><code>all</code></a>:</p>\n\n<pre><code>isAllFoo :: [MyType] -&gt; Bool\nisAllFoo = all isFoo\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "accepted_answer_id": 33931364, "answer_count": 1, "score": 2, "last_activity_date": 1448518402, "creation_date": 1448509085, "last_edit_date": 1448518402, "question_id": 33930175, "link": "https://stackoverflow.com/questions/33930175/checking-all-values-in-a-list-have-a-specific-constructor", "title": "Checking all values in a list have a specific constructor", "body": "<p>I have a function <code>myTest</code> that does a constructor check of all elements in a list.  It looks like this:</p>\n\n<pre><code>data MyType = Foo Int | Bar String deriving (Show, Read)\n\nmyThing :: [MyType]\nmyThing = [Foo 1, Foo 2, Foo 3, Bar \"fail\", Foo 5]\n\nmyTest :: [MyType] -&gt; Bool\nmyTest list = foldl (\\ acc x -&gt; if isOfTypeFoo x then acc else False) True list\n</code></pre>\n\n<p>I would like for <code>myTest</code> to return True if every element in the list is a <code>Foo</code>, but if there is one or more <code>Bar</code>, it returns False.  If I run <code>myTest myThing</code>, it should return <code>False</code>.</p>\n\n<p>What would the function <code>isOfTypeFoo</code> look like?  (Or is there a better way to do this?)</p>\n"}, {"tags": ["postgresql", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1448523863, "post_id": 33931427, "comment_id": 55626123, "body": "Unfortunately, list size is changeable during computation. I&#39;m using generic functions when it maybe 3, 4, 5, ... elements in list. I tried to convert list to tuple with TemplateHaskell, but we quasi-quotation can&#39;t be generated during execution, so again I need to know size beforehand"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1448524522, "post_id": 33931427, "comment_id": 55626400, "body": "Is it always the first column that is an <code>Int</code>, and the rest are always <code>String</code>s?"}, {"owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1448524778, "post_id": 33931427, "comment_id": 55626517, "body": "Maybe I can generate for example all conversion function from 1 to 10 in TH, and then dispatch them in execution? I think I don&#39;t have more than 10 columns tables, yet. But don&#39;t know how"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1448527730, "post_id": 33931427, "comment_id": 55628100, "body": "@FilipvanHoft: I wonder if you could use <code>(:.)</code> in that case, i.e. something like <code>[Int] :. [String]</code> for some <code>Int</code> and some <code>String</code> fields."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1448530838, "post_id": 33931427, "comment_id": 55630190, "body": "<a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.0.1/docs/Database-PostgreSQL-Simple.html#t\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/postgresql-simple-0.5.0.1/docs/&hellip;</a>&zwnj;&#8203;::."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1448516908, "creation_date": 1448516908, "answer_id": 33931427, "question_id": 33928848, "link": "https://stackoverflow.com/questions/33928848/postgresql-heterogeneous-insertion/33931427#33931427", "title": "PostgreSQL heterogeneous insertion", "body": "<p>If you have three columns with types <code>Int</code>, <code>String</code>, <code>String</code>, then you can't represent a row of this schema with <code>[String]</code>, you have to use <code>(Int, String, String)</code>. If you change <code>vals</code> to this type, it should work. </p>\n\n<p>Of course, this means your way of generating <code>vals</code> needs to change as well, since <code>map evalVal fields</code> only makes sense if the fields are all of the same type. But the details of this depend on what <code>evalVal</code> does.</p>\n"}], "owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1448516924, "creation_date": 1448498452, "last_edit_date": 1448516924, "question_id": 33928848, "link": "https://stackoverflow.com/questions/33928848/postgresql-heterogeneous-insertion", "title": "PostgreSQL heterogeneous insertion", "body": "<p>I have list like <code>[\"0\", \"s\", \"a\"]</code> which is generated in process of evaluating , that list should be inserted in PostgreSQL with <code>postgresql-simple</code> where first column is <code>bigint</code>, but when I'm using</p>\n\n<pre><code>let vals = map evalVal field :: [String] \nexecute conn query vals\n</code></pre>\n\n<p>I have error with wrong types conversion </p>\n\n<pre><code>Incompatible {errSQLType = \"int4\", errSQLTableOid = Just (Oid 25340),\n</code></pre>\n\n<p>How can I make library understand that first value is int? </p>\n"}, {"tags": ["haskell", "dsl", "language-design", "dependent-type"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1448498194, "post_id": 33928608, "comment_id": 55618504, "body": "You&#39;ll have to introduce a type-level environment (complete with a type-level representation of your variable names!), and construct a custom type for sequences of statements. It&#39;s an awful lot of work, and for pretty minor benefit compared to coding up the runtime check manually, but it can be done."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 4, "creation_date": 1448518553, "post_id": 33928608, "comment_id": 55623881, "body": "You might be able to get some ideas from this example of a scoped-typed embedding of STLC into Haskell: <a href=\"http://unsafePerform.IO/blog/2015-02-05-typed_embedding_of_stlc_into_haskell/\" rel=\"nofollow noreferrer\">unsafePerform.IO/blog/&hellip;</a>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1448518689, "post_id": 33928608, "comment_id": 55623930, "body": "In particular, check out how <code>TVar</code> works in that example: it statically ensures that a given variable reference is both in scope and well-typed."}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1448842978, "post_id": 33928608, "comment_id": 55735340, "body": "I understand your approach. But I&#39;d like to have a way in which I could write an assignment like this &quot;x&quot; := 1 and it checks statically that &quot;x&quot; is already defined and it has type Int. In your approach, I need to use variables using DeBruijn indexes, something that I would like to avoid, since my objective is to stay as close as possible to C code. I&#39;ve tried it on Coq (<a href=\"https://gist.github.com/rodrigogribeiro/9726fc290a0d671849c3\" rel=\"nofollow noreferrer\">gist.github.com/rodrigogribeiro/9726fc290a0d671849c3</a>) and Idris (<a href=\"https://gist.github.com/rodrigogribeiro/0a24bbf77ccb53b10f9a\" rel=\"nofollow noreferrer\">gist.github.com/rodrigogribeiro/0a24bbf77ccb53b10f9a</a>) without success. The problem is how to build a proof of list membership &quot;automagically&quot;."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1448850077, "post_id": 33928608, "comment_id": 55736878, "body": "@RodrigoRibeiro well if you&#39;re willing to venture into Idris/Agda, I have (perhaps unsurprisingly) another blog post for you where names on the frontend side are indeed <code>String</code>s: <a href=\"http://gergo.erdi.hu/blog/2013-05-01-simply_typed_lambda_calculus_in_agda,_without_shortcuts/\" rel=\"nofollow noreferrer\">gergo.erdi.hu/blog/&hellip;</a> ; in particular, see here for examples: <a href=\"http://gergo.erdi.hu/blog/2013-05-01-simply_typed_lambda_calculus_in_agda,_without_shortcuts/html/STLC.Examples.html#882\" rel=\"nofollow noreferrer\">gergo.erdi.hu/blog/&hellip;</a>"}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1448885339, "post_id": 33928608, "comment_id": 55752047, "body": "@Cactus: I liked how you represented DeBruijn like indexes using names thought the type Binder. Very nice solution! I&#39;ll try this in Idris. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1448849904, "last_edit_date": 1448849904, "creation_date": 1448849466, "answer_id": 33990488, "question_id": 33928608, "link": "https://stackoverflow.com/questions/33928608/typed-abstract-syntax-and-dsl-design-in-haskell/33990488#33990488", "title": "Typed abstract syntax and DSL design in Haskell", "body": "<p>You should know that your goals are quite lofty.  I don't think you will get very far treating your variables exactly as strings.  I'd do something slightly more annoying to use, but more practical.  Define a monad for your DSL, which I'll call <code>M</code>:</p>\n\n<pre><code>newtype M a = ...\n\ndata Exp a where\n    ... as before ...\n\ndata Var a  -- a typed variable\n\nassign :: Var a -&gt; Exp a -&gt; M ()\ndeclare :: String -&gt; a -&gt; M (Var a)\n</code></pre>\n\n<p>I'm not sure why you have <code>Exp a</code> for assignment and just <code>a</code> for declaration, but I reproduced that here.  The <code>String</code> in <code>declare</code> is just for cosmetics, if you need it for code generation or error reporting or something -- the identity of the variable should really not be tied to that name.  So it's usually used as</p>\n\n<pre><code>myFunc = do\n    foobar &lt;- declare \"foobar\" 42\n</code></pre>\n\n<p>which is the annoying redundant bit. Haskell doesn't really have a good way around this (though depending on what you're doing with your DSL, you may not need the string at all).</p>\n\n<p>As for the implementation, maybe something like</p>\n\n<pre><code>data Stmt = forall a. Assign (Var a) (Exp a)\n          | forall a. Declare (Var a) a\n\ndata Var a = Var String Integer  -- string is auxiliary from before, integer\n                                 -- stores real identity.\n</code></pre>\n\n<p>For <code>M</code>, we need a unique supply of names and a list of statements to output.</p>\n\n<pre><code>newtype M a = M { runM :: WriterT [Stmt] (StateT Integer Identity a) }\n    deriving (Functor, Applicative, Monad)\n</code></pre>\n\n<p>Then the operations as usually fairly trivial.</p>\n\n<pre><code>assign v a = M $ tell [Assign v a]\n\ndeclare name a = M $ do\n    ident &lt;- lift get\n    lift . put $! ident + 1\n    let var = Var name ident\n    tell [Declare var a]\n    return var\n</code></pre>\n\n<p>I've made a fairly large DSL for code generation in another language using a fairly similar design, and it scales well.  I find it a good idea to stay \"near the ground\",  just doing solid modeling without using too many fancy type-level magical features, and accepting minor linguistic annoyances.  That way Haskell's main strength -- it's ability to abstract -- can still be used for code in your DSL.</p>\n\n<p>One drawback is that everything needs to be defined within a <code>do</code> block, which can be a hinderance to good organization as the amount of code grows.  I'll steal <code>declare</code> to show a way around that:</p>\n\n<pre><code>declare :: String -&gt; M a -&gt; M a\n</code></pre>\n\n<p>used like</p>\n\n<pre><code>foo = declare \"foo\" $ do\n    -- actual function body\n</code></pre>\n\n<p>then your <code>M</code> can have as a component of its state a cache from names to variables, and the first time you <em>use</em> a declaration with a certain name you render it and put it in a variable (this will require a bit more sophisticated monoid than <code>[Stmt]</code> as the target of your <code>Writer</code>).  Later times you just look up the variable.  It does have a rather floppy dependence on uniqueness of names, unfortunately; an explicit model of namespaces can help with that but never eliminate it entirely.</p>\n"}, {"tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": false, "score": 1, "last_activity_date": 1469925673, "last_edit_date": 1469925673, "creation_date": 1448968537, "answer_id": 34019037, "question_id": 33928608, "link": "https://stackoverflow.com/questions/33928608/typed-abstract-syntax-and-dsl-design-in-haskell/34019037#34019037", "title": "Typed abstract syntax and DSL design in Haskell", "body": "<p>After seeing all the code by @Cactus and the Haskell suggestions by @luqui, I've managed to got a solution close to what I want in Idris. The complete code is available at the following gist:</p>\n\n<p>(<a href=\"https://gist.github.com/rodrigogribeiro/33356c62e36bff54831d\" rel=\"nofollow\">https://gist.github.com/rodrigogribeiro/33356c62e36bff54831d</a>)</p>\n\n<p>Some little things I need to fix in the previous solution:</p>\n\n<ol>\n<li>I don't know (yet) if Idris support integer literal overloading, what would be quite useful to build my DSL.</li>\n<li>I've tried to define in DSL syntax a prefix operator for program variables, but it didn't worked as I like. I've got a solution (in the previous gist) that uses a keyword --- use --- for variable access.</li>\n</ol>\n\n<p>I'll check this minor points with guys in Idris #freenode channel to see if these two points are possible. </p>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 5, "last_activity_date": 1469576064, "creation_date": 1469576064, "answer_id": 38601492, "question_id": 33928608, "link": "https://stackoverflow.com/questions/33928608/typed-abstract-syntax-and-dsl-design-in-haskell/38601492#38601492", "title": "Typed abstract syntax and DSL design in Haskell", "body": "<p>Given that my work focuses on related issues of scope and type safety being encoded at the type-level, I stumbled upon this old-ish question whilst googling around and thought I'd give it a try.</p>\n\n<p>This post provides, I think, an answer quite close to the original specification. The whole thing is surprisingly short once you have the right setup.</p>\n\n<p>First, I'll start with a sample program to give you an idea of what the end result looks like:</p>\n\n<pre><code>program :: Program\nprogram = Program\n  $  Declare (Var :: Name \"foo\") (Of :: Type Int)\n  :&gt; Assign  (The (Var :: Name \"foo\")) (EInt 1)\n  :&gt; Declare (Var :: Name \"bar\") (Of :: Type Bool)\n  :&gt; increment (The (Var :: Name \"foo\"))\n  :&gt; Assign  (The (Var :: Name \"bar\")) (ENot $ EBool True)\n  :&gt; Done\n</code></pre>\n\n<h1>Scoping</h1>\n\n<p>In order to ensure that we may only assign values to variables which have been declared before, we need a notion of scope.</p>\n\n<p><code>GHC.TypeLits</code> provides us with type-level strings (called <code>Symbol</code>) so we can very-well use strings as variable names if we want. And because we want to ensure type safety, each variable declaration comes with a type annotation which we will store together with the variable name. Our type of scopes is therefore: <code>[(Symbol, *)]</code>.</p>\n\n<p>We can use a type family to test whether a given <code>Symbol</code> is in scope and return its associated type if that is the case:</p>\n\n<pre><code>type family HasSymbol (g :: [(Symbol,*)]) (s :: Symbol) :: Maybe * where\n  HasSymbol '[]            s = 'Nothing\n  HasSymbol ('(s, a) ': g) s = 'Just a\n  HasSymbol ('(t, a) ': g) s = HasSymbol g s\n</code></pre>\n\n<p>From this definition we can define a notion of variable: a variable of type <code>a</code> in scope <code>g</code> is a symbol <code>s</code> such that <code>HasSymbol g s</code> returns <code>'Just a</code>. This is what the <code>ScopedSymbol</code> data type represents by using an existential quantification to store the <code>s</code>.</p>\n\n<pre><code>data ScopedSymbol (g :: [(Symbol,*)]) (a :: *) = forall s.\n  (HasSymbol g s ~ 'Just a) =&gt; The (Name s)\n\ndata Name (s :: Symbol) = Var\n</code></pre>\n\n<p>Here I am purposefully abusing notations all over the place: <code>The</code> is the constructor for the type <code>ScopedSymbol</code> and <code>Name</code> is a <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Proxy.html\" rel=\"noreferrer\"><code>Proxy</code></a> type with a nicer name and constructor. This allows us to write such niceties as:</p>\n\n<pre><code>example :: ScopedSymbol ('(\"foo\", Int) ': '(\"bar\", Bool) ': '[]) Bool\nexample = The (Var :: Name \"bar\")\n</code></pre>\n\n<h1>Statements</h1>\n\n<p>Now that we have a notion of scope and of well-typed variables in that scope, we can start considering the effects <code>Statement</code>s should have. Given that new variables can be declared in a <code>Statement</code>, we need to find a way to propagate this information in the scope. The key hindsight is to have two indices: an input <em>and</em> an output scope.</p>\n\n<p>To <code>Declare</code> a new variable together with its type will expand the current scope with the pair of the variable name and the corresponding type.</p>\n\n<p><code>Assign</code>ments on the other hand do not modify the scope. They merely associate a <code>ScopedSymbol</code> to an expression of the corresponding type.</p>\n\n<pre><code>data Statement (g :: [(Symbol, *)]) (h :: [(Symbol,*)]) where\n  Declare :: Name s -&gt; Type a -&gt; Statement g ('(s, a) ': g)\n  Assign  :: ScopedSymbol g a -&gt; Exp g a -&gt; Statement g g\n\ndata Type (a :: *) = Of\n</code></pre>\n\n<p>Once again we have introduced a proxy type to have a nicer user-level syntax. </p>\n\n<pre><code>example' :: Statement '[] ('(\"foo\", Int) ': '[])\nexample' = Declare (Var :: Name \"foo\") (Of :: Type Int)\n\nexample'' :: Statement ('(\"foo\", Int) ': '[]) ('(\"foo\", Int) ': '[])\nexample'' = Assign (The (Var :: Name \"foo\")) (EInt 1)\n</code></pre>\n\n<p><code>Statement</code>s can be chained in a scope-preserving way by defining the following GADT of type-aligned sequences:</p>\n\n<pre><code>infixr 5 :&gt;\ndata Statements (g :: [(Symbol, *)]) (h :: [(Symbol,*)]) where\n  Done :: Statements g g\n  (:&gt;) :: Statement g h -&gt; Statements h i -&gt; Statements g i\n</code></pre>\n\n<h1>Expressions</h1>\n\n<p>Expressions are mostly unchanged from your original definition except that they are now scoped and a new constructor <code>EVar</code> lets us dereference a previously-declared variable (using <code>ScopedSymbol</code>) giving us an expression of the appropriate type.</p>\n\n<pre><code>data Exp (g :: [(Symbol,*)]) (t :: *) where\n  EVar    :: ScopedSymbol g a -&gt; Exp g a\n  EBool   :: Bool -&gt; Exp g Bool\n  EInt    :: Int  -&gt; Exp g Int\n  EAdd    :: Exp g Int -&gt; Exp g Int -&gt; Exp g Int\n  ENot    :: Exp g Bool -&gt; Exp g Bool\n</code></pre>\n\n<h1>Programs</h1>\n\n<p>A <code>Program</code> is quite simply a sequence of statements starting in the empty scope. We use, once more, an existential quantification to hide the scope we end up with.</p>\n\n<pre><code>data Program = forall h. Program (Statements '[] h)\n</code></pre>\n\n<p>It is obviously possible to write subroutines in Haskell and use them in your programs. In the example, I have the very simple <code>increment</code> which can be defined like so:</p>\n\n<pre><code>increment :: ScopedSymbol g Int -&gt; Statement g g\nincrement v = Assign v (EAdd (EVar v) (EInt 1))\n</code></pre>\n\n<p>I have uploaded the whole code snippet together with the right <code>LANGUAGE</code> pragmas and the examples listed here <a href=\"https://gist.github.com/gallais/12e5ff1015fd28a6fce8c693f8b59a3d\" rel=\"noreferrer\">in a self-contained gist</a>. I haven't however included any comments there.</p>\n"}], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 868, "favorite_count": 5, "accepted_answer_id": 38601492, "answer_count": 3, "score": 4, "last_activity_date": 1469925673, "creation_date": 1448496597, "question_id": 33928608, "link": "https://stackoverflow.com/questions/33928608/typed-abstract-syntax-and-dsl-design-in-haskell", "title": "Typed abstract syntax and DSL design in Haskell", "body": "<p>I'm designing a DSL in Haskell and I would like to have an assignment operation. Something like this (the code below is just for explaining my problem in a limited context, I didn't have type checked Stmt type):</p>\n\n<pre><code> data Stmt = forall a . Assign String (Exp a) -- Assignment operation\n           | forall a. Decl String a          -- Variable declaration \n data Exp t where\n    EBool   :: Bool -&gt; Exp Bool\n    EInt    :: Int  -&gt; Exp Int\n    EAdd    :: Exp Int -&gt; Exp Int -&gt; Exp Int\n    ENot    :: Exp Bool -&gt; Exp Bool\n</code></pre>\n\n<p>In the previous code, I'm able to use a GADT to enforce type constraints on expressions. My problem is how can I enforce that the left hand side of an assignment is: 1) Defined, i.e., a variable must be declared before it is used and 2) The right hand side must have the same type of the left hand side variable?</p>\n\n<p>I know that in a full dependently typed language, I could define statements indexed by some sort of typing context, that is, a list of defined variables and their type. I believe that this would solve my problem. But, I'm wondering if there is some way to achieve this in Haskell.</p>\n\n<p>Any pointer to example code or articles is highly appreciated.</p>\n"}]