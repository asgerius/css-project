[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 8126, "user_id": 562388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d71e7de62f17824c666db0405ccf60c7?s=128&d=identicon&r=PG", "display_name": "alf", "link": "https://stackoverflow.com/users/562388/alf"}, "edited": false, "score": 2, "creation_date": 1464809539, "post_id": 37577227, "comment_id": 62641438, "body": "Try printing out <code>maxi</code> on each iteration; that should give you a hint. Besides, I don&#39;t think you&#39;re using Haskell the best way."}, {"owner": {"reputation": 29, "user_id": 5653481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563aa3a76ad0c7b292e5c912f5e20af4?s=128&d=identicon&r=PG", "display_name": "SoldierKB", "link": "https://stackoverflow.com/users/5653481/soldierkb"}, "reply_to_user": {"reputation": 8126, "user_id": 562388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d71e7de62f17824c666db0405ccf60c7?s=128&d=identicon&r=PG", "display_name": "alf", "link": "https://stackoverflow.com/users/562388/alf"}, "edited": false, "score": 0, "creation_date": 1464809634, "post_id": 37577227, "comment_id": 62641490, "body": "How can I pring int value in <b>hPutStrLn stderr ...</b>? Yes, I know I&#39;m not usuing it the best way, I&#39;m just trying it :)."}, {"owner": {"reputation": 8126, "user_id": 562388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d71e7de62f17824c666db0405ccf60c7?s=128&d=identicon&r=PG", "display_name": "alf", "link": "https://stackoverflow.com/users/562388/alf"}, "edited": false, "score": 6, "creation_date": 1464809656, "post_id": 37577227, "comment_id": 62641504, "body": "The point is, those aren&#39;t &quot;variables&quot; in that they don&#39;t <i>vary.</i> Those are values, and the scope is limited to the <code>do</code> operator you&#39;re currently in."}, {"owner": {"reputation": 29, "user_id": 5653481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563aa3a76ad0c7b292e5c912f5e20af4?s=128&d=identicon&r=PG", "display_name": "SoldierKB", "link": "https://stackoverflow.com/users/5653481/soldierkb"}, "reply_to_user": {"reputation": 8126, "user_id": 562388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d71e7de62f17824c666db0405ccf60c7?s=128&d=identicon&r=PG", "display_name": "alf", "link": "https://stackoverflow.com/users/562388/alf"}, "edited": false, "score": 0, "creation_date": 1464809929, "post_id": 37577227, "comment_id": 62641650, "body": "How can I do it then?"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 2, "creation_date": 1464812707, "post_id": 37577227, "comment_id": 62643107, "body": "You should pick up a book like <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">LYAH</a> and learn how to write programs functionally. If you&#39;re coming from an imperative language, you may have picked up the (bad) habit of relying on the mutability of the references and the data structures in your program. When you write in Haskell, you just have to kick this bad habit; you have to start thinking in ways that respect the immutability of the things you name. I came to Haskell from Java/Scala, and let me tell you, thinking functionally takes some time (but it&#39;s worth it). LYAH will get you started."}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 5653481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563aa3a76ad0c7b292e5c912f5e20af4?s=128&d=identicon&r=PG", "display_name": "SoldierKB", "link": "https://stackoverflow.com/users/5653481/soldierkb"}, "edited": false, "score": 0, "creation_date": 1464813570, "post_id": 37577644, "comment_id": 62643563, "body": "How can I create an empty list?"}, {"owner": {"reputation": 8126, "user_id": 562388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d71e7de62f17824c666db0405ccf60c7?s=128&d=identicon&r=PG", "display_name": "alf", "link": "https://stackoverflow.com/users/562388/alf"}, "reply_to_user": {"reputation": 29, "user_id": 5653481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563aa3a76ad0c7b292e5c912f5e20af4?s=128&d=identicon&r=PG", "display_name": "SoldierKB", "link": "https://stackoverflow.com/users/5653481/soldierkb"}, "edited": false, "score": 0, "creation_date": 1464814306, "post_id": 37577644, "comment_id": 62643990, "body": "I would really suggest you to refer to <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">Learn You a Haskell for Great Good!</a>, namely the <a href=\"http://learnyouahaskell.com/starting-out#an-intro-to-lists\" rel=\"nofollow noreferrer\">chapter on lists</a>\u2014it is not exactly a question you ask on Stack Overflow. But while we&#39;re on it, try <code>[]</code>"}, {"owner": {"reputation": 29, "user_id": 5653481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563aa3a76ad0c7b292e5c912f5e20af4?s=128&d=identicon&r=PG", "display_name": "SoldierKB", "link": "https://stackoverflow.com/users/5653481/soldierkb"}, "edited": false, "score": 0, "creation_date": 1464848649, "post_id": 37577644, "comment_id": 62654246, "body": "Thanks, I checked it and it works as it should ^^. I had bad times trying to make it work, without knowing all that <code>snd</code>, <code>zip</code> and <code>maximum</code>, and also thinking NOT in a functional way :)."}], "tags": [], "owner": {"reputation": 8126, "user_id": 562388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d71e7de62f17824c666db0405ccf60c7?s=128&d=identicon&r=PG", "display_name": "alf", "link": "https://stackoverflow.com/users/562388/alf"}, "is_accepted": true, "score": 9, "last_activity_date": 1464813173, "last_edit_date": 1464813173, "creation_date": 1464810866, "answer_id": 37577644, "question_id": 37577227, "link": "https://stackoverflow.com/questions/37577227/simple-haskell-program-not-behaving-correct/37577644#37577644", "title": "Simple Haskell program not behaving correct", "body": "<p>Anyway, let's have fun.</p>\n\n<pre><code>loop = do\n    let maxi = 0\n    let maxIdx = 0\n    let idx = 0\n    let idxN = 0\n    replicateM 5 $ do\n        input_line &lt;- getLine\n        let element = read input_line :: Int\n\n        if maxi &lt; element\n        then do \n            let maxi = element\n            let maxIdx = idx\n            hPutStrLn stderr \"INNER CHECK\"\n        else\n            hPutStrLn stderr \"OUTER CHECK\"\n\n        let idx = idxN + 1\n        let idxN = idx\n\n        print maxIdx\n\n    loop\n</code></pre>\n\n<p>is not a particularly Haskelly code (and as you know is not particularly correct).</p>\n\n<p>Let's make if Haskellier.</p>\n\n<p>What do we do here? We've an infinite loop, which is reading a line 5 times, does something to it, and then calls itself again for no particular reason.</p>\n\n<p>Let's split it:</p>\n\n<pre><code>import Control.Monad\n\nreadFiveLines :: IO [Int]\nreadFiveLines = replicateM 5 readLn\n\naddIndex :: [Int] -&gt; [(Int, Int)]\naddIndex xs = zip xs [0..]\n\nfindMaxIndex :: [Int] -&gt; Int\nfindMaxIndex xs = snd (maximum (addIndex xs))\n\nloop :: ()\nloop = loop\n\nmain :: IO ()\nmain = do xs &lt;- readFiveLines\n          putStrLn (show (findMaxIndex xs))\n</code></pre>\n\n<p><code>snd</code> returns the second element from a tuple; <code>readLn</code> is essentially <code>read . getLine</code>; <code>zip</code> takes two lists and returns a list of pairs; <code>maximum</code> finds a maximum value. </p>\n\n<p>I left <code>loop</code> intact in its original beauty.</p>\n\n<p>You can be even Haskellier if you remember that <code>something (huge expression)</code> can be replaced with <code>something $ huge expression</code> (<code>$</code> simply applies its left operand to its right operand), and the functions can be combined with <code>.</code>: <code>f (g x)</code> is the same as <code>(f . g) x</code>, or <code>f . g $ x</code> (see? it's working for the left side as well!). Additionally, <code>zip x y</code> can be rewritten as <code>x `zip` y</code></p>\n\n<pre><code>import Control.Monad\n\nreadFiveLines :: IO [Int]\nreadFiveLines = replicateM 5 readLn\n\naddIndex :: [Int] -&gt; [(Int, Int)]\naddIndex = (`zip` [0..])\n\nfindMaxIndex :: [Int] -&gt; Int\nfindMaxIndex = snd . maximum . addIndex\n\nmain :: IO ()\nmain = do xs &lt;- readFiveLines\n          putStrLn . show . findMaxIndex $ xs\n</code></pre>\n\n<p>As for debug print, there's a package called <code>Debug.Trace</code> and a function <code>traceShow</code> which prints its first argument (formatted with <code>show</code>, hence the name) to <code>stderr</code>, and returns its second argument:</p>\n\n<pre><code>findMaxIndex :: [Int] -&gt; Int\nfindMaxIndex = snd . (\\xs -&gt; traceShow xs (maximum xs)) . addIndex\n</code></pre>\n\n<p>That allows you to tap onto any expression and see what's coming in (and what are the values around \u2014 you can <code>show</code> tuples, lists, etc.)</p>\n"}, {"comments": [{"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1464818000, "post_id": 37578616, "comment_id": 62645706, "body": "No offense, but this answer isn&#39;t particularly helpful for a beginner who doesn&#39;t understand how Haskell works yet."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1464818933, "post_id": 37578616, "comment_id": 62646055, "body": "No offense taken.  If might help someone someday."}, {"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1464951505, "post_id": 37578616, "comment_id": 62708005, "body": "Not a particularly helpful answer, I think. In there you get Monads, lifts and the state monad. Not too over the top, I admit, but inappropriate for the beginner, before having read his first book."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1464955125, "post_id": 37578616, "comment_id": 62710273, "body": "@FredrikKarlsson Thanks for the feedback. As I stated, I think alf&#39;s answer is very good. However, I don&#39;t think it does what the poster&#39;s original program intended without the use of <code>traceShow</code> which should only be used for debugging. These questions and answers are available to the entire internet, so I think it&#39;s fair to add a version with &#39;proper&#39; IO lest someone stumble across this questions and think <code>traceShow</code> is an appropriate solution. Also, I think its insulting to assume that just because someone is a beginner, they don&#39;t have the capacity to appreciate an answer."}, {"owner": {"reputation": 8126, "user_id": 562388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d71e7de62f17824c666db0405ccf60c7?s=128&d=identicon&r=PG", "display_name": "alf", "link": "https://stackoverflow.com/users/562388/alf"}, "edited": false, "score": 0, "creation_date": 1464993562, "post_id": 37578616, "comment_id": 62731287, "body": "For what it&#39;s worth, it was helpful for me: I would <i>love</i> to be able to write this version as well, but had neither working knowledge of monad transformers nor the dedication to learn that for a toy problem. It is true indeed that most probably it&#39;s out of the OP&#39;s depth (it&#39;s certainly borderline out of mine), but saying that the answer is &quot;bad&quot; because it&#39;s hard is completely missing the point, see <a href=\"https://www.infoq.com/presentations/Simple-Made-Easy\" rel=\"nofollow noreferrer\">infoq.com/presentations/Simple-Made-Easy</a> for example (I agree it&#39;s not only hard but also complex, but comparing two solutions is extremely valuable, don&#39;t you think?)."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 0, "last_activity_date": 1464814563, "creation_date": 1464814563, "answer_id": 37578616, "question_id": 37577227, "link": "https://stackoverflow.com/questions/37577227/simple-haskell-program-not-behaving-correct/37578616#37578616", "title": "Simple Haskell program not behaving correct", "body": "<p>I think alf's answer is very good, but for what it's worth, here's how I would interpret your intention.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nmodule Main where\n\nimport System.IO\nimport Control.Monad.State\n\ndata S = S { maximum :: Int\n           , maximumIndex :: Int\n           , currentIndex :: Int }\n\nupdate :: Int -&gt; Int -&gt; S -&gt; S\nupdate m mi (S _ _ ci) = S m mi ci\n\nincrement :: S -&gt; S\nincrement (S m mi ci) = S m mi (ci+1)\n\nnext :: (MonadIO m, MonadState S m) =&gt; m ()\nnext =  do\n  S maxi maxIdx currIdx &lt;- get\n\n  input &lt;- liftIO $ getLine\n  let element = read input :: Int\n\n  if maxi &lt; element\n  then do\n    modify (update element currIdx)\n    liftIO $ hPutStrLn stderr \"INNER CHECK\"\n  else\n    liftIO $ hPutStrLn stderr \"OUTER CHECK\"\n\n  modify increment\n\nrun :: Int -&gt; IO S\nrun n = execStateT (replicateM_ n next) (S 0 0 0)\n\nmain :: IO ()\nmain = do\n  S maxi maxIdx _ &lt;- run 5    \n  putStrLn $ \"maxi: \" ++ (show maxi) ++ \" | maxIdx: \" ++ (show maxIdx)\n</code></pre>\n\n<p>This uses a monad transformer to combine a stateful computation with IO. The <code>get</code> function retrieves the current state, and the <code>modify</code> function lets you change the state.</p>\n"}], "owner": {"reputation": 29, "user_id": 5653481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563aa3a76ad0c7b292e5c912f5e20af4?s=128&d=identicon&r=PG", "display_name": "SoldierKB", "link": "https://stackoverflow.com/users/5653481/soldierkb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 37577644, "answer_count": 2, "score": 1, "last_activity_date": 1464814563, "creation_date": 1464809273, "question_id": 37577227, "link": "https://stackoverflow.com/questions/37577227/simple-haskell-program-not-behaving-correct", "title": "Simple Haskell program not behaving correct", "body": "<p>I'm new to Haskell and trying to write simple program to find maximal element and it's index from intput. I receive values to compare one by one. Maximal element I'm holding in <strong>maxi</strong> variable, it's index - in <strong>maxIdx</strong>. Here's my program:</p>\n\n<pre><code>loop = do\n    let maxi = 0\n    let maxIdx = 0\n    let idx = 0\n    let idxN = 0\n    replicateM 5 $ do\n        input_line &lt;- getLine\n        let element = read input_line :: Int\n\n        if maxi &lt; element\n        then do \n            let maxi = element\n            let maxIdx = idx\n            hPutStrLn stderr \"INNER CHECK\"\n        else\n            hPutStrLn stderr \"OUTER CHECK\"\n\n        let idx = idxN + 1\n        let idxN = idx\n\n        print maxIdx\n\n    loop\n</code></pre>\n\n<p>Even though I know elements coming are starting from bigger to smaller (5, 4, 3, 2, 1) program enters INNER CHECK all the time (it should happen only for the first element!) and <strong>maxIdx</strong> is always 0.\nWhat am I doing wrong?\nThanks in advance.</p>\n"}, {"tags": ["haskell", "happstack"], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1465916519, "post_id": 37578189, "comment_id": 63095481, "body": "Thank you so much!  I have a further question here. Is the Request and the Response of each Route contained in the dir..., or where should I look for those Request and Response?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1465917429, "post_id": 37578189, "comment_id": 63096256, "body": "Not sure what you are asking. Perhaps you should open up a new question. <code>dit &quot;static&quot; action</code> means whenever the request URL is <code>&#47;static&#47;...</code>, then have <code>action</code> process the request. So in this case the <code>serveDirectory</code> function will process the request (if the url begins with <code>&#47;static&#47;...</code>)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1464812910, "creation_date": 1464812910, "answer_id": 37578189, "question_id": 37577056, "link": "https://stackoverflow.com/questions/37577056/what-should-a-route-look-like-in-happstack-code/37578189#37578189", "title": "What should a Route look like in Happstack code?", "body": "<p>My understanding is that each <code>dir ...</code> line is a route (for a directory.)</p>\n\n<p>E.g.:</p>\n\n<pre><code> dir \"static\" $ serveDirectory DisableBrowsing [] staticDir,\n</code></pre>\n\n<p>means that for paths like <code>/static/...</code> invoke the handler <code>serveDirectory ...</code></p>\n\n<p>If you want to add your own route, add it before the <code>notFoundResponse</code> - otherwise it probably will never get called.</p>\n"}], "owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "accepted_answer_id": 37578189, "answer_count": 1, "score": 1, "last_activity_date": 1464812910, "creation_date": 1464808677, "last_edit_date": 1464811152, "question_id": 37577056, "link": "https://stackoverflow.com/questions/37577056/what-should-a-route-look-like-in-happstack-code", "title": "What should a Route look like in Happstack code?", "body": "<pre><code>runServer :: IO ()\nrunServer = do\n    configureLogger\n    staticDir &lt;- getStaticDir\n    redirectUrlGraphEmail &lt;- retrieveAuthURL testUrl\n    redirectUrlGraphPost &lt;- retrieveAuthURL testPostUrl\n    aboutContents &lt;- LazyIO.readFile $ markdownPath ++ \"README.md\"\n    privacyContents &lt;- LazyIO.readFile $ markdownPath ++ \"PRIVACY.md\"\n-- Start the HTTP server\nsimpleHTTP serverConf $ do\n  decodeBody (defaultBodyPolicy \"/tmp/\" 4096 4096 4096)\n  msum [ do\n          nullDir\n          seeOther \"graph\" (toResponse \"Redirecting to /graph\"),\n          dir \"grid\" gridResponse,\n          dir \"graph\" graphResponse,\n          dir \"image\" graphImageResponse,\n          dir \"timetable-image\" $ look \"courses\" &gt;&gt;= \\x -&gt; look \"session\" &gt;&gt;= timetableImageResponse x,\n          dir \"graph-fb\" $ seeOther redirectUrlGraphEmail $ toResponse \"\",\n          dir \"post-fb\" $ seeOther redirectUrlGraphPost $ toResponse \"\",\n          dir \"test\" $ look \"code\" &gt;&gt;= getEmail,\n          dir \"test-post\" $ look \"code\" &gt;&gt;= postToFacebook,\n          dir \"post\" postResponse,\n          dir \"draw\" drawResponse,\n          dir \"about\" $ aboutResponse aboutContents,\n          dir \"privacy\" $ privacyResponse privacyContents,\n          dir \"static\" $ serveDirectory DisableBrowsing [] staticDir,\n          dir \"course\" $ look \"name\" &gt;&gt;= retrieveCourse,\n          dir \"all-courses\" $ liftIO allCourses,\n          dir \"graphs\" $ liftIO queryGraphs,\n          dir \"course-info\" $ look \"dept\" &gt;&gt;= courseInfo,\n          dir \"depts\" $ liftIO deptList,\n          dir \"timesearch\" searchResponse,\n          dir \"calendar\" $ lookCookieValue \"selected-lectures\" &gt;&gt;= calendarResponse,\n          dir \"get-json-data\" $ look \"graphName\" &gt;&gt;= \\graphName -&gt; liftIO $ getGraphJSON graphName,\n          dir \"loading\" $ look \"size\" &gt;&gt;= loadingResponse,\n          dir \"save-json\" $ look \"jsonData\" &gt;&gt;= \\jsonStr -&gt; look \"nameData\" &gt;&gt;= \\nameStr -&gt; liftIO $ saveGraphJSON jsonStr nameStr,\n          notFoundResponse\n    ]\n</code></pre>\n\n<p>In the list after the function msum( I assume it's a list since it's in []), is everything after dir a route? What should a route look like in happstack code? I am totally lost in this piece of code. </p>\n"}, {"tags": ["haskell", "text", "package-managers", "parsec"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464815459, "post_id": 37576910, "comment_id": 62644578, "body": "It is standard practice to produce a minimal working example (where here &quot;working&quot; means &quot;produces the error you quoted&quot;). For a cabal problem, that ideally includes at the very least a minimized <code>.cabal</code> file and a minimized <code>.hs</code> file. You&#39;ve hinted at some of the contents of each, but there aren&#39;t enough details to reproduce your problem."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1464860769, "post_id": 37576910, "comment_id": 62661696, "body": "Btw - the signature for <code>floating2</code> should be <code>Bool -&gt; Parser Double</code>"}, {"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1464862862, "post_id": 37576910, "comment_id": 62663264, "body": "Yes, you are right. I fixed it now."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1464815540, "post_id": 37577999, "comment_id": 62644612, "body": "The error quoted is not about constraint solving, but about name resolution. So the knee jerk reaction of &quot;just use stack&quot; is not obviously sufficient."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464820101, "post_id": 37577999, "comment_id": 62646490, "body": "I would still try a cabal sandbox and/or stack to make sure we have a clean build and mitigate against a corrupted pkg db. I can&#39;t see anything in the <code>build-depends</code> which directly or indirectly brings in <code>parsec</code> - do you?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1464820831, "post_id": 37577999, "comment_id": 62646747, "body": "<code>parsec3-numbers</code> depends on <code>parsec</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464821562, "post_id": 37577999, "comment_id": 62646988, "body": "Well - there you go!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464825022, "post_id": 37577999, "comment_id": 62647982, "body": "That doesn&#39;t explain anything, really, which was my point all along: the question doesn&#39;t provided enough information for us to divine what&#39;s wrong yet. So we should be writing comments trying to acquire this information, not off-the-cuff answers that don&#39;t solve the problem."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464812636, "last_edit_date": 1464812636, "creation_date": 1464812210, "answer_id": 37577999, "question_id": 37576910, "link": "https://stackoverflow.com/questions/37576910/parsec3-blocked-by-parsec-what-ever-i-do/37577999#37577999", "title": "Parsec3 blocked by parsec, what ever I do", "body": "<p>FWIW, I was able to satisfy all of your constraints with stack resolvers lts-5.13 and lts-6.0.</p>\n\n<p>I think there is something screwed up with your package db. I would try using a cabal sandbox and/or use <code>stack</code>.</p>\n\n<p>If you use <code>stack</code>, just add these to your <code>extra-deps:</code> section in the <code>stack.yaml</code> file:</p>\n\n<pre><code>extra-deps:\n- parsec3-numbers-0.1.0\n- parsec3-1.0.1.8\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1464862818, "post_id": 37587951, "comment_id": 62663233, "body": "Fantastic! Yes, parsec3 pulls in parsec, even though I tried to block it. Recompilijg solved everything! Thanks!"}, {"owner": {"reputation": 1375, "user_id": 420038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e486867defc84340f1837639ca54ee?s=128&d=identicon&r=PG", "display_name": "thomie", "link": "https://stackoverflow.com/users/420038/thomie"}, "edited": false, "score": 0, "creation_date": 1466034893, "post_id": 37587951, "comment_id": 63155196, "body": "Use <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/packages.html#ghc-flag--ignore-package\" rel=\"nofollow noreferrer\"><code>-ignore-package</code></a> next time. <code>ghci -ignore-package parsec Test.hs</code> results in &quot;Failed to load interface for \u2018Text.Parsec.Number\u2019.&quot; And <code>ghci -ignore-package parsec -package parsec3-numbers Test.hs</code> results in &quot;cannot satisfy -package parsec3-numbers: parsec3-numbers-0.1.0-5ewSm5c1kZOI1sNlSx7Ecm is unusable due to missing or recursive dependencies: parsec-3.1.11-37j7M1YEHqtEooY7BpJdri&quot;"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1464860844, "last_edit_date": 1464860844, "creation_date": 1464860022, "answer_id": 37587951, "question_id": 37576910, "link": "https://stackoverflow.com/questions/37576910/parsec3-blocked-by-parsec-what-ever-i-do/37587951#37587951", "title": "Parsec3 blocked by parsec, what ever I do", "body": "<p>In the .cabal file for <code>parsec3-numbers</code> there is:</p>\n\n<pre><code>flag parsec3\n    Description: Use parsec3\n    Default: False\n\nLibrary\n  exposed-modules:\n    Text.Parsec.Number\n  if flag(parsec3)\n      build-depends: parsec3\n  else\n      build-depends: parsec\n</code></pre>\n\n<p>So I bet you want to build <code>parsec3-numbers</code> with the <code>-f parsec3</code> option.</p>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 37587951, "answer_count": 2, "score": 1, "last_activity_date": 1464862745, "creation_date": 1464808147, "last_edit_date": 1464862745, "question_id": 37576910, "link": "https://stackoverflow.com/questions/37576910/parsec3-blocked-by-parsec-what-ever-i-do", "title": "Parsec3 blocked by parsec, what ever I do", "body": "<p>using a cabal file looking like this (the relevant library part):</p>\n\n<blockquote>\n  <p>build-depends:       base >=4.8 &amp;&amp; &lt; 4.9,   filepath >=1.4 &amp;&amp; &lt;1.5,  time >=1.5 &amp;&amp; &lt;1.6, bytestring >=0.10 &amp;&amp; &lt;0.11, unix >=2.7 &amp;&amp; &lt;2.8, cryptohash >=0.11 &amp;&amp; &lt;0.12, process >=1.2 &amp;&amp; &lt;1.3, transformers >= 0.4 &amp;&amp; &lt; 0.5, text >= 1.2 &amp;&amp; &lt;= 1.3, base16-bytestring >= 0.1.1 &amp;&amp; &lt; 1.1.2, utf8-string >= 1 &amp;&amp; &lt; 1.1, directory >=1.2 &amp;&amp; &lt;1.3, regex-base >= 0.9 &amp;&amp; &lt; 1.0, regex-pcre >= 0.94 &amp;&amp; &lt; 0.95, regex-base >= 0.93 &amp;&amp; &lt; 0.94, direct-sqlite >=2.3 &amp;&amp; &lt;2.4, text >=1.2 &amp;&amp; &lt;1.3, filemanip >=0.3 &amp;&amp; &lt; 0.4, <strong>parsec3-numbers >=0.1 &amp;&amp; &lt; 0.2, parsec3 >=1.0 &amp;&amp; &lt;1.1</strong></p>\n</blockquote>\n\n<p>I get this when doing a <code>cabal build</code> :</p>\n\n<pre><code>...\nCouldn't match expected type \u2018ParsecT\n                                Text () Data.Functor.Identity.Identity Double\u2019\n            with actual type \u2018parsec-3.1.9:Text.Parsec.Prim.ParsecT\n                                s0 u0 m0 Double\u2019\nNB: \u2018ParsecT\u2019\n      is defined in \u2018Text.Parsec.Prim\u2019 in package \u2018parsec3-1.0.1.8\u2019\n    \u2018parsec-3.1.9:Text.Parsec.Prim.ParsecT\u2019\n      is defined in \u2018Text.Parsec.Prim\u2019 in package \u2018parsec-3.1.9\u2019\nIn a stmt of a 'do' block: time &lt;- floating\n</code></pre>\n\n<p>What I am trying to do is use the <code>floating2</code> parser in the <code>parsec3-numbers</code> package, but somehow I get also the interference of parsec-3.1.9.\nI get the same problem if I load the failing file into ghci and with <code>:set -hide-package parsec</code> or <code>:set -hide-package parsec-numbers</code> set.</p>\n\n<p>How do I make sure that I will only get parsec3 parsers? The imports I am using in the file are:</p>\n\n<pre><code>import Text.Parsec.Text\nimport Text.Parsec\nimport Text.Parsec.Number\nimport qualified Data.List as DL\nimport qualified Data.Text.IO as TIO\n\nimport Database.SQLite3\nimport Data.Text\n</code></pre>\n\n<p>so this should work. I need the Text parsing capabilities of parsec3, that is why I went into this.</p>\n\n<p>Fredrik</p>\n\n<p>EDIT:</p>\n\n<p>Ok, reducing this problem to a minimal form that highlights the real issue.\nUsing this code:</p>\n\n<pre><code>import Text.Parsec.Text\nimport Text.Parsec\nimport Text.Parsec.Number\n\nnum:: Bool -&gt; Parser Double\nnum = floating2\n</code></pre>\n\n<p>and a procedure for evaluating it that does not depend on the specific build tool used</p>\n\n<pre><code>&gt; cd ~ # Move outside of any cabal package\n&gt; ghci -hide-package parsec # Parsec should now not be pulled in\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :l test.hs\n[1 of 1] Compiling Main             ( test.hs, interpreted )\n\ntest.hs:6:7:\n    Couldn't match type \u2018parsec-3.1.9:Text.Parsec.Prim.ParsecT\n                           s0 u0 m0 Double\u2019\n                   with \u2018ParsecT\n                           Data.Text.Internal.Text () Data.Functor.Identity.Identity Double\u2019\n    NB: \u2018parsec-3.1.9:Text.Parsec.Prim.ParsecT\u2019\n          is defined in \u2018Text.Parsec.Prim\u2019 in package \u2018parsec-3.1.9\u2019\n        \u2018ParsecT\u2019\n          is defined in \u2018Text.Parsec.Prim\u2019 in package \u2018parsec3-1.0.1.8\u2019\n    Expected type: Parser a -&gt; Parser Double\n      Actual type: Bool\n                   -&gt; parsec-3.1.9:Text.Parsec.Prim.ParsecT s0 u0 m0 Double\n    In the expression: floating2\n    In an equation for \u2018num\u2019: num = floating2\nFailed, modules loaded: none.\n</code></pre>\n\n<p>As you can see, <code>parsec-3.1.9</code> is still pulled in, and is 'blocking' the <code>parsec3</code> definitions.</p>\n\n<p>Just to provide a clean case here,  <code>parsec-numbers</code> is a package out there, and that is <strong>not</strong> creating the problem in this case:</p>\n\n<pre><code>&gt;  ghci -hide-package parsec-numbers\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n&lt;command line&gt;: cannot satisfy -hide-package parsec-numbers\n    (use -v for more information)\n</code></pre>\n"}, {"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1464804431, "post_id": 37574875, "comment_id": 62638849, "body": "Question in body is quite different from that in the title."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1464810264, "post_id": 37574875, "comment_id": 62641826, "body": "I edited the question to be more clear. I&#39;m not looking for anything subjective. I want to know how to solve this problem. I&#39;m assuming there&#39;s some useful functions that can accomplish this. Thanks!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1464813040, "post_id": 37574875, "comment_id": 62643289, "body": "Are you really looking for <i>maximal</i> common subsequences?"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464813827, "post_id": 37574875, "comment_id": 62643706, "body": "@ErikR I&#39;m not sure. The use case is removing the common portions of a list of chapter titles from web books. The pages will have the book title in each chapter, I want to extract the unique part from a list of strings."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1464829094, "post_id": 37574875, "comment_id": 62648953, "body": "Will the common parts always be at the beginning and end? For instance, <code>ab</code> is the longest common prefix and <code>g</code> is the longest common suffix. That would really simplify the problem."}], "answers": [{"tags": [], "owner": {"reputation": 3165, "user_id": 1181103, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/99bcd4d7172ef6e5ece5e0af27f7381c?s=128&d=identicon&r=PG", "display_name": "Sergey Romanovsky", "link": "https://stackoverflow.com/users/1181103/sergey-romanovsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1464982836, "last_edit_date": 1464982836, "creation_date": 1464976226, "answer_id": 37620634, "question_id": 37574875, "link": "https://stackoverflow.com/questions/37574875/function-to-find-longest-common-subsequences-of-a-list-of-lists/37620634#37620634", "title": "Function to find longest common subsequences of a list of lists?", "body": "<p>You're looking for <a href=\"https://hackage.haskell.org/package/string-similarity-0.1.0.0/docs/Data-List-CommonSubstring.html\" rel=\"nofollow\">Data.List.CommonSubstring</a></p>\n\n<pre><code>$ ghci\n\u03bb: :m +Data.List.CommonSubstring\n\u03bb: longestSubstring \"abcdefg\" \"abc__fg\"\n\"abc\"\n</code></pre>\n\n<p>It's unclear what exactly you want (longest subsequence or all possible subsequences), so feel free to use <a href=\"https://hackage.haskell.org/package/suffixtree-0.2.2.1/docs/Data-SuffixTree.html\" rel=\"nofollow\">Data.SuffixTree</a> directly to implement required logic.</p>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 37620634, "answer_count": 1, "score": 1, "last_activity_date": 1464982836, "creation_date": 1464800828, "last_edit_date": 1464810218, "question_id": 37574875, "link": "https://stackoverflow.com/questions/37574875/function-to-find-longest-common-subsequences-of-a-list-of-lists", "title": "Function to find longest common subsequences of a list of lists?", "body": "<p>How can I find the longest subsequences that two lists have in common? For example:</p>\n\n<pre><code>[\"abcdefg\", \"abc__fg\", \"ab____g\"] \n</code></pre>\n\n<p>It should return:</p>\n\n<pre><code>[\"ab\", \"g\"]\n</code></pre>\n\n<p>Is there an existing function that does this? How would you compose one from existing ones?</p>\n"}, {"tags": ["haskell", "types", "pattern-matching"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464804118, "post_id": 37574407, "comment_id": 62638700, "body": "Just to give you a clue why this error exists: compare <code>show ([] :: [Char])</code> and <code>show ([] :: [Int])</code>. This makes it very clear why e.g. <code>show []</code> is ambiguous: should it result in the former value or the latter? Even for &quot;containers&quot; that don&#39;t contain any values, one must fix the type of the contained elements before the behavior of <code>show</code> is determined."}], "answers": [{"comments": [{"owner": {"reputation": 269, "user_id": 4038547, "user_type": "registered", "accept_rate": 18, "profile_image": "https://graph.facebook.com/100006406093905/picture?type=large", "display_name": "Rodrigo Stv", "link": "https://stackoverflow.com/users/4038547/rodrigo-stv"}, "edited": false, "score": 0, "creation_date": 1464800692, "post_id": 37574560, "comment_id": 62636729, "body": "Should not I type the Nothing as something similar to Maybe Show t?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 269, "user_id": 4038547, "user_type": "registered", "accept_rate": 18, "profile_image": "https://graph.facebook.com/100006406093905/picture?type=large", "display_name": "Rodrigo Stv", "link": "https://stackoverflow.com/users/4038547/rodrigo-stv"}, "edited": false, "score": 0, "creation_date": 1464801102, "post_id": 37574560, "comment_id": 62636975, "body": "I think you can do something like <code>(Nothing :: forall t. Show t =&gt; Maybe t)</code> but I have not tried and I am almost certain it wont; <code>f</code> is polymorphic in its argument but you need a concrete type that <code>f</code> works on."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 269, "user_id": 4038547, "user_type": "registered", "accept_rate": 18, "profile_image": "https://graph.facebook.com/100006406093905/picture?type=large", "display_name": "Rodrigo Stv", "link": "https://stackoverflow.com/users/4038547/rodrigo-stv"}, "edited": false, "score": 1, "creation_date": 1464803938, "post_id": 37574560, "comment_id": 62638605, "body": "@RodrigoStv No, function arguments are never (!) polymorphic in Haskell. (Though GHC has extensions to relax this restriction.)"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1464799876, "creation_date": 1464799876, "answer_id": 37574560, "question_id": 37574407, "link": "https://stackoverflow.com/questions/37574407/type-error-in-haskell-when-pattern-matching-against-maybe-with-show-constraint/37574560#37574560", "title": "Type error in Haskell when pattern matching against Maybe with Show constraint", "body": "<p>Here <code>Nothing</code> is of any possible <code>Maybe a</code> you have to specify which <code>a</code> you mean - try</p>\n\n<pre><code>main :: IO ()\nmain = f (Nothing :: Maybe Int)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464808394, "post_id": 37576053, "comment_id": 62640856, "body": "<code>main</code> can have any <code>IO</code> type, not just <code>IO ()</code>, although that&#39;s not too relevant here."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464811500, "post_id": 37576053, "comment_id": 62642500, "body": "@dfeuer: Huh, I didn&#39;t know that.  Thanks!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464813883, "post_id": 37576053, "comment_id": 62643732, "body": "It&#39;s generally clearest, I think, to use <code>IO ()</code> for programs that may terminate in an orderly fashion, and to use <code>IO a</code> (polymorphic) for programs that only terminate with an uncaught exception, but that&#39;s a bit nit-picky."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 4, "last_activity_date": 1464821220, "last_edit_date": 1464821220, "creation_date": 1464805140, "answer_id": 37576053, "question_id": 37574407, "link": "https://stackoverflow.com/questions/37574407/type-error-in-haskell-when-pattern-matching-against-maybe-with-show-constraint/37576053#37576053", "title": "Type error in Haskell when pattern matching against Maybe with Show constraint", "body": "<p>Suppose you're the compiler, and you're trying to type check your program:</p>\n\n<pre><code>main = do\n f Nothing\n</code></pre>\n\n<p>You know that:</p>\n\n<ol>\n<li><code>main</code> must have type <code>IO ()</code>, because it's a compiler-imposed requirement;</li>\n<li><code>f</code> must have type <code>(Show t) =&gt; Maybe t -&gt; IO ()</code>, because that's the type annotation on it.</li>\n<li><code>Nothing</code> must have type <code>Maybe a</code>, where <code>a = t</code> (the same <code>t</code> as in the use of <code>f</code>);</li>\n<li>Therefore, <code>a</code> must be a <code>Show</code> instance.</li>\n</ol>\n\n<p>But this isn't enough to get the program to compile, Haskell must <strong>monomorphize</strong> the call to <code>f</code> in your <code>main</code> action, i.e., figure out the concrete type of every type variable in that particular use of <code>f</code>.  In this case, this is because the type of <code>main :: IO ()</code> is monomorphic (no type variables in it), so none of the expressions that occur in its definition may have types with uninstantiated type variables.</p>\n\n<p>So that's what this ambiguous type error means: your program doesn't have enough information for the compiler to figure out the element type of the <code>Maybe</code> argument to your call to <code>f</code>.  All it can figure out is that it must be a <code>Show</code> instance, but that's not enough get the program to compile.  </p>\n\n<p>The solution is to add a type annotation somewhere that picks a concrete type for it.  There are many ways:</p>\n\n<pre><code>main = f (Nothing :: Maybe Int)\n\nmain = f argument\n  where argument :: Maybe Integer\n        argument = Nothing\n\nmain = (f :: Maybe String -&gt; IO ()) Nothing\n</code></pre>\n\n<p>The reason there isn't just one way is that type inference is like a detective\u2014it works by putting together a lot of different clues, and thus there are many different hints you can give it that will allow it to \"solve the case.\"</p>\n"}], "owner": {"reputation": 269, "user_id": 4038547, "user_type": "registered", "accept_rate": 18, "profile_image": "https://graph.facebook.com/100006406093905/picture?type=large", "display_name": "Rodrigo Stv", "link": "https://stackoverflow.com/users/4038547/rodrigo-stv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1464821220, "creation_date": 1464799431, "question_id": 37574407, "link": "https://stackoverflow.com/questions/37574407/type-error-in-haskell-when-pattern-matching-against-maybe-with-show-constraint", "title": "Type error in Haskell when pattern matching against Maybe with Show constraint", "body": "<pre><code>import Data.Maybe\n\nf :: (Show t) =&gt; Maybe t -&gt; IO () \nf Nothing  = putStrLn   \"Nothing!\"\nf (Just x) = putStrLn $ \"The number is \" ++ (show x)\n\nmain = do\n  f Nothing\n</code></pre>\n\n<p>This gives:</p>\n\n<pre><code>foo.hs:7:3:\n    No instance for (Show a0) arising from a use of \u2018f\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Show a =&gt; Show (Maybe a) -- Defined in \u2018GHC.Show\u2019\n      instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n      instance Show Integer -- Defined in \u2018GHC.Show\u2019\n      ...plus 22 others\n    In a stmt of a 'do' block: f Nothing\n    In the expression: do { f Nothing }\n    In an equation for \u2018main\u2019: main = do { f Nothing }\n\nfoo.hs:7:3:\n    No instance for (Show a0) arising from a use of \u2018f\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Show a =&gt; Show (Maybe a) -- Defined in \u2018GHC.Show\u2019\n      instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n      instance Show Integer -- Defined in \u2018GHC.Show\u2019\n      ...plus 22 others\n    In a stmt of a 'do' block: f Nothing\n    In the expression: do { f Nothing }\n    In an equation for \u2018main\u2019: main = do { f Nothing }\n</code></pre>\n\n<p>How can this peace of code be fixed? The point is to safely print a showable. I thought that (Show t) => Maybe t could be destructured into both Nothing and Just x.</p>\n"}, {"tags": ["function", "haskell", "function-composition", "pointfree"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1464795912, "post_id": 37573019, "comment_id": 62633832, "body": "<code>(fmap firstTriple .) . Text.commonPrefixes</code> ?"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1464802124, "post_id": 37573019, "comment_id": 62637581, "body": "It looks like <code>fmap (fmap firstTriple) . Text.commonPrefixes</code> works too. Thanks everyone!"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "closed_date": 1464795801, "answer_count": 0, "score": 0, "last_activity_date": 1464795112, "creation_date": 1464795112, "question_id": 37573019, "link": "https://stackoverflow.com/questions/37573019/compose-function-with-two-arguments", "closed_reason": "Duplicate", "title": "Compose function with two arguments", "body": "<p>I ran into something that threw me off today. I was trying to define a function equivalent to <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html#v:commonPrefixes\" rel=\"nofollow\"><code>Data.Text.commonPrefixes</code></a> that throws away everything but the prefix. </p>\n\n<p>The following works:</p>\n\n<pre><code>commonPrefix :: Text -&gt; Text -&gt; Maybe Text\ncommonPrefix a b = fmap firstTriple $ Text.commonPrefixes a b\n\nfirstTriple :: (a, b, c) -&gt; a\nfirstTriple (a, _, _) = a\n</code></pre>\n\n<p>I originally tried doing it like this, which doesn't work:</p>\n\n<pre><code>commonPrefix :: Text -&gt; Text -&gt; Maybe Text\ncommonPrefix = fmap firstTriple . Text.commonPrefixes\n</code></pre>\n\n<p>Is there a way to define this function as a composition?</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1464979185, "post_id": 37572628, "comment_id": 62725245, "body": "Can you provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>? There are too many variables and too little concrete information to diagnose the problem."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465000865, "post_id": 37572628, "comment_id": 62732961, "body": "@n.m. Updated with an <a href=\"https://github.com/crockeea/CPPBindings\" rel=\"nofollow noreferrer\">example</a>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465016057, "post_id": 37572628, "comment_id": 62735239, "body": "When running with shared libraries, the error &quot;no such file or directory libclib.so&quot; can be corrected by placing libclib.so in LD_LIBRARY_PATH. or specifying its installation directory in ld-options. <code>-rpath &#47;path&#47;to&#47;libclib-dir</code> should do the trick. Not sure about integrating C++ code in a Haskell static library. I have never tried this. What&#39;s the exact problem with this? Do you have an example of successfully integrating C code, where integrating C++ code in the same manner doesn&#39;t work?: What error messages do you get in this case?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465018394, "post_id": 37572628, "comment_id": 62735748, "body": "@n.m. Unless I can specify a <i>relative</i> path for the .so file, this is no good. It means that users of the library also have to set an absolute path particular to their system, which is too complicated. When cabal linked the pure-C version of <code>CLib</code>, I didn&#39;t have to set LD_LIBRARY_PATH or <code>ld-options</code> to get the dynamic libraries working; I&#39;m looking for a similarly foolproof solution. I&#39;ll get an example with working C/failing C++ integration tomorrow."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465018510, "post_id": 37572628, "comment_id": 62735772, "body": "It is possible to specify a relative path too, see <code>$ORIGIN</code> in <code>man ld</code>. I&#39;m sure the C-version of clib was somehow different in other respects because it doesn&#39;t matter to the dynamic loader which source language(s) were used to build the library."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465018720, "post_id": 37572628, "comment_id": 62735813, "body": "@n.m. The question is where the path is relative from. It&#39;s unclear, which AFAICT is the reason that neither cabal nor stack support a relative &quot;extra-lib-dirs&quot;. You can circumvent this either by using Setup.hs or by giving linker options with <code>optl</code>, but I couldn&#39;t figure out how to get cabal to find the library with either of those solutions."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465018791, "post_id": 37572628, "comment_id": 62735829, "body": "@n.m. The C version is different in that it is pure C. IIRC, the issue is that GHC tries to compile the header files as pure C files, and throws an error when it sees C++ code in them."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465019071, "post_id": 37572628, "comment_id": 62735880, "body": "&quot;where the path is relative from&quot; -- from the file being linked. &quot;and throws an error when it sees C++ code in them&quot; -- that&#39;s right, don&#39;t put C++ code in header files that GHC can see. If you need C++ code in these files, isolate it with <code>#ifdef __cplusplus</code> like any other header file that should support both C and C++. If you can give me a pure C working example, I think I will be able to convert it to C++ without too much pain."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465066403, "post_id": 37572628, "comment_id": 62749491, "body": "@n.m. Though I&#39;m not sure why my header file needs to support C and C++ (rather than just C++), the <code>#ifdef</code> does make the <code>cabal configure</code> step happy. This allows me to use cabal to link with C++ using instructions <a href=\"http://blog.ezyang.com/2010/06/setting-up-cabal-the-ffi-and-c2hs/\" rel=\"nofollow noreferrer\">here</a>. Unfortunately, for more complicated examples, I still can&#39;t run <code>cabal repl</code>. It&#39;s possible this is a GHC or cabal bug, but I&#39;m still working on it. A longer explanation and more examples are <a href=\"https://github.com/crockeea/CPPBindings\" rel=\"nofollow noreferrer\">at the repo</a> (see README)."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465076647, "post_id": 37572628, "comment_id": 62752431, "body": "@n.m. Found the problem: the order in which I list the .cpp files in the cabal files matters. I&#39;m not sure if this is a bug or not, what do you think? If you write a short answer about using <code>__cplusplus</code>, I&#39;ll give you the bounty, and add my own answer with a detailed example."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465077780, "post_id": 37572628, "comment_id": 62752730, "body": "I&#39;ve just tried to build your repo, and got an undefined symbol error for a class-static variable, despite the symbol being clearly defined. I think this is a GHCi linker bug. I have replaced the class-static variable with a file-static one, plus two access functions, and now cabal repl works. If you can fix this with reordering C++ files, this looks even more like a linker bug. Their order should not matter."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465080251, "post_id": 37572628, "comment_id": 62753340, "body": "Bug report <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12152\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465083331, "post_id": 37572628, "comment_id": 62753840, "body": "@n.m. I just tried linking with <code>stdc++</code> using <code>extra-libraries</code> (pushed in repo), which works when building/static linking, but fails for <code>cabal repl</code>/dynamic linking with the same error as above: <code>panic!... Loading temp shared object failed</code>. Thoughts on how to work around that?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465108153, "post_id": 37572628, "comment_id": 62758597, "body": "I&#39;ve seen some C++-related GHCi linker bugs/inconsistencies before. No real workarounds, just file a bug against GHCi."}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 3, "last_activity_date": 1465109933, "creation_date": 1465109933, "answer_id": 37639281, "question_id": 37572628, "link": "https://stackoverflow.com/questions/37572628/statically-link-c-library-with-a-haskell-library/37639281#37639281", "title": "Statically link C++ library with a Haskell library", "body": "<p>GHC cannot really understand C++ header files. It needs pure C code. The common way for a C++ header file to provide C interface is to isolate away C++ parts with <code>#ifdef __cplusplus</code>, e.g.:</p>\n\n<pre><code>#ifdef __cplusplus\nextern \"C\" {         // C compilers and various C-based FFIs don't like this\n#endif\n\nvoid foo();\n\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n\n<p>In addition, GHCi is historically known to have problems with linking C++ code. For example, at one point it didn't understand weak symbols (often produced by the compiler in conjunction with inline functions and template instantiations). You might be seeing one of these problems. I'd recommend filing a bug report to the GHC team.</p>\n"}, {"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 5, "last_activity_date": 1467208870, "last_edit_date": 1467208870, "creation_date": 1465138050, "answer_id": 37643200, "question_id": 37572628, "link": "https://stackoverflow.com/questions/37572628/statically-link-c-library-with-a-haskell-library/37643200#37643200", "title": "Statically link C++ library with a Haskell library", "body": "<p>Including a C or C++ library with a Haskell library is trivial once you know a few tricks.</p>\n\n<p>I got the core from this <a href=\"http://blog.ezyang.com/2010/06/setting-up-cabal-the-ffi-and-c2hs/\" rel=\"nofollow\">article</a>, though it seems to overcomplicate things. You can use cabal (currently 1.25) with a <code>Simple</code> build type (i.e. no special <code>Setup.hs</code>), no makefile, and no external tools like <code>c2hs</code>.</p>\n\n<p>To include symbols from a pure C library:</p>\n\n<ol>\n<li>In your cabal file, either add <code>Include-dirs: relative/path/to/headers/</code> or <code>Includes: relative/path/to/myheader.h</code>. </li>\n<li>Add <code>C-sources: relative/path/to/csources/c1.c, relative/path/to/csources/c2.c, etc</code>.</li>\n</ol>\n\n<p>There's a couple of extra bits for C++:</p>\n\n<ol start=\"3\">\n<li>You can add <code>.cpp</code> files to the <code>C-sources</code> field in the cabal file. </li>\n<li>On all functions in <code>.cpp</code> files that Haskell needs access to, add <code>extern \"C\"</code> to avoid name mangling.</li>\n<li>Surround all non-pure-C code in header files with <code>#ifdef __cplusplus ... #endif</code> (see n.m.'s answer).</li>\n<li>If you use the standard C++ library, you'll need to add <code>extra-libraries: stdc++</code> to your cabal file, and link with <code>g++</code> using <code>ghc-options: -pgmlg++</code>.</li>\n<li>You may have to fiddle a bit with the <em>order</em> that you list the <code>.c(pp)</code> files in the cabal file if you want dynamic linking (i.e. <code>cabal repl</code>) to work. See <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12152\" rel=\"nofollow\">this ticket</a> for more information.</li>\n</ol>\n\n<p>That's it! You can see a complete working example <a href=\"https://github.com/crockeea/CPPBindings\" rel=\"nofollow\">here</a> which works with both <code>stack</code> and <code>cabal</code>.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1826, "favorite_count": 5, "accepted_answer_id": 37643200, "answer_count": 2, "score": 12, "last_activity_date": 1467208870, "creation_date": 1464794086, "last_edit_date": 1495540949, "question_id": 37572628, "link": "https://stackoverflow.com/questions/37572628/statically-link-c-library-with-a-haskell-library", "title": "Statically link C++ library with a Haskell library", "body": "<p>Setup: I have a Haskell library <code>HLib</code> which makes calls to a C/C++ backend <code>CLib</code> for efficiency. The backend is small and specialized for use with <code>HLib</code>. The interface to <code>CLib</code> will <em>only</em> be exposed through <code>HLib</code>; <code>HLib</code> tests, <code>HLib</code> benchmarks and third party libraries depending on <code>HLib</code> will not make direct FFI calls to <code>CLib</code>. From the test/benchmark/3rd party lib perspective, <code>HLib</code> should be appear purely Haskell. This means in the cabal file sections for, e.g., <code>HLib</code> tests, there should be no references to <code>-lCLib</code>, <code>libCLib</code>, etc, only a <code>build-depends</code> on <code>HLib</code>, and that executables should not need to look for a dynamic <code>CLib</code> library. I need to be able to build and run all executables in <code>HLib</code> and third-party libs, as well as run <code>cabal repl</code> for development.</p>\n\n<p>Originally, <code>CLib</code> was written in pure C. Cabal has support for this case, and I can integrate <code>CLib</code> into <code>HLib</code> in precisely the manner described above by using <code>include-dirs</code>, <code>c-sources</code>, and <code>includes</code> fields in the cabal file.</p>\n\n<p><code>CLib</code> has evolved into a C++ library, which I couldn't figure out how to get cabal to integrate easily. Instead, I resorted to a makefile with custom build and Setup.hs, like <a href=\"http://codinginfinity.me/post/2015-04-18/haskell_and_cpp\" rel=\"nofollow noreferrer\">this</a>. You can see a small example of this method <a href=\"https://github.com/crockeea/CPPBindings\" rel=\"nofollow noreferrer\">here</a><sup>1,2</sup>.</p>\n\n<p>In that example, I can't run <code>cabal repl</code> in <code>HLib</code> because \"Loading archives not supported\". This really means I need a dynamic C++ library, which is simple enough to create (there's a commented line in the <code>CLib</code> makefile to do it). If I do make the dynamic C++ library, however, the test for <code>HLib</code> fails at runtime due to a \"no such file or directory libclib.so\". This is bad (in addition to the crash) because the test executable linked against the dynamic library, which is not what I want.</p>\n\n<p>Concretely, the tests for <code>HLib</code> and <code>SimpleLib</code> should both pass, and I should be able to run <code>cabal repl</code> in both the <code>hlib</code> and <code>simplelib</code> directories.</p>\n\n<p>Other things I've tried: <a href=\"https://stackoverflow.com/questions/23175371/statically-link-a-haskell-program-that-uses-c-wrapper-library\">this answer</a>, <a href=\"https://stackoverflow.com/a/18580540/925978\">this answer</a> (which I can't get to compile), <a href=\"https://ro-che.info/articles/2015-10-26-static-linking-ghc\" rel=\"nofollow noreferrer\">this</a>, and reading <a href=\"https://downloads.haskell.org/~ghc/7.10.3/docs/html/users_guide/using-shared-libs.html#idp46686512703504\" rel=\"nofollow noreferrer\">the docs</a> (results in \"relocation\" errors).</p>\n\n<p>I'm using GHC-7.10.3 at the moment, though if this is significantly easier in 8.0, that's fine.</p>\n\n<p><sup>[1]<sub> Simplified from <a href=\"https://github.com/cpeikert/lol/tree/challenges\" rel=\"nofollow noreferrer\">lol/challenges</a>.</sub></sup></p>\n\n<p><sup>[2]<sub> Download and run <code>./sandbox-init</code>. This builds <code>HLib</code> (which implicitly builds <code>CLib</code>, and <code>SimpleLib</code>, which is a Haskell library that depends on <code>HLib</code>.</sub></sup></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1464792875, "post_id": 37571939, "comment_id": 62631667, "body": "I think it is overkill to use regex in this case and go for a version that still uses <code>ByteString</code> you can implement something like <code>trim</code> trim easily with <code>Data.Char.isSpace</code> and <code>dropWhile</code> and <code>reverse</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464793124, "post_id": 37571939, "comment_id": 62631832, "body": "to get an idea where you find functions - use goo\u2026 uhm no - <a href=\"https://www.haskell.org/hoogle/?hoogle=isspace\" rel=\"nofollow noreferrer\">hoogle</a>"}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464793259, "post_id": 37571939, "comment_id": 62631932, "body": "@epsilonhalbe So in my case, given I already imported <code>Data.ByteString.Lazy</code> it would be <code>let body = Char8.unpack (r ^. responseBody)</code>? For me it yields: extip.hs:6:1: error:     Failed to load interface for `Data.BytesString.Lazy&#39;     Perhaps you meant       Data.ByteString.Lazy (from bytestring-0.10.8.1)       Data.ByteString.Lens (from lens-4.14)       Data.ByteString.Char8 (from bytestring-0.10.8.1)     Use -v to see a list of the files searched for. Failed, modules loaded: none."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464793930, "post_id": 37571939, "comment_id": 62632432, "body": "typo in import statement (&quot;BytesString&quot; -&gt; &quot;ByteString&quot;) - starts to look a bit better by now."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1464794446, "post_id": 37571939, "comment_id": 62632817, "body": "What a mess lol. Now I get: <code>ghci&gt; :t (unpack (r ^. responseBody))</code> -&gt; <code>(unpack (r ^. responseBody)) :: [GHC.Word.Word8]</code> Still not a String."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464795566, "post_id": 37571939, "comment_id": 62633602, "body": "<code>ByteString</code> is made of bytes, not characters! There&#39;s some module in the package that helps fake it a bit, but I think only for strict bytestrings."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 2, "creation_date": 1479988869, "post_id": 37571939, "comment_id": 68794234, "body": "terrible situation on the string front. module system so needed here.."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "reply_to_user": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1480072533, "post_id": 37571939, "comment_id": 68828269, "body": "@nicolas One would think a string specific type class could sort out the mess but no one ever bothered to write one."}], "answers": [{"comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1464797434, "post_id": 37573268, "comment_id": 62634762, "body": "Given: <code>let b1 = r ^. responseBody</code>, <code>decodeLatin1 b1</code> yields: &lt;interactive&gt;:119:14: error:     * Couldn&#39;t match expected type <code>Data.ByteString.ByteString&#39;                   with actual type </code>Data.ByteString.Lazy.ByteString&#39;       NB: <code>Data.ByteString.Lazy.ByteString&#39;             is defined in </code>Data.ByteString.Lazy.Internal&#39;           <code>Data.ByteString.ByteString&#39;             is defined in </code>Data.ByteString.Internal&#39;     * In the first argument of <code>decodeLatin1&#39;, namely </code>b1&#39;       In the expression: decodeLatin1 b1       In an equation for `it&#39;: it = decodeLatin1 b1"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1464798390, "post_id": 37573268, "comment_id": 62635360, "body": "It&#39;s not easy to see from the docs, but decodeLatin1 requires a <i>strict</i> ByteString. Use <code>toStrict</code> to convert the lazy string first."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 17, "last_activity_date": 1464795833, "creation_date": 1464795833, "answer_id": 37573268, "question_id": 37571939, "link": "https://stackoverflow.com/questions/37571939/data-bytestring-lazy-internal-bytestring-to-string/37573268#37573268", "title": "Data.ByteString.Lazy.Internal.ByteString to string?", "body": "<p>Short answer: Use <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Lazy-Char8.html#v:unpack\" rel=\"noreferrer\"><code>unpack</code></a> from Data.ByteString.Lazy.Char8</p>\n\n<p>Longer answer:</p>\n\n<p>In general when you want to convert a ByteString (of any variety) to a String or Text you have to specify an encoding - e.g. UTF-8 or Latin1, etc.</p>\n\n<p>When retrieving an HTML page the encoding you are suppose to use may appear in the Content-type header or in the response body itself as a <code>&lt;meta ...&gt;</code> tag.</p>\n\n<p>Alternatively you can just guess at what the encoding of the body is.</p>\n\n<p>In your case I presume you are accessing a site like <a href=\"http://whatsmyip.org\" rel=\"noreferrer\">http://whatsmyip.org</a> and you only need to parse out your IP address. So without examining the headers or looking through the HTML, a safe encoding to use would be Latin1.</p>\n\n<p>To convert ByteStrings to Text via an encoding, have a look at the functions in <a href=\"http://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text-Encoding.html\" rel=\"noreferrer\">Data.Text.Encoding</a></p>\n\n<p>For instance, the <code>decodeLatin1</code> function.</p>\n"}, {"comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 2, "creation_date": 1464796735, "post_id": 37573326, "comment_id": 62634352, "body": "What I want is to return a canonical type which does not produce extra work (such as this SO question here). Had Wreq returned String I would not have the trouble I am facing. If the language has no canonical string type, whenever libraries are used, such conversion problems arise. Call me old fashioned...but I prefer to stick to one canonical type at interface boundaries."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1464798292, "post_id": 37573326, "comment_id": 62635293, "body": "extip.hs:14:41: error:     * Couldn&#39;t match type <code>GHC.Word.Word8&#39; with </code>Char&#39;       Expected type: GHC.Word.Word8 -&gt; Bool         Actual type: Char -&gt; Bool     * In the first argument of <code>B.dropWhile&#39;, namely </code>isSpace&#39;       In the first argument of <code>(.)&#39;, namely </code>(B.dropWhile isSpace)&#39;       In the second argument of <code>(.)&#39;, namely         </code>(B.dropWhile isSpace) . Char8.reverse . (B.dropWhile isSpace)&#39; ..."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1464798676, "post_id": 37573326, "comment_id": 62635567, "body": "I think I fixed it - have no ghc at hand (as I already said)."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 4, "last_activity_date": 1464798545, "last_edit_date": 1464798545, "creation_date": 1464795998, "answer_id": 37573326, "question_id": 37571939, "link": "https://stackoverflow.com/questions/37571939/data-bytestring-lazy-internal-bytestring-to-string/37573326#37573326", "title": "Data.ByteString.Lazy.Internal.ByteString to string?", "body": "<p>I simply do not understand why you insist on using <code>String</code>s, when you have already a <code>ByteString</code> at hand that is the faster/more efficient implementation.\nImporting <code>regex</code> gives you almost no benefit - for parsing an ip-address I would use <code>attoparsec</code> which works great with <code>ByteString</code>s.</p>\n\n<p>Here is a version that does not use regex but returns a String - note I did not compile it for I have no haskell setup where I am right now.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule ExtIp (getExtIp) where\nimport Network.Wreq\nimport Control.Lens\nimport Data.ByteString.Lazy.Char8 as Char8\nimport Data.Char (isSpace)\n\ngetExtIp :: IO String\ngetExtIp = do\n    r &lt;- get \"http://myexternalip.com/raw\"\n    return $ Char8.unpack $ trim (r ^. responseBody)\n  where trim = Char8.reverse . (Char8.dropWhile isSpace) . Char8.reverse . (Char8.dropWhile isSpace)\n</code></pre>\n"}], "owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6685, "favorite_count": 3, "accepted_answer_id": 37573326, "answer_count": 2, "score": 13, "last_activity_date": 1464798545, "creation_date": 1464792295, "question_id": 37571939, "link": "https://stackoverflow.com/questions/37571939/data-bytestring-lazy-internal-bytestring-to-string", "title": "Data.ByteString.Lazy.Internal.ByteString to string?", "body": "<p>Trying to write a module which returns the external IP address of my computer.\nUsing <code>Network.Wreq</code> <code>get</code> function, then applying a lense to obtain <code>responseBody</code>, the type I end up with is <code>Data.ByteString.Lazy.Internal.ByteString</code>. As I want to filter out the trailing \"\\n\" of the result body, I want to use this for a regular expression subsequently.\nProblem: That seemingly very specific ByteString type is not accepted by regex library and I found no way to convert it to a <code>String</code>.</p>\n\n<p>Here is my feeble attempt so far (not compiling).</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule ExtIp (getExtIp) where\nimport Network.Wreq\nimport Control.Lens\nimport Data.BytesString.Lazy\nimport Text.Regex.Posix\n\ngetExtIp :: IO String\ngetExtIp = do\n    r &lt;- get \"http://myexternalip.com/raw\"\n    let body = r ^. responseBody\n    let addr = body =~ \"[^\\n]*\\n\"\n    return (addr)\n</code></pre>\n\n<p>So my question is obviously: How to convert that funny special ByteString to a <code>String</code>? Explaining how I can approach such a problem myself is also appreciated. I tried to use <code>unpack</code> and <code>toString</code> but have no idea what to import to get those functions if they exist.</p>\n\n<p>Being a very sporadic haskell user, I also wonder if someone could show me the idiomatic haskell way of defining such a function. The version I show here does not account for possible runtime errors/exceptions, after all.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464792227, "post_id": 37571413, "comment_id": 62631180, "body": "Thank you for your response. I did my main, like you said in first <code>main</code> and now my program enters into a kind of infinite loop , and prints elements that have been read from the keyboard :D."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 1, "creation_date": 1464792308, "post_id": 37571413, "comment_id": 62631241, "body": "@ClaudiuM: I had a mistake in my original version, wrote <code>cars = ... : cars</code>, which defines in fact an infinite list. Should be fixed now."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1464792838, "last_edit_date": 1464792838, "creation_date": 1464790912, "answer_id": 37571413, "question_id": 37571169, "link": "https://stackoverflow.com/questions/37571169/haskell-data-type-list/37571413#37571413", "title": "Haskell data type list", "body": "<p>First I'd recommend you actually <em>use</em> those type synonyms, if you define them at all:</p>\n\n<pre><code>data Car = Car Name Model Color Year Price Coin\n  deriving (Show)\n</code></pre>\n\n<p>Note that this is completely equivalent to declaring all fields <code>String</code> (because <code>Model</code> and <code>String</code> are just different names for exactly the same type), it's just clearer to read. Even clearer might be if you used <a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching#Introduction_to_records\" rel=\"nofollow\">record fields</a> for such a type, but that wouldn't make a difference here.</p>\n\n<p>Now to &ldquo;create&rdquo; a new car from some string properties, you want to <em>not</em> concatenate these properties to a list. Instead, just use the <code>Car</code> constructor and prepend <em>a single car</em> to the list.</p>\n\n<pre><code>main = do\n    putStrLn \"Car details \"\n    putStr \"Name: \"\n    name &lt;- getLine\n    ...\n    let cars' = Car name model color year price coin : cars\n    print cars'\n</code></pre>\n\n<p>In case you wonder: <code>Car foo bar baz : cars</code> is the same as <code>(Car foo bar baz) : (cars)</code>. In fact, <code>Car</code> is just used like any other function here; you could also define a helper function</p>\n\n<pre><code>redCar :: Name -&gt; Model -&gt; Year -&gt; Price -&gt; Coin -&gt; Car\nredCar n m y p c = Car n m \"red\" y p c\n</code></pre>\n\n<p>and then write</p>\n\n<pre><code>   print $ redCar name model year price coin : cars\n</code></pre>\n\n<p>OTOH, <code>[cars]</code> is <em>not</em> a list of cars that you could prepend another car to; rather it's a list <em>with a single element</em> (and that element is a list of cars).</p>\n\n<p>A different subject is how you <em>update</em> stuff in general, in Haskell. ErikR adresses how this can be done with recursion; I'd note that you <em>can</em> also have proper mutable variables in Haskell IO code. We generally avoid working in IO as much as possible, but if you actually write an interactive application then it's sensible enough:</p>\n\n<pre><code>import Data.IORef\n\nmain = do\n    knownCars &lt;- newIORef cars\n    putStrLn \"Car details \"\n    ...\n    modifyIORef knownCars $ Car name model color year price coin\n    print =&lt;&lt; readIORef cars\n</code></pre>\n\n<p>Then you can follow this with</p>\n\n<pre><code>    putStrLn \"Details of another car:\"\n    ...\n    modifyIORef knownCars $ Car name2 model2 color2 year2 price2 coin2\n</code></pre>\n\n<p>and actually have both cars added. Of course this only makes sense if the whole program is actually running in a loop. (&ldquo;Loop&rdquo; still meaning recursion, in fact.)</p>\n"}, {"comments": [{"owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464792664, "post_id": 37571624, "comment_id": 62631512, "body": "Hello! , thank you for your suggestion. Because for and while does not exist here, I have wondered how loops look like here, in Haskell, and now I got it, because of you :D. Also, I found an answer for my original question (above answer) ."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1464791495, "creation_date": 1464791495, "answer_id": 37571624, "question_id": 37571169, "link": "https://stackoverflow.com/questions/37571169/haskell-data-type-list/37571624#37571624", "title": "Haskell data type list", "body": "<p>As you probably have been told, Haskell \"variables\" are not mutable. That means you have to explicitly pass state around as a parameter in your loop.</p>\n\n<p>For example, this is a loop which will repeatedly ask the user for a color:</p>\n\n<pre><code>loop1 = do putStrLn \"Enter a color: \"\n           color &lt;- getLine\n           loop1\n</code></pre>\n\n<p>However, the users's input is not \"saved\" anywhere. The next step is to keep track of all of previous input as a parameter to the looping function:</p>\n\n<pre><code>loop2 colors = do putStrLn $ \"Previous colors: \" ++ show colors\n                  putStrLn \"Enter a color: \"\n                  color &lt;- getLine\n                  loop2 (color:colors)\n</code></pre>\n\n<p>Hopefully this helps.</p>\n"}], "owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 37571413, "answer_count": 2, "score": 1, "last_activity_date": 1464792838, "creation_date": 1464790278, "question_id": 37571169, "link": "https://stackoverflow.com/questions/37571169/haskell-data-type-list", "title": "Haskell data type list", "body": "<p>I am new to Haskell, and I want to make a program with lists. I want to read from keyboard next element, and append everything to my existing list. Because I used data types, I don't know how to add a new car with all those details, in my list named <code>cars</code>. \n  I know that sequence <code>let ls = name:model:color:year:price:coin:[cars]</code> is wrong and I have no ideea how to make it work. Can anyone give me an ideea about what can I do here please?</p>\n\n<pre><code>type Name = String\ntype Model = String\ntype Color= String\ntype Year = String\ntype Price = String\ntype Coin = String\ndata Car = Car String String String String String String deriving (Show)\ncars :: [Car]\ncars = [Car \"Range Rover\" \"Sport Supercharged\" \"Blue\" \"2015\" \"85790\" \"$\" ,  Car \"BMW\" \"4-Series\" \"Black\" \"2014\" \"65489\" \"$\"]\n\nmain = do\n    putStrLn \"Car details \"\n    putStr \"Name: \"\n    name &lt;- getLine\n    putStr \"Model: \"\n    model &lt;- getLine\n    putStr \"Color: \"\n    color &lt;- getLine\n    putStr \"Year: \"\n    year &lt;- getLine\n    putStr \"Price: \"\n    price &lt;- getLine\n    putStr \"Coin: \"\n    coin &lt;- getLine\n    let ls = name:model:color:year:price:coin:[cars]\n    putStrLn (show ls)\n</code></pre>\n"}, {"tags": ["haskell", "computer-science"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1464791598, "post_id": 37571156, "comment_id": 62630683, "body": "You can view base types as algebraic types with a lot of constructors, so eg 32 bit integers have 2^32 constructors."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1464793432, "post_id": 37571156, "comment_id": 62632063, "body": "What do you mean by &quot;base type&quot;?"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 1, "creation_date": 1464811970, "post_id": 37571156, "comment_id": 62642740, "body": "Is this question about ADTs or GADTs? They are not the same."}, {"owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1464830929, "post_id": 37571156, "comment_id": 62649298, "body": "@liminalisht I mentioned G.A.D.T&#39;s, I know they&#39;re not the same."}], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 5, "last_activity_date": 1464795204, "last_edit_date": 1464795204, "creation_date": 1464792496, "answer_id": 37572033, "question_id": 37571156, "link": "https://stackoverflow.com/questions/37571156/whats-the-difference-between-algebraic-data-types-and-base-types/37572033#37572033", "title": "What&#39;s the difference between algebraic data types and base types?", "body": "<p>I'm not sure if you mean regular <code>data</code> declarations vs. types like <code>Int</code> or generalized algebraic data types using the GADTs extension, so if this doesn't answer your question then please clarify.</p>\n\n<p>Normal <code>data</code> declarations let you create types that are a combination of products (this and that) and sums (this or that).</p>\n\n<p>Some examples are:</p>\n\n<pre><code>data Color = Red | Green | Blue                      -- a sum type\ndata Person = Person { name :: String, age :: Int }  -- a product type\ndata Address = Mail Street City Country | Email String -- both!\n</code></pre>\n\n<p>GADTs allow you to be more specific about the type of each constructor.  Here's my favorite example:</p>\n\n<pre><code>-- helper types to encode natural numbers\ndata Z     -- zero\ndata S n   -- successor\n\n-- a list that encodes its size in its type\ndata List a n where\n  Nil :: List a Z\n  Cons :: a -&gt; List a n -&gt; List a (S n)\n\n-- head that cannot be called on an empty list!\nhead :: List a (S n) -&gt; a\nhead (Cons h _) = h\n\n-- tail that cannot be called on a empty list!\ntail :: List a (S n) -&gt; List a n\ntail (Cons _ t) = t\n</code></pre>\n\n<p>Note that we cannot do this trick with normal data declarations like</p>\n\n<pre><code>data List a n = Nil | Cons a (List a n)\n</code></pre>\n\n<p>because there's no way to specify that <code>Nil</code>'s type is <code>List a Z</code> and that <code>Cons</code> increments the size of the list by one.</p>\n"}], "owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1464795204, "creation_date": 1464790239, "question_id": 37571156, "link": "https://stackoverflow.com/questions/37571156/whats-the-difference-between-algebraic-data-types-and-base-types", "title": "What&#39;s the difference between algebraic data types and base types?", "body": "<p>I understand what G.A.D.T's are, but what is the difference between G.A.D.T's and base types (in Haskell, or elsewhere)?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 1955, "user_id": 1211428, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c4514c5bec0f849d1a202dd4fb25a6dc?s=128&d=identicon&r=PG", "display_name": "zaquest", "link": "https://stackoverflow.com/users/1211428/zaquest"}, "edited": false, "score": 3, "creation_date": 1464787938, "post_id": 37570121, "comment_id": 62627653, "body": "You&#39;re trying to use <code>:+</code> constructor to concatenate two lists."}, {"owner": {"reputation": 1481, "user_id": 2885946, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/8CNNA.png?s=128&g=1", "display_name": "ryo", "link": "https://stackoverflow.com/users/2885946/ryo"}, "reply_to_user": {"reputation": 1955, "user_id": 1211428, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c4514c5bec0f849d1a202dd4fb25a6dc?s=128&d=identicon&r=PG", "display_name": "zaquest", "link": "https://stackoverflow.com/users/1211428/zaquest"}, "edited": false, "score": 0, "creation_date": 1464788311, "post_id": 37570121, "comment_id": 62627965, "body": "Thank you! I understand now."}], "answers": [{"comments": [{"owner": {"reputation": 1481, "user_id": 2885946, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/8CNNA.png?s=128&g=1", "display_name": "ryo", "link": "https://stackoverflow.com/users/2885946/ryo"}, "edited": false, "score": 0, "creation_date": 1464788602, "post_id": 37570384, "comment_id": 62628237, "body": "Thank you for your implementation!"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1464788309, "creation_date": 1464788309, "answer_id": 37570384, "question_id": 37570121, "link": "https://stackoverflow.com/questions/37570121/haskel-implementation-of-of-list/37570384#37570384", "title": "Haskel - Implementation of &lt;*&gt; of List", "body": "<p>as zaquest pointed out you are prepending instead of concatenating.</p>\n\n<p>So first implement a concat:</p>\n\n<pre><code>infixr 5 +:+\n(+:+) :: List a -&gt; List a -&gt; List a\nEmpty +:+ ys = ys\n(x :+ xs) +:+ ys = x :+ (xs +:+ ys)\n</code></pre>\n\n<p>and then use it instead in </p>\n\n<pre><code>(f :+ fs) &lt;*&gt; xs =  fmap f xs +:+  (fs &lt;*&gt; xs)\n</code></pre>\n\n<p>(PS: of course you can rename it - I thought <code>+:+</code> looked moste like <code>:+</code> here)</p>\n"}], "owner": {"reputation": 1481, "user_id": 2885946, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/8CNNA.png?s=128&g=1", "display_name": "ryo", "link": "https://stackoverflow.com/users/2885946/ryo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 37570384, "answer_count": 1, "score": 2, "last_activity_date": 1464788309, "creation_date": 1464787630, "question_id": 37570121, "link": "https://stackoverflow.com/questions/37570121/haskel-implementation-of-of-list", "title": "Haskel - Implementation of &lt;*&gt; of List", "body": "<p>I'd like to implement my list in Haskell.\nBut I can't do this. The implementation of <code>&lt;*&gt;</code> causes </p>\n\n<pre><code>data List a = a :+ (List a) | Empty deriving Show\ninfixr 9 :+\n\ninstance Functor List where\n  fmap _ Empty     = Empty\n  fmap f (a :+ xs) = f a :+ fmap f xs\n\ninstance Applicative List where\n  pure x           = x :+ Empty\n  Empty     &lt;*&gt; _  = Empty\n  (f :+ fs) &lt;*&gt; xs =  fmap f xs :+  (fs &lt;*&gt; xs) -- Error\n\nmain :: IO ()\nmain = do\n  print $ 1 :+ 2 :+ 3 :+ Empty\n  print $ fmap (^2) (1 :+ 2 :+ 3 :+ Empty)\n  print $ ((+1) :+ (*2) :+ (^2) :+ Empty) &lt;*&gt; (1 :+ 2 :+ 3 :+ Empty)\n</code></pre>\n\n<p>The error is</p>\n\n<p>Couldn't match expected type \u2018b\u2019 with actual type \u2018List b\u2019\n      \u2018b\u2019 is a rigid type variable bound by ...</p>\n"}, {"tags": ["haskell", "events", "behavior", "frp", "reactive-banana"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464788733, "post_id": 37569894, "comment_id": 62628352, "body": "I think most just <i>cheat</i> those into their events using <i>real word IO stuff</i> - for example <a href=\"https://hackage.haskell.org/package/reactive-banana-sdl-0.2.0/docs/src/Reactive-Banana-SDL.html#runSDLPump\" rel=\"nofollow noreferrer\">this</a> uses SDL-timers to pump in time - from what I understand you use similar things (your usual imperative/async/event-based <code>IO</code> stuff) to build your basis (see <a href=\"https://hackage.haskell.org/package/reactive-banana-1.1.0.1/docs/Reactive-Banana-Frameworks.html\" rel=\"nofollow noreferrer\">here</a>)"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1464805836, "post_id": 37569894, "comment_id": 62639568, "body": "I&#39;ve written a few examples of connecting FRP libraries to real world UI stuff. An <a href=\"http://stackoverflow.com/questions/15129677/simpler-alternative-libs-to-reactive-haskell/26112094#26112094\">example connecting reactive-banana to GLUT</a> demonstrates firing events from <i>real world IO stuff</i>. An <a href=\"http://stackoverflow.com/a/20677522/414413\">example connecting reactive-banana to gloss</a> demonstrates stepping events in an explicit event loop, but taking a detour through IO to use the existing support in <code>Reactive.Banana.Frameworks</code>."}], "answers": [{"comments": [{"owner": {"reputation": 550, "user_id": 2665006, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f5fc5207efb9ca551f6c5f3e4804beca?s=128&d=identicon&r=PG", "display_name": "phage", "link": "https://stackoverflow.com/users/2665006/phage"}, "edited": false, "score": 0, "creation_date": 1465247008, "post_id": 37587803, "comment_id": 62811959, "body": "Thank Heinrich for respond.  I have learned much from your work.  Much appreciated.  I have a follow-up question.  You refer to the flow and interconnection between events and behaviors as an event-network.  Is this same as a graph?"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "reply_to_user": {"reputation": 550, "user_id": 2665006, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f5fc5207efb9ca551f6c5f3e4804beca?s=128&d=identicon&r=PG", "display_name": "phage", "link": "https://stackoverflow.com/users/2665006/phage"}, "edited": false, "score": 0, "creation_date": 1465289534, "post_id": 37587803, "comment_id": 62826692, "body": "@phage Yes, they essentially mean the same thing. I do make a slight distinction: I usually use &quot;graph&quot; to refer to the Events, Behaviors and their connections, and &quot;network&quot; to refer to this <i>in conjunction</i> with the IO actions and registered event handlers. In other words, I think of the former as &quot;pure&quot; and the latter as &quot;impure&quot;. But it&#39;s really just a small distinction in nomenclature that I like to make to add a tad more precision when writing about it."}], "tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": false, "score": 3, "last_activity_date": 1464859657, "creation_date": 1464859657, "answer_id": 37587803, "question_id": 37569894, "link": "https://stackoverflow.com/questions/37569894/haskell-reactive-banana-frp-and-event-loop/37587803#37587803", "title": "Haskell Reactive-Banana FRP and event loop", "body": "<p>It is useful to keep in mind the distinction between FRP, which is concerned with building interesting <code>Event</code>s and <code>Behavior</code>s from basic ones, and platform specific \"glue code\", which provides a collection of basic <code>Event</code>s, like the current mouse position or keyboard presses.</p>\n\n<p>In the Reactive-Banana library, this distinction is reflected in the module structure, <code>Reactive.Banana.Combinators</code> is concerned with the first part, while <code>Reactive.Banana.Frameworks</code> is concerned with the second part.</p>\n\n<p>Now, understanding how the second part (basic <code>Events</code>) works is not important for understanding how the first part (FRP) works; in fact, different libraries may make very different implementation choices.</p>\n\n<p>That said, in the Reactive-Banana library, an event network is essentially a huge callback function that registers itself to external event sources (called <code>AddHandler</code> in the library). Whenever one of these external sources call the callback function, the latter will traverse the graph of <code>Event</code> and <code>Behavior</code> in dependency order, perform the necessary updates to internal state, and finally run the actions previously registered with <code>reactimate</code>.</p>\n\n<p>The magic of FRP is that the library user doesn't see any of these implementation details, though it is sometimes useful to know that \"event network = a huge callback function\".</p>\n"}], "owner": {"reputation": 550, "user_id": 2665006, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f5fc5207efb9ca551f6c5f3e4804beca?s=128&d=identicon&r=PG", "display_name": "phage", "link": "https://stackoverflow.com/users/2665006/phage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 3, "answer_count": 1, "score": 2, "last_activity_date": 1464859657, "creation_date": 1464787086, "question_id": 37569894, "link": "https://stackoverflow.com/questions/37569894/haskell-reactive-banana-frp-and-event-loop", "title": "Haskell Reactive-Banana FRP and event loop", "body": "<p>I am still trying to wrap my head around Haskell and FRP.  Specifically, I have worked through some examples using reactive-banana package and starting to get FRP.</p>\n\n<p>However, I still don't understand how the event network knows when an input event has occurred.  My understanding is that, unlike NodeJS which has an event loop constantly checking for user inputs, FRP utilizes a different framework for \"waiting\" or \"checking\" user inputs or external signals.</p>\n\n<p>From my reading, FRP makes time explicit.  By coupling time with either an event or behavior, somehow the network always knows when an external stimulus has fired.</p>\n\n<p>I have read many papers by Conal, Hudak, et al. and the explanations are too technical.  Please provide less technical explanation.</p>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["eclipse", "haskell", "ghc"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464772290, "post_id": 37563975, "comment_id": 62615888, "body": "AFAIK eclipseFP is not maintained anymore so you might be out of luck (see <a href=\"https://github.com/JPMoresmau/eclipsefp\" rel=\"nofollow noreferrer\">github.com/JPMoresmau/eclipsefp</a>)"}], "answers": [{"tags": [], "owner": {"reputation": 102407, "user_id": 2670892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4iPV5.png?s=128&g=1", "display_name": "greg-449", "link": "https://stackoverflow.com/users/2670892/greg-449"}, "is_accepted": false, "score": 2, "last_activity_date": 1464772479, "creation_date": 1464772479, "answer_id": 37564322, "question_id": 37563975, "link": "https://stackoverflow.com/questions/37563975/why-my-eclipse-doesnt-mark-the-reserverd-words-for-haskell/37564322#37564322", "title": "Why my Eclipse doesn&#39;t mark the reserverd words for Haskell?", "body": "<p>That looks like you are actually using the normal text editor.</p>\n\n<p>Close the file and then right click on the file in Project Explorer and choose 'Open With...' and select the Haskell editor.</p>\n\n<p>Eclipse remembers the last editor you used to open a file so if you had opened this file before installing the plug-in you will get the plain text editor. Once you have opened the file with the correct editor it will use that editor by default in future.</p>\n"}], "owner": {"reputation": 319, "user_id": 4989750, "user_type": "registered", "accept_rate": 48, "profile_image": "https://graph.facebook.com/10155683297590191/picture?type=large", "display_name": "BarneyL. BarStin", "link": "https://stackoverflow.com/users/4989750/barneyl-barstin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464772536, "creation_date": 1464771481, "last_edit_date": 1464772536, "question_id": 37563975, "link": "https://stackoverflow.com/questions/37563975/why-my-eclipse-doesnt-mark-the-reserverd-words-for-haskell", "title": "Why my Eclipse doesn&#39;t mark the reserverd words for Haskell?", "body": "<p>I've installed the plugin for Eclipse Luna: EclipseFP -  <a href=\"http://eclipsefp.sf.net/updates\" rel=\"nofollow noreferrer\">http://eclipsefp.sf.net/updates</a> . Its Works, but the IDE is not marking the reserved words.</p>\n\n<p><a href=\"https://i.stack.imgur.com/xeHef.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xeHef.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["algorithm", "haskell", "math", "prime-factoring"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464757917, "post_id": 37559798, "comment_id": 62608120, "body": "just switch <code>Int</code> to <code>Integer</code> everywhere - it&#39;s not the right answer but if I use your algorithm with just this changes and ask <code>pollard_rho 1724114033281923457</code> it gives me 1402015859 quite fast)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464758005, "post_id": 37559798, "comment_id": 62608162, "body": "the reason is probably that <code>x*(x-1)</code> overflows when using <code>Int</code>"}, {"owner": {"reputation": 2161, "user_id": 193622, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ccf61bd20c2f51314bee79769561200d?s=128&d=identicon&r=PG", "display_name": "ponkin", "link": "https://stackoverflow.com/users/193622/ponkin"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464758106, "post_id": 37559798, "comment_id": 62608202, "body": "@Carsten That works!! brilliant answer) I spent 2 days to find out what is wrong!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464758606, "post_id": 37559798, "comment_id": 62608409, "body": "I hope you don&#39;t mind if I move it into an answer then"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1464786058, "post_id": 37559798, "comment_id": 62626032, "body": "It&#39;s instructive in cases like this to remove the type annotations entirely and see what Haskell infers for the types."}, {"owner": {"reputation": 2161, "user_id": 193622, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ccf61bd20c2f51314bee79769561200d?s=128&d=identicon&r=PG", "display_name": "ponkin", "link": "https://stackoverflow.com/users/193622/ponkin"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1464789531, "post_id": 37559798, "comment_id": 62628998, "body": "@chepner I am relativly new in Haskell, and I am not sure what do you mean. Can you apply an example code?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1464821545, "post_id": 37559798, "comment_id": 62646981, "body": "@ponkin just put <code>-- </code> in front of lines of code like <code>func :: Int -&gt; Int -&gt; Int</code>."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 7, "last_activity_date": 1464758793, "creation_date": 1464758793, "answer_id": 37560095, "question_id": 37559798, "link": "https://stackoverflow.com/questions/37559798/fast-pollard-rho-factorization-in-haskell/37560095#37560095", "title": "Fast Pollard Rho factorization in Haskell", "body": "<p>as far as I can tell the problem seems to be possible overflows you get when the numbers get too big for <code>Int</code> - in this case most likely in the <code>x * x - 1</code> part of <code>func</code> (<code>Int</code> has a <code>maxBound</code> of 9223372036854775807 on my system)</p>\n\n<p>So the easiest option is just to switch to <code>Integer</code> everywhere as those are unbounded:</p>\n\n<pre><code>func :: Integer -&gt; Integer -&gt; Integer\n...\n\npollardStep :: Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer \n...\n\npollard_rho :: Integer -&gt; Integer\n...\n</code></pre>\n\n<p>this of course will make everything a bit slower though</p>\n"}], "owner": {"reputation": 2161, "user_id": 193622, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ccf61bd20c2f51314bee79769561200d?s=128&d=identicon&r=PG", "display_name": "ponkin", "link": "https://stackoverflow.com/users/193622/ponkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 2, "accepted_answer_id": 37560095, "answer_count": 1, "score": 5, "last_activity_date": 1464807060, "creation_date": 1464757295, "question_id": 37559798, "link": "https://stackoverflow.com/questions/37559798/fast-pollard-rho-factorization-in-haskell", "title": "Fast Pollard Rho factorization in Haskell", "body": "<p>I am trying to implement <a href=\"https://en.wikipedia.org/wiki/Pollard%27s_rho_algorithm\">Pollard Rho</a> factorization method in Haskell.\nHere is what I came to</p>\n\n<pre><code>func :: Int -&gt; Int -&gt; Int\nfunc x n = mod ( x * x - 1) n\n\npollardStep :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\npollardStep i k n x y\n      | d /= 1 &amp;&amp; d /= n = d\n      | i == k = pollardStep (i+1) (2*k) n x1 x1\n      | otherwise = pollardStep (i+1) k n x1 y\n      where d = gcd n $ abs $ y - x\n            x1 = func x n\n\npollard_rho :: Int -&gt; Int\npollard_rho n = pollardStep 1 2 n 2 2\n</code></pre>\n\n<p>This function if fine for small numbers like 8051.\nBut when I try to find factors for large numbers, for example, 1724114033281923457(I have checked, it is composite with factors 11363592254 and 1229739323) it takes forever(in that case function will never ends).\nWhat am I doing wrong? I would be very appreciate to any help.</p>\n"}, {"tags": ["haskell", "import", "module", "compiler-errors"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464752794, "post_id": 37559009, "comment_id": 62606536, "body": "You may like the beginning of <a href=\"http://stackoverflow.com/questions/8327032/write-this-scala-matrix-multiplication-in-haskell/8331995#8331995\">my answer to an apparently unrelated question</a>."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1464752641, "creation_date": 1464752641, "answer_id": 37559048, "question_id": 37559009, "link": "https://stackoverflow.com/questions/37559009/qualified-import-of-data-map-conflicts-with-prelude/37559048#37559048", "title": "Qualified import of Data.Map conflicts with Prelude", "body": "<p><code>import Data.Map as M</code> imports the names from Data.Map both qualified and unqualified.</p>\n\n<p>To only import qualified names use:</p>\n\n<pre><code>import qualified Data.Map as M\n</code></pre>\n"}], "owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 37559048, "answer_count": 1, "score": 3, "last_activity_date": 1464753408, "creation_date": 1464752318, "last_edit_date": 1464753408, "question_id": 37559009, "link": "https://stackoverflow.com/questions/37559009/qualified-import-of-data-map-conflicts-with-prelude", "title": "Qualified import of Data.Map conflicts with Prelude", "body": "<p>I'd like to use <code>Prelude.map</code> and <code>Data.Map.map</code> for different purposes in my code, but a qualified import of <code>Data.Map</code> doesn't seem to help:</p>\n\n<pre><code>Prelude&gt; import Data.Map as M\nPrelude M&gt; map\n\n&lt;interactive&gt;:3:1:\n    Ambiguous occurrence \u2018map\u2019\n    It could refer to either \u2018M.map\u2019\n                             imported from \u2018Data.Map\u2019\n                             (and originally defined in \u2018containers-0.5.0.0:Data.Map.Base\u2019)\n                          or \u2018Prelude.map\u2019\n                             imported from \u2018Prelude\u2019 (and originally defined in \u2018GHC.Base\u2019)\n</code></pre>\n\n<p>(I also took a <a href=\"http://i.stack.imgur.com/tZYXg.png\" rel=\"nofollow\">screenshot</a> of the error message, <a href=\"http://i.stack.imgur.com/tZYXg.png\" rel=\"nofollow\">which you can see here</a>.)</p>\n\n<p>I would like to be able to use <code>map</code> and <code>M.map</code> respectively; how can I do that?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 7, "creation_date": 1464751149, "post_id": 37558801, "comment_id": 62606097, "body": "Just make <code>dig</code> a higher order function and pass in the <code>cluster</code> and <code>classify</code> functions as arguments."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464752179, "post_id": 37558801, "comment_id": 62606374, "body": "the type of the variable <code>categories</code> seems to be different between <code>dig</code> and <code>dig&#39;</code> - is that right?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1464753670, "post_id": 37558801, "comment_id": 62606782, "body": "A cute trick you may like: <code>\\case Nothing -&gt; return (); Just p -&gt; e</code> may also be written <code>traverse_ (\\p -&gt; e)</code>."}, {"owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464753862, "post_id": 37558801, "comment_id": 62606832, "body": "@ErikR, you&#39;re right, the type of categories is different. In each case the type of <code>categories</code> is the type returned by the <code>classify</code> function. The difference is handled in the <code>cluster</code> function"}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "edited": false, "score": 0, "creation_date": 1464885542, "post_id": 37568476, "comment_id": 62680068, "body": "what do you think of the solution I was able to come up with?"}], "tags": [], "owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "is_accepted": false, "score": 1, "last_activity_date": 1464783599, "creation_date": 1464783599, "answer_id": 37568476, "question_id": 37558801, "link": "https://stackoverflow.com/questions/37558801/generalizing-functions-in-haskell/37568476#37568476", "title": "Generalizing functions in Haskell", "body": "<p>My method was to let the compiler do most of the thinking for me.  First, I took the common code and made it its own function</p>\n\n<pre><code>dig'' classifier =\n  await &gt;&gt;= \\case\n    Nothing -&gt; return ()\n    Just ( Cluster clusterKey clusterValue ) -&gt; do\n      categories &lt;- liftIO $ classify classifier clusterValue\n      if (length clusterValue == length categories)\n        then do\n          yield $ Cluster clusterKey clusterValue\n          dig'' classifier\n        else do\n          mapM_ (yield . cluster) categories\n          dig'' classifier\n</code></pre>\n\n<p>This lead to a couple of problems.  First, the compiler whines that <code>cluster</code> and <code>classify</code> are undefined, so we'll need to add them onto the function as parameters.  You'll also notice that classifier is never used outside of the classify function, so we'll combine them into one value.  Also, since we've changed the parameters of our function, our recursive calls change, so we'll need to take care of those.</p>\n\n<pre><code>dig'' cluster =\n  await &gt;&gt;= \\case\n    Nothing -&gt; return ()\n    Just ( Cluster clusterKey clusterValue ) -&gt; do\n      categories &lt;- liftIO $ classify clusterValue\n      if (length clusterValue == length categories)\n        then do\n          yield $ Cluster clusterKey clusterValue\n          dig'' cluster classify\n        else do\n          mapM_ (yield . cluster) categories\n          dig'' cluster classify\n</code></pre>\n\n<p>Here's where I noticed that the <code>cluster</code> in the where clause needed <code>clusterKey</code>, so it will need to be passed in as a parameter somehow.</p>\n\n<pre><code>dig'' cluster =\n  await &gt;&gt;= \\case\n    Nothing -&gt; return ()\n    Just ( Cluster clusterKey clusterValue ) -&gt; do\n      categories &lt;- liftIO $ classify clusterValue\n      if (length clusterValue == length categories)\n        then do\n          yield $ Cluster clusterKey clusterValue\n          dig'' cluster classify\n        else do\n          mapM_ (yield . cluster clusterKey) categories\n          dig'' cluster classify\n</code></pre>\n\n<p>Finally, use a type hole to let ghc figure out the data type for me.</p>\n\n<pre><code>dig'' :: _\ndig'' cluster =\n  await &gt;&gt;= \\case\n    Nothing -&gt; return ()\n    Just ( Cluster clusterKey clusterValue ) -&gt; do\n      categories &lt;- liftIO $ classify clusterValue\n      if (length clusterValue == length categories)\n        then do\n          yield $ Cluster clusterKey clusterValue\n          dig'' cluster classify\n        else do\n          mapM_ (yield . cluster clusterKey) categories\n          dig'' cluster classify\n</code></pre>\n\n<p>I got a value of </p>\n\n<pre><code>(Foldable t, MonadIO m) =&gt;\n ([a] -&gt; a1 -&gt; Cluster a b)\n -&gt; ([b] -&gt; IO (t a1)) -&gt; Conduit (Cluster a b) m (Cluster a b)\n</code></pre>\n\n<p>but your results may differ, since I largely made up all my data types.  For example, I suspect that the <code>[a]</code> and <code>[b]</code> will be different for your code.</p>\n\n<p>Now, to get back to the original functions.  Here we have the advantage of already knowing the types for our result.</p>\n\n<pre><code>dig :: MappingClassifierM FileSummary IO Partitioner -&gt; Conduit (Cluster Partitioner FileSummary) IO (Cluster Partitioner FileSummary)\ndig classifier = dig'' ????\n</code></pre>\n\n<p>Now we just need the two parameters for <code>dig''</code>. The first parameter is just filling in for the <code>cluster</code> definition, so we get</p>\n\n<pre><code>(\\clusterKey (key, val) -&gt; Cluster (key : clusterKey) val)\n</code></pre>\n\n<p>The second parameter was classify, to which we'd rolled in the classifier, so it's simply\n    (classifyM classifier)</p>\n\n<p>Thus, the final definition is </p>\n\n<pre><code>dig :: MappingClassifierM FileSummary IO Partitioner -&gt; Conduit (Cluster Partitioner FileSummary) IO (Cluster Partitioner FileSummary)\ndig classifier = dig'' (\\clusterKey (key, val) -&gt; Cluster (key : clusterKey) val) (classifyM classifier)\n</code></pre>\n\n<p>Similarly, you can also find</p>\n\n<pre><code>dig' :: BinaryClassifierM FileSummary IO -&gt; Conduit (Cluster Partitioner FileSummary) IO (Cluster Partitioner FileSummary)\ndig' classifier = dig'' (\\clusterKey -&gt; Cluster (Content : clusterKey)) (classifyBinary classifier)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "edited": false, "score": 0, "creation_date": 1464886216, "post_id": 37597517, "comment_id": 62680460, "body": "I&#39;d thought about creating a typeclass, but I tend to do that too often and I&#39;ve been trying to break the habit, so I didn&#39;t for my solution.  I like that you moved <code>dig classifier</code> out of the conditional.  I wish that I&#39;d remembered to do that on my own.  I&#39;m not a big fan of using <code>when x</code> followed by <code>when (not x)</code>, instead of just using an if statement, but that&#39;s probably a matter of taste.  My only other comment is that you&#39;ve included the classifier in the type definition for cluster, but neither of your cluster instances are using it.  Will you need it later?"}, {"owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "reply_to_user": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "edited": false, "score": 0, "creation_date": 1464894972, "post_id": 37597517, "comment_id": 62685493, "body": "@user640078  I didn&#39;t want to include the classifier in the type definition of cluster, but I was having issues with the compiler if I didn&#39;t:  <code>Could not deduce (Classifier classifier0 FileSummary m0 c) arising from a use of \u2018cluster\u2019 from the context (Classifier classifier FileSummary IO c). The type variables \u2018classifier0\u2019, \u2018m0\u2019 are ambiguous</code>.   Is there any other way to let the compiler know what instance to choose?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464911434, "post_id": 37597517, "comment_id": 62692385, "body": "FYI, when using fundeps like that you should generally put the &quot;determining&quot; parameter last instead of first. As well as being idiomatic, it lets your class work with generalized newtype deriving."}], "tags": [], "owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "is_accepted": false, "score": 1, "last_activity_date": 1464885464, "creation_date": 1464885464, "answer_id": 37597517, "question_id": 37558801, "link": "https://stackoverflow.com/questions/37558801/generalizing-functions-in-haskell/37597517#37597517", "title": "Generalizing functions in Haskell", "body": "<p>I was able to find an alternative solution using classes allowing some language extensions:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nclass Classifier classifier a m c | classifier -&gt; m c where\n  classify :: (Monad m) =&gt; classifier -&gt; [a] -&gt; m [c]\n  cluster :: classifier -&gt; [Partitioner] -&gt; c -&gt; Cluster Partitioner a\n\ninstance Classifier (MappingClassifierM FileSummary IO Partitioner) FileSummary IO (P\n  classify = classifyM\n  cluster _ x (key, val) = Cluster (key : x) val\n\ninstance Classifier (BinaryClassifierM FileSummary IO) FileSummary IO [FileSummary] w\n  classify = classifyBinary\n  cluster _ clusterKey = Cluster (Content : clusterKey)\n\ndig :: (Classifier classifier FileSummary IO c) =&gt; classifier -&gt; Conduit (Cluster Par\ndig classifier =\n  await &gt;&gt;= \\case\n    Nothing -&gt; return ()\n    Just ( Cluster clusterKey clusterValue ) -&gt; do\n      categories &lt;- liftIO $ classify classifier clusterValue\n\n      when (length clusterValue == length categories) $\n        yield $ Cluster clusterKey clusterValue\n\n      when (length clusterValue /= length categories) $\n        mapM_ (yield . (cluster classifier clusterKey)) categories\n\n      dig classifier\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1464885464, "creation_date": 1464750864, "question_id": 37558801, "link": "https://stackoverflow.com/questions/37558801/generalizing-functions-in-haskell", "title": "Generalizing functions in Haskell", "body": "<p>These two functions are almost identical:</p>\n\n<pre><code>dig :: MappingClassifierM FileSummary IO Partitioner -&gt; Conduit (Cluster Partitioner FileSummary) IO (Cluster Partitioner FileSummary)\ndig classifier =\n  await &gt;&gt;= \\case\n    Nothing -&gt; return ()\n    Just ( Cluster clusterKey clusterValue ) -&gt; do\n      categories &lt;- liftIO $ classify classifier clusterValue\n      if (length clusterValue == length categories)\n        then do\n          yield $ Cluster clusterKey clusterValue\n          dig classifier\n        else do\n          mapM_ (yield . cluster) categories\n          dig classifier\n      where\n        cluster (key, val) = Cluster (key : clusterKey) val\n        classify = classifyM\n\ndig' :: BinaryClassifierM FileSummary IO -&gt; Conduit (Cluster Partitioner FileSummary) IO (Cluster Partitioner FileSummary)\ndig' classifier =\n  await &gt;&gt;= \\case\n    Nothing -&gt; return ()\n    Just ( Cluster clusterKey clusterValue ) -&gt; do\n      categories &lt;- liftIO $ classify classifier clusterValue\n      if (length clusterValue == length categories)\n        then do\n          yield $ Cluster clusterKey clusterValue\n          dig' classifier\n        else do\n          mapM_ (yield . cluster) categories\n          dig' classifier\n      where\n        cluster = Cluster (Content : clusterKey)\n        classify = classifyBinary\n</code></pre>\n\n<p>The only difference is in the the functions defined in the <em>where</em> clause. </p>\n\n<p>The following constraints apply:</p>\n\n<ul>\n<li>The <code>classify</code> function depends on the \"type\" of the classifier that is being passed as first parameter.</li>\n<li>The <code>cluster</code> function depends on the actual implementation of the classifier.</li>\n</ul>\n\n<p>I want to generalize the two functions so as to create a single function that handles both implementations to avoid duplication. </p>\n\n<p>I don't know if I'm on the right direction. Based on my limited knowledge of Haskell so far, I'd think that I have to create a class \"Classifier\", for which BinaryClassifier and MappingClassifierM would be instances of, but I'm facing with several compilation errors when I try to implement it.</p>\n\n<p>So, my question is: How do an experienced Haskell programmer generalize these two functions to avoid duplication?</p>\n\n<p>For additional context, below are the the relevant type signatures for the two different cases I'm trying to generalize:</p>\n\n<pre><code>type MappingClassifierM a m k = a -&gt; m k\nclassifyM :: (Monad m, Ord k) =&gt; MappingClassifierM a m k -&gt; [a] -&gt; m [(k, [a])]\ndig :: MappingClassifierM FileSummary IO Partitioner -&gt; Conduit (Cluster Partitioner FileSummary) IO (Cluster Partitioner FileSummary)\n\ntype BinaryClassifierM a m = a -&gt; a -&gt; m Bool\nclassifyBinary :: Monad m =&gt; BinaryClassifierM a m -&gt; [a] -&gt; m [[a]]\ndig' :: BinaryClassifierM FileSummary IO -&gt; Conduit (Cluster Partitioner FileSummary) IO (Cluster Partitioner FileSummary)\n</code></pre>\n"}, {"tags": ["c++", "haskell", "computer-science"], "comments": [{"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 1, "creation_date": 1464744757, "post_id": 37557938, "comment_id": 62604627, "body": "You could do worse than looking up on Wikipedia: <a href=\"https://en.wikipedia.org/wiki/Polymorphism_%28computer_science%29\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Polymorphism_%28computer_science%29</a>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1464746306, "post_id": 37557938, "comment_id": 62604977, "body": "Haskell has <i>parametric polymorphism</i>, where you have functions that work identically over multiple types, e.g. <code>length :: [a] -&gt; Int</code> works for lists of Strings, lists of Doubles, etc.  All you need is a single definition, as a parametrically polymorphic value doesn&#39;t care about what the parameter is, just where it&#39;s used.  It also has typeclasses which it uses for <i>ad hoc polymorphism</i>, functions where the implementation is type dependant, e.g. <code>show :: Show a =&gt; a -&gt; String</code> is a family of functions each with its own definition: <code>show :: Int -&gt; String, show :: Double -&gt; String, ...</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1886, "user_id": 1698143, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5bd39afbb0ffd37a0ad4aaa51002370e?s=128&d=identicon&r=PG", "display_name": "Failed Scientist", "link": "https://stackoverflow.com/users/1698143/failed-scientist"}, "edited": false, "score": 0, "creation_date": 1464744142, "post_id": 37557947, "comment_id": 62604491, "body": "Last paragraph is gold!!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2486888"}, "edited": false, "score": 0, "creation_date": 1464744549, "post_id": 37557947, "comment_id": 62604572, "body": "What about &quot;compile-time polymorphism&quot;?"}, {"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 0, "creation_date": 1464744726, "post_id": 37557947, "comment_id": 62604618, "body": "@NickyC: There are two kinds of compile-time polymorphism in C++: the kind that is an optimization because the compiler sees which implementation needs to be invoked, and the kind that is a language feature using template metaprogramming.  The first still relies on <code>virtual</code> methods but improves performance; the second relies on programming using types explicitly."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2486888"}, "edited": false, "score": 1, "creation_date": 1464745132, "post_id": 37557947, "comment_id": 62604697, "body": "Actually, I am suggesting, the existence of the term &quot;compile-time polymorphism&quot; may be a counter-example to your answer. Your description of <i>polymorphism</i> seems more about <i>dynamic dispatch</i>, rather than the term &quot;polymorphism&quot; which has  a broader meaning."}, {"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 0, "creation_date": 1464745339, "post_id": 37557947, "comment_id": 62604750, "body": "@NickyC: Sure, that&#39;s why I gave a nod to it in my answer by saying &quot;Often not known at compile time.&quot;  But the OP is a novice, so this discussion is basically off-topic for the given question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2486888"}, "edited": false, "score": 0, "creation_date": 1464745895, "post_id": 37557947, "comment_id": 62604875, "body": "I would say the &quot;often&quot;-clause looks like an underemphasis to some readers. And I would question the off-topic-ness due to the clause <i>whether overloading is or is not a form of polymorphism</i> in the original question."}], "tags": [], "owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "is_accepted": false, "score": 4, "last_activity_date": 1464744096, "last_edit_date": 1464744096, "creation_date": 1464743614, "answer_id": 37557947, "question_id": 37557938, "link": "https://stackoverflow.com/questions/37557938/what-is-the-difference-between-polymorphism-and-overloading/37557947#37557947", "title": "What is the difference between polymorphism and overloading?", "body": "<p>Polymorphism: one method which has multiple implementations depending on the type of the argument(s) with which it is invoked.  Often not known at compile time.  The number of arguments is fixed, and in C++ the only argument whose type matters is the first one (<code>this</code>).  In C++ the common version of this requires a base class with <code>virtual</code> methods.</p>\n\n<p>Overloading: one name which is actually multiple methods depending on the count and type of the argument(s) with which it is invoked.  Always decided at compile time.  No base class is involved.</p>\n\n<p>If you'd like an analogy: polymorphism is when you hire a dozen specialist mechanics to work on cars, and each one of them has functions like <code>do_work(vehicle)</code> and <code>take_vacation(duration)</code>.  Each one does something different but they all have the same signature apart from the \"implicit this\" argument in C++ (aka <code>self</code> in Python, etc.).  Overloading is when you hire generalist mechanics and each one of them has <code>do_work(steering)</code>, <code>do_work(lighting)</code>, <code>do_work(engine)</code>, etc.</p>\n"}, {"comments": [{"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 2, "creation_date": 1464743645, "post_id": 37557948, "comment_id": 62604364, "body": "C++ also has &quot;static polymorphism&quot; which is not overloading."}, {"owner": {"reputation": 1886, "user_id": 1698143, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5bd39afbb0ffd37a0ad4aaa51002370e?s=128&d=identicon&r=PG", "display_name": "Failed Scientist", "link": "https://stackoverflow.com/users/1698143/failed-scientist"}, "reply_to_user": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 0, "creation_date": 1464744094, "post_id": 37557948, "comment_id": 62604479, "body": "@JohnZwinck I meant its one type of static polymorphism. But thanks for drawing attention there. I have updated it"}, {"owner": {"reputation": 31438, "user_id": 908939, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/etRsI.jpg?s=128&g=1", "display_name": "Trevor Hickey", "link": "https://stackoverflow.com/users/908939/trevor-hickey"}, "edited": false, "score": 0, "creation_date": 1464750241, "post_id": 37557948, "comment_id": 62605881, "body": "I don&#39;t think all function overloading is a type of dynamic polymorphism. A compiler must resolve non-virtual function overloads at compile time."}, {"owner": {"reputation": 1886, "user_id": 1698143, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5bd39afbb0ffd37a0ad4aaa51002370e?s=128&d=identicon&r=PG", "display_name": "Failed Scientist", "link": "https://stackoverflow.com/users/1698143/failed-scientist"}, "reply_to_user": {"reputation": 31438, "user_id": 908939, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/etRsI.jpg?s=128&g=1", "display_name": "Trevor Hickey", "link": "https://stackoverflow.com/users/908939/trevor-hickey"}, "edited": false, "score": 0, "creation_date": 1464756300, "post_id": 37557948, "comment_id": 62607521, "body": "@TrevorHickey I think you have misread my comment. I mean overloading is one of different types of <b>static</b> polymorphism (<i>templates, function pointers being others one</i>) I have added screenshot in answer to further elaborate it"}], "tags": [], "owner": {"reputation": 1886, "user_id": 1698143, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5bd39afbb0ffd37a0ad4aaa51002370e?s=128&d=identicon&r=PG", "display_name": "Failed Scientist", "link": "https://stackoverflow.com/users/1698143/failed-scientist"}, "is_accepted": false, "score": 1, "last_activity_date": 1464756195, "last_edit_date": 1495540727, "creation_date": 1464743622, "answer_id": 37557948, "question_id": 37557938, "link": "https://stackoverflow.com/questions/37557938/what-is-the-difference-between-polymorphism-and-overloading/37557948#37557948", "title": "What is the difference between polymorphism and overloading?", "body": "<p>Overloading is a subset of Polymorphism. Polymorphism is of two types: On run-time and compile-time. Overloading belongs to the latter one (<em>there are some other facets of compile-time/static polymorphism as well like <strong>templates</strong>, <strong>function pointers</strong></em>)</p>\n\n<p>Usually authors refer Polymorphism to the one done on the Run-time (<em>unless specified</em>) and if you are talking about that Polymorphism, then clearly <em>that</em> one is done on runtime (<em>John's answer already drew the basic differences w.r.t <strong>inheritance/virtual function</strong> in his answer there</em>) and overloading is done on compile time when your function parameters determine which overload to be called.</p>\n\n<p><strong>Overloading - Static Polymorphism</strong> <em>(Demonstration)</em></p>\n\n<p>Following screenshot can demonstrate how function overloading is static (<em>resolved before run time</em>)</p>\n\n<p><a href=\"https://i.stack.imgur.com/fT6zz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fT6zz.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>P.S</strong></p>\n\n<p>In case, you would like to see, this is a related question about <a href=\"https://stackoverflow.com/questions/28122037/overloaded-virtual-function-in-virtual-inheritance\">overloading and virtual functions</a></p>\n"}, {"tags": [], "owner": {"reputation": 374839, "user_id": 734069, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a356923f858fbe363dad1dc566837fc6?s=128&d=identicon&r=PG", "display_name": "Nicol Bolas", "link": "https://stackoverflow.com/users/734069/nicol-bolas"}, "is_accepted": true, "score": 8, "last_activity_date": 1464750911, "last_edit_date": 1464750911, "creation_date": 1464749731, "answer_id": 37558649, "question_id": 37557938, "link": "https://stackoverflow.com/questions/37557938/what-is-the-difference-between-polymorphism-and-overloading/37558649#37558649", "title": "What is the difference between polymorphism and overloading?", "body": "<p>Polymorphism, at its core, is about multiple things which all have a certain set of consistent behavior, such that you can replace one with another within a particular algorithm or process. So long as they all provide the expected interface, the process still works.</p>\n\n<p>Overloading doesn't really have such a foundation. It is merely the ability to name two or more functions with the same name, so long as they have different parameter lists. The compiler figure out which function you actually meant based on the types of the arguments you pass.</p>\n\n<p>Now overloading can be used to create polymorphism. Consider the following:</p>\n\n<pre><code>template&lt;typename T&gt;\nvoid func(T t) {call(t);}\n</code></pre>\n\n<p>This will call <code>call</code>, passing <code>t</code> as a parameter. This will work so long as you provide a type <code>T</code> for which <code>call(t)</code> is legitimate C++ code. You could do this by overloading the function <code>call</code> for whatever types you are interested in using with <code>func</code>:</p>\n\n<pre><code>void call(int);\nvoid call(float);\nvoid call(vector&lt;int&gt;);\n</code></pre>\n\n<p>In this way, <code>func</code> is a function which is polymorphic (statically) with respect to its parameter. It can perform its operation on any type, so long as that type has the appropriate interface. That interface being the ability to call a function <code>call</code> with a variable of that type.</p>\n\n<pre><code>func(5); //Legal\nfunc(13.4); //Legal\nfunc(vector&lt;int&gt;{4, 3, 2, 1}); //Legal\nfunc(vector&lt;float&gt;{}); //NOT legal\n</code></pre>\n\n<p>Here, we use function overloading of <code>call</code> to create a form of polymophism through the <code>func</code> function. But this does not mean that overloading <em>is</em> polymorphism.</p>\n\n<p>Overloading is a language tool. Polymorphism is a concept. Polymorphism is about making multiple objects all work the same way. Overloading is just a way to give different functions the same name.</p>\n"}], "owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1601, "favorite_count": 1, "accepted_answer_id": 37558649, "answer_count": 3, "score": 10, "last_activity_date": 1464756195, "creation_date": 1464743500, "question_id": 37557938, "link": "https://stackoverflow.com/questions/37557938/what-is-the-difference-between-polymorphism-and-overloading", "title": "What is the difference between polymorphism and overloading?", "body": "<p>I understand polymorphism and vaguely understand overloading, but would appreciate someone that thoroughly understands there two concepts to explain what the categorical difference is and whether overloading is or is not a form of polymorphism (seems to be disagreement about this).</p>\n"}, {"tags": ["haskell", "amazon-s3"], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1464733570, "creation_date": 1464733570, "question_id": 37556648, "link": "https://stackoverflow.com/questions/37556648/s3-request-signing-with-amazonka", "title": "S3 request signing with amazonka", "body": "<p>Does <a href=\"http://brendanhay.nz/amazonka-doc/\" rel=\"nofollow\"><code>amazonka</code></a> have any API to generate v4 authorization headers for <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/API/sig-v4-header-based-auth.html\" rel=\"nofollow\"><code>S3 request</code> as documented here</a>? I couldn't find any when I looked - so, asking here. The reason I am asking is because I will like to make streaming <code>REST</code> request to <code>S3</code> using <code>pipes</code> libraries. <code>amazonka</code> seems to be using <code>conduit</code> for underlying <code>request</code> and <code>response</code> bodies. So, I am hoping to re-use the core <code>authorization</code> header generation work already done in <code>amazonka</code>, and use <code>pipes</code> libraries for streaming REST requests.</p>\n"}, {"tags": ["haskell", "type-inference"], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 1, "creation_date": 1464733114, "post_id": 37556517, "comment_id": 62601776, "body": "Does this mean that I must use <code>data</code> or <code>newtype</code> here?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1464733644, "post_id": 37556517, "comment_id": 62601970, "body": "@rityzmon I think so, for the moment."}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1464734117, "post_id": 37556517, "comment_id": 62602105, "body": "Thanks. So I&#39;m confused then. Why would the compiler allow a type synonym like <code>type R a = Int</code> when the <code>a</code> cannot be used?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1464734338, "post_id": 37556517, "comment_id": 62602179, "body": "It&#39;s not very useful, but why forbid it?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1464734347, "post_id": 37556517, "comment_id": 62602182, "body": "@rityzmon What do you mean? <code>R Char</code> can be used, as <code>R b</code> can be, but they both mean <code>Int</code>. The fact that <code>b</code> is not determined is another issue."}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1464734412, "post_id": 37556517, "comment_id": 62602195, "body": "@augustss Because <code>a</code> cannot possibly serve any purpose. If it wasn&#39;t allowed, I probably would&#39;ve figured out why my code didn&#39;t work."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 1, "creation_date": 1464734600, "post_id": 37556517, "comment_id": 62602266, "body": "@rityzmon But a signature like <code>C a =&gt; Proxy a -&gt; R a</code> is perfectly fine."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1464734701, "post_id": 37556517, "comment_id": 62602301, "body": "Would you also forbid <code>f a = 5</code>?  The <code>a</code> cannot serve any purpose."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 1, "creation_date": 1464734782, "post_id": 37556517, "comment_id": 62602331, "body": "@rityzmon Also note that the type error is telling: it tells that the <code>a</code> variable is ambiguous w.r.t. the constraints. It explicitly says that this is a problem of the signature, and not the actual code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1464737942, "post_id": 37556517, "comment_id": 62603101, "body": "The real problem, IMO, is that Haskell beginners are learning about type synonyms. Type synonyms are rarely actually useful to beginners, even though they tend to expect them to be."}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464764815, "post_id": 37556517, "comment_id": 62611284, "body": "@dfeuer Yes, you&#39;re right. My central mistake in this question was that I thought the <code>a</code> in <code>R a</code> of <code>f :: forall a. MyType a =&gt; Int -&gt; R a</code> could be meaningfully used in the implementation just like a <i>phantom type</i>. But apparently not. It is just dropped when the synonym is substituted."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1464733314, "last_edit_date": 1464733314, "creation_date": 1464732929, "answer_id": 37556517, "question_id": 37556296, "link": "https://stackoverflow.com/questions/37556296/how-to-use-replace-proxy-proxy-a-with-type-mytype-a-int-with-a-as-pha/37556517#37556517", "title": "How to use replace `Proxy :: Proxy a` with `type MyType a = Int` with `a` as phantom type", "body": "<p>Type synonyms are completely equivalent to their expansions: <code>R Int ~ R Bool ~ R Char ~ Int</code>. So, you are actually using the type</p>\n\n<pre><code>f :: forall a. MyType a =&gt; Int -&gt; Int\n</code></pre>\n\n<p>which is inherently ambiguous, since the type variable <code>a</code> is used only in the constraint.</p>\n\n<p>In particular, if <code>T</code> is a <code>data</code> or <code>newtype</code>, then the compiler can simplify a type equality constraint <code>T a ~ T b</code> and deduce <code>a ~ b</code>. </p>\n\n<p>With type families, this is no longer true since they can be non injective (albeit there is a GHC 8.0 extension which can deal properly with injectivity). </p>\n\n<p>With type synomyms, this is also not true in general. Given <code>T a ~ T b</code> we expand the synonym <code>T</code> before proceeding further: if <code>a</code> and <code>b</code> disappear in this step nothing can be inferred about them.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 1, "accepted_answer_id": 37556517, "answer_count": 1, "score": 1, "last_activity_date": 1464733314, "creation_date": 1464731868, "last_edit_date": 1464732935, "question_id": 37556296, "link": "https://stackoverflow.com/questions/37556296/how-to-use-replace-proxy-proxy-a-with-type-mytype-a-int-with-a-as-pha", "title": "How to use replace `Proxy :: Proxy a` with `type MyType a = Int` with `a` as phantom type", "body": "<p>While playing with types in Haskell, I came up with the following:</p>\n\n<pre><code>class    MyType a    where typeVal :: Proxy a -&gt; Int\ninstance MyType Int  where typeVal _ = 1\ninstance MyType Char where typeVal _ = 2\n\ng :: MyType a =&gt; Int -&gt; Proxy a -&gt; Int\ng x p = x + typeVal p\n</code></pre>\n\n<p>This works as expected. Then, I got the idea that perhaps I can have the function return a custom type in place of having to pass in a <code>Proxy</code>:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\ntype R a = Int\n\nf :: forall a. MyType a =&gt; Int -&gt; R a\nf x = x + typeVal (Proxy :: Proxy a)\n</code></pre>\n\n<p>I thought this would work but it doesn't. I get the error:</p>\n\n<pre><code>Could not deduce (MyType a0)\nfrom the context (MyType a)\n  bound by the type signature for f :: MyType a =&gt; Int -&gt; R a\nThe type variable \u2018a0\u2019 is ambiguous\nIn the ambiguity check for the type signature for \u2018f\u2019:\n  f :: forall a. MyType a =&gt; Int -&gt; R a\nTo defer the ambiguity check to use sites, enable AllowAmbiguousTypes\nIn the type signature for \u2018f\u2019: f :: MyType a =&gt; Int -&gt; R a\n</code></pre>\n\n<p>I don't want to enable <code>AllowAmbiguousTypes</code> because I don't think there is any ambiguity. What am I doing wrong?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464729095, "post_id": 37555581, "comment_id": 62600188, "body": "Thanks, thats elegant. I always forget about list comprehension."}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464729124, "post_id": 37555581, "comment_id": 62600200, "body": "Regarding the generalization, the somethingToRepresentAConstructor could be a String?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464729238, "post_id": 37555581, "comment_id": 62600251, "body": "Hmmm, doing this is certainly possible....  Doing it in an elegant way, that is another question....  The brute force approach would be to write it out by hand <code>getX &quot;A&quot; = getA; getX &quot;B&quot; = getB</code>."}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464729677, "post_id": 37555581, "comment_id": 62600464, "body": "My list of constructor is quite long, that&#39;s why I was thinking of generalizing. Would be elegant to have one function for them all..."}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464729820, "post_id": 37555581, "comment_id": 62600528, "body": "Maybe using view patterns? or something-something patterns"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464729824, "post_id": 37555581, "comment_id": 62600531, "body": "Two thoughts that come to mind....  Base something on show/read strings, or use Template Haskell.  The first soln gives me the heebie-jeebies :) , the second soln is complicated to implement.  But from a practical viewpoint, one of these might be exactly what you are looking for.  There might be a view pattern soln here, I haven&#39;t used them a lot myself, but perhaps you can take the general form above and replace with a generalized pattern."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1464736191, "post_id": 37555581, "comment_id": 62602705, "body": "Instead of three constructors all with the same arguments, use one constructor with an enum type as its first argument. <code>data FooType = A | B | C deriving Eq</code> <code>data Foo = Foo FooType Int</code> <code>firstOf :: FooType -&gt; [Foo] -&gt; Maybe Int; firstOf f xs = listToMaybe [i | Foo t i &lt;- xs, t == f]</code>. Then if you want you can just define <code>getA = firstOf A</code>, <code>getB = firstOf B</code>, and so on."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 3, "last_activity_date": 1464728671, "creation_date": 1464728671, "answer_id": 37555581, "question_id": 37555532, "link": "https://stackoverflow.com/questions/37555532/haskell-pattern-match-on-content-of-list/37555581#37555581", "title": "Haskell pattern match on content of list", "body": "<p>This will work</p>\n\n<pre><code>getA theList = listToMaybe [x | A x &lt;- theList]\ngetB theList = listToMaybe [x | B x &lt;- theList]\n</code></pre>\n\n<p>You will need to import <code>Data.Maybe</code>.</p>\n\n<p>Generalizing this would be possible, but tricky....  What type would you even want this function to have?  (<code>[a]-&gt;somethingToRepresentAConstructor-&gt;Int</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464787986, "post_id": 37570056, "comment_id": 62627698, "body": "This is what I have currently, but I didn&#39;t like it because there is one function per constructor."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1464788557, "post_id": 37570056, "comment_id": 62628193, "body": "Not really. You just represent each constructor type-safely, by a function instead of a string. Of course, it is less compact (though with <code>LambdaCase</code> extension you can write <code>firstJust (\\case { A x -&gt; Just x; _ -&gt; Nothing })</code>)."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1464787511, "last_edit_date": 1592644375, "creation_date": 1464787511, "answer_id": 37570056, "question_id": 37555532, "link": "https://stackoverflow.com/questions/37555532/haskell-pattern-match-on-content-of-list/37570056#37570056", "title": "Haskell pattern match on content of list", "body": "<blockquote>\n<p>And what about a getX function, capable of getting the value of any specified constructor in the list?</p>\n<p>Regarding the generalization, the somethingToRepresentAConstructor could be a String?</p>\n</blockquote>\n<p>You can generalize a bit more and get</p>\n<pre><code>firstJust :: (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b\nfirstJust f xs = case filter isJust (map f xs) of\n                   x : _ -&gt; x\n                   [] -&gt; Nothing\n\ngetA = firstJust f\n  where f (A x) = Just x\n        f _ = Nothing\n\ngetB = firstJust f\n  where f (B x) = Just x\n        f _ = Nothing\n</code></pre>\n"}], "owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 642, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1464787511, "creation_date": 1464728491, "question_id": 37555532, "link": "https://stackoverflow.com/questions/37555532/haskell-pattern-match-on-content-of-list", "title": "Haskell pattern match on content of list", "body": "<p>I have a list of elements:</p>\n\n<pre><code>data Foo = A Int | B Int | C Int\n\nmyList :: [Foo]\nmyList = [A 1, B 2, C 3]\n</code></pre>\n\n<p>I want a function that gets the value of a specific constructor, if existing:</p>\n\n<pre><code>-- returns value of the first A constructor, if exists:\ngetA :: [Foo] -&gt; Maybe Int\n\n-- returns value of the first B constructor, if exists:\ngetB :: [Foo] -&gt; Maybe Int\n</code></pre>\n\n<p>Any elegant solution?\nAnd what about a <code>getX</code> function, capable of getting the value of any specified constructor in the list? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1464727677, "post_id": 37555221, "comment_id": 62599486, "body": "This code reads like C converted to Haskell, not idiomatic Haskell....  You should take advantage of Haskell laziness, <code>readFile</code>, <code>lines</code>, and a bunch of pure functions, which would really show off the reason to choose Haskell over C."}], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 2, "last_activity_date": 1464727730, "creation_date": 1464727730, "answer_id": 37555354, "question_id": 37555221, "link": "https://stackoverflow.com/questions/37555221/haskell-reading-data-from-file-and-storing-into-a-container/37555354#37555354", "title": "Haskell - Reading data from file and storing into a container", "body": "<p>The type signature of <code>bookFromFile</code> has to be <code>Handle-&gt;IO Book</code>, since this function uses IO.</p>\n\n<p>Also, since the function is in IO, you shouldn't call it using <code>let b = ....</code>, but use <code>b &lt;- ....</code>.</p>\n\n<p>You also need to use <code>return</code> on the last line of the function to actually wrap the value in the IO needed for the return.</p>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1464727846, "creation_date": 1464727846, "answer_id": 37555383, "question_id": 37555221, "link": "https://stackoverflow.com/questions/37555221/haskell-reading-data-from-file-and-storing-into-a-container/37555383#37555383", "title": "Haskell - Reading data from file and storing into a container", "body": "<p>there are three small problems:</p>\n\n<ul>\n<li><code>bookFromFile</code> needs to sit in <code>IO</code> - you can see this because you use functions like <code>hGetLine</code> and <code>putStr</code></li>\n<li>when you then use it you have use <code>b &lt;- bookFromFile...</code> instead of <code>let b = bookFromFile ...</code></li>\n<li>and you have to <code>return</code> the tuple</li>\n</ul>\n\n<p>also you can get rid of many of the <code>(...)</code> like this</p>\n\n<pre><code>main = do\n   inputFile &lt;- openFile \"catalogo.txt\" ReadMode\n   b &lt;- bookFromFile inputFile\n   print \"done\"\n\nbookFromFile :: Handle -&gt; IO Book\nbookFromFile inputFile = do\n   --Read&amp;Store stuff from file\n   isbn &lt;- fmap read (hGetLine inputFile)\n   title &lt;- hGetLine inputFile \n   author &lt;- hGetLine inputFile\n   genre &lt;- hGetLine inputFile \n   date &lt;- hGetLine inputFile \n   publisher &lt;- hGetLine inputFile\n   summary &lt;- readSummary inputFile --readSummary :: Handle -&gt; IO String (works well)\n   putStr (summary ++ \"\\n\")\n\n   --Construct and return a book\n   return (isbn, title, author, genre, date, publisher, summary)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 1, "last_activity_date": 1464795533, "creation_date": 1464795533, "answer_id": 37573144, "question_id": 37555221, "link": "https://stackoverflow.com/questions/37555221/haskell-reading-data-from-file-and-storing-into-a-container/37573144#37573144", "title": "Haskell - Reading data from file and storing into a container", "body": "<p><code>bookFromFile</code> should properly make as much of the thinking pure as possible, so maybe something like this:</p>\n\n<pre><code>import Data.List\nimport System.IO\n\ntype Book = (Int, String, String, String, String, String, String)\n\nbookFromStrings:: [String] -&gt; Maybe Book\nbookFromStrings [isbn,title,author,genre,date,publisher,summary] = \n       Just (read isbn,title,author,genre,date,publisher,summary)\nbookFromStrings _ = Nothing\n\nbookFromString :: String -&gt; Maybe Book\nbookFromString str = bookFromStrings (begin ++ [unlines rest]) where\n      (begin, rest) = splitAt 6 (lines str)\n\nbookFromHandle :: Handle -&gt; IO (Maybe Book)\nbookFromHandle h  = do\n    str &lt;- hGetContents h\n    return (bookFromString str)\n\nbookFromFile :: FilePath -&gt;  IO (Maybe Book)\nbookFromFile file = withFile file ReadMode bookFromHandle\n</code></pre>\n\n<p>It would be basically the same but nicer if you made a little record type for <code>Book</code></p>\n\n<pre><code> data Book = Book {isbn :: Int, title :: String ...}\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 37555383, "answer_count": 3, "score": 1, "last_activity_date": 1464795533, "creation_date": 1464727151, "question_id": 37555221, "link": "https://stackoverflow.com/questions/37555221/haskell-reading-data-from-file-and-storing-into-a-container", "title": "Haskell - Reading data from file and storing into a container", "body": "<p>I have the following code in Haskell that gives me an error on the first line of bookFromFile function. What am I doing wrong?</p>\n\n<p>The error code is down below. </p>\n\n<pre><code>import Data.List\nimport System.IO\n\ntype Book = (Int, String, String, String, String, String, String)\n\nmain = do\n   inputFile &lt;- openFile \"catalogo.txt\" ReadMode\n   let b = (bookFromFile inputFile)\n   print \"done\"\n\nbookFromFile :: Handle -&gt; Book\nbookFromFile inputFile = do\n\n   --Read&amp;Store stuff from file\n   isbn &lt;- fmap read (hGetLine inputFile) :: IO Int\n   title &lt;- (hGetLine inputFile) \n   author &lt;- (hGetLine inputFile)\n   genre &lt;- (hGetLine inputFile) \n   date &lt;- (hGetLine inputFile) \n   publisher &lt;- (hGetLine inputFile)\n   summary &lt;- (readSummary inputFile) --readSummary :: Handle -&gt; IO String (works well)\n   putStr (summary ++ \"\\n\")\n\n   --Construct and return a book\n   (isbn, title, author, genre, date, publisher, summary)\n</code></pre>\n\n<p>Strangely, <em>(Int, String, String, String, String, String, Int)</em> is not even the type I have defined for book.\nError Message:</p>\n\n<pre><code>* Couldn't match type `IO'\n                     with `(,,,,,,) Int String String String String String'\n      Expected type: (Int, String, String, String, String, String, Int)\n        Actual type: IO Int\n    * In a stmt of a 'do' block:\n        isbn &lt;- fmap read (hGetLine inputFile) :: IO Int\n      In the expression:\n        do { isbn &lt;- fmap read (hGetLine inputFile) :: IO Int;\n             putStr ((show isbn) ++ \"\\n\");\n             title &lt;- (hGetLine inputFile);\n             putStr (title ++ \"\\n\");\n             .... }\n</code></pre>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464725055, "post_id": 37554450, "comment_id": 62598099, "body": "you just have to pack/unpack it from <code>R</code> when defining your <code>Applicative</code> instance: <code>(R f) &lt;*&gt; (R a) = R (\\r -&gt; (f r) (a r))</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464725137, "post_id": 37554450, "comment_id": 62598139, "body": "in case you already <i>have</i> the instance you have to wrap the function/values into <code>R</code> and then you can use <code>run</code>: <code>run (R (+) &lt;*&gt; R (*2)) 5</code>"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464725587, "post_id": 37554450, "comment_id": 62598388, "body": "I guess my question was not the clearest. That is what I was wondering, will upvote if you add that as an answer. Might ask you a follow up q on the applicative instance though."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1464751853, "post_id": 37554450, "comment_id": 62606298, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/5310203/how-to-use-instances-of-monad-and-confusion-about\">How to use (-&gt;) instances of Monad and confusion about (-&gt;)</a>"}], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1464804383, "post_id": 37555030, "comment_id": 62638823, "body": "Question1) I am puzzled by why <code>:t (Reader (+) &lt;*&gt; Reader (*2))</code> is <code>Num b =&gt; Reader b b</code>. Can you please explain or should I ask a new q? Question2) The first argument to <code>(&lt;*&gt;)</code> is <code>r (a -&gt; b)</code> - why does it then typecheck to give <code>(+)</code>, which is <code>(r -&gt; a -&gt; b)</code>? Thanks."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1464805944, "post_id": 37555030, "comment_id": 62639631, "body": "it&#39;s because <code>(+)</code> is <code>Num c =&gt; c -&gt; c -&gt; c</code> - so if you look at the <code>r -&gt; (a -&gt; b)</code> (the essential of <code>R r (a -&gt; b)</code>) and plug in <code>(+)</code> for it you need <code>r ~ c</code>, <code>a ~ c</code> and <code>b ~ c</code> - which yields the type (after renaming) ... btw: the first argument to <code>&lt;*&gt;</code> here is not <code>r (a -&gt; b)</code> - it&#39;s <code>R r (a -&gt; b)</code>"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1464726362, "creation_date": 1464726362, "answer_id": 37555030, "question_id": 37554450, "link": "https://stackoverflow.com/questions/37554450/how-do-i-use-my-reader-newtype-r-r-a-r-run-r-a/37555030#37555030", "title": "How do I use my Reader: newtype R r a = R { run :: r -&gt; a }?", "body": "<p>as I said in the comments you basically have everything you need - the missing bit is just the technicality of wrapping/unwrapping the function from the <code>R</code> constructor.</p>\n\n<p>ok here is how you make your <code>R</code> into a <code>Applicative</code> instance:</p>\n\n<pre><code>instance Applicative (R r) where\n    pure a          = R (\\_ -&gt; a)\n    (R f) &lt;*&gt; (R a) = R (\\r -&gt; (f r) (a r))\n</code></pre>\n\n<p>and yes this:</p>\n\n<pre><code>(&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>then translates into:</p>\n\n<pre><code>(&lt;*&gt;) :: R r (a -&gt; b) -&gt; R r a -&gt; R r b\n</code></pre>\n\n<p>once you have this the call equivalent to your example just involves wrapping/unwrapping the function from the constructor:</p>\n\n<pre><code>run (R (+) &lt;*&gt; R (*2)) 5\n</code></pre>\n\n<hr>\n\n<p>in case you get some warning about a <code>Functor</code> instance: you need this too:</p>\n\n<pre><code>instance Functor (R r) where\n    fmap f (R a) = R (\\r -&gt; f (a r))\n</code></pre>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 37555030, "answer_count": 1, "score": 1, "last_activity_date": 1464726362, "creation_date": 1464724172, "question_id": 37554450, "link": "https://stackoverflow.com/questions/37554450/how-do-i-use-my-reader-newtype-r-r-a-r-run-r-a", "title": "How do I use my Reader: newtype R r a = R { run :: r -&gt; a }?", "body": "<p>I'm trying to wrap my head around the applicative instance for Reader by matching the type definition with some examples. One problem is I do not know how to use my Reader newtype.</p>\n\n<p>My definition of Reader is </p>\n\n<pre><code>newtype R r a =\n  R { run :: r -&gt; a }\n</code></pre>\n\n<p>The type definition for <code>(&lt;*&gt;)</code> is</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Specialized for the Reader type this becomes:</p>\n\n<pre><code>(&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>So when I try:</p>\n\n<pre><code>(&lt;*&gt;) (+) (*2) 5 -- seems equivalent to using Reader since the types match\n</code></pre>\n\n<p>in the REPL I get <code>15</code>. I guess this is because it computes <code>(2*5) + 5</code>.</p>\n\n<p>How would I do the above with my Reader newtype? And is the <code>a</code> you see in \n<code>(r -&gt; a -&gt; b)</code> the same <code>a</code> you get from <code>(r -&gt; a)</code> or am I misunderstanding something?</p>\n"}, {"tags": ["list", "haskell", "reverse", "palindrome"], "answers": [{"comments": [{"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1464715788, "post_id": 37552106, "comment_id": 62592704, "body": "What do you mean by <code>(-&gt;) k</code> is that a lambda?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1464715959, "post_id": 37552106, "comment_id": 62592786, "body": "Some background: <code>((-&gt;) t)</code> is &quot;a function taking a <code>t</code> as input&quot;, and in your case <code>t</code> is <code>String</code>. The Applicative instance for that receives a <code>String</code>, and passes it to the first function <code>f</code>, getting back another function <code>f&#39;</code>. It passes <i>that same String</i> to the second function, getting back a value of some kind; and then it calls <code>f&#39;</code> with the returned value. Hence <code>(f &lt;*&gt; g) x == f x (g x)</code>."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1464716255, "post_id": 37552106, "comment_id": 62592937, "body": "@amalloy I think a lot of my confusion comes from how the type signature of <code>&lt;*&gt;</code> changes. For example how <code>f (a -&gt; b)</code> became <code>(k -&gt; a -&gt; b)</code>. Why is this the case for <code>(-&gt;) k</code>?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1464717189, "post_id": 37552106, "comment_id": 62593463, "body": "Its type signature doesn&#39;t change, but rather we use a more specialized version of it. <code>&lt;*&gt;</code> works for any Applicative, just like <code>==</code> works for any Eq. <code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code>, and in our case <code>f :: ((-&gt;) String)</code>. So we substitute for <code>f</code>, and arrive at <code>(&lt;*&gt;) :: (String -&gt; a -&gt; b) -&gt; (String -&gt; a) -&gt; (String -&gt; b)</code>. Further, <code>a :: String</code> and <code>b :: Bool</code>, so <code>(&lt;*&gt;) :: (String -&gt; String -&gt; Bool) -&gt; (String -&gt; String) -&gt; (String -&gt; Bool)</code>. Finally, remove the extraneous <code>()</code>, to get <code>(&lt;*&gt;) :: (String -&gt; String -&gt; Bool) -&gt; (String -&gt; String) -&gt; String -&gt; Bool</code>."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": false, "score": 7, "last_activity_date": 1464716176, "last_edit_date": 1464716176, "creation_date": 1464715686, "answer_id": 37552106, "question_id": 37551981, "link": "https://stackoverflow.com/questions/37551981/you-can-find-out-if-a-list-is-a-palindrome-using-reverse-how-does-it-w/37552106#37552106", "title": "You can find out if a list is a palindrome using (==) &lt;*&gt; reverse. How does it work?", "body": "<p>Start with the type of <code>(&lt;*&gt;)</code></p>\n\n<pre><code>&gt; : t (&lt;*&gt;)\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Now <code>(-&gt;) k</code> is an instance of <code>Applicative</code>, with implementation</p>\n\n<pre><code>instance Applicative ((-&gt;) k) where\n    pure a  = \\_ -&gt; a\n    f &lt;*&gt; g = \\k -&gt; f k (g k)\n</code></pre>\n\n<p>In particular, the type of <code>(&lt;*&gt;)</code> specialised to <code>(-&gt;) k</code> is</p>\n\n<pre><code>(&lt;*&gt;) :: (k -&gt; a -&gt; b) -&gt; (k -&gt; a) -&gt; (k -&gt; b)\n</code></pre>\n\n<p>So the application <code>(==) &lt;*&gt; reverse</code> is</p>\n\n<pre><code>(==) &lt;*&gt; reverse = \\k -&gt; (==) k (reverse k)\n                 = \\k -&gt; k == reverse k\n</code></pre>\n\n<p>i.e. it checks that a list is equal to its reverse.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464742091, "post_id": 37557739, "comment_id": 62604034, "body": "Why do you always have to come up with the nice, clear answers?"}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1469338573, "post_id": 37557739, "comment_id": 64489458, "body": "Coming back to it two months later is made so much more sense. Thanks!"}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 2, "last_activity_date": 1464748460, "last_edit_date": 1464748460, "creation_date": 1464741667, "answer_id": 37557739, "question_id": 37551981, "link": "https://stackoverflow.com/questions/37551981/you-can-find-out-if-a-list-is-a-palindrome-using-reverse-how-does-it-w/37557739#37557739", "title": "You can find out if a list is a palindrome using (==) &lt;*&gt; reverse. How does it work?", "body": "<p>Chris Taylor's answer is just right, but another way of looking at it, that I find more intuitive, is this: what the <code>Applicative</code> instance of function types does is this:</p>\n\n<ol>\n<li>\"Feed\" the same argument value to two functions with the same argument type;</li>\n<li>Combine their results with another function.</li>\n</ol>\n\n<p>So basically, if you have <code>f :: t -&gt; a</code> and <code>g:: t -&gt; b</code>, the <code>Applicative</code> instance lets you map functions <code>h :: a -&gt; b -&gt; c</code> over the <code>a</code> and <code>b</code> results, under the assumption that <code>f</code> and <code>g</code> will be fed the same argument.</p>\n\n<p>So think of how you'd write the palindrome test in a non-convoluted way:</p>\n\n<pre><code>palindrome :: Eq a =&gt; [a] -&gt; Bool\npalindrome xs = xs == reverse xs\n</code></pre>\n\n<p><code>xs</code> appears twice on the right hand side of the definition: once as argument to <code>==</code>, and a second time as argument to <code>reverse</code>.  This automatically tells you that there is likely a way to use the <code>(-&gt;) t</code> applicative instance to eliminate the duplication.  A different, perhaps more intuitive attack on this would be to first rewrite the function to this:</p>\n\n<pre><code>palindrome xs = id xs == reverse xs\n</code></pre>\n\n<p>...where <code>id x = x</code> is the <em>identity function</em>, which just returns its argument (and is a standard library function).  Now you can rewrite that using the standard <code>Applicative</code> idiom (<code>f &lt;$&gt; a0 &lt;*&gt; ... &lt;*&gt; an</code>) to this:</p>\n\n<pre><code>-- Function that feed the same argument value to both `id` and `reverse`,\n-- then tests their results with `==`: \npalindrome = (==) &lt;$&gt; id &lt;*&gt; reverse\n</code></pre>\n\n<p>And now we can ask if there is a way to get rid of <code>id</code> in that rewrite.  Since <code>&lt;$&gt;</code> is just shorthand for <code>fmap</code>, we can study the <code>Functor</code> instance for <code>(-&gt;) t</code>, which is just another way to express function composition:</p>\n\n<pre><code>instance Functor ((-&gt;) t) where\n  -- Mapping `f` over a *function* `g` is just the same as composing `f`\n  -- on the results of `g`.\n  fmap f g = f . g\n</code></pre>\n\n<p>One of the most important properties of function composition is that for any function <code>f</code>:</p>\n\n<pre><code>f . id = f\n</code></pre>\n\n<p>So applying that to the version of <code>palindrome</code> above, we get:</p>\n\n<pre><code>-- Since `f . id = f` for all `f`, then `(==) &lt;$&gt; id` is just `(==)`:\npalindrome = (==) &lt;*&gt; reverse\n</code></pre>\n"}], "owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1023, "favorite_count": 0, "accepted_answer_id": 37557739, "answer_count": 2, "score": 2, "last_activity_date": 1464748460, "creation_date": 1464715282, "question_id": 37551981, "link": "https://stackoverflow.com/questions/37551981/you-can-find-out-if-a-list-is-a-palindrome-using-reverse-how-does-it-w", "title": "You can find out if a list is a palindrome using (==) &lt;*&gt; reverse. How does it work?", "body": "<p>I've tried to go through this using the types, but I'm still having difficulty understanding how it works.</p>\n\n<p>Given:</p>\n\n<pre><code>&gt; :t (==)\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n\n&gt; :t (&lt;*&gt;)\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n\n&gt; :t reverse\nreverse :: [a] -&gt; [a]\n\n&gt; :t (==) &lt;*&gt; reverse\n(==) &lt;*&gt; reverse :: Eq a =&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>Intuitively I can understand that it combines the equality operator with reverse in such a way that it creates a function that checks if a reversed list is equal to the original, but that's really not much more information than what is already pretty obvious.</p>\n\n<p>Could someone break down in more detail the internals of what is actually happening here?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464714946, "post_id": 37551591, "comment_id": 62592242, "body": "How come value is of type Int instead of IO Int?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 1, "creation_date": 1464715309, "post_id": 37551591, "comment_id": 62592440, "body": "In Haskell&#39;s do notation, the value to the left of a <code>&lt;-</code> actually has the type of the item with the monad (IO, in this case) removed.  So while it is true that the <code>readFile</code> line has type <code>IO String</code>, by the next line, value has only type <code>String</code>."}, {"owner": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464719846, "post_id": 37551591, "comment_id": 62595095, "body": "so something like &quot;value &lt;- value&quot; will remove the IO as well?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464722571, "post_id": 37551591, "comment_id": 62596683, "body": "Although &quot;remove the IO&quot; isn&#39;t quite the correct way to say this, yes, it would.  But I can guarantee you that the Haskell community would consider that bad form.  In general, a variable should not point to two different values, <code>value</code> should have a single type.  In fact, in general it is not possible to change the value of a variable, although this example gives you one loophole in that rule...."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 1, "last_activity_date": 1464713874, "creation_date": 1464713874, "answer_id": 37551591, "question_id": 37551439, "link": "https://stackoverflow.com/questions/37551439/haskell-read-a-single-int-from-a-file-and-print-it/37551591#37551591", "title": "Haskell - Read a single int from a file and print it", "body": "<p>You can use the <code>readFile</code> function to convert your file to a string.</p>\n\n<pre><code>main = do\n  contents &lt;- readFile \"theFile\"\n  let value = read $ head $ lines contents::Int \n  print value\n</code></pre>\n\n<p>You should add better error detection, or this program will fail if there isn't a first line, or if the value is malformed, but this is the basic flow....</p>\n"}, {"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1464714562, "post_id": 37551622, "comment_id": 62592027, "body": "Not so fast! There are people who are still on ghc 6!"}, {"owner": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464714865, "post_id": 37551622, "comment_id": 62592194, "body": "what does fmap actually do?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464715540, "post_id": 37551622, "comment_id": 62592564, "body": "@EricMarchettiSantos It turns a plain function <code>a -&gt; b</code> to work under IO as <code>IO a -&gt; IO b</code> (it works for other functors as well)."}], "tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": false, "score": 2, "last_activity_date": 1464713961, "creation_date": 1464713961, "answer_id": 37551622, "question_id": 37551439, "link": "https://stackoverflow.com/questions/37551439/haskell-read-a-single-int-from-a-file-and-print-it/37551622#37551622", "title": "Haskell - Read a single int from a file and print it", "body": "<p>You can specify the type explicitly, change the read line to</p>\n\n<pre><code>isbn &lt;- fmap read (hGetLine inputFile) :: IO Int\n</code></pre>\n\n<p>As <code>hGetLine inputFile</code> is of type <code>IO String</code>, you should use <code>fmap</code> to get \"inside\" to read as an <code>Int</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464717261, "post_id": 37552389, "comment_id": 62593500, "body": "It is still a bit cloudy for me. readInteger is String -&gt; Int so  &quot;let .. = &quot;  will somehow change that to IO String -&gt; IO Integer. Is that correct?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464718033, "post_id": 37552389, "comment_id": 62594006, "body": "Not exactly. <code>hGetLine inputFile</code> is <code>IO String</code>, but when you say <code>line &lt;- hGetLine inputFile</code>, <code>line</code> is just <code>String</code>. Then <code>let .. =</code> doesn&#39;t add any IO either. You <i>will</i> have to return to IO at the last line of the <code>do</code> block, for example, by using <code>print isbn</code> (this returns <code>IO ()</code>)."}, {"owner": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464718616, "post_id": 37552389, "comment_id": 62594365, "body": "In &#39;line &lt;- hGetLine inputFile&#39;, &#39;&lt;-&#39; converts &#39;IO String&#39; to &#39;String&#39;?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464719948, "post_id": 37552389, "comment_id": 62595165, "body": "Not really. If you think about IO as a box, and IO String as a string inside a box, then you in fact can never get rid of the box and leave just the content. What <code>&lt;-</code> and <code>fmap</code> let you do is get inside the box and manipulate its content from within."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "edited": false, "score": 0, "creation_date": 1464721073, "post_id": 37552389, "comment_id": 62595833, "body": "@EricMarchettiSantos Your first proposal (that you are turning a <code>String -&gt; Int</code> function into an <code>IO String -&gt; IO Int</code> function) was closer to the truth. <code>line &lt;- hGetLine inputFile; blah</code> gets turned into <code>hGetLine inputFile &gt;&gt;= \\line -&gt; blah</code>. In the latter, <code>(&gt;&gt;=)</code> is turning your <code>(\\line -&gt; return (read line)) :: String -&gt; IO Int</code> into <code>(&gt;&gt;= (\\line -&gt; return (read line))) :: IO String -&gt; IO Int</code>. This combination of <code>(&gt;&gt;=)</code> and <code>return</code> is common enough that it&#39;s given its own name, <code>fmap</code>, a function which can indeed turn a <code>String -&gt; Int</code> into an <code>IO String -&gt; IO Int</code>."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 0, "last_activity_date": 1464716695, "creation_date": 1464716695, "answer_id": 37552389, "question_id": 37551439, "link": "https://stackoverflow.com/questions/37551439/haskell-read-a-single-int-from-a-file-and-print-it/37552389#37552389", "title": "Haskell - Read a single int from a file and print it", "body": "<p>First, observe that reading stuff and then immediately printing it can result in mysterious errors:</p>\n\n<pre><code>GHCi, version 8.0.0.20160421: http://www.haskell.org/ghc/  :? for help\nPrelude \u03bb read \"123\"\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>The reason is that you don't specify what type you want to read. You can counter this by using type annotations:</p>\n\n<pre><code>Prelude \u03bb read \"123\" :: Integer\n123\n</code></pre>\n\n<p>but it is sometimes easier to introduce a little helper function:</p>\n\n<pre><code>Prelude \u03bb let readInteger = read :: String -&gt; Integer\nPrelude \u03bb readInteger \"123\"\n123\n</code></pre>\n\n<p>Now to the main problem. <code>read( hGetLine inputFile)</code> doesn't work because <code>hGetLine inputFile</code> returns and <code>IO String</code> and <code>read</code> needs a <code>String</code>. This can be solved in two steps:</p>\n\n<pre><code>line &lt;- hGetLine inputFile\nlet isbn = readInteger line\n</code></pre>\n\n<p>Note two different constructs <code>&lt;-</code> and <code>let .. =</code>, they do different things. Can you figure out exactly what?</p>\n\n<p>As shown in another answer, you can do it in a less verbose manner:</p>\n\n<p>isbn &lt;- fmap readInteger (hGetLine inputFile)</p>\n\n<p>which is great if you do a simple thing like <code>read</code>. But it is often desirable to explicitly name intermediate results. You can use <code>&lt;-</code> and <code>let .. =</code> constructs in such cases.</p>\n"}], "owner": {"reputation": 95, "user_id": 4687529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-E6XgPOn1Tb8/AAAAAAAAAAI/AAAAAAAAABk/FqvUYEijHFo/photo.jpg?sz=128", "display_name": "Eric Marchetti Santos", "link": "https://stackoverflow.com/users/4687529/eric-marchetti-santos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 0, "accepted_answer_id": 37552389, "answer_count": 3, "score": 1, "last_activity_date": 1464716695, "creation_date": 1464713359, "question_id": 37551439, "link": "https://stackoverflow.com/questions/37551439/haskell-read-a-single-int-from-a-file-and-print-it", "title": "Haskell - Read a single int from a file and print it", "body": "<p>How do I create a program that reads a line from a file, parse it to an int and print it(ignoring exceptions of course). Is there anything like \"read\" but for <em>IO String</em>? </p>\n\n<p>I've got this so far but I couldn't get around the <em>IO</em> types:</p>\n\n<pre><code>readFromFile = do\n   inputFile &lt;- openFile \"catalogue.txt\" ReadMode\n\n   isbn &lt;- read( hGetLine inputFile)\n\n\n   hClose inputFile\n</code></pre>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464716526, "post_id": 37550959, "comment_id": 62593078, "body": "Perhaps there&#39;s an <code>If</code> type level function? I think I saw that used somewhere, but I&#39;m not a library expert..."}, {"owner": {"reputation": 179, "user_id": 4149214, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6ea83c98d47b4feae6c0d80ee065529?s=128&d=identicon&r=PG&f=1", "display_name": "prophet-on-that", "link": "https://stackoverflow.com/users/4149214/prophet-on-that"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464776698, "post_id": 37550959, "comment_id": 62619020, "body": "Thanks, you&#39;re absolutely right, <code>If</code> exists in <a href=\"https://hackage.haskell.org/package/base/docs/Data-Type-Bool.html\" rel=\"nofollow noreferrer\">Data.Type.Bool</a>."}, {"owner": {"reputation": 179, "user_id": 4149214, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6ea83c98d47b4feae6c0d80ee065529?s=128&d=identicon&r=PG&f=1", "display_name": "prophet-on-that", "link": "https://stackoverflow.com/users/4149214/prophet-on-that"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464777038, "post_id": 37550959, "comment_id": 62619250, "body": "Following up on this, I managed to rewrite <code>Mod</code> using the type-level <code>If</code>, which compiled successfully. However, any attempt to reduce a term of the form <code>Mod m n</code> resulted in a stack overflow exception. Tweaking the <i>-freduction-depth</i> option showed me that GHC was prioritising expanding the <code>m - n</code> part of the expression, without realising that this may never be possible. I&#39;ll have to look further in the <i>DataKinds</i> extension to understand more of the behaviour."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464782909, "post_id": 37550959, "comment_id": 62623509, "body": "That&#39;s very interesting. From your report, it seems that type-level <code>If</code> is eager on all its arguments, which looks wrong."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1469771891, "last_edit_date": 1469771891, "creation_date": 1469742909, "answer_id": 38647376, "question_id": 37550959, "link": "https://stackoverflow.com/questions/37550959/constraints-in-type-family-instances/38647376#38647376", "title": "Constraints in type family instances", "body": "<p>Not an answer (I don't think there even is one possible yet), but for the benefit of other people (like me) trying to retrace OPs steps in comments. The following compiles, but using it quickly results in a stack overflow.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, TypeOperators, UndecidableInstances #-}\nimport GHC.TypeLits\nimport Data.Type.Bool\n\ntype family Mod (m :: Nat) (n :: Nat) :: Nat where\n  Mod m n = If (n &lt;=? m) (Mod (m - n) n) m\n</code></pre>\n\n<p>The reason is that <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Type-Bool.html#t:If\" rel=\"nofollow\"><code>If</code></a> itself is just a regular type family and the behavior of type-families is to start by expanding their type arguments (eager in a sense) before using those in the right hand side. The unfortunate result in this case is that <code>Mod (m - n) n</code> gets expanded even if <code>n &lt;=? m</code> is false, hence the stack overflow.</p>\n\n<p>For exactly the same reason, the logical operators in <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Type-Bool.html\" rel=\"nofollow\"><code>Data.Type.Bool</code></a> do not short circuit. Given </p>\n\n<pre><code>type family Bottom :: Bool where Bottom = Bottom\n</code></pre>\n\n<p>We can see that <code>False &amp;&amp; Bottom</code> and <code>True || Bottom</code> both hang.</p>\n\n<h1>EDIT</h1>\n\n<p>Just in case the OP is just interested in a type family with the required behavior (and not just the more general problem of having guards in type families) there <em>is</em> a way to express <code>Mod</code> in a way that terminates:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, TypeOperators, UndecidableInstances #-}\nimport GHC.TypeLits\n\ntype Mod m n = Mod1 m n 0 m\n\ntype family Mod1 (m :: Nat) (n :: Nat) (c :: Nat) (acc :: Nat) :: Nat where\n  Mod1 m n n acc = Mod1 m n 0 m\n  Mod1 0 n c acc = acc\n  Mod1 m n c acc = Mod1 (m - 1) n (c + 1) acc\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 4149214, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6ea83c98d47b4feae6c0d80ee065529?s=128&d=identicon&r=PG&f=1", "display_name": "prophet-on-that", "link": "https://stackoverflow.com/users/4149214/prophet-on-that"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "accepted_answer_id": 38647376, "answer_count": 1, "score": 8, "last_activity_date": 1469771891, "creation_date": 1464711708, "last_edit_date": 1464712404, "question_id": 37550959, "link": "https://stackoverflow.com/questions/37550959/constraints-in-type-family-instances", "title": "Constraints in type family instances", "body": "<p>I'm exploring type families in Haskell, trying to establish the complexity of type-level functions I can define. I want to define a closed type-level version of <code>mod</code>, something like so:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, TypeOperators, UndecidableInstances #-}\nimport GHC.TypeLits\n\ntype family Mod (m :: Nat) (n :: Nat) :: Nat where\n  n &lt;= m =&gt; Mod m n = Mod (m - n) n\n  Mod m n = m\n</code></pre>\n\n<p>However, the compiler (GHC 7.10.2) rejects this, as the constraint in the first equation isn't permitted. How do guards at the value-level translate to the type level? Is this even possible in Haskell currently? </p>\n"}, {"tags": ["haskell", "recursion", "proof", "equational-reasoning"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464705192, "post_id": 37548367, "comment_id": 62585842, "body": "note that you are missing one line in <code>exec _ [] = error &quot;ADD applied to an empty or singleton stack&quot;</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1464705822, "post_id": 37548367, "comment_id": 62586239, "body": "You will probably need a lemma about <code>exec</code> - in particular you have <code>exec (a ++ b) s = exec b (exec a s)</code>. This would allow you write <code>exec (comp x ++ comp y ++ [ADD])</code> as <code>exec [ADD] (exec (comp y) (exec (comp x)))</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "edited": false, "score": 0, "creation_date": 1464706803, "post_id": 37548367, "comment_id": 62586920, "body": "Thank you! But how can I prove the comp x and comp y then?"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1464706046, "creation_date": 1464706046, "answer_id": 37548907, "question_id": 37548367, "link": "https://stackoverflow.com/questions/37548367/how-to-prove-this-haskell-code-using-equational-reasoning/37548907#37548907", "title": "How to prove this Haskell code using equational reasoning", "body": "<p>When the first argument to <code>exec</code> is a list, the two possibilities are:</p>\n\n<pre><code>exec (PUSH n: codes)  -- #1\nexec (ADD   : codes)  -- #2\n</code></pre>\n\n<p>In the induction step you get to assume that the proposition holds for <code>codes</code>, i.e. you may assume:</p>\n\n<pre><code>exec codes s = eval codes : s\n</code></pre>\n\n<p>for <em>any</em> value of <em>s</em> -- Keep this in mind - this is usually the key step in any induction proof.</p>\n\n<p>Start by expanding #1 using the code you've written for <code>exec</code>:</p>\n\n<pre><code>exec (PUSH n: codes) s == exec codes (n:s)\n                       == ...\n                       == ...\n                       == eval (PUSH n: codes) : s\n</code></pre>\n\n<p>Can you see a place to use the induction hypothesis?</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1464706046, "creation_date": 1464704608, "question_id": 37548367, "link": "https://stackoverflow.com/questions/37548367/how-to-prove-this-haskell-code-using-equational-reasoning", "title": "How to prove this Haskell code using equational reasoning", "body": "<p>I found this exercise on equational reasoning and proofs in Haskell. The following code is given:</p>\n\n<pre><code>type Stack = [Int]\ntype Code = [Op]\ndata Op = PUSH Int | ADD\nderiving (Show)\n--\n-- Stack machine\n--\nexec :: Code -&gt; Stack -&gt; Stack\nexec [ ] s = s\nexec (PUSH n : c) s = exec c (n:s)\nexec (ADD:c) (m:n:s) = exec c (n+m : s)\n--\n-- Interpeter\n--\ndata Expr = Val Int | Add Expr Expr\nderiving (Show)\neval :: Expr -&gt; Int\neval (Val n) = n\neval (Add x y) = eval x+eval y\n--\n-- Compiler\n--\ncomp :: Expr -&gt; Code\ncomp (Val n) = [PUSH n]\ncomp (Add x y) = comp x ++ comp y ++ [ADD]\n</code></pre>\n\n<p>Now I have to prove that <code>exec(comp e) s = eval e : s</code>.</p>\n\n<p>So I found this answer so far:</p>\n\n<p>We have to prove that <code>exec (comp e) s = eval e : s</code>.</p>\n\n<p>First case: Assume <code>e = (Val n)</code>. Then <code>comp (Val n) = [PUSH n]</code>, so we have to prove that <code>exec ([PUSH n]) s = eval ([PUSH n] : s)</code>. We find that <code>exec ([PUSH n]) s = exec [] (n:s) = (n:s)</code> using the function definition of exec.</p>\n\n<p>Now <code>eval (Val n) : s = n : s</code>. The first case is OK!</p>\n\n<p>Second case: Assume <code>e = (Add x y)</code>. Then <code>comp (Add x y) = comp x ++ comp y ++ [ADD]</code>. </p>\n\n<p>But now I'm struggling with this recursive use of comp. Should I be using some form of trees and induction on these trees to prove this? I'm not completely sure how to do that.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "edited": false, "score": 1, "creation_date": 1464697351, "post_id": 37545456, "comment_id": 62579805, "body": "Ok, but arent there situations when this is ambiguous? For example in my specific case I want to use f in a case expression like this: case f xs of Nothing -&gt; something... Just ( a, as) -&gt; something else... How does haskell know which f I am using?"}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "edited": false, "score": 1, "creation_date": 1464697930, "post_id": 37545456, "comment_id": 62580222, "body": "@user3726947 If the function, in which you have this expression, doesn&#39;t care which specific type &quot;a&quot; is, then it&#39;s a polymorphic function and will have a signature like <code>f2 :: (YourClass a) =&gt; a -&gt; ...</code>"}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 3, "last_activity_date": 1464696724, "creation_date": 1464696724, "answer_id": 37545456, "question_id": 37545204, "link": "https://stackoverflow.com/questions/37545204/how-to-specify-the-instance-from-which-a-function-is-called/37545456#37545456", "title": "How to specify the instance from which a function is called", "body": "<p>The typeclass instances are indexed by the specific types, for which they are declared. E.g., in the following case:</p>\n\n<pre><code>class YourClass a where\n  f :: [Bool] -&gt; Maybe (a, [a])\n\ninstance YourClass Int where\n  f = error \"Define me\"\n\ninstance YourClass Char where\n  f = error \"Define me\"\n</code></pre>\n\n<p>There are two unique instances of <code>YourClass</code>. One gets picked up, when <code>a</code> is <code>Int</code>, the other - when it is <code>Char</code>. The instances get resolved automatically using the types that the <code>f</code> function actually gets applied to.</p>\n\n<p>So whenever you use <code>f</code> as if it has a specific signature <code>[Bool] -&gt; Maybe (Int, [Int])</code>, the instance for <code>Int</code> gets picked up automatically. Since Haskell also has an incredibly powerful type inference, this specific signature doesn't really need to be specified in most cases, and the compiler resolves it from the context, again, automatically.</p>\n\n<p>So basically, you can simply use that function on all types for which you have instances and safely expect the compiler to do the rest for you.</p>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 7, "last_activity_date": 1464697900, "creation_date": 1464697900, "answer_id": 37545876, "question_id": 37545204, "link": "https://stackoverflow.com/questions/37545204/how-to-specify-the-instance-from-which-a-function-is-called/37545876#37545876", "title": "How to specify the instance from which a function is called", "body": "<p>Sometimes you have to add type annotations. Consider the typeclass <code>Read</code>:</p>\n\n<pre><code>class Read a where\n  read :: String -&gt; a\n</code></pre>\n\n<p>If you try <code>read \"1\"</code> expecting to get the integer <code>1</code>, you'll get an error instead because there's no way to know what the type <code>a</code> is.  However, this works: <code>read \"1\" :: Int</code>.</p>\n\n<p>If you are using your function <code>f</code> in a situation where the compiler can figure out what <code>a</code> is, then it'll work fine.  Otherwise, you have to help the compiler by adding appropriate type annotations.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1464699508, "creation_date": 1464699508, "answer_id": 37546449, "question_id": 37545204, "link": "https://stackoverflow.com/questions/37545204/how-to-specify-the-instance-from-which-a-function-is-called/37546449#37546449", "title": "How to specify the instance from which a function is called", "body": "<p>To complement other answers, I'd point out that indeed some cases can be ambiguous.</p>\n\n<p>For instance:</p>\n\n<pre><code>class C a where\n  f :: String -&gt; a\ninstance C Int where\n  f s = length s\ninstance C Bool where\n  f s = s == \"hello!\"\n\nmain :: IO ()\nmain = print (f \"testing\")\n</code></pre>\n\n<p>Now, <code>print</code> accepts any (<code>Show</code>able) type, and <code>f \"testing\"</code> can produce both a <code>Int</code> and a <code>Bool</code>. This is inherently ambiguous since the program above could print \"False\" as well as \"7\". There is no way that the compiler can figure that out.</p>\n\n<p>As a solution we can use</p>\n\n<pre><code>main = print (f \"testing\" :: Int)\n-- or\nmain = print (f \"testing\" :: Bool)\n</code></pre>\n\n<p>to disambiguate. Another less convenient option is</p>\n\n<pre><code>main = print ((f :: String -&gt; Int) \"testing\")\n</code></pre>\n\n<p>or even, in GHC 8.0 with the right extension on,</p>\n\n<pre><code>main = print (f @ Int \"testing\")  -- explicit choice for type a\n</code></pre>\n\n<p>Note however that in some contexts there is no ambiguity, and GHC can do wonders. For instance:</p>\n\n<pre><code>main = print (f \"testing\" &amp;&amp; True)         -- Bool is chosen here\nmain = print (f \"testing\" + length [1,2])  -- Int is chosen here\n</code></pre>\n\n<p>This is because <code>&amp;&amp;</code> requires <code>Bool</code>, and <code>length</code> returns <code>Int</code> while <code>+</code> forces the two arguments to have the same type (so <code>f \"testing\"</code> must be <code>Int</code> as well).</p>\n\n<p>Also working</p>\n\n<pre><code>bar :: Bool -&gt; Float\nbar b = ...\n\nmain = print (bar (f \"testing))  -- Bool is chosen\n</code></pre>\n"}], "owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 37545876, "answer_count": 3, "score": 2, "last_activity_date": 1464699508, "creation_date": 1464696080, "last_edit_date": 1464698336, "question_id": 37545204, "link": "https://stackoverflow.com/questions/37545204/how-to-specify-the-instance-from-which-a-function-is-called", "title": "How to specify the instance from which a function is called", "body": "<p>Say I have a type class such that for every instance a of this type class I have a function</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>f :: [Bool] -&gt; Maybe (a, [a])\n</code></pre>\n\n<p>How can I call f? More precisely, how can I specify that I mean the f from the instance of a and not from the instance of b if b is another type that is in this type class?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1464694649, "creation_date": 1464694649, "answer_id": 37544685, "question_id": 37544580, "link": "https://stackoverflow.com/questions/37544580/why-simple-haskell-add-function-doesnt-behave-as-intended/37544685#37544685", "title": "why simple haskell add function doesn&#39;t behave as intended?", "body": "<pre><code>add n = (+) 1\n</code></pre>\n\n<p>You never use <code>n</code> on the right hand side. Keep in mind that <code>(+) 1</code> is short for <code>\\x -&gt; (+) 1</code>, and you'll see that</p>\n\n<pre><code>add n = (+) 1 = \\x -&gt; (+) 1 x\n</code></pre>\n\n<p>Or, equivalently </p>\n\n<pre><code>add n x = (+) 1 x\n</code></pre>\n\n<p>Therefore, <code>n</code> can be any type (here called <code>t</code>), since it is not used at all.</p>\n\n<p>You meant</p>\n\n<pre><code>add n = (+) 1 n\n</code></pre>\n\n<blockquote>\n  <p>BTW, why I have to prefix repo with let in order to define function?</p>\n</blockquote>\n\n<p>Because you're using GHCi, which doesn't act the same as using GHC on a source file.</p>\n"}, {"tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": false, "score": 0, "last_activity_date": 1464696418, "last_edit_date": 1464696418, "creation_date": 1464694755, "answer_id": 37544729, "question_id": 37544580, "link": "https://stackoverflow.com/questions/37544580/why-simple-haskell-add-function-doesnt-behave-as-intended/37544729#37544729", "title": "why simple haskell add function doesn&#39;t behave as intended?", "body": "<p>You are not using <code>n</code>, so it can be of any type you want. <code>t</code> is not some specific type, it means an argument of some type <code>t</code>.</p>\n\n<p>A good indication that <code>t</code> is not used anywhere (and something is wrong) is the fact that only <code>a</code> has a <code>Num</code> constraint. So for <code>add</code> to work properly if it actually used <code>t</code> in the addition, it would have to somehow be able to add <code>a</code> to a variable of <em>any type</em>, including types that are not an instance of <code>Num</code>.</p>\n"}], "owner": {"reputation": 4988, "user_id": 161289, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KUaQL.jpg?s=128&g=1", "display_name": "zinking", "link": "https://stackoverflow.com/users/161289/zinking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 1, "accepted_answer_id": 37544685, "answer_count": 2, "score": 2, "last_activity_date": 1464696418, "creation_date": 1464694372, "question_id": 37544580, "link": "https://stackoverflow.com/questions/37544580/why-simple-haskell-add-function-doesnt-behave-as-intended", "title": "why simple haskell add function doesn&#39;t behave as intended?", "body": "<p>I'm playing with the haskell repo around a little. \nwhy f2 behaves that way ? (I was expecting f2 takes only 1 argument), also what does <code>t</code> mean in the type?</p>\n\n<p>BTW, why I have to prefix repo with <strong>let</strong> in order to define function?</p>\n\n<pre><code>\u03bb&gt; :t add  -- f1\nadd :: Num a =&gt; a -&gt; a\n\u03bb&gt; let add n = (+) 1  -- f2 what does this mean?\n\u03bb&gt; add 1 1\n2\n\u03bb&gt; :t add\nadd :: Num a =&gt; t -&gt; a -&gt; a\n\u03bb&gt; add 1 3\n4\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation", "traversal", "io-monad", "strictness"], "answers": [{"comments": [{"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1464679449, "post_id": 37539042, "comment_id": 62568162, "body": "Thank you very much for your answer, chi. May I ask how you know that the IO definition of mapM is strict and that return is lazy?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 3, "creation_date": 1464680055, "post_id": 37539042, "comment_id": 62568538, "body": "@NioBium <code>Failure &gt;&gt;= f = Failure</code> discards the <code>f</code>: there&#39;s no need to proceed further on the monadic chain. IO has a lower lever definition which is not easily written, but -- barring exceptions -- <code>action &gt;&gt;= f</code> will always call <code>f</code> since one expects that e.g. <code>action &gt;&gt; print 4</code> will eventually print 4 no matter what <code>action</code> does (barring IO exceptions and non-termination)."}, {"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1464680355, "post_id": 37539042, "comment_id": 62568708, "body": "Right. Thanks again!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 10, "last_activity_date": 1464699767, "last_edit_date": 1464699767, "creation_date": 1464678459, "answer_id": 37539042, "question_id": 37538532, "link": "https://stackoverflow.com/questions/37538532/io-monad-prevents-short-circuiting-of-embedded-mapm/37539042#37539042", "title": "IO monad prevents short circuiting of embedded mapM?", "body": "<p>Nice test cases. Here's what's happening:</p>\n\n<ul>\n<li><p>in <code>mapM compute</code> we see laziness at work, as usual. No surprise here.</p></li>\n<li><p>in <code>mapM compute2</code> we work inside the IO monad, whose <code>mapM</code> definition will demand the whole list: unlike <code>Result</code> which skips the tail of the list as soon as <code>Failure</code> is found, <code>IO</code> will always scan the whole list. Note the code:</p>\n\n<pre><code>compute2 x = traceShow x $ return $ Result x\n</code></pre>\n\n<p>So, the above wil print the debug message as soon as each element of the list of IO actions is accessed. All are, so we print everything.</p></li>\n<li><p>in <code>mapM compute3</code> we now use, roughly:</p>\n\n<pre><code>compute3 x = return $ traceShow x $ Result x\n</code></pre>\n\n<p>Now, since <code>return</code> in IO is lazy, it will <em>not</em> trigger the <code>traceShow</code> when returning the IO action. So, when <code>mapM compute3</code> is run, <em>no message</em> is seen. Instead, we see messages only when <code>sequence results3</code> is run, which forces the <code>Result</code> -- not all of them, but only as much as needed.</p></li>\n<li><p>the final <code>Identity</code> example is also quite tricky. Note this:</p>\n\n<pre><code>&gt; newtype Id1 a = Id1 a\n&gt; data Id2 a = Id2 a\n&gt; Id1 (trace \"hey!\" True) `seq` 42\nhey!\n42\n&gt; Id2 (trace \"hey!\" True) `seq` 42\n42\n</code></pre>\n\n<p>when using a <code>newtype</code>, at runtime there is no boxing/unboxing (AKA lifting) involved, so forcing a <code>Id1 x</code> value causes <code>x</code> to be forced. With <code>data</code> types this does not happen: the value is wrapped in a box (e.g. <code>Id2 undefined</code> is not equivalent to <code>undefined</code>).</p>\n\n<p>In your example, you add an <code>Identity</code> constructor, but that is from the <code>newtype Identity</code>!! So, when calling</p>\n\n<pre><code>return $ traceShow x $ Result x\n</code></pre>\n\n<p>the <code>return</code> here does not wrap anything, and the <code>traceShow</code> is immediately triggered as soon as <code>mapM</code> is run.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1464724269, "creation_date": 1464724269, "answer_id": 37554476, "question_id": 37538532, "link": "https://stackoverflow.com/questions/37538532/io-monad-prevents-short-circuiting-of-embedded-mapm/37554476#37554476", "title": "IO monad prevents short circuiting of embedded mapM?", "body": "<p>Your <code>Result</code> type appears to be virtually identical to <code>Maybe</code>, with</p>\n\n<pre><code>Result &lt;-&gt; Just\nFailure &lt;-&gt; Nothing\n</code></pre>\n\n<p>For the sake of my poor brain, I'll stick to <code>Maybe</code> terminology in the rest of this answer.</p>\n\n<p>chi explained why <code>IO (Maybe a)</code> does not short-circuit the way you expected. But there <em>is</em> a type you can use for this sort of thing! It's essentially the same type, in fact, but with a different <code>Monad</code> instance. You can find it in <code>Control.Monad.Trans.Maybe</code>. It looks something like this:</p>\n\n<pre><code>newtype MaybeT m a = MaybeT\n  { runMaybeT :: m (Maybe a) }\n</code></pre>\n\n<p>As you can see, this is just a <code>newtype</code> wrapper around <code>m (Maybe a)</code>. But its <code>Monad</code> instance is very different:</p>\n\n<pre><code>instance Monad m =&gt; Monad (MaybeT m) where\n  return a = MaybeT $ return (Just a)\n  m &gt;&gt;= f = MaybeT $ do\n    mres &lt;- runMaybeT m\n    case mres of\n      Nothing -&gt; return Nothing\n      Just a -&gt; runMaybeT (f a)\n</code></pre>\n\n<p>That is, <code>m &gt;&gt;= f</code> runs the <code>m</code> computation in the underlying monad, getting <code>Maybe</code> something or other. If it gets <code>Nothing</code>, it just stops, returning <code>Nothing</code>. If it gets something, it passes that to <code>f</code> and runs the result. You can also turn any <code>m</code> action into a \"successful\" <code>MaybeT m</code> action using <code>lift</code> from <code>Control.Monad.Trans.Class</code>:</p>\n\n<pre><code>class MonadTrans t where\n  lift :: Monad m =&gt; m a -&gt; t m a\n\ninstance MonadTrans MaybeT where\n  lift m = MaybeT $ Just &lt;$&gt; m\n</code></pre>\n\n<p>You can also use this class, defined somewhere like <code>Control.Monad.IO.Class</code>, which is often clearer and can be much more convenient:</p>\n\n<pre><code>class MonadIO m where\n  liftIO :: IO a -&gt; m a\n\ninstance MonadIO IO where\n  liftIO m = m\n\ninstance MonadIO m =&gt; MonadIO (MaybeT m) where\n  liftIO m = lift (liftIO m)\n</code></pre>\n"}], "owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 37539042, "answer_count": 2, "score": 11, "last_activity_date": 1464724269, "creation_date": 1464676838, "question_id": 37538532, "link": "https://stackoverflow.com/questions/37538532/io-monad-prevents-short-circuiting-of-embedded-mapm", "title": "IO monad prevents short circuiting of embedded mapM?", "body": "<p>Somewhat mystified by the following code. In non-toy version of the problem I'm trying to do a monadic computation in a monad Result, the values of which can only be constructed from within IO. Seems like the magic behind IO makes such computations strict, but I can't figure out how exactly that happens.</p>\n\n<p>The code:</p>\n\n<pre><code>data Result a = Result a | Failure deriving (Show)\n\ninstance Functor Result where\n  fmap f (Result a) = Result (f a)\n  fmap f Failure = Failure\n\ninstance Applicative Result where\n  pure = return\n  (&lt;*&gt;) = ap\n\ninstance Monad Result where\n  return = Result\n  Result a &gt;&gt;= f = f a\n  Failure &gt;&gt;= _ = Failure\n\ncompute :: Int -&gt; Result Int\ncompute 3 = Failure\ncompute x = traceShow x $ Result x\n\ncompute2 :: Monad m =&gt; Int -&gt; m (Result Int)\ncompute2 3 = return Failure\ncompute2 x = traceShow x $ return $ Result x\n\ncompute3 :: Monad m =&gt; Int -&gt; m (Result Int)\ncompute3 = return . compute\n\nmain :: IO ()\nmain = do\n  let results = mapM compute [1..5]\n  print $ results\n  results2 &lt;- mapM compute2 [1..5]\n  print $ sequence results2\n  results3 &lt;- mapM compute3 [1..5]\n  print $ sequence results3\n  let results2' = runIdentity $ mapM compute2 [1..5]\n  print $ sequence results2'\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>1\n2\nFailure\n1\n2\n4\n5\nFailure\n1\n2\nFailure\n1\n2\nFailure\n</code></pre>\n"}, {"tags": ["scala", "haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464667043, "post_id": 37536290, "comment_id": 62563132, "body": "I don&#39;t know much scala but isn&#39;t it just the same as in the citation? I would assume the <code>A</code> in <code>def identity[A](x: A): A</code> to be a <code>forall A</code> as well"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1464667184, "last_edit_date": 1495535644, "creation_date": 1464667184, "answer_id": 37536604, "question_id": 37536290, "link": "https://stackoverflow.com/questions/37536290/universally-quantified-types-in-haskell-and-scala/37536604#37536604", "title": "Universally Quantified Types in Haskell and Scala?", "body": "<p>I am not a Scala expert, but my understanding is that all Scala type parameters are universally quantified (i.e. declared with a <code>forall</code>) <em>unless</em> they are explicitly quantified with <code>forSome</code>. See, for instance:</p>\n\n<p><a href=\"https://stackoverflow.com/q/9444958/866915\">What is the forSome keyword in Scala for?</a> </p>\n\n<p>In Haskell we use the <code>forall</code> keyword to declare existential types. It may seem counter-intuitive to use <code>forall</code> when we mean <code>for some</code>, but it can be done using the logical equivalence of the following statements:</p>\n\n<pre><code>(forSome x. P(x))  implies  Q   \n\n(forall x. P(x)    implies  Q)\n</code></pre>\n\n<p>Here Q is a statement not containing <em>x</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 582, "user_id": 5236247, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/X84Js.png?s=128&g=1", "display_name": "Adowrath", "link": "https://stackoverflow.com/users/5236247/adowrath"}, "edited": false, "score": 0, "creation_date": 1490483324, "post_id": 37538157, "comment_id": 73133235, "body": "I did not quite understand your third point, possibly because I am not familiar with what the Haskell example is: What exactly is the benefit of the Poly1 approach over a standard <code>Int =&gt; Int</code>?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 582, "user_id": 5236247, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/X84Js.png?s=128&g=1", "display_name": "Adowrath", "link": "https://stackoverflow.com/users/5236247/adowrath"}, "edited": false, "score": 1, "creation_date": 1490528179, "post_id": 37538157, "comment_id": 73142284, "body": "@Adowrath For this case, there&#39;s no difference. Consider <code>def f3(p: Poly1, x: Int, y: Bool) = (f3(x), f3(y))</code> instead (unlike Haskell, Scala also could use <code>Any =&gt; Any</code> here, but it&#39;ll give a different, and less precise, return type)."}, {"owner": {"reputation": 582, "user_id": 5236247, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/X84Js.png?s=128&g=1", "display_name": "Adowrath", "link": "https://stackoverflow.com/users/5236247/adowrath"}, "edited": false, "score": 0, "creation_date": 1490546645, "post_id": 37538157, "comment_id": 73148664, "body": "Interesting. I thought this would be possible with the existential type as well, but it seems my understanding wasn&#39;t sufficient. Thanks!"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 7, "last_activity_date": 1464675454, "creation_date": 1464675454, "answer_id": 37538157, "question_id": 37536290, "link": "https://stackoverflow.com/questions/37536290/universally-quantified-types-in-haskell-and-scala/37538157#37538157", "title": "Universally Quantified Types in Haskell and Scala?", "body": "<p>There is no <em>explicit</em> <code>forall</code> in Scala, but it has equivalents to the different ways explicit <code>forall</code>s are used in Haskell: </p>\n\n<ol>\n<li><p>To enable <code>ScopedTypeVariables</code>: not necessary, as Scala type variables are scoped by default.</p></li>\n<li><p>For existential types: Scala supports them directly.</p></li>\n<li><p>For higher-rank types, i.e. ones which have a <code>forall</code> nested under function arrows: consider this example:</p>\n\n<pre><code>f2 :: (forall a. a-&gt;a) -&gt; Int -&gt; Int\nf2 f x = f x\n</code></pre>\n\n<p>In Scala <code>[A](A =&gt; A)</code> can't be used directly, but </p>\n\n<pre><code>trait Poly1 {\n  def apply[A](x: A): A\n}\n</code></pre>\n\n<p>is equivalent to it, so you can implement <code>f2</code>:</p>\n\n<pre><code>def f2(p: Poly1, x: Int) = p(x)\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 3, "accepted_answer_id": 37538157, "answer_count": 2, "score": 3, "last_activity_date": 1464675454, "creation_date": 1464664597, "question_id": 37536290, "link": "https://stackoverflow.com/questions/37536290/universally-quantified-types-in-haskell-and-scala", "title": "Universally Quantified Types in Haskell and Scala?", "body": "<p><a href=\"https://en.wikibooks.org/wiki/Haskell/Existentially_quantified_types\" rel=\"nofollow\">Existentially quantified types</a> explains:</p>\n\n<blockquote>\n  <p>any use of a lowercase type implicitly begins with a <code>forall</code> keyword, so the two type declarations for map are equivalent, as are the declarations below:</p>\n</blockquote>\n\n<pre><code>id :: a -&gt; a\nid :: forall a . a -&gt; a\n</code></pre>\n\n<p>Given Scala's <a href=\"http://www.scala-lang.org/api/rc2/scala/Predef$.html\" rel=\"nofollow\">scala.Predef#identity</a>, is there a <code>forall</code> equivalent, i.e. per Haskell's above second function?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 3, "creation_date": 1464640281, "post_id": 37533052, "comment_id": 62556864, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/35785176/check-whether-a-type-is-an-instance-of-show-in-haskell\">Check whether a type is an instance of Show in Haskell?</a>"}, {"owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 5, "creation_date": 1464641428, "post_id": 37533052, "comment_id": 62557279, "body": "<a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">wiki.haskell.org/GHC/AdvancedOverlap</a> has that exact problem and solutions. I would not recommend implementing them!"}, {"owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "reply_to_user": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 0, "creation_date": 1464754027, "post_id": 37533052, "comment_id": 62606882, "body": "@ibotty That looks interesting. Thanks for the share. I may not heed your warning though :P"}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "edited": false, "score": 0, "creation_date": 1464753991, "post_id": 37535830, "comment_id": 62606864, "body": "Thanks for this answer. This is more or less what I was thinking of, but @ibotty provided an interesting resource that I ultimately ended up using (at least for the time being(, for better or for worse."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 4, "last_activity_date": 1464664378, "last_edit_date": 1464664378, "creation_date": 1464660939, "answer_id": 37535830, "question_id": 37533052, "link": "https://stackoverflow.com/questions/37533052/haskell-safe-show/37535830#37535830", "title": "Haskell: safe &#39;show&#39;", "body": "<p>How about this:</p>\n\n<pre><code>fromRightWith :: (a -&gt; String) -&gt; Either a b -&gt; b\nfromRightWith show (Left a) = error $ \"fromRight: (Left \" ++ show a ++ \")\"\nfromRightWith _ (Right b) = b\n\nfromRight :: Either a b -&gt; b\nfromRight = fromRightWith $ const \"_\"\n\nfromRight' :: Show a =&gt; Either a b -&gt; b\nfromRight' = fromRightWith show\n</code></pre>\n\n<p>Then if, in your code, you know that <code>a</code> is an instance of <code>Show</code>, use <code>fromRight'</code>. If not, use <code>fromRight</code>:</p>\n\n<pre><code>instance Show MyError where\n  show = -- ..\n\ntrySomething :: IO (Either MyError Value)\ntrySomething = --- ..\n\nmain = do\n  value &lt;- fromRight' &lt;$&gt; trySomething\n  -- ..\n</code></pre>\n"}], "owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "accepted_answer_id": 37535830, "answer_count": 1, "score": 2, "last_activity_date": 1464675127, "creation_date": 1464639045, "last_edit_date": 1464675127, "question_id": 37533052, "link": "https://stackoverflow.com/questions/37533052/haskell-safe-show", "title": "Haskell: safe &#39;show&#39;", "body": "<p>As part of a larger project written in Haskell, I am working on a small utility library to encapsulate common paradigms I use throughout my code. One function (or two functions, rather) that I was working on are <code>fromLeft :: Either a b -&gt; a</code> and <code>fromRight :: Either a b -&gt; b</code>, which are partial functions that are undefined (<code>error</code> to be exact) on antichiral constructors:</p>\n\n<pre><code>fromLeft :: Either a b -&gt; a\nfromLeft x = case x of\n               (Left x) -&gt; x\n               (Right y) -&gt; error \"fromLeft: (Right _)\"\n\nfromRight :: Either a b -&gt; b\nfromRight x = case x of\n                (Right x) -&gt; x\n                (Left y) -&gt; error \"fromRight: (Left _)\"\n</code></pre>\n\n<p>In any case, I wanted to extend these functions if possible so that, if the <code>y</code> in the second pattern match for each function were of a type that were <code>show</code>able, it would be printed instead of <code>\"_\"</code>. However, there is no obvious way to go about that without putting a constraint in the signature, which would make these functions lose their generality.</p>\n\n<p>Is there any extension or module voodoo that can selectively perform typeclass functions for instances of those typeclasses and return a general result for other types? More specifically, is there any way in Haskell to write a program that simulates the invalid function\n<code>\\x -&gt; if (showable x) then show x else \"_\"</code></p>\n"}, {"tags": ["haskell", "xmonad", "mate"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464638551, "post_id": 37532560, "comment_id": 62556142, "body": "It looks like <code>xmonad-mate</code> is just a configuration file - right? So just build <code>xmonad</code> using the ghc you already have. Do you know how to manually build an application from Hackage?"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464638924, "post_id": 37532560, "comment_id": 62556276, "body": "sure I know regularily build xmonad from hackage, and install/compile ghc. But where to put what config files to please gdm and mate is a complete mystery to me..."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464639188, "post_id": 37532560, "comment_id": 62556381, "body": "according to <a href=\"http://koji.fedoraproject.org/koji/rpminfo?rpmID=7624204\" rel=\"nofollow noreferrer\">this</a> <code>xmonad-mate</code> consists of a single file placed in the directory /usr/share/xsessions. Does that help?"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464641211, "post_id": 37532560, "comment_id": 62557197, "body": "well, plus (at least) /usr/bin/xmonad-start is needed."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1464639467, "creation_date": 1464639467, "answer_id": 37533120, "question_id": 37532560, "link": "https://stackoverflow.com/questions/37532560/how-to-get-rid-of-the-ghc-dependency-of-xmonad-mate/37533120#37533120", "title": "how to get rid of the ghc dependency of xmonad-mate?", "body": "<p>I would go to this page:</p>\n\n<p><a href=\"http://koji.fedoraproject.org/koji/buildinfo?buildID=757093\" rel=\"nofollow\">http://koji.fedoraproject.org/koji/buildinfo?buildID=757093</a></p>\n\n<p>find your architecture, and click on all the <strong>(info)</strong> links. On each info page at the bottom there is a list of file contained in the package.</p>\n\n<p>Just go through each one and see what files are placed where when the package is installed.</p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1464639467, "creation_date": 1464636704, "question_id": 37532560, "link": "https://stackoverflow.com/questions/37532560/how-to-get-rid-of-the-ghc-dependency-of-xmonad-mate", "title": "how to get rid of the ghc dependency of xmonad-mate?", "body": "<p>I am on fedora, and use the <code>xmonad-mate</code> package. This depends on <code>ghc</code>, and I don't want this, because I have (newer) ghc installed anyway, so it just wastes space on disk, and time/downloads on upgrades.</p>\n\n<p>Why do I use the package at all? Because it seems the foolproof way to get everything configured, and have it as option in <code>gdm</code>, and start <code>mate-panel</code>, etc.</p>\n\n<p>I understand the dependency on ghc (needed to re-compile .xmonad/xmonad.hs) but I do want to side-track it. Like, provide a dummy <code>ghc</code> (and <code>ghc-xmonad</code>) package? But then - if that's more cumbersome than isolating the config files ...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1464636664, "post_id": 37532381, "comment_id": 62555438, "body": "A general strategy that often helps with errors like this is to add type signatures to your functions."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464648531, "post_id": 37532381, "comment_id": 62559248, "body": "Unrelated to your problem, but you may prefer <code>readLn</code> over <code>read &lt;$&gt; getLine</code> in the future; on parse errors, the former throws an IO exception right away, instead of a difficult-to-trace pure exception at some ill-defined later point."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 5055758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6aac0826e8af0fcfea76a2da9e72d974?s=128&d=identicon&r=PG&f=1", "display_name": "v.sharath chandra", "link": "https://stackoverflow.com/users/5055758/v-sharath-chandra"}, "edited": false, "score": 0, "creation_date": 1464665898, "post_id": 37533257, "comment_id": 62562836, "body": "I want to print the result in different lines so I added &quot;\\n&quot; but it is not working."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1464640073, "creation_date": 1464640073, "answer_id": 37533257, "question_id": 37532381, "link": "https://stackoverflow.com/questions/37532381/no-instance-error-in-haskell-program/37533257#37533257", "title": "No Instance Error in Haskell Program", "body": "<p>You need to use <code>div</code> instead of <code>/</code>.</p>\n\n<p><code>div</code> will take two Integral values and return another Integral value - e.g. <code>div 5 2 == 2</code>. Then you'll also need to get rid of the <code>truncate</code> call.</p>\n\n<p><code>/</code> does \"floating point\" division.</p>\n\n<p><code>fromIntegral</code> will convert an Integral value to any other <code>Num</code> type.</p>\n"}], "owner": {"reputation": 81, "user_id": 5055758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6aac0826e8af0fcfea76a2da9e72d974?s=128&d=identicon&r=PG&f=1", "display_name": "v.sharath chandra", "link": "https://stackoverflow.com/users/5055758/v-sharath-chandra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 37533257, "answer_count": 1, "score": 0, "last_activity_date": 1464640073, "creation_date": 1464635834, "question_id": 37532381, "link": "https://stackoverflow.com/questions/37532381/no-instance-error-in-haskell-program", "title": "No Instance Error in Haskell Program", "body": "<p>I wanted to Print to A pascal Triangle for a given Length.</p>\n\n<pre><code>main = do \n  l_str &lt;- getLine\n  let l_int = read $ l_str :: Int     \n  let why = print_row l_int 0\n  print why\n  return ()\n\nprint_row x y\n     | (x &lt; y) = \" \"    \n     | otherwise = (print_column y 0 ) ++ \"\\n\" ++ print_row x (y+1) \nprint_column y r\n     | (y &lt; r) = \"\"\n     | otherwise = (show $ fact y r ) ++ print_column y (r+1)   \nfact n r\n     |  (n &gt;= r) = truncate $ (fact' n)/((fact' (n-r))*(fact' r))\nfact' n\n     | (n &gt;= 0) = product [1..n]    \n</code></pre>\n\n<p>I have checked all my functions \"print_row\" ,\"print_column\" everything works fine.\nI am getting this error:</p>\n\n<blockquote>\n  <p>PascalTriangle.hs:4:17:<br>\n      No instance for (RealFrac Int) arising from a use of \u2018fact\u2019<br>\n      In the expression: fact l_int 0<br>\n      In an equation for \u2018why\u2019: why = fact l_int 0<br>\n      In the expression:<br>\n        do { l_str &lt;- getLine;<br>\n             let l_int = ...;<br>\n             let why = fact l_int 0;<br>\n             print why;<br>\n             .... }  </p>\n</blockquote>\n\n<p>I am not able Understand anything about this error.The pogram works fine when I use a constant instead of l_int in line 4.Like let why = print_row 4 0.</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1464634817, "post_id": 37532120, "comment_id": 62554745, "body": "You have discovered one of the interesting properties of Haskell\u2014its purity. You cannot perform an IO action and return a result <i>not</i> wrapped in IO. This is because Haskell functions cannot perform arbitrary side effects; they must be pure. You <i>could</i> return an <code>IO Env</code>, which seems to be what you\u2019re looking for here, based on your use of <code>do</code> and <code>return</code>."}, {"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1464634906, "post_id": 37532120, "comment_id": 62554773, "body": "@AlexisKing Does this mean I should convert all my other &quot;eval&quot; functions to return IO Env&#39;s too? And &quot;unwrapping&quot; them in every situation ?"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1464635474, "post_id": 37532120, "comment_id": 62554999, "body": "You might want to look into using a free monad to avoid committing to <code>IO</code>.  <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">haskellforall.com/2012/06/&hellip;</a>"}, {"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1464636822, "post_id": 37532120, "comment_id": 62555491, "body": "@AlexisKing , I tried messing with the code some more to have eg <code>evalAssign</code> returning and acception <code>IO Env</code>&#39;s. I did not succeed :/ . Could you provide some examples / help for my problem, if possible."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464643102, "post_id": 37532120, "comment_id": 62557826, "body": "It takes a certain number of scraped knees to figure out how to keep pure code pure and confine the <code>IO</code> business to the periphery. I may try to write an answer later, but that may be better left to a more experienced teacher than me."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1464676819, "post_id": 37533753, "comment_id": 62566641, "body": "A potential improvement over this would be to use <code>StateT Env IO</code> as the monad, which would allow you omit passing around the <code>Env</code> by hand, and also you could write <code>eval (Seq ss) = mapM_ eval ss</code> etc."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1464642999, "creation_date": 1464642999, "answer_id": 37533753, "question_id": 37532120, "link": "https://stackoverflow.com/questions/37532120/perform-io-action-but-return-other-type/37533753#37533753", "title": "Perform IO action, but return other type", "body": "<p>Your AExpr and BExpr types represent pure computations in your language - not only don't they do any IO, but they also don't modify the environment. Consequently you shouldn't have to modify their eval functions.</p>\n\n<p>So you just have to modify the evalution of <code>Stmt</code> values. The type signature will change to:</p>\n\n<pre><code>eval :: Stmt -&gt; Env -&gt; IO Env\n</code></pre>\n\n<p>An example of how <code>eval Seq</code> will change:</p>\n\n<pre><code>eval (Seq []) env     = return env\neval (Seq (s:ss)) env = do env' &lt;- eval s env  -- eval the first statement\n                           eval (Seq ss) env'  -- eval the rest\n</code></pre>\n\n<p>Note that <code>eval If</code> doesn't need to change:</p>\n\n<pre><code>eval (If bool stmt1 stmt2) env = \n  if evalBExpr bool env\n    then eval stmt1 env\n    else eval stmt2 env\n</code></pre>\n\n<p><code>evalMotorInstruct</code> will compile if you change it's signature to:</p>\n\n<pre><code>evalMotorInstruct :: String -&gt; AExpr -&gt; Env -&gt; IO Env\n</code></pre>\n\n<p>I'll leave the rest to you.</p>\n\n<p>When refactoring, just comment out the code which doesn't compile. Then incrementally add the lines back in one-by-one getting each to compile before adding another line. Use <code>... = undefined</code> if you need to. Come back and fill those in later.</p>\n"}], "owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464642999, "creation_date": 1464634505, "question_id": 37532120, "link": "https://stackoverflow.com/questions/37532120/perform-io-action-but-return-other-type", "title": "Perform IO action, but return other type", "body": "<p>For a project we were given the task to write an imperative language and execute it via Haskell. The parser (omitted here) and parts of the evaluation are done. Now only remains to code the effects. Manipulating a little robot.</p>\n\n<p>Given the following code: </p>\n\n<pre><code>data Env = Env [Binding]\ninstance Show Env where\n  show (Env (x:xs)) = show x ++ \", \" ++ show (Env xs)\n  show (Env []) = \"\"\n\ndata Binding = Binding (String,Int)\ninstance Show Binding where\n  show (Binding x) = fst x ++ \" : \" ++ show (snd x)\n\nlookup' :: String -&gt; Env -&gt; Int\nlookup' zoek (Env env) = case elemIndex zoek [fst x | Binding x &lt;- env] of\n  Just y -&gt;  y\n  Nothing -&gt; error \"Not found\"\n\n\neval :: Stmt -&gt; Env -&gt;  Env\neval (Seq s) env = foldl (flip eval) env s\neval (Assign varName aexpr) env = evalAssign varName aexpr env\neval (If bool stmt1 stmt2) env = evalIf bool stmt1 stmt2 env\neval (While bool stmt) env = undefined\neval (MotorInstruct string aExpr) env = undefined\neval (SensorRead string) env = undefined\neval Skip env = env\n\nevalAExpr :: AExpr -&gt; Env -&gt; Int\nevalAExpr (IntConst int) _  = fromInteger int\nevalAExpr (Neg a) env = - evalAExpr a env\nevalAExpr (ABinary Add a b) env = evalAExpr a env + evalAExpr b env\nevalAExpr (ABinary Subtract a b) env = evalAExpr a env - evalAExpr b env\nevalAExpr (ABinary Multiply a b) env = evalAExpr a env * evalAExpr b env\nevalAExpr (ABinary Divide a b) env = evalAExpr a env `div` evalAExpr b env\nevalAExpr (Var x) env = getElementAtEnv env (lookup' x env)\n  where\n    getElementAtEnv (Env env) index = getSndFromBinding (env !! index)\n    getSndFromBinding (Binding (_,t)) = t\n\n\nevalBExpr :: BExpr -&gt; Env -&gt; Bool\nevalBExpr (BoolConst bool) _ = bool\nevalBExpr (Not expr) env = not $ evalBExpr expr env\n-- Boolean operators\nevalBExpr (BBinary And a b) env = evalBExpr a env &amp;&amp; evalBExpr b env\nevalBExpr (BBinary Or a b) env = evalBExpr a env || evalBExpr b env\n-- Relational operators\nevalBExpr (RBinary Greater a b) env = evalAExpr a env &gt; evalAExpr b env\nevalBExpr (RBinary Less a b) env = evalAExpr a env &lt; evalAExpr b env\nevalBExpr (RBinary Equal a b) env = evalAExpr a env == evalAExpr b env\n\n\nevalIf ::  BExpr -&gt; Stmt -&gt; Stmt -&gt; Env -&gt; Env\nevalIf expr s1 s2 env = if evalBExpr expr env\n  then\n    eval s1 env\n  else\n    eval s2 env\n\n\nevalAssign :: String -&gt; AExpr -&gt; Env -&gt; Env\nevalAssign term s (Env env)= if term `elem` transform\n  then\n    Env ( take (lookup' term (Env env)) env ++ [Binding (term, evalAExpr s (Env env))]++ drop (lookup' term (Env env) + 1) env)\n  else\n    Env (env ++ [Binding (term, evalAExpr s (Env env))])\n  where transform = [ fst ele | Binding ele &lt;- env]\n\n\nzoekMotor :: String -&gt; Int\nzoekMotor \"left\" = 0x9\nzoekMotor \"right\" = 0xa\nzoekMotor _ = error \"No such motor\"\n\n\nsendToMotor :: String -&gt; Int -&gt; IO()\nsendToMotor m s = do\n  bot &lt;- openMBot\n  sendCommand bot $ setMotor (zoekMotor m) s s\n  closeMBot bot\n\nevalMotorInstruct :: String -&gt; AExpr -&gt; Env -&gt; Env\nevalMotorInstruct welke waarde env = do\n  sendToMotor welke (evalAExpr waarde env)\n  return env\n</code></pre>\n\n<p>How would I go about executing the function <code>sendToMotor</code> (which returns <code>IO()</code>) in my evaluating function <code>evalMotorInstruct</code> which should return an <code>Env</code>? I'm somewhat to a loss as to how I would execute my 'action' - function and only get my <code>Env</code> back out of the evaluation function.</p>\n\n<p>Note that the current code for <code>evalMotorInstruct</code> is not correct. The function is supposed to return an <code>Env</code>, but actually returns an <code>IO Env</code></p>\n\n<p>Thank you</p>\n"}, {"tags": ["haskell", "read-eval-print-loop"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1464629673, "post_id": 37531049, "comment_id": 62552610, "body": "they don&#39;t do the same thing at all - <code>div</code> is division with remainder and <code>&#47;</code>is ... well fractional division - think <code>5 &#47; 2 = 2.5</code> vs <code>5 `div` 2 = 2</code> - can you see the difference? - The difference between the classes is just that - <code>Integral</code> is for numbers you can do division with remainder with and fractional is for rational-like numbers (<code>a&#47;b</code>)"}, {"owner": {"reputation": 392, "user_id": 3266372, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ade6e897ca0df87d7576e7c1557dbd3e?s=128&d=identicon&r=PG&f=1", "display_name": "kmos.w", "link": "https://stackoverflow.com/users/3266372/kmos-w"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464629777, "post_id": 37531049, "comment_id": 62552645, "body": "Now I See.. Thanks :-)"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464632429, "post_id": 37531049, "comment_id": 62553696, "body": "@Carsten: Could you post that as an answer for better visibility? Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1464641193, "last_edit_date": 1464641193, "creation_date": 1464640667, "answer_id": 37533370, "question_id": 37531049, "link": "https://stackoverflow.com/questions/37531049/haskell-type-classes-difference-between-div-and/37533370#37533370", "title": "Haskell type classes - difference between div and /?", "body": "<p>There is a conceptual difference between those operations:</p>\n\n<ul>\n<li><code>div</code> is division with remainder (see <a href=\"https://en.wikipedia.org/wiki/Euclidean_domain\" rel=\"nofollow\">euclidean domain</a>)</li>\n<li><code>(/)</code> is fractional division - this is the <em>inverse</em> operation to <code>(*)</code></li>\n</ul>\n\n<p>think <code>5 / 2 = 2.5</code> vs <code>5 `div` 2 = 2</code></p>\n\n<p>The difference between the <em>classes</em> is just that </p>\n\n<ul>\n<li><code>Integral</code> is for numbers you can do division with remainder with </li>\n<li>and <code>Fractional</code> is for rational-like numbers in the form of <code>a/b</code> - think of <code>1/2</code> or <code>2/7</code>, etc.</li>\n</ul>\n\n<p>Indeed this is a common problem if you mix both <code>Fractional</code> and <code>Integral</code> operations like <code>div</code> and <code>(/)</code> as just within the <em>prelude</em> there is no type that is an instance of both of these classes and so you end up with an well-typed expression that you often cannot evaluate.</p>\n\n<p>The usual <em>fix</em> for this is using <code>fromIntegral</code> to go convert into the common <code>Num</code> instance you are targeting.</p>\n"}], "owner": {"reputation": 392, "user_id": 3266372, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ade6e897ca0df87d7576e7c1557dbd3e?s=128&d=identicon&r=PG&f=1", "display_name": "kmos.w", "link": "https://stackoverflow.com/users/3266372/kmos-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464641193, "creation_date": 1464629561, "last_edit_date": 1464630609, "question_id": 37531049, "link": "https://stackoverflow.com/questions/37531049/haskell-type-classes-difference-between-div-and", "title": "Haskell type classes - difference between div and /?", "body": "<p>When I query the type of <code><code>div</code></code> infix operator and the <code>/</code> operator in Ghci, I find that <code>div</code> has the signature <code>(div) :: Integral a =&gt; a -&gt; a -&gt; a</code> while <code>/</code> has the signature <code>(/) Fractional a =&gt; a -&gt; a -&gt; a</code>. While they accomplish pretty much the same thing, what is the difference between type classes <code>Fractional</code> and <code>Integral</code>?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1464629439, "post_id": 37530987, "comment_id": 62552514, "body": "Look at the GHC Core. Use <code>-ddump-simpl</code> and search for the dictionary arguments."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1464632462, "post_id": 37530987, "comment_id": 62553708, "body": "I&#39;m curious. What&#39;s the differences between <code>a ~ b =&gt; Transformable a b</code> and <code>Transformable a a</code> ?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1464637592, "post_id": 37530987, "comment_id": 62555760, "body": "I&#39;m not sure I need it in that case. I simplified my code which neede it. There a great explanation <a href=\"http://chrisdone.com/posts/haskell-constraint-trick\" rel=\"nofollow noreferrer\">there</a>"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464638491, "post_id": 37530987, "comment_id": 62556122, "body": "@chi <code>-ddump-simpl</code> gives something indeed but it&#39;s quite opaque. Could you give me a hint on what to look for ?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1464634267, "post_id": 37531353, "comment_id": 62554511, "body": "The OP asks: &quot;Is it possible to know <b>(at compile time)</b>...&quot;"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1464634585, "post_id": 37531353, "comment_id": 62554642, "body": "I did that and its a indeed. But I&#39;m interested to know if there is magic flag to see at compile time . +1anyway"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464630999, "creation_date": 1464630999, "answer_id": 37531353, "question_id": 37530987, "link": "https://stackoverflow.com/questions/37530987/is-there-a-way-to-trace-overlapping-instance-decision/37531353#37531353", "title": "Is there a way to trace overlapping instance decision", "body": "<p>You can always use <code>Debug.Trace</code>:</p>\n\n<pre><code>import Debug.Trace\n...\n\ninstance Transformable a Int where\n  transform _ = trace \"using Int definition\" 17\n\ninstance a ~ b =&gt; Transformable a b where\n  transform x = trace \"using a ~ b definition\" x\n</code></pre>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1464630999, "creation_date": 1464629267, "question_id": 37530987, "link": "https://stackoverflow.com/questions/37530987/is-there-a-way-to-trace-overlapping-instance-decision", "title": "Is there a way to trace overlapping instance decision", "body": "<p>Is it possible to know (at compile time) which instance does the compiler chose in case of overlapping instance ?</p>\n\n<p>Contrived example,</p>\n\n<pre><code>{-# LANGUAGE IncoherentInstances #-}\n\n\nclass Transformable a b where\n  transform :: a -&gt; b\n\ninstance Transformable a Int where\n  transform _ = 17\n\ninstance a ~ b =&gt; Transformable a b where\n  transform x = x\n</code></pre>\n\n<p>What is the result of <code>tranform (1:: Int) :: Int</code> ? (1 or 17)\nIs there a way to know when instanciating <code>Transformable Int Int</code> if the compiler schose instance 1 or instance 2 ?\nIt is also sometime usefull when there is no overlap but the chain of instanciation is complicated.</p>\n"}, {"tags": ["parsing", "haskell", "parsec", "bijection"], "comments": [{"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1475268643, "post_id": 37529673, "comment_id": 66892422, "body": "Parsing libraries generally construct an &quot;Abstract Syntax Tree&quot;, which leaves out all formatting. What you are looking for is a &quot;Concrete Syntax Tree&quot;. I don&#39;t know of any libraries which build this."}, {"owner": {"reputation": 25686, "user_id": 975097, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/dbbc1b2bc18739858cfa3b7ddcba7362?s=128&d=identicon&r=PG", "display_name": "Anderson Green", "link": "https://stackoverflow.com/users/975097/anderson-green"}, "edited": false, "score": 0, "creation_date": 1547072473, "post_id": 37529673, "comment_id": 95071075, "body": "I usually use <a href=\"https://stackoverflow.com/a/44347314/975097\">definite clause grammars</a> in Prolog for bidirectional parsing, but I haven&#39;t seen anything like this in Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "is_accepted": false, "score": 1, "last_activity_date": 1464626410, "last_edit_date": 1495540853, "creation_date": 1464624396, "answer_id": 37529859, "question_id": 37529673, "link": "https://stackoverflow.com/questions/37529673/is-there-an-established-way-to-write-parsers-that-can-reconstruct-their-exact-in/37529859#37529859", "title": "Is there an established way to write parsers that can reconstruct their exact input?", "body": "<p>A solution implemented in Haskell?  I don't know of one; they may exist.</p>\n\n<p>In general, though, one can store enough information to regenerate a legal version of the program that resembles the original to an arbitrary degree, by storing \"formatting\" information with collected tokens.  In the limit, the format information <em>is</em> the original string for the token; any approximation of that will give successively less accurate answers.</p>\n\n<p>If you keep whitespace as explicit tokens in the parse tree, in the limit you can even regenerate that.   Whether that is useful likely depends on the application.  In general, I think this is overkill.</p>\n\n<p>Details on what/how to capture and how to regenerate can be found in my SO answer: <a href=\"https://stackoverflow.com/questions/5832412/compiling-an-ast-back-to-source-code/5834775#5834775\">Compiling an AST back to source code</a></p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1464627460, "post_id": 37530489, "comment_id": 62551696, "body": "Yes, that&#39;s great work; but does it really adress my problem? I was under the impression that these invertible parsers mainly guarantee <code>parse . print \u2261 id</code>. Can they also assure anything about <code>print . parse</code>?"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1464627837, "post_id": 37530489, "comment_id": 62551845, "body": "If you&#39;re pretty-printing, then <code>print ( parse s) === s</code> modulo whitespace? It should be even easier to build basic printer/parsers for exact-printing."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1464628022, "post_id": 37530489, "comment_id": 62551931, "body": "Well, the thing is, in my application <i>most</i> of the file is \u201cwhitespace\u201d (or rather \u201ccomments\u201d), since I don&#39;t bother to actually parse most of the content in detail, only a few variables."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1464628555, "post_id": 37530489, "comment_id": 62552167, "body": "You need a whitespace parser that returns what it has read, and not ignores it? The &quot;lens&quot; model looks reasonable to me. Whether it&#39;s useful would depend on the combinators. I would not just blame the type..."}], "tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 2, "last_activity_date": 1464628316, "last_edit_date": 1464628316, "creation_date": 1464627029, "answer_id": 37530489, "question_id": 37529673, "link": "https://stackoverflow.com/questions/37529673/is-there-an-established-way-to-write-parsers-that-can-reconstruct-their-exact-in/37530489#37530489", "title": "Is there an established way to write parsers that can reconstruct their exact input?", "body": "<p>Is this a case of \"bidirectional transformation\"? E.g.,  <a href=\"http://ceur-ws.org/Vol-1571/\" rel=\"nofollow\">http://ceur-ws.org/Vol-1571/</a> </p>\n\n<p>In particular, \"Invertible Syntax Descriptions: Unifying Parsing and Pretty Printing\" by Rendel and Osterman \n<a href=\"http://dblp.org/rec/conf/haskell/RendelO10\" rel=\"nofollow\">http://dblp.org/rec/conf/haskell/RendelO10</a> , Haskell Symposium 2010 (cf. <a href=\"http://lambda-the-ultimate.org/node/4191\" rel=\"nofollow\">http://lambda-the-ultimate.org/node/4191</a> )</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 1, "answer_count": 2, "score": 14, "last_activity_date": 1464628316, "creation_date": 1464623648, "last_edit_date": 1464623948, "question_id": 37529673, "link": "https://stackoverflow.com/questions/37529673/is-there-an-established-way-to-write-parsers-that-can-reconstruct-their-exact-in", "title": "Is there an established way to write parsers that can reconstruct their exact input?", "body": "<p>Say I want to parse a file in language <em>X</em>. Really, I'm only interested in a small part of the information within. It's easy enough to write a parser in one of Haskell's many eDSLs for that purpose (e.g. Megaparsec).</p>\n\n<pre><code>data Foo = Foo Int  -- the information I'm after.\n\nparseFoo :: Parsec Text Foo\nparseFoo = ...\n</code></pre>\n\n<p>That readily gives rise to a function <code>getFoo :: Text -&gt; Maybe Foo</code>.</p>\n\n<p>But now I would also like to <em>modify</em> the source of the <code>Foo</code> information, i.e. basically I want to implement</p>\n\n<pre><code>changeFoo :: (Foo -&gt; Foo) -&gt; Text -&gt; Text\n</code></pre>\n\n<p>with the properties</p>\n\n<pre><code>changeFoo id \u2261 id\ngetFoo . changeFoo f \u2261 fmap f . getFoo\n</code></pre>\n\n<p>It's possible to do that by changing the result of the parser to something like a lens</p>\n\n<pre><code>parseFoo :: Parsec Text (Foo, Foo -&gt; Text)\nparseFoo = ...\n</code></pre>\n\n<p>but that makes the definition a lot more cumbersome &ndash; I can't just gloss over irrelevant information anymore, but need to store the match of every <code>string</code> subparse and manually reassemble it.</p>\n\n<p>This could be somewhat automated by keeping the string-reassembage in a <code>StateT</code> layer around the parser monad, but I couldn't just use the existing primitive parsers.</p>\n\n<p>Is there an existing solution for this problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1464621486, "post_id": 37528849, "comment_id": 62548822, "body": "It could, but then you&#39;d have to expand the structure to carry that flag around. Evidently the maintainers of Data.Sequence decided that wasn&#39;t worth it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1464628808, "post_id": 37528849, "comment_id": 62552254, "body": "I&#39;d write a such a custom flag-carrying <code>Seq</code> variant, if I needed it."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1464682544, "post_id": 37528849, "comment_id": 62570051, "body": "For most use-cases one wouldn&#39;t be happy about the performance overhead that the management of an extra flag would introduce. Let <code>Seq</code> be what it is. What you need is a simple wrapper over it, which will abstract over the flag as well. We have two clearly separable abstractions."}], "answers": [{"tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 1, "last_activity_date": 1464625846, "creation_date": 1464625846, "answer_id": 37530207, "question_id": 37528849, "link": "https://stackoverflow.com/questions/37528849/why-is-data-sequence-reverse-on/37530207#37530207", "title": "why is Data.Sequence.reverse O(n)?", "body": "<p>Well you could define </p>\n\n<pre><code>data S a = S { forward :: Seq a , backward :: Seq a }\n</code></pre>\n\n<p>and then implement all operations with the invariant that </p>\n\n<pre><code>forall a :: Type, s :: S a  : reverse (forward s) == backward s . \n</code></pre>\n\n<p>This doubles the cost of each, but gives constant-time <code>reverse</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 1, "creation_date": 1464679369, "post_id": 37530739, "comment_id": 62568109, "body": "&quot;one must first check the flag!&quot; not for each element (only once per function call), only <code>&gt;&lt;</code> operation require reconstruct the whole structure"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1464628103, "creation_date": 1464628103, "answer_id": 37530739, "question_id": 37528849, "link": "https://stackoverflow.com/questions/37528849/why-is-data-sequence-reverse-on/37530739#37530739", "title": "why is Data.Sequence.reverse O(n)?", "body": "<p>Yes, it could.</p>\n\n<p>However, this adds a small price to every lookup (one must first check the flag!), and the payoff only comes to users that use <code>reverse</code> a lot. This latter group was probably judged to be small. Since throwing the appropriate flag onto the type can be done client-side, it makes sense <em>not</em> to pay this price in the library for every use of every function. Instead, the programmer that intends to call <code>reverse</code> a lot is forced to make this performance tradeoff choice if they want it, which seems perfectly sensible to me.</p>\n"}, {"comments": [{"owner": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "edited": false, "score": 0, "creation_date": 1464703581, "post_id": 37538587, "comment_id": 62584573, "body": "Did you mean <code>&gt;&lt;</code>?  If so, I&#39;m not sure why the need to incur the expense of reversing upon concatenation is an objection to a single flag.  This just delays the expense until it is actually needed, I would think?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "edited": false, "score": 0, "creation_date": 1464722007, "post_id": 37538587, "comment_id": 62596379, "body": "@Alan, <code>&lt;&gt;</code> is (depending on base library version) either a function of type <code>(&lt;&gt;) :: Monoid a =&gt; a -&gt; a -&gt; a</code> or a method of the <code>Semigroup</code> class with a similar signature. It&#39;s much more widely known than <code>&gt;&lt;</code> in the general Haskell community, and for sequences <code>(&lt;&gt;) = (&gt;&lt;)</code>. Delaying the expense until it&#39;s needed can be good, but can also make performance hard to predict and in many cases bad. In fact, I&#39;ve been working on making a number of sequence operations do their work <i>more</i> eagerly to combat this, and have managed to improve benchmark performance quite a lot.."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1464678400, "last_edit_date": 1464678400, "creation_date": 1464676987, "answer_id": 37538587, "question_id": 37528849, "link": "https://stackoverflow.com/questions/37528849/why-is-data-sequence-reverse-on/37538587#37538587", "title": "why is Data.Sequence.reverse O(n)?", "body": "<p>If you have just one flag, you will have problems. Suppose I want</p>\n\n<pre><code>xs &lt;&gt; reverse xs\n</code></pre>\n\n<p>How could I calculate that? With just one flag, I'd have to perform an expensive reverse before appending. To actually do this <em>right</em>, you need more flags, spread around the tree. <em>All</em> around the tree. Every node in the tree needs to carry reversal information. This is definitely possible, but it's somewhat expensive. Even worse, every step of every operation has to manage the reversal flags appropriately, which is a bit of a nightmare for whoever has to write and maintain the code. This idea has been worked out in a paper somewhere (I don't remember which one) but it's no fun in practice.</p>\n\n<p>If you have an algorithm that relies essentially on reversing, then you should use a custom sequence type with lots of flags, and include just the operations you need (if you're basing your type on <code>Data.Sequence</code>, you should probably steal one bit from each size field). But I don't think such algorithms are terrifically common.</p>\n"}], "owner": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 37538587, "answer_count": 3, "score": 5, "last_activity_date": 1464681649, "creation_date": 1464620838, "last_edit_date": 1464675927, "question_id": 37528849, "link": "https://stackoverflow.com/questions/37528849/why-is-data-sequence-reverse-on", "title": "why is Data.Sequence.reverse O(n)?", "body": "<p>The docs say <code>Data.Sequence.reverse</code> is O(n).  Couldn't a finite sequence type be \"reversed\" by setting a flag? (Effectively, which end to \"start counting\" from.)</p>\n"}, {"tags": ["performance", "haskell", "f#"], "comments": [{"owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "edited": false, "score": 1, "creation_date": 1464614758, "post_id": 37526740, "comment_id": 62545026, "body": "Just for the record, what are you measuring? The execution of the whole program (from command line) or the runtime of the body (using something not shown in the snippet)?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 2, "creation_date": 1464614765, "post_id": 37526740, "comment_id": 62545029, "body": "I would have imagined that for purely functional code, Haskell would be ahead of F# at least. In the current <code>4.0</code> version, F# does not even have fold, scan and zip inlined. I would imagine that for roughly similar, purely functional code Haskell should exceed F# due to the optimizations afforded to it by its purity."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464614841, "post_id": 37526740, "comment_id": 62545074, "body": "What I am measuring is when [I go to] (<a href=\"https://www.hackerrank.com/challenges/stockmax\" rel=\"nofollow noreferrer\">hackerrank.com/challenges/stockmax</a>), paste those programs in and press RunCodeRunCodeRun Code. Not the full submission. The time will be printed at the top."}, {"owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "edited": false, "score": 3, "creation_date": 1464614872, "post_id": 37526740, "comment_id": 62545093, "body": "I would profile the IO code and actual calculation separately. Your input code currently converts from Text to String (with T.unpack)  and then uses &quot;read&quot; which is known to be very slow."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464615002, "post_id": 37526740, "comment_id": 62545174, "body": "The whole first test case is 1.5Mb. How would one speed up that part of the program? I actually thought that converting from <code>Text</code> to <code>String</code> would slow it down, but I was not sure to do it otherwise. Using the Haskell <code>Text.Reader</code>  functions?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 7, "creation_date": 1464615438, "post_id": 37526740, "comment_id": 62545401, "body": "Why does the Haskell version use <code>replicateM</code> to read <i>everything</i> and start computing only after that? The F# version does not do that. Can&#39;t you move <code>solve</code> so that it is called (and its result printed) inside the <code>replicateM</code>? Right now, it seems you are dealing with large lists / Text strings which are not present in F#."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1464615849, "post_id": 37526740, "comment_id": 62545656, "body": "Most importantly: do we know the compiler options for F# and Haskell? What are the optimization levels?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464616064, "post_id": 37526740, "comment_id": 62545792, "body": "Here are the compiler <a href=\"https://www.hackerrank.com/environment\" rel=\"nofollow noreferrer\">versions</a>. Not sure about the compiler options. I&#39;ll see if I can look it up."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 1, "creation_date": 1464618549, "post_id": 37526740, "comment_id": 62547239, "body": "@behzad.nouri The code segments are what makes them long, but I&#39;ll take note of this for next time. Personally, I kind of like adding stuff to my post until I am satisfied with the amount of information."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 3, "creation_date": 1464618903, "post_id": 37526740, "comment_id": 62547430, "body": "@MarkoGrdinic fyi, most people look away from <a href=\"http://meta.stackoverflow.com/questions/300546/detect-walls-of-text\">wall of text questions</a>. you will get better responses if you keep the question short and to the point."}, {"owner": {"reputation": 21891, "user_id": 1243762, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b9b83cf6ca76699d7abfbba07f4675a3?s=128&d=identicon&r=PG&f=1", "display_name": "Guy Coder", "link": "https://stackoverflow.com/users/1243762/guy-coder"}, "edited": false, "score": 1, "creation_date": 1464624378, "post_id": 37526740, "comment_id": 62550414, "body": "If you want to add a wall of text then use <code>TL;DR</code> as I find it helps; e.g. <a href=\"http://stackoverflow.com/questions/37117089/how-to-add-languageprimitives-genericzero-get-zero-to-system-string\">How to add LanguagePrimitives.GenericZero / get_Zero to System.String?</a> I also find that if I talk first person it probably goes into <code>TL;DR</code> and if it is third person probably goes in the actual question."}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 2, "creation_date": 1464617055, "post_id": 37527523, "comment_id": 62546385, "body": "I understand that String functions are supposed to be slow, but are Text functions supposed to be slow as well?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 1, "creation_date": 1464617496, "post_id": 37527523, "comment_id": 62546622, "body": "@MarkoGrdinic with ascii only text, my <i>guess</i> is that <code>ByteString.Char8</code> performs faster than <code>Text</code>; but rely on your own benchmarks."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 4, "creation_date": 1464637286, "post_id": 37527523, "comment_id": 62555652, "body": "You can make this about five times as fast - 0.02 rather than 0.1 - if you revert to using unboxed vectors for the main <code>solve</code> function, now that the problem is well-analysed sprunge.us/PUYW"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1464689467, "post_id": 37527523, "comment_id": 62574523, "body": "@Michael the code has been improved and that 0.1 second timing no longer holds"}, {"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "edited": false, "score": 0, "creation_date": 1464713537, "post_id": 37527523, "comment_id": 62591448, "body": "Could you please help me understand the particular construction of <code>foldl</code> in your <code>solve</code> function? I am used to thinking of <code>foldl</code> as taking the arguments: <code>(\\accumulator element -&gt; something) accumulator list</code> (as in <code>foldl (+) 0 [1,2,3]</code>). It looks like <code>go (const 0)</code> needs two more arguments, which would qualify it as the function argument for <code>foldl</code>, but if that&#39;s so, I&#39;m confused about where is the accumulator passed, and why is there an extra argument after the list?"}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 2, "creation_date": 1464718330, "post_id": 37527523, "comment_id": 62594200, "body": "Realize that in the normal type of foldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b, &quot;b&quot; could be the type &quot;c -&gt; d&quot;, in which case the type would be (with extraneous parens removed) Foldable t =&gt; ((c -&gt;d) -&gt; a -&gt; c -&gt;d) -&gt; (c -&gt; d) -&gt; t a -&gt; c -&gt; d, which matches the shape of the arguments he is passing.  In other words, his accumulator is a function that is changed as he runs down the list, starting as a (const 0)."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "edited": false, "score": 1, "creation_date": 1464762039, "post_id": 37527523, "comment_id": 62609863, "body": "@\u05d2\u05dc\u05e2\u05d3\u05d1\u05e8\u05e7\u05df There was a <a href=\"http://stackoverflow.com/questions/37501967/how-to-make-fromlist-lazy-in-this-dynamic-programming-example\">different question</a> a few days ago to which Behzad wrote the answer in a similar style and I spent a long time analyzing the usage of lambda as an accumulator. Personally, I do think it is confusing and it would make more sense to use tuples instead to accumulate extra values. Understanding it also requires understanding the basics of lambda calculus."}, {"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "reply_to_user": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1464843035, "post_id": 37527523, "comment_id": 62652137, "body": "@mindreader finally got it; working out how <code>go</code> is stacking function calls is cool but a little cumbersome; I hope to develop some intuition about it; also I wonder if that kind of function stack is less efficient for large data than something like the simple backwards loop by Harrop, which of course does not detract from its conceptual awesomeness!"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 75, "last_activity_date": 1464653731, "last_edit_date": 1495540009, "creation_date": 1464616684, "answer_id": 37527523, "question_id": 37526740, "link": "https://stackoverflow.com/questions/37526740/why-is-the-f-version-of-this-program-6x-faster-than-the-haskell-one/37527523#37527523", "title": "Why is the F# version of this program 6x faster than the Haskell one?", "body": "<p>If you switch to <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString.html\" rel=\"noreferrer\"><code>ByteString</code></a> and stick with plain Haskell lists (instead of vectors) you will get a more efficient solution. You may also rewrite the solve function with <em>a single left fold</em> and bypass zip and right scan<sup> (1)</sup>.\nOverall, on my machine, I get 20 times performance improvement compared to your <em>Haskell</em> solution<sup> (2)</sup>.</p>\n\n<p>Below Haskell code performs faster than the F# code:</p>\n\n<pre><code>import Data.List (unfoldr)\nimport Control.Applicative ((&lt;$&gt;))\nimport Control.Monad (replicateM_)\nimport Data.ByteString (ByteString)\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Char8 as C\n\nparse :: ByteString -&gt; [Int]\nparse = unfoldr $ C.readInt . C.dropWhile (== ' ')\n\nsolve :: [Int] -&gt; Int\nsolve xs = foldl go (const 0) xs minBound\n    where go f x s = if s &lt; x then f x else s - x + f s\n\nmain = do\n    [n] &lt;- parse &lt;$&gt; B.getLine\n    replicateM_ n $ B.getLine &gt;&gt; B.getLine &gt;&gt;= print . solve . parse\n</code></pre>\n\n<p><sub>1. See <a href=\"https://stackoverflow.com/posts/37527523/revisions\">edits</a> for an earlier version of this answer which implements <code>solve</code> using <code>zip</code> and <code>scanr</code>.</sub><br>\n<sub>2. HackerRank website shows even a larger performance improvement.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "reply_to_user": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "edited": false, "score": 3, "creation_date": 1464658059, "post_id": 37529124, "comment_id": 62561209, "body": "@JonHarrop I was hoping you&#39;ll join the game :-). Don&#39;t worry about the downvotes, the whole question will probably get deleted soon because it &quot;does not fit the Q&amp;A format&quot; or something."}, {"owner": {"reputation": 188404, "user_id": 541686, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f2d0d2c0f7a83e2f8797a5ae79a324b6?s=128&d=identicon&r=PG", "display_name": "user541686", "link": "https://stackoverflow.com/users/541686/user541686"}, "reply_to_user": {"reputation": 1485, "user_id": 5579365, "user_type": "registered", "accept_rate": 94, "profile_image": "https://graph.facebook.com/10153866160373738/picture?type=large", "display_name": "Adam Copley", "link": "https://stackoverflow.com/users/5579365/adam-copley"}, "edited": false, "score": 4, "creation_date": 1464679986, "post_id": 37529124, "comment_id": 62568488, "body": "@AdamCopley: In all fairness no it shouldn&#39;t."}, {"owner": {"reputation": 1485, "user_id": 5579365, "user_type": "registered", "accept_rate": 94, "profile_image": "https://graph.facebook.com/10153866160373738/picture?type=large", "display_name": "Adam Copley", "link": "https://stackoverflow.com/users/5579365/adam-copley"}, "edited": false, "score": 4, "creation_date": 1464680166, "post_id": 37529124, "comment_id": 62568599, "body": "The op has asked for a review of his working code with regard to performance considerations, and how to write more efficient Haskell code. They key being it is working code. How is this not a review request?"}, {"owner": {"reputation": 4887, "user_id": 284588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f5d72c7cc2365d2d72dba3f9172550b?s=128&d=identicon&r=PG", "display_name": "Yitz", "link": "https://stackoverflow.com/users/284588/yitz"}, "reply_to_user": {"reputation": 1485, "user_id": 5579365, "user_type": "registered", "accept_rate": 94, "profile_image": "https://graph.facebook.com/10153866160373738/picture?type=large", "display_name": "Adam Copley", "link": "https://stackoverflow.com/users/5579365/adam-copley"}, "edited": false, "score": 3, "creation_date": 1464690932, "post_id": 37529124, "comment_id": 62575465, "body": "@AdamCopley OP has asked about performance differences between Haskell and F#. Sample snippets of code in each language, proposed to be more or less equivalent, were provided. In benchmarking the sample code is critical, so obviously the samples will need to be discussed, tweaked, or replaced. But the question is not about the code and is not a request for code review. It would be totally off topic there."}, {"owner": {"reputation": 1485, "user_id": 5579365, "user_type": "registered", "accept_rate": 94, "profile_image": "https://graph.facebook.com/10153866160373738/picture?type=large", "display_name": "Adam Copley", "link": "https://stackoverflow.com/users/5579365/adam-copley"}, "edited": false, "score": 3, "creation_date": 1464694623, "post_id": 37529124, "comment_id": 62577906, "body": "If an asker of a question asks how a snippet of working code can be improved, that to me is a review request, plain and simple, no arguments."}], "tags": [], "owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "is_accepted": false, "score": 45, "last_activity_date": 1464621630, "creation_date": 1464621630, "answer_id": 37529124, "question_id": 37526740, "link": "https://stackoverflow.com/questions/37526740/why-is-the-f-version-of-this-program-6x-faster-than-the-haskell-one/37529124#37529124", "title": "Why is the F# version of this program 6x faster than the Haskell one?", "body": "<p>Just for the record, the F# version is also not optimal. I don't think it really matters at this point, but if people wanted to compare the performance, then it is worth noting that it can be made faster.</p>\n\n<p>I have not tried very hard (you can certainly make it even faster by using restricted mutation, which would not be against the nature of F#), but simple change to use <code>Seq</code> instead of <code>Array</code> in the right places (to avoid allocating temporary arrays) makes the code about 2x to 3x faster:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let solve (ar : uint64[]) =\n    let ar' = Seq.zip ar (Array.scanBack max ar 0UL)    \n    let go sr (p,m) = sr + m - p\n    Seq.fold go 0UL ar'\n</code></pre>\n\n<p>If you use <code>Seq.zip</code>, you can also drop the <code>take</code> call (because <code>Seq.zip</code> truncates the sequence automatically). Measured using <code>#time</code> using the following snippet:</p>\n\n<pre><code>let rnd = Random()\nlet inp = Array.init 100000 (fun _ -&gt; uint64 (rnd.Next()))\nfor a in 0 .. 10 do ignore (solve inp) // Measure this line\n</code></pre>\n\n<p>I get around 150ms for the original code and something between 50-75ms using the new version.</p>\n"}, {"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1464636369, "post_id": 37531880, "comment_id": 62555350, "body": "According to <a href=\"https://www.hackerrank.com/challenges/stockmax\" rel=\"nofollow noreferrer\">HackerRank</a>, it is slightly faster, 0.14 rather than 0.17"}, {"owner": {"reputation": 2768, "user_id": 631115, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/fEHsz.jpg?s=128&g=1", "display_name": "Shredderroy", "link": "https://stackoverflow.com/users/631115/shredderroy"}, "edited": false, "score": 15, "creation_date": 1464636766, "post_id": 37531880, "comment_id": 62555476, "body": "As soon as I saw a question featuring the words F# and Haskell, I began to scan the page for Dr. Harrop&#39;s response!"}, {"owner": {"reputation": 11019, "user_id": 418488, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/625af9d6f5c5062f65a43582b57c041d?s=128&d=identicon&r=PG", "display_name": "Just another metaprogrammer", "link": "https://stackoverflow.com/users/418488/just-another-metaprogrammer"}, "edited": false, "score": 2, "creation_date": 1464639864, "post_id": 37531880, "comment_id": 62556702, "body": "FYI; because of an issue in the F# compiler there&#39;s an extra 5% to gain by writing this as a tail-recursive function that loops towards 0."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 4, "creation_date": 1464642803, "post_id": 37531880, "comment_id": 62557759, "body": "@Michael: My program takes ~0.000001s to run on this machine so HackerRank is measuring JIT compile time + run time for F# vs just run time for Haskell."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1464649157, "post_id": 37531880, "comment_id": 62559419, "body": "The HackerRank site clearly distinguishes compilation from run time for the F# program, just enter it into the text box, click the compile button and watch. The fastest variant Haskell program mentioned on this page sprunge.us/PUYW appears to be 7 times as fast as this F#."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1464649525, "post_id": 37531880, "comment_id": 62559512, "body": "Note that the whole difference between the initial Haskell and F# programs was due to the absurdly elaborate input handling in the Haskell program. It was using methods appropriate for a mixture of Ancient Greek and Thai text, not digits. Note also that in your program, the &quot;input&quot; is compiled together with <code>solve</code> etc. which, as we know ... makes numerous optimizations possible. You are calculating a constant."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1464650367, "post_id": 37531880, "comment_id": 62559697, "body": "@Michael: &quot;Note that the whole difference between the initial Haskell and F# programs was due to the absurdly elaborate input handling in the Haskell program. It was using methods appropriate for a mixture of Ancient Greek and Thai text, not digits&quot;. On the contrary, both original programs used Unicode. Only the Haskell has been optimised to operate directly on bytes."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1464651498, "post_id": 37531880, "comment_id": 62559898, "body": "Ah, yes, good point; I was going by confused memory while making my main point about computing constants - which, for good reason never happens in benchmarking compiled programs.  Certainly the present form of input handling is not taking any time to speak of, since it is possible to speed up @behzad.nouri &#39;s program 5x just by using <code>Data.Vector.Unboxed</code> rather than <code>Data.List</code> for <code>solve</code> as in <a href=\"http://sprunge.us/PUYW\" rel=\"nofollow noreferrer\">sprunge.us/PUYW</a>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1464653369, "post_id": 37531880, "comment_id": 62560294, "body": "This rectifies the unicode business without intruding on behzad nouri&#39;s structure <a href=\"http://sprunge.us/aOKI\" rel=\"nofollow noreferrer\">sprunge.us/aOKI</a> . It is three times as fast as your fsharp .15 v .05 and just uses dumb preludish higher order functions for  <code>solve</code>"}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "edited": false, "score": 0, "creation_date": 1464653478, "post_id": 37531880, "comment_id": 62560321, "body": "I&#39;ve updated my F# code to do the equivalent and both the F# and Haskell now take 0.02s."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1464653657, "post_id": 37531880, "comment_id": 62560358, "body": "Good. The input management was more confusing than it seemed. So now the question is whether the Haskell would be improved by using your approach, using a mutable vector and strefs."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1464653930, "post_id": 37531880, "comment_id": 62560424, "body": "@Michael, <code>STRef</code>s representing primitive values tend to suck, especially if they&#39;re modified a lot. You&#39;re better off using <code>StateT v (ST s)</code>, or faking <code>STRefs</code> using mutable unboxed vectors/arrays (there&#39;s a package for that somewhere)."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 8, "creation_date": 1464704134, "post_id": 37531880, "comment_id": 62585060, "body": "Not sure how &quot;write it like C&quot; is a legitimate response. Of course it will be faster, but the whole point of using F# or Haskell is so I don&#39;t have to write like C."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "reply_to_user": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 7, "creation_date": 1464713273, "post_id": 37531880, "comment_id": 62591286, "body": "@3noch: As Yaron Minsky famously said &quot;don&#39;t be puritanical about purity&quot;."}, {"owner": {"reputation": 13006, "user_id": 679898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7819f58e928d59c76fe12b30607346d6?s=128&d=identicon&r=PG", "display_name": "scrwtp", "link": "https://stackoverflow.com/users/679898/scrwtp"}, "reply_to_user": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 3, "creation_date": 1464766999, "post_id": 37531880, "comment_id": 62612526, "body": "@3noch: Sure, that&#39;s the whole point of F# or Haskell, but asking a question &quot;How can I make it faster&quot; about reasonably fast code <b>is</b> inevitably asking &quot;How can I make it more like C&quot;. How&#39;s that not a legitimate response?"}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "reply_to_user": {"reputation": 13006, "user_id": 679898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7819f58e928d59c76fe12b30607346d6?s=128&d=identicon&r=PG", "display_name": "scrwtp", "link": "https://stackoverflow.com/users/679898/scrwtp"}, "edited": false, "score": 2, "creation_date": 1464875912, "post_id": 37531880, "comment_id": 62672747, "body": "@scrwtp Well the question was about how to make two very non-C-like implementations have similar performance characteristics, not how to turn either of them into C."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "reply_to_user": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 2, "creation_date": 1464887422, "post_id": 37531880, "comment_id": 62681241, "body": "@3noch: That makes no sense."}], "tags": [], "owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "is_accepted": false, "score": 53, "last_activity_date": 1464835017, "last_edit_date": 1464835017, "creation_date": 1464633411, "answer_id": 37531880, "question_id": 37526740, "link": "https://stackoverflow.com/questions/37526740/why-is-the-f-version-of-this-program-6x-faster-than-the-haskell-one/37531880#37531880", "title": "Why is the F# version of this program 6x faster than the Haskell one?", "body": "<p>If I wanted to do that quickly in F# I would avoid all of the higher-order functions inside <code>solve</code> and just write a C-style imperative loop:</p>\n\n\n\n<pre class=\"lang-ml prettyprint-override\"><code>let solve (ar : uint64[]) =\n  let mutable sr, m = 0UL, 0UL\n  for i in ar.Length-1 .. -1 .. 0 do\n    let p = ar.[i]\n    m &lt;- max p m\n    sr &lt;- sr + m - p\n  sr\n</code></pre>\n\n<p>According to my measurements, this is 11x faster than your F#.</p>\n\n<p>Then the performance is limited by the IO layer (unicode parsing) and string splitting. This can be optimised by reading into a byte buffer and writing the lexer by hand:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let buf = Array.create 65536 0uy\nlet mutable idx = 0\nlet mutable length = 0\n\ndo\n  use stream = System.Console.OpenStandardInput()\n  let rec read m =\n    let c =\n      if idx &lt; length then\n        idx &lt;- idx + 1\n      else\n        length &lt;- stream.Read(buf, 0, buf.Length)\n        idx &lt;- 1\n      buf.[idx-1]\n    if length &gt; 0 &amp;&amp; '0'B &lt;= c &amp;&amp; c &lt;= '9'B then\n      read (10UL * m + uint64(c - '0'B))\n    else\n      m\n  let read() = read 0UL\n  for _ in 1UL .. read() do\n    Array.init (read() |&gt; int) (fun _ -&gt; read())\n    |&gt; solve\n    |&gt; System.Console.WriteLine\n</code></pre>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13576, "favorite_count": 15, "accepted_answer_id": 37527523, "answer_count": 3, "score": 51, "last_activity_date": 1464835017, "creation_date": 1464614423, "last_edit_date": 1464619160, "question_id": 37526740, "link": "https://stackoverflow.com/questions/37526740/why-is-the-f-version-of-this-program-6x-faster-than-the-haskell-one", "title": "Why is the F# version of this program 6x faster than the Haskell one?", "body": "<p>Haskell version(1.03s):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n  import qualified Data.Text as T\n  import qualified Data.Text.IO as TIO\n  import Control.Monad\n  import Control.Applicative ((&lt;$&gt;))\n  import Data.Vector.Unboxed (Vector,(!))\n  import qualified Data.Vector.Unboxed as V\n\n  solve :: Vector Int -&gt; Int\n  solve ar =\n    V.foldl' go 0 ar' where\n      ar' = V.zip ar (V.postscanr' max 0 ar)\n      go sr (p,m) = sr + m - p\n\n  main = do\n    t &lt;- fmap (read . T.unpack) TIO.getLine -- With Data.Text, the example finishes 15% faster.\n    T.unlines . map (T.pack . show . solve . V.fromList . map (read . T.unpack) . T.words)\n      &lt;$&gt; replicateM t (TIO.getLine &gt;&gt; TIO.getLine) &gt;&gt;= TIO.putStr\n</code></pre>\n\n<p>F# version(0.17s):</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>open System\n\nlet solve (ar : uint64[]) =\n    let ar' = \n        let t = Array.scanBack max ar 0UL |&gt; fun x -&gt; Array.take (x.Length-1) x\n        Array.zip ar t\n\n    let go sr (p,m) = sr + m - p\n    Array.fold go 0UL ar'\n\nlet getIntLine() =\n    Console.In.ReadLine().Split [|' '|]\n    |&gt; Array.choose (fun x -&gt; if x &lt;&gt; \"\" then uint64 x |&gt; Some else None)    \n\nlet getInt() = getIntLine().[0]\n\nlet t = getInt()\nfor i=1 to int t do\n    getInt() |&gt; ignore\n    let ar = getIntLine()\n    printfn \"%i\" (solve ar)\n</code></pre>\n\n<p>The above two programs are the solutions for the <a href=\"https://www.hackerrank.com/challenges/stockmax/\" rel=\"noreferrer\">Stock Maximize problem</a> and times are for the first test case of the <code>Run Code</code> button.</p>\n\n<p>For some reason the F# version is roughly 6x faster, but I am pretty sure that if I replaced the slow library functions with imperative loops that I could speed it up by at least 3 times and more likely 10x.</p>\n\n<p>Could the Haskell version be similarly improved?</p>\n\n<p>I am doing the above for learning purposes and in general I am finding it difficult to figure out how to write efficient Haskell code.</p>\n"}, {"tags": ["parsing", "haskell", "text-parsing", "parsec", "megaparsec"], "answers": [{"comments": [{"owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1567239772, "post_id": 37530178, "comment_id": 101911881, "body": "Mabye there should be a combinator for that."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1464655603, "last_edit_date": 1464655603, "creation_date": 1464625713, "answer_id": 37530178, "question_id": 37525609, "link": "https://stackoverflow.com/questions/37525609/is-it-possible-to-force-backtrack-all-options/37530178#37530178", "title": "Is it possible to force backtrack all options?", "body": "<p>Here is how I understand how Parsec backtracking works (and doesn't work):</p>\n\n<p>In:</p>\n\n<pre><code>(try a &lt;|&gt; try b &lt;|&gt; c)\n</code></pre>\n\n<p>if <code>a</code> fails, <code>b</code> will be tried, and if <code>b</code> subsequently fails <code>c</code> will be tried.</p>\n\n<p>However, in:</p>\n\n<pre><code>(try a &lt;|&gt; try b &lt;|&gt; c) &gt;&gt; d\n</code></pre>\n\n<p>if <code>a</code> succeeds but <code>d</code> fails, Parsec does <em>not</em> go back and try <code>b</code>. Once <code>a</code> succeeded Parsec considers the whole choice as parsed and it moves on to <code>d</code>. It will never go back to try <code>b</code> or <code>c</code>.</p>\n\n<p>This doesn't work either for the same reason:</p>\n\n<pre><code>(try (try a &lt;|&gt; try b &lt;|&gt; c)) &gt;&gt; d\n</code></pre>\n\n<p>Once <code>a</code> or <code>b</code> succeeds, the whole choice succeeds, and therefor the outer <code>try</code> succeeds. Parsing then moves on to <code>d</code>.</p>\n\n<p>A solution is to distribute <code>d</code> to within the choice:</p>\n\n<pre><code>try (a &gt;&gt; d) &lt;|&gt; try (b &gt;&gt; d) &lt;|&gt; (c &gt;&gt; d)\n</code></pre>\n\n<p>Now if <code>a</code> succeeds but <code>d</code> fails, <code>b &gt;&gt; d</code> will be tried.</p>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 37530178, "answer_count": 1, "score": 1, "last_activity_date": 1464655603, "creation_date": 1464611040, "question_id": 37525609, "link": "https://stackoverflow.com/questions/37525609/is-it-possible-to-force-backtrack-all-options", "title": "Is it possible to force backtrack all options?", "body": "<p>I need to parse this syntax for function declaration</p>\n\n<pre><code>foo x = 1 \nFunc \"foo\" (Ident \"x\") = 1\n\nfoo (x = 1) = 1 \nFunc \"foo\" (Label \"x\" 1) = 1\n\nfoo x = y = 1 \nFunc \"foo\" (Ident \"x\") = (Label \"y\" 1)\n</code></pre>\n\n<p>I have written this parser</p>\n\n<pre><code>module SimpleParser where\nimport Text.Parsec.String (Parser)\nimport Text.Parsec.Language (emptyDef)\nimport Text.Parsec\nimport qualified Text.Parsec.Token as Tok\nimport Text.Parsec.Char\nimport Prelude\n\nlexer :: Tok.TokenParser ()\nlexer = Tok.makeTokenParser style\n  where\n    style = emptyDef {\n              Tok.identLetter    = alphaNum\n             }\n\nparens :: Parser a -&gt; Parser a\nparens = Tok.parens lexer\n\ncommaSep :: Parser a -&gt; Parser [a]\ncommaSep = Tok.commaSep1 lexer\n\ncommaSep1 :: Parser a -&gt; Parser [a]\ncommaSep1 = Tok.commaSep1 lexer\n\n\nidentifier :: Parser String\nidentifier = Tok.identifier lexer\n\nreservedOp :: String -&gt; Parser ()\nreservedOp = Tok.reservedOp lexer\n\ndata Expr = IntLit Int | Ident String | Label String Expr | Func String Expr Expr | ExprList [Expr] deriving (Eq, Ord, Show)\n\n\ninteger :: Parser Integer\ninteger = Tok.integer lexer\n\nlitInt :: Parser Expr\nlitInt = do\n  n &lt;- integer\n  return $ IntLit (fromInteger n)\n\nident :: Parser Expr\nident = Ident &lt;$&gt; identifier\n\nparamLabelItem = litInt &lt;|&gt; paramLabel\n\nparamLabel :: Parser Expr\nparamLabel = do\n  lbl &lt;- try (identifier &lt;* reservedOp \"=\")\n  body &lt;- paramLabelItem\n  return $ Label lbl body\n\nparamItem :: Parser Expr\nparamItem = parens paramRecord &lt;|&gt; litInt &lt;|&gt; try paramLabel &lt;|&gt; ident\n\nparamRecord :: Parser Expr\nparamRecord = ExprList &lt;$&gt; commaSep1 paramItem\n\nfunc :: Parser Expr\nfunc = do\n  name &lt;- identifier\n  params &lt;- paramRecord\n  reservedOp \"=\"\n  body &lt;- paramRecord\n  return $ (Func name params body)\n\n\nparseExpr :: String -&gt; Either ParseError Expr\nparseExpr s = parse func \"\" s\n</code></pre>\n\n<p>I can parse <code>foo (x) = 1</code> but I cannot parse <code>foo x = 1</code></p>\n\n<pre><code>parseExpr \"foo x = 1\"\nLeft (line 1, column 10):\nunexpected end of input\nexpecting digit, \",\" or \"=\"\n</code></pre>\n\n<p>I understand it tries to parse this code like <code>Func \"foo\" (Label \"x\" 1)</code> and fails. But after fail why it cannot try to parse it like <code>Func \"foo\" (Ident \"x\") = 1</code></p>\n\n<p>Is there any way to do it?</p>\n\n<p>Also I have tried to swap <code>ident</code> and <code>paramLabel</code></p>\n\n<pre><code>paramItem = parens paramRecord &lt;|&gt; litInt &lt;|&gt; try paramLabel &lt;|&gt; ident\nparamItem = parens paramRecord &lt;|&gt; litInt &lt;|&gt; try ident &lt;|&gt; paramLabel\n</code></pre>\n\n<p>In this case I can parse <code>foo x = 1</code> but I cannot parse <code>foo (x = 1) = 2</code></p>\n\n<pre><code>parseExpr \"foo (x = 1) = 2\"\nLeft (line 1, column 8):\nunexpected \"=\"\nexpecting \",\" or \")\"\n</code></pre>\n"}, {"tags": ["haskell", "lenses"], "comments": [{"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1464608965, "post_id": 37522307, "comment_id": 62541396, "body": "if you run out of luck and want to see solution follow <a href=\"http://lpaste.net/6450842794700308480\" rel=\"nofollow noreferrer\">this link</a> and read really <a href=\"https://artyom.me/lens-over-tea-1\" rel=\"nofollow noreferrer\">nice article</a> about lenses with exact your exercise in it"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "reply_to_user": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1464609422, "post_id": 37522307, "comment_id": 62541683, "body": "@klappvisor: thank you! The article is really handy :)"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "edited": false, "score": 0, "creation_date": 1464609399, "post_id": 37524564, "comment_id": 62541673, "body": "Thank you very much! This is a really clear explanation :)"}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 2, "last_activity_date": 1464608670, "last_edit_date": 1464608670, "creation_date": 1464607740, "answer_id": 37524564, "question_id": 37522307, "link": "https://stackoverflow.com/questions/37522307/implement-choosing-over-2-lenses-in-haskell/37524564#37524564", "title": "Implement choosing over 2 lenses in haskell", "body": "<p>This is a great exercise problem because you don't even have to know anything about lenses to implement the solution. You can just follow the types.</p>\n\n<pre><code>choosing :: Lens s1 a -&gt; Lens s2 a -&gt; Lens (Either s1 s2) a\nchoosing lns1 lns2 = undefined\n</code></pre>\n\n<p>The return type <code>Lens (Either s1 s2) a</code> is an alias for <code>forall f . Functor f =&gt; (a -&gt; f a) -&gt; Either s1 s2 -&gt; f (Either s1 s2)</code> so you know that you have to return some kind of function that takes two parameters:</p>\n\n<pre><code>choosing lns1 lns2 = \\func x -&gt; undefined\n</code></pre>\n\n<p>The type of <code>func</code> is <code>(a -&gt; f a)</code> and <code>x</code> is a value of type <code>Either s1 s2</code>. We can't do much with <code>func</code> yet but we know enough about <code>x</code> that we can pattern match on it:</p>\n\n<pre><code>choosing lns1 lns2 = \\func x -&gt; case x of\n    Left l  -&gt; undefined\n    Right r -&gt; undefined\n</code></pre>\n\n<p>Now, using <code>lns1</code>, <code>lns2</code>, <code>func</code> and the knowledge that the type <code>f</code> is a functor (so you can use <code>fmap</code>) you just need to implement the branches of the case expression so that both produce a value of type <code>f (Either s1 s2)</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 2, "accepted_answer_id": 37524564, "answer_count": 1, "score": 3, "last_activity_date": 1464617831, "creation_date": 1464600896, "last_edit_date": 1464617831, "question_id": 37522307, "link": "https://stackoverflow.com/questions/37522307/implement-choosing-over-2-lenses-in-haskell", "title": "Implement choosing over 2 lenses in haskell", "body": "<p>I'm practicing for my exam Haskell in 2 weeks. Now I'm making some exercises, but I'm stuck on this one. </p>\n\n<blockquote>\n  <p>Implement a function <code>choosing</code> that is given 2 lenses and should return a new lens that works with <code>Either</code>-values.</p>\n</blockquote>\n\n<p>I'm given this code: </p>\n\n<pre><code>type Lens s a = forall f . Functor f =&gt; (a -&gt; f a) -&gt; s -&gt; f s\n\n--------------------------------------------------------------\n-- Lens s1 a             :: Functor f =&gt; a -&gt; f a -&gt; s1 -&gt; f s1\n-- Lens s2 a             :: Functor f =&gt; a -&gt; f a -&gt; s2 -&gt; f s2\n-- Lens (Either s1 s2) a :: Functor f =&gt; a -&gt; f a -&gt; (Either s1 s2) -&gt; f (Either s1 s2)\n--------------------------------------------------------------\nchoosing :: Lens s1 a -&gt; Lens s2 a -&gt; Lens (Either s1 s2) a\nchoosing lns1 lns2 = undefined\n</code></pre>\n\n<p>Now, I'm completely stuck. I think I should be using fmap to solve this issue, but I don't know how to combine these 2 lenses.</p>\n\n<p>So, with the help of @shang and @klappvisor I found the full answer to this question:</p>\n\n<pre><code>choosing :: Lens s1 a -&gt; Lens s2 a -&gt; Lens (Either s1 s2) a\nchoosing lns1 lns2 = (\\func x -&gt; case x of\n                                Left value  -&gt; (\\z -&gt; Left $ set lns1 z value) &lt;$&gt; (func (view lns1 value))\n                                Right value -&gt; (\\z -&gt; Right $ set lns2 z value) &lt;$&gt; (func (view lns2 value)))\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "indentation"], "comments": [{"owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 0, "creation_date": 1464597819, "post_id": 37520942, "comment_id": 62534704, "body": "Can you add the error message to your question?"}, {"owner": {"reputation": 79, "user_id": 4646246, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10153647923720744/picture?type=large", "display_name": "James Pritchard", "link": "https://stackoverflow.com/users/4646246/james-pritchard"}, "reply_to_user": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 0, "creation_date": 1464599114, "post_id": 37520942, "comment_id": 62535501, "body": "Thank you for the suggestion, this has been done."}], "answers": [{"tags": [], "owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "is_accepted": false, "score": 0, "last_activity_date": 1464597880, "creation_date": 1464597880, "answer_id": 37521301, "question_id": 37520942, "link": "https://stackoverflow.com/questions/37520942/haskell-parse-error-possibly-incorrect-indentation-or-mismatched-brackets-in-c/37521301#37521301", "title": "haskell parse error (possibly incorrect indentation or mismatched brackets) in control statement", "body": "<p>What about the following?</p>\n\n<pre><code>getLineDir :: (Int, Int) -&gt; Piece -&gt; Board -&gt; [Piece]\ngetLineDir (x, y) (Piece (x', y') player) board \n            | pieceAt(x'+ x, y'+ y) board == Nothing = []\n            | pieceAt(x'+ x, y'+ y) board == Just (Piece _ player') &amp;&amp; isPlayer player (Piece _ player') == True = (Piece (x', y') player) : [] \n            | otherwise  = (Piece _ player') : getLineDir (x,y) (Piece (x'+ x, y'+ y) player) board\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1464602222, "creation_date": 1464602222, "answer_id": 37522733, "question_id": 37520942, "link": "https://stackoverflow.com/questions/37520942/haskell-parse-error-possibly-incorrect-indentation-or-mismatched-brackets-in-c/37522733#37522733", "title": "haskell parse error (possibly incorrect indentation or mismatched brackets) in control statement", "body": "<p>You can't use <code>==</code> with a pattern like <code>Just (Piece _ player')</code>. You need proper pattern matching as with <code>case</code>.</p>\n\n<pre><code>getLineDir :: (Int, Int) -&gt; Piece -&gt; Board -&gt; [Piece]\ngetLineDir (x,y) (Piece (x',y') player) board =\n   case pieceAt (x'+ x, y'+ y) board of\n   Nothing -&gt; []\n   Just piece@(Piece _ player')\n     | isPlayer player piece -&gt; [Piece (x',y') player]\n     | otherwise -&gt; piece : getLineDir (x,y) (Piece (x'+x, y'+y) player) board\n</code></pre>\n\n<p>Probably, <code>Just piece@(Piece _ player')</code> can simply be replaced with <code>Just piece</code>, since you never need <code>player'</code> after that.</p>\n"}], "owner": {"reputation": 79, "user_id": 4646246, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10153647923720744/picture?type=large", "display_name": "James Pritchard", "link": "https://stackoverflow.com/users/4646246/james-pritchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1022, "favorite_count": 0, "accepted_answer_id": 37522733, "answer_count": 2, "score": 1, "last_activity_date": 1464680530, "creation_date": 1464596699, "last_edit_date": 1464680530, "question_id": 37520942, "link": "https://stackoverflow.com/questions/37520942/haskell-parse-error-possibly-incorrect-indentation-or-mismatched-brackets-in-c", "title": "haskell parse error (possibly incorrect indentation or mismatched brackets) in control statement", "body": "<p>I am trying to get something working, its for a game. I have come across a parse error that I am unable to trace.</p>\n\n<pre><code>getLineDir :: (Int, Int) -&gt; Piece -&gt; Board -&gt; [Piece]\ngetLineDir (x,y) (Piece (x',y') player) board \n            | pieceAt(x'+ x, y'+ y) board == Nothing = []\n            | if pieceAt(x'+ x, y'+ y) board == Just (Piece _ player') &amp;&amp; isPlayer player (Piece _ player') == True then (Piece (x',y') player):[] else (Piece _ player'): getLineDir (x,y) (Piece (x'+x, y'+y) player) board\n\nflippable :: [Piece] -&gt; [Piece]\n</code></pre>\n\n<p>The error message I am getting is:</p>\n\n<blockquote>\n  <p>parse error (possibly incorrect indentation or mismatched brackets)</p>\n</blockquote>\n\n<p>I am getting the parse error at the line starting with \"flippable\" so I'm guessing its something wrong with the previous line.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464611773, "post_id": 37520900, "comment_id": 62543208, "body": "I&#39;m more troubled by the fact that you use <code>foldl</code> instead of <code>foldl&#39;</code> but chi&#39;s answer looks like it gets the job done."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464618828, "post_id": 37520900, "comment_id": 62547401, "body": "Can I always stick to the strict version (<code>foldl&#39;</code>) unless I&#39;m certain that only a partial result of the fold will be used further?"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464618987, "post_id": 37520900, "comment_id": 62547470, "body": "Won&#39;t <code>unfoldrN</code> be just as bad since it&#39;s not strict?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464621205, "post_id": 37520900, "comment_id": 62548677, "body": "You can tune the strictness of an unfold to a great extent by being careful about how you write the function passed to <code>unfoldrN</code>. I&#39;m not sure how <code>foldl</code> behaves for vectors. It may be good for building a structure lazily, but that&#39;s not what you&#39;re doing here. If you&#39;re using an accumulator that doesn&#39;t have lazy structure, you should generally use <code>foldl&#39;</code> or <code>foldr&#39;</code>. Note however that for <i>lists</i>, <code>foldr&#39;</code> is no good."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1464600901, "last_edit_date": 1464600901, "creation_date": 1464598016, "answer_id": 37521345, "question_id": 37520900, "link": "https://stackoverflow.com/questions/37520900/are-dummy-folds-a-good-alternative-to-recursion/37521345#37521345", "title": "Are &#39;dummy-folds&#39; a good alternative to recursion?", "body": "<p>If you can't beat them, join them.\nAnd if you can't fold them, unfold them.</p>\n\n<p>Indeed, one could use <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector.html#v:unfoldrN\" rel=\"nofollow\"><code>unfoldrN</code></a> here:</p>\n\n<pre><code>randVectors :: (RandomGen g) =&gt; Int -&gt; Int -&gt; g -&gt; (V.Vector (VU.Vector Int), g)\nrandVectors nvecs veclen = unfoldrN nvecs (Just . randVector veclen)\n</code></pre>\n\n<p>More in detail:</p>\n\n<pre><code>unfoldrN :: Int -&gt; (b -&gt; Maybe (a, b)) -&gt; b -&gt; Vector a \n</code></pre>\n\n<p>is used as</p>\n\n<pre><code>unfoldrN :: Int -&gt; (g -&gt; Maybe (VU.Vector Int, g)) -&gt; g -&gt; Vector (VU.Vector Int)\n</code></pre>\n\n<p>The <code>Int</code> is the maximum length of the generated vector, i.e. <code>nvecs</code>.\nThe function <code>(g -&gt; Maybe (VU.Vector Int, g))</code> is simply the same thing as <code>randVector</code>, except that is can choose to stop the generation early by returning <code>Nothing</code> -- we do not need that, so we compose with <code>Just</code>. The argument <code>g</code> is the initial generator.</p>\n\n<p>Alternatively, one could use a state monad for that <code>g -&gt; (g, _)</code> recurring pattern in types, and exploit</p>\n\n<pre><code>Data.Vector.replicateM :: Monad m =&gt; Int -&gt; m a -&gt; m (Vector a)\n</code></pre>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 2, "accepted_answer_id": 37521345, "answer_count": 1, "score": 2, "last_activity_date": 1464600901, "creation_date": 1464596557, "question_id": 37520900, "link": "https://stackoverflow.com/questions/37520900/are-dummy-folds-a-good-alternative-to-recursion", "title": "Are &#39;dummy-folds&#39; a good alternative to recursion?", "body": "<p>Take a look at the code below, especially the first function <code>randVectors</code>.\nIt creates a vector of random vectors. In order to do that, the random generator <code>g</code> has to be 'looped' on; the generator used for creating the first vector is returned and passed along to generate the next vector and so forth. The code compiles and works as expected, but is this the idiomatic way of writing Haskell?</p>\n\n<p>As you see, the step function in the fold ignores what's being folded over. It could be implemented with recursion instead, but that does not seem much better at least in my eyes.</p>\n\n<pre><code>import           Control.Monad               as M\nimport           Control.Monad.ST\nimport qualified Data.Vector                 as V\nimport qualified Data.Vector.Generic         as VG\nimport           Data.Vector.Generic.Mutable as VGM\nimport qualified Data.Vector.Unboxed         as VU\nimport           System.Random\n\n\nrandVectors :: (RandomGen g) =&gt; Int -&gt; Int -&gt; g -&gt; (V.Vector (VU.Vector Int), g)\nrandVectors nvecs veclen g =\n  foldl step (V.empty, g) [0..nvecs]\n    where\n  step :: (RandomGen g) =&gt; (V.Vector (VU.Vector Int), g) -&gt; Int -&gt; (V.Vector (VU.Vector Int), g)\n  step (li, g1) _ =\n    (V.snoc li subli, g2)\n      where\n    (subli, g2) = randVector veclen g1\n\nrandVector :: (RandomGen g) =&gt; Int -&gt; g -&gt; (VU.Vector Int, g)\nrandVector n =\n  shuffle vector $ VU.length vector\n    where\n  vector = VU.enumFromN 0 n\n\nshuffle :: (RandomGen g, VG.Vector v a) =&gt; v a -&gt; Int -&gt; g -&gt; (v a, g)\nshuffle vec size g =\n  runST $ do\n    vec_mut &lt;- VG.thaw vec\n    let swap_random g1 i = do\n          let (j,g2) = randomR (0,i) g1\n          VGM.swap vec_mut i j\n          return g2\n    g' &lt;- M.foldM swap_random g [1..size-1]\n    vec' &lt;- VG.unsafeFreeze vec_mut\n    let vec_sample = VG.take size vec'\n    return (vec_sample, g')\n</code></pre>\n"}, {"tags": ["haskell", "cabal-install", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1464647979, "post_id": 37518733, "comment_id": 62559101, "body": "AFAIK there&#39;s currently no way to pass these flags with <code>stack</code>. <a href=\"https://github.com/commercialhaskell/stack/issues/1438\" rel=\"nofollow noreferrer\">These</a> <a href=\"https://github.com/commercialhaskell/stack/issues/593\" rel=\"nofollow noreferrer\">two</a> issues are somewhat related \u2013 I suggest you join the discussion and pronounce your need! ;)"}, {"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 0, "creation_date": 1464827440, "post_id": 37518733, "comment_id": 62648606, "body": "Another relevant issue: <a href=\"https://github.com/commercialhaskell/stack/issues/652\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/652</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496855249, "post_id": 37518733, "comment_id": 75836311, "body": "In the event that you only want to pass a debug flag every now and then, you can trick <code>stack</code> by: (1) building your project (2) running <code>happy</code> manually (<code>stack exec happy -- </code>) with your desired options outputting to the same file as <code>stack</code> would (3) change something in a module imported in the grammar (4) <code>stack build</code> again. This will trigger recompilation, but not re-processing of the grammar (since <code>stack</code> will have observed no change in the grammar file)."}, {"owner": {"reputation": 2115, "user_id": 1934349, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/LyNoA.jpg?s=128&g=1", "display_name": "paulotorrens", "link": "https://stackoverflow.com/users/1934349/paulotorrens"}, "edited": false, "score": 0, "creation_date": 1504944201, "post_id": 37518733, "comment_id": 79219340, "body": "Everything is terrible."}], "owner": {"reputation": 2425, "user_id": 2392147, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/09f00344014ef1858c322172cc0a1be3?s=128&d=identicon&r=PG&f=1", "display_name": "orm", "link": "https://stackoverflow.com/users/2392147/orm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 303, "favorite_count": 3, "answer_count": 0, "score": 9, "last_activity_date": 1464617871, "creation_date": 1464588743, "last_edit_date": 1464617871, "question_id": 37518733, "link": "https://stackoverflow.com/questions/37518733/passing-flags-to-alex-and-happy-via-stack", "title": "passing flags to alex and happy via stack", "body": "<p>I am trying to move a project from cabal to stack. It was painless up until I tried to make alex use a custom wrapper. Now I'm stuck.</p>\n\n<p>I used to use cabal build --alex-options=\"..\" to pass them on, but that option is not there with stack (stack version 1.1.2 at least). Similarly, I used to pass debug flags to happy, but now it  no longer seems possible.  Is there some other way to achieve this and still use stack?</p>\n\n<p>The point of moving this project is to help collaborators be able to reproduce my build effortlessly (it was already some work to convince them to use Haskell).</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "edited": false, "score": 0, "creation_date": 1464583591, "post_id": 37517749, "comment_id": 62528698, "body": "Do you have any more examples of Abstract data types that I can look into further?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464588560, "post_id": 37517749, "comment_id": 62530311, "body": "Are primitive types like <code>Int</code> and <code>Char</code> really considered algebraic?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464589228, "post_id": 37517749, "comment_id": 62530582, "body": "@dfeuer Sure, they&#39;re just (large but) finite sums."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "edited": false, "score": 1, "creation_date": 1464589264, "post_id": 37517749, "comment_id": 62530602, "body": "@McLeodx There are lots of abstract types. Can you say what you want to get out of your further looking? With a clear goal in mind, it&#39;s easier to suggest next steps."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1464583473, "creation_date": 1464583473, "answer_id": 37517749, "question_id": 37517622, "link": "https://stackoverflow.com/questions/37517622/what-are-some-abstract-data-types-in-haskell-and-how-do-they-differ-from-algebra/37517749#37517749", "title": "What are some Abstract Data Types in Haskell and how do they differ from Algebraic Data Types?", "body": "<p>Abstract data types do not export their implementation, instead preferring to export functions that can be used to build and consume them. There are many fantastic and oft-used examples in the <a href=\"http://hackage.haskell.org/package/containers\" rel=\"noreferrer\"><code>containers</code></a> package; the <code>Map</code> type sprung immediately to mind as a type with a very rich API but for which you are not permitted to see the implementation details. The <code>Set</code>, <code>Seq</code>, and specialized <code>IntMap</code> and <code>IntSet</code> types are all also abstract.</p>\n\n<p>All Haskell types are algebraic -- this just means they are all constructed from sums, products, function types, and recursion.</p>\n"}], "owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 0, "accepted_answer_id": 37517749, "answer_count": 1, "score": 1, "last_activity_date": 1464583473, "creation_date": 1464582461, "question_id": 37517622, "link": "https://stackoverflow.com/questions/37517622/what-are-some-abstract-data-types-in-haskell-and-how-do-they-differ-from-algebra", "title": "What are some Abstract Data Types in Haskell and how do they differ from Algebraic Data Types?", "body": "<p>What are some examples of Abstract Data Types in Haskell and what specifically differentiate them from Algebraic Data Types?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1464564293, "post_id": 37515706, "comment_id": 62525199, "body": "Consider using a benchmarking package, such as criterion."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1464567649, "last_edit_date": 1464567649, "creation_date": 1464567340, "answer_id": 37516155, "question_id": 37515706, "link": "https://stackoverflow.com/questions/37515706/simple-haskell-performance-analysis/37516155#37516155", "title": "Simple Haskell Performance Analysis", "body": "<p>(Available as a .lhs at <a href=\"http://pastebin.com/jpg0vSNd\" rel=\"nofollow\">http://pastebin.com/jpg0vSNd</a> )</p>\n\n<p>Some observations:</p>\n\n<ol>\n<li><p>A good way to force evalution of a value is to use <code>deepseq</code> from <code>Control.DeepSeq</code>.</p></li>\n<li><p><code>repeat</code> does not re-evaluate it's argument.</p></li>\n<li><p>GHC is pretty good at spotting expression which are the same, so sometimes you have to disguise your function calls with identical arguments to make GHC re-evalute the function call.</p></li>\n</ol>\n\n<p>Here is an example of using <code>deepseq</code>:</p>\n\n<pre><code> import Control.DeepSeq (deepseq)\n import Control.Monad\n import Debug.Trace\n import System.TimeIt\n import System.Environment\n\n theList = [1..8] ++ [undefined] ++ [10] :: [Int]\n\n main1 = do\n   print $ length theList\n   print $ deepseq theList (length theList)\n</code></pre>\n\n<p>The first <code>print</code> statement emits <code>10</code>. The second throws an exception because\nthe <code>deepseq</code> call tried to evaluate the <code>undefined</code> element.</p>\n\n<p>To see that <code>repeat</code> does not re-evaluate it's argument, consider this example:</p>\n\n<pre><code> foo = repeat $ trace \"(here)\" 2\n\n main2 = print $ take 3 foo\n</code></pre>\n\n<p>The result of running <code>main2</code> is:</p>\n\n<pre><code>[(here)\n2,2,2]\n</code></pre>\n\n<p>What is happening is that when the head of <code>foo</code> is called for <code>repeat</code> evaluate it's argument. This calls <code>trace</code> which prints <code>(here)</code> and returns 2. This value is saved by <code>repeat</code> when the rest of the list <code>foo</code> is needed.</p>\n\n<p>Finally, here is a demonstration of how good GHC is at spotting function calls with identical arguemnts.</p>\n\n<pre><code> fib :: Int -&gt; Int\n fib 0 = 0\n fib 1 = 1\n fib n = fib (n-1) + fib (n-2)\n\n theN = 34  -- use 24 if running under ghci\n\n compute1 = fib theN\n compute2 k = fib theN\n compute3 k = fib (k+theN-k)\n</code></pre>\n\n<p><code>fib theN</code> is just a function call which takes a while to compute (about 0.6 secs)</p>\n\n<pre><code> loop1 n = forM_ [1..n] $ \\_ -&gt; print compute1\n loop2 n = forM_ [1..n] $ \\k -&gt; print (compute2 k)\n loop3 n = forM_ [1..n] $ \\k -&gt; print (compute3 k)\n\n timeLoop loop = do timeIt $ loop 1\n                    timeIt $ loop 2\n                    timeIt $ loop 3\n                    timeIt $ loop 10\n\n main4 = timeLoop loop1\n main5 = timeLoop loop2\n main6 = timeLoop loop3\n\n main = do (arg:_) &lt;- getArgs\n           case arg of\n             \"4\" -&gt; main4\n             \"5\" -&gt; main5\n             \"6\" -&gt; main6\n</code></pre>\n\n<p>The run times depend on whether or not you compile with -O2 or not.\nTypical reuts are:</p>\n\n<pre><code>         w/o -O2    with -O2\nmain4     1 secs    0.1 sec\nmain5    13 secs    0.1 sec\nmain6    13 secs    1.0 sec\n</code></pre>\n\n<p>Some conclusions:</p>\n\n<ul>\n<li>A top-level expression like <code>compute1</code> is memoized.</li>\n<li>Adding an ignored parameter (e.g. <code>compute2</code>) will fool GHC into recomputing a function call if -O2 is not used.</li>\n<li>With -O2 a trickier way of disguising the function call may be needed to get GHC to re-evaluate it in a loop.</li>\n</ul>\n"}], "owner": {"reputation": 1912, "user_id": 2571452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45f39e6fa724f6a1c44b5e3bf81a67be?s=128&d=identicon&r=PG", "display_name": "Rich Randall", "link": "https://stackoverflow.com/users/2571452/rich-randall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 37516155, "answer_count": 1, "score": 1, "last_activity_date": 1464567649, "creation_date": 1464562298, "question_id": 37515706, "link": "https://stackoverflow.com/questions/37515706/simple-haskell-performance-analysis", "title": "Simple Haskell Performance Analysis", "body": "<p>I am trying to compare the perf of two implementations of finding the Nth smallest number in a binary search tree.  This is just a toy learning problem.  My na\u00efve attempt at measuring follows:</p>\n\n<pre><code>getNth :: Tree Int -&gt; Int -&gt; Either String Int\n\neval :: [Either b Int] -&gt; Int\neval = (foldl (+) 0) . rights\n\nmain :: IO ()\nmain = do\n    let t = foldl treeInsertBalanced EmptyTree [1..1000000]\n        first = getNth t 100000\n        iterations = 100000000000\n        second = take iterations $ repeat $ getNth t 100\n        third = take iterations $ repeat $ getNth' t 100\n\n    print $ \"dummy to cause eval: \" ++ (show first)\n    print \"\"\n\n    time1 &lt;- System.CPUTime.getCPUTime\n    print $ eval second\n    time2 &lt;- System.CPUTime.getCPUTime\n    print $ eval third\n    time3 &lt;- System.CPUTime.getCPUTime\n\n    let secondTime = time2-time1\n        thirdTime  = time3-time2\n        timeDiff   = secondTime - thirdTime\n    print $ \"take version = \" ++ (show secondTime)\n    print $ \"opt version  = \" ++ (show thirdTime)\n    print $ \"diff         = \" ++ (show timeDiff)\n</code></pre>\n\n<p>I am having a hard time figuring out how to include laziness where I want it, and prevent it where I do not.</p>\n\n<p>I want the tree to be completely constructed before I begin measuring the functions that operate on it.  This is why I try to force an evaluation of t by calling getNth on it and then printing it.  </p>\n\n<ol>\n<li>Is this doing what I hope it is doing.</li>\n<li>Will t remain fully evaluated when I use it subsequently.</li>\n</ol>\n\n<p>The difference in implementation between the two getNth functions is that the first uses the 'take' function on a simple depth first search of the tree.  The second does a depth first search with an explicit early return.  I want to know whether the simple 'take' implementation has to walk the whole tree or not.  How can I determine that in a simpler way than measuring the performance of the two functions.  I tried introducing an 'error' or an 'undefined' as a value in the tree, but of course neither was evaluated unless it was the Nth element in the tree.  Is there another, simple way of determining whether the getNth function is truly laze or not?</p>\n"}, {"tags": ["haskell", "monad-transformers", "servant"], "answers": [{"comments": [{"owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "edited": false, "score": 0, "creation_date": 1464598789, "post_id": 37515733, "comment_id": 62535302, "body": "Yes, lift was my first intuition, however, compiler couldn&#39;t match <code>t0 (ExceptT ServantErr m0)</code> with <code>AppHandler</code>. There is no MonadTrans instance for AppHandler and I had troubles deriving/making one, as the kind of the AppHandler didn&#39;t match what MonadTrans expected."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "edited": false, "score": 0, "creation_date": 1464618951, "post_id": 37515733, "comment_id": 62547454, "body": "I think you can get away with just a <code>type</code> for <code>AppHandler</code> - e.g. <code>type AppHandler = ReaderT Config (ExceptT ServantErr IO)</code>. You still need to use <code>!??</code> though."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464562487, "creation_date": 1464562487, "answer_id": 37515733, "question_id": 37515246, "link": "https://stackoverflow.com/questions/37515246/using-failwith-with-servant-and-custom-monad-stack/37515733#37515733", "title": "Using failWith with Servant and custom monad stack", "body": "<p>In general to convert a value of type <code>m a</code> to <code>ReaderT r m a</code> just use <code>lift</code>.</p>\n\n<p>So perhaps this will work for you:</p>\n\n<pre><code>entity &lt;- lift $ (runDb $ getCompanyByName companyName) !? err400\n</code></pre>\n\n<p>if the entire <code>(runDb ...) !? err400</code> is an <code>ExceptT ServantError ...</code> value.</p>\n\n<p>Also, this servant issue discussion:</p>\n\n<p><a href=\"https://github.com/haskell-servant/servant/issues/286\" rel=\"nofollow\">https://github.com/haskell-servant/servant/issues/286</a></p>\n\n<p>might be helpful.</p>\n"}, {"comments": [{"owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "edited": false, "score": 0, "creation_date": 1464598945, "post_id": 37515829, "comment_id": 62535394, "body": "This works, however, I&#39;m bit puzzled I&#39;ve had to write my own helper for that, I expected I could use something existing and compose (probably with some lifting). Wouldn&#39;t it be possible without writing new helper?"}, {"owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "reply_to_user": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "edited": false, "score": 1, "creation_date": 1464599203, "post_id": 37515829, "comment_id": 62535563, "body": "@Bartosz, you can open an issue or file a pull request with Daniel&#39;s code here: <a href=\"https://github.com/Gabriel439/Haskell-Errors-Library/issues\" rel=\"nofollow noreferrer\">github.com/Gabriel439/Haskell-Errors-Library/issues</a>, and then everyone in the future won&#39;t have to write their own helper :)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1464563589, "creation_date": 1464563589, "answer_id": 37515829, "question_id": 37515246, "link": "https://stackoverflow.com/questions/37515246/using-failwith-with-servant-and-custom-monad-stack/37515829#37515829", "title": "Using failWith with Servant and custom monad stack", "body": "<p>You want a variant of <code>(!?)</code> that is polymorphic in which monad it returns. For example:</p>\n\n<pre><code>(!??) :: MonadError e m =&gt; m (Maybe a) -&gt; e -&gt; m a\nact !?? err = act &gt;&gt;= maybe (throwError err) return\n</code></pre>\n\n<p>Then, provided <code>err400 :: ServantError</code> -- which is the type of errors you declared <code>AppHandler</code> to have -- you will be able to write</p>\n\n<pre><code>runDb (getCompanyByName companyName) !?? err400\n</code></pre>\n"}], "owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 1, "accepted_answer_id": 37515829, "answer_count": 2, "score": 3, "last_activity_date": 1464563589, "creation_date": 1464558035, "question_id": 37515246, "link": "https://stackoverflow.com/questions/37515246/using-failwith-with-servant-and-custom-monad-stack", "title": "Using failWith with Servant and custom monad stack", "body": "<p>I'm using <em>Servant</em> with custom monad stack:</p>\n\n<pre><code>newtype AppHandler a = AppHandler { runHandler :: ReaderT Config (ExceptT ServantErr IO) a }\n  deriving (Functor, Applicative, Monad, MonadReader Config, MonadError ServantErr, MonadIO)\n\ndata Config = Config\n    { getPool :: ConnectionPool }\n</code></pre>\n\n<p>Now, in many handlers I just need to do fetch some data (Persistent) from db and act upon it, so I've got:</p>\n\n<pre><code>runDb :: (MonadReader Config m, MonadIO m) =&gt; SqlPersistT IO b -&gt; m b\nrunDb query = do\n  pool &lt;- asks getPool\n  liftIO $ runSqlPool query pool\n</code></pre>\n\n<p>As it turns out, when fetching from db, you're bound to work with <code>Maybe</code>, and quite often when the Maybe is <code>Nothing</code>, you just want to throw error so that Servant server will turn it into proper HTTP response. This led me to the discovery of <code>Control.Error.Util</code> and the <code>(!?) :: Applicative m =&gt; m (Maybe a) -&gt; e -&gt; ExceptT e m a</code> helper. So I tried following:</p>\n\n<pre><code>someHandler :: AppHandler NoContent\nsomeHandler = do\n  entity &lt;- (runDb $ getCompanyByName companyName) !? err400\n  -- some more logic\n  return NoContent\n</code></pre>\n\n<p>But this does not compile, the result of <code>!?</code> here is <code>ExceptT ServantErr m0 (Entity SomeEntity)</code> but I no longer work with such handler type, it requires the <code>AppHandler (Entity SomeEntity)</code>. How would I convert such value back to my handler type?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1464558794, "post_id": 37515185, "comment_id": 62524091, "body": "Any <code>Bar (a &#39;: as)</code> is also going to be a <code>Bar &#39;[a]</code>, no?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1464560615, "post_id": 37515185, "comment_id": 62524485, "body": "@user2297560 No, the analysis in the question is correct on this point: only when <code>as ~ []</code> are <code>a &#39;: as</code> and <code>&#39;[a]</code> the same."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464562203, "post_id": 37515185, "comment_id": 62524791, "body": "@DanielWagner Ah, I see.  Thanks.  This kind of type level stuff is still a bit magical to me."}], "answers": [{"comments": [{"owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "edited": false, "score": 0, "creation_date": 1464601376, "post_id": 37515336, "comment_id": 62536826, "body": "Actually I still can&#39;t get it to work. I get the same error with <code>instance (as ~ (a1 &#39;: a2 &#39;: more), Bar as) =&gt; Bar (a&#39; &#39;: as) where </code>. I would expect <code>as ~ (a &#39;: b &#39;: cs)</code> to only match on lists of two or more elements, which is (still) not the case of <code>&#39;[Int]</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "edited": false, "score": 0, "creation_date": 1464612854, "post_id": 37515336, "comment_id": 62543897, "body": "No - the answer is that the instances are overlapping. I just quoted the blog article to point out that the constraints don&#39;t affect instance resolution."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1464558921, "creation_date": 1464558921, "answer_id": 37515336, "question_id": 37515185, "link": "https://stackoverflow.com/questions/37515185/unclear-why-instances-are-overlapping/37515336#37515336", "title": "Unclear why instances are overlapping", "body": "<p>Chris Done has written up a blog post about this:</p>\n\n<p><a href=\"http://chrisdone.com/posts/haskell-constraint-trick\" rel=\"nofollow\">http://chrisdone.com/posts/haskell-constraint-trick</a></p>\n\n<p>His makes this observation:</p>\n\n<blockquote>\n  <p>The constraints of an instance don\u2019t have anything to do with deciding whether an instance is picked from the list of instances available. Constraints only apply after GHC has already decided it\u2019s going with this instance.</p>\n</blockquote>\n\n<p>So so constraint present in:</p>\n\n<pre><code>instance Bar as =&gt; Bar (a ': as)\n</code></pre>\n\n<p>doesn't preclude GHC from matching it against <code>'[Int]</code>.</p>\n"}], "owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 37515336, "answer_count": 1, "score": 1, "last_activity_date": 1464558921, "creation_date": 1464557458, "question_id": 37515185, "link": "https://stackoverflow.com/questions/37515185/unclear-why-instances-are-overlapping", "title": "Unclear why instances are overlapping", "body": "<p>When I try compiling the following code with GHC 7.10.3, it throws an \"Overlapping Instances\" error at me:</p>\n\n<pre><code>{-# LANGUAGE DataKinds         #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE GADTs             #-}\n{-# LANGUAGE KindSignatures    #-}\n{-# LANGUAGE TypeOperators     #-}\n\nmodule Main where\n\nclass Bar a where\n  bar :: Foo a\n\n-- Instance #1\ninstance Bar '[a] where\n  bar = C1\n\n-- Instance #2\ninstance (Bar as) =&gt; Bar (a ': as) where\n  bar = C2 bar\n\ndata Foo :: [*] -&gt; * where\n  C1 :: Foo '[a]\n  C2 :: Foo as -&gt; Foo (a ': as)\n\nmain :: IO ()\nmain = undefined\n\nfoobar :: Foo '[Int]\nfoobar = bar\n</code></pre>\n\n<blockquote>\n  <p>28 col 10 error: Overlapping instances for Bar '[Int] arising from a use of \u2018bar\u2019</p>\n  \n  <p>Matching instances:</p>\n  \n  <p>instance Bar '[a] -- Defined at test.hs:13:10</p>\n  \n  <p>instance Bar as => Bar (a : as) -- Defined at test.hs:17:10</p>\n  \n  <p>In the expression: bar</p>\n  \n  <p>In an equation for \u2018foobar\u2019: foobar = bar</p>\n</blockquote>\n\n<p>Clearly <code>'[Int]</code> is an instance of <code>Bar</code> through <code>#1</code>. Now I am surprised, because (from my understanding of the situtation) <code>'[Int] = (Int ': '[])</code> cannot be an instance of <code>Bar</code> through <code>#2</code> since <code>'[]</code> itself is not an instance of <code>Bar</code> (which is required). I have vague memories of constraints on instanciation not being what I thought it was, and I suspect that the problem here lies in <code>... (Bar as) =&gt; ...</code> though I cannot be sure. Any help appreciated.</p>\n"}, {"tags": ["haskell", "opengl", "gloss"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464555688, "post_id": 37514699, "comment_id": 62523307, "body": "You might have a look at the <a href=\"https://hackage.haskell.org/package/gl\" rel=\"nofollow noreferrer\"><code>gl</code></a> library - supposedly it is a <i>complete</i> set of OpenGL raw bindings."}, {"owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464557510, "post_id": 37514699, "comment_id": 62523780, "body": "Yes, I know about it, but not how to change the Gloss OpenGL initialization code."}], "answers": [{"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1464571292, "post_id": 37516289, "comment_id": 62526380, "body": "Heh. Here we have a library that abstracts out two other libraries whose only purpose is to abstract out several other libraries."}, {"owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "edited": false, "score": 0, "creation_date": 1464588699, "post_id": 37516289, "comment_id": 62530371, "body": "Yes, the simplest option seems like to modify the <code>initialize</code> function and compile gloss manually. I will give it a try when I get home."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1464568980, "creation_date": 1464568980, "answer_id": 37516289, "question_id": 37514699, "link": "https://stackoverflow.com/questions/37514699/set-opengl-window-hints-in-gloss/37516289#37516289", "title": "Set OpenGL window hints in Gloss", "body": "<p>Here's the best I can figure out...</p>\n\n<p><code>gloss</code> abstracts graphics backends via the <code>class Backend</code> type class, and there are two instances defined:</p>\n\n<pre><code>instance Backend GLFWState\ninstance Backend GLUTState\n</code></pre>\n\n<p>Which one is used is controlled at compile time via the <code>WITHGLUT</code> and <code>WITHGLFW</code> CPP macros.</p>\n\n<p>This explains why gloss doesn't provide functions to customize the GL setup - as far as it is concerned the backend is abstract.</p>\n\n<p>The initialization code for the GLUT backend is in the <code>initializeGLUT</code> function in Graphics/Gloss/Internals/Interface/Backend/GLUT.hs</p>\n\n<p>Perhaps you can modify that routine to set up GLUT they way you want to obtain a custom version of gloss.</p>\n"}], "owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1464568980, "creation_date": 1464554047, "question_id": 37514699, "link": "https://stackoverflow.com/questions/37514699/set-opengl-window-hints-in-gloss", "title": "Set OpenGL window hints in Gloss", "body": "<p>I am looking into the <a href=\"http://gloss.ouroborus.net/\" rel=\"nofollow\">gloss</a> library and as any sane person I am quite irritated by the lack of anti-aliasing. I know some OpenGL window hints that help enabling anti-aliasing, especially the <code>GL.lineSmooth</code> hint. However looking through the Gloss haddock docs there doesn't seem to be any obvious way to set OpenGL hints. So how would I go forward doing this?</p>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1464551057, "post_id": 37514142, "comment_id": 62521830, "body": "The type of <code>f2</code> is <code>forall t. t</code> (the <code>forall</code> is implicit, so it is omitted when GHCi prints it). That is the type of <code>undefined</code>. <code>f2</code>&#39;s type can&#39;t be constrained by how it is used. If that sort of thing happened, if you use <code>id &#39;a&#39;</code> you could never use <code>id</code> on non-<code>Char</code> types."}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1464551628, "post_id": 37514203, "comment_id": 62522037, "body": "Thanks for the explanation, but it didn&#39;t get me closer to what I wanted. I think I misframed my actual question. I&#39;m going to post another one."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1464552103, "last_edit_date": 1464552103, "creation_date": 1464551120, "answer_id": 37514203, "question_id": 37514142, "link": "https://stackoverflow.com/questions/37514142/ghc-cannot-infer-type-of-function-called-from-readert-proxy-p-io/37514203#37514203", "title": "GHC cannot infer type of function called from `ReaderT (Proxy p) IO ()`", "body": "<p>Nothing's wrong. The type checker <em>did</em> figure out the type of <code>f2</code> - look at ghci's output again:</p>\n\n<pre><code>ghci&gt; :t f2\nf2 :: t\n</code></pre>\n\n<p><code>t</code> is shorthand for <code>forall t. t</code>. <code>f2</code> can take on any type. That makes sense - <code>f2 = undefined</code> after all.</p>\n\n<pre><code>ghci&gt; :t undefined\nundefined :: a\n</code></pre>\n\n<p>When you write <code>f1 = f2</code>, you're using <code>f2</code> at the more specific type of <code>ReaderT (Proxy p) IO ()</code>. <code>ReaderT (Proxy p) IO ()</code> is one way to instantiate the type <code>t</code>. In other words, the type inference algorithm has generated the simple unification constraint <code>t ~ ReaderT (Proxy p) IO ()</code>.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 37514203, "answer_count": 1, "score": 1, "last_activity_date": 1464552103, "creation_date": 1464550700, "last_edit_date": 1464550949, "question_id": 37514142, "link": "https://stackoverflow.com/questions/37514142/ghc-cannot-infer-type-of-function-called-from-readert-proxy-p-io", "title": "GHC cannot infer type of function called from `ReaderT (Proxy p) IO ()`", "body": "<p>The following code compiles:</p>\n\n<pre><code>import Control.Monad.Trans.Reader\nimport Data.Proxy\n\nf1 :: ReaderT (Proxy p) IO ()\nf1 = f2\n\nf2 = undefined\n</code></pre>\n\n<p>GHC knows type of <code>f1</code>:</p>\n\n<pre><code>&gt; :t f1\nf1 :: ReaderT (Proxy p) IO ()\n</code></pre>\n\n<p>But it can't figure out the type of <code>f2</code>:</p>\n\n<pre><code>&gt; :t f2\nf2 :: t\n</code></pre>\n\n<p>What's wrong?</p>\n\n<p>My idea was to put <code>Proxy</code> inside a reader so that I do not have to pass it around. Is this a problem somehow?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1464550130, "post_id": 37513814, "comment_id": 62521481, "body": "What do you want &quot;throwing the exception&quot; to do? Crash the server? Return an HTTP response (like a 500 or 404?)"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464587313, "post_id": 37513814, "comment_id": 62529798, "body": "Return an HTTP response (e.g. 400) along with a message. (e.g. <code>{ error: &quot;This should error out&quot; }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464595214, "post_id": 37519017, "comment_id": 62533472, "body": "Thanks. I&#39;ve updated the question to better reflect why I used the term &quot;throw exception&quot;"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464633656, "post_id": 37519017, "comment_id": 62554230, "body": "For example, I believe <code>event &lt;- runDB $ get404 eid</code> - knows how to short circuit, and send a 404 -- But I couldn&#39;t understand how to do something similar myself :)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1464635907, "last_edit_date": 1464635907, "creation_date": 1464589901, "answer_id": 37519017, "question_id": 37513814, "link": "https://stackoverflow.com/questions/37513814/how-to-throw-exceptions-from-handler/37519017#37519017", "title": "How to throw exceptions from Handler", "body": "<p>You can use the <code>sendResponseStatus</code> to directly specify the response:</p>\n\n<pre><code>getEventsR = do\n  mpage   &lt;- lookupGetParam \"page\"\n  case hasPage mpage of\n    Left message -&gt; sendResponseStatus status400 message\n    Right val    -&gt; ...continue processing with val...\n</code></pre>\n\n<p>The second argument to <code>sendResponseStatus</code> can be any type which has a <code>ToTypedContent</code> instance. This includes <code>Text</code>, <code>Value</code> and other common types. See <a href=\"http://hackage.haskell.org/package/yesod-core-1.4.0/docs/Yesod-Core-Content.html#t:ToTypedContent\" rel=\"nofollow\">this page</a> for types which have this instance defined by default.</p>\n\n<p><strong>Update</strong></p>\n\n<p>In response to your comments...</p>\n\n<p><code>get404</code> is defined as:</p>\n\n<pre><code>get404 key = do\n    mres &lt;- get key\n    case mres of\n        Nothing -&gt; notFound'\n        Just res -&gt; return res\n\nnotFound' :: MonadIO m =&gt; m a\nnotFound' = liftIO $ throwIO $ HCError NotFound\n</code></pre>\n\n<p><code>HCError</code> is a constructor of the <code>HandlerContents</code> type:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/yesod-core-1.4.0/docs/Yesod-Core-Types.html#t:HandlerContents\" rel=\"nofollow\">http://hackage.haskell.org/package/yesod-core-1.4.0/docs/Yesod-Core-Types.html#t:HandlerContents</a></p>\n\n<pre><code>data HandlerContents:\n    HCContent Status !TypedContent   \n    HCError ErrorResponse    \n    HCSendFile ContentType FilePath (Maybe FilePart)     \n    HCRedirect Status Text   \n    HCCreated Text   \n    HCWai Response   \n    HCWaiApp Application\n</code></pre>\n\n<p>An <code>ErrorResponse</code> has the following constructors:</p>\n\n<pre><code>data ErrorResponse:\n    NotFound     \n    InternalError Text   \n    InvalidArgs [Text]   \n    NotAuthenticated     \n    PermissionDenied Text    \n    BadMethod Method    \n</code></pre>\n\n<p>So you can <code>throwIO</code> a limited number of errors, and the error messages are limited to <code>Text</code>.</p>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 37519017, "answer_count": 1, "score": 1, "last_activity_date": 1464635907, "creation_date": 1464548836, "last_edit_date": 1464595185, "question_id": 37513814, "link": "https://stackoverflow.com/questions/37513814/how-to-throw-exceptions-from-handler", "title": "How to throw exceptions from Handler", "body": "<p>I'm building a RESTful endpoint that should throw an error if there is invalid data. Here's a simplified (and slightly silly) version:</p>\n\n<pre><code>getEventsR :: Handler Value\ngetEventsR = do\n    mpage   &lt;- lookupGetParam \"page\"\n    let filters = case hasPage mpage of\n                      Right val -&gt; val\n                      Left val  -&gt; error $ T.unpack val -- Throw an error\n\n     -- The rest...\n\n\nhasPage :: Maybe Text -&gt; Either Text Text\nhasPage = \n    Left \"This should error out\"\n</code></pre>\n\n<ol>\n<li>Is this the correct way - a function should return an <code>Either</code> that will later be expanded to an error?</li>\n<li>I probably shouldn't use <code>error</code>, right? What instead?</li>\n</ol>\n\n<p>As a side note, I'd be happy if my thrown error would be sent also in JSON format.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>The reason I've used the term \"throw exception\", is because my code looks something like this (simplified):</p>\n\n<pre><code>let selectOpt = case addPager [] of\n                    Right val -&gt; val\n                    Left val  -&gt; error $ T.unpack val\n\nlet filters = case addFilter [] of\n                    Right val -&gt; val\n                    Left val  -&gt; error $ T.unpack val\n\nevents &lt;- runDB $ selectList filters selectOpt :: Handler [Entity Event]\n</code></pre>\n\n<p>So if it errors out on <code>selectOpt</code> I'd like it to short-circuit, and not continue with the rest of the handler.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1464546889, "post_id": 37513423, "comment_id": 62520422, "body": "Might be because you haven&#39;t told it how you want it to read it. You usually need to use a type annotation when using <code>read</code>. How is is supposed to know what type you want it to interpret <code>code</code> as? In Haskell, when in doubt, add type annotations. Seriously, remember that. It will save you a lot of headache."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1464547079, "post_id": 37513423, "comment_id": 62520488, "body": "Wait, <code>code</code> is already a String. Why are you <code>read</code>ing it?"}, {"owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1464547826, "post_id": 37513423, "comment_id": 62520725, "body": "Because I seen that in some tutorials....they said that by using &quot;let code1 = read code&quot; it will be converted to int :\\"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1464548144, "post_id": 37513423, "comment_id": 62520832, "body": "It&#39;s been about a year since I&#39;ve written Haskell, but doesn&#39;t <code>read</code> take a String and return an object? Or in other words, the opposite of <code>show</code>? Since you&#39;re concating <code>code1</code> on the next line, you expect it to be a String, but that&#39;s already what <code>getLine</code> returns, so it should already be the correct type. <code>read</code>ing should only be necessary when the type being written to file isn&#39;t a String."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464548174, "post_id": 37513423, "comment_id": 62520844, "body": "The problem here is that <code>&quot;Cod:&quot; ++ code1</code> forces <code>code1</code> to be a string. So <code>read</code> is going from string to string, and that fails."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1464548723, "post_id": 37513423, "comment_id": 62521005, "body": "<code>let code1 = read code</code> creates an int only if <code>code</code> is defined or later inferred to be an <code>int</code>. <code>read</code> can return values of many different types, depending on the context in which it is used."}, {"owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464550368, "post_id": 37513423, "comment_id": 62521565, "body": "Thank you for your comments, problem is solved now :D"}], "answers": [{"comments": [{"owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464549486, "post_id": 37513771, "comment_id": 62521278, "body": "Thank you very much, now it works....you know what I can&#39;t explain myself? 2 h ago, I did it like this, but it didn&#39;t worked, and now it works just great."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464549556, "post_id": 37513771, "comment_id": 62521291, "body": "@ClaudiuM Haskell is, by definition, very consistent. There must have been something different if it wasn&#39;t working, but is now. I&#39;m glad it works though."}, {"owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464553747, "post_id": 37513771, "comment_id": 62522715, "body": "Do you know how to access &quot;code&quot; variable if I&#39;m inside 2 if statements for example? Because I get the following error when I try to acces it &quot;    \u2022 Variable not in scope: code :: String     \u2022 Perhaps you meant one of these:         \u2018cos\u2019 (imported from Prelude), \u2018mod\u2019 (imported from Prelude)&quot; I know need a kind of global declaration for code, just like we use in C++ or Java...but how to do that here in Haskell?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464554923, "post_id": 37513771, "comment_id": 62523102, "body": "@ClaudiuM Post a link to a pastebin / gist.github with the code. I&#39;m not sure what you mean. I&#39;ll gladly help if you if I see some code."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464558104, "post_id": 37513771, "comment_id": 62523932, "body": "@ClaudiuM Are you talking about accessing the <code>code</code> inside the <code>if number == 1</code> block? If you think about it, that doesn&#39;t make any sense. If the user enters &quot;3&quot;, the 1 block will never execute, so <code>code</code> won&#39;t exist. Create a function that asks the user to enter a code, and use that in both places."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "edited": false, "score": 0, "creation_date": 1464558277, "post_id": 37513771, "comment_id": 62523986, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/113269/discussion-between-carcigenicate-and-claudiu-m\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 3, "last_activity_date": 1464562085, "last_edit_date": 1464562085, "creation_date": 1464548661, "answer_id": 37513771, "question_id": 37513423, "link": "https://stackoverflow.com/questions/37513423/haskell-exception-prelude-read-no-parse/37513771#37513771", "title": "Haskell Exception: Prelude.read: no parse", "body": "<p>This fails since you're attempting to <code>read</code> a String as a String. </p>\n\n<p><code>read</code> is used to parse a String as an object. To parse a String as a String though, you need to add explicit quotes around the String being parsed. Failing to do so will result in the error that you got. You can test this by adding <code>\"</code>s around the input when your program asks for it. It should work. </p>\n\n<p>Do you expect <code>code1</code> to be an int? If that's the case, there's 2 problems (and a couple ways to solve them) :</p>\n\n<ol>\n<li><p>You need to tell <code>read</code> what type you want it to parse the string as. To do that, use a type annotation. Add <code>:: int</code> after <code>read code</code>. </p></li>\n<li><p>Since you can't concatenate an int, change <code>code1</code> in your last line to <code>(show code1)</code> to convert it back to a String. </p></li>\n</ol>\n\n<p>The problem with the above way is you're converting from, then to a String. You could avoid any converting by keeping it as a String by skipping the <code>read</code> altogether:</p>\n\n<pre><code>import System.IO                      \n main = do\n    putStrLn \"Please put book details\"\n    putStr \"Code: \"\n    code &lt;- getLine\n    # Check user's input to ensure it's correct. \n    appendFile \"book.txt\" (\"Cod:\" ++ code) \n</code></pre>\n"}], "owner": {"reputation": 250, "user_id": 5563000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UaSRS.jpg?s=128&g=1", "display_name": "Linksx", "link": "https://stackoverflow.com/users/5563000/linksx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2232, "favorite_count": 0, "accepted_answer_id": 37513771, "answer_count": 1, "score": 2, "last_activity_date": 1464562085, "creation_date": 1464546353, "last_edit_date": 1464558377, "question_id": 37513423, "link": "https://stackoverflow.com/questions/37513423/haskell-exception-prelude-read-no-parse", "title": "Haskell Exception: Prelude.read: no parse", "body": "<p>I am new to Haskell, kinda 2 days since I study Haskell, and I want to do a project with files. I did it already in c++ and now I want to do it in Haskell too.\nA little part of project is about a library, where I can register a book and a person. Now I want to put book code into a file.txt but to store it as int, not as String, because I have to search and compare this code , with other codes later, and will be easier to compare.\nHere is my code, and I receive the following error *** Exception: Prelude.read: no parse. Does anyone know how to solve this please?</p>\n\n<pre><code> import System.IO                      \n main = do\n    putStrLn \"Please put book details\"\n    putStr \"Code: \"\n    code &lt;- getLine\n    let code1 = read code\n    appendFile \"book.txt\" (\"Cod:\" ++ code1 ++ \"\\n\")\n</code></pre>\n"}, {"tags": ["haskell", "fold", "monoids"], "comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 1, "creation_date": 1464728760, "post_id": 37513123, "comment_id": 62600031, "body": "You might want to read <a href=\"http://web.jaguarpaw.co.uk/~tom/blog/posts/2012-11-04-what-is-foldr-made-of.html\" rel=\"nofollow noreferrer\">Tom Ellis&#39; &quot;What is <code>foldr</code> made of?&quot;</a> and <a href=\"https://byorgey.wordpress.com/2012/11/05/foldr-is-made-of-monoids/\" rel=\"nofollow noreferrer\">Brent Yorgey&#39;s response &quot;<code>foldr</code> is made of monoids&quot;</a>."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1464552873, "post_id": 37513302, "comment_id": 62522433, "body": "Thanks for fixing the typo ;)"}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 8, "last_activity_date": 1464552368, "last_edit_date": 1464552368, "creation_date": 1464545689, "answer_id": 37513302, "question_id": 37513123, "link": "https://stackoverflow.com/questions/37513123/how-can-foldmap-do-the-same-as-foldr-when-the-latter-does-not-have-anything-to-d/37513302#37513302", "title": "How can foldMap do the same as foldr when the latter does not have anything to do with monoids?", "body": "<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>Note that <code>a -&gt; b -&gt; b</code> is <code>a -&gt; (b -&gt; b)</code>. Functions <code>b -&gt; b</code> form a monoid under composition.</p>\n\n<p>Note how this resembles</p>\n\n<pre><code>foldMap :: (..omitted..) =&gt; (a -&gt; m) -&gt; f a -&gt; m\n</code></pre>\n\n<p>The only difference is that foldMap doesn't use the \"zero\" argument of type <code>b</code> of <code>fold</code> and returns an <code>m</code>, which in terms of <code>foldr</code> would be <code>b-&gt;b</code>. Now just apply one to the other and you've recovered <code>foldr</code> from <code>foldMap</code>.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 37513302, "answer_count": 1, "score": 7, "last_activity_date": 1464592646, "creation_date": 1464544636, "last_edit_date": 1464592646, "question_id": 37513123, "link": "https://stackoverflow.com/questions/37513123/how-can-foldmap-do-the-same-as-foldr-when-the-latter-does-not-have-anything-to-d", "title": "How can foldMap do the same as foldr when the latter does not have anything to do with monoids?", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:foldr\" rel=\"nofollow\"><code>foldr</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:foldMap\" rel=\"nofollow\"><code>foldMap</code></a> can be used to define each other as I understand. But how is that possible, as the latter uses monoids, while the former does not? Do we have any guarantees that the stuff the <code>foldr</code> works on can have a monoid?</p>\n"}, {"tags": ["string", "haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464542504, "post_id": 37512478, "comment_id": 62519051, "body": "You define input as a list of string lists. In my case I get single string from file and that&#39;s the main problem."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464543952, "post_id": 37512478, "comment_id": 62519453, "body": "Ah.  I see.  I&#39;ll adjust my answer."}, {"owner": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464601112, "post_id": 37512478, "comment_id": 62536685, "body": "That&#39;s impresive but it looks like I&#39;m still getting IO type (or string) and what I needed was [[int]]"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464604737, "post_id": 37512478, "comment_id": 62538965, "body": "@Dominik if you&#39;re reading from a file, there is no way to escape <code>IO</code>, you have to work inside it."}, {"owner": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464606813, "post_id": 37512478, "comment_id": 62540142, "body": "Whoa, why is that? There is no any trick? Safety is not main goal."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464607847, "post_id": 37512478, "comment_id": 62540743, "body": "@Dominik I cannot, in good conscience, tell you about <code>performUnsafeIO</code>. I think you should really just work inside <code>IO</code>.  I adjusted my answer to demonstrate."}, {"owner": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464616449, "post_id": 37512478, "comment_id": 62546039, "body": "So maybe to be able to iterate on specific values I should use my own type? In that file in front of all was word &quot;pyramid&quot; and then [...."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464620297, "post_id": 37512478, "comment_id": 62548168, "body": "I don&#39;t know what you mean by use your own type. You can either use <code>Data.Text</code> functions to transform the input into a form that <code>read</code> will parse for you as I did above, or you can learn how to use a parser library like <code>Text.Parsec</code>."}, {"owner": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464626070, "post_id": 37512478, "comment_id": 62551117, "body": "I mean this      <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">learnyouahaskell.com/making-our-own-types-and-typeclasses</a> Is it possible, to simply make my own type and fill it with values retreived from file as above (pyramid [some data])? I prefer to ask even before trying because google did not return any available solution."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "edited": false, "score": 0, "creation_date": 1464634658, "post_id": 37512478, "comment_id": 62554678, "body": "I see.  You want to make a data type and derive <code>Read</code>. That will not work unless the format of your string is the exact format that the derived <code>Read</code> instance is expecting. It can&#39;t magically know what format your data is in."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1464621156, "last_edit_date": 1464621156, "creation_date": 1464540459, "answer_id": 37512478, "question_id": 37512382, "link": "https://stackoverflow.com/questions/37512382/haskell-make-int-list-of-lists-out-of-a-single-string/37512478#37512478", "title": "Haskell: make int list of lists out of a single string", "body": "<p>The correct way to do this is probably to use a parser library like <code>Text.Parsec</code>.  That being said, here's a quick and hacky way to do it not unlike what a python programmer might come up with. The idea is to massage the input string into a form that <code>read</code> will parse for us.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Prelude hiding (null)\nimport Data.Text (snoc, pack, unpack, splitOn, strip, null)\nimport Data.Maybe (fromMaybe)\nimport System.IO\n\nparse :: String -&gt; [[Maybe Int]]\nparse = map read . map unpack . map (flip snoc ']') . filter (not . null) . map strip . splitOn \"]\" . pack\n\nmain :: IO ()\nmain = do\n  input &lt;- readFile \"myfile.txt\"  -- input = \"[Just 3, Nothing, Just 1, Nothing] [Nothing, Nothing, Nothing, Nothing] [Nothing, Nothing, Just 4, Nothing] [Nothing, Just 3, Nothing, Nothing]\"\n  putStrLn . show $ map (map (fromMaybe 0)) (parse input)\n</code></pre>\n\n<p>The <code>parse</code> method works like this:</p>\n\n<ul>\n<li><code>pack</code> converts a <code>String</code> value into a <code>Text</code> value</li>\n<li><code>splitOn \"]\"</code> does exactly what you think</li>\n<li><code>map strip</code> removes leading and trailing whitespace</li>\n<li><code>filter (not . null)</code> removes empty strings (there's one at the end)</li>\n<li><code>map (flip snoc ']')</code> append the \"]\" character back to the end of each string</li>\n<li><code>map unpack</code> converts each <code>Text</code> value back to a <code>String</code> value</li>\n<li><code>map read</code> parses each <code>String</code> value into a <code>[Maybe Int]</code></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "is_accepted": false, "score": 0, "last_activity_date": 1464685389, "creation_date": 1464685389, "answer_id": 37541295, "question_id": 37512382, "link": "https://stackoverflow.com/questions/37512382/haskell-make-int-list-of-lists-out-of-a-single-string/37541295#37541295", "title": "Haskell: make int list of lists out of a single string", "body": "<p>Just an alternate version that uses <code>read</code>:</p>\n\n<pre><code>import Data.List.Split (splitOn)\nimport Data.Maybe      (fromMaybe)\n\nmain :: IO ()\nmain = do\n    s &lt;- readFile \"lists.txt\"\n    let xs = map (\\s' -&gt; map (fromMaybe 0) (read (s' ++ \"]\"))) . init . splitOn \"]\" $ s\n    print xs\n</code></pre>\n\n<p>The idea is simple: first, the file contents are read as a <code>String</code> and bound to <code>s</code>. Then, <code>s</code> is parsed to a list of integers (<code>[Int]</code>) which is bound to <code>xs</code>. In order to do that, the following steps are taken:</p>\n\n<ol>\n<li><p><code>splitOn \"]\"</code>: splits the input string <code>s</code> generating a list of strings (<code>[String]</code>). Each element misses the character <code>']'</code> in the end. The last element of this list is an undesirable <code>\"\\n\"</code>. The resulting list is:</p>\n\n<pre><code>[\"[Just 3, Nothing, Just 1, Nothing\",\" [Nothing, Nothing, Nothing, Nothing\", ..., \"\\n\"]\n</code></pre></li>\n<li><p><code>init</code>: removes the unwanted \"\\n\".</p></li>\n<li><p><code>map (\\s' -&gt; map (fromMaybe 0) (read (s' ++ \"]\")))</code>: applies to each string element the enclosed lambda function, which does:</p>\n\n<ol>\n<li><code>read (s' ++ \"]\")</code>: append the missing <code>']'</code> to the string and parses it to a list of <code>Maybe</code>s (<code>Num a =&gt; [Maybe a]</code>). Note that we do not need to explicitly specify a type for <code>read</code> because GHC can infer it from the use of <code>fromMaybe 0</code> (see below).</li>\n<li><code>map (fromMaybe 0)</code>: apply the function <code>fromMaybe 0</code> on each element of the list, which returns <code>v</code> when <code>Just v</code>; and <code>0</code>, otherwise.</li>\n</ol></li>\n</ol>\n\n<p>That way you can get a list of integer lists using <code>read</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 6397474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100c0f9eca7a0920b237de3c44254d8a?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/6397474/dominik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1464685389, "creation_date": 1464539952, "question_id": 37512382, "link": "https://stackoverflow.com/questions/37512382/haskell-make-int-list-of-lists-out-of-a-single-string", "title": "Haskell: make int list of lists out of a single string", "body": "<p>I've got some data in txt file which looks like this:</p>\n\n<pre><code>  [Just 3, Nothing, Just 1, Nothing] [Nothing, Nothing, Nothing, Nothing] [Nothing, Nothing, Just 4, Nothing] [Nothing, Just 3, Nothing, Nothing]\n</code></pre>\n\n<p>What I need is to have list of lists containing above values as integers e.g.</p>\n\n<pre><code>[[3,0,1,0],[0,0,0,0],....]\n</code></pre>\n\n<p>And so on. Do you have any idea how to do it properly? I can replace \"nothing\" by 0 and drop \"Just\" part but it will stay as a single string.</p>\n"}, {"tags": ["haskell", "matrix", "diagonal"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464539985, "post_id": 37511914, "comment_id": 62518265, "body": "If the rows are <code>(x:xs)</code>, how is <code>diagonals (x:xs)</code> related to <code>diagonals xs</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464541962, "post_id": 37511914, "comment_id": 62518880, "body": "I&#39;d be happy to explain more about my implementation in the linked answer if you say which parts you did/didn&#39;t understand."}, {"owner": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464544326, "post_id": 37511914, "comment_id": 62519576, "body": "@DanielWagner This part confused me: <code>go b es_ = [h | h:_ &lt;- b] : case es_ of         []   -&gt; transpose ts         e:es -&gt; go (e:ts) es         where ts = [t | _:t &lt;- b]</code>. I&#39;m new to FP and i know there is a function called go, with arguments <code>b</code> and <code>es_</code>. But what exactly does <code>case</code> and this &quot;pattern matching&quot; (thats what it looks like to me)."}, {"owner": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464544500, "post_id": 37511914, "comment_id": 62519631, "body": "@ErikR I&#39;m not quite sure what you&#39;re intending to point at.."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464555857, "post_id": 37511914, "comment_id": 62523348, "body": "@GabbaGandalf <code>case es_ of [] -&gt; branch1; e:es -&gt; branch2</code> checks whether <code>es_</code> is an empty list, in which case its value is <code>branch1</code>, or whether it is nonempty, in which case it names the first element <code>e</code>, the rest of the list <code>es</code>, and then becomes the value <code>branch2</code>. Think &quot;base case&quot; vs. &quot;recursive case&quot; if you&#39;re familiar with thinking in those terms about recursive functions. In this particular <code>case</code>, <code>es_</code> is keeping track of which rows we have not started walking through in our traversal, so it will take the first branch until it reaches the longest diagonal."}], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1464539501, "creation_date": 1464539501, "answer_id": 37512310, "question_id": 37511914, "link": "https://stackoverflow.com/questions/37511914/returning-a-matrix-in-diagonals-in-haskell/37512310#37512310", "title": "Returning a matrix in diagonals in Haskell", "body": "<p>Notice what happens when you pad each row so that the left pointing arrows point straight down:</p>\n\n<pre><code>a11 a12 a13 a14\n    a21 a22 a23 a24\n        a31 a32 a33 a_34\n</code></pre>\n\n<p>You would get your required result if you could just \"stack\" the columns on each other somehow. But we can't stack the columns, unfortunately. Of course, if we transpose the matrix, then the columns will be the rows, and they can be joined together with <code>concat</code>, and this would have the same effect as stacking columns. But we need to preserve the padding when we do the transpose.</p>\n\n<p>Here's an idea. What if we wrap all the values in <code>Just</code> and insert <code>Nothing</code> in the padded spots?</p>\n\n<pre><code>(Just a11) (Just a12) (Just a13) (Just a14) Nothing    Nothing\nNothing    (Just a21) (Just a22) (Just a23) (Just a24) Nothing\nNothing    Nothing    (Just a31) (Just a32) (Just a33) (Just a34)\n</code></pre>\n\n<p>Now when we transpose, the shifts will be preserved.  It just remains to remove all the <code>Nothing</code>s, <code>concat</code> the rows into a single list, and unwrap each <code>Just</code>.</p>\n\n<p>Of course, with this being homework, you'll have to write the code yourself.  But I hope this at least gives you a good idea of how you might approach the problem.</p>\n"}], "owner": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 618, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464539501, "creation_date": 1464537113, "last_edit_date": 1495541389, "question_id": 37511914, "link": "https://stackoverflow.com/questions/37511914/returning-a-matrix-in-diagonals-in-haskell", "title": "Returning a matrix in diagonals in Haskell", "body": "<p>so i was asked to write a function <code>diag :: [[a]] -> [a]</code> in haskell for my weekly assignment which returns all diagonals of a well-formed matrix like:</p>\n\n<p><img src=\"https://i.imgur.com/60XilkG.png?1\" alt=\"matrix\"></p>\n\n<p>Resulting in the list: <code>[a11,a12,a21,a13,a22,a31,a14,a23,a32,a24,a33,a34]</code>.</p>\n\n<p>Since we're not allowed to use any third-party packages like Data.matrix and me not beeing able to completly understand the implementation in <a href=\"https://stackoverflow.com/a/32469565/5655543\">this post</a> i would appreciate your help with this one.</p>\n\n<p><em>EDIT:</em></p>\n\n<p>I understood <a href=\"https://stackoverflow.com/q/3998891/5655543\">this one</a>, but it only returns one diagonal in the wrong order. I also understood the <a href=\"https://math.stackexchange.com/a/22396\">math</a>, but it didn't really help me either.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "edited": false, "score": 0, "creation_date": 1464536752, "post_id": 37511748, "comment_id": 62517226, "body": "I wrote the functions that generate list of tuples describing one jump, they are called canJumpLF and canJumpRF. My problem is that I do not know how to write a recursive function that generates one big list of tuples&#39; lists.      canJump (a,b) list              | (not ((canJumpLF (a,b) list) == [])) = (canJumpLF (a,b) list):(canJump (a+2, b-2) list)             | (not ((canJumpRF (a,b) list) ==[])) =  (canJumpRF(a,b) list) :(canJump (a+2, b+2) list)             | otherwise = []  It returns only the first sequence of possible jumps, skips the rest."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "edited": false, "score": 0, "creation_date": 1464537103, "post_id": 37511748, "comment_id": 62517342, "body": "Work on the <code>singleJumps</code> function first, and then solve the multi-jump / recursion problem."}, {"owner": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "edited": false, "score": 0, "creation_date": 1464537570, "post_id": 37511748, "comment_id": 62517475, "body": "This version of a function returns two possible jumps from the beginning point, but does not produce sequences: canJump1 (a,b) list = ((canJumpLF (a,b) list):(canJump (a+2, b-2) list)) ++ ((canJumpRF(a,b) list) : (canJump (a+2, b+2) list))"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "edited": false, "score": 0, "creation_date": 1464538516, "post_id": 37511748, "comment_id": 62517788, "body": "Looks like a good candidate for <code>singleJumps</code>. Now write <code>multiJumps</code> using the hints I gave. The list comprehension syntax <code>x &lt;- xs</code> roughly translates as &quot;for each x in xs&quot;. Are you familiar with list comprehensions?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "edited": false, "score": 0, "creation_date": 1464538950, "post_id": 37511748, "comment_id": 62517943, "body": "Examples and some explanations of list comprehension: <a href=\"http://learnyouahaskell.com/starting-out#im-a-list-comprehension\" rel=\"nofollow noreferrer\">I&#39;m a list comprehension - LYAH</a> <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">(the Haskell Wiki)</a>"}, {"owner": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "edited": false, "score": 0, "creation_date": 1464543606, "post_id": 37511748, "comment_id": 62519358, "body": "I do not know how to write this recursive function. My function that creates a list [ [(a,b), (c,d)] , [(a,b), (g,h)] ] or if you prefer a list of possible chessboards after one jump is called canOneJump. I do not know how to use it for multijumps."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "edited": false, "score": 0, "creation_date": 1464546493, "post_id": 37511748, "comment_id": 62520285, "body": "Get up to 20 reputation and we can continue in a chat room."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1464536151, "creation_date": 1464536151, "answer_id": 37511748, "question_id": 37511246, "link": "https://stackoverflow.com/questions/37511246/haskell-checkers-how-to-write-a-function-that-returns-a-list-of-possible-jumps/37511748#37511748", "title": "Haskell checkers - how to write a function that returns a list of possible jumps", "body": "<p>First I'd suggest posting your code to the <a href=\"http://codereview.stackexchange.com\">Code Review Stackexchange</a> to get some pointers on code style, organization, and other tips. They have a rule about only reviewing working code, so just ask them to review the code that you have.</p>\n\n<p>Here's an outline of how I would proceed.</p>\n\n<p>The solution will be a lot easier to understand with these type definitions:</p>\n\n<pre><code>type Coord = (Int,Int)\ntype CoordBoard = [ (Coord, Char) ]\n</code></pre>\n\n<p>Step 1. Using the functions you already have, write a function to return all possible single jumps from a specific square:</p>\n\n<pre><code>singleJumps :: (Coord, CoordBoard) -&gt; [ (Coord, CoordBoard) ]\n</code></pre>\n\n<p>Note that you return the updated <code>CoordBoard</code> - i.e. the board with the jumped piece removed and the jumper moved. Return the empty list if there are no possible jumps.</p>\n\n<p>Step 2. Then write a function to find all possible jump <em>paths</em> from a starting square:</p>\n\n<pre><code>multiJumps :: (Coord, CoordBoard) -&gt; [ ([Coord], CoordBoard) ]\n</code></pre>\n\n<p>This also returns the <code>CoordBoard</code> with the jump moves executed. The idea behind <code>multiJumps</code> is:</p>\n\n<pre><code>for each possible single jump (rc, b):\n  for each possible multi jump (path, b') starting from (rc,b):\n    return the path (rc:path) and ending board configuration b'\n</code></pre>\n\n<p>This is where the recursion happens. (Hint: <code>multijumps</code> can be written as a list comprehension.)</p>\n"}, {"tags": [], "owner": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "is_accepted": false, "score": 0, "last_activity_date": 1464643270, "creation_date": 1464643270, "answer_id": 37533792, "question_id": 37511246, "link": "https://stackoverflow.com/questions/37511246/haskell-checkers-how-to-write-a-function-that-returns-a-list-of-possible-jumps/37533792#37533792", "title": "Haskell checkers - how to write a function that returns a list of possible jumps", "body": "<p>Finally, I solved my problem, but I had to change several functions / write new ones.</p>\n\n<pre><code>canJumpLB (a,b) list\n        | (isJumpLBPossible (a,b) list) = [(a,b),(a-2, b-2)]\n        | otherwise = [] \n\ncanJumpRB (a,b) list\n        | (isJumpRBPossible (a,b) list) =  [(a,b),(a-2, b+2)] \n        | otherwise = [] \n\n canOneJump (a,b) list =filter (/=[]) $filter (/=[]) $filter (/=[]) [canJumpLF (a,b) list] ++ [canJumpRF (a,b) list]\n\n\ncanImakeAnotherJump list listOfLists = concat $ [canOneJump (x!!((length x)-1)) list | x &lt;- listOfLists]\nanotherJump list listOfLists = combine (canImakeAnotherJump list listOfLists) listOfLists []\n\njumpSequences v list []  \n        | (canOneJump v list == []) = []\n        | otherwise = jumpSequences v list (canOneJump v list)\n\njumpSequences v list results  \n        | ((canImakeAnotherJump list results) == []) = results\n        | otherwise = jumpSequences v list (anotherJump list results)\n</code></pre>\n\n<p>The function jumpSequences shows all sequences of jumps from a certain position. My pawns do not jump backwards, so I do not update the chessboard. </p>\n"}], "owner": {"reputation": 140, "user_id": 6364239, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208962845131414/picture?type=large", "display_name": "Joanna", "link": "https://stackoverflow.com/users/6364239/joanna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 650, "favorite_count": 1, "accepted_answer_id": 37511748, "answer_count": 2, "score": 2, "last_activity_date": 1486656716, "creation_date": 1464533116, "last_edit_date": 1465854921, "question_id": 37511246, "link": "https://stackoverflow.com/questions/37511246/haskell-checkers-how-to-write-a-function-that-returns-a-list-of-possible-jumps", "title": "Haskell checkers - how to write a function that returns a list of possible jumps", "body": "<p>I would like to ask for help because I do not know how to write a function that analyzes possible jumps for a checkers' pawn.\nI am stuck and I will be very thankful for help. </p>\n\n<p>I created a chessboard and a list of tuples that represent chessboard as a list. </p>\n\n<p>This is the form to be able to show the chessboard on the screen:\n\"\\\"p.p.p.p.\\n.p.p.p.p\\np.p.p.p.\\n........\\n........\\n........\\nP.P.P.P.\\n.P.P.P.P\\nP.P.P.P.\\n\\\"\"</p>\n\n<p>And this is the form which I use to analyze possible moves of pieces:\n[((1,1),'p'),((1,2),'.'),((1,3),'p'),((1,4),'.'),((1,5),'p'),((1,6),'.'),((1,7),'p'),((1,8),'.'),((2,1),'.'),((2,2),'p'),((2,3),'.'),((2,4),'p'),((2,5),'.'),((2,6),'p'),((2,7),'.'),((2,8),'p'),((3,1),'p'),((3,2),'.'),((3,3),'p'),((3,4),'.'),((3,5),'p'),((3,6),'.'),((3,7),'p'),((3,8),'.'),((4,1),'.'),((4,2),'.'),((4,3),'.'),((4,4),'.'),((4,5),'.'),((4,6),'.'),((4,7),'.'),((4,8),'.'),((5,1),'.'),((5,2),'.'),((5,3),'.'),((5,4),'.'),((5,5),'.'),((5,6),'.'),((5,7),'.'),((5,8),'.'),((6,1),'.'),((6,2),'.'),((6,3),'.'),((6,4),'.'),((6,5),'.'),((6,6),'.'),((6,7),'.'),((6,8),'.'),((7,1),'P'),((7,2),'.'),((7,3),'P'),((7,4),'.'),((7,5),'P'),((7,6),'.'),((7,7),'P'),((7,8),'.'),((8,1),'.'),((8,2),'P'),((8,3),'.'),((8,4),'P'),((8,5),'.'),((8,6),'P'),((8,7),'.'),((8,8),'P')]</p>\n\n<p>This is the code I wrote so far:</p>\n\n<pre><code>module Checkers where\n\nimport Test.HUnit\nimport Test.QuickCheck\nimport Data.Char\nimport Data.Maybe (fromJust)\nimport Control.Error.Util (note)\nimport Data.Maybe (listToMaybe)\nimport Data.Char(isDigit)\nimport Data.String\nimport Data.List\nimport Prelude\n\n\ntype Board = [[Square]]\ntype Square = Maybe Piece\n\ndata Piece = Piece PColor PType deriving (Show)\ndata PColor = White | Black deriving (Show)\ndata PType = Pawn | Queen deriving (Show)\n\ntypeList:: [(Char, PType)]\ntypeList = [('p', Pawn), ('q', Queen)]\n\n\ninitialBoard = unlines [\"p.p.p.p.\"\n                        ,\".p.p.p.p\"\n                        ,\"p.p.p.p.\"\n                        ,\"........\"\n                        ,\"........\"\n                        ,\"........\"\n                        ,\"P.P.P.P.\"\n                        ,\".P.P.P.P\"\n                        ,\"P.P.P.P.\" ]\n\nboard2 = unlines        [\"p.p.p.p.\"\n                        ,\".p.p.p.p\"\n                        ,\"p.p.p.p.\"\n                        ,\".P.P.P..\"\n                        ,\"........\"\n                        ,\"........\"\n                        ,\"P...P.P.\"\n                        ,\".P.P.P.P\"\n                        ,\"P.P.P.P.\"]\n\n\n\nshowBoard :: Board -&gt; String\nshowBoard = unlines. map showRow\n    where showRow = map showSquare\n\n\nreadBoard :: String -&gt; Either String Board\nreadBoard = (mapM . mapM) readSquare . lines\n\nshowSquare:: Square -&gt; Char\n-- showSquare Nothing = ' '\n-- showSquare (Just p)  = showPiece p\nshowSquare = maybe ' ' showPiece\n\nreadSquare:: Char -&gt; Either String Square\nreadSquare '.' = return Nothing\nreadSquare c = note errorMsg $ fmap return (readPiece c)  \n        where errorMsg = \"Error reading square '\" ++ show c ++ \"' is not a valid square\"\n\n--readSquare:: Char -&gt; Square\n--readSquare c = readPiece c\n\nshowPiece:: Piece -&gt;  Char\nshowPiece (Piece White Pawn) = 'P'\nshowPiece (Piece Black Pawn) = 'p'\nshowPiece (Piece White Queen) = 'Q'\nshowPiece (Piece Black Queen) = 'q'\n\nreadPiece:: Char -&gt; Maybe Piece\nreadPiece c = fmap makePiece lookupType\n    where   color = if isUpper c then White else Black\n        lookupType = lookup (toLower c) typeList\n        makePiece = Piece color\n\n--readPiece 'P' = Just (Piece White Pawn)\n--readPiece 'p' = Just (Piece Black Pawn)\n--readPiece 'Q' = Just (Piece White Queen)\n--readPiece 'q' = Just (Piece Black Queen)\n--readPiece _ = Nothing\n\n--transform chessboard into a list of tuples to analyze possible kills\n\n\n--String or Int?\ntestString = \"hello world 13 i am a new 37 developer 82\"\n\ndata StringOrInt = S String | I Int\n    deriving (Eq,Ord,Show)\n\nreadInt :: String -&gt; Int\nreadInt = read\n\n--convert String into tuples\n--1. convert chessBoard into a list\nmyShow :: String -&gt; String\nmyShow s = concat [\"[\", intersperse ',' s, \"]\"]\nisSlash x = x=='\\\\'\ndeleteAllInstances :: Eq a =&gt; a -&gt; [a] -&gt; [a]\ndeleteAllInstances a xs = filter (/= a) xs\nclearBoardList_ s = deleteAllInstances '\\n' $ myShow $ s\nclearBoardList__ s = deleteAllInstances '[' $ clearBoardList_ s\nclearBoardList s = deleteAllInstances ',' $ clearBoardList__ s\n\n--2 zip with coordinates (1,1), (1,2).... (8,8)\nmakeL = [(x,y)| x&lt;-[1..8], y&lt;-[1..8]]\nmakeTuplesBoard s = zip makeL s\ntestList = makeList initialBoard\ntestList2 = makeList board2\n--3 all together\nmakeList s = makeTuplesBoard $ clearBoardList s --xy coordinates of pawns\n\n\n--is there my Pawn?\nisMyPawn ((x,y),z) = (z=='p' || z=='q')\nmatchFirst (a,b) ((c,d),_) = (a,b) == (c,d)\nwhatIsThere (a,b) list =  eliminate $ find (matchFirst (a,b)) list          --test: whatIsThere (1,1) $ makeList initialBoard\neliminate (Just a) = a\nwhichPiece (a,b) list = snd $ snd ( whatIsThere (a,b) $ makeTuplesBoard list ) --shows what is on a specific field\n\nisThereSth (a,b) list = whichPiece (a,b) list == 'p' || whichPiece (a,b) list == 'P' || whichPiece (a,b) list == 'q' ||whichPiece (a,b) list == 'Q'     --isThereSth (1,1) $ makeList initialBoard\n\nisThereMyPawn (a,b) list = ((whichPiece (a,b) list == 'p'), list)     --whichPiece (a,b) list == ((a,b),'p')\nisThereMyQueen (a,b) list = ((whichPiece (a,b) list == 'q'), list)\nisThereOtherPawn (a,b) list = ((whichPiece (a,b) list == 'P'), list)\nisThereOtherQueen (a,b) list = ((whichPiece (a,b) list == 'Q'), list)\n\n--remove a figure from its place and put somewhere else\nremovePiece (a,b) list = map (\\ x -&gt; if matchFirst (a,b) x then ((a,b),'.') else x) list\nremoveMyPawn (a,b) list = removePiece (a,b) list\nremoveMyQueen (a,b) list = removePiece (a,b) list \nremoveOtherPawn (a,b) list = removePiece (a,b) list \nremoveOtherQueen (a,b) list = removePiece (a,b) list\nisWithinLimit (a,b) \n    | not ((a&gt;0) &amp;&amp; (a&lt;9) &amp;&amp; (b&gt;0) &amp;&amp; (b&lt;9)) = False\n    | otherwise = True\n\nisWithinLimit1 (a,b) list\n    | not ((a&gt;0) &amp;&amp; (a&lt;9) &amp;&amp; (b&gt;0) &amp;&amp; (b&lt;9)) = (False, list)\n    | otherwise = (True, list)\n\nputPiece (a,b) piece list = map (\\ x -&gt; if matchFirst (a,b) x then ((a,b),piece) else x) list --map (\\ x -&gt; if matchFirst (a,b) x then ((a,b),'.') else x) list\n--test: movePiece (1,1) (1,2) $  makeTuplesBoard initialBoard\nmovePiece (a,b) (c,d) list =  removePiece (a,b) $ putPiece (c,d) (whichPiece (a,b) $  makeTuplesBoard initialBoard ) (makeTuplesBoard initialBoard)\n\n--putADot (a,b) list = replace ( matchFirst (a,b)) list \n--swapTuples (a,b) (c,d) list = \n--move (a,b) (c,d) list = \n--  | (isThereSth (a,b) == False) = list\n--        | otherwise = \n\nisThereOtherPawn2 (a,b) list x\n    | (x==True) = fst $ isThereOtherPawn (a,b) list\n    | otherwise = False\n\nisWithinLimit2 (a,b) list x\n    | (x==True) = fst $ isWithinLimit1 (a,b) list \n    | otherwise = False\n\nisFree2 (a,b) list x\n    | (x==True) = isFree (a,b) list\n    | otherwise = False\n\nisThereMyPawn2 (a,b) list x \n    | (x==True) = fst $ isThereMyPawn (a,b) list\n    | otherwise = False\n\nisFree (a,b) list = not (isThereSth (a,b) list)\nisJumpLFPossible (a,b) list = isThereMyPawn2 (a,b) list $ (isFree2 (a+2,b-2) list $ isWithinLimit2 (a+2,b-2) testList $ isThereOtherPawn2 (a+1,b-1) list $ fst $ isWithinLimit1 (a+1,b-1) list) --test: isFree2 (3,4) testList $ isWithinLimit2 (3,4) testList $ isThereOtherPawn2 (3,4) testList $ fst $ isWithinLimit1 (2,3) testList\n\nisJumpRFPossible (a,b) list = isThereMyPawn2 (a,b) list $ (isFree2 (a+2,b+2) list $ isWithinLimit2 (a+2,b+2) testList $ isThereOtherPawn2 (a+1,b+1) list $ fst $ isWithinLimit1 (a+1,b+1) list) --test: isFree2 (3,4) testList $ isWithinLimit2 (3,4) testList $ isThereOtherPawn2 (3,4) testList $ fst $ isWithinLimit1 (2,3) testList\n\n\n-- checking whether my Pawn has any jump possiblitiy - one move\ncanJumpLF (a,b) list\n        | (isJumpLFPossible (a,b) list) = [(a,b),(a+2, b-2)] \n        | otherwise = [] --test: canJump (1,1) testBoard\n\ncanJumpRF (a,b) list\n        | (isJumpRFPossible (a,b) list) = [(a,b),(a+2, b+2)] \n        | otherwise = [] --test: canJump (1,1) testBoard\n\n    isFree (a,b) list = not (isThereSth (a,b) list)\n\n\n-- recursive check whether and which kills are possible for my Pawn\n--canJump (a,b) list \n--      | (fst (canJumpLF (a,b) list)) = snd (canJump (a+2, b-2) list)\n--      | (fst (canJumpRF (a,b) list)) = snd (canJump (a+2, b+2) list)\n--      | otherwise = []\n\nreplaceTuple tups old new = map check tups where\n    check tup | tup == old = new\n              | otherwise  = tup\n\n\n--movePawn (x,y) (a,b) = if (isMyPawn(x,y)\n\n--replacePawn list = replaceTuple $ ((x,y),_) ((x,y),'.') list\n\n--analyze possible moves of pawn\n\n\n--Tests\ntests:: Test\ntests = TestList $ map TestCase\n    [assertEqual \"odd tests here\" 1(1 :: Int)]\n\nprop_empty :: Int -&gt; Bool\nprop_empty c1 = (c1::Int) == c1\n\nrunTest = do\n    return()\n\nmain:: IO()\nmain = runTest\n</code></pre>\n\n<p>My problem is as follows. I need a function that returns a list of all possible jump sequences. I think it needs to be a recursive function. It should:\n(1) check whether a jump to the right, left is possible\n(2) if it is possible, then recursively run itself from the position a pawn would take after (1)\n(3) it should return a list of tuples' lists representing possible sequences of jumps: [(a,b), (c,d), (e,f), (g,h)], [(a,b), (p,r)], [(a,b), (q,s), (t,u)]]\n(4) if the pawn reached the opposite end of the chessboard it can jump backwards if there are any possible jumps\n(5) if the pawn reached the end of the board and there are no jumps possible it turns into a queen (it gets crowned - I cannot tell whether this possibility should be included in this function or not - perhaps not)</p>\n\n<p>In other words, from the position (a,b) I want to analyze all possible jumps and write a function that returns a list of all possible jump sequences. \n...\nAfter modifications my problem remains but I can explain it simpler:</p>\n\n<p>The function canOneJump (a,b) board returns a list of possible places where pawns can be after they made 1 jump. In other words, the function returns [(1,2), (2,3), (4,5)] each tuple representing a row and a column where a pawn can be after a jump.\nI have a function that is supposed to create now lists of jumps from the initial location of a pawn (a,b) (based on the chessboard situation which is given as a list) but it does not work. Perhaps someone could help me to fix this function so it works. \nI want to get a list of jump sequences  [[(3,3), (5,5), (7,3)], [(3,3), (5,1)]]  that represent different jump sequences that are available. </p>\n\n<pre><code>canJump v board = \n        map (v:) w\n        where\n            list = listPlacesAfterMyPawnJump v board\n            w = concat $ map (flip canJump board) list\n</code></pre>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1464535564, "post_id": 37510611, "comment_id": 62516835, "body": "A monad like this would look similar to <a href=\"http://hackage.haskell.org/package/resourcet-1.1.7.3/docs/Control-Monad-Trans-Resource.html\" rel=\"nofollow noreferrer\">ResourceT</a>:  &quot;a modified ReaderT monad transformer holding onto a mutable reference to all of the release actions still remaining to be performed&quot;. The difference is that the cleanup actions would only be performed in case of error. Given that <code>ResourceT</code> gives the user access to its <a href=\"http://hackage.haskell.org/package/resourcet-1.1.7.3/docs/Control-Monad-Trans-Resource.html#g:9\" rel=\"nofollow noreferrer\">internal state</a> perhaps it could serve as the base of a <code>RollbackT</code> implementation."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464561845, "post_id": 37512012, "comment_id": 62524740, "body": "Removing rollback actions once something succeeds seems annoying with this approach; could you comment on how to do that briefly?"}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464564622, "post_id": 37512012, "comment_id": 62525278, "body": "I don&#39;t understand; if the computation succeeds, the rollback list is ignored."}, {"owner": {"reputation": 577, "user_id": 2623340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be7fc634975d4db3756313e5b78f4dec?s=128&d=identicon&r=PG", "display_name": "ArnauOrriols", "link": "https://stackoverflow.com/users/2623340/arnauorriols"}, "edited": false, "score": 0, "creation_date": 1538244731, "post_id": 37512012, "comment_id": 92078929, "body": "Shouldn&#39;t the tell [rollaction] be in the Left case?"}], "tags": [], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "is_accepted": false, "score": 1, "last_activity_date": 1464537985, "last_edit_date": 1464537985, "creation_date": 1464537638, "answer_id": 37512012, "question_id": 37510611, "link": "https://stackoverflow.com/questions/37510611/rollback-io-action/37512012#37512012", "title": "rollback IO action", "body": "<p>This looks very much like a <code>WriterT</code> monad combined with <code>ExceptT</code>. You could probably do something like this:</p>\n\n<pre><code>orRollback action rollaction = do\n    eres &lt;- liftIO $ try action \n    case eres of\n       Right res -&gt; do\n          tell [rollaction]\n          return res\n       Left (e :: SomeException) -&gt; throwE e\n</code></pre>\n\n<p>And then call it like:</p>\n\n<pre><code>runMyComputation computation = do\n   (res, rolls) &lt;- runWriterT $ runExceptT $ computation\n   case res of\n       Right r -&gt; return r\n       Left e -&gt; do\n           sequence_ (reverse rolls) -- Handle errors in rollbacks?\n           throwIO e\n</code></pre>\n\n<p>I didn't test it, but the idea should work. You might probably need some better monoid than <code>[]</code> if you are going to see exceptions often.</p>\n\n<p>This doesn't quite compose as you cannot do <code>onRollback</code> on non-IO actions. But that might be perfectly OK.</p>\n"}], "owner": {"reputation": 219, "user_id": 4625247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/cbHw8.gif?s=128&g=1", "display_name": "Mikhail Puzanov", "link": "https://stackoverflow.com/users/4625247/mikhail-puzanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1465335949, "creation_date": 1464529362, "last_edit_date": 1465335949, "question_id": 37510611, "link": "https://stackoverflow.com/questions/37510611/rollback-io-action", "title": "rollback IO action", "body": "<p>I have a very simple abstraction for dealing with a sequence of IO actions which can be rolled back (to some extent), i.e. if an action writes a file, then rollback would be deleting this file or if an action creates a directory tree, pruning it would be the rollback, etc.</p>\n\n<pre><code>data IOAction = IOAction {\n  execute  :: IO (),\n  rollback :: IO ()\n}\n\nexecuteAll :: [IOAction] -&gt; IO ()\nexecuteAll [] = return ()\nexecuteAll (a : as) = do\n  execute a\n  executeAll as `catch` rollbackAndRethrow\n  where\n    rollbackAndRethrow :: SomeException -&gt; IO ()\n    rollbackAndRethrow e = rollback a &gt;&gt; throw e\n</code></pre>\n\n<p>It does pretty much what I want, but I have a strong hunch that there are more composable and more reliable (in the sense of exception handling) ways to do it. So my question is could I use, say, a known monad transformer from some library to implement the same idea?</p>\n\n<p>Having something like </p>\n\n<pre><code>writeFilesAtomically :: CanRollbackT IO ()\nwriteFilesAtomically = do\n  a1 &lt;- (writeFile a str1) `orRollback` removeFile a\n  a2 &lt;- (writeFile x str2) `orRollback` removeFile x\n  ....\n</code></pre>\n\n<p>would be more convenient than the current solution.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1464529643, "post_id": 37510536, "comment_id": 62515009, "body": "Try <code>stack</code>, it just works."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1464530124, "post_id": 37510536, "comment_id": 62515151, "body": "I installed stack, but it forced me to downgrade from GHC 8.0.1 to 7.10, I&#39;m not sure stack works with GHC 8"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464534931, "post_id": 37510536, "comment_id": 62516636, "body": "last time I checked you needed to use the ghc-8 branch to get ghc-mod working with ghc8 anyway - so <code>install ghc-mod</code> probably will not work with 8.0.1 right now"}], "answers": [{"tags": [], "owner": {"reputation": 1243, "user_id": 679688, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/688b35f9becc72d8ca0d2fbc76749119?s=128&d=identicon&r=PG", "display_name": "Joshua Chia", "link": "https://stackoverflow.com/users/679688/joshua-chia"}, "is_accepted": false, "score": 1, "last_activity_date": 1467537466, "creation_date": 1467537466, "answer_id": 38168497, "question_id": 37510536, "link": "https://stackoverflow.com/questions/37510536/trouble-installing-ghc-mod/38168497#38168497", "title": "Trouble installing ghc-mod", "body": "<p><a href=\"https://github.com/DanielG/ghc-mod/issues/798\" rel=\"nofollow\">https://github.com/DanielG/ghc-mod/issues/798</a></p>\n\n<p>Officially, ghc-mod is not updated to GHC 8. There's a branch ghc-8 for it where some tests are still broken but other things supposedly work.</p>\n\n<p>The ghc-8 branch seems to work for me. It builds and I can use it. I use Stack on Linux.</p>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1703, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1467537466, "creation_date": 1464528879, "last_edit_date": 1464529975, "question_id": 37510536, "link": "https://stackoverflow.com/questions/37510536/trouble-installing-ghc-mod", "title": "Trouble installing ghc-mod", "body": "<p>I'm trying to install GHC-MOD on Windows 10 x64 on GHC 8.0.1 with cabal:</p>\n\n<pre><code>C:\\WINDOWS\\system32&gt;cabal install ghc-mod\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: ghc-mod-5.5.0.0 (user goal)\ntrying: djinn-lib-0.0.1.2/installed-I8G... (dependency of djinn-ghc-0.0.2.3)\nnext goal: mtl (dependency of ghc-mod-5.5.0.0)\nrejecting: mtl-2.2.1/installed-6qs... (conflict: mtl =&gt;\ntransformers==0.5.2.0/installed-0.5..., ghc-mod =&gt; transformers&lt;0.5)\nrejecting: mtl-2.2.1, mtl-2.2.0.1, mtl-2.2, mtl-2.1.3.1, mtl-2.1.2, mtl-2.1.1,\nmtl-2.1, mtl-2.0.1.1, mtl-2.0.1.0, mtl-2.0.0.0, mtl-1.1.1.1, mtl-1.1.1.0,\nmtl-1.1.0.2, mtl-1.1.0.1, mtl-1.1.0.0, mtl-1.0 (conflict: djinn-lib =&gt;\nmtl==2.2.1/installed-6qs...)\nBackjump limit reached (currently 2000, change with --max-backjumps or try to\nrun with --reorder-goals).\n</code></pre>\n\n<p>Then changing backjumps:</p>\n\n<pre><code>C:\\WINDOWS\\system32&gt;cabal install ghc-mod --max-backjumps 9999\nResolving dependencies...\nConfiguring old-time-1.1.0.3...\nFailed to install old-time-1.1.0.3\nBuild log ( C:\\Users\\xx\\AppData\\Roaming\\cabal\\logs\\old-time-1.1.0.3.log ):\nConfiguring old-time-1.1.0.3...\nconfigure: WARNING: unrecognized options: --with-compiler\nchecking for gcc... C:\\PROGRA~1\\HASKEL~1\\802E01~1.1\\mingw\\bin\\gcc.exe\nchecking whether the C compiler works... no\nconfigure: error: in `/cygdrive/c/Users/xx/AppData/Local/Temp/cabal-tmp-3644/old-time-1.1.0.3':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\ncabal: Leaving directory 'C:\\Users\\xx\\AppData\\Local\\Temp\\cabal-tmp-3644\\old-time-1.1.0.3'\ncabal: Error: some packages failed to install:\ncpphs-1.20.1 depends on old-time-1.1.0.3 which failed to install.\nghc-mod-5.0.0 depends on old-time-1.1.0.3 which failed to install.\nhaskell-src-exts-1.17.1 depends on old-time-1.1.0.3 which failed to install.\nhlint-1.9.32 depends on old-time-1.1.0.3 which failed to install.\nold-time-1.1.0.3 failed during the configure step. The exception was:\nExitFailure 77\n</code></pre>\n\n<p>I've tried installing both MinGW+MSYS and Cygwin, but neither works. All the GHC folders are in the PATH environment variable.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464525072, "post_id": 37509719, "comment_id": 62513646, "body": "What do you expect <code>initializePure :: Bar</code> to be, in the last case? There is no implementation for that: not in the instance, and not in the class."}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464560703, "post_id": 37509719, "comment_id": 62524505, "body": "@chi I don&#39;t expect <code>initializePure</code> to be called except from <code>initialize</code>. I&#39;ve amended the question to include that."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1464562873, "post_id": 37509867, "comment_id": 62524917, "body": "...and you can use <code>DefaultSignatures</code> to still have a default implementation of <code>initialise</code> for those types that happen to also be instances of <code>PureInitialisable</code>."}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464606629, "post_id": 37509867, "comment_id": 62540041, "body": "@DanielWagner That extension suits me perfectly, want to make that an answer?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1464627583, "post_id": 37509867, "comment_id": 62551750, "body": "@Koterpillar I&#39;ve edited this answer to mention it, instead."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1464627573, "last_edit_date": 1464627573, "creation_date": 1464524543, "answer_id": 37509867, "question_id": 37509719, "link": "https://stackoverflow.com/questions/37509719/minimal-complete-definition-with-dependent-functions/37509867#37509867", "title": "Minimal complete definition with dependent functions", "body": "<p>The compiler is quite right to warn about this, since it <em>cannot</em> be possible to have <code>initialisePure</code> on a type that can only be initialised with IO.</p>\n\n<p>The only way to make this safe is to separate the two cases; the simplest possibility would be to have <em>two</em> classes:</p>\n\n<pre><code>class Initialisable a where\n  initialise :: IO a\n\nclass Initialisable a =&gt; PureInitialisable a where\n  initialisePure :: a\n\ndata Foo = Foo\n\ninstance Initialisable Foo where\n  initialise = return Foo\ninstance PureInitialisable Foo where\n  initialisePure = Foo\n\ndata Bar = Bar\ninitialiseBar :: IO Bar\ninitialiseBar = undefined\n\ninstance Initialisable Bar where\n  initialise = initialiseBar\n</code></pre>\n\n<p>You can't give a default implementation for <code>PureInitialisable</code>, because it just <em>doesn't exist</em> for some types, like <code>Bar</code>. But if you turn on <code>DefaultSignatures</code>, you can give a default for <code>Initialisable</code> that kicks in when the type also happens to be <code>PureInitialisable</code>:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n\nclass Initialisable a where\n  initialise :: IO a\n\n  default initialise :: PureInitialisable a =&gt; IO a\n  initialise = return initialisePure\n</code></pre>\n\n<p>For types like <code>Foo</code>, this lets you write</p>\n\n<pre><code>instance PureInitialisable Foo where initialisePure = Foo\ninstance Initialisable Foo\n</code></pre>\n\n<p>which is slightly shorter.</p>\n\n<p>An alternative might be to make the monad in which initialisation happens customisable:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass Initialisable a where\n  type InitialisationM a :: *\n  type InitialisationM a = a\n  initialise :: InitialisationM a\n\ninstance Initialisable Foo where\n  initialise = Foo\n\ninstance Initialisable Bar where\n  type InitialisationM Bar = IO Bar\n  initialise = initialiseBar\n</code></pre>\n"}], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 37509867, "answer_count": 1, "score": 2, "last_activity_date": 1464627573, "creation_date": 1464523648, "last_edit_date": 1464561381, "question_id": 37509719, "link": "https://stackoverflow.com/questions/37509719/minimal-complete-definition-with-dependent-functions", "title": "Minimal complete definition with dependent functions", "body": "<p>I have the following typeclass (irrelevant methods omitted):</p>\n\n<pre><code>class Initializable a where\n    initialize :: IO a\n    initialize = return initializePure\n\n    {# convenience method for implementations, not to be called from outside #}\n    initializePure :: a\n\ndata Foo = Foo\n\ninstance Initializable Foo where\n    initializePure = Foo\n\ndata Bar = Bar\n\ninstance Initializable Bar where\n    initialize = initializeBar\n</code></pre>\n\n<p>Some implementations need <code>IO</code> to initialize themselves, some don't.</p>\n\n<p>This code gives a warning:</p>\n\n<pre><code>No explicit implementation for\n  \u2018initializePure\u2019\nIn the instance declaration for \u2018Initializable Bar\u2019\n</code></pre>\n\n<p>I have tried to add a <code>MINIMAL</code> pragma like this:</p>\n\n<pre><code>{-# MINIMAL initializePure | initialize #-}\n</code></pre>\n\n<p>But then I get a different warning:</p>\n\n<pre><code>The MINIMAL pragma does not require:\n  \u2018initializePure\u2019\nbut there is no default implementation.\nIn the class declaration for \u2018Initializable\u2019\n</code></pre>\n\n<p>My intent is to have <code>Initializable</code> by providing <em>either</em> <code>initialize</code> or <code>initializePure</code>, but only using <code>initialize</code> outside of the definition.</p>\n\n<p>How do I compile the code cleanly?</p>\n"}, {"tags": ["haskell", "types", "continuation-passing"], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464526992, "post_id": 37509308, "comment_id": 62514198, "body": "I guess I got my terminology mixed up. Though, why does the above give a type error when I write out the type of <code>z</code> explicitly as <code>z :: a -&gt; r</code> as in the above?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464527914, "post_id": 37509308, "comment_id": 62514482, "body": "@MarkoGrdinic Because of an arguably wrong default interpretation rule of that signature. Briefly put, Haskell assumes each signature is independent from others, so your <code>a</code> in <code>z :: a -&gt; r</code> is unrelated to the <code>a</code> in the signature of <code>chainCPS</code>.  You can tell Haskell that they are indeed the same thing if you write <code>chainCPS :: forall a b r .  ...</code> and enable the <code>ScopedTypeVariables</code> extension. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#lexically-scoped-type-variables\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1464521081, "creation_date": 1464521081, "answer_id": 37509308, "question_id": 37508652, "link": "https://stackoverflow.com/questions/37508652/what-is-the-type-of-the-variables-in-chaincps/37509308#37509308", "title": "What is the type of the variables in chainCPS?", "body": "<blockquote>\n  <p>That means that <code>s z</code> should be of type <code>r</code> after applying <code>z</code> to <code>s</code>.</p>\n</blockquote>\n\n<p>Nope. It is true that <code>z someArg</code> is of type <code>r</code>, when <code>someArg</code> is of type <code>a</code>, but here we are applying <code>s</code>, not <code>z</code>.</p>\n\n<p>Here instead we have</p>\n\n<pre><code>s :: (a -&gt; r) -&gt; r\nz :: (a -&gt; r)\n</code></pre>\n\n<p>so <code>z</code> matches the type of the argument of <code>s</code>. Hence, the resulting type is the result of <code>(a -&gt; r) -&gt; r</code>, which is <code>r</code>.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 37509308, "answer_count": 1, "score": 1, "last_activity_date": 1464521081, "creation_date": 1464516828, "last_edit_date": 1464518250, "question_id": 37508652, "link": "https://stackoverflow.com/questions/37508652/what-is-the-type-of-the-variables-in-chaincps", "title": "What is the type of the variables in chainCPS?", "body": "<p>I am looking at the <a href=\"https://en.wikibooks.org/wiki/Haskell/Continuation_passing_style\" rel=\"nofollow\">continuation passing style tutorial</a> and cannot understand the types in the following function.</p>\n\n<pre><code>  chainCPS :: ((a -&gt; r) -&gt; r) -&gt; (a -&gt; ((b -&gt; r) -&gt; r)) -&gt; ((b -&gt; r) -&gt; r)\n  chainCPS s f k = s z where \n    -- z :: (a -&gt; r) -&gt; a -&gt; ((b -&gt; r) -&gt; r) -- Fails\n    z x = f x k\n</code></pre>\n\n<p>The above is the remodel of the following:</p>\n\n<pre><code>  chainCPS :: ((a -&gt; r) -&gt; r) -&gt; (a -&gt; ((b -&gt; r) -&gt; r)) -&gt; ((b -&gt; r) -&gt; r)\n  chainCPS s f = \\k -&gt; s $ \\x -&gt; f x $ k\n</code></pre>\n\n<p>Looking at the type info provided by the Atom editor I can see that <code>s :: (a -&gt; r) -&gt; r</code>, <code>f :: a -&gt; (b -&gt; r) -&gt; r</code>, <code>k :: b -&gt; r</code>. Futhermore in <code>z</code> the <code>x</code> is of type <code>x :: a</code>.</p>\n\n<p>What is confusing to me about this is that <code>z</code> is of type <code>z :: a -&gt; r</code>.</p>\n\n<p>That means that <code>s z</code> should be of type <code>r</code> after applying <code>z</code> to <code>s</code>.</p>\n\n<p>If so, how does the final type come out to <code>(b -&gt; r) -&gt; r</code>?</p>\n\n<p>Edit: The <code>b -&gt; r</code> comes from <code>k</code>...right. That means <code>z</code> really is of type <code>a -&gt; r</code>, as the editor says. But then why does the following fail typechecking?</p>\n\n<pre><code>  chainCPS :: ((a -&gt; r) -&gt; r) -&gt; (a -&gt; ((b -&gt; r) -&gt; r)) -&gt; (b -&gt; r) -&gt; r\n  chainCPS s f k = s z where\n    z :: a -&gt; r\n    z x = f x k\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "edited": false, "score": 1, "creation_date": 1464504482, "post_id": 37507016, "comment_id": 62508376, "body": "From what I&#39;ve seen, the convention for using double <code>&gt;</code> indicates a sort of &quot;direction&quot;. You could read this is as feed the result of <code>f</code> into <code>g</code>, which is sort of the &quot;opposite direction&quot; of function composition."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 6, "creation_date": 1464504900, "post_id": 37507016, "comment_id": 62508471, "body": "<code>&gt;.&gt;</code> is an indivisible operator symbol. It represents a function. Its individual characters represent nothing, just like <code>r</code> in <code>print</code> represent nothing. In Haskell you can define new operator symbols. You can define <code>&gt;.&gt;</code> or <code>+++&lt;&gt;+++</code> or <code>&gt;&gt;&gt;&lt;&lt;&lt;</code> or <code>-=+=-</code> to do whatever you want. Some library happens to define <code>f &gt;.&gt; g </code> to be the same as <code>g . f</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1464516915, "post_id": 37507812, "comment_id": 62511220, "body": "If it <i>is</i> a reverse composition operator (which should be determined with <code>:t (&gt;.&gt;)</code> in GHCi) then it should be noted that it&#39;s preferrable to use <a href=\"http://hackage.haskell.org/package/base/docs/Control-Arrow.html#v:-62--62--62-\" rel=\"nofollow noreferrer\"><code>&gt;&gt;&gt;</code></a> from the base library instead."}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": true, "score": 2, "last_activity_date": 1464510776, "creation_date": 1464510776, "answer_id": 37507812, "question_id": 37507016, "link": "https://stackoverflow.com/questions/37507016/in-haskell-whats-does-the-notation-represent/37507812#37507812", "title": "In Haskell, what&#39;s does the notation &gt;.&gt; represent?", "body": "<p>It is just the name of an operator; the operator might as well have been named <code>foo</code> or <code>&gt;&gt;&gt;&gt;.&gt;</code> or something else, as long as its a legal name in Haskell. </p>\n\n<p>A domain specific meaning of the symbols might have been assigned by the author, especially in relation to other names in the same library, however, in this case, I doubt there is some deeper meaning \u2014 it's just the reverse function composition operator. </p>\n"}], "owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 37507812, "answer_count": 1, "score": 1, "last_activity_date": 1464510776, "creation_date": 1464504090, "question_id": 37507016, "link": "https://stackoverflow.com/questions/37507016/in-haskell-whats-does-the-notation-represent", "title": "In Haskell, what&#39;s does the notation &gt;.&gt; represent?", "body": "<p>What does the notation <code>f &gt;.&gt; g = g . f</code> mean?  Specifically what does the two <code>&gt;</code> symbols around the dot indicate?</p>\n"}, {"tags": ["haskell", "queue"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464493032, "post_id": 37505725, "comment_id": 62506460, "body": "Although thoroughly off-topic for StackOverflow, this is an excellent question. You can indeed get much better performance from more restricted types. The simple &quot;banker&#39;s queue&quot; behzad.nouri suggests is very good when the queue is not too big. Once you push up against the cache size, it starts to look pretty bad. You might want to consider fancy cache-oblivious queues if performance is critical. Otherwise, I would <i>guess</i> you might do all right with Okasaki&#39;s finger-tree-style &quot;implicit queues&quot;."}, {"owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464494524, "post_id": 37505725, "comment_id": 62506712, "body": "I don&#39;t think it is off-topic as I am not looking for a subjective comparison; I  want to know if I missed something obvious in my search (eg, for C++ the answer would be std::queue). It may be that the best answer is just Data.Sequence, or &quot;no, such a packages does not exist.&quot; I updated my question to be more objective."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464494913, "post_id": 37505725, "comment_id": 62506789, "body": "There are lots of kinds of queues with different performance characteristics, capabilities, etc. Are you looking for a persistent queue? A monadic ephemeral queue? A queue occasionally used persistently? A queue for communication between concurrent threads?"}, {"owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464497220, "post_id": 37505725, "comment_id": 62507124, "body": "Yes, a persistent queue. I found the answer in GHC release notes, see my answer below."}], "answers": [{"comments": [{"owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "edited": false, "score": 0, "creation_date": 1464493043, "post_id": 37505858, "comment_id": 62506462, "body": "Sure, but I was looking for a mature Haskell implementation, preferably in Haskell Platform or Hackage."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464494426, "post_id": 37505858, "comment_id": 62506686, "body": "That version of the queue is not the banker&#39;s queue I thought it was. Your queue can perform very badly when used persistently."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464502704, "post_id": 37505858, "comment_id": 62508042, "body": "@dfeuer ...but, to be fair, a <i>persistent</i> queue is a pretty niche need."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 4, "last_activity_date": 1464496563, "last_edit_date": 1464496563, "creation_date": 1464492295, "answer_id": 37505858, "question_id": 37505725, "link": "https://stackoverflow.com/questions/37505725/standard-queue-package-for-haskell/37505858#37505858", "title": "Standard queue package for Haskell?", "body": "<p>Okasaki in his book <a href=\"https://rads.stackoverflow.com/amzn/click/com/0521663504\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Purely Functional Data Structures</a>, describes a FIFO queue as a pair of lists, <em>front</em> and <em>back</em>, where the front list contains the front elements of the queue in the correct order, and the back list contains the rear elements of the queue in the <em>reverse</em> order.</p>\n\n<pre><code>data Queue a = Queue [a] [a]  -- front &amp; back lists\n</code></pre>\n\n<p>The idea is that new items are inserted to <em>front</em> of the <em>back</em> list, whereas values are popped out from the front list. If the front list becomes empty it is replaced by the <em>reverse</em> of the back list.</p>\n\n<p>The queue maintains the invariance that the front list can be empty only if the back list is also empty; and performs amortized O(1).</p>\n\n<pre><code>-- helper function to maintain the invariance:\n-- front list can be empty only if the back list is also empty\nfill :: Queue a -&gt; Queue a\nfill (Queue [] b) = Queue (reverse b) []\nfill q = q\n\npush :: a -&gt; Queue a -&gt; Queue a\npush x (Queue f b) = fill $ Queue f (x:b)\n\nfront :: Queue a -&gt; Maybe a\nfront (Queue (x:_) _) = Just x\nfront _               = Nothing\n\npop :: Queue a -&gt; Maybe (Queue a)\npop (Queue (_:xs) b) = Just . fill $ Queue xs b\npop _                = Nothing\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464497875, "post_id": 37506254, "comment_id": 62507220, "body": "<code>Data.Sequence</code> is lots of fun when you need lots of reasonably efficient operations (I&#39;m currently the person primarily responsible for maintaining it, so I have a pretty decent sense of its good and bad features). But you&#39;ll pretty much always do better by using a less flexible structure if you can get away with it. <code>Data.Sequence</code> has to maintain size annotations to support splitting, needs to support multiple internal node sizes and extra &quot;digit&quot; sizes to support concatenation, etc."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464498011, "post_id": 37506254, "comment_id": 62507238, "body": "If you make only light use of persistence, you may be better off with larger nodes. If you&#39;re storing unboxable types, you may be able to use unboxed vectors in a tree to make things really scream. There&#39;s no one queue to rule them all."}, {"owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464499370, "post_id": 37506254, "comment_id": 62507457, "body": "Thank you for the advise; I will keep it in mind if/when I run into performance issues. That said, it is good to know <code>Data.Sequence</code> is reasonable for general use as not writing &amp; debugging a custom queue is likely to save me more time than the efficiency costs (and as you pointed out in your comment on behzad.nouri&#39;s answer, it is easy to make subtle mistakes that greatly decrease efficiency)."}, {"owner": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464529054, "post_id": 37506254, "comment_id": 62514842, "body": "@dfeuer Any hope that index-based insert and delete will be added? <a href=\"https://github.com/haskell/containers/issues/138\" rel=\"nofollow noreferrer\">github.com/haskell/containers/issues/138</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "edited": false, "score": 0, "creation_date": 1464531582, "post_id": 37506254, "comment_id": 62515616, "body": "@Alan, I have to think some more about that; I forgot I&#39;d had that idea. I&#39;m not sure it&#39;s possible to do better than splitting and re-joining, and I&#39;m generally hesitant to add new functions that can be implemented as efficiently using the existing API in an obvious way."}, {"owner": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464546343, "post_id": 37506254, "comment_id": 62520235, "body": "@dfeuer If that is really the best that can be done (for now at least), the documentation should imo mention that.  Otherwise an API oversight may be suspected."}, {"owner": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464548803, "post_id": 37506254, "comment_id": 62521038, "body": "@dfeuer One other thing: might there be possible gains from an analog to <code>Data.Array.&#47;&#47;</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "edited": false, "score": 0, "creation_date": 1464549375, "post_id": 37506254, "comment_id": 62521238, "body": "@Alan, actually, I&#39;ve just had an idea for <code>insert</code> that I&#39;m working up right now, using 2-3 (non-finger) tree insertion. I don&#39;t know if it will work out, and I don&#39;t know if it will be fast, but I&#39;ll give it a go. <code>&#47;&#47;</code> for sequences is possible, but to do it reasonably efficiently I think we&#39;d need to rearrange some module dependencies so it could use <code>Data.IntMap</code>. The coming major version of <code>containers</code> will not do any such large-scale restructuring, but some ideas are very definitely in the air for doing so in the version after that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "edited": false, "score": 0, "creation_date": 1464550451, "post_id": 37506254, "comment_id": 62521601, "body": "@Alan, I opened <a href=\"https://github.com/haskell/containers/issues/262\" rel=\"nofollow noreferrer\">github.com/haskell/containers/issues/262</a> for <code>&#47;&#47;</code>, but you should also email libraries@haskell.org with a formal proposal."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "edited": false, "score": 1, "creation_date": 1464830791, "post_id": 37506254, "comment_id": 62649277, "body": "@Alan, for StackOverflow posterity, know that the next version <code>Data.Sequence</code> will offer <code>insertAt</code> and <code>deleteAt</code>, each of which is several times faster than splitting and re-joining."}], "tags": [], "owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "is_accepted": true, "score": 2, "last_activity_date": 1464496977, "creation_date": 1464496977, "answer_id": 37506254, "question_id": 37505725, "link": "https://stackoverflow.com/questions/37505725/standard-queue-package-for-haskell/37506254#37506254", "title": "Standard queue package for Haskell?", "body": "<p>Data.Queue was added to <code>base</code> in ghc 6.4 [1] and deprecated in ghc 6.6 [2] when it was subsumed by <code>Data.Sequence</code>.</p>\n\n<p>From the 6.6 release notes:</p>\n\n<blockquote>\n  <p>There is a new module Data.Sequence for finite sequences. The Data.Queue module is now deprecated in favour of this faster, more featureful replacement.</p>\n</blockquote>\n\n<p>[1] <a href=\"https://downloads.haskell.org/~ghc/6.4/docs/html/users_guide/release-6-4.html\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/6.4/docs/html/users_guide/release-6-4.html</a></p>\n\n<p>[2] <a href=\"https://downloads.haskell.org/~ghc/6.6/docs/html/users_guide/release-6-6.html\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/6.6/docs/html/users_guide/release-6-6.html</a></p>\n"}], "owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 2, "closed_date": 1464535483, "accepted_answer_id": 37506254, "answer_count": 2, "score": 2, "last_activity_date": 1464499569, "creation_date": 1464490674, "last_edit_date": 1464499569, "question_id": 37505725, "link": "https://stackoverflow.com/questions/37505725/standard-queue-package-for-haskell", "closed_reason": "Not suitable for this site", "title": "Standard queue package for Haskell?", "body": "<p>Is there a standard queue implementation for Haskell? I see several reasonably mature priority queue implementations, but no simple queues. Data.Sequence seems OK, but I assume we could get better performance with a more restricted datatype. Further, restricting the operations (ie, not a deque) can prevent bugs from dequeuing from the wrong end.</p>\n\n<p>Edit:</p>\n\n<p>To clarify, I was hoping for a mature Haskell implementation, preferably in Haskell Platform or Hackage. </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 518, "user_id": 945764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f1f5f8984d14b5d1c6d4f048ce1581e?s=128&d=identicon&r=PG", "display_name": "lucian", "link": "https://stackoverflow.com/users/945764/lucian"}, "edited": false, "score": 0, "creation_date": 1464488221, "post_id": 37505437, "comment_id": 62505920, "body": "both of you and Epsilonhalbe have great answers, thanks!"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 5, "last_activity_date": 1464487573, "last_edit_date": 1464487573, "creation_date": 1464487005, "answer_id": 37505437, "question_id": 37505372, "link": "https://stackoverflow.com/questions/37505372/how-to-downcast-type-in-case-of-in-haskell/37505437#37505437", "title": "how to downcast type in &quot;case of&quot; in haskell", "body": "<p>It looks like you are confusing the data type <code>A</code> with the constructor <code>A</code> of the data type <code>C</code>. The <code>c</code> that you pass into function <code>f</code> has type <code>C</code> which means it is a value constructed with either of the constructors <code>A</code> or <code>B</code>.  However, values of type <code>A</code> and type <code>B</code> are constructed with the constructors <code>One</code> and <code>Two</code> respectively.</p>\n\n<p>Perhaps what you want is something like this instead:</p>\n\n<pre><code>data A = One Int\ndata B = Two Int\n\nfa :: A -&gt; Int\nfa a = 1\n\ndata C = A A | B B\n\nf :: C -&gt; Int\nf c = case c of\n          A a -&gt; fa a\n          _ -&gt; 0\n</code></pre>\n\n<p>The key difference is that the <code>C</code> type now consists of either a value constructed with the <code>A</code> constructor that contains a value of type <code>A</code> or a value constructed with the <code>B</code> constructor that contains a value of type <code>B</code>. Of course, you should probably name your constructors something less confusing like <code>data C = TheA A | TheB B</code>.  Alternatively, you could use the <code>Either</code> type which is isomorphic to your <code>C</code>: <code>type C = Either A B</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 2, "last_activity_date": 1464487687, "creation_date": 1464487687, "answer_id": 37505494, "question_id": 37505372, "link": "https://stackoverflow.com/questions/37505372/how-to-downcast-type-in-case-of-in-haskell/37505494#37505494", "title": "how to downcast type in &quot;case of&quot; in haskell", "body": "<p>The problem at hand is not with coercion, but you do mix up the difference between a type - and its instances.</p>\n\n<p><code>Type</code> is the thing on the left hand side of the <code>=</code> in a <code>data</code>-declaration and all of them live in one name-space. (To indicate the difference I will denote them with bold face).</p>\n\n<ul>\n<li><strong><code>A</code></strong></li>\n<li><strong><code>B</code></strong></li>\n<li><strong><code>C</code></strong></li>\n</ul>\n\n<p><code>Values</code> or instances of a type are written on the right hand side of the <code>data</code>-declaration</p>\n\n<ul>\n<li><code>One Int</code></li>\n<li><code>Two Int</code></li>\n<li><code>A</code> and <code>B</code></li>\n</ul>\n\n<p>Now you try to call a function <code>fa :: <strong>A</strong> -> Int</code> on something of type <strong><code>C</code></strong> thus resulting in the error.</p>\n\n<p>To fix this there are more solutions</p>\n\n<p>you can write conversion functions that convert <code>A</code> to <code>One 1</code> and call <code>fa</code> on the transformed value - or change the types like <a href=\"https://stackoverflow.com/users/2297560/user2297560\">@user2297560</a> showed <a href=\"https://stackoverflow.com/a/37505437/630160\">already</a></p>\n\n<pre><code>data A = One Int\ndata B = Two Int\ndata C = A | B\n\nfa :: A -&gt; Int\nfa a = 1\n\nconvA :: C -&gt; A\nconvA A = One 1\nconvA _ = error \"not A\"\n\nf :: C -&gt; Int\nf c = case c of\n          A -&gt; fa (convA A)\n          _ -&gt; 0\n</code></pre>\n\n<p>or simply by doing it in the definition of <code>f</code></p>\n\n<pre><code>f :: C -&gt; Int\nf A = fa (One 1)\nf _ = 0\n</code></pre>\n"}], "owner": {"reputation": 518, "user_id": 945764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f1f5f8984d14b5d1c6d4f048ce1581e?s=128&d=identicon&r=PG", "display_name": "lucian", "link": "https://stackoverflow.com/users/945764/lucian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 37505494, "answer_count": 2, "score": 0, "last_activity_date": 1464487687, "creation_date": 1464486080, "question_id": 37505372, "link": "https://stackoverflow.com/questions/37505372/how-to-downcast-type-in-case-of-in-haskell", "title": "how to downcast type in &quot;case of&quot; in haskell", "body": "<p>I wanted to downcast the type(from C to A), but failed in the sample:</p>\n\n<pre><code>data A = One Int\ndata B = Two Int\nfa::A -&gt; Int\nfa a = 1\n\ndata C = A | B\n\nf::C -&gt; Int\nf c = case c of\n          A -&gt; fa (c::A)\n          _ -&gt; 0\n</code></pre>\n\n<p>the error message is :</p>\n\n<pre><code>Couldn't match expected type \u2018A\u2019 with actual type \u2018C\u2019\nIn the first argument of \u2018fa\u2019, namely \u2018(c :: A)\u2019\nIn the expression: fa (c :: A)\n</code></pre>\n\n<p>How can I do it properly? Much thanks!</p>\n"}, {"tags": ["list", "haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 5089983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/185d75f8cd264c969acebf8cfeb65ad7?s=128&d=identicon&r=PG&f=1", "display_name": "hsforever", "link": "https://stackoverflow.com/users/5089983/hsforever"}, "edited": false, "score": 0, "creation_date": 1464485393, "post_id": 37505226, "comment_id": 62505553, "body": "Thank you! Please feel free to add the idiomatic solution as it&#39;s not my homework - I&#39;m self-learning it. So it will help me even more if you could post the idiomatic solution."}, {"owner": {"reputation": 1075, "user_id": 10358967, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4V7Q6XvDivU/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaOvV19bWhnj7CaSL2naSzQty7e0sg/mo/photo.jpg?sz=128", "display_name": "Oto-obong Eshiett", "link": "https://stackoverflow.com/users/10358967/oto-obong-eshiett"}, "edited": false, "score": 0, "creation_date": 1585211957, "post_id": 37505226, "comment_id": 107683587, "body": "You caesar algorithm helped me solve an issue, but please can you explain how it works, I can&#39;t really grasp it, thank you"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1585615521, "post_id": 37505226, "comment_id": 107818027, "body": "I don&#39;t think explaining the caesar cipher is fitting for this question. So I won&#39;t add it here. But feel free to copy the sections you don&#39;t understand and ask a new question. By explaining which portions of the code you don&#39;t understand and which you do - you&#39;ll get a much better learning experience."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1464486613, "last_edit_date": 1464486613, "creation_date": 1464484325, "answer_id": 37505226, "question_id": 37505073, "link": "https://stackoverflow.com/questions/37505073/haskell-caesar-cipher-non-exhaustive-pattern/37505226#37505226", "title": "Haskell - caesar cipher - non exhaustive pattern", "body": "<p>I think the error lies in the following line(s)</p>\n\n<pre><code> where go nn (x:xs)\n          | (x:xs) == [] = []\n</code></pre>\n\n<p>the match <code>(x:xs) == []</code> will never be true as the first one is always a list with a (real) head and a (maybe empty) tail</p>\n\n<p>you can fix this by </p>\n\n<pre><code> where go _ [] = []\n       go nn (x:xs) | ((+nn) $ ord x) &gt; 122 = (chr $ (+nn) 96) : go nn xs\n                    | ((+nn) $ ord x) &gt;= 97 &amp;&amp; ((+nn) $ ord x) &lt;=122 = (chr.(+nn) $ ord x) : go nn xs\n                    | otherwise = error \"input error\"\n</code></pre>\n\n<p>Though this style is highly unreadable - i recommend changing from <code>(+nn) $ ord x</code> to something like <code>ord x + nn</code> as well as <code>chr (ord x + nn)</code>.</p>\n\n<p>Moreover you are not accounting for</p>\n\n<ul>\n<li>whitespace in your transformation as well as</li>\n<li>interpunction,</li>\n<li>negative numbers and</li>\n<li>upper case letters!</li>\n</ul>\n\n<p>As this seems to be a homework/exercise I won't give the idiomatic solution, but only a hint that there is a function called <a href=\"http://hoogle.haskell.org/?hoogle=map\" rel=\"nofollow\"><code>map</code></a> that you should definitely look up and use!</p>\n\n<p>Also your function <code>go</code> is not necessary you can write the algorithm completely without it:</p>\n\n<pre><code>caesar :: Int -&gt; String -&gt; String\ncaesar _ [] = []\ncaesar n (x:xs)\n          | 122 &lt; ord x + n                    = chr (96 + n)    : caesar n xs\n          | 97 &lt;= ord x + n &amp;&amp; ord x + n &lt;=122 = chr (ord x + n) : caesar n xs\n          | otherwise = error \"input error\"\n</code></pre>\n\n<p>Please test with \"Alea, iacta esto!\" and not \"foo\" - you'll find more bugs with the first test case.</p>\n\n<h2>Update:</h2>\n\n<p>the idiomatic way to solve a problem, where you have a list and transform every element with a function is using <code>map</code>, so for example</p>\n\n<pre><code>&gt; map (\\x -&gt; x + 3) [1..3]\n[4,5,6]\n</code></pre>\n\n<p>thus you need a function</p>\n\n<pre><code>cipher :: Int -&gt; Char -&gt; Char\ncipher n x\n    | isDigit x = chr $ ord '0' + (ord x - ord '0' + n'') `mod` 10\n    | isLower x = chr $ ord 'a' + (ord x - ord 'a' + n' ) `mod` 26\n    | isUpper x = chr $ ord 'A' + (ord x - ord 'A' + n' ) `mod` 26\n    | otherwise = x\n    where n'  = n `mod` 26 -- for the letters\n          n'' = n `mod` 10 -- for the digits\n\ncaesar :: Int -&gt; String -&gt; String\ncaesar n xs = map (cipher n) xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464484647, "post_id": 37505236, "comment_id": 62505434, "body": "you know that this will throw an error for any input - you just converted the &quot;non exhaustive pattern&quot; error with &quot;shouldn&#39;t happen&quot;. Which at least should be <code>go n xx = error $ &quot;Unexpected input: go called with parameters n = &quot;++show n++&quot; and xx = &quot; ++ show xx</code> to find out why the error occurred."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464485013, "post_id": 37505236, "comment_id": 62505497, "body": "@epsilonhalbe yep. poster asked about non-exhaustive error, not how to make the program correct ;) I fixed the error message to make it less confusing for posterity, though."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1464485059, "last_edit_date": 1464485059, "creation_date": 1464484388, "answer_id": 37505236, "question_id": 37505073, "link": "https://stackoverflow.com/questions/37505073/haskell-caesar-cipher-non-exhaustive-pattern/37505236#37505236", "title": "Haskell - caesar cipher - non exhaustive pattern", "body": "<p>Your <code>go</code> function doesn't have a case that matches an empty list.  The <code>otherwise</code> guard doesn't help here since the pattern <code>go nn (x:xs)</code> doesn't match to begin with.</p>\n\n<p>Try this:</p>\n\n<pre><code>caesar :: Int -&gt; [Char] -&gt; [Char]\ncaesar n [] = []\ncaesar n st = go n st\n   where go nn (x:xs)\n          | (x:xs) == [] = []\n          | ((+nn) $ ord x) &gt; 122 = (chr $ (+nn) 96) : go nn xs\n          | ((+nn) $ ord x) &gt;= 97 &amp;&amp; ((+nn) $ ord x) &lt;=122 = (chr.(+nn) $ ord x) : go nn xs\n          | otherwise = error \"input error\"\n         go _ _ = error \"fix me\"\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 5089983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/185d75f8cd264c969acebf8cfeb65ad7?s=128&d=identicon&r=PG&f=1", "display_name": "hsforever", "link": "https://stackoverflow.com/users/5089983/hsforever"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "accepted_answer_id": 37505226, "answer_count": 2, "score": 0, "last_activity_date": 1464486613, "creation_date": 1464482531, "question_id": 37505073, "link": "https://stackoverflow.com/questions/37505073/haskell-caesar-cipher-non-exhaustive-pattern", "title": "Haskell - caesar cipher - non exhaustive pattern", "body": "<p>Execution of the following code results in non-exhaustive pattern error. I can't figure it out why. Please help. Thanks.</p>\n\n<pre><code>module Cipher where\n\nimport Data.Char\n\ncaesar :: Int -&gt; [Char] -&gt; [Char]\ncaesar n [] = []\ncaesar n st = go n st\n   where go nn (x:xs)\n          | (x:xs) == [] = []\n          | ((+nn) $ ord x) &gt; 122 = (chr $ (+nn) 96) : go nn xs\n          | ((+nn) $ ord x) &gt;= 97 &amp;&amp; ((+nn) $ ord x) &lt;=122 = (chr.(+nn) $ ord x) : go nn xs\n          | otherwise = error \"input error\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1464482118, "post_id": 37505024, "comment_id": 62505098, "body": "<code>&lt;=</code> is just the <code>less than or equal</code> operator/function, I suppose?"}, {"owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1464482546, "post_id": 37505024, "comment_id": 62505159, "body": "In Haskell I know that =&gt; differs from -&gt; but I&#39;m not sure how.  I&#39;ve seen both &lt;= and =&gt; used in notation"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1464483320, "last_edit_date": 1464483320, "creation_date": 1464483002, "answer_id": 37505116, "question_id": 37505024, "link": "https://stackoverflow.com/questions/37505024/the-meaning-of-vs-in-haskell/37505116#37505116", "title": "The meaning of &lt;= vs. =&gt; in Haskell", "body": "<p>They're completely different things.</p>\n\n<ul>\n<li><p><code>=&gt;</code> (as well as <code>-&gt;</code>) is built-in type-level syntax. It's used for denoting constraints. For instance, the signature</p>\n\n<pre><code>abs :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>tells you that the <code>abs</code> function takes a value of type <code>a</code> and yields a value of the same type, under the condition <code>a</code> is a number type (i.e., fulfills the <code>Num a</code> constraint). Such a constraint will usually be<sup>&dagger;</sup> a <em>type class</em>; in this case</p>\n\n<pre><code>class Num a where\n  ...\n</code></pre>\n\n<p>You can read the <code>=&gt;</code> arrow as a sort-of function mapping, too: <code>abs</code> first takes the information of <em>what specific sort of number <code>a</code> is</em> as an &ldquo;implicit argument&rdquo;, then one such number as an explicit argument, and only then gives the result.</p></li>\n<li><p><code>&lt;=</code> is not syntax, it's just an infix operator that's defined in the standard library. Specifically it's the less-than operator, which mathematicians write <strong>&leq;</strong>.<br>You can look up such operators on <a href=\"http://hayoo.fh-wedel.de/?query=%3C%3D\" rel=\"nofollow\">Hayoo</a>, no need to ask questions about them.</p></li>\n</ul>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Strictly speaking, a class is not a constraint but a &ldquo;constraint constructor&rdquo;, i.e. a type-level function whose <em>result</em> is of kind <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Exts.html#t:Constraint\" rel=\"nofollow\"><code>Constraint</code></a>. For instance, <code>Num :: * -&gt; Constraint</code> applied to e.g. <code>Int :: *</code> means that <code>Num Int</code> is a constraint. (Those are not type signatures but <em>kind signatures</em>, i.e. &ldquo;types of type-level things&rdquo;.)</sub></p>\n"}, {"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 6, "last_activity_date": 1464483790, "last_edit_date": 1464483790, "creation_date": 1464483380, "answer_id": 37505146, "question_id": 37505024, "link": "https://stackoverflow.com/questions/37505024/the-meaning-of-vs-in-haskell/37505146#37505146", "title": "The meaning of &lt;= vs. =&gt; in Haskell", "body": "<p>The two are completely unrelated; they just seem related because of ASCII. It makes more sense if you look at their Unicode equivalents:</p>\n\n<ul>\n<li><p><code>=&gt;</code> is an arrow: <code>\u21d2</code>. It's used to specify constraints in type signatures:</p>\n\n<pre><code>Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>The <code>Eq a =&gt;</code> in the above signature means that the type variable <code>a</code> can be any type that is an instance of the <code>Eq</code> class. That is, any type that either has <code>deriving (Eq)</code> or an explicit instance like <code>instance Eq Type where ...</code>.</p>\n\n<p>In function signatures, <code>-&gt;</code> specifies a normal argument while <code>=&gt;</code> specifies <em>constraints</em> in the signature. In the above example (<code>Eq a =&gt; a -&gt; a -&gt; Bool</code>), the function takes two arguments of type <code>a</code> and gives us a <code>Bool</code>. The <code>Eq a =&gt;</code> part is not an explicit argument to the function; it just tells us that <code>a</code> must be part of <code>Eq</code> (that is, it must be comparable with <code>==</code>).</p></li>\n<li><p><code>&lt;=</code> is <strong>less than or equal to</strong>. That is, it's <code>\u2264</code>, <em>not</em> <code>\u21d0</code>. It's a normal function in the standard library that's part of the <code>Ord</code> class:</p>\n\n<pre><code>\u03bb&gt; :t (&lt;=)\n(&lt;=) :: Ord a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>You can use it in a normal expression:</p>\n\n<pre><code>\u03bb&gt; 10 &lt;= 12\nTrue\n</code></pre></li>\n</ul>\n\n<p>The only reason they seem symmetrical is because the ASCII approximation of <code>\u2264</code> and <code>\u21d0</code> are the same, but that's just a limitation in notation. Otherwise, they're completely unrelated.</p>\n\n<p>You can use the unambiguous Unicode symbols in your code. The <code>UnicodeSyntax</code> extension enables using <code>\u21d2</code> for <code>=&gt;</code> and the <code>base-unicode-symbols</code> package contains Unicode versions of standard library functions including <code>\u2264</code> for <code>&lt;=</code>.</p>\n"}], "owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 37505146, "answer_count": 2, "score": 0, "last_activity_date": 1464483790, "creation_date": 1464481958, "question_id": 37505024, "link": "https://stackoverflow.com/questions/37505024/the-meaning-of-vs-in-haskell", "title": "The meaning of &lt;= vs. =&gt; in Haskell", "body": "<p>I'm relatively new to Haskell; what does the <code>&lt;=</code> syntax represent and what is the difference between <code>&lt;=</code> and <code>=&gt;</code>?  Examples of both would be helpful.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1464462462, "creation_date": 1464462462, "answer_id": 37502861, "question_id": 37502649, "link": "https://stackoverflow.com/questions/37502649/how-define-an-average-function-when-dealing-with-monads/37502861#37502861", "title": "How define an average function when dealing with monads", "body": "<p>The problem lies on <code>/</code> wanting a number like <code>Double</code>, not a number inside a monad like <code>m Double</code>.</p>\n\n<p>A naive fix could be</p>\n\n<pre><code>avg :: PrimMonad m =&gt; m [Double] -&gt; m Double\navg xs = (/) &lt;$&gt; sum' xs &lt;*&gt; (fromIntegral &lt;$&gt; len' xs)\n</code></pre>\n\n<p>but this is unsatisfactory, since it will run the monadic action <code>xs</code> twice.</p>\n\n<p>I'd rather use something like</p>\n\n<pre><code>avg :: PrimMonad m =&gt; m [Double] -&gt; m Double\navg xs = (\\ys -&gt; sum ys / fromIntegral (length ys)) &lt;$&gt; xs\n</code></pre>\n\n<p>I would also avoid naming <code>xs</code> a monadic action, since <code>xs</code> can easily be taken for a plain list. This is however a matter of personal preference.</p>\n\n<p>Even better, I'd define a non-monadic average first:</p>\n\n<pre><code>avg :: [Double] -&gt; Double\navg xs = sum xs / fromIntegral (length xs)\n\navgM :: PrimMonad m =&gt; m [Double] -&gt; m Double\navgM = fmap avg\n</code></pre>\n\n<p>Since <code>avgM</code> is so short, I would probably omit its definition, and directly call <code>fmap avg</code> where needed.</p>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1464462499, "creation_date": 1464462499, "answer_id": 37502868, "question_id": 37502649, "link": "https://stackoverflow.com/questions/37502649/how-define-an-average-function-when-dealing-with-monads/37502868#37502868", "title": "How define an average function when dealing with monads", "body": "<p>the error you are facing is twofold</p>\n\n<ol>\n<li>you try to divide two monadic values</li>\n<li>you are using <code>fromIntegral</code> on a monadic value.</li>\n</ol>\n\n<p>now to the solving part - easiest would be to use <code>do</code> notation to circumvent the whole problem</p>\n\n<p>for simplicity's sake I copied an avg function from <a href=\"https://stackoverflow.com/questions/21997609/getting-average-of-calculated-list-haskell\">getting-average-of-calculated-list-haskell</a></p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nimport Data.List\n\navg :: (Integral a, Fractional b) =&gt; [a] -&gt; b\navg xs = g $ foldl' c (0,0) xs\n where\n   c (!a,!n) x = (a+x,n+1)\n   g (a,n) = fromIntegral a / fromIntegral n\n\nmonAvg :: (Monad m, Integral a, Fractional b) =&gt; m [a] -&gt; m b\nmonAvg mxs = do xs &lt;- mx\n                return $ avg xs\n</code></pre>\n\n<p>but this is maybe not the thing you want it is too specialised.</p>\n\n<p>The minimal thing we need is only <code>Functor</code> - so <code>fmap avg</code> solves your problem as well.</p>\n\n<p>if you want to keep your functions - then you need <code>&lt;*&gt;</code> from <code>Applicatives</code> to combine.</p>\n\n<pre><code>appAvg :: Applicative m =&gt; m [Double] -&gt; m Double\nappAvg xs = (/) &lt;$&gt; sum xs &lt;*&gt; (fromIntegral &lt;$&gt; len' xs)\n</code></pre>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 37502861, "answer_count": 2, "score": 0, "last_activity_date": 1464462499, "creation_date": 1464461063, "question_id": 37502649, "link": "https://stackoverflow.com/questions/37502649/how-define-an-average-function-when-dealing-with-monads", "title": "How define an average function when dealing with monads", "body": "<p>I have list of type</p>\n\n<pre><code>PrimMonad m =&gt; m [Double]\n</code></pre>\n\n<p>To calculate the average I defined the following functions:</p>\n\n<pre><code>sum' :: PrimMonad m =&gt; m [Double] -&gt; m Double\nsum' xs = (sum &lt;$&gt; xs)\n\nlen' :: PrimMonad m =&gt; m [Double] -&gt; m Int\nlen' xs = length &lt;$&gt; xs\n\navg :: PrimMonad m =&gt; m [Double] -&gt; m Double\navg xs = (sum' xs) / (fromIntegral $ len' xs)\n</code></pre>\n\n<p>However, I am having problems with the <code>avg</code> function. I get the following errors:</p>\n\n<pre><code>    Could not deduce (Fractional (m Double)) arising from a use of \u2018/\u2019 \u2026                                                                                           \n        from the context (PrimMonad m)                                                                                                                                                                          \n          bound by the type signature for                                                                                                                                                                       \n                     avg :: PrimMonad m =&gt; m [Double] -&gt; m Double                                                                                                                                               \n          at                                                                                                                               \n        In the expression: (sum' xs) / (fromIntegral $ len' xs)                                                                                                                                                 \n        In an equation for \u2018avg\u2019:                                                                                                                                                                               \n            avg xs = (sum' xs) / (fromIntegral $ len' xs)                                                                                                                                                       \n  Could not deduce (Integral (m Int)) \u2026                                                                                                                          \n          arising from a use of \u2018fromIntegral\u2019                                                                                                                                                                  \n        from the context (PrimMonad m)                                                                                                                                                                          \n          bound by the type signature for                                                                                                                                                                       \n                     avg :: PrimMonad m =&gt; m [Double] -&gt; m Double                                                                                                                                               \n          at                                                                                                                               \n        In the expression: fromIntegral                                                                                                                                                                         \n        In the second argument of \u2018(/)\u2019, namely \u2018(fromIntegral $ len' xs)\u2019                                                                                                                                      \n        In the expression: (sum' xs) / (fromIntegral $ len' xs)                                                                                                                                                 \n    Compilation failed.\n</code></pre>\n\n<p>What do I need to do get this simple function defined?</p>\n"}, {"tags": ["haskell", "dynamic-programming", "lazy-evaluation", "memoization", "continuations"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1464457662, "post_id": 37501967, "comment_id": 62498996, "body": "I would expect <code>go i j</code> to access <code>cs</code> in some way, so that we really use dynamic programming. I can&#39;t see where this is happens.. does it?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464457798, "post_id": 37501967, "comment_id": 62499041, "body": "In <code>[l (i-1) x + j | x &lt;- [0..j-1]]</code>. If you look a few lines down you should see <code>l i j = fromMaybe maxi (M.lookup (i,j) cs)</code>. I know this code is not particularly great. Given how I&#39;ve structured it, it might be worth switching <code>Vector.Unboxed</code>, but I want to figure out to make this one work."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464458046, "post_id": 37501967, "comment_id": 62499116, "body": "@Carsten It is included in the online judge if that is what you are asking, but I think IntMap requires Ints as keys. I am using (Int, Int) tuples as keys in this example."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464458494, "post_id": 37501967, "comment_id": 62499277, "body": "my bad sorry - indeed that is the case"}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464510173, "post_id": 37502736, "comment_id": 62509613, "body": "This is good answer, but it opens more questions for me. I can understand what it is trying to do - two passes are a good idea, and I can deal that the above is no longer a DP formulation and that it sidesteps my question, but I am not sure that I can deal/w programs written in continuation passing style. I had to stare at the above code quite a bit and I still do not understand it completely. I did study CPS for a bit when I first found out about it, but never internalized it. Is this idiomatic Haskell? CPS is not used at all in F#, but I see there are a bunch of tutorials for it in Haskell.."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464525510, "post_id": 37502736, "comment_id": 62513755, "body": "@MarkoGrdinic this is the first time i heard of cps, and i do not know how much of this is counted as cps; but i would say this style of code is typical Haskell code style i have seen"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464527553, "post_id": 37502736, "comment_id": 62514362, "body": "Using a lambda to accumulate a result is something I haven&#39;t seen outside some of CPS tutorials that I&#39;ve read. Though now that I am drilling more into this, I can see your point. I am having a bit of trouble visualizing what the two parameters to f in <code>f candy&#39; score</code> are supposed to be doing. Are they supposed to take the role of <code>c</code> and <code>s</code> on the subsequent iteration?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464528738, "post_id": 37502736, "comment_id": 62514737, "body": "It previously occurred to me to use tuples inside fold in order to store intermediate computations, but not function arguments. If this is not CPS, then what is it? Are there any resources to read up on this?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 1, "creation_date": 1464794419, "post_id": 37502736, "comment_id": 62632784, "body": "@MarkoGrdinic I do not know if this counts as CPS, but it is a very common pattern which occurs when you need to pass along extra arguments while folding. Here I need 2 extra arguments. see my answers to <a href=\"http://stackoverflow.com/q/36707461/625914\">this question</a> for another example with only 1 extra argument or <a href=\"http://stackoverflow.com/q/35392658/625914\">this other hacker rank problem</a> where I need 3 extra arguments!"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 1, "creation_date": 1464801765, "post_id": 37502736, "comment_id": 62637370, "body": "I&#39;ll admit, using the lambdas to short circuit the fold is not something that would have occurred to me. I was going to say that tuples were all one would need until I saw that link. Your solutions are quite something to behold. But why not use tuples for algorithms that do not require early exit. Also wouldn&#39;t building up all those lambdas incur a performance overhead? How well does the GHC optimize them?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1464802785, "post_id": 37502736, "comment_id": 62637962, "body": "@MarkoGrdinic I am not sure how ghc optimizes them, but see the comments/discussion bellow <a href=\"http://stackoverflow.com/a/36106345/625914\">this answer</a> and <a href=\"http://stackoverflow.com/a/36291398/625914\">this one</a>. Both are performing much faster than the alternative methods. As I said, this pattern is very common and I use it a lot."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1464465020, "last_edit_date": 1464465020, "creation_date": 1464461608, "answer_id": 37502736, "question_id": 37501967, "link": "https://stackoverflow.com/questions/37501967/how-to-make-fromlist-lazy-in-this-dynamic-programming-example/37502736#37502736", "title": "How to make fromList lazy in this dynamic programming example?", "body": "<p>The problem you have linked to has a clean Haskell solution using <em>right folds</em>. In other words, you can skip worrying about lazy fromList, memoization and all that by just using a more functional style.</p>\n\n<p>The idea is that you maintain a list of <code>(candy, score)</code> pairs where <code>candy</code> is zero initially for all (<code>repeat 0</code> in bellow code). Then you go once from left to right and bump up <code>candy</code> values if this item score exceeds the one before:</p>\n\n<pre><code>-- s is the score and c is the candy of the guy before\n-- if s &lt; score then this guy should get at least c + 1 candies\ncandy' = max candy $ if s &lt; score then c + 1 else 1\n</code></pre>\n\n<p>and do the same thing again going in the other direction:</p>\n\n<pre><code>import Control.Monad (replicateM)\nimport Control.Applicative ((&lt;$&gt;))\n\nsolve :: [Int] -&gt; Int\nsolve = sum . map fst . loop . reverse . loop . zip  (repeat 0)\n    where\n    loop cs = foldr go (\\_ _ -&gt; []) cs 0 0\n    go (candy, score) f c s = (candy', score): f candy' score\n        where candy' = max candy $ if s &lt; score then c + 1 else 1\n\nmain = do\n    n &lt;- read &lt;$&gt; getLine\n    solve . fmap read &lt;$&gt; replicateM n getLine &gt;&gt;= print\n</code></pre>\n\n<p>This performs linearly, and passes all tests on HackerRank.</p>\n"}, {"tags": [], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "is_accepted": false, "score": 0, "last_activity_date": 1464588941, "creation_date": 1464588941, "answer_id": 37518784, "question_id": 37501967, "link": "https://stackoverflow.com/questions/37501967/how-to-make-fromlist-lazy-in-this-dynamic-programming-example/37518784#37518784", "title": "How to make fromList lazy in this dynamic programming example?", "body": "<p>Well, regarding my own question at the top, probably the way to make the thing lazy would be to just use a list (a list of lists or a vector of lists.) The reason why the above is impossible to make lazy is because the Map type is lazy in the values and strict in the keys.</p>\n\n<p>More importantly, my analysis that the fold is doing essentially two passes was completely right. The way those built up continuations are being executed in reverse completely tripped me up at first, but I've adapted @behzad.nouri code to work with only a single loop.</p>\n\n<pre><code>module Main where\n  import Control.Monad (replicateM)\n  import Control.Applicative ((&lt;$&gt;))\n  import Debug.Trace\n\n\n  solve :: [Int] -&gt; Int\n  solve = sum . loop\n      where\n      loop :: [Int] -&gt; [Int]\n      loop = (\\(_,_,x) -&gt; x 0 0) . foldr go (0, 0, \\_ _ -&gt; [])\n      go :: Int -&gt; (Int, Int, Int -&gt; Int -&gt; [Int]) -&gt; (Int, Int, Int -&gt; Int -&gt; [Int])\n      go score (candyP,scoreP,f) =\n        let\n          candyP' = if scoreP &lt; score then candyP + 1 else 1\n          in\n            (candyP', score,\n              \\candyN scoreN -&gt;\n                let\n                  candy' = max candyP' $ if scoreN &lt; score then candyN + 1 else 1\n                  in candy' : f candy' score) -- This part could be replaced with a sum\n\n  main = do\n      n &lt;- read &lt;$&gt; getLine\n      solve . fmap read &lt;$&gt; replicateM n getLine &gt;&gt;= print\n</code></pre>\n\n<p>The above passes all tests, no problem, and that is convincing proof that the above analysis is correct.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 37502736, "answer_count": 2, "score": 1, "last_activity_date": 1464588941, "creation_date": 1464456950, "last_edit_date": 1464540955, "question_id": 37501967, "link": "https://stackoverflow.com/questions/37501967/how-to-make-fromlist-lazy-in-this-dynamic-programming-example", "title": "How to make fromList lazy in this dynamic programming example?", "body": "<pre><code>module Main where\n  import System.Random\n  import Data.Foldable\n  import Control.Monad\n  import qualified Data.Map as M\n  import qualified Data.Vector as V\n  import Debug.Trace\n  import Data.Maybe\n  import Data.Ord\n\n  -- Represents the maximal integer. maxBound is no good because it overflows.\n  -- Ideally should be something like a billion.\n  maxi = 1000\n\n  candies :: V.Vector Int -&gt; Int --M.Map (Int, Int) Int\n  candies ar = ff [l (V.length ar - 1) x | x &lt;- [0..maxi]]\n    where\n      go :: Int -&gt; Int -&gt; Int\n      go _ 0 = maxi\n      go 0 j = j\n      go i j =\n        case compare (ar V.! (i-1)) (ar V.! i) of\n          LT -&gt; ff [l (i-1) x + j | x &lt;- [0..j-1]]\n          GT -&gt; ff [l (i-1) x + j | x &lt;- [j+1..maxi]]\n          EQ -&gt; ff [l (i-1) x + j | x &lt;- [0..maxi]]\n      l :: Int -&gt; Int -&gt; Int\n      l i j = fromMaybe maxi (M.lookup (i,j) cs)\n      ff l = --minimum l\n        case l of\n          l:ls -&gt; if l &lt; maxi then l else ff ls\n          [] -&gt; maxi\n\n      -- I need to make this lazy somehow.\n      cs :: M.Map (Int, Int) Int\n      cs = M.fromList [((i,j), go i j) | i &lt;- [0..V.length ar - 1], j &lt;- [0..maxi]]\n\n\n  main :: IO ()\n  main = do\n    --ar &lt;- fmap (V.fromList . map read . tail . words) getContents\n    g &lt;- fmap (V.fromList . take 5 . randomRs (1,50)) getStdGen\n    print $ candies g\n</code></pre>\n\n<p>The above code is for the <a href=\"https://www.hackerrank.com/challenges/candies\" rel=\"nofollow\">HackerRank Candies</a> challenge. I think the code is correct in essence even though it gives me runtime errors on submission. HackerRank does not say what those errors are, but most likely it is because I ran out allotted memory.</p>\n\n<p>To make the above work, I need to rewrite the above so the fromList gets lazily evaluated or something to that effect. I like the above form and rewriting the functions so they pass along the map as a parameter is something I would very much like to avoid.</p>\n\n<p>I know Haskell has various memoization libraries on Hackage, but the online judge does not allow their use.</p>\n\n<p>I might have coded myself into a hole due to Haskell's purity.</p>\n\n<p>Edit:</p>\n\n<p>I did some experimenting in order to figure out how those folds and lambda's work. I think this is definitely linked to continuation passing after all, as the continuations are being built up along the fold. To show what I mean, I'll demonstrate it with a simple program.</p>\n\n<pre><code>module Main where\n  trans :: [Int] -&gt; [Int]\n  trans m =\n    foldr go (\\_ -&gt; []) m 0 where\n      go x f y = (x + y) : f x\n\n  main = do\n    s &lt;- return $ trans [1,2,3]\n    print s\n</code></pre>\n\n<p>One thing that surprised me was that when I inserted a print, it got executed in a reverse manner, from left to right, which made me think at first that I misunderstood how foldr works. That turned out to not be the case.</p>\n\n<p>What the above does is print out <code>[1,3,5]</code>.</p>\n\n<p>Here is the explanation how it executes. Trying to print out <code>f x</code> in the above will not be informative and will cause it to just all around the place.</p>\n\n<p>It starts with something like this. The fold obviously executes 3 <code>go</code> functions.</p>\n\n<pre><code>go x f y = (x + y) : f x\ngo x f y = (x + y) : f x\ngo x f y = (x + y) : f x\n</code></pre>\n\n<p>The above is not quite true. One has to keep in mind that all <code>f</code>s are separate.</p>\n\n<pre><code>go x f'' y = (x + y) : f'' x\ngo x f' y = (x + y) : f' x\ngo x f y = (x + y) : f x\n</code></pre>\n\n<p>Also for clarity one it should also be instructive to separate out the lambdas.</p>\n\n<pre><code>go x f'' = \\y -&gt; (x + y) : f'' x\ngo x f' = \\y -&gt; (x + y) : f' x\ngo x f = \\y -&gt; (x + y) : f x\n</code></pre>\n\n<p>Now the fold starts from the top. The topmost statement gets evaluated as...</p>\n\n<pre><code>go 3 (\\_ -&gt; []) = \\y -&gt; (3 + y) : (\\_ -&gt; []) 3\n</code></pre>\n\n<p>This reduces to:</p>\n\n<pre><code>go 3 (\\_ -&gt; []) = (\\y -&gt; (3 + y) : [])\n</code></pre>\n\n<p>The result is the unfinished lambda above. Now the fold evaluates the second statement.</p>\n\n<pre><code>go 2 (\\y -&gt; (3 + y) : []) = \\y -&gt; (2 + y) : (\\y -&gt; (3 + y) : []) 2\n</code></pre>\n\n<p>This reduces to:</p>\n\n<pre><code>go 2 (\\y -&gt; (3 + y) : []) = (\\y -&gt; (2 + y) : 5 : [])\n</code></pre>\n\n<p>The the fold goes to the last statement.</p>\n\n<pre><code>go 1 (\\y -&gt; (2 + y) : 5 : []) = \\y -&gt; (1 + y) : (\\y -&gt; (2 + y) : 5 : []) 1\n</code></pre>\n\n<p>This reduces to:</p>\n\n<pre><code>go 1 (\\y -&gt; (2 + y) : 5 : []) = \\y -&gt; (1 + y) : 3 : 5 : []\n</code></pre>\n\n<p>The the 0 outside the fold gets applied and the final lambda gets reduced to</p>\n\n<pre><code>1 : 3 : 5 : []\n</code></pre>\n\n<p>This is just the start of it. The case gets more interesting when <code>f x</code> is replaced with <code>f y</code>.</p>\n\n<p>Here is a similar program to the previous.</p>\n\n<pre><code>module Main where\n  trans :: [Int] -&gt; [Int]\n  trans m =\n    foldr go (\\_ -&gt; []) m 1 where\n      go x f y = (x + y) : f (2*y+1)\n\n  main = do\n    s &lt;- return $ trans [1,2,3]\n    print s\n</code></pre>\n\n<p>Let me once again go from top to bottom.</p>\n\n<pre><code>go x f'' = \\y -&gt; (x + y) : f'' (2*y+1)\ngo x f' = \\y -&gt; (x + y) : f' (2*y+1)\ngo x f = \\y -&gt; (x + y) : f (2*y+1)\n</code></pre>\n\n<p>The top statement.</p>\n\n<pre><code>go 3 (\\_ -&gt; []) = \\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)\n</code></pre>\n\n<p>The middle statement:</p>\n\n<pre><code>go 2 (\\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)) = \\y -&gt; (2 + y) : (\\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)) (2*y+1)\n</code></pre>\n\n<p>The last statement:</p>\n\n<pre><code>go 1 (\\y -&gt; (2 + y) : (\\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)) (2*y+1)) = \\y -&gt; (1 + y) : (\\y -&gt; (2 + y) : (\\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)) (2*y+1)) 2*y+1\n</code></pre>\n\n<p>Notice how the expressions build up because <code>y</code>s cannot be applied. Only after the 0 gets inserted can the whole expression be evaluated.</p>\n\n<pre><code>(\\y -&gt; (1 + y) : (\\y -&gt; (2 + y) : (\\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)) (2*y+1)) 2*y+1) 1\n\n2 : (\\y -&gt; (2 + y) : (\\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)) (2*y+1)) 3\n\n2 : 5 : (\\y -&gt; (3 + y) : (\\_ -&gt; []) (2*y+1)) 7\n\n2 : 5 : 10 : (\\_ -&gt; []) 15\n\n2 : 5 : 10 : []\n</code></pre>\n\n<p>There is a buildup due to the order of evaluation.</p>\n\n<p>Edit: So...</p>\n\n<pre><code>go (candy, score) f c s = (candy', score): f candy' score\n    where candy' = max candy $ if s &lt; score then c + 1 else 1\n</code></pre>\n\n<p>The above in fact does 3 passes across the list in each iteration.</p>\n\n<p>First foldr has to travel to back of the list before it can begin. Then as <code>candi'</code> depends on <code>s</code> and <code>c</code> variables which cannot be applied immediately this necessitates building up the continuations as in that last example.</p>\n\n<p>Then when the two <code>0</code> <code>0</code> are fed into at the end of the fold, the whole thing only then gets evaluated.</p>\n\n<p>It is a bit hard to reason about.</p>\n"}, {"tags": ["haskell", "memory", "cpu"], "answers": [{"comments": [{"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1464475641, "post_id": 37502007, "comment_id": 62503891, "body": "I do <b>not want</b> to do a <b>profiling</b>. I want to check memory usage in <b>program itself</b>, for program command. GHC.Stats is GHC specific, so it is <b>not portable</b>. Again I say, &#39;I try to search but i can&#39;t find what i want&#39;."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1464482684, "post_id": 37502007, "comment_id": 62505181, "body": "Well GHC is the most mature and feature complete compiler, but you are right that GHC is but one implementation of haskell - if you want to get a readout of the current cpu/ram/disk this will be operating system specific I guess - but other than the answer I gave I have no knowledge of any libraries that would do that job"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 0, "last_activity_date": 1464457176, "creation_date": 1464457176, "answer_id": 37502007, "question_id": 37501875, "link": "https://stackoverflow.com/questions/37501875/checking-memory-and-cpu-usage-in-haskell-program-itself/37502007#37502007", "title": "Checking memory and CPU usage in Haskell program itself", "body": "<p>Your first query phrase is already providing me with lots of links I would recommend to follow: </p>\n\n<ul>\n<li><a href=\"https://book.realworldhaskell.org/read/profiling-and-optimization.html\" rel=\"nofollow\">Real World Haskell: Profiling and Optimization</a> is a detailed introduction how to get run-time info of your application.</li>\n<li>next @donstewart's answer <a href=\"https://stackoverflow.com/questions/3276240/tools-for-analyzing-performance-of-a-haskell-program/3276557#3276557\">StackOverflow: tools-for-analyzing-performance-of-a-haskell-program</a></li>\n</ul>\n\n<p>For more information in a long time application - take a look at <a href=\"https://hackage.haskell.org/package/ekg\" rel=\"nofollow\">hackage: ekg</a>, <a href=\"https://ocharles.org.uk/blog/posts/2012-12-11-24-day-of-hackage-ekg.html\" rel=\"nofollow\">blog ocharles: about ekg</a>, and an <a href=\"http://blog.johantibell.com/2011/12/remotely-monitor-any-haskell.html\" rel=\"nofollow\">article</a> of the author of ekg.</p>\n\n<p>If you want to implement something yourself, the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Stats.html\" rel=\"nofollow\"><code>GHC.Stats</code> API</a> would be a starting point</p>\n"}, {"comments": [{"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1464536777, "post_id": 37506601, "comment_id": 62517235, "body": "Thx for your new approach! I will check those packages!"}], "tags": [], "owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "is_accepted": true, "score": 3, "last_activity_date": 1464500496, "last_edit_date": 1495542760, "creation_date": 1464500496, "answer_id": 37506601, "question_id": 37501875, "link": "https://stackoverflow.com/questions/37501875/checking-memory-and-cpu-usage-in-haskell-program-itself/37506601#37506601", "title": "Checking memory and CPU usage in Haskell program itself", "body": "<p>What about using <a href=\"https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol\" rel=\"nofollow noreferrer\">SNMP</a> for that?</p>\n\n<p>SNMP is usually used to remotely monitor devices, but nothing prevents you from running a agent locally and querying it from (a thread in) your Haskell application. That way, CPU and memory usage information would be collected by a separate application (the SNMP agent) and your application would ask for it when it needs. In order to that, you could use one these Haskell packages: <a href=\"https://hackage.haskell.org/package/snmp\" rel=\"nofollow noreferrer\">snmp</a> or <a href=\"https://hackage.haskell.org/package/NetSNMP\" rel=\"nofollow noreferrer\">NetSNMP</a>.</p>\n\n<p>You'll probably be able to find a lot of useful information/tutorials/examples regarding process monitoring using SNMP in the Internet (if you are not familiar with it) and once you understood them, implementing what you need in Haskell using those packages should be straightforward. Also, I found this <a href=\"https://stackoverflow.com/questions/9996178/snmp-getting-information-from-a-process\">related question</a>.</p>\n"}], "owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "accepted_answer_id": 37506601, "answer_count": 2, "score": 3, "last_activity_date": 1464500496, "creation_date": 1464456291, "last_edit_date": 1464475448, "question_id": 37501875, "link": "https://stackoverflow.com/questions/37501875/checking-memory-and-cpu-usage-in-haskell-program-itself", "title": "Checking memory and CPU usage in Haskell program itself", "body": "<p>I try to make some DB in Haskell, and I want to find a way to <strong>check memory and CPU usage in the program.</strong></p>\n\n<p>I try to search using keywords like <em>\"haskell memory usage\"</em> or <em>\"haskell memory checking\"</em>, <em>\"haskell CPU usage\"</em>, ..., but there is no answer I want (Memory and CPU checking in haskell program <strong>itself</strong>). </p>\n\n<p>Is there portable way to get memory and CPU usage in <strong>itself</strong>, while the program is running?</p>\n\n<p>Please let me know.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1464451386, "creation_date": 1464451386, "answer_id": 37501140, "question_id": 37500852, "link": "https://stackoverflow.com/questions/37500852/understanding-system-zmq4-monadics-forall-in-signature/37501140#37501140", "title": "Understanding `System.ZMQ4.Monadic`&#39;s `forall` in Signature", "body": "<p>From the <a href=\"http://hackage.haskell.org/package/zeromq4-haskell-0.6.3/docs/System-ZMQ4-Monadic.html#t:ZMQ\" rel=\"nofollow\">ZQM docs</a>:</p>\n\n<blockquote>\n  <p>The ZMQ monad is modeled after ST and encapsulates a Context. It uses the uninstantiated type variable z to distinguish different invoctions of runZMQ and to prevent unintented use of Sockets outside their scope. Cf. the paper of John Launchbury and Simon Peyton Jones Lazy Functional State Threads.</p>\n</blockquote>\n\n<p>So the <code>z</code> parameter acts just like the <code>s</code> parameter in <code>ST s a</code>.</p>\n\n<p>One explanation of the ST monad from the Haskell Wiki:</p>\n\n<p><a href=\"https://wiki.haskell.org/Monad/ST\" rel=\"nofollow\">https://wiki.haskell.org/Monad/ST</a></p>\n"}, {"tags": [], "owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1464572301, "creation_date": 1464572301, "answer_id": 37516598, "question_id": 37500852, "link": "https://stackoverflow.com/questions/37500852/understanding-system-zmq4-monadics-forall-in-signature/37516598#37516598", "title": "Understanding `System.ZMQ4.Monadic`&#39;s `forall` in Signature", "body": "<p>ErikR's answer is a good one about <em>why</em> there is a <code>forall</code> but the<code>what</code> is a different matter.</p>\n\n<p>To take a simpler answer, take the type</p>\n\n<pre><code>f :: (a -&gt; a) -&gt; a\n</code></pre>\n\n<p>This function can be called on any function with the same input and output type. For example <code>f (*2) :: Int</code> is a well typed term.</p>\n\n<p>On the other hand</p>\n\n<pre><code>f :: (forall a. a -&gt; a) -&gt; Int\n</code></pre>\n\n<p>Requires that the input function be polymorphic in <code>a</code>. In other words, it requires that the input function be applicable to any type. Basically this means that it can only be <code>id</code> or something that returns an error, because otherwise it can't create a value of an arbitrary type.</p>\n\n<p>This limiting behavior is used by systems to enforce certain invariants, for example the <code>ST</code> ErikR mentions uses it to make sure that internal state can't be accessed externally.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1464572301, "creation_date": 1464449523, "question_id": 37500852, "link": "https://stackoverflow.com/questions/37500852/understanding-system-zmq4-monadics-forall-in-signature", "title": "Understanding `System.ZMQ4.Monadic`&#39;s `forall` in Signature", "body": "<p>Looking at <code>runZMQ</code> from <a href=\"https://hackage.haskell.org/package/zeromq4-haskell-0.5/docs/System-ZMQ4-Monadic.html\" rel=\"nofollow\">System.ZMQ4.Monadic</a>:</p>\n\n<p>What is the meaning of this type signature?</p>\n\n<pre><code>\u03bb: :t runZMQ \nrunZMQ\n  :: transformers-0.4.2.0:Control.Monad.IO.Class.MonadIO m =&gt;\n     (forall z. ZMQ z a) -&gt; m a\n</code></pre>\n\n<p>In particular, I don't understand the <code>forall</code>.</p>\n"}, {"tags": ["haskell", "build", "module", "hierarchy", "cabal"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464443482, "post_id": 37499658, "comment_id": 62494567, "body": "Usually you only list top level dirs like <code>src&#47;</code> in <code>hs-source-dirs</code>, then you will have to rename the module A =&gt; A.A and module B.C =&gt; B.C.C, also a module A would have to be placed in <code>src&#47;A.hs</code> see for example <a href=\"https://hackage.haskell.org/package/aeson-0.11.2.0/src/\" rel=\"nofollow noreferrer\">aeson</a> as an example for a valid module structure. The error I think is because it looks for a folder B in the directory B/C/ and then a source file <code>C.hs</code> in there which is not there."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464444558, "post_id": 37499658, "comment_id": 62494897, "body": "for a module X.Y.Z, GHC looks for the file X/Y/Z.hs in the hs-source-dirs."}], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1464447373, "post_id": 37499984, "comment_id": 62495767, "body": "I am not sure I am ready to use <code>stack</code>. It feels completely unnatural when isolating a part of source in <code>A</code> from the rest of the code and then splitting it up into main part and some subparts to place the main part in <code>A&#47;</code> and the subparts in say <code>A&#47;A&#47;</code>. I would really want to have a module that is self contained in one directory. Splitting into more trees is not what I am looking for, the logical separation is not that strict."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1464453912, "post_id": 37499984, "comment_id": 62497829, "body": "From your comment, it sort of sounds like what you really want to do is just put modules in different places in the source tree.  To do that, don&#39;t chance the hs-source-dirs (just use <code>src</code> alone), then put the modules in each subdir, and name them <code>&lt;path&gt;.&lt;name&gt;</code> (ie- create <code>B&#47;C.hs</code>, then call it <code>B.C</code>).  When you create a source dir, everything recursively inside of it is considered for compiling."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1464454146, "post_id": 37499984, "comment_id": 62497893, "body": "well what I wanted and what I think makes sense: modules are in correspondence to directories (not path/filename.hs). but I already adopted the way you described. Thanks"}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1464444568, "creation_date": 1464444568, "answer_id": 37499984, "question_id": 37499658, "link": "https://stackoverflow.com/questions/37499658/flexibility-of-the-hierarchy-of-module-sources-allowed-in-cabal-project/37499984#37499984", "title": "Flexibility of the hierarchy of module sources allowed in cabal project", "body": "<p>The reason for the error is that module B.C should be defined in file <code>B/C.hs</code>, not <code>B/C/C.hs</code> (that would be module <code>B.C.C</code>).  This error would have appeared if you had only one source dir with one source file, it is not because of the extra parts you have put in.</p>\n\n<p>Also, the dir that appears in the <code>hs-source-dirs</code> directive should only be the root of the dir tree, so it is doubtful that you need all of the parts that you put in, for instance, <code>src/B/C</code> (which would treat <code>src/B/C</code> as another root....  meaning you can define top level modules in  that dir.  If you are actually doing that, I would consider this a mistake).</p>\n\n<p>What you probably want to do is define multiple top level source dirs, like this</p>\n\n<pre><code>A_src/A.hs\nB_src/B/C.hs\n\nhs-source-dirs: A_src, B_src\n</code></pre>\n\n<p>Even better, I would suggest you use stack, which allows you to separate different modules completely with their own source dirs, called <code>src</code>, and independent .cabal files, allowing for richer dependencies between each module.</p>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 37499984, "answer_count": 1, "score": 0, "last_activity_date": 1464444568, "creation_date": 1464442430, "question_id": 37499658, "link": "https://stackoverflow.com/questions/37499658/flexibility-of-the-hierarchy-of-module-sources-allowed-in-cabal-project", "title": "Flexibility of the hierarchy of module sources allowed in cabal project", "body": "<p>I have a project with source tree:</p>\n\n<pre><code>src/\nsrc/A/\nsrc/A/A.hs\nsrc/B/\nsrc/B/C/\nsrc/B/C/C.hs\n...\n</code></pre>\n\n<p>The two haskell files divide source code into modules:</p>\n\n<pre><code>-- File A/A.hs\nmodule A where\n...\n</code></pre>\n\n<p>and</p>\n\n<pre><code>-- File B/C/C.hs\nmodule B.C where\n...\n</code></pre>\n\n<p>The cabal file contains:</p>\n\n<pre><code>other-modules: A, B.C, ...\nhs-source-dirs: src/, src/A/, src/B/, src/B/C/, ...\n</code></pre>\n\n<p>But while the module <code>A</code> can be easily found, cabal complains about <code>B.C</code>:</p>\n\n<pre><code>cabal: can't find source for B/C in ...\n</code></pre>\n\n<p>I see no rational explanation why placing a file defining module <code>A</code> under <code>A/A.hs</code> is OK but placing <code>B.C</code> under <code>B/C/C.hs</code> isn't. Is there a workaround other than placing <code>C.hs</code> directly under <code>B</code> (I would like to maintain some separation of sources)?</p>\n"}, {"tags": ["haskell", "aeson", "haskell-pipes"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464442338, "post_id": 37498848, "comment_id": 62494169, "body": "I assume you want to stream the image directly to disk?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464442697, "post_id": 37498848, "comment_id": 62494293, "body": "@ErikR, yep, that should be fine for example purposes. Disk location depends on id."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464444244, "post_id": 37498848, "comment_id": 62494793, "body": "I don&#39;t think <code>decoded</code> can stream directly to disk. Each parsed top-level JSON value is parsed in it&#39;s entirety before its given to you."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464446878, "post_id": 37498848, "comment_id": 62495601, "body": "@ErikR, yep, <code>decoded</code> signature shows the same thing. Would a manual parser work instead of <code>decoded</code>? Like make a stream out of bytestring and pass it directly to <code>pipes</code> after manually parsing <code>id</code> in ordered JSON array? Not sure if <code>aeson</code> allows for that."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464448329, "post_id": 37498848, "comment_id": 62496035, "body": "You would have to write your own JSON parser. It would be easier to implement a simple line-oriented protocol with two commands: <code>Id ...</code> and <code>chunk ...</code>. When you see an <code>id ...</code> line it begins a new file. When you see a <code>chunk ...</code> line it means to write that (base64) encoded chunk to the current file. Perhaps an empty <code>chunk</code> line means end of file."}], "answers": [{"tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": true, "score": 1, "last_activity_date": 1464496650, "creation_date": 1464496650, "answer_id": 37506228, "question_id": 37498848, "link": "https://stackoverflow.com/questions/37498848/decoding-json-stream-where-some-values-are-needed-before-others/37506228#37506228", "title": "Decoding JSON stream where some values are needed before others", "body": "<p>I believe you won\u2019t be able to reuse the <code>pipes-aeson</code> library because it doesn't provide a way to stream over a nested field of a decoded JSON record nor is there any support for cursor-like navigation of the struct.  That means that you will need to parse the skeleton of the JSON record by hand.</p>\n\n<p>Also, some work needs to be done to wrap the <code>base64-bytestring</code> in a <code>pipes</code>-like API with this type:</p>\n\n<pre><code>-- Convert a base64-encoded stream to a raw byte stream\ndecodeBase64\n    :: Producer ByteString m r\n    -- ^ Base64-encoded bytes\n    -&gt; Producer ByteString m (Either SomeException (Producer ByteString m r)) \n    -- ^ Raw bytes\n</code></pre>\n\n<p>Note that the result returns a <code>Producer</code> for the remainder of the byte string (i.e. everything after the base64-encoded bytes) if the decoding completes successfully.  This lets you resume parsing where the image bytes end.</p>\n\n<p>However, assuming that you have a <code>decodeBase64</code> function, then the rough outline of how the code would work is that you\u2019d have three parts:</p>\n\n<ul>\n<li>Parse the prefix of the record before the image bytes using a <code>binary</code> parser adapted to <code>pipes</code></li>\n<li>Use the <code>decodeBase64</code> function to stream the decoded image bytes</li>\n<li>Parse the suffix of the record after the image bytes also using a <code>binary</code> parser adapted to <code>pipes</code></li>\n</ul>\n\n<p>In other words, the types and implementation would look roughly like this:</p>\n\n<pre><code>-- This would match the \"{ 'id' : 'foo', 'image' : '\" prefix of the JSON record\nskipPrefix :: Data.Binary.Get ()\n\nskipPrefix\u2019 :: Monad m =&gt; Producer ByteString m r -&gt; m (Either DecodingError (Producer ByteString m r))\nskipPrefix\u2019 = execStateT (Pipes.Binary.decodeGet skipPrefix)\n\n\u2014 This would match the \"' }\" suffix of the JSON record\nskipSuffix :: Data.Binary.Get ()\n\nskipSuffix\u2019 :: Monad m =&gt; Producer ByteString m r -&gt; m (Either DecodingError (Producer ByteString m r))\nskipSuffix\u2019 = execStateT (Pipes.Binary.decodeGet skipSuffix)\n\nstreamImage\n    ::  Monad m\n    =&gt;  Producer ByteString m r\n    -&gt;  Producer ByteString m (Either SomeException (Producer ByteString m r))\nstreamImage p0 = do\n    e0 &lt;- lift (skipPrefix\u2019 p0)\n    case e0 of\n        Left exc -&gt; return (Left (toException exc))\n        Right p1 -&gt; do\n            e1 &lt;- decodeBase64 p1\n            case e1 of\n                Left exc -&gt; return (Left exc)\n                Right p2 -&gt; do\n                    e2 &lt;- lift (skipSuffix\u2019 p2)\n                    case e2 of\n                        Left exc -&gt; return (Left (toException exc))\n                        Right p3 -&gt; return (Right p3)\n</code></pre>\n\n<p>In other words, <code>streamImage</code> would take a <code>Producer</code> as input that begins at the first character of the JSON record, and it will stream the decoded image bytes extracted from that record.  If decoding succeeds, then it will return the remainder of the byte stream immediately after the JSON record.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 37506228, "answer_count": 1, "score": 1, "last_activity_date": 1464496650, "creation_date": 1464437608, "last_edit_date": 1464443448, "question_id": 37498848, "link": "https://stackoverflow.com/questions/37498848/decoding-json-stream-where-some-values-are-needed-before-others", "title": "Decoding JSON stream where some values are needed before others", "body": "<p>Let us say we have a JSON object like this (with base64 encoded bytestring):</p>\n\n<pre><code>TaggedImage = TaggedImage {  id :: Text, image :: ByteString }\n</code></pre>\n\n<p>Now, we want to receive <code>image</code> from a source, and store it in a location using the information in <code>id</code> tag. So, what that means is that <code>id</code> must be parsed ahead of time (to determine location for the image) while <code>image</code> is parsed in streaming fashion. Is this straight-forward to do?</p>\n\n<p>I am planning to use <code>pipes-aeson</code>, <code>aws</code> (for <code>S3</code> storage) and <code>pipes</code> to do streaming decoding from <code>Websocket</code> producer with a <code>S3</code> bucket as the consumer (which can't be created until we parse the <code>id</code> to determine the location of <code>S3</code> bucket). Looking at <a href=\"https://s3.amazonaws.com/haddock.stackage.org/lts-6.0/pipes-aeson-0.4.1.6/Pipes-Aeson.html\" rel=\"nofollow\"><code>decoded</code></a> method, I can't figure out if I could indeed do what I asked above. This is my first attempt at streaming in JSON and pipes. So, help will be very much appreciated.</p>\n\n<p>A simple example with read and write to the filesystem will also do as stand-in for <code>Websocket producer</code> and <code>S3 consumer</code>.</p>\n\n<p><strong>Addendum</strong></p>\n\n<p>Since JSON key-value pairs are  unordered according to <a href=\"http://www.rfc-editor.org/rfc/rfc7159.txt\" rel=\"nofollow\">RFC</a> while the arrays are ordered, <code>image</code> data might come before <code>id</code>, it seems, for the data type I defined above. So, it might also help to change it to JSON array (a tuple in Haskell which <code>aeson</code> TH derivation seems to convert to ordered array). Please feel free to change the data type definition if need be, to impose ordering for decoding. For example, the data type might be changed to:</p>\n\n<pre><code>TaggedImage = TaggedImage (Text,ByteString)\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464435815, "post_id": 37498478, "comment_id": 62492044, "body": "what is the error? My best guess: it&#39;s not defaulting to a generic function"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464435966, "post_id": 37498478, "comment_id": 62492095, "body": "btw: where is the point - the last snippet seems better anyway (why switch on <code>text</code> again?)"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464445325, "post_id": 37498478, "comment_id": 62495133, "body": "It is just a simplified version of the real case I have. My concern is why having the values in a variable cause it not to compile."}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464445277, "post_id": 37500013, "comment_id": 62495116, "body": "But what is the reason moving it to top level will solve the errors?"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464445903, "post_id": 37500013, "comment_id": 62495296, "body": "It&#39;s a type error. I&#39;ll provide the exact one once in front of the computer :)"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464447809, "post_id": 37500013, "comment_id": 62495874, "body": "Your edit indeed makes sense. Is there a way to set the type of direction so it would become polymorphic?"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464453846, "post_id": 37500013, "comment_id": 62497809, "body": "Thanks @ErikR. Thanks to your suggestion, it seems that in fact just by letting direction get an argument (e.g. <code>direction t = ...</code>) solved the problem."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1464448101, "last_edit_date": 1495535339, "creation_date": 1464444764, "answer_id": 37500013, "question_id": 37498478, "link": "https://stackoverflow.com/questions/37498478/assigning-asc-desc-to-variable-later-causes-a-compiler-error/37500013#37500013", "title": "Assigning Asc/ Desc to variable later causes a compiler error", "body": "<p>Make <code>direction</code> a function and move it to the top-level:</p>\n\n<pre><code>direction text = if text == \"id\" then Desc else Asc\n</code></pre>\n\n<p>See the <code>updown</code> function in this SO answer: </p>\n\n<p><a href=\"https://stackoverflow.com/a/37380039/866915\">https://stackoverflow.com/a/37380039/866915</a></p>\n\n<p><strong>Update</strong></p>\n\n<p>In order for <code>direction EventId</code> to make sense, <code>direction</code> has to have type:</p>\n\n<pre><code>direction :: EntityField Event Int\n</code></pre>\n\n<p>In order for <code>direction EventTitle</code> to make sense it has to have type:</p>\n\n<pre><code>direction :: EntityField Event String\n</code></pre>\n\n<p>So if <code>direction</code> is defined in a where clause like this</p>\n\n<pre><code>where direction = if ... then Asc else Desc\n</code></pre>\n\n<p>it can't satisfy both type constraints. However, if you make it a function:</p>\n\n<pre><code>direction t = if t == \"id\" then Asc else Desc\n</code></pre>\n\n<p>then it is polymorphic. That means that <code>direction ...</code> can have different types at different call sites.</p>\n\n<p><strong>Update</strong></p>\n\n<p>To use the original code, try adding the type signature:</p>\n\n<pre><code>where\n  direction :: EntityField r t -&gt; SelectOpt r\n  direction = if text == \"id\" then Desc else Asc\n</code></pre>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 37500013, "answer_count": 1, "score": -2, "last_activity_date": 1464448101, "creation_date": 1464435296, "question_id": 37498478, "link": "https://stackoverflow.com/questions/37498478/assigning-asc-desc-to-variable-later-causes-a-compiler-error", "title": "Assigning Asc/ Desc to variable later causes a compiler error", "body": "<p>I am getting a compiler error when I try to have something like:</p>\n\n<pre><code>getOrder :: Text -&gt; SelectOpt Event\ngetOrder text =\n    case text of\n        \"id\"    -&gt; direction EventId\n        \"title\" -&gt; direction EventTitle\n\n    where direction = if text == \"id\" then Desc else Asc\n</code></pre>\n\n<p>If I change this line, it will work:</p>\n\n<pre><code>where direction = Asc\n</code></pre>\n\n<p>Same if I change the <code>case</code> - it will work:</p>\n\n<pre><code>case text of\n    \"id\"    -&gt; Desc EventId\n    \"title\" -&gt; Asc EventTitle\n</code></pre>\n\n<p>So my question is why assigning <code>Asc</code> and <code>Desc</code> cause the compiler error?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 5382, "user_id": 2565842, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0ede033b05bc5fedbc4836a17aebce77?s=128&d=identicon&r=PG", "display_name": "Anne", "link": "https://stackoverflow.com/users/2565842/anne"}, "edited": false, "score": 0, "creation_date": 1464446729, "post_id": 37500140, "comment_id": 62495551, "body": "Thanks! Here&#39;s a thing that&#39;s confusing me: I started with a pure function that needs a list of random numbers as input (essentially doing a <code>sum $ map someFunction randomNumbers</code>). However, the random numbers generated above are monadic (is that a word?) and it seems that I can&#39;t just stick them inside my pure function. What is the proper way to resolve this in Haskell?"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 5382, "user_id": 2565842, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0ede033b05bc5fedbc4836a17aebce77?s=128&d=identicon&r=PG", "display_name": "Anne", "link": "https://stackoverflow.com/users/2565842/anne"}, "edited": false, "score": 0, "creation_date": 1464447492, "post_id": 37500140, "comment_id": 62495804, "body": "I don&#39;t think there is one &quot;proper&quot; way to do it. I&#39;ve outlined my personal preference above. You are probably more interested in the &quot;most expedient&quot; way to solve your immediate problem. In that case try either <code>fmap sum $ map someFunction randomNumbers</code>, or use <code>mkStdGen 123456</code> insteand of <code>newStdGen</code>. (123456 can be any arbitrary integer)"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 1, "last_activity_date": 1464445484, "creation_date": 1464445484, "answer_id": 37500140, "question_id": 37497135, "link": "https://stackoverflow.com/questions/37497135/haskell-random-numbers/37500140#37500140", "title": "Haskell random numbers", "body": "<p>First off, you probably don't want to use <code>newStdGen</code>. The biggest problem is that you'll get a different seed every time you run your program, so no results will be reproducible. In my opinion, <code>mkStdGen</code> is a better choice as it requires you to give it a seed.  This means you will get the same sequence of (pseudo)random numbers every time. If you want a different sequence, just change the seed.</p>\n\n<p>The second problem with <code>newStdGen</code> is that since it's impure, you'll end up in the IO monad which can be a bit inconvenient.</p>\n\n<pre><code>sample :: Int -&gt; IO [Int]\nsample n = do\n  gen &lt;- newStdGen\n  return $ take n $ randoms gen\n</code></pre>\n\n<p>You can use do-notation to 'extract' the values and then sum them:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  xs &lt;- sample 10\n  s = sum xs\n  print s\n</code></pre>\n\n<p>Or you could 'fmap' the function over the result (but notice that at some point you will probably need to extract the value):</p>\n\n<pre><code>main :: IO ()\nmain = do\n  s &lt;- fmap sum $ sample 10\n  print s\n</code></pre>\n\n<p>The <code>fmap</code> function is a generalized version of <code>map</code>. Just like <code>map</code> applies a function to the values inside a list, <code>fmap</code> can apply a function to values inside <code>IO</code>.</p>\n\n<p>Another problem with this <code>sample</code> function is that if we call it again, it starts with a fresh seed instead of continuing the previous (pseudo)random sequence. Again, this make reproducing results impossible. In order to fix this problem, we need to pass in the seed and return a new seed. Unfortunately, <code>randoms</code> does not return the next seed for us, so we'll have to write this from scratch using <code>random</code>.</p>\n\n<pre><code>sample :: Int -&gt; StdGen -&gt; ([Int],StdGen)\nsample n seed1 = case n of\n  0 -&gt; ([],seed1)\n  k -&gt; let (rs,seed2) = sample (k-1) seed1\n           (r, seed3) = random seed2\n        in ((r:rs),seed3)\n</code></pre>\n\n<p>Our main function is now</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let seed1 = mkStdGen 123456\n      (xs,seed2) = sample 10 seed1\n      s = sum xs\n      (ys,seed3) = sample 10 seed2\n      t = sum ys\n  print s\n  print t\n</code></pre>\n\n<p>I know this seems like an awful lot of work just to to use random numbers, but the advantages are worth it. We can generate all of our randomness with a single seed which guarantees that the results can be reproduced.</p>\n\n<p>Of course, this being Haskell, we can take advantage of Monads to get rid of all the manual threading of the seed values. This is a slightly more advanced method, but well worth learning since monads are ubiquitous in Haskell code.</p>\n\n<p>We need these imports:</p>\n\n<pre><code>import System.Random\nimport Control.Monad\nimport Control.Applicative\n</code></pre>\n\n<p>Then we'll create a newtype which represents the action of turning a seed into a value and the next seed.</p>\n\n<pre><code>newtype Rand a = Rand { runRand :: StdGen -&gt; (a,StdGen) }\n</code></pre>\n\n<p>We need <code>Functor</code> and <code>Applicative</code> instances or GHC will complain, but we can avoid implementing them for this example.</p>\n\n<pre><code>instance Functor Rand\ninstance Applicative Rand\n</code></pre>\n\n<p>And now for the Monad instance. This is where the magic happens. The <code>&gt;&gt;=</code> function (called bind) is the one place where we specify how to thread the seed value through the computation.</p>\n\n<pre><code>instance Monad Rand where\n  return x = Rand ( \\seed -&gt; (x,seed) )\n  ra &gt;&gt;= f = Rand ( \\s1 -&gt; let (a,s2) = runRand ra s1\n                           in  runRand (f a) s2 )\n\nnewRand :: Rand Int\nnewRand = Rand ( \\seed -&gt; random seed )\n</code></pre>\n\n<p>Now our <code>sample</code> function is extremely simple! We can take advantage of <code>replicateM</code> from <code>Control.Monad</code> which repeats a given action and accumulates the results in a list. All that funny business with the seed values is taken care of behind the scenes</p>\n\n<pre><code>sample :: Int -&gt; Rand [Int]\nsample n = replicateM n newRand\n\nmain :: IO ()\nmain = do\n  let seed1 = mkStdGen 124567\n      (xs,seed2) = runRand (sample 10) seed1\n      s = sum xs\n  print s\n</code></pre>\n\n<p>We can even stay inside the <code>Rand</code> monad if we need to generate random values multiple times.</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let seed1 = mkStdGen 124567\n      (xs,seed2) = flip runRand seed1 $ do\n        x &lt;- newRand\n        bs &lt;- sample 5\n        cs &lt;- sample 10\n        return $ x : (bs ++ cs)\n      s = sum xs\n  print s\n</code></pre>\n\n<p>I hope this helps!</p>\n"}], "owner": {"reputation": 5382, "user_id": 2565842, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0ede033b05bc5fedbc4836a17aebce77?s=128&d=identicon&r=PG", "display_name": "Anne", "link": "https://stackoverflow.com/users/2565842/anne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 740, "favorite_count": 1, "accepted_answer_id": 37500140, "answer_count": 1, "score": 1, "last_activity_date": 1464445484, "creation_date": 1464426160, "question_id": 37497135, "link": "https://stackoverflow.com/questions/37497135/haskell-random-numbers", "title": "Haskell random numbers", "body": "<p>I am trying to generate a sample of random numbers in Haskell</p>\n\n<pre><code>import System.Random\n\ngetSample n = take n $ randoms g where\n    g = newStdGen\n</code></pre>\n\n<p>but it seems I am not quite using <code>newStdGen</code> the right way. What am I missing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1464428505, "post_id": 37497097, "comment_id": 62490168, "body": "What did you try exactly? I&#39;m pretty sure the package is not broken..."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1464428926, "post_id": 37497097, "comment_id": 62490279, "body": "Maybe you ran <code>cabal install -fuse_sse2</code> as the hackage page seems to suggest? You need to specify the name of the package to install too of course."}, {"owner": {"reputation": 5382, "user_id": 2565842, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0ede033b05bc5fedbc4836a17aebce77?s=128&d=identicon&r=PG", "display_name": "Anne", "link": "https://stackoverflow.com/users/2565842/anne"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1464432116, "post_id": 37497097, "comment_id": 62491068, "body": "That&#39;s exactly what I did... <code>cabal install -fuse_sse2 mersenne-random</code> seems to do the trick. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": false, "score": 1, "last_activity_date": 1464428217, "creation_date": 1464428217, "answer_id": 37497423, "question_id": 37497097, "link": "https://stackoverflow.com/questions/37497097/haskell-use-a-mersenne-twister/37497423#37497423", "title": "Haskell: use a Mersenne twister", "body": "<p>Did you try the <a href=\"https://hackage.haskell.org/package/mersenne-random-pure64\" rel=\"nofollow\">mersenne-random-pure64</a> package? I was able to install it using cabal without any problems.</p>\n"}], "owner": {"reputation": 5382, "user_id": 2565842, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0ede033b05bc5fedbc4836a17aebce77?s=128&d=identicon&r=PG", "display_name": "Anne", "link": "https://stackoverflow.com/users/2565842/anne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464428217, "creation_date": 1464425880, "question_id": 37497097, "link": "https://stackoverflow.com/questions/37497097/haskell-use-a-mersenne-twister", "title": "Haskell: use a Mersenne twister", "body": "<p>I need normally distributed random numbers and was thinking Mersenne twister. I tried to install the \n<a href=\"https://hackage.haskell.org/package/mersenne-random\" rel=\"nofollow\">mersenne-random package</a>\nbut that didn't work (cabal failed to install due to missing .cabal file, so I suspect the package might be broken).</p>\n\n<p>Is there any other way to get a Mersenne twister in Haskell?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464471212, "post_id": 37495750, "comment_id": 62502881, "body": "Presumably you want <code>liftClause :: (Ord a, Ord b) =&gt; Iso&#39; a b -&gt; Iso&#39; (Conjunction a) (Disjunction b)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464418332, "creation_date": 1464418332, "answer_id": 37496116, "question_id": 37495750, "link": "https://stackoverflow.com/questions/37495750/confused-about-constructing-an-iso-from-another-iso/37496116#37496116", "title": "Confused about constructing an Iso from another Iso", "body": "<p><code>liftClause</code> can only operate on an <code>Iso' a a</code> - i.e. the two domains must have the same type - the type <code>a</code>.</p>\n\n<p>However <code>negatingClause</code> has type:</p>\n\n<pre><code>negatingClause :: Iso' (Conjunction Atom) (Disjunction Atom)\n</code></pre>\n\n<p>so you can't call <code>liftClause</code> on it since <code>Conjunction Atom</code> and <code>Disjunction Atom</code> are not the same.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1464418358, "creation_date": 1464418358, "answer_id": 37496123, "question_id": 37495750, "link": "https://stackoverflow.com/questions/37495750/confused-about-constructing-an-iso-from-another-iso/37496123#37496123", "title": "Confused about constructing an Iso from another Iso", "body": "<p>I haven't read this in enough detail to figure out what you <em>should</em> do, but <code>liftClause</code> takes an <code>Iso' a a</code>, i.e. an isomorphism from some type to itself. <code>negatingClause</code> is an <code>Iso' (Conjunction Atom) (Disjunction Atom)</code>; this definitely does not match <code>Iso' a a</code>. That's why the type error is complaining about being unable to match <code>Conjunction Atom</code> with <code>Disjunction Atom</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1464428733, "last_edit_date": 1464428733, "creation_date": 1464426466, "answer_id": 37497185, "question_id": 37495750, "link": "https://stackoverflow.com/questions/37495750/confused-about-constructing-an-iso-from-another-iso/37497185#37497185", "title": "Confused about constructing an Iso from another Iso", "body": "<p>(Answer also posted to <a href=\"http://lpaste.net/164691\" rel=\"nofollow\">http://lpaste.net/164691</a>)</p>\n\n<p>Here is a solution using TypeFamilies.</p>\n\n<p>First we'll simplify the set up:</p>\n\n<pre><code> {-# LANGUAGE TypeFamilies #-}\n\n import Control.Lens\n\n data Atom = Pos Int | Neg Int deriving (Show)\n newtype And a = And [a]       deriving (Show)\n newtype Or a  = Or [a]        deriving (Show)\n</code></pre>\n\n<p>The goal is create the following sequence of functions:</p>\n\n<pre><code>f0 :: Atom -&gt; Atom                      g0 :: Atom -&gt; Atom\nf1 :: And Atom -&gt; Or Atom               g1 :: Or Atom -&gt; And Atom\nf2 :: And (Or Atom) -&gt; Or (And Atom)    g1 :: Or (And Atom) -&gt; And (Or Atom)\n...\n</code></pre>\n\n<p>The f's and g's are inverses of each other. From these functions we can\ncreate the <code>Iso'</code> lenses:</p>\n\n<pre><code>iso0 = iso f0 g0  :: Iso' Atom Atom\niso1 = iso f1 g1  :: Iso' (And Atom) (Or Atom)\niso2 = iso f2 g2  :: Iso' (And (Or Atom)) (Or (And Atom))\n</code></pre>\n\n<p>We start by creating the type family <code>Negated</code> which acts as a type function.\n<code>Negated a</code> is the type that an f-function (or g-function) maps <code>a</code> to.</p>\n\n<pre><code> type family Negated a\n\n type instance Negated Atom = Atom\n type instance Negated (And a) = Or (Negated a)\n type instance Negated (Or a) = And (Negated a)\n</code></pre>\n\n<p>For instance, <code>Negated (And (Or Atom))</code> is the type <code>Or (And Atom))</code>.</p>\n\n<p>Next, we define a type class to perform the inverting operation:</p>\n\n<pre><code> class Invertible a where\n   invert :: a -&gt; Negated a\n\n instance Invertible Atom where\n   invert (Pos a) = Neg a\n   invert (Neg a) = Pos a\n\n instance Invertible a =&gt; Invertible (And a) where\n   invert (And clauses) =  Or (map invert clauses)\n\n instance Invertible a =&gt; Invertible (Or a) where\n   invert (Or clauses) = And (map invert clauses)\n</code></pre>\n\n<p>The definitions of the isomorphisms are now trivial:</p>\n\n<pre><code> iso0 :: Iso' Atom Atom\n iso0 = iso invert invert\n\n iso1  :: Iso' (And Atom) (Or Atom)\n iso1 = iso invert invert\n\n iso2 :: Iso' (And (Or Atom)) (Or (And Atom))\n iso2 = iso invert invert\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code> and1 = And [ Pos 1, Neg 2, Pos 3 ]\n or1 = Or [and1]\n\n test1 = invert and1                 -- Or [Neg 1,Pos 2,Neg 3]\n test2 = invert or1                  -- And [Or [Neg 1,Pos 2,Neg 3]]\n</code></pre>\n\n<p>Note that one limitation of this approach to modeling logical predicates is that all the Atoms must be at the same depth in the expression tree.\nE.g., you can't represent this tree (here <code>x</code>, <code>y</code> and <code>z</code> are Atoms):</p>\n\n<pre><code>             and\n            /   \\\n           x    or\n               /  \\\n              y    z\n</code></pre>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 37497185, "answer_count": 3, "score": 2, "last_activity_date": 1464428733, "creation_date": 1464415207, "question_id": 37495750, "link": "https://stackoverflow.com/questions/37495750/confused-about-constructing-an-iso-from-another-iso", "title": "Confused about constructing an Iso from another Iso", "body": "<p>I am currently writing some code to wrangle logical forms in a particular way. In pursuit of this, I have written the following code, which makes use of lenses:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}            \n{-# LANGUAGE Rank2Types #-} \n\nmodule Logic.Internal.Formula where \n\nimport BasicPrelude hiding (empty, negate)        \nimport qualified Data.Set as Set \nimport Control.Lens \n\ndata Atom = Pos { i :: Integer}                                                                                           \n          | Neg { i :: Integer}                                                                                           \n          deriving (Eq, Ord, Show, Read)                                                                                  \n\nnegatingAtom :: Iso' Atom Atom                                                                                            \nnegatingAtom = iso go go                                                                                                  \n  where go (Pos x) = Neg x                                                                                                \n        go (Neg x) = Pos x                                                                                                \n\nnewtype Conjunction a = Conjunction (Set a)                                                                               \n  deriving (Eq, Ord, Read, Show)                                                                                          \n\nconjuncts :: Conjunction a -&gt; [a]                                                                                         \nconjuncts (Conjunction x) = Set.toList x                                                                                  \n\nnewtype Disjunction a = Disjunction (Set a)                                                                               \n  deriving (Eq, Ord, Read, Show)\ndisjuncts :: Disjunction a -&gt; [a]                                                                                         \ndisjuncts (Disjunction x) = Set.toList x                                                                                  \n\nnegatingClause :: Iso' (Conjunction Atom) (Disjunction Atom)                                                              \nnegatingClause = liftClause negatingAtom                                                                                  \n\ntype CNF = Conjunction (Disjunction Atom)                                                                                 \ntype DNF = Disjunction (Conjunction Atom)\n\n-- Helper stuff                                                               \n\nliftClause :: (Ord a) =&gt; Iso' a a -&gt; Iso' (Conjunction a) (Disjunction a)                                                 \nliftClause x = let pipeline = Set.fromList . fmap (view x) in                                                             \n  iso (Disjunction . pipeline . conjuncts) (Conjunction . pipeline . disjuncts)\n</code></pre>\n\n<p>Then, I attempted to write the following in (what I believed was) the natural way:</p>\n\n<pre><code>type CNF = Conjunction (Disjunction Atom)                                                                                 \ntype DNF = Disjunction (Conjunction Atom)                                                                                 \n\nnegatingForm :: Iso' CNF DNF                                                                                              \nnegatingForm = liftClause negatingClause\n</code></pre>\n\n<p>However, the typechecker was <em>definitely</em> not happy with this, and I'm not at all sure why. The exact output is below:</p>\n\n<pre><code>Couldn't match type \u2018Conjunction Atom\u2019 with \u2018Disjunction Atom\u2019                                                            \nExpected type: p1 (Disjunction Atom) (f1 (Disjunction Atom))                                                              \n               -&gt; p1 (Disjunction Atom) (f1 (Disjunction Atom))                                                           \n  Actual type: p1 (Disjunction Atom) (f1 (Disjunction Atom))                                                              \n               -&gt; p1 (Conjunction Atom) (f1 (Conjunction Atom))                                                           \nIn the first argument of \u2018liftClause\u2019, namely \u2018negatingClause\u2019                                                            \nIn the expression: liftClause negatingClause\n</code></pre>\n\n<p>I'm a bit new to lenses, and would really like to understand what I misunderstood here, as well as how I would implement the required <code>Iso</code>.</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "is_accepted": false, "score": 1, "last_activity_date": 1464389357, "creation_date": 1464389357, "answer_id": 37493336, "question_id": 37493319, "link": "https://stackoverflow.com/questions/37493319/multiply-all-numbers-in-a-list-haskell/37493336#37493336", "title": "Multiply all numbers in a list - Haskell", "body": "<p>You can do so with a fold function:</p>\n\n<pre><code>foldr (*) 1 [2,3,4]\n</code></pre>\n\n<p>or...</p>\n\n<pre><code>foldr1 (*) [2,3,4]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 871, "user_id": 3422027, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/uVM5L.jpg?s=128&g=1", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/3422027/brian-moreno"}, "edited": false, "score": 0, "creation_date": 1464389624, "post_id": 37493352, "comment_id": 62482946, "body": "Thanks for the answer, can you explain what the foldr function does please?"}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "reply_to_user": {"reputation": 871, "user_id": 3422027, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/uVM5L.jpg?s=128&g=1", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/3422027/brian-moreno"}, "edited": false, "score": 0, "creation_date": 1464390501, "post_id": 37493352, "comment_id": 62483197, "body": "I have edited the answer to explain foldr function. Hope that it helps you."}], "tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": true, "score": 7, "last_activity_date": 1464390417, "last_edit_date": 1464390417, "creation_date": 1464389439, "answer_id": 37493352, "question_id": 37493319, "link": "https://stackoverflow.com/questions/37493319/multiply-all-numbers-in-a-list-haskell/37493352#37493352", "title": "Multiply all numbers in a list - Haskell", "body": "<p>There are a number of ways of doing it in Haskell. \nFor instance, you could use:</p>\n\n<pre><code>product [3,2,4]\n</code></pre>\n\n<p>or equivalently</p>\n\n<pre><code>foldr (*) 1 [3,2,4]\n</code></pre>\n\n<p>or recursively:</p>\n\n<pre><code>prod [] = 1\nprod (x : xs) = x * prod xs \n</code></pre>\n\n<p>Function <code>foldr</code> is the so called list <a href=\"https://en.wikipedia.org/wiki/Catamorphism\" rel=\"noreferrer\">catamorphism</a>. To understand foldr we need to first understand list constructors. In Haskell, <code>[3,2,4]</code> is a syntax sugar for <code>3 : 2 : 4 : []</code>, where <code>:</code> is list-cons constructor and <code>[]</code> is the empty list. Application <code>foldr f v</code> replaces every occurrence of <code>:</code> in a list by function <code>f</code> and the empty list for <code>v</code>. Its definition is as follows:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr f v [] = v                       -- equation 1\nfoldr f v (x:xs) = f x (foldr f v xs)  -- equation 2\n</code></pre>\n\n<p>As an example, consider <code>foldr (*) 1 [3,2,4]</code>:</p>\n\n<pre><code>foldr (*) 1 [3,2,4]     =\n3 * (foldr (*) 1 [2,4]) = (by equation 2 of foldr)\n3 * (2 * (foldr (*) 1 [4])) = (by equation 2 of foldr)\n3 * (2 * (4 * (foldr (*) 1 []))) = (by equation 2 of foldr)\n3 * (2 * (4 * 1)) = (by equation 1 of foldr)\n= 24\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 641, "user_id": 1094085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fMHca.jpg?s=128&g=1", "display_name": "FstTesla", "link": "https://stackoverflow.com/users/1094085/fsttesla"}, "is_accepted": false, "score": 1, "last_activity_date": 1464389774, "creation_date": 1464389774, "answer_id": 37493406, "question_id": 37493319, "link": "https://stackoverflow.com/questions/37493319/multiply-all-numbers-in-a-list-haskell/37493406#37493406", "title": "Multiply all numbers in a list - Haskell", "body": "<p>The <code>product</code> function is exactly what you're looking for.<br>\nIt has also the feature that <code>product []</code> equals 1, as you would expect mathematically speaking.</p>\n\n<p>If you look at its definition, you can see that <code>product</code> is indeed the <em>fold</em> of multiplication (with 1 as neutral element).</p>\n"}], "owner": {"reputation": 871, "user_id": 3422027, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/uVM5L.jpg?s=128&g=1", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/3422027/brian-moreno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8894, "favorite_count": 0, "closed_date": 1464395046, "accepted_answer_id": 37493352, "answer_count": 3, "score": -2, "last_activity_date": 1464390417, "creation_date": 1464389248, "question_id": 37493319, "link": "https://stackoverflow.com/questions/37493319/multiply-all-numbers-in-a-list-haskell", "closed_reason": "Duplicate", "title": "Multiply all numbers in a list - Haskell", "body": "<p>I'm really new to haskell and would like to multiply all numbers in an array. For example.:</p>\n\n<p>Array:</p>\n\n<pre><code>[3,2,4]   //3*2*4\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>24 \n</code></pre>\n\n<p>Thanks, any help is greatly appreciated. </p>\n"}, {"tags": ["linux", "haskell", "yesod"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1464461888, "post_id": 37492835, "comment_id": 62500288, "body": "Please follow the up-to-date instructions on the Yesod quickstart page, which will help you avoid a lot of pain points: <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow noreferrer\">yesodweb.com/page/quickstart</a>"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 23, "user_id": 5329441, "user_type": "registered", "profile_image": "https://graph.facebook.com/476501772511748/picture?type=large", "display_name": "shabat", "link": "https://stackoverflow.com/users/5329441/shabat"}, "edited": false, "score": 1, "creation_date": 1464397342, "post_id": 37492962, "comment_id": 62484505, "body": "Ok... sure <code>yesod-bin</code> installed correctly? What <i>is</i> in the <code>.cabal&#47;bin</code> folder?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1464387039, "creation_date": 1464387039, "answer_id": 37492962, "question_id": 37492835, "link": "https://stackoverflow.com/questions/37492835/yesod-init-command-not-found/37492962#37492962", "title": "Yesod init command not found", "body": "<p>Make sure you have</p>\n\n<pre><code># add local cabal binaries to command path\nexport PATH=~/.cabal/bin:${PATH}\n</code></pre>\n\n<p>in your <code>~/.bashrc</code> file. Alternatively, use <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/install_and_upgrade.md\" rel=\"nofollow\">stack</a> instead of cabal for this kind of stuff.</p>\n"}, {"tags": [], "owner": {"reputation": 23, "user_id": 5329441, "user_type": "registered", "profile_image": "https://graph.facebook.com/476501772511748/picture?type=large", "display_name": "shabat", "link": "https://stackoverflow.com/users/5329441/shabat"}, "is_accepted": false, "score": 0, "last_activity_date": 1464416108, "creation_date": 1464416108, "answer_id": 37495868, "question_id": 37492835, "link": "https://stackoverflow.com/questions/37492835/yesod-init-command-not-found/37495868#37495868", "title": "Yesod init command not found", "body": "<p>I solved it by installing <code>stack</code>  and <code>yesod-platform</code></p>\n"}], "owner": {"reputation": 23, "user_id": 5329441, "user_type": "registered", "profile_image": "https://graph.facebook.com/476501772511748/picture?type=large", "display_name": "shabat", "link": "https://stackoverflow.com/users/5329441/shabat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 37492962, "answer_count": 2, "score": 0, "last_activity_date": 1464416108, "creation_date": 1464386272, "question_id": 37492835, "link": "https://stackoverflow.com/questions/37492835/yesod-init-command-not-found", "title": "Yesod init command not found", "body": "<p>got installed haskell platform and then run</p>\n\n<pre><code>cabal install yesod-bin\n</code></pre>\n\n<p>but when I type </p>\n\n<pre><code>yesod init\n</code></pre>\n\n<p>i get \"bash: yesod: command not found...\"\nhow do I fix it ?</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 3675367, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/160781f2227e937225d258d2f97a86c5?s=128&d=identicon&r=PG&f=1", "display_name": "Nausika", "link": "https://stackoverflow.com/users/3675367/nausika"}, "edited": false, "score": 0, "creation_date": 1464380815, "post_id": 37491326, "comment_id": 62479897, "body": "Thanks for the explanation! I knew that the <code>l</code> was the problem - now I see why."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1464378930, "creation_date": 1464378930, "answer_id": 37491326, "question_id": 37490826, "link": "https://stackoverflow.com/questions/37490826/error-in-recursive-function-trying-to-find-all-subdirectories-of-a-given-direc/37491326#37491326", "title": "Error in recursive function / trying to find all subdirectories of a given directory", "body": "<p>This looks wrong:</p>\n\n<pre><code>getDirTree l@(x:xs) = do\n        -- ...\n        b &lt;- getDirTree xs\n        return (nub $ l ++ a ++ b)\n</code></pre>\n\n<p>The last line adds <code>l</code> which is <code>x:xs</code> with <code>b</code>, which will contain the <code>l</code> argument in the <code>getDirTree xs</code> call, so <code>b</code> will contain <code>xs</code>. Hence <code>xs</code> is included twice (at every recursive step!).</p>\n\n<p>Try <code>return ( x : a ++ b )</code> instead.</p>\n"}, {"comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1464380758, "post_id": 37491374, "comment_id": 62479869, "body": "<code>getDirTree&#39; = let foo phi x = pure x &lt;|&gt; (phi x &gt;&gt;= foo phi) in ala ListT foo</code>"}, {"owner": {"reputation": 101, "user_id": 3675367, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/160781f2227e937225d258d2f97a86c5?s=128&d=identicon&r=PG&f=1", "display_name": "Nausika", "link": "https://stackoverflow.com/users/3675367/nausika"}, "edited": false, "score": 0, "creation_date": 1464381795, "post_id": 37491374, "comment_id": 62480286, "body": "Thank you @ErikR. Seeing alternative solutions helps a lot."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464379100, "creation_date": 1464379100, "answer_id": 37491374, "question_id": 37490826, "link": "https://stackoverflow.com/questions/37490826/error-in-recursive-function-trying-to-find-all-subdirectories-of-a-given-direc/37491374#37491374", "title": "Error in recursive function / trying to find all subdirectories of a given directory", "body": "<p>This seems to work:</p>\n\n<pre><code>getDirTree' :: FilePath -&gt; IO [FilePath]\ngetDirTree' path = do\n  subs &lt;- getSubDirs path\n  as &lt;- mapM getDirTree' subs\n  return $ subs ++ concat as\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 3675367, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/160781f2227e937225d258d2f97a86c5?s=128&d=identicon&r=PG&f=1", "display_name": "Nausika", "link": "https://stackoverflow.com/users/3675367/nausika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 1, "accepted_answer_id": 37491326, "answer_count": 2, "score": 0, "last_activity_date": 1464379100, "creation_date": 1464376645, "question_id": 37490826, "link": "https://stackoverflow.com/questions/37490826/error-in-recursive-function-trying-to-find-all-subdirectories-of-a-given-direc", "title": "Error in recursive function / trying to find all subdirectories of a given directory", "body": "<p>I'm trying to write a function that returns all subdirectories of a given directory (recursive).</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>import System.Directory\nimport Control.Monad\nimport Data.List\n\ngetSubDirs :: FilePath -&gt; IO [FilePath]\ngetSubDirs dir =\n        getDirectoryContents dir\n        &gt;&gt;= filterM (\\x -&gt; return $ x /= \".\" &amp;&amp; x /= \"..\")\n        &gt;&gt;= mapM (makeAbsolute . (\\x -&gt; dir ++ \"/\" ++ x))\n        &gt;&gt;= filterM doesDirectoryExist\n        &gt;&gt;= return . reverse\n\ngetDirTree :: [FilePath] -&gt; IO [FilePath]\ngetDirTree [] = return []\ngetDirTree l@(x:xs) = do\n        a &lt;- getSubDirs x &gt;&gt;= getDirTree\n        b &lt;- getDirTree xs\n        return (nub $ l ++ a ++ b)\n</code></pre>\n\n<p>Which seems to work. But there is something wrong with the recursion - I would like to get rid of the <code>nub</code> in <code>getDirTree</code>. </p>\n"}, {"tags": ["haskell", "functional-programming", "higher-order-functions"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1464373503, "post_id": 37488980, "comment_id": 62476434, "body": "that&#39;s also <code>c . a &lt;*&gt; b</code>."}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1464383380, "post_id": 37489097, "comment_id": 62480888, "body": "or if you want to get familiar with <code>Applicative</code>, you can use <code>&lt;*&gt;</code> to generalize this to functions of arbitrary arity: <code>(++) &lt;$&gt; take 1 &lt;*&gt; drop 2</code> is the same as <code>liftA2 (++) (take 1) (drop 2)</code>."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 5, "last_activity_date": 1464370710, "last_edit_date": 1464370710, "creation_date": 1464369418, "answer_id": 37489097, "question_id": 37488980, "link": "https://stackoverflow.com/questions/37488980/compose-functions-into-another-function/37489097#37489097", "title": "Compose functions into another function", "body": "<p>If you reorder the signature to:</p>\n\n<pre><code>(b -&gt; c -&gt; d) -&gt; (a -&gt; b) -&gt; (a -&gt; c) -&gt; a -&gt; d\n</code></pre>\n\n<p>this is equivalent to <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:liftM2\" rel=\"nofollow\"><code>liftM2</code></a>, since <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-645\" rel=\"nofollow\"><code>((-&gt;) r)</code> is an instance of Monad type class</a></p>\n\n<pre><code>liftM2 :: Monad m =&gt; (a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r\n</code></pre>\n\n<p>and</p>\n\n<pre><code>\\&gt; liftM2 (++) (take 1) (drop 2) [1, 2, 3, 4]\n[1,3,4]\n</code></pre>\n\n<hr>\n\n<p>similarly, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#v:liftA2\" rel=\"nofollow\"><code>liftA2</code></a> from <code>Control.Applicative</code>:</p>\n\n<pre><code>liftA2 :: Applicative f =&gt; (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n\n\\&gt; liftA2 (++) (take 1) (drop 2) [1, 2, 3, 4]\n[1,3,4]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "is_accepted": false, "score": 4, "last_activity_date": 1464369573, "creation_date": 1464369573, "answer_id": 37489134, "question_id": 37488980, "link": "https://stackoverflow.com/questions/37488980/compose-functions-into-another-function/37489134#37489134", "title": "Compose functions into another function", "body": "<p><code>liftM2</code> from <code>Control.Monad</code> is almost the same as your <code>compact</code> function, just with the arguments in a different order.</p>\n\n<p><code>liftM2 :: Monad m =&gt; (a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r</code></p>\n\n<p>which in context is the same as:</p>\n\n<p><code>liftM2 :: (b -&gt; c -&gt; d) -&gt; (a -&gt; b) -&gt; (a -&gt; c) -&gt; a -&gt; d</code></p>\n\n<p>So:</p>\n\n<pre><code>liftM2 (++) (take 1) (drop 2) [1,2,3,4] == [1,3,4]\nliftM2 (&lt;) (+10) (*2) 11 == True\nliftM2 (&lt;) (+10) (*2) 9 == False\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4804135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5c16dfa01c706b52d06ab572148160?s=128&d=identicon&r=PG&f=1", "display_name": "foxterfox", "link": "https://stackoverflow.com/users/4804135/foxterfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 37489097, "answer_count": 2, "score": 2, "last_activity_date": 1464370710, "creation_date": 1464368952, "question_id": 37488980, "link": "https://stackoverflow.com/questions/37488980/compose-functions-into-another-function", "title": "Compose functions into another function", "body": "<p>Is there a function for Haskell in the standard library which takes three functions and returns a function which applies the return values of the first two functions to the third function, something like this:</p>\n\n<pre><code>compact :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; a -&gt; d\ncompact a b c = \\x -&gt; c (a x) (b x)\n</code></pre>\n\n<p>Or this:</p>\n\n<pre><code>import Control.Arrow\ncompact' :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; a -&gt; d\ncompact' a b c = uncurry c . (a &amp;&amp;&amp; b)\n</code></pre>\n\n<p>So that:</p>\n\n<pre><code>compact (take 1) (drop 2) (++) [1,2,3,4] == [1,3,4]\ncompact (+10) (*2) (&lt;) 11 == True\ncompact (+10) (*2) (&lt;) 9 == False\n</code></pre>\n"}, {"tags": ["haskell", "gray-code"], "comments": [{"owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "edited": false, "score": 0, "creation_date": 1464364564, "post_id": 37487484, "comment_id": 62471896, "body": "hard problem?how can \u0131 do?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464365082, "post_id": 37487484, "comment_id": 62472206, "body": "google &quot;Gray code&quot;"}, {"owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464365651, "post_id": 37487484, "comment_id": 62472545, "body": "thanks but this will give all possible?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464366305, "post_id": 37487484, "comment_id": 62472883, "body": "I think it is clear what he&#39;s asking, though it takes a bit of thought to read through the obvious English-as-a-second-language problems: how would one go about enumerating all gray codes of a given length? (Or, equivalently, how would one go about enumerating all Hamiltonian cycles on an n-dimensional cube?) So I do not vote to close as &quot;unclear what you&#39;re asking&quot;, as others have."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464366615, "post_id": 37487484, "comment_id": 62473054, "body": "well - the OP edited the question just a few minutes ago and added his solution - the function <code>g</code> which I didn&#39;t see when I made my comment."}, {"owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "edited": false, "score": 0, "creation_date": 1464366773, "post_id": 37487484, "comment_id": 62473125, "body": "thanks.one bit change like this.sequent members of list will have only one  bit change.for example 001-011 only second bit different.011-010 only third bit different.sequent members will be like this.sorry for my english."}, {"owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "edited": false, "score": 0, "creation_date": 1464366850, "post_id": 37487484, "comment_id": 62473161, "body": "yes \u0131 editted but this code gives only one posibilty.other possibilities werent found ."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464367090, "post_id": 37487484, "comment_id": 62473296, "body": "@ErikR I, too, read the answer before the edit, and even wrote up an answer with almost identical code before I realized what the question was about (which I then deleted -- all of this before I saw the edit). So while the question was perhaps subtle or hard to understand from the beginning, I do think all the interesting information was there even before the edit."}, {"owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "edited": false, "score": 0, "creation_date": 1464367270, "post_id": 37487484, "comment_id": 62473408, "body": "can you help me finding all possibilities using this rules?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464373991, "post_id": 37487484, "comment_id": 62476706, "body": "@rooney - this clearly smells like a homework problem. So what kinds of things have you covered in the course which might be relevant to this problem? Can you (in any computer language) write a program to find all possible paths through a maze?"}, {"owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "edited": false, "score": 0, "creation_date": 1464374351, "post_id": 37487484, "comment_id": 62476906, "body": "yes this is final examination question and \u0131 m new in haskell .\u0131 can write in c# but this wasnt accepted."}, {"owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "edited": false, "score": 0, "creation_date": 1464374369, "post_id": 37487484, "comment_id": 62476916, "body": "can you give me a tip if you know"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 0, "last_activity_date": 1464559779, "last_edit_date": 1464559779, "creation_date": 1464365998, "answer_id": 37488215, "question_id": 37487484, "link": "https://stackoverflow.com/questions/37487484/generate-binary-one-bit-change-between-all-members/37488215#37488215", "title": "generate binary one bit change between all members", "body": "<p>There is probably a smarter way to do this that exploits more of the structure of gray codes. This way is sort of quick and dirty, but it seems to work fairly well.</p>\n\n<p>The basic idea is we'll generate all sequences of bitstrings, then filter out the ones that aren't gray codes. We'll be slightly more clever, though, in that we'll check prefixes of each sequence to make sure they could plausibly be extended to a gray code, and prune prefixes that can't be.</p>\n\n<p>For our purposes, a gray code will have five properties:</p>\n\n<ul>\n<li>Each pair of consecutive bitstrings differs in exactly one place.</li>\n<li>The sequence is cyclic: the first and last bitstring also differ in exactly one place.</li>\n<li>No two bitstrings in a sequence are equal.</li>\n<li>A code with bitstring length n has 2^n elements.</li>\n<li>To break the cyclic symmetry, every code will start with the all-zero bitstring.</li>\n</ul>\n\n<p>Three of these properties can be expressed on code prefixes:</p>\n\n<pre><code>import Control.Monad\nimport Data.List\n\nvalidCodePrefix xss = nearbyPairs &amp;&amp; unique &amp;&amp; endsWithZeros where\n    nearbyPairs = all (uncurry nearby) (zip xss (tail xss))\n    unique = all ((1==) . length) . group . sort $ xss\n    endsWithZeros = all (all (=='0')) (take 1 (reverse xss))\n\nnearby xs xs' = length [() | (x, x') &lt;- zip xs xs', x /= x'] == 1\n</code></pre>\n\n<p>The cyclic condition applies only to completed codes, and can be written as:</p>\n\n<pre><code>cyclic xss = nearby (head xss) (last xss)\n</code></pre>\n\n<p>We can implement the search and enforce the length condition at the same time, by repeatedly choosing from all appropriate length bitstrings, and keeping only those ones that are valid:</p>\n\n<pre><code>codes n = go (2^n) [] where\n    go 0 code = [reverse code | cyclic code]\n    go i code = do\n        continuation &lt;- replicateM n \"01\"\n        guard (validCodePrefix (continuation:code))\n        go (i-1) (continuation:code)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6176034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07aa99620f7ea7d41c73015f065b427b?s=128&d=identicon&r=PG&f=1", "display_name": "rooney", "link": "https://stackoverflow.com/users/6176034/rooney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 37488215, "answer_count": 1, "score": -2, "last_activity_date": 1465307210, "creation_date": 1464363588, "last_edit_date": 1465307210, "question_id": 37487484, "link": "https://stackoverflow.com/questions/37487484/generate-binary-one-bit-change-between-all-members", "title": "generate binary one bit change between all members", "body": "<p>\u0131 have a question. \u0131 want to generate binary list .but between members of the list will be only one bit change.</p>\n\n<p>oneBitAll :: Integral a => a -> [[String]] </p>\n\n<p>for n=2</p>\n\n<p>Output:</p>\n\n<p>[\"00\",\"01\",\"11\",\"10\"] ve [\"00\",\"10\",\"11\",\"01\"] </p>\n\n<p>n=3</p>\n\n<p>oneBitAll 3<br>\n [[\"000\",\"001\",\"011\",\"010\",\"110\",\"111\",\"101\",\"100\"],      [\"000\",\"001\",\"011\",\"111\",\"101\",\"100\",\"110\",\"010\"],    [\"000\",\"001\",\"101\",\"100\",\"110\",\"111\",\"011\",\"010\"],    [\"000\",\"001\",\"101\",\"111\",\"011\",\"010\",\"110\",\"100\"],    [\"000\",\"010\",\"011\",\"001\",\"101\",\"111\",\"110\",\"100\"],    .....]  </p>\n\n<p>only one bit change between members.</p>\n\n<p>please help.</p>\n\n<p>this gives only one</p>\n\n<pre><code>g 0 = [\"\"]\ng n = (map ('0':)) (g (n-1)) ++ (map ('1':)) (reverse (g (n-1)))\n</code></pre>\n\n<p>gray code is true for this.but \u0131 want to find all combinations.</p>\n\n<p>how can I generate all possible gray codes for given  n number?</p>\n\n<pre><code>permute [] = [[]]\npermute xs = concatMap (\\x -&gt; map (x:) $ permute $ delete x xs) xs \ng 0 = [\"\"]\ng n = (map ('0':)) (g (n-1)) ++ (map ('1':)) (reverse (g (n-1)))\noneBitAll n = (map transpose . permute . transpose $ g n) \n</code></pre>\n\n<p>This code generate half of possibilities.What can \u0131 add this code?this code generates;</p>\n\n<p>[[\"000\",\"001\",\"011\",\"010\",\"110\",\"111\",\"101\",\"100\"],[\"000\",\"010\",\"011\",\"001\",\"101\",\"111\",\"110\",\"100\"],[\"000\",\"001\",\"101\",\"100\",\"110\",\"111\",\"011\",\"010\"],[\"000\",\"010\",\"110\",\"100\",\"101\",\"111\",\"011\",\"001\"],[\"000\",\"100\",\"101\",\"001\",\"011\",\"111\",\"110\",\"010\"],[\"000\",\"100\",\"110\",\"010\",\"011\",\"111\",\"101\",\"001\"]]</p>\n\n<p>but must generate 12 members.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "criterion"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1464360057, "post_id": 37485522, "comment_id": 62468882, "body": "Die you try to do a <code>stack build</code>?"}, {"owner": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "edited": false, "score": 0, "creation_date": 1464364880, "post_id": 37485522, "comment_id": 62472088, "body": "Can you upload a full project with this problem somewhere? (Unrelated: by defining <code>leaves-of-a-tree</code> in your <code>build-depends</code> and adding <code>src</code> to <code>hs-source-dirs</code> you are depending on your library component twice)"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "edited": false, "score": 0, "creation_date": 1464417442, "post_id": 37485522, "comment_id": 62487499, "body": "I did try <code>stack build</code>. The problem is that the benchmark program is not being found. @Jan Thanks for the remark. I also uploaded the relevant files to github."}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1464417582, "post_id": 37494845, "comment_id": 62487530, "body": "I think everything is alright with the module containing the benchmark program. However it might be that I&#39;m missing something. I added a link to the github repository that contains the project. Please note that I did some renaming while trying to look for the solution."}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 0, "last_activity_date": 1464405523, "creation_date": 1464405523, "answer_id": 37494845, "question_id": 37485522, "link": "https://stackoverflow.com/questions/37485522/how-to-use-criterion-with-stack/37494845#37494845", "title": "How to use criterion with stack", "body": "<p>This reminds me of what happens when you don't have a proper Main module.  Do you have \"module MainBenchmarkSuite\" at the top?</p>\n\n<p>I can't find the ghc ticket for this, but for some reason ghc treats this as only a warning.  IIRC it's resolved in GHC 8.0</p>\n"}, {"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1464502410, "post_id": 37501339, "comment_id": 62507996, "body": "This seems like a bug in Cabal or Stack, doesn&#39;t it?"}, {"owner": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1464639233, "post_id": 37501339, "comment_id": 62556400, "body": "As Stack is using the Cabal library for most build stuff, I would guess this is Cabal-related. If it&#39;s not considered a bug, at least the documentation should cover this."}], "tags": [], "owner": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "is_accepted": true, "score": 1, "last_activity_date": 1464452679, "creation_date": 1464452679, "answer_id": 37501339, "question_id": 37485522, "link": "https://stackoverflow.com/questions/37485522/how-to-use-criterion-with-stack/37501339#37501339", "title": "How to use criterion with stack", "body": "<p>There is some weird cabal stuff going on here.</p>\n\n<p>Your <a href=\"https://github.com/capitanbatata/sandbox/blob/8d7dea6a09fc7e3529d12473ebdce765e2355367/leaves-of-a-tree/bench/LeavesOfATreeBench.hs\" rel=\"nofollow\">LeavesOfATreeBench.hs</a>:</p>\n\n<pre><code>-- |\n\nmodule LeavesOfATreeBench where\n\nimport           Criterion.Main\nimport           Data.BinTree\n\nmkTree :: [a] -&gt; BinTree a\nmkTree [] = Nil\nmkTree (x:xs) = Fork x (mkTree lxs) (mkTree rxs)\n  where (lxs, rxs) = splitAt ((length xs + 1) `div` 2) xs\n\nmain :: IO ()\nmain = defaultMain [\n  bgroup \"leaves\"\n    [ bench \"tree 0\" $ whnf leaves (mkTree ([0 .. 20] :: [Integer]))\n    , bench \"tree 1\" $ whnf leaves (mkTree ([0 .. 200] :: [Integer]))\n    ]\n  ]\n</code></pre>\n\n<p>Now, once I simply remove the line</p>\n\n<pre><code>module LeavesOfATreeBench where\n</code></pre>\n\n<p>everything works as expected:</p>\n\n<pre><code>Registering leaves-of-a-tree-0.1.0.0...\nleaves-of-a-tree-0.1.0.0: benchmarks\nRunning 1 benchmarks...\nBenchmark leaves-of-a-tree-bench: RUNNING...\nbenchmarking leaves/tree 0\ntime                 41.81 ns   (41.51 ns .. 42.29 ns)\n                     0.999 R\u00b2   (0.998 R\u00b2 .. 0.999 R\u00b2)\nmean                 42.65 ns   (42.12 ns .. 43.50 ns)\nstd dev              2.293 ns   (1.526 ns .. 3.690 ns)\nvariance introduced by outliers: 75% (severely inflated)\n\nbenchmarking leaves/tree 1\ntime                 71.11 ns   (70.41 ns .. 71.84 ns)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 0.999 R\u00b2)\nmean                 71.30 ns   (70.45 ns .. 72.19 ns)\nstd dev              2.917 ns   (2.431 ns .. 3.507 ns)\nvariance introduced by outliers: 62% (severely inflated)\n\nBenchmark leaves-of-a-tree-bench: FINISH\nCompleted 2 action(s).\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 872, "favorite_count": 0, "accepted_answer_id": 37501339, "answer_count": 2, "score": 3, "last_activity_date": 1464452679, "creation_date": 1464357920, "last_edit_date": 1464417371, "question_id": 37485522, "link": "https://stackoverflow.com/questions/37485522/how-to-use-criterion-with-stack", "title": "How to use criterion with stack", "body": "<p>I set up a simple stack project, and a .cabal entry for the benchmark tests:</p>\n\n<pre><code>benchmark leaves-of-a-tree-bench\n  type:             exitcode-stdio-1.0\n  hs-source-dirs:   src, bench\n  main-is:          MainBenchmarkSuite.hs\n  build-depends:    base\n                  , criterion\n                  , random\n                  , leaves-of-a-tree\n  ghc-options:      -Wall\n                    -O2\n  default-language: Haskell2010                    \n</code></pre>\n\n<p>However after running <code>stack bench</code> I get the following error:</p>\n\n<pre><code>setup-Simple-Cabal-1.22.5.0-ghc-7.10.3: Error: Could not find benchmark program      \n\".stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/leaves-of-a-tree-bench/leaves-of-a-tree-bench\".\nDid you build the package first?\n</code></pre>\n\n<p>Am I missing something?</p>\n\n<p>EDIT: I uploaded the project to <a href=\"https://github.com/capitanbatata/sandbox/tree/master/leaves-of-a-tree\" rel=\"nofollow\">a github repository</a></p>\n"}, {"tags": ["haskell", "yesod", "esqueleto"], "answers": [{"comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1464370978, "post_id": 37485390, "comment_id": 62475237, "body": "It seems like the library should define it. Maybe open an issue @FtheBuilder?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1464374571, "post_id": 37485390, "comment_id": 62477032, "body": "@MaxGabriel I will open"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1464460918, "post_id": 37485390, "comment_id": 62500023, "body": "@Daniel Martin I&#39;ve defined it myself, I posted just to help others with similar problems..."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 3, "last_activity_date": 1464357504, "creation_date": 1464357504, "answer_id": 37485390, "question_id": 37485243, "link": "https://stackoverflow.com/questions/37485243/yesod-esqueleto-isjust/37485390#37485390", "title": "Yesod Esqueleto isJust", "body": "<p>Can't you define it yourself?</p>\n\n<pre><code>isJust = not_ . isNothing\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 1, "accepted_answer_id": 37485390, "answer_count": 1, "score": 1, "last_activity_date": 1464357504, "creation_date": 1464357097, "question_id": 37485243, "link": "https://stackoverflow.com/questions/37485243/yesod-esqueleto-isjust", "title": "Yesod Esqueleto isJust", "body": "<p>I've been using <code>isNothing</code>, from <code>Esqueleto</code>, but now I would like to just test if it is <code>not null</code>, I've noticed that there is no <code>isJust</code>, I would like to know the reason it doesn't exist, and what could I do to achieve similar effect: <code>isJust (a ^. MyEntityMyField)</code></p>\n"}, {"tags": ["haskell", "types", "type-inference"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464377214, "post_id": 37484734, "comment_id": 62478286, "body": "See my answer for an explanation as to why <code>read 2</code> gives a <code>Parse error</code> in ghci."}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464357243, "post_id": 37485191, "comment_id": 62466874, "body": "I&#39;d like to know what ghci is trying to do when you type <code>read &quot;2&quot;</code> at the REPL prompt."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464357306, "post_id": 37485191, "comment_id": 62466914, "body": "<code>read &quot;2&quot; :: Read a =&gt; a</code>. There is no default type for <code>Read a =&gt; a</code>, producing a parse error."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464358068, "post_id": 37485191, "comment_id": 62467441, "body": "Normally if GHC doesn&#39;t know which instance you are referring to is says &quot;There are several potential instances ...&quot; and then list out the instances available. In this case it is actually proceeding with the <code>read</code> with some type in mind. But which type? For instance, evaling <code>read undefined</code> results in the undefined error - so some type&#39;s read function is actually looking at the string."}, {"owner": {"reputation": 383, "user_id": 4847170, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/dffff1120ce7fce426c128efc46bb125?s=128&d=identicon&r=PG&f=1", "display_name": "EasternDude", "link": "https://stackoverflow.com/users/4847170/easterndude"}, "edited": false, "score": 0, "creation_date": 1464358303, "post_id": 37485191, "comment_id": 62467615, "body": "haskell is so mind-boggling and awesome at the same time. Thanks! By the way, i can even omit function type, haskell figures it out anyway. Amazing"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464365798, "post_id": 37485191, "comment_id": 62472642, "body": "@ErikR I think the difference may have to do with whether the function is polymophic in an <i>argument</i> (e.g., <code>show</code>) or in its <i>return value</i> (as is the case with <code>read</code>). A problem with an argument is caught immediately; a problem with the return type is deferred until it is actually evaluated."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464366861, "post_id": 37485191, "comment_id": 62473165, "body": "But - what code is emitting <code>Parse error</code>? GHCI is clearly finding some function to run - so what function is being run, and what rules did GHCI use to find that function?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1464368292, "post_id": 37485191, "comment_id": 62473922, "body": "<code>read</code> is. But at the prompt, with no further context, <code>read</code> doesn&#39;t know what to actually return, so <i>it</i> raises the error. <code>read</code> <i>always</i> takes a <code>String</code> as its argument, so dispatch is not a problem. Once <code>read</code> <i>starts</i> to run, and can&#39;t figure out what to do with its argument, the exception is raised."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464376953, "post_id": 37485191, "comment_id": 62478159, "body": "Well  - I got this one explained - I posted it as a new answer."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1464357336, "last_edit_date": 1464357336, "creation_date": 1464356947, "answer_id": 37485191, "question_id": 37484734, "link": "https://stackoverflow.com/questions/37484734/how-does-haskell-read-infer-types/37485191#37485191", "title": "How does Haskell &#39;read&#39; infer types", "body": "<p>Let's work backwards.</p>\n\n<ol>\n<li><code>head . foldl foldingFunction [] . words :: Num a =&gt; String -&gt; a</code></li>\n<li><code>foldl foldingFunction [] .words :: Num a =&gt; String -&gt; [a]</code></li>\n<li><code>foldl foldingFunction [] :: Num a =&gt; [String] -&gt; [a]</code>:</li>\n</ol>\n\n<p>Since <code>foldl ::Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b</code>, we can see that <code>t a ~ [String]</code>, so we can also see that <code>foldingFunction :: Num a =&gt; [a] -&gt; String -&gt; [a]</code>.</p>\n\n<p>Thus, <code>read \"2\" : [] :: Num a =&gt; [a]</code>, the same type as <code>foldingFunction [] \"2\"</code>.</p>\n\n<p>In other words, <code>solveRPN</code> provides the necessary context to infer what <code>read</code> should return.</p>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 0, "last_activity_date": 1464357119, "creation_date": 1464357119, "answer_id": 37485248, "question_id": 37484734, "link": "https://stackoverflow.com/questions/37484734/how-does-haskell-read-infer-types/37485248#37485248", "title": "How does Haskell &#39;read&#39; infer types", "body": "<p>The context <code>(Num a, Read a) =&gt;</code> on your <code>solveRPN</code> function are enough for <code>read</code> to figure it out.  Try this in ghci:</p>\n\n<pre><code>let n = read \"2\" :: (Num a, Read a) =&gt; a\n:t n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 2, "last_activity_date": 1464357291, "creation_date": 1464357291, "answer_id": 37485313, "question_id": 37484734, "link": "https://stackoverflow.com/questions/37484734/how-does-haskell-read-infer-types/37485313#37485313", "title": "How does Haskell &#39;read&#39; infer types", "body": "<p>So what you have to understand is that Haskell assigns all the types of functions at compile time, not run time. Also, that functions have only one type for all their patterns.</p>\n\n<p>What this means is that it will decide that the type of the function is overall and use that decision in every case. Also, Haskell does rather heavy type inference (unlike most other languages), and so will sometimes determine the type of a function based on the type of something that might seem a bit far away from the original function call.</p>\n\n<p>Let's look at your example:</p>\n\n<pre><code>solveRPN :: (Num a, Read a) =&gt; String -&gt; a  \nsolveRPN xs = head . foldl foldingFunction [] . words $ xs\n    where   foldingFunction (x:y:ys) \"*\" = (x * y):ys  \n            foldingFunction (x:y:ys) \"+\" = (x + y):ys  \n            foldingFunction (x:y:ys) \"-\" = (y - x):ys  \n            foldingFunction xs numberString = read numberString:xs \n</code></pre>\n\n<p>First off, the type of <code>solveRPN</code> is declared as <code>String -&gt; a</code>.</p>\n\n<p>Now, looking at the definition of <code>solveRPN</code>, we have the first line saying:</p>\n\n<pre><code>solveRPN xs = head . foldl foldingFunction [] . words $ xs\n</code></pre>\n\n<p>Now, the types of the names used there are:</p>\n\n<pre><code>xs :: String    (from the type of solveRPN)\nhead :: [b] -&gt; b    (I'm using different variable names for each different type)\nfoldl :: (c -&gt; d -&gt; c) -&gt; c -&gt; [d] -&gt; c\nwords :: String -&gt; [String]\n</code></pre>\n\n<p>So the type of <code>solveRPN</code> means that we must have that type <code>b</code> is the same as type <code>a</code>, and since <code>head</code> is applied to the output of <code>foldl</code>, we must have that type <code>c</code> is the same as type <code>[a]</code>. Now since the third argument to <code>foldl</code> is of type <code>[String]</code>, we know that type <code>d</code> is <code>String</code>, and now we have enough to determine the type of <code>foldingFunction</code>:</p>\n\n<pre><code>foldingFunction :: [a] -&gt; String -&gt; [a]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1464377341, "last_edit_date": 1464377341, "creation_date": 1464376843, "answer_id": 37490875, "question_id": 37484734, "link": "https://stackoverflow.com/questions/37484734/how-does-haskell-read-infer-types/37490875#37490875", "title": "How does Haskell &#39;read&#39; infer types", "body": "<blockquote>\n  <p>If I tried to execute this bit in console it would give parse error becasue read wouldn't know what that string should be, right? </p>\n</blockquote>\n\n<p>(Thanks to <a href=\"https://groups.google.com/forum/#!topic/haskell-cafe/juEd1ZJizUE\" rel=\"nofollow\">haskell-cafe mailing list</a> for help on this.)</p>\n\n<p>You are getting a parse error at the GHCI REPL because in the absence of a type context, GHCi evaluates the expression as if it were the type <code>()</code> (the empty tuple type.)</p>\n\n<p>For instance, this does not give an error:</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; read \"()\"\n()\n</code></pre>\n\n<p>This is a consequence of the <code>-XExtendedDefaultRules</code> option which is implicitly in effect when using GHCi. See <a href=\"http://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow\">Type defaulting in GHCi</a> in the <a href=\"http://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/index.html\" rel=\"nofollow\">GHC User Guide</a> for more details on why GHCi has these extended defaulting rules.</p>\n\n<p>To see how this option affects evaluation, you can perform the same experiment with the option disabled:</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set -XNoExtendedDefaultRules\nPrelude&gt; read \"2\"\n\n&lt;interactive&gt;:3:1:\n    No instance for (Read a0) arising from a use of \u2018it\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    ...\n</code></pre>\n\n<p>Now we get a <code>No instance for ...</code> error message. This is the message that tells you that GHC does not know which type to return.</p>\n"}], "owner": {"reputation": 383, "user_id": 4847170, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/dffff1120ce7fce426c128efc46bb125?s=128&d=identicon&r=PG&f=1", "display_name": "EasternDude", "link": "https://stackoverflow.com/users/4847170/easterndude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 1, "accepted_answer_id": 37485313, "answer_count": 4, "score": 1, "last_activity_date": 1464377341, "creation_date": 1464355634, "last_edit_date": 1464369810, "question_id": 37484734, "link": "https://stackoverflow.com/questions/37484734/how-does-haskell-read-infer-types", "title": "How does Haskell &#39;read&#39; infer types", "body": "<p>I learned before that when using Haskell's <code>read</code> function when reading numbers from <code>String</code>s you need to specify the type of output, as:</p>\n\n<pre><code>read \"2\" :: Int\n</code></pre>\n\n<p>unless you do something like:</p>\n\n<pre><code>read \"2\" + 2\n</code></pre>\n\n<p>Haskell then knows you're trying to do addition, hence it must be a number.</p>\n\n<p>However, one particular function caught my attention, because by looking at function i thought it would not compile, but it does, i don't know why.</p>\n\n<p>This reverse polish notation calculator that implements addition, subtraction and multiplication:</p>\n\n<pre><code>solveRPN :: (Num a, Read a) =&gt; String -&gt; a  \nsolveRPN xs = head . foldl foldingFunction [] . words $ xs\n    where   foldingFunction (x:y:ys) \"*\" = (x * y):ys  \n            foldingFunction (x:y:ys) \"+\" = (x + y):ys  \n            foldingFunction (x:y:ys) \"-\" = (y - x):ys  \n            foldingFunction xs numberString = read numberString:xs \n</code></pre>\n\n<p>if you give it a string like \"2 5 +\" it will return 7.</p>\n\n<p>last line of this code is what i can't understand. When you give this function \"2 5 +\" the first element in <code>xs</code> list will be \"2\" and accumulator at time is <code>[]</code>, hence it will slip through first 3 patterns and last one will do its job, hence:</p>\n\n<pre><code> foldingFunction [] \"2\" = read \"2\":[]\n</code></pre>\n\n<p>So, my question is: How come <code>read \"2\":[]</code> dosen't crash? If I tried to execute this bit in console it would give parse error becasue <code>read</code> wouldn't know what that string should be, right? how come it's not <code>(read \"2\" :: Int):[]</code> or something?</p>\n"}, {"tags": ["haskell", "tree", "higher-order-functions"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 6, "creation_date": 1464344911, "post_id": 37480567, "comment_id": 62458946, "body": "With the pragmas <code>{-# LANGUAGE DeriveFunctor, DeriveFoldable #-}</code> you can just add <code>... deriving (Functor, Foldable)</code> to the data declaration and GHC will do the first four for you."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1464345464, "post_id": 37480567, "comment_id": 62459259, "body": "How would <code>filter</code> for trees work?"}, {"owner": {"reputation": 133, "user_id": 6390394, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ab0911e8409e70ac6c9183897decfed6?s=128&d=identicon&r=PG&f=1", "display_name": "ABBC", "link": "https://stackoverflow.com/users/6390394/abbc"}, "edited": false, "score": 0, "creation_date": 1464346508, "post_id": 37480567, "comment_id": 62459865, "body": "I want to know how to write the functions explicitly, for example I know that the map function can be written:   treeMap :: (a -&gt;b) -&gt; Tree a -&gt; Tree b   treeMap f tree = case tree of   \tNull -&gt; Null   \tNode a Null Null -&gt; Node (f a) Null Null   \tNode a l r -&gt; Node (f a) (treeMap f l) (treeMap f r)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1464348751, "post_id": 37480567, "comment_id": 62461245, "body": "@BenjaminHodgson if the top node&#39;s value is eliminated, the two updated branches can be joined by pulling up the rightmost element from the left, or leftmost from the right updated branch."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1464384458, "post_id": 37480567, "comment_id": 62481286, "body": "@WillNess, as we know nothing about what the tree <i>means</i>, we have no particular reason to believe that the operation you suggest makes any sense."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464387667, "post_id": 37480567, "comment_id": 62482378, "body": "@dfeuer my suggestion follows the &quot;lisp congruency&quot;, same as chi&#39;s answer. both make sense or don&#39;t in the same way, I think. so yes, of course it&#39;s somewhat arbitrary. (that&#39;s why I said &quot;can&quot;, and not e.g. &quot;must&quot;; indeed  I should&#39;ve perhaps said &quot;may&quot; or even &quot;might&quot; :) )."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464347047, "creation_date": 1464347047, "answer_id": 37481844, "question_id": 37480567, "link": "https://stackoverflow.com/questions/37480567/higher-order-haskell-functions-applied-to-trees/37481844#37481844", "title": "Higher Order Haskell Functions Applied to Trees", "body": "<p>Here's something which may help you:</p>\n\n<p>Let <code>t1</code> be this tree (of type <code>Tree String</code>)</p>\n\n<pre><code>     \"a\"\n     / \\\n   \"b\" \"c\"\n   /     \\\n \"d\"     \"e\"\n         / \\\n       \"f\" \"g\"\n</code></pre>\n\n<p>First - how would you write it in terms of <code>Null</code> and <code>Node</code> constructors?</p>\n\n<p>Second - what would <code>fold (++) t1</code> be?</p>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464352899, "post_id": 37483681, "comment_id": 62463930, "body": "The OP clearly was able to do <code>map</code>, so I was trying to help him (her?) get started on <code>fold</code> without writing out the code."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464353176, "post_id": 37483681, "comment_id": 62464125, "body": "@ErikR Since they wanted a lot of functions, I thought it was ok to show how to craft one of those. IMO, the good answers must either provide some hints only (like yours -- perhaps with slightly more help), or explain the reasoning in detail. The really bad answers are those who hand out the code with no careful explanation. (And, by the record, I don&#39;t agree with who downvoted you)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1464363481, "post_id": 37483681, "comment_id": 62471228, "body": "great answer! :) the simpler the building blocks, the higher the building; the smaller the steps, the farther you go!  --- (just 2 add that it&#39;s an <i>in-order</i> traversal of the tree; another thing is, the flipped type <code>:: (a -&gt; b -&gt; b) -&gt; Tree a -&gt; b -&gt; b</code> would lead to more visually apparent code, directly corresponding to the <i>difference-list</i> technique)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1464384829, "post_id": 37483681, "comment_id": 62481425, "body": "Indeed, as @WillNess suggests, there are multiple reasonable definitions of <code>foldr</code> for binary trees. Each corresponds to a different definition of <code>foldMap</code>, and I think it can be easier to understand them in the <code>foldMap</code> context, though the OP didn&#39;t mention that. That said, I greatly appreciate this answer. The demonstration of equational reasoning is great."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1464353319, "last_edit_date": 1464353319, "creation_date": 1464352301, "answer_id": 37483681, "question_id": 37480567, "link": "https://stackoverflow.com/questions/37480567/higher-order-haskell-functions-applied-to-trees/37483681#37483681", "title": "Higher Order Haskell Functions Applied to Trees", "body": "<p>Here's a step-by-step approach. We will focus on <code>treeFoldr</code>, only.</p>\n\n<h1>The basic and boring way</h1>\n\n<pre><code>data Tree a = Null | Node (Tree a) a (Tree a)\n</code></pre>\n\n<p>We start from a basic approach to define <code>treeFoldr</code>: we convert to list first, then use <code>foldr</code>.</p>\n\n<pre><code>-- In-order visit\ntoList :: Tree a -&gt; [a]\ntoList Null = []\ntoList (Node l a r) = toList l ++ [a] ++ toList r\n\ntreeFoldr_1 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_1 f x t = foldr f x $ toList t\n</code></pre>\n\n<h1>Equational reasoning to the rescue</h1>\n\n<p>Now we transform <code>treeFoldr_1</code> into a recursive definition, removing the intermediate list and the <code>foldr</code> call.</p>\n\n<p>We split the definition of <code>treeFoldr_1</code>, by cases on <code>t</code>.</p>\n\n<pre><code>treeFoldr_2 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_2 f x Null         = foldr f x $ toList Null\ntreeFoldr_2 f x (Node l a r) = foldr f x $ toList (Node l a r)\n</code></pre>\n\n<p>We expand <code>toList</code>.</p>\n\n<pre><code>treeFoldr_3 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_3 f x Null         = foldr f x []\ntreeFoldr_3 f x (Node l a r) = foldr f x (toList l ++ [a] ++ toList r)\n</code></pre>\n\n<p>Here we exploit a <code>foldr</code> property:</p>\n\n<pre><code>--   foldr f x (ys ++ zs) = foldr f (foldr f x zs) ys\n</code></pre>\n\n<p>obtaining</p>\n\n<pre><code>treeFoldr_4 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_4 _ x Null         = x\ntreeFoldr_4 f x (Node l a r) = \n    foldr f (foldr f x ([a] ++ toList r)) (toList l)\n</code></pre>\n\n<p>Again, we apply the same <code>foldr</code> equation.</p>\n\n<pre><code>treeFoldr_5 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_5 _ x Null         = x\ntreeFoldr_5 f x (Node l a r) = \n    foldr f (foldr f (foldr f x (toList r)) [a]) (toList l)\n</code></pre>\n\n<p>By definition of <code>foldr</code>, we can simplify</p>\n\n<pre><code>--    foldr f z [a] = f a z\n</code></pre>\n\n<p>obtaining</p>\n\n<pre><code>treeFoldr_6 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_6 _ x Null         = x\ntreeFoldr_6 f x (Node l a r) = \n    foldr f (f a (foldr f x (toList r))) (toList l)\n              -- ^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Now, <code>foldr f x (toList t)</code> is <code>treeFoldr f x t</code>, so we can try\na recursive call to replace that pattern.</p>\n\n<pre><code>treeFoldr_7 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_7 _ x Null         = x\ntreeFoldr_7 f x (Node l a r) = \n    foldr f (f a (treeFoldr_7 f x r)) (toList l)\n -- ^^^^^^^...........................^^^^^^^^^^\n</code></pre>\n\n<p>Again, same pattern.</p>\n\n<pre><code>treeFoldr_8 :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFoldr_8 _ x Null         = x\ntreeFoldr_8 f x (Node l a r) = \n    treeFoldr_8 f (f a (treeFoldr_8 f x r)) l\n</code></pre>\n\n<p>... and we are done. No more lists around!</p>\n\n<h1>Small test</h1>\n\n<pre><code>test :: Tree Int\ntest = Node \n       (Node Null 2 Null) \n       5 \n       (Node\n        (Node Null 4 Null)\n        1\n        (Node Null 7 Null))\n\nfoo :: Int -&gt; String -&gt; String\nfoo n s = \"(\" ++ show n ++ \", \" ++ s ++ \")\"\n\n--  *TreeFoldable&gt; treeFoldr_8 foo \"X\" test \n--  \"(2, (5, (4, (1, (7, X)))))\"\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 6390394, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ab0911e8409e70ac6c9183897decfed6?s=128&d=identicon&r=PG&f=1", "display_name": "ABBC", "link": "https://stackoverflow.com/users/6390394/abbc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1464353319, "creation_date": 1464343383, "last_edit_date": 1464347458, "question_id": 37480567, "link": "https://stackoverflow.com/questions/37480567/higher-order-haskell-functions-applied-to-trees", "title": "Higher Order Haskell Functions Applied to Trees", "body": "<p>I have the data type</p>\n\n<pre><code>data Tree a = Null | Node a {lTree, rTree :: Tree a}\n</code></pre>\n\n<p>I want to rewrite the following higher order functions so that they can apply to trees.</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; Tree a -&gt; Tree b \n\nfold :: (a -&gt; b -&gt; a) -&gt; a -&gt; Tree b -&gt; a\n\nfoldl :: (a -&gt; b -&gt; a) -&gt; a -&gt; Tree b -&gt; a \n\nfoldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b \n\nfilter :: (a -&gt; Bool) -&gt; Tree a -&gt; Tree a \n\nzip :: Tree a -&gt; Tree b -&gt; Tree (a,b) \n</code></pre>\n\n<p>I want to know how to write the functions explicitly, for example I know that the map function can be written: </p>\n\n<pre><code>treeMap :: (a -&gt;b) -&gt; Tree a -&gt; Tree b \ntreeMap f tree = case tree of \n    Null -&gt; Null \n    Node a Null Null -&gt; Node (f a) Null Null \n    Node a l r -&gt; Node (f a) (treeMap f l) (treeMap f r)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464344305, "post_id": 37479644, "comment_id": 62458570, "body": "Can you post your .cabal files from both projects? Try to come up with the smallest example which demonstrates the problem. I would like to see in the .cabal file how project B refers to stuff from project A."}, {"owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464362701, "post_id": 37479644, "comment_id": 62470730, "body": "I updated the question."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1464351251, "creation_date": 1464351251, "answer_id": 37483312, "question_id": 37479644, "link": "https://stackoverflow.com/questions/37479644/stack-using-binaries-of-other-package/37483312#37483312", "title": "Stack using binaries of other package", "body": "<p>I'll take a stab at answering your question...</p>\n\n<p>How about putting</p>\n\n<pre><code>~/.stack-work/install/x86_64-linux/lts-6.0/7.10.3/bin\n</code></pre>\n\n<p>in your <code>PATH</code>? If the other project really needs <em>binaries</em> (i.e. programs) built by another project, this would be the way to do it.</p>\n\n<p>Or, copy the built programs to some directory in your current <code>PATH</code> - i.e. /usr/local/bin or ~/bin.</p>\n\n<p>If this doesn't answer your question, please post the cabal files for both projects.</p>\n"}, {"tags": [], "owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "is_accepted": false, "score": 0, "last_activity_date": 1464363787, "creation_date": 1464363787, "answer_id": 37487546, "question_id": 37479644, "link": "https://stackoverflow.com/questions/37479644/stack-using-binaries-of-other-package/37487546#37487546", "title": "Stack using binaries of other package", "body": "<p>I found an answer after digging into the <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/faq.md\" rel=\"nofollow\">FAQ</a> of <code>stack</code>. Create a file <code>stack.yaml</code> into <code>B</code> folder. At first the content could be:</p>\n\n<pre><code>resolver: lts-6.0\npackages:\n- '.'\n- '/home/jonaprieto/A'\n\nextra-deps: []\n</code></pre>\n\n<p>Then, it runs:</p>\n\n<p><code>$ stack build</code></p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464363902, "creation_date": 1464363902, "answer_id": 37487587, "question_id": 37479644, "link": "https://stackoverflow.com/questions/37479644/stack-using-binaries-of-other-package/37487587#37487587", "title": "Stack using binaries of other package", "body": "<p>You don't need to include the project A's <code>bin</code> directory - that was a red herring.</p>\n\n<p>Organize your files like this:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 stack.yaml\n\u251c\u2500\u2500 project-A\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 LICENSE.txt\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Setup.hs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 project-A.cabal\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 ...\n\u2502\n\u2514\u2500\u2500 project-B\n \u00a0\u00a0 \u251c\u2500\u2500 Setup.hs\n \u00a0\u00a0 \u251c\u2500\u2500 project-B.cabal\n \u00a0\u00a0 \u2514\u2500\u2500 src\n \u00a0\u00a0     \u2514\u2500\u2500 ...\n</code></pre>\n\n<p>Your top-level stack.yaml file will look like:</p>\n\n<pre><code>resolver: lts-5.13\npackages:\n- project-A/\n- project-B/\n</code></pre>\n\n<p>Then in the top-level directory run <code>stack build</code>.</p>\n"}], "owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1464363902, "creation_date": 1464340800, "last_edit_date": 1464362658, "question_id": 37479644, "link": "https://stackoverflow.com/questions/37479644/stack-using-binaries-of-other-package", "title": "Stack using binaries of other package", "body": "<p>I have two projects in my user directory <code>~</code>, the project <code>A</code> and <code>B</code>.\nI run <code>stack init</code> and later <code>stack build</code> on the project <code>A</code>. Then, I have\nthe binaries of the <code>A</code> package in a folder <code>~/.stack-work/install/x86_64-linux/lts-6.0/7.10.3/bin</code>. The issue is <code>B</code> needs this version of the binaries from <code>A</code> package, and then try the same build with <code>stack</code> on the <code>B</code> project directory. I tried on <code>~/B</code> run the following command without success.</p>\n\n<p><code>stack build ~/.stack-work/install/x86_64-linux/lts-6.0/7.10.3/bin</code> </p>\n\n<p>How can I do that? What if I create a third package <code>C</code>, and need something similar?</p>\n\n<p>Excerpts:</p>\n\n<p>The <code>A.cabal</code> content.</p>\n\n<pre><code>name: A\nversion: 1.1\n</code></pre>\n\n<p>And the <code>B.cabal</code>.</p>\n\n<pre><code>name: B\nversion: 1.0\nbuild-depends: A&gt;= 1.1\n</code></pre>\n\n<p>Then,</p>\n\n<pre><code>$ stack init\nLooking for .cabal or package.yaml files to use to init the project.\nUsing cabal packages:\n- B.cabal\n\nSelecting the best among 8 snapshots...\n\n* Partially matches lts-6.0\n    A version 1.0 found\n        - A requires ==1.1\n</code></pre>\n\n<p>This may be resolved by:\n    - Using '--omit-packages to exclude mismatching package(s).\n    - Using '--resolver' to specify a matching snapshot/resolver</p>\n\n<p>But I actually have the version 1.1 of <code>A</code> build.</p>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1464341034, "post_id": 37479233, "comment_id": 62456392, "body": "@Carsten I guess. trying this now. my emacs by default launched stack ghci that&#39;s why I am looking into this"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464341241, "post_id": 37479233, "comment_id": 62456519, "body": "I had to test it to make sure but you should be able to load both if you just do <code>:load Logger.h mainLogger.hs</code> - I don&#39;t know if you can get GHCi to look for the missing module in the current folder if you have no cabal file (I usually just create one)"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464341468, "post_id": 37479233, "comment_id": 62456698, "body": "@Carsten yes ! it works. I tried loading one then the other (failed), but giving them both at the same time does work . can you put this as an answer ?"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464341518, "post_id": 37479233, "comment_id": 62456724, "body": "now unfortunately, emacs does them one at a time, but that&#39;s another issue"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464341699, "post_id": 37479233, "comment_id": 62456831, "body": "yes - based on the description I would have thought that it would look for a correctly named file in the current path (you can see that the path is right with <code>:show paths</code>) but nope sadly not"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464342591, "post_id": 37479233, "comment_id": 62457437, "body": "@Carsten the path look right indeed. I dont know why it would load under ghci but not under stack ghci. the only difference seems that paths are relative in <code>ghci</code> and absolute in <code>stack ghci</code>.. is it a bug ?"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1464343372, "last_edit_date": 1464343372, "creation_date": 1464341578, "answer_id": 37479923, "question_id": 37479233, "link": "https://stackoverflow.com/questions/37479233/stack-ghci-not-loading-up-local-modules/37479923#37479923", "title": "stack ghci not loading up local modules?", "body": "<p>You should be able to load both if you do it at the same time:</p>\n\n<pre><code>:load Logger.hs mainLogger.hs \n</code></pre>\n\n<p>I don't know if you can get GHCi to look for the missing module in the current folder if you have no cabal file but if you create/initialize one this is not necessary.</p>\n"}, {"tags": [], "owner": {"reputation": 406, "user_id": 1738086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44ffd4d27d01bce9b3425f88d83975a3?s=128&d=identicon&r=PG", "display_name": "Simon Courtenage", "link": "https://stackoverflow.com/users/1738086/simon-courtenage"}, "is_accepted": false, "score": 2, "last_activity_date": 1511431934, "creation_date": 1511431934, "answer_id": 47452868, "question_id": 37479233, "link": "https://stackoverflow.com/questions/37479233/stack-ghci-not-loading-up-local-modules/47452868#47452868", "title": "stack ghci not loading up local modules?", "body": "<p>This issue should now be fixed in the latest version of stack.  It seems that when a module imported a local module, stack wasn't including the local directory in its module search path.  In the latest 1.5.1. version of stack, this has been fixed - so you should be able to just type</p>\n\n<pre><code>stack ghci mainLogger.hs\n</code></pre>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1035, "favorite_count": 0, "accepted_answer_id": 37479923, "answer_count": 2, "score": 4, "last_activity_date": 1511431934, "creation_date": 1464339693, "last_edit_date": 1464340835, "question_id": 37479233, "link": "https://stackoverflow.com/questions/37479233/stack-ghci-not-loading-up-local-modules", "title": "stack ghci not loading up local modules?", "body": "<p>I have </p>\n\n<pre><code>mainLogger.hs\nLogger.hs\n</code></pre>\n\n<p>in my local directory where the mainLogger.hs reference the Logger module. </p>\n\n<p>When in <code>stack ghci</code> I <code>:load mainLogger.hs</code> I get the following error message :</p>\n\n<pre><code>mainLogger.hs:6:18:\n    Could not find module \u2018Logger\u2019\n    It is not a module in the current program, or in any known package.\n</code></pre>\n\n<p>However if I can compile <code>stack exec -- ghc mainLogger.hs</code> and run <code>stack runghc mainLogger2.hs</code> or have <code>stack exec -- ghci</code> load the module correctly.</p>\n\n<p>Anyone knows what is preventing <code>stack ghci</code> from locating module in the local directory ?</p>\n\n<p>ps : I am not using any cabal file or stack.yaml file in this directory, so it falls back onto my global stack.yaml config</p>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464432417, "post_id": 37478037, "comment_id": 62491145, "body": "in the <code>$(fmap ...)</code> case it seems that <code>Type0</code> gets defined but not <code>Type1</code> - is that right?"}, {"owner": {"reputation": 666, "user_id": 2316594, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PLyfY.jpg?s=128&g=1", "display_name": "Katty J.", "link": "https://stackoverflow.com/users/2316594/katty-j"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464432650, "post_id": 37478037, "comment_id": 62491201, "body": "@ErikR, that&#39;s right"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1464435085, "post_id": 37478037, "comment_id": 62491834, "body": "perhaps it will help - I added a bunch of trace statements: <a href=\"http://lpaste.net/164713\" rel=\"nofollow noreferrer\">lpaste.net/164713</a> - didn&#39;t see anything obvious though"}], "answers": [{"comments": [{"owner": {"reputation": 666, "user_id": 2316594, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PLyfY.jpg?s=128&g=1", "display_name": "Katty J.", "link": "https://stackoverflow.com/users/2316594/katty-j"}, "edited": false, "score": 0, "creation_date": 1464439134, "post_id": 37498853, "comment_id": 62493181, "body": "Yeah, I was hoping that once I made a new name for type &quot;Type0&quot;, the second call to <code>lookupTypeName</code> would return it. And that&#39;s not the case. So apparently I&#39;ll have to manage <code>(String, Name)</code> pairs by myself."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464439539, "last_edit_date": 1464439539, "creation_date": 1464437629, "answer_id": 37498853, "question_id": 37478037, "link": "https://stackoverflow.com/questions/37478037/type-declarations-in-template-haskell/37498853#37498853", "title": "Type declarations in Template Haskell", "body": "<p>Here's my assessment of what's happening...</p>\n\n<p>Consider this simplified example which also fails:</p>\n\n<pre><code>ty :: CType\nty = CProduct \"Type1\" [  (\"proj11\", CProduct \"Type0\" [(\"proj0\", CInt)]) ]\n</code></pre>\n\n<ol>\n<li><code>genType</code> is called with <code>CProduct \"Type1\" ...</code></li>\n<li>The declarations for the fields of <code>Type1</code> are generated (into <code>ts</code></li>\n<li><code>ts</code> contains the definition of <code>Type0</code>. This declaration works.</li>\n<li>Then <code>lookupTypName \"Type1\"</code> is called and this returns <code>Nothing</code></li>\n<li>So a new <code>DataD</code> is created with field definitions from  <code>fn</code></li>\n<li>But the field definitions don't refer to the declarations created in step 2.</li>\n</ol>\n\n<p>Somehow when <code>genField</code> is called for <code>\"proj11\"</code> you have to use the declarations returned in <code>ts</code> to create the field.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here is the inline version of what you need to do:</p>\n\n<pre><code>blah :: Q [Dec]\nblah = do\n  let ty_int = ConT ''Int\n  t0_cname &lt;- newName \"Type0\"\n  proj0_name &lt;-  newName \"proj0\"\n  let t0_rec = RecC t0_cname [ (proj0_name, NotStrict, ty_int) ]\n  t0_tname &lt;- newName \"Type0\"\n  let t0_decl = DataD [] t0_tname [] [t0_rec] []\n\n  proj11_name &lt;- newName \"proj11\"\n  t1_cname &lt;- newName \"Type1\"\n  let t1_rec = RecC t1_cname [ (proj11_name, NotStrict, ConT t0_tname) ]\n  t1_tname &lt;- newName \"Type1\"\n  let t1_decl = DataD [] t1_tname [] [t1_rec] []\n\n  return [t0_decl, t1_decl]\n</code></pre>\n\n<p>If you expand <code>$(blah)</code> it should work and in ghci you'll see:</p>\n\n<pre><code>*Main&gt; :i Type0\ndata Type0 = Type0 {proj0 :: Int}   -- Defined at ...\n*Main&gt; :i Type1\ndata Type1 = Type1 {proj11 :: Type0}    -- Defined at ...\n</code></pre>\n\n<p>The key is in the <code>t1_rec</code> assignment. For the type of the field you have to use the same name (<code>t0_name</code>) that was used in the <code>DataD</code> constructor for Type0.</p>\n"}, {"tags": [], "owner": {"reputation": 666, "user_id": 2316594, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PLyfY.jpg?s=128&g=1", "display_name": "Katty J.", "link": "https://stackoverflow.com/users/2316594/katty-j"}, "is_accepted": false, "score": 0, "last_activity_date": 1464443245, "creation_date": 1464443245, "answer_id": 37499793, "question_id": 37478037, "link": "https://stackoverflow.com/questions/37478037/type-declarations-in-template-haskell/37499793#37499793", "title": "Type declarations in Template Haskell", "body": "<p>Following version seems to work as intended:</p>\n\n<pre><code>genType :: [(String, Name)] -&gt; CType -&gt; Q Type\ngenType db CInt = return (ConT ''Int)\ngenType db CDouble = return (ConT ''Double)\ngenType db (CProduct s t) =\n    do\n      let \n          res = lookup s db\n      case res of\n        Nothing -&gt; return (TupleT 0)\n        Just n -&gt; return (ConT n)\n\ngenField :: [(String, Name)] -&gt; (String, CType) -&gt; Q VarStrictType\ngenField db (s , t) =\n    do\n      sn &lt;- newName s\n      tn &lt;- genType db t\n      return (sn, NotStrict, tn)\n\ntodb = map (\\(x, _) -&gt; (nameBase x, x))\ncrit (x, _) (y, _) = nameBase x == nameBase y \n\ngenDecl :: CType -&gt; Q [(Name, Dec)]\ngenDecl CInt = return []\ngenDecl CDouble = return []\ngenDecl (CProduct s t) =\n    do\n      ts &lt;- fmap (nubBy crit . join) . mapM (genDecl . snd) $ t\n      res0 &lt;- lookupTypeName s\n      let\n          db = todb ts\n          res1 = lookup s db       \n      case (res0 , res1) of\n        (Just _ , Just _) -&gt; return ts\n        (Just _ , Nothing) -&gt; return ts\n        (Nothing , Just _) -&gt; return ts\n        (Nothing , Nothing) -&gt;\n            do\n              sn &lt;- newName s\n              sc &lt;- newName s\n              fs &lt;- mapM (genField db) $ t\n              let\n                  dt = DataD [] sn [] [RecC sc fs] []\n              return ((sn, dt) : ts)           \n</code></pre>\n"}], "owner": {"reputation": 666, "user_id": 2316594, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PLyfY.jpg?s=128&g=1", "display_name": "Katty J.", "link": "https://stackoverflow.com/users/2316594/katty-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1464443245, "creation_date": 1464336088, "last_edit_date": 1464351949, "question_id": 37478037, "link": "https://stackoverflow.com/questions/37478037/type-declarations-in-template-haskell", "title": "Type declarations in Template Haskell", "body": "<p>Consider the following type (in Haskell):</p>\n\n<pre><code>data CType = CInt | CDouble | CProduct String [(String, CType)]\n</code></pre>\n\n<p>I would like to have a function that would generate corresponding Haskell type declarations. Constructors <code>CInt</code> and <code>CDouble</code> should correspond to <code>Int</code> and <code>Double</code> types thus result in no declaration. <code>(CProduct t ts)</code> should correspond to the record type with name and constructor defined by <code>t</code> and fields defined by <code>ts</code> list. For example:</p>\n\n<pre><code>ty :: CType\nty = CProduct \"Type1\" [(\"proj10\", CDouble), (\"proj11\", CProduct \"Type0\" [(\"proj0\", CInt)])]\n</code></pre>\n\n<p>should result in two definitions:</p>\n\n<pre><code>data Type0 = Type0 {proj0 :: Int}\ndata Type1 = Type1 {proj10 :: Double, proj11 :: Type0} \n</code></pre>\n\n<p>To define this function I use Template Haskell:</p>\n\n<pre><code>genType :: CType -&gt; Q Type\ngenType CInt = return (ConT ''Int)\ngenType CDouble = return (ConT ''Double)\ngenType (CProduct s t) =\n    do\n      l &lt;- lookupTypeName s\n      case l of\n        Just sn -&gt; return (ConT sn)\n        Nothing -&gt;\n            do\n              sn &lt;- newName s\n              return (ConT sn)\n\ngenField :: (String, CType) -&gt; Q VarStrictType\ngenField (s , t) =\n    do\n      sn &lt;- newName s\n      tn &lt;- genType t\n      return (sn, NotStrict, tn)\n\ngenDecl :: CType -&gt; Q [Dec]\ngenDecl CInt = return []\ngenDecl CDouble = return []\ngenDecl (CProduct s t) =\n    do\n      ts &lt;- fmap join . mapM (genDecl . snd) $ t\n      res &lt;- lookupTypeName s\n      case res of\n        Just _ -&gt; return ts\n        Nothing -&gt;\n            do\n              sn &lt;- newName s\n              sc &lt;- newName s      \n              fn &lt;- mapM genField $ t\n              let\n                  dt = DataD [] sn [] [RecC sc fn] []\n              return (dt : ts)\n</code></pre>\n\n<p>When I invoke the function with <code>$(genDecl ty)</code> for <code>ty :: CType</code> defined above I get following error:</p>\n\n<pre><code>The exact Name \u2018Type0_adN6\u2019 is not in scope \u2026\n      Probable cause: you used a unique Template Haskell name (NameU), \n      perhaps via newName, but did not bind it\n</code></pre>\n\n<p>But when I generate definitions one by one everything is fine:</p>\n\n<pre><code>$(fmap (\\[x, y] -&gt; [y]) . genDecl $ ty)\n\n$(genDecl $ ty)\n</code></pre>\n\n<p><strong>So the question is</strong>: how to properly add type declarations in <code>Q</code> monad to generate them all at once?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464336254, "post_id": 37477639, "comment_id": 62453484, "body": "All servers should check the request size. Check your <code>maximumContentLength</code> (on your foundation), default value is 2M (related <a href=\"http://stackoverflow.com/questions/10880105/efficient-large-file-upload-with-yesod\" title=\"efficient large file upload with yesod\">stackoverflow.com/questions/10880105/&hellip;</a>)"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464338192, "post_id": 37477639, "comment_id": 62454639, "body": "The message is not that big, just a table about 8x5 cells ..."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 1, "creation_date": 1464339372, "post_id": 37477639, "comment_id": 62455380, "body": "Ok, the default session backend is one cookie ~4Kbytes. Probably you should sent message into response or store in any backend to get back in future requests."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464349234, "post_id": 37477639, "comment_id": 62461509, "body": "I&#39;ll have a look at that thanks."}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1464334904, "creation_date": 1464334904, "question_id": 37477639, "link": "https://stackoverflow.com/questions/37477639/has-yesod-setmessage-function-a-size-limit", "title": "Has Yesod setMessage function a size limit?", "body": "<p>I'm using Yesod and I'm experiencing a strange bug.\nI'm uploading csv file and when the format is incorrect I display as a message (using <code>setMessage</code>) the uploaded file with some error message. When the file is too big, I don't get any message at all, as if I didn't set the message (or the message has been discarded).</p>\n\n<p>I'm pretty sure the problem is on my side, but ss it possible that <code>setMessage</code> a size limit and discart too big message ? I guess <code>setMessage</code> uses session or something and it might have some restrictions .</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464336338, "post_id": 37474405, "comment_id": 62453537, "body": "You might want to read about <a href=\"http://stackoverflow.com/q/28624408/3234959\"><code>let</code> vs <code>&lt;-</code></a>. It is not the exact issue you are having now, but it might help."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1464342994, "post_id": 37474405, "comment_id": 62457706, "body": "Read <a href=\"http://stackoverflow.com/q/20324446/510937\">Why can&#39;t I force an IO action with seq?</a> for a bit more info on evaluating vs executing IO actions."}], "answers": [{"tags": [], "owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "is_accepted": false, "score": 13, "last_activity_date": 1464324946, "last_edit_date": 1464324946, "creation_date": 1464320894, "answer_id": 37474518, "question_id": 37474405, "link": "https://stackoverflow.com/questions/37474405/understanding-type-of-io-in-let-expression/37474518#37474518", "title": "Understanding Type of IO () in `let` Expression", "body": "<blockquote>\n  <p>What is <code>f</code>'s type?</p>\n</blockquote>\n\n<p>As you have correctly identified, it is <code>IO ()</code> which can be thought of as an IO action that returns nothing useful (<code>()</code>)</p>\n\n<blockquote>\n  <p>Why does \"foo\" not get printed before showing the result of <code>42</code>?</p>\n</blockquote>\n\n<p>Haskell is lazily evaluated, but even <code>seq</code> is not enough in this case. An IO action will only be performed in the REPL if the expression returns the IO action. An IO action will only be performed in a program if it's returned by <code>main</code>. However, there are ways to get around this limitation.</p>\n\n<blockquote>\n  <p>Lastly, why doesn't the following work?</p>\n</blockquote>\n\n<p>Haskell's <code>let</code> names a value within the scope of an expression, so after the expression has been evaluated <code>f</code> goes out of scope.</p>\n"}, {"tags": [], "owner": {"reputation": 5004, "user_id": 327815, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/17f2e18da0338911cd6ea464ff2613d1?s=128&d=identicon&r=PG", "display_name": "Jokester", "link": "https://stackoverflow.com/users/327815/jokester"}, "is_accepted": false, "score": 7, "last_activity_date": 1466476981, "last_edit_date": 1466476981, "creation_date": 1464321223, "answer_id": 37474563, "question_id": 37474405, "link": "https://stackoverflow.com/questions/37474405/understanding-type-of-io-in-let-expression/37474563#37474563", "title": "Understanding Type of IO () in `let` Expression", "body": "<p><code>f</code> will be of type <code>IO ()</code>.</p>\n\n<p>\"foo\" is not printed because <code>f</code> is not 'binded' to real world. (I can't say this is a friendly explanation. If this sounds nonsense, you may want to refer some tutorial to catch the idea of Monad and lazy evaluation).</p>\n\n<p><code>let name = value in (scope)</code> makes the value available in, but not out of the scope, so <code>:t</code> won't find it in ghci's top level scope.</p>\n\n<p><code>let</code> without <code>in</code> makes it available to <code>:t</code> (this code is only valid in ghci):</p>\n\n<pre><code>&gt; let f = putStrLn \"foo\"\n&gt; :t f\nf :: IO ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 10, "last_activity_date": 1464336146, "creation_date": 1464336146, "answer_id": 37478055, "question_id": 37474405, "link": "https://stackoverflow.com/questions/37474405/understanding-type-of-io-in-let-expression/37478055#37478055", "title": "Understanding Type of IO () in `let` Expression", "body": "<p><code>let f = ...</code> simply defines <code>f</code>, and does not \"run\" anything. It is vaguely similar to a definition of a new function in imperative programming.</p>\n\n<p>Your full code <code>let f = putStrLn \"foo\" in 42</code> could be loosely translated to</p>\n\n<pre><code>{\n  function f() {\n     print(\"foo\");\n  }\n  return 42;\n}\n</code></pre>\n\n<p>You wouldn't expect the above to print anything, right?</p>\n\n<p>By comparison, <code>let f = putStrLn \"foo\" in do f; f; return 42</code> is similar to</p>\n\n<pre><code>{\n  function f() {\n     print(\"foo\");\n  }\n  f();\n  f();\n  return 42;\n}\n</code></pre>\n\n<p>The correspondence is not perfect, but hopefully you get the idea.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 4, "last_activity_date": 1464340166, "creation_date": 1464340166, "answer_id": 37479402, "question_id": 37474405, "link": "https://stackoverflow.com/questions/37474405/understanding-type-of-io-in-let-expression/37479402#37479402", "title": "Understanding Type of IO () in `let` Expression", "body": "<p>There are two things going on here.</p>\n\n<p>First, consider</p>\n\n<pre><code>let x = sum [1..1000000] in 42\n</code></pre>\n\n<p>Haskell is <em>lazy</em>. Since we don't actually do anything with <code>x</code>, it is never computed. (Which is just as well, because it would be mildly slow.) Indeed, if you compile this, the compiler will see that <code>x</code> is never used, and delete it (i.e., not generate any compiled code for it).</p>\n\n<p>Second, calling <code>putStrLn</code> does not actually <em>print</em> anything. Rather, it returns <code>IO ()</code>, which you can think of as a kind of \"I/O command object\". Merely having a command object is different from <em>executing</em> the it. By design, the only way to \"execute\" an I/O command object is to return it from <code>main</code>. At least, it is in a complete program; GHCi has the helpful feature that if you enter an expression that returns an I/O command object, GHCi will execute it for you.</p>\n\n<p>Your expression returns 42; again, <code>f</code> isn't used, so it doesn't do anything.</p>\n\n<p>As <code>chi</code> rightly points out, it's a bit like declaring a local (zero-argument) function but never calling it. You wouldn't expect to see any output.</p>\n\n<p>You can also do something like</p>\n\n<pre><code>actions = [print 5, print 6, print 7, print 8]\n</code></pre>\n\n<p>This creates a list of I/O command objects. But, again, it does not <em>execute</em> any of them.</p>\n\n<p>Typically when you write a function that does I/O, it's a do-block that chains everything into one giant I/O command object and returns it to the caller. In that case, you don't really need to understand or thing about this distinction between <em>defining</em> a command object and <em>executing</em> it. But the distinction is still there.</p>\n\n<p>It's perhaps easier to see this with a monad that has an explicit run-function. For example, <code>runST</code> takes an ST command object, runs it, and gives you back the answer. But (say) <code>newSTVar</code>, by itself, does nothing but construct an ST command; you have to <code>runST</code> that before anything actually \"happens\".</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "answer_count": 4, "score": 15, "last_activity_date": 1466476981, "creation_date": 1464320000, "question_id": 37474405, "link": "https://stackoverflow.com/questions/37474405/understanding-type-of-io-in-let-expression", "title": "Understanding Type of IO () in `let` Expression", "body": "<p>Given:</p>\n\n<pre><code>\u03bb: let f = putStrLn \"foo\" in 42\n42\n</code></pre>\n\n<p>What is <code>f</code>'s type? Why does <code>\"foo\"</code> not get printed before showing the result of <code>42</code>?</p>\n\n<p>Lastly, why doesn't the following work?</p>\n\n<pre><code>\u03bb: :t f\n\n&lt;interactive&gt;:1:1: Not in scope: \u2018f\u2019\n</code></pre>\n"}, {"tags": ["function", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 14326, "user_id": 181150, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9df3da994139c4dc56900b170d8824a6?s=128&d=identicon&r=PG", "display_name": "markovuksanovic", "link": "https://stackoverflow.com/users/181150/markovuksanovic"}, "edited": false, "score": 0, "creation_date": 1464309159, "post_id": 37472947, "comment_id": 62444577, "body": "Makes perfect sense. Thanks!"}], "tags": [], "owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "is_accepted": true, "score": 1, "last_activity_date": 1464308122, "creation_date": 1464308122, "answer_id": 37472947, "question_id": 37472850, "link": "https://stackoverflow.com/questions/37472850/haskell-function-definition-and-arguments-list/37472947#37472947", "title": "Haskell function definition and arguments list", "body": "<p>Haskell does not need to decide where to place <code>abc</code>. When you call <code>reverseWords</code> in your second example it will simply return <code>unwords . map reverse . words</code>.</p>\n\n<p>And then abc gets applied to that with which you will end up with the same result as in your first example.</p>\n\n<p>This is also called Point-free style as you can read more about it here: <a href=\"https://wiki.haskell.org/Point-free\" rel=\"nofollow\">https://wiki.haskell.org/Point-free</a></p>\n"}], "owner": {"reputation": 14326, "user_id": 181150, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9df3da994139c4dc56900b170d8824a6?s=128&d=identicon&r=PG", "display_name": "markovuksanovic", "link": "https://stackoverflow.com/users/181150/markovuksanovic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 37472947, "answer_count": 1, "score": 1, "last_activity_date": 1464308122, "creation_date": 1464307415, "question_id": 37472850, "link": "https://stackoverflow.com/questions/37472850/haskell-function-definition-and-arguments-list", "title": "Haskell function definition and arguments list", "body": "<p>I have the following function definitions (which are equivalent):</p>\n\n<pre><code>reverseWords :: String -&gt; String\nreverseWords wds = unwords . map reverse . words $ wds\n</code></pre>\n\n<p>and</p>\n\n<pre><code>reverseWords :: String -&gt; String\nreverseWords = unwords . map reverse . words\n</code></pre>\n\n<p>I understand that they are equivalent as they yield the same result but I'm a bit confused about the second form.</p>\n\n<p>If I call a function like:</p>\n\n<pre><code>reverseWords abc\n</code></pre>\n\n<p>How does haskell decide where to place this 'abc' parameter?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1464299300, "post_id": 37471250, "comment_id": 62441757, "body": "Note that <code>comp2 == flip on</code>, where <code>on</code> is defined in <code>Data.Function</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1464298930, "last_edit_date": 1464298930, "creation_date": 1464298222, "answer_id": 37471343, "question_id": 37471250, "link": "https://stackoverflow.com/questions/37471250/beginner-haskell-how-to-implement-this-function/37471343#37471343", "title": "Beginner Haskell - how to implement this function?", "body": "<p>You've <em>implemented</em> <code>comp2</code> just fine. You just don't <em>use</em> it right. The arguments to <code>comp2</code> are both functions. Is <code>3</code> a function? I daresay not.</p>\n\n<p>Haskell compilers have an extremely open mind though &ndash; GHC assumes that <code>a -&gt; b</code> <em>could</em> possibly have a <code>Num</code> instance (which is what's required to use numerical literals). Hence it doesn't give an error like <code>Couldn't match type `a -&gt; b` with numerical literal `3`</code>, but tries to go on with the assumption that there <em>must</em> be such an instance because you are invoking it. But to actually <em>search</em> for that instance, the compiler needs to have <code>FlexibleContexts</code> enabled.</p>\n\n<pre><code>Prelude&gt; comp2 3 4\n\n&lt;interactive&gt;:9:1:\n    Non type-variable argument in the constraint: Num (a -&gt; b)\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall a b c.\n            (Num (a -&gt; b), Num (b -&gt; b -&gt; c)) =&gt;\n            a -&gt; a -&gt; c\nPrelude&gt; :set -XFlexibleContexts \nPrelude&gt; comp2 3 4\n\n&lt;interactive&gt;:11:1:\n    Could not deduce (Num (a -&gt; b0))\n    from the context (Num (a -&gt; b), Num (b -&gt; b -&gt; c))\n      bound by the inferred type for \u2018it\u2019:\n                 (Num (a -&gt; b), Num (b -&gt; b -&gt; c)) =&gt; a -&gt; a -&gt; c\n      at &lt;interactive&gt;:11:1-9\n    The type variable \u2018b0\u2019 is ambiguous\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall a b c.\n            (Num (a -&gt; b), Num (b -&gt; b -&gt; c)) =&gt;\n            a -&gt; a -&gt; c\n    Probable cause: the inferred type is ambiguous\n</code></pre>\n\n<p>This is still not as clear as we'd like, but it points out the problem: you try to use function types as number types.</p>\n"}, {"tags": [], "owner": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "is_accepted": true, "score": 1, "last_activity_date": 1464298387, "creation_date": 1464298387, "answer_id": 37471382, "question_id": 37471250, "link": "https://stackoverflow.com/questions/37471250/beginner-haskell-how-to-implement-this-function/37471382#37471382", "title": "Beginner Haskell - how to implement this function?", "body": "<p>Are you sure you mean implement and not use?\nIf you look at <code>comp2 :: (a -&gt; b) -&gt; (b -&gt; b -&gt; c) -&gt; (a -&gt; a -&gt; c)</code>, it is possible to see that comp2 takes two functions, f and g. To use comp2, you need to give it two functions and probably two values. Try this</p>\n\n<pre><code>comp2 (*2) (+) 2 3\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 3786813, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e89832a40fc616b33de68554d4c985b8?s=128&d=identicon&r=PG&f=1", "display_name": "thepen", "link": "https://stackoverflow.com/users/3786813/thepen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 37471382, "answer_count": 2, "score": 2, "last_activity_date": 1464298930, "creation_date": 1464297823, "question_id": 37471250, "link": "https://stackoverflow.com/questions/37471250/beginner-haskell-how-to-implement-this-function", "title": "Beginner Haskell - how to implement this function?", "body": "<p>This code is taken from <a href=\"https://wiki.haskell.org/Partial_application\" rel=\"nofollow\">https://wiki.haskell.org/Partial_application</a></p>\n\n<p>I'm attempting to implement this function : </p>\n\n<pre><code>comp2 :: (a -&gt; b) -&gt; (b -&gt; b -&gt; c) -&gt; (a -&gt; a -&gt; c)\ncomp2 f g = (\\x y -&gt; g (f x) (f y))\n</code></pre>\n\n<p>using </p>\n\n<pre><code>*Main&gt; comp2 3 4\n</code></pre>\n\n<p>but receive exception : </p>\n\n<pre><code>&lt;interactive&gt;:19:1:\n    Non type-variable argument in the constraint: Num (a -&gt; b)\n    (Use FlexibleContexts to permit this)\n    When checking that `it' has the inferred type\n      it :: forall a b c.\n            (Num (a -&gt; b), Num (b -&gt; b -&gt; c)) =&gt;\n            a -&gt; a -&gt; c\n*Main&gt; \n</code></pre>\n\n<p>How to implement <code>comp2</code> function ? </p>\n"}, {"tags": ["haskell", "types", "type-inference", "unification"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1464295445, "post_id": 37470354, "comment_id": 62439938, "body": "You are right that it is hard to write an interesting function of that type; but the <i>reason</i> you gave is incorrect. It is certainly allowed to write functions which result in ambiguous types when applied in certain ways."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1464297774, "post_id": 37470354, "comment_id": 62441107, "body": "Any type that\u2019s not a tautology when interpreted as a logical formula is the type of a partial function, which must throw an error or loop forever, at least for some inputs. <code>forall a b. a -&gt; b</code> isn\u2019t a tautology, as you can easily think of counterexamples: <code>Int -&gt; Void</code> for example\u2014just because you gave me an <code>Int</code> doesn\u2019t mean I can give you a <code>Void</code>! Same goes for <code>head :: [a] -&gt; a</code>. You can tell just by looking at the type that it can\u2019t return a result if you give it an empty list <code>[]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1342, "user_id": 1574374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6f66f66b0b5781a51040183831d6403?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Harris", "link": "https://stackoverflow.com/users/1574374/mike-harris"}, "edited": false, "score": 0, "creation_date": 1464294997, "post_id": 37470444, "comment_id": 62439687, "body": "I don&#39;t think it&#39;s cheating at all. If you&#39;re going to return a value of an unknown/unspecified type, I can&#39;t think of any other value you could possibly return except bottom."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464295304, "post_id": 37470444, "comment_id": 62439851, "body": "&quot;Exactly one&quot; is probably a bit strong. If you mean semantically, then there are other options like <code>f = undefined</code> and <code>f x = seq x undefined</code> that are not really different in a practical way, and if you mean practically, then there are other options like <code>f x = f x</code> (i.e. that loop instead of throwing an exception) that are not really different in a semantic way. And of course there&#39;s the obvious caveat, which lives in a strange space both semantically and practically..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464296320, "post_id": 37470444, "comment_id": 62440373, "body": "@DanielWagner Would it be fair to say exactly one <i>pure</i> function?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464297249, "post_id": 37470444, "comment_id": 62440865, "body": "@chepner What makes <code>f = undefined</code> or <code>f x = f x</code> less pure than <code>f _ = undefined</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1464297531, "post_id": 37470444, "comment_id": 62440986, "body": "I meant for <code>f x = seq x undefined</code>; looking only at the input and output, that&#39;s the same as <code>f x = undefined</code>. As for <code>f = undefined</code>, isn&#39;t that the same as <code>f _ = undefined</code> if you assume that <code>f :: a -&gt; b</code>? (The only difference being in the former you have <code>undefined :: a -&gt; b</code> and in the latter <code>undefined :: b</code>.) I don&#39;t really understand the exact semantics of <code>undefined</code> well enough to say if <code>f x = f x</code> is the same as or different from <code>f _ = undefined</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464311829, "post_id": 37470444, "comment_id": 62445159, "body": "@chepner Semantically, <code>f = undefined</code> and <code>f _ = undefined</code> are different: one is bottom and the other is not. But you are right to point out that <code>f _ = undefined</code> and <code>f x = seq x undefined</code> are semantically the same."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1464312203, "post_id": 37470444, "comment_id": 62445246, "body": "I think I was getting carried away with <code>undefined :: a</code>, assuming that you could think of <code>a</code> as being a function type as well, then applying that &quot;function&quot; to another value."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464471287, "post_id": 37470444, "comment_id": 62502904, "body": "@chepner Yes, you can do that."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1464294742, "creation_date": 1464294742, "answer_id": 37470444, "question_id": 37470354, "link": "https://stackoverflow.com/questions/37470354/function-with-type-a-b-in-haskell/37470444#37470444", "title": "Function with type a -&gt; b in Haskell?", "body": "<p>There is, I think, exactly one, but it is cheating a little bit:</p>\n\n<pre><code>&gt; let f _ = undefined\n&gt; :t f\nf:: t -&gt; t1\n</code></pre>\n\n<p>This only exists because bottom is considered a value of every type.</p>\n"}, {"comments": [{"owner": {"reputation": 275, "user_id": 4063232, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc076ef5cdf00a8551d2c861ca91717b?s=128&d=identicon&r=PG&f=1", "display_name": "SebiSebi", "link": "https://stackoverflow.com/users/4063232/sebisebi"}, "edited": false, "score": 0, "creation_date": 1464301629, "post_id": 37470750, "comment_id": 62442605, "body": "Ok! I got it! :) Thanks for the answer :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1464336386, "last_edit_date": 1464336386, "creation_date": 1464295898, "answer_id": 37470750, "question_id": 37470354, "link": "https://stackoverflow.com/questions/37470354/function-with-type-a-b-in-haskell/37470750#37470750", "title": "Function with type a -&gt; b in Haskell?", "body": "<p>Barring &perp; (<em>bottom value</em> &ndash; <code>undefined</code> etc.), which is always possible but never useful, there can indeed be no such function. This is one of the simplest instances of the so-called <a href=\"http://dl.acm.org/citation.cfm?doid=99370.99404\" rel=\"nofollow\">free theorems</a> that we get from polymorphic type signatures.</p>\n\n<p>You're on the right track with your intuitive explanation of why this is not possible, though it went off in the end. Yes, you can consider <code>f (5 :: Int)</code>. The problem is <em>not</em> that the compiler &ldquo;can't infer&rdquo; what <code>b</code> would be &ndash; that would be the case for many realistic functions, e.g. </p>\n\n<pre><code>fromIntegral :: (Num b, Integral a) =&gt; a -&gt; b\n</code></pre>\n\n<p>makes perfect sense; <code>b</code> will be inferred <em>from the environment</em> in which <code>fromIntegral x</code> is used. For instance, I might write<sup>&dagger;</sup></p>\n\n<pre><code>average :: [Double] -&gt; Double\naverage l = sum l / fromIntegral (length l)\n</code></pre>\n\n<p>In this case, <code>length l :: a</code> has the fixed type <code>Int</code> and <code>fromIntegral (length l) :: b</code> must have the fixed type <code>Double</code> to fit in the environment, and unlike in most other languages with type inference, information from the environment is available hereto in a Hindley-Milner based language.</p>\n\n<p>No, the problem with <code>f :: a -&gt; b</code> is that you could instantiate <code>a</code> and <code>b</code> to <em>any</em> ridiculous combination of types, not just different number types. Because <code>f</code> is unconstrainedly polymorphic, it would have to be able to convert <em>any type into any other type</em>.</p>\n\n<p>In particular, it would be able to convert into the <em>vacuous type</em> <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Void.html#t:Void\" rel=\"nofollow\"><code>Void</code></a>.</p>\n\n<pre><code>evil :: Int -&gt; Void\nevil = f\n</code></pre>\n\n<p>And then I could have</p>\n\n<pre><code>muahar :: Void\nmuahar = f 0\n</code></pre>\n\n<p>But, by construction of <code>Void</code>, there <em>cannot</em> be a value of this type (save for &perp; which you can't evaluate without either crashing or looping infinitely).</p>\n\n<p><hr>\n<sup>&dagger;</sup><sub>It should be noted that this is by some standards not a very good way of computing the average.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1464296779, "post_id": 37470817, "comment_id": 62440608, "body": "Adding a type constraint changes the problem, though, in the same way asking how many functions have type <code>a -&gt; a</code> depends on whether or not there are constraints. For example, <code>id</code> is the only function of type <code>a -&gt; a</code>, but there are lots of functions of type <code>Num a =&gt; a -&gt; a</code>."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 0, "last_activity_date": 1464299394, "last_edit_date": 1464299394, "creation_date": 1464296110, "answer_id": 37470817, "question_id": 37470354, "link": "https://stackoverflow.com/questions/37470354/function-with-type-a-b-in-haskell/37470817#37470817", "title": "Function with type a -&gt; b in Haskell?", "body": "<blockquote>\n  <p>... but what is <code>b</code> since Haskell cannot infer it from the arguments I gave?</p>\n</blockquote>\n\n<p>Depending on the context, Haskell can infer the return type; say:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, TypeSynonymInstances, FlexibleInstances #-}\n\nclass Cast a b where\n    cast :: a -&gt; b\n\ninstance Cast a a where\n    cast = id\n\ninstance Cast Int String where\n    cast = show\n\ninstance Cast Int Double where\n    cast = fromIntegral\n</code></pre>\n\n<p>then, </p>\n\n<pre><code>cast :: Cast a b =&gt; a -&gt; b\n</code></pre>\n\n<p>and if given enough context, Haskell knows which function to use:</p>\n\n<pre><code>\\&gt; let a = 42 :: Int\n\\&gt; let b = 100.0 :: Double\n\n\\&gt; \"string: \" ++ cast a  -- Int -&gt; String\n\"string: 42\"\n\n\\&gt; b * cast a            -- Int -&gt; Double\n4200.0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1464341056, "creation_date": 1464341056, "answer_id": 37479736, "question_id": 37470354, "link": "https://stackoverflow.com/questions/37470354/function-with-type-a-b-in-haskell/37479736#37479736", "title": "Function with type a -&gt; b in Haskell?", "body": "<p>In order to implement <code>f :: a -&gt; b</code>, it means that <code>f</code> has to be able to return <em>any possible type</em>. Even types that don't exist today, but somebody could define in ten years' time. Without some kind of reflection feature, that's obviously impossible.</p>\n\n<p>Well... \"impossible\" is a big word... As the other answers point out, it's impossible <em>excluding bottom</em>. In other words, <code>f</code> can never <em>return</em> a value of type <code>b</code>. It <em>can</em> throw an exception, or loop forever. But (arguably) neither of those things is really \"returning a value\".</p>\n\n<pre><code>f1 :: a -&gt; b\nf1 = error \"f1\"\n\nf2 :: a -&gt; b\nf2 s = error \"f2\"\n\nf3 :: a -&gt; b\nf3 x = f3 x\n</code></pre>\n\n<p>These functions are all subtly different, and they all compile just fine. And, of course, <em>they're all useless!</em> So yes, there is no <em>useful</em> function with type <code>a -&gt; b</code>.</p>\n\n<p>If you want to split hairs:</p>\n\n<ul>\n<li><code>f1</code> throws an exception.</li>\n<li><code>f1 'x'</code> throws an exception.</li>\n<li><code>f2</code> is a normal-looking function.</li>\n<li><code>f2 'x'</code> throws an exception.</li>\n<li><code>f3</code> is a normal-looking function.</li>\n<li><code>f3 'x'</code> doesn't throw an exception, but it loops forever, so it never actually <em>returns</em> anything.</li>\n</ul>\n\n<p>Basically any function you see that returns \"any type\" is a function that never actually returns. We can see this in unusual monads. For example:</p>\n\n<pre><code>f4 :: a -&gt; Maybe b\n</code></pre>\n\n<p>It is <em>perfectly possible</em> to implement this function without throwing an exception or looping forever.</p>\n\n<pre><code>f4 x = Nothing\n</code></pre>\n\n<p>Again, we're not actually <em>returning</em> a <code>b</code>. We could similarly do</p>\n\n<pre><code>f5 :: a -&gt; [b]\nf5 x = []\n\nf6 :: a -&gt; Either String b\nf6 x = Left \"Not here\"\n\nf7 :: a -&gt; Parser b\nf7 x = fail \"Not here\"\n</code></pre>\n"}], "owner": {"reputation": 275, "user_id": 4063232, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc076ef5cdf00a8551d2c861ca91717b?s=128&d=identicon&r=PG&f=1", "display_name": "SebiSebi", "link": "https://stackoverflow.com/users/4063232/sebisebi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2205, "favorite_count": 0, "accepted_answer_id": 37470750, "answer_count": 4, "score": 2, "last_activity_date": 1464341056, "creation_date": 1464294382, "last_edit_date": 1464294742, "question_id": 37470354, "link": "https://stackoverflow.com/questions/37470354/function-with-type-a-b-in-haskell", "title": "Function with type a -&gt; b in Haskell?", "body": "<p>Is there any kind of function in Haskell that has type <code>a -&gt; b</code>? That means, is it possible to write a function such that <code>f :: a -&gt; b</code>? I don't think a function like that exists for the following reason: suppose that we found f where <code>f :: a -&gt; b</code>, what would <code>f 2</code> produce? a value of type <code>b</code>, but what is <code>b</code> since Haskell cannot infere (I think) it from the arguments I gave? Is this correct? Otherwise, can you give me an example of such a function?  </p>\n"}, {"tags": ["json", "haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1464292840, "post_id": 37469508, "comment_id": 62438565, "body": "I wanted to avoid writing code to serialize it manually due to relatively big number of properties (some of them <code>Maybe</code>, some nested) and number of constructors. But if there is no other option, I will go with it"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1464294173, "post_id": 37469508, "comment_id": 62439223, "body": "@klappvisor It shouldn&#39;t matter whether your fields are nested or <code>Maybe</code>s, so long as each field&#39;s type is a <code>ToJSON</code> instance."}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464300558, "post_id": 37469508, "comment_id": 62442221, "body": "@DanielWagner I use <code>defaultOptions { omitNothingFields = True }</code> so I guess I have to if I want to omit them"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1464291006, "creation_date": 1464291006, "answer_id": 37469508, "question_id": 37468850, "link": "https://stackoverflow.com/questions/37468850/how-to-serialize-record-sum-data-type-in-aeson-without-tag/37469508#37469508", "title": "How to serialize record sum data type in Aeson without tag?", "body": "<p>Just define the <code>ToJSON</code> instance yourself:</p>\n\n<pre><code>instance ToJSON AB where\n    toJSON (A ab a) = object [ \"ab\" .= ab, \"a\" .= a ]\n    toJSON (B ab a) = object [ \"ab\" .= ab, \"a\" .= a ]\n\nab1 = A \"foo\" \"bar\"\nab2 = A \"abc\" \"def\"\n\n*Main&gt; import qualified Data.ByteString.Lazy.Char8 as LBS\n*Main LBS&gt; LBS.putStrLn $ encode ab2\n{\"ab\":\"abc\",\"a\":\"def\"}\n*Main LBS&gt; LBS.putStrLn $ encode ab1\n{\"ab\":\"foo\",\"a\":\"bar\"}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1464300383, "post_id": 37470457, "comment_id": 62442167, "body": "I guess it&#39;s better to take it and wait or contribute to Aeson. That hack was exactly what I was looking for. Thanks!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1464294774, "creation_date": 1464294774, "answer_id": 37470457, "question_id": 37468850, "link": "https://stackoverflow.com/questions/37468850/how-to-serialize-record-sum-data-type-in-aeson-without-tag/37470457#37470457", "title": "How to serialize record sum data type in Aeson without tag?", "body": "<p>A hacky way is to simply delete the <code>tag</code> from the resulting object:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nimport Data.Aeson\nimport Data.HashMap.Strict\nimport Data.String\nimport Data.Text\nimport GHC.Generics\n\ndata AB\n  = A { ab :: Text\n      , a  :: Text\n      }\n  | B { ab :: Text\n      , b  :: Text\n      }\n  deriving Generic\n\ninstance ToJSON AB where\n  toJSON ab = case genericToJSON defaultOptions ab of\n    Object o -&gt; Object (delete (fromString \"tag\") o)\n    _ -&gt; error \"impossible\"\n</code></pre>\n\n<p>It'll probably come back to bite you when the generic instance inevitably changes, though, so if you do this, be conscious of the technical debt you are choosing to take on.</p>\n"}, {"comments": [{"owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "edited": false, "score": 0, "creation_date": 1616948172, "post_id": 51976584, "comment_id": 118156314, "body": "To give an example, I think this is the minimal code needed for both serialization and deserialization to work without tag: data Foo = FooA { x :: Int } | FooB { y :: Int } deriving (Generic, Show); instance ToJSON Foo where     toEncoding = genericToEncoding (defaultOptions { sumEncoding = UntaggedValue }); instance FromJSON Foo where     parseJSON = genericParseJSON (defaultOptions { sumEncoding = UntaggedValue });"}], "tags": [], "owner": {"reputation": 1431, "user_id": 339925, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/nVMEY.jpg?s=128&g=1", "display_name": "Paul Young", "link": "https://stackoverflow.com/users/339925/paul-young"}, "is_accepted": false, "score": 5, "last_activity_date": 1544035830, "last_edit_date": 1544035830, "creation_date": 1534981545, "answer_id": 51976584, "question_id": 37468850, "link": "https://stackoverflow.com/questions/37468850/how-to-serialize-record-sum-data-type-in-aeson-without-tag/51976584#51976584", "title": "How to serialize record sum data type in Aeson without tag?", "body": "<p><a href=\"https://hackage.haskell.org/package/aeson-1.4.0.0/docs/Data-Aeson-Types.html#t:Options\" rel=\"nofollow noreferrer\"><code>Options</code></a> has a <a href=\"https://hackage.haskell.org/package/aeson-1.4.0.0/docs/Data-Aeson-Types.html#v:sumEncoding\" rel=\"nofollow noreferrer\"><code>sumEncoding</code></a> field, and <a href=\"https://hackage.haskell.org/package/aeson-1.4.0.0/docs/Data-Aeson-Types.html#v:defaultOptions\" rel=\"nofollow noreferrer\"><code>defaultOptions</code></a> sets this to <a href=\"https://hackage.haskell.org/package/aeson-1.4.0.0/docs/Data-Aeson-Types.html#v:defaultTaggedObject\" rel=\"nofollow noreferrer\"><code>defaultTaggedObject</code></a>.</p>\n\n<p>Setting it to <code>UntaggedValue</code> (from <a href=\"https://hackage.haskell.org/package/aeson-1.4.0.0/docs/Data-Aeson-Types.html#t:SumEncoding\" rel=\"nofollow noreferrer\"><code>SumEncoding</code></a>, available in aeson-1.0.0.0 and later) should do what you're looking for.</p>\n"}], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 743, "favorite_count": 2, "accepted_answer_id": 37470457, "answer_count": 3, "score": 2, "last_activity_date": 1544035830, "creation_date": 1464288577, "last_edit_date": 1464315345, "question_id": 37468850, "link": "https://stackoverflow.com/questions/37468850/how-to-serialize-record-sum-data-type-in-aeson-without-tag", "title": "How to serialize record sum data type in Aeson without tag?", "body": "<p>I have data type with multiple constructors, for example </p>\n\n<pre><code>data AB = A \n  { \n    ab :: Text\n  , a :: Text\n  } \n  | B \n  {\n    ab :: Text\n  , b :: Text\n  } deriving (Generic)\n</code></pre>\n\n<p>Right now when I use Aeson to serialize <code>A</code> it generated to following JSON:</p>\n\n<pre><code>{\n  \"tag\": \"A\",\n  \"ab\": \"some text\",\n  \"a\": \"some text\"\n}\n</code></pre>\n\n<p>I know that it's possible to use <a href=\"https://hackage.haskell.org/package/aeson-0.11.2.0/docs/Data-Aeson-TH.html#t:SumEncoding\" rel=\"nofollow\"><code>SumEncoding</code></a> to manipulate how constructor will be handled, but could not find what I want.</p>\n\n<p>Is it possible somehow to omit <code>tag</code> field in serialized JSON? I need only one way serialization (no reason to keep it to deserialize it), but data type is pretty big to write how to serialize it manually.</p>\n"}, {"tags": ["haskell", "traversable"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1464293356, "post_id": 37468032, "comment_id": 62438834, "body": "A Haskell koan: <code>Constant 5</code> does not contain the constant <code>5</code>."}], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1464287956, "post_id": 37468348, "comment_id": 62435912, "body": "Thanks, will think about it. Is my implementation correct?"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1464288586, "post_id": 37468348, "comment_id": 62436261, "body": "Still, it does not return <code>Constant 5</code> or anything concrete either, it just returns a type with a constraint or something similar..."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 3, "creation_date": 1464289156, "post_id": 37468348, "comment_id": 62436563, "body": "@TheUnfunCat: Your implementation looks correct. One exercise you could try to appreciate this is this: how would you write a different <code>Traversable</code> instance for <code>Constant</code>?  (Hint: it&#39;s a trick question!) Anyway, your example should evaluate to the value <code>[Constant 5]</code>; you should be able to pattern match against the result to verify that. That&#39;s the point of the <code>Constant</code> functor\u2014it&#39;s a limit case for <code>Functor</code>/<code>Applicative</code>/<code>Traversable</code> that just ignores the functions you&#39;re mapping over it."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 5, "last_activity_date": 1464297883, "last_edit_date": 1592644375, "creation_date": 1464286774, "answer_id": 37468348, "question_id": 37468032, "link": "https://stackoverflow.com/questions/37468032/traversable-for-data-constant-a-b-constant-a-passes-quickchecks-but-acts-funn/37468348#37468348", "title": "Traversable for data Constant a b = Constant a passes Quickchecks, but acts funny", "body": "<blockquote>\n<p>When I try to use the traversable instance like so:</p>\n<pre><code>traverse (\\x -&gt; [x + 1]) $ Constant 5 \n</code></pre>\n<p>I do not get <code>Constant [5]</code> which I was hoping for [...]</p>\n</blockquote>\n<p>You're not going to get <code>Constant [5]</code>.  Let's write the type for <code>traverse</code>:</p>\n<pre><code>traverse :: (Traversable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n</code></pre>\n<p>...and line it up with your instantiation of it:</p>\n<pre><code>                  -- I've substituted `x` for `a` and `y` for `b` in the\n                  -- first type, because otherwise my head hurts.\n                  (x -&gt; f  y) -&gt; t            x -&gt; f  (t            y)\n(Num a, Num b) =&gt; (a -&gt; [] a) -&gt; (Constant b) a -&gt; [] ((Constant b) a)\n</code></pre>\n<p>So we have:</p>\n<pre><code>t = Constant b\nf = []\nx = Num a =&gt; a\ny = NUm b =&gt; b\n</code></pre>\n<p>Note that the type for <code>traverse</code> implies that <code>t</code> will be the same in the argument and the result.  Since you're using <code>Constant 5 :: Num a =&gt; Constant a b</code> as the argument, that implies that you can never have <code>Constant [5] :: Num a =&gt; Constant [a] b</code> in the result, because <code>Constant a /= Constant [a]</code>.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 2, "accepted_answer_id": 37468348, "answer_count": 1, "score": 3, "last_activity_date": 1464297883, "creation_date": 1464285685, "question_id": 37468032, "link": "https://stackoverflow.com/questions/37468032/traversable-for-data-constant-a-b-constant-a-passes-quickchecks-but-acts-funn", "title": "Traversable for data Constant a b = Constant a passes Quickchecks, but acts funny", "body": "<p>The haskell book wants me to implement the traversable instance for </p>\n\n<pre><code>newtype Constant a b = Constant { getConstant :: a }\n</code></pre>\n\n<p>including all necessary superclasses. The code below passes <code>Quickcheck/Checkers</code>, but acts funny</p>\n\n<pre><code>import Test.QuickCheck\nimport Test.QuickCheck.Checkers\nimport Test.QuickCheck.Classes\n\nnewtype Constant a b = Constant { getConstant :: a }\n\ninstance Functor (Constant a) where\n  fmap f (Constant a) = Constant a\n\ninstance Foldable (Constant a) where\n  foldr f z (Constant x) = z\n\ninstance Traversable (Constant a) where\n  traverse f (Constant a) = pure $ Constant a    \n\ntype TI = []\nmain = do\n  let trigger = undefined :: TI (Int, Int, [Int])\n  quickBatch (traversable trigger)\n</code></pre>\n\n<p>When I try to use the traversable instance like so:</p>\n\n<pre><code>traverse (\\x -&gt; [x + 1]) $ Constant 5 \n</code></pre>\n\n<p>I do not get <code>Constant [5]</code> which I was hoping for, but rather</p>\n\n<pre><code>traverse (\\x -&gt; [x + 1]) $ Constant 5\n  :: (Num b, Num a) =&gt; [Constant a b]\n</code></pre>\n\n<p>What does it mean? Have I done something wrong?</p>\n"}, {"tags": ["c", "haskell", "ffi", "c2hs"], "answers": [{"comments": [{"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 0, "creation_date": 1464347449, "post_id": 37468255, "comment_id": 62460496, "body": "Thank you; so IIUC for every C enum I will need two Haskell types and the respective conversion functions, e.g. <code>{# enum DMBoundaryType as DMBoundaryType_ {underscoreToCase} deriving (Eq, Show) #} type DMBoundaryType = {# type DMBoundaryType #}  dmbToC x = toCInt $ fromEnum (x :: DMBoundaryType_) dmbFromC c = (toEnum $ fromIntegral (c :: DMBoundaryType)):: DMBoundaryType_</code>. Since I have a few tens of these enum types, what is a good way to do this without much copy/paste? A C macro?"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 6, "last_activity_date": 1464286475, "creation_date": 1464286475, "answer_id": 37468255, "question_id": 37467431, "link": "https://stackoverflow.com/questions/37467431/inline-c-type-cannot-be-marshalled-in-a-foreign-call/37468255#37468255", "title": "inline-c : &quot;`Type` cannot be marshalled in a foreign call&quot;", "body": "<p>C <code>enum</code> is not <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch8.html#x15-1560008.4.2\" rel=\"noreferrer\">marshallable foreign type</a>, that is what compiler tries to tell you. To work around it, pass it as a <code>CInt</code> using <code>fromEnum</code> (looks like <code>c2hs</code> now supports it via <a href=\"https://github.com/haskell/c2hs/wiki/Implementation%20of%20Haskell%20Binding%20Modules#enumeration-hooks\" rel=\"noreferrer\">hooks</a>, but I never tried it.)</p>\n"}], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 648, "favorite_count": 0, "accepted_answer_id": 37468255, "answer_count": 1, "score": 4, "last_activity_date": 1464286475, "creation_date": 1464283518, "last_edit_date": 1464284018, "question_id": 37467431, "link": "https://stackoverflow.com/questions/37467431/inline-c-type-cannot-be-marshalled-in-a-foreign-call", "title": "inline-c : &quot;`Type` cannot be marshalled in a foreign call&quot;", "body": "<h3>Setting</h3>\n\n<p>A C enum type rendered into Haskell by c2hs, complete with <code>Storable</code> instance which compiles correctly (<code>TypesC2Hs.chs</code>). I import this unqualified into the module I have assigned for the <code>inline-c</code> context (<code>Internal.hs</code>). Both the <code>.hs</code> module generated by c2hs and <code>Internal.hs</code> are imported by <code>InlineC.hs</code>, the other <code>inline-c</code> module that holds the quasiquotes wrapping the C calls. </p>\n\n<pre><code>TypesC2Hs.hs ------------- \n    |                    |\n    V                    V\nInternal.hs -------&gt; InlineC.hs\n</code></pre>\n\n<h3>Question</h3>\n\n<p><code>InlineC.hs</code> complains that this type cannot be marshalled: \"Unacceptable argument type in foreign declaration: \u2018DMBoundaryType\u2019 cannot be marshalled in a foreign call When checking declaration:\"</p>\n\n<p>What is going on? This is the first time <code>inline-c</code> gives me type of this error. </p>\n\n<p>I should note that other types that do not need to be dereferenced directly, e.g. <code>newtype DM = DM (Ptr DM) deriving Storable</code>, work fine with the above approach. </p>\n\n<p>Thanks in advance</p>\n\n<hr>\n\n<p>TypesC2Hs.chs</p>\n\n<pre><code>{# enum DMBoundaryType as DMBoundaryType {underscoreToCase} deriving (Eq, Show) #}\n\ninstance Storable DMBoundaryType where\n  sizeOf _ = {# sizeof DMBoundaryType #}\n  alignment _ = {# alignof DMBoundaryType #}\n  peek = peek\n  poke = poke\n</code></pre>\n\n<p>Internal.hs</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell ,GeneralizedNewtypeDeriving, StandaloneDeriving ,DeriveDataTypeable, DataKinds, OverloadedStrings #-}\n\nmodule Internal where\n\nimport TypesC2Hs\n\nimport qualified Language.C.Inline         as C\nimport qualified Language.C.Types          as CT\nimport           Language.C.Inline.Context\n\nimport qualified Language.Haskell.TH       as TH\n\nimport           Data.Monoid               ((&lt;&gt;), mempty)\nimport qualified Data.Map                  as Map\n\n\nctx :: Context\nctx = baseCtx &lt;&gt; funCtx &lt;&gt; vecCtx &lt;&gt; bsCtx &lt;&gt; pctx where\n  pctx = mempty {ctxTypesTable = typesTable}\n\n\ntypesTable :: Map.Map CT.TypeSpecifier TH.TypeQ  \ntypesTable = Map.fromList\n              [ (CT.TypeName \"DMBoundaryType\", [t| DMBoundaryType |])  ]\n</code></pre>\n\n<p>InlineC.hs</p>\n\n<pre><code>dmdaCreate1d0' cc bx m dof s =\n   withPtr ( \\ dm -&gt; [C.exp|int{DMDACreate1d($(int c),\n                                              $(DMBoundaryType bx),\n                                              $(PetscInt m),\n                                              $(PetscInt dof),\n                                              $(PetscInt s),\n                                              NULL,\n                                              $(DM* dm))}|]  )\n  where c = unComm cc\n</code></pre>\n"}, {"tags": ["c#", "visual-studio", "haskell", "dll", "vsix"], "comments": [{"owner": {"reputation": 13408, "user_id": 585968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97d0399ab165e17f668b2cdd1a5c1dc0?s=128&d=identicon&r=PG&f=1", "display_name": "MickyD", "link": "https://stackoverflow.com/users/585968/mickyd"}, "edited": false, "score": 0, "creation_date": 1464331949, "post_id": 37465055, "comment_id": 62451008, "body": "Its certainly possible, it&#39;s up to you whether you wish to use a toolbar button or menu item (both roads lead to Rome)"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "reply_to_user": {"reputation": 13408, "user_id": 585968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97d0399ab165e17f668b2cdd1a5c1dc0?s=128&d=identicon&r=PG&f=1", "display_name": "MickyD", "link": "https://stackoverflow.com/users/585968/mickyd"}, "edited": false, "score": 0, "creation_date": 1464388340, "post_id": 37465055, "comment_id": 62482598, "body": "Is the following possible? When i add a file with drag &amp; drop in solution explorer (or with add -&gt; new file) the procedure described above should be executed. So i do not need any menu or tool window, just listen to an event and execute some code. But which event is this in detail? This is unfortunately my first try in developing a VSIX"}], "answers": [{"tags": [], "owner": {"reputation": 20106, "user_id": 1585345, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/a0g5v.jpg?s=128&g=1", "display_name": "bbsimonbb", "link": "https://stackoverflow.com/users/1585345/bbsimonbb"}, "is_accepted": false, "score": 1, "last_activity_date": 1466584537, "last_edit_date": 1466584537, "creation_date": 1465200263, "answer_id": 37652362, "question_id": 37465055, "link": "https://stackoverflow.com/questions/37465055/vsix-to-dynamically-create-dll-files/37652362#37652362", "title": "VSIX to dynamically create DLL files", "body": "<p>Sure, none of that should cause problems. Consider starting your project with <a href=\"https://visualstudiogallery.msdn.microsoft.com/8bdcdbea-5d10-4a77-adaa-7d8ac6fcd9f8\" rel=\"nofollow\">Jared Parsons' VSIX templates</a>, for maximum portablility across VS versions. Menu commands or toolbox items, or both, can be added as you want to the same extension. They are not different project types. (That option just determines what sample code gets added at project creation.) Popping a file dialog and running a command line are straightforward. Adding a dll reference happens like this...</p>\n\n<pre><code>var p = _project as VsProject; \np.References.Add(&lt;path to assembly DLL&gt;);\n</code></pre>\n"}], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1466584537, "creation_date": 1464276271, "question_id": 37465055, "link": "https://stackoverflow.com/questions/37465055/vsix-to-dynamically-create-dll-files", "title": "VSIX to dynamically create DLL files", "body": "<p>I would like to create a Visual Studio Extension which should do the following:</p>\n\n<ol>\n<li>Open a file dialog and choose a Haskell source file</li>\n<li>Start an executable (should be integrated in the VSIX) which creates\na DLL from this Haskell source file (hs2lib).</li>\n<li>Add the created DLL file to my current solution as a reference</li>\n</ol>\n\n<p>The purpose of the extension should be that i can automatically create a DLL from an Haskell source file and call it within my C# code.</p>\n\n<p>Is this all possible with an extension and which type of extension (Toolbox, Menucommand, ...) is best suited for this?</p>\n"}, {"tags": ["c", "unix", "haskell", "ffi", "c2hs"], "answers": [{"tags": [], "owner": {"reputation": 30265, "user_id": 3246555, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ziIu9.png?s=128&g=1", "display_name": "AlexD", "link": "https://stackoverflow.com/users/3246555/alexd"}, "is_accepted": true, "score": 1, "last_activity_date": 1464276434, "last_edit_date": 1464276434, "creation_date": 1464275991, "answer_id": 37464950, "question_id": 37464821, "link": "https://stackoverflow.com/questions/37464821/large-c2hs-inferred-size-of-c-enum/37464950#37464950", "title": "Large c2hs-inferred size of C enum", "body": "<p>The size of enum is implementation-defined. The standard says:</p>\n\n<blockquote>\n  <p><strong>6.7.2.2 Enumeration specifiers</strong><br>...</p>\n  \n  <p>Each enumerated type shall be compatible with <code>char</code>, a signed integer type, or an\n  unsigned integer type. The choice of type is implementation-defined ...</p>\n</blockquote>\n\n<p>BTW, in C++ one could specify the underlying type explicitly, e.g.:</p>\n\n<pre><code>enum E : int\n{\n    // ...\n};\n</code></pre>\n"}], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 37464950, "answer_count": 1, "score": 1, "last_activity_date": 1464276434, "creation_date": 1464275601, "last_edit_date": 1464276128, "question_id": 37464821, "link": "https://stackoverflow.com/questions/37464821/large-c2hs-inferred-size-of-c-enum", "title": "Large c2hs-inferred size of C enum", "body": "<p>When writing the <code>Storable</code> instance of a C enum that has 5 options (using c2hs), the <code>{# sizeof #}</code> macro returns 4 (i.e. 4 bytes). Isn't this extremely wasteful, when 3 bits would suffice? Does this depend on the size of a memory word?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1464274505, "post_id": 37463222, "comment_id": 62427612, "body": "Haskell has some redundancy in its syntax. E.g. <code>f x = 2*x</code> and <code>f = \\x -&gt; 2*x</code>. There little justification beyond the vague readability / personal preferences to support these. One might answer pointing out that these were in part borrowed from Miranda, but historical reasons are never a satisfactory answer, IMO."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1464273945, "post_id": 37463879, "comment_id": 62427156, "body": "There&#39;s also a difference of the scope of where clauses."}, {"owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1464288366, "post_id": 37463879, "comment_id": 62436137, "body": "True, and I think that&#39;s another good reason to use the second version if you have more than one constructor."}], "tags": [], "owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "is_accepted": false, "score": 1, "last_activity_date": 1464273232, "creation_date": 1464273232, "answer_id": 37463879, "question_id": 37463222, "link": "https://stackoverflow.com/questions/37463222/what-is-the-reason-behind-two-styles-of-function-definition-when-using-pattern-m/37463879#37463879", "title": "What is the reason behind two styles of function definition when using pattern matching in Haskell?", "body": "<p>The first format is useful if you want to destruct an argument with single constructor because it makes your functions shorter and cleaner. The second version is preferred when you have multiple constructors because if you have to change the name of the function you only have to do it in one place.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1464273744, "creation_date": 1464273744, "answer_id": 37464089, "question_id": 37463222, "link": "https://stackoverflow.com/questions/37463222/what-is-the-reason-behind-two-styles-of-function-definition-when-using-pattern-m/37464089#37464089", "title": "What is the reason behind two styles of function definition when using pattern matching in Haskell?", "body": "<p>In fact, a piecewise function definition is just syntactic sugar for the definition that uses a <code>case</code> expression. <a href=\"http://www.haskellforall.com/2014/10/how-to-desugar-haskell-code.html#pattern-matching\" rel=\"nofollow\">A simpler example</a>:</p>\n\n<pre><code>f (Left  l) = eL\nf (Right r) = eR\n\n-- ... desugars to:\nf x = case x of\n    Left  l -&gt; eL\n    Right r -&gt; eR\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 9, "last_activity_date": 1464294169, "last_edit_date": 1464294169, "creation_date": 1464289623, "answer_id": 37469138, "question_id": 37463222, "link": "https://stackoverflow.com/questions/37463222/what-is-the-reason-behind-two-styles-of-function-definition-when-using-pattern-m/37469138#37469138", "title": "What is the reason behind two styles of function definition when using pattern matching in Haskell?", "body": "<p>The answer to this is in the following, highly recommended paper:</p>\n\n<ul>\n<li>Hudak, Paul, John Hughes, Simon Peyton Jones and Philip Wadler.  2007.  <a href=\"http://haskell.cs.yale.edu/wp-content/uploads/2011/02/history.pdf\">\"A History of Haskell: Being Lazy With Class.\"</a>  <em>Third ACM SIGPLAN History of Programming Languages Conference (HOPL-III).</em></li>\n</ul>\n\n<p>In section 4.4 they talk about this:</p>\n\n<blockquote>\n  <p><strong>4.4 Declaration style vs. expression style</strong></p>\n  \n  <p>As our discussions evolved, it became clear that there were two different styles in which functional programs could be written: \u201cdeclaration style\u201d and \u201cexpression style\u201d. [...] </p>\n  \n  <p>The declaration style attempts, so far as possible, to define a function by multiple equations, each of which uses pattern matching and/or guards to identify the cases it covers. In contrast, in the expression style a function is built up by composing expressions together to make bigger expressions. [...]</p>\n  \n  <p>It took some while to identify the stylistic choice as we have done here, but once we had done so, we engaged in furious debate about which style was \u201cbetter.\u201d An underlying assumption was that if possible there should be \u201cjust one way to do something,\u201d so that, for example, having both let and where would be redundant and confusing.</p>\n  \n  <p>In the end, we abandoned the underlying assumption, and provided full syntactic support for both styles. This may seem like a classic committee decision, but it is one that the present authors believe was a fine choice, and that we now regard as a strength of the language.</p>\n</blockquote>\n\n<p>So the reason is just that when Haskell was being invented, different authors had different preferences, and they just threw both styles into the language.  So use the one you like.</p>\n\n<p>Declaration style does seem to be more popular, although I'd say most people use a mix.</p>\n"}], "owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 1, "accepted_answer_id": 37469138, "answer_count": 3, "score": 3, "last_activity_date": 1464294169, "creation_date": 1464271569, "question_id": 37463222, "link": "https://stackoverflow.com/questions/37463222/what-is-the-reason-behind-two-styles-of-function-definition-when-using-pattern-m", "title": "What is the reason behind two styles of function definition when using pattern matching in Haskell?", "body": "<p>In Chapter 7, \"More functional patterns\" of <a href=\"http://haskellbook.com/\" rel=\"nofollow\">Haskell Programming from First Principles</a>, given the following data types:</p>\n\n<pre><code>newtype Username = Username String\nnewtype AccountNumber = AccountNumber Integer\ndata User = UnregisteredUser\n          | RegisteredUser Username AccountNumber\n</code></pre>\n\n<p>it defines the following function:</p>\n\n<pre><code>printUser :: User -&gt; IO ()\nprintUser UnregisteredUser = putStrLn \"UnregisteredUser\"\nprintUser (RegisteredUser (Username name)\n                          (AccountNumber acctNum))\n          = putStrLn $ name ++ \" \" ++ show acctNum\n</code></pre>\n\n<p>But experimenting with the code, I realized that I can also define de <code>printUser</code> function as:</p>\n\n<pre><code>printUser :: User -&gt; IO ()\nprintUser user = case user of\n  UnregisteredUser -&gt; putStrLn \"UnregisteredUser\"\n  (RegisteredUser (Username name)\n                  (AccountNumber acctNum)) -&gt; putStrLn $ name ++ \" \" ++ show acctNum\n</code></pre>\n\n<p>I'm trying to understand why it is possible to use two such different styles. Is there some design motivation behind it? Or, an explanation like, \"first style is preferred in such and such situations, whereas the second style of definition would better be used when ...\"? (I mean, anything other than a vague 'readability'-motivated explanation?)</p>\n"}, {"tags": ["string", "haskell", "char", "whitespace", "removing-whitespace"], "comments": [{"owner": {"reputation": 127019, "user_id": 59303, "user_type": "moderator", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/gIt1g.png?s=128&g=1", "display_name": "ChrisF", "link": "https://stackoverflow.com/users/59303/chrisf"}, "edited": false, "score": 0, "creation_date": 1464267752, "post_id": 37461615, "comment_id": 62422153, "body": "See <a href=\"http://stackoverflow.com/questions/4978578/how-to-split-a-string-in-haskell\" title=\"how to split a string in haskell\">stackoverflow.com/questions/4978578/&hellip;</a> replace the comma separator with a space"}, {"owner": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "reply_to_user": {"reputation": 127019, "user_id": 59303, "user_type": "moderator", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/gIt1g.png?s=128&g=1", "display_name": "ChrisF", "link": "https://stackoverflow.com/users/59303/chrisf"}, "edited": false, "score": 0, "creation_date": 1464269774, "post_id": 37461615, "comment_id": 62423735, "body": "I should have been more specific but I&#39;m looking a solution without using libraries."}], "answers": [{"comments": [{"owner": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "edited": false, "score": 0, "creation_date": 1464269951, "post_id": 37461998, "comment_id": 62423887, "body": "Yes I would like to try and avoid using libraries!"}, {"owner": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "edited": false, "score": 0, "creation_date": 1464288773, "post_id": 37461998, "comment_id": 62436356, "body": "Hi, thanks for your awesome response! I have a question about the eta reduction your trying to do there. It would be nice I think if there was a case for the empty list but when I try to do that it says it has different amounts of arguments, like this splitWords [] = []. Is there a way to include that case in splitWords?"}, {"owner": {"reputation": 816, "user_id": 4153209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bd54eebccc6829e45b653c41b217bd?s=128&d=identicon&r=PG", "display_name": "Thomas Francois", "link": "https://stackoverflow.com/users/4153209/thomas-francois"}, "reply_to_user": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "edited": false, "score": 0, "creation_date": 1464336646, "post_id": 37461998, "comment_id": 62453701, "body": "@user6386278 You do not need a case for the empty list. I am not convinced it would be nice either, mostly confusing. <code>splitWords</code> takes for argument a <code>String</code>, not a <code>List</code>. It would work because <code>String</code> is equivalent to <code>[Char]</code>, but it would confuse things. So calling <code>splitWords</code> with <code>&quot;&quot;</code> or <code>[]</code> yields the same result, but using a string is more consistent. If you call <code>splitWords &quot;&quot;</code>, it will in turn call <code>splitWord &quot;&quot; &quot;&quot;</code>, which will be matched to <code>splitWord word []</code>. Note that I made the mistake myself of using <code>[]</code> where <code>&quot;&quot;</code> would be more appropriate."}], "tags": [], "owner": {"reputation": 816, "user_id": 4153209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bd54eebccc6829e45b653c41b217bd?s=128&d=identicon&r=PG", "display_name": "Thomas Francois", "link": "https://stackoverflow.com/users/4153209/thomas-francois"}, "is_accepted": true, "score": 2, "last_activity_date": 1464282939, "last_edit_date": 1464282939, "creation_date": 1464268626, "answer_id": 37461998, "question_id": 37461615, "link": "https://stackoverflow.com/questions/37461615/removing-whitespace-from-a-string-and-putting-each-word-separated-in-a-list-has/37461998#37461998", "title": "Removing whitespace from a string and putting each word separated in a list, haskell", "body": "<p>Do you need to do it yourself? If not, use <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-String.html#v:words\" rel=\"nofollow\"><code>Data.String.words</code></a>.</p>\n\n<pre><code>\u03bb words \" A \\t String with many\\nspaces.\"\n[\"A\",\"String\",\"with\",\"many\",\"spaces.\"] :: [String]\n</code></pre>\n\n<p><code>words</code> is defined by:</p>\n\n<pre><code>words   :: String -&gt; [String]\nwords s =  case dropWhile Char.isSpace s of\n                  \"\" -&gt; []\n                  s' -&gt; w : words s''\n                        where (w, s'') = break Char.isSpace s'\n</code></pre>\n\n<hr>\n\n<p><strong>Edit:</strong> not using Data.String functions.</p>\n\n<p>You were not too far off.</p>\n\n<p>First, you are missing the last word in your output.\nYou can solve that by changing the line <code>splitWord _ []  = []</code> to <code>splitWord word []  = [word]</code>.</p>\n\n<p>The next issue is the empty strings that are added to the list. You need to filter them out (I made a top-level function to demonstrate):</p>\n\n<pre><code>addIfNotEmpty :: String -&gt; [String] -&gt; [String]\naddIfNotEmpty s l = if s == \"\" then l else s:l\n</code></pre>\n\n<p>Using this function:</p>\n\n<pre><code>splitWord word []  = addIfNotEmpty word []\nsplitWord word ('\\n':as)   = addIfNotEmpty word $ splitWord \"\" as\nsplitWord word ('\\t':as)  = addIfNotEmpty word $ splitWord \"\" as\nsplitWord word (' ':as)  = addIfNotEmpty word $ splitWord \"\" as\nsplitWord word (a:as) = splitWord (word ++ [a]) as\n</code></pre>\n\n<p>And tadaa! It works. But wait, we are not done!</p>\n\n<hr>\n\n<p><strong>Tidying up</strong></p>\n\n<p>Let's start by <code>splitWords</code>. Not much to do here, but we can use <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow\">eta-reduction</a>:</p>\n\n<pre><code>splitWords :: String -&gt; [String]\nsplitWords = splitWord \"\"\n</code></pre>\n\n<p>Next, notice that for each type of space, the action is the same. Let's remove the repetition:</p>\n\n<pre><code>splitWord word (c:cs)\n    | c `elem` \" \\t\\n\" = addIfNotEmpty word $ splitWord \"\" cs\n    | otherwise        = splitWord (word ++ [c]) cs\n</code></pre>\n\n<p>I used <code>elem</code> here to check if the next character is a space, there are arguably better ways to do it.</p>\n\n<p>Final result:</p>\n\n<pre><code>splitWords :: String -&gt; [String]\nsplitWords = splitWord \"\"\n\nsplitWord :: String -&gt; String -&gt; [String]\nsplitWord word [] = addIfNotEmpty word []\nsplitWord word (c:cs)\n    | c `elem` \" \\t\\n\" = addIfNotEmpty word $ splitWord \"\" cs\n    | otherwise        = splitWord (word ++ [c]) cs\n\naddIfNotEmpty :: String -&gt; [String] -&gt; [String]\naddIfNotEmpty s l = if s == \"\" then l else s:l\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1464294601, "creation_date": 1464294601, "answer_id": 37470412, "question_id": 37461615, "link": "https://stackoverflow.com/questions/37461615/removing-whitespace-from-a-string-and-putting-each-word-separated-in-a-list-has/37470412#37470412", "title": "Removing whitespace from a string and putting each word separated in a list, haskell", "body": "<p>What we need is a parser. This is simply a function that takes a string as input and returns a data structure as output. I'll show you a simplified way to create a parser in the \"combinator\" style.  What this means is that we'll build the parser we want out of smaller parsers (by combining them).</p>\n\n<p>This isn't the best or most efficient way to do this, but it will demonstrate the technique. And it doesn't require any libraries!</p>\n\n<p>We'll start with a language pragma to decrease some boilerplate:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n</code></pre>\n\n<p>Now let's create a data type to represent parsing functions.</p>\n\n<pre><code>data Parser a = P { parser :: String -&gt; Maybe (String, a) } deriving Functor\n</code></pre>\n\n<p>Basically, the parser is a function underneath the data wrapper.  The way it will work is it will take a string as input and if its criteria matches characters at the beginning of the string, then it will consume those characters, create the data of type <code>a</code> and return a <code>Just</code> containing the unconsumed input and the new item. However, if the criteria fails, then it just returns <code>Nothing</code>.</p>\n\n<p>We'll implement Applicative and Monad for our Parser type, then we'll be able to use do notation.  This is one of the coolest features of Haskell (IMHO). We won't use the Applicative <code>&lt;*&gt;</code>, but we need the instance in order to implement Monad. (Although Applicative is awesome in its own right.)</p>\n\n<pre><code>instance Applicative Parser where\n  pure x = P (\\input -&gt; Just (input, x))\n  f &lt;*&gt; p = do\n    f' &lt;- f\n    p' &lt;- p\n    return $ f' p'\n</code></pre>\n\n<p>The key operation Monad requires is the bind (<code>&gt;&gt;=</code>) which takes the result of a first parser and feeds it to a function that returns a second parser. This is the most convenient way to combine parsers. It lets us accumulate (or throw away) results without manually threading the input through the parser functions.</p>\n\n<pre><code>instance Monad Parser where\n  return = pure\n  p &gt;&gt;= f = P (\\input -&gt; case parse p input of\n                           Just (rest, x) -&gt; parse (f x) rest\n                           _ -&gt; Nothing)\n</code></pre>\n\n<p>Next we need a way to create a \"primitive\" parser. We'll make a function that takes a <code>Char</code> predicate and returns a parser that will accept a single character that passes the predicate.</p>\n\n<pre><code>satisfy :: (Char -&gt; Bool) -&gt; Parser Char\nsatisfy p = P (\\input -&gt; case input of\n                  (x:xs) | p x -&gt; Just (xs, x)     -- success!\n                  _ -&gt; Nothing                     -- failure :(\n</code></pre>\n\n<p>There are lots of other ways we could manipulate Parsers, but we'll stick to solving the given problem. The next thing we need is a way to repeat a Parser.  That's where the <code>while</code> function comes in handy. It will take a parser that produces items of type <code>a</code> and repeat it until it fails, accumulating the results in a list.</p>\n\n<pre><code>while :: Parser a -&gt; Parser [a]\nwhile p = P (\\input -&gt; case parse p input of\n                Nothing -&gt; Just (input, [])\n                Just (rest, x) -&gt; parse (fmap (x:) (while p)) rest)\n</code></pre>\n\n<p>We're almost done. We'll create the predicates to tell whitespace from non-whitespace.</p>\n\n<pre><code>isWhitespace c = c == ' ' || c == '\\t' || c == '\\n'\nisNotWhiteSpace = not . isWhitespace\n</code></pre>\n\n<p>Ok, now we'll see how awesome do-notation is.  First we create a parser for a single word.</p>\n\n<pre><code>word :: Parser String\nword = do\n  c &lt;- (satisfy isNotWhitespace)        -- grab the first character\n  cs &lt;- while (satisfy isNotWhitespace) -- get any other characters\n  while (satisfy isWhitespace)          -- eat the trailing whitespace\n  return (c:cs)\n</code></pre>\n\n<p>We can finally implement the Parser we really want!</p>\n\n<pre><code>splitWords :: Parser [String]\nsplitWords = do\n  while (satisfy isWhitespace)   -- eat up any leading whitespace\n  while word\n</code></pre>\n\n<p>And finally, try it!</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let input = \" A \\t String with many\\nspaces.\"\n  case parse splitWords input of\n    Nothing -&gt; putStrLn \"failed!\"\n    Just (_, result) -&gt; putStrLn . show $ result\n</code></pre>\n\n<p>This is what I get in ghci:</p>\n\n<pre><code>\u03bb main\n[\"A\",\"String\",\"with\",\"many\",\"spaces.\"]\n</code></pre>\n"}], "owner": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1076, "favorite_count": 1, "accepted_answer_id": 37461998, "answer_count": 2, "score": 1, "last_activity_date": 1464294601, "creation_date": 1464267588, "last_edit_date": 1495540367, "question_id": 37461615, "link": "https://stackoverflow.com/questions/37461615/removing-whitespace-from-a-string-and-putting-each-word-separated-in-a-list-has", "title": "Removing whitespace from a string and putting each word separated in a list, haskell", "body": "<p>With thanks to <a href=\"https://stackoverflow.com/questions/3098877/remove-white-space-from-string\">Remove white space from string</a>, I can successfully remove the whitespace in a string, but in my case, I also need to separate the words and put them all in a list like the following example. </p>\n\n<p>Input</p>\n\n<blockquote>\n  <p>\" A  \\t String with many\\nspaces.\"</p>\n</blockquote>\n\n<p>would output</p>\n\n<blockquote>\n  <p>[\"A\",\"String\",\"with\",\"many\",\"spaces.\"]</p>\n</blockquote>\n\n<p>I am able to output this </p>\n\n<blockquote>\n  <p><code>[\"\",\"A\",\"\",\"\",\"\",\"String\",\"with\",\"many\"]</code></p>\n</blockquote>\n\n<p>with the following code</p>\n\n<pre><code>&gt; splitWords :: String -&gt; [String]\n&gt; splitWords [] =[]\n&gt; splitWords as =splitWord \"\" as\n\n\n&gt; splitWord _ []  = []\n&gt; splitWord word ('\\n':as)   = word : splitWord \"\" as\n&gt; splitWord word ('\\t':as)  = word : splitWord \"\" as\n&gt; splitWord word (' ':as)  = word : splitWord \"\" as\n&gt; splitWord word (a:as) = splitWord (word ++ [a]) as\n</code></pre>\n\n<p>Since I'm trying to learn haskell, solutions without using other libraries would be ideal!</p>\n"}, {"tags": ["haskell", "recursion-schemes"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1464262086, "post_id": 37458581, "comment_id": 62418152, "body": "The compiler says <code>the choice depends on the instantiation of &#39;f0&#39;</code>. Your use of <code>value</code>, being of type <code>(Value f, Num a) =&gt; f a -&gt; a</code>, gives no hint as to which implementation of <code>app</code> should be used. Scatter some type annotations in there and you should be good to go."}, {"owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1464321443, "post_id": 37458581, "comment_id": 62447438, "body": "Thank you for your comment. Now I think I understand it. I cannot give a type annotation to <code>value</code> in <code>cata (app value) (succ zero)</code> because <code>Expr</code> isn&#39;t an instance of <code>Value</code>, not like I can do <code>cata (app (value :: Num a =&gt; Zero a -&gt; a)) (Fix Zero)</code>. So what I&#39;m trying to do here is to define an instance of <code>Value</code> for <code>Expr</code> automatically. I guess I can do it with TH, but are there any ways to do it without TH?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1464332794, "post_id": 37458581, "comment_id": 62451500, "body": "Hold on, why can&#39;t you write that? Looks correct to me"}, {"owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1464336277, "post_id": 37458581, "comment_id": 62453495, "body": "Do you mean I can write <code>cata (app (value :: Num a =&gt; Expr a -&gt; a)) (succ zero)</code>?"}, {"owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1464339180, "post_id": 37458581, "comment_id": 62455251, "body": "Yes, and it didn&#39;t type check."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1464344048, "post_id": 37458581, "comment_id": 62458407, "body": "Oh, I see why it didn&#39;t typecheck - you&#39;ve commented out your instance of <code>Value (Sum f g)</code>"}, {"owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1464347826, "post_id": 37458581, "comment_id": 62460737, "body": "That&#39;s right. And as I explained in the question, I&#39;m looking for a way to apply <code>value</code> to <code>Fix Expr</code> using <code>cata</code> without manually defining this instance."}], "owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563169573, "creation_date": 1464259560, "last_edit_date": 1563169573, "question_id": 37458581, "link": "https://stackoverflow.com/questions/37458581/use-cata-with-sum-of-functors", "title": "Use cata with Sum of functors", "body": "<p>I'm playing with <a href=\"http://hackage.haskell.org/package/data-fix-0.0.3/docs/Data-Fix.html\" rel=\"nofollow\"><code>Data.Fix</code></a> and <a href=\"http://hackage.haskell.org/package/transformers-0.5.1.0/docs/Data-Functor-Sum.html\" rel=\"nofollow\"><code>Data.Functor.Sum</code></a>, and trying to use <a href=\"http://hackage.haskell.org/package/data-fix-0.0.3/docs/Data-Fix.html#v:cata\" rel=\"nofollow\"><code>cata</code></a> with sum of functors, then ran into an issue that code didn't type check. But I'm not sure how I can make it type check.</p>\n\n<p>Here is the code.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor, FlexibleInstances, MultiParamTypeClasses #-}\n\nimport Data.Fix (Fix(Fix), cata)\nimport Data.Functor.Sum (Sum(InL, InR))\nimport Prelude hiding (succ)\n\nclass (Functor f, Functor g) =&gt; IsPartOf f g where\n    inj :: f a -&gt; g a\n    app :: (f a -&gt; a) -&gt; (g a -&gt; a)\ninstance {-# OVERLAPPABLE #-} Functor f =&gt; IsPartOf f f where\n    inj = id\n    app = id\ninstance {-# OVERLAPPABLE #-} (Functor f, Functor g) =&gt; IsPartOf f (Sum f g) where\n    inj = InL\n    app f (InL l) = f l\ninstance {-# OVERLAPPABLE #-} (Functor f, Functor g, Functor h, IsPartOf f g) =&gt; IsPartOf f (Sum h g) where\n    inj = InR . inj\n    app f (InR r) = app f r\n\ndata Zero e = Zero deriving Functor\ndata Succ e = Succ e deriving Functor\ndata Add e = Add e e deriving Functor\n\ntype Expr = Sum Zero (Sum Succ Add)\n\nzero :: Fix Expr\nzero = Fix (inj Zero)\n\nsucc :: Fix Expr -&gt; Fix Expr\nsucc = Fix . inj . Succ\n\nadd :: Fix Expr -&gt; Fix Expr -&gt; Fix Expr\nadd = ((Fix . inj) .) . Add\n\nclass Value f where\n    value :: Num a =&gt; f a -&gt; a\ninstance Value Zero where\n    value _ = 0\ninstance Value Succ where\n    value (Succ e) = 1 + e\ninstance Value Add where\n    value (Add e1 e2) = e1 + e2\n{-\ninstance (Value f, Value g) =&gt; Value (Sum f g) where\n    value (InL f) = value f\n    value (InR g) = value g\n-}\n</code></pre>\n\n<p>First, I have three functors <code>Zero</code>, <code>Succ</code> and <code>Add</code>. I combined them using <code>Sum</code> and defined <code>type Expr = Sum Zero (Sum Succ Add)</code>.</p>\n\n<p>I also have <code>Value</code> class to convert each functor to a number. Since I don't want to write an instance of <code>Value</code> for <code>Sum</code> by myself, I introduced <code>IsPartOf</code> class that knows how to construct a sum of functors (<code>inj</code>) and how to apply a function for an inner functor to an outer functor (<code>app</code>).</p>\n\n<p>But when I try to use them like <code>cata (app value) (succ zero)</code>, GHC says it doesn't type check.</p>\n\n<pre><code>*Main&gt; cata (app value) (succ zero)\n\n&lt;interactive&gt;:10:7:\n    Overlapping instances for IsPartOf f0 Expr\n      arising from a use of \u2018app\u2019\n    Matching instances:\n      instance [overlappable] (Functor f, Functor g, Functor h,\n                               IsPartOf f g) =&gt;\n                              IsPartOf f (Sum h g)\n        -- Defined at min.hs:16:31\n      instance [overlappable] Functor f =&gt; IsPartOf f f\n        -- Defined at min.hs:10:31\n      instance [overlappable] (Functor f, Functor g) =&gt;\n                              IsPartOf f (Sum f g)\n        -- Defined at min.hs:13:31\n    (The choice depends on the instantiation of \u2018f0\u2019\n     To pick the first instance above, use IncoherentInstances\n     when compiling the other instance declarations)\n    In the first argument of \u2018cata\u2019, namely \u2018(app value)\u2019\n    In the expression: cata (app value) (succ zero)\n    In an equation for \u2018it\u2019: it = cata (app value) (succ zero)\n\n&lt;interactive&gt;:10:11:\n    Could not deduce (Value f0) arising from a use of \u2018value\u2019\n    from the context (Num a)\n      bound by the inferred type of it :: Num a =&gt; a\n      at &lt;interactive&gt;:10:1-28\n    The type variable \u2018f0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Value Add -- Defined at min.hs:41:10\n      instance Value Succ -- Defined at min.hs:39:10\n      instance Value Zero -- Defined at min.hs:37:10\n    In the first argument of \u2018app\u2019, namely \u2018value\u2019\n    In the first argument of \u2018cata\u2019, namely \u2018(app value)\u2019\n    In the expression: cata (app value) (succ zero)\n</code></pre>\n\n<p>Why GHC doesn't find a proper instance? How can I make this type check, or what is a proper way to express this idea?</p>\n\n<p>I tried this with GHC 7.10.3.</p>\n"}]