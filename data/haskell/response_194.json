[{"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538019349, "post_id": 52527627, "comment_id": 91997396, "body": "Thank you for the help! Helped me understand what was actually going on. I updated my original post with where I am at with what you told me. I have a question that I state above.   Thank you"}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538022334, "post_id": 52527627, "comment_id": 91998074, "body": "@Riley For the code with the <code>let</code>, that goes in another function, like <code>calcGPA grades = let \u2026</code> So, that&#39;ll take in the grades for one person (a list of tuples) and produce one tuple with the name and GPA, using your new <code>cumulativeSums</code> function."}, {"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538022589, "post_id": 52527627, "comment_id": 91998134, "body": "Does the cumulativeSums function above look correct?"}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538022639, "post_id": 52527627, "comment_id": 91998149, "body": "Yes, except you&#39;ll have some minor type errors that shouldn&#39;t be too hard to correct, since it&#39;s similar to your original question."}, {"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538022957, "post_id": 52527627, "comment_id": 91998253, "body": "I&#39;m having issues putting the let block into a function. The equal sign after the (weightedSum, sumOfWeights)  line is giving me a error that it should be in a let. When I put it in a let I also get an error."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538023038, "post_id": 52527627, "comment_id": 91998276, "body": "Make sure it&#39;s indented past the <code>let</code> on the line above (like the example)."}, {"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538025501, "post_id": 52527627, "comment_id": 91998935, "body": "I actually want my output of calcGPA(what i pass my list of tuples into) to return the credits also. I updated my calculcateGPA function, but i am having a hard time updating calcGPA. My code of where i am now is above. thanks"}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538025616, "post_id": 52527627, "comment_id": 91998977, "body": "In that case, you can modify the code above to return <code>(name, gpa, sumOfWeights)</code>, since the &quot;weights&quot; are the credits. If you want, you can rename the variable."}, {"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538025962, "post_id": 52527627, "comment_id": 91999095, "body": "I am getting an error on the first two lines of the let saying i have conflicting definitions of name. Any idea why this may be."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1538047405, "post_id": 52527627, "comment_id": 92010966, "body": "It looks like you define name twice: once in the <code>name =</code> line and once in the <code>(name, weightedSum, sumOfWeights) =</code> line. Once a variable like <code>name</code> is defined (in a certain scope), it can&#39;t be defined again. Either remove the first one or the second one."}], "tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": false, "score": 2, "last_activity_date": 1538007055, "creation_date": 1538007055, "answer_id": 52527627, "question_id": 52527030, "link": "https://stackoverflow.com/questions/52527030/calculating-from-multiple-tuples/52527627#52527627", "title": "Calculating from multiple tuples", "body": "<p>You're going in the right direction if you were planning on using <code>foldl</code> or <code>foldr</code> with your <code>calcGPA</code> function.</p>\n\n<p>What we do when folding is we have a function with the result-so-far, the next element in a list, and the result-just-after. With <code>foldl</code>, which is most appropriate for sums, the type and arguments, as far as lists are concerned is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldl f startingResult items = \u2026\n</code></pre>\n\n<p>We see that your function will need to be type <code>(b -&gt; a -&gt; b)</code>. Looking elsewhere in the type signature, the ultimate result of <code>foldl</code> is type <code>b</code>. The type of elements in the list is type <code>a</code>.</p>\n\n<p>So what the function you provide <code>foldl</code> does is takes two arguments: the result-so-far and the next item in the list. It then expects your function to give back the result-just-after.</p>\n\n<p>You \"fold\" in a new item to the result each time your function is run on the next element in the list. So let's look at what our list element type is and what our result type will be.</p>\n\n<p>Our list element type is something like <code>(String, Double, Int)</code>. Our result type is <code>(Double, Int)</code>. So the type signature for our folding function is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>cumulativeSums :: (Double, Int) -&gt; (String, Double, Int) -&gt; (Double, Int)\n</code></pre>\n\n<p>So far so good. Now what about the other arguments to <code>foldl</code>? We know the <code>items</code> argument: it's our sublist for one person's grades. We know <code>f</code>, it's our <code>cumulativeSums</code> function we're going to write. What is <code>startingResult</code>? Well, both sums should start with 0, so it's <code>(0, 0)</code>. We have:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let name                        = (\\ (name, _, _) -&gt; name) (head grades)\n    (weightedSum, sumOfWeights) = foldl cumulativeSums (0, 0) grades\n    gpa                         = weightedSum / sumOfWeights\nin  (name, gpa)\n</code></pre>\n\n<p>Now we write <code>cumulativeSums</code>. Remember, we're getting told the result-so-far and the item from the list. We just need to give back the result-just-after. See if you can write that part.</p>\n\n<p>For the code already provided, I'd recommend writing your own version of it. There are some type errors related to mixing <code>Int</code>s and <code>Double</code>s in the code above.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1538035266, "post_id": 52529358, "comment_id": 92003618, "body": "This is a nice approach, but I think the OP is a beginner and will not be able to understand much of the code above. Sometimes, it&#39;s better to stick to an elementary approach, which would be more helpful to the OP, even if less elegant."}], "tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 2, "last_activity_date": 1538053882, "last_edit_date": 1538053882, "creation_date": 1538021653, "answer_id": 52529358, "question_id": 52527030, "link": "https://stackoverflow.com/questions/52527030/calculating-from-multiple-tuples/52529358#52529358", "title": "Calculating from multiple tuples", "body": "<p>You need to go over each sub-list so you can accumulate values. Something like this:</p>\n\n<pre><code>averageGdp :: [[(String, Double, Double)]] -&gt; [(String, Double, Double)]\naverageGdp = fmap f\n  where\n    f             = (,,) &lt;$&gt; fst . head &lt;*&gt; totalAvg &lt;*&gt; totalCredit \n    fst (a, _, _) = a\n    totalCredit   = getSum . foldMap (\\(_, _, c) -&gt; pure c)\n    total         = getSum . foldMap (\\(_, b, c) -&gt; pure $ b * c)\n    totalAvg      = (/) &lt;$&gt; total &lt;*&gt;  totalCredit\n</code></pre>\n\n<p>f takes the inner list as its input and produces a triple. You then map f over the outer list.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1538065503, "last_edit_date": 1538065503, "creation_date": 1538045352, "answer_id": 52535267, "question_id": 52527030, "link": "https://stackoverflow.com/questions/52527030/calculating-from-multiple-tuples/52535267#52535267", "title": "Calculating from multiple tuples", "body": "<p>A one-liner to do what you asked about:</p>\n\n<pre><code>import Control.Category ( (&gt;&gt;&gt;) )\n\ng :: [[(t, Double, Double)]] -&gt; [(t, Double, Double)]\ng = filter (not . null) &gt;&gt;&gt;\n      map (unzip3 &gt;&gt;&gt; \\ (a,b,c) -&gt; (head a, sum (zipWith (*) b c) / sum c, sum c))\n</code></pre>\n\n<p><code>unzip3 :: [(a, b, c)] -&gt; ([a], [b], [c])</code> is in the Prelude.</p>\n\n<p><code>&gt;&gt;&gt;</code> is the left-to-right function composition, <code>(f &gt;&gt;&gt; g) x = g (f x)</code>.</p>\n\n<p><code>filter</code> makes sure all empty groups are removed before further processing.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1538065907, "post_id": 52535999, "comment_id": 92022772, "body": "I got the feeling it&#39;s safe to assume this is a part of a larger problem, presented to students gradually, in several installments, and so yes, it would be safe to assume it&#39;s already grouped as part of some previous assignment. as is usual, the OP was quite vague on this, of course. :)  good point about <code>head</code>, I&#39;ve corrected my answer thanks to that."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 1, "last_activity_date": 1538055944, "last_edit_date": 1538055944, "creation_date": 1538047906, "answer_id": 52535999, "question_id": 52527030, "link": "https://stackoverflow.com/questions/52527030/calculating-from-multiple-tuples/52535999#52535999", "title": "Calculating from multiple tuples", "body": "<p>With this sort of grouping problems, I think it's a bit of a red herring that the data already looks grouped. Can you always be sure of that? What if the data looks like the following?</p>\n\n<pre><code>[[(\"Erikson,Ann\",2.0,3),(\"Erikson,Ann\",3.33,3),(\"Lewis,Buck\",2.66,1)], \n [(\"Lewis,Buck\",2.0,3)]]\n</code></pre>\n\n<p>Or like this?</p>\n\n<pre><code>[[(\"Erikson,Ann\",2.0,3),(\"Erikson,Ann\",3.33,3),(\"Lewis,Buck\",2.66,1)], []]\n</code></pre>\n\n<p>Notice that in the first example, one entry for <code>\"Lewis,Buck\"</code> is grouped together with entries for <code>\"Erikson,Ann\"</code>. The second example, on the other hand, contains an empty list.</p>\n\n<p>Most attempts I've seen at solving problems like this does so by utilising <strong>unsafe</strong> (i.e. non-total) functions like <code>head</code>. This can lead to wrong implementations or run-time crashes.</p>\n\n<p>Haskell is a great language exactly because you can use the type system to keep you honest. If the original input wasn't already grouped, it'd be safer to use ungrouped data. Otherwise, you can flatten the input using <code>concat</code>. I'm here assuming that the example data in the OP is called <code>sample</code>:</p>\n\n<pre><code>*Q52527030&gt; concat sample\n[(\"Erikson,Ann\",2.0,3.0),(\"Erikson,Ann\",3.33,3.0),(\"Lewis,Buck\",2.66,1.0),\n (\"Lewis,Buck\",2.0,3.0),(\"Smith,John\",0.0,1.0),(\"Smith,John\",1.66,3.0),\n (\"Smith,John\",1.33,3.0),(\"Torvell,Sarah\",4.0,3.0)]\n</code></pre>\n\n<p>This gives you a nice flat list on which you can perform a custom grouping operation:</p>\n\n<pre><code>import qualified Data.Map.Strict as Map\n\narrangeByFst :: Ord a =&gt; [(a, b, c)] -&gt; [(a, [(b, c)])]\narrangeByFst = Map.toList . foldl updateMap Map.empty\n  where updateMap m (x, y, z) = Map.insertWith (++) x [(y, z)] m\n</code></pre>\n\n<p>Here I've chosen to take a shortcut and use the built-in <code>Map</code> module, but otherwise, writing a function similar to <code>Map.insertWith</code> on a list of tuples isn't <em>too</em> hard.</p>\n\n<p>This function takes a flat list of triples and groups them into pairs keyed by the first element, but with the other element being a list of data.</p>\n\n<p>If you apply that to the flattened <code>sample</code> input, you get this:</p>\n\n<pre><code>*Q52527030&gt; arrangeByFst $ concat sample\n[(\"Erikson,Ann\",[(3.33,3.0),(2.0,3.0)]),(\"Lewis,Buck\",[(2.0,3.0),(2.66,1.0)]),\n (\"Smith,John\",[(1.33,3.0),(1.66,3.0),(0.0,1.0)]),(\"Torvell,Sarah\",[(4.0,3.0)])]\n</code></pre>\n\n<p>This is a more robust approach because it doesn't rely on any particular assumptions about how data is ordered.</p>\n\n<p>Each element in this list is a pair, where the first element is the name, and the second element is a list of grades. You can add a function to calculate the GPA of such a pair:</p>\n\n<pre><code>calculateGPA :: Fractional b =&gt; (a, [(b, b)]) -&gt; (a, b)\ncalculateGPA (n, ts) = (n, sumOfGrades ts / numberOfGrades ts)\n  where\n    sumOfGrades grades = sum $ map (\\(gp, c) -&gt; gp * c) grades\n    numberOfGrades grades = fromIntegral (length grades)\n</code></pre>\n\n<p>This function takes as input a tuple where the second element is a list of tuples <code>ts</code>. It calculates <code>sumOfGrades</code> by mapping each tuple of grade points <code>gp</code> and credits <code>c</code> into the product of the two, and then taking the <code>sum</code> of those numbers. It then divides that number by the length of the list of grades.</p>\n\n<p>You can now map the list produced in the previous step to calculate the GPA of each person:</p>\n\n<pre><code>*Q52527030&gt; map calculateGPA $ arrangeByFst $ concat sample\n[(\"Erikson,Ann\",7.995),(\"Lewis,Buck\",4.33),(\"Smith,John\",2.9899999999999998),\n (\"Torvell,Sarah\",12.0)]\n</code></pre>\n\n<p>Apart from using <code>Data.Map.Strict</code>, I've deliberately attempted to strike a balance between keeping things basic, but still safe. A more sophisticated approach could have used <code>fmap</code> instead of <code>map</code>, <code>join</code> instead of <code>concat</code>, more point-free style, and so on. There's always room for improvement.</p>\n"}], "owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1538065503, "creation_date": 1538002178, "last_edit_date": 1538025590, "question_id": 52527030, "link": "https://stackoverflow.com/questions/52527030/calculating-from-multiple-tuples", "title": "Calculating from multiple tuples", "body": "<p>I'm trying to take a list of lists of tuple and turn each list of tuples into a single tuple. Like this:</p>\n\n<p>Currently have:    </p>\n\n<pre><code>[[(\"Erikson,Ann\",2.0,3),(\"Erikson,Ann\",3.33,3)],[(\"Lewis,Buck\",2.66,1), \n  (\"Lewis,Buck\",2.0,3)],[(\"Smith,John\",0.0,1),(\"Smith,John\",1.66,3), \n  (\"Smith,John\",1.33,3)],[(\"Torvell,Sarah\",4.0,3)]]\n</code></pre>\n\n<p>And I want the form to be a single list of tuples. One tuple for each persons name. \nAlong with combining the list of tuples into a single tuple I want to use the second and third elements of each tuple to calculate the gpa of the person. The second number is the grade point for that class and the third number is the credits for the class.\nWhat I need to do is take the sum of credits * gradepoint for each tuple and then divide that sum by the sum of all the credits in each tuple. </p>\n\n<p>What i have so far, that doesn't work is this...</p>\n\n<pre><code>     calcGPA :: MyType2 -&gt; MyType2 -&gt; (String, Double, Double)\n     calcGPA (a,b,c) (d,e,f) = (a, ((b*(fromIntegral c))+(e*(fromIntegral \n     f))/(b+e)), \n     (b+e))\n</code></pre>\n\n<p>Where i am passing in the first list of lists I show at the top of this post.</p>\n\n<p>Am I going in the right direction to solve this problem. Any tips or help would be appreciated.</p>\n\n<p>Thank you</p>\n\n<hr>\n\n<p>EDIT</p>\n\n<p>Thank you for the help! Helped me understand what was actually going on. I wrote the cumulativeSums fuction as follow:</p>\n\n<pre><code>     cumulativeSums :: (Double, Int) -&gt; (String, Double, Int) -&gt; (Double, \n     Int)\n     cumulativeSums (a,b) (c,d,e) = (a+(d*e), b+e)\n</code></pre>\n\n<p>I'm confused on the chunk of code you have above with the let. Where does this go? Do I put it in its own function that I call passing in the list of list of tuples?</p>\n\n<p>Thank you</p>\n\n<p>________________________________________________________________________________Now that im trying to output credits also</p>\n\n<pre><code>    calcGPA :: [(String, Double, Int)] -&gt; (String, Double, Int)\n    calcGPA grades = let name                        = (\\ (name, _, _) -&gt; \n    name) (head grades)\n                         (name, weightedSum, sumOfWeights) = foldl \n    cumulativeSums (name, 0, 0) grades\n                 gpa                         = weightedSum / sumOfWeights\n                     in  (name, gpa, credits)\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "pattern-matching"], "comments": [{"owner": {"reputation": 1253, "user_id": 4733879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5iiSX.png?s=128&g=1", "display_name": "Filnor", "link": "https://stackoverflow.com/users/4733879/filnor"}, "edited": false, "score": 5, "creation_date": 1538032766, "post_id": 52526944, "comment_id": 92002291, "body": "Please do not vandalize your posts. If you believe your question is not useful or is no longer useful, it should be <i>deleted</i> instead of editing out all of the data that actually makes it a question. By posting on the Stack Exchange network, you&#39;ve granted a non-revocable right for SE to distribute that content (under the CC BY-SA 3.0 license). By SE policy, any vandalism will be reverted."}, {"owner": {"reputation": 137098, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "edited": false, "score": 0, "creation_date": 1538033202, "post_id": 52526944, "comment_id": 92002528, "body": "You can&#39;t easily delete a question which has upvoted answers, though."}], "answers": [{"comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1538011795, "post_id": 52527312, "comment_id": 91995861, "body": "Good answer, however, I think that mentioning pattern matching vs partial functions (<code>head</code>, <code>tail</code>) might be a good addition."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1575139948, "post_id": 52527312, "comment_id": 104468228, "body": "obligatory dv for the top voted answer with needlessly partial solution. sry."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 6, "last_activity_date": 1538004247, "creation_date": 1538004247, "answer_id": 52527312, "question_id": 52526944, "link": "https://stackoverflow.com/questions/52526944/rotate-function-in-haskell/52527312#52527312", "title": "Rotate function in Haskell", "body": "<p><code>[y]</code> does not mean \"let <code>y</code> be a list\". It means \"this argument is a list containing one element called <code>y</code>\". You have the right structure, but you don't need the brackets around the <code>y</code>.</p>\n\n<pre><code>rotate :: Int -&gt; [a] -&gt; [a]\nrotate 0 y = y\nrotate x y = rotate (x-1) (tail y ++ [head y])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29068, "user_id": 149436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc4c5aa5126e36603eabdfdc57c46583?s=128&d=identicon&r=PG", "display_name": "Evan Trimboli", "link": "https://stackoverflow.com/users/149436/evan-trimboli"}, "is_accepted": false, "score": 1, "last_activity_date": 1538004324, "last_edit_date": 1538004324, "creation_date": 1538004299, "answer_id": 52527321, "question_id": 52526944, "link": "https://stackoverflow.com/questions/52526944/rotate-function-in-haskell/52527321#52527321", "title": "Rotate function in Haskell", "body": "<p>I think you want something like this:</p>\n\n<pre><code>rotate :: Int -&gt; [a] -&gt; [a]\nrotate 0 x = x\nrotate times (x:xs) = rotate (times - 1) (xs ++ [x])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1575140214, "post_id": 58328879, "comment_id": 104468298, "body": "not to mention it being non-partial, unlike those other solutions. :)"}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1570731388, "creation_date": 1570731388, "answer_id": 58328879, "question_id": 52526944, "link": "https://stackoverflow.com/questions/52526944/rotate-function-in-haskell/58328879#58328879", "title": "Rotate function in Haskell", "body": "<p><strong>TL&amp;DR</strong></p>\n\n<pre><code>rotate :: Int -&gt; [a] -&gt; [a]\nrotate = drop &lt;&gt; take\n</code></pre>\n\n<p>In Haskell the most concise but also a curious way to rotate a list could be using the <code>Semigroup</code> type class instance of the function type <code>(a -&gt; b)</code>. Lets check the relevant part of the instance.</p>\n\n<pre><code>instance Semigroup b =&gt; Semigroup (a -&gt; b) where\n        f &lt;&gt; g = \\x -&gt; f x &lt;&gt; g x\n</code></pre>\n\n<p>First things first, <code>&lt;&gt;</code> is in fact the inline version of the <code>mappend</code> function from the <code>Monoid</code> type class.</p>\n\n<p>Then we see, the <code>Semigroup b =&gt;</code> constraint in the type signature states that the return type <code>b</code> should also be a member of <code>Semigroup</code> type class. Since we use <code>drop :: Int -&gt; [a] -&gt; [a]</code> and <code>take :: Int -&gt; [a] -&gt; [a]</code> we can quickly notice that <code>b</code> is in fact another function with type signature <code>[a] -&gt; [a]</code> so it is a member of <code>Semigroup</code> type class if and only if it's <code>b</code>, which happens to be <code>[a]</code> is also a member of the <code>Semigroup</code> type class and it is.</p>\n\n<pre><code>instance Semigroup [a] where\n        (&lt;&gt;) = (++)\n</code></pre>\n\n<p>So everything holds so far but how does it work?</p>\n\n<p>We can deduce from the type signatures as follows;</p>\n\n<ul>\n<li><code>(drop :: Int -&gt; ([a] -&gt; [a])) &lt;&gt; (take :: Int -&gt; ([a] -&gt; [a]))</code> is</li>\n<li><code>\\n -&gt; (drop n :: [a] -&gt; [a]) &lt;&gt; (take n :: [a] -&gt; [a])</code> which is</li>\n<li><code>\\n -&gt; \\xs -&gt; (drop n xs :: [a]) &lt;&gt; (take n xs :: [a])</code> which is</li>\n<li><code>\\n -&gt; \\xs -&gt; (drop n xs) ++ (take n xs)</code></li>\n</ul>\n\n<p>This is basically better than the answers using recursive <code>++</code> operator to add the head as a singleton list to the end of the tail since it yields an O(n^2) time complexity.</p>\n"}], "owner": {"reputation": 97, "user_id": 7350169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03a29f39ab44dae8f625feb700571db4?s=128&d=identicon&r=PG&f=1", "display_name": "Aashray Adhikari", "link": "https://stackoverflow.com/users/7350169/aashray-adhikari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 561, "favorite_count": 0, "accepted_answer_id": 52527312, "answer_count": 3, "score": 2, "last_activity_date": 1570731388, "creation_date": 1538001564, "last_edit_date": 1538032490, "question_id": 52526944, "link": "https://stackoverflow.com/questions/52526944/rotate-function-in-haskell", "title": "Rotate function in Haskell", "body": "<p>I want to write a function in Haskell that rotates the list given as the second argument by the number of positions indicated by the first argument. Using pattern matching, implement a recursive function </p>\n\n<p>I have written the following function:</p>\n\n<pre><code>rotate :: Int -&gt; [a] -&gt; [a]\nrotate 0 [y]= [y]\nrotate x [y]= rotate((x-1) [tail [y] ++ head [y]])\n</code></pre>\n\n<p>but this function always produces a error. Is there any way to solve it?\nThe function should do the following when it runs:</p>\n\n<pre><code>rotate 1 \"abcdef\"\n\"bcdefa\"\n</code></pre>\n"}, {"tags": ["haskell", "types", "haskell-platform"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1537983363, "post_id": 52523288, "comment_id": 91986155, "body": "What are you trying to do here?"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1537983467, "post_id": 52523288, "comment_id": 91986207, "body": "Also please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. The code you posted here gives a different compiler error than the one you are asking about because there is no <code>main</code>."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1537983529, "post_id": 52523288, "comment_id": 91986236, "body": "The code you posted works fine for me."}, {"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537983995, "post_id": 52523288, "comment_id": 91986423, "body": "It&#39;s part of codes in where clause, which I need to compute the result of endX."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1537984481, "post_id": 52523288, "comment_id": 91986641, "body": "Please edit your original question with the missing code."}, {"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537984660, "post_id": 52523288, "comment_id": 91986709, "body": "I&#39;ve added more codes. I hope it&#39;s easier for you to find the problem."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1537985819, "post_id": 52523288, "comment_id": 91987242, "body": "Please post an MCVE - something people can copy and paste to see your same error and avoid guessing what <code>Raster</code> and <code>Coord</code> actually mean."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537986506, "post_id": 52523979, "comment_id": 91987594, "body": "After I&#39; ve done this  | curX &gt; fromIntegral endX  = plotEllipse2 (xc, yc, curX, curY, di2), a new error occured: &quot;Ambiguous type variable &#39;a0&#39; arising from a use of &#39;fromIntegral&#39;."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537986585, "post_id": 52523979, "comment_id": 91987630, "body": "Try the last two paragraphs I just added to my answer. That should help that, but we&#39;ll see."}, {"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537986876, "post_id": 52523979, "comment_id": 91987771, "body": "It shows &quot;No instance for (Integral Double) arising from a use of &#39;fromIntegral&#39;&quot; now."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537986987, "post_id": 52523979, "comment_id": 91987844, "body": "Sorry, I got confused a little when writing the answer. Try switching the <code>fromIntegral</code> to the other side of the <code>&gt;</code>, as shown above in the new version of the answer."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537987092, "post_id": 52523979, "comment_id": 91987906, "body": "You&#39;re welcome. If you want to, try to learn what the type errors were telling you along the way. It&#39;ll help in future encounters with them."}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 2, "creation_date": 1538013152, "post_id": 52523979, "comment_id": 91996127, "body": "Stylistically, its possible to infix <code>(&#47;)</code> operator: <code>endX = (...) &#47; (...)</code>"}], "tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": false, "score": 3, "last_activity_date": 1537986885, "last_edit_date": 1537986885, "creation_date": 1537986121, "answer_id": 52523979, "question_id": 52523288, "link": "https://stackoverflow.com/questions/52523288/no-instance-for-floating-int-fractional-int/52523979#52523979", "title": "No instance for (Floating Int) (Fractional Int)", "body": "<p><code>plotEllipse1</code> takes a tuple of <code>Int</code>s:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>plotEllipse1 :: (Int, Int, Int, Int, Int) -&gt; Raster\n</code></pre>\n\n<p><code>curX</code> is one of the elements of the tuple, so it's an <code>Int</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>plotEllipse1 (x0, y0, curX, curY, curD)\n</code></pre>\n\n<p>You compare <code>curX</code> to <code>endX</code> using <code>&gt;</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  | curX &gt; endX  = plotEllipse2 (xc, yc, curX, curY, di2)\n</code></pre>\n\n<p><code>&gt;</code> is type <code>Ord a =&gt; a -&gt; a -&gt; Bool</code>, which means that the left and right sides must be the same type.</p>\n\n<p><code>endX</code>'s type is in the <code>Fractional</code> and <code>Floating</code> typeclasses because you use <code>sqrt</code> and <code>/</code> to obtain it. But remember, the left and right sides of <code>&gt;</code> must be the same type, so <code>curX</code> has to also have a type with those typeclasses, but <em>its type, <code>Int</code>, definitely isn't part of those typeclasses</em>, which the error messages are complaining about.</p>\n\n<p>So, how do we fix this? We convert <code>curX</code> to <code>endX</code>'s type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  | fromIntegral curX &gt; endX  = plotEllipse2 (xc, yc, curX, curY, di2)\n</code></pre>\n\n<p>Now <code>fromIntegral curX</code> should have the appropriate type.</p>\n\n<hr>\n\n<p>Notice also that you've used <code>fromIntegral</code> elsewhere. You simply missed it in one more place it was needed.</p>\n\n<p>You may also need to give <code>endX</code> a type signature so that the compiler knows <em>which</em> <code>Fractional</code> and <code>Floating</code> type you want to use. For example, <code>Double</code> is a perfectly good candidate, so maybe you'll use:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>endX :: Double\nendX = (/) (fromIntegral sqa) (sqrt (fromIntegral (sqa + sqb)))\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1538029139, "creation_date": 1537983253, "last_edit_date": 1538029139, "question_id": 52523288, "link": "https://stackoverflow.com/questions/52523288/no-instance-for-floating-int-fractional-int", "title": "No instance for (Floating Int) (Fractional Int)", "body": "<p>Here is part of my code:</p>\n\n<pre><code>sqa = a*a \nsqb = b*b\nendX = (/) (fromIntegral sqa) (sqrt (fromIntegral (sqa + sqb)))\n</code></pre>\n\n<p>and both <code>a</code> and <code>b</code> are <code>Int</code>. However, after I use <code>fromIntegral</code> on it, it still shows errors <code>No instance for (Floating Int) arising from a use of 'sqrt'</code> and <code>No instance for (Fractional Int) arising from a use of '/'</code>. I don't know why this happens. Can anyone help me?</p>\n\n<p>More context:</p>\n\n<pre><code>ellipse :: (Int, Int) -&gt; Int -&gt; Int -&gt; [(Int, Int), Double]\nellipse (xc, yc) a b = plotEllipse1 (xc, yc, xi, yi, di1)\nwhere\n   sqa = a*a\n   sqb = b*b\n   xi = 0\n   yi = b\n   di1 = 2*sqb - 2*b*sqa + sqa\n   endX = (/) (fromIntegral sqa) (sqrt (fromIntegral (sqa + sqb)))\n   plotEllipse1 :: (Int, Int, Int, Int, Int) -&gt; Raster\n   plotEllipse1 (x0, y0, curX, curY, curD)\n     | curX &gt; endX  = plotEllipse2 (xc, yc, curX, curY, di2)\n     | otherwise = ...\n</code></pre>\n"}, {"tags": ["regex", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 5, "last_activity_date": 1537983205, "last_edit_date": 1537983205, "creation_date": 1537981943, "answer_id": 52522966, "question_id": 52522742, "link": "https://stackoverflow.com/questions/52522742/need-help-for-haskell-regular-expression/52522966#52522966", "title": "Need help for Haskell regular expression", "body": "<pre><code>&gt; matchTest (mkRegex \"\\\\\\\\[a-zA-Z0-9]+\") \"\\\\begin\"\nTrue\n</code></pre>\n\n<p>There are a couple of issues with your line of code.</p>\n\n<ul>\n<li>The regular expression isn't quoted correctly, the string needs to be within double quotes. (But you should get a syntax error for that.)</li>\n<li>The regular expressions supported by <code>regex-compat</code> (I assume that's the package you're using) are the same as those supported by <code>egrep</code>, and they don't know <code>:alnum:</code>.</li>\n<li>Backslash <code>\\</code> is an escape character both within Haskell strings and regular expressions, so you need to escape it.</li>\n</ul>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1538024819, "creation_date": 1537981027, "last_edit_date": 1538024819, "question_id": 52522742, "link": "https://stackoverflow.com/questions/52522742/need-help-for-haskell-regular-expression", "title": "Need help for Haskell regular expression", "body": "<p>Given some strings: <code>\"\\begin\"</code>, <code>\"\\end\"</code> or <code>\"\\section\"</code> etc.</p>\n\n<p>I want to match them with following function and regular expression:</p>\n\n<pre><code>matchTest (mkRegex '\\\\[:alnum:]+')  \"\\begin\"\n</code></pre>\n\n<p>I always get False when I test it in GHCi,</p>\n\n<p>Does anyone know how to match the pattern like <code>\"\\begin\"</code> or <code>\"\\end\"</code> etc.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1537978173, "post_id": 52521926, "comment_id": 91983586, "body": "It&#39;s difficult to answer this question because <code>handValue</code> has other issues that will persist even if this problem is solved. For instance, <code>[Card s r]</code> is an element containing exactly one card. <code>tail [Card s r]</code> will always be <code>[]</code>. <code>length [Card s r]</code> will always be <code>1</code> and, in any event, can never be <code>&lt; 0</code>. If you want to match on a list, think &quot;What do I do with the empty list? What do I do with x cons xs?&quot; In other words, <code>handValue [] = []; handValue (Card s r : cards) = ???</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1537978272, "post_id": 52521926, "comment_id": 91983639, "body": "I think the fundamental confusion here is that <code>handValue [Card s r]</code> does not match on any list of cards, it matches on a list of exactly one element. This is why the pattern is incomplete."}], "answers": [{"tags": [], "owner": {"reputation": 45723, "user_id": 18243, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/607cfd4a5b41fe6c886c978128b9c03e?s=128&d=identicon&r=PG", "display_name": "Jean-Paul Calderone", "link": "https://stackoverflow.com/users/18243/jean-paul-calderone"}, "is_accepted": true, "score": 2, "last_activity_date": 1537978086, "creation_date": 1537978086, "answer_id": 52522052, "question_id": 52521926, "link": "https://stackoverflow.com/questions/52521926/non-exhaustive-patterns-in-function-in-haskell/52522052#52522052", "title": "Non-exhaustive patterns in function in Haskell", "body": "<p>In:</p>\n\n<pre><code>handValue :: [Card] -&gt; [Int]\nhandValue [Card s r] \n</code></pre>\n\n<p>you're defining the function for the case of a length 1 list passed as the first argument.  You haven't defined the function for the other cases - length less than 1 or length greater than 1.</p>\n\n<p><code>[Card s r]</code> is a pattern that matches the length 1 list and unpacks the only value in it in to <code>s</code> and <code>r</code>.  It looks like you want to do something more like:</p>\n\n<pre><code>handValue cards\n| (length cards) &lt; 0 = ...\n| otherwise          = []\n</code></pre>\n\n<p>but this doesn't quite make sense since the length of a list can never be less than 0.</p>\n\n<p>Perhaps you mean something more like:</p>\n\n<pre><code>handValue [] = []\nhandValue (Card s r):cards = (fromEnum r + 1) : handValue cards\n</code></pre>\n\n<p>which pattern matches the empty list and the non-empty list which should be exhaustive.</p>\n"}], "owner": {"reputation": 19, "user_id": 10347763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ecd1dd294b69ae2be2828b680253dd3?s=128&d=identicon&r=PG&f=1", "display_name": "maggibaggi", "link": "https://stackoverflow.com/users/10347763/maggibaggi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "closed_date": 1537980150, "accepted_answer_id": 52522052, "answer_count": 1, "score": -2, "last_activity_date": 1537978086, "creation_date": 1537977613, "question_id": 52521926, "link": "https://stackoverflow.com/questions/52521926/non-exhaustive-patterns-in-function-in-haskell", "closed_reason": "Duplicate", "title": "Non-exhaustive patterns in function in Haskell", "body": "<p>Im trying to write a function that takes in list of Cards and gives me back all the rank values. Im getting the problem of Non-exhaustive patterns in function and I can't fix it</p>\n\n<pre><code>data Card = Card Suit Rank\n          deriving (Show, Bounded, Read)\n\ndata Suit = Red\n          | Black\n          deriving (Show, Enum, Bounded, Read)\n\ndata Rank = Ace   \n          | Two\n          | Three\n          | Four\n          | Five\n          | Six\n          | Seven\n          | Eight\n          | Nine\n          | Ten\n          deriving (Show, Enum, Bounded, Read)\n\nhandValue :: [Card] -&gt; [Int]\nhandValue [Card s r] \n    | (length [Card s r]) &lt; 0 = (fromEnum (r) + 1) : handValue (tail [Card s r])\n    | otherwise               = []\n</code></pre>\n\n<p>What Can I do to counter this problem?</p>\n"}, {"tags": ["list", "function", "haskell", "conditional-statements", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1538007102, "post_id": 52521608, "comment_id": 91994823, "body": "@AJFarmar I appreciate the edit, shadowing is probably confusing for newcomers. although sometimes I like to use it in these kinds of situations with enumerations: &quot;for each <code>n</code> from 1 to the given limit, ...&quot;. :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1537977318, "last_edit_date": 1537977318, "creation_date": 1537976546, "answer_id": 52521608, "question_id": 52521386, "link": "https://stackoverflow.com/questions/52521386/haskell-creating-a-list-based-on-conditions-returned-by-functions/52521608#52521608", "title": "Haskell - Creating a List based on conditions returned by functions", "body": "<p>Look closer at your definition</p>\n\n<pre><code>isPerfect n = n == sum [i | i &lt;- [1..n-1], n `mod` i == 0]   -- NB the `mod`\n</code></pre>\n\n<p>it is already keeping such numbers <code>i</code> that pass the test, <code>n `mod` i == 0</code>, and drops all the others.</p>\n\n<p>So you just make use of the same principle:</p>\n\n<pre><code>perfectsTo :: Int -&gt; [Int]\nperfectsTo n = [i | i &lt;- [1..n], isPerfect i]\n</code></pre>\n\n<p>Yes it does work. The <code>[] ==</code> is superfluous there.</p>\n"}], "owner": {"reputation": 13, "user_id": 10419664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17ec748638eb1e445ecdc57dd5c0df2f?s=128&d=identicon&r=PG&f=1", "display_name": "I Boiten", "link": "https://stackoverflow.com/users/10419664/i-boiten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 52521608, "answer_count": 1, "score": 0, "last_activity_date": 1537977318, "creation_date": 1537975850, "last_edit_date": 1537976799, "question_id": 52521386, "link": "https://stackoverflow.com/questions/52521386/haskell-creating-a-list-based-on-conditions-returned-by-functions", "title": "Haskell - Creating a List based on conditions returned by functions", "body": "<p>I have a function that figures out if a certain value is a Perfect Number (Adding up all it's factors, except itself, produces itself) and returns a Boolean based on it's result:</p>\n\n<pre><code>isPerfect :: Int -&gt; Bool\nisPerfect n = n == sum [i | i &lt;- [1..n-1], n mod i == 0]\n</code></pre>\n\n<p>I now have a function which tries to use this function's result as a condition, which if true, results in a value being placed into a list, and if not, it ignores that value. Since I started using Haskell 2 days ago, I am struggling greatly with doing this (I'm more used to Python). This is my first attempt at something plausible: </p>\n\n<pre><code>isPerfectUpToN :: Int -&gt; [Int]\nisPerfectUpToN n = [] insert y\nwhere\ny = [1..n] AND isPerfect y == True\n</code></pre>\n\n<p>I've tried many different google searches to see if this list could be created using list comprehension, something along the lines of</p>\n\n<pre><code>[] == [y | y &lt;- [1..n], isPerfect y]\n</code></pre>\n\n<p>But this implementation didn't work. Since I do want to learn Haskell, can somebody help me (preferably using only the commands available in prelude) with getting this conditional check to work?</p>\n"}, {"tags": ["haskell", "linear-search"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1537969908, "post_id": 52518817, "comment_id": 91978265, "body": "You seem to be starting to write a recursive algorithm but then use list notation for just the current case (<code>x</code>) and ignore the remainder of the list (<code>xs</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 10408948, "user_type": "registered", "profile_image": "https://graph.facebook.com/1102103916621870/picture?type=large", "display_name": "Andrei Bercea", "link": "https://stackoverflow.com/users/10408948/andrei-bercea"}, "edited": false, "score": 0, "creation_date": 1537974367, "post_id": 52520464, "comment_id": 91981351, "body": "Hello. Thank you for your response. Returning those exact values is a contraint of my assignment. I understood your way of solving this problem, but unfortunately I can&#39;t take this way in solving it. A solution that I know for sure that works is creating a new list of indexes and zipping it to the existent one of values, but I am still trying to figure out how to write that :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 57, "user_id": 10408948, "user_type": "registered", "profile_image": "https://graph.facebook.com/1102103916621870/picture?type=large", "display_name": "Andrei Bercea", "link": "https://stackoverflow.com/users/10408948/andrei-bercea"}, "edited": false, "score": 0, "creation_date": 1537976577, "post_id": 52520464, "comment_id": 91982725, "body": "You can use the same approach; you just need to check the return value of the recursive call. If it is -1, return that. Otherwise, return that value + 1."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 57, "user_id": 10408948, "user_type": "registered", "profile_image": "https://graph.facebook.com/1102103916621870/picture?type=large", "display_name": "Andrei Bercea", "link": "https://stackoverflow.com/users/10408948/andrei-bercea"}, "edited": false, "score": 1, "creation_date": 1537976659, "post_id": 52520464, "comment_id": 91982768, "body": "Or, just wrap the <code>Maybe</code> version: <code>maybe (-1) id . linsearch</code> returns -1 if <code>linsearch</code> returns <code>Nothing</code>, or extracts the wrapped <code>Int</code> from a <code>Just</code> response."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1537973109, "creation_date": 1537973109, "answer_id": 52520464, "question_id": 52518817, "link": "https://stackoverflow.com/questions/52518817/haskell-linear-search-returning-index/52520464#52520464", "title": "Haskell Linear Search (returning index)", "body": "<p>Returning <code>-1</code> to represent a failed search is something you do in a language with a bad type system. Also, there is no reason to find <em>all</em> the elements if you only care about the first one. Further, <code>head</code> will fail if the resulting list is empty.</p>\n\n<pre><code>linsearch :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int\nlinsearch _ [] = Nothing\nlinsearch y (x:xs) | y == x = Just 0\n                   | otherwise = fmap (+ 1) (linsearch y xs)\n</code></pre>\n\n<p>An empty list obviously fails: return <code>Nothing</code>. With a non-empty list, check if\nthe first element is the one you are looking for; if so, return <code>Just 0</code>. Otherwise, <code>y</code> may or may not be in <code>xs</code>; recurse to find out. You'll add 1 to that result to account for <code>xs</code> being the \"shifted\" version of the original list. You need to use <code>fmap</code> because you won't be adding 1 to some integer <code>y</code>; you'll be adding it to a \"wrapped\" value like <code>Just y</code>, or possibly <code>Nothing</code> if <code>y</code> really isn't in the list. Note</p>\n\n<pre><code>fmap (+1) Nothing == Nothing\nfmap (+1) (Just 3) == Just 4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1537975712, "last_edit_date": 1537975712, "creation_date": 1537973879, "answer_id": 52520743, "question_id": 52518817, "link": "https://stackoverflow.com/questions/52518817/haskell-linear-search-returning-index/52520743#52520743", "title": "Haskell Linear Search (returning index)", "body": "<p><em>TL;DR: the solution is at the end of the post.</em></p>\n\n<p>You don't need the list decomposition pattern in your definition, just deal with the list as a whole through the list comprehension:</p>\n\n<pre><code>linsearch :: Eq a =&gt; a -&gt; [a] -&gt; Int\nlinsearch _ [] = -1\nlinsearch y xs = head [i | let j = length xs, i &lt;- [0..j-1],\n                           -- y == x  -- x? what is that?\n                           y == (xs!!i)]\n</code></pre>\n\n<p>Now <code>linsearch 3 [0..9]</code> returns <code>3</code>, as it should. But <code>linsearch 3 [0..]</code> doesn't return at all -- it is lost in trying to calculate the list's length, which isn't actually needed here at all! Moreover, ditching the length calculation makes us re-arrange the algorithm  from its currently <em>quadratic</em> form into the much better, <em>linear</em> one:</p>\n\n<pre><code>linsearch :: Eq a =&gt; a -&gt; [a] -&gt; Int\nlinsearch _ [] = -1\nlinsearch y xs = head [i | (x,i) &lt;- zip xs [0..], y == x]\n</code></pre>\n\n<p><code>linsearch 3 [0..]</code> now successfully returns <code>3</code>, <em>as it should</em>. </p>\n\n<p><code>linsearch 3 [0,2..]</code> still diverges though (i.e. never returns), because Haskell doesn't know -- nor does it <em>want to</em> -- that there's no point searching on an ordered <em>increasing</em> list while past the very first element which is larger than the one we're searching for. That is so because <code>[a]</code> is the type of <em>lists</em>, not of <em>ordered</em> lists.</p>\n\n<p>We could define such variant though too, as e.g.</p>\n\n<pre><code>linsearchOrdered :: Ord a =&gt; a -&gt; [a] -&gt; Int\nlinsearchOrdered y xs = linsearch y $ takeUntil (&gt; y) xs\n\ntakeUntil :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ntakeUntil p xs = foldr (\\x r -&gt; if not (p x) then x:r else [x]) [] xs\n</code></pre>\n\n<p>And sure enough, it is working now:</p>\n\n<pre><code>&gt; linsearchOrdered 3 [0,2..]\n*** Exception: Prelude.head: empty list\n\n&gt; takeUntil (&gt; 3) [0,2..]\n[0,2,4]\nit :: (Ord a, Num a, Enum a) =&gt; [a]    \n\n&gt; linsearch 3 [0,2,4]\n*** Exception: Prelude.head: empty list\n</code></pre>\n\n<p>wait, what? Where's the error coming from? It comes from your use of <code>head</code>: since there were no <code>3</code> found in <code>[0,2,4]</code>, you code calls <code>head []</code> which is an error.</p>\n\n<p>Instead, we can use <code>take 1</code>, and convert its result to a <code>Maybe a</code> with a standard use of <code>listToMaybe</code>:</p>\n\n<pre><code>import Data.Maybe\n\nlinsearch :: (Eq a) =&gt; a -&gt; [a] -&gt; Maybe Int\nlinsearch y xs = listToMaybe $ take 1 [i | (x,i) &lt;- zip xs [0..], y == x]\n</code></pre>\n\n<p>Ok, <em>now</em> it's working:</p>\n\n<pre><code>&gt; linsearchOrdered 3 [0,2..]\nNothing    \n\n&gt; linsearchOrdered 4 [0,2..]\nJust 2\n</code></pre>\n\n<p>Note the return type is different now. Instead of using a special value, we use a wrapping type to indicate the success (with <code>Just</code>) or failure (with <code>Nothing</code>):</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>If you really want <em>your</em> original design, we can code it as</p>\n\n<pre><code>linsearch y xs = head $ [i | (x,i) &lt;- zip xs [0..], y == x] ++ [-1]\n</code></pre>\n\n<p>Haskell is <em>lazy</em> so <code>head</code> will (safely, now, with the <code>++ [-1]</code>) stop on the first matching element (if at all possible). There's almost no duplicated effort going to waste, both with using <code>head</code> and <code>takeUntil</code>. </p>\n\n<p>Both are folds though. <code>zip</code> can be coded as a fold as well, so <code>linsearch</code> is a fold too. And <a href=\"https://stackoverflow.com/questions/52034032/using-a-filtered-list-in-a-new-function-in-haskell/52034637#52034637\">folds composition can be fused into one fold</a> by fusing the reducer functions, turning it all into an explicitly one-pass algorithm, if so desired.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1538035519, "post_id": 52528534, "comment_id": 92003751, "body": "<code>caseExtract = fromMaybe (-1)</code>. it is defined in <code>Data.Maybe</code>. :)"}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1538035628, "post_id": 52528534, "comment_id": 92003821, "body": "@WillNess  Good looks!"}], "tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": false, "score": 1, "last_activity_date": 1538035942, "last_edit_date": 1538035942, "creation_date": 1538015317, "answer_id": 52528534, "question_id": 52518817, "link": "https://stackoverflow.com/questions/52518817/haskell-linear-search-returning-index/52528534#52528534", "title": "Haskell Linear Search (returning index)", "body": "<p>There is a function <code>elemIndex</code> in <code>Data.List</code> which does exactly what you want. Your function could be written as follows:</p>\n\n<pre><code>import Data.List\nlinsearch y xs = elemIndex y xs\n</code></pre>\n\n<p><code>elemIndex</code> returns a <code>Maybe Int</code>. So calling <code>linsearch 5 []</code> yields <code>Nothing</code> while <code>linsearch 5 [3,4,5]</code> yields <code>Just 2</code>. Side note, the above implementation allows you to drop the <code>xs</code>: <code>linsearch y = elemIndex y</code> is valid. Now if you want to return only an <code>Int</code> we can \"extract\" the value from the <code>Maybe</code> using a <code>case</code> expression:</p>\n\n<pre><code>linsearch y xs = caseExtract $ elemIndex y xs\n  where\n    caseExtract m = case m of\n                      Just a  -&gt; a\n                      Nothing -&gt; -1\n</code></pre>\n\n<p>If ya wanna get really fancy, you could go \"point-free\" by dropping the <code>xs</code> and using composition<code>(.)</code> with <code>fromMaybe</code> from <code>Data.Maybe</code> :</p>\n\n<pre><code>import Data.List\nimport Data.Maybe\nlinsearch y = fromMaybe (-1) . elemIndex y\n</code></pre>\n\n<p>The benefit of using library functions like <code>elemIndex</code> is that they are safe, unlike <code>head</code> which will go boom if passed an empty list. Reference: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch20.html#x28-24400020.7\" rel=\"nofollow noreferrer\">Haskell Report</a> <a href=\"http://learnyouahaskell.com/modules#data-list\" rel=\"nofollow noreferrer\">LYAH Data.List</a> <a href=\"https://www.reddit.com/r/haskell/comments/5n51u3/why_are_partial_functions_as_in_head_tail_bad/\" rel=\"nofollow noreferrer\">reddit unsafe head</a> <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Maybe.html\" rel=\"nofollow noreferrer\">fromMaybe</a></p>\n"}], "owner": {"reputation": 57, "user_id": 10408948, "user_type": "registered", "profile_image": "https://graph.facebook.com/1102103916621870/picture?type=large", "display_name": "Andrei Bercea", "link": "https://stackoverflow.com/users/10408948/andrei-bercea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1083, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1538035942, "creation_date": 1537968145, "question_id": 52518817, "link": "https://stackoverflow.com/questions/52518817/haskell-linear-search-returning-index", "title": "Haskell Linear Search (returning index)", "body": "<p>So, I want my function to return the index (the first if it appears multiple times in the list) of a given value. It appears to work only for an empty list or if the given element has the index 0. Could you let me know what I do wrong?</p>\n\n<pre><code>linsearch _ [] = -1\nlinsearch y (x:xs) = head [i | let j = length xs, i &lt;- [0..j-1], y == x]\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "types", "entity-relationship"], "comments": [{"owner": {"reputation": 725, "user_id": 1117884, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/uoBrU.png?s=128&g=1", "display_name": "yokto", "link": "https://stackoverflow.com/users/1117884/yokto"}, "edited": false, "score": 1, "creation_date": 1537968559, "post_id": 52518413, "comment_id": 91977431, "body": "Well where do you store the <code>Budget</code>s? They must be in a kind of list somewhere right? You can easily write a function <code>lookupProject :: [Budget] -&gt; ProjectID -&gt; Budget</code>. Of course in a real life application you would just use a database."}, {"owner": {"reputation": 115, "user_id": 3680029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2f9062247d1bcf616e8a6cf493c00fc?s=128&d=identicon&r=PG&f=1", "display_name": "user3680029", "link": "https://stackoverflow.com/users/3680029/user3680029"}, "reply_to_user": {"reputation": 725, "user_id": 1117884, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/uoBrU.png?s=128&g=1", "display_name": "yokto", "link": "https://stackoverflow.com/users/1117884/yokto"}, "edited": false, "score": 0, "creation_date": 1537971463, "post_id": 52518413, "comment_id": 91979319, "body": "May be my example is awkward, I also feel that &quot;records&quot; should exist somewhere outside the program to work this out (a list is kind of storing structure). I came to this problem when I wanted to implement the getBudget with my two test value. I think in OOP this is piece of cake. I think in FPL you do not manipulate object but structure (object inside). If my question is misplaced I have no pb if my post is banned."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1537982954, "creation_date": 1537982954, "answer_id": 52523231, "question_id": 52518413, "link": "https://stackoverflow.com/questions/52518413/haskell-express-relationship-between-type-values/52523231#52523231", "title": "Haskell express relationship between type values", "body": "<p>No, you're not right. That function can be easily coded. </p>\n\n<p>You could start e.g. with two lists, of types <code>[Budget]</code> and <code>[Project]</code>. </p>\n\n<p>Then using the module <code>Data.Map</code> you could build two dictionaries, <code>Map ProjectID Budget</code> and <code>Map ProjectId Project</code>, and run your lookup queries on those. These would serve as two database tables.</p>\n\n<p>If budgets and projects tables exist separately, you can pair up different budgets and projects tables as arguments to your query functions. </p>\n\n<p>If you push the budget into your project data type, you'd have just one table, which could also be implemented as a <code>Map</code> of course. Then if a project's budget changes you'd have to update that table, i.e. create its copy with an updated entry for that project. This is also easily done with the functions from same <code>Data.Map</code> module.</p>\n"}], "owner": {"reputation": 115, "user_id": 3680029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2f9062247d1bcf616e8a6cf493c00fc?s=128&d=identicon&r=PG&f=1", "display_name": "user3680029", "link": "https://stackoverflow.com/users/3680029/user3680029"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537982954, "creation_date": 1537966973, "question_id": 52518413, "link": "https://stackoverflow.com/questions/52518413/haskell-express-relationship-between-type-values", "title": "Haskell express relationship between type values", "body": "<p>I am new to haskell, I started for my own \"culture\" to code the following project <a href=\"https://owickstrom.github.io/domain-modelling-with-haskell-workshop/\" rel=\"nofollow noreferrer\">https://owickstrom.github.io/domain-modelling-with-haskell-workshop/</a>, my first attempt was to define Budget and Project as separate data types (as suggested by the author) but rapidly when working on the function getBudget I was unable to find a way of relating a given Project with its Budget with reference to projectID field.\n[ I just follow gradually the instruction and create code along the way, personally I think that budget should an \"intrinsic\" attribute of a project and no need to create a separate structure for coding the Budget which should lead to attempt2, but nevertheless...]</p>\n\n<p>attempt1:</p>\n\n<pre><code>data Budget = Budget ProjectID Income Expenditure deriving Show\ndata Project = SingleP ProjectID Name| GroupP [Project] deriving Show\n</code></pre>\n\n<p>for testing purposes I created two \"instances\" </p>\n\n<pre><code>testProject = SingleP 1 \"Haskell workshop\"\ntestBudget = Budget 1 100000.0 50000.0\n</code></pre>\n\n<p>testProject &lt;-> testBudget are related by the ID of the project. I didn't manage to write a function that will take an ID then \"lookup\" a corresponding Budget and retrieve budget data. Failing to do this, I think that I should create a data type which \"embeds\" the relation like this (attempt2):</p>\n\n<pre><code>data Budget = Budget Income Expenditure   \ndata Project = SingleP ProjectID Name Budget ....\n</code></pre>\n\n<p>then <code>testProject = SingleP 1 \"Haskell worskhop\" testBudget</code></p>\n\n<p>My questions:\n- Am I right saying that it's not possible to code such relationship, (I suspect that this is due to variable immutability, simply saying I cannot \"access\" testBudget in Haskell)?\n- any such \"sql'ish\" Domain Model should build around \"total\" Data type i.e. one that \"encapsulate\" also the relation, because the relation cannot be programmed in a functional way.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1537958097, "post_id": 52515317, "comment_id": 91970930, "body": "This question is no longer necessary, because it was responded in the link provided by in the answer to the question <a href=\"https://stackoverflow.com/questions/52513998/how-to-create-a-monad-that-combines-state-and-error-in-haskell/52514310?noredirect=1#52513998\">How to create a monad that combines state and error in Haskell</a>."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1537958680, "post_id": 52515317, "comment_id": 91971267, "body": "<code>fmap = liftM</code> can be used if you want to reuse the Monad instance."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1537959051, "post_id": 52515317, "comment_id": 91971507, "body": "@4castle How does it differ from <code>fmap f x = x &gt;&gt;= (pure . f)</code> in the &quot;adding&quot; link on the other question, copied <a href=\"https://ideone.com/a2NTSt\" rel=\"nofollow noreferrer\">here</a> ?"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1537960316, "post_id": 52515317, "comment_id": 91972231, "body": "@4castle Got it after looking in <a href=\"https://www.haskell.org/hoogle/?hoogle=liftM\" rel=\"nofollow noreferrer\">Hoogle</a> for <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#liftM\" rel=\"nofollow noreferrer\"><code>liftM</code></a>: they are equivalent definitions."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537971952, "post_id": 52515317, "comment_id": 91979655, "body": "It&#39;s OK to post an answer yourself and accept it, to signal that the question is resolved. :)"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "closed_date": 1537972059, "answer_count": 0, "score": 1, "last_activity_date": 1537957308, "creation_date": 1537956845, "last_edit_date": 1537957308, "question_id": 52515317, "link": "https://stackoverflow.com/questions/52515317/how-to-base-the-definition-of-my-custom-monad-on-its-functor-definition-in-haske", "closed_reason": "Duplicate", "title": "How to base the definition of my custom monad on its functor definition in Haskell", "body": "<p>I have defined in Haskell a custom monad combining state and error processing like this:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\n\ndata Result a e = Ok a | Error e\n\nnewtype StateError s e a = StateError { runStateError :: s -&gt; (Result a e, s) }\n\ninstance Functor (StateError s e) where\n  fmap f m = StateError $\n    \\s -&gt; case runStateError m s of\n            (Ok x, s1) -&gt; (Ok (f x), s1)\n            (Error e, s1) -&gt; (Error e, s1)\n\ninstance Applicative (StateError s e) where\n  pure x = StateError $ \\s -&gt; (Ok x, s)\n  a &lt;*&gt; b = ap a b\n\ninstance Monad (StateError s e) where\n  return = pure\n\n  m &gt;&gt;= f = StateError $\n    \\s -&gt; case runStateError m s of\n            (Ok x, s1) -&gt; runStateError (f x) s1\n            (Error e, s1) -&gt; (Error e, s1)\n\nget = StateError $ \\s -&gt; ((Ok s), s)\n\nput s = StateError $ \\_ -&gt; ((Ok ()), s)\n\nmain = return ()\n</code></pre>\n\n<p>The code compiles fine, but it seems there is some redundancy here between the definitions of <code>fmap</code> and the <code>&gt;&gt;=</code> bind operator in the monad.</p>\n\n<p>How can I redefine the bind operator to leverage the functor definition?</p>\n\n<p>If this is not possible, why am I forced to define a functor for my custom monad? \n<br/>It seems useless if I am not going to use <code>fmap</code> anywhere.</p>\n\n<p>Thanks</p>\n\n<p>NOTE: I know monad transformers exist, and perhaps they are the right way to combine the existing state and error monads into one, but I preferred this route for learning reasons (I have little experience with monads).</p>\n\n<p>NOTE: This question is a follow-up of my other question <a href=\"https://stackoverflow.com/questions/52513998/how-to-create-a-monad-that-combines-state-and-error-in-haskell/52514310?noredirect=1#52513998\">How to create a monad that combines state and error in Haskell</a>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1537953365, "post_id": 52513998, "comment_id": 91967931, "body": "about the Applicative, it must be defined too. you just put your <code>return</code> into the Applicative instance under the name <code>pure</code>, and add <code>a &lt;*&gt; b = ap a b</code> there. Then in Monad have <code>return = pure</code>. So this will fix <i>that</i> problem."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1537954556, "post_id": 52513998, "comment_id": 91968661, "body": "Why not just combine <code>StateT</code> with <code>Either</code>, or <code>ExceptT</code> with <code>State</code>?"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1537954784, "post_id": 52513998, "comment_id": 91968820, "body": "@MarkSeemann Because I am a Haskell newbie, trying to create his first monad, and don&#39;t want to mess with monad transformers yet. Also, I am not sure if the monad transformer version is more simple to write or more efficient in terms of performance."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1537955588, "post_id": 52513998, "comment_id": 91969423, "body": "That&#39;s a perfectly fine reason :) It may be useful to know that those monad transformers exist, though, for later."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1537955823, "post_id": 52513998, "comment_id": 91969575, "body": "@MarkSeemann Yes, Mark, I know they exist, and also &quot;comonads&quot;, &quot;free monads&quot;, and all sorts of &quot;costrangenads&quot;, but one thing at a time ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1537956013, "post_id": 52514310, "comment_id": 91969716, "body": "Ok, you helped a lot. See my updated code in the question. Now can you help me in using the <code>fmap</code> definition to simplify my monad bind operator implementation? It seems useless being forced to define a functor, and to not leverage it to simplify the monad implementation. The two codes seem very similar, so I guess there is something to be done yet. Otherwise, what&#39;s the need for the functor?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1537956066, "post_id": 52514310, "comment_id": 91969751, "body": "without looking, you really should ask <i>new</i> question if you have substantial change in the question. I <i>really</i> propose you unroll your edit there, and <i>ask a new question</i>. thanks."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1537956147, "post_id": 52514310, "comment_id": 91969799, "body": "Oh, I thought about that, but decided to do it in this question for everything to be at one place. Should still I move this part into another new question, and refer this question in the new one?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1537956193, "post_id": 52514310, "comment_id": 91969822, "body": "yes, you should roll back your edit, ask new &quot;followup&quot; question and include link to this one as a background. I&#39;ll roll it back for you now. :)"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1537957383, "post_id": 52514310, "comment_id": 91970522, "body": "Done, you can see the new question <a href=\"https://stackoverflow.com/questions/52515317/how-to-base-the-definition-of-my-custom-monad-on-its-functor-definition-in-haske\">here</a>."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1537957890, "post_id": 52514310, "comment_id": 91970810, "body": "Forget the question ... I just saw your &quot;adding&quot; link now, with the complete solution to the monad, and this as much better code reuse. Know I just have to understand it :-) Thanks a lot!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1537971741, "post_id": 52514310, "comment_id": 91979495, "body": "yeah, that&#39;s a standard definition. see <a href=\"https://stackoverflow.com/questions/11234632/monads-with-join-instead-of-bind/11249714#11249714\">this</a> (and also, <a href=\"https://stackoverflow.com/a/44118041/849891\">this</a> and its links)."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1537975254, "last_edit_date": 1537975254, "creation_date": 1537953853, "answer_id": 52514310, "question_id": 52513998, "link": "https://stackoverflow.com/questions/52513998/how-to-create-a-monad-that-combines-state-and-error-in-haskell/52514310#52514310", "title": "How to create a monad that combines state and error in Haskell", "body": "<p>Your error is fixed by changing the code to</p>\n\n<pre><code>  m &gt;&gt;= f = StateError $\n    \\s -&gt; case runStateError m s of\n            (Ok x, s1) -&gt; runStateError (f x) s1\n            (Error e, s1) -&gt; (Error e, s1)\n        -- or:\n        --  (Error e, s1) -&gt; (Error e, s)     -- also works\n        -- not:\n        --  e             -&gt; e                -- this doesn't\n</code></pre>\n\n<p>and <a href=\"https://ideone.com/a2NTSt\" rel=\"nofollow noreferrer\">adding</a> the obvious <code>Functor</code> and <code>Applicative</code> instances,</p>\n\n<pre><code>instance Functor .... where\n  fmap = liftM\n\ninstance Applicative .... where\n  (&lt;*&gt;) = ap\n  pure = return\n</code></pre>\n\n<p><code>Error e :: Result a e</code> is polymorphic, </p>\n\n<pre><code>data Result a e = Ok a | Error e\n</code></pre>\n\n<p>so has different types on the left and on the right of that arrow. As it complaints in the error message,</p>\n\n<pre><code>  Expected type: (Result b e, s)\n  Actual type: (Result a e, s)\n</code></pre>\n\n<p>when you use a <em>variable</em>, that makes it be <em>the same</em> on the both sides of the arrow. So <code>e</code> reuses the same value, but <code>Error e</code> creates new value of the appropriate type as needed. And we do need the new type, as demanded by the signature of <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n--          ^^                    ^^\n</code></pre>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 52514310, "answer_count": 1, "score": 3, "last_activity_date": 1537975254, "creation_date": 1537952970, "last_edit_date": 1537956311, "question_id": 52513998, "link": "https://stackoverflow.com/questions/52513998/how-to-create-a-monad-that-combines-state-and-error-in-haskell", "title": "How to create a monad that combines state and error in Haskell", "body": "<p>I am trying to create a monad that combines state and error processing, like this</p>\n\n<pre><code>import Control.Monad\n\ndata Result a e = Ok a | Error e\n\nnewtype StateError s e a = StateError { runStateError :: s -&gt; (Result a e, s) }\n\ninstance Monad (StateError s e) where\n  return x = StateError $ \\s -&gt; (Ok x, s)\n\n  m &gt;&gt;= f = StateError $\n    \\s -&gt; case runStateError m s of\n            (Ok x, s') -&gt; runStateError (f x) s'\n            e -&gt; e\n\nget = StateError $ \\s -&gt; ((Ok s), s)\n\nput s = StateError $ \\_ -&gt; ((Ok ()), s)\n\nmain = return ()\n</code></pre>\n\n<p>When I compile, I receive this error, which I do not know how to fix: </p>\n\n<pre><code>StateError.hs:13:18: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018b\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          (&gt;&gt;=) :: forall a b.\n                   StateError s e a -&gt; (a -&gt; StateError s e b) -&gt; StateError s e b\n        at StateError.hs:10:5-7\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          (&gt;&gt;=) :: forall a b.\n                   StateError s e a -&gt; (a -&gt; StateError s e b) -&gt; StateError s e b\n        at StateError.hs:10:5-7\n      Expected type: (Result b e, s)\n        Actual type: (Result a e, s)\n    \u2022 In the expression: e\n      In a case alternative: e -&gt; e\n      In the expression:\n        case runStateError m s of\n          (Ok x, s') -&gt; runStateError (f x) s'\n          e -&gt; e\n    \u2022 Relevant bindings include\n        e :: (Result a e, s) (bound at StateError.hs:13:13)\n        f :: a -&gt; StateError s e b (bound at StateError.hs:10:9)\n        m :: StateError s e a (bound at StateError.hs:10:3)\n        (&gt;&gt;=) :: StateError s e a\n                 -&gt; (a -&gt; StateError s e b) -&gt; StateError s e b\n          (bound at StateError.hs:10:5)\n   |\n13 |             e -&gt; e\n   |                  ^\n</code></pre>\n\n<p>What am I doing wrong here? I think the problem is the difficulty of matching the two results of the <code>case</code></p>\n\n<pre><code>      Expected type: (Result b e, s)\n      Actual type: (Result a e, s)\n</code></pre>\n\n<p>like force <code>a</code> to be a <code>b</code>, or something alike, but I don't know how to solve this.</p>\n\n<p>In addition, I am also receiving this error:</p>\n\n<pre><code>StateError.hs:7:10: error:\n    \u2022 No instance for (Applicative (StateError s e))\n        arising from the superclasses of an instance declaration\n    \u2022 In the instance declaration for \u2018Monad (StateError s e)\u2019\n  |\n7 | instance Monad (StateError s e) where\n  |          ^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>This asks me to instantiate <code>Applicative</code>, so I would appreciate some guidance on what to do here. </p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1537927972, "post_id": 52508964, "comment_id": 91958096, "body": "Thanks, I think that basically answers my question--I&#39;m not really trying to accomplish anything other than understand Haskell.  I ran into these &quot;untyped&quot; type declarations for functions, like <code>myFunc :: a -&gt; a</code>.  Without knowing what <code>a</code> is, it seems like there are not many functions that could have this type declaration.  With a type declaration of <code>myFunc :: a -&gt; b</code> it seems like nothing could have this type unless there were some object that is of every type."}, {"owner": {"reputation": 110, "user_id": 3545872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3592e93f4d00ce3bb170661074534?s=128&d=identicon&r=PG&f=1", "display_name": "uwap", "link": "https://stackoverflow.com/users/3545872/uwap"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1537928144, "post_id": 52508964, "comment_id": 91958131, "body": "Exactly. A function from of type <code>a -&gt; b</code> can&#39;t be done in haskell. (Except for when it does. <code>unsafeCoerce</code> has exactly this type but we don&#39;t really use it) And as you can prove that there should be no function of type <code>a -&gt; b</code> you can also prove that there should be exactly one function of type <code>a -&gt; a</code> being the identity function."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1537947417, "post_id": 52508964, "comment_id": 91964430, "body": "For more info about this, this property that allows one to prove that the only function of type <code>a -&gt; a</code> is the identity (and many other useful things about types!) is called <a href=\"https://bartoszmilewski.com/2014/09/22/parametricity-money-for-nothing-and-theorems-for-free/\" rel=\"nofollow noreferrer\">parametricity</a>, which gives you so-called <a href=\"https://people.mpi-sws.org/~dreyer/tor/papers/wadler.pdf\" rel=\"nofollow noreferrer\">free theorems</a>.  These theorems are also <a href=\"https://en.wikipedia.org/wiki/Natural_transformation\" rel=\"nofollow noreferrer\">naturality squares</a> from category theory.  Deep stuff here.  @Addem"}], "tags": [], "owner": {"reputation": 110, "user_id": 3545872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3592e93f4d00ce3bb170661074534?s=128&d=identicon&r=PG&f=1", "display_name": "uwap", "link": "https://stackoverflow.com/users/3545872/uwap"}, "is_accepted": false, "score": 2, "last_activity_date": 1537928328, "last_edit_date": 1537928328, "creation_date": 1537927783, "answer_id": 52508964, "question_id": 52508886, "link": "https://stackoverflow.com/questions/52508886/haskell-is-there-any-object-that-is-of-every-type-like-null-in-java/52508964#52508964", "title": "Haskell: Is there any object that is of every type, like `null` in Java?", "body": "<p>Short answer: No</p>\n\n<p>It wouldn't be very type safe to have it. Maybe you can provide more information to your question to understand what you are trying to accomplish.</p>\n\n<p>Edit: Daniel Wagner is right. An infinite loop can be of every type.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 2, "creation_date": 1537928195, "post_id": 52508983, "comment_id": 91958148, "body": "@user2864740 Can you elaborate a little? Are you agreeing or objecting? If objecting, what are you objecting to, in particular?"}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 1, "creation_date": 1537928260, "post_id": 52508983, "comment_id": 91958160, "body": "I think user2864740 is just being a tad snarky about the use of the word &quot;any&quot; in your answer rather than &quot;every&quot;.  Nit-picking semantics."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 1, "creation_date": 1537928447, "post_id": 52508983, "comment_id": 91958209, "body": "@Addem Hm. Perhaps. However, I believe I was quite careful. Although infinite loops can be given a type which corresponds to &quot;every type&quot; in Haskell, not all sensible Turing-complete languages have the kind of polymorphism necessary to do that. But even in languages that do not have the type <code>forall a. a</code>, you can usually construct an infinite loop of any (concrete) type."}, {"owner": {"reputation": 110, "user_id": 3545872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3592e93f4d00ce3bb170661074534?s=128&d=identicon&r=PG&f=1", "display_name": "uwap", "link": "https://stackoverflow.com/users/3545872/uwap"}, "edited": false, "score": 0, "creation_date": 1537928477, "post_id": 52508983, "comment_id": 91958212, "body": "Damn turing complete languages. You caught me there. Haven&#39;t been Haskell in a while and now I remember what I hated about it :D"}, {"owner": {"reputation": 110, "user_id": 3545872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3592e93f4d00ce3bb170661074534?s=128&d=identicon&r=PG&f=1", "display_name": "uwap", "link": "https://stackoverflow.com/users/3545872/uwap"}, "edited": false, "score": 2, "creation_date": 1537928825, "post_id": 52508983, "comment_id": 91958287, "body": "Actually, to get a little bit deeper into that: We can construct any type from a <code>Void</code>. An infinite loop is just one example of that. The function <code>absurd :: Void -&gt; a</code> shows how absurd this is."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1537946666, "post_id": 52508983, "comment_id": 91964021, "body": "Strictly speaking, <code>loop</code> and <code>undefined</code> can&#39;t be objects of unlifted types like <code>Int#</code>, so they don&#39;t inhabit every type. Though, this is like in Java: values of primitive types <code>int</code> and <code>double</code> can&#39;t be assigned to <code>null</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1537963092, "post_id": 52508983, "comment_id": 91973847, "body": "@Shersh Surprise! <code>let x :: Int#; x = undefined in ()</code> is allowed, and throws an exception. <code>let f :: Int# -&gt; Int#; f v = f v; x :: Int#; x = f 0# in ()</code> is allowed, and loops forever."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1537971687, "post_id": 52508983, "comment_id": 91979460, "body": "@DanielWagner ah, it makes sense now. I was testing differently in ghci, but now I see why it&#39;s working. <code>undefined</code> is lifted over unlifted types as well. Command <code>:info undefined</code> helps a lot!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 11, "last_activity_date": 1537928481, "last_edit_date": 1537928481, "creation_date": 1537927912, "answer_id": 52508983, "question_id": 52508886, "link": "https://stackoverflow.com/questions/52508886/haskell-is-there-any-object-that-is-of-every-type-like-null-in-java/52508983#52508983", "title": "Haskell: Is there any object that is of every type, like `null` in Java?", "body": "<p>Short answer: <strong>Yes</strong></p>\n\n<p>As in any sensible Turing-complete language, infinite loops can be given any type:</p>\n\n<pre><code>loop :: a\nloop = loop\n</code></pre>\n\n<p>This (well, <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:undefined\" rel=\"noreferrer\">this</a>, or maybe <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:error\" rel=\"noreferrer\">this</a>) is occasionally useful as a temporary placeholder for as-yet-unimplemented functionality or as a signal to readers that we are in a dead branch for reasons that are too tedious to explain to the compiler. But it is generally not used at all analogously to the way <code>null</code> is typically used in Java code.</p>\n\n<p>Normally to signal lack of a value when that's a sensible thing to do, one instead uses</p>\n\n<pre><code>Nothing :: Maybe a\n</code></pre>\n\n<p>which, while it can't be any type at all, can be the lack of any type at all.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1537947651, "post_id": 52509212, "comment_id": 91964565, "body": "Bottom isn&#39;t a type."}, {"owner": {"reputation": 110, "user_id": 3545872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3592e93f4d00ce3bb170661074534?s=128&d=identicon&r=PG&f=1", "display_name": "uwap", "link": "https://stackoverflow.com/users/3545872/uwap"}, "edited": false, "score": 0, "creation_date": 1537950489, "post_id": 52509212, "comment_id": 91966191, "body": "<code>Void</code> is bottom though."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 110, "user_id": 3545872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3592e93f4d00ce3bb170661074534?s=128&d=identicon&r=PG&f=1", "display_name": "uwap", "link": "https://stackoverflow.com/users/3545872/uwap"}, "edited": false, "score": 0, "creation_date": 1537981867, "post_id": 52509212, "comment_id": 91985423, "body": "@uwap ugh.  context."}], "tags": [], "owner": {"reputation": 61, "user_id": 6342481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/439684f108f4b556e5ae922869354749?s=128&d=identicon&r=PG&f=1", "display_name": "subttle", "link": "https://stackoverflow.com/users/6342481/subttle"}, "is_accepted": false, "score": 0, "last_activity_date": 1538035562, "last_edit_date": 1538035562, "creation_date": 1537929845, "answer_id": 52509212, "question_id": 52508886, "link": "https://stackoverflow.com/questions/52508886/haskell-is-there-any-object-that-is-of-every-type-like-null-in-java/52509212#52509212", "title": "Haskell: Is there any object that is of every type, like `null` in Java?", "body": "<p><a href=\"https://wiki.haskell.org/Bottom\" rel=\"nofollow noreferrer\">Bottom</a> inhabits every type in Haskell. It can be written explicitly as <code>undefined</code> in GHC.</p>\n"}, {"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1537947225, "post_id": 52510657, "comment_id": 91964325, "body": "I&#39;m of the opinion that the &quot;real&quot; mistake was lack of direct support for coproducts; compound types that contain <b>one of</b> their constituent parts. Structs, classes, etc, have provided straightforward support for product types (compound types that contain <b>all of</b> their constituent parts) for ages, but not their natural dual. Without coproducts it&#39;s hard to get by without something like <code>null</code> (unless you pile on enough other features that you can eventually simulate coproducts); you do need that &quot;choice&quot;. When you&#39;ve got coproducts then you can do things like <code>Maybe</code> in library code."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1538062645, "post_id": 52510657, "comment_id": 92020984, "body": "@WillNess It sure is. It&#39;s also not something Java makes nearly as clean as Haskell (or at least, not last time I was using it)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1538064568, "post_id": 52510657, "comment_id": 92022039, "body": "@DanielWagner thanks for confirming. I was thinking about C/C++ actually, with its structs, classes, unions and yes null pointers. It&#39;s true <i>tagged</i> union is not a <i>language</i> construct in C, but it is very very close to it..."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1538105088, "post_id": 52510657, "comment_id": 92034975, "body": "@WillNess Absolutely tagged unions are coproducts. I could debate whether C style unions count as &quot;direct support for coproducts&quot; though, since you have to manage the tag by hand. They&#39;re not really any more appealing than null pointers for handling &quot;missing&quot; values. But then C also isn&#39;t a language where it really makes sense to talk about a hypothetical version that had corproducts <i>instead of</i> nulls; there&#39;s no way you&#39;re going to get away from the concept of invalid pointers at that level."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 8, "last_activity_date": 1537977875, "last_edit_date": 1537977875, "creation_date": 1537940497, "answer_id": 52510657, "question_id": 52508886, "link": "https://stackoverflow.com/questions/52508886/haskell-is-there-any-object-that-is-of-every-type-like-null-in-java/52510657#52510657", "title": "Haskell: Is there any object that is of every type, like `null` in Java?", "body": "<p>Technically yes, as Daniel Wagner's answer states.</p>\n\n<p>However I would argue that \"a value that can be used for every type\" and \"a value like Java's <code>null</code>\" are actually very different requirements. Haskell does not have the latter. I think this is a good thing (as does Tony Hoare, who famously called his invention of null-references a <a href=\"https://en.wikipedia.org/wiki/Tony_Hoare#Apologies_and_retractions\" rel=\"nofollow noreferrer\">billion-dollar mistake</a>).</p>\n\n<p>Java-like <code>null</code> has no properties <em>except</em> that you can check whether a given reference is equal to it. Anything else you ask of it will blow up at runtime.</p>\n\n<p>Haskell <code>undefined</code> (or <code>error \"my bad\"</code>, or <code>let x = x in x</code>, or <code>fromJust Nothing</code>, or any of the infinite ways of getting at it) has no properties at all. Anything you ask of it will blow up at runtime, <strong>including</strong> whether any given value is equal to it.</p>\n\n<p>This is a crucial distinction because it makes it near-useless as a \"missing\" value. It's not possible to do the equivalent of <code>if (thing == null) { do_stuff_without_thing(); } else { do_stuff_with(thing); }</code> using <code>undefined</code> in place of <code>null</code> in Haskell. The only code that can safely handle a possibly-undefined value is code that just never inspects that value at all, and so you can only safely <em>pass</em> <code>undefined</code> to other code when you <strong>know</strong> that it won't be used in any way<sup>1</sup>.</p>\n\n<p>Since we can't do \"null pointer checks\", in Haskell code we almost always use some type <code>T</code> (for arguments, variables, and return types) when we mean there <strong>will</strong> be a value of type <code>T</code>, and we use <code>Maybe T</code><sup>2</sup> when we mean that there may or may not be a value of type <code>T</code>.</p>\n\n<p>So Haskellers use <code>Nothing</code> roughly where Java programmers would use <code>null</code>, but <code>Nothing</code> is in practice very different from Haskell's version of a value that is of every type. <code>Nothing</code> can't be used on every type, only \"<code>Maybe</code> types\" - but there is a \"<code>Maybe</code> version\" of every type. The type distinction between <code>T</code> and <code>Maybe T</code> means that it's clear from the type whether you can omit a value, when you need to handle the possible absence of a value<sup>3</sup>, etc. In Java you're relying on the documentation being correct (and present) to get that knowledge.</p>\n\n<hr>\n\n<p><sup>1</sup> Laziness <em>does</em> mean that the \"won't be inspected at all\" situation can come up a lot more than it would in a strict language like Java, so sub-expressions that may-or-may-not be the bottom value are not that uncommon. But even their use is very different from Java's idioms around values that might be <code>null</code>.</p>\n\n<p><sup>2</sup> <code>Maybe</code> is a data-type with the definition <code>data Maybe a = Nothing | Just a</code>, whether the <code>Nothing</code> constructor contains no other information and the <code>Just</code> constructor just stores a single value of type <code>a</code>. So for a given type <code>T</code>, <code>Maybe T</code> adds an additional \"might not be present\" feature and nothing else to the base type <code>T</code>.</p>\n\n<p><sup>3</sup> And the Haskell version of handling possible absence is usually using combinators like <code>maybe</code> or <code>fromMaybe</code>, or pattern matching, all of which have the advantage over <code>if (thing == null)</code> that the compiler is aware of which part of the code is handling a missing value and which is handling the value.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1537944232, "last_edit_date": 1537944232, "creation_date": 1537943426, "answer_id": 52511301, "question_id": 52508886, "link": "https://stackoverflow.com/questions/52508886/haskell-is-there-any-object-that-is-of-every-type-like-null-in-java/52511301#52511301", "title": "Haskell: Is there any object that is of every type, like `null` in Java?", "body": "<p>Short answer: <strong>Yes.  But also no.</strong></p>\n\n<p>While it's true that an infinite loop, aka <code>undefined</code> (which are identical in the <a href=\"https://en.wikibooks.org/wiki/Haskell/Denotational_semantics\" rel=\"nofollow noreferrer\">denotational semantics</a>), inhabits every type, it is usually sufficient to reason about programs as if these values didn't exist, as exhibited in the popular paper <a href=\"https://www.cs.ox.ac.uk/jeremy.gibbons/publications/fast+loose.pdf\" rel=\"nofollow noreferrer\">Fast and Loose Reasoning is Morally Correct</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1538238057, "post_id": 52570156, "comment_id": 92077232, "body": "I feel like The Joker, enjoying watching the world burn as I just set everyone into a holy war with my little question.  :)"}], "tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": false, "score": 0, "last_activity_date": 1538237217, "creation_date": 1538237217, "answer_id": 52570156, "question_id": 52508886, "link": "https://stackoverflow.com/questions/52508886/haskell-is-there-any-object-that-is-of-every-type-like-null-in-java/52570156#52570156", "title": "Haskell: Is there any object that is of every type, like `null` in Java?", "body": "<p>I disagree with almost every other answer to this question.</p>\n\n<pre><code>loop :: a\nloop = loop\n</code></pre>\n\n<p>does not define a value of any type. It does not even define a value.</p>\n\n<pre><code>loop :: a\n</code></pre>\n\n<p>is a <em>promise</em> to return a value of type <code>a</code>.</p>\n\n<pre><code>loop = loop\n</code></pre>\n\n<p>is an endless loop, so the <em>promise is broken</em>. Since <code>loop</code> never returns at all, it follows that it never returns a value of type <code>a</code>. So no, even technically, there is no <code>null</code> value in Haskell.</p>\n\n<p>The closest thing to <code>null</code> is to use <code>Maybe</code>. With <code>Maybe</code> you have <code>Nothing</code>, and this is used in many contexts. It is also much more explicit.</p>\n\n<p>A similar argument can be used for <code>undefined</code>. When you use <code>undefined</code> in a non-strict setting, you just have a thunk that will throw an error as soon as it is evaluated. But it will never give you a value of the promised type.</p>\n\n<p>Haskell has a bottom type because it is unavoidable. Due to the halting problem, you can never prove that a function will actually return at all, so it is always possible to break promises. Just because someone promises to give you 100$, it does not mean that you will actually get it. He can always say \"I didn't specify <em>when</em> you will get the money\" or just refuse to keep the promise. The promise doesn't even prove that he has the money or that he would be able to provide it when asked about it.</p>\n\n<hr>\n\n<p>An example from the Apple-world..</p>\n\n<p>Objective C had a <code>null</code> value and it has been called <code>nil</code>. The newer Swift language switched to an <code>Optional</code> type, where <code>Optional&lt;a&gt;</code> can be abbreviated to <code>a?</code>. It behaves exactly like Haskells <code>Maybe</code> monad. Why did they do this? Maybe because of <a href=\"https://en.wikipedia.org/wiki/Tony_Hoare#Apologies_and_retractions\" rel=\"nofollow noreferrer\">Tony Hoare's apology</a>. Maybe because Haskell was one of Swifts role-models. </p>\n"}], "owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 52508983, "answer_count": 6, "score": 1, "last_activity_date": 1538237217, "creation_date": 1537927095, "question_id": 52508886, "link": "https://stackoverflow.com/questions/52508886/haskell-is-there-any-object-that-is-of-every-type-like-null-in-java", "title": "Haskell: Is there any object that is of every type, like `null` in Java?", "body": "<p>In Java, with a little exception, <code>null</code> is of every type.  Is there a corresponding object like that in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "edited": false, "score": 2, "creation_date": 1537928723, "post_id": 52508801, "comment_id": 91958270, "body": "side note: you should also think of how to handle the case of negative integer input"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "edited": false, "score": 0, "creation_date": 1537928936, "post_id": 52508801, "comment_id": 91958312, "body": "I have a feeling it will be throwing my first Haskell error/exception, or whatever the equivalent is."}], "answers": [{"comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 1, "creation_date": 1537928880, "post_id": 52509000, "comment_id": 91958300, "body": "Great, the first option was what I went with to get by, and the second option was apparently what I had forgotten and was looking for."}], "tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": true, "score": 5, "last_activity_date": 1537928552, "last_edit_date": 1537928552, "creation_date": 1537928061, "answer_id": 52509000, "question_id": 52508801, "link": "https://stackoverflow.com/questions/52508801/why-is-the-following-function-not-in-scope-when-defined-in-a-where-clause/52509000#52509000", "title": "Why is the following function not in scope when defined in a where clause?", "body": "<p>The <code>num2Char</code> function is not in scope for the first definition <code>num2Str n | n &lt; 26</code> because the <code>where</code> clause is only \"scoped\" to the second definition <code>num2Str n</code>. The easiest way to circumvent your issue is to modify the function as follows by just separating the functions:</p>\n\n<pre><code>import Data.Char (chr, ord)\n\nnum2Str :: Int -&gt; String\nnum2Str n | n &lt; 26 = [(num2Chr n)]\nnum2Str n          = num2Chr n : num2Str (n - 26)\n\nnum2Chr :: Int -&gt; Char\nnum2Chr n = chr(97 + n `mod` 26)\n</code></pre>\n\n<p>However, in the interest of style it is probably best to fully utilize guards:</p>\n\n<pre><code>num2Str :: Int -&gt; String\nnum2Str n | n &lt; 26    = [(num2Chr n)]\n          | otherwise = num2Chr n : num2Str (n - 26)\n  where\n    num2Chr :: Int -&gt; Char\n    num2Chr n = chr(97 + n `mod` 26)\n</code></pre>\n\n<p>I would recommend the above style(s) for completeness, conciseness, and correctness.</p>\n\n<p>Side note on syntax: do not use brackets around the where clause and no need for the semicolon.</p>\n\n<p>If you really want to keep the code similar and to illustrate what I mean about <code>where</code> clauses:</p>\n\n<pre><code>num2Str :: Int -&gt; String\nnum2Str n | n &lt; 26 = [(num2Chr n)]\n  where \n    num2Chr n = chr(97 + n `mod` 26)\nnum2Str n          = num2Chr n : num2Str (n - 26)\n  where \n    num2Chr n = chr(97 + n `mod` 26)\n</code></pre>\n\n<p>This is valid, but the style is poor. Each <code>where</code> is scoped to the function above it. For more information and reference: <a href=\"http://learnyouahaskell.com/syntax-in-functions#where\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/syntax-in-functions#where</a></p>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 1, "accepted_answer_id": 52509000, "answer_count": 1, "score": 4, "last_activity_date": 1538048386, "creation_date": 1537926298, "last_edit_date": 1538048386, "question_id": 52508801, "link": "https://stackoverflow.com/questions/52508801/why-is-the-following-function-not-in-scope-when-defined-in-a-where-clause", "title": "Why is the following function not in scope when defined in a where clause?", "body": "<pre><code>import               Data.Char (chr, ord)\n\nnum2Str :: Int -&gt; String\nnum2Str n | n &lt; 26 = [num2Chr n]\nnum2Str n          = num2Chr n : num2Str (n - 26)\n  where {\n    num2Chr :: Int -&gt; Char;\n    num2Chr n = chr(97 + n `mod` 26)\n  }\n</code></pre>\n\n<p>This results in the error</p>\n\n<pre><code>    * Variable not in scope: num2Chr :: Int -&gt; Char\n    * Perhaps you meant `num2Str' (line 132)\n    |\n132 | num2Str n | n &lt; 26 = [num2Chr n]\n    |                       ^^^^^^^\n</code></pre>\n\n<p>I tried a few alternatives to the layout but none seemed to work.</p>\n\n<p><strong>Minor update</strong></p>\n\n<p>The code had some logic errors in it unrelated to the question; here is a corrected version:</p>\n\n<pre><code>import               Data.Char (chr, ord)\nnum2LcStr :: Int -&gt; String\nnum2LcStr n | n &lt; 26    = [num2Chr n] \n            | otherwise = 'z' : num2LcStr (n - 26)\n  where\n    num2Chr nn = chr(97 + nn `mod` 26)\n</code></pre>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 0, "creation_date": 1537926495, "post_id": 52508483, "comment_id": 91957822, "body": "Perhaps the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad.html#v:join\" rel=\"nofollow noreferrer\">join</a> function will help. It can take a list of lists and &quot;flatten&quot; it to a single list."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537926520, "post_id": 52508483, "comment_id": 91957824, "body": "<i>I am trying</i> Can you show your attempts?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1537927543, "post_id": 52508483, "comment_id": 91958006, "body": "Step one is to write a function which transforms a single tuple, that is, a function of type <code>(String, Int, String, Int, String, Double) -&gt; (String, Double, Int)</code>. Have you made an attempt at doing that? Show us how far you got!"}, {"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537930272, "post_id": 52508483, "comment_id": 91958607, "body": "Yes I currently have:    computeGpas = show . (map (map calcGPA) .groupBy groupName .sortBy byName) . (map stringToTuple) . (map words) . lines    calcGPA [[subject, num, section, credits, name, grade]] = (name,(grade*credits)/credits, credits)    This is what I have been trying to work with.  Thank you. @DanielWagner"}], "answers": [{"tags": [], "owner": {"reputation": 606, "user_id": 3210255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b91b15246ea26b014e25102cadb03c87?s=128&d=identicon&r=PG&f=1", "display_name": "Tom&#225;\u0161 Zemanovi\u010d", "link": "https://stackoverflow.com/users/3210255/tom%c3%a1%c5%a1-zemanovi%c4%8d"}, "is_accepted": false, "score": 0, "last_activity_date": 1537928910, "creation_date": 1537928910, "answer_id": 52509097, "question_id": 52508483, "link": "https://stackoverflow.com/questions/52508483/changing-the-form-of-a-tuple/52509097#52509097", "title": "Changing the form of a tuple", "body": "<p>First define a function to calculate GPA, e.g.:\n<code>\ngpa (a,b,c,d,e,f) = (e,d*f/d,d)\n</code></p>\n\n<p>You'll want to map the list twice, first for the outer list and second for the inner lists, e.g.:\n<code>\nfmap (fmap gpa) listOfLists\n</code></p>\n\n<p>Or using <code>&lt;$&gt;</code> operator:\n<code>\n((&lt;$&gt;) gpa) &lt;$&gt; listOfLists\n</code></p>\n\n<p>An alternative prelude called <a href=\"https://hackage.haskell.org/package/protolude\" rel=\"nofollow noreferrer\">protolude</a> also defines an operator that does this and looks quite intuitive:\n<code>\ngpa &lt;&lt;$&gt;&gt; listOfLists\n</code></p>\n"}, {"comments": [{"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1537944989, "post_id": 52509675, "comment_id": 91963160, "body": "Thank you! This makes sense and successfully converted the list into the form I am looking for. I&#39;m still having issues with the math and calculating the GPA in code. I updated my post above with what I have tried.  Thank you"}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "reply_to_user": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1537946772, "post_id": 52509675, "comment_id": 91964079, "body": "@Riley use <code>fromIntegral</code> to convert from <code>Int</code> to <code>Double</code>. So in your update <code>c</code> and <code>f</code> are <code>Int</code>s that need to be <code>Double</code>. Haskell does not implicitly convert types. As briefly noted in my explanation you&#39;ll need to do this: <code>(b*(fromIntegral c)+e*(fromIntegral f))&#47;(b+e)</code>. <code>b</code> and <code>e</code> are already of type <code>Double</code> and thus do not need conversion. You&#39;re going in the right direction. The reference I posted has many useful functions on lists such as <code>groupBy</code> and <code>map</code>, play around with them in GHCi to work out errors and construct more complex functions incrementally."}], "tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": false, "score": 0, "last_activity_date": 1537934285, "last_edit_date": 1537934285, "creation_date": 1537933971, "answer_id": 52509675, "question_id": 52508483, "link": "https://stackoverflow.com/questions/52508483/changing-the-form-of-a-tuple/52509675#52509675", "title": "Changing the form of a tuple", "body": "<p>Not sure if this is <em>exactly</em> what you want based on your comment, but it may help:</p>\n\n<pre><code>convertTupleList :: [[(String, Int, String, Int, String, Double)]] -&gt; [(String,Double,Int)]\nconvertTupleList ts = map morphTuple $ concat ts\n\nmorphTuple :: (String, Int, String, Int, String, Double) -&gt; (String, Double, Int)\nmorphTuple (_,_,_,d,e,f) = (e, (d'*f)/d', d)\n  where\n    d' = fromIntegral d\n</code></pre>\n\n<p><code>convertTupleList</code> first <code>concat</code>s the list of list of tuples, basically <code>[[a]]-&gt;[a]</code>. Then it <code>map</code>s the <code>morphTuple</code> function over the <code>concat</code>ed list. So each element is morphed from a tuple <code>(String,Int,String,Int,String,Double)</code> to <code>(String,Double,Int)</code>. The <code>morphTuple</code> function uses <code>fromIntegral</code> to convert <code>Int</code> to <code>Double</code> then multiplies and divides accordingly. There are certainly more cleaner solutions, for instance <code>convertTupleList</code> screams for point-free style but I'll leave it as an exercise to optimize and correct any specification errors. I would also advise dissecting the <code>concat</code> and <code>map</code> functions in GHCi. Further references and helpful list functions: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch20.html#x28-23100020.3\" rel=\"nofollow noreferrer\">Haskell Report Folds</a></p>\n\n<p>PS: Please add <strong>coding attempts</strong>  and updates to the original question with the edit button.</p>\n"}], "owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1537944871, "creation_date": 1537923431, "last_edit_date": 1537944871, "question_id": 52508483, "link": "https://stackoverflow.com/questions/52508483/changing-the-form-of-a-tuple", "title": "Changing the form of a tuple", "body": "<p>I have a list of lists containing tuples. I want to change the form of the list I am receiving into a different form. Example below:</p>\n\n<p>I am taking in \n<code>[[(String, Int, String, Int, String, Double)]]</code> or <code>[[(a,b,c,d,e,f)]]</code></p>\n\n<p>I want to turn it into a single list of tuples of the form:</p>\n\n<p><code>[(String,Double,Int)]</code> specifically <code>[(e, ((d*f)/(d)), d)]</code></p>\n\n<p>I am trying to calculate a GPA where the list contains a list of tuples that contain all the classes a person is taking. <code>e</code> is the name of the person, <code>d</code> is the number of credits, and <code>f</code> is the grade point. The name will be the same in each tuple, but the grade point and number of credits won't.</p>\n\n<p>I don't understand how I can go through all of the tuples inside the list of lists and take the <code>d</code> and <code>f</code> of each tuple which are the values I need to calculate the GPA. </p>\n\n<p>If any help could be given to push me in the right direction that would be appreciated.</p>\n\n<p>Thank you</p>\n\n<hr>\n\n<p>UPDATE</p>\n\n<p>I am now at the point where I have a single list of tuples. Looks like this:</p>\n\n<pre><code>    [(\"Erikson,Ann\",2.0,3),(\"Erikson,Ann\",3.33,3),(\"Lewis,Buck\",2.66,1), \n    (\"Lewis,Buck\",2.0,3),(\"Smith,John\",0.0,1),(\"Smith,John\",1.66,3), \n    (\"Smith,John\",1.33,3),(\"Torvell,Sarah\",4.0,3)]\n</code></pre>\n\n<p>I need to create one tuple for each person. The tuple should have the form:\n        (name, calculated gpa, total credits)</p>\n\n<p>The calculated gpa is the 2nd element of each tuple multiplied by the 3rd element in each tuple added with the product of that same operation with all the other tuples that share the same name. then divide that number by the sum of the credits(the third element). The sum of all the third elements in tuples that share the same name is the third element. Confusing and hard to work. In the end i want one tuple for each person.</p>\n\n<p>I am trying this:</p>\n\n<pre><code>    type MyType2 = (String, Double, Int)\n    groupNameTuple :: MyType2 -&gt; MyType2 -&gt; Bool\n    groupNameTuple (a,_,_) (b,_,_) = a==b\n\n\n    calcGPA :: MyType2 -&gt; MyType2 -&gt; MyType2\n    calcGPA (a,b,c) (d,e,f) = (a, ((b*c)+(e*f))/(b+e), (b+e))\n</code></pre>\n\n<p>When I try to do this calculation on the bottom it says the middle element isn't a double. Other than that error is this in the right direction? </p>\n\n<p>Thank you</p>\n"}, {"tags": ["haskell", "pattern-matching", "guard-clause"], "comments": [{"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 0, "creation_date": 1537917510, "post_id": 52507795, "comment_id": 91956051, "body": "Can you post the exact error?"}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "reply_to_user": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 1, "creation_date": 1537917632, "post_id": 52507795, "comment_id": 91956078, "body": "@DavOS Edited the error in."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1537917689, "post_id": 52507795, "comment_id": 91956085, "body": "Why are you trying to put the patterns in the guards?"}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1537917740, "post_id": 52507795, "comment_id": 91956102, "body": "@sepp2k So that I can return a certain value depending on the type and values in the pattern.  Maybe I&#39;m misunderstanding your question."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1537917893, "post_id": 52507795, "comment_id": 91956130, "body": "How would you not be able to do that if you skipped the guards and just pattern matched normally? The only use case for guards I see here would be to replace the <code>if</code>, but it doesn&#39;t look like you&#39;re trying to replace the <code>if</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1537917962, "post_id": 52507795, "comment_id": 91956143, "body": "&quot;<i>Is this not how you&#39;re supposed to do pattern matching in Haskell?</i>&quot; No. Guards are boolean expressions, not patterns."}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1537918006, "post_id": 52507795, "comment_id": 91956155, "body": "@melpomene Ah, that would explain why I hadn&#39;t found any such examples!  Got it."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1537918108, "post_id": 52507795, "comment_id": 91956173, "body": "<code>if A then False else B</code> better written as <code>not A &amp;&amp; B</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1537918638, "post_id": 52507942, "comment_id": 91956282, "body": "So this is what I turned it into but now it&#39;s still giving me the part of the error <code>Not in scope: data constructor \u2018Node\u2019</code>.  However when I remove the <code>isSmall</code> function but leave the definitioon of the <code>Tree</code> (which contains <code>Node</code>) it compiles just fine.  The definition of the <code>Tree</code> is actually in one file that is imported into my <code>test</code> file--could that be causing the problem?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1537918748, "post_id": 52507942, "comment_id": 91956300, "body": "@Addem Is there a <code>module</code> declaration in the file that defines <code>Tree</code>? If so, what does it look like?"}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1537918784, "post_id": 52507942, "comment_id": 91956311, "body": "<code>module BinarySearchTrees( Tree(Null) , size, member, insert, toList, eq, treeMin, delete) where</code>"}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1537918877, "post_id": 52507942, "comment_id": 91956332, "body": "I&#39;m starting think I was misunderstanding how <code>Node</code> works. I thought that was a primitive Haskell type, but now I&#39;m thinking it&#39;s made up inside the definition of Tree, therefore when I import Tree without importing Node, I don&#39;t have access to Node.  Which seems strange because Node is part of the definition of Tree ... but I guess it is how it is."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 4, "creation_date": 1537918912, "post_id": 52507942, "comment_id": 91956338, "body": "@Addem Yeah, that says you want to export the <code>Tree</code> type and its <code>Null</code> data constructor, but not <code>Node</code>. You want either <code>Tree(Null, Node)</code> or <code>Tree(..)</code> there."}], "tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": false, "score": 2, "last_activity_date": 1537918474, "creation_date": 1537918474, "answer_id": 52507942, "question_id": 52507795, "link": "https://stackoverflow.com/questions/52507795/haskell-pattern-matching-with-guards/52507942#52507942", "title": "Haskell pattern matching with guards", "body": "<p>As indicated in the comments, this is incorrect pattern matching. Here is one way to achieve what you seem to be looking for:</p>\n\n<pre><code>isSmall :: Tree -&gt; Bool\nisSmall Null         = True\nisSmall (Node a b c) = if b &gt;= 10\n                       then False\n                       else isSmall a &amp;&amp; isSmall c\n</code></pre>\n\n<p>You also get another error by doing it the way you posted in the question:</p>\n\n<pre><code>* Couldn't match expected type `Bool' with actual type `Tree'\n* In the expression: (Node a b c)\n  In a stmt of a pattern guard for\n                 an equation for `isSmall':\n    (Node a b c)\n  In an equation for `isSmall':\n      isSmall _\n        | Null = True\n        | (Node a b c) = if b &gt;= 10 then False else isSmall a &amp;&amp; isSmall c\n</code></pre>\n\n<p>This indicates that the expression inside the guard statements must be of type <code>Bool</code> but you are providing a <code>Tree</code> (either <code>Null</code> or <code>Node</code>). </p>\n"}, {"comments": [{"owner": {"reputation": 400, "user_id": 2748187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtP0A.jpg?s=128&g=1", "display_name": "Tom Palmer", "link": "https://stackoverflow.com/users/2748187/tom-palmer"}, "edited": false, "score": 0, "creation_date": 1598879125, "post_id": 52507955, "comment_id": 112591872, "body": "I have a case where I want to capture all the contents implicitly but still check the matching ADT constructor, such as <code>toThing thing | Thing{} &lt;- thing = thing</code>. Any other way to capture all or some of the contents without being explicit? In my case, this is somewhat of an <code>otherwise</code> condition, but I&#39;d still rather be explicit about the case."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 8, "last_activity_date": 1537918610, "creation_date": 1537918610, "answer_id": 52507955, "question_id": 52507795, "link": "https://stackoverflow.com/questions/52507795/haskell-pattern-matching-with-guards/52507955#52507955", "title": "Haskell pattern matching with guards", "body": "<blockquote>\n  <p>Is this not how you're supposed to do pattern matching in Haskell?</p>\n</blockquote>\n\n<p>No. Guards are boolean expressions, not patterns.</p>\n\n<p>You can do pattern matching like this:</p>\n\n<pre><code>isSmall :: Tree -&gt; Bool\nisSmall Null = True\nisSmall (Node a b c) = b &lt; 10 &amp;&amp; isSmall a &amp;&amp; isSmall c\n</code></pre>\n\n<p>... or like this:</p>\n\n<pre><code>isSmall :: Tree -&gt; Bool\nisSmall x = case x of\n  Null -&gt; True\n  Node a b c -&gt; b &lt; 10 &amp;&amp; isSmall a &amp;&amp; isSmall c\n</code></pre>\n\n<p>... or even like this:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\nisSmall :: Tree -&gt; Bool\nisSmall = \\case\n  Null -&gt; True\n  Node a b c -&gt; b &lt; 10 &amp;&amp; isSmall a &amp;&amp; isSmall c\n</code></pre>\n\n<p>(using the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#lambda-case\" rel=\"noreferrer\">LambdaCase</a> language extension). This is perhaps closest to your original attempt.</p>\n\n<p>That said, it is possible to embed patterns in guards by using <code>&lt;-</code>. This is known as \"pattern guards\":</p>\n\n<pre><code>isSmall :: Tree -&gt; Bool\nisSmall x \n  | Null &lt;- x = True\n  | Node a b c &lt;- x = b &lt; 10 &amp;&amp; isSmall a &amp;&amp; isSmall c\n</code></pre>\n\n<p>However, this syntax doesn't buy you much here. You still have to give the argument a name (<code>x</code> in this case) and you have to explicitly say <code>&lt;- x</code> everywhere. It would be clearer to use pattern matching directly (using <code>case</code> or multiple function equations).</p>\n"}], "owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3362, "favorite_count": 0, "accepted_answer_id": 52507955, "answer_count": 2, "score": 1, "last_activity_date": 1537919023, "creation_date": 1537917275, "last_edit_date": 1537919023, "question_id": 52507795, "link": "https://stackoverflow.com/questions/52507795/haskell-pattern-matching-with-guards", "title": "Haskell pattern matching with guards", "body": "<p>Suppose I want to model a tree structure in Haskell with </p>\n\n<pre><code>data Tree = Null | Node Tree Integer Tree deriving Show\n</code></pre>\n\n<p>and I'd like to test if every entry is, say, less than 10.  I thought I would use pattern matching and write </p>\n\n<pre><code>isSmall :: Tree -&gt; Bool\nisSmall _ \n  | Null = True\n  | (Node a b c) = if b &gt;= 10\n                   then False\n                   else isSmall a &amp;&amp; isSmall c\n</code></pre>\n\n<p>However it gives errors about <code>a</code>, <code>b</code>, and <code>c</code> being out of scope.  I would have thought putting them in the guards would basically put them in the scope.  Is this not how you're supposed to do pattern matching in Haskell?  I've looked around for examples that would guide me but I haven't found any examples of pattern matching in guards that uses a data structure composed of several other data structures.</p>\n\n<p>The error:</p>\n\n<pre><code>test.hs:24:6: Not in scope: data constructor \u2018Node\u2019\n\ntest.hs:24:11: Not in scope: \u2018a\u2019\n\ntest.hs:24:13: Not in scope: \u2018b\u2019\n\ntest.hs:24:15: Not in scope: \u2018c\u2019\n\ntest.hs:24:27: Not in scope: \u2018b\u2019\n\ntest.hs:26:38: Not in scope: \u2018a\u2019\n\ntest.hs:26:57: Not in scope: \u2018c\u2019\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 0, "creation_date": 1537909022, "post_id": 52506506, "comment_id": 91953568, "body": "The definition of MyType needs to be fixed (or removed) since the type variables (a,b ...) are not in scope."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 0, "creation_date": 1537909302, "post_id": 52506506, "comment_id": 91953669, "body": "Oops, thanks. I&#39;ll be conservative and just define it to match the tuples shown."}, {"owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "edited": false, "score": 0, "creation_date": 1537910043, "post_id": 52506506, "comment_id": 91953977, "body": "If I then wanted to group the tuples with similar names into one big tuple I would use groupBy. Is this the right direction to go?    computeGpas = show . groupBy groupName . sortBy byName . (map stringToTuple) . (map words) . lines    groupName :: MyType -&gt; MyType -&gt; Bool groupName (<i>, _, _, _, a, _) (</i>, _, _, _, b, _) = True"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1537909266, "last_edit_date": 1537909266, "creation_date": 1537908682, "answer_id": 52506506, "question_id": 52506258, "link": "https://stackoverflow.com/questions/52506258/sorting-lists-using-sortby/52506506#52506506", "title": "sorting lists using sortBy", "body": "<p>Start with the type of <code>sortBy</code>:</p>\n\n<pre><code>&gt; :t sortBy\nsortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>This means <code>byName</code> needs to have type <code>a -&gt; a -&gt; Ordering</code>. In this case, <code>a</code> is a tuple whose fifth element as type <code>String</code>; <code>byName</code> will ignore the other fields. So you'll need to define a function like</p>\n\n<pre><code>type MyType = (String, Int, String, Int, String, Double)\nbyName :: MyType -&gt; MyType -&gt; Ordering\nbyName (_, _, _, _, a, _) (_, _, _, _, b, _) = ...\n</code></pre>\n\n<p>I leave replacing the <code>...</code> with the correct expression as an exercise.</p>\n\n<p>(Recall that <code>Ordering</code> is a type with three values, <code>LT</code>, <code>EQ</code>, and <code>GT</code>, where <code>byName a b == LT</code> if <code>a &lt; b</code>, <code>byName a b == EQ</code> if <code>a == b</code>, and <code>byName a b == GT</code> if <code>a &gt; b</code>. In your case, two tuples will compare as equal as long as they have the same name. It sounds like you don't actually  care whether <code>byName</code> returns <code>LT</code> or <code>GT</code> otherwise.)</p>\n"}, {"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1537931184, "post_id": 52506917, "comment_id": 91958815, "body": "Also consider <code>sortOn</code>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1537910798, "creation_date": 1537910798, "answer_id": 52506917, "question_id": 52506258, "link": "https://stackoverflow.com/questions/52506258/sorting-lists-using-sortby/52506917#52506917", "title": "sorting lists using sortBy", "body": "<p>While you can figure something like this out for yourself, most of the desired capability is already available via <code>Data.Ord</code>. If <code>tuples</code> is your input list, you can just use:</p>\n\n<pre><code>sortBy (comparing name) tuples\n</code></pre>\n\n<p>where <code>name</code> is a utility function defines as:</p>\n\n<pre><code>name (_, _, _, _, n, _) = n\n</code></pre>\n\n<p>This is actually a parametrically polymorphic function, so you could also call it <code>fifth</code>, or something generic like that.</p>\n\n<p>You can call the above expression and format the output to see that it does approximately what you want:</p>\n\n<pre><code>Prelude Data.Ord Data.List&gt; putStrLn $ unlines $ show &lt;$&gt; sortBy (comparing name) tuples\n(\"B\",101,\"M\",3,\"Jon\",3.33)\n(\"B\",273,\"F\",1,\"Mike\",2.66)\n(\"B\",203,\"R\",3,\"Rachel\",1.66)\n(\"A\",200,\"P\",1,\"Rachel\",0.0)\n(\"A\",999,\"N\",3,\"Rachel\",1.33)\n(\"A\",100,\"Q\",3,\"Todd\",2.0)\n(\"A\",549,\"D\",3,\"Todd\",2.0)\n(\"B\",220,\"S\",3,\"Todd\",4.0)\n</code></pre>\n\n<p>Compared to the OP, this is in the opposite order of what's required, but I'll leave it as an exercise to figure out how to change the sort order. There's a couple of different ways to do that.</p>\n"}], "owner": {"reputation": 65, "user_id": 7481105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dacd7a9f6da35434bc254ccb8c36e19c?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/7481105/riley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1537910961, "creation_date": 1537907564, "last_edit_date": 1537910961, "question_id": 52506258, "link": "https://stackoverflow.com/questions/52506258/sorting-lists-using-sortby", "title": "sorting lists using sortBy", "body": "<p>I am trying to sort my list of tuples based on the 4th element in each of the tuples.  The fourth element contains a string that is a person's name. I want to put tuples that contain the same name next to each other. An example of the lists of tuples before it is sorted is:</p>\n\n<pre><code>[(\"A\",100,\"Q\",3,\"Todd\",2.0),\n (\"B\",203,\"R\",3,\"Rachel\",1.66),\n (\"B\",273,\"F\",1,\"Mike\",2.66),\n (\"A\",200,\"P\",1,\"Rachel\",0.0),\n (\"A\",549,\"D\",3,\"Todd\",2.0),\n (\"B\",220,\"S\",3,\"Todd\",4.0),\n (\"B\",101,\"M\",3,\"Jon\",3.33),\n (\"A\",999,\"N\",3,\"Rachel\",1.33)]\n</code></pre>\n\n<p>I want it too look like:</p>\n\n<pre><code>[(\"A\",100,\"Q\",3,\"Todd\",2.0),\n (\"A\",549,\"D\",3,\"Todd\",2.0),\n (\"B\",220,\"S\",3,\"Todd\",4.0),\n (\"B\",203,\"R\",3,\"Rachel\",1.66),\n (\"A\",200,\"P\",1,\"Rachel\",0.0),\n (\"A\",999,\"N\",3,\"Rachel\",1.33),\n (\"B\",273,\"F\",1,\"Mike\",2.66),\n (\"B\",101,\"M\",3,\"Jon\",3.33)]\n</code></pre>\n\n<p>What I need is for all the tuples that contain Todd to be next to each other and so on for each name. The order the names show up doesn't matter, just that they are next to each other.</p>\n\n<pre><code>sortedList= show . sortBy byName . (map stringToTuple) . (map words) . lines\n</code></pre>\n\n<p>This is the line of code I am calling sort by in. I understand I need to make a function <code>byName</code> that will somehow figure out if the tuples share a common name. </p>\n\n<p>Any help to steer me into the right direction for writing the <code>byName</code> method would be appreciated.\nThank you</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses", "higher-kinded-types"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1537902288, "creation_date": 1537902288, "answer_id": 52505172, "question_id": 52504734, "link": "https://stackoverflow.com/questions/52504734/how-to-use-the-same-record-selector-two-ways-within-a-function-lenses/52505172#52505172", "title": "How to use the same record selector two ways within a function? Lenses?", "body": "<p>I think you probably want:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\ngetSubDelta :: (forall f . (dat f -&gt; DeltaPoint f fld))\n            -&gt; Either (dat Z) (dat Delta)\n            -&gt; Maybe (Either (DeltaPoint Z fld) (DeltaOf fld))\ngetSubDelta sel = either (Just . Left . sel) sel\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>x :: Either (MyData Z) (MyData Delta) \n     -&gt; Maybe (Either (DeltaPoint Z Char) (DeltaOf Char))\nx = getSubDelta myDataChar\n-- same as: x = either (Just . Left . myDataChar) myDataChar\n</code></pre>\n"}], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 52505172, "answer_count": 1, "score": 0, "last_activity_date": 1537902288, "creation_date": 1537900547, "question_id": 52504734, "link": "https://stackoverflow.com/questions/52504734/how-to-use-the-same-record-selector-two-ways-within-a-function-lenses", "title": "How to use the same record selector two ways within a function? Lenses?", "body": "<p>I have some data that have different representations based on a type parameter, a la <a href=\"http://reasonablypolymorphic.com/blog/higher-kinded-data\" rel=\"nofollow noreferrer\">Sandy Maguire's Higher Kinded Data</a>. Here are two examples:</p>\n\n<pre><code>wholeMyData :: MyData Z\nwholeMyData = MyData 1 'w'\n\ndeltaMyData :: MyData Delta\ndeltaMyData = MyData Nothing (Just $ Left 'b')\n</code></pre>\n\n<p>I give some of the implementation details below, but first the actual question. </p>\n\n<p>I often want to get a field of the data, usually via a local definition like:</p>\n\n<pre><code>let x = either (Just . Left . myDataChar) myDataChar -- myDataChar a record of MyData\n</code></pre>\n\n<p>It happens so often I would like to make a standard combinator,</p>\n\n<pre><code>getSubDelta :: ( _ -&gt; _ ) -&gt; Either a b -&gt; Maybe (Either c d)\ngetSubDelta f = either (Just . Left . f) f\n</code></pre>\n\n<p>but filling in that signature is problematic. The easy solution is to just supply the record selector function twice,</p>\n\n<pre><code>getSubDelta :: (a-&gt;c) -&gt; (b-&gt;d) -&gt; Either a b -&gt; Maybe (Either c d)\ngetSubDelta f g = either (Just . Left . f) g\n</code></pre>\n\n<p>but that is unseemly. So my question. Is there a way I can fill in the signature above? I'm assuming there is probably a lens based solution, what would that look like? Would it help with deeply nested data? I can't rely on the data types always being single constructor, so prisms? Traversals? My lens game is weak, so I was hoping to get some advice before I proceed. </p>\n\n<p>Thanks!</p>\n\n<hr>\n\n<p>Some background. I defined a generic method of performing \"deltas\", via a mix of GHC.Generics and type families. The gist is to use a type family in the definition of the data type. Then, depending how the type is parameterized, the records will either represent whole data or a change to existing data.</p>\n\n<p>For instance, I define the business data using <code>DeltaPoints</code>.</p>\n\n<pre><code>MyData f = MyData { myDataInt  :: DeltaPoint f Int\n                  , myDataChar :: DeltaPoint f Char} deriving Generic\n</code></pre>\n\n<p>The <code>DeltaPoints</code> are implemented in the library, and have different forms for <code>Delta</code> and <code>Z</code> states.</p>\n\n<pre><code>data DeltaState = Z | Delta deriving (Show,Eq,Read)\ntype family DeltaPoint (st :: DeltaState) a where\n  DeltaPoint Z      a = a\n  DeltaPoint Delta  a = Maybe (Either a (DeltaOf a)) \n</code></pre>\n\n<p>So a <code>DeltaPoint Z a</code> is just the original data, <code>a</code>, and a <code>DeltaPoint Delta a</code>, may or may not be present, and if it is present will either be a replacement of the original (<code>Left</code>) or an update  (<code>DeltaOf a</code>).</p>\n\n<p>The runtime delta functionality is encapsulated in a type class.</p>\n\n<pre><code>class HasDelta a where\n  type DeltaOf a\n  delta :: a -&gt; a -&gt; Maybe (Either a (DeltaOf a))\n  applyDeltaOf :: a -&gt; DeltaOf a -&gt; Maybe a\n</code></pre>\n\n<p>And with the use of Generics, I can usually get the delta capabilities with something like:</p>\n\n<pre><code>instance HasDelta (MyData Z) where\n  type (DeltaOf (MyData Z)) = MyData Delta\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1537898560, "post_id": 52504234, "comment_id": 91948986, "body": "What is not working with your attempt?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1537898871, "post_id": 52504234, "comment_id": 91949102, "body": "Please provide an example of what you&#39;ve already done before asking for a solution. For now, <a href=\"http://idownvotedbecau.se/noattempt/\" rel=\"nofollow noreferrer\">idownvotedbecau.se/noattempt</a> ."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537904062, "post_id": 52504234, "comment_id": 91951548, "body": "So, you want a function of type <code>(String, String, a) -&gt; (String, a)</code>?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1537915508, "post_id": 52504234, "comment_id": 91955590, "body": "<code>f (x, y, z) = (x ++ &quot; &quot; ++ y, z)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 8512671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058bba55470f10b6e798edec1fb902b5?s=128&d=identicon&r=PG&f=1", "display_name": "Lex", "link": "https://stackoverflow.com/users/8512671/lex"}, "is_accepted": false, "score": 2, "last_activity_date": 1537955508, "creation_date": 1537955508, "answer_id": 52514855, "question_id": 52504234, "link": "https://stackoverflow.com/questions/52504234/how-to-merge-two-elements-within-a-tuple-in-haskell/52514855#52514855", "title": "How to merge two elements within a tuple in Haskell", "body": "<p>Not sure if this is exactly what you're looking for, but to turn a tuple (String, String, Integer) into a tuple (String, Integer), you can use this:</p>\n\n<pre><code>mergeStrings(s1, s2, i) = (s1 ++ \" \" ++ s2, i)\n</code></pre>\n\n<p>Now,</p>\n\n<pre><code>mergeString(\"Hello\", \"world\", 1)\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>(\"Hello world\", 1)\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 6217937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cecf5d820865432a360b2c2a38ad4aa0?s=128&d=identicon&r=PG&f=1", "display_name": "Wheeeeeecode", "link": "https://stackoverflow.com/users/6217937/wheeeeeecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 765, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1537955508, "creation_date": 1537898434, "question_id": 52504234, "link": "https://stackoverflow.com/questions/52504234/how-to-merge-two-elements-within-a-tuple-in-haskell", "title": "How to merge two elements within a tuple in Haskell", "body": "<p>I'm new to Haskell, and was trying to merge strings within a tuple into one element. For example, if my input was (\"Hello\",\"world\",1), it would output (\"Hello world\",1)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1537889546, "post_id": 52501590, "comment_id": 91944276, "body": "please go over the syntactic issue (I added the mention pseudocode to be clearer), I want to promote a data constructor..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537894709, "post_id": 52501590, "comment_id": 91947162, "body": "Even if you somehow managed to lift <code>UUID</code> to the type level, you have a problem: <code>[] :: * -&gt; *</code>, but <code>CreateWorkspace :: UUID -&gt; UUID -&gt; CommandRequest</code>, a kind that is clearly distinct from <code>*</code>. So <code>[CreateWorkspace]</code> is not well-kinded. Can you say what you would want the type <code>[CreateWorkspace]</code> to mean (since on its own it does not have a meaning)? Are you sure you don&#39;t just want <code>myFilter :: [CommandRequest] -&gt; [(UUID, UUID)]</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537894925, "post_id": 52501590, "comment_id": 91947258, "body": "(In particular, I suspect you are thinking, &quot;The type of <code>CreateWorkspace</code> data values is the <code>CreateWorkspace</code> type!&quot;. But this is not at all true. Indeed, there are no terms whose type has <code>CreateWorkspace</code> as its outermost constructor.)"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537898370, "post_id": 52501590, "comment_id": 91948904, "body": "please have a look here : <a href=\"https://gitlab.com/YoEight/eventstore-hs/blob/dev/1.0/Database/EventStore.hs\" rel=\"nofollow noreferrer\">gitlab.com/YoEight/eventstore-hs/blob/dev/1.0/Database/&hellip;</a> at readStreamEventsCommon function, you&#39;ll see that they are returning IO (Async (ReadResult &#39;RegularStream StreamSlice))  with data StreamType = All | RegularStream deriving (Eq, Ord). and if you look there (<a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/kind-polymorphism-and-promotion.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/&hellip;</a>) they are saying : &quot;With -XDataKinds, GHC automatically promotes every suitable datatype to be a kind, and its (value) constructors to be type constructors&quot;"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537898518, "post_id": 52501590, "comment_id": 91948973, "body": "I&#39;m a fan of dependent types and my impression was that with that I could define by example a List of one value constructor like [&#39;True] or [&#39;Nothing], but maybe I&#39;m dreaming..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537903226, "post_id": 52501590, "comment_id": 91951203, "body": "Meanwhile, if <i>you</i> look at the source of <code>ReadResult s a</code>, you&#39;ll see that it doesn&#39;t store a value of type <code>s</code> (and can&#39;t, because <code>s</code> has the wrong kind). A <code>ReadResult &#39;RegularStream StreamSlice</code> doesn&#39;t have a value constructed by the data constructor <code>RegularStream</code> in it. So I think <code>ReadResult</code> doesn&#39;t do what you think it does -- and it motivates my question, &quot;what do you think/want this to do?&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1537889662, "post_id": 52501876, "comment_id": 91944345, "body": "I would like the function to be typed &#39;[CreateWorkspace] not [CommandRequest]"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 1, "creation_date": 1537889857, "post_id": 52501876, "comment_id": 91944485, "body": "@NicolasHenin That&#39;s impossible, since that is not a type. Value constructors are not types, <code>[CreateWorkspace]</code> is not a type, and <code>&#39;[CreateWorkspace]</code> is not a type either. Perhaps you need a GADT, singletons, and some more complex type-level machinery, but I&#39;m unsure about what you really want/need."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1537890078, "post_id": 52501876, "comment_id": 91944597, "body": "I want to filter and better type my result (<a href=\"https://stackoverflow.com/questions/44865000/what-does-an-apostrophe-in-front-of-a-list-something-mean-in-haskell\" title=\"what does an apostrophe in front of a list something mean in haskell\">stackoverflow.com/questions/44865000/&hellip;</a>) I was thinking it&#39;s possible by using DataKinds extension. you wrote &quot;This is DataKinds in action, which:  lifts values at the type level, and lifts types to the kind level &quot; Sorry there is something I don&#39;t understand then..."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1537891113, "post_id": 52501876, "comment_id": 91945191, "body": "if you look at the lib <a href=\"https://gitlab.com/YoEight/eventstore-hs/blob/dev/1.0/Database/EventStore.hs\" rel=\"nofollow noreferrer\">gitlab.com/YoEight/eventstore-hs/blob/dev/1.0/Database/&hellip;</a> at readStreamEventsCommon function, you&#39;ll see that they are returning IO (Async (ReadResult &#39;RegularStream StreamSlice)) which is the kind of stuff I would like to do"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1537891158, "post_id": 52501876, "comment_id": 91945222, "body": "with data StreamType = All | RegularStream deriving (Eq, Ord)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1537890492, "last_edit_date": 1537890492, "creation_date": 1537889579, "answer_id": 52501876, "question_id": 52501590, "link": "https://stackoverflow.com/questions/52501590/filter-a-list-by-returning-only-one-kind-of-data-constructor-instead-of-the-type/52501876#52501876", "title": "Filter a list by returning only one kind of data constructor instead of the type of the type constructor", "body": "<p>You can use a list comprehension to filter only those values obtained through a specific constructor. Note that the type of the list does not change.</p>\n\n<pre><code>filter :: [CommandRequest] -&gt; [CommandRequest]\nfilter xs = [ x | x@(CreateWorkspace{}) &lt;- xs ]\n</code></pre>\n\n<hr>\n\n<p>If you want a more precise type, you need more complex type-level machinery, like GADTs. </p>\n\n<p>Here's an untested approach. You'll need a few extensions to be turned on.</p>\n\n<pre><code>data CR = CW | II  -- to be promoted to \"kinds\"\n\n-- A more precise, indexed type\ndata CommandRequestP (k :: CR) where\n   CreateWorkspace :: {commandId :: UUID, workspaceId ::UUID }\n      -&gt; CommandRequestP 'CW\n   IntroduceIdea :: {commandId :: UUID, workspaceId ::UUID, ideaContent :: String}\n      -&gt; CommandRequestP 'II\n\n-- Existential wrapper, so that we can build lists\ndata CommandRequest where\n    C :: CommandRequestP k -&gt; CommandRequest\n\nfilter :: [CommandRequest] -&gt; [CommandRequestP 'CW]\nfilter xs = [ x | C (x@(CreateWorkspace{})) &lt;- xs ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1537938591, "post_id": 52507644, "comment_id": 91960605, "body": "Thanks for having spent the time to explain ;-) It was really helpful !"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1537916319, "last_edit_date": 1537916319, "creation_date": 1537915974, "answer_id": 52507644, "question_id": 52501590, "link": "https://stackoverflow.com/questions/52501590/filter-a-list-by-returning-only-one-kind-of-data-constructor-instead-of-the-type/52507644#52507644", "title": "Filter a list by returning only one kind of data constructor instead of the type of the type constructor", "body": "<p>Given a Haskell type like:</p>\n\n<pre><code>data Foo = Bar Int | Baz String\n</code></pre>\n\n<p>there is no direct way of writing down a new type that represents the subset of values of type <code>Foo</code> that are constructed with <code>Bar</code>, <strong>even</strong> using the <code>DataKinds</code> extension.</p>\n\n<p>In particular, when you turn on <code>DataKinds</code>, the <code>Bar</code> type that you get is <em>not</em> the type of the values <code>Bar 1</code> and <code>Bar 2</code>.  In fact, the new lifted <code>Bar</code> type doesn't really have anything to do with the values <code>Bar 1</code> and <code>Bar 2</code>, except for the fact that they share the name <code>Bar</code>.  It's not that different than explicitly defining:</p>\n\n<pre><code>data True = TrueThing\n</code></pre>\n\n<p>This new type <code>True</code> has nothing to do with the value <code>True</code> of type <code>Bool</code>, except they happen to have the same name.</p>\n\n<p>Presuming that what you are <em>trying</em> to do is find a type-safe way of representing the result of filtering <code>CommandRequest</code> for just those values that were constructed with the <code>CreateWorkspace</code> constructor so that you can't \"accidentally\" let an <code>IntroduceIdea</code> sneak in to your list, you'll have to take another approach.  There are several possibilities.</p>\n\n<p>The most straightforward way, which doesn't require any special type-level programming at all, is to represent <code>CreateWorkspace</code> and <code>IntroduceIdea</code> as separate types:</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\ndata CreateWorkspace = CreateWorkspace\n  { commandId :: UUID\n  , workspaceId ::UUID\n  } deriving (Show)\ndata IntroduceIdea = IntroduceIdea\n  { commandId :: UUID\n  , workspaceId ::UUID\n  , ideaContent :: String\n  } deriving (Show)\n</code></pre>\n\n<p>and then create a new algebraic sum type to represent the disjoint union of those separate types:</p>\n\n<pre><code>data CommandRequest\n  = CreateWorkspace' CreateWorkspace\n  | IntroduceIdea' IntroduceIdea\n  deriving (Show)\n</code></pre>\n\n<p>Note we've used the ticks to differentiate these constructors from those used in the underlying component types.  A simple variant of this would be to move common fields (like <code>commandId</code>, and perhaps <code>workSpaceId</code>) into the <code>CommandRequest</code> type.  This might or might not make sense, depending on what you're trying to accomplish.</p>\n\n<p>Anyway, this adds a little syntactic fluff, but it's straightforward to define:</p>\n\n<pre><code>filterCreateWorkspace :: [CommandRequest] -&gt; [CreateWorkspace]\nfilterCreateWorkspace crs = [ cw | CreateWorkspace' cw &lt;- crs ]\n</code></pre>\n\n<p>and with some additional \"constructors\":</p>\n\n<pre><code>createWorkspace :: UUID -&gt; UUID -&gt; CommandRequest\ncreateWorkspace u1 u2 = CreateWorkspace' (CreateWorkspace u1 u2)\n\nintroduceIdea :: UUID -&gt; UUID -&gt; String -&gt; CommandRequest\nintroduceIdea u1 u2 s = IntroduceIdea' (IntroduceIdea u1 u2 s)\n</code></pre>\n\n<p>it's not too hard to create and filter <code>[CommandRequest]</code> lists:</p>\n\n<pre><code>type UUID = Int\ntestdata1 :: [CommandRequest]\ntestdata1\n  = [ createWorkspace 1 2\n    , createWorkspace 3 4\n    , introduceIdea 5 6 \"seven\"\n    ]\n\ntest1 = filterCreateWorkspace testdata1\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; test1\n[CreateWorkspace {commandId = 1, workspaceId = 2}\n,CreateWorkspace {commandId = 3, workspaceId = 4}]\n</code></pre>\n\n<p>This is almost certainly the correct approach for doing what you want to do.  I mean, this is exactly what algebraic data types are <strong>for</strong>.  This is what a Haskell program is <strong>supposed</strong> to look like.</p>\n\n<p>\"But no,\" I hear you say!  \"I want to spend endless hours fighting confusing type errors!  I want to crawl down the dependent type rabbit hole.  You know, for 'reasons'.\"  Should I stand in your way?  Can one man stand against the ocean?</p>\n\n<p>If you really want to do this at the type level, you <em>still</em> want to define separate types for your two constructors:</p>\n\n<pre><code>data CreateWorkspace = CreateWorkspace\n  { commandId :: UUID\n  , workspaceId ::UUID\n  } deriving (Show)\ndata IntroduceIdea = IntroduceIdea\n  { commandId :: UUID\n  , workspaceId ::UUID\n  , ideaContent :: String\n  } deriving (Show)\n</code></pre>\n\n<p>As before, this makes it easy to represent a list of type <code>[CreateWorkspace]</code>.  Now, the key to working at the type level will be finding a way to make it as difficult as possible to represent a list of type  <code>[CommandRequest]</code>.  A standard method would be to introduce a <code>CommandRequest</code> type class with instances for our two types, together with an existential type to represent an arbitrary type belonging to that class:</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\ntype UUID = Int   -- for the sake of examples\n\ndata CreateWorkspace = CreateWorkspace\n  { commandId :: UUID\n  , workspaceId ::UUID\n  } deriving (Show)\ndata IntroduceIdea = IntroduceIdea\n  { commandId :: UUID\n  , workspaceId ::UUID\n  , ideaContent :: String\n  } deriving (Show)\n\nclass CommandRequest a where\n    maybeCreateWorkspace :: a -&gt; Maybe CreateWorkspace\ninstance CommandRequest CreateWorkspace where\n    maybeCreateWorkspace c = Just c\ninstance CommandRequest IntroduceIdea where\n    maybeCreateWorkspace _ = Nothing\n\ndata SomeCommandRequest = forall t . CommandRequest t =&gt; SomeCommandRequest t\n</code></pre>\n\n<p>Now we can define:</p>\n\n<pre><code>import Data.Maybe\n\nfilterCreateWorkspace :: [SomeCommandRequest] -&gt; [CreateWorkspace]\nfilterCreateWorkspace = catMaybes . map getCW\n  where getCW (SomeCommandRequest cr) = maybeCreateWorkspace cr\n</code></pre>\n\n<p>which works fine, though the syntax is still a bit cumbersome:</p>\n\n<pre><code>testdata2 :: [SomeCommandRequest]\ntestdata2 = [ SomeCommandRequest (CreateWorkspace 1 2)\n           , SomeCommandRequest (CreateWorkspace 3 4)\n           , SomeCommandRequest (IntroduceIdea 5 6 \"seven\")\n           ]\ntest2 = print $ filterCreateWorkspace testdata2\n</code></pre>\n\n<p>The test gives:</p>\n\n<pre><code>&gt; test2\n[CreateWorkspace {commandId = 1, workspaceId = 2}\n,CreateWorkspace {commandId = 3, workspaceId = 4}]\n</code></pre>\n\n<p>The awkward thing about this solution is that we need a type class method for identifying the <code>CreateWorkspace</code> type.  If we wanted to construct lists of each possible constructor, we'd need to add a new type class method for every single one, and we need to give a definition for the method for every instance (though we can get away with a default definition that returns <code>Nothing</code> for all but one instance, I guess).  Anyway, that's nuts!</p>\n\n<p>The mistake we made was making it <em>difficult</em> to represent a list of type <code>[CreateWorkspace]</code> instead of <strong>absurdly difficult</strong>.  To make it absurdly difficult, we'll still want to represent our two constructors as separate types, but we'll make them instances of a data family keyed by constructor names lifted to the type level by the <code>DataKinds</code> extension.  <em>Now</em> this is starting to look like a Haskell program!</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE TypeFamilies #-}\n\ndata CommandRequestC = CreateWorkspace | IntroduceIdea\ndata family CommandRequest (c :: CommandRequestC)\n\ntype UUID = Int   -- for the sake of examples\ndata instance CommandRequest CreateWorkspace\n  = CreateWorkspaceCR\n  { commandId :: UUID\n  , workspaceId ::UUID\n  } deriving (Show)\ndata instance CommandRequest IntroduceIdea\n  = IntroduceIdeaCR\n  { commandId :: UUID\n  , workspaceId ::UUID\n  , ideaContent :: String\n  } deriving (Show)\n</code></pre>\n\n<p>What's going on here?  Well, we introduced a new type <code>CommandRequestC</code> (the trailing <code>C</code> stands for \"constructor\") with two constructors <code>CreateWorkspace</code> and <code>IntroduceIdea</code>.  The only purpose of these constructors was to lift them to the type level using <code>DataKinds</code> in order to use them as type-level tags for the <code>CommandRequest</code> data family.  This is a very common way of using <code>DataKinds</code>, maybe the <em>most</em> common.  In fact, the example you gave of the type <code>ReadResult 'RegularStream StreamSlice</code> was <strong>exactly</strong> this kind of usage.  The type:</p>\n\n<pre><code>data StreamType = All | RegularStream\n</code></pre>\n\n<p>carries no useful data.  The whole point of its existence is to lift the constructors <code>All</code> and <code>RegularStream</code> to type-level tags, so that <code>ReadResult 'All StreamSlice</code> and <code>ReadResult 'RegularStream StreamSlice</code> can be used to name two different related types, just like <code>CommandRequest 'CreateWorkspace</code> and <code>CommandRequest 'IntroduceIdea</code> name two different related types.</p>\n\n<p>At this point, we have two separate types for our two constructors that happen to be related via a tagged data family, rather than via a type class.</p>\n\n<pre><code>testdata3 :: [CommandRequest 'CreateWorkspace]\ntestdata3 = [CreateWorkspaceCR 1 2, CreateWorkspaceCR 3 4]\n\ntestdata4 :: [CommandRequest 'IntroduceIdea]\ntestdata4 = [IntroduceIdeaCR 5 6 \"seven\"]\n</code></pre>\n\n<p>Note that even though we can write the type <code>[CommandRequest c]</code>, leaving the constructor tag as an unspecified type variable <code>c</code>, we still can't write a list that mixes these constructors:</p>\n\n<pre><code>testdata5bad :: [CommandRequest c]\ntestdata5bad = [CreateWorkspaceCR 1 2, CreateWorkspaceCR 3 4, \n            IntroduceIdeaCR 5 6 \"seven\"]  -- **ERROR**\n</code></pre>\n\n<p>We still need our existential type:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\ndata SomeCommandRequest = forall c . SomeCommandRequest (CommandRequest c)\n</code></pre>\n\n<p>and the extra existential syntax:</p>\n\n<pre><code>testdata6 :: [SomeCommandRequest]\ntestdata6 = [ SomeCommandRequest (CreateWorkspaceCR 1 2)\n            , SomeCommandRequest (CreateWorkspaceCR 3 4)\n            , SomeCommandRequest (IntroduceIdeaCR 5 6 \"seven\")]\n</code></pre>\n\n<p>Worse yet, if we try to write a filter function, it's not clear how to implement it.  One reasonable first attempt is:</p>\n\n<pre><code>filterCreateWorkspace :: [SomeCommandRequest] -&gt; [CommandRequest 'CreateWorkspace]\nfilterCreateWorkspace (SomeCommandRequest cr : rest)\n   = case cr of cw@(CreateWorkspaceCR _ _) -&gt; cw : filterCreateWorkspace rest\n                _ -&gt; filterCreateWorkspace rest\n</code></pre>\n\n<p>but this fails with an error about failing to match to the <code>CreateWorkspace</code> tag.</p>\n\n<p>The problem is that data families aren't powerful enough to allow you to infer which member of a family you actually have (i.e., whether <code>cr</code> is a <code>CreateWorkspaceCR</code> or <code>IntroduceIdeaCR</code>).  At this point, we could go back to working with a type class or maybe introduce proxies or singletons to maintain a value-level representation of the constructors in the existential type, but there's a more straightforward solution.  </p>\n\n<p>GADTs <em>are</em> powerful enough to infer the type of <code>cr</code>, and we can rewrite our data family as a GADT.  Not only is the syntax simpler:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE StandaloneDeriving #-}\n\ndata CommandRequestC = CreateWorkspace | IntroduceIdea\n\ntype UUID = Int\ndata CommandRequest c where\n  CreateWorkspaceCR :: UUID -&gt; UUID -&gt; CommandRequest 'CreateWorkspace\n  IntroduceIdeaCR :: UUID -&gt; UUID -&gt; String -&gt; CommandRequest 'IntroduceIdea\nderiving instance Show (CommandRequest c)\n\ndata SomeCommandRequest = forall c . SomeCommandRequest (CommandRequest c)\n</code></pre>\n\n<p>but we can implement our filtering function without fuss: </p>\n\n<pre><code>filterCreateWorkspace :: [SomeCommandRequest] -&gt; [CommandRequest 'CreateWorkspace]\nfilterCreateWorkspace crs\n  = [ cw | SomeCommandRequest cw@(CreateWorkspaceCR _ _) &lt;- crs ]\n</code></pre>\n\n<p>define some helpful \"constructors\":</p>\n\n<pre><code>createWorkspace :: UUID -&gt; UUID -&gt; SomeCommandRequest\ncreateWorkspace u1 u2 = SomeCommandRequest (CreateWorkspaceCR u1 u2)\n\nintroduceIdea :: UUID -&gt; UUID -&gt; String -&gt; SomeCommandRequest\nintroduceIdea u1 u2 s = SomeCommandRequest (IntroduceIdeaCR u1 u2 s)\n</code></pre>\n\n<p>and test it:</p>\n\n<pre><code>testdata7 :: [SomeCommandRequest]\ntestdata7 = [ createWorkspace 1 2\n            , createWorkspace 3 4\n            , introduceIdea 5 6 \"seven\"]\ntest7 = filterCreateWorkspace testdata7\n</code></pre>\n\n<p>like so:</p>\n\n<pre><code>&gt; test4\n[CreateWorkspaceCR 1 2,CreateWorkspaceCR 3 4]\n&gt;\n</code></pre>\n\n<p>Does any of this look familiar?  It should, because it's @chi's solution.  And it's the only type-level solution that really makes sense, giving what you're trying to do.</p>\n\n<p>Now, with a couple of type aliases and some clever renaming, you can <em>technically</em> get the type signature you want, like so:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE StandaloneDeriving #-}\n\ndata CommandRequestC = CreateWorkspaceC | IntroduceIdeaC\ntype CreateWorkspace = ACommandRequest 'CreateWorkspaceC\ntype IntroduceIdea = ACommandRequest 'IntroduceIdeaC\n\ntype UUID = Int\ndata ACommandRequest c where\n  CreateWorkspaceCR :: UUID -&gt; UUID -&gt; CreateWorkspace\n  IntroduceIdeaCR :: UUID -&gt; UUID -&gt; String -&gt; IntroduceIdea\nderiving instance Show (ACommandRequest c)\n\ndata CommandRequest = forall c . CommandRequest (ACommandRequest c)\n\nfilterCreateWorkspace :: [CommandRequest] -&gt; [CreateWorkspace]\nfilterCreateWorkspace crs\n  = [ cw | CommandRequest cw@(CreateWorkspaceCR _ _) &lt;- crs ]\n\ncreateWorkspace :: UUID -&gt; UUID -&gt; CommandRequest\ncreateWorkspace u1 u2 = CommandRequest (CreateWorkspaceCR u1 u2)\n\nintroduceIdea :: UUID -&gt; UUID -&gt; String -&gt; CommandRequest\nintroduceIdea u1 u2 s = CommandRequest (IntroduceIdeaCR u1 u2 s)\n\ntestdata8 :: [CommandRequest]\ntestdata8 = [ createWorkspace 1 2\n            , createWorkspace 3 4\n            , introduceIdea 5 6 \"seven\"]\n\ntest8 = filterCreateWorkspace testdata8\n</code></pre>\n\n<p>but this is just a trick, so I wouldn't take it too seriously.</p>\n\n<p>And, if all this seems like a lot of work and leaves you feeling dissatisfied with the resulting solution, then welcome to the world of type-level programming!  (Actually, it <em>is</em> all kind of fun, but try not to expect too much.)</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "accepted_answer_id": 52507644, "answer_count": 2, "score": 0, "last_activity_date": 1537916319, "creation_date": 1537888696, "last_edit_date": 1537889836, "question_id": 52501590, "link": "https://stackoverflow.com/questions/52501590/filter-a-list-by-returning-only-one-kind-of-data-constructor-instead-of-the-type", "title": "Filter a list by returning only one kind of data constructor instead of the type of the type constructor", "body": "<p>So let's say I have the following data type :</p>\n\n<pre><code>data CommandRequest  = CreateWorkspace {commandId :: UUID , workspaceId ::UUID }\n                 | IntroduceIdea {commandId :: UUID , workspaceId ::UUID , ideaContent :: String} deriving (Show,Eq)\n</code></pre>\n\n<p>with the <code>{-# LANGUAGE DataKinds   #-}</code></p>\n\n<p>I want to implement the following function (in pseudocode) :</p>\n\n<pre><code>filter :: [CommandRequest] -&gt; [CreateWorkspace] (promoting the data constructor to a type level)\n</code></pre>\n\n<p>can you help me with the implementation of that function ?... Thank you ! </p>\n"}, {"tags": ["parsing", "haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1537886494, "post_id": 52498754, "comment_id": 91942266, "body": "Thank you. When you write &quot;p = item &gt;&gt;= \\x -&gt; return x&quot;, is that the equivalent of just the first line &quot;p = do x &lt;- item&quot;?   If so feeding f (= \\x -&gt; return x&quot;) into bind:  (&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b p &gt;&gt;= f = \\inp -&gt; case parse p inp of                        [ ] -&gt; [ ]                        [(v,out)] -&gt; parse ((\\x -&gt; return x) v) out  I can sort of see how &#39;v&#39; might be returned from that, but not how that reduces to simply making &#39;out&#39; available as the input for the next line. What is parse doing if the next line of the &#39;do&#39; parser is a the item parser?"}, {"owner": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1537886808, "post_id": 52498754, "comment_id": 91942534, "body": "Hutton says: &quot;That is, the parser p &gt;&gt; = f fails if the application of the parser p to the input string fails, and otherwise applies the function f to the result value to give a second parser, which is then applied to the output string to give the final result. In this manner, the result value produced by the first parser is made directly available for processing by the second.&quot;  So bind applies two parsers with bind in each line of the &#39;do&#39; parser - with item &amp; a second invisible parser that outputs &#39;out&#39; as input for item on the next line? I don&#39;t see how &quot;parse (f v) out&quot; can do that."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1537888045, "post_id": 52498754, "comment_id": 91943404, "body": "@JohnDawson I&#39;ve expanded my answer in response to your comment. I hope that&#39;s cleared things up."}, {"owner": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1537895002, "post_id": 52498754, "comment_id": 91947303, "body": "Thank you! I understand. Thank you for taking the time to explain. You have put me out of my misery and I can now continue with the book. I like the &#39;spareness&#39; of Graham Hutton&#39;s book, but in section 8.4 there was just too much new on one or two pages fighting my expectations of how things should work."}, {"owner": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1581522309, "post_id": 52498754, "comment_id": 106464336, "body": "item returns something of the form [(x,xs)]  p is defined as:  p = do x &lt;- item        item        y &lt;- item        return (x,y)  how does x &lt;- item match with just the x of (x,xs) and call it x ( or y )?   Why, when the monad is &#39;unwrapped&#39; and the underlying value taken out, doesn&#39;t the arrow &lt;-  deliver the tuple (x,xs) and call that whole thing x (or y)  or fail - rather than just the first x from the tuple? @sepp2k"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1581523709, "post_id": 52498754, "comment_id": 106465224, "body": "@JohnDawson Because that&#39;s how <code>&gt;&gt;=</code> is defined for <code>Parser</code>. If you look at the definition of <code>&gt;&gt;=</code> in the OP, it says <code>parse (f v) out</code> where <code>v</code> is the first element in the tuple and <code>out</code> is the second element. So <code>f</code> is called with the first item of the tuple, thus <code>x</code>, which is <code>f</code>&#39;s parameter, will be that item."}, {"owner": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1581524353, "post_id": 52498754, "comment_id": 106465678, "body": "Thank you. So the rule for identifying the &quot;result value&quot; is always to look at the definition of bind (p &gt;&gt;= f) and identify which value is applied directly to the function f and that will be the result value taken on by x in the do notation&#39;s &quot;x &lt;-&quot;?  @sepp2k"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "edited": false, "score": 0, "creation_date": 1581524851, "post_id": 52498754, "comment_id": 106465979, "body": "@JohnDawson Yes. <code>x &lt;- foo; ...</code> becomes <code>foo &gt;&gt;= \\x -&gt; ...</code> when <code>do</code>-notation is expanded, so <code>x</code> becomes whichever argument <code>&gt;&gt;=</code> uses as the argument to the function on its right (i.e. <code>f</code> in this case)."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 4, "last_activity_date": 1537888012, "last_edit_date": 1537888012, "creation_date": 1537880155, "answer_id": 52498754, "question_id": 52497671, "link": "https://stackoverflow.com/questions/52497671/haskell-graham-hutton-book-parsing-ch-8-what-does-parse-f-v-out-do-and/52498754#52498754", "title": "Haskell: Graham Hutton Book Parsing (Ch-8): What does `parse (f v) out` do, and how does it do it?", "body": "<p><code>f v</code> produces a <code>Parser b</code> because <code>f</code> is a function of type <code>a -&gt; Parser b</code> and <code>v</code> is a value of type <code>a</code>. So then you're calling <code>parse</code> with this <code>Parser b</code> and the string <code>out</code> as arguments.</p>\n\n<blockquote>\n  <p>F in the 'do' parser is item</p>\n</blockquote>\n\n<p>No, it's not. Let's consider a simplified (albeit now somewhat pointless) version of your parser:</p>\n\n<pre><code>p = do x &lt;- item\n       return x\n</code></pre>\n\n<p>This will desugar to:</p>\n\n<pre><code>p = item &gt;&gt;= \\x -&gt; return x\n</code></pre>\n\n<p>So the right operand of <code>&gt;&gt;=</code>, i.e. <code>f</code>, is <code>\\x -&gt; return x</code>, not <code>item</code>.</p>\n\n<blockquote>\n  <p>Also how does the 'do' parser 'drop' the returned values each time to operate on the rest of the input string when item is called again? What is the object that works its way through the 'do' parser and how is it altered and each step and by what means is it altered?</p>\n</blockquote>\n\n<p>When you apply a parser it returns a tuple containing the parsed value and a string representing the rest of the input. If you look at <code>item</code> for example, the second element of the tuple will be <code>xs</code> which is the tail of the input string (i.e. a string containing all characters of the input string except the first). This second part of the tuple will be what's fed as the new input to subsequent parsers (as per <code>[(v,out)] -&gt; parse (f v) out</code>), so that way each successive parser will take as input the string that the previous parser produced as the second part of its output tuple (which will be a suffix of <em>its</em> input).</p>\n\n<hr>\n\n<p>In response to your comments:</p>\n\n<blockquote>\n  <p>When you write \"p = item >>= \\x -> return x\", is that the equivalent of just the first line \"p = do x &lt;- item\"?</p>\n</blockquote>\n\n<p>No, it's equivalent to the entire <code>do</code>-block (i.e. <code>do {x &lt;- item; return x}</code>). You can't translate <code>do</code>-blocks line-by-line like that. <code>do { x &lt;- foo; rest }</code> is equivalent to <code>foo &gt;&gt;= \\x -&gt; do {rest}</code>, so you'll always have the rest of the <code>do</code>-block as part of the right operand of <code>&gt;&gt;=</code>.</p>\n\n<blockquote>\n  <p>but not how that reduces to simply making 'out' available as the input for the next line. What is parse doing if the next line of the 'do' parser is a the item parser?</p>\n</blockquote>\n\n<p>Let's walk through an example where we invoke <code>item</code> twice (this is like your <code>p</code>, but without the middle item). In the below I'll use <code>===</code> to denote that the expressions above and below the <code>===</code> are equivalent.</p>\n\n<pre><code>do x &lt;- item\n   y &lt;- item\n   return (x, y)\n=== -- Desugaring do\nitem &gt;&gt;= \\x -&gt; item &gt;&gt;= \\y -&gt; return (x, y)\n=== -- Inserting the definition of &gt;&gt;= for outer &gt;&gt;=\n\\inp -&gt; case parse item inp of\n             [] -&gt; []\n             [(v,out)] -&gt; parse (item &gt;&gt;= \\y -&gt; return (v, y)) out\n</code></pre>\n\n<p>Now let's apply this to the input \"ab\":</p>\n\n<pre><code>case parse item \"ab\" of\n     [] -&gt; []\n     [(v,out)] -&gt; parse (item &gt;&gt;= \\y -&gt; return (v, y)) out\n=== Insert defintiion of `parse`\ncase item \"ab\" of\n     [] -&gt; []\n     [(v,out)] -&gt; parse (item &gt;&gt;= \\y -&gt; return (v, y)) out\n=== Insert definition of item\ncase ('a', \"b\") of\n     [] -&gt; []\n     [(v,out)] -&gt; parse (item &gt;&gt;= \\y -&gt; return (v, y)) out\n===\nparse (item &gt;&gt;= \\y -&gt; return ('a', y)) out\n</code></pre>\n\n<p>Now we can expand the second <code>&gt;&gt;=</code> the same we did the fist and eventually end up with <code>('a', 'b')</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1588326851, "last_edit_date": 1588326851, "creation_date": 1537923348, "answer_id": 52508471, "question_id": 52497671, "link": "https://stackoverflow.com/questions/52497671/haskell-graham-hutton-book-parsing-ch-8-what-does-parse-f-v-out-do-and/52508471#52508471", "title": "Haskell: Graham Hutton Book Parsing (Ch-8): What does `parse (f v) out` do, and how does it do it?", "body": "<p>The relevant advice is, <em>Don't panic</em> (meaning, don't rush it; or, take it slow), and, <em>Follow the types</em>.</p>\n\n<p>First of all, <code>Parser</code>s</p>\n\n<pre><code>type Parser a = String -&gt; [(a,String)]\n</code></pre>\n\n<p><em>are</em> functions from <code>String</code> to lists of pairings of result values of type <code>a</code> and the leftover Strings (because <code>type</code> defines type synonyms, not new types like <code>data</code> or <code>newtype</code> do). </p>\n\n<p>That <em>leftovers</em> string will be used as <em>input</em> for the <em>next</em> parsing step. That's the main thing about it here.</p>\n\n<p>You are asking, <em>in</em></p>\n\n<pre><code>p &gt;&gt;= f = \\inp -&gt; case (parse p inp) of\n                       [] -&gt; []\n                       [(v,out)] -&gt; parse (f v) out\n</code></pre>\n\n<blockquote>\n  <p><i>how the <code>(f v)</code> in <code>[(v,out)] -&gt; parse (f v) out</code> returns a parser which is then applied to <code>out</code>?</i></p>\n</blockquote>\n\n<p>The answer is, <code>f</code>'s <em>type</em> says that it does so: </p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b    -- or, the equivalent\n(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; (String -&gt; [(b,String)])\n--       p              f                inp\n</code></pre>\n\n<p>We have <code>f :: a -&gt; Parser b</code>, so that's just what it does: applied to a value of type <code>a</code> it returns a value of type <code>Parser b</code>. Or equivalently,</p>\n\n<pre><code>f    :: a       -&gt; (String  -&gt; [(b,String)])      -- so that\nf (v :: a)      ::  String  -&gt; [(b,String)]       -- and,\nf (v :: a) (out ::  String) :: [(b,String)]  \n</code></pre>\n\n<p>So whatever is the value that <code>parse p inp</code> <em>produces</em>, it must be what <code>f</code> is waiting for to proceed. The types must <em>\"fit\"</em>:</p>\n\n<pre><code>      p :: Parser a                     --   m  a\nf       ::        a -&gt; Parser b         --      a -&gt; m  b\nf &lt;$&gt; p :: Parser    ( Parser b )       --   m     ( m  b )\nf =&lt;&lt; p :: Parser             b         --   m          b\n</code></pre>\n\n<p>or, equivalently,</p>\n\n<pre><code>p       :: String -&gt; [(a,   String)]\n--         inp         v    out\n      f ::             a -&gt; String   -&gt; [(b, String)]\n--                     v    out\np &gt;&gt;= f :: String                    -&gt; [(b, String)]     -- a combined Parser\n--         inp                            v2  out2\n</code></pre>\n\n<p>So this also answers your second question,</p>\n\n<blockquote>\n  <p><i>How can that be a parser and how can it take <code>out</code> as an argument?</i></p>\n</blockquote>\n\n<p>The real question is, what kind of <code>f</code> is it, that does such a thing? Where does it come from? And that's your fourth question.</p>\n\n<p>And the answer is, your example in <code>do</code>-notation,</p>\n\n<pre><code>p :: Parser (Char, Char)\n\np = do x &lt;- item\n       _ &lt;- item\n       y &lt;- item\n       return (x,y)\n</code></pre>\n\n<p>by Monad laws is equivalent to the nested chain </p>\n\n<pre><code>p = do { x &lt;- item\n       ; do { _ &lt;- item\n            ; do { y &lt;- item\n                 ; return (x,y) }}}\n</code></pre>\n\n<p>which is a syntactic sugar for the nested chain of <code>Parser</code> <em>bind</em> applications,</p>\n\n<pre><code>p :: Parser (Char, Char) -- ~ String -&gt; [((Char,Char), String)]\n\np = item &gt;&gt;= (\\ x -&gt;              -- item :: Parser Char ~ String -&gt; [(Char,String)] \n               item &gt;&gt;= (\\ _ -&gt;                      -- x :: Char\n                          item &gt;&gt;= (\\ y -&gt;           -- y :: Char\n                                     return (x,y) )))\n</code></pre>\n\n<p>and it is <em>because</em> the functions are nested that the final <code>return</code> has access to <em>both</em> <code>y</code> <em>and</em> <code>x</code> there; and it is precisely the <code>Parser</code> <em>bind</em> that arranges for the output leftovers string to be used as input to the next parsing step:</p>\n\n<pre><code>p = item &gt;&gt;= f     -- :: String -&gt; [((Char,Char), String)]\n    where    \n           { f x = item &gt;&gt;= f2\n                    where { f2 _ = item &gt;&gt;= f3\n                                    where { f3 y = return (x,y) }}}\n</code></pre>\n\n<p>i.e. (under the assumption that <code>inp</code> is a string of length two or longer),</p>\n\n<pre><code>parse p inp                            -- assume that `inp`'s \n  = (item &gt;&gt;= f) inp                   --  length is at least 2     NB.\n  =\n    let  [(v, left)] = item inp        -- by the def of &gt;&gt;=\n    in                                \n        (f v) left\n  =\n    let  [(v, left)] = item inp\n    in\n       let  x = v                      -- inline the definition of `f`\n       in  (item &gt;&gt;= f2) left\n  =\n    let  [(v, left)] = item inp\n    in let  x = v \n       in let  [(v2, left2)] = item left     -- by the def of &gt;&gt;=, again\n          in (f2 v2) left2\n  =\n    ..........\n  =\n    let  [(x,left1)] = item inp        -- x &lt;- item\n         [(_,left2)] = item left1      -- _ &lt;- item\n         [(y,left3)] = item left2      -- y &lt;- item\n    in \n        [((x,y), left3)]\n  =\n    let   (x:left1)  = inp             -- inline the definition\n          (_:left2)  = left1           -- of `item`\n          (y:left3)  = left2\n    in \n        [((x,y), left3)]\n  =\n    let   (x:_:y:left3) = inp\n    in \n        [((x,y), left3)]\n</code></pre>\n\n<p>after few simplifications. </p>\n\n<p>And this answers your third question.</p>\n"}, {"tags": [], "owner": {"reputation": 857, "user_id": 2303700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce2e93a0b74ecb2908f6b0e2df3177b2?s=128&d=identicon&r=PG", "display_name": "Simon Dowdeswell", "link": "https://stackoverflow.com/users/2303700/simon-dowdeswell"}, "is_accepted": false, "score": 0, "last_activity_date": 1590314687, "last_edit_date": 1590314687, "creation_date": 1550545579, "answer_id": 54758303, "question_id": 52497671, "link": "https://stackoverflow.com/questions/52497671/haskell-graham-hutton-book-parsing-ch-8-what-does-parse-f-v-out-do-and/54758303#54758303", "title": "Haskell: Graham Hutton Book Parsing (Ch-8): What does `parse (f v) out` do, and how does it do it?", "body": "<p>I am having similar problems reading the syntax, because it's not what we are used to. </p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n\np &gt;&gt;= f = \\inp -&gt; case parse p inp of\n                       [] -&gt; []\n                       [(v,out)] -&gt; parse (f v) out\n</code></pre>\n\n<p>so for the question: </p>\n\n<blockquote>\n  <p>I want to know how the  <code>(f v) out</code> in  <code>[(v,out)] -&gt; parse (f v) out</code> returns a parser which is then applied to <code>out</code>.</p>\n</blockquote>\n\n<p>It does because that's the signature of the 2nd arg (the <strong><code>f</code></strong>): <code>(&gt;&gt;=) :: Parser a -&gt;</code> <strong><code>(a -&gt; Parser b)</code></strong> <code>-&gt; Parser b</code> .... <strong><code>f</code></strong> takes an <strong><code>a</code></strong> and produces a <strong><code>Parser b</code></strong> . a <strong><code>Parser b</code></strong> takes a <strong><code>String</code></strong> which is the <strong><code>out</code></strong> ... <code>(f v)</code> <strong><code>out</code></strong>.</p>\n\n<p>But the output of this should not be mixed up with the output of the function we are writing: <strong><code>&gt;&gt;=</code></strong> </p>\n\n<ul>\n<li>We are outputting a parser ... <code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt;</code>\n<strong><code>Parser b</code></strong> .  </li>\n<li>The <code>Parser</code> we are outputting has the job of wrapping and chaining the first 2 args</li>\n</ul>\n\n<p>A parser is a function that takes 1 arg. <em>This is constructed right after the first <code>=</code></em> ... i.e. by returning an (anonymous) function: <code>p &gt;&gt;= f</code> <strong><code>= \\inp -&gt; ...</code></strong> so <strong><code>inp</code></strong> refers to the input string of the Parser we are building</p>\n\n<p>so what is left is to define what that constructed function should do ... <em>NOTE: we are not implementing any of the input parsers just chaining them together</em> ... so the <strong>output Parser function should</strong>:</p>\n\n<ul>\n<li>apply the input parser (<strong><code>p</code></strong>) to the its input (<code>inp</code>): <strong><code>p</code></strong> <code>&gt;&gt;= f =</code> <strong><code>\\inp</code></strong> <code>-&gt; case</code> <strong><code>parse p inp</code></strong> <code>of</code> </li>\n<li>take the output of that parse <code>[(v, out)]</code> -- <strong><code>v</code></strong> is the result, <strong><code>out</code></strong> is what remains of the input</li>\n<li>apply the input function (<code>f</code> is <strong><code>(a -&gt; Parser b)</code></strong>) to the parsed result (<code>v</code>)</li>\n<li><code>(f v)</code> produces a <strong><code>Parser b</code></strong> (a function that takes 1 arg)</li>\n<li>so apply that output parser to the <em>remainder</em> of the input <em>after</em> the first parser (<code>out</code>)</li>\n</ul>\n\n<p>For me the understanding lies in the use of destructuring and the realization that we are constructing a function that glues together the <em>execution</em> of other functions together simply considering their <em>interface</em>.</p>\n\n<p>Hope that helps ... it helped me to write it :-)</p>\n"}], "owner": {"reputation": 31, "user_id": 10412779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f707b9a04243959db4a906997eba713c?s=128&d=identicon&r=PG&f=1", "display_name": "John Dawson", "link": "https://stackoverflow.com/users/10412779/john-dawson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1590314687, "creation_date": 1537876610, "last_edit_date": 1539427640, "question_id": 52497671, "link": "https://stackoverflow.com/questions/52497671/haskell-graham-hutton-book-parsing-ch-8-what-does-parse-f-v-out-do-and", "title": "Haskell: Graham Hutton Book Parsing (Ch-8): What does `parse (f v) out` do, and how does it do it?", "body": "<p>My question is about Graham Hutton's book <a href=\"http://www.cs.nott.ac.uk/~pszgmh/book-old.html\" rel=\"nofollow noreferrer\"><em>Programming in Haskell 1st Ed</em></a>.</p>\n\n<p>There is a parser created in section 8.4, and I am assuming anyone answering has the book or can see the link to slide 8 in the link above. </p>\n\n<p>A basic parser called <code>item</code> is described as:</p>\n\n<pre><code>type Parser a = String -&gt; [(a, String)]\n\nitem :: Parser Char\n\nitem = \\inp -&gt; case inp of\n        [] -&gt; []\n        (x:xs) -&gt; [(x,xs)]\n</code></pre>\n\n<p>which is used with <code>do</code> to define another parser <code>p</code> (the <code>do</code> parser)</p>\n\n<pre><code>p :: Parser (Char, Char)\n\np = do x &lt;- item\n       item\n       y &lt;- item\n       return (x,y)\n</code></pre>\n\n<p>the relevant <em>bind</em> definition is:</p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n\np &gt;&gt;= f = \\inp -&gt; case parse p inp of\n                       [] -&gt; []\n                       [(v,out)] -&gt; parse (f v) out\n</code></pre>\n\n<p><code>return</code> is defined as:</p>\n\n<pre><code>return  :: a -&gt; Parser a\n\nreturn v = \\inp -&gt; [(v,inp)]\n</code></pre>\n\n<p><code>parse</code> is defined as:</p>\n\n<pre><code>parse :: Parser a -&gt; String -&gt; [(a,String)]\n\nparse p inp = p inp\n</code></pre>\n\n<p>The program (the <code>do</code> parser) takes a string and selects the 1st and 3rd characters and  returns them in a tuple with the remainder of the string in a list, e.g., <code>\"abcdef\"</code> produces <code>[('a','c'), \"def\"]</code>.</p>\n\n<p>I want to know how the \n        <code>(f v) out</code> \nin \n        <code>[(v,out)] -&gt; parse (f v) out</code>\nreturns a parser which is then applied to <code>out</code>. </p>\n\n<ul>\n<li><p><code>f</code> in the <code>do</code> parser is <code>item</code> and <code>item</code> taking a character <code>'c'</code> returns <code>[('c',[])]</code>? </p></li>\n<li><p>How can that be a parser and how can it take <code>out</code> as an argument? </p></li>\n</ul>\n\n<p>Perhaps I am just not understanding what <code>(f v)</code> does. </p>\n\n<ul>\n<li><p>Also how does the <code>do</code> parser 'drop' the returned values each time to operate on the rest of the input string when <code>item</code> is called again? </p></li>\n<li><p>What is the object that works its way through the <code>do</code> parser, and how is it altered at each step, and by what means is it altered?</p></li>\n</ul>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1537877479, "post_id": 52497437, "comment_id": 91936120, "body": "Great, thank you! Could you expand on the &quot;should not&quot; part? I understand that Typeable and friends exactly want to create a runtime representation of the types. Would it be totally illegitimate to have an instance that simply inherits this behavior from the derivee (if that&#39;s a word)? My main reason for introducing this newtype (in my specific case) is to squeeze a bit more type-safety out of the language by differentiating <code>T</code> and <code>Text</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1537877934, "last_edit_date": 1537877934, "creation_date": 1537875848, "answer_id": 52497437, "question_id": 52496506, "link": "https://stackoverflow.com/questions/52496506/can-i-derive-a-newtype-instance-of-data/52497437#52497437", "title": "Can I derive a newtype instance of `Data`?", "body": "<p>From the <a href=\"https://downloads.haskell.org/~ghc/8.6.1/docs/html/users_guide/glasgow_exts.html?highlight=generalizednewtypederiving#a-more-precise-specification\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>A derived instance is derived only for declarations of these forms\n  (after expansion of any type synonyms):</p>\n\n<pre><code>newtype T v1..vn                   = MkT (t vk+1..vn) deriving (C t1..tj)\nnewtype instance T s1..sk vk+1..vn = MkT (t vk+1..vn) deriving (C t1..tj)\n</code></pre>\n  \n  <p>where [...]</p>\n  \n  <ul>\n  <li>C is not <code>Read</code>, <code>Show</code>, <code>Typeable</code>, or <code>Data</code>. These classes should not \u201clook through\u201d the type or its constructor. You can still derive these\n  classes for a newtype, but it happens in the usual way, not via this\n  new mechanism. Confer with <a href=\"https://downloads.haskell.org/~ghc/8.6.1/docs/html/users_guide/glasgow_exts.html?highlight=generalizednewtypederiving#default-deriving-strategy\" rel=\"nofollow noreferrer\">Default deriving strategy</a>.</li>\n  </ul>\n</blockquote>\n\n<p>The point is: a <code>Data</code> instance for a <code>newtype</code> should be crafted according to the constructor of the <code>newtype</code> itself, rather than to the (several) constructors of the underlying type.</p>\n\n<p>The generalized <code>newtype</code> instance would simply \"coerce\" the <code>Data</code> instance of the underlying type to the <code>newtype</code>, but that would be wrong.</p>\n\n<p>(The error message you got could have been more helpful, though.)</p>\n\n<p>Concluding: try to use <code>DeriveDataTypeable</code> instead. That should derive the right instance.</p>\n\n<pre><code>newtype T = T Text deriving (Data)\n</code></pre>\n\n<hr>\n\n<p>More precisely, we should see this in a proper instance:</p>\n\n<pre><code>&gt; data U = A | B deriving Data\n&gt; newtype T = T U deriving Data\n&gt; toConstr (T A)\nT\n</code></pre>\n\n<p>Instead, a \"newtype derived\" instance would yield <code>A</code> here, exposing the underlying constructor instead of the intended <code>T</code> one.</p>\n"}], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 52497437, "answer_count": 1, "score": 3, "last_activity_date": 1537877934, "creation_date": 1537872921, "last_edit_date": 1537873377, "question_id": 52496506, "link": "https://stackoverflow.com/questions/52496506/can-i-derive-a-newtype-instance-of-data", "title": "Can I derive a newtype instance of `Data`?", "body": "<p>I have a newtype <code>T</code>:</p>\n\n<pre><code>newtype T = T Text\n</code></pre>\n\n<p>I want to derive <code>Data</code> for it. So with <code>-XGeneralizedNewtypeDeriving -XDerivingStrategies</code> I do</p>\n\n<pre><code>deriving newtype instance Data T\n</code></pre>\n\n<p>I would expect this to be a no-brainer derivation for GHC yet I get a nasty error message (attached below). The error message seems to come from the application of <code>coerce</code> incurred by the <code>newtype</code> derivation.</p>\n\n<p>If I understand role annotations correctly, they would need to go on the type declaration on the instance methods for <code>Data</code>, yet there are none. Do I need to roll my own instance?</p>\n\n<pre><code>    \u2022 Couldn't match representation of type \u2018c1 Text\u2019\n                               with that of \u2018c1 T\u2019\n        arising from a use of \u2018ghc-prim-0.5.2.0:GHC.Prim.coerce\u2019\n      NB: We cannot know what roles the parameters to \u2018c1\u2019 have;\n        we must assume that the role is nominal\n    \u2022 In the expression:\n        ghc-prim-0.5.2.0:GHC.Prim.coerce\n          @(forall (c :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep\n                         -&gt; TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n            forall (d :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep)\n                   (b :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n            Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b\n            -&gt; forall (g :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n               g -&gt; c g\n               -&gt; Text -&gt; c Text)\n          @(forall (c :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep\n                         -&gt; TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n            forall (d :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep)\n                   (b :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n            Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b\n            -&gt; forall (g :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n               g -&gt; c g\n               -&gt; T -&gt; c T)\n          gfoldl\n      In an equation for \u2018gfoldl\u2019:\n          gfoldl\n            = ghc-prim-0.5.2.0:GHC.Prim.coerce\n                @(forall (c :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep\n                               -&gt; TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n                  forall (d :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep)\n                         (b :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n                  Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b\n                  -&gt; forall (g :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n                     g -&gt; c g\n                     -&gt; Text -&gt; c Text)\n                @(forall (c :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep\n                               -&gt; TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n                  forall (d :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep)\n                         (b :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n                  Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b\n                  -&gt; forall (g :: TYPE ghc-prim-0.5.2.0:GHC.Types.LiftedRep).\n                     g -&gt; c g\n                     -&gt; T -&gt; c T)\n                gfoldl\n      When typechecking the code for \u2018gfoldl\u2019\n        in a derived instance for \u2018Data T\u2019:\n        To see the code I am typechecking, use -ddump-deriv\n      In the instance declaration for \u2018Data T\u2019\n</code></pre>\n\n<p>Possibly related: <a href=\"https://stackoverflow.com/questions/25893150/generalizednewtypederiving-fails-for-persistfieldsql\">GeneralizedNewtypeDeriving fails for PersistFieldSql</a></p>\n\n<p>EDIT: Perhaps I should just use <code>-XDeriveDataTypeable</code>?</p>\n"}, {"tags": ["haskell", "gtk", "monads"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1537880908, "post_id": 52496149, "comment_id": 91938434, "body": "Looks like you have <code>G.set window [G.containerChild G.:= canvas]</code> both in <code>createWindowAndCanvas</code> and in <code>main</code>. Perhaps that&#39;s related."}, {"owner": {"reputation": 43, "user_id": 6716026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8X4I.png?s=128&g=1", "display_name": "Jakov Kholodkov", "link": "https://stackoverflow.com/users/6716026/jakov-kholodkov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1538584001, "post_id": 52496149, "comment_id": 92196564, "body": "That was exacly it ! If you&#39;d like you can answer the question below and get more stackoverflow reputation."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1538584147, "creation_date": 1538584147, "answer_id": 52631715, "question_id": 52496149, "link": "https://stackoverflow.com/questions/52496149/periodically-repeating-task-in-haskell-and-gtk/52631715#52631715", "title": "Periodically repeating task in haskell and GTK", "body": "<p>You have</p>\n\n<pre><code>G.set window [G.containerChild G.:= canvas]\n</code></pre>\n\n<p>in both <code>createWindowAndCanvas</code> and in <code>main</code>, and the warning is letting you know that <code>canvas</code> shouldn't be made the child of a container when it is already the child of a container.</p>\n\n<p>You can fix the problem by removing one or the other child relationships.</p>\n"}], "owner": {"reputation": 43, "user_id": 6716026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8X4I.png?s=128&g=1", "display_name": "Jakov Kholodkov", "link": "https://stackoverflow.com/users/6716026/jakov-kholodkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 52631715, "answer_count": 1, "score": 2, "last_activity_date": 1538584147, "creation_date": 1537871818, "last_edit_date": 1537880727, "question_id": 52496149, "link": "https://stackoverflow.com/questions/52496149/periodically-repeating-task-in-haskell-and-gtk", "title": "Periodically repeating task in haskell and GTK", "body": "<p>I am quite new to haskell, and would like to write a GUI with gtk.\nThe goal of the program is to periodically poll a UART interface (which already works),\nand update the values of a chart. I use the \"Chart\" library.\nI have already come as far as drawing a single chart in a window.\nNow I currently use \"G.timeoutAdd\" <a href=\"http://hackage.haskell.org/package/gtk-0.15.0/docs/Graphics-UI-Gtk-General-General.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/gtk-0.15.0/docs/Graphics-UI-Gtk-General-General.html</a>, to which I pass the function that draws some values.</p>\n\n<p>Then i get the following GTK warning:</p>\n\n<p>(:24592): Gtk-WARNING **: 12:06:59.996: Attempting to add a widget with type GtkDrawingArea to a container of type GtkWindow, but the widget is already inside a container of type GtkWindow, the GTK+ FAQ at <a href=\"http://library.gnome.org/devel/gtk-faq/stable/\" rel=\"nofollow noreferrer\">http://library.gnome.org/devel/gtk-faq/stable/</a> explains how to reparent a widget</p>\n\n<p>I don't know what kind of pointer Magic Haskell does under the hood.\nAnd It seems, that i would have to use a \"forever\" with some kind of delay ?\nIs there a standart procedure for recurrent calls with a timedelay ?</p>\n\n<p>The Current code:</p>\n\n<pre><code>module Main where\n\nimport Graphics.Rendering.Chart.Easy\nimport Graphics.Rendering.Chart.Gtk \nimport qualified Graphics.UI.Gtk as G\nimport qualified Graphics.Rendering.Cairo as C\nimport qualified Graphics.UI.Gtk.Gdk.Events as GE\n\n\nimport Graphics.Rendering.Chart.Renderable\nimport Graphics.Rendering.Chart.Geometry\nimport Graphics.Rendering.Chart.Drawing\nimport Graphics.Rendering.Chart.Backend.Cairo\n\nimport Data.IORef\nimport Control.Monad(when)\nimport System.IO.Unsafe(unsafePerformIO)\n\n\n-- Yuck. But we really want the convenience function\n-- renderableToWindow as to be callable without requiring\n-- initGUI to be called first. But newer versions of\n-- gtk insist that initGUI is only called once\nguiInitVar :: IORef Bool\n{-# NOINLINE guiInitVar #-}\nguiInitVar = unsafePerformIO (newIORef False)\n\ninitGuiOnce :: IO ()\ninitGuiOnce = do\n    v &lt;- readIORef guiInitVar\n    when (not v) $ do\n        -- G.initGUI\n        G.unsafeInitGUIForThreadedRTS\n        writeIORef guiInitVar True\n\nlinechart list = toRenderable layout\n  where\n    lineplot = plot_lines_values .~ list\n              $ plot_lines_style  . line_color .~ opaque blue\n              $ plot_lines_title .~ \"Plot\"\n              $ def\n\n    layout = layout_title .~ \"Amplitude Modulation\"\n           $ layout_plots .~ [toPlot lineplot]\n           $ def\n\nfunc :: Double -&gt; Double\nfunc x = (sin (x*3.14159/45) + 1) / 2 * (sin (x*3.14159/5))\n\ncreateWindowAndCanvas :: Renderable a -&gt; Int -&gt; Int -&gt; IO (G.Window, G.DrawingArea)\ncreateWindowAndCanvas chart windowWidth windowHeight = do\n  window &lt;- G.windowNew\n  canvas &lt;- G.drawingAreaNew\n  G.widgetSetSizeRequest window windowWidth windowHeight\n  G.onExpose canvas $ const (updateCanvas chart canvas)\n  G.set window [G.containerChild G.:= canvas]\n  return (window, canvas)\n\ngetSerialDataAndUpdateCanvas :: G.DrawingArea -&gt;IO(Bool)\ngetSerialDataAndUpdateCanvas canvas = do\n  -- I Thought that here, i could do the fetching of the data from\n  -- the UART/Serialport and then give the data to \"x\"\n  umpdateCanvas (linechart [[ (x, func x) | x &lt;- [0,0.5 .. 40.0 ]]]) canvas \n  return True\n\numpdateCanvas :: Renderable a -&gt; G.DrawingArea  -&gt; IO Bool\numpdateCanvas chart canvas = do\n  win &lt;- G.widgetGetDrawWindow canvas\n  (width, height) &lt;- G.widgetGetSize canvas\n  regio &lt;- G.regionRectangle $ GE.Rectangle 0 0 width height\n  let sz = (fromIntegral width, fromIntegral height)\n  G.drawWindowBeginPaintRegion win regio\n  G.renderWithDrawable win $ runBackend (defaultEnv bitmapAlignmentFns) (render chart sz) \n  G.drawWindowEndPaint win\n  return True\n\nmain :: IO ()\nmain = do\n  let emptyList = [[]] :: [[(Double, Double)]]\n      emptyChart = linechart emptyList\n\n  initGuiOnce\n\n  (window, canvas) &lt;- createWindowAndCanvas emptyChart 400 400\n  G.set window [G.containerChild G.:= canvas]\n\n  window `G.on` G.keyPressEvent $ do\n    C.liftIO (G.widgetDestroy window)\n    return True\n\n  window `G.on` G.objectDestroy $ G.mainQuit\n\n  -- Calls function with the timeout in ms\n  G.timeoutAdd (getSerialDataAndUpdateCanvas canvas) 20\n\n  G.widgetShowAll window\n  G.mainGUI\n</code></pre>\n\n<p>I use the newest version of stack, with the following extra deps in stack.yaml</p>\n\n<pre><code>extra-deps: \n  - gtk-0.14.10\n  - gio-0.13.5.0\n  - SVGFonts-1.6.0.3\n  - diagrams-core-1.4.1.1\n  - diagrams-lib-1.4.2.3\n  - diagrams-postscript-1.4.1\n  - diagrams-svg-1.4.2\n  - diagrams-solve-0.1.1\n  - dual-tree-0.2.2\n  - Chart-1.9\n  - Chart-cairo-1.9\n  - Chart-diagrams-1.9\n  - Chart-gtk-1.9\n</code></pre>\n\n<p>and dependencies in package.yaml</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- gtk\n- Chart\n- cairo\n- Chart-diagrams\n- Chart-gtk\n- Chart-cairo\n</code></pre>\n"}, {"tags": ["haskell", "bresenham"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537946242, "post_id": 52492131, "comment_id": 91963779, "body": "Oh, you are right. I forgot to switch them on the outout."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 1, "last_activity_date": 1537857986, "creation_date": 1537857986, "answer_id": 52492131, "question_id": 52490080, "link": "https://stackoverflow.com/questions/52490080/how-to-draw-a-line-with-bresenhams-algorithm-in-haskell/52492131#52492131", "title": "How to draw a line with Bresenham&#39;s algorithm in haskell", "body": "<p>The thing you are missing is the <code>maySwitch</code> function. Bresenham's Algorithm works only on lines with slopes between 0 and 1 (i.e. 45 degrees). For steeper lines you need to swap the x and y coordinates on both the input and output. This is what the <code>maySwitch</code> function does. You have only swapped them on the input.</p>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 4678973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pQZUt.png?s=128&g=1", "display_name": "Lucsanszky", "link": "https://stackoverflow.com/users/4678973/lucsanszky"}, "is_accepted": false, "score": 0, "last_activity_date": 1537902531, "creation_date": 1537902531, "answer_id": 52505232, "question_id": 52490080, "link": "https://stackoverflow.com/questions/52490080/how-to-draw-a-line-with-bresenhams-algorithm-in-haskell/52505232#52505232", "title": "How to draw a line with Bresenham&#39;s algorithm in haskell", "body": "<p>Indeed, it seems like that you were missing the <code>maySwitch</code> function, just like Paul pointed it out. Kinda \"shameless plug\" but let me include an implementation of mine that I wrote two years ago when I was trying to improve my Haskell skills: <a href=\"https://github.com/Lucsanszky/soft-engine/commit/801e802f498bb9c19528cd074f169bc15cbd5191#diff-59f6fe8726905567287c68be078212a0R66\" rel=\"nofollow noreferrer\">https://github.com/Lucsanszky/soft-engine/commit/801e802f498bb9c19528cd074f169bc15cbd5191#diff-59f6fe8726905567287c68be078212a0R66</a></p>\n\n<p>Hopefully, by seeing an alternative implementation in a slightly different context, you will have a better understanding of the algorithm.</p>\n"}], "owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1537902531, "creation_date": 1537845270, "question_id": 52490080, "link": "https://stackoverflow.com/questions/52490080/how-to-draw-a-line-with-bresenhams-algorithm-in-haskell", "title": "How to draw a line with Bresenham&#39;s algorithm in haskell", "body": "<p>I found codes in Haskell wiki of \"Bresenham's line drawing algorithm\", however, I cannot easily understand the part of the beginning, so I rewrote it. But I cannot draw the lines when the slope is over 1/2.\nHere is part of my codes.</p>\n\n<pre><code>line :: Point -&gt; Point -&gt; [Point]\nline (x0,y0) (x1,y1)\n| abs (y1-y0) &gt; abs(x1-x0)  = line (y0,x0) (y1,x1)\n| x0 &gt; x1                   = line (x1,y1) (x0,y0)\n| otherwise                 = plotLine x0 y0 0\n  where\n</code></pre>\n\n<p>And in where clause, I define the plotLine function just like the \"go\" in Haskell wiki. Since the rest of my codes are almost the same as the codes in Haskell wiki, so I think the problem is from the beginning. But I cannot figure it out. Can anyone help me?</p>\n\n<p>By the way, here is the website of \"Bresenham's line drawing algorithm\" on Haskell wiki: <a href=\"https://wiki.haskell.org/Bresenham%27s_line_drawing_algorithm\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Bresenham%27s_line_drawing_algorithm</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 0, "creation_date": 1537845699, "post_id": 52490035, "comment_id": 91921003, "body": "this question might help <a href=\"https://stackoverflow.com/questions/2035742/is-there-a-haskell-function-for-dates\" title=\"is there a haskell function for dates\">stackoverflow.com/questions/2035742/&hellip;</a>"}, {"owner": {"reputation": 1469, "user_id": 4876305, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymQ5f.jpg?s=128&g=1", "display_name": "Gabriel L.", "link": "https://stackoverflow.com/users/4876305/gabriel-l"}, "edited": false, "score": 1, "creation_date": 1537845762, "post_id": 52490035, "comment_id": 91921016, "body": "Strictly speaking, you cannot have a function <code>getDate :: () -&gt; Int</code> that will actually get you the date. I assume you mean you want something like <code>currentDate :: IO date</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 515, "user_id": 7173551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4aB3g.png?s=128&g=1", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/7173551/cthulhu"}, "edited": false, "score": 0, "creation_date": 1537846728, "post_id": 52490167, "comment_id": 91921224, "body": "How can I get it without being IO Integer?"}, {"owner": {"reputation": 1469, "user_id": 4876305, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymQ5f.jpg?s=128&g=1", "display_name": "Gabriel L.", "link": "https://stackoverflow.com/users/4876305/gabriel-l"}, "reply_to_user": {"reputation": 515, "user_id": 7173551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4aB3g.png?s=128&g=1", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/7173551/cthulhu"}, "edited": false, "score": 6, "creation_date": 1537846942, "post_id": 52490167, "comment_id": 91921261, "body": "@Cthulhu \u2013 you cannot. That&#39;s kind of the whole point. Reading the time is not a pure function, it&#39;s a &quot;step&quot; which would have to occur at a particular point in time during the execution of your program. That&#39;s not how Haskell works \u2013 you have no idea if, when, or how many times any given function in Haskell will run. If your Haskell program needs to express computations dealing with impure values, you do so in an <code>IO</code> action which represents an imperative program.  There is technically an escape hatch, but it&#39;s for advanced use cases, and I am not even going to say what it is here."}], "tags": [], "owner": {"reputation": 1469, "user_id": 4876305, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymQ5f.jpg?s=128&g=1", "display_name": "Gabriel L.", "link": "https://stackoverflow.com/users/4876305/gabriel-l"}, "is_accepted": true, "score": 9, "last_activity_date": 1537846490, "last_edit_date": 1537846490, "creation_date": 1537846121, "answer_id": 52490167, "question_id": 52490035, "link": "https://stackoverflow.com/questions/52490035/how-to-get-date-in-haskell/52490167#52490167", "title": "How to get date in haskell?", "body": "<p>From <a href=\"https://wiki.haskell.org/Getting_the_current_date\" rel=\"noreferrer\">https://wiki.haskell.org/Getting_the_current_date</a>:</p>\n\n<pre><code>import Data.Time.Clock\nimport Data.Time.Calendar\n\ndate :: IO (Integer, Int, Int) -- :: (year, month, day)\ndate = getCurrentTime &gt;&gt;= return . toGregorian . utctDay\n</code></pre>\n\n<p>If you only want the year\u2026</p>\n\n<pre><code>year :: IO Integer\nyear = (\\(y, _, _) -&gt; y) &lt;$&gt; date\n</code></pre>\n"}], "owner": {"reputation": 515, "user_id": 7173551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4aB3g.png?s=128&g=1", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/7173551/cthulhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1245, "favorite_count": 1, "accepted_answer_id": 52490167, "answer_count": 1, "score": -2, "last_activity_date": 1537846490, "creation_date": 1537844984, "last_edit_date": 1537845220, "question_id": 52490035, "link": "https://stackoverflow.com/questions/52490035/how-to-get-date-in-haskell", "title": "How to get date in haskell?", "body": "<p>I'm working with Haskell and I would like to get the year of the current date in haskell. I want the output to be an Int or String. \nThanks.</p>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 1, "creation_date": 1537846255, "post_id": 52489707, "comment_id": 91921119, "body": "Yes, the idea is to compose your <code>myTransform</code> funtion with IO String via functions like  fmap  &lt;$&gt;, =&lt;&lt; functions"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 0, "creation_date": 1537859978, "post_id": 52489707, "comment_id": 91925868, "body": "@YuanWang In this case, it would be impossible, though, since the argument is a monadic function, not a single monadic action."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537878343, "post_id": 52489707, "comment_id": 91936722, "body": "You need to do the exact opposite of your title; you need to lift your pure function into an IO action."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1537859435, "post_id": 52489875, "comment_id": 91925608, "body": "Actually, this does not answer the question, which is about passing a <code>String -&gt; IO String</code> function for a <code>String -&gt; String</code> argument. In such case, we can&#39;t simply run the IO action in advance since we do not know the string argument."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1537843495, "creation_date": 1537843495, "answer_id": 52489875, "question_id": 52489707, "link": "https://stackoverflow.com/questions/52489707/how-to-turn-io-actions-into-a-pure-function/52489875#52489875", "title": "How to turn IO Actions into a &quot;pure&quot; function", "body": "<p>This is a common dup, but I have a moment so...</p>\n\n<p>No, you should run the IO action and thus obtain the <code>String</code> typed value which is passed to your <code>myTransform</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>main :: IO ()\nmain =\n  do stdout &lt;- externProg \"myProg\"  -- \"execute\" the IO action and obtain \"stdout :: String\"\n     let res = myTransform stdout  -- res :: String\n     putStrLn res\n</code></pre>\n\n<p>Or once you're comfortable in the language and if you are ok with the style:</p>\n\n<pre><code>main :: IO ()\nmain = putStrLn . myTransform =&lt;&lt; externProg \"myProg\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 725, "user_id": 1117884, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/uoBrU.png?s=128&g=1", "display_name": "yokto", "link": "https://stackoverflow.com/users/1117884/yokto"}, "is_accepted": true, "score": 4, "last_activity_date": 1537858612, "creation_date": 1537858612, "answer_id": 52492299, "question_id": 52489707, "link": "https://stackoverflow.com/questions/52489707/how-to-turn-io-actions-into-a-pure-function/52492299#52492299", "title": "How to turn IO Actions into a &quot;pure&quot; function", "body": "<p>No, you can not. You will have to make a monadic version of myTransform. It is custom to append a capital M. I.e. map becomes mapM. fold becomse foldM ... Unfortunately there is no iterateM. I would therefore skip <code>iterateM</code> and implement it directly.</p>\n\n<pre><code>myTransformM' :: (Monad m) =&gt; Int -&gt; (String -&gt; m String) -&gt; String -&gt; m [String]\nmyTransformM' 0 f str = return [str]\nmyTransformM' n f str = do\n    results &lt;- myTransformM (n-1) f str\n    next &lt;- f (head results)\n    return (next:results)\n\nmyTransformM n f str = do\n    results &lt;- myTransformM' n f str\n    return $ reverse results\n</code></pre>\n\n<p>You might notice that the results of the first function are ordered the other way around. This is in order to avoid the function being quadratic.</p>\n\n<p>You can try yourself what will happen if you implement <code>iterateM</code>. It will just loop eternally. This is because Haskell can never know if you will actually get a list back or if there will be an IOError somewhere down the road. Similarly if you take the Maybe monad, Haskell will never know if you actually get a <code>Just list</code> back or if down the road somewhere there is a <code>Nothing</code>.</p>\n\n<pre><code>iterateM :: (Monad m) =&gt; (a -&gt; m a) -&gt; a -&gt; m [a]\niterateM f a = do\n    result &lt;- f a\n    results &lt;- iterateM f result\n    return (result:results)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 1095759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424076a3d8c54ffa4c8355123407708b?s=128&d=identicon&r=PG", "display_name": "Lubricy", "link": "https://stackoverflow.com/users/1095759/lubricy"}, "edited": false, "score": 0, "creation_date": 1537929133, "post_id": 52492897, "comment_id": 91958356, "body": "thank you so much @chi the example explains so well exactly <b>why</b> it won&#39;t gonna work."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1537860853, "creation_date": 1537860853, "answer_id": 52492897, "question_id": 52489707, "link": "https://stackoverflow.com/questions/52489707/how-to-turn-io-actions-into-a-pure-function/52492897#52492897", "title": "How to turn IO Actions into a &quot;pure&quot; function", "body": "<p>The answer by yokto explains the issue very well. I'll only add a further example.</p>\n\n<p>Consider this function:</p>\n\n<pre><code>f1 :: (Int -&gt; Int) -&gt; Int\nf1 g = g 10 + g 20\n\nf2 :: (Int -&gt; Int) -&gt; Int\nf2 g = g 20 + g 10\n</code></pre>\n\n<p>These functions have exactly the same semantics. A Haskell implementation can rewrite the first into the second one, it it wishes, without affecting the outcome.</p>\n\n<p>Now, consider</p>\n\n<pre><code>myG :: Int -&gt; IO Int\nmyG x = print x &gt;&gt; return x\n\nmain :: IO ()\nmain = do\n   x &lt;- f1 myG  -- assume this could be made to work, somehow\n   print x\n</code></pre>\n\n<p>What should this print? Intuitively, it prints either</p>\n\n<pre><code>10\n20\n30\n</code></pre>\n\n<p>or</p>\n\n<pre><code>20\n10\n30\n</code></pre>\n\n<p>depending on the evaluation order used in <code>f1</code>. This is bad since <code>f2</code> could also have been used, and it should lead to the same result, but likely will lead to the other. Worse, the compiler could optimize one into the other, so any specific output is not really guaranteed: the compiler could change it at a whim.</p>\n\n<p>This is a big problem, which Haskell was designed to avoid. The order of IO effects has to be completely specified in the program. For that, the programmer must be prevented to turn IO stuff (like <code>Int -&gt; IO Int</code>) into non-IO stuff (like <code>Int -&gt; Int</code>).</p>\n\n<p>If we used a monadic type for <code>f</code> as in</p>\n\n<pre><code>f3 :: (Int -&gt; IO Int) -&gt; IO Int\nf3 g = ...\n</code></pre>\n\n<p>then Haskell would force us to specify an order between <code>g 10</code> and <code>g 20</code>.</p>\n"}], "owner": {"reputation": 45, "user_id": 1095759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424076a3d8c54ffa4c8355123407708b?s=128&d=identicon&r=PG", "display_name": "Lubricy", "link": "https://stackoverflow.com/users/1095759/lubricy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 1, "accepted_answer_id": 52492299, "answer_count": 3, "score": 1, "last_activity_date": 1537860853, "creation_date": 1537842131, "question_id": 52489707, "link": "https://stackoverflow.com/questions/52489707/how-to-turn-io-actions-into-a-pure-function", "title": "How to turn IO Actions into a &quot;pure&quot; function", "body": "<p>Haskell newbie here.\nI have a higher order function <code>myTransform</code> at hand, which takes a function <code>fn :: String -&gt; String</code> and do some fancy things.\nLet's assume the implementation is</p>\n\n<pre><code>myTransform :: Int -&gt; (String -&gt; String) -&gt; String -&gt; [String]\nmyTransform n f = take n . iterate f\n</code></pre>\n\n<p>now I want to transform an external program, which is, if I understand right, an IO action. Preferably, the signature should be <code>String -&gt; IO String</code>:</p>\n\n<pre><code>import System.Process\nexternProg :: String -&gt; IO String\nexternProg s = readProcess \"echo\" [\"-n\", s, \"+ 1\"] \"\"\n</code></pre>\n\n<p>the question is, is there any way I can fit this <code>String -&gt; IO String</code> function into that <code>String -&gt; String</code> argument slot, without changing, or even knowing, how <code>myTransform</code> implements?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 162, "user_id": 3826046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tJMLE.jpg?s=128&g=1", "display_name": "Cornul11", "link": "https://stackoverflow.com/users/3826046/cornul11"}, "edited": false, "score": 0, "creation_date": 1537835182, "post_id": 52488946, "comment_id": 91919086, "body": "Changing <code>lowestModThree(fst(a) snd(a) fst(b) snd(b) fst(c) snd(c) 1)</code> to <code>lowestModThree (fst(a)) (snd(a)) (fst(b)) (snd(b)) (fst(c)) (snd(c)) 1</code> solved it for the first one, as noted by the user that commented (he deleted the comment).  Changing <code>isPrimeRec&#39;(isqrt(n) n)</code> to <code>isPrimeRec&#39; (isqrt n) n</code> fixed the problem for the second problem."}, {"owner": {"reputation": 162, "user_id": 3826046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tJMLE.jpg?s=128&g=1", "display_name": "Cornul11", "link": "https://stackoverflow.com/users/3826046/cornul11"}, "edited": false, "score": 0, "creation_date": 1537835875, "post_id": 52488946, "comment_id": 91919215, "body": "Now onto fixing the algorithm implementation correctness. Thank you."}, {"owner": {"reputation": 162, "user_id": 3826046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tJMLE.jpg?s=128&g=1", "display_name": "Cornul11", "link": "https://stackoverflow.com/users/3826046/cornul11"}, "edited": false, "score": 0, "creation_date": 1537835907, "post_id": 52488946, "comment_id": 91919219, "body": "Considering i don&#39;t have type mismatches anymore, solved."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 162, "user_id": 3826046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tJMLE.jpg?s=128&g=1", "display_name": "Cornul11", "link": "https://stackoverflow.com/users/3826046/cornul11"}, "edited": false, "score": 2, "creation_date": 1537836488, "post_id": 52488946, "comment_id": 91919311, "body": "@Cornul11 You should also change <code>lowestModThree (fst(a)) (snd(a)) (fst(b)) (snd(b)) (fst(c)) (snd(c)) 1</code> to <code>lowestModThree (fst a) (snd a) (fst b) (snd b) (fst c) (snd c) 1</code> for readability."}, {"owner": {"reputation": 162, "user_id": 3826046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tJMLE.jpg?s=128&g=1", "display_name": "Cornul11", "link": "https://stackoverflow.com/users/3826046/cornul11"}, "reply_to_user": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1537836695, "post_id": 52488946, "comment_id": 91919358, "body": "@ChaiT.Rex, will do."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1537834843, "creation_date": 1537834843, "answer_id": 52488946, "question_id": 52488888, "link": "https://stackoverflow.com/questions/52488888/couldnt-match-type-integer-in-haskell/52488946#52488946", "title": "Couldn&#39;t match type Integer in Haskell", "body": "<p>The syntax to apply function <code>f</code> to argument <code>x</code> is <code>f x</code>, not <code>f(x)</code>. Applications associate left, so <code>f x y</code> means <code>(f x) y</code> -- that is, apply <code>f</code> to <code>x</code>, and apply the resulting function to <code>y</code>. If <code>x</code> is itself a complicated expression with function applications in it, you can use extra parentheses to disambiguate; so, for example:</p>\n\n<ul>\n<li><code>a b c d</code> applies function <code>a</code> to arguments <code>b</code>, <code>c</code>, and <code>d</code></li>\n<li><code>a (b c) d</code> applies function <code>a</code> to arguments <code>b c</code> and <code>d</code></li>\n<li><code>a b (c d)</code> applies function <code>a</code> to arguments <code>b</code> and <code>c d</code></li>\n<li><code>a (b c d)</code> applies function <code>a</code> to a single argument, <code>b c d</code></li>\n</ul>\n"}], "owner": {"reputation": 162, "user_id": 3826046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tJMLE.jpg?s=128&g=1", "display_name": "Cornul11", "link": "https://stackoverflow.com/users/3826046/cornul11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 52488946, "answer_count": 1, "score": 1, "last_activity_date": 1537834843, "creation_date": 1537834312, "last_edit_date": 1537834618, "question_id": 52488888, "link": "https://stackoverflow.com/questions/52488888/couldnt-match-type-integer-in-haskell", "title": "Couldn&#39;t match type Integer in Haskell", "body": "<p>In the exercise that i'm doing for the Functional Programming course i'm asked to find the lowest x for which <code>x mod a = b</code>, being given a series of pairs <code>(a, b)</code>.</p>\n\n<p>In the case when i'm given three pairs (tuples), i am using the following code:</p>\n\n<pre><code>solveModularEq :: [(Integer,Integer)] -&gt; Integer\nsolveModularEq [(a),(b),(c)] = lowestModThree(fst(a) snd(a) fst(b) snd(b) fst(c) snd(c) 1)\n\nlowestModThree :: Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; \nInteger -&gt; Integer -&gt; Integer \nlowestModThree a b c aa bb cc k\n  | k `mod` a == aa &amp;&amp; k `mod` b == bb &amp;&amp; k `mod` c == cc = k\n  | k &gt; (aa * bb * cc) = aa * bb * cc\n  | otherwise = lowestModThree a b c aa bb cc (k+1)\n</code></pre>\n\n<p>In the case that there is no such x, return the product of the moduli.</p>\n\n<p>The errors i am getting are strange because it doesn't seem that i'm mismatching any types.</p>\n\n<pre><code>modEq.hs:3:32:\n   Couldn't match expected type \u2018Integer\u2019\n              with actual type \u2018Integer\n                                 -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer\u2019\n   Probable cause: \u2018lowestModThree\u2019 is applied to too few arguments\n  In the expression:\n     lowestModThree (fst (a) snd (a) fst (b) snd (b) fst (c) snd (c) 1)\n   In an equation for \u2018solveModularEq\u2019:\n      solveModularEq [(a), (b), (c)]\n         = lowestModThree\n             (fst (a) snd (a) fst (b) snd (b) fst (c) snd (c) 1)\n\nmodEq.hs:3:51:\n  Couldn't match type \u2018Integer\u2019\n                  with \u2018((a0, b0) -&gt; b0)\n                       -&gt; (Integer, Integer)\n                        -&gt; ((a1, b1) -&gt; a1)\n                        -&gt; (Integer, Integer)\n                        -&gt; ((a2, b2) -&gt; b2)\n                        -&gt; (Integer, Integer)\n                        -&gt; ((a3, b3) -&gt; a3)\n                        -&gt; (Integer, Integer)\n                        -&gt; ((a4, b4) -&gt; b4)\n                        -&gt; (Integer, Integer)\n                        -&gt; Integer\n                        -&gt; Integer\u2019\n   Expected type: (((a0, b0) -&gt; b0)\n                   -&gt; (Integer, Integer)\n                   -&gt; ((a1, b1) -&gt; a1)\n                   -&gt; (Integer, Integer)\n                   -&gt; ((a2, b2) -&gt; b2)\n                   -&gt; (Integer, Integer)\n                   -&gt; ((a3, b3) -&gt; a3)\n                   -&gt; (Integer, Integer)\n                   -&gt; ((a4, b4) -&gt; b4)\n                   -&gt; (Integer, Integer)\n                   -&gt; Integer\n                   -&gt; Integer,\n                   Integer)\n     Actual type: (Integer, Integer)\n   In the first argument of \u2018fst\u2019, namely \u2018(a)\u2019\n   In the first argument of \u2018lowestModThree\u2019, namely\n     \u2018(fst (a) snd (a) fst (b) snd (b) fst (c) snd (c) 1)\u2019\n</code></pre>\n\n<p>Same happens in this implementation of mine of a recursive primality test implementation.</p>\n\n<pre><code>isPrimeRec :: Int -&gt; Bool\nisPrimeRec n = isPrimeRec'(isqrt(n) n)\n\nisPrimeRec' :: Int -&gt; Int -&gt; Bool\nisPrimeRec' divisor n\n  | mod n divisor == 0 = isPrimeRec' (divisor-1) n\n  | mod n divisor /= 0 = False\n  | divisor &lt; 2 = True\n</code></pre>\n\n<p>The error for this one is</p>\n\n<pre><code>palPrimes.hs:10:16:\n    Couldn't match expected type \u2018Bool\u2019 with actual type \u2018Int -&gt; Bool\u2019\n    Probable cause: \u2018isPrimeRec'\u2019 is applied to too few arguments\n    In the expression: isPrimeRec' (isqrt (n) n)\n    In an equation for \u2018isPrimeRec\u2019:\n        isPrimeRec n = isPrimeRec' (isqrt (n) n)\n\npalPrimes.hs:10:28:\n    Couldn't match expected type \u2018Int -&gt; Int\u2019 with actual type \u2018Int\u2019\n    The function \u2018isqrt\u2019 is applied to two arguments,\n    but its type \u2018Int -&gt; Int\u2019 has only one\n    In the first argument of \u2018isPrimeRec'\u2019, namely \u2018(isqrt (n) n)\u2019\n    In the expression: isPrimeRec' (isqrt (n) n)\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1537829911, "post_id": 52488255, "comment_id": 91918063, "body": "<code>join</code> doesn&#39;t simply remove an outer monad; it <i>merges</i> them, in a monad-specific way. Even <code>join [[&quot;dog&quot;]]</code> doesn&#39;t simply remove the outer list; it concatenates the inner lists: <code>join [[&quot;dog&quot;], [&quot;cat&quot;]] == [&quot;dog&quot;, &quot;cat&quot;]</code>."}, {"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537830646, "post_id": 52488255, "comment_id": 91918223, "body": "Can you clarify what is &quot;monad-specific way&quot;, any reference or doc would be appreciated."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1537833673, "post_id": 52488255, "comment_id": 91918818, "body": "@AronLee <code>join</code> is defined as part of the definition of a Monad. Each Monad defines <code>join</code> differently."}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 6, "last_activity_date": 1537828945, "creation_date": 1537828945, "answer_id": 52488296, "question_id": 52488255, "link": "https://stackoverflow.com/questions/52488255/join-for-different-monads-in-haskell/52488296#52488296", "title": "join for different monads in Haskell", "body": "<p>The <code>m</code> in <code>join :: Monad m =&gt; m (m a) -&gt; m a</code> is the same Monad everywhere it appears. If you had <code>Just (Just \"dog\")</code>, then you have two <code>Maybe</code> monads and your <code>join</code> will work perfectly. Similarly to your list example.</p>\n\n<p>Pulling things out of a Monad cannot be generalized, which is part of the power of Monads. Consider that if you <em>could</em> do that, it would be trivial to strip out the type safety of the IO Monad!</p>\n\n<p>To go from <code>Just [\"dog\"] -&gt; [\"dog\"]</code>, you just need a <code>Maybe a -&gt; a</code> You could use <code>Data.Maybe.fromJust</code>, but <code>maybe</code> is safer (what if you have <code>Nothing</code> instead?)</p>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 1, "accepted_answer_id": 52488296, "answer_count": 1, "score": 2, "last_activity_date": 1537859574, "creation_date": 1537828643, "last_edit_date": 1537859574, "question_id": 52488255, "link": "https://stackoverflow.com/questions/52488255/join-for-different-monads-in-haskell", "title": "join for different monads in Haskell", "body": "<p>I know I can use join to remove the first level of list</p>\n\n<p><code>join [[\"dog\"]]</code>  \" output <code>[\"dog\"]</code></p>\n\n<p>But why the following is not working</p>\n\n<pre><code>join $ (Just [\"dog\"]) \n\ngot error:\nCouldn't match type \u2018[]\u2019 with \u2018Maybe\u2019\n</code></pre>\n\n<p>We know <code>Maybe</code> and <code>[]</code> are both Monad in Haskell,</p>\n\n<pre><code>join(Monad m)=&gt; m(m a) -&gt; m a\n</code></pre>\n\n<p><code>Maybe</code> is Monad </p>\n\n<p><code>[]</code> is Monad</p>\n\n<p>What is wrong with that?</p>\n\n<p>It seems to me join only for the same type of Monad, \nplease correct me if I'm wrong.</p>\n\n<p>Is there any function similar to join for any Monads like the example I's given above?</p>\n\n<p>I know I can do it as following</p>\n\n<pre><code>fromJust (Just [\"dog\"]) \n\n\"output:  [\"dog\"]\n</code></pre>\n\n<p>But I need to know Just in advance.</p>\n"}, {"tags": ["function", "variables", "haskell", "arguments"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537809725, "post_id": 52484382, "comment_id": 91910303, "body": "This looks like an (almost) complete duplicate of the question you asked two minutes ago <a href=\"https://stackoverflow.com/questions/52484370/haskell-use-multiple-functions-inside-of-another-function\" title=\"haskell use multiple functions inside of another function\">stackoverflow.com/questions/52484370/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537809939, "post_id": 52484382, "comment_id": 91910407, "body": "What do you think the values of <code>a</code> and <code>b</code> would <i>be</i>? You haven&#39;t called <code>cubicQ</code> at all, and whatever values you would use in such a call are the values you would use in <code>cubicRealSolution</code> in the first place."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537810267, "post_id": 52484382, "comment_id": 91910536, "body": "@chepner: in the linked question, the OP defines a <code>q</code>, etc., but does not really makes a &quot;function application&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1537829087, "post_id": 52484528, "comment_id": 91917861, "body": "You can wrap a function inside another one using the <code>where</code> keyword. The wrapped function will have access to all the parameters from the function it is wrapped in. So not impossible although it depends on the situation."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1537810393, "creation_date": 1537810393, "answer_id": 52484528, "question_id": 52484382, "link": "https://stackoverflow.com/questions/52484382/how-to-get-a-variables-only-defined-as-an-argument-in-another-function-in-haskel/52484528#52484528", "title": "How to get a variables only defined as an argument in another function in Haskell", "body": "<p>Sorry, it's not possible. If you want a function to have access to a value, you must pass that value to the function (and it must be prepared to accept it).</p>\n"}, {"tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 0, "last_activity_date": 1537828645, "creation_date": 1537828645, "answer_id": 52488256, "question_id": 52484382, "link": "https://stackoverflow.com/questions/52484382/how-to-get-a-variables-only-defined-as-an-argument-in-another-function-in-haskel/52488256#52488256", "title": "How to get a variables only defined as an argument in another function in Haskell", "body": "<p>Altough this won't work we'll present you this to show the idea. In Haskell you can write  </p>\n\n<pre><code>cubicQ a b c = ((3*a*c) - b**2)/(9 * (a**2))\n\n    where\n\n    cubicRealSolution q r s t = if p &lt; 0 then error \"NaN\" else (s + t) - ((b)/(3*(a)))\n</code></pre>\n\n<p>The trick is to use the <code>where</code> keyword. Because <code>cubicRealSolution</code> is wrapped inside <code>cubicQ</code> it can have access to its arguments <code>a</code>, <code>b</code> and <code>c</code> without the need to pass them. </p>\n"}], "owner": {"reputation": 11, "user_id": 6407056, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4w-kl2YfWp4/AAAAAAAAAAI/AAAAAAAAAoo/UnzVthH5O_M/photo.jpg?sz=128", "display_name": "Nick P.", "link": "https://stackoverflow.com/users/6407056/nick-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1537828645, "creation_date": 1537809583, "question_id": 52484382, "link": "https://stackoverflow.com/questions/52484382/how-to-get-a-variables-only-defined-as-an-argument-in-another-function-in-haskel", "title": "How to get a variables only defined as an argument in another function in Haskell", "body": "<p>I have </p>\n\n<pre><code>cubicQ a b c = ((3*a*c) - b**2)/(9 * (a**2))\n</code></pre>\n\n<p>I need to get the value of \"a\" out of that so I can use it in another function, without having to pass it as an argument in that other function. The function I need to use it in is below:</p>\n\n<pre><code>cubicRealSolution q r s t = if p &lt; 0 then error \"NaN\" else (s + t) - ((b)/(3*(a)))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537809634, "post_id": 52484370, "comment_id": 91910254, "body": "You forgot to <i>call</i> the functions <i>with parameters</i>. <code>q = cubicQ</code> will simply assign the function to the variable <code>q</code>. So you need to call it like <code>q = cubicQ a b c</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1537810535, "last_edit_date": 1537810535, "creation_date": 1537810228, "answer_id": 52484506, "question_id": 52484370, "link": "https://stackoverflow.com/questions/52484370/haskell-use-multiple-functions-inside-of-another-function/52484506#52484506", "title": "Haskell use multiple functions inside of another function", "body": "<p>In your <code>cubicRealSolution</code>, you write:</p>\n\n<pre><code>where q = cubicQ\n</code></pre>\n\n<p>(some other declarations as well, but these all suffer from the same problem).</p>\n\n<p>The problem with this is that you now define a function <code>q</code> with type <code>q :: Float -&gt; Float -&gt; Float -&gt; Float</code>. You thus do <em>not</em> make a function call, you simply declare <code>q</code> a function.</p>\n\n<p>You call the function with <code>cubicQ a b c</code> (where <code>a</code>, <code>b</code> and <code>c</code> are de identifiers defined in the <em>head</em> of the <code>cubicRealSolution</code>, not to be confused with the <code>cubicQ</code> function).</p>\n\n<p>So a function that at least would typecheck could look like:</p>\n\n<pre><code>cubicRealSolution :: Float -&gt; Float -&gt; Float -&gt; Float -&gt; Float\ncubicRealSolution a b c d = if l &lt; 0 then error \"NaN\" else sol\n    where q = cubicQ <b>a b c</b>\n          r = cubicR <b>a b c d</b>\n          s = cubicS <b>r q</b>\n          t = cubicT <b>q r</b>\n          l = check <b>q r</b>\n          sol = x1 <b>s t a b</b></code></pre>\n\n<p>Haskell thus does <em>not</em> look for identifiers with the same name, and then calls the function with this parameters. Such \"<em>retrieval by name</em>\" would, in my opionion, be very unsafe, since adding an extra parameter (or renaming one) could have all sorts of effects that are very hard to predict. In fact the name of the parameter usually does not matter much (with some noteworthy exceptions like writing parts in <em>template Haskell</em>).</p>\n\n<p>If <code>cubicQ</code> however aims to calculate the roots of a cubical polynomial, then it seems to return the wrong result. So there is still a semantical problem.</p>\n"}], "owner": {"reputation": 19, "user_id": 7297394, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b0Ubb.jpg?s=128&g=1", "display_name": "Nick Pass", "link": "https://stackoverflow.com/users/7297394/nick-pass"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 770, "favorite_count": 0, "accepted_answer_id": 52484506, "answer_count": 1, "score": 0, "last_activity_date": 1537810535, "creation_date": 1537809504, "last_edit_date": 1537809917, "question_id": 52484370, "link": "https://stackoverflow.com/questions/52484370/haskell-use-multiple-functions-inside-of-another-function", "title": "Haskell use multiple functions inside of another function", "body": "<p>I'm creating a program to compute the solution to a cubic equation in haskell. I'm new to functional languages and I'm having some difficulties. Here is my code:</p>\n\n<pre><code>cubicQ :: Float -&gt; Float -&gt; Float -&gt; Float\ncubicQ a b c = ((3 * a * c) - (b**2)) / (9 * (a**2)) --calculates Q\n\ncubicR :: Float -&gt; Float -&gt; Float -&gt; Float -&gt; Float\ncubicR a b c d = ((9 * a * b * c) - (27 * a**2 * d) - (2 * b**3)) / (54 \n* a**3)--calculates R\n\ncubicS :: Float -&gt; Float -&gt; Float\ncubicS r q = (r + (sqrt(q**3 + r**2))) ** (1/3)--calculates S\n\ncubicT :: Float -&gt; Float -&gt; Float\ncubicT q r = (r - (sqrt(q**3 + r**2))) ** (1/3)--calculates T\n\ncheck :: Float -&gt; Float -&gt; Float\ncheck q r = ((q**3)+(r**2)) --checks for real  numbers\n\nx1 :: Float -&gt; Float -&gt; Float -&gt; Float -&gt; Float\nx1 s t a b = (s + t) - (b / (3 * a)) --calculates x1\n\ncubicRealSolution :: Float -&gt; Float -&gt; Float -&gt; Float -&gt; Float      \n--defines function which takes input and solves  \ncubicRealSolution a b c d = if l &lt; 0 then error \"NaN\" else (sol) --Check \nfor real numbers\n                where\n                  q = cubicQ\n                  r = cubicR\n                  s = cubicS\n                  t = cubicT\n                  l = check \n                  sol = x1\n</code></pre>\n\n<p>I get this error when compiling, <code>* Couldn't match expected type Float'\n                  with actual type Float -&gt; Float -&gt; Float -&gt; Float -&gt; Float'\n    * Probable cause: sol' is applied to too few arguments</code>\nI'm not sure where to go from here. I can get it to work if i remove all of the functions and instead just make my variables equal to the computations that thr functions do, but it's for a school assignment and so I have to have these functions defined.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537808478, "post_id": 52483625, "comment_id": 91909675, "body": "Although that is not the error, defining functions that are not &quot;<i>curried</i>&quot; are rather uncommon in Haskell. Typically the functions are defined as <code>interest n a p = ...</code>, and thus called with <code>interest (n-1) a p</code>."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 10408948, "user_type": "registered", "profile_image": "https://graph.facebook.com/1102103916621870/picture?type=large", "display_name": "Andrei Bercea", "link": "https://stackoverflow.com/users/10408948/andrei-bercea"}, "edited": false, "score": 0, "creation_date": 1537807170, "post_id": 52483669, "comment_id": 91908996, "body": "I succeeded using if instead of guards. I will try this way, as well. Thank you very much!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1537806869, "last_edit_date": 1537806869, "creation_date": 1537806566, "answer_id": 52483669, "question_id": 52483625, "link": "https://stackoverflow.com/questions/52483625/haskell-recursion-function/52483669#52483669", "title": "Haskell Recursion Function", "body": "<p><code>where</code> can only be used after <em>all</em> the guards, and applies to all of them. For instance</p>\n\n<pre><code>f x y =\n  | x &gt; 0     = g a + x   -- a is visible here\n  | otherwise = h a + y   -- and here\n  where a = x + y\n</code></pre>\n\n<p>Further, note that your <code>where a = (a*p)/100</code> will likely lead to non-termination, since <code>a</code> is recursively defined in terms of itself (<code>(a*p)/100</code>). You should use a new variable name e.g. <code>a' = (a*p)/100</code>.\nIt is in general a bad idea to \"redefine\" an outer variable in Haskell: turning on warnings with the <code>-Wall</code> flag helps in detecting these issues.</p>\n\n<p>Finally, note that you can also use <code>let</code> instead of <code>where</code>, and use that inside any expression. For instance</p>\n\n<pre><code>f x y =\n  | x &gt; 0 =\n     let a = x + y\n     in g a + x\n  | otherwise = y  -- a is not visible here\n</code></pre>\n\n<p>One could even write</p>\n\n<pre><code>(let a = x + y in g a) + x\n</code></pre>\n\n<p>albeit I can not recommend this style.</p>\n"}], "owner": {"reputation": 57, "user_id": 10408948, "user_type": "registered", "profile_image": "https://graph.facebook.com/1102103916621870/picture?type=large", "display_name": "Andrei Bercea", "link": "https://stackoverflow.com/users/10408948/andrei-bercea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 52483669, "answer_count": 1, "score": 0, "last_activity_date": 1537806869, "creation_date": 1537806421, "question_id": 52483625, "link": "https://stackoverflow.com/questions/52483625/haskell-recursion-function", "title": "Haskell Recursion Function", "body": "<p>So, what I try to do is to define <em>recursively</em> a function that calculates how much money I have after <strong>n</strong> years, if I start with an amount <strong>a</strong> and receive <strong>p</strong> percent of interest per year.</p>\n\n<pre><code>interest (n,a,p)\n | n &gt; 0          = interest (n-1,a,p)\n       where a = (a*p)/100\n | otherwise      = a\n</code></pre>\n\n<p>And it gives me this error:</p>\n\n<pre><code>E:\\\\Module1\\week3\\scripts.hs:35:2: error: parse error on input `|'\n   |\n35 |  | otherwise      = a\n   |  ^\n</code></pre>\n\n<p>Can anyone tell me what I do wrong?\nThank you.</p>\n"}, {"tags": ["c#", "haskell", "process"], "comments": [{"owner": {"reputation": 49, "user_id": 3477744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b597598acf2e79b73f5228776f62335?s=128&d=identicon&r=PG&f=1", "display_name": "mcNogard", "link": "https://stackoverflow.com/users/3477744/mcnogard"}, "edited": false, "score": 0, "creation_date": 1537795298, "post_id": 52480180, "comment_id": 91901926, "body": "Why can there not be stdin in both?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1537796060, "post_id": 52480180, "comment_id": 91902436, "body": "<code>&lt; text.txt</code> is a <i>shell</i> redirect. <code>StartInfo.UseShellExecute = false</code> means that that won&#39;t work (as far as I understand it)."}], "owner": {"reputation": 49, "user_id": 3477744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b597598acf2e79b73f5228776f62335?s=128&d=identicon&r=PG&f=1", "display_name": "mcNogard", "link": "https://stackoverflow.com/users/3477744/mcnogard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537795071, "creation_date": 1537794399, "last_edit_date": 1537795071, "question_id": 52480180, "link": "https://stackoverflow.com/questions/52480180/running-haskell-from-c-with-arguments-and-receiving-output", "title": "Running haskell from c# with arguments and receiving output", "body": "<p>I am trying to run haskell code in C#, but generally speaking I wan't to be able to communicate with command line in c#. I am able to run commands like \"runhaskell hask\", but I am still unable to run commands like \"runhaskell hask &lt; text.txt\" which despite working in command line, does not work for the method I am using. </p>\n\n<p>This is the code I have come up with.</p>\n\n<p>C#:</p>\n\n<pre><code>private void Om_Programmet_Click(object sender, RoutedEventArgs e)\n    {\n        string current_directory = \n        System.AppDomain.CurrentDomain.BaseDirectory;\n        string project_directory = \n        //current directory, but abbreviated it to fit into code block.\n        Directory.GetParent(Directory.GetParent(D...\n\n        string program = project_directory+\"\\\\text.txt\";\n\n        string haskell_program = project_directory+\"\\\\hask\";\n        string text_file = project_directory+\"\\\\text.txt\";\n        string arguments = haskell_program+ \" &lt; \"+text_file;\n        Debug.WriteLine(arguments);\n\n        var process = new Process();\n        process.StartInfo.FileName = \"runhaskell\";\n        process.StartInfo.Arguments = arguments;\n        process.StartInfo.CreateNoWindow = true;\n        process.StartInfo.UseShellExecute = false;\n        process.StartInfo.RedirectStandardOutput = true;\n        process.StartInfo.RedirectStandardError = true;\n        process.StartInfo.UseShellExecute = false;\n        process.OutputDataReceived += new \n        DataReceivedEventHandler(ReadOutput);\n        process.ErrorDataReceived += new \n        DataReceivedEventHandler(ErrorOutput);\n\n        process.Start();\n        process.BeginOutputReadLine();\n        process.BeginErrorReadLine();\n        process.WaitForExit();\n\n    }\n    private static void ErrorOutput(object sender, DataReceivedEventArgs e)\n    {\n        if (e.Data != null)\n        {\n            Debug.WriteLine(\"Error: \" + e.Data);\n        }\n    }\n\n    private static void ReadOutput(object sender, DataReceivedEventArgs e)\n    {\n        if (e.Data != null)\n        {\n            Debug.WriteLine(e.Data);\n        }\n    }\n</code></pre>\n\n<p>Haskell:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO()\nmain = do\n    c &lt;- getContents\n    putStrLn c\n</code></pre>\n\n<p>This code gives back the error message \"hGetContents: invalid argument\".</p>\n\n<p>It seems like there is an issue with <code>getContents</code> reading the text file, but it seems to me like everything should be okay. </p>\n"}, {"tags": ["json", "haskell", "jwt"], "comments": [{"owner": {"reputation": 765, "user_id": 3316409, "user_type": "registered", "profile_image": "https://graph.facebook.com/719585406/picture?type=large", "display_name": "dvaergiller", "link": "https://stackoverflow.com/users/3316409/dvaergiller"}, "edited": false, "score": 0, "creation_date": 1537789800, "post_id": 52478096, "comment_id": 91898382, "body": "I believe the JWK is simply the key used for signing and/or verifying the JWT. Thus, using it should be mandatory in all libraries unless they support the &quot;none&quot; algorithm (which should never be accepted in production anyway, or maybe ever?). So, I believe that using a JWK should be mandatory in most libraries although some might not call it a JWK but simply call it &quot;the key&quot;."}, {"owner": {"reputation": 405, "user_id": 9348482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67dc5143c1ba85c2f417bf83ede6177f?s=128&d=identicon&r=PG&f=1", "display_name": "autumn322", "link": "https://stackoverflow.com/users/9348482/autumn322"}, "reply_to_user": {"reputation": 765, "user_id": 3316409, "user_type": "registered", "profile_image": "https://graph.facebook.com/719585406/picture?type=large", "display_name": "dvaergiller", "link": "https://stackoverflow.com/users/3316409/dvaergiller"}, "edited": false, "score": 0, "creation_date": 1537791358, "post_id": 52478096, "comment_id": 91899283, "body": "Hi @dvaergiller thanks for your response! I don&#39;t think it&#39;s just a <code>secret</code> since actually there is an ietf <a href=\"https://tools.ietf.org/html/rfc7517\" rel=\"nofollow noreferrer\">specification</a> about it. But I&#39;m puzzled about: What is the use case of it? When to use it?"}, {"owner": {"reputation": 86, "user_id": 1137049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d4f863f93fe0658826ca4ec949f4a8d?s=128&d=identicon&r=PG", "display_name": "Andr&#233; Twupack", "link": "https://stackoverflow.com/users/1137049/andr%c3%a9-twupack"}, "edited": false, "score": 1, "creation_date": 1537791681, "post_id": 52478096, "comment_id": 91899481, "body": "JWK is a format to describe a public key. This can than be downloaded as part of a JWKS through a public URL. The Public Keys in the JWKS can then be used to validate a signature, e.g. the signature of the JWT. In your situation your JWT should normally have a header entry kid (key id). this kid then corresponds to an entry in a JWKS which contains the information on how to validate the signature of the JWT."}, {"owner": {"reputation": 765, "user_id": 3316409, "user_type": "registered", "profile_image": "https://graph.facebook.com/719585406/picture?type=large", "display_name": "dvaergiller", "link": "https://stackoverflow.com/users/3316409/dvaergiller"}, "edited": false, "score": 0, "creation_date": 1537795291, "post_id": 52478096, "comment_id": 91901922, "body": "@autumn322 no it is not a <code>secret</code>, but a key. Note that JWT supports signing and encoding using either shared secret or public key. If you want to use shared secret rather than public key signing, I think you should look at the functions <code>hmacEncode</code> and <code>hmacDecode</code>"}, {"owner": {"reputation": 405, "user_id": 9348482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67dc5143c1ba85c2f417bf83ede6177f?s=128&d=identicon&r=PG&f=1", "display_name": "autumn322", "link": "https://stackoverflow.com/users/9348482/autumn322"}, "reply_to_user": {"reputation": 765, "user_id": 3316409, "user_type": "registered", "profile_image": "https://graph.facebook.com/719585406/picture?type=large", "display_name": "dvaergiller", "link": "https://stackoverflow.com/users/3316409/dvaergiller"}, "edited": false, "score": 0, "creation_date": 1537797877, "post_id": 52478096, "comment_id": 91903641, "body": "@dvaergiller Oh so JWK serves the same reason for those public/private key that usually takes form of a <code>.pem</code> file? Now I feel silly. So when do you want to use those JWK over the <code>.pem</code> file? This is the last one I promise!"}, {"owner": {"reputation": 765, "user_id": 3316409, "user_type": "registered", "profile_image": "https://graph.facebook.com/719585406/picture?type=large", "display_name": "dvaergiller", "link": "https://stackoverflow.com/users/3316409/dvaergiller"}, "edited": false, "score": 0, "creation_date": 1537883476, "post_id": 52478096, "comment_id": 91940241, "body": "@autumn322 I honestly do not know when to use jwkEncode and when to use rsaEncode. But I would love to hear an answer to this one so I&#39;m following this thread =P"}], "owner": {"reputation": 405, "user_id": 9348482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67dc5143c1ba85c2f417bf83ede6177f?s=128&d=identicon&r=PG&f=1", "display_name": "autumn322", "link": "https://stackoverflow.com/users/9348482/autumn322"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 413, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1537788587, "creation_date": 1537787661, "last_edit_date": 1537788587, "question_id": 52478096, "link": "https://stackoverflow.com/questions/52478096/usage-of-jwk-in-a-jws", "title": "Usage of JWK in a JWS", "body": "<p>I'm trying to learn about JWT. I've read <a href=\"https://medium.com/vandium-software/5-easy-steps-to-understanding-json-web-tokens-jwt-1164c0adfcec\" rel=\"nofollow noreferrer\">several</a> <a href=\"https://medium.com/ag-grid/a-plain-english-introduction-to-json-web-tokens-jwt-what-it-is-and-what-it-isnt-8076ca679843\" rel=\"nofollow noreferrer\">blog</a> <a href=\"https://medium.facilelogin.com/jwt-jws-and-jwe-for-not-so-dummies-b63310d201a3\" rel=\"nofollow noreferrer\">post</a> and a github <a href=\"https://github.com/dwyl/learn-json-web-tokens\" rel=\"nofollow noreferrer\">repo</a> and I think I've understood it quite well. </p>\n\n<p>There's this <a href=\"http://hackage.haskell.org/package/jose-jwt-0.8.0\" rel=\"nofollow noreferrer\">library</a> in Haskell that deals with JWT and its kind. In this library, using JWK is mandatory, while most of the library I used in another language doesn't. I'm puzzled of what JWK is, seems it is hardly mentioned in the blog post I've read so far.</p>\n\n<p>A quick search yields a result that what I think about JWK is, I don't know if it's right, is basically a JSON object that can be used as a <code>secret</code>\n and specifying what algorithm is supported. Can someone clarify that this is true or no. More explanation about it will be gratefully accepted!</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1537788760, "post_id": 52477344, "comment_id": 91897798, "body": "What do you mean conduit lib using routing features ?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1537794369, "post_id": 52477344, "comment_id": 91901286, "body": "What&#39;s the question?"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1537860429, "creation_date": 1537784887, "last_edit_date": 1537860429, "question_id": 52477344, "link": "https://stackoverflow.com/questions/52477344/libs-to-have-a-minimal-api-rest-server-running-with-routing-features-fully-integ", "title": "Libs to have a minimal api rest server running with routing features fully integrated with conduit", "body": "<p>I'd like to stream all the way in an API rest with the conduit lib using routing features etc... So far I have used scotty but I'm obliged to terminate the stream inside my api rest call instead to fully integrate conduit with it... Maybe scotty is doing it but I didn't find a way :</p>\n\n<pre><code>post \"/requestCommand/\" $ do\n                   command &lt;- jsonData\n                   (liftIO $ runConduit\n                           $ yield (eventStoreConnection,command)\n                             .| CommandStream.persist\n                             .| sinkList) &gt;&gt;= json\n</code></pre>\n\n<p>I have the intuition that Yesod could do it btw, I'm investigating on that :-), conduit-extra can run a TCP server but I didn't find routing features attached with it... </p>\n\n<p>Do you know some libs to have a minimal api rest server running with routing features (parsing/extracting url parameters, dispatching by post/get/put etc...) which is fully integrated with conduit ?</p>\n"}, {"tags": ["haskell", "monads", "applicative"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537779818, "post_id": 52475742, "comment_id": 91893088, "body": "<code>(&lt;$&gt;)</code> is left associative, so that means that <code>g &lt;$&gt; head &lt;$&gt; f</code>, is <code>(g &lt;$&gt; head) &lt;$&gt; f</code>."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537779891, "post_id": 52475742, "comment_id": 91893124, "body": "@WillemVanOnsem Sure, but <code>g &lt;$&gt; (head &lt;$&gt; f)</code> doesn&#39;t work either. And frankly, I&#39;m a bit puzzled as to why <i>any</i> of the above wouldn&#39;t work."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1537780049, "post_id": 52475742, "comment_id": 91893200, "body": "Well in the above you <code>fmap</code> the values, so <code>g &lt;$&gt; head &lt;$&gt; f</code> basically creates an <code>IO (IO [Int]))</code>, not an <code>IO ()</code>."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537780137, "post_id": 52475742, "comment_id": 91893241, "body": "Ah, I laughed when I read that. So obvious, yet so tricky! Put that in an answer so I can accept it :) I really wonder if it could be possible to at least emit a warning for that; after all it&#39;s an unintentionally discarded value."}, {"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537787413, "post_id": 52475742, "comment_id": 91897058, "body": "@WillemVanOnsem i think the type is <code>IO (IO ())</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 0, "creation_date": 1537787460, "post_id": 52475742, "comment_id": 91897078, "body": "@JonasDureg&#229;rd: yes, that was a typo (but the five minutes were already passed before I noticed it). In the answer I argue that it is <code>IO (IO ())</code> :)"}, {"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 1, "creation_date": 1537787547, "post_id": 52475742, "comment_id": 91897113, "body": "@BartekBanachewicz if you want an error for mistakes like these you can write it as a binding: <code>() &lt;- g . head &lt;$&gt; f</code>. That will give a type error."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1537780541, "creation_date": 1537780541, "answer_id": 52476067, "question_id": 52475742, "link": "https://stackoverflow.com/questions/52475742/why-doesnt-this-simple-composition-work/52476067#52476067", "title": "Why doesn&#39;t this simple composition work?", "body": "<p>The first and second are exactly the same, because <code>&lt;$&gt;</code> is left-associative and <code>head</code> is a function, and <code>&lt;$&gt;</code> is <code>.</code> in the function monad. Then,</p>\n\n<pre><code>    g . head &lt;$&gt; f\n\n    =  fmap (print . head) (return [1..5] :: IO [Int])\n    =  do { x &lt;- (return [1..5] :: IO [Int])\n          ; return ( print (head x) ) }\n    =  do { let x = [1..5] \n          ; return ( print (head x) ) } :: IO _whatever\n    =       \n            return ( print 1 )   :: IO (IO ())\n</code></pre>\n\n<p>We have one too many <code>return</code>s there. In fact,</p>\n\n<pre><code>    =  fmap (print . head) (return [1..5] :: IO [Int])\n    =  return (print (head [1..5]))\n    =  return (print 1)\n</code></pre>\n\n<p>is a shorter derivation.</p>\n\n<p>The third one is</p>\n\n<pre><code>    (head &lt;$&gt; f) &gt;&gt;= g\n  = (fmap head $ return [1..5]) &gt;&gt;= print\n  = (return (head [1..5])) &gt;&gt;= print\n  = (return 1) &gt;&gt;= print\n</code></pre>\n\n<p>which is obviously OK.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1537780979, "post_id": 52476111, "comment_id": 91893649, "body": "otherwise known as <code>join</code>. :)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537781057, "post_id": 52476111, "comment_id": 91893685, "body": "@WillNess: yes, I was working on that at the moment of commenting ;)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1537792906, "post_id": 52476111, "comment_id": 91900296, "body": "I&#39;d hesitate to call this an &quot;unwrapping&quot;, since that implies you could unwrap a single <code>IO f</code> to get the <code>f</code>. I like to think of it as the outer <code>IO</code> &quot;absorbing&quot; the inner <code>IO</code>, leaving the <code>f</code> safely wrapped throughout the entire process."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537793038, "post_id": 52476111, "comment_id": 91900374, "body": "@chepner: good point, do you think this is a better formulation?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1537798225, "post_id": 52476111, "comment_id": 91903850, "body": "Looks good to me. I don&#39;t know if there is any deeper subtlety that could say whether it&#39;s the inner or outer monad that &quot;survives&quot; the process, or if both are equally replaced by a new one :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537951888, "post_id": 52476111, "comment_id": 91967015, "body": "@chepner I think it is the outer &#39;shell&#39; that stays on, so that the &#39;shell&#39; is never &#39;off&#39; and the &#39;inside&#39; is never &#39;exposed&#39; -- or equivalently, in a <i>bind</i>-combined computation the first computation&#39;s &#39;shell&#39; is the <i>outer</i> one: <code>m a -&gt; ...... -&gt; m b</code>. Looking at the types in <a href=\"https://stackoverflow.com/questions/52497671/haskell-graham-hutton-book-parsing-ch-8-what-does-parse-f-v-out-do-and/52508471#52508471\">this simple case</a> of Parser monad  is what convinced me so (look under &#39; <i>the types must &quot;fit&quot;</i> &#39;)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1537792959, "last_edit_date": 1537792959, "creation_date": 1537780707, "answer_id": 52476111, "question_id": 52475742, "link": "https://stackoverflow.com/questions/52475742/why-doesnt-this-simple-composition-work/52476111#52476111", "title": "Why doesn&#39;t this simple composition work?", "body": "<p>Probably the best way to write this is:</p>\n\n<pre><code>f &gt;&gt;= g . head\n</code></pre>\n\n<p>or in a more verbose form:</p>\n\n<pre><code>f &gt;&gt;= (g . head)\n</code></pre>\n\n<p>so we basically perform an <code>fmap</code> on the value for <code>f</code> (we thus take the <code>head</code> of the values wrapped in the <code>IO</code> monad), and then we pass then to <code>g</code>, like:</p>\n\n<pre><code>(head &lt;$&gt; f) &gt;&gt;= g\n</code></pre>\n\n<p>is semantically the same.</p>\n\n<p>But now what happens if we use <code>g &lt;$&gt; head &lt;$&gt; f</code>? Let us first analyze the types:</p>\n\n<pre><code>f :: IO [Int]\ng :: Int -&gt; IO ()\n(&lt;$&gt;) :: Functor m =&gt; (a -&gt; b) -&gt; m a -&gt; m b\n</code></pre>\n\n<p>(I used <code>m</code> here to avoid confusion with the <code>f</code> function)</p>\n\n<p>The canonical form of this is:</p>\n\n<pre><code>((&lt;$&gt;) ((&lt;$&gt;) g head) f)\n</code></pre>\n\n<p>The second <code>(&lt;$&gt;)</code> takes a <code>g :: Int -&gt; IO ()</code> and <code>head :: [c] -&gt; c</code> as parameters, so that means that <code>a ~ Int</code>, <code>b ~ IO ()</code>, and <code>m ~ (-&gt;) [c]</code>. So the result is:</p>\n\n<pre><code> (&lt;$&gt;) g head :: (-&gt;) [c] (IO ())\n</code></pre>\n\n<p>or less verbose:</p>\n\n<pre><code>g &lt;$&gt; head :: [c] -&gt; IO ()\n</code></pre>\n\n<p>The first <code>(&lt;$&gt;)</code> function thus takes as parameters <code>g &lt;$&gt; head :: [c] -&gt; IO ()</code>, and <code>IO [Int]</code>, so that means that <code>m ~ IO</code>, <code>a ~ [Int]</code>, <code>c ~ Int</code>, <code>b ~ IO ()</code>, and hence we obtain the type:</p>\n\n<pre><code>(&lt;$&gt;) (g &lt;$&gt; head) f :: IO (IO ())\n</code></pre>\n\n<p>We thus do not perform any real action: we <code>fmap</code> the <code>[Int]</code> list to an <code>IO</code> action (that is wrapped in the <code>IO</code>). You could see it as <code>return (print 1)</code>: you do not \"evaluate\" the <code>print 1</code>, but you <code>return</code> that wrapped in an <code>IO</code>.</p>\n\n<p>You can of course \"absorb\" the outer <code>IO</code> here, and then use the inner <code>IO</code>, like:</p>\n\n<pre><code>evalIO :: IO (IO f) -&gt; IO f\nevalIO res = do\n   f &lt;- res\n   f\n</code></pre>\n\n<p>or shorter:</p>\n\n<pre><code>evalIO :: IO (IO f) -&gt; IO f\nevalIO res = res &gt;&gt;= id\n</code></pre>\n\n<p>(this can be generalized to all sorts of <code>Monad</code>s, but this is irrelevant here).</p>\n\n<p>The <code>evalIO</code> is also known as <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad.html#v:join\" rel=\"nofollow noreferrer\"><strong><code>join :: Monad m =&gt; m (m a) -&gt; m a</code></strong></a>.</p>\n"}], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 52476111, "answer_count": 2, "score": 7, "last_activity_date": 1537792959, "creation_date": 1537779414, "last_edit_date": 1537779996, "question_id": 52475742, "link": "https://stackoverflow.com/questions/52475742/why-doesnt-this-simple-composition-work", "title": "Why doesn&#39;t this simple composition work?", "body": "<p>I was recently in need of putting <code>head</code> in between two monadic operations. Here's the SSCCE:</p>\n\n<pre><code>module Main where\n\nf :: IO [Int]\nf = return [1..5]\n\ng :: Int -&gt; IO ()\ng = print\n\nmain = do\n    putStrLn \"g &lt;$&gt; head &lt;$&gt; f\"\n    g &lt;$&gt; head &lt;$&gt; f\n\n    putStrLn \"g . head &lt;$&gt; f\"\n    g . head &lt;$&gt; f\n\n    putStrLn \"head &lt;$&gt; f &gt;&gt;= g\"\n    head &lt;$&gt; f &gt;&gt;= g\n</code></pre>\n\n<p>This program is well-formed and compiles without warnings. However, only one version out of 3 above works<sup>1</sup>. Why is that?</p>\n\n<p>And specifically, what would be the best way to link <code>f</code> and <code>g</code> together with <code>head</code> in the middle? I ended up using the 3rd one (in the form of <code>do</code> notation), but I don't really like it, since it should be a trivial one-liner<sup>2</sup>.</p>\n\n<hr>\n\n<p><sup>1</sup> Spoiler alert: the 3rd one is the only one that prints <code>1</code>; the other two are silent, both under <code>runhaskell</code> and <code>repl</code>.</p>\n\n<p><sup>2</sup> I do realize that those are all one-liners, but the order of operations feels really confusing in the only one that works.</p>\n"}, {"tags": ["haskell", "lookup-tables", "template-haskell", "compile-time-constant", "clash"], "comments": [{"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 3, "creation_date": 1537768219, "post_id": 52473170, "comment_id": 91888311, "body": "You can put <code>toBCD</code> in the same module: <code>$( let toBCD :: Word8 -&gt; Vec 3 Word8; toBCD = \u2026 in listToVecTH $ fmap toBCD [minBound .. ] )</code>. You can even make the part inside the <code>$( )</code> multiline if you indent properly."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1537768317, "post_id": 52473170, "comment_id": 91888337, "body": "@ChaiT.Rex: that&#39;s a nice idea! Unfortunately, writing it like that then makes <code>toBCD</code> inaccessible from other code."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1537768504, "post_id": 52473170, "comment_id": 91888388, "body": "Unfortunately, the only two solutions I know of are code duplication (in this case, copying and pasting <code>toBCD</code> as a top-level function and as a <code>let</code> function in every splice you want to use it in) and using a separate module (which you can then reexport functions from)."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 1, "creation_date": 1537768575, "post_id": 52473170, "comment_id": 91888409, "body": "@ChaiT.Rex: I am hoping that there is some CLaSH-specific way to force compilation of that ROM to a precomputed table."}, {"owner": {"reputation": 725, "user_id": 1117884, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/uoBrU.png?s=128&g=1", "display_name": "yokto", "link": "https://stackoverflow.com/users/1117884/yokto"}, "edited": false, "score": 0, "creation_date": 1537858990, "post_id": 52473170, "comment_id": 91925359, "body": "Have not studied the details, but sounds a bit like <a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow noreferrer\">wiki.haskell.org/Memoization</a>"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1537767124, "creation_date": 1537767124, "question_id": 52473170, "link": "https://stackoverflow.com/questions/52473170/turn-a-function-into-a-precomputed-lookup-table-without-going-through-template-h", "title": "Turn a function into a precomputed lookup table without going through Template Haskell", "body": "<p>I have the following CLaSH function:</p>\n\n<pre><code>toBCD :: Word8 -&gt; Vec 3 Word8\ntoBCD x =\n    x `div` 100 :&gt;\n    (x `div` 10) `mod` 10 :&gt;\n    x `mod` 10 :&gt;\n    Nil\n</code></pre>\n\n<p>Of course, the resulting HDL module is unsynthesizable because of the division by  a non-power of 2 constant. So I would like to turn it into a lookup table instead, and put it into a small asynchronous ROM.</p>\n\n<p>At first, I thought it would be enough to do something like </p>\n\n<pre><code>romBCD :: Word8 -&gt; Vec 3 Word8\nromBCD = asyncROM $ fmap toBCD $ iterate d256 succ 0\n</code></pre>\n\n<p>but the resulting VHDL still contains the formula to calculate <code>toBCD 0</code>, <code>toBCD 1</code>, etc. What I would like instead, is to get VHDL which simply contains the precomputed values in a 256x24 table.</p>\n\n<p>One workaround I found was to calculate <code>romBCD</code>'s contents via Template Haskell:</p>\n\n<pre><code>romBCD = asyncRom $(listToVecTH $ fmap toBCD [minBound .. maxBound])\n</code></pre>\n\n<p>but that then forces the definition of <code>romBCD</code> to be in a separate module than <code>toBCD</code>.</p>\n"}, {"tags": ["haskell", "shake-build-system"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1537828818, "post_id": 52471995, "comment_id": 91917789, "body": "You could introduce an intermediate target <code>Key</code> for &quot;extra_input.txt&quot; that could generate a file list in a file called &quot;extra_input.txt&quot;. For your standard build, the contents of that file might be empty but for your special targets, it will add the necessary dependencies. We would need more context from your shake file to suggest where to put the intermediate <code>Key</code>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1537838360, "post_id": 52471995, "comment_id": 91919672, "body": "@BobDalgleish but that sounds like it would only work with pre-selected explicit extension points. I&#39;m more looking for a solution where <code>mainFor</code> doesn&#39;t have to anticipate which rules would be possibly extended this way in various clients."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1539760683, "post_id": 52779714, "comment_id": 92614223, "body": "That&#39;s a shame; I&#39;ve found Make&#39;s similar functionality useful in the past."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1539760784, "post_id": 52779714, "comment_id": 92614273, "body": "Is &quot;providing multiple actions that together produce a result&quot; something that Shake already supports?"}, {"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1539870949, "post_id": 52779714, "comment_id": 92664810, "body": "No, shake doesn&#39;t support putting multiple actions together at the moment."}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 1, "last_activity_date": 1539347833, "creation_date": 1539347833, "answer_id": 52779714, "question_id": 52471995, "link": "https://stackoverflow.com/questions/52471995/adding-an-extra-dependency-in-new-rules-to-existing-rules/52779714#52779714", "title": "Adding an extra dependency in new Rules to existing Rules", "body": "<p>There is currently no way to do this using Shake. The possibilities are:</p>\n\n<ul>\n<li>Add it to Shake. Whether that's the right thing depends on how common this requirement is - and my guess is relatively rare - but that needs validating. The fact you want the dependencies run before the rule is more concerning - it's somehow less compositional than just providing multiple actions that together produce a result.</li>\n<li>Do it on the outside. My straw man would be to write the \"extras\" as some kind of <code>FilePath -&gt; Action ()</code> function, then define your own <code>%&gt;</code> that also applied that function to the output. It would only work with pre-selected extension points, but if you redefine <code>%&gt;</code> at the top of the file it can hit all your instances.</li>\n<li>If you really want to hide it more, use <code>shakeExtra</code> to store the state in some way.</li>\n</ul>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1539347833, "creation_date": 1537755897, "last_edit_date": 1537780819, "question_id": 52471995, "link": "https://stackoverflow.com/questions/52471995/adding-an-extra-dependency-in-new-rules-to-existing-rules", "title": "Adding an extra dependency in new Rules to existing Rules", "body": "<p>I am writing a Shakefile with the aim of making it extensible with new <code>Rules</code>. Its interface is a function <code>mainFor :: Rules () -&gt; IO ()</code>, the idea being that client projects would only need to define <code>main = mainFor myCustomRules</code> to get the whole thing working. <code>mainFor customRules</code> is defined as a bunch of Shake <code>Rules</code> followed by a call to <code>customRules</code>.</p>\n\n<p>This works as long as the custom rules passed to <code>mainFor</code> are for new targets. </p>\n\n<p>However, some of my stock (non-custom) rules are basically of the form \"run this big opaque proprietary external script with this input and hope for the best\"; and there can be extra files used by the external script depending on its input. For example, imagine I have a rule of the following form:</p>\n\n<pre><code>\"_build/output.bin\" %&gt; out -&gt; do\n    need [\"_build/script.scr\", \"_build/src/generated.src\"]\n    runExternalScript\n</code></pre>\n\n<p>For a particular client project, maybe the generated source code contains references to another file <code>_build/src/extrainput.src</code>. So in the custom rules passed to <code>mainFor</code>, not only do I need extra rules for this file, but the existing rule should also be modified to mark that it <code>need</code>s this input:</p>\n\n<pre><code>main = mainFor $ do\n    \"_build/src/extrainput.src\" %&gt; \\out -&gt; do\n       generateExtraSrc\n\n    \"_buld/output.bin\" %&gt; \\out -&gt; do\n      need [\"_build/src/extrainput.src\"]\n</code></pre>\n\n<p>but this, unsurprisingly, fails because both the stock rule in <code>mainFor</code> and the second custom  rule passed in the <code>customRules</code> argument are for the same target. <strong>Note that I do not want to fully override the stock rule, only extend it to add the extra dependency.</strong></p>\n"}, {"tags": ["haskell", "quickcheck", "doctest", "nix", "nixos"], "answers": [{"tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": false, "score": 1, "last_activity_date": 1537777011, "creation_date": 1537777011, "answer_id": 52475150, "question_id": 52471822, "link": "https://stackoverflow.com/questions/52471822/how-to-override-doctest-to-use-my-ghc/52475150#52475150", "title": "How to override `doctest` to use my `ghc`?", "body": "<p>Haskell derivations are not suitable as <code>nix-shell</code> environments by themselves.</p>\n\n<p>The Nixpkgs manual <a href=\"https://nixos.org/nixpkgs/manual/index.html#how-to-create-ad-hoc-environments-for-nix-shell\" rel=\"nofollow noreferrer\">recommends</a> creating a derivation for the purpose of a <code>nix-shell</code> only, using a <code>ghcWithPackages</code> invocation as a dependency.</p>\n\n<p>If the file you're trying to run is part of a haskell package, you can <a href=\"https://nixos.org/nixpkgs/manual/index.html#how-to-build-a-stand-alone-project\" rel=\"nofollow noreferrer\">use <code>cabal2nix</code></a> to do most of the work for you.</p>\n\n<p>I recommend the latter, because it does not pollute your user-wide state (whether profile or user-specific overlay), it is easier to share with others and provides structure that is sufficient to scale from toy example to a valuable package.</p>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 3174781, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c085ae4fa8b80c0d024386f5194806b?s=128&d=identicon&r=PG", "display_name": "Theo Sherry", "link": "https://stackoverflow.com/users/3174781/theo-sherry"}, "is_accepted": false, "score": 0, "last_activity_date": 1613075146, "creation_date": 1613075146, "answer_id": 66162285, "question_id": 52471822, "link": "https://stackoverflow.com/questions/52471822/how-to-override-doctest-to-use-my-ghc/66162285#66162285", "title": "How to override `doctest` to use my `ghc`?", "body": "<p>I had the same problem trying to get my nix/haskell dev environment set up and found a solution in this <a href=\"https://www.reddit.com/r/haskell/comments/4bci4o/nixpkgshaskellpackages_are_not_visible_to_ghc_and/d1a617e/\" rel=\"nofollow noreferrer\">reddit post</a>. To get <code>doctest</code> to use a specific version of <code>ghc</code> you can set the environment variable <code>NIX_GHC</code>:</p>\n<pre><code>$ doctest --version\ndoctest version 0.16.3\nusing version 8.10.3 of the GHC API\nusing /nix/store/9bm9bs9c4zpl17zdk1d0azid44x3h99b-ghc-8.10.3/bin/ghc-8.10.3\n\n$ export NIX_GHC=/nix/store/zvx9dmfqaa8wibygkbibg4kl98pfj9qv-ghc-8.10.3-with-packages/bin/ghc\n$ doctest --version\ndoctest version 0.16.3\nusing version 8.10.3 of the GHC API\nusing /nix/store/zvx9dmfqaa8wibygkbibg4kl98pfj9qv-ghc-8.10.3-with-packages/bin/ghc\n</code></pre>\n"}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1613075146, "creation_date": 1537753876, "question_id": 52471822, "link": "https://stackoverflow.com/questions/52471822/how-to-override-doctest-to-use-my-ghc", "title": "How to override `doctest` to use my `ghc`?", "body": "<p>I have problem using <code>doctest</code> with <code>QuickCheck</code> on <code>NixOS</code></p>\n\n<pre><code>-- code.hs\n--\n-- $setup\n-- &gt;&gt;&gt; import Test.QuickCheck\n--\n-- |\n-- This test will pass\n-- &gt;&gt;&gt; 1 + 1\n-- 2\n--\n-- This test use QuickCheck\n-- prob&gt; \\xs -&gt; reverse xs = reverse . id $ xs\n--\n-- The last test will fail to ensure doctest was running\n-- &gt;&gt;&gt; 1 == 0\n-- True\n--\n\nmain :: IO ()\nmain = pure ()\n</code></pre>\n\n<p>The default <code>haskellPackages.doctest</code> doesn't include <code>QuickCheck</code></p>\n\n<pre><code>$ nix-shell -p haskellPackages.doctest --run 'doctest code.hs'\ncode.hs:4: failure in expression `import Test.QuickCheck'\nexpected:\n but got:\n          &lt;no location info&gt;: error:\n              Could not find module \u2018Test.QuickCheck\u2019\n              It is not a module in the current program, or in any known package.\n\nExamples: 3  Tried: 1  Errors: 0  Failures: 1\n</code></pre>\n\n<p>so I try to make an overrride version as <code>mydoctest</code></p>\n\n<pre><code># ~/.config/nixpkgs/overlays/doctest.nix\n\nself: super:\nwith super.haskellPackages;\nlet\n  myghc = ghcWithPackages (p: with p;\n          [\n            QuickCheck\n          ]);\nin\n{\n  mydoctest = doctest.override {\n    ghc = myghc;\n  };\n}\n</code></pre>\n\n<p>It still can't find <code>QuickCheck</code></p>\n\n<pre><code>$ nix-shell -p mydoctest --run 'doctest code.hs'\ncode.hs:4: failure in expression `import Test.QuickCheck'\nexpected:\n but got:\n          &lt;no location info&gt;: error:\n              Could not find module \u2018Test.QuickCheck\u2019\n              It is not a module in the current program, or in any known package.\n\nExamples: 3  Tried: 1  Errors: 0  Failures: 1\n</code></pre>\n\n<p>but it work if I call it via ghc</p>\n\n<pre><code>$ nix-shell -p mydoctest --run 'ghc -e \":!doctest code.hs\"'\ncode.hs:15: failure in expression `1 == 0'\nexpected: True\n but got: False\n\nExamples: 3  Tried: 3  Errors: 0  Failures: 1\n</code></pre>\n\n<p><code>myghc</code> is there but didn't use by <code>mydoctest</code></p>\n\n<pre><code>$ nix-shell -p mydoctest --run 'doctest --version'\ndoctest version 0.16.0\nusing version 8.4.3 of the GHC API\nusing /nix/store/g1dj8c6h6g8rbb8cv9bgmp1h2f3bxk1l-ghc-8.4.3-with-packages/bin/ghc\n\n$ nix-shell -p mydoctest --run 'which ghc'\n/nix/store/qj3vnm903p77nxiraxqxm9b8gbz5rpia-ghc-8.4.3-with-packages/bin/ghc\n</code></pre>\n\n<p>How can I make <code>doctest</code> to use my override <code>ghc</code> ?</p>\n"}, {"tags": ["haskell", "monads", "ioref"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1537720299, "post_id": 52467957, "comment_id": 91877945, "body": "<a href=\"https://stackoverflow.com/questions/1931875/when-is-it-ok-to-use-an-ioref\">Related</a>, though I wouldn&#39;t call it a dup."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1537723236, "post_id": 52467957, "comment_id": 91878838, "body": "I&#39;ve probably only used IORef in situations involving concurrency. Yes, it would be bad to use an IORef just so you could write code in an imperative style. MVar and the STM vars are great, but if IORef does what you need there&#39;s nothing wrong with using it."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537728832, "post_id": 52467957, "comment_id": 91880443, "body": "I&#39;m guessing that paper is on concurrency? I&#39;ve not really seen IORef outside of concurrency applications, as pointed out above."}, {"owner": {"reputation": 311, "user_id": 5803465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7346402b78bdd223b92798bef605773c?s=128&d=identicon&r=PG&f=1", "display_name": "user5803465", "link": "https://stackoverflow.com/users/5803465/user5803465"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1537802846, "post_id": 52467957, "comment_id": 91906638, "body": "@AJFarmar The paper is about using type theory in the field of software security."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 11, "last_activity_date": 1537733579, "creation_date": 1537733579, "answer_id": 52469879, "question_id": 52467957, "link": "https://stackoverflow.com/questions/52467957/ioref-in-haskell/52469879#52469879", "title": "IORef in Haskell", "body": "<p>First off, I think that for code snippets in a paper, using <code>IORef</code> is perfectly sensible, particularly if the paper isn't <em>about</em> best practices for mutable references or concurrency.  <code>IORef</code> is simple to understand, has straightfoward syntax and semantics (especially in a non-concurrent setting), and is a natural choice if you want the reader to concentrate on aspects of your examples other than the <code>IORef</code>s.  It's unfortunate that the author's approach has backfired for you -- just ignore the <code>IORef</code>s and pay attention to what the rest of what the paper is saying.</p>\n\n<p>(If the paper <em>was</em> about best practices for mutable references or concurrency, perhaps it was written before better alternatives were available.)</p>\n\n<p>Anyway, to your larger question, the main objections to using <code>IORef</code> would be:</p>\n\n<ul>\n<li>Like any other mechanism for introducing mutable state into your program, it makes your code more difficult to reason about, maintain, test, etc. -- all the usual things that functional programming proponents would say give FP an \"edge\" over mutation-intensive imperative algorithms.</li>\n<li>It's just a newtype wrapper around a specialized <code>STRef RealWorld</code>, and the only thing it adds over <code>STRef</code> are some atomic operations.  In non-concurrent code, there's no good reason not to use <code>STRef s</code> values in an <code>ST s</code> monad, since they're more flexible -- you can run them in pure code with <code>runST</code> or, if needed, in the IO monad with <code>stToIO</code>.</li>\n<li>In concurrent code, there are more powerful abstractions, like <code>MVar</code> and <code>STM</code> that are much easier to work with than <code>IORef</code>s.</li>\n</ul>\n\n<p>So, to the extent that mutable state is \"bad\" and -- if you really need it -- better alternatives are available depending on whether you do or don't need concurrency, there's not much to recommend <code>IORef</code>.</p>\n\n<p><strong>On the other hand,</strong> if you are already working on some non-concurrent code in the <code>IO</code> monad because you need to perform actual IO operations, and you genuinely need some pervasive mutable state that isn't easy to disentangle from the IO, then using <code>IORef</code>s seems legitimate.</p>\n\n<p>With respect to your more specific questions:</p>\n\n<ol>\n<li><p>I guess it would be safe to say that using <code>IORef</code> is considered \"bad practice\" when a <a href=\"https://stackoverflow.com/questions/20439316/when-to-use-stref-or-ioref\">weaker tool would do the job</a>.  That weaker tool might be an <code>STRef s</code>, or better yet a <code>State</code> monad or better yet a rewritten higher-order algorithm that doesn't need any state at all.  Because <code>IORef</code> combines IO with mutable references, it's kind of an imperative sledgehammer that's likely to lead to the most unidiomatic Haskell code possible, so it's best avoided unless it's \"obviously\" the right solution for a particular problem.</p></li>\n<li><p>The <code>State</code> monad is usually the preferred idiomatic way to add state to a program, but it provides the \"illusion\" of a mutable state by threading a sequence of immutable state values through the computation, and not all algorithms can be efficiently implemented this way.  Where true mutable state is required, an <code>STRef</code> is usually the natural choice in a non-concurrent setting.  Note that you probably wouldn't use <code>MVar</code> or <code>STM</code> in a non-concurrent setting -- there's no reason to use them in this case, and they would force you into the <code>IO</code> monad even if you didn't otherwise need it.  </p></li>\n<li><p>Yes, there are programming scenarios where either <code>IORef</code> or <code>STRef</code> are  preferable to <code>State</code>, <code>STM</code>, <code>MVar</code>, or pure <code>IO</code> (see below).  There are few scenarios where <code>IORef</code> is obviously preferable to <code>STRef</code>, but -- as mentioned above -- if you're already in the <code>IO</code> monad and have a need for true mutable state that's entangled with IO operations, then <code>IORef</code> probably has the edge over <code>STRef</code> in terms of slightly cleaner syntax.</p></li>\n</ol>\n\n<p>Some examples of cases where either <code>IORef</code> or <code>STRef</code> is a good approach:</p>\n\n<ul>\n<li><code>Data.Unique</code> in the <code>base</code> package uses an <code>IORef</code> as a global counter for generating unique objects.</li>\n<li>In the <code>base</code> library, the file handle internals make extensive use of <code>IORef</code>s for attaching buffers to handles.  This is a good example of \"already being in the IO monad with entangled IO operations\".</li>\n<li>Many vector algorithms are most efficiently implemented using mutable vectors (e.g., even something as simple as counting byte frequencies in a block of data).  If you use mutable vectors from the <code>vector</code> package, then technically you're using mutable byte arrays rather than <code>STRef</code> or <code>IORef</code>, but it's still morally equivalent.</li>\n<li>The <code>equivalence</code> package uses <code>STRef</code>s for an efficient implementation of the union-join algorithm.</li>\n<li>As a somewhat on-the-nose example, if you're implementing an interpreter for an imperative language, then using <code>IORef</code> or <code>STRef</code> values for the mutable variables is generally going to be most efficient.</li>\n</ul>\n"}], "owner": {"reputation": 311, "user_id": 5803465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7346402b78bdd223b92798bef605773c?s=128&d=identicon&r=PG&f=1", "display_name": "user5803465", "link": "https://stackoverflow.com/users/5803465/user5803465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1523, "favorite_count": 2, "accepted_answer_id": 52469879, "answer_count": 1, "score": 11, "last_activity_date": 1537733579, "creation_date": 1537719201, "question_id": 52467957, "link": "https://stackoverflow.com/questions/52467957/ioref-in-haskell", "title": "IORef in Haskell", "body": "<p>I was wondering if there was a legitimate usage for <strong>IORef</strong> in Haskell? More specifically I would be thankful if someone could address the following or point to an appropriate place to know more about this:</p>\n\n<ol>\n<li>Is using IORef considered a bad Haskell practice? If yes, why? More specifically how is it better or worse than an IO monad?</li>\n<li><p>If one was looking to add state to a program, isn't state monad a better (purer) way to do it. If one was feeling more imperative couldn't he still use STM, and MVar, and still be better off?</p></li>\n<li><p>Are there programming scenarios that are easily handled using IORefs rather than STM, MVar, or the pure IO?  </p></li>\n</ol>\n\n<p>I am reading a paper that uses IORef for the code snippets, and it has been difficult read for me owing to the negative perception I have towards IORef. Rather than wallow in my ignorance, I thought asking my fellow Haskellers for help might be a better idea. </p>\n"}, {"tags": ["list", "haskell", "types"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537702862, "post_id": 52465399, "comment_id": 91873146, "body": "If you want to make &#39;lists&#39; like this, consider <code>data NestList a = Elem a | Nest [a]</code>, then you can write <code>Nest [ Nest [], Nest [ Nest [] ] ]</code> to any depth."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1537741974, "post_id": 52465399, "comment_id": 91883638, "body": "@AJFarmar perhaps you meant <code>data NestedList a = Elem a | Nest [NestedList a]</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1537771345, "post_id": 52465399, "comment_id": 91889407, "body": "@WillNess You&#39;re right, I can&#39;t change it now though!"}], "answers": [{"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 7, "last_activity_date": 1537708645, "last_edit_date": 1537708645, "creation_date": 1537700280, "answer_id": 52465426, "question_id": 52465399, "link": "https://stackoverflow.com/questions/52465399/list-of-nested-empty-lists-in-haskell/52465426#52465426", "title": "list of nested empty lists in Haskell", "body": "<p>You are right, that in a Haskell list, all elements must be of the same type. And indeed, the type in your example is:</p>\n\n<pre><code>&gt; :t slist\nslist :: [[[[a]]]]\n</code></pre>\n\n<p>But the empty list <code>[]</code> can have any type, as long as it's of the form <code>[b]</code>, but there are many possible <code>b</code>s. So there are many possible concrete types. One of them is for <code>b</code> to be of type <code>[[[a]]]</code>, as in your <code>slist</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1537717937, "post_id": 52465451, "comment_id": 91877299, "body": "we could stress that this is only possible because of the use of <i>several</i>  literal <code>[]</code>s, but if we&#39;d try <code>let s=[[], [[]]] in [s, [s], [[s]]]</code> then it couldn&#39;t ... possibly ...... wait ..... nah, it <i>also works!</i> :) Because <code>s</code> is not &quot;a thing&quot;, but &quot;a <i>polymorphic</i> definition&quot;! What really doesn&#39;t work is <code>(\\s -&gt; [s, [s], [[s]]]) [[], [[]]]</code> because lambda function&#39;s parameter type is monomorphic."}], "tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": false, "score": 6, "last_activity_date": 1537700443, "creation_date": 1537700443, "answer_id": 52465451, "question_id": 52465399, "link": "https://stackoverflow.com/questions/52465399/list-of-nested-empty-lists-in-haskell/52465451#52465451", "title": "list of nested empty lists in Haskell", "body": "<p>Take a look at type of the first element of such a list:</p>\n\n<pre><code>&gt; head [ [], [[]], [[],[[]]] ]\n[]\nit :: [[[t]]]\n</code></pre>\n\n<p>It's not <code>t</code>, but it's <code>[[[t]]]</code>. </p>\n\n<blockquote>\n  <p>Why I can possibility to make in Haskell such list</p>\n</blockquote>\n\n<p>Because the is nothing wrong with the type of this expression.</p>\n\n<blockquote>\n  <p>What is wrong? Why does Haskell consider them to be the same type?</p>\n</blockquote>\n\n<p><code>t</code> in the <code>[[[[t]]]]</code> is not a final type, it's type variable. That's why the type of the first element of this list could be <code>a</code> or <code>[b]</code> or <code>[[c]]</code> or <code>[[[t]]]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1537701006, "post_id": 52465460, "comment_id": 91872695, "body": "@Vladimir What do you mean? I just copy-and-pasted the list from your question and named the empty lists."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1537701109, "post_id": 52465460, "comment_id": 91872720, "body": "<code>slist</code> has  only 3 elements, see <code>length slist</code>"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 1, "creation_date": 1537701344, "post_id": 52465460, "comment_id": 91872774, "body": "@Vladimir I was labeling the empty lists, not the elements of <code>slist</code>. I&#39;ve added some spaces to make this clearer."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1537701581, "post_id": 52465460, "comment_id": 91872828, "body": "then why do you use two letters (a and c) for empty list in one record?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1537701837, "post_id": 52465460, "comment_id": 91872896, "body": "@Vladimir Because the different empty lists have different types here. For example the type of <code>a</code> is equal to the type of <code>[b]</code> (but notably not the type of <code>b</code>). So the elements of the list all have the same type because the individual empty lists don&#39;t."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1537701369, "last_edit_date": 1537701369, "creation_date": 1537700512, "answer_id": 52465460, "question_id": 52465399, "link": "https://stackoverflow.com/questions/52465399/list-of-nested-empty-lists-in-haskell/52465460#52465460", "title": "list of nested empty lists in Haskell", "body": "<p>An empty list can be a list of any type. It can be a list of numbers, a list of strings, or a list of lists. I mean, why wouldn't you be allowed to have an empty list of lists or even an empty list of lists of lists?</p>\n\n<p>So in your list:</p>\n\n<pre><code>--a     b       c     d\n[ [], [ [] ], [ [], [ [] ] ] ]\n</code></pre>\n\n<p><code>d</code> is an empty list, <code>c</code> is an empty list of lists, <code>b</code> is an empty list of lists of lists and <code>a</code> is an empty list of lists of lists of lists.</p>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 797, "favorite_count": 0, "accepted_answer_id": 52465426, "answer_count": 3, "score": 12, "last_activity_date": 1537760473, "creation_date": 1537700044, "last_edit_date": 1537760473, "question_id": 52465399, "link": "https://stackoverflow.com/questions/52465399/list-of-nested-empty-lists-in-haskell", "title": "list of nested empty lists in Haskell", "body": "<p>Why is it possible to make such a list in Haskell:</p>\n\n<pre><code>slist = [ [], [[]], [[],[[]]] ]\n</code></pre>\n\n<p>As far I understand, every element has various types here (like in mathematics: \u00d8, {\u00d8} and so on). And ghci says:</p>\n\n<pre><code>&gt; :t []\n[] :: [t]\n&gt; :t [[]]\n[[]] :: [[t]]\n</code></pre>\n\n<p>formally, I see different notes. </p>\n\n<p>In other words, the first element is a simple empty list and the second one is a list of list (!) and so on.</p>\n\n<p>What is wrong? Why does Haskell consider them to be the same type?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537701312, "post_id": 52464705, "comment_id": 91872764, "body": "Bind should not simplify, or the two identity laws (<code>return x &gt;&gt;= f = f x</code> and <code>m &gt;&gt;= return = m</code>) will not hold."}, {"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537730022, "post_id": 52464705, "comment_id": 91880749, "body": "@DanielWagner That depends on how you define equivalence on expressions (although arguably if you have a simplifying bind you need to have a simplifying show). There are Monads where the laws only hold &quot;morally&quot;, like the QuickCheck Gen monad."}], "tags": [], "owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "is_accepted": false, "score": 1, "last_activity_date": 1537694149, "creation_date": 1537694149, "answer_id": 52464705, "question_id": 52464397, "link": "https://stackoverflow.com/questions/52464397/what-math-operations-does-this-abstraction-of-expression-support/52464705#52464705", "title": "What math operations does this abstraction of expression support?", "body": "<p>Substitution is pretty much what bind does, but that's a pretty useful tool. For instance you can make a function that eliminates all variables by lookups in an [(a,Int)] (and an extra Int as default value if the variable is not in the list). </p>\n\n<p>I suppose the Monad instance could be made to do other stuff, for instance if it simplifies the expression when it rebuilds Add's (so Add (Val x) (Val y) is reduced to Val (x+y)), the function I mentioned above would always reduce the result to (Val n). Not sure you want to do that though. </p>\n\n<p>The Applicative instance does not let you do anything you can not already do with the Monad instance (prove this by implementing &lt;*> using >>= and pure).</p>\n"}, {"comments": [{"owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 0, "creation_date": 1537777793, "post_id": 52468468, "comment_id": 91892112, "body": "I must admit I find it very surprising that these are all about substitution, which is the first thing that came to mind when considering the functor instance. It is possible to do all kinds of weird operations, such as Cartesian product -like <code>do { v1 &lt;- expr; v2 &lt;- expr; pure $ v1 : &#39;_&#39; : v2 : [] }</code>, but I failed to find a sensible mathematical application for these. Thanks!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1537722793, "creation_date": 1537722793, "answer_id": 52468468, "question_id": 52464397, "link": "https://stackoverflow.com/questions/52464397/what-math-operations-does-this-abstraction-of-expression-support/52468468#52468468", "title": "What math operations does this abstraction of expression support?", "body": "<p>The applicative instance corresponds to substituting for variables where the <code>Expr</code>-level structure of the substitution doesn't depend on the variable.  For example, if you were processing this expression in the context of a linear programming problem and wanted to replace each variable <code>Var 'x'</code> with a sum of two variables, one which is always positive and one which is always negative, you could write:</p>\n\n<pre><code>&gt; import Control.Applicative\n&gt; expr &lt;**&gt; Add (Var (:\"pos\")) (Var (:\"neg\"))\nAdd (Add (Add (Var \"xpos\") (Var \"xneg\")) \n   (Add (Var \"ypos\") (Var \"yneg\"))) \n   (Add (Add (Var \"xpos\") (Var \"xneg\")) (Val 1))\n&gt;\n</code></pre>\n\n<p>The key here is that every variable is replaced with the same template <code>Add (Var \"_pos\") (Var \"_neg\")</code> where the new variables in the template have names that can depend on the original variable name.  That's what makes this operation applicative.</p>\n\n<p>As an aside, note that substituting a <code>Val Int</code> for each <code>Var Char</code> isn't an applicative operation unless the <em>same</em> value is substituted for each variable -- the value of the <code>Int</code> is part of the <code>Expr</code>-level structure and can't depend on the variable name.</p>\n\n<p>Because the monad instance can replace variables with an <code>Expr</code> that depends on the variable name, it can perform more general substitutions.</p>\n\n<p>Ultimately, the Functor instance allows you to change variable names, the Monad instance allows you to substitute variables with arbitrary expressions, and the Applicative instance provides a limited sort of template substitution that just isn't very interesting or useful for this particular data structure.</p>\n\n<p>That's really all they can do, though there is one generalization that you touched on with your failed attempt to use the Functor instance to substitute values.  These instances can change the type from <code>Expr Char</code> to some other <code>Expr b</code>.  For example, if you were compiling an expression to a bytecode that referenced variables by memory pointers, then suddenly variable \"renaming\" via the Functor becomes a little more interesting:</p>\n\n<pre><code>type Location = Int\nsymtab :: [(Char, Int)]\nsymtab = [('x', 4096), ('y', 4100)]  -- memory addresses\n\n&gt; fmap (fromJust . flip lookup symtab) expr\nAdd (Add (Var 4096) (Var 4100)) (Add (Var 4096) (Val 1))\n&gt; \n</code></pre>\n"}], "owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 52468468, "answer_count": 2, "score": 2, "last_activity_date": 1537722793, "creation_date": 1537691557, "question_id": 52464397, "link": "https://stackoverflow.com/questions/52464397/what-math-operations-does-this-abstraction-of-expression-support", "title": "What math operations does this abstraction of expression support?", "body": "<p>A famous Haskell book has an exercise (spoiler alert) that asks to write functor, applicative and monad instances for a simplified data type of mathematical expressions. And no, this is not my homework for a course.</p>\n\n<p>The following typechecks:</p>\n\n<pre><code>data Expr a = Var a | Val Int | Add (Expr a) (Expr a) deriving Show\n\ninstance Functor Expr where\n  fmap f (Var x) = Var $ f x\n  fmap f (Add e1 e2) = Add (fmap f e1) (fmap f e2)\n  fmap _ (Val x) = Val x\n\ninstance Applicative Expr where\n  pure x = Var x\n  (Val x) &lt;*&gt; _ = Val x\n  (Var f) &lt;*&gt; e = f &lt;$&gt; e\n  (Add f g) &lt;*&gt; e = Add (f &lt;*&gt; e) (g &lt;*&gt; e)\n\ninstance Monad Expr where\n  return = pure\n  (Val x) &gt;&gt;= _ = Val x\n  (Var x) &gt;&gt;= f = f x\n  (Add e1 e2) &gt;&gt;= f = Add (e1 &gt;&gt;= f) (e2 &gt;&gt;= f)\n</code></pre>\n\n<p>However, the last part of the question asks to explain what bind does in this case, with an example. I think an even better question would be: what kinds of useful operations can you do with these abstractions? So I started to consider this, with the following expression:</p>\n\n<pre><code>expr :: Expr Char\nexpr = Add (Add (Var 'x') (Var 'y')) (Add (Var 'x') (Val 1))\n</code></pre>\n\n<p>The functor instance allows me to substitute a different name for a variable:</p>\n\n<pre><code>\u03bb&gt; (\\v -&gt; if v == 'x' then 't' else v) &lt;$&gt; expr\nAdd (Add (Var 't') (Var 'y')) (Add (Var 't') (Val 1))\n</code></pre>\n\n<p>But using it to substitute values for variables doesn't really seem to work:</p>\n\n<pre><code>\u03bb&gt; (\\v -&gt; if v == 'x' then 2 else 3) &lt;$&gt; expr\nAdd (Add (Var 2) (Var 3)) (Add (Var 2) (Val 1))\n</code></pre>\n\n<p>Here, however, the monad comes to the rescue:</p>\n\n<pre><code>\u03bb&gt; expr &gt;&gt;= (\\v -&gt; Val (if v == 'x' then 2 else 3))\nAdd (Add (Val 2) (Val 3)) (Add (Val 2) (Val 1))\n</code></pre>\n\n<p>With the help of the monad, it seems even possible to substitute expressions for a variable, here <code>t+2</code> is substituted for <code>x</code>:</p>\n\n<pre><code>\u03bb&gt; expr &gt;&gt;= (\\v -&gt; if v == 'x' then Add (Var 't') (Val 2) else pure v)\nAdd (Add (Add (Var 't') (Val 2)) (Var 'y')) (Add (Add (Var 't') (Val 2)) (Val 1))\n</code></pre>\n\n<p>But what else? What would be meaningful uses of the applicative? What other useful operations could we do with the monad?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1537699436, "post_id": 52463923, "comment_id": 91872311, "body": "Does this also fetch all dependencies of <code>acme-missiles</code>?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1537718659, "post_id": 52463923, "comment_id": 91877517, "body": "Yup.  It should go through the process of downloading everything needed to build the indicated package but without actually compiling."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1537687100, "creation_date": 1537687100, "answer_id": 52463923, "question_id": 52463081, "link": "https://stackoverflow.com/questions/52463081/how-to-download-packages-without-compiling-installing-them/52463923#52463923", "title": "How to download packages without compiling/installing them?", "body": "<p>I think you probably want a combination of the <code>--prefetch</code> and <code>--dry-run</code> flags.  For example, the following command:</p>\n\n<pre><code>stack build --prefetch --dry-run acme-missiles\n</code></pre>\n\n<p>downloads the <code>acme-missiles-0.3.tar.gz</code> source file without building it.  If you later run <code>stack build acme-missiles</code>, it should configure and build it from the previously downloaded source.</p>\n"}, {"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1537699453, "post_id": 52463941, "comment_id": 91872315, "body": "would you happen to know the difference between <code>stack build --prefetch</code> and <code>stack unpack</code>?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1537699717, "post_id": 52463941, "comment_id": 91872365, "body": "I tried this, and it seems to be unpacking the packages&#39; source to the current directory. Not what I wanted."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 0, "last_activity_date": 1537687240, "creation_date": 1537687240, "answer_id": 52463941, "question_id": 52463081, "link": "https://stackoverflow.com/questions/52463081/how-to-download-packages-without-compiling-installing-them/52463941#52463941", "title": "How to download packages without compiling/installing them?", "body": "<p>If you want to download sources of the package locally you can use <code>stack unpack</code> command:</p>\n\n<pre><code>stack unpack typerep-map-0.3.0\n</code></pre>\n\n<p>The same can be done with <code>cabal-install</code> as well but with <code>cabal get</code> command:</p>\n\n<pre><code>cabal get typerep-map-0.3.0\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 52463923, "answer_count": 2, "score": 1, "last_activity_date": 1537699483, "creation_date": 1537678139, "last_edit_date": 1537699483, "question_id": 52463081, "link": "https://stackoverflow.com/questions/52463081/how-to-download-packages-without-compiling-installing-them", "title": "How to download packages without compiling/installing them?", "body": "<p>Is there any command-line switch to <code>stack</code> that tells it to download all relevant packages without compiling/installing anything?</p>\n"}, {"tags": ["list", "haskell", "append", "tuples"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1537683736, "post_id": 52462852, "comment_id": 91869042, "body": "I am on the phone so can&#39;t give a proper answer, but what you want is <code>map (append (&quot;String&quot;, &quot;String&quot;, 0.0))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1537734428, "post_id": 52463810, "comment_id": 91881931, "body": "<code>(x :)</code> is simpler"}], "tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": false, "score": 2, "last_activity_date": 1537686608, "last_edit_date": 1537686608, "creation_date": 1537686173, "answer_id": 52463810, "question_id": 52462852, "link": "https://stackoverflow.com/questions/52462852/haskell-how-do-i-append-to-a-list-of-list-of-tuples/52463810#52463810", "title": "Haskell: How do I append to a list of list of tuples?", "body": "<p>Type of <code>[[(\"String\", \"String\", 2.0)],[(\"String\", \"String\", 2.0),(\"String\", \"String\", 2.0)]]</code> is <code>Fractional t =&gt; [[(String, String, t)]]</code>, or to simplify <code>[[(String, String, Double)]]</code>.</p>\n\n<p>So, it order to append the element to every nested list, we need to have a function <code>(String, String, Double) -&gt; [[(String, String, Double)]] -&gt; [[(String, String, Double)]]</code>. In other words, <code>a -&gt; [[a]] -&gt; [[a]]</code>:</p>\n\n<pre><code>append :: a -&gt; [[a]] -&gt; [[a]]\nappend x xs = map (\\xss -&gt; xss ++ [x]) xs\n</code></pre>\n\n<p>And finally</p>\n\n<pre><code>&gt; append (\"String\",\"String\",0.0) [[(\"String\", \"String\", 2.0)],[(\"String\", \"String\", 2.0),(\"String\", \"String\", 2.0)]]\n[[(\"String\",\"String\",2.0),(\"String\",\"String\",0.0)],[(\"String\",\"String\",2.0),(\"String\",\"String\",2.0),(\"String\",\"String\",0.0)]]\n</code></pre>\n\n<p>By the way, note that adding elements to the end of the list is O(n), thus  you might consider to add it to the beginning:</p>\n\n<pre><code>append' :: a -&gt; [[a]] -&gt; [[a]]\nappend' x = map ((:) x)\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 10389247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1eb0398873278aff7a0a5055f3375c8?s=128&d=identicon&r=PG&f=1", "display_name": "Natti", "link": "https://stackoverflow.com/users/10389247/natti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1013, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537686608, "creation_date": 1537674985, "question_id": 52462852, "link": "https://stackoverflow.com/questions/52462852/haskell-how-do-i-append-to-a-list-of-list-of-tuples", "title": "Haskell: How do I append to a list of list of tuples?", "body": "<p>Sorry, I just started learning Haskell. I don't understand how to append a tuple to each sublist.</p>\n\n<p>My current list is:</p>\n\n<pre><code>[[(\"String\", \"String\", 2.0)],[(\"String\", \"String\", 2.0),(\"String\", \"String\", 2.0)]]\n</code></pre>\n\n<p>I want to add a tuple in each sublist so my new list is:</p>\n\n<pre><code>[[(\"String\", \"String\", 2.0),(\"String\",\"String\",0.0)],[(\"String\", \"String\", 2.0),(\"String\", \"String\", 2.0),(\"String\",\"String\",0.0)]]\n</code></pre>\n\n<p>I am trying to write a function but it keeps on giving me an error</p>\n\n<pre><code>append :: a -&gt; [a] -&gt; [a]\nappend i (x:xs) = x : append i xs\nappend i [] = i : []\n</code></pre>\n\n<p>Then I do:</p>\n\n<pre><code>map append (\"String\",\"String\",0.0)\n</code></pre>\n\n<p>This gives me a lot of errors like incorrect \"type-matching\". I am not sure how to append in Haskell.</p>\n"}, {"tags": ["list", "haskell", "tuples", "fold"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1537666325, "post_id": 52462190, "comment_id": 91866698, "body": "What is the error that you see?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1537670695, "post_id": 52462190, "comment_id": 91867272, "body": "Looks like yet another variant of <a href=\"https://stackoverflow.com/q/12398458/791604\">group similar items in a list</a>... but I&#39;m not certain enough to close as a dupe, because the grouping step appears to already be done, and only the combination step remains. Even so I&#39;d still probably end up using the code I suggested at the linked question unless the grouping that precedes this question had somehow been done in better than O(n log n) time."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537721860, "post_id": 52462190, "comment_id": 91878407, "body": "all you need is <code>map</code>, and <code>map f = foldr ((:) . f) []</code>."}, {"owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537752277, "post_id": 52462190, "comment_id": 91885289, "body": "@WillNess this doesn&#39;t detail how to combine the elements."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "edited": false, "score": 0, "creation_date": 1537777550, "post_id": 52462190, "comment_id": 91892011, "body": "@TheInternet <i>small</i> steps... either the OP would get to the solution from that little hint, or they can always ask for clarifications. :)"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537721724, "post_id": 52462274, "comment_id": 91878371, "body": "doing O(n log n) when O(n) is possible, is not generally a recommended thing. the groups are already there, and you propose to destroy them and then go to work to recreate them."}, {"owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537728566, "post_id": 52462274, "comment_id": 91880364, "body": "We could use a mutable hash table to get O(n), but yes <code>Map</code> insertion is logarithmic."}, {"owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537735363, "post_id": 52462274, "comment_id": 91882167, "body": "Also, to be clear, the values themselves aren&#39;t actually destroyed, GHC will share them. @WillNess"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537741116, "post_id": 52462274, "comment_id": 91883488, "body": "<code>concat</code> &#39;destroys&#39; the <i>groups</i>, as in, forgets the <i>grouping</i>."}, {"owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537749633, "post_id": 52462274, "comment_id": 91884853, "body": "@WillNess the grouping isn&#39;t necessary to solve the problem. Plus, the OP made it clear he wanted to combine the lists based on name irrespective of grouping."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537777425, "post_id": 52462274, "comment_id": 91891959, "body": "they did, but it looks like it was an error on their part. the grouping of course is essential, either explicit in the list (as shown in the question) or implicit in the Map (as in your answer)."}], "tags": [], "owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "is_accepted": false, "score": 1, "last_activity_date": 1537711280, "last_edit_date": 1537711280, "creation_date": 1537666976, "answer_id": 52462274, "question_id": 52462190, "link": "https://stackoverflow.com/questions/52462190/haskell-how-do-i-combine-a-list-of-list-of-tuples-using-foldr/52462274#52462274", "title": "Haskell: How do I combine a list of list of tuples using foldr?", "body": "<p>First I would flatten your list (use <code>concat</code>), then accumulate the values into a <code>Map</code> recursively. While accumulating, I would ensure that you upsert existing values with addition (this is what the <code>add</code> function does).</p>\n\n<pre><code>module Main where                                                                                                                                             \n\nimport           Data.List                                                                                                                                    \nimport qualified Data.Map  as M                                                                                                                               \n\nmain = print $ makeMap vals                                                                                                                                   \n\nmakeMap :: (Ord k, Num a, Num b) =&gt; [(a, k, b)] -&gt; M.Map k (a, b)                                                                                             \nmakeMap = foldl' go mempty                                                                                                                                    \n  where                                                                                                                                                       \n    go m (x,name,y) = M.insertWith add name (x,y) m                                                                                                           \n    add (a,b) (c,d) = (a+c,b+d)                                                                                                                               \n\nvals = concat [[(1, \"Bob J\", 4.0)],[(1, \"Bill J\", 2.5),(2,\"Bill J\", 2.7)]]   \n</code></pre>\n\n<p>Result is</p>\n\n<pre><code>\u03bb&gt; main                                                                                                                                                       \nfromList [(\"Bill J\",(3,5.2)),(\"Bob J\",(1,4.0))] \n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 10389247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1eb0398873278aff7a0a5055f3375c8?s=128&d=identicon&r=PG&f=1", "display_name": "Natti", "link": "https://stackoverflow.com/users/10389247/natti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 851, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537711280, "creation_date": 1537665702, "last_edit_date": 1537674437, "question_id": 52462190, "link": "https://stackoverflow.com/questions/52462190/haskell-how-do-i-combine-a-list-of-list-of-tuples-using-foldr", "title": "Haskell: How do I combine a list of list of tuples using foldr?", "body": "<p>I want to combine my list but I need to pass in a dummy initial value which is why I want to use 'foldr'.</p>\n\n<p>My current list is:</p>\n\n<pre><code>[[(1, \"Bob J\", 4.0)],[(1, \"Bill J\", 2.5),(2,\"Bill J\", 2.7)]]\n</code></pre>\n\n<p>I want to combine the list based on their names but I also need to do arithmetic when I am combining the number.</p>\n\n<p>My current code is:</p>\n\n<pre><code>grp xs = foldr combine xs\n  where\n    combine\n    (x,_,y)\n    (totalX,_,totalY)\n    = (totalX+x,_,totalY+fromIntegral x *y)\n</code></pre>\n\n<p>This returns an error. I want totalX and totalY to initially be zero so it doesn't mess with the calculations. How do I do this?</p>\n\n<p>Edit: I want my output to be in the same format so I want:</p>\n\n<p>[(1,\"Bob J\", 4.0],(3,\"Bill J\", 2.6)] </p>\n"}, {"tags": ["haskell", "functional-programming", "lazy-evaluation"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1537660074, "post_id": 52461791, "comment_id": 91865719, "body": "It doesn&#39;t matter what order its evaluated in, it&#39;s going to come out with the same answer."}, {"owner": {"reputation": 1004, "user_id": 1692517, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/893889b69fb20b6f02e3cb7a182e1c47?s=128&d=identicon&r=PG", "display_name": "user1692517", "link": "https://stackoverflow.com/users/1692517/user1692517"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537660402, "post_id": 52461791, "comment_id": 91865758, "body": "yes, but I&#39;m still required to show the order of evaluation for my work"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1537668117, "post_id": 52461791, "comment_id": 91866916, "body": "Can you clarify what exactly you&#39;re required to show?  What&#39;s the exact wording of the assignment as it pertains to showing the order of evaluation?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1537671123, "post_id": 52461791, "comment_id": 91867325, "body": "The answer to the only direct question you asked is &quot;No, you do not have the correct order of evaluation.&quot;. I&#39;m not sure I&#39;m comfortable writing down the correct order; could you please confirm that your course&#39;s rules on collaboration are okay with what you&#39;re doing here on SO? Or, more to the point: why are you asking here instead of asking your teacher(&#39;s assistant)?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1537704603, "post_id": 52461791, "comment_id": 91873557, "body": "You mention &quot;the correct order of evaluation that Haskell would use&quot;, but there&#39;s no mandated order by Haskell, only a mandated (lazy) semantics. Probably you intend to use the so-called &quot;normal evaluation order&quot;, which is one way to ensure lazy semantics. Even in such case, <code>x - y</code> could evaluate <code>x</code> before <code>y</code>, or in the other order. Maybe you are assuming left-to-right on arithmetic operators (?) It depends on what your course stated."}], "answers": [{"tags": [], "owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "is_accepted": false, "score": 3, "last_activity_date": 1537694518, "creation_date": 1537694518, "answer_id": 52464760, "question_id": 52461791, "link": "https://stackoverflow.com/questions/52461791/regarding-evaluation-order/52464760#52464760", "title": "Regarding evaluation order", "body": "<p>You can test your hypothesis by replacing subexpressions by <code>(error \"x\")</code>, <code>(error \"y\")</code>, etc. Whichever error is evaluated first is the one to show up when you run the expression.</p>\n"}, {"tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": false, "score": 0, "last_activity_date": 1537719149, "creation_date": 1537719149, "answer_id": 52467945, "question_id": 52461791, "link": "https://stackoverflow.com/questions/52461791/regarding-evaluation-order/52467945#52467945", "title": "Regarding evaluation order", "body": "<p>To the point, evaluation can proceed in any order the compiler wants it to, as long as it gets the correct answer. For example, it could optimize the entire expression to 23 and have no evaluation at all at runtime. It could evaluate the right side of arithmetic operators before the left side, except for subtraction. It could randomly decide at runtime which to evaluate first.</p>\n\n<p>Ignoring that, for an explanation of how to manually do the work, see <a href=\"https://hackhands.com/lazy-evaluation-works-haskell/\" rel=\"nofollow noreferrer\">\"How Lazy Evaluation Works in Haskell\"</a>.</p>\n\n<hr>\n\n<p>But how to manually figure it out is not the main point of this answer. Your question was what evaluation order Haskell would actually use, so this answer loosely intends to tell you the evaluation order your program uses when compiled with the compiler of your choice (ignoring some caveats that don't matter for basic understanding of evaluation order).</p>\n\n<p>With some work, we can have Haskell tell us what order it evaluates in. If you're in school, you probably want to learn how to find the evaluation order manually without assistance so that you can do well on a test.</p>\n\n<p>It's recommended that you only do this to check an answer you're confident in. You can also use it if you get stuck, but you should only read up until the point that you're stuck to see what the next step is and to make an educated guess about <em>why</em> that's the next step so that you can begin to learn what the rules are by experimenting. This, in combination with the above linked article, will help quite a bit.</p>\n\n<p>To do this, we can expand upon Jonas Dureg\u00e5rd's answer by using <code>Debug.Trace</code>'s functions instead of <code>error</code>. <code>Debug.Trace</code>'s functions can output things <em>when</em> something starts or stops being evaluated, so they're quite appropriate here:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Debug.Trace\n\n-- Show result\nr :: String -&gt; Int -&gt; Int\nr nm n = trace (\"Result of \" ++ nm ++ \" is \" ++ show n) n\n\n-- Show evaluation of Int -&gt; Int -&gt; Int function\nf :: String -&gt; (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\nf nm g a b = e nm $ g a b\n\n-- Show evaluation of an Int\ne :: String -&gt; Int -&gt; Int\ne nm = r nm . trace (\"Evaluating \" ++ nm)\n\n-- Show Int literal\ni :: Int -&gt; Int\ni n = e (show n) n\n\nmultiply :: Int -&gt; Int -&gt; Int\nmultiply a b = e \"multiply\" $ (f \"multiply's *\" (*))\n                              (e \"multiply's a\" a)\n                              (e \"multiply's b\" b)\n\nminus :: Int -&gt; Int -&gt; Int\nminus a b = e \"minus\" $ (f \"minus's -\" (-))\n                        (e \"minus's a\" a)\n                        (e \"minus's b\" b)\n\nminus2 :: Int -&gt; Int -&gt; Int\nminus2 a b = e \"minus2\" $ (f \"minus2's -\" (-))\n                          (e \"minus2's b\" b)\n                          (e \"minus2's a\" a)\n\nmain :: IO ()\nmain = print $ minus2 (multiply (minus (i 3) (i 5)) (i 7)) (i 9)\n</code></pre>\n\n<p>Once you've solved the problem on paper, you can check your answer with <a href=\"https://ideone.com/BjTZNQ#stderr\" rel=\"nofollow noreferrer\">the results of the above code run on GHC</a>. It tells you what evaluation order your code uses when compiled with GHC.</p>\n\n<p>You can alternatively run this through the Haskell compiler of your choice.</p>\n"}], "owner": {"reputation": 1004, "user_id": 1692517, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/893889b69fb20b6f02e3cb7a182e1c47?s=128&d=identicon&r=PG", "display_name": "user1692517", "link": "https://stackoverflow.com/users/1692517/user1692517"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1537719149, "creation_date": 1537659680, "last_edit_date": 1537694888, "question_id": 52461791, "link": "https://stackoverflow.com/questions/52461791/regarding-evaluation-order", "title": "Regarding evaluation order", "body": "<pre><code>multiply :: Int -&gt; Int -&gt; Int \nmultiply a b = a * b \n\nminus :: Int -&gt; Int -&gt; Int \nminus a b = a - b \n\nminus2 :: Int -&gt; Int -&gt; Int \nminus2 a b = b \u2013 a\n\n\nminus2 (multiply (minus 3 5) 7) 9\nminus2 ((minus 3 5) * 7) 9\n9 - ((minus 3 5) * 7)\n9 - ((3 - 5) * 7)\n9 - ((-2) * 7)\n9 - (-14)\n23\n</code></pre>\n\n<p>Running the line <code>minus2 (multiply (minus 3 5) 7) 9</code>\nDo I have the correct order of evaluation that Haskell would use?</p>\n\n<p>Still new with functional programming so I'm not sure if I have the \"lazy evaluation\" process correct.</p>\n"}, {"tags": ["haskell", "self-organizing-maps"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537653251, "post_id": 52460902, "comment_id": 91864438, "body": "Please write the <i>full</i> error you&#39;re still getting after your edits."}, {"owner": {"reputation": 11, "user_id": 10401982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2cc7903cb5aff925f0aa00e4ea5db1?s=128&d=identicon&r=PG&f=1", "display_name": "JaydFlore", "link": "https://stackoverflow.com/users/10401982/jaydflore"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537653971, "post_id": 52460902, "comment_id": 91864613, "body": "I have edited the Error, also thank you for your help."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1537656166, "post_id": 52460902, "comment_id": 91865064, "body": "The error references code you haven&#39;t included in the question. Did you try to read and understand the error message? Where are you stuck?"}, {"owner": {"reputation": 11, "user_id": 10401982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2cc7903cb5aff925f0aa00e4ea5db1?s=128&d=identicon&r=PG&f=1", "display_name": "JaydFlore", "link": "https://stackoverflow.com/users/10401982/jaydflore"}, "edited": false, "score": 0, "creation_date": 1537657197, "post_id": 52460902, "comment_id": 91865246, "body": "I have edited the full Code. From my understanding, the error is telling me that the 2nd Parameter type of adjustNum is wrong with the useage of SOM.  If i check the type of SOM i cant figure it out <code>SOM:: gm p -&gt; (t -&gt; d -&gt; x)-&gt;          (p -&gt; p -&gt; x) -&gt;  (p -&gt; x -&gt; p -&gt; p) -&gt;  t  -&gt; SOM t d gm x k p</code>  I dont know if im checking on the wrong place but adjustNum is the 4th argument so it should be type <code>(p -&gt; x -&gt; p -&gt; p)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 10401982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2cc7903cb5aff925f0aa00e4ea5db1?s=128&d=identicon&r=PG&f=1", "display_name": "JaydFlore", "link": "https://stackoverflow.com/users/10401982/jaydflore"}, "is_accepted": true, "score": 0, "last_activity_date": 1537710551, "creation_date": 1537710551, "answer_id": 52466763, "question_id": 52460902, "link": "https://stackoverflow.com/questions/52460902/using-selforganizing-map-som-from-hackage-for-list-of-lists/52466763#52466763", "title": "Using SelfOrganizing map som from hackage for List of Lists", "body": "<p>I found my answer for this problem after checking and trying out the other exmple given in <a href=\"https://github.com/mhwombat/som/blob/master/examples/colours.hs\" rel=\"nofollow noreferrer\">https://github.com/mhwombat/som/blob/master/examples/colours.hs</a> </p>\n\n<p>Using the function euclideanDistanceSquared and adjustVector provided by the som lib instead of my defined ones worked for me.</p>\n"}], "owner": {"reputation": 11, "user_id": 10401982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2cc7903cb5aff925f0aa00e4ea5db1?s=128&d=identicon&r=PG&f=1", "display_name": "JaydFlore", "link": "https://stackoverflow.com/users/10401982/jaydflore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 52466763, "answer_count": 1, "score": 1, "last_activity_date": 1537710551, "creation_date": 1537650613, "last_edit_date": 1537658271, "question_id": 52460902, "link": "https://stackoverflow.com/questions/52460902/using-selforganizing-map-som-from-hackage-for-list-of-lists", "title": "Using SelfOrganizing map som from hackage for List of Lists", "body": "<p>i wanted to use the som package from  <a href=\"http://hackage.haskell.org/package/som\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/som</a> \nto test some things with my own Data. I have looked up the example  <a href=\"https://github.com/mhwombat/som/blob/master/examples/housePrices.hs\" rel=\"nofollow noreferrer\">https://github.com/mhwombat/som/blob/master/examples/housePrices.hs</a></p>\n\n<p>and i have to rewrite the code for my use case which is Data Like Float or Double Lists in a List </p>\n\n<pre><code>let myData = [[1.2,1.3,4.1],[1.2,1.3,3.1] ...]\n</code></pre>\n\n<p>I would appreciate any help or any hint for another som package for List of Lists as inputs. </p>\n\n<p>Edit: The complete Code </p>\n\n<pre><code>import Control.Monad (foldM_, forM_, unless, replicateM)\nimport Control.Monad.Random (evalRandIO, Rand, RandomGen, getRandomR)\nimport Data.Datamining.Pattern (adjustVector,  euclideanDistanceSquared)\nimport Data.Datamining.Clustering.SOM (SOM(..), toGridMap, decayingGaussian)\nimport Data.Datamining.Clustering.Classifier (Classifier, train, trainBatch)\n\nimport Data.List (foldl')\nimport Data.Word (Word8)\nimport Data.Array.IArray (elems)\nimport Data.Array.Unboxed (UArray)\nimport Data.Array.ST (runSTArray)\nimport GHC.Arr (listArray, readSTArray, thawSTArray, writeSTArray)\nimport Math.Geometry.Grid \nimport Math.Geometry.Grid.Square (RectSquareGrid, rectSquareGrid)\nimport qualified Math.Geometry.GridMap as GM \nimport Math.Geometry.GridMap.Lazy (LGridMap, lazyGridMap)\nimport Numeric (showHex)\nimport System.Directory (doesFileExist) \n\nmain :: IO ()\nmain = do\n  c &lt;- evalRandIO $ buildSOM (length myTestDataInput)\n  putStr . show . map round . GM.elems . toGridMap $ c\n  foldM_ trainAndPrint c myTestDataInput\n\ntrainAndPrint c x = do\n   let c2 = train c x\n   putStr . show . map round . GM.elems . toGridMap $ c2\n   putStrLn $ \" after training with \" ++ show (round x)\n   return c2\n\n\n buildSOM n = do     \n    let g = rectSquareGrid 3 3  \n    let gm = lazyGridMap g ownWeights\n    let n' = fromIntegral n\n    let lrf = decayingGaussian 0.5 0.1 0.3 0.1 n' \n    return $ SOM gm lrf absD adjustNum 0\n\n\nownWeights = [[1.2,1.3],[1.2,1.3],[1.2,1.3],[1.2,1.3],[1.2,4.3],[1.2,1.5],[6.2,1.3]]\nmyTestDataInput  = [[1.2,1.3],[1.2,1.3],[1.3,3.1],[1.2,2.3],[4.3,3.1],[1.5,3.1],[6.2,1.3]]\n\nabsD _ [] = []\nabsD [] _ = []\nabsD (x:xs) (y:ys) = abs (x-y) : absD xs ys\n\nadjustNum [] _ _ = []\nadjustNum (target:tarL) r (x:xs)\n  | r &lt; 0     = error \"Negative learning rate\"\n  | r &gt; 1     = error \"Learning rate &gt; 1\"\n  | otherwise = x + r*(target - x) : adjustNum tarL r xs\n</code></pre>\n\n<p>Full Error: </p>\n\n<p>C:\\NN\\SOM.hs:65:28: error:</p>\n\n<pre><code>* Occurs check: cannot construct the infinite type: a0 ~ [a0]\n  Expected type: [a0] -&gt; [a0] -&gt; [a0] -&gt; [a0]\n    Actual type: [a0] -&gt; a0 -&gt; [a0] -&gt; [a0]\n* In the fourth argument of `SOM', namely `adjustNum'\n  In the second argument of `($)', namely\n    `SOM gm lrf absD adjustNum 0'\n  In a stmt of a 'do' block: return $ SOM gm lrf absD adjustNum 0\n* Relevant bindings include\n    lrf :: [a0] -&gt; [a0] -&gt; [a0] (bound at C:\\\\NN\\SOM.hs:64:7)\n    n' :: [a0] (bound at C:\\\\NN\\SOM.hs:63:7)\n    gm :: LGridMap RectSquareGrid [a0] (bound at C:\\\\NN\\SOM.hs:62:7)\n    buildSOM :: Int\n                -&gt; Control.Monad.Trans.Random.Lazy.RandT\n                     System.Random.StdGen\n                     Data.Functor.Identity.Identity\n                     (SOM [a0] [a0] (LGridMap RectSquareGrid) [a0] (Int, Int) [a0])\n      (bound at C:\\\\NN\\SOM.hs:56:1)\n | 65 | return $ SOM gm lrf absD adjustNum 0 | ^^^^^^^^^ Failed, no modules loaded. Prelude&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1537648082, "post_id": 52460571, "comment_id": 91863199, "body": "What is the first bit that&#39;s unclear about <code>otherwise =  rainfall n `max` mostRain (n - 1)</code>?"}, {"owner": {"reputation": 9333, "user_id": 85215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56d65f736083a06748fb7816b96a3ffd?s=128&d=identicon&r=PG", "display_name": "Jonas H&#248;gh", "link": "https://stackoverflow.com/users/85215/jonas-h%c3%b8gh"}, "edited": false, "score": 4, "creation_date": 1537648527, "post_id": 52460571, "comment_id": 91863299, "body": "My guess is that the rainfall function is just some arbitrary numbers for generating sample data"}, {"owner": {"reputation": 21, "user_id": 10360510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z2xzP.jpg?s=128&g=1", "display_name": "Haskell Newbie", "link": "https://stackoverflow.com/users/10360510/haskell-newbie"}, "edited": false, "score": 0, "creation_date": 1537648817, "post_id": 52460571, "comment_id": 91863382, "body": "I don&#39;t understand why they subtract 1 from n winch is the week number ?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1537656344, "post_id": 52460571, "comment_id": 91865088, "body": "@HaskellNewbie  It wouldn&#39;t terminate otherwise.  Imagine a C loop of <code>for(i=n; i &gt;= 1 ; i = i) { ... }</code>.  Since <code>i</code> isn&#39;t decremented (or <code>n</code> in the Haskell loop) it&#39;s not going to terminate."}, {"owner": {"reputation": 21, "user_id": 10360510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z2xzP.jpg?s=128&g=1", "display_name": "Haskell Newbie", "link": "https://stackoverflow.com/users/10360510/haskell-newbie"}, "edited": false, "score": 0, "creation_date": 1537659168, "post_id": 52460571, "comment_id": 91865586, "body": "Thank you!!!! with each comment and answer i have learned something new!!! :) :) &lt;3 &lt;3"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10360510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z2xzP.jpg?s=128&g=1", "display_name": "Haskell Newbie", "link": "https://stackoverflow.com/users/10360510/haskell-newbie"}, "edited": false, "score": 0, "creation_date": 1537649051, "post_id": 52460686, "comment_id": 91863438, "body": "Great now I know from you that the number 3.9 is arbitrary. and they already defined rainfall . but Ii don&#39;t understand why they subtract 1 from n the week-number?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1537649619, "post_id": 52460686, "comment_id": 91863571, "body": "Are you referring to this: <code>otherwise =  rainfall n `max` mostRain (n - 1)</code>? It&#39;s just saying that the biggest daily rainfall after n days is the greater of: the rainfall on day n, and the previous daily max (that is, the one after n-1 days). [I&#39;m also a relative newbie at Haskell, and I really don&#39;t like that the solution has used <code>max</code> as an infix function. Clearly it&#39;s allowed but I don&#39;t really see why, and I think it makes it a bit less readable.]"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1537649907, "post_id": 52460686, "comment_id": 91863643, "body": "@RobinZigmond On infix <code>max</code>: yup, that&#39;s not great indeed."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 2, "last_activity_date": 1537648739, "creation_date": 1537648739, "answer_id": 52460686, "question_id": 52460571, "link": "https://stackoverflow.com/questions/52460571/can-you-help-me-understand-how-this-code-working-i-am-very-starter-in-haskell/52460686#52460686", "title": "can you help me understand how this code working i am very starter in haskell", "body": "<p>Notice that it says this in the description:</p>\n\n<blockquote>\n  <p><code>rainfall :: WeekNumber -> Double    <strong>-- assume this function exists</strong></code></p>\n</blockquote>\n\n<p>That is to say, <strong>you're not actually expected to define <code>rainfall</code>.</strong> The definition they give in the solution is an example definition - the number 3.9 is entirely arbitrary. Ignore it.</p>\n\n<p>You're only supposed to define <code>mostRain</code>, and so that's the part you should be paying attention to.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 10360510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z2xzP.jpg?s=128&g=1", "display_name": "Haskell Newbie", "link": "https://stackoverflow.com/users/10360510/haskell-newbie"}, "edited": false, "score": 0, "creation_date": 1537654882, "post_id": 52460826, "comment_id": 91864816, "body": "Thank you so much all of you who give some time and satt there explaining to me step by step :) :) :) :) I really appreciate your help and I am so grateful to find this website!! Haskell is so difficult and complicated and it made me hate programming, I am a newbie in all programming languages in general! I have applied the code and tried mostRain from 1 to 50 randomly after 5th week all the results are the same mostRain 6 23.4. so I understand that week 6 is the most raining in a whole year?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1537649998, "creation_date": 1537649998, "answer_id": 52460826, "question_id": 52460571, "link": "https://stackoverflow.com/questions/52460571/can-you-help-me-understand-how-this-code-working-i-am-very-starter-in-haskell/52460826#52460826", "title": "can you help me understand how this code working i am very starter in haskell", "body": "<p>First, as @AJFarmar points out, writing the <code>rainfall</code> function wasn't part of the exercise.  The answer just provides an arbitrary definition so you can test the solution, and the number 3.9 was just pulled out of thin air to make the rainfall amounts seem \"interesting\":</p>\n\n<pre><code>&gt; rainfall 1\n3.9\n&gt; rainfall 2\n7.8\n&gt;\n</code></pre>\n\n<p>You don't really need to understand what the expression:</p>\n\n<pre><code>fromIntegral (n `mod` 7) * 3.9\n</code></pre>\n\n<p>does to understand the solution, but  if you're interested, it takes the input integer <code>n</code>, calculates <code>n `mod` 7</code> (which is the remainder when <code>n</code> is divided by 7, so it turns 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 into 1, 2, 3, 4, 5, 6, 0, 1, 2, 3), and converts the result from an integer to a double before multiplying by 3.9.  So, for example, this gives amounts of rainfall for weeks 1 to 10 that look like this:</p>\n\n<pre><code>&gt; map rainfall [1..10]\n[3.9,7.8,11.7,15.6,19.5,23.4,0.0,3.9,7.8,11.7]\n&gt;\n</code></pre>\n\n<p>To understand the part of the solution after <code>otherwise</code>, first let's rewrite it to get rid of the special backtick notation:</p>\n\n<pre><code>mostRain :: WeekNumber -&gt; Double\nmostRain n | n &lt; 1     = 0\n           | otherwise =  max (rainfall n) (mostRain (n - 1))\n</code></pre>\n\n<p>This definition says that the calculation of the most rain seen in weeks 1 to n, namely <code>mostRain n</code>, will be defined as <code>0</code> if <code>n &lt; 1</code> and by the following expression otherwise:</p>\n\n<pre><code>max (rainfall n) (mostRain (n - 1))\n</code></pre>\n\n<p>This expression evaluates the maximum of two numbers, the value of <code>rainfall n</code> (i.e., the rainfall in week <code>n</code>) and the value of <code>mostRain (n - 1)</code>.  This is a recursive call which will calculate the most rain seen in weeks 1 to <code>n-1</code>.</p>\n\n<p>So, this is really saying that the most rain from weeks 1 to n is defined to be the maximum of (1) the amount of rain in week n and (2) the most rain seen in the previous weeks.  Alternatively, you can think of it as performing a calculation in steps like this:</p>\n\n<pre><code>mostRain 3\n= max (rainfall 3) (mostRain 2)\n= max (rainfall 3) (max (rainfall 2) (mostRain 1))\n= max (rainfall 3) (max (rainfall 2) (max (rainfall 1) (mostRain 0))\n= max (rainfall 3) (max (rainfall 2) (max (rainfall 1) 0)\n</code></pre>\n\n<p>and if we fill in the simulated rainfall amounts, you can see how it ultimately calculates the maximum:</p>\n\n<pre><code>= max 11.7 (max 7.8 (max 3.9 0)\n= max 11.7 (max 7.8 3.9)\n= max 11.7 7.8\n= 11.7\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10360510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z2xzP.jpg?s=128&g=1", "display_name": "Haskell Newbie", "link": "https://stackoverflow.com/users/10360510/haskell-newbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 52460826, "answer_count": 2, "score": 1, "last_activity_date": 1537649998, "creation_date": 1537647635, "last_edit_date": 1537647966, "question_id": 52460571, "link": "https://stackoverflow.com/questions/52460571/can-you-help-me-understand-how-this-code-working-i-am-very-starter-in-haskell", "title": "can you help me understand how this code working i am very starter in haskell", "body": "<p>I am looking up some Haskell exercises with answers.\nThis is the exercise:</p>\n\n<blockquote>\n  <p>Assume that you have a function <code>rainfall</code> which computes the rainfall in your city for a given week (where weeks are numbered from 1 and upwards)</p>\n\n<pre><code>type WeekNumber = Int\nrainfall :: WeekNumber -&gt; Double    -- assume this function exists\n</code></pre>\n  \n  <p>Complete the definition of the following function:</p>\n\n<pre><code>mostRain :: WeekNumber -&gt; Double\nmostRain n | n &lt; 1     = 0\n           | otherwise =                       -- (complete this case)\n</code></pre>\n  \n  <p>Your solution must be recursive. Hint: The function max may be useful. Note that you do not have to provide a definition for the function <code>rainfall</code>.</p>\n</blockquote>\n\n<p>The answer:</p>\n\n<pre><code>import Data.List\nimport Data.Maybe\nimport Test.QuickCheck\n-- 1 ----------------\ntype WeekNumber = Int\nrainfall :: WeekNumber -&gt; Double\nrainfall n = fromIntegral (n `mod` 7) * 3.9\n\nmostRain :: WeekNumber -&gt; Double\nmostRain n | n &lt; 1     = 0\n           | otherwise =  rainfall n `max` mostRain (n - 1) \n</code></pre>\n\n<p>I really hoping that someone can help explain to me how they come up with this number 3.9 <code>(n `mod` 7) * 3.9</code></p>\n\n<p>and what actually happens here <code>otherwise =  rainfall n `max` mostRain (n - 1)</code>?</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537642821, "post_id": 52459888, "comment_id": 91861927, "body": "Perhaps you better first aim to define it <i>without</i> the <code>foldTree</code>."}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537647041, "post_id": 52460000, "comment_id": 91862912, "body": "Well llike specified before, on <code>lt</code> and <code>rt</code>, the <code>treeTakeWhile</code> has already been applied: these are <i>not</i> trees, but already &quot;folded&quot; elements."}, {"owner": {"reputation": 13, "user_id": 10401642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d2bb19bbc154c1bf72fcb7a23ffca4?s=128&d=identicon&r=PG&f=1", "display_name": "azureus", "link": "https://stackoverflow.com/users/10401642/azureus"}, "edited": false, "score": 0, "creation_date": 1537647333, "post_id": 52460000, "comment_id": 91863000, "body": "I moved my comment into the original post to preserve formatting"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 13, "user_id": 10401642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d2bb19bbc154c1bf72fcb7a23ffca4?s=128&d=identicon&r=PG&f=1", "display_name": "azureus", "link": "https://stackoverflow.com/users/10401642/azureus"}, "edited": false, "score": 0, "creation_date": 1537647430, "post_id": 52460000, "comment_id": 91863033, "body": "@azureus: yes, but it was clear, the point is that in case of a &quot;fold&quot;, the fold is already applied (well lazily) done to the <i>parameters</i> <code>l</code> and <code>r</code>, so <code>f l</code>, etc. makes no sense."}, {"owner": {"reputation": 13, "user_id": 10401642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d2bb19bbc154c1bf72fcb7a23ffca4?s=128&d=identicon&r=PG&f=1", "display_name": "azureus", "link": "https://stackoverflow.com/users/10401642/azureus"}, "edited": false, "score": 0, "creation_date": 1537647625, "post_id": 52460000, "comment_id": 91863081, "body": "Oh! I see. Wow, these folds really did a number on me. Thank you so much. I am still getting used to reasoning this way. Could you point me to places where I can improve my skills especially when it comes to working with these fairly &#39;primitive&#39; abstractions in the language?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 13, "user_id": 10401642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d2bb19bbc154c1bf72fcb7a23ffca4?s=128&d=identicon&r=PG&f=1", "display_name": "azureus", "link": "https://stackoverflow.com/users/10401642/azureus"}, "edited": false, "score": 0, "creation_date": 1537647718, "post_id": 52460000, "comment_id": 91863106, "body": "The LYAH book can be a good start I think <a href=\"http://learnyouahaskell.com/higher-order-functions#folds\" rel=\"nofollow noreferrer\">learnyouahaskell.com/higher-order-functions#folds</a>"}, {"owner": {"reputation": 13, "user_id": 10401642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d2bb19bbc154c1bf72fcb7a23ffca4?s=128&d=identicon&r=PG&f=1", "display_name": "azureus", "link": "https://stackoverflow.com/users/10401642/azureus"}, "edited": false, "score": 0, "creation_date": 1537647826, "post_id": 52460000, "comment_id": 91863134, "body": "I have been using LYAH fairly actively and I feel like I have a decent handle on list folds but I guess I haven&#39;t got used to the lazy aspect of it and was not able to extend it effectively when reasoning with trees"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 13, "user_id": 10401642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d2bb19bbc154c1bf72fcb7a23ffca4?s=128&d=identicon&r=PG&f=1", "display_name": "azureus", "link": "https://stackoverflow.com/users/10401642/azureus"}, "edited": false, "score": 0, "creation_date": 1537652036, "post_id": 52460000, "comment_id": 91864125, "body": "@azureus: well essentially most &quot;folds&quot; are <i>catamorphisms</i> (a concept from <i>category</i> theory) so perhaps the wiki page can provide some insights <a href=\"https://wiki.haskell.org/Catamorphisms\" rel=\"nofollow noreferrer\">wiki.haskell.org/Catamorphisms</a> although category theory is rather &quot;abstract&quot; (well it takes some &quot;chewing&quot; before you start appreciating it :)"}, {"owner": {"reputation": 712, "user_id": 2326106, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/576f57ddb3d4b124d5bd5d9ad62f9c0c?s=128&d=identicon&r=PG", "display_name": "mBrice1024", "link": "https://stackoverflow.com/users/2326106/mbrice1024"}, "edited": false, "score": 0, "creation_date": 1568336983, "post_id": 52460000, "comment_id": 102250786, "body": "Not to give away the ans but make sure you do not wrap your node construction params in parenthesis. I just spent a good hour wondering why my code looked perfectly logical but wouldn&#39;t compile due to type errors. Oh the joys of switching from modern languages to haskell haha."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1537645783, "last_edit_date": 1537645783, "creation_date": 1537643476, "answer_id": 52460000, "question_id": 52459888, "link": "https://stackoverflow.com/questions/52459888/trying-a-version-of-takewhile-on-trees-in-haskell/52460000#52460000", "title": "Trying a version of takeWhile on trees in Haskell", "body": "<p>Instead of using <code>foldTree</code> immediately, let's first aim to define the function itself.</p>\n\n<p>Basically there are three options here:</p>\n\n<ol>\n<li>the tree is a <code>Leaf</code>, regardless what the condition is, the result is a <code>Leaf</code> as well;</li>\n<li>the tree is a <code>Node</code> and the condition is satsified, then we yield the element, and recurse on the subtrees;</li>\n<li>the tree is a <code>Node</code> and the condition is <em>not</em> satisfied, then the result is a <code>Leaf</code>.</li>\n</ol>\n\n<p>We can encode these rules as:</p>\n\n<pre><code>treeTakeWhile :: (a -&gt; Bool) -&gt; Tree a -&gt; Tree a\ntreeTakeWhile c = go\n    where go Leaf = Leaf                                -- (1)\n          go (Node l x r) | c x = Node (go l) x (go r)  -- (2)\n                          | otherwise = Leaf            -- (3)\n</code></pre>\n\n<p>this then yields the expected results:</p>\n\n<pre><code>Prelude&gt; treeTakeWhile (&gt;5) t\nLeaf\nPrelude&gt; treeTakeWhile (&gt;=4) t\nNode (Node Leaf 10 Leaf) 4 (Node Leaf 5 Leaf)\nPrelude&gt; treeTakeWhile (&lt;5) t\nNode Leaf 4 Leaf\nPrelude&gt; treeTakeWhile (&lt;8) t\nNode Leaf 4 (Node Leaf 5 Leaf)\n</code></pre>\n\n<h1>Moving this to a <code>foldTree</code></h1>\n\n<p>Now we aim to move the logic to a <code>foldTree</code>, we can thus write the function as:</p>\n\n<pre><code>treeTakeWhile :: (a -&gt; Bool) -&gt; Tree a -&gt; Tree a\ntreeTakeWhile c = foldTree f x0\n    where f tl x tr = -- ...\n          x0 = -- ...\n</code></pre>\n\n<p>The <code>x0</code> is the value we should fill in for <code>Leaf</code>s, but we already know what that is: it is the first rule (1) and we should thus return a <code>Leaf</code> as well.</p>\n\n<p>For <code>f</code> we need a function <code>Tree a -&gt; a -&gt; Tree a -&gt; Tree a</code>. The first operand <code>tl</code> is the <code>treeTakeWhile</code> of the left subtree (this would be equivalent to <code>go l</code> in the original function implementation), the second parameter <code>x</code> is the value encoded in the <code>Node</code>, and the last parameter <code>tr</code> is the result of <code>treeTakeWhile</code> on the second subtree (so equivalent to <code>go r</code>), so:</p>\n\n<pre><code>treeTakeWhile :: (a -&gt; Bool) -&gt; Tree a -&gt; Tree a\ntreeTakeWhile c = foldTree f x0\n    where f tl x tr = -- ...\n          x0 = -- ...\n</code></pre>\n\n<p>(leave this as an exercise).</p>\n"}], "owner": {"reputation": 13, "user_id": 10401642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d2bb19bbc154c1bf72fcb7a23ffca4?s=128&d=identicon&r=PG&f=1", "display_name": "azureus", "link": "https://stackoverflow.com/users/10401642/azureus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 52460000, "answer_count": 1, "score": 1, "last_activity_date": 1537647241, "creation_date": 1537642662, "last_edit_date": 1537647241, "question_id": 52459888, "link": "https://stackoverflow.com/questions/52459888/trying-a-version-of-takewhile-on-trees-in-haskell", "title": "Trying a version of takeWhile on trees in Haskell", "body": "<p>Given a tree that looks like this:</p>\n\n<pre><code>data Tree a = Leaf | Node (Tree a) a (Tree a)\n</code></pre>\n\n<p>And a fold function that looks like this:</p>\n\n<pre><code>foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldTree _ b Leaf         = b\nfoldTree fn b (Node lt x rt) = f (foldTree fn b lt) x (foldTree fn b rt)\n</code></pre>\n\n<p>I want to be able to write a takeWhileTree function that looks like this:</p>\n\n<pre><code>treeTakeWhile :: (a -&gt; Bool) -&gt; Tree a -&gt; Tree a\n</code></pre>\n\n<p>I want it to mimic the 'normal' list takeWhile function so that it returns the largest possible tree whose elements satisfy the given condition.</p>\n\n<p>So, if a tree <code>t = Node (Node Leaf 10 Leaf) 4 (Node Leaf 5 Leaf)</code>, then:</p>\n\n<pre><code>treeTakeWhile (&gt; 5) T = Leaf\ntreeTakeWhile (&gt;= 4) T = T\ntreeTakeWhile (&lt; 5) T = Node Leaf 4 Leaf\ntreeTakeWHile (&lt; 8) T = Node Leaf 4 (Node Leaf 5 Leaf)\n</code></pre>\n\n<p>So far I seem to not be able to formulate what to pass into foldTree. \nIn the definition of foldtree, the function can be broken down as: b probably being the left subtree, a probably being the value in the current node and b probably being the right subtree.</p>\n\n<p>Therefore, the function passed to treeTakeWhile has to be applied to all these parts of the node in some manner while being able to stop when the operation no longer applies.</p>\n\n<pre><code>treeTakeWhile fn = foldTree (\\xs x ys -&gt; if y then g else Leaf) Node()\n              where g = (lt, x, rt)\n                    y = fn (Node lt x rt)\n</code></pre>\n\n<p>The above is clearly wrong but I am not sure how to express the act of applying the function to the current node's value followed by the left tree and the right tree here. Could somebody point me in the right direction? And how will the fold be able to produce the required tree?</p>\n\n<p>Edit 1:</p>\n\n<p>Okay, based on your feedback, I have gotten to a place where I think I am pretty close to the answer but cannot figure out why the compiler still complains:</p>\n\n<pre><code>treeTakeWhile :: (a -&gt; Bool) -&gt; Tree a -&gt; Tree a\ntreeTakeWhile c = foldTree f acc\n        where acc = Leaf\n              f l x r = if c x then Node (f lt) x (f rt) else Leaf\n</code></pre>\n\n<p>As far as I can tell, foldTree is being passed the right arguments now. And the predicate is also being evaluated as required at each level of the tree. The return value is always of type Tree as well.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1537649653, "post_id": 52459736, "comment_id": 91863580, "body": "Since you are using <code>parsec</code>, you may be interested in the <a href=\"http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Expr.html\" rel=\"nofollow noreferrer\"><code>Text.Parsec.Expr</code></a> module."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1537644562, "creation_date": 1537644562, "answer_id": 52460148, "question_id": 52459736, "link": "https://stackoverflow.com/questions/52459736/parsing-arithmetic-expression-with-haskell-parsec/52460148#52460148", "title": "Parsing arithmetic expression with Haskell Parsec", "body": "<p>Consider parsing <code>1+2</code>.  In <code>parseExp</code> this parses <code>1</code> into <code>t1 = Const 1</code> and then enters the loop <code>loop (Const 1)</code>.  The loop tries the first alternative <code>termSuffix (Const 1)</code> which succesfully parses the operator <code>+</code>, the next term <code>t2 = Const 2</code>, and then loops back into <code>termSuffix (Binary Plus (Const 1) (Const 2))</code> which expects either a <code>+</code> or <code>-</code>.  The parse fails.  Instead of looping back into <code>termSuffix</code>, you should loop back into <code>loop</code> to allow a single term after the first <code>+</code>:</p>\n\n<pre><code>parseExp :: Parser Exp\nparseExp = do\n  t1 &lt;- parseTerm\n  loop t1\n  where termSuffix t1 = do\n          op &lt;- lexeme $ oneOf \"+-\"\n          t2 &lt;- parseTerm\n          case op of\n            -- *** use `loop` here, not `termSuffix` ***\n            '+' -&gt; loop (Binary Plus t1 t2)\n            '-' -&gt; loop (Binary Minus t1 t2)\n        loop t = termSuffix t &lt;|&gt; return t\n</code></pre>\n\n<p>After making a similar change to <code>parseTerm</code>, your test cases all work fine.</p>\n"}], "owner": {"reputation": 55, "user_id": 9383672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "saitouena", "link": "https://stackoverflow.com/users/9383672/saitouena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1051, "favorite_count": 0, "accepted_answer_id": 52460148, "answer_count": 1, "score": 2, "last_activity_date": 1537644562, "creation_date": 1537641487, "question_id": 52459736, "link": "https://stackoverflow.com/questions/52459736/parsing-arithmetic-expression-with-haskell-parsec", "title": "Parsing arithmetic expression with Haskell Parsec", "body": "<p>I'm writing a arithmetic parser to treat expressions like \"1+2-3\". I use <a href=\"https://norasandler.com/2017/12/15/Write-a-Compiler-3.html#fn2\" rel=\"nofollow noreferrer\">this blog post</a> as reference. To treat left associativity and precedence, I write a parser with Parsec according to this BNF (from blog post).</p>\n\n<pre><code>&lt;exp&gt; ::= &lt;term&gt; { (\"+\" | \"-\") &lt;term&gt; }\n&lt;term&gt; ::= &lt;factor&gt; { (\"*\" | \"/\") &lt;factor&gt; }\n&lt;factor&gt; ::= \"(\" &lt;exp&gt; \")\" | &lt;unary_op&gt; &lt;factor&gt; | &lt;int&gt;\n</code></pre>\n\n<p>This is my parser code.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parseExp :: Parser Exp\nparseExp = do\n  t1 &lt;- parseTerm\n  loop t1\n  where termSuffix t1 = do\n          op &lt;- lexeme $ oneOf \"+-\"\n          t2 &lt;- parseTerm\n          case op of\n            '+' -&gt; termSuffix (Binary Plus t1 t2)\n            '-' -&gt; termSuffix (Binary Minus t1 t2)\n        loop t = termSuffix t &lt;|&gt; return t\n\nparseTerm :: Parser Exp\nparseTerm = do\n  f1 &lt;- parseFactor\n  loop f1\n  where factorSuffix f1 = do\n          op &lt;- lexeme $ oneOf \"*/\"\n          f2 &lt;- parseFactor\n          case op of\n            '*' -&gt; factorSuffix (Binary Mul f1 f2)\n            '/' -&gt; factorSuffix (Binary Div f1 f2)\n        loop t = factorSuffix t &lt;|&gt; return t\n\nparseFactor :: Parser Exp\nparseFactor = parseConst &lt;|&gt; parseParen &lt;|&gt; parseUnary\n\nparseParen = do\n  void $ lexeme $ char '('\n  e &lt;- parseExp\n  void $ lexeme $ char ')'\n  return e\n\nparseUnary :: Parser Exp\nparseUnary = do\n  op &lt;- lexeme $ oneOf \"!~-\"\n  f &lt;- parseFactor\n  case op of\n    '!' -&gt; return $ Unary LogNeg f\n    '~' -&gt; return $ Unary BitCompl f\n    '-' -&gt; return $ Unary ArithNeg f\n\nparseConst :: Parser Exp\nparseConst = do\n  i &lt;- many1 digit\n  return (Const $ read i)\n</code></pre>\n\n<p>I also used this tutorial code as reference. <a href=\"http://jakewheat.github.io/intro_to_parsing/#_simple_expr\" rel=\"nofollow noreferrer\">tutorial</a></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>simpleExpr7 :: Parser SimpleExpr\nsimpleExpr7 = do\n    -- first parse a term\n    e &lt;- term7\n    -- then see if it is followed by an '+ expr' suffix\n    maybeAddSuffix e\n  where\n    -- this function takes an expression, and parses a\n    -- '+ expr' suffix, returning an Add expression\n    -- it recursively calls itself via the maybeAddSuffix function\n    addSuffix e0 = do\n        void $ lexeme $ char '+'\n        e1 &lt;- term7\n        maybeAddSuffix (Add e0 e1)\n    -- this is the wrapper for addSuffix, which adapts it so that if\n    -- addSuffix fails, it returns just the original expression\n    maybeAddSuffix e = addSuffix e &lt;|&gt; return e\n</code></pre>\n\n<p>My code doesn't work. This code works like this.</p>\n\n<pre><code>*Main CodeGen Parser&gt; parseWithEof parseExp \"-2\"\nRight (Unary ArithNeg (Const 2))\n*Main CodeGen Parser&gt; parseWithEof parseExp \"(2)\"\nRight (Const 2)\n*Main CodeGen Parser&gt; parseWithEof parseExp \"-!(((2)))\"\nRight (Unary ArithNeg (Unary LogNeg (Const 2)))\n*Main CodeGen Parser&gt; parseWithEof parseExp \"1+2\"\nLeft (line 1, column 4):\nunexpected end of input\nexpecting digit\n*Main CodeGen Parser&gt; parseWithEof parseExp \"1+2+3\"\nLeft (line 1, column 6):\nunexpected end of input\nexpecting digit\n*Main CodeGen Parser&gt; parseWithEof parseExp \"1+2*3\"\nLeft (line 1, column 6):\nunexpected end of input\nexpecting digit\n</code></pre>\n\n<p>I can't understand why this results <code>unexpected end of input</code>.</p>\n"}, {"tags": ["haskell", "types", "ghc", "type-synonyms"], "answers": [{"comments": [{"owner": {"reputation": 569, "user_id": 1378376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c593899e94bea32edec0b39c01106f3e?s=128&d=identicon&r=PG", "display_name": "tophat", "link": "https://stackoverflow.com/users/1378376/tophat"}, "edited": false, "score": 0, "creation_date": 1537634387, "post_id": 52458542, "comment_id": 91859568, "body": "In regards to your explanation, the need type annotation is rather annoyingly redundant considering that (at least visually) it is pretty easy to infer what the synonym&#39;s type is. In regards to your suggestion, It had never occurred to me that I could define <code>GetType</code> like that (so thank you for mentioning that)."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1537633173, "creation_date": 1537633173, "answer_id": 52458542, "question_id": 52458179, "link": "https://stackoverflow.com/questions/52458179/weird-error-when-defining-a-type-synonym-of-a-type-synonym-ghc/52458542#52458542", "title": "Weird Error When Defining a Type Synonym of a Type Synonym (GHC)", "body": "<p>The error is quite obtuse, but what I think it's trying to say is that GHC has noticed that the kind of <code>UnwrapSynonym</code> is dependent, <code>forall (pt :: Type) -&gt; GetKind pt</code>, and it wants you to explicitly annotate the dependency:</p>\n\n<pre><code>type UnwrapSynonym pt = (Unwrap pt :: GetKind pt)\n</code></pre>\n\n<p>The reason it's talking about telling it \"which variables are dependent on which others\" is because this error can also pop up in e.g. this situation:</p>\n\n<pre><code>data Nat = Z | S Nat\ndata Fin :: Nat -&gt; Type where\n  FZ :: Fin (S n)\n  FS :: Fin n -&gt; Fin (S n)\n\ntype family ToNat (n :: Nat) (x :: Fin n) :: Nat where\n  ToNat (S n) FZ = Z\n  ToNat (S n) (FS x) = S (ToNat n x)\n\ntype ToNatAgain n x = ToNat n x -- similar error\n</code></pre>\n\n<p><code>ToNatAgain</code> should have kind <code>forall (n :: Nat) -&gt; Fin n -&gt; Nat</code>, but the type of the variable <code>x</code> depends on the type of the variable <code>n</code>. GHC wants that explicitly annotated, so it tells me to tell it which variables depend on which other variables, and it gives me what it inferred as their kinds to help do that.</p>\n\n<pre><code>type ToNatAgain (n :: Nat) (x :: Fin n) = ToNat n x\n</code></pre>\n\n<p>In your case, the dependency is between the return kind and the argument kind. The underlying reason is the same, but the error message was apparently not designed with your case in mind and doesn't fit. You should submit a bug report.</p>\n\n<p>As an aside, do you really need separate <code>Unwrap</code> and <code>GetType</code>? Why not make <code>GetType</code> dependent?</p>\n\n<pre><code>type family GetType (pt :: Type) :: GetKind pt where\n  GetType (PolyType k t) = t\n</code></pre>\n"}], "owner": {"reputation": 569, "user_id": 1378376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c593899e94bea32edec0b39c01106f3e?s=128&d=identicon&r=PG", "display_name": "tophat", "link": "https://stackoverflow.com/users/1378376/tophat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 52458542, "answer_count": 1, "score": 3, "last_activity_date": 1558532797, "creation_date": 1537630441, "last_edit_date": 1592644375, "question_id": 52458179, "link": "https://stackoverflow.com/questions/52458179/weird-error-when-defining-a-type-synonym-of-a-type-synonym-ghc", "title": "Weird Error When Defining a Type Synonym of a Type Synonym (GHC)", "body": "<h1>Background</h1>\n<p>I have written the following code in Haskell (GHC):</p>\n<pre><code>{-# LANGUAGE \n  NoImplicitPrelude,\n  TypeInType, PolyKinds, DataKinds,\n  ScopedTypeVariables,\n  TypeFamilies\n#-}\n\nimport Data.Kind(Type)\n\ndata PolyType k (t :: k)\n\ntype Wrap (t :: k) = PolyType k t\ntype Unwrap pt = (GetType pt :: GetKind pt)\n\ntype family GetType (pt :: Type) :: k where\n  GetType (PolyType k t) = t\n\ntype family GetKind (pt :: Type) :: Type where\n  GetKind (PolyType k t) = k\n</code></pre>\n<p>The intention of this code is to allow me to wrap a type of an arbitrary kind into a type (namely <code>PolyType</code>) of a single kind (namely <code>Type</code>) and then reverse the process (i.e. unwrap it) later.</p>\n<h1>Problem</h1>\n<p>I would like to define a type synonym for <code>Unwrap</code> akin to the following:</p>\n<pre><code>type UnwrapSynonym pt = Unwrap pt\n</code></pre>\n<p>However, the above definition produces the following error (GHC 8.4.3):</p>\n<pre><code>* Invalid declaration for `UnwrapSynonym'; you must explicitly\n  declare which variables are dependent on which others.\n  Inferred variable kinds: pt :: *\n* In the type synonym declaration for `UnwrapSynonym'\n</code></pre>\n<p>What does this error mean? Is there a way I can get around it in order to define <code>UnwrapSynonym</code>?</p>\n<h1>What I Have Been Doing</h1>\n<p>My approach to this problem thus far is to essentially manually inline <code>Uwrap</code> in any high-order type synonyms I wish to define, but that feels icky, and I am hoping there is a better way.</p>\n<p>Unfortunately, I am not experienced enough with the inner workings of GHC even understand exactly what the problem is much less figure out how to fix it.</p>\n<p>I believe I have a decent understanding of how the extensions I'm using (ex. <code>TypeInType</code> and <code>PolyKinds</code>) work, but it is apparently not deep enough to understand this error. Furthermore, I have not been able to find an resources that address a similar problem. This is partly because I don't know how to succinctly describe it, which also made it hard to come up with a good title for this question.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1537622016, "post_id": 52456961, "comment_id": 91856210, "body": "If it is necessary to try this out, I just have the following imports:  <code>Prelude hiding (map)</code>, <code>Data.Massiv.Array as MA</code>, and <code>mapSize :: Int</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537633400, "post_id": 52456961, "comment_id": 91859299, "body": "if you always use explicit brackets (<code>let { a=x; b=y } in ...</code> etc.), you will never have these kind of silly problems (also, tabs mixed with spaces, etc). I know it&#39;s unpopular, and I can&#39;t understand why. It works."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537665050, "post_id": 52456961, "comment_id": 91866513, "body": "@WillNess I have to admit, I am somewhat inclined to do so. Partly because whitespace (at least in python) can at times cause surprising behavior, partly because it is more explicitly obvious with <code>{ }</code>, and partly because the editor I&#39;m using at the moment (<code>acme</code>) seems to make it particularly difficult to notice exact alignment, but that&#39;s probably my bad."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537682573, "post_id": 52456961, "comment_id": 91868858, "body": "one doesn&#39;t contradict the other. of course we should have nice consistent  indentation, but with the explicit delimiters we also get correctness guarantee -- and sometimes / oftentimes it even makes the code <i>clearer</i> (like with e.g. multi-line expressions), which should always be our goal. all at a &quot;price&quot; of just a few extra keystrokes. :)"}], "answers": [{"tags": [], "owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "is_accepted": false, "score": 5, "last_activity_date": 1537622865, "creation_date": 1537622865, "answer_id": 52457109, "question_id": 52456961, "link": "https://stackoverflow.com/questions/52456961/how-to-get-a-multiline-lambda-working-when-lambda-is-a-function-argument/52457109#52457109", "title": "How to get a multiline lambda working when lambda is a function argument?", "body": "<p>You are running into problems with layout in the <code>let</code> statement.  The first non-whitespace character after <code>let</code> sets a new layout level.  Any future lines indented <em>more</em> than that are interpreted as continuing the definition on their previous line.  Any lines indented <em>equal</em> to that are interpreted as starting a new definition in the <code>let</code> block.  Any lines indented <em>less</em> than that are considered to come <em>after</em> the <code>let</code> block.</p>\n\n<p>So you can't write this:</p>\n\n<pre><code>let xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y) \n  -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) )\n</code></pre>\n\n<p>But you can write this:</p>\n\n<pre><code>let xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y) \n            -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) )\n</code></pre>\n\n<p>The only difference is that the continued line is indented further than <code>xsMat</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1537623123, "creation_date": 1537623123, "answer_id": 52457140, "question_id": 52456961, "link": "https://stackoverflow.com/questions/52456961/how-to-get-a-multiline-lambda-working-when-lambda-is-a-function-argument/52457140#52457140", "title": "How to get a multiline lambda working when lambda is a function argument?", "body": "<p>The problem is that the syntax of <code>let</code> is</p>\n\n<pre><code>let { DECLARATIONS } in EXPRESSION\n</code></pre>\n\n<p>or (in a <code>do</code> block)</p>\n\n<pre><code>let { DECLARATIONS } ;\n</code></pre>\n\n<p>You almost never see the <code>{</code> <code>}</code> used in code because they're usually implicit: The token after <code>let</code> (if it's not a <code>{</code>) determines the base indentation of the following block of declarations. New lines that are indented more than the base indentation are left unchanged; new lines that have the same indentation as the base indentation get an implicit <code>;</code> inserted before them; new line with less indentation terminate the block. This whitespace sensitive syntax is called \"layout\".</p>\n\n<p>In</p>\n\n<pre><code>--      v\n    let xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y) \n      -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) )\n--    ^\n</code></pre>\n\n<p>the first token after <code>let</code> is <code>xsMat</code> (marked with <code>v</code>). This is the start of an implicit block.</p>\n\n<p>The following line is less indented than the base indentation (marked <code>^</code>). This implicitly terminates the block, so the parser sees</p>\n\n<pre><code>let { xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y)\n  } -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) )\n</code></pre>\n\n<p>and gets confused because the <code>\\</code> inside the block is not terminated and the <code>-&gt;</code> outside of the block makes no sense either.</p>\n\n<p>Solution:</p>\n\n<pre><code>let xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y) \n     -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) )\n</code></pre>\n\n<p>Indent the <code>-&gt; ...</code> line more than <code>xsMat</code>. That way it's read as a continuation line and the whole thing parses as</p>\n\n<pre><code>let { xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y) \n       -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) ) }\n</code></pre>\n\n<p>Alternatively you can also write</p>\n\n<pre><code>let { xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y) \n  -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) ) }\n</code></pre>\n\n<p>by hand. If you use <code>{</code>, layout mode doesn't kick in and you can format everything pretty much any way you want.</p>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 52457140, "answer_count": 2, "score": 1, "last_activity_date": 1537632081, "creation_date": 1537621775, "last_edit_date": 1537632081, "question_id": 52456961, "link": "https://stackoverflow.com/questions/52456961/how-to-get-a-multiline-lambda-working-when-lambda-is-a-function-argument", "title": "How to get a multiline lambda working when lambda is a function argument?", "body": "<p>I have some code as follows, that, when all on one line, compiles and functions correctly:</p>\n\n<pre><code>let xsMat = makeArrayR U Seq(mapSize :. mapSize) (\\(x :. y) \n  -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) )\n</code></pre>\n\n<p>But the error I'm getting currently is:</p>\n\n<pre><code>Main.hs:31:7: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\n   |\n31 |       -&gt; noiseValue perlinNoise(fromIntegral x, fromIntegral y, 0 ) )\n   |       ^\n</code></pre>\n\n<p>I saw <a href=\"https://stackoverflow.com/questions/38673518/haskell-multi-line-lambdas\">Haskell Multi-line Lambdas</a> but maybe I'm missing something still, or maybe this is just a different issue.</p>\n\n<p>Stylistic suggestions that go beyond what is needed to just get this working are also welcome.</p>\n\n<p><strong>Update:</strong> Both @melpomene and Chris Smith's answers address this question, and are worth reading (for others seeing this)! For stylistic improvements, someone also suggested using <code>$</code> like which I appreciate, but their answer was deleted (I presume because the core issue was not addressed - but thank you as well):</p>\n\n<pre><code>let xsMat = makeArrayR U Seq(mapSize :. mapSize) $ \\(x :. y)\n      -&gt; noiseValue perlinNoise (fromIntegral x, fromIntegral y, 0 ) \n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537623236, "post_id": 52456974, "comment_id": 91856545, "body": "I am still confused about foldl. Since the type signature of foldl starts from (b -&gt; a -&gt; b), for a list [8,6,4], I think it applies like this:  treeInsert (treeInsert (treeInsert EmptyTree 8) 6) 4. However, if foldl applies like this: insertTree 4 (insertTree 6 (insertTree 8 EmptyTree)), I can get the expected result."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537623546, "post_id": 52456974, "comment_id": 91856633, "body": "Well it works with <code>foldl f z [x1, x2, x3] == f (f (f z x1) x2) x3</code>. But since we use <code>f = flip insertTree</code>, we thus &quot;flip&quot; te parameters, so <code>foldl (flip f) z [x1, x2, x3]</code> will yield <code>f x3 (f x2 (f x1 z))</code>."}, {"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537623703, "post_id": 52456974, "comment_id": 91856673, "body": "It&#39;s really helpful, I got it, Thanks~~"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1537623712, "last_edit_date": 1537623712, "creation_date": 1537621874, "answer_id": 52456974, "question_id": 52456943, "link": "https://stackoverflow.com/questions/52456943/cannot-construct-the-infinite-type-when-using-foldl/52456974#52456974", "title": "cannot construct the infinite type when using foldl", "body": "<p>The signature of <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:foldl\" rel=\"nofollow noreferrer\"><strong><code>foldl</code></strong></a> is:</p>\n\n<pre><code>foldl :: (<b>b -&gt; a -&gt; b</b>) -&gt; b -&gt; [a] -&gt; b</code></pre>\n\n<p>We apply <code>foldl</code> with a function (<code>insertTree</code>) as well as a <code>Tree</code> and a list of <code>Int</code>s, so that means that <code>b ~ Tree Int</code>, and <code>a  ~ Int</code>.</p>\n\n<p>So that means that the thus far constructed <code>Tree</code> should be the first argument here.</p>\n\n<p>We can solve it by using <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:flip\" rel=\"nofollow noreferrer\"><strong><code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</code></strong></a>:</p>\n\n<pre><code>let numsTree = foldl <b>(flip</b> treeInsert<b>)</b> EmptyTree nums</code></pre>\n\n<p><code>flip</code> flips the parameters, so <code>f x y == flip f y x</code>.</p>\n\n<p><code>foldl</code> means that for a list <code>[8,6,4]</code>, we will apply it like:</p>\n\n<pre><code>insertTree 4 (insertTree 6 (insertTree 8 EmptyTree))\n</code></pre>\n\n<p>We can also decide to use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:foldr\" rel=\"nofollow noreferrer\"><strong><code>foldr :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code></strong></a> (notice that the order of the parameters has changed) like:</p>\n\n<pre><code>let numsTree = <b>foldr</b> treeInsert EmptyTree nums</code></pre>\n\n<p>then for a list <code>[8,6,4]</code> this will result in:</p>\n\n<pre><code>insertTree 8 (insertTree 6 (insertTree 4 EmptyTree))\n</code></pre>\n\n<p>Since the order in which elements are inserted in a <code>Tree</code> can have impact, the two are <em>semantically</em>, <em>not</em> equivalent.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "edited": false, "score": 0, "creation_date": 1537623558, "post_id": 52457110, "comment_id": 91856635, "body": "I got it. I was really confused about the position of elements from the list and the accumulated value. Thank you very much~"}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 2, "last_activity_date": 1537622866, "creation_date": 1537622866, "answer_id": 52457110, "question_id": 52456943, "link": "https://stackoverflow.com/questions/52456943/cannot-construct-the-infinite-type-when-using-foldl/52457110#52457110", "title": "cannot construct the infinite type when using foldl", "body": "<p>There are two differences between <code>foldr</code> and <code>foldl</code>.  The important one is the way they parenthesize their calculation:</p>\n\n<pre><code>foldl (+) 0 [1..3] = ((0 + 1) + 2) + 3\nfoldr (+) 0 [1..3] = 1 + (2 + (3 + 0))\n</code></pre>\n\n<p>The other one is that they expect their first argument (the function), to take <em>its</em> arguments in opposite order:</p>\n\n<pre><code>&gt; :t foldl\nfoldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n&gt; :t foldr\nfoldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>I believe the only reason for this second difference is to match the order that the expressions are written in the first code snippet.  You should choose between the functions based on which order of parentheses you want, and flip your function to match if necessary.</p>\n\n<p>So in your case, the two options are:</p>\n\n<pre><code>foldr treeInsert EmptyTree nums\nfoldl (flip treeInsert) EmptyTree nums\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 10400661, "user_type": "registered", "profile_image": "https://graph.facebook.com/711687962557096/picture?type=large", "display_name": "Frederick LI", "link": "https://stackoverflow.com/users/10400661/frederick-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 0, "accepted_answer_id": 52457110, "answer_count": 2, "score": 0, "last_activity_date": 1537623712, "creation_date": 1537621583, "question_id": 52456943, "link": "https://stackoverflow.com/questions/52456943/cannot-construct-the-infinite-type-when-using-foldl", "title": "cannot construct the infinite type when using foldl", "body": "<p>I defined a binary tree and used my functions to create a new tree.</p>\n\n<pre><code>data Tree a = EmptyTree | Node a (Tree a) (Tree a) deriving (Show)\n\nsingleton :: a -&gt; Tree a\nsingleton x = Node x EmptyTree EmptyTree\n\ntreeInsert :: (Ord a) =&gt; a -&gt; Tree a -&gt; Tree a\ntreeInsert x EmptyTree = singleton x\ntreeInsert x (Node a left right)\n    | x &lt; a     = Node a (treeInsert x left) right\n    | x &gt; a     = Node a left (treeInsert x right)\n    | otherwise = Node a left right\n</code></pre>\n\n<p>when I executed this in the terminal: </p>\n\n<pre><code>let nums = [8,6,4,1,7,3,5]\nlet numsTree= foldl treeInsert EmptyTree nums\n</code></pre>\n\n<p>It returned an error.</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: a ~ Tree a\nExpected type: Tree a -&gt; Tree a -&gt; Tree a\nActual type: a -&gt; Tree a -&gt; Tree a\n</code></pre>\n\n<p>however, after I changed foldl to foldr, it works.</p>\n\n<pre><code>let numsTree= foldr treeInsert EmptyTree nums\n</code></pre>\n\n<p>Can anyone tell me why? And what is the difference between foldl and foldr in this case, I am not clear with it. Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 1, "creation_date": 1537606170, "post_id": 52454990, "comment_id": 91852532, "body": "Change it to:  <code>thisItemNumber item = snd $ head $ filter (\\(i, _) -&gt; i == item) (zipItems items)</code> . The problem is that the operator <code>.</code> expects a function as parameter, but as you say, <code>zipItems item</code> is a list."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537606320, "post_id": 52454990, "comment_id": 91852573, "body": "You use the <code>.</code> the wrong way here."}, {"owner": {"reputation": 139, "user_id": 2569729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/874a73d3d8e6408c250cf0674e9853be?s=128&d=identicon&r=PG", "display_name": "Shillington", "link": "https://stackoverflow.com/users/2569729/shillington"}, "edited": false, "score": 1, "creation_date": 1537606577, "post_id": 52454990, "comment_id": 91852634, "body": "Ahh. Thanks! I could have also put brackets around everything except zipItems."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1537606618, "post_id": 52454990, "comment_id": 91852645, "body": "Other options: <code>(snd . head . filter (\\(i, _) -&gt; i == item)) (zipItems items)</code> or <code>snd . head . filter (\\(i, _) -&gt; i == item) $ zipItems items</code> or <code>snd . head $ filter (\\(i, _) -&gt; i == item) (zipItems items)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1537622989, "last_edit_date": 1537622989, "creation_date": 1537606945, "answer_id": 52455117, "question_id": 52454990, "link": "https://stackoverflow.com/questions/52454990/haskell-filter-applied-to-too-many-arguments/52455117#52455117", "title": "Haskell: Filter applied to too many arguments", "body": "<p>You somehow wrote a function that looks like a (wrong) mix between the a \"function pipeline\" (with the <code>(.)</code> operator), and an approach where you specify the parameter.</p>\n\n<p>Since you define a chain of functions, you need to put these between brackets if you perform function application with <code>zipItem items</code> here, since otherwise the function application only binds with the last item of the chain: the <code>filter (\\(i, _) -&gt; i == item)</code>. If you write:</p>\n\n<pre><code>f . g x\n</code></pre>\n\n<p>then this is interpeted as:</p>\n\n<pre><code>f . (g x)\n</code></pre>\n\n<p>But the <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> operator expects that the second operand is a function, where <code>filter (\\(i, _) -&gt; i == item) (zipItems items)</code> is a <code>[(Char, Int)]</code>, so the two do <em>not</em> match.</p>\n\n<p>So by adding brackets, we obtain:</p>\n\n<pre><code>thisItemNumber :: (Enum c, Num c) => Char -> c\nthisItemNumber item = <b>(</b>snd . head . filter (\\(i, _) -&gt; i == item)<b>)</b> (zipItems items)</code></pre>\n\n<p>Since it is possible that the element can not be found, it might however be useful to use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Maybe.html#v:listToMaybe\" rel=\"nofollow noreferrer\"><strong><code>listToMaybe :: [a] -&gt; Maybe a</code></strong></a> and return a <code>Maybe c</code>, such that it is clear that this function can fail to find the element:</p>\n\n<pre><code>import Data.Maybe(listToMaybe)\n\nthisItemNumber :: (Enum c, Num c) => Char -> Maybe c\nthisItemNumber item = (<b>listToMaybe</b> . map snd . filter ((item ==) . fst)) (zipItems items)</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Data.Maybe&gt; thisItemNumber 'L'\nNothing\nPrelude Data.Maybe&gt; thisItemNumber 'a'\nNothing\nPrelude Data.Maybe&gt; thisItemNumber 'T'\nJust 0\nPrelude Data.Maybe&gt; thisItemNumber 'e'\nJust 1\nPrelude Data.Maybe&gt; thisItemNumber 'X'\nNothing\n</code></pre>\n\n<p>That being said, what you here aim to do, already exists (well not with this specific values of course), with the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:elemIndex\" rel=\"nofollow noreferrer\"><strong><code>elemIndex :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int</code></strong></a> function.</p>\n\n<p>So the last function is equivalent to:</p>\n\n<pre><code>import Data.List(elemIndex)\n\nthisItemNumber :: (Enum c, Num c) => Char -> Maybe c\nthisItemNumber item = elemIndex item items</code></pre>\n\n<p>or we can unwrap the value from the <code>Just</code> data constructor with <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Maybe.html#v:fromJust\" rel=\"nofollow noreferrer\"><strong><code>fromJust :: Maybe a -&gt; a</code></strong></a>:</p>\n\n<pre><code>import Data.List(elemIndex)\nimport Data.Maybe(fromJust)\n\nthisItemNumber :: (Enum c, Num c) => Char -> c\nthisItemNumber item = fromJust (elemIndex item items)</code></pre>\n\n<p>although, as said before, this means that your function can error, which is typically <em>not</em> advisable.</p>\n"}, {"comments": [{"owner": {"reputation": 139, "user_id": 2569729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/874a73d3d8e6408c250cf0674e9853be?s=128&d=identicon&r=PG", "display_name": "Shillington", "link": "https://stackoverflow.com/users/2569729/shillington"}, "edited": false, "score": 0, "creation_date": 1537634696, "post_id": 52455141, "comment_id": 91859667, "body": "Thanks. I didn&#39;t want to use <code>elemIndex</code> because as you say it has a Maybe return type which I&#39;ve found generally adds nothing to the code except a load of wrappers everywhere. Abusing it with <code>fromJust</code> seems OK though."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1537607421, "last_edit_date": 1537607421, "creation_date": 1537607119, "answer_id": 52455141, "question_id": 52454990, "link": "https://stackoverflow.com/questions/52454990/haskell-filter-applied-to-too-many-arguments/52455141#52455141", "title": "Haskell: Filter applied to too many arguments", "body": "<p>You're using <code>.</code> there. The <code>.</code> operator creates a pipeline of functions:</p>\n\n<pre><code>(f . g) x = f (g x)\n</code></pre>\n\n<p>In your case the code is</p>\n\n<pre><code>snd . head . filter (\\(i, _) -&gt; i == item) (zipItems items)\n</code></pre>\n\n<p><code>snd</code> is a function.</p>\n\n<p><code>head</code> is a function.</p>\n\n<p>But <code>filter (\\(i, _) -&gt; i == item) (zipItems items)</code> is not a function, it's a list.</p>\n\n<p>That's why you get an error: To be able to use <code>.</code>, you must give it a function.</p>\n\n<pre><code>* Couldn't match expected type `a -&gt; [(a0, c)]'\n              with actual type `[(Char, Integer)]'\n</code></pre>\n\n<p>says <code>.</code> expects some kind of function (which must return a list of tuples to satisfy <code>snd . head</code>), but what you're actually giving it is a list.</p>\n\n<p>Possible solutions:</p>\n\n<ul>\n<li><p>Don't use <code>.</code> at all:</p>\n\n<pre><code>snd (head (filter (\\(i, _) -&gt; i == item) (zipItems items)))\n</code></pre>\n\n<p>All of your functions are fully applied so you don't really need a function pipeline.</p></li>\n<li><p>Use <code>$</code> instead of parens:</p>\n\n<pre><code>snd $ head $ filter (\\(i, _) -&gt; i == item) $ zipItems items\n</code></pre>\n\n<p>Deeply nested code can be hard to decipher. We can get rid of <code>)))</code> by using <code>$</code> instead.</p></li>\n<li><p>Build a function pipeline, but immediately apply it to an argument:</p>\n\n<pre><code>(snd . head . filter (\\(i, _) -&gt; i == item) . zipItems) items\n</code></pre>\n\n<p>Now all operands of <code>.</code> are functions, but we take the whole thing and apply it to <code>items</code> at the end.</p></li>\n</ul>\n\n<p>Or you could just use the standard library and do</p>\n\n<pre><code>import Data.List\n\nthisItemNumber item = elemIndex item items\n</code></pre>\n\n<p>This slightly changes the return type of <code>thisItemNumber</code> to <code>Maybe Int</code> because it's possible that <code>item</code> doesn't appear in <code>items</code>. If you want to ignore this error:</p>\n\n<pre><code>import Data.List\nimport Data.Maybe\n\nthisItemNumber item = fromJust (elemIndex item items)\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 2569729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/874a73d3d8e6408c250cf0674e9853be?s=128&d=identicon&r=PG", "display_name": "Shillington", "link": "https://stackoverflow.com/users/2569729/shillington"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 500, "favorite_count": 0, "accepted_answer_id": 52455141, "answer_count": 2, "score": 2, "last_activity_date": 1537622989, "creation_date": 1537605727, "question_id": 52454990, "link": "https://stackoverflow.com/questions/52454990/haskell-filter-applied-to-too-many-arguments", "title": "Haskell: Filter applied to too many arguments", "body": "<p>I'm trying to get the index of a value in a list, doing so like this:</p>\n\n<pre><code>items = \"Test\"\nzipItems xs = zip xs [0..]\nthisItemNumber item = snd . head . filter (\\(i, _) -&gt; i == item) (zipItems items)\n</code></pre>\n\n<p>When I run this I get the following error:</p>\n\n<pre><code>* Couldn't match expected type `a -&gt; [(a0, c)]'\n              with actual type `[(Char, Integer)]'\n* Possible cause: `filter' is applied to too many arguments\n  In the second argument of `(.)', namely\n    `filter (\\ (i, _) -&gt; i == item) (zipItems items)'\n  In the second argument of `(.)', namely\n    `head . filter (\\ (i, _) -&gt; i == item) (zipItems items)'\n  In the expression:\n    snd . head . filter (\\ (i, _) -&gt; i == item) (zipItems items)\n* Relevant bindings include\n    thisItemNumber :: Char -&gt; a -&gt; c (bound at &lt;interactive&gt;:89:5)\n</code></pre>\n\n<p>Which I don't understand. In my mind:</p>\n\n<pre><code>zipItems items\n</code></pre>\n\n<p>has type <code>[(Char, Int)]</code></p>\n\n<pre><code>\\(i, _) -&gt; i == item\n</code></pre>\n\n<p>has type <code>(Char, a) -&gt; Bool</code></p>\n\n<p>and then I'm just applying filter to a type <code>a -&gt; Bool</code> and an <code>a</code>. How is this going wrong?</p>\n"}, {"tags": ["haskell", "types", "type-constraints", "type-constructor"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537635691, "post_id": 52454726, "comment_id": 91859957, "body": "the M is supposed to be substituted with I, E, P, S, O, L, ... defined later in the article."}], "answers": [{"comments": [{"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1537605711, "post_id": 52454940, "comment_id": 91852440, "body": "Got it, so basically it uses function bindM and unitM to introduce Monads rather than class Monad m. I am wondering if there is a way to achieve the same using class Monad m.. definition"}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1537605984, "post_id": 52454940, "comment_id": 91852491, "body": "This does not seem to work: data Value m = Wrong | Num Int | Func (Value -&gt; m Value):  Expecting one more argument to \u2018Value\u2019       Expected a type, but \u2018Value\u2019 has kind \u2018(k0 -&gt; *) -&gt; *\u2019     \u2022 In the type \u2018(Value -&gt; m Value)\u2019       In the definition of data constructor \u2018Func\u2019       In the data declaration for \u2018Value\u2019    | 13 |                | Func (Value -&gt; m Value)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1537607021, "post_id": 52454940, "comment_id": 91852740, "body": "Should be <code>Fun (Value m -&gt; m (Value m)</code>"}], "tags": [], "owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "is_accepted": false, "score": 1, "last_activity_date": 1537611697, "last_edit_date": 1537611697, "creation_date": 1537605325, "answer_id": 52454940, "question_id": 52454726, "link": "https://stackoverflow.com/questions/52454726/data-type-with-type-constraint-in-wadler-essence-of-functional-programming-pap/52454940#52454940", "title": "Data type with type constraint in Wadler - Essence of functional programming paper,", "body": "<p>M is not a constraint, it is a type constructor. So writing <code>M Value</code> is similar <code>[Value]</code>, <code>Maybe Value</code> etc. A constraint would be something like <code>Monad m =&gt; m Value</code>, where m is a type variable, not a type constructor and <code>Monad m</code> is the constraint (Monad is a type class).</p>\n\n<p>In the paper, the definition of the type <code>M value</code> has not been presented, and it is later shown that you can give it different definitions (the definitions would involve defining <code>data M v = ...</code> and the functions <code>bindM</code> and <code>unitM</code>).</p>\n\n<p>Edit: If you wanted to have a constraint, you would change the definition of value like this:</p>\n\n<pre><code>data Value m = Wrong\n             | Num Int\n             | Fun (Value m -&gt; m (Value m))\n</code></pre>\n\n<p>And then have the constraint in the types of functions, e.g.:</p>\n\n<pre><code>interp :: Monad m =&gt; Term -&gt; Environment -&gt; m (Value m)\n</code></pre>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537611697, "creation_date": 1537603459, "last_edit_date": 1537605676, "question_id": 52454726, "link": "https://stackoverflow.com/questions/52454726/data-type-with-type-constraint-in-wadler-essence-of-functional-programming-pap", "title": "Data type with type constraint in Wadler - Essence of functional programming paper,", "body": "<p>In Phil Wadler's paper : The essence of functional programming, Wadler describes the application of Monads using a simple interpreter program. The program is as shown below:</p>\n\n<blockquote>\n  <p>A term is either a variable, a constant, a sum, a lambda expression,\n  or an application. The following will serve as test data.</p>\n\n<pre><code>term0 = (App (Lam \"x\" (Add (Var \"x\") (Var \"x\"))) (Add (Con 10) (Con 11)))\n</code></pre>\n  \n  <p>For our purposes, a monad is a triple <code>(M,unitM,bindM)</code> consisting of a\n  type constructor <code>M</code> and a pair of polymorphic functions.</p>\n\n<pre><code>unitM :: a -&gt; M a\nbindM :: M a -&gt; (a -&gt; M b) -&gt; M b\n</code></pre>\n</blockquote>\n\n<p>Then the interpreter program is described as:</p>\n\n<pre><code>type Name = String\n\ndata Value = Wrong\n           | Num Int\n           | Fun (Value -&gt; M Value)\n</code></pre>\n\n<p>I do not see how <code>M Value</code> has been included here. My understanding that Haskell does not allow type constraints on data type constructors?</p>\n\n<p>Further details:\nThe complete program is below:</p>\n\n<pre><code>type Name = String\ndata Term = Var Name\n          | Con Int\n          | Add Term Term\n          | Lam Name Term\n          | App Term Term\ndata Value = Wrong\n           | Num Int\n           | Fun (Value -&gt; M Value)\ntype Environment = [(Name, Value)]\ninterp :: Term -&gt; Environment -&gt; M Value\ninterp (Var x) e = lookup x e\ninterp (Con i) e = unitM (Num i)\ninterp (Add u v) e = interp u e `bindM` (\\a -&gt;\n                                            interp v e `bindM` (\\b -&gt;\n                                                                  add a b))\ninterp (Lam x v) e = unitM (Fun (\\a -&gt; interp v ((x,a):e)))\ninterp (App t u) e = interp t e `bindM` (\\f -&gt;\n                                             interp u e `bindM` (\\a -&gt;\n                                                                     apply f a))\n\nlookup :: Name -&gt; Environment -&gt; M Value\nlookup x [] = unitM Wrong\nlookup x ((y,b):e) = if x==y then unitM b else lookup x e\n\nadd :: Value -&gt; Value -&gt; M Value\nadd (Num i) (Num j) = unitM (Num (i+j))\nadd a b = unitM Wrong\n\napply :: Value -&gt; Value -&gt; M Value\napply (Fun k) a = k a\napply f a = unitM Wrong\n</code></pre>\n\n<p>As can be seen\n<code>interp (Lam x v) e = unitM (Fun (\\a -&gt; interp v ((x,a):e)))</code> requires definition <code>data Value = ... | Func (Value -&gt; M Value)</code></p>\n\n<p>I tried to implement <code>interp (Lam x v)</code> by using <code>data Value = ... | Func (Value -&gt; Value)</code>, but it did not seem possible to me.</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537597096, "post_id": 52454039, "comment_id": 91850902, "body": "Why did you write <code>[0..n^n-2]</code> here at the end?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537597333, "post_id": 52454039, "comment_id": 91850940, "body": "Hint: use a 2-tuple as <code>b</code>."}, {"owner": {"reputation": 141, "user_id": 10394930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5fc94932382e087ae14e58bade83cbc?s=128&d=identicon&r=PG&f=1", "display_name": "newb346", "link": "https://stackoverflow.com/users/10394930/newb346"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537598417, "post_id": 52454039, "comment_id": 91851140, "body": "Silly me. I corrected it"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1537603962, "post_id": 52454039, "comment_id": 91852077, "body": "See also <a href=\"https://stackoverflow.com/q/15538151/1048572\">stackoverflow.com/q/15538151/1048572</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1537606882, "post_id": 52454039, "comment_id": 91852704, "body": "In cases like this, it often helps writing an explicit recursive function (with possibly more arguments as needed), and then convert it to a fold later on."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1537609719, "post_id": 52454039, "comment_id": 91853347, "body": "<code>Node (Leaf 0 Leaf)</code> is invalid expression. It should be <code>(Node Leaf 0 Leaf)</code> or just <code>Node Leaf 0 Leaf</code>."}], "answers": [{"tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 4, "last_activity_date": 1537603469, "creation_date": 1537603469, "answer_id": 52454728, "question_id": 52454039, "link": "https://stackoverflow.com/questions/52454039/attempting-to-construct-trees-in-haskell/52454728#52454728", "title": "Attempting to construct trees in Haskell", "body": "<blockquote>\n  <p>If I was to use a 2-tuple, what would I combine?</p>\n</blockquote>\n\n<p>I would recommend to pass the remaining depth as well as the offset from the left:</p>\n\n<pre><code>build = unfoldT level . (0,)\n  where\n    level (_, 0) = Nothing\n    level (o, n) = let mid = 2^(n-1)\n                   in ((o, n-1), o+mid-1, (o+mid, n-1))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1537611820, "post_id": 52455632, "comment_id": 91853838, "body": "I like the idea of passing through the <code>nextNum</code> as state (it avoids the repeated calculations that my answer has), but I don&#39;t think this approach is doable with <code>unfold</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1537611903, "post_id": 52455632, "comment_id": 91853861, "body": "I haven&#39;t thought it through yet... I had this suspicion too but I&#39;m not sure. In any way writing it out this way helps clarify things ,as chi also suggests up in the comments. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1537612011, "post_id": 52455632, "comment_id": 91853882, "body": "or we could produce <code>Tree (a, next_num_or_something)</code> as another intermediate step..."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1537612343, "post_id": 52455632, "comment_id": 91853954, "body": "Well you could always create a temporary tree manually and then <code>unfold</code> it into the real tree, but that&#39;s (ab)using <code>unfold</code> as <code>fmap</code> and we could just drop it, constructing the proper result in the first place."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1537631522, "post_id": 52455632, "comment_id": 91858743, "body": "yeah, looks like it is impossible to do with the <code>unfoldT</code> as defined in the question. the function <code>s -&gt; Maybe (s, a, s)</code> must produce the <code>a</code> <i>and</i> the two <code>s</code>&#39;s at the same time, so it doesn&#39;t fit. interesting, this example really shows the difference between recursion and corecursion, on <i>trees</i>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1537611644, "last_edit_date": 1537611644, "creation_date": 1537610998, "answer_id": 52455632, "question_id": 52454039, "link": "https://stackoverflow.com/questions/52454039/attempting-to-construct-trees-in-haskell/52455632#52455632", "title": "Attempting to construct trees in Haskell", "body": "<blockquote>\n  <p>If I was to use a 2-tuple, what would I combine? </p>\n</blockquote>\n\n<p>That's the key question behind the state-passing paradigm in functional programming, expressed also with the State Monad. We won't be dealing with the latter here, but maybe use the former.</p>\n\n<p>But before that, do we really need to generate all the numbers in a list, and then work off that list? Don't we know <em>in advance</em> what are the numbers we'll be working with?</p>\n\n<p>Of course we do, because the tree we're building is totally balanced and fully populated.</p>\n\n<p>So if we have a function like</p>\n\n<pre><code>-- build2 (depth, startNum)\nbuild2 :: (Int, Int) -&gt; Tree Int\n</code></pre>\n\n<p>we can use it <em>just the same</em> to construct <em>both halves</em> of e.g. the <code>build [0..14]</code> tree:</p>\n\n<pre><code>build [0..14] == build2 (4,0) == Node (build2 (3,0)) 7 (build2 (3,8))\n</code></pre>\n\n<p>Right?</p>\n\n<p>But if we didn't want to mess with the direct calculations of all the numbers involved, we could arrange for the aforementioned state-passing, with the twist to <code>build2</code>'s interface:</p>\n\n<pre><code>--     depth, startNum    tree, nextNum\nbuild3 :: (Int, Int) -&gt; (Tree Int, Int)\n</code></pre>\n\n<p>and use it like</p>\n\n<pre><code>build :: Int -&gt; Tree Int                 -- correct!\nbuild depth = build3 (depth, 0)          -- intentionally incorrect\n\nbuild3 :: (Int, Int) -&gt; (Tree Int, Int)  -- correct!\nbuild3 (depth, start) = Node lt n rt     -- intentionally incorrect\n  where\n       (lt, n) = build3 (depth-1, start)   -- n is returned\n       (rt, m) = build3 (depth-1, n+1)     --  and used, next\n</code></pre>\n\n<p>You will need to tweak the above to make all the pieces fit together (<em>follow the types!</em>), implementing the missing pieces of course and taking care of the corner / base cases.</p>\n\n<p>Formulating this as an unfold would be the next step.</p>\n"}], "owner": {"reputation": 141, "user_id": 10394930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5fc94932382e087ae14e58bade83cbc?s=128&d=identicon&r=PG&f=1", "display_name": "newb346", "link": "https://stackoverflow.com/users/10394930/newb346"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1537611644, "creation_date": 1537596918, "last_edit_date": 1537598399, "question_id": 52454039, "link": "https://stackoverflow.com/questions/52454039/attempting-to-construct-trees-in-haskell", "title": "Attempting to construct trees in Haskell", "body": "<p>I am trying to use an unfold function to build trees.</p>\n\n<pre><code>Tree t = Leaf | Node (Tree t) t (Tree t)\n\nunfoldT :: (b -&gt; Maybe (b, a, b)) -&gt; b -&gt; Tree a\nunfoldT f b =\n    case f b of\n      Nothing -&gt; Leaf\n      Just (lt, x, rt) -&gt; Node (unfoldT f lt) x (unfoldT f rt)\n</code></pre>\n\n<p>The build function needs to create a tree that has a height equal to the number provided, as well as be numbered in an in-order fashion. The base case being build 0 = Leaf and the next being build 1 = Node (Leaf 0 Leaf).</p>\n\n<pre><code>build :: Integer -&gt; Tree Integer\n</code></pre>\n\n<p>My attempt at solving it:</p>\n\n<pre><code>build n = unfoldT (\\x -&gt; Just x) [0..2^n-2]\n</code></pre>\n\n<p>I am not entirely sure how to go about constructing the tree here.\nWould love it if somebody could point me in the right direction.</p>\n\n<p>Edit 1:</p>\n\n<p>If I was to use a 2-tuple, what would I combine? I need to be able to refer to the current node, its left subtree and its right subtree somehow right?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 3076906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ea9268b379640272ae25cd797754982d?s=128&d=identicon&r=PG&f=1", "display_name": "user3076906", "link": "https://stackoverflow.com/users/3076906/user3076906"}, "edited": false, "score": 0, "creation_date": 1537590868, "post_id": 52453333, "comment_id": 91850029, "body": "So, the first guard will update the value of m if it&#39;s less than n. What about the second guard? I tried calling the function recursively, but it gave an error since it&#39;s expecting an int rather than a list of strings."}, {"owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "edited": false, "score": 0, "creation_date": 1537622451, "post_id": 52453333, "comment_id": 91856334, "body": "The second guard is where you say what the result should be when m is no longer less than n.  If you want to finish, then you would not use recursion there; just write an expression for the answer.  Of course, that means you have to know the answer!  Chances are, you want another argument to <code>loop</code> that keeps a running answer, in addition to the counter.  But without knowing what you&#39;re trying to compute, it&#39;s hard to say for sure."}, {"owner": {"reputation": 33, "user_id": 3076906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ea9268b379640272ae25cd797754982d?s=128&d=identicon&r=PG&f=1", "display_name": "user3076906", "link": "https://stackoverflow.com/users/3076906/user3076906"}, "edited": false, "score": 0, "creation_date": 1537636790, "post_id": 52453333, "comment_id": 91860275, "body": "I see, that makes sense. The purpose of somefunction was to concatenate two lists of strings. Before the two lists are concatenated together, I would call another function to modify the list l in some way. The other function will simply use the same list twice to distribute the contents of each element with each other.  I would still like to figure how to do it with a helper function, so that I can see how to do it both ways."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1537588292, "creation_date": 1537588292, "answer_id": 52453333, "question_id": 52453081, "link": "https://stackoverflow.com/questions/52453081/how-to-update-a-value-created-with-let-in-a-recursive-function/52453333#52453333", "title": "How to update a value created with let in a recursive function", "body": "<p>You do indeed need a helper function that calls itself with an updated argument each time.</p>\n\n<pre><code>somefunction l n = loop 0\n  where\n    loop m\n      | m &lt; n = ...\n      | otherwise = ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33, "user_id": 3076906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ea9268b379640272ae25cd797754982d?s=128&d=identicon&r=PG&f=1", "display_name": "user3076906", "link": "https://stackoverflow.com/users/3076906/user3076906"}, "is_accepted": false, "score": 0, "last_activity_date": 1537597794, "creation_date": 1537597794, "answer_id": 52454140, "question_id": 52453081, "link": "https://stackoverflow.com/questions/52453081/how-to-update-a-value-created-with-let-in-a-recursive-function/52454140#52454140", "title": "How to update a value created with let in a recursive function", "body": "<p>I ended up finding a solution after thinking about it for a while. I was thinking of using a helper function to keep track of the current iteration, but that was proving to be a bit difficult. In the end, I realized that I could simply call the recursive function in the opposite order so that the function would use the n and go all the way down to 0, then it would call otherfunction. This way, the result was printed in the correct order and I didn't have to use a helper function.</p>\n"}], "owner": {"reputation": 33, "user_id": 3076906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ea9268b379640272ae25cd797754982d?s=128&d=identicon&r=PG&f=1", "display_name": "user3076906", "link": "https://stackoverflow.com/users/3076906/user3076906"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 52453333, "answer_count": 2, "score": 0, "last_activity_date": 1537597794, "creation_date": 1537584635, "question_id": 52453081, "link": "https://stackoverflow.com/questions/52453081/how-to-update-a-value-created-with-let-in-a-recursive-function", "title": "How to update a value created with let in a recursive function", "body": "<p>I'm trying to write a recursive function that keeps going until a certain number is reached. The function has two parameters. The first is a list of strings, while the second is a number that tells me how many iterations I'm supposed to do. I've tried using let in the beginning, but I'm having a hard time figuring out how to increment the value I declare using let. </p>\n\n<p>My function looks something like this.</p>\n\n<pre><code>    somefunction l n = let m = 0 in \n                       if (m &lt; n) then somefunction (otherfunction l m) n\n                       else l\n</code></pre>\n\n<p>This has the obvious problem that I don't increment the value of m anywhere so the function won't ever terminate. I'm still getting used to haskell so the syntax has been giving me some trouble. I feel like the solution to this should be pretty easy, but I can't seem to figure out how to go about it. I've thought of using a helper function that could increment the value of m and maybe call the otherfunction. This seems like the way to go, but I'm not sure on how to put it all together. </p>\n\n<p>This is a homework assignment, so I would appreciate any kind of hint on how to solve this problem. I have all my other functions working, I just need to make them all work together. </p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree", "fold"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1537570841, "post_id": 52451923, "comment_id": 91847288, "body": "<code>foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b</code> expects the first argument to be a function that takes 3 arguments. you&#39;ve given it a function that takes 2 arguments. basically the error says it can&#39;t make a value (the result of <code>f x acc</code>) be a function (the expected result of a functions of type <code>b -&gt; a -&gt; (b -&gt; b)</code>, which is equivalent to <code>b -&gt; a -&gt; b -&gt; b</code>)"}, {"owner": {"reputation": 43, "user_id": 10398898, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NOD9-2rcPMA/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUPNaFQRARzsn125zc8mVJtVlblqA/mo/photo.jpg?sz=128", "display_name": "starter", "link": "https://stackoverflow.com/users/10398898/starter"}, "reply_to_user": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1537571751, "post_id": 52451923, "comment_id": 91847446, "body": "I understand that but I am not completely sure what I would pass in as the third value in this case. First would be the value from the tree it self, second would be the accumulator. What might the third one be here?"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1537582927, "last_edit_date": 1537582927, "creation_date": 1537573926, "answer_id": 52452266, "question_id": 52451923, "link": "https://stackoverflow.com/questions/52451923/variations-of-folds-on-haskell-trees/52452266#52452266", "title": "Variations of folds on Haskell Trees", "body": "<p>We can recover the linear, accumulator-passing folds from the data type-following tree-shaped folds by folding into <em>endofunctions</em>, like this:</p>\n\n<pre><code>data Tree a = Leaf | Node (Tree a) a (Tree a) deriving (Eq, Show)\n\n-- foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n\nfoldTreeR :: (a -&gt; r -&gt; r) -&gt; r -&gt; Tree a -&gt; r\nfoldTreeR cons z t = foldTree g id t z           -- b ~ r -&gt; r\n  where\n  g lt a rt = lt . cons a . rt \n</code></pre>\n\n<p>And the left fold:</p>\n\n<pre><code>foldTreeL :: (acc -&gt; a -&gt; acc) -&gt; acc -&gt; Tree a -&gt; acc\nfoldTreeL conj z t = foldTree g id t z           -- b ~ acc -&gt; acc\n  where\n  g lt a rt = rt . flip conj a . lt\n</code></pre>\n\n<hr>\n\n<p>More detailed explanations:</p>\n\n<p>Both <code>cons a</code> and <code>flip conj a</code> have type <code>r -&gt; r</code> (or <code>acc -&gt; acc</code>, which is the same). This is the type of functions with the types of argument and result being the same. </p>\n\n<p>Such functions are known as endofunctions, <em>endo</em> indicative of the sameness of their domain and codomain (the types on the right and left side of the arrow). As such, they <em>compose</em> easily: can participate in <code>(.)</code> operation, i.e. function composition, with the result of composition having the same type as the types of operands:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\n(f . g) x = f (g x)\n\n-- and for endofunctions,\n-- ((f :: r -&gt; r) . (g :: r -&gt; r)) :: r -&gt; r\n</code></pre>\n\n<p>For a tree with an in-order traversal of <code>[a,b,c,...,n]</code>, the right fold turns that tree into a composition</p>\n\n<pre><code>(cons a . cons b . cons c . ..... . cons n) z\n\n-- which is the same as\n-- cons a (cons b (cons c ... (cons n z) ... ))\n</code></pre>\n\n<p>and the left fold turns it into</p>\n\n<pre><code>(conj' n . ..... . conj' c . conj' b . conj' a) z\n</code></pre>\n\n<p>where</p>\n\n<pre><code>conj' a acc = flip conj a acc = conj acc a     -- by definition of `flip`\n\n-- so the above composition chain is the same as\n-- conj (... (conj (conj (conj z a) b) c) ...) n\n</code></pre>\n\n<p>with some <code>id</code>s sprinkled around that chain, each <code>Leaf</code> being turned into an <code>id</code>, having no effect on the whole chain, because</p>\n\n<pre><code>(id . f) x = id (f x) = f x = f (id x) = (f . id) x\n</code></pre>\n\n<p>so</p>\n\n<pre><code>id . f = f = f . id\n</code></pre>\n\n<p>i.e. <code>id</code> serving as a 'zero' element w.r.t. to the function composition operation, just like <code>0</code> does with the <code>+</code> operation (this, by the way, is referred to as <em>'monoid'</em> being formed by <code>.</code> and <code>id</code>, or by <code>0</code> and <code>+</code>).</p>\n\n<hr>\n\n<p>Here's how we'd create that in-order traversal list for a tree:</p>\n\n<pre><code>inorder :: Tree a -&gt; [a]\ninorder t = foldTree g [] t\n  where\n  g lt a rt = lt ++ [a] ++ rt\n</code></pre>\n\n<p>So the list <code>[a,b,...,n]</code> is actually created as</p>\n\n<pre><code>[] ++ [a] ++ [] ++ [b] ++ [] ++ ... ++ [n] ++ []\n</code></pre>\n\n<p>and the right fold of that tree would be created as</p>\n\n<pre><code>(id . cons a . id . cons b . id . .... . cons n . id) z\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1537644439, "last_edit_date": 1537644439, "creation_date": 1537608805, "answer_id": 52455361, "question_id": 52451923, "link": "https://stackoverflow.com/questions/52451923/variations-of-folds-on-haskell-trees/52455361#52455361", "title": "Variations of folds on Haskell Trees", "body": "<p>Here's how you could have come up with the solution yourself.</p>\n\n<p>We have</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tree a =                               Leaf \n            | Node (Tree a) a (Tree a)                   deriving (Eq, Show)\n\nfoldTree :: (        b -&gt;   a -&gt;   b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n\nfoldTree    (g :: b -&gt;   a -&gt;   b -&gt; b) (z :: b) :: Tree a -&gt; b\n</code></pre>\n\n<p>So given <code>g</code> and <code>z</code> this function turns a <code>Tree a</code> value into a <code>b</code> value by turning the sub-trees of <code>t</code> into <code>b</code>s and combining them with the tree's <code>a</code>, through <code>g</code>.</p>\n\n<p>Can we <strong><em><code>map</code></em></strong> over these trees, using <code>foldTree</code>? Yes:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mapTree :: (a -&gt; c) -&gt; Tree a -&gt; Tree c\nmapTree f t = foldTree g z t\n  where\n  -- we need to create a Node with the mapped element inside it\n  -- already having the transformed sub-trees. Well, \n  -- creating Tree values is the job of that type's data constructors:\n  g lt a rt = Node lt (f a) rt      -- f is applied to the element `a`\n  -- and all leaves are transformed into the same value, which is:\n  z = Leaf\n</code></pre>\n\n<p>So now we have <code>mapTree (f :: a -&gt; c) :: Tree a -&gt; Tree c</code>. How does this help us? </p>\n\n<p>What do we want? We want</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldTreeR :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n-- i.e.\nfoldTreeR (cons :: a -&gt; r -&gt; r) (nil :: r) :: Tree a -&gt; r\n</code></pre>\n\n<p>So we have <code>cons</code>, such that <code>cons (x :: a) :: r -&gt; r</code>. </p>\n\n<p>What if we <em>map this <code>cons</code></em> over a Tree? The type <code>a -&gt; r -&gt; r</code> is actually <code>a -&gt; (r -&gt; r)</code>, and indeed we just saw that <code>cons</code> turns an <code>(x :: a)</code> into <code>r -&gt; r</code> (<em>read it: turns a value <code>x</code> or type <code>a</code> into a value of type <code>r -&gt; r</code></em>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mapTree (cons :: a -&gt; r -&gt; r) :: Tree a -&gt; Tree (r -&gt; r)\n</code></pre>\n\n<p>Why would we want <em>that</em>? What can we do with all those <code>r -&gt; r</code> functions we now have in the tree's nodes? Well, we can turn a tree into a list of the values in its nodes, by an in-order traversal:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inorder :: Tree d -&gt; [d]\ninorder t = foldTree (\\l a r -&gt; l ++ a : r) [] t\n</code></pre>\n\n<p>so we can have</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inorder . mapTree (cons :: a -&gt; r -&gt; r) :: [r -&gt; r]\n          -----------------\n          Tree a -&gt; Tree (r -&gt; r)\n--------\nTree (r-&gt;r) -&gt; [r-&gt;r]\n</code></pre>\n\n<p>and we can <em>compose</em> all these functions inside that list, <em>linearly</em>, to arrange for the right-to-left  result-passing operation which <em>is</em> ... the <em>right fold!</em></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldTreeR_ :: (a -&gt; r -&gt; r) -&gt; r -&gt; Tree a -&gt; r\nfoldTreeR_ cons z t = foldr ($) z (inorder $ mapTree cons t)\n           -- or, equivalently,\n           --         foldr (.) id (inorder $ mapTree cons t) z\n</code></pre>\n\n<p>That's it.</p>\n\n<p>If we inline everything and simplify the resulting definitions, we get the one in the other answer.</p>\n\n<p>Same for the left folding. Try it.</p>\n"}], "owner": {"reputation": 43, "user_id": 10398898, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NOD9-2rcPMA/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUPNaFQRARzsn125zc8mVJtVlblqA/mo/photo.jpg?sz=128", "display_name": "starter", "link": "https://stackoverflow.com/users/10398898/starter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "accepted_answer_id": 52452266, "answer_count": 2, "score": 4, "last_activity_date": 1537644439, "creation_date": 1537570464, "last_edit_date": 1537574583, "question_id": 52451923, "link": "https://stackoverflow.com/questions/52451923/variations-of-folds-on-haskell-trees", "title": "Variations of folds on Haskell Trees", "body": "<p>Given a tree defined to be:</p>\n\n<pre><code>data Tree a = Leaf | Node (Tree a) a (Tree a) deriving (Eq, Show)\n</code></pre>\n\n<p>I want to use the function:</p>\n\n<pre><code>foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldTree _ b Leaf         = b\nfoldTree f b (Node lt x rt) = f (foldTree f b lt) x (foldTree f b rt)\n</code></pre>\n\n<p>To be able to create equivalents of the normal <code>foldr</code> and <code>foldl</code> as:</p>\n\n<pre><code>foldTreeR :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldTreeL :: (b -&gt; a -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n</code></pre>\n\n<p>I thought these would be fairly straightforward since their definitions mimic those of <code>foldr</code> and <code>foldl</code> pretty much exactly. I assumed that all I would have to do would be plug in the values analogously in a similar manner so I would write an anonymous function, an accumulator with the base state of my tree and the tree that needs to be processed. The lambda function would have to vary based on the type of fold being done.</p>\n\n<p>Here is what I came up with:</p>\n\n<pre><code>foldTreeR :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldTreeR f acc t =  foldTree (\\x acc -&gt; f x acc) acc t\n</code></pre>\n\n<p>I get the error:</p>\n\n<blockquote>\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018a -&gt; b\u2019 \n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          foldTreeR :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n        at Folds.hs:294:14\n      Expected type: Tree (a -&gt; b)\n        Actual type: Tree a\n</code></pre>\n</blockquote>\n\n<p>I am not really sure how I should pass in the original tree in this case. </p>\n\n<p>It seems the left fold will just be a variation of the same with the values within the lambda function re-ordered as well as evaluated differently.</p>\n\n<p>Could someone help me understand how a solution can be reached here?</p>\n"}, {"tags": ["haskell", "types", "maybe"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1537549616, "post_id": 52448050, "comment_id": 91839446, "body": "What is the exact error message? <code>ghc</code> puts out a bunch of useful information the message, and saves us from guessing."}, {"owner": {"reputation": 770, "user_id": 4798397, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh4.googleusercontent.com/-RbvyOI92KHs/AAAAAAAAAAI/AAAAAAAAAEk/B4Yg7W9lXAk/photo.jpg?sz=128", "display_name": "The Coding Wombat", "link": "https://stackoverflow.com/users/4798397/the-coding-wombat"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1537549776, "post_id": 52448050, "comment_id": 91839509, "body": "Added it to the question"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1537550335, "post_id": 52448050, "comment_id": 91839743, "body": "Not trying to be snarky: have you tried to understand the error message? If so what do you think it&#39;s telling you and where are you confused? (reading error messages from the type-checker is an important skill)"}, {"owner": {"reputation": 770, "user_id": 4798397, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh4.googleusercontent.com/-RbvyOI92KHs/AAAAAAAAAAI/AAAAAAAAAEk/B4Yg7W9lXAk/photo.jpg?sz=128", "display_name": "The Coding Wombat", "link": "https://stackoverflow.com/users/4798397/the-coding-wombat"}, "edited": false, "score": 0, "creation_date": 1537550785, "post_id": 52448050, "comment_id": 91839929, "body": "That elemIndex returns a &quot;Maybe Int&quot;, but (!!) simply uses an Int"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537552243, "post_id": 52448050, "comment_id": 91840559, "body": "I want to paraphrase what the compiler is telling you. I hope you&#39;ll find it helpful. &quot;The <code>header</code> for the table might not have <code>column</code> in it anywhere. You have to tell me how you want <code>select</code> to behave when that happens, and you haven&#39;t done so.&quot;"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1537552859, "post_id": 52448050, "comment_id": 91840847, "body": "If you actually finished the <code>case</code> expression (what is the value if you match <code>Nothing</code>?), you&#39;d get rid of the parse error."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1537553193, "post_id": 52448050, "comment_id": 91841000, "body": "ah sorry, I see your issue was with the parse error rather than the type error (I should read more carefully myself)"}, {"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 0, "creation_date": 1537556991, "post_id": 52448050, "comment_id": 91842634, "body": "Your maybeValue function also has the wrong type, header is a Row, not a Field."}], "owner": {"reputation": 770, "user_id": 4798397, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh4.googleusercontent.com/-RbvyOI92KHs/AAAAAAAAAAI/AAAAAAAAAEk/B4Yg7W9lXAk/photo.jpg?sz=128", "display_name": "The Coding Wombat", "link": "https://stackoverflow.com/users/4798397/the-coding-wombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 310, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537549764, "creation_date": 1537548392, "last_edit_date": 1537549764, "question_id": 52448050, "link": "https://stackoverflow.com/questions/52448050/maybeint-to-int-with-elemindex", "title": "MaybeInt to Int with elemIndex", "body": "<p>I have a Table (list of list of string) and have a method \"select\" to remove certain rows. Select takes a column name and a value and removes all rows that don't have that value in that column. I used <code>elemIndex</code>, and get a type mismatch error (Maybe Int -> Int).</p>\n\n<pre><code>  type Field = String\n  type Row   = [Field]\n  type Table = [Row]\n\n  select :: Field -&gt; Field -&gt; Table -&gt; Table\n  select column value table@(header:rows)\n      = header : (filter rowHasValue rows)\n      where columnIndex     = elemIndex column header\n            rowHasValue row = (row !! columnIndex) == value;\n</code></pre>\n\n<p>I tried creating another function, but that gets a parse error on where</p>\n\n<pre><code>maybeValue :: Field -&gt; Field -&gt; Int\nmaybeValue column header = case maybeValue of\n                                Just n -&gt; n\n                                Nothing -&gt;\n    where maybeValue = elemIndex column header;\n</code></pre>\n\n<p>Exact error message:</p>\n\n<pre><code>Main.hs:85:39: error:\n    * Couldn't match expected type `Int' with actual type `Maybe Int'\n    * In the second argument of `(!!)', namely `columnIndex'\n      In the first argument of `(==)', namely `(row !! columnIndex)'\n      In the expression: (row !! columnIndex) == value\n   |\n85 |             rowHasValue row = (row !! columnIndex) == value\n</code></pre>\n"}, {"tags": ["haskell", "emacs", "cabal"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1537542053, "post_id": 52445706, "comment_id": 91835669, "body": "The new argument is probably a <i>deriving strategy</i>"}, {"owner": {"reputation": 65926, "user_id": 324105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b1ad4e4bdf8feaef18504593914fe16?s=128&d=identicon&r=PG", "display_name": "phils", "link": "https://stackoverflow.com/users/324105/phils"}, "edited": false, "score": 0, "creation_date": 1537572190, "post_id": 52445706, "comment_id": 91847523, "body": "I know nothing about any of this, but did you try the &quot;new-style&quot; project/commands that it recommends?"}, {"owner": {"reputation": 325, "user_id": 1171465, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8213f046d39a07aea3d3ad9346b78462?s=128&d=identicon&r=PG", "display_name": "The Dude", "link": "https://stackoverflow.com/users/1171465/the-dude"}, "edited": false, "score": 0, "creation_date": 1540895949, "post_id": 52445706, "comment_id": 93023218, "body": "There is a similar issue open on the github repo: <a href=\"https://github.com/chrisdone/structured-haskell-mode/issues/160\" rel=\"nofollow noreferrer\">github.com/chrisdone/structured-haskell-mode/issues/160</a> but the project hasn&#39;t seen much activity in the last 7 months or so.  I hope it&#39;s not dead as it is super cool Emacs mode for Haskell."}], "owner": {"reputation": 325, "user_id": 1171465, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8213f046d39a07aea3d3ad9346b78462?s=128&d=identicon&r=PG", "display_name": "The Dude", "link": "https://stackoverflow.com/users/1171465/the-dude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 203, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537539615, "creation_date": 1537539615, "question_id": 52445706, "link": "https://stackoverflow.com/questions/52445706/structured-haskell-mode-fails-to-install", "title": "Structured Haskell Mode fails to install", "body": "<p>I am trying to update my structured haskell mode using the cabal install command.  Unfortunately, it's failing</p>\n\n<pre><code>obelix:~ rk$ cabal install structured-haskell-mode\nWarning: The install command is a part of the legacy v1 style of cabal usage.\n\nPlease switch to using either the new project style and the new-install\ncommand or the legacy v1-install alias as new-style projects will become the\ndefault in the next version of cabal-install. Please file a bug if you cannot\nreplicate a working v1- use case with the new-style commands.\n\nFor more information, see: https://wiki.haskell.org/Cabal/NewBuild\n\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-command-line-argument]\nResolving dependencies...\nStarting     structured-haskell-mode-1.1.0\nBuilding     structured-haskell-mode-1.1.0\nFailed to install structured-haskell-mode-1.1.0\nBuild log ( /Users/rk/.cabal/logs/ghc-8.4.3/structured-haskell-mode-1.1.0-BtZnu5PUgZA64b8d6lKBIV.log ):\ncabal: Entering directory '/var/folders/m7/cw4w1yc11pv_t25pmlyqc4qm0000gn/T/cabal-tmp-1494/structured-haskell-mode-1.1.0'\nConfiguring structured-haskell-mode-1.1.0...\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-command-line-argument]\nPreprocessing executable 'structured-haskell-mode' for structured-haskell-mode-1.1.0..\nBuilding executable 'structured-haskell-mode' for structured-haskell-mode-1.1.0..\n[1 of 1] Compiling Main             ( src/Main.hs, dist/build/structured-haskell-mode/structured-haskell-mode-tmp/Main.o )\n\nsrc/Main.hs:165:18: error:\n    \u2022 The constructor \u2018Deriving\u2019 should have 3 arguments, but has been given 2\n    \u2022 In the pattern: Deriving _ ds@(_ : _)\n      In the pattern: Just (Deriving _ ds@(_ : _))\n      In a case alternative:\n          Just (Deriving _ ds@(_ : _))\n            -&gt; [spanHSE\n                  (show \"InstHeads\")\n                  \"InstHeads\"\n                  (SrcSpan\n                     (srcSpanFilename start)\n                     (srcSpanStartLine start)\n                     (srcSpanStartColumn start)\n                     (srcSpanEndLine end)\n                     (srcSpanEndColumn end)) |\n                  Just (IRule _ _ _ (IHCon (SrcSpanInfo start _) _)) &lt;- [listToMaybe\n                                                                           ds],\n                  Just (IRule _ _ _ (IHCon (SrcSpanInfo end _) _)) &lt;- [listToMaybe\n                                                                         (reverse ds)]]\n    |\n165 |            Just (Deriving _ ds@(_:_)) -&gt;\n    |                  ^^^^^^^^^^^^^^^^^^^\ncabal: Leaving directory '/var/folders/m7/cw4w1yc11pv_t25pmlyqc4qm0000gn/T/cabal-tmp-1494/structured-haskell-mode-1.1.0'\ncabal: Error: some packages failed to install:\nstructured-haskell-mode-1.1.0-BtZnu5PUgZA64b8d6lKBIV failed during the\nbuilding phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>It seems that it's calling the <code>Deriving</code> constructor with the wrong number of arguments. Any suggestions for a quick fix? </p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "reply_to_user": {"reputation": 127, "user_id": 9804298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051abd2dea67f677ad87560b0fdb86f8?s=128&d=identicon&r=PG&f=1", "display_name": "Rajesh", "link": "https://stackoverflow.com/users/9804298/rajesh"}, "edited": false, "score": 0, "creation_date": 1537617785, "post_id": 52443359, "comment_id": 91855244, "body": "@Rajesh great, feel free to accept the answer then :)"}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 4, "last_activity_date": 1537531335, "creation_date": 1537531335, "answer_id": 52443359, "question_id": 52442615, "link": "https://stackoverflow.com/questions/52442615/parse-error-on-input-in-haskell-yesod-framework/52443359#52443359", "title": "parse error on input `{&#39; in haskell yesod framework", "body": "<p>Put the following on top of your file:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n</code></pre>\n\n<p>See <a href=\"https://wiki.haskell.org/Quasiquotation\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Quasiquotation</a></p>\n"}], "owner": {"reputation": 127, "user_id": 9804298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051abd2dea67f677ad87560b0fdb86f8?s=128&d=identicon&r=PG&f=1", "display_name": "Rajesh", "link": "https://stackoverflow.com/users/9804298/rajesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1537531335, "creation_date": 1537528740, "last_edit_date": 1537531157, "question_id": 52442615, "link": "https://stackoverflow.com/questions/52442615/parse-error-on-input-in-haskell-yesod-framework", "title": "parse error on input `{&#39; in haskell yesod framework", "body": "<p>I could not understand why this error is occurred<br>\nI have created yesod-sqlite project using stack command as follow the instruction in yesod quick start after creating It's working fine. but I want to add my page by follow the instruction and example in <a href=\"https://www.schoolofhaskell.com/user/yogsototh/a-yesod-tutorial\" rel=\"nofollow noreferrer\">this</a> example</p>\n\n<p>Echo.hs handler code is as follows:</p>\n\n<p>module Handler.Echo where</p>\n\n<pre><code>import Import\nimport           Data.Text (Text)\nimport qualified Data.Text as T\nimport           Yesod\n\ngetEchoR :: Text -&gt; Handler Html\ngetEchoR theText = defaultLayout [whamlet|&lt;h1&gt;Hello #{theText}!|]\n</code></pre>\n\n<p>When I run yesod devel in command prompt I got the following error:</p>\n\n<blockquote>\n  <p>E:\\haskell\\yesod-new\\src\\Handler\\Echo.hs:9:58: error: parse error on\n  input `{'   | 9 |     getEchoR theText = defaultLayout\n  [whamlet|Hello #{theText}!|]   |<br>\n  ^</p>\n  \n  <p>--  While building custom Setup.hs for package yesod-new-0.0.0 using:\n        C:\\Users\\RajeshTarle\\AppData\\Roaming\\stack\\setup-exe-cache\\x86_64-windows\\\n  Cabal-simple_Z6RU0evB_2.2.0.1_ghc-8.4.3.exe\n  --builddir=.stack-work\\dist\\7d103d30  build lib:yesod-new --ghc-options \" -ddump-hi -ddump-to-file\"\n      Process exited with code: ExitFailure 1 Type help for available commands. Press enter to force a rebuild.</p>\n</blockquote>\n\n<p>I am using Windows please help me. \nThanks.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1537520619, "post_id": 52438196, "comment_id": 91823154, "body": "What have you tried? Where are you having trouble?"}], "answers": [{"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1537697991, "post_id": 52440630, "comment_id": 91871983, "body": "Thank you - although I think that I would still end up with duplication; for I need to prohibit only <i>certain</i> lines duplicating, which means that the duplication check would need to know about which lines, and the parsing would also need to know about which lines."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1537774453, "post_id": 52440630, "comment_id": 91890625, "body": "@user3416536 I see. In that case you could have something like <code>parseMap :: Parsec (Map ByteString [(SourcePos, ByteString)])</code> and then <code>parseValues</code> would check if the map contains one or more occurrences of values for a certain key. If you need, I can elaborate a bit on working with <code>SourcePos</code>."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1537817124, "post_id": 52440630, "comment_id": 91913479, "body": "Agreed, that could work.  I like the &#39;pure&#39; parsec approach that @k-a-buhr refers, and am reading the paper - but if I can&#39;t make that work, I will try this approach."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1538229841, "post_id": 52440630, "comment_id": 92075178, "body": "@user3416536 The pure approach looks very nice indeed, but I&#39;d say in this case it might be less practical."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1538329919, "post_id": 52440630, "comment_id": 92096280, "body": "You might well be right, and I appreciate the alternative suggestion.  But I&#39;m more worried about clean code and improving my understanding than about performance here."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 1, "last_activity_date": 1537521995, "creation_date": 1537521995, "answer_id": 52440630, "question_id": 52438196, "link": "https://stackoverflow.com/questions/52438196/how-to-parse-a-series-of-lines-with-only-a-few-interesting-ones-with-parsec-in/52440630#52440630", "title": "How to parse a series of lines (with only a few interesting ones) with Parsec in Haskell", "body": "<p>Indeed a simple solution would be to parse the file into <code>Map ByteString ByteString</code>, checking for duplicates while parsing, and then build the target result from that, checking that all required fields are present.</p>\n\n<pre><code>parseMap :: Parsec (Map ByteString ByteString)\n-- ...\n\nparseValues :: Map ByteString ByteString -&gt; Parsec MyDataStructure\n-- ...\n</code></pre>\n\n<p>Function <code>parseValues</code> can use <code>Parsec</code> again to parse the fields (perhaps using <a href=\"http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Prim.html#v:runP\" rel=\"nofollow noreferrer\"><code>runP</code></a> on each one) and to report errors or missing fields.</p>\n\n<p>The disadvantage of this solution that parsing is done on two levels (once to get <code>ByteString</code>s and the second time to parse them). And that this way we can't report correctly the position of errors found in <code>parseValues</code>. However, Parsec allows to get and set the current position in a file, so it might be feasible to include them in the map, and then use them when parsing the individual strings:</p>\n\n<pre><code>parseMap :: Parsec (Map ByteString (SourcePos, ByteString))\n</code></pre>\n\n<hr>\n\n<p>Using Parsec directly to parse the full result might be possible, but I'm afraid it'd be tricky to accomplish to allow arbitrary order and at the same time different output types of the fields.</p>\n"}, {"comments": [{"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 0, "creation_date": 1537567514, "post_id": 52451496, "comment_id": 91846475, "body": "Thinking about it, there might be a performance gain instead of a loss, since the parsers are so simple (and reject most lines after a few character instead of parsing all of them)."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1537698072, "post_id": 52451496, "comment_id": 91872003, "body": "Thank you, I was wondering about this myself.  I may well give it a go, although I will first try to fully understand @k-a-buhr&#39;s answer."}], "tags": [], "owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "is_accepted": false, "score": 1, "last_activity_date": 1537567140, "creation_date": 1537567140, "answer_id": 52451496, "question_id": 52438196, "link": "https://stackoverflow.com/questions/52438196/how-to-parse-a-series-of-lines-with-only-a-few-interesting-ones-with-parsec-in/52451496#52451496", "title": "How to parse a series of lines (with only a few interesting ones) with Parsec in Haskell", "body": "<p>If you don't mind a slight performance loss, write one parser for the width-line and one for the length-line and do something like this:</p>\n\n<pre><code>let ls = lines input in \n  case ([x | Right x &lt;- parseWidth ls], [x | Right x &lt;- parseLength ls]) of\n    ([w],[l]) -&gt; ...\n    _         -&gt; parserError ...\n</code></pre>\n\n<p>It's easy to add separate error cases for repetated/missing values without repeating anything. </p>\n"}, {"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1537697907, "post_id": 52459852, "comment_id": 91871971, "body": "Wow, thank you kindly.  It&#39;s going to take me a while to digest all of that, let alone understand it - but I really appreciate the detailed answer, and I shall work my way through it!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1537645498, "last_edit_date": 1537645498, "creation_date": 1537642423, "answer_id": 52459852, "question_id": 52438196, "link": "https://stackoverflow.com/questions/52438196/how-to-parse-a-series-of-lines-with-only-a-few-interesting-ones-with-parsec-in/52459852#52459852", "title": "How to parse a series of lines (with only a few interesting ones) with Parsec in Haskell", "body": "<p>Given that you want an \"elegant\" Parsec solution, I think you're looking for a variant of a permutation parser.</p>\n\n<p>For background reading, see the documentation for <code>Text.Parsec.Perm</code> and its more modern incarnation in module <code>Control.Applicative.Permutation</code> of the <code>parser-combinators</code> library.  In addition, this Functional Pearl paper <a href=\"https://www.cs.ox.ac.uk/jeremy.gibbons/wg21/meeting56/loeh-paper.pdf\" rel=\"nofollow noreferrer\">Parsing Permutation Phrases</a> describes the approach and is great fun to read.</p>\n\n<p>There are two special aspects to your problem:  First, I'm not aware of an existing permutation parser that allows for \"unmatched\" content before, between and after matched portions in a clean manner, and hacks like building the skip logic into the component parsers or deriving an extra parser to identify skippable lines for use in <code>intercalateEffect</code> from <code>Control.Applicative.Permutation</code> seem ugly.  Second, the special structure of your input -- the fact that the lines can be recognized by the identifier rather than only general component parsers -- means that we can write a more efficient solution than a usual permutation parser, one that looks up identifiers in a map instead of trying a list of parsers in sequence.</p>\n\n<p>Below is a possible solution.  On the one hand, it's using a sledgehammer to kill a fly.  In your simple situation, writing an ad hoc parser to read in the identifiers and their RHSs, check for required identifiers and duplicates, and then invoke identifier-specific parsers for the RHSs, seems more straightforward.  On the other hand, maybe there are more complicated scenarios where the solution below would be justified, and I think it's conceivable it might be useful to others.</p>\n\n<p>Anyway, here's the idea.  First, some preliminaries:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\nmodule ParseLines where\nimport Control.Applicative\nimport Control.Monad\nimport Data.List (intercalate)\nimport Text.Parsec (unexpected, eof, parseTest)\nimport Text.Parsec.Char (char, letter, alphaNum, noneOf, newline, digit)\nimport Text.Parsec.String (Parser)\nimport qualified Data.Map.Lazy as Map\nimport qualified Data.Set as Set\n</code></pre>\n\n<p>Let's say we have a data type representing the final result of the parse:</p>\n\n<pre><code>data Video = Video\n  { width :: Int\n  , height :: Int\n  } deriving (Show)\n</code></pre>\n\n<p>We're going to construct a <code>Permutation a</code> parser.  The type <code>a</code> is what we're going to eventually return (and in this case, it's always <code>Video</code>).  This <code>Permutation</code> will actually be a <code>Map</code> from \"known\" identifiers like <code>ID_VIDEO_WIDTH</code> to a special kind of parser that will parse the right-hand side for the given identifier (e.g., an integer like <code>700</code>) and then return -- not the parsed integer -- but a continuation <code>Permutation a</code> that parses the remaining data to construct a <code>Video</code>, with the parsed integer (e.g., <code>700</code>) \"baked in\" to the continuation.  The continuation will have a map that recognizes the \"remaining\" values, and we'll also keep track of known identifiers we've already read to flag duplicates.</p>\n\n<p>We'll use the following type:</p>\n\n<pre><code>type Identifier = String\ndata Permutation a = Permutation\n  -- \"seen\" identifiers for flagging duplicates\n  (Set.Set Identifier)\n  (Either\n    -- if there are more values to read, map identifier to a parser\n    -- that parses RHS and returns continuation for parsing the rest\n    (Map.Map Identifier (Parser (Permutation a)))\n    -- or we're ready for an eof and can return the final value\n    a)\n</code></pre>\n\n<p>\"Running\" such a parser involves converting it to a plain <code>Parser</code>, and this is where we implement the logic for identifying recognized lines, flagging duplicates, and skipping unrecognized identifiers.  First, here's a parser for identifiers.  If you wanted to be more lenient, you could use <code>many1 (noneOf \"\\n=\")</code> or something.</p>\n\n<pre><code>ident :: Parser String\nident = (:) &lt;$&gt; letter' &lt;*&gt; many alphaNum'\n  where letter' = letter &lt;|&gt; underscore\n        alphaNum' = alphaNum &lt;|&gt; underscore\n        underscore = char '_'\n</code></pre>\n\n<p>and here's a parser for skipping the rest of a line when we see an unrecognized identifier:</p>\n\n<pre><code>skipLine :: Parser ()\nskipLine = void $ many (noneOf \"\\n\") &gt;&gt; newline\n</code></pre>\n\n<p>Finally, here's how we run the <code>Permutation</code> parser:</p>\n\n<pre><code>runPermutation :: Permutation a -&gt; Parser a\nrunPermutation p@(Permutation seen e)\n  = -- if end of file, return the final answer (or error)\n    eof *&gt;\n    case e of\n      Left m -&gt; fail $\n        \"eof before \" ++ intercalate \", \" (Map.keys m)\n      Right a -&gt; return a\n  &lt;|&gt;\n    -- otherwise, parse the identifier\n    do k &lt;- ident &lt;* char '='\n       -- is it one we're waiting for?\n       case either (Map.lookup k) (const Nothing) e of\n         -- no, it's not, so check for duplicates and skip\n         Nothing -&gt; if Set.member k seen\n           then unexpected (\"duplicate \" ++ k)\n           else skipLine *&gt; runPermutation p\n         -- yes, it is\n         Just prhs -&gt; do\n           -- parse the RHS to get a continuation Permutation\n           -- and run it to parse rest of parameters\n           (prhs &lt;* newline) &gt;&gt;= runPermutation\n</code></pre>\n\n<p>To see how this is supposed to work, here's how we would <em>directly</em> construct a <code>Permutation</code> to parse a <code>Video</code>.  It's long, but not that complicated:</p>\n\n<pre><code>perm2 :: Permutation Video\nperm2 = Permutation\n  -- nothing's been seen yet\n  Set.empty\n  -- parse width or height\n  $ Left (Map.fromList\n   [ (\"ID_VIDEO_WIDTH\", do\n         -- parse the width\n         w &lt;- int\n         -- return a continuation permutation\n         return $ Permutation\n           -- we've seen width\n           (Set.fromList [\"ID_VIDEO_WIDTH\"])\n           -- parse height\n           $ Left (Map.fromList\n            [ (\"ID_VIDEO_HEIGHT\", do\n                  -- parse the height\n                  h &lt;- int\n                  -- return a continuation permutation\n                  return $ Permutation\n                    -- we've seen them all\n                    (Set.fromList [\"ID_VIDEO_WIDTH\", \"ID_VIDEO_HEIGHT\"])\n                    -- have all parameters, so eof returns the video\n                    $ Right (Video w h))\n            ]))\n   -- similarly for other permutation:\n   , (\"ID_VIDEO_HEIGHT\", do\n         h &lt;- int\n         return $ Permutation\n           (Set.fromList [\"ID_VIDEO_HEIGHT\"])\n           $ Left (Map.fromList\n            [ (\"ID_VIDEO_WIDTH\", do\n                  w &lt;- int\n                  return $ Permutation\n                    (Set.fromList [\"ID_VIDEO_WIDTH\", \"ID_VIDEO_HEIGHT\"])\n                    $ Right (Video w h))\n            ]))\n   ])\n\nint :: Parser Int\nint = read &lt;$&gt; some digit\n</code></pre>\n\n<p>You can test it like so:</p>\n\n<pre><code>testdata1 :: String\ntestdata1 = unlines\n  [ \"ID_SID_0_LANG=eng\"\n  , \"ID_VIDEO_FORMAT=H264\"\n  , \"ID_VIDEO_HEIGHT=574\"\n  , \"ID_START_TIME=0.00\"\n  , \"ID_SUBTITLE_ID=0\"\n  , \"ID_VIDEO_ID=0\"\n  , \"ID_VIDEO_FPS=25.000\"\n  , \"ID_VIDEO_WIDTH=700\"\n  ]\n\ntest1 :: IO ()\ntest1 = parseTest (runPermutation perm2) testdata1\n</code></pre>\n\n<p>You should be able to verify that it provides appropriate errors for missing keys, duplicate entries for known keys, and accepts keys in any order.</p>\n\n<p>Finally, we obviously don't want to construct permutation parsers like <code>perm2</code> manually, so we take a page from the <code>Text.Parsec.Perm</code> module and introduce the following syntax:</p>\n\n<pre><code>video :: Parser Video\nvideo = runPermutation (Video &lt;$$&gt; (\"ID_VIDEO_WIDTH\", int) &lt;||&gt; (\"ID_VIDEO_HEIGHT\", int))\n</code></pre>\n\n<p>and define operators to construct the necessary <code>Permutation</code> objects.  These definitions are a little tricky, but they follow pretty directly from the definition of <code>Permutation</code>.</p>\n\n<pre><code>(&lt;$$&gt;) :: (a -&gt; b) -&gt; (Identifier, Parser a) -&gt; Permutation b\nf &lt;$$&gt; xq = Permutation Set.empty (Right f) &lt;||&gt; xq\ninfixl 2 &lt;$$&gt;\n\n(&lt;||&gt;) :: Permutation (a -&gt; b) -&gt; (Identifier, Parser a) -&gt; Permutation b\np@(Permutation seen e) &lt;||&gt; (x, q)\n  = Permutation seen (Left (Map.insert x q' m'))\n  where\n    q' = (\\a -&gt; addQ x a p) &lt;$&gt; q\n    m' = case e of Right _ -&gt; Map.empty\n                   Left m -&gt; Map.map (fmap (&lt;||&gt; (x, q))) m\ninfixl 1 &lt;||&gt;\n\naddQ :: Identifier -&gt; a -&gt; Permutation (a -&gt; b) -&gt; Permutation b\naddQ x a (Permutation seen e)\n  = Permutation (Set.insert x seen) $ case e of\n      Right f -&gt; Right (f a)\n      Left m -&gt; Left (Map.map (fmap (addQ x a)) m)\n</code></pre>\n\n<p>and the final test:</p>\n\n<pre><code>test :: IO ()\ntest = parseTest video testdata1\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; test\nVideo {width = 700, height = 574}\n&gt;\n</code></pre>\n\n<p>Here's the final code, slightly rearranged:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\nmodule ParseLines where\n\nimport Control.Applicative\nimport Control.Monad\nimport Data.List (intercalate)\nimport Text.Parsec (unexpected, eof, parseTest)\nimport Text.Parsec.Char (char, letter, alphaNum, noneOf, newline, digit)\nimport Text.Parsec.String (Parser)\nimport qualified Data.Map.Lazy as Map\nimport qualified Data.Set as Set\n\n-- * Permutation parser for identifier settings\n\n-- | General permutation parser for a type @a@.\ndata Permutation a = Permutation\n  -- | \"Seen\" identifiers for flagging duplicates\n  (Set.Set Identifier)\n  -- | Either map of continuation parsers for more identifiers or a\n  -- final value once we see eof.\n  (Either (Map.Map Identifier (Parser (Permutation a))) a)\n\n-- | Create a one-identifier 'Permutation' from a 'Parser'.\n(&lt;$$&gt;) :: (a -&gt; b) -&gt; (Identifier, Parser a) -&gt; Permutation b\nf &lt;$$&gt; xq = Permutation Set.empty (Right f) &lt;||&gt; xq\ninfixl 2 &lt;$$&gt;\n\n-- | Add a 'Parser' to a 'Permutation'.\n(&lt;||&gt;) :: Permutation (a -&gt; b) -&gt; (Identifier, Parser a) -&gt; Permutation b\np@(Permutation seen e) &lt;||&gt; (x, q)\n  = Permutation seen (Left (Map.insert x q' m'))\n  where\n    q' = (\\a -&gt; addQ x a p) &lt;$&gt; q\n    m' = case e of Right _ -&gt; Map.empty\n                   Left m -&gt; Map.map (fmap (&lt;||&gt; (x, q))) m\ninfixl 1 &lt;||&gt;\n\n-- | Helper to add a parsed component to a 'Permutation'.\naddQ :: Identifier -&gt; a -&gt; Permutation (a -&gt; b) -&gt; Permutation b\naddQ x a (Permutation seen e)\n  = Permutation (Set.insert x seen) $ case e of\n      Right f -&gt; Right (f a)\n      Left m -&gt; Left (Map.map (fmap (addQ x a)) m)\n\n-- | Convert a 'Permutation' to a 'Parser' that detects duplicates\n-- and skips unknown identifiers.\nrunPermutation :: Permutation a -&gt; Parser a\nrunPermutation p@(Permutation seen e)\n  = -- if end of file, return the final answer (or error)\n    eof *&gt;\n    case e of\n      Left m -&gt; fail $\n        \"eof before \" ++ intercalate \", \" (Map.keys m)\n      Right a -&gt; return a\n  &lt;|&gt;\n    -- otherwise, parse the identifier\n    do k &lt;- ident &lt;* char '='\n       -- is it one we're waiting for?\n       case either (Map.lookup k) (const Nothing) e of\n         -- no, it's not, so check for duplicates and skip\n         Nothing -&gt; if Set.member k seen\n           then unexpected (\"duplicate \" ++ k)\n           else skipLine *&gt; runPermutation p\n         -- yes, it is\n         Just prhs -&gt; do\n           -- parse the RHS to get a continuation Permutation\n           -- and run it to parse rest of parameters\n           (prhs &lt;* newline) &gt;&gt;= runPermutation\n\n-- | Left-hand side of a setting.\ntype Identifier = String\n\n-- | Parse an 'Identifier'.\nident :: Parser Identifier\nident = (:) &lt;$&gt; letter' &lt;*&gt; many alphaNum'\n  where letter' = letter &lt;|&gt; underscore\n        alphaNum' = alphaNum &lt;|&gt; underscore\n        underscore = char '_'\n\n-- | Skip (rest of) a line.\nskipLine :: Parser ()\nskipLine = void $ many (noneOf \"\\n\") &gt;&gt; newline\n\n-- * Parsing video information\n\n-- | Our video data.\ndata Video = Video\n  { width :: Int\n  , height :: Int\n  } deriving (Show)\n\n-- | Parsing integers (RHS of width and height settings)\nint :: Parser Int\nint = read &lt;$&gt; some digit\n\n-- | Some test data\ntestdata1 :: String\ntestdata1 = unlines\n  [ \"ID_SID_0_LANG=eng\"\n  , \"ID_VIDEO_FORMAT=H264\"\n  , \"ID_VIDEO_HEIGHT=574\"\n  , \"ID_START_TIME=0.00\"\n  , \"ID_SUBTITLE_ID=0\"\n  , \"ID_VIDEO_ID=0\"\n  , \"ID_VIDEO_FPS=25.000\"\n  , \"ID_VIDEO_WIDTH=700\"\n  ]\n\n-- | `Video` parser based on `Permutation`.\nvideo :: Parser Video\nvideo = runPermutation (Video &lt;$$&gt; (\"ID_VIDEO_WIDTH\", int) &lt;||&gt; (\"ID_VIDEO_HEIGHT\", int))\n\n-- | The final test.\ntest :: IO ()\ntest = parseTest video testdata1\n</code></pre>\n"}], "owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1537645498, "creation_date": 1537512939, "question_id": 52438196, "link": "https://stackoverflow.com/questions/52438196/how-to-parse-a-series-of-lines-with-only-a-few-interesting-ones-with-parsec-in", "title": "How to parse a series of lines (with only a few interesting ones) with Parsec in Haskell", "body": "<p>I have some input data of the form below (this is just a small sample).</p>\n\n<pre><code>ID_SID_0_LANG=eng\nID_VIDEO_FORMAT=H264\nID_VIDEO_HEIGHT=574\nID_START_TIME=0.00\nID_SUBTITLE_ID=0\nID_VIDEO_ID=0\nID_VIDEO_FPS=25.000\nID_VIDEO_WIDTH=700\n</code></pre>\n\n<p>I'm trying to see if I can parse this with Parsec.  For the sake of our example, I want to pull out two values, the width and the height.  I am trying to see if this can be done with Parsec.</p>\n\n<ul>\n<li>The lines may come in any order</li>\n<li>If either the width or the height are missing, I'd like a ParseError</li>\n<li>If either the width or the height occur more than once, I'd like a ParseError</li>\n<li>The other lines are mixed and varied per input, I can assume nothing beyond their basic format.</li>\n</ul>\n\n<p>I'd like to use Parsec because I'm going to have to parse the values (which, in general, may be of different types - enumerations for codecs, elapsed types, strings, etc.).  And I'd like my returned data structure to contain Naturals rather than, say, Maybe Natural, to simplify later code.</p>\n\n<p>My problem is how to \"parse\" the leading ID_ lines that aren't interesting to me, but pick up only those that are.  So I want to parse \"any number of uninteresting ID_ lines; a height (or width); any number of uninteresting ID_ lines; a width (or height if width already found); any number of uninteresting ID_ lines).  And I'd like to do this without repeating the notion of what constitutes an \"interesting\" key, because repetition is a primary cause of subtle error when being later maintained.</p>\n\n<p>My best effort so far is to parse lines producing a list of Data Structure Modifiers for the interesting lines, each with a Key, and separately checking for presence of the required lines and lack of duplication of the unique lines; but that's not satisfying because I'm repeating the \"interesting\" keys.</p>\n\n<p>Can this be elegantly done with Parsec?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1537509307, "post_id": 52437388, "comment_id": 91817756, "body": "what is <code>(\\x -&gt; [x])</code> doing here?"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 4, "last_activity_date": 1537511046, "creation_date": 1537511046, "answer_id": 52437778, "question_id": 52437388, "link": "https://stackoverflow.com/questions/52437388/attempting-to-flatten-a-tree-in-haskell-using-in-order-traversal/52437778#52437778", "title": "Attempting to flatten a tree in Haskell using in-order traversal", "body": "<p>The type of <code>treeFold</code> is</p>\n\n<pre><code>treeFold :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n</code></pre>\n\n<p>You want to return a list of values, <code>[a]</code>.</p>\n\n<p>Therefore the result type <code>b</code> must be equal to <code>[a]</code>, giving us a specialized type signature of</p>\n\n<pre><code>treeFold :: ([a] -&gt; a -&gt; [a] -&gt; [a]) -&gt; [a] -&gt; Tree a -&gt; [a]\n</code></pre>\n\n<p>Note that the second argument has type <code>[a]</code>.</p>\n\n<p>What value are you passing instead?</p>\n"}, {"comments": [{"owner": {"reputation": 141, "user_id": 10394930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5fc94932382e087ae14e58bade83cbc?s=128&d=identicon&r=PG&f=1", "display_name": "newb346", "link": "https://stackoverflow.com/users/10394930/newb346"}, "edited": false, "score": 0, "creation_date": 1537540391, "post_id": 52437847, "comment_id": 91834637, "body": "Ah, that makes a lot of sense. I think I am still just beginning to wrap my head around the application of functions in Haskell and the way to reason about the arguments using the types provided. Thank you!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 141, "user_id": 10394930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5fc94932382e087ae14e58bade83cbc?s=128&d=identicon&r=PG&f=1", "display_name": "newb346", "link": "https://stackoverflow.com/users/10394930/newb346"}, "edited": false, "score": 1, "creation_date": 1537540443, "post_id": 52437847, "comment_id": 91834661, "body": "the main thing is, don&#39;t be afraid of the types! types are your friends! (for real, not like in that &#39;Mars Attacks!&#39; movie :) ).  --- as for the application, mainly it&#39;s this: for <code>f :: a -&gt; b -&gt; c -&gt; d</code>, we have <code>f (x::a) :: b -&gt; c -&gt; d</code>, and <code>f (x::a) (y::b) :: c -&gt; d</code>, and <code>f (x::a) (y::b) (z::c) :: d</code>. that&#39;s all!"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1537517643, "last_edit_date": 1537517643, "creation_date": 1537511305, "answer_id": 52437847, "question_id": 52437388, "link": "https://stackoverflow.com/questions/52437388/attempting-to-flatten-a-tree-in-haskell-using-in-order-traversal/52437847#52437847", "title": "Attempting to flatten a tree in Haskell using in-order traversal", "body": "<p>The types must fit:</p>\n\n<pre><code>treeFold ::           ( b -&gt; a -&gt; b -&gt; b              ) -&gt; b -&gt; Tree a -&gt; b\n\ntreeToList = treeFold (\\xs   x    ys -&gt; xs ++ (x : ys))    z\n-------------------------------------------------------------------\n                        b    a    b     b      a   b       b\n                                              --------\n                                              b\n</code></pre>\n\n<p>Since <code>x</code> and <code>ys</code> participate in the same <code>:</code>, their types must be compatible:</p>\n\n<pre><code>(:) ::   a  -&gt; [a]  -&gt;  [a]\nx   ::   a\nys  ::          b\n-------------------\n              b ~ [a]\n</code></pre>\n\n<p>Thus we have</p>\n\n<pre><code>treeFold ::           ( [a] -&gt; a -&gt; [a] -&gt; [a]           ) -&gt; [a] -&gt; Tree a-&gt;[a]\n\ntreeToList = treeFold (\\ xs    x    ys  -&gt; xs ++ (x : ys))     z\n-------------------------------------------------------------------\n                         [a]   a    [a]    [a]    a   [a]     [a]\n                                                 --------\n                                                 [a]\n</code></pre>\n\n<p>Conclusion: the last argument, <code>z</code>, must have the type <code>[a]</code>.</p>\n\n<p>What is the meaning of this argument? As usual with the folds, each \"variant\" in the data type definition has a corresponding argument to the fold function.</p>\n\n<p>Your (missing) data type definition is:</p>\n\n<pre><code>data Tree a = Node (Tree a)    a   (Tree a)       | Leaf\n</code></pre>\n\n<p>and the fold's type is</p>\n\n<pre><code>treeFold ::   (         b  -&gt;  a  -&gt;  b  -&gt; b )   -&gt;  b     -&gt; Tree a -&gt; b\n</code></pre>\n\n<p>which corresponds to the \"<em>recursive results</em>-holding type\" of</p>\n\n<pre><code>data TreeF a r = NodeF  r      a      r           | LeafF\n</code></pre>\n\n<p>Thus <code>z</code> is \"the value to convert each <code>Leaf</code> to\". </p>\n\n<p>Most natural choice for it is just <code>[]</code>. Actually, the only choice, because we don't know anything about the type <code>a</code> (in <code>[a]</code>) yet.</p>\n"}], "owner": {"reputation": 141, "user_id": 10394930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5fc94932382e087ae14e58bade83cbc?s=128&d=identicon&r=PG&f=1", "display_name": "newb346", "link": "https://stackoverflow.com/users/10394930/newb346"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 52437847, "answer_count": 2, "score": 2, "last_activity_date": 1537533909, "creation_date": 1537509105, "last_edit_date": 1537533909, "question_id": 52437388, "link": "https://stackoverflow.com/questions/52437388/attempting-to-flatten-a-tree-in-haskell-using-in-order-traversal", "title": "Attempting to flatten a tree in Haskell using in-order traversal", "body": "<p>Trying to use the given fold function to flatten out a tree into a list.</p>\n\n<pre><code>treeFold :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFold _ b Leaf         = b\ntreeFold f b (Node lt x rt) = f (treeFold f b lt) x (treeFold f b rt)\n</code></pre>\n\n<p>Here is what I have tried to so far:</p>\n\n<pre><code>treeToList :: Tree a -&gt; [a]\ntreeToList = treeFold (\\xs x ys -&gt; xs ++ x : ys) (\\x -&gt; [x])\n</code></pre>\n\n<p>For some reason, I can't quite wrap my head around how to go about doing this?\nFeels like there's something I haven't quite gotten into my head about Haskell. Any help would be appreciated along with how to go about solving it.\nThanks!</p>\n\n<p>Edit:</p>\n\n<p>I realize that the type signature I am using here verges on the nonsensical. In the type signature of treeFold, based on what I can think, the second argument (b) is probably a list since it acts as the accumulator in a way in this case. That would make the third argument (Tree a) a some version of the argument on the left of the equation. Two of the arguments within the function have to be the left and right subtrees within a Node. The third argument is just the value of the Node. Within the function, I need to combine the left tree, right tree and the value in the usual in order fashion but all the different variations I tried have had some issues </p>\n"}, {"tags": ["haskell", "functional-programming", "lazy-evaluation", "ghc", "sieve-of-eratosthenes"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 3, "creation_date": 1537486697, "post_id": 52434603, "comment_id": 91812866, "body": "Haskell itself wouldn&#39;t know. but the implementation of <code>minus</code> might. Given that in that code fragment we have that <code>minus</code>, <code>union</code> and <code>unionAll</code> come from <code>Data.List.Ordered</code>, that means that at some point the fact that the infinite list you use is ordered is used to short-circuit the computation. What the runtime will guarantee is that as soon as it knows the 3rd element of the list (that is, it knows the list is of the form <code>a : b : c : rest</code>), it will stop the computation of the rest of the list."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 10393959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xcTGa.jpg?s=128&g=1", "display_name": "Wilson", "link": "https://stackoverflow.com/users/10393959/wilson"}, "edited": false, "score": 0, "creation_date": 1537488661, "post_id": 52434735, "comment_id": 91813270, "body": "Ah thank you that clears things up! To clarify if I understand correctly, does this mean that unionAll is able to short circuit calculation early because it knows that the first list is the <i>least</i> (documentation: &quot;the assumption that the heads of the inner lists are sorted&quot;). Also am I using the proper terminology to describe this? Thank you again!"}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 4, "last_activity_date": 1537487242, "creation_date": 1537487242, "answer_id": 52434735, "question_id": 52434603, "link": "https://stackoverflow.com/questions/52434603/understanding-the-limitations-of-lazy-evaluation-sieve-of-eratosthenes/52434735#52434735", "title": "Understanding the Limitations of Lazy Evaluation (Sieve of Eratosthenes)", "body": "<p><code>(!!)</code> only demands that <code>primes</code> be evaluated enough to find out that there are at least 3 elements, and what the third element is.  To get that third element, we need to start evaluating the call to <code>minus</code>.</p>\n\n<p><code>minus</code> assumes that both its arguments are sorted.  This is described in the docs, and is satisfied in the definition of <code>primes</code>.  The first comparison <code>minus</code> performs is between 5 and 9, and this shows that 5 is the first element of the result. In the <a href=\"https://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/src/Data-List-Ordered.html#minus\" rel=\"nofollow noreferrer\">definition of minus</a> this is the case <code>LT -&gt; x : loop xs (y:ys)</code>.</p>\n\n<p><code>(!!)</code> now has the third element of <code>primes</code>, so evaluation does not continue in <code>primes</code> or <code>minus</code> or <code>unionAll</code>.  This back-and-forth between evaluation of subexpressions and pattern matching in the outer expressions is lazy evaluation.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1537519585, "last_edit_date": 1537519585, "creation_date": 1537518696, "answer_id": 52439701, "question_id": 52434603, "link": "https://stackoverflow.com/questions/52434603/understanding-the-limitations-of-lazy-evaluation-sieve-of-eratosthenes/52439701#52439701", "title": "Understanding the Limitations of Lazy Evaluation (Sieve of Eratosthenes)", "body": "<p>Actually, the crux is in the implementation of <code>unionAll</code>. <code>minus</code> just pulls elements from its right argument one by one unawares (it assumes both its arguments are non-decreasing of course).</p>\n\n<p>First, let's re-write it as</p>\n\n<pre><code>primes = 2 : ps \nps     = 3 : t\nt      = minus [5,7..] (unionAll [[p*p, p*p+2*p..] | p &lt;- ps])\n\n-- primes !! 2 == ps !! 1 == head t\n\n       = minus [5,7..] (unionAll [[p*p, p*p+2*p..] | p &lt;- (3 : t)])\n       = minus [5,7..] (unionAll ([9, 15..] : [[p*p, p*p+2*p..] | p &lt;- t]))\n</code></pre>\n\n<p>Now <code>unionAll</code> is smart: it relies on the assumption (here, fact) that in <code>unionAll xs</code> it holds that <code>(map head xs)</code> are non-decreasing.</p>\n\n<p>As such, it <em>knows</em> it <em>does not have to compare</em> <code>9</code> with anything! So it just produces it unconditionally (you can consult its definition to check it for yourself):</p>\n\n<pre><code>       = minus [5,7..] \n               (9 : union [15, 21..] (unionAll ........))\n</code></pre>\n\n<p>Thus <code>minus</code> has something to compare the <code>5</code> and the <code>7</code> with, and produces:</p>\n\n<pre><code>       = 5 : 7 : minus [9,11..] \n                       (9 : union [15, 21..] (unionAll ........))\n</code></pre>\n\n<p>All this from knowing just the first odd prime, <code>3</code>.</p>\n"}], "owner": {"reputation": 113, "user_id": 10393959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xcTGa.jpg?s=128&g=1", "display_name": "Wilson", "link": "https://stackoverflow.com/users/10393959/wilson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 1, "accepted_answer_id": 52434735, "answer_count": 2, "score": 11, "last_activity_date": 1537752640, "creation_date": 1537485833, "last_edit_date": 1537752640, "question_id": 52434603, "link": "https://stackoverflow.com/questions/52434603/understanding-the-limitations-of-lazy-evaluation-sieve-of-eratosthenes", "title": "Understanding the Limitations of Lazy Evaluation (Sieve of Eratosthenes)", "body": "<p>In the <a href=\"https://wiki.haskell.org/Prime_numbers\" rel=\"nofollow noreferrer\">Haskell Wiki article on prime numbers</a>, the following implementation of the Sieve of Eratosthenes is described: </p>\n\n<pre><code>primes = 2 : 3 : minus [5,7..] (unionAll [[p*p, p*p+2*p..] | p &lt;- tail primes])\n</code></pre>\n\n<p>When doing...</p>\n\n<pre><code>primes !! 2\n</code></pre>\n\n<p>... how does Haskell recognize in this specific situation not to try all <code>p</code>'s in the tail of <code>primes</code> (a.k.a <code>[3..]</code>), but instead only does a set minus with <code>3</code>? </p>\n\n<p>In other words: how does Haskell know that any of the other <code>p</code>'s (or multiples thereof) will not match <code>5</code>, which is the eventual answer. Is there a good rule of thumb to know when the compiler is smart enough to handle infinite cases?</p>\n"}, {"tags": ["haskell", "typeclass", "functional-dependencies"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1537482253, "post_id": 52434044, "comment_id": 91811877, "body": "In practice, you should probably just use the <a href=\"http://hackage.haskell.org/package/vector-space-0.14/docs/Data-AffineSpace.html\" rel=\"nofollow noreferrer\"><code>AffineSpace</code> class</a>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1537483529, "post_id": 52434044, "comment_id": 91812179, "body": "Hmm I looked at AffineSpace, it amounts to defining a separate instance for each numeric class."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537493241, "post_id": 52434044, "comment_id": 91814208, "body": "And, to reiterate my stance on the dupe: you claim &quot;I need to be able to write <code>diff 5 3</code> and <code>diff time1 time2</code>&quot;, but don&#39;t motivate this need. I am skeptical."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537503995, "post_id": 52434044, "comment_id": 91816276, "body": "@DanielWagner the so called dupe isn&#39;t even close. In my real code, <code>diff</code> is called <code>(-)</code>. The motivation is to remove a limitation of <a href=\"http://hackage.haskell.org/package/numeric-prelude\" rel=\"nofollow noreferrer\">numeric-prelude</a> explained in the second bullet point of &quot;Scope &amp; Limitations/TODO&quot;."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537533332, "post_id": 52434044, "comment_id": 91830457, "body": "@n.m. The question asked at the dupe isn&#39;t close. But the answer is, namely: you&#39;ve no choice but to make a bunch of instances or use a newtype wrapper. Read the answers here and you&#39;ll see they&#39;re identical. And for posterity, the dupe I chose was <a href=\"https://stackoverflow.com/q/52041190/791604\">this</a>. I still don&#39;t agree with the folks who voted to reopen: the answers there answer this question, too."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537547791, "post_id": 52434044, "comment_id": 91838597, "body": "@DanielWagner I didn&#39;t see the answer talking about writing a bunch of instances, only about newtype wrapping (which I understand but cannot use)."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537482556, "post_id": 52434141, "comment_id": 91811958, "body": "*define Diff Int Int Int and Diff Double Double Double and Diff Rational Rational Rational separately&quot; I know this will work but this is not ideal because I&#39;m in an environment where new instances of Num are likely to be defined. I&#39;ll add this to the question."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537484771, "post_id": 52434141, "comment_id": 91812483, "body": "If this is a requirement, then you should better find a solution that doesn&#39;t require a custom class at all."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537485287, "post_id": 52434141, "comment_id": 91812600, "body": "It isn&#39;t a requirement, but it is not desirable. If only I could generate a separate instance of Diff for each instance of Num automatically..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537485651, "post_id": 52434141, "comment_id": 91812670, "body": "I&#39;d say just write the one-line instance out for each of these types."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537551824, "post_id": 52434141, "comment_id": 91840364, "body": "Well, you <i>could</i> probably hack your way through with overlapping instances instead. I personally stay away from these, but some people use them successfully."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537553105, "post_id": 52434141, "comment_id": 91840954, "body": "I have tried overlapping instances too, no luck, The problem is not overlapping but conflicting fundeps (or type families)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1537482109, "creation_date": 1537482109, "answer_id": 52434141, "question_id": 52434044, "link": "https://stackoverflow.com/questions/52434044/problem-with-creating-a-type-class-for-a-heterogenous-operation/52434141#52434141", "title": "Problem with creating a type class for a heterogenous operation", "body": "<p>The problem is that <code>Diff (TimePoint a) (TimePoint a)</code> happens to be a special case of <code>Diff a a</code>. You may think \u201cit's not because of the <code>Num a</code> constraint\u201d, but remember that you can never prove that a type is <em>not</em> an instance of some class, because the instance might still be added later.</p>\n\n<p>The solution is to not define a <code>Diff a a a</code> instance. Instead define <code>Diff Int Int Int</code> and <code>Diff Double Double Double</code> and <code>Diff Rational Rational Rational</code> separately.</p>\n"}, {"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537484707, "post_id": 52434320, "comment_id": 91812469, "body": "Thanks, this seems to be mostly working, though <code>diff 5 3</code> still doesn&#39;t work because of overloaded literals. Won&#39;t <code>UndecidableInstances</code> affect other modules?"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537543105, "post_id": 52434320, "comment_id": 91836264, "body": "I&#39;m not sure - I&#39;ve seen it described in a few places (<a href=\"https://chrisdone.com/posts/haskell-constraint-trick\" rel=\"nofollow noreferrer\">chrisdone.com/posts/haskell-constraint-trick</a>), but it&#39;s just a way of manipulating the instance selector."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": false, "score": 1, "last_activity_date": 1537483362, "creation_date": 1537483362, "answer_id": 52434320, "question_id": 52434044, "link": "https://stackoverflow.com/questions/52434044/problem-with-creating-a-type-class-for-a-heterogenous-operation/52434320#52434320", "title": "Problem with creating a type class for a heterogenous operation", "body": "<p>You might try a common trick to avoid the head matching problem that @leftaroundabout described in their answer</p>\n\n<pre><code>instance {-# OVERLAPPABLE #-} (a ~ b, a ~ c, Num a) =&gt; Diff a b c where\n    diff = (-)\n</code></pre>\n\n<p>This requires <code>UndecidableInstances</code>, and <code>TypeFamilies</code> to enable the unification constraint, and will not work unless the result of the <code>diff</code> is eventually concretely typed, so some level of inference e.g. in GHCi, isn't possible.</p>\n"}], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 52434141, "answer_count": 2, "score": 2, "last_activity_date": 1537525680, "creation_date": 1537481498, "last_edit_date": 1537483205, "question_id": 52434044, "link": "https://stackoverflow.com/questions/52434044/problem-with-creating-a-type-class-for-a-heterogenous-operation", "title": "Problem with creating a type class for a heterogenous operation", "body": "<p>What follows is a very simplified version of what I'm trying to do.</p>\n\n<p>Suppose I want to create a generic difference operation that can accept operands of different types.</p>\n\n<pre><code>class Diff a b c where\n    diff :: a -&gt; b -&gt; c\n</code></pre>\n\n<p>Naturally we can apply this operation to numbers.</p>\n\n<pre><code>instance Num a \u21d2 Diff a a a where\n    diff = (-)\n</code></pre>\n\n<p>But not only numbers. If we have say two points in time, then a difference between them would be a time interval.</p>\n\n<pre><code>newtype TimePoint = TP Integer deriving Show -- seconds since epoch\nnewtype TimeInterval = TI Integer deriving Show -- in seconds\n\ninstance Diff TimePoint TimePoint TimeInterval where\n    diff (Tp x) (Tp y) = TI (x-y)\n</code></pre>\n\n<p>Everything is fine. Except when I try to test my <code>diff</code> in GHCi, I get this:</p>\n\n<pre><code>*Example \u03bb diff 5 3\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 Could not deduce (Diff a0 b0 c)\n      from the context: (Diff a b c, Num a, Num b)\n        bound by the inferred type for \u2018it\u2019:\n                   forall a b c. (Diff a b c, Num a, Num b) =&gt; c\n        at &lt;interactive&gt;:1:1-8\n      The type variables \u2018a0\u2019, \u2018b0\u2019 are ambiguous\n    \u2022 In the ambiguity check for the inferred type for \u2018it\u2019\n      To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n      When checking the inferred type\n        it :: forall a b c. (Diff a b c, Num a, Num b) =&gt; c\n*Example \u03bb\n</code></pre>\n\n<p>So I must write type signatures at places where the type should be \"obvious\" for the compiler.</p>\n\n<p>Let's try to help it a bit.</p>\n\n<pre><code>class Diff a b c | a b -&gt; c where\n  diff \u2237 a -&gt; b -&gt; c\n</code></pre>\n\n<p>It should be able to determine the type of the result now! Unfortunately this doesn't compile:</p>\n\n<pre><code>[1 of 1] Compiling Example          ( Example.hs, interpreted )\n\nExample.hs:8:10: error:\n    Functional dependencies conflict between instance declarations:\n      instance Num a =&gt; Diff a a a -- Defined at Example.hs:8:10\n      instance Num a =&gt; Diff (TimePoint a) (TimePoint a) (TimeInterval a)\n        -- Defined at Example.hs:14:10\n  |\n8 | instance Num a =&gt; Diff a a a where\n  |          ^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\nPrelude GOA \u03bb \n</code></pre>\n\n<p>BTW I have tried associated type families in place of fundeps  as well, with predictably similar results.</p>\n\n<p>Now I understand perfectly well why this happens. There are two instances <code>Diff a a a</code> and <code>Diff (TimePoint a) (TimePoint a) (TimeInterval a)</code>, and they cannot coexist with the fundep in place. The question is, how do I work around this problem? Wrapping numbers in a newtype is not a viable solution, I need to be able to write <code>diff 5 3</code> and <code>diff time1 time2</code>, and the types of these expressions should be deduced from the operands.</p>\n\n<p>I know I could define separate instances for <code>Diff Int Int Int</code> and <code>Diff Double Double Double</code> and <code>Diff Rational Rational Rational</code>, but this is not an ideal solution, because new instances of <code>Num</code> could be defined and the code must handle them without having to define an additional instance of <code>Diff</code> for each of those.</p>\n\n<p>A minimal complete example follows:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies, FlexibleInstances #-}\n\nmodule Example where\n\nclass Diff a b c | a b -&gt; c where\n  diff :: a -&gt; b -&gt; c\n\ninstance Num a =&gt; Diff a a a where\n  diff = (-)\n\ndata TimePoint a = TP a deriving Show\ndata TimeInterval a = TI a deriving Show\n\ninstance Num a =&gt; Diff (TimePoint a) (TimePoint a) (TimeInterval a) where\n  diff (TP x) (TP y) = TI (x - y)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "business-logic", "quickcheck", "property-based-testing"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1540943083, "post_id": 52433713, "comment_id": 93047054, "body": "I daresay business logic is one of the worst applications for property-based checking, because it often blatantly disregards mathematical approachability."}], "answers": [{"comments": [{"owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "edited": false, "score": 0, "creation_date": 1540940101, "post_id": 53067785, "comment_id": 93046334, "body": "This answer seems to relate to more traditional unit-test style approach to testing, how does your answer relate to property based testing such as in quickcheck / similar libraries?"}, {"owner": {"reputation": 28384, "user_id": 648265, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4d98e414a47934d66cb78bf73d0845ba?s=128&d=identicon&r=PG", "display_name": "ivan_pozdeev", "link": "https://stackoverflow.com/users/648265/ivan-pozdeev"}, "reply_to_user": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "edited": false, "score": 0, "creation_date": 1540944503, "post_id": 53067785, "comment_id": 93047374, "body": "@danbroooks I&#39;ve never heard of property-based testing before but this is a great opportunity to finally learn some fundamentally new principle. From what I see now, it&#39;s some AI logic that does a part of the job picking those &quot;representative&quot; inputs for you -- but the general principles are the same, the checked conditions are static and represent interface rather than implementation."}], "tags": [], "owner": {"reputation": 28384, "user_id": 648265, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4d98e414a47934d66cb78bf73d0845ba?s=128&d=identicon&r=PG", "display_name": "ivan_pozdeev", "link": "https://stackoverflow.com/users/648265/ivan-pozdeev"}, "is_accepted": false, "score": -1, "last_activity_date": 1540913377, "creation_date": 1540913377, "answer_id": 53067785, "question_id": 52433713, "link": "https://stackoverflow.com/questions/52433713/is-it-a-good-or-a-bad-thing-that-a-suite-of-quickcheck-tests-match-the-implement/53067785#53067785", "title": "Is it a good or a bad thing that a suite of quickcheck tests match the implementations?", "body": "<p>No, it's not a good thing because you're effectively comparing the results of code with results of the same code.</p>\n\n<p>To resolve this chicken-and-egg problem, tests are built on these principles:</p>\n\n<ul>\n<li>Tests feed predefined inputs and check for predefined outputs. Nothing \"random\". All sources of randomness are considered additional inputs and mocked or otherwise forced to produce specific values.\n\n<ul>\n<li>Sometimes, a compromise is possible: you leave a random source alone and check the output not for exact value but just for \"correctness\" (e.g. that it has a specific format). But then you're not testing the logic that is responsible for the parts that you don't check (though you may not need to, see below).</li>\n</ul></li>\n<li>The only way to test a function completely is to exhastively try all possible inputs</li>\n<li>Since this is almost always impossible, only a few \"representative\" ones are selected\n\n<ul>\n<li>And <em>an assumption about the code is made</em> that it handles all other possible inputs the same way\n\n<ul>\n<li>This is why test coverage metric is important: it will tell you when a code has changed in such a way that this assumption no longer holds</li>\n</ul></li>\n</ul></li>\n</ul>\n\n<p>To select the optimal \"representative\" input, follow the function's interface.</p>\n\n<ul>\n<li>If there are some ranges in input data that trigger different behavior, edge values are usually the most useful</li>\n<li>Outputs are checked against the interface's promises\n\n<ul>\n<li>Sometimes, the interface doesn't promise a specific value for given inputs, variations are considered implementation details. Then you test not for a specific values but only what the interface guarantees.\n\n<ul>\n<li>Testing implementation details is only useful if other components rely on them -- then they are not really implementation details but parts of a separate, private interface.</li>\n</ul></li>\n</ul></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1540947382, "creation_date": 1540947382, "answer_id": 53074813, "question_id": 52433713, "link": "https://stackoverflow.com/questions/52433713/is-it-a-good-or-a-bad-thing-that-a-suite-of-quickcheck-tests-match-the-implement/53074813#53074813", "title": "Is it a good or a bad thing that a suite of quickcheck tests match the implementations?", "body": "<p>Basically the only times it makes sense for property checking to compare two implementations of the same function are when:</p>\n\n<ol>\n<li><p>Both function are part of the API, and they should each implement a certain function. For example, we generally want <code>liftEq (==) = (==)</code>. So we should test that <code>liftEq</code> for the type we're defining satisfies this property.</p></li>\n<li><p>One implementation is obviously correct, but inefficient, while another is efficient but not obviously correct. In this case, the test suite should define the obviously correct version and check the efficient version against it.</p></li>\n</ol>\n\n<p>For typical \"business logic\", neither of these apply. There might, however, be some special cases where they do. For example, you could have two different functions you call under different circumstances that are supposed to agree under certain conditions.</p>\n"}, {"tags": [], "owner": {"reputation": 1548, "user_id": 4345848, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QpVd4.jpg?s=128&g=1", "display_name": "Sir4ur0n", "link": "https://stackoverflow.com/users/4345848/sir4ur0n"}, "is_accepted": true, "score": 2, "last_activity_date": 1551772304, "creation_date": 1551772304, "answer_id": 54997830, "question_id": 52433713, "link": "https://stackoverflow.com/questions/52433713/is-it-a-good-or-a-bad-thing-that-a-suite-of-quickcheck-tests-match-the-implement/54997830#54997830", "title": "Is it a good or a bad thing that a suite of quickcheck tests match the implementations?", "body": "<p>I'm sorry to jump in a few months later, but as this question easily pops on Google I think it needs a better answer.</p>\n\n<p>Ivan's answer is about unit tests while you are talking about property tests, so let's disregard it.</p>\n\n<p>Dfeuer tells you when it's acceptable to mirror the implementation, but not what to do for your use case.</p>\n\n<p>It's a common mistake with Property based tests (PBT) to rewrite the implementation code at first. But this is not what PBT are for. They exist to check <strong>properties</strong> of your function. Hey, don't worry, we all do this mistake the first few times we write PBT :D</p>\n\n<p>A type of property you could check here is whether your function response is <strong>consistent</strong> with its input: </p>\n\n<pre><code>if SUT.shouldDiscountProduct p t \nthen isJust (userDiscountCode p) &amp;&amp; isJust (productDiscount t) \nelse isNothing (userDiscountCode p) || isNothing (productDiscount t)\n</code></pre>\n\n<p>This one is subtle in your particular use case, but pay attention, we reversed the logic. Your test checks the input, and based on this, asserts on the output. My test checks on the output, and based on this, asserts on the input. In other use cases this could be much less symmetric. Most of the code can also be refactored, I let you this exercise ;)</p>\n\n<p>But you may find other types of properties! E.g. <strong>invariance</strong> properties:</p>\n\n<pre><code>SUT.shouldDiscountProduct p{userDiscountCode = Nothing} t == False\nSUT.shouldDiscountProduct p{productDiscount = Nothing} t == False\n</code></pre>\n\n<p>See what we did here? We fixed one part of the input (e.g. the user discount code is always empty) and we assert that no matter how everything else varies, the output is invariant (always false). Same goes for product discount.</p>\n\n<p>One last example: you could use an <strong>analogous</strong> property to check your old code and your new code behave exactly the same:</p>\n\n<pre><code>shouldDiscountProduct user product =\n  if M.isNothing (userDiscountCode user)\n     then False\n     else if (productDiscount product) then True\n                                       else False\n\nshouldDiscountProduct' user product\n  | Just _ &lt;- userDiscountCode user\n  , Just _ &lt;- productDiscount product\n  = True\n  | otherwise = False\n\nSUT.shouldDiscountProduct p t = SUT.shouldDiscountProduct' p t\n</code></pre>\n\n<p>Which reads as \"No matter the input, the rewritten function must always return the same value as the old function\". This is so cool when refactoring!</p>\n\n<p>I hope this helps you grasp the idea behind Property based tests: stop worrying so much about the value returned by your function, and start wondering about some behaviors your function has.</p>\n\n<p>Note, PBT are not an enemy of unit tests, they actually fit well together. You could use 1 or 2 unit tests if it makes you feel safer about actual values, then write Property test(s) to assert your function has some behaviors, no matter the input.</p>\n"}], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 2, "accepted_answer_id": 54997830, "answer_count": 3, "score": 8, "last_activity_date": 1551772304, "creation_date": 1537479624, "last_edit_date": 1540940183, "question_id": 52433713, "link": "https://stackoverflow.com/questions/52433713/is-it-a-good-or-a-bad-thing-that-a-suite-of-quickcheck-tests-match-the-implement", "title": "Is it a good or a bad thing that a suite of quickcheck tests match the implementations?", "body": "<p>I'm trying to get started with Haskell's QuickCheck, and while I am familiar with the concepts behind the testing methodology, this is the first time I am trying to put it to use on a project that goes beyond testing stuff like <code>reverse . reverse == id</code> and that kind of thing. I want to know if it is useful to apply it to business logic (I think it very much could be).</p>\n\n<p>So a couple of existing business logic type functions that I would like to test look like the following:</p>\n\n<pre><code>shouldDiscountProduct :: User -&gt; Product -&gt; Bool\nshouldDiscountProduct user product =\n  if M.isNothing (userDiscountCode user)\n     then False\n     else if (productDiscount product) then True\n                                       else False\n</code></pre>\n\n<p>For this function I can write a QuickCheck spec like the following:</p>\n\n<pre><code>data ShouldDiscountProductParams\n  = ShouldDiscountProductParams User Product\n\ninstance Show ShouldDiscountProductParams where\n  show (ShouldDiscountProductParams u p) =\n    \"ShouldDiscountProductParams:\\n\\n\" &lt;&gt;\n    \"- \" &lt;&gt; show u &lt;&gt; \"\\n\\n\" &lt;&gt;\n    \"- \" &lt;&gt; show p\n\ninstance Arbitrary ShouldDiscountProductParams where\n  arbitrary = ShouldDiscountProductParams &lt;$&gt; arbitrary &lt;*&gt; arbitrary\n\nshouldDiscountProduct :: Spec\nshouldDiscountProduct = it behavior (property verify)\n  where\n    behavior =\n      \"when product elegible for discount\\n\"\n      &lt;&gt; \" and user has discount code\"\n\n    verify (ShouldDiscountProductParams p t) =\n      subject p t `shouldBe` expectation p t\n\n    subject =\n      SUT.shouldDiscountProduct\n\n    expectation User{..} Product{..} =\n      case (userDiscountCode, productDiscount) of\n        (Just _, Just _) -&gt; True\n        _ -&gt; False\n</code></pre>\n\n<p>And what I end up with is a function <code>expectation</code> that verifies the current implementation of <code>shouldDiscountProduct</code>, just more elegantly. So now I have a test, I can refactor my original function. But my natural inclination would be to change it to the implementation in <code>expectation</code>:</p>\n\n<pre><code>shouldDiscountProduct User{..} Product{..} =\n  case (userDiscountCode, productDiscount) of\n    (Just _, Just _) -&gt; True\n    _ -&gt; False\n</code></pre>\n\n<p>But this is fine right? If I want to change this function again in future I have the same function ready to verify my changes are appropriate and not inadvertently breaking something.</p>\n\n<p>Or is this overkill / double bookkeeping? I suppose I have had ingrained into me from OOP testing that you should try and avoid mirroring the implementation details as much as possible, this literally couldn't be any further than that, it is the implementation!</p>\n\n<p>I then think as I go through my project and add these kinds of tests, I am effectively going to be addding these tests, and then refactoring to the cleaner implementation I implement in the <code>expectation</code> assertion. Obviously this isn't going to be the case for more complex functions than these, but in the round I think will be the case. </p>\n\n<p>What are people experiences with using property based testing for business logic-type functions? Are there any good resources out there for this kind of thing? I guess I just want to verify that I am using QC in an appropriate way, and its just my OOP past throwing doubts in my mind about this...</p>\n"}, {"tags": ["haskell", "maybe"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1537493086, "post_id": 52432973, "comment_id": 91814172, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=%5BMaybe+a%5D+-&gt;+Maybe+%5Ba%5D\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=%5BMaybe+a%5D+-&gt;+Maybe+%5Ba%5D</a>"}], "answers": [{"comments": [{"owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "edited": false, "score": 0, "creation_date": 1537480078, "post_id": 52433003, "comment_id": 91811236, "body": "Thank you Willem!! Now I understand sequence does mapM id [Maybe a]"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1537476653, "last_edit_date": 1537476653, "creation_date": 1537476044, "answer_id": 52433003, "question_id": 52432973, "link": "https://stackoverflow.com/questions/52432973/better-way-to-implement-function-that-takes-maybe-a-and-returns-maybe-a/52433003#52433003", "title": "better way to implement function that takes [Maybe a] and returns Maybe [a]", "body": "<p>This functionality already exists with the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:sequence\" rel=\"noreferrer\"><strong><code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code></strong></a> function:</p>\n\n<pre><code>Prelude&gt; import Control.Monad\nPrelude Control.Monad&gt; sequence [Just 3]\nJust [3]\nPrelude Control.Monad&gt; sequence [Just 3, Nothing]\nNothing\nPrelude Control.Monad&gt; sequence [Just 3, Just 2]\nJust [3,2]\nPrelude Control.Monad&gt; sequence [Just 1,Just 2,Just 3,Just 4,Just 5]\nJust [1,2,3,4,5]\nPrelude Control.Monad&gt; sequence [Just 1,Nothing,Just 3,Just 4,Just 5]\nNothing\n</code></pre>\n\n<p>In essence this is just a <code>mapM id :: (Monad m, Traversable t) =&gt; t (m a) -&gt; m (t a)</code>, since for example for a 3-list, it is equal to:</p>\n\n<pre><code>-- special case for 3 elements to demonstrate how it works\nfunc3 [a, b, c] = do\n    ya &lt;- a\n    yb &lt;- b\n    yc &lt;- c\n    return [ya, yb, yc]\n</code></pre>\n\n<p>or thus like:</p>\n\n<pre><code>func3 [a, b, c] = a &gt;&gt;= \\ya -&gt; b &gt;&gt;= \\yb -&gt; c &gt;&gt;= yc -&gt; return [ya, yb, yc]\n</code></pre>\n\n<p>(I here use a special case, since <code>mapM</code> introduces some extra functions making it harder to follow)</p>\n\n<p>Since for <code>Maybe</code>, the <code>Monad Maybe</code> is implemented like:</p>\n\n<pre><code>instance Monad Maybe where\n    return = Just\n    Nothing &gt;&gt;= _ = Nothing\n    (Just x) &gt;&gt;= f = f x\n</code></pre>\n\n<p>so that means that from the moment one of the elements (<code>a</code>, <code>b</code> or <code>c</code>) is <code>Nothing</code>, the result will be <code>Nothing</code>, if all values are <code>Just</code>s, we will \"collect\" these with the lambda expression, and eventually yield a list with the elements.</p>\n\n<p>You can see a list <code>[]</code> as a generalization of a <code>Maybe</code> (where <code>Nothing</code> is the empty list, and <code>Just</code> is a singleton list), and the same behavior can be observed:</p>\n\n<pre><code>Prelude Control.Monad&gt; sequence [[1,2], [4,3]]\n[[1,4],[1,3],[2,4],[2,3]]\nPrelude Control.Monad&gt; sequence [[1,2], [4,3], []]\n[]\n</code></pre>\n\n<p>Here <code>sequence</code> will make a <em>cross product</em>, but if one of the lists that provide the elements of one of the set for which we apply a cross product is empty, the result is empty as well.</p>\n"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 52433003, "answer_count": 1, "score": 1, "last_activity_date": 1577397163, "creation_date": 1537475933, "last_edit_date": 1577397163, "question_id": 52432973, "link": "https://stackoverflow.com/questions/52432973/better-way-to-implement-function-that-takes-maybe-a-and-returns-maybe-a", "title": "better way to implement function that takes [Maybe a] and returns Maybe [a]", "body": "<p>I need a function that takes [Maybe a] list as an input, picks up each value, process it and return Maybe [a]. I want to return Nothing if the input list has a Nothing.</p>\n\n<pre><code>func [Just 1,Just 2,Just 3,Just 4,Just 5] =&gt; this returns Just [1,2,3,4,5]\nfunc [Just 1,Nothing,Just 3,Just 4,Just 5] =&gt; this returns Nothing\n</code></pre>\n\n<p>I wrote this</p>\n\n<pre><code>func mlist = if elem Nothing mlist\n             then Nothing\n             else Just $ map (\\(Just e) -&gt; e) mlist\n</code></pre>\n\n<p>It works but I am wondering if I can do it better. I don't like the part where I do elem Nothing mlist first and map the mlist again.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1537473396, "post_id": 52432214, "comment_id": 91808454, "body": "I doubt this is a good question for SO, but some people rely on pretty old versions of GHC. I think most users have reached 8.2, most of the rest have reached 8.0, and almost all have reached 7.10. A few still prefer to work with 7.6 or 7.8. People who are for some reason stuck with the version that shipped with their LTS OS distribution may go back further, but I personally refrain from caring at all about versions before 7.8 or much about versions before 8.0."}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1537472551, "creation_date": 1537472551, "question_id": 52432214, "link": "https://stackoverflow.com/questions/52432214/what-is-the-incidence-of-ltss-in-the-wild", "title": "What is the incidence of LTSs in the wild?", "body": "<p>I have a <a href=\"https://hackage.haskell.org/package/crypto-enigma\" rel=\"nofollow noreferrer\">Haskell package</a> that I'd like (<a href=\"https://stackoverflow.com/q/52338228/656912\">in order to simplify and stabilize my builds</a>) to restrict to the most recent <a href=\"https://www.stackage.org\" rel=\"nofollow noreferrer\">Stackage LTS</a> versions, thus requiring anyone using older LTS, and thus older GHC, to use an older version of my package.</p>\n\n<p>Currently my package supports <a href=\"https://matrix.hackage.haskell.org/package/crypto-enigma\" rel=\"nofollow noreferrer\">GHC 8.4 through 7.10</a> (via LTS 6.35, 7.24, 9.21, 9.6, 10.3, 11.22, and 12.10) but if I make this change I will be limited to 8.4 (or perhaps a bit earlier depending on what I target) and LTS after 10.3.</p>\n\n<p>What is the incidence of LTS (or GHC version) usage in the wild? Are older versions widely used, or used in specific applications or contexts?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537471945, "post_id": 52432027, "comment_id": 91807727, "body": "The only potential problem is that the base case here might be to return the empty string if the input list is empty :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537471988, "post_id": 52432027, "comment_id": 91807751, "body": "@WillemVanOnsem My version satisfies a nice invariant: the string returned always begins and ends with a <code>+</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537472061, "post_id": 52432027, "comment_id": 91807793, "body": "yes I agree, in the question however, it seems like the base case is that empty lists should map to empty strings, but personally I like a more &quot;simpler&quot; version as well. :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537472358, "post_id": 52432027, "comment_id": 91807942, "body": "@WillemVanOnsem The question&#39;s implementation is wrong, as specified by the question asker, and the specification of the correct behavior is incomplete; therefore some taste is required in cooking up a fix. In such a situation, I prefer uniformity, simplicity, and generality until there is a reason to dislike it."}, {"owner": {"reputation": 175, "user_id": 8843385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c36b066e6fbd3997a82d7ea39d665603?s=128&d=identicon&r=PG&f=1", "display_name": "ramon abacherli", "link": "https://stackoverflow.com/users/8843385/ramon-abacherli"}, "edited": false, "score": 0, "creation_date": 1537472780, "post_id": 52432027, "comment_id": 91808177, "body": "Thank you for the answer, do you know the variant which includes foldr? That would be the one I would like to use"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 175, "user_id": 8843385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c36b066e6fbd3997a82d7ea39d665603?s=128&d=identicon&r=PG&f=1", "display_name": "ramon abacherli", "link": "https://stackoverflow.com/users/8843385/ramon-abacherli"}, "edited": false, "score": 0, "creation_date": 1537472990, "post_id": 52432027, "comment_id": 91808265, "body": "@ramonabacherli, you can mechanically transform this answer into one that uses <code>foldr</code> if that&#39;s what your assignment requires."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 175, "user_id": 8843385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c36b066e6fbd3997a82d7ea39d665603?s=128&d=identicon&r=PG&f=1", "display_name": "ramon abacherli", "link": "https://stackoverflow.com/users/8843385/ramon-abacherli"}, "edited": false, "score": 0, "creation_date": 1537473066, "post_id": 52432027, "comment_id": 91808302, "body": "@ramonabacherli, you should look for the &quot;<code>foldr</code> pattern&quot; in Daniel Wagner&#39;s code. Have you learned how to recognize it?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1537476095, "last_edit_date": 1537476095, "creation_date": 1537471760, "answer_id": 52432027, "question_id": 52431915, "link": "https://stackoverflow.com/questions/52431915/how-to-check-if-you-are-in-the-first-iteration-of-a-loop-in-haskell/52432027#52432027", "title": "How to check if you are in the first iteration of a loop in Haskell?", "body": "<p>Proposal: don't detect when you're in the first iteration, which is hard; instead detect when you're in the last iteration, which is easy because it's the <code>[]</code> case in the first line.</p>\n\n<pre><code>printLine :: [Int] -&gt; String\n-- final iteration; add an extra + at the end\nprintLine [] = \"+\"\n\n-- not the final iteration; don't include a + at the end of the -s\nprintLine (x:xs) = \"+\" ++ replicate x '-' ++ printLine xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "is_accepted": false, "score": 0, "last_activity_date": 1537518182, "last_edit_date": 1537518182, "creation_date": 1537508249, "answer_id": 52437228, "question_id": 52431915, "link": "https://stackoverflow.com/questions/52431915/how-to-check-if-you-are-in-the-first-iteration-of-a-loop-in-haskell/52437228#52437228", "title": "How to check if you are in the first iteration of a loop in Haskell?", "body": "<p>If an empty list must map to an empty string, one option is to fold with a special case for an empty list.</p>\n\n<pre><code>printLine :: [Int] -&gt; String\nprintLine [] = \"\"\nprintLine xs = foldr (\\x res -&gt; '+' : replicate x '-' ++ res) \"+\" xs\n</code></pre>\n\n<p>So that</p>\n\n<pre><code>\u03bb&gt; map printLine [[], [1..4], [5]]\n[\"\",\"+-+--+---+----+\",\"+-----+\"]\n</code></pre>\n\n<p>Alternatively, since the original question asked for control during the first iteration, one option is to use a helper function. Here are two alternatives.</p>\n\n<pre><code>printLine' :: [Int] -&gt; String\nprintLine' [] = \"\"\nprintLine' xs = '+' : go xs\n  where go :: [Int] -&gt; String\n        go [] = \"\"\n        go (n:ns) = replicate n '-' ++ \"+\" ++ go ns\n\nprintLine'' :: [Int] -&gt; String\nprintLine'' xs = go True xs\n  where go :: Bool -&gt; [Int] -&gt; String\n        go _ [] = \"\"\n        go isFirst (n:ns) = (if isFirst then \"+\" else \"\")\n          ++ replicate n '-' ++ \"+\" ++ go False ns\n</code></pre>\n\n<p>With these definitions</p>\n\n<pre><code>\u03bb&gt; map printLine' [[], [1..4], [5]]\n[\"\",\"+-+--+---+----+\",\"+-----+\"]\n\u03bb&gt; map printLine'' [[], [1..4], [5]]\n[\"\",\"+-+--+---+----+\",\"+-----+\"]\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 8843385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c36b066e6fbd3997a82d7ea39d665603?s=128&d=identicon&r=PG&f=1", "display_name": "ramon abacherli", "link": "https://stackoverflow.com/users/8843385/ramon-abacherli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 52432027, "answer_count": 2, "score": 1, "last_activity_date": 1537518182, "creation_date": 1537471289, "last_edit_date": 1537474718, "question_id": 52431915, "link": "https://stackoverflow.com/questions/52431915/how-to-check-if-you-are-in-the-first-iteration-of-a-loop-in-haskell", "title": "How to check if you are in the first iteration of a loop in Haskell?", "body": "<p>I could understand if the question doesn't really clarify my problem, so here is some more explanation: </p>\n\n<p>I am trying to add the string  \"+\" at the start of my string, which I get like this: </p>\n\n<pre><code>printLine :: [Int] -&gt; String  --Type of the function\nprintLine [] = \"\"             --Base case\n\nprintLine (x:xs) = \"+\" ++ foldr (++) \"+\" f ++ printLine xs\n                 where f = replicate x \"-\"\n</code></pre>\n\n<p>The result I get from the above: </p>\n\n<pre><code>+-----++------++------++------+\n</code></pre>\n\n<p>The result I would like to get:</p>\n\n<pre><code>+-----+------+------+------+\n</code></pre>\n\n<p>Basically my question is: How do I add \"+\" only at the start? \nI can understand that this might be a silly question, but I am stuck for a while now and I can't find the answer on SO or elsewhere.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1537473538, "post_id": 52431887, "comment_id": 91808523, "body": "Without looking at the details too closely, you probably want <code>parListChunk</code> instead of <code>parList</code> - the computation you are parallelizing is so small that the overhead of sparking parallel evaluation for <b>each</b> element is not worth it."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1537474466, "last_edit_date": 1537474466, "creation_date": 1537473515, "answer_id": 52432442, "question_id": 52431887, "link": "https://stackoverflow.com/questions/52431887/bad-performance-for-parallel-n-body-in-haskell/52432442#52432442", "title": "Bad performance for parallel N-Body in Haskell", "body": "<p>Two thoughts:</p>\n\n<ol>\n<li><p>I don't recommend HMatrix. It's a \u201cMatlab in a box\u201d library, which not only goes strongly against Haskell's grain in terms of semantics (dynamical dimension checking<sup>\u2020</sup> etc.) but also subverts Haskell's better sides in performance. The idea of HMatrix/Matlab is to work with <em>large, monolithic, heap-allocated arrays</em> and do as much as possible with linear algebra primitives (which are implemented in C). This approach makes sense in a slow language like Matlab or Python (you delegate the inner loops to another, faster language), but not really in Haskell: the external calls can't properly be inlined, unlike native Haskell functions, and they add some overhead which though it may be negligible when crunching <em>large</em> vectors, can definitely add up for small ones. Pointer indirection harms cache performance.</p>\n\n<p>The most popular static, native LA library is <a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\"><code>linear</code></a>, which takes a much more Haskell-oriented approach (functors everywhere), and has proper tight memory layout. (I'm actually not such a fan of the interface itself, but the data types <a href=\"http://hackage.haskell.org/package/free-vector-spaces\" rel=\"nofollow noreferrer\">can also be used</a> with the very nice <a href=\"http://hackage.haskell.org/package/vector-space-0.14/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\"><code>vector-space</code></a> operators.)</p>\n\n<p>Switching to the types from <code>linear</code> improves the performance (single-threaded) by a factor 10 for me.</p>\n\n<pre><code>import Data.VectorSpace\nimport Data.VectorSpace.Free\nimport Linear.V2\n\nimport Data.List (zipWith4)\nimport Data.List.Split\nimport Control.DeepSeq\nimport System.Environment\nimport Control.Parallel.Strategies\n\n\ntype Vec = V2 Double  -- In case you're wondering: you don't need to\n                      -- hard-code the dimension, you can also make your\n                      -- functions _polymorphic_ on the vector space.\n\ndata Particle = Particle\n    { tag      :: !Int\n    , position :: !Vec\n    , velocity :: !Vec\n    , mass     :: !Double\n    }\n\ninstance Eq Particle where\n  p1 == p2 = (tag p1) == (tag p2)\n\ninstance Show Particle where\n  show p = show $ position p\n\ninstance NFData Particle where\n  rnf p = t `seq` ps `seq` vel `seq` m `seq` ()\n    where\n        t   = tag p\n        ps  = position p\n        vel = velocity p\n        m   = mass p\n\ndata System = System\n    { number :: Int\n    , particles :: [Particle]\n    }\n\ninstance Show System where\n    show sys = show (particles sys)\n\ninstance NFData System where\n    rnf sys = rnf $ particles sys\n\n\ng :: Double\ng = 6.674e-11\n\n-- | Construct a vector from a list of elements\nmkVector :: [Double] -&gt; Vec\nmkVector [x,y] = V2 x y\n\n-- | Construct a system from a given list of\n-- position vectors, velocity vectors, and masses\nmkSystem :: [(Vec, Vec, Double)] -&gt; System\nmkSystem xs = System\n    { number = length xs\n    , particles = map (apply Particle) $ zipWith cons [0..] xs\n    }\n    where\n    cons y (a, b, c)     = (y, a, b, c)\n    apply f (y, a, b, c) = f y a b c\n\n\n-- | Calculate the gravitational force vector acted on p1 by p2\ngetForce :: Particle -&gt; Particle -&gt; Vec\ngetForce p1 p2\n    | p1 == p2   = zeroV\n    | otherwise  = (g * (m1 * m2 / r^2)) *^ unit\n    where\n        m1 = mass p1\n        m2 = mass p2\n        r1 = position p1\n        r2 = position p2\n        dr = r2 - r1\n        r = magnitude dr\n        unit = dr ^/ r\n\n-- | Calculate the net gravitational force acted on the particle by\n-- all the other particles\nnetForce :: Particle -&gt; [Particle] -&gt; Vec\nnetForce p ps = sum (map (getForce p) ps)\n\n\n-- | Update the position and velocity of a particle in the system\n-- through a given timestep\nmove :: Double -&gt; System -&gt; Particle -&gt; Particle\nmove h sys p = let\n    (pos, vel) = (position p, velocity p)\n    acc        = (netForce p $ particles sys) ^/ mass p\n    in\n    p { position = pos ^+^ h *^ vel\n        , velocity = vel ^+^ h *^ acc\n        }\n\nstepSize = 1000\n\n-- | Update the system through one timestep\nevolve :: System -&gt; System\nevolve sys = sys { particles = ps' }\n    where\n      ps' = map (move stepSize sys) (particles sys) `using` parList rdeepseq\n\n-- | Stream of system at different timesteps\nevolution :: System -&gt; [System]\nevolution = iterate evolve\n\n\n\nsys1 :: System\nsys1 = mkSystem\n    [ (mkVector [1.496e11, 0], mkVector [0, 2.98e4], 5.974e24)\n    , (mkVector [2.279e11, 0], mkVector [0, 2.41e4], 6.42e23)\n    , (mkVector [5.79e10, 0], mkVector [0, 4.8e4], 3.3e23)\n    , (mkVector [0, 0], mkVector [0, 0], 1.98e30)\n    , (mkVector [ 1.08e11, 0], mkVector [0, 3.5e4], 4.87e24)\n    ]\n\n\nmain :: IO ()\nmain = do\n    [n] &lt;- fmap (map read) getArgs :: IO [Int]\n    let states = evolution sys1\n        finalState = states !! n\n\n    finalState `deepseq` (return ())\n</code></pre></li>\n<li><p>I wouldn't expect too gain much from parallelisation for only five particles anyhow. Each thread has very little it can do before giving back control, and everything interacts. You therefore quickly notice the overhead even of Haskell's light green threads.</p>\n\n<p>To benefit properly from parallelisation, you'll need to either set up the threads as a thread pool (like you would in traditional number-crunching languages) and thus avoid the sparking overhead, or make sure each thread has a lot to do. This works best if you mostly decouple the threads' domains; in really-many body applications this is done with something like a <a href=\"https://en.wikipedia.org/wiki/Barnes%E2%80%93Hut_simulation\" rel=\"nofollow noreferrer\">Barnes-Hut simulation</a>.</p></li>\n</ol>\n\n<p>Another thing: you're right now using a simple Euler solver for solving the equations of motion. That's a very bad scheme. Switching to a higher-order <a href=\"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods\" rel=\"nofollow noreferrer\">Runge Kutta solver</a>, ideally with adaptive step size, would allow you to save so much in terms of <em>number of steps</em> that the parallelisation aspect largely pales in impact by comparison.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Actually, HMatrix also has had <a href=\"http://hackage.haskell.org/package/hmatrix-0.19.0.0/docs/Numeric-LinearAlgebra-Static.html\" rel=\"nofollow noreferrer\">a statically checked module</a> for quite some time now.</sub></p>\n"}], "owner": {"reputation": 11, "user_id": 10383236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/937539d8f3dfac70a4752761b341c09f?s=128&d=identicon&r=PG&f=1", "display_name": "n626", "link": "https://stackoverflow.com/users/10383236/n626"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537474466, "creation_date": 1537471165, "question_id": 52431887, "link": "https://stackoverflow.com/questions/52431887/bad-performance-for-parallel-n-body-in-haskell", "title": "Bad performance for parallel N-Body in Haskell", "body": "<p>I wrote an N-body implementation in Haskell and tried to parallelize the updating of position of the particles (outer loop) using parList. However, the performance improvement from 1 to 3 cores is small, and it actually becomes worse for 4 cores. Here is the code, using 5 particles:</p>\n\n<pre><code>import Numeric.LinearAlgebra\nimport Data.List (zipWith4)\nimport Data.List.Split\nimport Control.DeepSeq\nimport System.Environment\nimport Control.Parallel.Strategies\n\n\ntype Vec = Vector Double\n\ndata Particle = Particle\n    { tag      :: Int\n    , position :: !Vec\n    , velocity :: !Vec\n    , mass     :: Double\n    }\n\ninstance Eq Particle where\n  p1 == p2 = (tag p1) == (tag p2)\n\ninstance Show Particle where\n  show p = show $ position p\n\ninstance NFData Particle where\n  rnf p = t `seq` ps `seq` vel `seq` m `seq` ()\n    where\n        t   = tag p\n        ps  = position p\n        vel = velocity p\n        m   = mass p\n\ndata System = System\n    { number :: Int\n    , particles :: [Particle]\n    }\n\ninstance Show System where\n    show sys = show (particles sys)\n\ninstance NFData System where\n    rnf sys = rnf $ particles sys\n\n\ng :: Double\ng = 6.674e-11\n\n-- | Construct a vector from a list of elements\nmkVector :: [Double] -&gt; Vec\nmkVector = vector\n\n-- | Construct a system from a given list of\n-- position vectors, velocity vectors, and masses\nmkSystem :: [(Vec, Vec, Double)] -&gt; System\nmkSystem xs = System\n    { number = length xs\n    , particles = map (apply Particle) $ zipWith cons [0..] xs\n    }\n    where\n    cons y (a, b, c)     = (y, a, b, c)\n    apply f (y, a, b, c) = f y a b c\n\n\n-- | Calculate the gravitational force vector acted on p1 by p2\ngetForce :: Particle -&gt; Particle -&gt; Vec\ngetForce p1 p2\n    | p1 == p2 = scalar 0.0\n    | otherwise = scalar (g * (m1 * m2 / r^2)) * unit\n    where\n        m1 = mass p1\n        m2 = mass p2\n        r1 = position p1\n        r2 = position p2\n        dr = r2 - r1\n        r = norm_2 dr\n        unit = normalize dr\n\n-- | Calculate the net gravitational force acted on the particle by\n-- all the other particles\nnetForce :: Particle -&gt; [Particle] -&gt; Vec\nnetForce p ps = sum (map (getForce p) ps)\n\n\n-- | Update the position and velocity of a particle in the system\n-- through a given timestep\nmove :: Double -&gt; System -&gt; Particle -&gt; Particle\nmove h sys p = let\n    (pos, vel) = (position p, velocity p)\n    acc        = (netForce p $ particles sys) / (scalar $ mass p)\n    in\n    p { position = pos + scalar h * vel\n        , velocity = vel + scalar h * acc\n        }\n\nstepSize = 1000\n\n-- | Update the system through one timestep\nevolve :: System -&gt; System\nevolve sys = sys { particles = ps' }\n    where\n      ps' = map (move stepSize sys) (particles sys) `using` parList rdeepseq\n\n-- | Stream of system at different timesteps\nevolution :: System -&gt; [System]\nevolution = iterate evolve\n\n\n\nsys1 :: System\nsys1 = mkSystem\n    [ (mkVector [1.496e11, 0], mkVector [0, 2.98e4], 5.974e24)\n    , (mkVector [2.279e11, 0], mkVector [0, 2.41e4], 6.42e23)\n    , (mkVector [5.79e10, 0], mkVector [0, 4.8e4], 3.3e23)\n    , (mkVector [0, 0], mkVector [0, 0], 1.98e30)\n    , (mkVector [ 1.08e11, 0], mkVector [0, 3.5e4], 4.87e24)\n    ]\n\n\nmain :: IO ()\nmain = do\n    [n] &lt;- fmap (map read) getArgs :: IO [Int]\n    let states = evolution sys1\n        finalState = states !! n\n\n    finalState `deepseq` (return ())\n</code></pre>\n\n<p>What is limiting the parallelism?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1537473728, "post_id": 52431770, "comment_id": 91808612, "body": "I suspect this might be easier to do with <code>Generic</code> and overlapping instances (you&#39;d have overlapping instances for <code>PK</code> and <code>Maybe</code> fields)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537474417, "post_id": 52431770, "comment_id": 91808933, "body": "It&#39;s pretty hard to read your draft code and work out what you&#39;re <i>actually</i> trying to accomplish. Could you please edit your question to explain the problem in much more detail before you get to your draft solution? There are already some minor red flags, like the combination of <code>Generic</code> with <code>Data</code>, but I don&#39;t even want to think about a solution because I don&#39;t feel like I understand the problem yet."}, {"owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "edited": false, "score": 0, "creation_date": 1537475045, "post_id": 52431770, "comment_id": 91809189, "body": "<code>{-# OVERLAPPING #-}</code> does the trick. Thanks"}, {"owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "edited": false, "score": 0, "creation_date": 1537511639, "post_id": 52431770, "comment_id": 91818599, "body": "By the way: there&#39;s a <a href=\"http://brandon.si/code/how-the-haskell-prelude-avoids-overlapping-types-in-show/\" rel=\"nofollow noreferrer\">usefull technique</a> to avoid overlapping instances. But it seems that this trick is not applicable in my case"}], "answers": [{"tags": [], "owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "is_accepted": false, "score": 0, "last_activity_date": 1537525844, "last_edit_date": 1537525844, "creation_date": 1537517997, "answer_id": 52439518, "question_id": 52431770, "link": "https://stackoverflow.com/questions/52431770/custom-generic-representation-of-the-data-type/52439518#52439518", "title": "Custom generic representation of the data type", "body": "<p>Ended up with the <a href=\"https://kseo.github.io/posts/2017-02-05-avoid-overlapping-instances-with-closed-type-families.html\" rel=\"nofollow noreferrer\">approach</a>, using <code>TypeFamilies</code></p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE UndecidableInstances #-}\nimport Data.Proxy\n\ntype family (F a) :: Bool where\n  F (Maybe a) = 'False\n  F a = 'True\n\nclass Required a where\n  isRequired :: Proxy a -&gt; Bool\n\nclass Required' (flag :: Bool) a where\n  isRequired' :: Proxy flag -&gt; Proxy a -&gt; Bool\n\ninstance (F a ~ flag, Required' flag a) =&gt; Required a where\n  isRequired = isRequired' (Proxy :: Proxy flag)\n\ninstance Required' 'False (Maybe a) where\n  isRequired' _ _ = False\n\ninstance Required' 'True a where\n  isRequired' _ x = True\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537525844, "creation_date": 1537470673, "last_edit_date": 1537524519, "question_id": 52431770, "link": "https://stackoverflow.com/questions/52431770/custom-generic-representation-of-the-data-type", "title": "Custom generic representation of the data type", "body": "<p>I need to generically render an html form by the given record type. For this reason, I've created type class</p>\n\n<pre><code>class EntityRep a where\n  toRep :: Proxy a -&gt; [FieldRep]\n  default toRep :: (Generic a, GEntityRep (Rep a)) =&gt; Proxy a -&gt; [FieldRep]\n  toRep _ = gtoRep (Proxy :: Proxy (Rep a))\n</code></pre>\n\n<p>where</p>\n\n<pre><code>data FieldRep = FieldRep\n  { fieldName :: String\n  , fieldRequired :: Bool\n  } deriving (Show)\nclass GEntityRep f where\n  gtoRep :: Proxy f -&gt; [FieldRep]\n</code></pre>\n\n<p>And the instance for the selector representation:</p>\n\n<pre><code>instance (Selector a, Required a) =&gt; GEntityRep (M1 S s (K1 R a)) where\n  gtoRep _ = [FieldRep { fieldName = selName (undefined :: M1 S s (K1 R a) ())\n                       , fieldRequired = isRequired (Proxy @a) }]\n</code></pre>\n\n<p>So I want to implement the function</p>\n\n<pre><code>isRequired :: (Required a) =&gt; Proxy a -&gt; Bool\n--returns True, only if the type is (Maybe a) for all a\n</code></pre>\n\n<p>My attempt was to use <code>Data.Data</code>:</p>\n\n<pre><code>constrs :: forall a. (Data a) =&gt; Proxy a -&gt; [Constr]\nconstrs _ = let dt = dataTypeOf (undefined :: a)\n  in if isAlgType dt then dataTypeConstrs dt\n     else []\nisRequired :: forall a. (Data a) =&gt; Proxy a -&gt; Bool\nisRequired proxy =\n     toConstr (Nothing :: Maybe ()) `elem` (constrs proxy)\n  || toConstr (Just () :: Maybe ()) `elem` (constrs proxy)\n</code></pre>\n\n<p>But this does not work, because constrs for different types may be equal.</p>\n\n<p>At the end, for the following record</p>\n\n<pre><code>data PK a = PK a | Unset deriving (Data, Typeable, Show)\ndata ProductCategory = Clothes | Food deriving (Data, Typeable, Show)\ndata Product = Product { productName :: String\n                       , productCategory :: ProductCategory\n                       , productPrice :: Maybe Int } deriving (Generic, Show)\ninstance EntityRep Product\n</code></pre>\n\n<p>the following expression</p>\n\n<pre><code>&gt;&gt;&gt; toRep (Proxy @Product)\n</code></pre>\n\n<p>should return </p>\n\n<pre><code>[FieldRep{fieldName=\"productName\"\n         ,fieldRequired=True}\n,FieldRep{fieldName=\"productCategory\"\n         ,fieldRequired=True}\n,FieldRep{fieldName=\"productPrice\"\n         ,fieldRequired=False}]\n</code></pre>\n\n<p>I could create the type class</p>\n\n<pre><code>class Required a where\n  isRequired :: Proxy a -&gt; Bool\n</code></pre>\n\n<p>then implement it for the various of types, but it's so bothersome. And all instances will be identical, except <code>Maybe a</code>.</p>\n\n<h2>Edit. Using overlapping instances</h2>\n\n<p>We can make a default implementation</p>\n\n<pre><code>instance Required a where\n  isRequired _ = True\n</code></pre>\n\n<p>then overlap it with the <code>Maybe a</code> instance:</p>\n\n<pre><code>instance {-# OVERLAPPING #-} Required (Maybe a) where\n  isRequired _ = False\n</code></pre>\n"}, {"tags": ["haskell", "archlinux", "quickcheck", "manjaro"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1537470625, "post_id": 52429645, "comment_id": 91807106, "body": "You&#39;ll notice that cabal suggested running <code>ghc-pkg check</code>. Did you try that?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1537479835, "post_id": 52429645, "comment_id": 91811153, "body": "With Stack, you&#39;re not really supposed to install packages on your system. Add required packages to the project&#39;s <code>.cabal</code> file and run things with <code>stack build</code>, <code>stack test</code>, etc."}, {"owner": {"reputation": 4124, "user_id": 3183924, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5e9d0e2a47aea15d63e369970b921cca?s=128&d=identicon&r=PG&f=1", "display_name": "Paradox", "link": "https://stackoverflow.com/users/3183924/paradox"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537737700, "post_id": 52429645, "comment_id": 91882747, "body": "@AJFarmar Yes, I did."}, {"owner": {"reputation": 4124, "user_id": 3183924, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5e9d0e2a47aea15d63e369970b921cca?s=128&d=identicon&r=PG&f=1", "display_name": "Paradox", "link": "https://stackoverflow.com/users/3183924/paradox"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1537737702, "post_id": 52429645, "comment_id": 91882748, "body": "@MarkSeemann Didn&#39;t know that, I&#39;ll do it that way in the future."}], "answers": [{"tags": [], "owner": {"reputation": 4124, "user_id": 3183924, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5e9d0e2a47aea15d63e369970b921cca?s=128&d=identicon&r=PG&f=1", "display_name": "Paradox", "link": "https://stackoverflow.com/users/3183924/paradox"}, "is_accepted": true, "score": 0, "last_activity_date": 1537463606, "last_edit_date": 1537463606, "creation_date": 1537461866, "answer_id": 52429722, "question_id": 52429645, "link": "https://stackoverflow.com/questions/52429645/haskell-there-are-files-missing-in-the-quickcheck-2-11-3-package/52429722#52429722", "title": "Haskell there are files missing in the QuickCheck-2.11.3 package", "body": "<p>Even though I have a <code>main = do</code> and couldn't get it working that way, I was able to run my QuickCheck test as follows:</p>\n\n<p>To run a quickCheck, first load your program with:</p>\n\n<pre><code> $ ghci MyProg.hs\n</code></pre>\n\n<p>Then to run the quickCheck, find the test you want to run, then run it with:</p>\n\n<pre><code> $ quickCheck my_quick_check\n</code></pre>\n"}], "owner": {"reputation": 4124, "user_id": 3183924, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5e9d0e2a47aea15d63e369970b921cca?s=128&d=identicon&r=PG&f=1", "display_name": "Paradox", "link": "https://stackoverflow.com/users/3183924/paradox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 503, "favorite_count": 0, "accepted_answer_id": 52429722, "answer_count": 1, "score": 0, "last_activity_date": 1537463606, "creation_date": 1537461634, "last_edit_date": 1537461978, "question_id": 52429645, "link": "https://stackoverflow.com/questions/52429645/haskell-there-are-files-missing-in-the-quickcheck-2-11-3-package", "title": "Haskell there are files missing in the QuickCheck-2.11.3 package", "body": "<p>I tried running my program which uses Haskell QuickCheck via <code>ghc MyProgramm.hs</code> , but received the following error:</p>\n\n<pre><code>$ ghc Ex2.hs \n[1 of 1] Compiling Ex2              ( Ex2.hs, Ex2.o )\n\nEx2.hs:21:1: error:\n    Could not find module \u2018Test.QuickCheck\u2019\n    There are files missing in the \u2018QuickCheck-2.11.3\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n   |\n21 | import Test.QuickCheck (\n   | ^^^^^^^^^^^^^^^^^^^^^^^^...\n</code></pre>\n\n<p>I installed <code>stack</code>, ran <code>stack update</code> and <code>stack install QuickCheck</code> without issue but the error persisted.  Then, I ran <code>cabal install QuickCheck</code> and got the following errors:</p>\n\n<pre><code>$ cabal install QuickCheck\nResolving dependencies...\nConfiguring QuickCheck-2.12.4...\nBuilding QuickCheck-2.12.4...\nFailed to install QuickCheck-2.12.4\nBuild log ( /home/username/.cabal/logs/ghc-8.4.3/QuickCheck-2.12.4-3d2YDDqfPBn4BfmTJbpJXK.log ):\ncabal: Entering directory '/tmp/cabal-tmp-9133/QuickCheck-2.12.4'\nConfiguring QuickCheck-2.12.4...\nPreprocessing library for QuickCheck-2.12.4..\nBuilding library for QuickCheck-2.12.4..\n[ 1 of 16] Compiling Test.QuickCheck.Exception ( Test/QuickCheck/Exception.hs, dist/build/Test/QuickCheck/Exception.o )\n[ 2 of 16] Compiling Test.QuickCheck.Random ( Test/QuickCheck/Random.hs, dist/build/Test/QuickCheck/Random.o )\n\nTest/QuickCheck/Random.hs:10:1: error:\n    Could not find module \u2018System.Random\u2019\n    There are files missing in the \u2018random-1.1\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n   |\n10 | import System.Random\n   | ^^^^^^^^^^^^^^^^^^^^\n\nTest/QuickCheck/Random.hs:11:1: error:\n    Could not find module \u2018System.Random.TF\u2019\n    There are files missing in the \u2018tf-random-0.5\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n   |\n11 | import System.Random.TF\n   | ^^^^^^^^^^^^^^^^^^^^^^^\n\nTest/QuickCheck/Random.hs:12:1: error:\n    Could not find module \u2018System.Random.TF.Gen\u2019\n    There are files missing in the \u2018tf-random-0.5\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n   |\n12 | import System.Random.TF.Gen(splitn)\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncabal: Leaving directory '/tmp/cabal-tmp-9133/QuickCheck-2.12.4'\ncabal: Error: some packages failed to install:\nQuickCheck-2.12.4-3d2YDDqfPBn4BfmTJbpJXK failed during the building phase. The\nexception was:\nExitFailure 1\n</code></pre>\n\n<p>However, I already have the arch packages <code>haskell-random</code>, <code>haskell-tf-random</code> and <code>haskell-mwc-random</code> installed.  Does anybody know how to fix this?</p>\n\n<p>Edit: I also ran <code>cabal install random --reinstall</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 1, "creation_date": 1537470229, "post_id": 52428880, "comment_id": 91806899, "body": "You should ask your edit as a new question - more people will see that you&#39;ve asked something different."}], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "edited": false, "score": 0, "creation_date": 1537461902, "post_id": 52428990, "comment_id": 91803004, "body": "Ok, but how can I determine whether value is <code>Just</code> something or <code>Nothing</code> using <code>Data</code>/<code>Typeable</code>?"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "edited": false, "score": 0, "creation_date": 1537462069, "post_id": 52428990, "comment_id": 91803081, "body": "Comparison between <code>Just</code> and <code>Nothing</code> should still work, as they have the same type. If you&#39;re having problems with that, ask in a separate question."}, {"owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "edited": false, "score": 0, "creation_date": 1537464445, "post_id": 52428990, "comment_id": 91804163, "body": "Thank you for the response. I&#39;ve updated my question where I described how I came to this question."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 3, "last_activity_date": 1537459028, "creation_date": 1537459028, "answer_id": 52428990, "question_id": 52428880, "link": "https://stackoverflow.com/questions/52428880/confused-with-data-data-toconstr/52428990#52428990", "title": "Confused with Data.Data.toConstr", "body": "<p>To quote <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Data.html#t:Constr\" rel=\"nofollow noreferrer\">the documentation</a> -</p>\n\n<blockquote>\n  <p>Note that equality on constructors with different types may not work -- i.e. the constructors for False and Nothing may compare equal.</p>\n</blockquote>\n\n<p><code>Just ()</code> is a constructor of <code>Maybe ()</code> - it won't necessarily compare false to the constructors of <code>T</code>.</p>\n"}], "owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 52428990, "answer_count": 1, "score": 0, "last_activity_date": 1537470906, "creation_date": 1537458588, "last_edit_date": 1537470906, "question_id": 52428880, "link": "https://stackoverflow.com/questions/52428880/confused-with-data-data-toconstr", "title": "Confused with Data.Data.toConstr", "body": "<p>I'm confused why for given data type</p>\n\n<pre><code>import Data.Data\ndata T a = T1 a | T2 deriving Data\n</code></pre>\n\n<p>the expression</p>\n\n<pre><code>toConstr (Just ()) == toConstr (T2 :: T Int)\n</code></pre>\n\n<p>returns <code>True</code>, while</p>\n\n<pre><code>toConstr (Just ()) == toConstr (T1 ())\n</code></pre>\n\n<p>returns <code>False</code>.</p>\n\n<p>Related <a href=\"https://stackoverflow.com/questions/52431770/custom-generic-representation-of-the-data-type\">question</a></p>\n"}, {"tags": ["haskell", "traversal", "existential-type", "data-kinds", "conkin"], "comments": [{"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1537459497, "post_id": 52427255, "comment_id": 91801797, "body": "Is there anything preventing you from using type-level <code>Nat</code>s in your code? I don&#39;t understand if e.g. <code>nextItem</code> is solely dependent on some runtime values."}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1537477808, "post_id": 52427255, "comment_id": 91810408, "body": "Where might type-level <code>Nat</code>s be useful?"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1537478977, "post_id": 52427255, "comment_id": 91810856, "body": "In being able to define indexes at the type level so you wouldn&#39;t have to coerce them, since a type-level index would always yield the same type on the <code>Foldable</code> - though that might require a type-level notion of the length of the <code>Foldable</code> to implement the traversal and construction of <code>res</code>. This is more speculation than a concrete design."}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1537480862, "post_id": 52427255, "comment_id": 91811490, "body": "I&#39;m sorry. It&#39;s not enough for me to grasp."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 6198830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/313406b45e01d20f96e49ada607fa366?s=128&d=identicon&r=PG", "display_name": "Facundo Dom&#237;nguez", "link": "https://stackoverflow.com/users/6198830/facundo-dom%c3%adnguez"}, "is_accepted": true, "score": 2, "last_activity_date": 1538139429, "last_edit_date": 1538139429, "creation_date": 1538138898, "answer_id": 52555715, "question_id": 52427255, "link": "https://stackoverflow.com/questions/52427255/change-values-to-indices-in-a-conkin-traversable-without-unsafecoerce/52555715#52555715", "title": "Change values to indices in a `Conkin.Traversable` without `unsafeCoerce`", "body": "<p>I conjecture that it is not possible to implement <code>toTupleDump</code> without <code>unsafeCoerce</code>.</p>\n\n<p>The problem can be reduced to computing <code>fillWithIndexes</code></p>\n\n<pre><code>data SomeIndex t = forall xs. SomeIndex (t (Index xs))\n\nfillWithIndexes :: forall (t :: (k -&gt; *) -&gt; *) (a :: k -&gt; *). Conkin.Traversable t\n  =&gt; t a -&gt; SomeIndex t\n</code></pre>\n\n<p>where <code>xs</code> is the list of types collected in the traversal of the value of type <code>t a</code>. However, the type system can't guarantee that traversals over the result <code>t (Index xs)</code> produce the same list of types <code>xs</code>.</p>\n\n<p>If the <code>Traversable</code> instance of <code>t</code> does not respect the <code>Traversable</code> laws, it is possible to concoct an implementation which actually changes the types.</p>\n\n<pre><code>data T a = TBool (a Bool) | TChar (a Char)\ninstance Conkin.Functor T where\n  fmap f (TBool a) = TBool (f a)\n  fmap f (TChar a) = TChar (f a)\n\ninstance Conkin.Foldable T where\n  foldr f z (TBool a) = f a z\n  foldr f z (TChar a) = f a z\n\ninstance Conkin.Traversable T where\n  traverse f (TBool a) = Conkin.pure (Compose (TChar undefined))\n  traverse f (TChar a) = Conkin.pure (Compose (TBool undefined))\n</code></pre>\n\n<p>Can't we rule this case out by assuming the <code>Traversable</code> laws hold? Yes, we can rule it out, but the typechecker can't, which means that we must use <code>unsafeCoerce</code>.</p>\n"}], "owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 2, "accepted_answer_id": 52555715, "answer_count": 1, "score": 4, "last_activity_date": 1538139429, "creation_date": 1537453017, "last_edit_date": 1537453996, "question_id": 52427255, "link": "https://stackoverflow.com/questions/52427255/change-values-to-indices-in-a-conkin-traversable-without-unsafecoerce", "title": "Change values to indices in a `Conkin.Traversable` without `unsafeCoerce`", "body": "<p>Using the <code>conkin</code> package: <a href=\"https://hackage.haskell.org/package/conkin\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/conkin</a></p>\n\n<p>I want to be able to take any <code>Conkin.Traversable</code> and dump it out to a <code>Tuple</code> leaving behind <em>indices</em> into that <code>Tuple</code> so that I can reconstruct it.</p>\n\n<p>I'm using a few language extensions:</p>\n\n<pre><code>{-# LANGUAGE DataKinds                 #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE GADTs                     #-}\n{-# LANGUAGE KindSignatures            #-}\n{-# LANGUAGE PolyKinds                 #-}\n{-# LANGUAGE RankNTypes                #-}\n{-# LANGUAGE ScopedTypeVariables       #-}\n{-# LANGUAGE TypeOperators             #-}\n</code></pre>\n\n<p>Module declaration</p>\n\n<pre><code>module TupleDump where\n</code></pre>\n\n<p>Imports</p>\n\n<pre><code>import           Control.Monad.State  (State, runState)\nimport qualified Control.Monad.State  as State\nimport           Data.Functor.Compose (getCompose)\nimport           Data.Functor.Const   (Const (Const), getConst)\nimport           Conkin               (Dispose (..), Flip (..), Tuple (..))\nimport qualified Conkin\n</code></pre>\n\n<p>I want to not have to use an unsafeCoerce, but can't see a way around it:</p>\n\n<pre><code>import           Unsafe.Coerce        (unsafeCoerce)\n</code></pre>\n\n<p>Let's define an <code>Index</code> as:</p>\n\n<pre><code>data Index (xs :: [k]) (x :: k) where\n  IZ :: Index (x ': xs) x\n  IS :: Index xs i -&gt; Index (x ': xs) i\n</code></pre>\n\n<p>We can use an index to extract an item from a <code>Tuple</code>:</p>\n\n<pre><code>(!) :: Tuple xs a -&gt; Index xs x -&gt; a x\n(!) (Cons x _) IZ      = x\n(!) (Cons _ xs) (IS i) = xs ! i\n</code></pre>\n\n<p>We should be able to take anything which is an instance of <code>Conkin.Traversable</code> and <em>dump</em> it to a <code>Tuple</code> leaving behind an Index in place of each element. Then from the structure of indices and the tuple we can reconstruct the original Traversable structure:</p>\n\n<pre><code>data TupleDump t a = forall xs. TupleDump (t (Index xs)) (Tuple xs a)\n\ntoTupleDump :: forall (t :: (k -&gt; *) -&gt; *) (a :: k -&gt; *). Conkin.Traversable t\n  =&gt; t a -&gt; TupleDump t a\nfromTupleDump :: Conkin.Functor t =&gt; TupleDump t a -&gt; t a\n</code></pre>\n\n<p>The reconstruction part is easy:</p>\n\n<pre><code>fromTupleDump (TupleDump inds vals) = Conkin.fmap (vals !) inds\n</code></pre>\n\n<p>This question is specifically how to implement <code>toTupleDump</code>. Below is my best attempt so far:</p>\n\n<hr>\n\n<p>It involves a lot of helper functions and an <code>unsafeCoerce</code></p>\n\n<p>Existentially quantified functors:</p>\n\n<pre><code>data Some (a :: k -&gt; *) = forall (x :: k). Some (a x)\n</code></pre>\n\n<p>Given an <code>Int</code>, construct some <code>Index</code>:</p>\n\n<pre><code>mkIndex :: Tuple xs a -&gt; Int -&gt; Some (Index xs)\nmkIndex Nil _ = error \"Index out of bounds\"\nmkIndex _ n | n &lt; 0 = error \"Index out of bounds\"\nmkIndex (Cons _ _) 0 = Some IZ\nmkIndex (Cons _ xs) n = case mkIndex xs (n - 1) of Some i -&gt; Some $ IS i\n</code></pre>\n\n<p>Given a list of existentially quantified functors, group them into a (flipped) <code>Tuple</code>:</p>\n\n<pre><code>fromList :: [Some a] -&gt; Some (Flip Tuple a)\nfromList [] = Some $ Flip Nil\nfromList (Some x : xs) = case fromList xs of\n  Some (Flip t) -&gt; Some (Flip (Cons x t))\n</code></pre>\n\n<p>Traversal inside a <code>Prelude.Applicative</code> (rather than a <code>Conkin.Applicative</code>)</p>\n\n<pre><code>traverseInPrelude :: (Prelude.Applicative f, Conkin.Traversable t)\n  =&gt; (forall x. a x -&gt; f (b x)) -&gt; t a -&gt; f (t b)\ntraverseInPrelude fn t =\n  Conkin.fmap (unComposeConst . getFlip) . getCompose &lt;$&gt;\n    getDispose (Conkin.traverse (Dispose . fmap ComposeConst . fn) t)\n\nnewtype ComposeConst a b c = ComposeConst {unComposeConst :: a b}\n</code></pre>\n\n<p>And now we can define <code>toTupleDump</code>:</p>\n\n<pre><code>toTupleDump t =\n</code></pre>\n\n<p>We'll track the index as just an <code>Int</code> at first and dump our elements to a normal list.\nSince we're building the list with <code>(:)</code>, it's going to be backwards.</p>\n\n<pre><code>  let\n    nextItem :: forall (x :: k). a x -&gt; State (Int, [Some a]) (Const Int x)\n    nextItem x = do\n      (i, xs') &lt;- State.get\n      State.put (i + 1, Some x : xs')\n      return $ Const i\n    (res, (_, xs)) = runState (traverseInPrelude nextItem t) (0, [])\n  in\n</code></pre>\n\n<p>Now we reverse the list and convert it to a <code>Tuple</code>:</p>\n\n<pre><code>  case fromList (reverse xs) of\n    Some (Flip (tup :: Tuple xs a)) -&gt;\n</code></pre>\n\n<p>And we need to <code>fmap</code> over the <code>res</code> structure changing all the <code>Int</code>s into <code>Index</code>es</p>\n\n<pre><code>      let\n        indexedRes = Conkin.fmap (coerceIndex . mkIndex tup . getConst) res\n</code></pre>\n\n<p>Here's that <code>unsafeCoerce</code>. Since this approach involves two passes over the structure, we have to let the typechecker know that on the second pass, the type parameter is the same as it was on the first pass.</p>\n\n<pre><code>        coerceIndex :: forall x. Some (Index xs) -&gt; Index xs x\n        coerceIndex (Some i) = unsafeCoerce i\n      in\n      TupleDump indexedRes tup\n</code></pre>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "edited": false, "score": 4, "creation_date": 1537437278, "post_id": 52422014, "comment_id": 91787651, "body": "<code>Num</code> requiring <code>Eq</code> is in the Haskell report (the specification), but it&#39;s not included in GHC because it&#39;s a seriously annoying requirement. <code>Num</code> is generally regarded as one of the cruftier classes in Haskell: purescript&#39;s equivalent is a good example of what a redesign might look like."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1537439698, "post_id": 52422014, "comment_id": 91789116, "body": "The change of Num no longer requiring Eq appears to have been made in the GHC 7.4 release: <a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/release-7-4-1.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1537440665, "post_id": 52422014, "comment_id": 91789665, "body": "You say &quot;irrational numbers can&#39;t be used in computers&quot;; I say <a href=\"http://hackage.haskell.org/package/cyclotomic\" rel=\"nofollow noreferrer\">huh?</a> <a href=\"http://hackage.haskell.org/package/numbers-3000.2.0.2/docs/Data-Number-CReal.html\" rel=\"nofollow noreferrer\">what?</a>"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1537456815, "post_id": 52422014, "comment_id": 91800193, "body": "Non-computable numbers can\u2019t (really) be used by computers. Not all irrational numbers are non-computable though. A lot of the irrational numbers you come across in practical applications (like pi and e) are computable."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1537437081, "creation_date": 1537437081, "answer_id": 52422271, "question_id": 52422014, "link": "https://stackoverflow.com/questions/52422014/is-the-haskell-type-class-real-a-misnomer/52422271#52422271", "title": "Is the Haskell type class &#39;Real&#39; a misnomer?", "body": "<p>Yes, the name <code>Real</code> is a rather misleading name for the class of types that can be converted to a rational.</p>\n\n<p>Indeed, we have instances like <code>Real Integer</code>, <code>Real IntPtr</code>, <code>Real CBool</code> which can be very surprising.</p>\n\n<p>The standard numeric classes are generally regarded as being a bit weird, both in their names and in their overall design.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1537438094, "post_id": 52422529, "comment_id": 91788140, "body": "<code>Real</code> <b>is</b> saying, basically, that all representable values have to be rational. I think you&#39;re talking about <code>Fractional</code> with its <code>fromRational</code> method, but <code>Real</code> actually has <code>toRational</code>."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1537438354, "post_id": 52422529, "comment_id": 91788284, "body": "Your comparison to <code>fromInteger</code> does not seem right to me as that converts in the other direction. If I have a type that represents computable reals and I want that to implement <code>Real</code>, my implementation of <code>toRational</code> must either break contract by rounding irrational numbers with some fixed precision (note that the docs say &quot;full precision&quot;) or be partial."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1537438502, "post_id": 52422529, "comment_id": 91788375, "body": "Though on second thought, implementations of <code>fromInteger</code> can be partial too (not every <code>Integer</code> can be represented as an <code>Int</code> for example - or a <code>Double</code> for that matter), so a comparison would actually make sense to justify a <code>toRational</code> implementation that diverges on irrational numbers."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1537439208, "post_id": 52422529, "comment_id": 91788793, "body": "@sepp2k the problem is that <a href=\"https://en.wikipedia.org/wiki/Almost_all\" rel=\"nofollow noreferrer\">almost all</a> real numbers are irrational. It&#39;s not just that very big numbers don&#39;t allow <code>toRational</code> anymore, but basically <i>any</i> number you pull from a typical distribution of reals can&#39;t be converted to rational without rounding."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1537439393, "post_id": 52422529, "comment_id": 91788919, "body": "@leftaroundabout You&#39;re right. I only realised at the end of the paragraph. I&#39;ve taken that part out now."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 4, "last_activity_date": 1537439363, "last_edit_date": 1537439363, "creation_date": 1537437858, "answer_id": 52422529, "question_id": 52422014, "link": "https://stackoverflow.com/questions/52422014/is-the-haskell-type-class-real-a-misnomer/52422529#52422529", "title": "Is the Haskell type class &#39;Real&#39; a misnomer?", "body": "<p>In general, Haskell's number classes are a bit of a mess. They're defined in a way that makes it convenient and easy to use the basic number types like <code>Int</code>, <code>Integer</code>, <code>Double</code>, etc. But when you start wanting more advanced kinds of numbers... they don't always make a lot of sense.</p>\n\n<hr>\n\n<p>Regarding <code>Num</code>: This is interesting. Both the Haskell '98 and Haskell 2010 Report demand that</p>\n\n<pre><code>class (Eq a, Show a) =&gt; Num a\n</code></pre>\n\n<p>If you look at the documentation for <code>base-4.0.0.0</code>, you find this is the case:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.0.0.0/docs/Prelude.html#7\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.0.0.0/docs/Prelude.html#7</a></p>\n\n<p>However, at some point the <code>base</code> package was changed such that <code>Num</code> now has no superclasses (contradicting the Report). So your slides aren't wrong; it <em>used</em> to be defined that way, but it got changed at some point. If you dig far enough, there's probably a ticket or a wiki page about this.</p>\n\n<hr>\n\n<p>Regarding <code>Real</code>... yes, the name is rather misleading. I'm also not really sure why it's different than <code>RealFrac</code>, which is <em>also</em> about conversions from a number to various ratios or integers.</p>\n\n<hr>\n\n<p>If this kind of thing interests you, there are various \"alternative Prelude\" libraries out there (e.g., \"classy Prelude\", \"numeric Prelude\") which replace the standard Prelude with something hopefully a little bit more sensible. It turns out it's surprisingly hard to do this really well \u2014 which is why the official spec hasn't really changed much. Nobody has suggested anything conclusively better.</p>\n"}], "owner": {"reputation": 677, "user_id": 3536806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5321e2babfa1c70186599163a3c188?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik Schrempf", "link": "https://stackoverflow.com/users/3536806/dominik-schrempf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 2, "accepted_answer_id": 52422271, "answer_count": 2, "score": 5, "last_activity_date": 1537439363, "creation_date": 1537436297, "question_id": 52422014, "link": "https://stackoverflow.com/questions/52422014/is-the-haskell-type-class-real-a-misnomer", "title": "Is the Haskell type class &#39;Real&#39; a misnomer?", "body": "<p>I am trying to understand the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Num\" rel=\"noreferrer\">numeric type class</a> hierarchy in Haskell. The basic numeric type is</p>\n\n<pre><code>class Num a where\n...\n</code></pre>\n\n<p>As a side note, according to some of my sources (slides), it should actually be</p>\n\n<pre><code>class Eq a =&gt; Num a where\n...\n</code></pre>\n\n<p>but I cannot find this in the Prelude.</p>\n\n<p>Now, I am interested in the <code>Real</code> type class</p>\n\n<pre><code>class (Num a, Ord a) =&gt; Real a where\n  -- the rational equivalent of its real argument with full precision\n  toRational :: a -&gt; Rational\n</code></pre>\n\n<p>I guess that <code>Real</code> refers to the fact that types that are instances of <code>Real</code> are not complex. But my understanding of a <code>Real</code> number from Mathematics is that it can be <em>Rational</em> and <em>Irrational</em>, so there is no equivalent of <code>toRational</code> for all of them. Of course, irrational numbers can't be used in computers anyways...</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["macos", "haskell", "devops", "nix", "nixos"], "comments": [{"owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1537449908, "post_id": 52421987, "comment_id": 91795503, "body": "The nixpkgs-unstable branch is typically a little bit behind master (unless there are failing tests holding things up). Is that not recent enough?"}], "answers": [{"comments": [{"owner": {"reputation": 1044, "user_id": 312656, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/373205140270199edfec6a500d269f8c?s=128&d=identicon&r=PG", "display_name": "nau", "link": "https://stackoverflow.com/users/312656/nau"}, "edited": false, "score": 0, "creation_date": 1537470171, "post_id": 52426587, "comment_id": 91806865, "body": "I&#39;m not sure I get it right. Now HowOldIs app shows 6ec64973bc3a48b0c54d11c782e8b88b550a8eab as latest nixpkgs-18.09-darwin commit. I use this to import packages:     import (builtins.fetchGit {       name = &quot;lts-12.9&quot;;       url = <a href=\"https://github.com/nixos/nixpkgs/\" rel=\"nofollow noreferrer\">github.com/nixos/nixpkgs</a>;       rev = &quot;6ec64973bc3a48b0c54d11c782e8b88b550a8eab&quot;;     }) {}; nix-build says fatal: not a tree object error: program &#39;git&#39; failed with exit code 128"}, {"owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "reply_to_user": {"reputation": 1044, "user_id": 312656, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/373205140270199edfec6a500d269f8c?s=128&d=identicon&r=PG", "display_name": "nau", "link": "https://stackoverflow.com/users/312656/nau"}, "edited": false, "score": 0, "creation_date": 1537476564, "post_id": 52426587, "comment_id": 91809857, "body": "I&#39;d argue you got it right, Nix got it wrong. <a href=\"https://github.com/NixOS/nix/issues/2431\" rel=\"nofollow noreferrer\">Relevant issue</a>"}], "tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": true, "score": 2, "last_activity_date": 1537476337, "last_edit_date": 1537476337, "creation_date": 1537451029, "answer_id": 52426587, "question_id": 52421987, "link": "https://stackoverflow.com/questions/52421987/how-to-find-nixpkgs-revision-where-macos-darwin-binary-cache-is-built/52426587#52426587", "title": "How to find nixpkgs revision where macos/darwin binary cache is built?", "body": "<p>You can find cached versions of nixpkgs <a href=\"http://howoldis.herokuapp.com/\" rel=\"nofollow noreferrer\">right here on the HowOldIs app.</a></p>\n\n<p>You'll probably want to use a revision of <code>nixpkgs-18.09-darwin</code> or <code>nixpkgs-unstable</code>.</p>\n\n<hr>\n\n<p>You can then fetch nixpkgs like so</p>\n\n<pre><code>builtins.fetchGit {\n  name = \"nixpkgs\";\n  url = \"https://github.com/nixos/nixpkgs.git\";\n  rev = \"6ec64973bc3a48b0c54d11c782e8b88b550a8eab\";\n  ref = \"release-18.09\";\n})\n</code></pre>\n\n<p>The <code>ref</code> attribute is required when the revision isn't under the default branch - typically <code>master</code>.</p>\n\n<p>A note <a href=\"https://nixos.org/nix/manual/#ssec-builtins\" rel=\"nofollow noreferrer\">in the Nix manual</a> describes it as follows:</p>\n\n<blockquote>\n  <p><strong>Note:</strong> It is nice to always specify the branch which a revision belongs to. Without the branch being specified, the fetcher might fail if the default branch changes. Additionally, it can be confusing to try a commit from a non-default branch and see the fetch fail. If the branch is specified the fault is much more obvious.</p>\n</blockquote>\n\n<p>I suppose this behavior is inspired by a workaround in the Git protocol, that you can only specify refs for fetching, but not arbitrary commits, if I'm not mistaken.</p>\n"}], "owner": {"reputation": 1044, "user_id": 312656, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/373205140270199edfec6a500d269f8c?s=128&d=identicon&r=PG", "display_name": "nau", "link": "https://stackoverflow.com/users/312656/nau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "accepted_answer_id": 52426587, "answer_count": 1, "score": 3, "last_activity_date": 1537476337, "creation_date": 1537436200, "question_id": 52421987, "link": "https://stackoverflow.com/questions/52421987/how-to-find-nixpkgs-revision-where-macos-darwin-binary-cache-is-built", "title": "How to find nixpkgs revision where macos/darwin binary cache is built?", "body": "<p>I'd like to pin nixpkgs to a quite fresh revision, say, Haskell LTS-12.9 or something. And I want to use nix-build for MacOS (Darwin) builds.</p>\n\n<p>The problem is there is no binary cache for most of Haskell packages, and the build takes ages to complete (on MacOS).</p>\n\n<p>How could I find \"optimal\" nixpkgs revision, which is recent enough to contain software versions I need, but old enough for binary caches to be available for Linux and MacOS?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537431269, "post_id": 52420495, "comment_id": 91784117, "body": "Using <code>find</code> here would make matters very complicated, and furthermore probably inefficient. Since for each element the <code>find</code> yields, we would need to iterate over the (remainder) of the list. I do not really see why this would be helpful."}, {"owner": {"reputation": 2402, "user_id": 4585226, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/881a0905a462b83fbb047fe96173c0ed?s=128&d=identicon&r=PG&f=1", "display_name": "476rick", "link": "https://stackoverflow.com/users/4585226/476rick"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537431380, "post_id": 52420495, "comment_id": 91784179, "body": "It&#39;s for practicing purposes, I just want to know how you can define such function."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537431582, "post_id": 52420495, "comment_id": 91784284, "body": "With explicit recursion, and <code>takeWhile</code>, etc. But it will nullify the purpose of <code>find</code> anyway."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537432107, "post_id": 52420495, "comment_id": 91784555, "body": "Notice the similarities between the list comprehension in <code>find</code> and the one in <code>positions</code>, and see how you could transform the one into the other."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1537432284, "post_id": 52420495, "comment_id": 91784643, "body": "The positions and find function you are given are really similar ... Just use zip as in (positions) before calling find."}, {"owner": {"reputation": 2402, "user_id": 4585226, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/881a0905a462b83fbb047fe96173c0ed?s=128&d=identicon&r=PG&f=1", "display_name": "476rick", "link": "https://stackoverflow.com/users/4585226/476rick"}, "edited": false, "score": 0, "creation_date": 1537432344, "post_id": 52420495, "comment_id": 91784673, "body": "I&#39;m looking for a way without the <code>zip</code> function. So how can I define positions with only the <code>find</code> function?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537433581, "post_id": 52420495, "comment_id": 91785364, "body": "no, you can&#39;t. you will use <code>find</code> to process the output of <code>zip ... [0..]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537447925, "post_id": 52420495, "comment_id": 91794067, "body": "@476rick If I take your requirement at face value (&quot;only the <code>find</code> function&quot;), then <i>only the <code>find</code> function</i> can be implemented. Nothing else. You must use something else in addition to <code>find</code> -- a lambda, a variable, another data type, another function, <i>something</i> -- if you want to have anything that isn&#39;t exactly <code>find</code>. (...and, to connect all the dots, <code>positions</code> isn&#39;t <code>find</code>, so if you want to implement <code>positions</code>, you will need to use more than just <code>find</code>.)"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1537500873, "post_id": 52420495, "comment_id": 91815584, "body": "both <code>find</code> and <code>positions</code> are functions, not methods."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1537448946, "last_edit_date": 1537448946, "creation_date": 1537434176, "answer_id": 52421344, "question_id": 52420495, "link": "https://stackoverflow.com/questions/52420495/haskell-how-to-declare-positions-function-with-using-find/52421344#52421344", "title": "Haskell - How to declare Positions function with using Find?", "body": "<p>We start by re-writing <code>positions</code> as</p>\n\n<pre><code>positions x xs = map (\\(_, i) -&gt; i) . filter (\\(y, _) -&gt; y == x) $ zip xs [0..]\n</code></pre>\n\n<p>and we re-write <code>find</code> as</p>\n\n<pre><code>find k t       = map (\\(_, v) -&gt; v) . filter (\\(m, _) -&gt; m == k) $ t\n-- or,\nfind x         = map (\\(_, i) -&gt; i) . filter (\\(y, _) -&gt; y == x) \n</code></pre>\n\n<p>and then simply notice that the two pieces of code are <em>exactly</em> the same (after the renaming of variables):</p>\n\n<pre><code>positions x xs = find x                                          $ zip xs [0..]\n</code></pre>\n\n<p><code>find</code> only accepts lists of <em>pairs</em>, then filters them and extracts the second component; you will have to use <em>something</em> (like, <em><code>zip</code></em>) to produce the pairs for <code>find</code> to process. There's <em>no</em> way around it.</p>\n\n<hr>\n\n<p>Of course <code>positions</code> can also be coded without the <code>zip</code> part (instead using e.g. <code>mapAccumL</code>) but then it doesn't need the <code>find</code>:</p>\n\n<pre><code>-- mapAccumL :: (acc -&gt; x -&gt; (acc, y)) -&gt; acc -&gt; [x] -&gt; (acc, [y])\n\npositions :: (Eq a) =&gt; a -&gt; [a] -&gt; [Int]\npositions x = concat . snd . mapAccumL g 0 \n  where\n  g acc y = (acc+1, [acc | y == x])\n</code></pre>\n\n<p>We could make it produce the list as expected by <code>find</code>, artificially, but it would be redoing a lot of work and would just be a re-implementation of the <code>zip</code> with enumeration part (so, not the <code>find</code> by itself), anyway.</p>\n"}, {"comments": [{"owner": {"reputation": 2402, "user_id": 4585226, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/881a0905a462b83fbb047fe96173c0ed?s=128&d=identicon&r=PG&f=1", "display_name": "476rick", "link": "https://stackoverflow.com/users/4585226/476rick"}, "edited": false, "score": 0, "creation_date": 1537442221, "post_id": 52423568, "comment_id": 91790532, "body": "Thank you for your answer. Although I don&#39;t want to use the zip function for this."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1537441071, "creation_date": 1537441071, "answer_id": 52423568, "question_id": 52420495, "link": "https://stackoverflow.com/questions/52420495/haskell-how-to-declare-positions-function-with-using-find/52423568#52423568", "title": "Haskell - How to declare Positions function with using Find?", "body": "<p>Look:</p>\n\n<pre><code>positions x xs = [i | (y, i) &lt;- zip xs [0..], y == x]\nfind      k t  = [v | (m, v) &lt;- t           , m == k]\n</code></pre>\n\n<p>They look pretty similar! We can make it even more striking by just renaming <code>k</code> to <code>x</code>, <code>m</code> to <code>y</code>, and <code>v</code> to <code>i</code> in the implementation of <code>find</code>:</p>\n\n<pre><code>positions x xs = [i | (y, i) &lt;- zip xs [0..], y == x]\nfind      x t  = [i | (y, i) &lt;- t           , y == x]\n</code></pre>\n\n<p>So now it's clear: all we have to do is have <code>positions</code> pass <code>zip xs [0..]</code> as the <code>t</code> argument to <code>find</code>.</p>\n\n<pre><code>positions x xs = find x (zip xs [0..])\n</code></pre>\n"}], "owner": {"reputation": 2402, "user_id": 4585226, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/881a0905a462b83fbb047fe96173c0ed?s=128&d=identicon&r=PG&f=1", "display_name": "476rick", "link": "https://stackoverflow.com/users/4585226/476rick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 52421344, "answer_count": 2, "score": 0, "last_activity_date": 1537448946, "creation_date": 1537431113, "last_edit_date": 1537433478, "question_id": 52420495, "link": "https://stackoverflow.com/questions/52420495/haskell-how-to-declare-positions-function-with-using-find", "title": "Haskell - How to declare Positions function with using Find?", "body": "<p>I'm very new to learning how to program in Haskell.</p>\n\n<p>I have an example of the method <code>positions</code>: </p>\n\n<pre><code>positions :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions x xs = [i | (y, i) &lt;- zip xs [0..], y == x]\n</code></pre>\n\n<p>My goal is to find a way to define the <code>positions</code> function, but with the <code>find</code> method.</p>\n\n<p>The <code>find</code> method:</p>\n\n<pre><code>find :: Eq a =&gt; a -&gt; [(a,b)] -&gt; [b]\nfind k t = [v | (m, v) &lt;- t, m == k]\n</code></pre>\n\n<p>Can someone explain how you declare a <code>positions</code> function with using <strong>only</strong> the <code>find</code> function? </p>\n\n<p>I don't understand how you can keep track of the index with the <code>find</code> function.</p>\n"}, {"tags": ["multithreading", "sockets", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537473885, "post_id": 52431180, "comment_id": 91808684, "body": "I don&#39;t think you&#39;re being careful enough here. <code>Network.Socket</code> only allows one OS thread to handle each socket, as I understand it. It does <i>not</i> do the sort of special handling the GHC I/O subsystem does to make believe that multiple threads can do so concurrently. So you need one bound thread (created with <code>forkOS</code>, <code>forkOn</code>, <code>asyncBound</code>, <code>asyncOn</code>, etc.) to manage each socket on behalf of other threads."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537480958, "post_id": 52431180, "comment_id": 91811524, "body": "I don&#39;t think that&#39;s right -- I can modify the program to open 10 different sockets on 10 different ports, and it works much the same -- everything runs in one O/S thread which never forks and spends most of its time waiting on a <code>select</code> call for <code>stdin</code> and the 10 sockets."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537482196, "post_id": 52431180, "comment_id": 91811860, "body": "Oh, because you compile it to run without threading. But that doesn&#39;t seem like a good idea if this is part of a larger program that needs threading! Better, I think, to write the code so it will work in that context too."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537483370, "post_id": 52431180, "comment_id": 91812143, "body": "Even if it&#39;s compiled with <code>-threaded</code> and <code>+RTS -N4</code>, it&#39;s <i>still</i> the case that there&#39;s no one-O/S-thread-per-socket rule.  The RTS will start up more than 4 O/S threads in a pool, but the number is still capped.  If I open 50 sockets, I get 11 O/S threads.  I believe the excess is determined by the <code>MAX_SPARE_WORKERS</code> constant in the RTS source which allows a certain number of O/S threads over the capability count.  Anyway, I&#39;ve added the source to the answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537483904, "post_id": 52431180, "comment_id": 91812263, "body": "It sounds like we might be talking past each other, unless I&#39;m just missing something. The <a href=\"http://hackage.haskell.org/package/network-2.8.0.0/docs/Network-Socket.html\" rel=\"nofollow noreferrer\">Haddocks</a> have a note: &quot;The proper programming model is that one <code>Socket</code> is handled by a single thread. If multiple threads use one <code>Socket</code> concurrently, unexpected things would happen. There is one exception for multiple threads vs a single <code>Socket</code>: one thread reads data from a <code>Socket</code> only and the other thread writes data to the <code>Socket</code> only.&quot;"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537484017, "post_id": 52431180, "comment_id": 91812295, "body": "Here you create ten green threads (which could actually run on more than one OS thread), each of which attempts to read from the <code>Socket</code>. That violates the rule, which is based on a similar one for the underlying C interface. You have to make sure that for each <code>Socket</code>, only one thread reads from it and only one thread writes to it."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537484041, "post_id": 52431180, "comment_id": 91812298, "body": "I believe that refers to the issue noted further down where reuse of a closed FD can cause problems.  So, it&#39;s probably a bad idea to handle a single socket with multiple green threads, particularly if any of them try to close it, but there&#39;s no requirement that there be one active O/S thread for each socket."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537484132, "post_id": 52431180, "comment_id": 91812321, "body": "Oh, certainly not. There just needs to be <i>at most</i> one. But I believe the underlying C interface is a bit pickier. Specifically, I think you need to make sure that only one OS thread reads/writes to a particular socket, meaning that the thread doing so must be <i>bound</i> so it can&#39;t migrate from one OS thread to another."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537484438, "post_id": 52431180, "comment_id": 91812403, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/180481/discussion-between-k-a-buhr-and-dfeuer\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1537484429, "last_edit_date": 1537484429, "creation_date": 1537468164, "answer_id": 52431180, "question_id": 52419899, "link": "https://stackoverflow.com/questions/52419899/is-network-socket-programming-in-haskell-concurrently-asynchronously-parallel/52431180#52431180", "title": "Is Network.Socket programming in Haskell &quot;Concurrently, Asynchronously, Parallel, Non-Blocking&quot; using forkIO", "body": "<p>Note that <code>forkIO</code> spawns a green thread, not an O/S thread, so if you spawn 1000 <code>forkIO</code> threads to handle simultaneous requests, that does not correspond to 1000 separate O/S (or \"CPU\") threads.</p>\n\n<p>Anyway, yes, the RTS handles multiple blocking read/write calls concurrently without tying up O/S threads.  In fact, by default when you compile and run a Haskell program without the <code>-threaded</code> flag or without the <code>-N</code> RTS option, it runs everything in a <strong>single</strong> O/S thread, even things you \"fork\" with <code>forkIO</code>, and multiple green threads can still block without blocking the (only) O/S thread.</p>\n\n<p>You would also never run a Haskell server on 1000 separate O/S threads.  The RTS can schedule thousands of green threads on a small pool of O/S threads much more efficiently than running each green thread on its own O/S thread, because switching between green threads doesn't require an expensive O/S context switch.</p>\n\n<p>You may find <a href=\"http://www.aosabook.org/en/posa/warp.html\" rel=\"nofollow noreferrer\">this 2012 article about the Warp web server library</a> helpful.  In particular, they compare and contrast multiple possible architectures: one CPU thread per request (i.e., the design you're imagining), an event-driven architecture, a hybrid with one event-handling process per core, and the Haskell model of lightweight threads running on an O/S thread pool.  Note that Warp uses <code>Network.Socket</code> under the hood.  In their benchmark setup, they were handling requests for 1000 simultaneous clients using anywhere from 1-10 O/S threads.</p>\n\n<p>If you'd like some concrete proof that <code>forkIO</code> threads won't block, here's a toy program:</p>\n\n<pre><code>import Control.Monad\nimport Control.Concurrent\nimport Network.Socket hiding (recv)\nimport Network.Socket.ByteString\nimport qualified Data.ByteString.Char8 as BS\n\nforks = 10\n\nmain = withSocketsDo $ do\n  s &lt;- socket AF_INET Datagram defaultProtocol\n  bind s (SockAddrInet 6667 (tupleToHostAddress (127,0,0,1)))\n  replicateM_ forks $ forkIO (BS.putStrLn =&lt;&lt; recv s 4096)\n  let loop = (putStrLn =&lt;&lt; getLine) &gt;&gt; loop\n  loop\n</code></pre>\n\n<p>If you compile and run this without threading:</p>\n\n<pre><code>$ stack ghc -- -O2 Socket.hs &amp;&amp; ./Socket\n</code></pre>\n\n<p>it will spawn 10 waiting <code>forkIO</code> threads and then enter a <code>getLine</code>/<code>putStrLn</code> loop that will echo your input back to you.    In the meantime, you can use netcat or your favorite networking tool to send requests to the waiting threads:</p>\n\n<pre><code>$ echo -n 'request' | nc -uw0 localhost 6667\n</code></pre>\n\n<p>which will also be echoed by the server.  After 10 requests, you will have exhausted the waiting threads, and it will no longer respond to network requests.</p>\n\n<p>Then you can bump up the threads with <code>fork = 10000</code> to create 10000 waiting threads.  While they're waiting, the main <code>getLine</code>/<code>putStrLn</code> loop will continue to run without a glitch.</p>\n\n<p>All this is happening within a single O/S thread, as you can verify by looking at <code>ps -Lf</code> or whatever.</p>\n\n<p>The question arose in a comment whether more threads were needed if multiple sockets are used simultaneously and the program is compiled with <code>-threaded</code>.  The following test program:</p>\n\n<pre><code>import Control.Monad\nimport Control.Concurrent\nimport Network.Socket hiding (recv)\nimport Network.Socket.ByteString\nimport qualified Data.ByteString.Char8 as BS\n\nforks = 50\n\nmain = withSocketsDo $ do\n  forM_ [0..forks-1] $ \\i -&gt; forkIO $ do\n    s &lt;- socket AF_INET Datagram defaultProtocol\n    bind s (SockAddrInet (6667+i) (tupleToHostAddress (127,0,0,1)))\n    BS.putStrLn =&lt;&lt; recv s 4096\n  let loop = (putStrLn =&lt;&lt; getLine) &gt;&gt; loop\n  loop\n</code></pre>\n\n<p>creates 50 separate sockets on ports 6667 to 6716 and waits on them.  If compiled without threading, it runs in one O/S thread without difficulty.  If compiled with threading and provided with a capability count above one, like so:</p>\n\n<pre><code>$ stack ghc -- -O2 -threaded Socket.hs\n$ ./Socket +RTS -N4\n</code></pre>\n\n<p>it appears to run 11 worker threads (which I think is a \"main thread\", four capabilities, plus six spare worker threads as specified by the constant <code>MAX_SPARE_WORKERS</code> in the RTS source) which share waiting on those 50 sockets.</p>\n\n<p>As an aside, the way this is accomplished in the <code>Network.Socket</code> code is that a <code>recv</code> call, for example, is ultimately implemented as:</p>\n\n<pre><code>throwSocketErrorWaitRead sock \"...\" $\n    c_recv s (castPtr ptr) (fromIntegral nbytes) 0\n</code></pre>\n\n<p>with the <code>throwSocketErrorWaitRead</code> wrapper defined as:</p>\n\n<pre><code>throwSocketErrorWaitRead :: (Eq a, Num a) =&gt; \n     Socket -&gt; String -&gt; IO a -&gt; IO a\nthrowSocketErrorWaitRead sock name io =\n    throwSocketErrorIfMinus1RetryMayBlock name\n        (threadWaitRead $ fromIntegral $ fdSocket sock)\n        io\n</code></pre>\n\n<p>and <code>throwSocketErrorIfMinus1RetryMayBlock</code> documented like so:</p>\n\n<pre><code>throwSocketErrorIfMinus1RetryMayBlock\n    :: (Eq a, Num a)\n    =&gt; String  -- ^ textual description of the location\n    -&gt; IO b    -- ^ action to execute before retrying if an\n               --   immediate retry would block\n    -&gt; IO a    -- ^ the 'IO' operation to be executed\n    -&gt; IO a\n</code></pre>\n\n<p>It's all a little complicated, but the upshot is that the wrappers call <code>c_recv</code> with is the actual <code>recv</code> system call.  It never blocks because the socket is configured as non-blocking, and if it returns with an error code indicating it <em>would</em> block, the <code>threadWaitRead</code> call is used to alert the RTS that this green thread should sleep until data is available for reading.</p>\n"}], "owner": {"reputation": 474, "user_id": 2645138, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000993761098/picture?type=large", "display_name": "Vigneshwaran Rajan", "link": "https://stackoverflow.com/users/2645138/vigneshwaran-rajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 3, "accepted_answer_id": 52431180, "answer_count": 1, "score": 5, "last_activity_date": 1537484429, "creation_date": 1537428807, "last_edit_date": 1537429199, "question_id": 52419899, "link": "https://stackoverflow.com/questions/52419899/is-network-socket-programming-in-haskell-concurrently-asynchronously-parallel", "title": "Is Network.Socket programming in Haskell &quot;Concurrently, Asynchronously, Parallel, Non-Blocking&quot; using forkIO", "body": "<p>Please I want to understand that whether GHC's RTS handles blocking Read/Write operations concurrently, i.e. lets say my hypothetical server can only handle CPU 1000 threads parallel,  if all 1000 forkIO are blocked due to Persistent Client socket blocking Read/Write and there are another 500 requests to be processed.</p>\n\n<p>Option-A> Does the another 500 request have to wait until the 1000 forkIO process is done.</p>\n\n<p>Option-B> Haskell internally handles (i.e. Concurrently, Asynchronously, Parallel, Non-Blocking) 1000 + 500 forkIO, by efficiently using all 1000 CPU threads.</p>\n\n<p>Just for info I have read many socket tutorials(and blogs) for both C and Haskell(Network.Socket), to have the understanding of how Haskell(forkIO) and C handles (i.e. Concurrently, Asynchronously, Parallel, Non-Blocking), but I don't have a clear understanding of how Haskell does that actually.</p>\n\n<p>Reference :</p>\n\n<p><a href=\"https://github.com/lpeterse/haskell-socket/issues/15#issuecomment-224382491\" rel=\"noreferrer\">https://github.com/lpeterse/haskell-socket/issues/15#issuecomment-224382491</a></p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537448131, "post_id": 52418038, "comment_id": 91794227, "body": "The technique I describe in <a href=\"https://stackoverflow.com/a/12398993/791604\">this answer</a> can be pretty trivially adapted to this variation."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1537424751, "last_edit_date": 1537424751, "creation_date": 1537424345, "answer_id": 52418793, "question_id": 52418038, "link": "https://stackoverflow.com/questions/52418038/haskell-how-do-i-write-a-function-to-combine-my-list-of-lists-of-tuples-into-a/52418793#52418793", "title": "Haskell: How do I write a function to combine my list of lists of tuples into a list of tuples?", "body": "<p>Your function <code>combine</code> is defined to take a list of a single element and return that element; given a list of zero or more than one item, it\u2019ll raise a runtime error as you observed. The compiler will warn about \u201cnon-exhaustive patterns\u201d like this with warnings enabled, e.g., <code>-Wall</code>.</p>\n\n<p>If you have a container of values and you want to combine them all in some way, that\u2019s a good indication that you can use a fold. Looking at just this sublist:</p>\n\n<pre><code>sublist = [(\"String\",1, \"String\", \"DEF\", 2.0),(\"String\",4, \"String\", \"DEF\", 2.0)]\n</code></pre>\n\n<p>You can combine these values with <code>foldr1</code> (or <code>foldl1</code>):</p>\n\n<pre><code>foldr1 :: Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a\n</code></pre>\n\n<p>Which is <code>(a -&gt; a -&gt; a) -&gt; [a] -&gt; a</code> when <code>t</code> = <code>[]</code>.</p>\n\n<pre><code>combineGroup xs = foldr1 combine xs\n  where\n    combine\n      (_, x, _, _, y)                 -- Current item in list\n      (s1, totalX, s2, name, totalY)  -- Accumulator for results\n      = (s1, totalX + x, s2, name, totalY + y)\n</code></pre>\n\n<p>This assumes the group is never empty; if it can be empty, use <code>foldr</code> (or <code>foldl'</code>) to supply an initial \u201cdefault\u201d value for the accumulator:</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>Then, to apply this function to every group in the outer list, simply use <code>map</code>:</p>\n\n<pre><code>map combineGroup groups\n</code></pre>\n\n<p>If you want to do this with direct recursion as a learning exercise, look at the definitions of <code>map</code> and <code>foldr</code> in the standard library and try to manually inline them into a single function.</p>\n\n<p>Another good way to improve your code would be to replace these tuples with a data type, e.g.:</p>\n\n<pre><code>data Info = Info\n  { infoString1, infoString2 :: String\n  , infoX :: Int\n  , infoName :: String\n  , infoY :: Double\n  } deriving (Show)  -- Add other classes like Eq, Ord, &amp;c. as needed.\n</code></pre>\n\n<p>Then the fold can be written more clearly using a <em>record update</em> to update only the fields you care about, without having to manually plumb around the irrelevant fields:</p>\n\n<pre><code>combineGroup xs = foldr1 combine xs\n  where\n    combine current acc = acc\n      { x = infoX acc + infoX current\n      , y = infoY acc + infoY current\n      }\n\n-- OR\n\n{-# LANGUAGE NamedFieldPuns #-}\ncombineGroup xs = foldr1 combine xs\n  where\n    combine Info{ x, y } acc@Info{ x = totalX, y = totalY }\n      = acc { x = totalX + x, y = totalY + y }\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 10389247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1eb0398873278aff7a0a5055f3375c8?s=128&d=identicon&r=PG&f=1", "display_name": "Natti", "link": "https://stackoverflow.com/users/10389247/natti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "closed_date": 1537448155, "answer_count": 1, "score": -1, "last_activity_date": 1537448788, "creation_date": 1537420539, "last_edit_date": 1537448788, "question_id": 52418038, "link": "https://stackoverflow.com/questions/52418038/haskell-how-do-i-write-a-function-to-combine-my-list-of-lists-of-tuples-into-a", "closed_reason": "Duplicate", "title": "Haskell: How do I write a function to combine my list of lists of tuples into a list of tuples?", "body": "<p>I am learning Haskell and I am unsure how to write a function to access my list.</p>\n\n<p>The data I am trying to modify is:</p>\n\n<pre><code>[[(\"String\",1, \"String\", \"ABC\", 2.0)],[(\"String\",1, \"String\", \"DEF\", 2.0),(\"String\",4, \"String\", \"DEF\", 2.0)]]\n</code></pre>\n\n<p>Currently, the data is grouped together based on the last string (\"ABC\" or \"DEF\"). I want to combine the information to get an output of:</p>\n\n<pre><code>[(\"String\",1, \"String\", \"ABC\", 2.0),(\"String\",5, \"String\", \"DEF\", 4.0)]\n</code></pre>\n\n<p>where the strings don't change but the int/floats get added together.</p>\n\n<p>The code I currently have is:</p>\n\n<pre><code>combine :: [(a)] -&gt; (a)\ncombine [(a)] = (a)\n</code></pre>\n\n<p>I am just testing out to see if I can access the lists of different sizes but it doesn't work. It gives me an error when I try to access the other set of list.</p>\n\n<pre><code>[(\"CS\",273,\"A\",1,\"Lewis, Buck\",1.66),*** Exception: Non-exhaustive patterns in function combineInfo\n</code></pre>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1537417697, "post_id": 52417415, "comment_id": 91778274, "body": "What you\u2019re saying doesn\u2019t make sense. Different instances of a data family are still <i>different types</i>, so the compiler can still statically determine a value\u2019s representation. The whole point of a <code>newtype</code> is to use the same runtime representation as some other type (that is, with no wrappers), but if there are other cases to the type, that clearly isn\u2019t possible."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1537421575, "post_id": 52417415, "comment_id": 91779466, "body": "&quot;Different instances of a data family are still different types,&quot; Hmm? They&#39;re all of type <code>Bar a</code>. &quot;The whole point of a newtype ..., but if there are other cases to the type, that clearly isn\u2019t possible. &quot; <code>Bar (Maybe Int)</code>, <code>Bar [Char]</code> are other cases of to the type, and <code>newtype</code> is possible -- until it gets tangled up with <code>Bar [a]</code>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1537421811, "post_id": 52417415, "comment_id": 91779558, "body": "If you have a type family <code>F</code>, then surely you would not say that <code>F Int</code> and <code>F Bool</code> must be the same type, hm? The point is that GHC tracks that difference statically. It does not statically track the difference between different constructors (which is often frustrating to novice Haskellers, who regularly ask questions like \u201chow can I have a type that is <code>T</code> but restricted to exclude data constructor <code>C</code>,\u201d to which the only answer is \u201cdefine a new data type\u201d)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537449135, "post_id": 52417415, "comment_id": 91794927, "body": "@AntC &quot;They&#39;re all of type <code>Bar a</code>.&quot; is not precise. Try it yourself and see: make a data family with at least two instances, then write <code>foo :: Bar a</code> and try to define <code>foo</code> without using <code>undefined</code>. You&#39;ll find it&#39;s not possible!"}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537422498, "post_id": 52417691, "comment_id": 91779866, "body": "&quot;You can think of data families as ...&quot; you&#39;re explaining a bunch of tricky ideas in terms of two more even trickier ideas. I&#39;ve deliberately not read past your first sentence, because my experience with an earlier q was I ended up even more confused. I like thinking in terms of data because I can imagine it in store. Whereas Haskell has type erasure semantics, so where do I go to see the types?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1537429333, "post_id": 52417691, "comment_id": 91783150, "body": "I&#39;m sorry my answer confused you. I figured that you might find an explanation in terms of type families helpful, given that those are usually more simply understood (the analogy is that type families are similar to functions on types). Unfortunately, data/type families don&#39;t have any data-level manifestation. They are purely type-level artifacts, meaning they pretty much disappear after type-checking."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537436305, "post_id": 52417691, "comment_id": 91787035, "body": "&quot;you might find an explanation in terms of type families helpful, given that those are usually more simply understood&quot; @Alec, @AlexisKing type families are not injective (and Haskell&#39;s so-called injective families are only half-implemented). <code>F Int</code>, <code>F Bool</code> could easily be the same type. But <code>T Int</code>, <code>T Bool</code> cannot be, for type constructor <code>T</code>. Any data constructor within <code>instance DF [a]</code> must yield a &#39;result&#39; whose type is apart from any data constructor within <code>instance DF (Maybe Int)</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1537473345, "post_id": 52417691, "comment_id": 91808437, "body": "@AntC I am very aware that type families aren&#39;t injective, and that Haskell&#39;s injective type families are full of caveats. You can&#39;t have it both ways: either you ask for a correct answer (which will assume existing familiarity with other advanced Haskell) or you ask for a ground up explanation. I fear you are setting yourself up for disappointment by asking on SO. Also, note that a &quot;type constructor&quot; also includes type families. The non-overlapping property you point out is precisely injectivity of <code>DF</code>."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537498577, "post_id": 52417691, "comment_id": 91815160, "body": "Then we&#39;ll agree to differ. &quot;note that a &quot;type constructor&quot; also includes type families&quot; I disagree; on the same grounds as I don&#39;t include functions as data constructors -- even though functions do construct values (which ipso facto have data constructors). In fact Haskell type families can&#39;t even be partially applied, they&#39;re a long way from being type constructors."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537512433, "post_id": 52417691, "comment_id": 91819002, "body": "Yes, I think a &quot;ground up explanation&quot; would help me a lot more than a &#39;complexity down&#39;. Or of course pointers to where I can find that. (I already read the GHC Users Guide and academic papers behind it, before asking the q.) In general by &quot;asking on SO&quot; what sort of &#39;explanation&#39; should I expect if not in terms of simpler building-blocks? Plus &#39;more powerful ways to combine them&#39;, in the John Hughes sense."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537583201, "post_id": 52417691, "comment_id": 91849126, "body": "I&#39;ve now read this answer. This sentence is wrong, so I&#39;ve downvoted: &quot;Being a <code>newtype</code> is definitively a property of the type constructor, not of the data constructor.&quot; I&#39;ve posted my understanding as an answer. I found no need to talk about type families/type functions. In fact I&#39;ve quoted the literature saying these are &quot;Function-free types&quot;."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1537583669, "post_id": 52417691, "comment_id": 91849184, "body": "@AntC being a <code>newtype</code> <i>is</i> a property of being a type constructor - see <a href=\"http://hackage.haskell.org/package/ghc-8.4.3/docs/TyCon.html#v:isNewTyCon\" rel=\"nofollow noreferrer\"><code>isNewTyCon</code></a>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1537418248, "creation_date": 1537418248, "answer_id": 52417691, "question_id": 52417415, "link": "https://stackoverflow.com/questions/52417415/data-family-instances-newtype-data/52417691#52417691", "title": "data family instances: newtype, data", "body": "<p>You can think of data families as stronger versions of (injective and open) type families. As you can see from <a href=\"https://stackoverflow.com/questions/39707115/data-families-vs-injective-type-families\">this question I asked a while back</a>, data families can <em>almost</em> be faked with injective type families.</p>\n\n<blockquote>\n  <p>Does that mean that being newtype is a property of the data constructor rather than the datatype? Could there be a Haskell with something like:</p>\n\n<pre><code>data Foo a = MkFoo1 Int a\n           | MkFoo2 Bool a\n           | newtype MkFoo3 a\n</code></pre>\n</blockquote>\n\n<p>No. Being a <code>newtype</code> is definitively a property of the type constructor, not of the data constructor. A data family, quite like a type family, has two levels of type constructors:</p>\n\n<ul>\n<li>the type constructor <code>data/type family FamTyCon a</code></li>\n<li>the type constructors for the instances <code>data/type instance FamInstTyCon a = ...</code></li>\n</ul>\n\n<p>Different instances of the same <code>data/type</code> family constructor are still fundamentally different types - they happen to be unified under one type constructor (and that type constructor is going to be injective and generative - see the linked question for more on that).</p>\n\n<p>By the type family analogy, you wouldn't expect to be able to pattern match on something of type <code>TyFam a</code>, right? Because you could have <code>type instance TyFam Int = Bool</code> and <code>type instance TyFam () = Int</code>, and you wouldn't be able to statically know if you were looking at a <code>Bool</code> or an <code>Int</code>!</p>\n"}, {"tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 0, "last_activity_date": 1537582618, "last_edit_date": 1537582618, "creation_date": 1537580295, "answer_id": 52452759, "question_id": 52417415, "link": "https://stackoverflow.com/questions/52417415/data-family-instances-newtype-data/52452759#52452759", "title": "data family instances: newtype, data", "body": "<p>These are equivalent:</p>\n\n<pre><code>newtype          NT a b  = MkNT (Int, b)\n\ndata family DF a b\nnewtype instance DF a b  = MkDF (Int, b)\n\n-- inferred MkNT :: (Int, b) -&gt; NT a b\n--          MkDF :: (Int, b) -&gt; DF a b\n</code></pre>\n\n<p>Furthermore you can't declare any other instance/constructor within family <code>DF</code>, because their instance heads would overlap <code>DF a b</code>.</p>\n\n<p>The error message in the q re standalone newtype <code>Baz</code> is misleading </p>\n\n<pre><code>-- Error: A newtype constructor must have a return type of form T a1 ... an\n</code></pre>\n\n<p>(and presumably dates from before there were data families). A newtype constructor must have a return type exactly as the instance head (modulo alpha renaming if it's using GADT syntax). For a standalone newtype, \"instance head\" means the <code>newtype</code> head.</p>\n\n<p>For non-newtype data instances, the various constructors might have return types strictly more specific than the instance head (that makes them GADTs).</p>\n\n<p>The type declared in a data/newtype instance head (in the literature variously called a 'type scheme', 'monotype' -- because no constraints, 'Function-free type' -- in the 2008 paper 'Type Checking with Open Type Functions') is the principal type that all the constructors' return types must unify with. (There might not be any constructors with exactly that return type.)</p>\n\n<p>If your instance be a <code>newtype</code>, the rules are much tighter: there can be only one constructor, and its return type must be exactly the principal type. So to answer the original q</p>\n\n<blockquote>\n  <p>Does that mean that being <code>newtype</code> is a property of the data constructor rather than the datatype?\n  ... but ... Then is being a <code>newtype</code> a property of the result type, rather than of the constructor?</p>\n</blockquote>\n\n<p>No, not of the constructor; yes more like of the result: being a newtype is the property of a data family instance/its principal type. It's just that for standalone newtypes, there can in effect be only one instance, and its principal type is the most general type for that type constructor. Derivatively, we can say the newtype's principal type/return type uniquely identifies a data constructor. That's crucial for type safety, because values of that type share their representation with the type inside the newtype's data constructor, i.e. with no wrapper -- as @AlexisKing's comment points out. Then pattern matching doesn't need to go looking for the constructor: the match is irrefutable/the constructor is virtual.</p>\n\n<p>It strikes me that in the interests of more precise typing/better documentation, you might want to declare a newtype as a data family with only one instance, whose head is more specific than what you must put for a standalone newtype.</p>\n"}], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1537582618, "creation_date": 1537416299, "question_id": 52417415, "link": "https://stackoverflow.com/questions/52417415/data-family-instances-newtype-data", "title": "data family instances: newtype, data", "body": "<p>With Haskell 98 decls, the whole datatype must be either <code>newtype</code> or <code>data</code>. But data families can have a mix of <code>newtype instance</code>, <code>data instance</code>. Does that mean that being <code>newtype</code> is a property of the data constructor rather than the datatype? Could there be a Haskell with something like:</p>\n\n<pre><code>data Foo a = MkFoo1 Int a\n           | MkFoo2 Bool a\n           | newtype MkFoo3 a\n</code></pre>\n\n<p>I know I can't write the following, but why/what goes wrong?:</p>\n\n<pre><code>data family Bar a\n\nnewtype instance Bar (Maybe Int)  = MkBar1 (Maybe Int)\n            -- MkBar1 :: (Maybe Int) -&gt; Bar (Maybe Int), see below\n\nnewtype instance Bar [Char]  = MkBar2 [Char]\n\ndata instance Bar [Bool]  where\n  MkBar3 :: Int -&gt; Bool -&gt; Bar [Bool]\n  -- can't be a newtype because of the existential Int\n\n-- we're OK up to here mixing newtypes and data/GADT\n\ndata instance Bar [a]  where\n  MkBar4 :: Num a =&gt; a -&gt; Bar [a]\n  -- can't be a newtype because of the Num a =&gt;\n</code></pre>\n\n<p>I can't write that because the instance head <code>Bar [a]</code> overlaps the two heads for <code>MkBar2, MkBar3</code>. Then I could fix that by moving those two constructor decls inside the <code>where ...</code> for <code>Bar [a]</code>. But then <code>MkBar2</code> becomes a GADT (because it's result type is not <code>Bar [a]</code>), so can't be a <code>newtype</code>.</p>\n\n<p>Then is being a <code>newtype</code> a property of the result type, rather than of the constructor? But consider the type inferred for newtype instance <code>MkBar1</code> above. I can't write a top-level <code>newtype</code> with the same type</p>\n\n<pre><code>newtype Baz a  where\n  MkBaz :: (Maybe Int) -&gt; Baz (Maybe Int)\n\n-- Error: A newtype constructor must have a return type of form T a1 ... an\n</code></pre>\n\n<p>Huh? <code>MkBar1</code> is a newtype constructor whose type is not of that form.</p>\n\n<p>If possible, please explain without diving into talk of roles: I've tried to understand them; it just makes my head hurt. Talk in terms of constructing and pattern-matching on those constructors.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1537448974, "post_id": 52417163, "comment_id": 91794812, "body": "And if, for some reason, you don&#39;t want the names like <code>Data.Massiv.Array.foo</code> to be defined -- only <code>foo</code> and <code>AM.foo</code> -- you can even combine <code>as</code> and <code>hiding</code> in the second import; <code>import Data.Massiv.Array as AM hiding (map)</code>."}], "tags": [], "owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "is_accepted": true, "score": 8, "last_activity_date": 1537414244, "creation_date": 1537414244, "answer_id": 52417163, "question_id": 52417141, "link": "https://stackoverflow.com/questions/52417141/in-haskell-is-it-possible-to-qualify-part-of-an-imported-module/52417163#52417163", "title": "In Haskell, is it possible to qualify part of an imported module?", "body": "<p>Write two <code>import</code>s and you can use <code>map</code> as <code>AM.map</code> and use other functions without <code>AM.</code>.</p>\n\n<pre><code>import qualified Data.Massiv.Array as AM\nimport Data.Massiv.Array hiding (map)\n</code></pre>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 1, "accepted_answer_id": 52417163, "answer_count": 1, "score": 4, "last_activity_date": 1537414244, "creation_date": 1537413974, "question_id": 52417141, "link": "https://stackoverflow.com/questions/52417141/in-haskell-is-it-possible-to-qualify-part-of-an-imported-module", "title": "In Haskell, is it possible to qualify part of an imported module?", "body": "<p>I'd like to be able to do something like: <code>import qualified Data.Massiv.Array (qualified map)</code>. </p>\n\n<p>This gives <code>error: parse error on input `map'</code>. </p>\n\n<p>Or better yet, <code>import qualified Data.Massiv.Array (qualified map) as AM</code>, so I also can access <code>foo</code> as either <code>foo</code> or <code>AM.foo</code>, unless <code>foo</code> == <code>map</code>, then I have to use <code>AM.map</code>. This is to avoid conflict with <code>Prelude.map</code>.</p>\n"}]