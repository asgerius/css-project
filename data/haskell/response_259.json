[{"tags": ["haskell", "printf"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1577317393, "post_id": 59482605, "comment_id": 105141519, "body": "You specify the type: <code>printf &quot;%v\\n&quot; (Nothing :: Maybe Int)</code>"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 5, "creation_date": 1577318050, "post_id": 59482605, "comment_id": 105141597, "body": "This is generally considered a non-issue. E.g. <code>[] == []</code> doesn&#39;t work either. In any real usage, you won&#39;t be directly using <code>Nothing</code> as an argument, and so it will work."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1577345370, "post_id": 59482605, "comment_id": 105145774, "body": "@HTNW \u201cnon-issue\u201d is perhaps an exaggeration. There&#39;s a reason why Haskell has a defaulting mechanism. Especially in the REPL it would be really tedious having to always specify the type of e.g. number you want to use. It <i>is</i> a bit of a pity that defaulting doesn&#39;t really scale to modern Haskell, especially it&#39;s little use when advanced type system features are involved."}, {"owner": {"reputation": 510, "user_id": 273132, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b2123585dfcc34d76272cb25aa9254d1?s=128&d=identicon&r=PG", "display_name": "xzt", "link": "https://stackoverflow.com/users/273132/xzt"}, "edited": false, "score": 1, "creation_date": 1577350542, "post_id": 59482605, "comment_id": 105147155, "body": "I would also suggest to start with <code>:t Nothing</code> in ghci. It will print <code>Nothing :: Maybe a</code>, meaning type of expression <code>Nothing</code> is <code>Maybe a</code>. What is the <code>a</code> there? No idea for me, as well as no idea for compiler. <code>a</code> can be inferred depending on the context, but expression <code>printf &quot;%v\\n&quot; Nothing</code> gives no enough information to get what <code>a</code> is. You have to specify it manually."}], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577317729, "creation_date": 1577317311, "last_edit_date": 1577317729, "question_id": 59482605, "link": "https://stackoverflow.com/questions/59482605/custom-printf-cannot-print-nothing", "title": "Custom printf cannot print Nothing", "body": "<p>I implemented custom <code>PrintArg</code> instance for <code>Maybe</code>:</p>\n\n<pre><code>import Text.Printf\n\ninstance PrintfArg a =&gt; PrintfArg (Maybe a) where\n    formatArg Nothing f str = formatArg \"Nothing\" f str\n    formatArg (Just x) f@(FieldFormat Nothing _ _ _ _ _ _) str = \"Just \" ++ formatArg x f str\n    formatArg (Just x) f@(FieldFormat (Just w) _ Nothing _ _ _ _) str = let\n        str' = formatArg x (f {fmtWidth = Nothing}) \"\"\n        in replicate (max 0 (w - 5 - length str')) ' ' ++ \"Just \" ++ str' ++ str\n    formatArg (Just x) f@(FieldFormat (Just w) _ (Just _) _ _ _ _) str = \"Just \" ++ formatArg x (f {fmtWidth = Just (w-5)}) str\n</code></pre>\n\n<p>It prints <code>Just</code> values well:</p>\n\n<pre><code>*Main&gt; printf \"%10d\\n\" (Just 2)\n    Just 2\n*Main&gt; printf \"%-10d\\n\" (Just 2)\nJust 2    \n*Main&gt; printf \"%+10d\\n\" (Just 2)\n   Just +2\n*Main&gt; printf \"% 10d\\n\" (Just 2)\n   Just  2\n*Main&gt; printf \"%010d\\n\" (Just 2)\nJust 00002\n</code></pre>\n\n<p>But due to the ambiguous type, it cannot print <code>Nothing</code>:</p>\n\n<pre><code>*Main&gt; printf \"%v\\n\" Nothing\n\n&lt;interactive&gt;:24:1: error:\n    \u2022 Could not deduce (PrintfArg a0) arising from a use of \u2018printf\u2019\n      from the context: PrintfType t\n        bound by the inferred type of it :: PrintfType t =&gt; t\n        at &lt;interactive&gt;:24:1-21\n      The type variable \u2018a0\u2019 is ambiguous\n      These potential instances exist:\n        instance [safe] PrintfArg Integer -- Defined in \u2018Text.Printf\u2019\n        instance [safe] PrintfArg a =&gt; PrintfArg (Maybe a)\n          -- Defined at Test.hs:3:10\n        instance [safe] PrintfArg Char -- Defined in \u2018Text.Printf\u2019\n        ...plus five others\n        ...plus 9 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression: printf \"%v\\n\" Nothing\n      In an equation for \u2018it\u2019: it = printf \"%v\\n\" Nothing\n</code></pre>\n\n<p>Is there a workaround for this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577313223, "post_id": 59482248, "comment_id": 105140981, "body": "It works for me. What do you have in the input file you&#39;re giving it? Do all of the URLs have a filename after the last <code>&#47;</code>?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577313494, "post_id": 59482248, "comment_id": 105141015, "body": "Also, do you actually have a real use for concurrency, or are you just trying to learn how to use it? If the former, have you considered just using <code>mapConcurrently_</code>?"}, {"owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577313741, "post_id": 59482248, "comment_id": 105141050, "body": "@JosephSible-ReinstateMonica I have 69 urls, that all start with <code>https:&#47;&#47;</code> and have a path component. I was trying to control maximum number of concurrent file downloads with this. I am not sure how <code>mapConcurrently_</code>  works."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577313813, "post_id": 59482248, "comment_id": 105141064, "body": "What happens if you call <code>retrieveUrls</code> directly from GHCi? What about just <code>retrieve</code>?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1577313859, "post_id": 59482248, "comment_id": 105141071, "body": "See <a href=\"https://stackoverflow.com/q/18896103/7509065\">Can Haskell&#39;s Control.Concurrent.Async.mapConcurrently have a limit?</a> to put a limit on."}, {"owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577314005, "post_id": 59482248, "comment_id": 105141101, "body": "If I call retrieve from ghci I get <code>Exception: user error (https not supported)</code> error. I wonder why I don&#39;t see anything when I run the executable :("}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577314332, "post_id": 59482248, "comment_id": 105141153, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/21296606/resolving-network-http-user-error-https-not-supported\">Resolving Network.HTTP &#39;user error (https not supported)&#39;</a>"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577314361, "post_id": 59482248, "comment_id": 105141159, "body": "Ah, that&#39;s the key! I was testing with insecure HTTP. And as for why you don&#39;t see it, it&#39;s being swallowed by the parallelization/forking."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577380167, "post_id": 59482248, "comment_id": 105157004, "body": "ICYMI, Simon Marlow&#39;s <a href=\"https://simonmar.github.io/pages/pcph.html\" rel=\"nofollow noreferrer\"><i>Parallel and Concurrent Programming in Haskell</i></a> is a great free resource on... that thing you&#39;re doing."}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 4, "last_activity_date": 1577314544, "creation_date": 1577314544, "answer_id": 59482396, "question_id": 59482248, "link": "https://stackoverflow.com/questions/59482248/concurrent-download-ends-immediately/59482396#59482396", "title": "Concurrent Download Ends Immediately", "body": "<p>There's two things going on here:</p>\n\n<ol>\n<li>The HTTP library only supports insecure HTTP, not HTTPS. <a href=\"https://stackoverflow.com/q/21296606/7509065\">Resolving Network.HTTP 'user error (https not supported)'</a> explains what you can do about that. Anyway, if you try to use HTTPS anyway, it throws an exception in IO.</li>\n<li><code>forkFinally</code> takes any exceptions thrown inside itself and returns them in the <code>Left</code> side of an <code>Either</code>. However, your code that takes the <code>Either</code> is just <code>(\\_ -&gt; writeChan waitq ())</code>, so you're discarding the exception and carrying on as if it succeeded. This explains why you couldn't see what was going wrong.</li>\n</ol>\n"}], "owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1577314544, "creation_date": 1577312616, "question_id": 59482248, "link": "https://stackoverflow.com/questions/59482248/concurrent-download-ends-immediately", "title": "Concurrent Download Ends Immediately", "body": "<p>I am new to Haskell, and wrote the following program as an exercise.</p>\n\n<p><code>Main.hs</code></p>\n\n<pre><code>module Main (main) where\n\nimport ParallelDownloader\n\nimport System.IO (hPutStrLn,stderr)\nimport GHC.IO.Encoding (setLocaleEncoding, utf8)\nimport System.Environment (getArgs)\n\n\nmain :: IO ()\nmain = do\n    setLocaleEncoding utf8\n    args &lt;- getArgs\n    case args of\n        [inputFile] -&gt; do\n            fileContents &lt;- readFile inputFile\n            retrieveUrls 4 (lines fileContents)\n        _ -&gt; hPutStrLn stderr \"Input File Not Specified\"\n</code></pre>\n\n<p><code>ParallelDownloader.hs</code></p>\n\n<pre><code>module ParallelDownloader where\nimport System.IO\nimport Network.HTTP\nimport Control.Concurrent\nimport Control.Monad(forM_)\n\nfetchUrl url = simpleHTTP (getRequest url) &gt;&gt;= getResponseBody\n\nretrieve url savePath = do\n    responseData &lt;- fetchUrl url\n    writeFile savePath responseData\n\ngetPath :: String -&gt; String\ngetPath = reverse . takeWhile (/= '/') . reverse\n\nworkerThread q = do\n    url &lt;- readChan q\n    if url == \"\" then\n        return ()\n    else do\n        retrieve url (getPath url)\n        workerThread q\n\nretrieveUrls :: Int -&gt; [String] -&gt; IO ()\nretrieveUrls numThread urls  = do\n    que &lt;- newChan\n    waitq &lt;- newChan\n    forM_ urls $ \\u -&gt; writeChan que u\n    forM_ [1..numThread] $ \\_ -&gt; writeChan que \"\"\n    forM_ [1..numThread] $ \\_ -&gt; forkFinally (workerThread que) (\\_ -&gt; writeChan waitq ())\n    forM_ [1..numThread] $ \\_ -&gt; readChan waitq\n</code></pre>\n\n<p>However, when I run the program, it ends immediately without doing anything? How can I make this work?</p>\n"}, {"tags": ["haskell", "type-kinds"], "comments": [{"owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577300428, "post_id": 59481115, "comment_id": 105138926, "body": "@WillemVanOnsem Yes, so am I correct that fmap2 is strictly more general than fmap and its implementation could be identical?"}, {"owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577300975, "post_id": 59481115, "comment_id": 105139025, "body": "Im not an expert of type theory, i&#39;ve been looking at this article <a href=\"https://en.wikipedia.org/wiki/Kind_(type_theory)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Kind_(type_theory)</a>   but I find it hard to understand the deep underlying reason why this whole kind system really exist"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1577301495, "post_id": 59481115, "comment_id": 105139108, "body": "As there is type based function level programming, there is kind based type level  programming and perhaps even a sort based kind level programming might exist in the future. <a href=\"https://jozefg.bitbucket.io/posts/2014-02-10-types-kinds-and-sorts.html\" rel=\"nofollow noreferrer\">Types and Kinds and Sorts, Oh My!</a> is a good read."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1577303383, "post_id": 59481115, "comment_id": 105139383, "body": "@J.M. you are not correct about that.  It is more general, but it cannot be implemented."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1577303501, "post_id": 59481115, "comment_id": 105139397, "body": "The complete type of <code>fmap</code> is actually longer than what you say in your question: <code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>. How would you state the constraint analogous to <code>Functor f</code> for your proposed alternative type?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1577308722, "post_id": 59481115, "comment_id": 105140261, "body": "<a href=\"https://stackoverflow.com/questions/29463811/any-advantage-of-using-type-constructors-in-type-classes\" title=\"any advantage of using type constructors in type classes\">stackoverflow.com/questions/29463811/&hellip;</a> has a couple answers that cover some advantages of the higher-kinded formulation, in both practical and theoretical terms. It also has an example of when it can be useful to give up those advantages for new capabilities."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1577320485, "post_id": 59481115, "comment_id": 105141865, "body": "If nothing else, standard Haskell supports a kind system, but not multiparameter type classes."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1577303407, "post_id": 59481397, "comment_id": 105139385, "body": "To be fair, the proposed type <code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code> from the question is also impossible to implement. (And this is not the type that <code>fmap</code> has in Haskell.) So one might want to first figure out what context the OP has in mind for <code>fmap2</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1577303486, "post_id": 59481397, "comment_id": 105139394, "body": "@DanielWagner, true.  This answer was quite a struggle to write, I have to cover too much ground at once.  I want to see how OP responds and take from there..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1577303529, "post_id": 59481397, "comment_id": 105139402, "body": "Completely fair. I started writing an answer, too, and struggled for a similar reason."}, {"owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577312145, "post_id": 59481397, "comment_id": 105140814, "body": "@luqui What about if I use type families: <code>type family ElemOf x :: *</code> Can&#39;t I implement <code>fmap3 :: (ElemOf p -&gt; ElemOf q) -&gt; p -&gt; q</code>?"}, {"owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577313250, "post_id": 59481397, "comment_id": 105140985, "body": "@luqi OK so if I have this: ``` class AAA a b where id2 :: a -&gt; b ``` nothing prevents me from doing this ``` instance AAA a a where id2 = id ``` Right? Similarly instead of having this: ``` class  Functor f  where     fmap        :: (a -&gt; b) -&gt; f a -&gt; f b ``` I could have this ``` class  Functor a b p q  where     fmap        :: (a -&gt; b) -&gt; p -&gt; q ``` OK i&#39;m adding parameters but I can keep the same code for each Functor instance no?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577317316, "post_id": 59481397, "comment_id": 105141506, "body": "@J.M., oh ok I am starting to see what you are asking.  It might be instructive to attempt these sorts of definitions and then try to use them.  Redo a bit of the standard library in your style, perhaps. Just make sure you don&#39;t stop at &quot;the definition type checks&quot; -- the mechanics at the use site come into play also."}, {"owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577317428, "post_id": 59481397, "comment_id": 105141525, "body": "Ive looked at that monotraversable library which sort of avoids kinds. see what i mean? thats why im confused as to what is the true purpose of kinds beside safety.."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 5, "last_activity_date": 1577303277, "creation_date": 1577303277, "answer_id": 59481397, "question_id": 59481115, "link": "https://stackoverflow.com/questions/59481115/haskell-kind-system-vs-type-families-and-multi-param-type-classes/59481397#59481397", "title": "Haskell kind system vs type families and multi param type classes", "body": "<p>Let's back up.  It seems like you think that because the signature </p>\n\n<pre><code>id2 :: a -&gt; b\n</code></pre>\n\n<p>is more general than</p>\n\n<pre><code>id :: a -&gt; a\n</code></pre>\n\n<p>that <code>id2</code> could have the same implementation as <code>id</code>.  But that's not true.  In fact <code>id2</code> has no total implementation (any implementation of <code>id2</code> involves an infinite loop or <code>undefined</code>).</p>\n\n<p>The structure of generality creates a \"pressure\", and this pressure is what we must navigate to find the right type for something.  If <code>f</code> is more general than <code>g</code>, that means that <em>anywhere <code>g</code> could be used, <code>f</code> could also</em> but it <strong>also</strong> means that <em>any implementation of <code>f</code> is a valid implementation of <code>g</code></em>.  So at the use site it goes one direction, at the definition site it goes the other.</p>\n\n<p>We can use <code>id2</code> anywhere we could have used <code>id</code>, but the signature of <code>id2</code> is so general that it is impossible to implement.  The more general a signature gets, the more contexts it can be used in, but also the less likely it is to have an implementation.  I would say a main goal of a good type signature is to find the level of generality where there are <em>as few as possible</em> implementations of your intended function, without making it impossible to write altogether.</p>\n\n<p>Your proposed signature <code>fmap2 :: (a -&gt; b) -&gt; p -&gt; q</code> is, like <code>id2</code>, so general that it is impossible to implement.  The purpose of higher-kinded types is to give us the tools to have very general signatures like <code>fmap</code>, which are not <em>too</em> general like <code>fmap2</code>.</p>\n"}], "owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1577461886, "creation_date": 1577300214, "last_edit_date": 1577461886, "question_id": 59481115, "link": "https://stackoverflow.com/questions/59481115/haskell-kind-system-vs-type-families-and-multi-param-type-classes", "title": "Haskell kind system vs type families and multi param type classes", "body": "<p>In Haskell I find it difficult to completely grasp the purpose of a kind system, and what it truly adds to the language.</p>\n\n<p>I understand having kinds adds safety.\nFor example consider <code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code> vs a monokinded version of it <code>fmap2 :: (a -&gt; b) -&gt; p -&gt; q</code>.</p>\n\n<p>My understanding is that, thanks to the kind system, I can specify beforehand with higher detail what the shape of the data should be. It is better, as the type checker can check more, and stricter requirements will make it less likely that users will mess up with types. This will reduce the likelihood of programming errors. I believe this is the main motivation for kinds but I might be wrong.</p>\n\n<p>Now I think fmap2 can have the same implementation as fmap, since its types are unconstrained. Is it true?</p>\n\n<p>Could one just replace all multi kinded types in the base/ghc library by mono kinded ones, and would it still compile correctly?</p>\n\n<p>To clarify a little bit I mean that for a class like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class  Functor f  where\n    fmap        :: (a -&gt; b) -&gt; f a -&gt; f b\n    (&lt;$)        :: a -&gt; f b -&gt; f a\n</code></pre>\n\n<p>I might replace it by something like </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class  Functor a b p q  where\n    fmap        :: (a -&gt; b) -&gt; p -&gt; q\n    (&lt;$)        :: a -&gt; q -&gt; p\n</code></pre>\n\n<p>This way for a <code>Functor</code> instance like </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Functor [] where fmap = map\n</code></pre>\n\n<p>I might replace it by</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Functor a b p q where fmap = map\n</code></pre>\n\n<p>Remark: This wont work as is because i also need to modify <code>map</code> and go down the dependency chain. Will think more about this later..</p>\n\n<p>I'm trying to figure out if kinds add more than just safety? Can I do something with multi kinded types that I cannot do with mono kinded ones?</p>\n\n<p>Remark: Here I forgot to mention i'm usually using some language extensions, typically to allow more flexibility in writing classes.\nWhen doing vanilla haskell kinds can be really meaningful thing to use.\nBut when I start using type families, and a few of other extensions it becomes much less clear that I need kinds at all.</p>\n\n<p>I have in mind that there is some monotraversable library which reimplements many  standard library functions using single kinded types, and type families to generalize signatures. That's why my intuition is that multi kinded variables might not really add that much expressive power after all, provided one uses type families. However a drawback of doing this is that you lose type safety. My question is do you really only lose just that, or do you really lose something else.</p>\n"}, {"tags": ["haskell", "polykinds"], "answers": [{"comments": [{"owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577285935, "post_id": 59479479, "comment_id": 105135928, "body": "i&#39;m not sure if this works, I want it to work for all <code>a</code> and <code>b</code> that i may plug in later, here it seems they are constant parameters, I feel like it should only depends on <code>l</code>. Maybe im wrong ill have to check"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 2, "creation_date": 1577286572, "post_id": 59479479, "comment_id": 105136065, "body": "@J.M. <code>a</code> and <code>b</code> are parameters, not constants, in the code above."}, {"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "reply_to_user": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "edited": false, "score": 0, "creation_date": 1577286681, "post_id": 59479479, "comment_id": 105136087, "body": "@J.M. I don&#39;t understand your exact question but I added some clarification I though you might find helpful"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 2, "creation_date": 1577297673, "post_id": 59479479, "comment_id": 105138365, "body": "In the last case I don&#39;t think <code>a</code> and <code>b</code> need to have the same kind: <code>type M (l :: k1 -&gt; k2 -&gt; *) (a :: k2) (b :: k1) = l b a </code>"}], "tags": [], "owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "is_accepted": true, "score": 5, "last_activity_date": 1577350145, "last_edit_date": 1577350145, "creation_date": 1577285614, "answer_id": 59479479, "question_id": 59479446, "link": "https://stackoverflow.com/questions/59479446/in-haskell-how-to-reorder-multi-kinded-types/59479479#59479479", "title": "In Haskell, how to reorder multi kinded types", "body": "<pre><code>type M l a b = l b a \n\nnewtype M l a b = M (l b a)\n</code></pre>\n\n<p>Or without taking <code>l</code> as parameter </p>\n\n<pre><code>data L a b = ... \n\nnewtype M a b = M (L b a) \n\ntype M a b = L b a\n</code></pre>\n\n<p>Edit:</p>\n\n<pre><code>type M l a b = l b a \n\ndata L a b = L (a Int) (b Int)\n\ntype Z = M L Maybe []\n</code></pre>\n\n<p>Moreover, you can give explicit kind signatures too</p>\n\n<pre><code>type M  (l :: k1 -&gt; k2 -&gt; *) (a :: k2) (b :: k1) = l b a \n</code></pre>\n"}], "owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 59479479, "answer_count": 1, "score": 1, "last_activity_date": 1577350145, "creation_date": 1577285310, "last_edit_date": 1577286013, "question_id": 59479446, "link": "https://stackoverflow.com/questions/59479446/in-haskell-how-to-reorder-multi-kinded-types", "title": "In Haskell, how to reorder multi kinded types", "body": "<p>Say I have a type of kind <code>l :: * -&gt; * -&gt; *</code>, so I need to apply 2 types for example <code>a</code>, and <code>b</code> to get a simple type <code>l a b</code>.</p>\n\n<p>How can I map the type <code>l :: * -&gt; * -&gt; *</code> into a new type <code>m(l) :: * -&gt; * -&gt; *</code> where <code>m(l) b a</code> means the same as <code>l a b</code> for every <code>a,b</code> ? Here <code>a,b</code> are not constants. Is it possible? Is it wrong to think of that?</p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1577280068, "post_id": 59478759, "comment_id": 105134519, "body": "The <code>DatatypeContexts</code> feature was considered a &quot;misfeature&quot;. It makes implicit what is better made explicit: that the <code>a</code> has a certain constraint on it: <a href=\"https://stackoverflow.com/a/7438716/67579\">stackoverflow.com/a/7438716/67579</a>"}, {"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 2, "creation_date": 1577280391, "post_id": 59478759, "comment_id": 105134613, "body": "<a href=\"https://www.youtube.com/watch?v=hIZxTQP1ifo&amp;feature=youtu.be&amp;t=1261\" rel=\"nofollow noreferrer\">youtube.com/watch?v=hIZxTQP1ifo&amp;feature=youtu.be&amp;t=1261</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1577329123, "post_id": 59478759, "comment_id": 105142816, "body": "@WillemVanOnsem, my understanding is that it didn&#39;t actually make anything implicit at all.  You still have to write all the same constraints you would have had to without a datatype context, and you are forced to write them in places where they would otherwise not be necessary.  It made more work for you with no gain."}], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 6, "last_activity_date": 1577281256, "creation_date": 1577281256, "answer_id": 59478944, "question_id": 59478759, "link": "https://stackoverflow.com/questions/59478759/does-the-sum-newtype-make-sense-for-non-numerical-types/59478944#59478944", "title": "Does the Sum newtype make sense for non-numerical types?", "body": "<p>As a raw datatype definition that you've quoted, <code>Sum a</code> isn't actually useful - it just trivially wraps another type. And this wouldn't become any more useful with a <code>Num a</code> constraint, even if that actually did anything in practice.</p>\n\n<p>What <code>Sum</code> is in practice used for is to make <code>Semigroup</code> and <code>Monoid</code> instances for numeric types, based on addition (and avoid privileging this instance over other possible ones by attaching it directly to the underlying type):</p>\n\n<pre><code>instance (Num a) =&gt; Semigroup (Sum a) where\n    (&lt;&gt;) = (+)\n</code></pre>\n\n<p>and here of course the constraint is necessary. But these instances are the only reason the type even exists, and there's no gain in including a constraint in the type definition.</p>\n"}], "owner": {"reputation": 343, "user_id": 5737686, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-NxMDXN7k3Ks/AAAAAAAAAAI/AAAAAAAAAZA/GwCslJbriao/photo.jpg?sz=128", "display_name": "sa___", "link": "https://stackoverflow.com/users/5737686/sa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 59478944, "answer_count": 1, "score": 2, "last_activity_date": 1577281256, "creation_date": 1577279798, "question_id": 59478759, "link": "https://stackoverflow.com/questions/59478759/does-the-sum-newtype-make-sense-for-non-numerical-types", "title": "Does the Sum newtype make sense for non-numerical types?", "body": "<p>This is how Sum is currently defined.</p>\n\n<p><code>newtype Sum a = Sum {getSum :: a}</code></p>\n\n<p>Does anyone have examples of how's it useful outside the numerical context? If it isn't, then why don't we constrain the <code>a</code> to be <code>Num a</code> while defining the newtype? Why would anyone want to define a <code>Sum \"hello\"</code> at all?</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1577273663, "post_id": 59477995, "comment_id": 105133034, "body": "The <code>String k, String v</code>, etc. type constraints do not make any sense."}], "answers": [{"comments": [{"owner": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "edited": false, "score": 0, "creation_date": 1577277688, "post_id": 59478032, "comment_id": 105133965, "body": "I see. To the left of &quot;=&gt;&quot;, I can write something like <code>Num x</code>, because <code>Num</code> is a type<b>class</b>, but <code>String</code> is just a type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "edited": false, "score": 1, "creation_date": 1577277969, "post_id": 59478032, "comment_id": 105134016, "body": "@user1934428 Yes. The rough idea is that a typeclass is &quot;a set/class of types&quot;, e.g. <code>Num</code> is a class comprising <code>Int,Integer,Double,Float,...</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1577273754, "creation_date": 1577273754, "answer_id": 59478032, "question_id": 59477995, "link": "https://stackoverflow.com/questions/59477995/creating-data-types-containing-lists-and-defining-functions-on-them/59478032#59478032", "title": "Creating data types containing lists and defining functions on them", "body": "<p>Your types are <em>not</em> typeclasses. A type constraint like <code>(String k, String v, Tdict d) =&gt;</code> thus does not make sense.</p>\n\n<p>You can implement the function with:</p>\n\n<pre><code>insertTdict :: <b>String</b> -&gt; <b>String</b> -&gt; <b>Tdict</b> -&gt; Tdict</code></pre>\n"}], "owner": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 59478032, "answer_count": 1, "score": 1, "last_activity_date": 1577292314, "creation_date": 1577273473, "last_edit_date": 1577292314, "question_id": 59477995, "link": "https://stackoverflow.com/questions/59477995/creating-data-types-containing-lists-and-defining-functions-on-them", "title": "Creating data types containing lists and defining functions on them", "body": "<p>Informally speaking, I made a data type Tdict where each instance of it is  a list of pairs, and each pair consists of a String and a List of Strings; in other languages, I would use a Hash, mapping Strings to Lists of Strings. Since I am learning Haskell, I would like to roll out this structure from scratch, instead of using the Hash package from Haskell. </p>\n\n<p>This is my data type definition of Tdict, using two auxiliary type definitions:</p>\n\n<pre><code>-- Pair of two strings\ndata TPair = TPair String String deriving (Show)\n\n-- Associating one String to a list of Strings\ndata Tassoc = Tassoc String [String] deriving (Show)\n\n-- type synonym for list of associations\ntype Tdict = [Tassoc]\n</code></pre>\n\n<p>So far, this is accepted by Haskell, so at least it is syntactically correct. Now I want to define a function, which takes as parameter two strings and a Tdict and returns a Tdict. However, Haskell already rejects the signature definition of the function:</p>\n\n<pre><code>insertTdict :: (String k, String v, Tdict d) =&gt; k -&gt; v -&gt; d -&gt; Tdict\n</code></pre>\n\n<p>The error message is about both parameters <code>v</code> and `d and reads:  </p>\n\n<pre><code>error:\n    \u2022 Expected kind \u2018* -&gt; Constraint\u2019, but \u2018Tdict\u2019 has kind \u2018*\u2019\n    \u2022 In the type signature:\n        insertTdict :: (String k, String v, Tdict d) =&gt;\n                   k -&gt; v -&gt; d -&gt; Tdict\n</code></pre>\n\n<p>(The error messages for parameters <code>v</code> and <code>d</code> are identical).</p>\n\n<p>What did I do wrong? I have the feeling, that I am missing something fundamental in Haskell.</p>\n\n<p>I used <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">this page</a> as  a reference for defining my data types.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1577268493, "post_id": 59475658, "comment_id": 105131881, "body": "You say &quot;obviously&quot;, but can you explain why it doesn&#39;t parse <code>.5</code> or <code>3.</code>?"}, {"owner": {"reputation": 57, "user_id": 12585674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa2c883d305bf71cc3a2a09ab597f937?s=128&d=identicon&r=PG&f=1", "display_name": "mission_code_now", "link": "https://stackoverflow.com/users/12585674/mission-code-now"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1577285473, "post_id": 59475658, "comment_id": 105135819, "body": "This parser serves to be a calculator-related feature, thus any sample inputs like those in your comment to be blocked strictly enough. Such inputs might be fixed to 0.5 and 3.0 rather well, but my case doesn&#39;t have to do with that solution"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 12585674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa2c883d305bf71cc3a2a09ab597f937?s=128&d=identicon&r=PG&f=1", "display_name": "mission_code_now", "link": "https://stackoverflow.com/users/12585674/mission-code-now"}, "edited": false, "score": 0, "creation_date": 1577286429, "post_id": 59476084, "comment_id": 105136034, "body": "Thank you for your response, indeed. But I get this error when compiling a module: <code>Couldn&#39;t match expected type Char&#39; with actual type ParsecT String () Data.Functor.Identity.Identity [Char]&#39; </code>. So, how to resolve that in order to start running?"}, {"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "reply_to_user": {"reputation": 57, "user_id": 12585674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa2c883d305bf71cc3a2a09ab597f937?s=128&d=identicon&r=PG&f=1", "display_name": "mission_code_now", "link": "https://stackoverflow.com/users/12585674/mission-code-now"}, "edited": false, "score": 0, "creation_date": 1577287175, "post_id": 59476084, "comment_id": 105136189, "body": "@mission_code_now I added the full working code. Maybe you can figure out the error"}, {"owner": {"reputation": 57, "user_id": 12585674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa2c883d305bf71cc3a2a09ab597f937?s=128&d=identicon&r=PG&f=1", "display_name": "mission_code_now", "link": "https://stackoverflow.com/users/12585674/mission-code-now"}, "edited": false, "score": 0, "creation_date": 1577287604, "post_id": 59476084, "comment_id": 105136265, "body": "Following your update, it runs smoothly. Thank you a lot, indeed."}], "tags": [], "owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "is_accepted": true, "score": 1, "last_activity_date": 1577287041, "last_edit_date": 1577287041, "creation_date": 1577258160, "answer_id": 59476084, "question_id": 59475658, "link": "https://stackoverflow.com/questions/59475658/parsing-floating-point-numbers-with-parsec-of-haskell/59476084#59476084", "title": "Parsing floating point numbers with Parsec of Haskell", "body": "<pre><code>fp_number  :: Parsec String () Double\nfp_number  = read &lt;$&gt; parser  where \n   parser = (++) &lt;$&gt; number &lt;*&gt; (option \"\" $ (:) &lt;$&gt; char '.'  &lt;*&gt; number )\n</code></pre>\n\n<p>A side note, don't forget to handle negative numbers too. </p>\n\n<pre><code>type Parser a = Parsec String () a\n\ndigit :: Parser Char\ndigit = -- same \n\nnumber :: Parser String \nnumber =  many1 digit\n\nfp_number  :: Parser  Double\nfp_number  = read &lt;$&gt; parser  where \n   parser = (++) &lt;$&gt; number &lt;*&gt; (option \"\" $ (:) &lt;$&gt; char '.'  &lt;*&gt; number )\n\nfp_addition :: Parser Double\nfp_addition = --same\n\ntest = parseTest fp_addition \"2.123 + 213.12\"\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 12585674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa2c883d305bf71cc3a2a09ab597f937?s=128&d=identicon&r=PG&f=1", "display_name": "mission_code_now", "link": "https://stackoverflow.com/users/12585674/mission-code-now"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 59476084, "answer_count": 1, "score": 1, "last_activity_date": 1577287041, "creation_date": 1577253932, "last_edit_date": 1577266046, "question_id": 59475658, "link": "https://stackoverflow.com/questions/59475658/parsing-floating-point-numbers-with-parsec-of-haskell", "title": "Parsing floating point numbers with Parsec of Haskell", "body": "<p>There is some code used to run parsing over calculator inputs (both integer and floating ones):</p>\n\n<pre><code>import Text.Parsec hiding(digit)\nimport Data.Functor\n\ntype Parser a = Parsec String () a\n\ndigit :: Parser Char\ndigit = oneOf ['0'..'9']\n\nfp_char :: Parser Char\nfp_char = oneOf ['.', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9']\n\nnumber :: Parser Integer \nnumber = read &lt;$&gt; many1 digit\n\nfp_number :: Parser Double\nfp_number = read &lt;$&gt; many1 fp_char\n\naddition :: Parser Integer\naddition = do\n    lhv &lt;- number\n    spaces\n    char '+'\n    spaces\n    rhv &lt;- number\n    return $ lhv + rhv\n\nfp_addition :: Parser Double\nfp_addition = do\n    lhv &lt;- fp_number\n    spaces\n    char '+'\n    spaces\n    rhv &lt;- fp_number\n    return $ lhv + rhv\n</code></pre>\n\n<p>Obviously, this will throw an exception once a float number input which preceded or followed by '.' without any digit before/after dot character respectively. How can I constrain string evaluation to prevent from execution failure?       </p>\n"}, {"tags": ["haskell", "recursion", "filter"], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 4, "last_activity_date": 1577242604, "creation_date": 1577242604, "answer_id": 59474856, "question_id": 59474836, "link": "https://stackoverflow.com/questions/59474836/filter-a-custom-data-type/59474856#59474856", "title": "filter a custom data type", "body": "<p>A <code>PriceItem</code> has a <code>[(Price, PriceType)]</code> in it. To turn a <code>(Price, PriceType)</code> into a <code>Price</code>, use <code>fst</code> to get the first element of the tuple. To do something to each element of a list, use <code>map</code>. Put those pieces together like this:</p>\n\n<pre><code>getPrices (PriceItem xs) = map fst xs\n</code></pre>\n\n<p>No explicit recursion is required.</p>\n\n<hr>\n\n<p>If you wanted to write all of the involved functions (including the recursion) yourself, you could do this instead:</p>\n\n<pre><code>getPrices (PriceItem []) = []\ngetPrices (PriceItem ((price, _):xs)) = price:getPrices (PriceItem xs)\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 12593452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a2c6a9455330529d8264d64f16f663?s=128&d=identicon&r=PG&f=1", "display_name": "nanemuna", "link": "https://stackoverflow.com/users/12593452/nanemuna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 59474856, "answer_count": 1, "score": 0, "last_activity_date": 1577247954, "creation_date": 1577242301, "last_edit_date": 1577242917, "question_id": 59474836, "link": "https://stackoverflow.com/questions/59474836/filter-a-custom-data-type", "title": "filter a custom data type", "body": "<p>I have these data types</p>\n\n<pre><code>type Price = (Int, Int)\nnewtype PriceItem = PriceItem [(Price, PriceType)]\ndata PriceType = High\n                | Medium\n                | Low\n                deriving Eq\n</code></pre>\n\n<p>and I'm trying to build a function that will give me a list with all the prices of a PriceItem (without the PriceType)</p>\n\n<pre><code>getPrices :: PriceItem -&gt; [Price]\n</code></pre>\n\n<p>I can't find a way to make this function recursive, which it needs to be since there can be any number of tuples in the PriceItem list </p>\n"}, {"tags": ["haskell", "newtype"], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 2, "last_activity_date": 1577236855, "creation_date": 1577236855, "answer_id": 59474520, "question_id": 59474501, "link": "https://stackoverflow.com/questions/59474501/couldnt-match-expected-type-newtype/59474520#59474520", "title": "couldn&#39;t match expected type (newtype)", "body": "<p>You declared <code>Board</code> with <code>newtype</code>, but you're trying to use it as if you declared it with <code>type</code>. Two choices to fix it:</p>\n\n<ol>\n<li>Declare <code>board</code> like this instead: <code>type Board = [(Cell, CellType)]</code></li>\n<li>Use the <code>Board</code> data constructor in <code>createTypeBoard</code>, like this: <code>createTypeBoard (a, b) c = Board $ zip (createCells (a, b)) [c]</code></li>\n</ol>\n\n<p>For more information on the difference between <code>type</code> and <code>newtype</code>, which may affect your decision on which fix to go with, see <a href=\"https://stackoverflow.com/q/991467/7509065\">Haskell type vs. newtype with respect to type safety</a> and/or <a href=\"https://stackoverflow.com/q/31815310/7509065\">The difference between type and newtype in Haskell</a>.</p>\n"}], "owner": {"reputation": 59, "user_id": 12593452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a2c6a9455330529d8264d64f16f663?s=128&d=identicon&r=PG&f=1", "display_name": "nanemuna", "link": "https://stackoverflow.com/users/12593452/nanemuna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 59474520, "answer_count": 1, "score": 0, "last_activity_date": 1577236855, "creation_date": 1577236536, "question_id": 59474501, "link": "https://stackoverflow.com/questions/59474501/couldnt-match-expected-type-newtype", "title": "couldn&#39;t match expected type (newtype)", "body": "<p>I'm working on a function </p>\n\n<pre><code>createTypeBoard :: (Int, Int) -&gt; CellType -&gt; Board\n</code></pre>\n\n<p>using these types</p>\n\n<pre><code>newtype Board = Board [(Cell, CellType)] deriving(Eq)\n\ndata CellType  = Mine                \n           | Flag                    \n           | Void                     \n           | Enumerated Int          \n           | Undiscovered             \n           deriving Eq\n\ntype Cell = (Int, Int)\n</code></pre>\n\n<p>createTypeBoard (2,2) Mine should be: Board [((1,1), X), ((1,2), X), ((2,1), X), ((2,2), X)]</p>\n\n<p>(X is the show instance of Mine)</p>\n\n<p>my idea was to use zip:</p>\n\n<pre><code>createTypeBoars (a, b) c = zip (createCells (a, b)) [c]\n</code></pre>\n\n<p>but I keep getting an error</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Board\u2019\n              with actual type \u2018[(Cell, CellType)]\u2019\n\u2022 In the expression: zip (createCells (a, b)) [Flag]\n  In an equation for \u2018createTypeBoard\u2019:\n      createTypeBoard (a, b) Flag = zip (createCells (a, b)) [Flag]\n</code></pre>\n\n<p>Board basically is [(Cell, CellType)] so I don't really get what the problem is :(</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1577215859, "creation_date": 1577215859, "answer_id": 59472810, "question_id": 59472723, "link": "https://stackoverflow.com/questions/59472723/whats-a-difference-between-unary-and-binary-operator-parsing-in-haskell/59472810#59472810", "title": "What&#39;s a difference between unary and binary operator parsing in Haskell?", "body": "<p><code>factorial</code> doesn't define a parser; it computes a factorial. The type should just be <code>Integer -&gt; Integer</code>, not <code>Parser Integer -&gt; Parser Integer</code>.</p>\n"}], "owner": {"reputation": 57, "user_id": 12585674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa2c883d305bf71cc3a2a09ab597f937?s=128&d=identicon&r=PG&f=1", "display_name": "mission_code_now", "link": "https://stackoverflow.com/users/12585674/mission-code-now"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 59472810, "answer_count": 1, "score": -1, "last_activity_date": 1577215859, "creation_date": 1577215075, "question_id": 59472723, "link": "https://stackoverflow.com/questions/59472723/whats-a-difference-between-unary-and-binary-operator-parsing-in-haskell", "title": "What&#39;s a difference between unary and binary operator parsing in Haskell?", "body": "<p>I'm learning some techniques to make a very simple Haskell parser that serves to calculation consistence (addition, subtraction and other trivial operations). Library I use is Parsec. Although I've got some comprehension on binary calculation, it seems to be tough to me if I try to make a unary operator function, for example that of negation (~). There is a code snippet I use to implement parsing for multiplication:</p>\n\n<pre><code>import Text.Parsec hiding(digit)\nimport Data.Functor\n\ntype Parser a = Parsec String () a\n\ndigit :: Parser Char\ndigit = oneOf ['0'..'9']\n\nnumber :: Parser Integer\nnumber = read &lt;$&gt; many1 digit\n\napplyMany :: a -&gt; [a -&gt; a] -&gt; a\napplyMany x [] = x\napplyMany x (h:t) = applyMany (h x) t  \n\n\nmultiplication :: Parser Integer\nmultiplication = do\n    lhv &lt;- number\n        spaces\n        char '*'\n        spaces\n        rhv &lt;- number\n        return $ lhv * rhv\n</code></pre>\n\n<p>Switching to an unary operation, my code for factorial as follows:</p>\n\n<pre><code>fact :: Parser Integer\nfact = do\n    spaces\n    char '!'\n    rhv &lt;- number\n    spaces\n    return $ factorial rhv\n\n\nfactorial :: Parser Integer -&gt; Parser Integer\nfactorial n\n    | n == 0 || n == 1 = 1\n    | otherwise = n * factorial (n-1)\n</code></pre>\n\n<p>And once module is getting loaded, an error message appears just like that:</p>\n\n<pre><code> Couldn't match type `Integer'\n                 with `ParsecT String () Data.Functor.Identity.Identity Integer'\n  Expected type: Parser Integer\n    Actual type: Integer\n</code></pre>\n\n<p>Confusingly, it's a hard case for me to realize what's wrong with my comprehension about unary ops comparing them to binary ones. Hoping any help to fix that.           </p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577217471, "post_id": 59472608, "comment_id": 105124377, "body": "When you say that QuickCheck is generating &quot;random keys&quot;, do you mean that it is generating random <code>StrMap</code>s? This question is very hard for me to understand."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577217600, "post_id": 59472608, "comment_id": 105124405, "body": "This is not a <i>minimum reproducible example</i> so I cannot be sure, but <code>(M.size . strs result)</code> looks like a type error. It is very difficult to answer a question like this if your example code doesn&#39;t compile."}, {"owner": {"reputation": 387, "user_id": 5377722, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MHeNHEtZhiI/AAAAAAAAAAI/AAAAAAAAAFo/racMaZDaQHE/photo.jpg?sz=128", "display_name": "Sergii Sopin", "link": "https://stackoverflow.com/users/5377722/sergii-sopin"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577217671, "post_id": 59472608, "comment_id": 105124418, "body": "It is generating a map with the content like following: {(0, &quot;xyz&quot;), (3, &quot;qwerty&quot;)} or just {(5, &quot;asd&quot;)}. In my case I need to make sure that keys always start from zero and there is no gaps between them, i.e. keys should always be 0,1,2,3,4,..."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577217732, "post_id": 59472608, "comment_id": 105124434, "body": "I don&#39;t think that is what you need at all. I don&#39;t see how that is relevant to the property you are checking. You never actually test the <i>values of the keys</i> in any way, only the relative sizes of successive maps."}, {"owner": {"reputation": 387, "user_id": 5377722, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MHeNHEtZhiI/AAAAAAAAAAI/AAAAAAAAAFo/racMaZDaQHE/photo.jpg?sz=128", "display_name": "Sergii Sopin", "link": "https://stackoverflow.com/users/5377722/sergii-sopin"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577218040, "post_id": 59472608, "comment_id": 105124494, "body": "When I have a map with values {(0,&quot;abc&quot;),(2,&quot;qwerty&quot;)} and I insert another value using addStr function it checks the size of the map, which is 2 in this example, and adds new element with the key equals to the size and a new value. In this example, I already have this key (2) in the map, so the value will be just overriden, which is not what I need."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577218245, "post_id": 59472608, "comment_id": 105124530, "body": "Ah. That makes sense. You shouldn&#39;t rely on QuickCheck to build structures that maintain some external invariant that your code requires unless you somehow tell QuickCheck to do that. One way you could do this would be to generate a small integer <code>n</code> and an infinite list of strings and to successively add <code>n</code> strings to an empty map. Then at any point, adding one more should have the behavior you expect."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577218604, "post_id": 59472608, "comment_id": 105124598, "body": "I still suspect that there are a number of issues that prevent your code from compiling, which makes it difficult to give more concrete advice. Another one is that <code>create</code> has the wrong type to be used as you do to construct <code>result&#39;</code>."}, {"owner": {"reputation": 387, "user_id": 5377722, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MHeNHEtZhiI/AAAAAAAAAAI/AAAAAAAAAFo/racMaZDaQHE/photo.jpg?sz=128", "display_name": "Sergii Sopin", "link": "https://stackoverflow.com/users/5377722/sergii-sopin"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577218958, "post_id": 59472608, "comment_id": 105124664, "body": "Could you please clarify what part doesn&#39;t compile? I assume you mean the test itself as the code being tested compiles well?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1577220459, "post_id": 59472608, "comment_id": 105124945, "body": "Surely you can clarify whether it does or doesn&#39;t compile. It is your code and you can try to compile it. I was wrong about the <code>addStr</code> being a type error, but I have to guess about these things because your code as provided is incomplete and can&#39;t be compiled at all."}, {"owner": {"reputation": 387, "user_id": 5377722, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MHeNHEtZhiI/AAAAAAAAAAI/AAAAAAAAAFo/racMaZDaQHE/photo.jpg?sz=128", "display_name": "Sergii Sopin", "link": "https://stackoverflow.com/users/5377722/sergii-sopin"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1577222263, "post_id": 59472608, "comment_id": 105125322, "body": "Yes, sorry. I was focusing on the code itself instead of the test. Changed it, so it compiles now (only some imports are missing)."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 3, "last_activity_date": 1577224376, "last_edit_date": 1577224376, "creation_date": 1577224057, "answer_id": 59473637, "question_id": 59472608, "link": "https://stackoverflow.com/questions/59472608/quickcheck-sequential-map-key-generation/59473637#59473637", "title": "QuickCheck sequential Map key generation", "body": "<p>Instead of using <code>QuickCheck</code> to generate arbitrary data that satisfies some complex invariant, which can be difficult, you can use QuickCheck to generate fully arbitrary data from which you can then construct data that satisfies the invariant (by some method external to the system being tested which you trust to be correct).</p>\n\n<p>The invariant in this case is given as \"keys must be contiguous\", but is actually \"keys must be contiguous <em>and start from 0</em>\". This is sufficient, but more than necessary. The minimal invariant required by <code>addStr</code> is \"the map must not contain a key that is the size of the map\", since that is the key we intend to insert. By simplifying the constraint, we also make it easier to satisfy: we can generate an arbitrary map (which may contain the bad key) and then delete the bad key, giving a satisfactory map.</p>\n\n<p>I'll also note that the UUID (and thus the mechanism for generating it, which requires <code>State</code> and perhaps <code>IO</code>) is irrelevant to the property being tested. This means we can construct the <code>MyType</code> with any <code>UUID</code> we have lying around (like the <code>nil</code> UUID provided by the package) and avoid the monadic stuff:</p>\n\n<pre><code>spec :: Spec\nspec = describe \"Creation and update\" $ do\n  QuickCheck.prop \"Check map addition\" $ do\n    \\strmap -&gt; -- we don't actually care what the String being inserted is for this test\n      let myType = MyType UUID.nil (M.delete (M.size strmap) strmap) -- Enforce the invariant\n      in assert $ strsSize (addStr myType \"\") = strsSize myType + 1\n</code></pre>\n\n<p>If you wanted to, you could also make an instance of <code>Arbitrary</code> for <code>MyType</code> that does something like this, or something that satisfies the stronger invariant (which may be required for other tests). I'll leave that as an exercise for you, but feel free to ask more questions if you get stuck trying it.</p>\n"}], "owner": {"reputation": 387, "user_id": 5377722, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MHeNHEtZhiI/AAAAAAAAAAI/AAAAAAAAAFo/racMaZDaQHE/photo.jpg?sz=128", "display_name": "Sergii Sopin", "link": "https://stackoverflow.com/users/5377722/sergii-sopin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 59473637, "answer_count": 1, "score": 2, "last_activity_date": 1578275475, "creation_date": 1577214210, "last_edit_date": 1578275475, "question_id": 59472608, "link": "https://stackoverflow.com/questions/59472608/quickcheck-sequential-map-key-generation", "title": "QuickCheck sequential Map key generation", "body": "<p>I am trying to test a logic of custom data type. It receives a Map Int String as a parameter and then I need to add an element into the Map inside the object. </p>\n\n<p>Type declaration and insertion function look like this: </p>\n\n<pre><code>import qualified Data.IntMap.Strict as M\nimport Data.UUID (UUID)\nimport Control.Monad.State\nimport System.Random\n\ntype StrMap = M.IntMap String\ntype MType = State StdGen\n\ndata MyType = MyType {\n    uuid :: UUID,\n    strs :: StrMap\n} deriving (Show)\n\ncreate :: StrMap -&gt; MType MyType\ncreate pm = do\n    state &lt;- get\n    let (uuid, newState) = random state\n    put newState\n    return $ MyType uuid pm\n\nstrsSize :: MyType -&gt; Int\nstrsSize e = M.size $ strs e\n\naddStr :: MyType -&gt; String -&gt; MyType\naddStr e p = e { strs = M.insert (strsSize e) p $ strs e }\n</code></pre>\n\n<p>It is important to have sequential keys in the Map, so having [0, 1, 3] is not acceptable.\nI was trying to test it using HSpec with QuickCheck:</p>\n\n<pre><code>main :: IO ()\nmain = hspec spec\n\nspec :: Spec\nspec = describe \"Creation and update\" $ do\n    QuickCheck.prop \"Check map addition\" $ do\n        \\xs str -&gt; monadicIO $ do\n            state &lt;- run(getStdGen)\n            let (result, newState) = runState (create xs) state\n            run(setStdGen newState)\n            let result' = addStr result str\n            assert $ (strsSize result) + 1 == strsSize result' -- fails here\n</code></pre>\n\n<p>The problem is that QuickCheck generates random keys and I am not sure how do I force it to generate a sequential keys for the Map. The problem with absense of the sequense is that function addStr may override values in case of repetetive keys, which is not desirable behavior.</p>\n\n<hr>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Thanks for all the help! After a long discussion and some kind of a thinking  I ended up with the following solution:</p>\n\n<pre><code>spec :: Spec\nspec = describe \"Creation and update\" $ do\n    QuickCheck.prop \"Check map addition\" $ do\n        \\xs str -&gt; not (null xs) Property.==&gt; monadicIO $ do\n            state &lt;- run(getStdGen)\n            let mp = M.fromList $ zip [0..(length xs)] xs\n            let (result, newState) = runState (create mp) state\n            run(setStdGen newState)\n            let result' = addStr result str\n            assert $ (strsSize result) + 1 == strsSize result'\n</code></pre>\n\n<p>Basically, I had to generate some random set of strings and them convert in into a map manually. It is probably not the most elegant solution, but it works as needed.</p>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1577212497, "post_id": 59472344, "comment_id": 105123200, "body": "The empty list has type <code>[] :: [a]</code>, since the other list is a <code>[[&#39;a&#39;]]</code>, it knows that <code>a ~ [Char]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1577213934, "post_id": 59472344, "comment_id": 105123579, "body": "It definitely isn&#39;t treating an empty list and <code>[[Char]]</code> as the same. However, it <i>is</i> treating the empty list as a value of type <code>[[Char]]</code> -- and why shouldn&#39;t it?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 3, "creation_date": 1577216844, "post_id": 59472344, "comment_id": 105124246, "body": "<code>[]</code> aka <code>Empty</code> is a <i>kind of</i> overloaded type constructor just like <code>Nothing</code> of <code>Maybe a</code>. It can belong to multiple types those carry type variable(s)."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "edited": false, "score": 3, "creation_date": 1577214009, "post_id": 59472421, "comment_id": 105123601, "body": "@Rahat Yes, exactly. (This is the meaning of <code>a ~ [Char]</code> in the answer -- you can read the <code>~</code> as an equality; the language creators only chose <code>~</code> instead of <code>=</code> because <code>=</code> already has so many uses in the syntax.)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1577214042, "post_id": 59472421, "comment_id": 105123609, "body": "If I said &quot;here are two doors that both have the same kind of thing behind them&quot; and then I opened the second door, showing you a cat, could you tell me what is behind the first door? That is what the compiler is doing here."}, {"owner": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "edited": false, "score": 0, "creation_date": 1577214896, "post_id": 59472421, "comment_id": 105123835, "body": "Cheers, I really appreciate your help. Merry Christmas to all."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 9, "last_activity_date": 1577212735, "creation_date": 1577212735, "answer_id": 59472421, "question_id": 59472344, "link": "https://stackoverflow.com/questions/59472344/why-is-the-type-of-true-false-a-bool-ch/59472421#59472421", "title": "why is the type of [ ( True , [ ] ) , ( False , [ [&#39;a&#39;] ] ) ] , &quot;[ (Bool , [ [char] ] )]&quot;?", "body": "<p>Haskell knows that <code>True</code> and <code>False</code> are <code>Bool</code>s, and furthermore we know that all the elements of a list have the same type.</p>\n\n<p>We are thus looking for a type <code>[(True,[]),(False, [['a']])]</code>. We see with the element that it is a 2-tuple with as first element a <code>Bool</code>, and as second item there is an empty list, so that has type <code>[] :: [a]</code> with <code>a</code>, at that time, unknown.</p>\n\n<p>Now if we look at the second item, and see <code>(False, [['a']])</code>. This is thus a 2-tuple with <code>False</code> as first item, and <code>[['a']]</code> as second item. The type of <code>'a'</code> is <code>Char</code>, hence <code>['a']</code> has type <code>[Char]</code>, and <code>[['a']]</code> has type <code>[[Char]]</code>. Since the elements of a list should have the same type, we thus derive that the <code>a</code> type parameter of the first item, is <code>a ~ [Char]</code>, and thus the outer list has type <code>[(True,[]),(False, [['a']])] :: [(Bool, [[Char]])]</code>.</p>\n"}], "owner": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1577289666, "creation_date": 1577212313, "last_edit_date": 1577289666, "question_id": 59472344, "link": "https://stackoverflow.com/questions/59472344/why-is-the-type-of-true-false-a-bool-ch", "title": "why is the type of [ ( True , [ ] ) , ( False , [ [&#39;a&#39;] ] ) ] , &quot;[ (Bool , [ [char] ] )]&quot;?", "body": "<p>When i type <code>:type [(True,[]),(False, [['a']])] , \"[(Bool,[[char]])]\"</code> in ghci it outputs <code>[ (Bool , [ [char] ] )]</code>. how is it possible that Haskell's type inference is treating an empty list and [[char]] as the same.</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 2, "last_activity_date": 1577289151, "last_edit_date": 1577289151, "creation_date": 1577247104, "answer_id": 59475167, "question_id": 59472241, "link": "https://stackoverflow.com/questions/59472241/custom-quickcheck-failed-message/59475167#59475167", "title": "Custom QuickCheck failed message", "body": "<p>Somehow I've never seen it advertised, but you can use <code>hspec</code>s expectations inside of <code>QuickCheck</code> properties. Here is an example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  describe \"blabla\" $ do\n    it \"should be equl\" $ verbose $ \\input -&gt;\n      round input `shouldBe` floor (input :: Double)\n</code></pre>\n\n<p>Above property is clearly not true, so it should fail. Since we are not only interested <code>input</code>, but also want to know the computed values from it, <code>shouldBe</code> will give us just that: </p>\n\n<pre><code>  3) blabla should be equl\n       Falsifiable (after 2 tests and 4 shrinks):\n         0.6\n       expected: 0\n        but got: 1\n</code></pre>\n\n<p>Naturally, due to <code>verbose</code>, only <code>input</code> will be printed for passing tests, while computed value (eg. <code>round input</code>) will only be printed for a failed test case, which is what you were looking for it seems anyways.</p>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 59475167, "answer_count": 1, "score": 4, "last_activity_date": 1577289151, "creation_date": 1577211510, "last_edit_date": 1577211938, "question_id": 59472241, "link": "https://stackoverflow.com/questions/59472241/custom-quickcheck-failed-message", "title": "Custom QuickCheck failed message", "body": "<pre><code>test1 = hspec $ do\n  describe \"blabla\" $ do\n    it \"should be equl\" $ verbose $\n      \\input-&gt; ...\n</code></pre>\n\n<p>In the above code, when a test failed, it prints the failed <code>input</code>. But I'm actually interested in another value that can be calculated from <code>input</code>. Can I ask <code>QuickCheck</code> to print the other value?</p>\n"}, {"tags": ["algorithm", "haskell", "binary-search-tree"], "answers": [{"tags": [], "owner": {"reputation": 36328, "user_id": 5483526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec50563f80bacd2a7fed69bd31d0c810?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Timmermans", "link": "https://stackoverflow.com/users/5483526/matt-timmermans"}, "is_accepted": true, "score": 1, "last_activity_date": 1577366540, "last_edit_date": 1577366540, "creation_date": 1577204762, "answer_id": 59471361, "question_id": 59470793, "link": "https://stackoverflow.com/questions/59470793/no-more-than-d1-comparisons-for-member-function-of-binary-search-tree/59471361#59471361", "title": "No more than d+1 comparisons for member function of binary search tree", "body": "<p>This is the BST equivalent for how I do binary search: <a href=\"https://stackoverflow.com/questions/39416560/how-can-i-simplify-this-working-binary-search-code-in-c/39417165#39417165\">How can I simplify this working Binary Search code in C?</a></p>\n\n<p>It's most simply described as \"find the position where it belongs, then check to see if it's there\".</p>\n\n<p>You are right that it's not efficient as the 3-way compare in the best case, but the best case is very unlikely.  In the <em>average</em> hit case, the 3-way procedure requires 2(d-1) compares, and in all miss cases it requires 2d.</p>\n\n<p>None of the comparisons in either algorithm are redundant, however, so no case in either one can be improved without making some other case worse.</p>\n\n<p>Given a full tree of depth d with unique keys, consider that both algorithms will perform a sequence of binary comparisons that will either identify the target node (2<sup>d</sup>-1 possibilities) or the position where it would be inserted (2<sup>d</sup> possibilities).  That's 2<sup>d+1</sup>-1 possible answers.</p>\n\n<p>Think about generating a Huffman encoding for the possible answers: <a href=\"https://en.wikipedia.org/wiki/Huffman_coding\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Huffman_coding</a></p>\n\n<p>The comparison results are a sequence of bits that identify the correct answer from the set of possibilities.  If all the answers are equally likely, then the optimal encoding takes (d+1) bits regardless of which answer is found.</p>\n\n<p>All other encodings are worse on average.  (Exactly <em>how much</em> worse can be determined by the Kullback-Leibler divergence, if you're interested: <a href=\"https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence</a>)</p>\n"}], "owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 59471361, "answer_count": 1, "score": -1, "last_activity_date": 1577366540, "creation_date": 1577201112, "question_id": 59470793, "link": "https://stackoverflow.com/questions/59470793/no-more-than-d1-comparisons-for-member-function-of-binary-search-tree", "title": "No more than d+1 comparisons for member function of binary search tree", "body": "<p>The exercise 2.2 in <em>Purely Functional Data Structure</em> says the original <code>member</code> function performs about <code>2d</code> comparisons in the worst case, where <code>d</code> is the depth of the tree. According to <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.14.8991\" rel=\"nofollow noreferrer\">this paper</a>, the author suggests to rewrite <code>member</code> function to take no more than <code>d + 1</code> comparisons by keeping track of a candidate element that <em>might</em> be equal to the query element (say, the last element for which &lt; returns false or &lt;= returns true) and checking for equality only when the bottom of the tree is hit.</p>\n\n<p>The following are the codes:</p>\n\n<pre><code>data Tree a = Leaf \n            | Fork (Tree a) a (Tree a)\n            deriving (Show, Eq)\n\n-- The original member function.\nmember :: Ord a =&gt; a -&gt; Tree a -&gt; Tree a\nmember _ Leaf = False\nmember x (Fork l y r)\n  | x &lt; y = member x l\n  | x &gt; y = member x r\n  | otherwise = True\n\n-- The improved member function that I write.\nmember' :: Ord a =&gt; a -&gt; Tree a -&gt; Tree a\nmember' v t = loop Nothing v t\n  where\n    loop candidate _ Leaf = Just x == candidate\n    loop candidate x (Fork l y r)\n      | x &lt; y = loop candidate x l\n      | otherwise = loop (Just y) x r\n</code></pre>\n\n<p>Now my questions are:</p>\n\n<ol>\n<li><p>According to <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.14.8991\" rel=\"nofollow noreferrer\">the paper</a>, is my improved <code>member</code> function right?</p></li>\n<li><p>In the worst case, the improved <code>member</code> is more efficient than the original one, since it compares no more than <code>d + 1</code> times. But according to the algorithm, the improved <code>member</code> will take <code>d + 1</code> comparisons for every query. For the original <code>member</code>, if the queried value equals the root value, it only compaires two times, whereas the improved <code>member</code> seems to still take <code>d + 1</code> comparisons. So it seems the improved algorithm is not as efficient as the original one in the best case. Do I misunderstand anything here? Actually <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.14.8991\" rel=\"nofollow noreferrer\">the paper</a> about the algorithm reads:</p></li>\n</ol>\n\n<blockquote>\n  <p><strong>When the searched-for node is reached the algorithm does not terminate</strong>\n  <strong>but continues in the right subtree</strong>. Since all elements in that subtree\n  are larger than the one searched for, the algorithm will make no more\n  right turns after passing that node. Thus if the element searched for\n  is to be found in the tree it has to be in the node where the last\n  right turn was made, which is the node referred to by candidate.</p>\n</blockquote>\n\n<p>So it seems that's how I understand the algorithm.</p>\n\n<ol start=\"3\">\n<li>If point 2 is true, then how to improve the algorithm so that it doesn't need to compare <code>d + 1</code> times in the best case besides using the three-way comparison functon <code>compare</code> in Haskell?</li>\n</ol>\n\n<p>Thanks for any information!</p>\n"}, {"tags": ["list", "haskell", "list-comprehension", "monads", "functor"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1577202809, "post_id": 59470646, "comment_id": 105120687, "body": "I don&#39;t know if this is possible, but practically, do you really <i>need</i> to handle all <code>n &gt; 0</code>? At <code>n = 10</code> there&#39;s going to be close to 4 billion elements in that list. At <code>n = 15</code>, there&#39;s going to be almost 1E+15 elements."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1577203307, "post_id": 59470646, "comment_id": 105120859, "body": "As written, <code>f i</code> returns the same value for all <code>i &gt;= 3</code>."}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1577388438, "post_id": 59470646, "comment_id": 105159495, "body": "I am writing a solver for a 2D &quot;rubik&#39;s&quot; cube game with this. It should be possible to solve it/strategically simplify the solution process with group theory. Here I am brute-forcing a group that swaps 1 with 2. Hopefully it doesn&#39;t require over <code>n&gt;8</code>. Game here: <a href=\"https://www.chiark.greenend.org.uk/~sgtatham/puzzles/js/twiddle.html\" rel=\"nofollow noreferrer\">chiark.greenend.org.uk/~sgtatham/puzzles/js/twiddle.html</a>."}], "answers": [{"comments": [{"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1577219656, "post_id": 59471740, "comment_id": 105124795, "body": "I did try using <code>++</code> in the lambda, but couldn&#39;t quite get the recurrent definition of g with itself. Thanks!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1577265707, "post_id": 59471740, "comment_id": 105131294, "body": "there&#39;s also the simpler option of <code>g = map reverse . g&#39;         where {         g&#39; 0 = [[]] ;         g&#39; n = [ (x:xs) | xs &lt;- g&#39; (n-1), x &lt;- f n ] }</code> which might even be a little bit more performant that Hughes&#39;, if the latter isn&#39;t used with <code>(\\xs x ys -&gt; xs $! (x:ys))</code> instead of (the equivalent of) <code>(\\xs x ys -&gt; xs ((x:) ys))</code> -- unless GHC is smart enough to do this on its own. (or maybe I&#39;m way off the mark here; and actually it&#39;s all just about the <code>~ 2n</code> time vs the <code>~ 3n</code> time, so, not that significant anyway :) )"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1577262530, "last_edit_date": 1577262530, "creation_date": 1577207590, "answer_id": 59471740, "question_id": 59470646, "link": "https://stackoverflow.com/questions/59470646/list-comprehension-in-haskell-of-any-order-or-dimension/59471740#59471740", "title": "List comprehension in Haskell of any order or dimension", "body": "<p>Like this:</p>\n\n<pre><code>g 0 = [[]]\ng n = (\\xs x -&gt; xs ++ [x]) &lt;$&gt; g (n - 1) &lt;*&gt; f n\n</code></pre>\n\n<p>Or more complicated, but also more efficient:</p>\n\n<pre><code>g = map ($ []) . go\n  where\n    go :: Int -&gt; [[(Char,Int)] -&gt; [(Char,Int)]]\n    go 0 = [id]\n    go n = (\\xs x -&gt; xs . (x:)) &lt;$&gt; go (n - 1) &lt;*&gt; f n\n</code></pre>\n\n<p>This uses Hughes lists/difference lists to avoid <a href=\"https://stackoverflow.com/a/13879693/849891\">the quadratic slowdown</a> of <code>\\xs x -&gt; xs ++ [x]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577214044, "post_id": 59472296, "comment_id": 105123611, "body": "Not sure how I missed this. This is way better than my answer."}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1577219587, "post_id": 59472296, "comment_id": 105124779, "body": "Thanks for the detailed explanation! I played with the list of <code>Prelude</code> functions, including both <code>sequence</code> and <code>traverse</code> (and some others), but didn&#39;t have the insight to see something that simple!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1577260979, "post_id": 59472296, "comment_id": 105130321, "body": "<code>(sequence .) . map</code> is <code>mapM</code> actually, which is a clearer name (IMO:YMMV), way shorter to type, and <code>[]</code> is a Monad anyway. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1577344846, "post_id": 59472296, "comment_id": 105145619, "body": "(what I forgot to add is that it&#39;s with <code>sequenceA</code> that it&#39;s <code>traverse</code> -- what you undoubtedly know, but I note this for the sake of a casual traveler)."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1577212663, "last_edit_date": 1577212663, "creation_date": 1577212018, "answer_id": 59472296, "question_id": 59470646, "link": "https://stackoverflow.com/questions/59470646/list-comprehension-in-haskell-of-any-order-or-dimension/59472296#59472296", "title": "List comprehension in Haskell of any order or dimension", "body": "<pre><code>g n = traverse f [1 .. n]\n</code></pre>\n\n<p><code>traverse</code> is in the Prelude (at least for the last few years).</p>\n\n<p>As that's a bit non-obvious, here's how I got there:</p>\n\n<ol>\n<li><p>I noticed you were applying <code>f</code> to the numbers from 1 to n, so I started with <code>map f [1 .. n]</code>.</p></li>\n<li><p>This produced a <code>[[(Char, Int)]]</code>, which is the desired result type, but it needs to be sort of...  turned sideways and multiplied. You want all the lists that come from non-deterministic selection of values in the inner lists.  Non-deterministic selection is the essence of the <code>Applicative</code> instance for <code>[]</code>, and it turns out that <code>sequence</code> on something of type <code>[[a]]</code> is exactly the operation \"produce all the lists you get from combinatorially combining elements from the inner lists\". This got me to <code>sequence $ map f [1 .. n]</code>.</p></li>\n<li><p>But the pair of <code>sequence</code> and <code>map</code> is common enough that there's an operation that does both at once. <code>sequence . map f</code> === <code>traverse f</code>.  So applying that rule simplified the result.  <code>traverse f [1 .. n]</code>.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1577327773, "post_id": 59476462, "comment_id": 105142657, "body": "I did start with the list comprehension syntax as yours, and slowly made my way into the <code>&lt;*&gt;</code> syntax, and was thinking of something like <code>fmap (.) fmap</code> composition to conjure up <code>a &lt;*&gt; b &lt;*&gt; ...</code> but couldn&#39;t get it to work. Anyway, thx for the explanation!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1577345267, "post_id": 59476462, "comment_id": 105145750, "body": "you&#39;re most welcome. :) the applicative syntax <code>...&lt;$&gt;...&lt;*&gt;...&lt;*&gt;...</code> comes as a substitute for the missing general <code>liftAn</code>, and MonadComprehensions can be another alternative for that (the <i>brackety</i> syntax; as in the original paper). What&#39;s missing is the ability for MonadComprehension to be translated as an Applicative-based code, when possible. I have <a href=\"https://stackoverflow.com/search?q=user%3A849891+essentially+Monadic\">several posts</a> about what makes a computation <i>essentially</i> Monadic."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1577284109, "last_edit_date": 1577284109, "creation_date": 1577261744, "answer_id": 59476462, "question_id": 59470646, "link": "https://stackoverflow.com/questions/59470646/list-comprehension-in-haskell-of-any-order-or-dimension/59476462#59476462", "title": "List comprehension in Haskell of any order or dimension", "body": "<pre><code>g n = mapM f [1..n]\n</code></pre>\n\n<h2>How to get there.</h2>\n\n<p>Your examples are equivalently written with List Comprehension syntax as </p>\n\n<pre><code>g :: Int -&gt; [[(Char,Int)]]\ng 1 = [[a    ] | a &lt;- (f 1)]\ng 2 = [[a,b  ] | a &lt;- (f 1), b &lt;- (f 2)]\ng 3 = [[a,b,c] | a &lt;- (f 1), b &lt;- (f 2), c &lt;- (f 3)]\n-- g n = [[a,b,c, ... , z] | a &lt;- (f 1), b &lt;- (f 2), ... , z &lt;- (f n)]\n</code></pre>\n\n<p>which is exactly how <code>sequence</code> is defined, in Monad Comprehension syntax:</p>\n\n<pre><code>sequence [as,bs,cs, ... , zs] = [[a,b,c, ... , z] | a &lt;- as, b &lt;- bs, ... , z &lt;- zs]\n</code></pre>\n\n<p>and thus</p>\n\n<pre><code>g n = sequence [(f 1), (f 2), ... , (f n)]\n    = sequence $ map f [1..n]\n</code></pre>\n\n<p>which is, in its turn, the definition (or an equivalent thereof) of <code>mapM</code>.</p>\n\n<p>(<code>mapM</code> is also known as <code>traverse</code> now, for types which are also Applicatives, as well as Monads. Haskell lists <code>[]</code> are both, anyway, and I find the name <code>mapM</code> clearer and shorter to type).</p>\n\n<hr>\n\n<p>This has been a public service announcement in favor of the underappreciated List Comprehension and Monad Comprehension syntax. </p>\n\n<p>I'm actually fine with <code>g n = sequence $ map f [1..n]</code>, and don't feel any particular urge to shorten it any further, as I find it clearer than both alternatives.</p>\n"}], "owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 59472296, "answer_count": 3, "score": 3, "last_activity_date": 1577284109, "creation_date": 1577200280, "last_edit_date": 1577261105, "question_id": 59470646, "link": "https://stackoverflow.com/questions/59470646/list-comprehension-in-haskell-of-any-order-or-dimension", "title": "List comprehension in Haskell of any order or dimension", "body": "<p>Consider the following program.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>chars = [\" \"] ++ [\"A\"] ++ [\"B\"] ++ (repeat \"ABCD\")\n\nf :: Int -&gt; [(Char,Int)]\nf n = (,) &lt;$&gt; (chars !! n) &lt;*&gt; [1..3]\n\ng :: Int -&gt; [[(Char,Int)]]\ng 1 = (\\a     -&gt; [a    ]) &lt;$&gt; (f 1)\ng 2 = (\\a b   -&gt; [a,b  ]) &lt;$&gt; (f 1) &lt;*&gt; (f 2)\ng 3 = (\\a b c -&gt; [a,b,c]) &lt;$&gt; (f 1) &lt;*&gt; (f 2) &lt;*&gt; (f 3)\n-- g n = (\\x1 x2 ... xn -&gt; [x1,x2,...,xn]) &lt;$&gt; (f 1) &lt;*&gt; (f 2) &lt;*&gt; ... (f n)\n</code></pre>\n\n<p>How can we write <code>g n</code> generally for all n > 0, without typing out the expansion explicitly as above, ideally only using <code>Prelude</code> (and <code>Control.Applicative</code> if necessary)? Note that <code>f n = f (n-1)</code> for all n>3, hence it may be possible to define <code>g</code> recursively. </p>\n\n<p>The output is like this (ignore the pretty printing):</p>\n\n<pre><code>&gt; g 1\n[ [ ( 'A' , 1 ) ] , [ ( 'A' , 2 ) ] , [ ( 'A' , 3 ) ] ]\n\n&gt; g 2\n[ [ ( 'A' , 1 ) , ( 'B' , 1 ) ]\n, [ ( 'A' , 1 ) , ( 'B' , 2 ) ]\n, [ ( 'A' , 1 ) , ( 'B' , 3 ) ]\n, [ ( 'A' , 2 ) , ( 'B' , 1 ) ]\n, [ ( 'A' , 2 ) , ( 'B' , 2 ) ]\n, [ ( 'A' , 2 ) , ( 'B' , 3 ) ]\n, [ ( 'A' , 3 ) , ( 'B' , 1 ) ]\n, [ ( 'A' , 3 ) , ( 'B' , 2 ) ]\n, [ ( 'A' , 3 ) , ( 'B' , 3 ) ]\n]\n\n&gt; g 3\n[ [ ( 'A' , 1 ) , ( 'B' , 1 ) , ( 'A' , 1 ) ]\n, [ ( 'A' , 1 ) , ( 'B' , 1 ) , ( 'A' , 2 ) ]\n...\n, [ ( 'A' , 3 ) , ( 'B' , 3 ) , ( 'D' , 3 ) ]\n]\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1577195050, "creation_date": 1577195050, "answer_id": 59469724, "question_id": 59469354, "link": "https://stackoverflow.com/questions/59469354/how-to-run-parsec-test-in-haskell/59469724#59469724", "title": "How to run Parsec test in Haskell?", "body": "<p>You can use the <code>parseTest</code> function from the <a href=\"http://hackage.haskell.org/package/parsec-3.1.14.0/docs/Text-Parsec.html\" rel=\"nofollow noreferrer\">Text.Parsec module</a>. A sample session in GHCI:</p>\n\n<pre><code>~/g/scripts $ stack ghci parser.hs\nGHCi, version 8.6.5: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /home/sibi/.ghci\n[1 of 1] Compiling Main             ( /home/sibi/github/scripts/parser.hs, interpreted )\nOk, one module loaded.\nLoaded GHCi configuration from /tmp/haskell-stack-ghci/452ad586/ghci-script\n\u03bb&gt; :t addition\naddition\n  :: ParsecT String () Data.Functor.Identity.Identity Integer\n\u03bb&gt; :t parseTest\nparseTest\n  :: (Stream s Data.Functor.Identity.Identity t, Show a) =&gt;\n     Parsec s () a -&gt; s -&gt; IO ()\n\u03bb&gt; parseTest addition \"3 + 2\"\n5\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 12585674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa2c883d305bf71cc3a2a09ab597f937?s=128&d=identicon&r=PG&f=1", "display_name": "mission_code_now", "link": "https://stackoverflow.com/users/12585674/mission-code-now"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 59469724, "answer_count": 1, "score": 2, "last_activity_date": 1577195050, "creation_date": 1577193097, "question_id": 59469354, "link": "https://stackoverflow.com/questions/59469354/how-to-run-parsec-test-in-haskell", "title": "How to run Parsec test in Haskell?", "body": "<p>Most recently, I've started learning parser implementation with Hackage libraries, particularly Parsec. So far I've this code to test integer addition as one of simple calculator features:</p>\n\n<pre><code>import Text.Parsec hiding(digit)\nimport Data.Functor\n\ntype Parser a = Parsec String () a\n\ndigit :: Parser Char\ndigit = oneOf ['0'..'9']\n\nnumber :: Parser Integer\nnumber = read &lt;$&gt; many1 digit\n\naddition = do\n    lhv &lt;- number\n    spaces\n    char '+'\n    spaces\n    rhv &lt;- number\n    return $ lhv + rhv  \n</code></pre>\n\n<p>I'm a little bit confused due to missing clue to start this parser by GHCI (my OS is Windows 10). What do I want to enter in command prompt just for having some test of that?         </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 1, "creation_date": 1577198250, "post_id": 59469216, "comment_id": 105119279, "body": "A list with 0 or 1 element is precisely what Maybe is."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1577198859, "post_id": 59469216, "comment_id": 105119443, "body": "How do you know? If you build your list this way, why not build the right thing, a Maybe, in the first place?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1577192692, "creation_date": 1577192692, "answer_id": 59469263, "question_id": 59469216, "link": "https://stackoverflow.com/questions/59469216/how-to-deal-with-non-exhaustive-pattern-matching/59469263#59469263", "title": "How to deal with non-exhaustive pattern matching?", "body": "<p>You can make a function where you make it \"impossible\" to pass such list. Indeed you can implement a function:</p>\n\n<pre><code>atLeastTwo :: <b>a -&gt; a -&gt; [a]</b> -&gt; b</code></pre>\n\n<p>So here the first two parameters represent the first and the second element, and the third parameter, the list, contains the remaining elements. You thus can implement a function, where the check if a function is exhaustive is useful, since you check that for the last parameter (the elements after the first two elements), all patterns are covered.</p>\n\n<p>or we can work with <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List-NonEmpty.html#t:NonEmpty\" rel=\"nofollow noreferrer\"><strong><code>NonEmpty</code></strong></a> to represent a non-empty list:</p>\n\n<pre><code>atLeastTwo :: <b>a -&gt; NonEmpty a</b> -&gt; b</code></pre>\n\n<p><code>NonEmpty</code> is defined as:</p>\n\n<pre><code>data NonEmpty = <b>a :| [a]</b></code></pre>\n\n<p>It is thus a type with one data constructor, that forces that the \"list\" contains at least one element.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1577269094, "post_id": 59469903, "comment_id": 105132013, "body": "just a few words or some link(s) about what those <code>&#39;Empty</code> and <code>&#39;NonEmpty</code> and <code>(t :: Tag)</code> things are (for someone not in the know to be able to find out more), and this will be perfect. :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1577196032, "creation_date": 1577196032, "answer_id": 59469903, "question_id": 59469216, "link": "https://stackoverflow.com/questions/59469216/how-to-deal-with-non-exhaustive-pattern-matching/59469903#59469903", "title": "How to deal with non-exhaustive pattern matching?", "body": "<p>There are several techniques. (Some untested code follows.)</p>\n\n<h3>Restricting the domain</h3>\n\n<p>Instead of</p>\n\n<pre><code>useList :: [a] -&gt; T\n</code></pre>\n\n<p>we can use a type for non-empty-lists:</p>\n\n<pre><code>useList :: NonEmptyList a -&gt; T\n</code></pre>\n\n<p>Willem's answer already explains this.</p>\n\n<h3>Weakening the codomain</h3>\n\n<p>We can instead use</p>\n\n<pre><code>useList :: [a] -&gt; Maybe T\nuseList (x:xs) = Just (...) -- as before\nuseList []     = Nothing\n</code></pre>\n\n<p>and make the pattern matching to be exhaustive. This is however less convenient for the caller who has to handle the <code>Nothing</code> case, which we might know to never happen.</p>\n\n<h3>Partial, but documented function</h3>\n\n<p>We can instead <code>error</code> out:</p>\n\n<pre><code>useList :: [a] -&gt; T\nuseList (x:xs) = (...) -- as before\nuseList []     = error \"useList: empty list\"\n</code></pre>\n\n<p>This also makes the pattern matching to be exhaustive. It suppresses the warning, at the cost of producing a runtime error message, which we can customize. </p>\n\n<p>In some cases, there is no pragmatic better alternative. For instance, assume we are using an algorithm to solve a complex task, and said algorithm keeps (or at least, should keep) an invariant where the list is always non empty. Then, instead of</p>\n\n<pre><code>useList :: [a] -&gt; Int\nuseList (x:xs) = (...)\nuseList []     = -1          -- it never happens, so we can return anything\n</code></pre>\n\n<p>it is better to use</p>\n\n<pre><code>useList :: [a] -&gt; Int\nuseList (x:xs) = (...)\nuseList []     = \"useList: internal error -- non null list invariant broken!\"\n</code></pre>\n\n<p>The latter makes it possible to detect a bug as early as possible.</p>\n\n<h3>GADTs proofs</h3>\n\n<p>Sometimes we can pass information using GADTs which help to make pattern matching exhaustive. For instance, one could use a type for tagged lists, where the tag represents the emptiness</p>\n\n<pre><code>data Tag = Empty | NonEmpty\n\ndata List (t :: Tag) a where\n   Nil  :: List 'Empty a\n   Cons :: a -&gt; List t a -&gt; List 'NonEmpty a\n</code></pre>\n\n<p>Then,</p>\n\n<pre><code>useList :: List 'NonEmpty a -&gt; T\nuseList (Cons x xs) = ...\n</code></pre>\n\n<p>is exhaustive, even if we never handle the <code>Nil</code> case.</p>\n\n<p>GHC also allows the \"non emptiness proof\" to be passed separately:</p>\n\n<pre><code>data IsNonEmpty (t :: Tag) where\n   IsNE :: IsNonEmpty 'NonEmpty\n\nuseList :: IsNonEmpty t -&gt; List t a -&gt; T\nuseList IsNE (Cons x xs) = ...\n</code></pre>\n\n<p>is also considered to be exhaustive.</p>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1577196032, "creation_date": 1577192436, "last_edit_date": 1577192561, "question_id": 59469216, "link": "https://stackoverflow.com/questions/59469216/how-to-deal-with-non-exhaustive-pattern-matching", "title": "How to deal with non-exhaustive pattern matching?", "body": "<p>I'm giving my function a list as a parameter but I know that it can ever be either empty list or list with one single element.</p>\n\n<p>When I do pattern matching I get a warning about non-exhaustive patterns.\nI can ignore it and the code works but what are some idiomatic ways of doing this?</p>\n"}, {"tags": ["haskell", "quickcheck", "haskell-hedgehog"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1577197330, "post_id": 59466970, "comment_id": 105119013, "body": "I think that more domain-specific details are required to get more interesting answers."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1577197204, "creation_date": 1577197204, "answer_id": 59470121, "question_id": 59466970, "link": "https://stackoverflow.com/questions/59466970/dependent-shrinking-in-quickcheck/59470121#59470121", "title": "Dependent shrinking in QuickCheck", "body": "<p>There is no panacea. To the best of my knowledge, integrated shrinking is the state of the art of general purpose solutions, with the caveats you mention. It's built into Hedgehog, but the approach is also 100% compatible with QuickCheck, which simply takes a neutral stance on the matter of shrinking, because there is no solution even close to a one-size-fits-all.</p>\n\n<blockquote>\n  <p>Libraries like hedgehog that feature integrated shrinking would solve this particular problem (albeit not always), however I'm wondering if there is a principled way to solve this in QuickCheck.</p>\n</blockquote>\n\n<p>The question suggests that there is some kind of methodological dichotomy between Hedgehog and QuickCheck, but that's not the case. They follow different design philosophies, but they're not opposed at all.</p>\n\n<p>Integrated shrinking (i.e., mixing generation and shrinking in the same monad) is at a sweet spot of generality and convenience; it is built into Hedgehog, but one could also build something equivalent on top of QuickCheck. There's no fundamental obstacle, it's just not worth the effort compared to simply using what's already there in Hedgehog.</p>\n\n<p>QuickCheck is organized differently, with a separate generator <code>Gen a</code> and shrinker <code>a -&gt; [a]</code>. If you want to generate a tree of values and use that for shrinking (which is how integrated shrinking works), you are free to go ahead and just do it. The point is, the choice is yours to make, instead of made for you implicitly; in exchange, you get to start with two simple abstractions for orthogonal concepts (generation and shrinking), instead of one more complex abstraction tying the two concepts together. Pragmatically, the difference is superficial and it's easy enough to decompose or merge back these abstractions explicitly.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 59470121, "answer_count": 1, "score": 3, "last_activity_date": 1577197204, "creation_date": 1577181351, "question_id": 59466970, "link": "https://stackoverflow.com/questions/59466970/dependent-shrinking-in-quickcheck", "title": "Dependent shrinking in QuickCheck", "body": "<p>I'm faced with the problem of writing a shrinking function for a generator that depends of the value (s) output by another one. Basically a generator of the form:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>do\n  a &lt;- genA\n  b &lt;- f a\n  pure $! g a b\n</code></pre>\n\n<p>where <code>genA :: Gen a</code>, <code>f :: a -&gt; Gen b</code> <code>g :: a -&gt; b -&gt; c</code>. For the sake of argument assume <code>g = (,)</code>. Then the problem is that given a pair <code>(a, b)</code>, shrinking <code>a</code> could break the relation that exists between <code>a</code>, <code>f</code> and <code>b</code>. </p>\n\n<p>To give an example of this, consider the following lists with a cached length:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data List =\n  List\n  { llength :: Int\n  , list :: [Int]\n  } deriving (Eq, Show)\n</code></pre>\n\n<p>The <code>arbitrary</code> function can be easily defined:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Arbitrary List where\n  arbitrary = do\n    n &lt;- choose (0, 10)\n    xs &lt;- vector n\n    pure $! List { llength = n, list = xs }\n</code></pre>\n\n<p>however shrinking an element of the form <code>List n xs</code> requires some knowledge of the relation between <code>n</code> and <code>xs</code>.</p>\n\n<p>In the preceding example this isn't a problem, since the relation between <code>n</code> and <code>xs</code> is easy to determine, however for the problem I'm working on determining this relationship is not trivial. </p>\n\n<p>Libraries like <code>hedgehog</code> that feature integrated shrinking would solve this particular problem (albeit <a href=\"https://www.well-typed.com/blog/2019/05/integrated-shrinking/\" rel=\"nofollow noreferrer\">not always</a>), however I'm wondering if there is a principled way to solve this in <code>QuickCheck</code>.</p>\n\n<hr>\n\n<p><a href=\"https://github.com/dnadales/sandbox/blob/968322d8ba4d9e2fc3469c1066e98127225546b6/hedgehog-vs-qc/test/hedgehog/Main.hs#L184\" rel=\"nofollow noreferrer\">Here</a> is an example that shows how <code>hedgehog</code> finds the minimal counterexample for the property that the length of the list is less than 5 (it consistently gives <code>List 5 [ 0 , 0 , 0 , 0 , 0 ]</code> as counterexample). And <a href=\"https://github.com/dnadales/sandbox/blob/968322d8ba4d9e2fc3469c1066e98127225546b6/hedgehog-vs-qc/test/qc/Main.hs#L170\" rel=\"nofollow noreferrer\">here</a> is an example of how I (think I) solved this problem at the moment, basically by emulating integrated shrinking.</p>\n\n<p>Also, be aware that the the behavior of the monadic interface of <code>hedgehog</code> <a href=\"https://www.well-typed.com/blog/2019/05/integrated-shrinking/\" rel=\"nofollow noreferrer\">is probably not what you want most of the time</a>.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 128601, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/741546b2a839c1a6f4148c290a83204e?s=128&d=identicon&r=PG", "display_name": "Alex Dong", "link": "https://stackoverflow.com/users/128601/alex-dong"}, "edited": false, "score": 1, "creation_date": 1577180657, "post_id": 59466729, "comment_id": 105113203, "body": "That&#39;s it. Thanks. Yes, I stripped off most of the code just to make it easier for people to see the error."}], "tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": true, "score": 6, "last_activity_date": 1577180302, "creation_date": 1577180302, "answer_id": 59466729, "question_id": 59466682, "link": "https://stackoverflow.com/questions/59466682/ghc-complains-could-not-find-module-monad/59466729#59466729", "title": "ghc complains &quot;Could not find module \u2018Monad\u2019&quot;", "body": "<p>Did you mean to import Control.Monad?</p>\n\n<p>None of the imports you have are needed to compile the minified program, since everything you need is already implicitly imported through the Prelude module, but maybe your whole program requires more dependencies than Prelude.</p>\n"}], "owner": {"reputation": 779, "user_id": 128601, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/741546b2a839c1a6f4148c290a83204e?s=128&d=identicon&r=PG", "display_name": "Alex Dong", "link": "https://stackoverflow.com/users/128601/alex-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 59466729, "answer_count": 1, "score": -2, "last_activity_date": 1577180302, "creation_date": 1577180128, "question_id": 59466682, "link": "https://stackoverflow.com/questions/59466682/ghc-complains-could-not-find-module-monad", "title": "ghc complains &quot;Could not find module \u2018Monad\u2019&quot;", "body": "<p>I've long wanted to have a play with Haskell and Scheme so I decided to work through the book \"Write yourself a Scheme in 48 Hours\" to explore both. </p>\n\n<p>I just hit my first obstacle where the <code>Monad</code> module seems to be missing. I've tried running it in <code>ghci</code> and the result seems to be the same.</p>\n\n<p>My environment is ghc 8.8.1 on OSX 10.15.2. </p>\n\n<pre><code>% brew info ghc ghc: stable 8.8.1 (bottled), HEAD Glorious Glasgow\nHaskell Compilation System https://haskell.org/ghc/\n/usr/local/Cellar/ghc/8.8.1 (6,813 files, 1.5GB) *\n</code></pre>\n\n<p>Here is the minimum reproducible file:</p>\n\n<pre><code>% cat hello.hs\nmodule Main where\nimport Monad\nimport System.Environment\n\nmain :: IO ()\nmain = do\n  putStrLn (\"Hello\")\n</code></pre>\n\n<p>And here is the compilation error: </p>\n\n<pre><code>ghc hello.hs\n[1 of 1] Compiling Main             ( hello.hs, hello.o )\n\nhello.hs:2:1: error:\n    Could not find module \u2018Monad\u2019\n    Use -v (or `:set -v` in ghci) to see a list of the files searched for.\n  |\n2 | import Monad\n  | ^^^^^^^^^^^^\n</code></pre>\n\n<p>Any hints? </p>\n\n<p>Alex</p>\n"}, {"tags": ["haskell", "types", "module", "pattern-matching"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1577157778, "post_id": 59463405, "comment_id": 105107511, "body": "Near duplicate: <a href=\"https://stackoverflow.com/questions/47929556/haskell-export-data-constructor\" title=\"haskell export data constructor\">stackoverflow.com/questions/47929556/&hellip;</a>. You are currently only exporting the <i>type</i> constructor, not the data constructor, by using <code>module Lib (Hi)</code>."}, {"owner": {"reputation": 191, "user_id": 7588896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/949e623bb4766cb6090bbd3ca40cad06?s=128&d=identicon&r=PG&f=1", "display_name": "twitu", "link": "https://stackoverflow.com/users/7588896/twitu"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1577159129, "post_id": 59463405, "comment_id": 105107736, "body": "Thanks. I couldn&#39;t find the question with the words I was searching for. Do I delete the question or close it?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1577162061, "post_id": 59463405, "comment_id": 105108175, "body": "If you think your question is adequately answered, you can close this as a duplicate."}], "owner": {"reputation": 191, "user_id": 7588896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/949e623bb4766cb6090bbd3ca40cad06?s=128&d=identicon&r=PG&f=1", "display_name": "twitu", "link": "https://stackoverflow.com/users/7588896/twitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1577162399, "answer_count": 0, "score": 0, "last_activity_date": 1577156969, "creation_date": 1577156969, "question_id": 59463405, "link": "https://stackoverflow.com/questions/59463405/as-pattern-matching-on-data-constructor-from-different-module", "closed_reason": "Duplicate", "title": "As pattern matching on data constructor from different module", "body": "<p>I have two modules,</p>\n\n<p><code>Lib.hs</code></p>\n\n<pre><code>module Lib (Hi) where\n\ndata Hi = Hi Int Int\n</code></pre>\n\n<p><code>Check.hs</code></p>\n\n<pre><code>module Check (applyCheck) where\nimport Lib\n\napplyCheck :: Hi -&gt; (Hi, Hi)\napplyCheck hi@(Hi a b) = (Hi a + b a - b, hi)\n</code></pre>\n\n<p>And the compiler gives the following error,</p>\n\n<pre><code>error:\nNot in scope: data constructor \u2018Hi\u2019\nPerhaps you meant variable \u2018hi\u2019\non line applyCheck hi@(Hi a b) = (Hi a + b a - b, hi)\n</code></pre>\n\n<p>This does not happen when I declare <code>Hi</code> in <code>Check.hs</code>. What am I doing wrong here? Is there a different way to pattern match a data constructor in a different module?</p>\n"}, {"tags": ["forms", "haskell", "servant", "webui"], "comments": [{"owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1577149691, "post_id": 59462675, "comment_id": 105106374, "body": "Yeah, I&#39;ve seen it, but since it says it was a hacky way of doing things I was wondering if there&#39;s a better solution."}], "owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1577201501, "answer_count": 0, "score": 1, "last_activity_date": 1577148203, "creation_date": 1577148203, "question_id": 59462675, "link": "https://stackoverflow.com/questions/59462675/handle-a-form-using-servant", "closed_reason": "Duplicate", "title": "Handle a form using Servant", "body": "<p>I want to create a simple HTML site that contains even simpler form with only one Submit button. In order to achieve that I created the following Servant API:</p>\n\n<pre><code>type ClientAPI = \n    \"prices\" :&gt; Get '[HTML] (Html ()) -- returns HTML UI to the user\n    :&lt;|&gt; \"updatePrices\" :&gt; Post '[HTML] (Html ()) -- handles a recalc request\n</code></pre>\n\n<p>My goal is to redirect user to \"prices\" site after completing the \"updatePrices\" procedure. In order to do this I return \"prices\" view at the end of \"updatePrices\" handler:</p>\n\n<pre><code>updatePricesView :: Handler (Html ())\nupdatePricesView = do\n    -- do the required logic here\n    pricesView -- return the view for \"prices\" endpoint\n</code></pre>\n\n<p>This works almost ok. The only drawback is that the address in my browser is set to \"/updatePrices\" instead of \"/prices\". As a result, if I hit F5, the whole procedure gets executed once again, which is a bit counterintuitive.</p>\n\n<p>This actually makes me think: how to handle a form properly with Servant ? In other languages I typically implement this as a redirect to the desired site, but can't see anything like this here.</p>\n"}, {"tags": ["haskell", "where-clause", "ghci", "haskell-platform"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1577142713, "post_id": 59462192, "comment_id": 105105336, "body": "Please edit your question to actually quote the part you don&#39;t understand. As it is I have no idea what you&#39;re talking about, and I suspect I won&#39;t be alone."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 1, "creation_date": 1577143409, "post_id": 59462192, "comment_id": 105105449, "body": "It just means that you can only use a <code>where</code> clause when you define variables/functions (<code>thirtysix = x*x where x=6</code>). You can not do it when you don&#39;t define variables/functions, (<code>print (x*x) where x=6</code> is invalid because <code>print</code> is not defining a variable or function)"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 6, "last_activity_date": 1577154768, "last_edit_date": 1577154768, "creation_date": 1577143504, "answer_id": 59462269, "question_id": 59462192, "link": "https://stackoverflow.com/questions/59462192/why-does-xx-where-x-6-fail-in-haskell/59462269#59462269", "title": "Why does x*x where x = 6 fail in Haskell?", "body": "<p>The book means that the following \"expression\" is not valid Haskell syntax:</p>\n\n<pre><code>x*x where x = 6\n</code></pre>\n\n<p>You can see it is invalid by either entering it at the GHCi prompt:</p>\n\n<pre><code>&gt; x*x where x=6\n&lt;interactive&gt;:11:5: error: parse error on input \u2018where\u2019\n</code></pre>\n\n<p>or using it in a program where an expression is expected:</p>\n\n<pre><code>mybrokenprogram = (x * x where x = 6)   -- gives a parse error\n</code></pre>\n\n<p>Contrast this with:</p>\n\n<pre><code>let x=6 in x*x\n</code></pre>\n\n<p>which works from the GHCi prompt:</p>\n\n<pre><code>&gt; let x=6 in x*x\n36\n</code></pre>\n\n<p>and works fine as part of the other example:</p>\n\n<pre><code>myawesomeprogram = (let x = 6 in x*x)\n</code></pre>\n\n<p>The book is explaining that a <code>where</code> clause applies to the <strong>entire</strong> right hand side of its associated defintion:</p>\n\n<pre><code>myfinewhereclause = x*x+x\n    where x = 6*6\n</code></pre>\n\n<p>Here, the <code>where</code> clause provides a definition for <code>x</code> that applies to the whole right-hand side <code>x*x+x</code>.  Even if there was some alternative definition of <code>x</code> in scope, the <code>where</code> clause would redefine <code>x</code> for the whole RHS:</p>\n\n<pre><code>my_argument_x_is_ignored x = x*x+x where x = 6*6\n</code></pre>\n\n<p>Here, the <code>where</code> clause provides a definition of <code>x</code> that applies to every usage of <code>x</code> in the expression <code>x*x+x</code>.  It doesn't apply only to the last use of <code>x</code>, and you can't use parenthesis to make it apply only to the last use of <code>x</code>:</p>\n\n<pre><code>wontwork x = x*x + (x where x=6*6)   -- won't work: bad syntax\n</code></pre>\n\n<p>It's nothing deep.  It's just the way the <code>where</code> syntax works.</p>\n"}], "owner": {"reputation": 95, "user_id": 12507904, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LnxSbMMyb3s/AAAAAAAAAAI/AAAAAAAAAEA/8R0Y2ulML7U/photo.jpg?sz=128", "display_name": "Rahat", "link": "https://stackoverflow.com/users/12507904/rahat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577154768, "creation_date": 1577142655, "question_id": 59462192, "link": "https://stackoverflow.com/questions/59462192/why-does-xx-where-x-6-fail-in-haskell", "title": "Why does x*x where x = 6 fail in Haskell?", "body": "<p>I've been reading thinking functionally with Haskell to learn Haskell and I came across that. In the book it says that A where clause does not qualify an expression but the whole of the right hand side of a definition. I don't quite understand this means.</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"tags": [], "owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "is_accepted": true, "score": 0, "last_activity_date": 1577142396, "creation_date": 1577142396, "answer_id": 59462164, "question_id": 59461779, "link": "https://stackoverflow.com/questions/59461779/unexpected-result-from-combinatory-recursive-function/59462164#59462164", "title": "Unexpected result from combinatory recursive function", "body": "<p><code>(map (x:) (combinations t xs a))</code> is incorrect, since you will prepend x, the combination should match the remainder:</p>\n\n<pre><code>(map (x:) (combinations (t-x) xs a))\n</code></pre>\n\n<p>At some points <code>t</code> will become zero, and an empty list should produce a result for that zero.</p>\n\n<pre><code>combinations 0 [] a = []:a\ncombinations _ [] a = a\n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 59462164, "answer_count": 1, "score": 0, "last_activity_date": 1577142396, "creation_date": 1577139103, "last_edit_date": 1577140381, "question_id": 59461779, "link": "https://stackoverflow.com/questions/59461779/unexpected-result-from-combinatory-recursive-function", "title": "Unexpected result from combinatory recursive function", "body": "<p>I have a sequence of natural numbers at specific power (<code>n</code>) until an upper limit (<code>x</code>) starting from 1. For example if the power is <code>n = 2</code> and <code>x = 5</code> the sequence is <code>[1, 4, 9, 16, 25]</code>. Based on that numbers I have to find all the possible combinations as long as the sum of 1 or more values in a set returns <code>x</code>. Some examples:</p>\n\n<ul>\n<li><code>[[1,4]]</code> for <code>x = 5</code> and <code>n = 2</code></li>\n<li><code>[[1,9]]</code> for <code>x = 10</code> and <code>n = 2</code></li>\n<li><code>[[1, 8, 27, 64]]</code> for <code>x = 100</code> and <code>n = 3</code> </li>\n<li>and so on</li>\n</ul>\n\n<p>I wrote the following code:</p>\n\n<pre><code>combinations :: Int -&gt; [Int] -&gt; [[Int]] -&gt; [[Int]]\ncombinations t l@(x:xs) a\n    | sum l == t  = a ++ [l]\n    | otherwise   = (map (x:) (combinations t xs a)) ++ (combinations t xs a)\ncombinations _ [] a = a\n\ncalcPowers x n = filter (&lt;=x) (map (^n) [1..x])\n\ncombos x n = combinations x (calcPowers x n) []::[[Int]]\n</code></pre>\n\n<p>but the returned results are:</p>\n\n<pre><code>\u03bb&gt; combos 1 2\n[[1]] -- CORRECT\n\u03bb&gt; combos 4 2\n[[1,4],[4]] -- WRONG\n\u03bb&gt; combos 5 2\n[[1,4]] -- CORRECT\n\u03bb&gt; combos 10 2\n[] -- this should be [[1,9]] -- WRONG\n\u03bb&gt; combos 100 2\n[[1,4,9,16,25,36,49,64,81,100],[1,4,9,16,25,36,49,64,100],.....] -- WRONG\n\u03bb&gt; combos 100 3\n[[1,8,27,64]] -- CORRECT\n</code></pre>\n\n<p>Any idea why it is not returning the right sequences?</p>\n"}, {"tags": ["haskell", "types", "ghc", "type-inference"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1577179328, "last_edit_date": 1577179328, "creation_date": 1577142294, "answer_id": 59462155, "question_id": 59461745, "link": "https://stackoverflow.com/questions/59461745/haskell-interpreter-cannot-infer-return-type/59462155#59462155", "title": "Haskell interpreter cannot infer return type", "body": "<p>TL;DR Don't use GHCi to enter non trivial code. Write your code in a file and load it in GHCi.</p>\n\n<p>Your error message mentions <code>Ghci13.Strategy</code>, which is a different class from <code>Strategy</code>. GHCi prints references to module <code>GhciXXX</code> when your have some code around which refers to a class which was <em>redefined</em> during the GHCi session. You probably have half of the code referring to an old class, and the other half referring to a new class, and that results in chaos.</p>\n\n<p>To reproduce, try this in GHCi:</p>\n\n<pre><code>&gt; class C a where foo :: a -&gt; Bool \n&gt; bar = foo                        \n&gt; class C a where foo :: a -&gt; Int  \n&gt; :t foo                           \nfoo :: C a =&gt; a -&gt; Int                    \n&gt; :t bar                           \nbar :: Ghci1.C a =&gt; a -&gt; Bool             \n</code></pre>\n\n<p>Note the last <code>Ghci1.C</code> which refers to the old class.</p>\n"}], "owner": {"reputation": 3855, "user_id": 342882, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/c13b4dc095a1bcc25e008effdd5cf07a?s=128&d=identicon&r=PG", "display_name": "Daneel Yaitskov", "link": "https://stackoverflow.com/users/342882/daneel-yaitskov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 59462155, "answer_count": 1, "score": 0, "last_activity_date": 1577179328, "creation_date": 1577138802, "question_id": 59461745, "link": "https://stackoverflow.com/questions/59461745/haskell-interpreter-cannot-infer-return-type", "title": "Haskell interpreter cannot infer return type", "body": "<p>I was trying to implement polymorphic tuple mapping and eventually wrote following snipped in GHCi:</p>\n\n<pre><code>data MaxS = MaxS\nclass Strategy action input result | input -&gt; result where  \n    work :: action -&gt; input -&gt; result\ninstance (Ord a) =&gt; Strategy MaxS (a, a, a) a where work _ (a, b, c) = max a (max b c)\nf :: (Strategy action input result) =&gt; action -&gt; input -&gt; result ; f a i = work a i\nf MaxS (1, 2, 3)   \n\n&lt;interactive&gt;:91:1: error:\n    * No instance for (Ghci13.Strategy\n                         MaxS (Integer, Integer, Integer) ())\n        arising from a use of `it'\n    * In the first argument of `print', namely `it'\n      In a stmt of an interactive GHCi command: print it\n\nf MaxS (1, 2, 3) :: Integer\n3\n</code></pre>\n\n<p>So my question is why Unit type is picked if nothing specified and how to avoid obvious return type definition.</p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "pointfree"], "comments": [{"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 5, "creation_date": 1577132602, "post_id": 59460929, "comment_id": 105102950, "body": "See <a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">pointfree.io</a> It should come up with <code>(.digitToInt).(+).(*10)</code>"}, {"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 5, "creation_date": 1577133536, "post_id": 59460929, "comment_id": 105103191, "body": "Pointfree code is often a case of &quot;just because you can doesn&#39;t mean you should&quot;. It&#39;s most useful when you have a long chain of functions with an obvious input-output pipeline. But when you start doing sections with the <code>(.)</code> operator to get things in the right places, remember that variable names were invented for a reason."}, {"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "reply_to_user": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 0, "creation_date": 1577136950, "post_id": 59460929, "comment_id": 105104018, "body": "@FrownyFrog, thank you for letting me know about this Pointfree.io site! However, it&#39;d be nice if you could write your own answer where you explain how that function composition work."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1577142767, "post_id": 59460929, "comment_id": 105105347, "body": "The fact that you do not need an explanation for <code>\\a x -&gt; a*10 + digitToInt x</code> but you do for <code>(.digitToInt).(+).(*10)</code> is a massive hint about which code to use. Point-free style can be very beautiful in many cases, but in others it quickly degenerates into obfuscation, deserving the name of point-less style. Distinguishing between the two is quite important to produce quality code."}, {"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1577143400, "post_id": 59460929, "comment_id": 105105447, "body": "I see your point, @chi; however, I&#39;m still eager to understand how the pointless-style function works in this case; not necessarily because I will use it, as I cannot deny it obfuscates the meaning of the function (at least in this  case), but because I think there&#39;s something I can learn from it, whereas there&#39;s nothing a lambda can teach but the syntax."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1577173632, "post_id": 59460929, "comment_id": 105110932, "body": "Another pointfree version of the function (which I don&#39;t recommend) would be <code>curry $ uncurry (+) . bimap (*10) digitToInt</code> using <code>bimap</code> from <code>Data.Bifunctor</code>."}], "answers": [{"comments": [{"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 1, "creation_date": 1577134768, "post_id": 59461164, "comment_id": 105103493, "body": "Does your statement about list fusion change depending on whether <code>foldl</code> or <code>foldl&#39;</code> is used?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1577135021, "post_id": 59461164, "comment_id": 105103552, "body": "I don&#39;t think so, though my understanding of list fusion is shaky. Assuming that <code>foldl</code> does benefit from list fusion, I don&#39;t think it matters if the item comes from the penultimate argument to <code>foldl</code> or from the first element of the input list."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1577134187, "creation_date": 1577134187, "answer_id": 59461164, "question_id": 59460929, "link": "https://stackoverflow.com/questions/59460929/how-to-combine-binary-and-unary-function-to-obtain-the-step-function-for-a-fold/59461164#59461164", "title": "How to combine binary and unary function to obtain the step function for a fold?", "body": "<p>It's simpler to reduce if you convert each digit to an integer <em>before</em> calling <code>foldl</code>:</p>\n\n<pre><code>asInt xs = foldl (\\a x -&gt; a*10 + x) 0 (map digitToInt xs)\n    -- == foldl ((+) . (10 *)) 0 (map digitToInt xs)\n</code></pre>\n\n<p>which you can further eta-convert to</p>\n\n<pre><code>asInt = foldl ((+) . (10 *)) 0 . map digitToInt\n</code></pre>\n\n<p>(I believe that the intermediate list that would otherwise be produced by <code>map</code> is not created, due to list fusion. The output of each call to <code>digitToInt</code> is used immediately by <code>foldl</code>, rather than placed into a list.)</p>\n"}, {"comments": [{"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1577437525, "post_id": 59494535, "comment_id": 105169609, "body": "The two chunks labelled &quot;second&quot; are an the answer for me, so I will accept it; however I&#39;d add some text to make the answer more readable for the future reader who could skip the comments where <code>curry</code> and <code>uncurry</code> are mentioned; furthermore, some words/links about <code>&lt;*&gt;</code> and <code>***</code> would be appreciated (I&#39;ve only seen <code>*</code> used as the multiplication symbol and by the output of <code>:kind</code> to display concrete types."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1577439500, "post_id": 59494535, "comment_id": 105170241, "body": "will review your edit shorty; note it&#39;s not <code>*</code> but <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-60--42--62-\" rel=\"nofollow noreferrer\"><code>&lt;*&gt;</code></a> -- the &quot;apply&quot; method of the <code>Applicative</code> type class. will also add the hackage <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Arrow.html#v:-42--42--42-\" rel=\"nofollow noreferrer\">links</a> to the answer later. thanks."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1577439617, "post_id": 59494535, "comment_id": 105170280, "body": "Hi, I <i>like</i> the parens around the lambdas, I think they help the clarity. that&#39;s just my opinion. :) So I&#39;d rather keep&#39;em."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1577439846, "post_id": 59494535, "comment_id": 105170368, "body": "the Applicative and the Arrow are <i>general</i>, abstract type classes, but used with functions, their <code>&lt;*&gt;</code> and <code>***</code> are <i>nothing more</i> than the definitions which I already include in the answer, <code>(f &lt;*&gt; g) a = (f a) (g a)</code> and <code>(f *** g) a = (f $ fst a, g $ snd a)</code>. So I just use the two operators as point-free combinators."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1577441867, "last_edit_date": 1577441867, "creation_date": 1577403881, "answer_id": 59494535, "question_id": 59460929, "link": "https://stackoverflow.com/questions/59460929/how-to-combine-binary-and-unary-function-to-obtain-the-step-function-for-a-fold/59494535#59494535", "title": "How to combine binary and unary function to obtain the step function for a fold?", "body": "<p><em>(you wanted to understand how the pointless-style functions work here, so here it is.)</em></p>\n\n<p>First.</p>\n\n<pre><code>(\\a x -&gt; a*10 + digitToInt x)\n= \n(\\a x -&gt; (+) ((*10) a) (digitToInt x))\n= \n(curry $ (+) . (*10) . fst &lt;*&gt; digitToInt . snd)\n=\n(curry $ uncurry (+) . ((*10) *** digitToInt))\n</code></pre>\n\n<p>Second.</p>\n\n<pre><code>(\\a x -&gt; a*10 + digitToInt x)\n= \n(\\a x -&gt; (+) ((*10) a) (digitToInt x))\n= \n(\\a x -&gt; ((+) . (*10)) a . digitToInt $ x)\n= \n(\\a   -&gt; ((+) . (*10)) a . digitToInt    )\n= \n(\\a   -&gt; (. digitToInt) ( ((+) . (*10)) a ) )\n= \n(\\a   -&gt; (. digitToInt) . ((+) . (*10)) $ a )\n= \n         (. digitToInt) .  (+) . (*10)\n</code></pre>\n\n<h2>How does it work</h2>\n\n<p>First.</p>\n\n<pre><code>(curry $ (+) . (*10) . fst &lt;*&gt; digitToInt . snd)  a  x\n= {-  curry f a b  =  f (a, b)                               -}\n        ((+) . (*10) . fst &lt;*&gt; digitToInt . snd) (a, x)\n= {-  (f &lt;*&gt; g) a  =  f a (g a)   ;   (f . g) a  =  f (g a)  -}\n   ((+) . (*10)) (fst (a, x)) (digitToInt ( snd  (a, x)))\n=\n   ((+) . (*10))       a      (digitToInt            x  )\n= {-  (f . g) a  =  f (g a)   ;   (`c` b) a  =  (a `c` b)    -}\n    (+)   (a*10)              (digitToInt            x  )\n= {-  (c) a b  =  (a `c` b)                                  -}\n          (a*10)            +  digitToInt            x\n</code></pre>\n\n<p>and,</p>\n\n<pre><code>(curry $ uncurry (+) . ((*10) *** digitToInt))  a  x\n= {-  curry f a b  =  f (a, b)                -}\n        (uncurry (+) . ((*10) *** digitToInt)) (a, x)\n= {-  (f *** g) a  =  (f $ fst a, g $ snd a)  -}\n         uncurry (+) (  (*10) a , digitToInt       x )\n= {-  uncurry f (a, b)  =  f a b              -}\n                 (+) (  (*10) a) (digitToInt       x )\n= {-  (`c` b) a  =  (a `c` b)                 -}\n                 (+)   (a*10)    (digitToInt       x )\n= {-  (c) a b  =  (a `c` b)                   -}\n                       (a*10)  +  digitToInt       x\n</code></pre>\n\n<p>Second.</p>\n\n<pre><code>           ((. digitToInt) . (+) . (*10)) a x\n= {-  (f . g) a  =  f (g a)     -}\n           ((. digitToInt) . (+)) ((*10) a) x\n= {-  (`c` b) a  =  (a `c` b)   -}\n           ((. digitToInt) . (+)) (a*10)    x\n= {-  (f . g) a  =  f (g a)     -}\n            (. digitToInt) ( (+)  (a*10) )  x\n= {-  (`c` b) a  =  (a `c` b)   -}\n ((+) (a*10) . digitToInt)                  x\n= {-  (f . g) a  =  f (g a)     -}\n  (+) (a*10) ( digitToInt                   x )\n= {-  (c) a b  =  (a `c` b)     -}\n      (a*10) + digitToInt                   x  \n</code></pre>\n\n<p>Another possibility is <em>partially</em> point-free,</p>\n\n<pre><code>foldl  (\\a -&gt; (a*10 +) . digitToInt)  ...\n</code></pre>\n\n<p>which is shorter than the full lambda yet still more readable than all the fully point-free versions.</p>\n"}], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 59494535, "answer_count": 2, "score": 2, "last_activity_date": 1577441867, "creation_date": 1577132445, "last_edit_date": 1577433712, "question_id": 59460929, "link": "https://stackoverflow.com/questions/59460929/how-to-combine-binary-and-unary-function-to-obtain-the-step-function-for-a-fold", "title": "How to combine binary and unary function to obtain the step function for a fold?", "body": "<p>When reading <a href=\"http://book.realworldhaskell.org/read/functional-programming.html\" rel=\"nofollow noreferrer\">Chapter 4 from Real World Haskell</a>, I solved the exercise 1, at page 97, with the following lines</p>\n\n<pre><code>asInt :: String -&gt; Int\nasInt ('-':x) = asInt x\nasInt xs = foldl (\\a x -&gt; a*10 + digitToInt x) 0 xs\n</code></pre>\n\n<p>then I have checked some comments from the linked page, and verified that this is a solution adopted by the majority.</p>\n\n<p>On the other hand, I think it would be nice to write the function not as a lambda (<code>\\a x -&gt; a*10 + digitToInt x</code>), which is so verbose and gives names to parameters (<code>a</code> and <code>x</code>) which really need not be given one, but as the \"combination\" of other functions, namely the binary functions <code>(*)</code>, <code>(+)</code>, and the unary function <code>digitToInt</code>; however I can't figure out how to combine those three in a binary function equivalent to the lambda above.</p>\n\n<p>I think the ingredients to compose are <code>(*10)</code>, the unary function that has to act on <code>foldl</code>'s accumulator, <code>digitToInt</code>, the unary function that acts on the element of the list <code>xs</code>, and <code>(+)</code>, that has to combine these two.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 0, "creation_date": 1577144550, "post_id": 59460889, "comment_id": 105105628, "body": "I&#39;m working on it at the moment and having quite a lot of fun at it, but meanwhile, I should point out that your function has an error in it. There is a one-page gap between chapters 3 and 4 (nothing on page 6)."}, {"owner": {"reputation": 301, "user_id": 2773933, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-wD8zUbBMBVI/AAAAAAAAAAI/AAAAAAAAIGs/njtrAvsaRVk/photo.jpg?sz=128", "display_name": "presci", "link": "https://stackoverflow.com/users/2773933/presci"}, "reply_to_user": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 0, "creation_date": 1577145648, "post_id": 59460889, "comment_id": 105105789, "body": "I have corrected it. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "is_accepted": true, "score": 1, "last_activity_date": 1577156305, "creation_date": 1577156305, "answer_id": 59463342, "question_id": 59460889, "link": "https://stackoverflow.com/questions/59460889/match-a-problem-number-to-page-number-in-haskell/59463342#59463342", "title": "Match a problem number to page number in haskell", "body": "<p>Spoiler: the following is a complete solution. </p>\n\n<p>First off, Haskell is a functional language, which means a lot of recursion. However, recursion is a common pattern, and one that is hard to read and reason about, and where mistakes are easy to make. This is why most recursion patterns are abstracted away in functions such as <code>foldr</code>, <code>scanr</code>, <code>length</code>, etc. In my opinion, functional programming is much easier to reason about when you think of the various data transformations as a sort of pipeline. This why there is no recursion in the following answer.</p>\n\n<p>I'll take you through the process of building this pipeline. You'll see that working this way reduces the levels of indirection to a minimum, and in the end, the algorithm can pretty much be read like a paragraph of text.</p>\n\n<hr>\n\n<p>First we start with a list representing the number of problems per chapiter, let's call it <code>dat</code>, since Haskell won't allow data:</p>\n\n<pre><code>let dat = [4, 2, 6, 1, 10]\n</code></pre>\n\n<p>Then we store the number of problems per page in variable k:</p>\n\n<pre><code>let k = 3\n</code></pre>\n\n<hr>\n\n<p>Let's start building our answer. We first want to zip the list of problem numbers with their corresponding chapter:</p>\n\n<pre><code>let step1 = zip [1..] dat\n-- [(1,4),(2,2),(3,6),(4,1),(5,10)]\n</code></pre>\n\n<p>The next thing we need is to convert the number of problems into indexes and transforming the page number into the actual number of pages taken up by the chapter:</p>\n\n<pre><code>-- We turn 4 into [1,2,3,4]\nlet step2 = map ((,) . (ceiling . (/(fromIntegral k)) . fromIntegral . snd) \n            &lt;*&gt; (take . snd &lt;*&gt; zipWith const [1..] . repeat . fst)) step1\n-- [(2,[1,2,3,4]),(1,[1,2]),(2,[1,2,3,4,5,6]),(1,[1]),(4,[1,2,3,4,5,6,7,8,9,10])]\n</code></pre>\n\n<p>We need to sprinkle a few <code>fromIntegral</code>, since <code>/</code> is defined for <code>Fractional</code>, and we had two <code>Int</code>. The two <code>&lt;*&gt;</code> you see are from the Applicative instance of <code>-&gt;</code>. It's very useful if you want to inline everything. Basically, it feeds an argument to each of two functions, then applies the first to the second (<code>f &lt;*&gt; g = (\\x -&gt; f x (g x))</code>). </p>\n\n<p>Next step is to use <code>scanl</code> to convert the page numbers into their cumulative values:</p>\n\n<pre><code>let step3 = scanl (\\(a, as) (b, bs) -&gt; (a + b, bs)) (1, []) step2\n-- [(1,[]),(3,[1,2,3,4]),(4,[1,2]),(6,[1,2,3,4,5,6]),(7,[1]),(11,[1,2,3,4,5,6,7,8,9,10])]\n-- Notice that the elements of every tuple are offset by 1.\n-- We'll fix this in the next step.\n</code></pre>\n\n<p>Let's fix this offset, still using the <code>&lt;*&gt;</code> trick to split our pipeline into two:</p>\n\n<pre><code>let step4 = zip . map fst &lt;*&gt; tail . map snd $ step3\n-- [(1,[1,2,3,4]),(3,[1,2]),(4,[1,2,3,4,5,6]),(6,[1]),(7,[1,2,3,4,5,6,7,8,9,10])]\n</code></pre>\n\n<p>Now, all we need is the first page of the chapter; we can deduce the last page from the number of questions. The function <code>chunksOf</code> from <code>Data.List.Split</code> is just what we need. It splits a list into groups of a certain length. Here, we will split the list of indexes into groups of <code>k</code> elements.</p>\n\n<pre><code>let step5 = map (\\(a, bs) -&gt; (a, zip [a..] $ chunksOf k bs)) $ step4\n-- [(1,[(1,[1,2,3]),(2,[4])]),(3,[(3,[1,2])]),(4,[(4,[1,2,3]),(5,[4,5,6])]),(6,[(6,[1])]),(7,[(7,[1,2,3]),(8,[4,5,6]),(9,[7,8,9]),(10,[10])])]\n</code></pre>\n\n<p>Hey, we're almost done now! The output of step 5 is a bit messy, but we can already see the page numbers with their corresponding indexes. All we have left is to <code>filter</code> out every question number that is equal to its page number:</p>\n\n<pre><code>let step5point5 = map (filter (\\(x, xs) -&gt; x `elem` xs) . snd) step5\n-- [[(1,[1,2,3])],[],[(5,[4,5,6])],[],[(9,[7,8,9]),(10,[10])]]\n-- Oops, looks like we needed a concatMap\nlet step6 = concatMap (filter (\\(x, xs) -&gt; x `elem` xs) . snd) step5\n-- [(1,[1,2,3]),(5,[4,5,6]),(9,[7,8,9]),(10,[10])]\n-- Much better.\n</code></pre>\n\n<p>Now, all that's left is to count the number of elements:</p>\n\n<pre><code>let step7 = length step6\n-- 4\n</code></pre>\n\n<p>The whole thing looks like this</p>\n\n<pre><code>solve k = step7 . step6 . step5 . step4 . step3 . step2 . step1\n    where step1 = zip [1..]\n          step2 = map ((,) . (ceiling . (/(fromIntegral k)) . fromIntegral . snd) \n                  &lt;*&gt; (take . snd &lt;*&gt; zipWith const [1..] . repeat . fst))\n          step3 = scanl (\\(a, as) (b, bs) -&gt; (a + b, bs)) (1, [])\n          step4 = zip . map fst &lt;*&gt; tail . map snd\n          step5 = map (\\(a, bs) -&gt; (a, zip [a..] $ chunksOf 3 bs))\n          step6 = concatMap (filter (\\(x, xs) -&gt; x `elem` xs  ) . snd)\n          step7 = length\n</code></pre>\n\n<p>As a side note, if you like working of Hackerrank, you can always look at successful answers by going to Submissions->Leaderboard->View solution.</p>\n"}, {"comments": [{"owner": {"reputation": 301, "user_id": 2773933, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-wD8zUbBMBVI/AAAAAAAAAAI/AAAAAAAAIGs/njtrAvsaRVk/photo.jpg?sz=128", "display_name": "presci", "link": "https://stackoverflow.com/users/2773933/presci"}, "edited": false, "score": 0, "creation_date": 1577174688, "post_id": 59463365, "comment_id": 105111212, "body": "Thank you so much for your time. I really appreciate"}], "tags": [], "owner": {"reputation": 1027, "user_id": 8201661, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZnbSrY_hynY/AAAAAAAAAAI/AAAAAAAAAGg/DP36j8HxldM/photo.jpg?sz=128", "display_name": "Nick", "link": "https://stackoverflow.com/users/8201661/nick"}, "is_accepted": false, "score": 2, "last_activity_date": 1577156556, "creation_date": 1577156556, "answer_id": 59463365, "question_id": 59460889, "link": "https://stackoverflow.com/questions/59460889/match-a-problem-number-to-page-number-in-haskell/59463365#59463365", "title": "Match a problem number to page number in haskell", "body": "<p>Instead of asking the question, \"what pages are used by each chapter?\", you could ask the question \"what range of problems is there on each page?\" If you came up with a data structure to answer this question, it's easy to run queries against this data structure to count how many pages contain a problem with the same number.</p>\n\n<p>Here's what the code might look like:</p>\n\n<pre><code>isInInclusiveRange :: Int -&gt; (Int, Int) -&gt; Bool\nisInInclusiveRange x (lo, hi) = lo &lt;= x &amp;&amp; x &lt;= hi\n\npages :: [Int]\npages = [1..]\n\nspecialProblemsCount :: Int -&gt; [Int] -&gt; Int\nspecialProblemsCount problemsPerPage problemsPerChapter =\n  length  (filter (\\(page, range) -&gt; isInInclusiveRange page range) (zip pages rangesOfProblems))\n  where\n    rangesOfProblemsForChapterWithThisManyProblems :: Int -&gt; [(Int, Int)]\n    rangesOfProblemsForChapterWithThisManyProblems problems = loop 1\n      where\n        {-- In this loop: lo is the lowest problem on the page (inclusive);\n            hi is the highest problem on the page (inclusive). --}\n        loop :: Int -&gt; [(Int, Int)]\n        loop lo\n          | lo &gt; problems = []\n          | otherwise =\n            let hi = min problems (lo + problemsPerPage - 1) in\n            (lo, hi) : loop (hi + 1)\n\n    rangesOfProblems :: [(Int, Int)]\n    rangesOfProblems =\n      concatMap rangesOfProblemsForChapterWithThisManyProblems problemsPerChapter\n</code></pre>\n\n<p>Here, <code>rangesOfProblems</code> is the list data structure that answers the question \"what range of problems is there on each page?\" For your example, it would look like: <code>[(1, 3), (4, 4), (1, 2), (1, 3), (4, 6), (1, 3), (4, 6), (7, 9), (9, 10)]</code>. That is, the first page has the problem range <code>(1, 3)</code> (inclusive on both ends); the second page has the problem range <code>(4, 4)</code>; etc. The trick is that <code>rangesOfProblemsForChapterThisManyProblems</code>, when given as argument the number of problems in a chapter, returns a list describing the problem ranges for each page of the chapter. <code>concatMap</code> takes the lists for each chapter and combines them into a single list, just as the bookbinder concatenates the chapters into a single book. :)</p>\n\n<p>If there's a function or pattern you don't recognize in this post, don't hesitate to add a comment.</p>\n"}], "owner": {"reputation": 301, "user_id": 2773933, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-wD8zUbBMBVI/AAAAAAAAAAI/AAAAAAAAIGs/njtrAvsaRVk/photo.jpg?sz=128", "display_name": "presci", "link": "https://stackoverflow.com/users/2773933/presci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 59463342, "answer_count": 2, "score": 0, "last_activity_date": 1577156556, "creation_date": 1577132232, "last_edit_date": 1577145742, "question_id": 59460889, "link": "https://stackoverflow.com/questions/59460889/match-a-problem-number-to-page-number-in-haskell", "title": "Match a problem number to page number in haskell", "body": "<p>I am trying to solve a hackerrank problem. <a href=\"https://www.hackerrank.com/challenges/lisa-workbook/problem\" rel=\"nofollow noreferrer\">https://www.hackerrank.com/challenges/lisa-workbook/problem</a>\nWhere I am given the list of problems in each chapter. And problems per page. As per Lisa the if the problem number matches the page number it is a special problem. Count the number of special problem in book</p>\n\n<pre><code>input : 3 [4, 2, 6, 1, 10]\noutput : 4\n</code></pre>\n\n<p>Explanation: 1st chapter has 4 problems that are split into 2 pages. 1st page has 3 problems. Problem 1 is special problem since it matches the page number i.e. 1</p>\n\n<p>Chapter 3rd, 5th problem is special since it is on fifth page.</p>\n\n<p>I created the implementation where I get the pages used by each chapter in form of tuples. I am stuck at how to match problem to page number??</p>\n\n<pre><code>import Data.List\n\nsolve::[Int] -&gt; Int -&gt;Int-&gt;Int-&gt; [(Int, Int)]\nsolve [] _ _ _= []\nsolve (x:xss) g st ed = let (a, b) = (x `div` g, x `mod` g) in\n    case b &lt;= 0  of\n        True -&gt; (st, ((st + a) - 1)): solve xss g ((st  + a) +  1) 0\n        False -&gt; (st, st + a): solve xss g (st +  a + 1)  0\n</code></pre>\n\n<pre><code>ghci&gt; solve [4,2,6,1,10] 3 1 0 \n[(1,2),(3,3),(4,5),(7,7),(8,11)]\n</code></pre>\n\n<p><a href=\"https://s3.amazonaws.com/hr-challenge-images/17892/1456473832-d122786d1e-bear_workbook.png\" rel=\"nofollow noreferrer\">Problem explanation</a></p>\n\n<p>corrected version:</p>\n\n<pre><code>solve::[Int] -&gt; Int -&gt;Int-&gt;Int-&gt; [(Int, Int)]\nsolve [] _ _ _= []\nsolve (x:xss) g st ed = let (a, b) = (x `div` g, x `mod` g) in\n    case b &gt; 0  of \n        True -&gt;  (st + 1, st + a + 1 ): solve xss g (st + a + 1) 0\n        False -&gt; (st + 1, st + a): solve xss g ( st + a) 0\n</code></pre>\n\n<pre><code>*Main&gt; solve [4, 2, 6, 1, 10] 3 0 0\n[(1,2),(3,3),(4,5),(6,6),(7,10)]\n\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1577131439, "post_id": 59460734, "comment_id": 105102624, "body": "Yes, you need recursion. Try writing the result of <code>appendList Empty l</code> (don&#39;t overthink it!), then that for <code>appendList (Entry a l1) l2</code> in terms of <code>appendList l1 l2</code>."}, {"owner": {"reputation": 301, "user_id": 11166014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b791d114e2be0517a969c57a30782a?s=128&d=identicon&r=PG&f=1", "display_name": "dps", "link": "https://stackoverflow.com/users/11166014/dps"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577131685, "post_id": 59460734, "comment_id": 105102696, "body": "I think I understood, thanks a lot !    <code>appendList (Entry a Empty) l2 = Entry a l2</code>   <code>appendList (Entry a l1) l2 = Entry a (appendList l1 l2)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1577136541, "creation_date": 1577136541, "answer_id": 59461495, "question_id": 59460734, "link": "https://stackoverflow.com/questions/59460734/concatenation-of-2-lists/59461495#59461495", "title": "Concatenation of 2 lists", "body": "<p>Based on <a href=\"https://stackoverflow.com/questions/59460734/concatenation-of-2-lists#comment105102696_59460734\">your comment</a> you solved most of the problem yourself.</p>\n\n<p>What might help (in the future) is to exhaustively take a look at all the combinations of the data constructors. Since there are here two parameters, and each such <code>List a</code> has two data constructors, we thus can write as skeleton:</p>\n\n<pre><code>appendList :: List a -&gt; List a -&gt; List a\nappendList Empty Empty = &hellip;\nappendList Empty (Entry x xs) = &hellip;\nappendList (Entry x xs) Empty = &hellip;\nappendList (Entry x xs) (Entry y ys) = &hellip;</code></pre>\n\n<p>Now we can reason over these cases. If both lists are <code>Empty</code>, then the result is an <code>Empty</code> list as well. If the first list is <code>Empty</code>, and the second is non-empty, then we return the second list. If the first list is non-empty, and the second list is empty, then we return the first list. Finally if both lists are non-empty, we make a list that will yield the first item of the first list, and recurse on the tail of the first list, and the second list.</p>\n\n<p>So we can implement this with:</p>\n\n<pre><code>appendList :: List a -&gt; List a -&gt; List a\nappendList Empty Empty = Empty\nappendList Empty (Entry x xs) = (Entry x xs)\nappendList (Entry x xs) Empty = (Entry x xs)\nappendList (Entry x xs) (Entry y ys) = (Entry x (appendList xs (Entry y ys)))</code></pre>\n\n<p>We can now compress these clauses. For example the firt two clauses can be resolved by simply returning the second list. The third and fourth clause can be compressed to <code>Entry x (AppendList xs ya)</code> where <code>ya</code> is the second parameter:</p>\n\n<pre><code>appendList :: List a -&gt; List a -&gt; List a\nappendList Empty ya = ya\nappendList (Entry x xs) ya = (Entry x (appendList xs ya))</code></pre>\n\n<p>or we can make this more compact with:</p>\n\n<pre><code>appendList :: List a -&gt; List a -&gt; List a\nappendList Empty = id\nappendList (Entry x xs) = Entry x . appendList xs</code></pre>\n"}], "owner": {"reputation": 301, "user_id": 11166014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b791d114e2be0517a969c57a30782a?s=128&d=identicon&r=PG&f=1", "display_name": "dps", "link": "https://stackoverflow.com/users/11166014/dps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 59461495, "answer_count": 1, "score": 1, "last_activity_date": 1577136541, "creation_date": 1577131287, "question_id": 59460734, "link": "https://stackoverflow.com/questions/59460734/concatenation-of-2-lists", "title": "Concatenation of 2 lists", "body": "<p>I have list type defined as<br>\n<code>data List a = Empty | Entry a (List a)</code> </p>\n\n<p>I need to write a function with signature<br>\n<code>appendList :: List a -&gt; List a -&gt; List a</code></p>\n\n<p>Looks like recursion might be useful here but I have no idea on how to use it</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "edited": false, "score": 6, "creation_date": 1577128036, "post_id": 59460159, "comment_id": 105101628, "body": "Do you have code that solves any part of this problem?  If so, please post it."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 3, "creation_date": 1577128104, "post_id": 59460159, "comment_id": 105101651, "body": "Can you think of a way to write a function that does the task for just one number? <code>f :: Int -&gt; String</code>, <code>f 100 == &quot;100&quot;</code>, <code>f 32 == &quot; 32&quot;</code>, <code>f 8 == &quot; \ufe01 8&quot;</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1577128205, "post_id": 59460159, "comment_id": 105101683, "body": "But this is not a string of length <code>n</code>, since there are spaces and some numbers have multiple digits. Can you please show what you tried?"}, {"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 0, "creation_date": 1577160600, "post_id": 59460159, "comment_id": 105107937, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/32311461/how-do-i-pad-string-representations-of-integers-in-haskell\">How do I pad string representations of integers in Haskell?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1577133045, "post_id": 59460959, "comment_id": 105103073, "body": "<code>concat (map f xs)</code> is better done in one step as <code>concatMap f xs</code>."}], "tags": [], "owner": {"reputation": 420, "user_id": 9687872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q8Nva.jpg?s=128&g=1", "display_name": "Dreana", "link": "https://stackoverflow.com/users/9687872/dreana"}, "is_accepted": true, "score": 3, "last_activity_date": 1577132624, "creation_date": 1577132624, "answer_id": 59460959, "question_id": 59460159, "link": "https://stackoverflow.com/questions/59460159/haskell-convert-an-int-into-a-string-of-length-n/59460959#59460959", "title": "Haskell: Convert an Int into a String of length n", "body": "<p>Thank you for your comments. I don\u2019t know why I didn\u2019t think of this before but now I wrote a function like Ry- suggested.</p>\n\n<pre><code>spaces i \n  | length (show i) == 1 = \u201c \u201c ++ show i ++ \u201c \u201c\n  | length (show i) == 2 = \u201c \u201c ++ show i\n  | otherwise = show i \n</code></pre>\n\n<p>I then mapped it to every element of the list and concatenated it (n is defined in the function)</p>\n\n<pre><code>function :: Int -&gt; String\nfunction n = concat (map spaces [1..n])\n</code></pre>\n"}], "owner": {"reputation": 420, "user_id": 9687872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q8Nva.jpg?s=128&g=1", "display_name": "Dreana", "link": "https://stackoverflow.com/users/9687872/dreana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "closed_date": 1577176718, "accepted_answer_id": 59460959, "answer_count": 1, "score": -1, "last_activity_date": 1577132624, "creation_date": 1577127824, "question_id": 59460159, "link": "https://stackoverflow.com/questions/59460159/haskell-convert-an-int-into-a-string-of-length-n", "closed_reason": "Duplicate", "title": "Haskell: Convert an Int into a String of length n", "body": "<p>Haskell beginner here.</p>\n\n<p>I have a list of integers [1..n] and would like to turn them into a String where every number takes up 3 spaces. Example:</p>\n\n<pre><code>[6..12] becomes\n\" 6  7  8  9 10 11 12\"\n</code></pre>\n\n<p>So a one-digit number is surrounded by 2 blanks whereas a two-digit number only has one blank in front.</p>\n\n<p>Using <strong>unwords</strong> (and <strong>show</strong> for converting the Ints to Strings) obviously only sets one blank between every number.</p>\n\n<p>Does anyone have an idea how this could be achieved?\nMany thanks for any advice.</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1577123988, "post_id": 59459466, "comment_id": 105100286, "body": "You can make use of an <code>Either Int Float</code> as return type, so <code>Parser (Either Int Float)</code>."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1577126277, "post_id": 59459466, "comment_id": 105101046, "body": "If you are returning a integer or floating point value, you&#39;ve written an evaluator (which parses in order to evaluate). A parser would return a parse tree or some such. (I know it sounds like a quibble but the distinction is useful.)"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1577126600, "last_edit_date": 1577126600, "creation_date": 1577126243, "answer_id": 59459850, "question_id": 59459466, "link": "https://stackoverflow.com/questions/59459466/parser-with-multiple-return-types/59459850#59459850", "title": "Parser with multiple return types", "body": "<p>When designing DSLs, it's very common to define a new data type representing all the different shapes values can have:</p>\n\n<pre><code>data Value\n    = I Int\n    | D Double\n    deriving (Eq, Ord, Read, Show)\n</code></pre>\n\n<p>You may want to implement some helper functions, like:</p>\n\n<pre><code>binOp :: (forall a. Num a =&gt; a -&gt; a -&gt; a) -&gt; Value -&gt; Value -&gt; Parser Value\nbinOp f (I a) (I b) = pure (I (f a b))\nbinOp f (D a) (D b) = pure (D (f a b))\nbinOp _ _ _ = fail \"oof, tried to mix Ints and Doubles\"\n</code></pre>\n\n<p>Then your <code>mulOp</code> and <code>addOp</code> implementations could call <code>binOp (*)</code> and <code>binOp (+)</code> somewhere in their implementation, for example.</p>\n\n<p>But I would consider another approach than using such helpers directly. I would propose introducing an intermediate representation for which parsing \"always succeeds\", then add a separate type-checking phase where you can throw errors about mixing ints and doubles... or do appropriate casts, or whatever your DSL wants to happen there. So:</p>\n\n<pre><code>data BinOp = Plus | Times deriving (Bounded, Enum, Eq, Ord, Read, Show)\ndata Type = Int | Double deriving (Bounded, Enum, Eq, Ord, Read, Show)\ndata DSL\n    = ILit Int\n    | DLit Double\n    | BinOp BinOp DSL DSL\n    deriving (Eq, Ord, Read, Show)\n</code></pre>\n\n<p>Then you can write things with types like</p>\n\n<pre><code>typeCheck :: DSL -&gt; These [TypeError] Type -- check for mixing\nunsafeEval :: DSL -&gt; Value -- implementation uses incomplete patterns and assumes no mixing\n\neval :: DSL -&gt; Either [TypeError] Value\neval t = case typeCheck t of\n    That _ -&gt; Right (unsafeEval t)\n    These [] _ -&gt; Right (unsafeEval t)\n    These es _ -&gt; Left es\n    This es -&gt; Left es\n</code></pre>\n\n<p>or whatever.</p>\n"}], "owner": {"reputation": 949, "user_id": 3929213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/HnYvM.png?s=128&g=1", "display_name": "mikelplhts", "link": "https://stackoverflow.com/users/3929213/mikelplhts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577126600, "creation_date": 1577123891, "last_edit_date": 1577124024, "question_id": 59459466, "link": "https://stackoverflow.com/questions/59459466/parser-with-multiple-return-types", "title": "Parser with multiple return types", "body": "<p>I have problem with parsers that can manage multiple types, e.g., the parser for arithmetic expressions. At the moment my parser takes in input only integers:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>aexpr :: Parser Int\naexpr = aterm `chainl` addOp\n\naterm :: Parser Int\naterm = afactor `chainl` mulOp\n\nafactor :: Parser Int\nafactor = parenP '(' aexpr ')'\n          &lt;|&gt;\n          do\n            s &lt;- sign \n            a &lt;- aexpr \n            return (s * a)\n          &lt;|&gt;  \n          token int_const\n</code></pre>\n\n<p>This works well for two integers, but I am introducing the float type, so the parser for arithmetic expressions can have in input two <code>Int</code>, two <code>Float</code> or two mixed types of <code>Int</code> and <code>Float</code>. The result type of the parser should be <code>Int</code> or <code>Float</code> based on the inputs (i.e., <code>Int</code> if both inputs are <code>Int</code>, <code>Float</code> otherwise).</p>\n\n<p>My question is: what is the best way to manage this? A simple way is to just manage all the inputs as <code>Float</code>, so integer values are converted into float values. But I don't like this solution: the end result will be always <code>Float</code>.</p>\n\n<p>Should I create two different parsers, i.e., one for <code>Int</code> and one for <code>Float</code>? But the two parsers would be pretty much the same.</p>\n\n<p>There is a better solution?</p>\n"}, {"tags": ["haskell", "redis"], "comments": [{"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 1, "creation_date": 1577109664, "post_id": 59456370, "comment_id": 105094324, "body": "you should pass the connection as a parameter. Hedis uses resource-pool package to avoid recreating the connections unnecessarily."}, {"owner": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "reply_to_user": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 0, "creation_date": 1577110683, "post_id": 59456370, "comment_id": 105094780, "body": "If I pass it as a parameter, how would I handle it correctly if the Redis server goes down for a moment and the connection pool throws an exception? How would I correctly restart the pool? Sorry if the questions are a bit dumb, but this is my first real functional language and I&#39;m still a beginner in Haskell."}, {"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 1, "creation_date": 1577112475, "post_id": 59456370, "comment_id": 105095566, "body": "It is not that different from other Python.  The library itself manages the connections. Therefore there is no need to manually restart the connection-pool. You just need handle exceptions thrown in a session like you would do in any other platform."}, {"owner": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "reply_to_user": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 0, "creation_date": 1577114598, "post_id": 59456370, "comment_id": 105096481, "body": "Oh, I thought after an exception the connection pool has to be restarted, that solves the problem then, thank you very much"}], "owner": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577108549, "creation_date": 1577108549, "question_id": 59456370, "link": "https://stackoverflow.com/questions/59456370/keep-a-redis-connection-alive-in-haskell", "title": "Keep a Redis connection alive in Haskell", "body": "<p>I followed the tutorials for creating a rest api with a db and Redis cache on <a href=\"https://mmhaskell.com/real-world/redis\" rel=\"nofollow noreferrer\">mmhaskell</a>. Everything works well until I use Redis for caching, then every requests takes about 1 second to complete.\n<br>\nAfter some research I found that this is probably because the connection is created anew every time I check the cache. This is done with the following method.</p>\n\n<pre><code>runRedisAction :: RedisInfo -&gt; Redis a -&gt; IO a\nrunRedisAction redisInfo action = do\n  connection &lt;- connect redisInfo\n  runRedis connection action\n</code></pre>\n\n<p>Every time a REST GET request is made I check if the requested entity is already in the cache, which means the connection is created for every request. Checking if a user is already in the cache is done like this:</p>\n\n<pre><code>fetchUserRedis :: RedisInfo -&gt; Int64 -&gt; IO (Maybe User)\nfetchUserRedis redisInfo uid = runRedisAction redisInfo $ do\n  result &lt;- Redis.get . pack . show $ uid\n  case result of\n    Right (Just userString) -&gt; return $ Just (read . unpack $ userString)\n    _ -&gt; return Nothing\n</code></pre>\n\n<p>and this is called with every GET.\n<br>\n<br>\nHow do I prevent the connection being built anew every time in Haskell, in Python for example, I could just move the connection variable to a higher scope.\n<br>\nOne way I considered was to pass the connection to the REST API when starting it in the main method, but then I would have to restart everything if the connection should for some reason disconnect.\n<br>\n<br>\nHopefully I managed to clearly state the problem, feel free to ask if you need any more information :)\n<br>\n<br>\n<br>\nPS: I use Servant for the Rest API, a locally installed Postgresql DB and Hedis as my Redis library</p>\n"}, {"tags": ["haskell", "types", "proof", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1577126836, "post_id": 59456879, "comment_id": 105101218, "body": "You don&#39;t use the <code>SList c</code> anywhere, btw."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1577127873, "post_id": 59456879, "comment_id": 105101574, "body": "...although after playing with an alternate solution a bit: perhaps <code>SList c</code> (or even <code>slist c</code>) makes avoiding ambiguities easier for callers!"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 3, "creation_date": 1577127999, "post_id": 59456879, "comment_id": 105101620, "body": "There is one small issue: you can&#39;t construct <code>SList [Void]</code> (with the usual definition of <code>Sing Void</code> present in the <code>singletons</code> package). I would suggest changing the second constructor to use a <code>Proxy x</code> instead of <code>Sing x</code>"}, {"owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1577128023, "post_id": 59456879, "comment_id": 105101623, "body": "@DanielWagner yes, technically we can get rid of it, but in practice it just means replacing it with lots of <code>ScopedTypeVariables</code> and <code>TypeApplications</code> usage."}], "tags": [], "owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "is_accepted": true, "score": 5, "last_activity_date": 1577110891, "creation_date": 1577110891, "answer_id": 59456879, "question_id": 59455253, "link": "https://stackoverflow.com/questions/59455253/how-do-i-prove-type-level-list-properties-in-haskell/59456879#59456879", "title": "How do I prove type-level list properties in haskell?", "body": "<p>Okay, so your type families are fine and your property is almost right.</p>\n\n<p>What you want to prove is this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>proof :: Drop (Length a) (a ++ c) :~: c\n</code></pre>\n\n<p>Except you don't really know what <code>a</code> and <code>c</code> are. They are implicitly quantified. You want them to be explicit so we can do induction over them.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>proof :: (a :: [ k ]) -&gt; (c :: [ k ]) -&gt; Drop (Length a) (a ++ c) :~: c\n</code></pre>\n\n<p>You'll realise this is not going to type check because Haskell doesn't have real dependent types, but there is a way around: <em>singleton types</em>. The idea is to create an indexed type so that each term corresponds to one term of a different type that is used as the type index. I know this sounds a bit confusing, but example should clarify it. </p>\n\n<p>You can use the <code>singletons</code> library or build them from scratch that's what I'll do here.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data family Sing (x :: k)\n\ndata SList xs where\n  SNil  :: SList '[]\n  SCons :: Sing x -&gt; SList xs -&gt; SList (x ': xs)\n\n</code></pre>\n\n<p>Here <code>Sing</code> is a data family so that I can generically refer to things that have singletons. <code>SList</code> is the singleton version of the list type and as you can see the <code>SNil</code> constructor corresponds to the type-level <code>[]</code>. Similarly, <code>SCons</code> reflects <code>:</code>.</p>\n\n<p>Then (assuming you also have a definition of <code>data Nat = O | S Nat</code> somewhere) the signature of the proof you are after is</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>proof :: SList a -&gt; SList c -&gt; Drop (Length a) (a ++ c) :~: c\n</code></pre>\n\n<p>Notice that I changed your <code>~</code> into a <code>:~:</code> that's a type operator available in <code>Data.Type.Equality</code>. It's only constructor is <code>Refl</code> which you can only assert if its two operands are exactly the same.</p>\n\n<p>Now we just need to prove it. Luckily, this is a super simple property to prove, you just need to do induction over <code>SList a</code></p>\n\n<p>In the base case <code>SList a</code> is <code>SNil</code>, so you are really trying to prove <code>Drop (Length '[]) ('[] '++ c) :~: c</code>. Because you used type families, the type checker will immediately reduce this to <code>c :~: c</code>. Since both operands are the same we can use the <code>Refl</code> constructor to prove this case.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>proof SNil _ = Refl\n</code></pre>\n\n<p>Now comes the inductive case. We'll pattern match again and this time learn that <code>SList a</code> is of the form <code>SCons a as</code> with <code>a :: Sing x</code> and <code>as :: Sing xs</code>. This means what we need to prove is <code>Drop (Length (x ': xs)) ((x : xs) ++ c) :~: c</code>. Again your type families will immediately start doing computation and reduce this goal to <code>Drop (Length xs) (xs ++ c) :~: c</code> because it doesn't really need to know what <code>x</code> is to do the evaluation.</p>\n\n<p>As it turns out, <code>proof as c</code> (nb. I use <code>as</code> instead of <code>SCons a as</code>) has exactly the required type, so we use that to prove the property.</p>\n\n<p>Here's the full proof.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>proof :: SList a -&gt; SList c -&gt; Drop (Length a) (a ++ c) :~: c\nproof SNil _ = Refl\nproof (SCons a as) cs = proof as cs\n</code></pre>\n\n<p>For these to work, you'll need all of these language extensions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE KindSignatures #-}\n</code></pre>\n"}], "owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 59456879, "answer_count": 1, "score": 5, "last_activity_date": 1577110891, "creation_date": 1577103516, "last_edit_date": 1577110109, "question_id": 59455253, "link": "https://stackoverflow.com/questions/59455253/how-do-i-prove-type-level-list-properties-in-haskell", "title": "How do I prove type-level list properties in haskell?", "body": "<p>I have these type families:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type family xs ++ ys where\n  '[]      ++ ys = ys\n  (x : xs) ++ ys = x : (xs ++ ys)\n\ntype family Drop n xs where\n  Drop  O         xs  = xs\n  Drop (S n) (_ : xs) = Drop n xs\n\ntype family Length xs where\n  Length '[] = O\n  Length  (x : xs) = S (Length xs)\n</code></pre>\n\n<p>At some point, GHC wants a proof that</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>forall a. Drop (Length a) (a ++ c) ~ c\n</code></pre>\n\n<p>I've used to shove that into context of some constructor.</p>\n\n<p>How do I prove this property universally?</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1577095212, "post_id": 59453184, "comment_id": 105088322, "body": "use <code>type</code> instead of <code>newtype</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1577095919, "post_id": 59453184, "comment_id": 105088630, "body": "You are not using <code>newtype</code> correctly.  It&#39;s worth reading about <code>newtype</code> (and its big brother <code>data</code>)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1577097290, "post_id": 59453184, "comment_id": 105089191, "body": "@Li-yaoXia We can&#39;t use <code>type</code> recursively. He needs to use a <code>newtype</code>, but in the correct way."}], "answers": [{"comments": [{"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 0, "creation_date": 1577541700, "post_id": 59453697, "comment_id": 105194883, "body": "so it basically was a syntactical error on my part, oh my dear... thank you!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1577097375, "last_edit_date": 1577097375, "creation_date": 1577096869, "answer_id": 59453697, "question_id": 59453184, "link": "https://stackoverflow.com/questions/59453184/recursive-parser-in-haskell/59453697#59453697", "title": "Recursive Parser in Haskell", "body": "<p>This is wrong:</p>\n\n<pre><code>newtype RecursiveParser = MyParsec (SomeResult, RecursiveParser)\n</code></pre>\n\n<p>Above, <code>MyParsec</code> is the name of a new data constructor, which is completely unrelated to the <code>MyParser</code> type constructor. Essentially, the above definition defines <code>RecursiveParser</code> to be a pair <code>(SomeResult, RecursiveParser)</code>, wrapped under the new constructor <code>MyParsec</code>.</p>\n\n<p>Recall the <code>newtype</code> syntax is</p>\n\n<pre><code>newtype NewtypeName = NewConstructorName SomeType\n</code></pre>\n\n<p>To actually use the <code>MyParsec (...)</code> type, you need to specify the name of the constructor as follows. It is customary to name it using the same name as the <code>newtype</code> itself.</p>\n\n<pre><code>newtype RecursiveParser = RecursiveParser (MyParsec (SomeResult, RecursiveParser))\n</code></pre>\n\n<p>Then, you can adapt your code so to remove the wrapper data constructor.</p>\n\n<pre><code>items :: RecursiveParser -&gt; MyParsec [SomeResult]\nitems (RecursiveParser prefixParser) = do\n  (someResult, newPrefixParser) &lt;- prefixParser\n  rst &lt;- items newPrefixParser\n  return (someResult : rst)\n</code></pre>\n"}], "owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 59453697, "answer_count": 1, "score": 1, "last_activity_date": 1577111500, "creation_date": 1577094596, "last_edit_date": 1577111500, "question_id": 59453184, "link": "https://stackoverflow.com/questions/59453184/recursive-parser-in-haskell", "title": "Recursive Parser in Haskell", "body": "<p>I'm writing a parser in Haskell, and one of the parsing functions (<code>prefixParser</code>) should return a modified version of itself on every call. The code here is simplified, but I hope every necessary bit of information is included.</p>\n\n<pre><code>type MyParsec r = Parsec [Char] () Identity r\n\nnewtype SomeResult = String\n\nnewtype RecursiveParser = MyParsec (SomeResult, RecursiveParser)\n\nitems :: RecursiveParser -&gt; MyParsec [SomeResult]\nitems prefixParser = do\n  (someResult, newPrefixParser) &lt;- prefixParser\n  rst &lt;- items newPrefixParser\n  return (someResult : rst)\n</code></pre>\n\n<p>Now the trouble is that <code>prefixParser</code>'s type is <code>RecursiveParser</code> but I call it inside a <code>do</code> block that expects a <code>MyParsec</code>. Ergo I get a </p>\n\n<blockquote>\n  <p>Couldn't match expected type</p>\n</blockquote>\n\n<p>error. Can I even do something like this or am I (as usual) not quite getting Haskell's type system?</p>\n\n<p>(The <code>prefixParser</code> is meant to parse an incrementing number <code>[1. 2. 3. ...]</code>, and as of yet not implemented.)</p>\n"}, {"tags": ["haskell", "higher-kinded-types", "type-variables"], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 7, "last_activity_date": 1577070303, "last_edit_date": 1577070303, "creation_date": 1577069699, "answer_id": 59449704, "question_id": 59449596, "link": "https://stackoverflow.com/questions/59449596/higher-kinded-types-as-type-variables-in-haskell/59449704#59449704", "title": "Higher kinded types as type variables in Haskell", "body": "<p>You cannot make an instance of this <code>Coordinate</code> class for the built-in pair type. You need to change one of them.</p>\n\n<ul>\n<li><p>The <code>Coordinate</code> class can be changed to take a normal <code>Type</code> as argument:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, TypeFamilies #-}\n\nimport Data.Kind (Type)\n\nclass Num (Component c) =&gt; Coordinate c where\n    type Component c :: Type -- every Coordinate type has a Component type\n    rotate :: Quaternion (Component c) -&gt; c -&gt; c\n    translate :: V3 (Component c) -&gt; c -&gt; c\n</code></pre>\n\n<p>E.g the <code>V3</code> instance will now look like</p>\n\n<pre><code>instance Num a =&gt; Coordinate (V3 a) where\n    type Component (V3 a) = a\n    rotate _ = id\n    translate = (+)\n</code></pre>\n\n<p>And the pair instance will use an equality constraint, which is the thing you were looking for</p>\n\n<pre><code>instance (Coordinate a, Coordinate b, Component a ~ Component b) =&gt; Coordinate (a, b) where\n    type Component (a, b) = Component a -- or = Component b\n    rotate p (l, r) = (rotate p l, rotate p r)\n    translate p (l, r) = (translate p l, translate p r)\n</code></pre></li>\n<li><p>Instead of pairs, use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Product.html#t:Product\" rel=\"noreferrer\"><code>Product</code></a>:</p>\n\n<pre><code>import Data.Functor.Product\n\ninstance (Coordinate a, Coordinate b) =&gt; Coordinate (Product a b) where\n    rotate p (Pair l r) = Pair (rotate p l) (rotate p r)\n    translate p (Pair l r) = Pair (translate p l) (translate p r)\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 131, "user_id": 9663052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c5e77edc1e34cdb3eb39ca0b5a8854a?s=128&d=identicon&r=PG&f=1", "display_name": "notBob", "link": "https://stackoverflow.com/users/9663052/notbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 59449704, "answer_count": 1, "score": 6, "last_activity_date": 1578329719, "creation_date": 1577068293, "last_edit_date": 1578329719, "question_id": 59449596, "link": "https://stackoverflow.com/questions/59449596/higher-kinded-types-as-type-variables-in-haskell", "title": "Higher kinded types as type variables in Haskell", "body": "<p>I have a class:</p>\n\n<pre><code>import Linear\n\nclass Coordinate c where\n    rotate :: Num a =&gt; Quaternion a -&gt; c a -&gt; c a\n    translate :: Num a =&gt; V3 a -&gt; c a -&gt; c a\n</code></pre>\n\n<p>, for which I have defined the instances</p>\n\n<pre><code>instance Coordinate V3 where\n    rotate _ = id\n    translate p = (p+)\n\ninstance Coordinate Quaternion where\n    rotate o = (o*)\n    translate _ = id\n</code></pre>\n\n<p>Now I want to define an instance for a pair of members of the class.</p>\n\n<pre><code>instance (Coordinate a, Coordinate b) =&gt; Coordinate (a, b) where\n    rotate o (a, b) = (rotate o a, rotate o b)\n    translate p (a, b) = (translate p a, translate p b)\n</code></pre>\n\n<p>The problem is that this does not work, since the compiler expects an argument for <code>a</code> and <code>b</code>. However adding a type-constraint like </p>\n\n<pre><code>instance (Coordinate a, Coordinate b, Num c) =&gt; Coordinate (a c, b c) where\n    move p (a, b) = (move p a, move p b)\n    translate p (a, b) = (translate p a, translate p b)\n</code></pre>\n\n<p>It does not work either, since this results in an expression with the kind <code>*</code> rather than  <code>* -&gt; *</code>. I can see how both of the above are incorrect, but I am unsure of how to solve this. I suppose there should be some form of constraint that keeps the <code>Num</code> types for both <code>a</code>and <code>b</code> the same, but I don't know what that would look like syntactically.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1577061276, "post_id": 59448802, "comment_id": 105080867, "body": "It has to be pointed out that &quot;Hask&quot; is a somewhat informal notion we use which is not completely rigorous. For instance if a Hask morphism is a &quot;Haskell function&quot;... what is that, exactly? Terms up to beta-ets equivalence? Denotational equivalence? Under which semantics? And so on. Andrej Bauer <a href=\"http://math.andrej.com/2016/08/06/hask-is-not-a-category/\" rel=\"nofollow noreferrer\">posted a rather provocative article on the not-so-well-defined Hask</a>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1577058939, "creation_date": 1577058939, "answer_id": 59448934, "question_id": 59448802, "link": "https://stackoverflow.com/questions/59448802/what-is-the-purpose-of-defining-hask/59448934#59448934", "title": "What is the purpose of defining Hask?", "body": "<p>The reason to do that is not so much to talk about <strong>Hask</strong> itself.</p>\n\n<p>Many things we do talk about a lot \u2013 functors, monads, natural transformations... \u2013 aren't programming-specific let alone Haskell-specific, but come from maths \u2013 from category theory. Now, in maths, if you say \u201c<em>F</em> is a functor\u201d people will first ask \u201ca functor <em>between which categories</em>?\u201d In practice mathematicians might e.g. <a href=\"https://en.wikipedia.org/wiki/Singular_homology\" rel=\"noreferrer\">consider functors from the category of topological spaces to the category of abelian groups</a>. Such a functor is quite a different beast from the kind of functors we're using in Haskell; yet it shares the very general properties of the \u201c<a href=\"https://en.wikipedia.org/wiki/Abstract_nonsense\" rel=\"noreferrer\">abstract nonsense</a>\u201d category theory.</p>\n\n<p>To apply the maths rigorously to what we want to do in Haskell, we need to be explicit, and that's where the term <strong>Hask</strong> comes in:</p>\n\n<blockquote>\n  <p>Haskell functors are functors from the category <strong>Hask</strong> to itself.</p>\n</blockquote>\n\n<p>You could of course \u201cinline\u201d the definition of <strong>Hask</strong> here</p>\n\n<blockquote>\n  <p>Haskell functors are functors from the category of Haskell types (with Haskell functions as morphisms) onto itself.</p>\n</blockquote>\n\n<p>but that would get cumbersome quickly.</p>\n"}], "owner": {"reputation": 24134, "user_id": 179081, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/TJ9hg.png?s=128&g=1", "display_name": "Lyndon White", "link": "https://stackoverflow.com/users/179081/lyndon-white"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 59448934, "answer_count": 1, "score": 7, "last_activity_date": 1577058939, "creation_date": 1577057352, "question_id": 59448802, "link": "https://stackoverflow.com/questions/59448802/what-is-the-purpose-of-defining-hask", "title": "What is the purpose of defining Hask?", "body": "<p>Occasionally I will see reference to <a href=\"https://wiki.haskell.org/Hask\" rel=\"noreferrer\"><strong>Hask</strong></a>.</p>\n\n<p>Which is described as:</p>\n\n<blockquote>\n  <p>Hask is the category of Haskell types and functions.</p>\n</blockquote>\n\n<p>Which is a fair enough thing to try to define. If one likes to try and find ways to describe things.\nBut generally when doing so one hopes to gain particular insights in the nature of the thing, or otherwise produce something from it.</p>\n\n<ul>\n<li>What is the purpose of defining Hask?</li>\n<li>Are there good examples of insights gained from this?</li>\n<li>Does it just serve as a way to talk about certain things that would otherwise be hard to concisely define?</li>\n</ul>\n"}, {"tags": ["haskell", "io", "gloss"], "owner": {"reputation": 21, "user_id": 12439302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e620fdac07279b820987389a11dbdf5?s=128&d=identicon&r=PG&f=1", "display_name": "Karlofsky", "link": "https://stackoverflow.com/users/12439302/karlofsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1577056030, "creation_date": 1577052792, "last_edit_date": 1577056030, "question_id": 59448395, "link": "https://stackoverflow.com/questions/59448395/how-to-exit-gloss-on-a-playio-step-event", "title": "How to exit Gloss on a playIO step event?", "body": "<p>So i've been trying for a while to find something on Gloss that i can substitute for state so when state is 2, Gloss would exit. (I'm using Graphics.Gloss.Interface.Pure.Game) </p>\n\n<p>I know of exitWith but not sure how to use it in this case, any suggestions are appreciated.</p>\n\n<pre><code>...\nstep :: Int -&gt; Int\nstep (EventKey (SpecialKey KeyEnter) Down _ _) state | state == 0 = state + 1 \n                                                     | state == 1 = state + 2                                                      \n                                                     | state == 2 = ?\n...\nmain :: IO ()\nmain = do play janela                 \n               white                \n               60                       \n               0\n               drawstate      \n               step               \n               time     \n</code></pre>\n"}, {"tags": ["haskell", "ghc", "hint"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577055568, "post_id": 59446654, "comment_id": 105079916, "body": "Can you show us the program you\u2019re trying to run using Hint? It may be that the error is in there rather than your main program."}, {"owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577068531, "post_id": 59446654, "comment_id": 105081824, "body": "@bradrn: edited to include the two referenced files."}, {"owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577068691, "post_id": 59446654, "comment_id": 105081848, "body": "I should clarify that the code presented is <i>supposed to be</i> a proof-of-concept for a <i>different</i> question I&#39;m struggling with relating to Polysemey."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577078593, "post_id": 59446654, "comment_id": 105083276, "body": "Have you checked that <code>UserProvided.hs</code> compiles on its own? Hint may just be reporting a compilation error."}, {"owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577110590, "post_id": 59446654, "comment_id": 105094736, "body": "UserProvided.hs is not a proper program or module; it&#39;s a snippet that&#39;s supposed to represent a value of type <code>MyEffect</code>. So I can&#39;t really &quot;compile&quot; it, but I can copy-paste it into GHCi with Effects loaded, and that works. I can even &quot;run&quot; it if I also import Polysemy!"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577137872, "post_id": 59446654, "comment_id": 105104245, "body": "I know that. What I was wondering is: <i>if</i> you put that snippet into its own module, and import the necessary modules, does that compile?"}, {"owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577144383, "post_id": 59446654, "comment_id": 105105603, "body": "I see. Yes: If I inline it in Main, wrapped in parentheses and indented with an explicit type-declaration as <code>E.MyEffect</code>, it works as expected."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1577162262, "post_id": 59446654, "comment_id": 105108209, "body": "Thanks @ShapeOfMatter! Then that can\u2019t be the problem. I\u2019ll have a closer look at the code and see if I can spot anything."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1577166938, "post_id": 59446654, "comment_id": 105109108, "body": "I\u2019ve just discovered something very interesting: simply doing <code>H.interpret &quot;pure ()&quot; (H.as :: Sem &#39;[Embed IO] ())</code> is enough to trigger the error! But I still don\u2019t know what that error indicates, or how to fix it\u2026"}], "owner": {"reputation": 668, "user_id": 10135377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f76366adbcfba903266a9d86362771e?s=128&d=identicon&r=PG&f=1", "display_name": "ShapeOfMatter", "link": "https://stackoverflow.com/users/10135377/shapeofmatter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1577413809, "creation_date": 1577036812, "last_edit_date": 1592644375, "question_id": 59446654, "link": "https://stackoverflow.com/questions/59446654/debug-ghc-compilation-error-returned-at-runtime-by-hints-language-haskell-inte", "title": "Debug GHC compilation error returned at runtime by hint&#39;s `Language.Haskell.Interpreter.runInterpreter`", "body": "<h2><a href=\"https://stackoverflow.com/questions/59495357/hint-interpret-gives-a-compiler-error-when-used-on-a-polysemy-sem-value\">I've re-posted this question to focus more tightly on the specific error, and to better enumerate what I've already tried.</a></h2>\n<p>I'm trying to parse some Haskell code during the runtime of a Haskell program using the <a href=\"https://hackage.haskell.org/package/hint-0.9.0.2\" rel=\"nofollow noreferrer\">hint package</a>.</p>\n<p>The outer program compiles, but when I run it the inner compilation step fails. I'm getting a description of what I assume is a syntax problem, and a location in the &quot;interactive&quot; code, but I have no idea how to view the code in question.</p>\n<p>Here's Main.hs</p>\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\nimport Data.List (intercalate)\nimport Polysemy (runM)\nimport qualified Language.Haskell.Interpreter as H\n\nimport qualified Effects as E\n\nhandleFailures :: Either H.InterpreterError a -&gt; IO a\nhandleFailures (Left l) = ioError $ userError $ message l\n  where\n    message (H.WontCompile es) = intercalate &quot;\\n&quot; (header : map unbox es)\n    message e = show e\n    header = &quot;ERROR: Won't compile:&quot;\n    unbox (H.GhcError e) = e\nhandleFailures (Right a) = return a\n\ninterpretation :: String -&gt; H.Interpreter E.MyEffect\ninterpretation s = do\n  H.loadModules [&quot;Effects&quot;]\n  H.setImportsQ [(&quot;Prelude&quot;, Nothing), (&quot;Effects&quot;, Nothing)]\n  effect &lt;- H.interpret s (H.as :: E.MyEffect)\n  return effect\n\nextractProgram :: String -&gt; IO E.MyEffect\nextractProgram s = do\n  p &lt;- H.runInterpreter $ interpretation s\n  success &lt;- handleFailures p\n  return success\n\nmain :: IO ()\nmain = do\n  userProvided &lt;- readFile &quot;UserProvided.hs&quot;\n  userProgram &lt;- extractProgram userProvided\n  runM . E.teletypeToIO . E.teletypePlusToIO $ userProgram\n</code></pre>\n<p>Effects.hs defines and provides helpers for a Polysemey <code>Sem</code> monad called <code>MyEffect</code>.</p>\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE LambdaCase, BlockArguments #-}\n{-# LANGUAGE GADTs, FlexibleContexts, TypeOperators, DataKinds, PolyKinds, ScopedTypeVariables #-}\n\nmodule Effects where\n\nimport Polysemy\n\ndata Teletype m a where\n  ReadTTY  :: Teletype m String\n  WriteTTY :: String -&gt; Teletype m ()\n\nmakeSem ''Teletype\n\nteletypeToIO :: Member (Embed IO) r =&gt; Sem (Teletype ': r) a -&gt; Sem r a\nteletypeToIO = interpret $ \\case\n  ReadTTY      -&gt; embed getLine\n  WriteTTY msg -&gt; embed $ putStrLn msg\n\ndata TeletypePlus m a where\n  ReadPlus  :: TeletypePlus m String\n  WritePlus :: String -&gt; TeletypePlus m ()\n\nmakeSem ''TeletypePlus\n\nteletypePlusToIO :: Member (Embed IO) r =&gt; Sem (TeletypePlus ': r) a -&gt; Sem r a\nteletypePlusToIO = interpret $ \\case\n  ReadPlus      -&gt; embed $ (&quot;+&quot; &lt;&gt;) &lt;$&gt; getLine\n  WritePlus msg -&gt; embed $ putStrLn $ msg &lt;&gt; &quot;+&quot;\n\ntype MyEffect = Sem [TeletypePlus, Teletype, Embed IO] ()\n</code></pre>\n<p>UserProvided.hs contains a simple <code>do</code> expression in <code>MyEffect</code>.</p>\n<pre class=\"lang-hs prettyprint-override\"><code>do\n  i &lt;- readTTY\n  j &lt;- readPlus\n  let k = i &lt;&gt; j\n  writeTTY k\n  writePlus k \n</code></pre>\n<p>In order to get the polysemy package available at runtime, I have to enter run it from inside a cabal sandbox.</p>\n<pre><code>$ cabal build\n    Build profile: -w ghc-8.8.1 -O1\n    In order, the following will be built (use -v for more details):\n     - Hello-Polysemy-0.1.0.0 (exe:Hello-Polysemy) (file Main.hs changed)\n    Preprocessing executable 'Hello-Polysemy' for Hello-Polysemy-0.1.0.0..\n    Building executable 'Hello-Polysemy' for Hello-Polysemy-0.1.0.0..\n    [2 of 2] Compiling Main             ( Main.hs, /home/mako/Git/Hello-Polysemy/dist-newstyle/buil/x86_64-linux/ghc-8.8.1/Hello-Polysemy-0.1.0.0/x/Hello-Polysemy/build/Hello-Polysemy/Hello-Polysemy-tmp/Main.o )\n    Linking /home/mako/Git/Hello-Polysemy/dist-newstyle/build/x86_64-linux/ghc-8.8.1/Hello-Polysemy-0.1.0.0/x/Hello-Polysemy/build/Hello-Polysemy/Hello-Polysemy ...\n$ cabal exec bash\n</code></pre>\n<p>... but then ...</p>\n<pre><code>$ cabal run\n    Up to date\n    Hello-Polysemy: user error (ERROR: Won't compile:\n    &lt;interactive&gt;:10:135: error:\n        Operator applied to too few arguments: :)\n</code></pre>\n<p>So far as I can tell the <em>only</em> place I'm using the <code>:</code> operator is in Effects.hs, where (a) I'm actually using the type-operator <code>':</code>, and (b) compilation succeeds just fine when Effects is imported into Main.hs.</p>\n<p>Any suggestions for what the problem might be, or how I could learn more?</p>\n<p>I already tried using <code>Language.Haskell.Interpreter.Unsafe.unsafeRunInterpreterWithArgs [&quot;-v4&quot;]</code>. That clarifies that it's talking about <code>ghc-prim:GHC.Types.:{(w) d 66})</code>, but I don't know what to do with that information.</p>\n<h3>Update:</h3>\n<p>I've tried various permutations of in-lining the &quot;userProvided&quot; code.<br />\ndeclaring the exact same <code>Effect</code> value inline in Main works fine. Replacing the string read from the file with an inline string of an even simpler value <code>&quot;writePlus \\&quot;asdf\\&quot;&quot;</code> doesn't change the error message.</p>\n"}, {"tags": ["unit-testing", "haskell", "error-handling", "monads"], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 7330813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0294fe5f7d94f3b03e97f4153e4c373f?s=128&d=identicon&r=PG", "display_name": "Kaan E.", "link": "https://stackoverflow.com/users/7330813/kaan-e"}, "edited": false, "score": 0, "creation_date": 1577040191, "post_id": 59446942, "comment_id": 105076821, "body": "I think I do, because I have 2 other data types that are read from a string based on overlapping conditions. I am controlling their production with functions like <code>makeModelIdM :: (Monad m) =&gt; String -&gt; m ModelId </code>. I am not sure if it is the best approach though. Should I try testing <code>makeModelId</code> instead ?"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1577038860, "creation_date": 1577038860, "answer_id": 59446942, "question_id": 59445776, "link": "https://stackoverflow.com/questions/59445776/test-haskell-io-for-custom-data-type/59446942#59446942", "title": "test haskell io for custom data type", "body": "<p>(This is more of a comment, but might be an answer as well.)</p>\n\n<p>Are you sure you need a second type class? The definition of <code>fromStringM</code> doesn't rely on the <code>StringLike2Primitive</code> instance so much as it simply wraps it.</p>\n\n<pre><code>fromStringM :: (Monad m, StringLike2Primitive a) =&gt; String -&gt; m a\nfromStringM a\n  | null a = fail \"empty string is not allowed\"\n  | not (isAlphaNumStr aStr) = fail \"Only ascii alphanumeric strings are allowed\"\n  | not (isAsciiStr aStr) = fail \"Only ascii strings are allowed\"\n  | otherwise = return $ fromString a\n</code></pre>\n\n<p>and likewise for <code>fromText</code>.</p>\n"}], "owner": {"reputation": 415, "user_id": 7330813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0294fe5f7d94f3b03e97f4153e4c373f?s=128&d=identicon&r=PG", "display_name": "Kaan E.", "link": "https://stackoverflow.com/users/7330813/kaan-e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577072303, "creation_date": 1577030261, "last_edit_date": 1577072303, "question_id": 59445776, "link": "https://stackoverflow.com/questions/59445776/test-haskell-io-for-custom-data-type", "title": "test haskell io for custom data type", "body": "<p><strong>Update</strong>: I noticed that there was a problem in the design of my code. The overall structure of my code has changed so much that any answer to this question would be more or less irrelevant to its current state. But SO says it's better not to delete an answered question, so I am keeping the question.</p>\n\n<p>The problem with my code was that typeclasses were too generic for what I wanted to do. Now I concentrate on writting functions like </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>makeModelId :: String -&gt; Either StringValueError ModelId\n</code></pre>\n\n<p>Then extend that with something like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>makeModelIdM :: (Monad m) =&gt; String -&gt; m (Either StringValueError ModelId)\nmakeModelIdM astr = do\n  idstr &lt;- astr\n  return (makeModelId idstr)\n</code></pre>\n\n<p>I am not sure if it is the best approach though..</p>\n\n<hr>\n\n<p>I know that there are lots of similar questions to this like <a href=\"https://stackoverflow.com/questions/1655067/haskell-io-testing\">this</a> or <a href=\"https://stackoverflow.com/questions/34168538/haskell-unit-tests-using-io-monad\">this</a> or <a href=\"https://stackoverflow.com/questions/7370073/testing-functions-in-haskell-that-do-io\">this</a>, and as far I understood what I want to do can be achieved with <code>HUnit</code>. But I can't seem to find the exact way of doing it. </p>\n\n<p>I basically have a setter typeclass which is  </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class StringLike2Primitive model where\n    fromString :: String -&gt; model\n    fromText :: Text -&gt; model\n    fromText aText = fromString (unpack aText)\n\nclass (StringLike2Primitive model) =&gt; StringLike2PrimitiveM model where\n    fromStringM :: (MonadPlus m) =&gt; String -&gt; m model\n    fromTextM :: (MonadPlus m) =&gt; Text -&gt; m model\n    fromStringM astr =  return (fromString astr)\n    fromTextM aText = fromStringM (unpack aText)\n\n</code></pre>\n\n<p>And I have couple of data types which implement these typeclasses, for example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance StringLike2Primitive ModelId where\n    fromString = StringIdCons\n\ninstance StringLike2PrimitiveM ModelId where\n    fromStringM aStr\n        | null aStr = fail \"empty string is not allowed as id\"\n        | not (isAlphaNumStr aStr) = fail\n            \"Only ascii alphanumeric strings are allowed\"\n        | not (isAsciiStr aStr) = fail\n            \"Only ascii alphanumeric strings are allowed\"\n</code></pre>\n\n<p>I am not sure how can I test <code>fromStringM</code> function against guarded values in a unit test environment, and I think my approach to error handling is problematic. Any tips would be appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1577023078, "post_id": 59444382, "comment_id": 105072432, "body": "What do you think the type of the <code>search</code> function should be?"}, {"owner": {"reputation": 21, "user_id": 12579600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b6386a866bb265b420d5cb22932315e?s=128&d=identicon&r=PG&f=1", "display_name": "Tomyy93", "link": "https://stackoverflow.com/users/12579600/tomyy93"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1577023222, "post_id": 59444382, "comment_id": 105072473, "body": "I think its should be search :: (Movie -&gt; Bool) -&gt; [Movie] -&gt; [Movie]"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1577023893, "post_id": 59444382, "comment_id": 105072644, "body": "Ok great, can you edit your question to try to write a little bit about what you\u2019ve tried and why it didn\u2019t work. Or maybe if you have some ideas about how the solution might work. Or perhaps you just don\u2019t know where to start and want some hints?"}, {"owner": {"reputation": 21, "user_id": 12579600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b6386a866bb265b420d5cb22932315e?s=128&d=identicon&r=PG&f=1", "display_name": "Tomyy93", "link": "https://stackoverflow.com/users/12579600/tomyy93"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1577024286, "post_id": 59444382, "comment_id": 105072730, "body": "im actually dont really know how to start i dont really understand how can i go through in the maded movies list and search it by the criteria director and return the value, i tried the look at the lookup fuction."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1577024449, "post_id": 59444382, "comment_id": 105072762, "body": "It sounds like you need <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\">filter</a>..."}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 1, "last_activity_date": 1577025015, "creation_date": 1577025015, "answer_id": 59445104, "question_id": 59444382, "link": "https://stackoverflow.com/questions/59444382/haskell-movies-search/59445104#59445104", "title": "Haskell movies search", "body": "<p>Ok so it seems you\u2019re on the right track. You have an idea for the type of the search function so let\u2019s write that down:</p>\n\n<pre><code>search :: (Movie -&gt; Bool) -&gt; [Movie] -&gt; [Movie]\n</code></pre>\n\n<p>Let\u2019s try to figure this out from first principles.</p>\n\n<p>The first argument is a function. Let\u2019s call it <code>p</code> for <em>predicate</em>. There isn\u2019t much we can do with this function. The most obvious thing would be to apply it to a movie but so far we haven\u2019t got any.</p>\n\n<p>The second argument is a list of movies. Let\u2019s pattern match on it. The first case is <code>[]</code>:</p>\n\n<pre><code>search p [] = (??)\n</code></pre>\n\n<p>Well we need to return a list of movies here and I don\u2019t think we should make one up out of thin air so we should probably return none. Indeed if you search a list of no movies, surely all you can get is nothing. We don\u2019t use the predicate argument in this case so let\u2019s write <code>_</code> instead you make it obvious that we don\u2019t use it:</p>\n\n<pre><code>search _ [] = []\n</code></pre>\n\n<p>The other case is the head of a list and the rest. Let\u2019s call the head <code>m</code> for <em>movie</em> and following convention the tail will be called <code>ms</code>:</p>\n\n<pre><code>search p (m:ms) = (??)\n</code></pre>\n\n<p>At this point we now have a movie to call our function <code>p</code> with so let\u2019s do that and consider the result:</p>\n\n<pre><code>search p (m:ms) =\n    if p m\n    then (??)\n    else (??)\n</code></pre>\n\n<p>Well what do we do here? If <code>p m</code> is true then we should include <code>m</code> in the output and if it is false then we shouldn\u2019t include it. Let\u2019s call the rest of the output <code>r</code> for <em>result</em>:</p>\n\n<pre><code>search p (m:ms) = if p m then p:r else r\n  where r = (??)\n</code></pre>\n\n<p>Now all we need to do is figure out what the rest of the result is. We know <code>r</code> must be of type <code>[Movie]</code> and if we think about it, <code>r</code> should be the list of movies from <code>ms</code> which satisfy the predicate <code>p</code>. I don\u2019t have a great explanation for how to think of this but the best advice I can give is that by reading and writing lots of little recursive functions like this, one develops an intuition as to how to figure these out:</p>\n\n<pre><code>search p (m:ms) = if p m then p:r else r\n  where r = search p ms\n</code></pre>\n\n<p>An alternative solution would be to use the <code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code> function from prelude:</p>\n\n<pre><code>search = filter\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 12579600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b6386a866bb265b420d5cb22932315e?s=128&d=identicon&r=PG&f=1", "display_name": "Tomyy93", "link": "https://stackoverflow.com/users/12579600/tomyy93"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 59445104, "answer_count": 1, "score": 0, "last_activity_date": 1577025015, "creation_date": 1577019341, "last_edit_date": 1577023183, "question_id": 59444382, "link": "https://stackoverflow.com/questions/59444382/haskell-movies-search", "title": "Haskell movies search", "body": "<p>I am new to Haskell and i have a project which need to give True if conditions is meet in the list, i'm already make the other function which check if the score is above or the director is the same but now i need to merge this conditions together but i'm stuck and dont know how to do that.</p>\n\n<p>The fuction need to give back true for that test cases:</p>\n\n<pre><code>search (director \"Christopher Nolan\") movies == [(\"Inception\", 8.8, \"Christopher Nolan\"), (\"The Dark Knight\", 9.0, \"Christopher Nolan\")]\n\nsearch (imdbAtLeast 8.2) movies == [(\"Green Book\", 8.3, \"Peter Farrelly\"), (\"Inception\", 8.8, \"Christopher Nolan\"), (\"The Dark Knight\", 9.0, \"Christopher Nolan\")]\n\nsearch (and_ (director \"Christopher Nolan\") (imdbAtLeast 8.9)) movies == [(\"The Dark Knight\", 9.0, \"Christopher Nolan\")]\n\nsearch (or_ (imdbAtLeast 7.5) (director \"Rian Johnson\")) [(\"The Last Jedi\", 7.2, \"Rian Johnson\"), (\"Sicario\", 7.6, \"Denis Villeneuve\")] == [(\"The Last Jedi\", 7.2, \"Rian Johnson\"), (\"Sicario\", 7.6, \"Denis Villeneuve\")]\n\nsearch (\\_ -&gt; True) [] == []\n\nsearch (\\_ -&gt; False) movies == []\n</code></pre>\n\n<p>my code untill that part:</p>\n\n<pre><code>type Movie = (String, Double, String)\n\n-- movies :: [(String, Double, String)]\nmovies :: [Movie]\nmovies = [ (\"Green Book\", 8.3, \"Peter Farrelly\")\n         , (\"Inception\", 8.8, \"Christopher Nolan\")\n         , (\"Incredibles 2\", 7.7, \"Brad Bird\")\n         , (\"The Dark Knight\", 9.0, \"Christopher Nolan\")\n         ] \nimdbAtLeast :: Double -&gt; (String,Double,String) -&gt; Bool \nimdbAtLeast pointgive (_, point, _) =  point &gt;= pointgive\n\ndirector  :: String  -&gt; (String,Double,String) -&gt; Bool \ndirector  directorgive  (_, _, director) =  director == directorgive\n\nand_ :: (Movie -&gt; Bool) -&gt; (Movie -&gt; Bool) -&gt; Movie -&gt; Bool\nand_ p q m = p m &amp;&amp; q m\n\nor_ :: (Movie -&gt; Bool) -&gt; (Movie -&gt; Bool) -&gt; Movie -&gt; Bool\nor_ p q m = p m || q m\n\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 8276, "user_id": 327038, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e17117063f64ef47f36ab4ee45bf3d4b?s=128&d=identicon&r=PG", "display_name": "asthasr", "link": "https://stackoverflow.com/users/327038/asthasr"}, "is_accepted": false, "score": 1, "last_activity_date": 1577012896, "creation_date": 1577012896, "answer_id": 59443678, "question_id": 59443643, "link": "https://stackoverflow.com/questions/59443643/how-to-build-a-docker-image-with-stack-haskell/59443678#59443678", "title": "How to build a docker image with Stack Haskell?", "body": "<p>I believe that the purpose of the Stack Docker integration is simply to perform builds within the container, not necessarily to <em>produce</em> a container. I would recommend using the <a href=\"https://hub.docker.com/_/haskell/\" rel=\"nofollow noreferrer\">official Haskell Docker image</a> and a Dockerfile to build the image instead.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1577012896, "creation_date": 1577012643, "question_id": 59443643, "link": "https://stackoverflow.com/questions/59443643/how-to-build-a-docker-image-with-stack-haskell", "title": "How to build a docker image with Stack Haskell?", "body": "<p>I am using <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">Stack</a> to build my Haskell project and would like to build a docker image from it.  </p>\n\n<p>I've found that Stack supports <a href=\"https://docs.haskellstack.org/en/stable/docker_integration/\" rel=\"nofollow noreferrer\">Docker integration</a>, but as I tried it does not build for me ready to use docker image from my project.  </p>\n\n<p>The statement <code>stack docker pull</code>, that describes in the section <a href=\"https://docs.haskellstack.org/en/stable/docker_integration/#use-stack-as-normal\" rel=\"nofollow noreferrer\">https://docs.haskellstack.org/en/stable/docker_integration/#use-stack-as-normal</a>, it downloads the Haskell compiler </p>\n\n<pre><code>REPOSITORY                     TAG                 IMAGE ID            CREATED             SIZE\ngolang                         1.12.9              669220934599        3 months ago        814MB\nkindest/node                   v1.15.3             8ca0c8463ebe        4 months ago        1.45GB\nfpco/stack-build               lts-14.17           9adc774bb5e5        4 months ago        8.52GB\ngcr.io/kuar-demo/kuard-amd64   blue    \n\n1db936caa6ac        8 months ago        23MB\n</code></pre>\n\n<p>but it does not build an image.</p>\n\n<p>The question is, how to build a docker image from my haskell project with Stack.</p>\n"}, {"tags": ["haskell", "free-monad", "church-encoding"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1576975676, "post_id": 59440787, "comment_id": 105065561, "body": "Perhaps you could &quot;warm up&quot; by manually writing the isomorphism between <code>FreeT</code> and <code>FT</code> from scratch, which might show you the technique you need in a context with fewer degrees of freedom"}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1576975756, "post_id": 59440787, "comment_id": 105065576, "body": "@luqui Based on my previous experiments with this <code>FT</code> isn&#39;t exactly isomorphic to <code>FreeT</code>, it&#39;s &quot;larger&quot; in a certain sense"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1576975862, "post_id": 59440787, "comment_id": 105065592, "body": "@luqui i suppose that was what I was going for when I was trying to &#39;inline&#39; the isomorphism functions...but I couldn&#39;t find a way to get around the &quot;recursing with a different <code>s0</code>&quot; part.  But maybe trying to write the isomorphism myself, instead of looking at the pre-written ones, might help"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1577000378, "post_id": 59441531, "comment_id": 105068175, "body": "This is essentially an appeal to authority.  It would be nice to see <i>why</i> converting to <code>FreeT</code> is good or bad."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1576987348, "creation_date": 1576987348, "answer_id": 59441531, "question_id": 59440787, "link": "https://stackoverflow.com/questions/59440787/converting-this-freet-explicitly-recursive-data-type-function-to-work-on-ft-c/59441531#59441531", "title": "Converting this FreeT (explicitly recursive data type) function to work on FT (church encoding)", "body": "<p>I'd say that no, as even something as simple as <code>cutoff</code> converts to <code>FreeT</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>cutoff :: (Functor f, Monad m) =&gt; Integer -&gt; FT f m a -&gt; FT f m (Maybe a)\ncutoff n = toFT . FreeT.cutoff n . fromFT\n</code></pre>\n\n<hr>\n\n<p>In general, you're probably looking at:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>improve :: Functor f =&gt; (forall m. MonadFree f m =&gt; m a) -&gt; Free f a\n</code></pre>\n\n<blockquote>\n  <p>Improve the asymptotic performance of code that builds a free monad with only binds and returns by using F behind the scenes.</p>\n</blockquote>\n\n<p>I.e. you'll construct <code>Free</code> efficiently, but then do whatever you need to do with <code>Free</code> (maybe again, by <code>improve</code>ing).</p>\n"}, {"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1577529074, "post_id": 59447757, "comment_id": 105192198, "body": "Thank you!  It&#39;s interesting that the equivalence is not immediately obvious, and that it is prudent to run some tests to make sure.  The fact that <code>FT</code> is &quot;bigger&quot; than <code>Free</code> definitely makes things strange."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1577055658, "last_edit_date": 1577055658, "creation_date": 1577045917, "answer_id": 59447757, "question_id": 59440787, "link": "https://stackoverflow.com/questions/59440787/converting-this-freet-explicitly-recursive-data-type-function-to-work-on-ft-c/59447757#59447757", "title": "Converting this FreeT (explicitly recursive data type) function to work on FT (church encoding)", "body": "<p>Here's the definition. There are no tricks in the implementation itself. Don't think and make it type check. Yes, at least one of these <code>fmap</code> is morally questionable, but the difficulty is actually to convince ourselves it does the Right thing.</p>\n\n<pre><code>runStateF\n    :: (Functor f, Monad m)\n    =&gt; s\n    -&gt; FT f (StateT s m) a\n    -&gt; FT f m (a, s)\nrunStateF s0 (FT run) = FT $ \\return0 handle0 -&gt;\n  let returnS a = StateT (\\s -&gt; fmap (\\r -&gt; (r, s)) (return0 (a, s)))\n      handleS k e = StateT (\\s -&gt; fmap (\\r -&gt; (r, s)) (handle0 (\\x -&gt; evalStateT (k x) s) e))\n  in evalStateT (run returnS handleS) s0\n</code></pre>\n\n<p>We have two stateless functions (i.e., plain <code>m</code>)</p>\n\n<pre><code>return0 :: a -&gt; m r\nhandle0 :: forall x. (x -&gt; m r) -&gt; f x -&gt; m r\n</code></pre>\n\n<p>and we must wrap them in two stateful (<code>StateT s m</code>) variants with the signatures below. The comments that follow give some details about what is going on in the definition of <code>handleS</code>.</p>\n\n<pre><code>returnS :: a -&gt; StateT s m r\nhandleS :: forall x. (x -&gt; StateT s m r) -&gt; f x -&gt; StateT s m r\n\n-- 1.                                               --    ^   grab the current state 's' here\n-- 2.                                               --      ^ call handle0 to produce that 'm'\n-- 3.                             ^ here we will have to provide some state 's': pass the current state we just grabbed.\n--                                  The idea is that 'handle0' is stateless in handling 'f x',\n--                                  so it is fine for this continuation (x -&gt; StateT s m r) to get the state from before the call to 'handle0'\n</code></pre>\n\n<p>There is an apparently dubious use of <code>fmap</code> in <code>handleS</code>, but it is valid as long as <code>run</code> <em>never looks</em> at the states produced by <code>handleS</code>. It is almost immediately thrown away by one of the <code>evalStateT</code>.</p>\n\n<p>In theory, there exist terms of type <code>FT f (StateT s m) a</code> which break that invariant. In practice, that almost certainly doesn't occur; you would really have to go out of your way to do something morally wrong with those continuations.</p>\n\n<p>In the following complete gist, I also show how to test with QuickCheck that it is indeed equivalent to your initial version using <code>FreeT</code>, with concrete evidence that the above invariant holds:</p>\n\n<p><a href=\"https://gist.github.com/Lysxia/a0afa3ca2ea9e39b400cde25b5012d18\" rel=\"nofollow noreferrer\">https://gist.github.com/Lysxia/a0afa3ca2ea9e39b400cde25b5012d18</a></p>\n"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 59447757, "answer_count": 2, "score": 6, "last_activity_date": 1577055658, "creation_date": 1576973706, "last_edit_date": 1576977494, "question_id": 59440787, "link": "https://stackoverflow.com/questions/59440787/converting-this-freet-explicitly-recursive-data-type-function-to-work-on-ft-c", "title": "Converting this FreeT (explicitly recursive data type) function to work on FT (church encoding)", "body": "<p>I'm using the <a href=\"https://hackage.haskell.org/package/free-5.1.3/docs/Control-Monad-Trans-Free.html#t:FreeT\" rel=\"nofollow noreferrer\">FreeT</a> type from the <em>free</em> library to write this function which \"runs\" an underlying <code>StateT</code>:</p>\n\n<pre><code>runStateFree\n    :: (Functor f, Monad m)\n    =&gt; s\n    -&gt; FreeT f (StateT s m) a\n    -&gt; FreeT f m (a, s)\nrunStateFree s0 (FreeT x) = FreeT $ do\n    flip fmap (runStateT x s0) $ \\(r, s1) -&gt; case r of\n      Pure y -&gt; Pure (y, s1)\n      Free z -&gt; Free (runStateFree s1 &lt;$&gt; z)\n</code></pre>\n\n<p>However, I'm trying to convert it to work on <a href=\"https://hackage.haskell.org/package/free-5.1.3/docs/Control-Monad-Trans-Free-Church.html\" rel=\"nofollow noreferrer\">FT</a>, the church-encoded version, instead:</p>\n\n<pre><code>runStateF\n    :: (Functor f, Monad m)\n    =&gt; s\n    -&gt; FT f (StateT s m) a\n    -&gt; FT f m (a, s)\nrunStateF s0 (FT x) = FT $ \\ka kf -&gt; ...\n</code></pre>\n\n<p>but I'm not quite having the same luck.  Every sort of combination of things I get seems to not quite work out.  The closest I've gotten is</p>\n\n<pre><code>runStateF s0 (FT x) = FT $ \\ka kf -&gt;\n    ka =&lt;&lt; runStateT (x pure (\\n -&gt; _ . kf (_ . n)) s0\n</code></pre>\n\n<p>But the type of the first hole is <code>m r -&gt; StateT s m r</code> and the type the second hole is <code>StateT s m r -&gt; m r</code>...which means we necessarily lose the state in the process.</p>\n\n<p>I know that all <code>FreeT</code> functions are possible to write with <code>FT</code>.  Is there a nice way to write this that doesn't involve round-tripping through <code>FreeT</code> (that is, in a way that requires explicitly matching on <code>Pure</code> and <code>Free</code>)?  (I've tried manually inlining things but I don't know how to deal with the recursion using different <code>s</code>s in the definition of <code>runStateFree</code>).  Or maybe this is one of those cases where the explicit recursive data type is necessarily more performant than the church (mu) encoding?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1576973426, "post_id": 59440692, "comment_id": 105065290, "body": "I think a skilled developer would return <code>Just [3, 4]</code>."}, {"owner": {"reputation": 179, "user_id": 2412873, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0109148d3479ee0f49b67e14f48793aa?s=128&d=identicon&r=PG", "display_name": "lOlive", "link": "https://stackoverflow.com/users/2412873/lolive"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1576974836, "post_id": 59440692, "comment_id": 105065469, "body": "What refactor would he/she do to the original code, to return Just [3, 4] ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1576990347, "post_id": 59440692, "comment_id": 105067033, "body": "Use <code>traverse</code> instead of <code>fmap</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1577026307, "post_id": 59440692, "comment_id": 105073162, "body": "Your first one doesn&#39;t return <code>[3, 4]</code>; it returns <code>Monad m =&gt; m [3, 4]</code> If you run this in GHCi, the monad defaults to <code>IO</code>, so your <code>IO [3, 4]</code> is immediately executed to produce <code>[3, 4]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1263, "user_id": 5817767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/209584382725014/picture?type=large", "display_name": "Pawan Kumar", "link": "https://stackoverflow.com/users/5817767/pawan-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1576983746, "last_edit_date": 1576983746, "creation_date": 1576983404, "answer_id": 59441318, "question_id": 59440692, "link": "https://stackoverflow.com/questions/59440692/proper-refactor-of-a-haskell-code-when-a-non-monadic-value-becomes-a-monadic-val/59441318#59441318", "title": "Proper refactor of a Haskell code when a non-monadic value becomes a monadic value", "body": "<p>To acheive <strong>Fyodor Soikin</strong> result you can try the below one.</p>\n\n<pre><code>h = Just 2\nadd = \\x y -&gt; x + y\naddH arr = pure fmap &lt;*&gt; (add &lt;$&gt; h) &lt;*&gt; pure arr\n\nmain = return $ addH [1, 2]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "is_accepted": false, "score": 1, "last_activity_date": 1577431189, "last_edit_date": 1577431189, "creation_date": 1577427868, "answer_id": 59496836, "question_id": 59440692, "link": "https://stackoverflow.com/questions/59440692/proper-refactor-of-a-haskell-code-when-a-non-monadic-value-becomes-a-monadic-val/59496836#59496836", "title": "Proper refactor of a Haskell code when a non-monadic value becomes a monadic value", "body": "<p>I would like to point out that in your original code, <code>[]</code> and <code>Maybe</code> are redundant, and that a closer inspection of the meaning of these two functors leads to an interesting discussion. <code>[]</code> (list) represents a success or a failure in the same sense that <code>Maybe</code> does, the main difference being that <code>[]</code> can represent 0 or more values, whereas <code>Maybe</code> is limited to 0 or 1 value.</p>\n\n<p>This leads to another consideration about the meaning of the <code>Just</code> in <code>Just 2</code>. What does it mean for <code>2</code> to be wrapped in a <code>Just</code>, and what would a <code>Nothing</code> mean? To take this one step further, here are five different results that you could opt for, each having a different meaning:</p>\n\n<ol>\n<li><code>Just [3, 4]</code>: There was one monolithic computation that dealt with multiple values, and it succeeded.</li>\n<li><code>Nothing</code>: There could have been a monolithic value, but there is none.</li>\n<li><code>[3, 4]</code>: There was a batch of computations, and these are the values that came out.</li>\n<li><code>[]</code>: There could have been multiple values, but there are none.</li>\n<li><code>[Just 3, Just 4]</code>: There was a batch of computations, where each computation could have failed, and all of them succeeded.</li>\n</ol>\n\n<p><strong>Case 1</strong>: If <code>h</code> represents a monolithic value, and is the unique point of failure in this computation chain, then options 1 and 2 seem like a reasonable choice. The following code accomplishes this:</p>\n\n<pre><code>import Control.Applicative (LiftA2)\nh = Just 2\nadd = (+)\naddH = LiftA2 add h . pure\n-- Returns Just [3,4] or Nothing\nmainFunc = traverse addH [1,2]\n</code></pre>\n\n<p><strong>Case 2</strong>: If <code>add</code> represents a function that can fail depending on its argument (for example, think of the function <code>hDivBy</code>, which would fail on every 0), then options 3 and 4 seem like a good choice. </p>\n\n<pre><code>import Data.Maybe (mapMaybe)\nhDivBy = \\x -&gt; (`div` x) &lt;$&gt; h\n--Returns [1]\nmainFunc = mapMaybe hDivBy [0, 2]\n</code></pre>\n\n<p><strong>Case 3</strong>: If you want to keep track of element indexing, then option 5 will give you just that:</p>\n\n<pre><code>--Returns [Nothing, Just 2]\nmainFunc = fmap hDivBy [0,2]\n</code></pre>\n\n<p>Notice that this code keeps everything in the <code>Applicative</code> realm, making it more general, <a href=\"https://wiki.haskell.org/Applicative_functor#Some_advantages_of_applicative_functors\" rel=\"nofollow noreferrer\">amongst other advantages</a>.</p>\n"}], "owner": {"reputation": 179, "user_id": 2412873, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0109148d3479ee0f49b67e14f48793aa?s=128&d=identicon&r=PG", "display_name": "lOlive", "link": "https://stackoverflow.com/users/2412873/lolive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1577431189, "creation_date": 1576972341, "question_id": 59440692, "link": "https://stackoverflow.com/questions/59440692/proper-refactor-of-a-haskell-code-when-a-non-monadic-value-becomes-a-monadic-val", "title": "Proper refactor of a Haskell code when a non-monadic value becomes a monadic value", "body": "<p>Let's say I have this sample code:</p>\n\n<pre><code>h = 2\nadd = \\x y -&gt; (x + y)\naddH = add h\n\nmain = return (fmap addH [1,2])\n</code></pre>\n\n<p>Running it evaluates to [3,4]</p>\n\n<hr>\n\n<p>Now, let's say h is not set to \"2\", but to \"Just 2\".</p>\n\n<p><strong>Question, part 1:</strong></p>\n\n<p>What is the proper refactor, then, to still return [3,4] in the end?</p>\n\n<p><strong>Question, part 2:</strong></p>\n\n<p>Would a skilled Haskell developper prefer to change the return value to be [Just 3, Just 4] </p>\n\n<p>For example with a refactor like this:</p>\n\n<pre><code>h = Just 2\nadd = \\x y -&gt; (x + y)\naddH = liftM2(add) h . pure         --isn't there a better syntax for that?\n\nmain = return (fmap addH [1,2])\n</code></pre>\n\n<hr>\n\n<p>More generally, in an existing codebase, how to minimize the refactor impact when a function that used to return 'Num t => [t]' must now return 'Num t => [Maybe t]'?</p>\n"}, {"tags": ["haskell", "archlinux", "xmonad"], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 1, "last_activity_date": 1577101097, "creation_date": 1577101097, "answer_id": 59454712, "question_id": 59440585, "link": "https://stackoverflow.com/questions/59440585/could-not-find-module-xmonad-when-attempting-to-compile/59454712#59454712", "title": "Could not find module `XMonad` when attempting to compile", "body": "<p>Sounds like an issue with cabal - I think there are some packaging difficulties on Arch Linux.</p>\n\n<p>As an alternative, you can manually build a Haskell project with your specific xmonad config, once you know this builds correctly, you can create a <code>~/.xmonad/build</code> shell file, and in here trigger a build to your xmonad config/application. </p>\n\n<p>So the contents of <code>build</code> might be:</p>\n\n<pre><code>#!/usr/bin/env bash\nset -e\ncd ~/MyXmonadProject/\nstack build # or cabal build?\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10637646, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EeqtoPg4gCY/AAAAAAAAAAI/AAAAAAAAEME/ylaCiw4qnE4/photo.jpg?sz=128", "display_name": "trey hanckok", "link": "https://stackoverflow.com/users/10637646/trey-hanckok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1507, "favorite_count": 0, "accepted_answer_id": 59454712, "answer_count": 1, "score": 3, "last_activity_date": 1577101097, "creation_date": 1576970715, "last_edit_date": 1576971131, "question_id": 59440585, "link": "https://stackoverflow.com/questions/59440585/could-not-find-module-xmonad-when-attempting-to-compile", "title": "Could not find module `XMonad` when attempting to compile", "body": "<p>I see a couple other people with the same issue however none of the solutions worked for me. The following commands+outputs are mainly what I have tried. I am posting 1) because I have been stuck on this for some time and 2) I wanted to leave a comment on another post but I have no reputation :(</p>\n\n<p>I have reinstalled my os (arch linux), keeping only my home files however I deleted .stack, .ghc, and .cabal folders.</p>\n\n<p><code>yay -S xmonad xmonad-contrib</code><br>\n<code>stack install xmonad xmonad-contrib</code>\n<code>sudo ghc-pkg recache</code></p>\n\n<p><code>xmonad --recompile</code>:</p>\n\n<pre><code>XMonad will use ghc to recompile, because \"/home/trey/.xmonad/build\" does not exist.\nError detected while loading xmonad configuration file: /home/trey/.xmonad/xmonad.hs\n\nxmonad.hs:7:1: error:\n    Could not find module `XMonad'\n    There are files missing in the `xmonad-0.15' package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n  |\n7 | import XMonad\n  | ^^^^^^^^^^^^^\n</code></pre>\n\n<p>... applies to all xmonad related modules</p>\n\n<p><code>ghc-pkg check</code>:</p>\n\n<pre><code>Warning: haddock-interfaces: /usr/share/doc/xmonad/html/xmonad.haddock doesn't exist or isn't a file\nWarning: haddock-html: /usr/share/doc/xmonad/html doesn't exist or isn't a directory\nWarning: haddock-interfaces: /usr/share/doc/xmonad-contrib/html/xmonad-contrib.haddock doesn't exist or isn't a file\nWarning: haddock-html: /usr/share/doc/xmonad-contrib/html doesn't exist or `\n</code></pre>\n\n<p>... returns about 800 lines or so of Warnings like these however am unable to copy these as for some reason it doesn't pipe well. If you do need to see the whole output I will find a solution.</p>\n\n<p><code>ghc-pkg list</code>:</p>\n\n<pre><code>/usr/lib/ghc-8.6.5/package.conf.d\n    Cabal-2.4.0.1\n    Glob-0.10.0\n    HTTP-4000.3.14\n    Only-0.1\n    StateVar-1.1.1.1\n    X11-1.9.1\n    X11-xft-0.3.1\n    aeson-1.4.6.0\n    annotated-wl-pprint-0.7.0\n    ansi-terminal-0.9.1\n    ansi-wl-pprint-0.6.9\n    array-0.5.3.0\n    asn1-encoding-0.9.6\n    asn1-parse-0.9.5\n    asn1-types-0.3.3\n    async-2.2.2\n    attoparsec-0.13.2.3\n    attoparsec-iso8601-1.0.1.0\n    auto-update-0.1.6\n    base-4.12.0.0\n    base-compat-0.10.5\n    base-orphans-0.8.1\n    base-prelude-1.3\n    base16-bytestring-0.1.1.6\n    base64-bytestring-1.0.0.2\n    basement-0.0.11\n    bifunctors-5.5.6\n    binary-0.8.6.0\n    bindings-uname-0.1\n    bitarray-0.0.1.1\n    blaze-builder-0.4.1.0\n    blaze-html-0.9.1.2\n    blaze-markup-0.8.2.3\n    byteable-0.1.1\n    bytestring-0.10.8.2\n    case-insensitive-1.2.1.0\n    cereal-0.5.8.1\n    clock-0.8\n    cmdargs-0.10.20\n    colour-2.3.5\n    comonad-5.0.6\n    conduit-1.3.1.2\n    conduit-extra-1.3.4\n    connection-0.3.1\n    constraints-0.11.2\n    containers-0.6.0.1\n    contravariant-1.5.2\n    cookie-0.4.5\n    cryptohash-sha256-0.11.101.0\n    cryptonite-0.26\n    cryptonite-conduit-0.2.2\n    data-default-0.7.1.1\n    data-default-class-0.1.2.0\n    data-default-instances-containers-0.0.1\n    data-default-instances-dlist-0.0.1\n    data-default-instances-old-locale-0.0.1\n    deepseq-1.4.4.0\n    digest-0.0.1.2\n    directory-1.3.3.0\n    distributive-0.6.1\n    dlist-0.8.0.7\n    easy-file-0.2.2\n    echo-0.1.3\n    ed25519-0.0.5.0\n    edit-distance-0.2.2.1\n    either-5.0.1.1\n    enclosed-exceptions-1.0.3\n    exceptions-0.10.3\n    extensible-exceptions-0.1.1.4\n    extra-1.6.18\n    fast-logger-3.0.0\n    file-embed-0.0.11.1\n    filelock-0.1.1.4\n    filepath-1.4.2.1\n    fsnotify-0.3.0.1\n    generic-deriving-1.12.4\n    (ghc-8.6.5)\n    ghc-boot-8.6.5\n    ghc-boot-th-8.6.5\n    ghc-compact-0.1.0.0\n    ghc-heap-8.6.5\n    ghc-prim-0.5.3\n    ghci-8.6.5\n    githash-0.1.3.3\n    hackage-security-0.5.3.0\n    haddock-library-1.7.0\n    hashable-1.2.7.0\n    haskeline-0.7.4.3\n    hi-file-parser-0.1.0.0\n    hinotify-0.4\n    hourglass-0.2.12\n    hpack-0.33.0\n    hpc-0.6.0.3\n    http-api-data-0.4.1.1\n    http-client-0.6.4\n    http-client-tls-0.3.5.3\n    http-conduit-2.3.7.3\n    http-download-0.1.0.0\n    http-types-0.12.3\n    infer-license-0.2.0\n    integer-gmp-1.0.2.0\n    integer-logarithms-1.0.3\n    libiserv-8.6.3\n    libyaml-0.1.1.1\n    lifted-async-0.10.0.4\n    lifted-base-0.2.3.12\n    megaparsec-7.0.5\n    memory-0.14.18\n    microlens-0.4.11.2\n    microlens-th-0.4.3.2\n    mime-types-0.1.0.9\n    mintty-0.1.2\n    monad-control-1.0.2.3\n    monad-logger-0.3.31\n    monad-loops-0.4.3\n    mono-traversable-1.0.13.0\n    mtl-2.2.2\n    mustache-2.3.0\n    neat-interpolation-0.3.2.5\n    network-2.8.0.0\n    network-uri-2.6.1.0\n    old-locale-1.0.0.7\n    old-time-1.1.0.3\n    open-browser-0.2.1.0\n    optparse-applicative-0.14.3.0\n    optparse-generic-1.3.0\n    optparse-simple-0.1.1.2\n    pantry-0.1.1.1\n    parsec-3.1.13.0\n    parser-combinators-1.2.1\n    path-0.6.1\n    path-io-1.4.2\n    path-pieces-0.2.1\n    pem-0.2.4\n    persistent-2.10.4\n    persistent-sqlite-2.10.5\n    persistent-template-2.7.3\n    pretty-1.1.3.6\n    primitive-0.6.4.0\n    process-1.6.5.0\n    profunctors-5.5.1\n    project-template-0.2.0.1\n    random-1.1\n    regex-applicative-0.3.3.1\n    regex-applicative-text-0.1.0.1\n    resolv-0.1.1.1\n    resource-pool-0.2.3.2\n    resourcet-1.2.2\n    retry-0.8.1.0\n    rio-0.1.12.0\n    rio-orphans-0.1.1.0\n    rio-prettyprint-0.1.0.0\n    rts-1.0\n    safe-0.3.18\n    safe-exceptions-0.1.7.0\n    scientific-0.3.6.2\n    semigroupoids-5.3.3\n    setlocale-1.0.0.9\n    shelly-1.8.1\n    silently-1.2.5.1\n    socks-0.6.1\n    split-0.2.3.3\n    stack-2.1.3\n    stm-2.5.0.0\n    stm-chans-3.0.0.4\n    streaming-commons-0.2.1.1\n    syb-0.7.1\n    system-fileio-0.3.16.4\n    system-filepath-0.4.14\n    tagged-0.8.6\n    tar-0.5.1.1\n    tar-conduit-0.3.2\n    template-haskell-2.14.0.0\n    temporary-1.3\n    terminal-size-0.3.2.1\n    terminfo-0.4.1.2\n    text-1.2.3.1\n    text-metrics-0.3.0\n    th-abstraction-0.3.1.0\n    th-expand-syns-0.4.5.0\n    th-lift-0.8.0.1\n    th-lift-instances-0.1.14\n    th-orphans-0.13.9\n    th-reify-many-0.1.9\n    th-utilities-0.2.3.1\n    time-1.8.0.2\n    time-compat-1.9.2.2\n    tls-1.4.1\n    transformers-0.5.6.2\n    transformers-base-0.4.5.2\n    transformers-compat-0.6.5\n    type-equality-1\n    typed-process-0.2.6.0\n    unicode-transforms-0.3.6\n    unix-2.7.2.2\n    unix-compat-0.5.2\n    unix-time-0.4.7\n    unliftio-0.2.12\n    unliftio-core-0.1.2.0\n    unordered-containers-0.2.10.0\n    utf8-string-1.0.1.1\n    uuid-types-1.0.3\n    vector-0.12.0.3\n    vector-algorithms-0.8.0.3\n    void-0.7.3\n    x509-1.7.5\n    x509-store-1.6.7\n    x509-system-1.6.6\n    x509-validation-1.6.11\n    xhtml-3000.2.2.1\n    xmonad-0.15\n    xmonad-contrib-0.16\n    yaml-0.11.2.0\n    zip-archive-0.4.1\n    zlib-0.6.2.1\n</code></pre>\n"}, {"tags": ["list", "haskell", "duplicates"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1576969935, "post_id": 59440447, "comment_id": 105064720, "body": "Do you mean all duplicates, or just consecutive ones?"}, {"owner": {"reputation": 2646, "user_id": 40751, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/VVvwi.jpg?s=128&g=1", "display_name": "tex", "link": "https://stackoverflow.com/users/40751/tex"}, "edited": false, "score": 0, "creation_date": 1576970103, "post_id": 59440447, "comment_id": 105064753, "body": "<code>nub</code> <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:nub\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1576970855, "post_id": 59440447, "comment_id": 105064882, "body": "<code>nub</code> is O(n^2) unfortunately - the best way I believe is to use the <code>fromList</code> and <code>toList</code> functions from <code>Data.Set</code> and then just use <code>toList . fromList</code>."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 2646, "user_id": 40751, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/VVvwi.jpg?s=128&g=1", "display_name": "tex", "link": "https://stackoverflow.com/users/40751/tex"}, "edited": false, "score": 0, "creation_date": 1577044143, "post_id": 59440447, "comment_id": 105077639, "body": "@tex No, <code>nub [1,2,2,3,4]</code> is <code>[1,2,3,4]</code>, but the OP wants <code>[1,3,4]</code>."}, {"owner": {"reputation": 2646, "user_id": 40751, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/VVvwi.jpg?s=128&g=1", "display_name": "tex", "link": "https://stackoverflow.com/users/40751/tex"}, "edited": false, "score": 0, "creation_date": 1577044579, "post_id": 59440447, "comment_id": 105077741, "body": "Good call. I misinterpreted the requirements."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1577118147, "post_id": 59440447, "comment_id": 105097946, "body": "<code>[x | x &lt;- group [1,2,2,3,4], [_] &lt;- [x], x &lt;- x]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 1, "creation_date": 1577165551, "post_id": 59440566, "comment_id": 105108804, "body": "Although this is simple to read, it is potentially inefficient, since <code>length</code> <a href=\"https://stackoverflow.com/a/35958999/7096763\">traverses the whole list</a>, just to check that there is no second element."}], "tags": [], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "is_accepted": false, "score": 1, "last_activity_date": 1576971094, "last_edit_date": 1576971094, "creation_date": 1576970466, "answer_id": 59440566, "question_id": 59440447, "link": "https://stackoverflow.com/questions/59440447/removing-duplicates-from-a-list-in-haskell/59440566#59440566", "title": "removing duplicates from a list in haskell", "body": "<p>From a comment I see that the function <code>Data.Set.nub</code> just does what the OP asks.</p>\n\n<p>However, my first attempt to solve the problem was the following, which only removes duplicates if they are consecutive (e.g. <code>[1,2,1,2,1,2]</code> is not changed):</p>\n\n<pre><code>concat $ filter (\\x -&gt; length x == 1) $ Data.List.group [1,2,3,4,4]\n</code></pre>\n\n<p>I hope this answer could be useful to some random user ending up on this page.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 7401094, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0sHEQ.jpg?s=128&g=1", "display_name": "imnotthatrobot", "link": "https://stackoverflow.com/users/7401094/imnotthatrobot"}, "edited": false, "score": 0, "creation_date": 1577106135, "post_id": 59440791, "comment_id": 105092747, "body": "I think this is the right answer, you just need to adjust the first pattern matching."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1577176919, "post_id": 59440791, "comment_id": 105111873, "body": "if <code>myCom [1,2,2,2] = [1,2]</code> is desired behavior, then what should <code>myCom [1,2,2,2,2]</code> be? is it <code>[1]</code> again, or <code>[1,2,2]</code>?"}], "tags": [], "owner": {"reputation": 201, "user_id": 7530714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0086b2237d1ccadf46971001dc048f9?s=128&d=identicon&r=PG&f=1", "display_name": "shortmanikos", "link": "https://stackoverflow.com/users/7530714/shortmanikos"}, "is_accepted": true, "score": 5, "last_activity_date": 1577348335, "last_edit_date": 1577348335, "creation_date": 1576973744, "answer_id": 59440791, "question_id": 59440447, "link": "https://stackoverflow.com/questions/59440447/removing-duplicates-from-a-list-in-haskell/59440791#59440791", "title": "removing duplicates from a list in haskell", "body": "<p>The first pattern match you have only catches lists with at least 3 elements.\nThat is why when the duplicates are at the end of the list when </p>\n\n<pre><code>myCom [4,4] \n</code></pre>\n\n<p>is called it simply uses</p>\n\n<pre><code>myCom ys = ys\n</code></pre>\n\n<p>and returns itself. You can catch this by defining myCom for lists with at least 2 elements as below (you werent't using z anyway):</p>\n\n<pre><code>myCom (x:y:ys)\n  | x == y    =  myCom ys\n  | otherwise = x  : myCom (y:ys)\nmyCom ys = ys\n</code></pre>\n\n<p>This gives</p>\n\n<p>myCom [1,2,2,3,4,4] = [1,3]</p>\n\n<p>There is still an issue with 3 (an odd number) consecutive numbers. For example we get:</p>\n\n<pre><code>myCom [1,2,2,2] = [1,2]\n</code></pre>\n\n<p>but I understand that this is desired behavior.</p>\n"}, {"tags": [], "owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "is_accepted": false, "score": 2, "last_activity_date": 1577165463, "last_edit_date": 1577165463, "creation_date": 1577162736, "answer_id": 59463938, "question_id": 59440447, "link": "https://stackoverflow.com/questions/59440447/removing-duplicates-from-a-list-in-haskell/59463938#59463938", "title": "removing duplicates from a list in haskell", "body": "<p>I would use <code>Maybe</code> to represent a length of one as a success condition. This works well with Haskell's pattern-matching syntax. You can then use <code>group</code> (from Data.List) and filter out the <code>Nothing</code>s using <code>catMaybe</code> (from Data.Maybe) :</p>\n\n<pre><code>myCom = catMaybes . map lenOne . group\n  where lenOne [x] = Just x\n        lenOne _   = Nothing\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 12577525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc56685f05d2da314c7e486015fc880c?s=128&d=identicon&r=PG&f=1", "display_name": "acemi", "link": "https://stackoverflow.com/users/12577525/acemi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 59440791, "answer_count": 3, "score": 0, "last_activity_date": 1577348335, "creation_date": 1576968827, "last_edit_date": 1576998153, "question_id": 59440447, "link": "https://stackoverflow.com/questions/59440447/removing-duplicates-from-a-list-in-haskell", "title": "removing duplicates from a list in haskell", "body": "<p>I am trying to delete consecutive duplicates in a list; for instance, given the list <code>[1,2,2,3,4]</code>, it the function I need must return <code>[1,3,4]</code>.</p>\n\n<p>My code at the end of the question, however, doesn't work if trailing duplicates are in list, like in <code>[1,2,3,4,4]</code>.</p>\n\n<p>I also want to do it in as simple terms as possible, how can I do this?</p>\n\n<pre><code>myCom :: Eq a =&gt; [a] -&gt; [a]\nmyCom (x:y:ys@(z:_))\n    | x == y    =  myCom ys\n    | otherwise = x  : myCom (y:ys)\nmyCom ys = ys\n</code></pre>\n"}, {"tags": ["haskell", "io", "stdout"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 8925336, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zgxWesHlQDY/AAAAAAAAAAI/AAAAAAAAaBc/zivyqp-Usn0/photo.jpg?sz=128", "display_name": "Filip Krawczyk", "link": "https://stackoverflow.com/users/8925336/filip-krawczyk"}, "edited": false, "score": 0, "creation_date": 1576968523, "post_id": 59440356, "comment_id": 105064428, "body": "thank you very much, i thought that when i already read from file in another function (with binding) i don&#39;t have to bind again"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 75, "user_id": 8925336, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zgxWesHlQDY/AAAAAAAAAAI/AAAAAAAAaBc/zivyqp-Usn0/photo.jpg?sz=128", "display_name": "Filip Krawczyk", "link": "https://stackoverflow.com/users/8925336/filip-krawczyk"}, "edited": false, "score": 1, "creation_date": 1576969153, "post_id": 59440356, "comment_id": 105064540, "body": "binding with <code>v &lt;- action</code> (at least in the IO context) basically means &quot;run the action <code>action</code> and store its result in the variable <code>v</code>&quot;. Reading from a file is indeed such an action which you can bind to the result of, but it doesn&#39;t make any sense to think that this stops you from binding to the results of any subsequent actions you may use. (And I encourage you to read about monads in Haskell, which will show you what&#39;s &quot;really&quot; going on here, and how, although <code>do</code> notation may look like a sequence of &quot;statements&quot; as in imperative programming, it&#39;s all just expressions under the hood.)"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 3, "last_activity_date": 1576967887, "creation_date": 1576967887, "answer_id": 59440356, "question_id": 59440307, "link": "https://stackoverflow.com/questions/59440307/how-to-print-io-string-couldnt-match-type-io-string-with-char-expected/59440356#59440356", "title": "How to print IO String - &quot;Couldn&#39;t match type \u2018IO String\u2019 with \u2018[Char]\u2019 Expected type: String Actual type: IO String&quot;", "body": "<p>The compiler's error message is actually very clear. The argument to <code>putStrLn</code> has to be a <code>String</code> (or <code>[Char]</code>, the two types are synonyms of each other), but your <code>p2</code> is not a <code>String</code> but an <code>IO String</code>.</p>\n\n<p>The same fundamental error occurs in both of the other things you say you have tried - they can't get round this issue.</p>\n\n<p>It's not totally clear what you want to do. I see two possibilities:</p>\n\n<ul>\n<li><p>if you simply want to print out a string, then you don't want the input to be an <code>IO String</code> at all, but a simple <code>String</code>. If you simply change the type signature accordingly, this will compile with no problem.</p></li>\n<li><p>perhaps you do indeed want to take an action of type <code>IO String</code> (such as <code>getLine</code>) as an input. In that case, you can use <code>do</code> notation (which you're already using anyway) to bind the <em>output</em> of the action, which is an actual <code>String</code>, to a variable and then call <code>putStrLn</code> with that:</p>\n\n<pre><code>day :: IO String -&gt; IO ()\nday p2 = do\n   putStr \"p2: \"\n   s &lt;- p2\n   putStrLn s\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 75, "user_id": 8925336, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zgxWesHlQDY/AAAAAAAAAAI/AAAAAAAAaBc/zivyqp-Usn0/photo.jpg?sz=128", "display_name": "Filip Krawczyk", "link": "https://stackoverflow.com/users/8925336/filip-krawczyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "accepted_answer_id": 59440356, "answer_count": 1, "score": 0, "last_activity_date": 1576967887, "creation_date": 1576967440, "question_id": 59440307, "link": "https://stackoverflow.com/questions/59440307/how-to-print-io-string-couldnt-match-type-io-string-with-char-expected", "title": "How to print IO String - &quot;Couldn&#39;t match type \u2018IO String\u2019 with \u2018[Char]\u2019 Expected type: String Actual type: IO String&quot;", "body": "<p>I want this function to print a given <code>IO String</code></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>day :: IO String -&gt; IO ()\nday p2 = do\n  putStr \"p2: \"\n  putStrLn p2\n</code></pre>\n\n<p>But the compiler says that it needs <code>[Char]</code>, but from what I know it's basically the same as <code>String</code>, so my question is <strong>how do I print out <code>IO String</code>?</strong></p>\n\n<p>Also this is what the error that <code>stack run</code> outputs: </p>\n\n<pre><code>    \u2022 Couldn't match type \u2018IO String\u2019 with \u2018[Char]\u2019\n      Expected type: String\n        Actual type: IO String\n    \u2022 In the first argument of \u2018putStrLn\u2019, namely \u2018p2\u2019\n      In a stmt of a 'do' block: putStrLn p2\n      In the expression: do putStrLn p2    \u2022 Couldn't match type \u2018IO String\u2019 with \u2018[Char]\u2019\n      Expected type: String\n        Actual type: IO String\n    \u2022 In the first argument of \u2018putStrLn\u2019, namely \u2018p2\u2019\n      In a stmt of a 'do' block: putStrLn p2\n      In the expression: do putStrLn p2\n   |\n17 |   putStrLn p2\n   |            ^^\n</code></pre>\n\n<p>I tried doing <code>putStr (\"p2: \" ++ p2)</code> and using <code>print</code> but with no success :(</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1576963214, "last_edit_date": 1576963214, "creation_date": 1576962495, "answer_id": 59439851, "question_id": 59439520, "link": "https://stackoverflow.com/questions/59439520/haskell-snake-program-move-fuction/59439851#59439851", "title": "Haskell Snake program move fuction", "body": "<p>The following is in no way a complete implementation of <code>doInstruction</code>, but should enable you to move forward. It passes your two test cases.</p>\n\n<h1>Just show me the code</h1>\n\n<p>Okay, here's a <em>partial</em> implementation of <code>doInstruction</code>:</p>\n\n<pre><code>doInstruction :: Instruction -&gt; Snake -&gt; Snake\ndoInstruction Move (currDir, p@(x:_), l) = (currDir, take l $ nextPos currDir x : p, l)\n</code></pre>\n\n<p>If you load it into GHCi, it'll pass the two test cases from the OP:</p>\n\n<pre><code>&gt; doInstruction Move (North, [(5, 7), (5, 6)], 2)        == (North, [(5, 8), (5, 7)], 2)\nTrue\n&gt; doInstruction Move (East, [(2, 1), (1, 1), (1, 0)], 3) == (East, [(3, 1), (2, 1), (1, 1)], 3)\nTrue\n</code></pre>\n\n<p>It'll still crash on lots of other input because it doesn't handle e.g. <code>Turn</code> instructions.</p>\n\n<h1>Explanation</h1>\n\n<p><code>doInstruction Move</code> handles the <code>Move</code> instruction exclusively. <code>(currentDir, p@(x:_), l)</code> pattern-matches the snake's current direction, it's positions, and it's length (I'm assuming that the last integer is the length).</p>\n\n<p>The <code>p@</code> syntax captures the entire position into the variable <code>p</code>. The function also needs the head of the list, so it also uses pattern matching on the list. Here, it matches only the head and ignores the tail: <code>(x:_)</code>. The underscore is the wildcard character that ignores the match, in this case the tail.</p>\n\n<p>This pattern match is also partial, because it's not going to match an empty list. You probably don't allow snakes of zero length, but if you did, this wouldn't match.</p>\n\n<p>The function uses <code>nextPos</code> to calculate the next position of the head of the snake. It <em>conses</em> (uses <code>:</code>) the resulting <code>Position</code> value onto the <code>p</code> list. This in itself creates a list that's too long, but then the function uses <code>take l</code> to take only the first <code>l</code> elements of that list.</p>\n\n<h1>Next steps</h1>\n\n<p>You should add more cases to the <code>doInstruction</code> function, e.g.</p>\n\n<pre><code>doInstruction :: Instruction -&gt; Snake -&gt; Snake\ndoInstruction Move (currDir, p@(x:_), l) = (currDir, take l $ nextPos currDir x : p, l)\ndoInstruction (Turn dir) snake = -- More code goes here...\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 8707006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/080594c9941aeca946fc0aebaa782fda?s=128&d=identicon&r=PG&f=1", "display_name": "Exyxtra", "link": "https://stackoverflow.com/users/8707006/exyxtra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576963214, "creation_date": 1576959100, "last_edit_date": 1576961459, "question_id": 59439520, "link": "https://stackoverflow.com/questions/59439520/haskell-snake-program-move-fuction", "title": "Haskell Snake program move fuction", "body": "<p>I need to do a project in Haskell, which does a snake program, but I'm stuck the last part.</p>\n\n<p>These two test case should give <code>True</code>, but I dont have an idea how should I do that:</p>\n\n<pre><code>doInstruction Move (North, [(5, 7), (5, 6)], 2)        == (North, [(5, 8), (5, 7)], 2)\ndoInstruction Move (East, [(2, 1), (1, 1), (1, 0)], 3) == (East, [(3, 1), (2, 1), (1, 1)], 3)\n</code></pre>\n\n<p>My code until that part</p>\n\n<pre><code>data Dir = West | North | East | South deriving (Eq, Show)\n\ntype Position = (Int, Int)\n\ntype Snake = (Dir, [Position], Int)\n\ndata Instruction = Move | Turn Dir deriving (Eq, Show)\n\nisOppositeDir :: Dir -&gt; Dir -&gt; Bool\nisOppositeDir West East = True\nisOppositeDir East West = True\nisOppositeDir North South = True\nisOppositeDir South North = True\nisOppositeDir _ _ = False\n\noppositeDir :: Dir -&gt; Dir\noppositeDir West = East\noppositeDir East = West\noppositeDir North = South\noppositeDir South = North\n\nnextPos :: Dir -&gt; Position -&gt; Position\nnextPos x (a,b)\n    | x == West = (a - 1 , b)\n    | x == East = (a + 1 , b)\n    | x == North = (a , b + 1)\n    | x == South = (a , b - 1)\n    | otherwise = (a , b)\n\ndoInstruction :: Instruction -&gt; Snake -&gt; Snake\ndoInstruction (Turn dir) (x, p, y) =  if isOppositeDir dir x then (x,p,y) else (dir,p,y)\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "rank-n-types"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1576946910, "post_id": 59437971, "comment_id": 105060113, "body": "Seems pretty clear to me: the return type of <code>fmap @c @c @f</code> would be <code>c (f x) (f x)</code>. If you want to use that as input type for <code>fmap @c @c @f</code>, you need <code>Obj c (f x)</code>, which is exactly what the error message is saying."}, {"owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1576946925, "post_id": 59437971, "comment_id": 105060119, "body": "Right now, I am adding <code>fobj :: forall x. Obj c x :- Obj c (f x)</code> to the definition of <code>Functor</code> and then using the <code>(\\\\)</code> operator from <code>Data.Constraint</code> to get what I want. It is a bit verbose, however. Is there any better solution?"}, {"owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1576947015, "post_id": 59437971, "comment_id": 105060144, "body": "@FyodorSoikin Ok, but why is it not able to deduce that from <code>Obj c x =&gt; Obj d (f x)</code>? How can I make it deduce that constraint automatically?"}, {"owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1576948895, "post_id": 59437971, "comment_id": 105060566, "body": "I think this is related. The last comment shows what I am trying to achieve, but it seems that there is no solution, at least yet. <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/5927\" rel=\"nofollow noreferrer\">gitlab.haskell.org/ghc/ghc/issues/5927</a>"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1576948993, "post_id": 59437971, "comment_id": 105060594, "body": "Why would it be automatically deduced? What makes you sure this is a valid implication for any <code>f</code>?"}, {"owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1576949767, "post_id": 59437971, "comment_id": 105060793, "body": "@FyodorSoikin Providing the instance for <code>Functor c c f</code> requires <code>Obj c x =&gt; Obj d (f x)</code> to hold."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1576950363, "post_id": 59437971, "comment_id": 105060908, "body": "Oh, I see. I missed that part."}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "edited": false, "score": 1, "creation_date": 1576948053, "post_id": 59438094, "comment_id": 105060378, "body": "With this solution, everytime one declares an instance of Category, one needs to construct a <code>fobj</code> using <code>Data.Constraint</code>. It would be nice to find a way for this to be automatically deduced by GHC."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1576959337, "post_id": 59438094, "comment_id": 105062798, "body": "perhaps you could use a default definition (perhaps with a default signature) to provide that implementation automatically. Something like <code>default fobj :: (forall x. Obj c x =&gt; Obj c (f x)) =&gt; Obj c x :- Obj c (f x); fobj = Sub</code>."}], "tags": [], "owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "is_accepted": false, "score": 1, "last_activity_date": 1576947149, "creation_date": 1576947149, "answer_id": 59438094, "question_id": 59437971, "link": "https://stackoverflow.com/questions/59437971/constraint-implication-as-a-constraint/59438094#59438094", "title": "Constraint implication as a constraint", "body": "<p>The following seems to work, but I do not know if this is an easier way. It uses the operator <code>(\\\\)</code> from <code>Data.Constraint</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE AllowAmbiguousTypes       #-}\n{-# LANGUAGE KindSignatures            #-}\n{-# LANGUAGE MultiParamTypeClasses     #-}\n{-# LANGUAGE RankNTypes                #-}\n{-# LANGUAGE ScopedTypeVariables       #-}\n{-# LANGUAGE TypeApplications          #-}\n{-# LANGUAGE TypeFamilies              #-}\n{-# LANGUAGE TypeOperators             #-}\n{-# LANGUAGE FlexibleContexts          #-}\n{-# LANGUAGE QuantifiedConstraints     #-}\n\nimport Prelude hiding (id, Functor, fmap)\nimport Data.Constraint\n\nclass Category c where                            \n  type Obj c a :: Constraint\n  id :: (Obj c x) =&gt; c x x\n  comp :: (Obj c x) =&gt; c y z -&gt; c x y -&gt; c x z    \n\nclass (Category c, Category d) =&gt; Functor c d f where\n  fobj :: forall x. Obj c x :- Obj c (f x)\n  fmap :: (Obj c x, Obj c y) =&gt; c x y -&gt; d (f x) (f y)\n\ndoublefmap :: forall c f x . (Category c , Functor c c f, Obj c x)\n           =&gt; c x x -&gt; c (f (f x)) (f (f x))\ndoublefmap = (fmap @c @c @f . fmap @c @c @f) \\\\ fobj @c @c @f @x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "is_accepted": false, "score": 1, "last_activity_date": 1576949860, "creation_date": 1576949860, "answer_id": 59438429, "question_id": 59437971, "link": "https://stackoverflow.com/questions/59437971/constraint-implication-as-a-constraint/59438429#59438429", "title": "Constraint implication as a constraint", "body": "<p>This is a second solution without using <code>Data.Constraint</code> that (at least to me) seems a bit more elegant.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE AllowAmbiguousTypes           #-}\n{-# LANGUAGE KindSignatures            #-}\n{-# LANGUAGE MultiParamTypeClasses     #-}\n{-# LANGUAGE RankNTypes                #-}\n{-# LANGUAGE ScopedTypeVariables       #-}\n{-# LANGUAGE TypeApplications          #-}\n{-# LANGUAGE TypeFamilies              #-}\n{-# LANGUAGE TypeOperators              #-}\n{-# LANGUAGE FlexibleContexts              #-}\n{-# LANGUAGE QuantifiedConstraints      #-}\n{-# LANGUAGE ConstraintKinds           #-}\n\nimport Prelude hiding (id, Functor, fmap)\n\nclass Category objc c where                            \n  id :: (objc x) =&gt; c x x\n  comp :: (objc x) =&gt; c y z -&gt; c x y -&gt; c x z\n\nclass (Category objc c, Category objd d, forall x . (objc x) =&gt; objd (f x))\n      =&gt; Functor objc c objd d f where\n  fmap :: (objc x, objc y) =&gt; c x y -&gt; d (f x) (f y)\n\ndoublefmap :: forall c f x objc objd . (Category objc c , Functor objc c objc c f, objc x)\n           =&gt; c x x -&gt; c (f (f x)) (f (f x))\ndoublefmap = (fmap @objc @c @objc @c @f . fmap @objc @c @objc @c @f) \n</code></pre>\n\n<p>I would be happy if someone can improve this.</p>\n"}], "owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1576960784, "creation_date": 1576946084, "last_edit_date": 1576960784, "question_id": 59437971, "link": "https://stackoverflow.com/questions/59437971/constraint-implication-as-a-constraint", "title": "Constraint implication as a constraint", "body": "<p>How can I encode a constraint implication in Haskell into a new constraint? In my example, I want to require that every <code>Functor c d f</code> needs to be such that <code>Obj c x</code> implies <code>Obj c (f x)</code>.  I am writing the constraint <code>forall x . Obj c x =&gt; Obj d (f x)</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE AllowAmbiguousTypes       #-}\n{-# LANGUAGE KindSignatures            #-}\n{-# LANGUAGE MultiParamTypeClasses     #-}\n{-# LANGUAGE RankNTypes                #-}\n{-# LANGUAGE ScopedTypeVariables       #-}\n{-# LANGUAGE TypeApplications          #-}\n{-# LANGUAGE TypeFamilies              #-}\n{-# LANGUAGE QuantifiedConstraints     #-}\n\nimport Prelude hiding (id, Functor, fmap)\nimport Data.Kind\n\nclass Category c where                            \n  type Obj c a :: Constraint                    \n  id :: (Obj c x) =&gt; c x x                        \n  comp :: (Obj c x) =&gt; c y z -&gt; c x y -&gt; c x z    \n\nclass ( Category c, Category d, forall x . Obj c x =&gt; Obj d (f x))\n      =&gt; Functor c d f where\n  fmap :: (Obj c x, Obj c y) =&gt; c x y -&gt; d (f x) (f y)\n\ndoublefmap :: forall c f x . (Category c , Functor c c f, Obj c x)\n           =&gt; c x x -&gt; c (f (f x)) (f (f x))\ndoublefmap = fmap @c @c @f . fmap @c @c @f\n</code></pre>\n\n<p>But this produces the following error:</p>\n\n<pre><code>Minimal.hs:27:14: error:\n    \u2022 Could not deduce: Obj c (f x) arising from a use of \u2018fmap\u2019\n      from the context: (Functor c c f, Obj c x)\n        bound by the type signature for:\n                   doublefmap :: forall (c :: * -&gt; * -&gt; *) (f :: * -&gt; *) x.\n                                 (Category c, Functor c c f, Obj c x) =&gt;\n                                 c x x -&gt; c (f (f x)) (f (f x))\n        at Minimal.hs:(25,1)-(26,44)\n    \u2022 In the first argument of \u2018(.)\u2019, namely \u2018fmap @c @c @f\u2019\n      In the expression: fmap @c @c @f . fmap @c @c @f\n      In an equation for \u2018doublefmap\u2019:\n          doublefmap = fmap @c @c @f . fmap @c @c @f\n    \u2022 Relevant bindings include\n        doublefmap :: c x x -&gt; c (f (f x)) (f (f x))\n          (bound at Minimal.hs:27:1)\n</code></pre>\n\n<p>What am I doing wrong here? What additional hints should I give the compiler? Is there any better way of achieving this?</p>\n\n<p>My guess is that I would need to use <code>Data.Constraint</code> and <code>:-</code>, but how?</p>\n"}, {"tags": ["parsing", "haskell", "arithmetic-expressions", "left-to-right"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1576931986, "post_id": 59436010, "comment_id": 105056905, "body": "Regardless of programming language: you should never write comments that merely repeat what the name and/or signature already say."}, {"owner": {"reputation": 949, "user_id": 3929213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/HnYvM.png?s=128&g=1", "display_name": "mikelplhts", "link": "https://stackoverflow.com/users/3929213/mikelplhts"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1576932452, "post_id": 59436010, "comment_id": 105056994, "body": "@leftaroundabout Yeah, I know. That was a mere placeholder because I was testing and I always add comments. The other parsers have appropriate comments."}, {"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 1, "creation_date": 1576942195, "post_id": 59436010, "comment_id": 105059081, "body": "<a href=\"https://www.seas.upenn.edu/~cis552/15fa/lectures/Parsers.html\" rel=\"nofollow noreferrer\">seas.upenn.edu/~cis552/15fa/lectures/Parsers.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1576959192, "creation_date": 1576959192, "answer_id": 59439531, "question_id": 59436010, "link": "https://stackoverflow.com/questions/59436010/defining-a-left-to-right-parser-for-arithmetic-expressions/59439531#59439531", "title": "Defining a left-to-right parser for arithmetic expressions", "body": "<p>The trick here is to define an <code>aexpr_int</code> parser that first parses an <code>aterm_int</code>, and then <em>recursively</em>, using a helper function on an accumulating expression, checks for multiple additional occurrences of <code>sign &gt;&gt; aterm_int</code>, adding the additional terms to the accumulator.  It might look something like this:</p>\n\n<pre><code>-- the aexpr integer parser\naexpr_int :: Parser Int\naexpr_int = do\n  a1 &lt;- aterm_int\n  go a1\n  where go expr =\n          do\n            s &lt;- sign\n            a2 &lt;- aterm_int\n            go (expr + (s * a2))\n          &lt;|&gt; return expr\n</code></pre>\n\n<p>Together with the following:</p>\n\n<pre><code>-- the aterm integer parser\naterm_int :: Parser Int\naterm_int = do\n  a1 &lt;- afactor_int\n  go a1\n  where go expr =\n          do\n            char '*'\n            a2 &lt;- afactor_int\n            go (expr * a2)\n          &lt;|&gt;\n          do\n            char '/'\n            a2 &lt;- afactor_int\n            go (div expr a2)\n          &lt;|&gt; return expr\n\n-- afactor_int\nafactor_int :: Parser Int\nafactor_int = do\n                token (char '(')\n                e &lt;- aexpr_int\n                token (char ')')\n                return e\n              &lt;|&gt;\n              do\n                s &lt;- sign\n                ic &lt;- afactor_int\n                return (s * ic)\n              &lt;|&gt;\n              token int_const\n</code></pre>\n\n<p>this seems to work correctly:</p>\n\n<pre><code>&gt; parseTest aexpr_int \"1-2-3-4\"\n-8\n</code></pre>\n\n<p>Note that, if you're using a real parser library instead of trying to write your own parser code for learning purposes, you'll want to use the library's built-in expression parser or combinators with names like <code>chainl</code> or <code>sepBy</code> to accomplish this.</p>\n"}], "owner": {"reputation": 949, "user_id": 3929213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/HnYvM.png?s=128&g=1", "display_name": "mikelplhts", "link": "https://stackoverflow.com/users/3929213/mikelplhts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "closed_date": 1577033670, "accepted_answer_id": 59439531, "answer_count": 1, "score": 4, "last_activity_date": 1576959192, "creation_date": 1576929809, "question_id": 59436010, "link": "https://stackoverflow.com/questions/59436010/defining-a-left-to-right-parser-for-arithmetic-expressions", "closed_reason": "Duplicate", "title": "Defining a left-to-right parser for arithmetic expressions", "body": "<p>I'm having a hard time defining a left-to-right arithmetic expression parser in Haskell. What I have done so far is defining a right-to-left parser, following the \"G. Hutton, Programming in Haskell\" book.</p>\n\n<pre><code>-- the aexpr integer parser\naexpr_int :: Parser Int\naexpr_int = do\n              a1 &lt;- aterm_int\n              s &lt;- sign -- return 1 for \"+\" and -1 for \"-\"\n              a2 &lt;- aexpr_int\n              return (a1 + (s * a2))\n            &lt;|&gt;\n            aterm_int\n\n-- the aterm integer parser\naterm_int :: Parser Int\naterm_int = do\n              a1 &lt;- aterm_int\n              char '*'\n              a2 &lt;- afactor_int\n              return (a1 * a2);\n            &lt;|&gt;\n            do\n              a1 &lt;- afactor_int\n              char '/'\n              a2 &lt;- aterm_int\n              return (div a1 a2)\n            &lt;|&gt;\n            afactor_int\n\n-- afactor_int\nafactor_int :: Parser Int\nafactor_int = do\n                token (char '(')\n                e &lt;- aexpr_int\n                token (char ')')\n                return e\n              &lt;|&gt; \n              do\n                s &lt;- sign \n                ic &lt;- aexpr_int \n                return (s * ic)\n              &lt;|&gt;  \n              token int_const   \n</code></pre>\n\n<p>So this parses <code>1 - 2 - 3 - 4</code> as <code>1 - (2 - (3 - 4))</code>, but I want it to parse as <code>((1 - 2) - 3) - 4</code>. How can I reach this result?</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 5, "last_activity_date": 1576880943, "creation_date": 1576880943, "answer_id": 59431969, "question_id": 59431870, "link": "https://stackoverflow.com/questions/59431870/haskell-bind-function-definition-parameter/59431969#59431969", "title": "Haskell - Bind function definition parameter", "body": "<p>You can't pattern match on variables, only on data constructors. </p>\n\n<p>But you can just compare:</p>\n\n<pre><code>newres2 k \n    | k == y    = num + num2\n    | otherwise = newres k\n</code></pre>\n\n<p>This will, of course, require that the type of <code>y</code> has an <code>Eq</code> instance, because that's where the <code>==</code> operator is defined, but this is already the case, because you're using the <code>/=</code> operator, defined in the same class.</p>\n"}], "owner": {"reputation": 1237, "user_id": 1774080, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/zhKuK.jpg?s=128&g=1", "display_name": "Noob Doob", "link": "https://stackoverflow.com/users/1774080/noob-doob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 1, "accepted_answer_id": 59431969, "answer_count": 1, "score": 1, "last_activity_date": 1576880943, "creation_date": 1576879964, "question_id": 59431870, "link": "https://stackoverflow.com/questions/59431870/haskell-bind-function-definition-parameter", "title": "Haskell - Bind function definition parameter", "body": "<p>I was trying to write a test function in Haskell to mess the idea of defining and returning functions on the fly to hold state. This is my attempt:</p>\n\n<pre><code>fib x = aux x results\n  where \n    results 0 = 1\n    results 1 = 1\n    results _ = -1\n    aux y res = ((res' y) , res')\n      where\n        res' = if res y /= -1 then res else newres2\n          where\n            (num,newres) = aux (y-1) res\n            (num2,_) = aux (y-2) newres\n\n            newres2 y = num + num2\n            newres2 k = newres k\n</code></pre>\n\n<p>My problem here is, I want <code>y</code> parameter in <code>newres2</code> definition to be binded to the <code>y</code> at the <code>aux</code> definition. I want my new definition to have the exact value <code>y</code> has up there, and pattern match to its specific value at the time this is defined at runtime. Is that possible?</p>\n"}, {"tags": ["haskell", "go", "ffi"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1576854472, "post_id": 59427395, "comment_id": 105040842, "body": "<a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 10, "creation_date": 1576861063, "post_id": 59427395, "comment_id": 105043646, "body": "You will have to go through C, their common denominator. There are tutorials for calling Haskell from C, and calling C from Go."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1576872067, "post_id": 59427395, "comment_id": 105047386, "body": "I know it isn&#39;t always an option, but if you can avoid sharing an address space and instead use IPC in some way then you&#39;ll save yourself some pain."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 4, "last_activity_date": 1576895657, "creation_date": 1576895657, "answer_id": 59433103, "question_id": 59427395, "link": "https://stackoverflow.com/questions/59427395/how-can-i-call-a-haskell-function-from-golang/59433103#59433103", "title": "How can I call a Haskell function from Golang?", "body": "<p>As already mentioned in the comments, you need to go through C.</p>\n\n<p>Good news: the python binding you have goes through C already. It means that haskell code exposes all the necessary API as C functions, you just need to find out how the API looks like and call it using <code>cgo</code>. You probably don't need to know anything about haskell.</p>\n\n<p>Assuming you have access to the source code, you should look for <code>*.c</code> and <code>*.h</code> files (often located in a <code>cbits</code> folder). If you don't know C, then ask your teammates to help.</p>\n\n<p>If you don't have access to the code, then you may try to guess the C API using the python binding. Though it'll be quite hard.</p>\n"}], "owner": {"reputation": 5488, "user_id": 3015734, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/31ccee0370328a7c894902c0a70373f7?s=128&d=identicon&r=PG", "display_name": "Tgsmith61591", "link": "https://stackoverflow.com/users/3015734/tgsmith61591"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1577155072, "creation_date": 1576854385, "last_edit_date": 1577155072, "question_id": 59427395, "link": "https://stackoverflow.com/questions/59427395/how-can-i-call-a-haskell-function-from-golang", "title": "How can I call a Haskell function from Golang?", "body": "<p>I am a python developer making the shift to Golang, so I'm sorry for the noob question. I am responsible for taking some Haskell code, for which we have python bindings, and making it callable from Go. I have a shared object file, <code>_foo.so</code>, that I want to somehow import into Go and call a la:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    f \"_foo.so\"\n)\n\nfunc DoBar() {\n    return f.Bar()\n}\n</code></pre>\n\n<p>Is this possible? I don't even have the first idea of where to begin, but I'm hoping that pseudo code gets the idea across.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1576856192, "post_id": 59426940, "comment_id": 105041588, "body": "Interesting, but <b>a)</b> could this actually be used in a Van Laarhoven setting? <b>b)</b> is that really necessary, profunctors over a Kleisli category? Seems we&#39;re going a bit far with the abstractions."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1576857009, "post_id": 59426940, "comment_id": 105041956, "body": "<b>a)</b> VL lenses already don&#39;t generalize to prisms and isos; the lens library tries hard to keep the types compatible, but it really is using profunctor optics by the point you&#39;re talking about the <code>Optic</code> synonym  <b>b)</b> If you take what I said and set <code>m = Maybe</code>, then you get exactly what the question needs. It doesn&#39;t require any additional work beyond that one substitution to fit the abstraction to the problem, so as far as abstractions go, I would argue this one is pretty tame."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1576858648, "post_id": 59426940, "comment_id": 105042648, "body": "Now it does seem that the special case of <code>Maybe</code> is important to see <code>KIso</code> as a subtype of <code>Prism</code>, so you have a point."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1577624929, "post_id": 59426940, "comment_id": 105210242, "body": "@Li-yaoXia What do you mean by &quot;it really is using profunctor optics&quot;? Doesn&#39;t <code>lens</code> have the extra <code>f</code> parameter there?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1577637094, "post_id": 59426940, "comment_id": 105213325, "body": "The <code>f</code> has little relevance when you&#39;re quantifying over <code>p</code>. You can do the same operations on <code>p a (f b)</code> for some abstract profunctor <code>p</code> and functor <code>f</code>, as on <code>q a b</code> for some abstract profunctor <code>q</code> (i.e., to construct an <code>Iso</code>). The constraints on <code>p</code> and <code>f</code> may be different from those on <code>q</code> as you go down the optic hierarchy, but they can be translated back and forth (at the very least by just decomposing <code>q</code> back into <code>p</code> and <code>f</code>)."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 4, "last_activity_date": 1576858103, "last_edit_date": 1576858103, "creation_date": 1576852342, "answer_id": 59426940, "question_id": 59426379, "link": "https://stackoverflow.com/questions/59426379/optic-for-partial-conversion-on-both-sides/59426940#59426940", "title": "Optic for partial conversion on both sides", "body": "<p>You can generalize <code>Iso</code>s (i.e., <code>(s -&gt; a, b -&gt; t)</code>) into <code>(s -&gt; m a, b -&gt; m t)</code> by replacing profunctors over Hask (i.e., <code>Profunctor</code>, that's the constraint in the definition of <code>Iso</code> as an <code>Optic</code>) with profunctors over Kleisli categories (here for the <code>Maybe</code> monad).</p>\n\n<pre><code>class Monad m =&gt; KProfunctor m p where\n  dimapM :: (s -&gt; m a) -&gt; (b -&gt; m t) -&gt; p a b -&gt; p s t\n\n-- dimapM pure pure = id\n-- dimapM f g . dimapM h i = dimapM (h &gt;=&gt; f) (g &gt;=&gt; i)\n\ntype Optic p s t a b = p a b -&gt; p s t\ntype KIso m s t a b = forall p. KProfunctor m p =&gt; Optic p s t a b\n</code></pre>\n\n<p>To construct one example of such profunctor, take the type of pseudo-isos <code>(s -&gt; m a, b -&gt; m t)</code> that we are trying to work with in the first place, and put <code>s</code> and <code>t</code> as the main indices:</p>\n\n<pre><code>data PseudoIso m a b s t = MkPseudoIso\n  { toM :: s -&gt; m a\n  , fromM :: b -&gt; m t\n  }\n\ninstance Monad m =&gt; KProfunctor m (PseudoIso m) where\n  -- exercise for the reader\n</code></pre>\n\n<ul>\n<li>To go from <code>PseudoIso</code> to <code>KIso</code>, use <code>dimapM</code> (the fields of <code>PseudoIso</code> are exactly the right type for the arguments of <code>dimapM</code>)</li>\n<li>To go from <code>KIso</code> to <code>PseudoIso</code>, partially apply to the identity <code>PseudoIso a b a b</code></li>\n</ul>\n\n<p>Actually, it doesn't have to be a Kleisli category. A profunctor over any category <code>(:-&gt;) :: k -&gt; k -&gt; Type</code> will give you a class of optics of the form <code>(s :-&gt; a, b :-&gt; t)</code>.</p>\n\n<p>Note: you can define an instance of <code>Choice</code> with <code>KProfunctor Maybe</code>, so maybe everything should really be specialized to <code>Maybe</code> so <code>Choice</code> could reasonably be added as a superclass of <code>KProfunctor</code>, then <code>KIso</code> would be a subtype of <code>Prism</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 3, "last_activity_date": 1576985289, "creation_date": 1576985289, "answer_id": 59441415, "question_id": 59426379, "link": "https://stackoverflow.com/questions/59426379/optic-for-partial-conversion-on-both-sides/59441415#59441415", "title": "Optic for partial conversion on both sides", "body": "<p>Let us look at profunctor encoding. It's simpler.</p>\n\n<p><code>Choice</code> is a class for <code>Prism</code>s, we are making subclass of <code>Prisms</code>, so <code>Choice</code> is natural choice for a superclass:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Choice p =&gt; Weird p where\n    weird :: (s -&gt; Maybe a) -&gt; (b -&gt; Maybe t) -&gt; p a b -&gt; p s t\n</code></pre>\n\n<p>If we try to write an instance for <code>p = (-&gt;)</code>, it won't work.\nSo our new kind of optics is not a superclass of <code>Setter</code>.</p>\n\n<p>The hierarchy would probably look something like: at best probably something like\n(Can a <code>Traversal</code> and thus <code>Lens</code> be turned into the new <code>Weird</code> optic, maybe?)</p>\n\n<pre><code>     Lens\n   /     \\\nIso       Traversal -&gt; Setter\n   \\      /\n     Prism\n         \\ \n           Weird\n</code></pre>\n\n<hr>\n\n<p>Let's try with another concrete <code>Profunctor</code>s.\nI'll use types as defined in <a href=\"https://oleg.fi/gists/posts/2017-04-18-glassery.html\" rel=\"nofollow noreferrer\">my blog post: Glassery</a></p>\n\n<p><code>ForgetM</code> is used to implement <code>preview</code></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Optic' p s a = p a a -&gt; p s s\n\npreview :: Optic' (ForgetM a) s a -&gt; s -&gt; Maybe a\npreview o = runForgetM (o (ForgetM Just))\n\nnewtype ForgetM r a b = ForgetM { runForgetM :: a -&gt; Maybe r }\n\ninstance Profunctor (ForgetM r) where\n    dimap f _ (ForgetM p) = ForgetM (p . f)\n\ninstance Choice (ForgetM r) where\n    right' (ForgetM p) = ForgetM (either (const Nothing) p)\n\ninstance Weird (ForgetM r) where\n    weird sa _bt (ForgetM ab) = ForgetM $ \\s -&gt; sa s &gt;&gt;= ab\n</code></pre>\n\n<p><code>TaggedM</code> can be used to define something in oppisite direction (not in <code>Glassery</code>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>repreview :: Optic' TaggedM s a -&gt; a -&gt; Maybe s\nrepreview o a = unTaggedM (o (TaggedM (Just a)))\n\nnewtype TaggedM a b = TaggedM { unTaggedM :: Maybe b }\n\ninstance Profunctor TaggedM where\n    dimap _sa bt (TaggedM b) = TaggedM (fmap bt b)\n\ninstance Choice TaggedM where\n    right' (TaggedM b) = TaggedM (fmap Right b)\n\ninstance Weird TaggedM where\n    weird _sa bt (TaggedM b) = TaggedM (b &gt;&gt;= bt)\n</code></pre>\n\n<p>We can now try this.</p>\n\n<p>Simple case works:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt; preview (weird Just Just) 'x'\nJust 'x'\n*Main&gt; repreview (weird Just Just) 'x'\nJust 'x'\n</code></pre>\n\n<p>Prisms can be used as new thing (thing <code>right' = _Right</code>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt; preview right' (Left 'x')\nNothing\n*Main&gt; preview right' (Right 'x')\nJust 'x'\n</code></pre>\n\n<hr>\n\n<p>There's also a nice symmetric <code>Profunctor</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Re p s t a b = Re { runRe :: p b a -&gt; p t s }\n\ninstance Profunctor p =&gt; Profunctor (Re p s t) where\n    dimap f g (Re p) = Re (p . dimap g f)\n\ninstance Cochoice p =&gt; Choice (Re p s t) where\n    right' (Re p) = Re (p . unright)\n\ninstance Choice p =&gt; Cochoice (Re p s t) where\n    unright (Re p) = Re (p . right')\n</code></pre>\n\n<p>and we can write <code>Weird</code> instance for it:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Weird p =&gt; Weird (Re p s t) where\n    weird sa bt (Re p) = Re (p . weird bt sa)\n</code></pre>\n\n<p>And we notice that, we need to add <code>Cochoice</code> to be the superclass of <code>Weird</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class (Choice p, Cochoice p) =&gt; Weird p where\n    weird :: (s -&gt; Maybe a) -&gt; (b -&gt; Maybe t) -&gt; p a b -&gt; p s t\n</code></pre>\n\n<p>That starts to look promising.</p>\n\n<hr>\n\n<p>van-Laarhoven. That's tricky.</p>\n\n<p>Compare <code>Prism</code> in profunctor and VL encodings:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type PrismVL s t a b = forall f p. (Choice p, Applicative f) =&gt; p a (f b) -&gt; p s (f t)\ntype PrismP  s t a b = forall   p. (Choice p)                =&gt; p a    b  -&gt; p s    t\n</code></pre>\n\n<p>The good start is to assume that this <code>Weird</code> thing would look like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type WeirdOptic s t a b = forall p f. (Weird p, Applicative f) =&gt; Optic p f s t a b\n</code></pre>\n\n<p>Maybe we would need to strengten the <code>f</code> constraint too, a bit.</p>\n\n<p>But I leave something for you to experiment with.\nAlso an open question is what's the intuition behind this new <code>Weird</code> optic;\nand what laws it should have (to be an optic, and not just two functions\nsmashed together). It feels than trying to do similar <code>Monad</code> / <code>Kleisli</code> optic\nwith anything fancier than <code>Maybe</code> is difficult, but maybe it would work out too.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1577654522, "post_id": 59520588, "comment_id": 105217827, "body": "Your <code>Fallback</code> looks an awful lot like <code>Data.Witherable.Filterable</code>. Is there a reason not to use that here?"}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1577717661, "post_id": 59520588, "comment_id": 105235031, "body": "@dfeuer Now that you brought it to my attention I&#39;ll use it, thanks! I tried finding something like it but my google and hoogle skills might be lacking"}], "tags": [], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "is_accepted": true, "score": 3, "last_activity_date": 1577721351, "last_edit_date": 1577721351, "creation_date": 1577632128, "answer_id": 59520588, "question_id": 59426379, "link": "https://stackoverflow.com/questions/59426379/optic-for-partial-conversion-on-both-sides/59520588#59520588", "title": "Optic for partial conversion on both sides", "body": "<p>Here's a solution in <code>lens</code>-style optics (rather than profunctor optics as in the other answers) using the <a href=\"https://hackage.haskell.org/package/witherable-0.3.5/docs/Data-Witherable.html#t:Filterable\" rel=\"nofollow noreferrer\"><code>Filterable</code></a> type-class:</p>\n\n<pre><code>-- A partial variant of (#) for partial reviews\ninfixr 8 #?\n(#?) :: Optic Tagged Maybe s t a b -&gt; b -&gt; Maybe t\nf #? b = Just b &amp; Tagged &amp; f &amp; unTagged\n\n-- A Prism \"turned around\", i.e a getter but a partial review\ntype InvPrism s t a b =\n    forall p f. (Profunctor p, Filterable f) =&gt; Optic p f s t a b\n\n-- A partial iso-morphism, i.e a partial getter and partial review\ntype PartialIso s t a b =\n    forall p f. (Choice p, Applicative f, Filterable f) =&gt; Optic p f s t a b\n\n-- Turn APrism around\ninvPrism :: APrism b a t s -&gt; InvPrism s t a b\ninvPrism p =\n    dimap\n    (review (reviewing (clonePrism p)))\n    (mapMaybe (^? getting (clonePrism p)))\n\n-- Create a PartialIso from two partial conversions\npartialIso :: (s -&gt; Maybe a) -&gt; (b -&gt; Maybe t) -&gt; PartialIso s t a b\npartialIso sma ams =\n    dimap\n    (maybe (Left ()) Right . sma)\n    (catMaybes . either (const (pure Nothing)) (fmap ams)) .\n    right'\n\n-- Coerce APrism to an Optic'\nreviewing ::\n    (Choice p, Bifunctor p, Functor f, Settable f) =&gt;\n    APrism s t a b -&gt; Optic' p f t b\nreviewing p =\n    bimap f (fmap f)\n    where\n        f = runIdentity . unTagged . clonePrism p . Tagged . Identity\n</code></pre>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 59520588, "answer_count": 3, "score": 4, "last_activity_date": 1577721351, "creation_date": 1576850022, "question_id": 59426379, "link": "https://stackoverflow.com/questions/59426379/optic-for-partial-conversion-on-both-sides", "title": "Optic for partial conversion on both sides", "body": "<p><code>Prism</code> is like <code>Iso</code> except one of the two conversions is partial. Is there an optic where both conversions are partial?</p>\n\n<p>Of course one can create a type <code>(s -&gt; Maybe a, b -&gt; Maybe t)</code> but I'm wondering if such a thing could be expressed an as <a href=\"http://hackage.haskell.org/package/lens-4.18.1/docs/Control-Lens-Type.html#t:Optic\" rel=\"nofollow noreferrer\"><code>Optic _ _</code></a>?</p>\n"}, {"tags": ["postgresql", "haskell", "haskell-stack", "haskell-persistent"], "answers": [{"comments": [{"owner": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "edited": false, "score": 0, "creation_date": 1576852036, "post_id": 59425471, "comment_id": 105039751, "body": "I tried a few new things, none of which really helped. I installed postgresql and followed several stackoverflow or gitlab issue suggestions on how to add the libpq.dll to my build file. However, no matter what I try, the error remains the same. How can I ensure the both libpq.dll and pg_config is loaded?"}, {"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "reply_to_user": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "edited": false, "score": 0, "creation_date": 1576853006, "post_id": 59425471, "comment_id": 105040188, "body": "They don&#39;t have to be loaded, they have to be installed. All you have to do is set the <code>PATH</code> environment variable to include the directory that contains <code>pg_config</code>. If you have trouble, ask somebody for help who knows Windows."}, {"owner": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "edited": false, "score": 0, "creation_date": 1576854001, "post_id": 59425471, "comment_id": 105040635, "body": "Oh, didn&#39;t know that was all, this and adding the path to the build file solved the problem, thanks. Now however, while building correctly, it complains about libssl-1_1-x64.dll being missing, but it is present in the /bin folder"}, {"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "reply_to_user": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "edited": false, "score": 0, "creation_date": 1576855813, "post_id": 59425471, "comment_id": 105041425, "body": "Well, you have to make sure that all the directories with required DLLs are on the <code>PATH</code>."}], "tags": [], "owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "is_accepted": true, "score": 4, "last_activity_date": 1576845800, "creation_date": 1576845800, "answer_id": 59425471, "question_id": 59424560, "link": "https://stackoverflow.com/questions/59424560/haskell-and-postgresql-build-error-the-program-pg-config-is-required-but-it-c/59425471#59425471", "title": "Haskell and postgresql - build error &quot;The program pg_config is required but it could not be found.&quot;", "body": "<p>It looks like Haskell is trying to build with the PostgreSQL client shared library <code>libpq.dll</code> and uses <code>pg_config</code> at build time to determine where PostgreSQL is installed and how it was built.</p>\n\n<p>That would mean that you have to install PostgreSQL on the machine where you build Haskell, including the header files, build environment or however it is called by the installer.</p>\n\n<p>For running Haskell you would only need <code>libpq.dll</code> and the dependent shared libraries.</p>\n"}], "owner": {"reputation": 46, "user_id": 5828133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4830dec8f309c392c65ece1fc97d757e?s=128&d=identicon&r=PG&f=1", "display_name": "B16", "link": "https://stackoverflow.com/users/5828133/b16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 59425471, "answer_count": 1, "score": 0, "last_activity_date": 1576845800, "creation_date": 1576841273, "question_id": 59424560, "link": "https://stackoverflow.com/questions/59424560/haskell-and-postgresql-build-error-the-program-pg-config-is-required-but-it-c", "title": "Haskell and postgresql - build error &quot;The program pg_config is required but it could not be found.&quot;", "body": "<p>I am currently learning haskell and just tried using postgresql as a database.\n<br>\nI generated my project with stack (<code>stack new &lt;name&gt;</code> -> <code>stack setup</code> -> <code>stack build</code>)\nand then all I changed was adding the dependencies needed to persistent and postgresql to the\npackage.yaml file (under \"dependencies:\").\n<br>\nThese are:</p>\n\n<ul>\n<li>persistent</li>\n<li>persistent-postgresql</li>\n<li>persistent-template</li>\n</ul>\n\n<p>This however results in a failing build with the following message:\n<br>\npostgresql-libpq     > setup.exe: The program 'pg_config' is required but it could not be found.\n<br>\npostgresql-libpq     >\n<br>\n--  While building package postgresql-libpq-0.9.4.2 using:\n      C:\\Users\\\\AppData\\Local\\Temp\\stack14388\\postgresql-libpq-0.9.4.2.stack-work\\dist\\e626a42b\\setup\\setup --builddir=.stack-work\\dist\\e626a42b configure --user --package-db=clear --package-db=global --package-db=C:\\sr\\snapshots\\365a3dde\\pkgdb --libdir=C:\\sr\\snapshots\\365a3dde\\lib --bindir=C:\\sr\\snapshots\\365a3dde\\bin --datadir=C:\\sr\\snapshots\\365a3dde\\share --libexecdir=C:\\sr\\snapshots\\365a3dde\\libexec --sysconfdir=C:\\sr\\snapshots\\365a3dde\\etc --docdir=C:\\sr\\snapshots\\365a3dde\\doc\\postgresql-libpq-0.9.4.2 --htmldir=C:\\sr\\snapshots\\365a3dde\\doc\\postgresql-libpq-0.9.4.2 --haddockdir=C:\\sr\\snapshots\\365a3dde\\doc\\postgresql-libpq-0.9.4.2 --dependency=Cabal=Cabal-2.4.1.0-5rQrtDcYhR2LOcYye7obEr --dependency=Win32=Win32-2.6.1.0 --dependency=base=base-4.12.0.0 --dependency=bytestring=bytestring-0.10.8.2 -f-use-pkg-config --extra-include-dirs=C:\\Users\\\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20180531\\mingw64\\include --extra-lib-dirs=C:\\Users\\\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20180531\\mingw64\\lib --extra-lib-dirs=C:\\Users\\\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20180531\\mingw64\\bin --exact-configuration --ghc-option=-fhide-source-paths\n    Process exited with code: ExitFailure 1</p>\n\n<p><br><br>\nDoes anyone know how to resolve this issue and why it even occurs?\n<br>\nDo I have to install postgresql just for being able to run build the project? If so, how would you\ndo this in production, when the database could basically lie everywhere?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1576840009, "post_id": 59424164, "comment_id": 105034567, "body": "You can not use <code>writeFile</code> here since that has type <code>String -&gt; String -&gt; IO ()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 9, "last_activity_date": 1576841416, "creation_date": 1576841416, "answer_id": 59424598, "question_id": 59424164, "link": "https://stackoverflow.com/questions/59424164/is-it-possible-to-use-writefile-inside-out-of-the-main-function-in-haskell/59424598#59424598", "title": "Is it possible to use writeFile inside out of the main function (in haskell)?", "body": "<p>The <code>writeFile</code> function has the type <code>FilePath -&gt; String -&gt; IO ()</code>, which means that it must run in the <code>IO</code> context.</p>\n\n<p>It doesn't <em>have</em> to run in the <code>main</code> function, but any function that involves <code>IO</code>, including <code>writeFile</code>, will have a return type that involves <code>IO</code>. So you could definitely do something like this:</p>\n\n<pre><code>myFunc :: String -&gt; IO ()\nmyFunc contents = do\n  -- do something else\n  writeFile \"foo.txt\" contents\n  -- do more stuff here\n</code></pre>\n\n<p>You can't, however, call functions that return <code>IO a</code> from pure functions (or, rather, <a href=\"https://stackoverflow.com/a/51620647/126014\">you can't extract the value from the IO container</a>). That's by design; it's how Haskell works, and <a href=\"https://blog.ploeh.dk/2018/11/19/functional-architecture-a-definition\" rel=\"noreferrer\">it's a good thing</a>. If you want to enable users to perform impure actions at arbitrary times, you must design for such a feature. <a href=\"https://blog.ploeh.dk/2017/07/10/pure-interactions\" rel=\"noreferrer\">Here's my introduction to pure interactions</a> - that's one place to start.</p>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 7, "last_activity_date": 1576849037, "last_edit_date": 1576849037, "creation_date": 1576841492, "answer_id": 59424610, "question_id": 59424164, "link": "https://stackoverflow.com/questions/59424164/is-it-possible-to-use-writefile-inside-out-of-the-main-function-in-haskell/59424610#59424610", "title": "Is it possible to use writeFile inside out of the main function (in haskell)?", "body": "<p>Yes, you can use <code>writeFile</code> in other places than <code>main</code>, but for a place to qualify, the type <code>IO</code> has to be a part of that place's type signature. (The reason I'm saying <em>place</em> is because <code>main</code> isn't a function, but your <code>concat</code> <em>is</em> a function. And the place you want to look at putting your <code>writeFile</code> call has to be an <code>IO</code> <em>action</em>, which can be the result of a function or not.)</p>\n\n<p>You mentioned saving something related to a game into a .txt file. An example of that could be:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>saveGame :: FilePath -&gt; GameState -&gt; IO ()\nsaveGame gameFile gameState =\n  writeFile gameFile (serializeGame gameState)\n\nserializeGame :: GameState -&gt; String\nserializeGame (GameState ...) = ...\n\nrunGame :: GameState -&gt; IO ()\nrunGame gameState = do\n  ...\n  if wantsToSaveGame\n    then saveGame gameFile gameState\n    else ...\n  ...\n  runGame updatedGameState\n\nmain :: IO ()\nmain = do\n  ...\n  runGame initialGameState\n</code></pre>\n\n<p>In this contrived example, <code>serializeGame</code> would not be a suitable place to call <code>saveGame</code> because it's a pure function, whereas <code>runGame</code> is a self-recursive <code>IO ()</code> action capable of affecting files on your file system.</p>\n\n<p>An example of a related <code>IO</code> action that <em>isn't</em> a function could be this one:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>resetSaveGame :: IO ()\nresetSaveGame =\n  saveGame defaultGameFile initialGameState\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11250729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab0ddfe22353c1257870e3e47906a1d?s=128&d=identicon&r=PG&f=1", "display_name": "yam", "link": "https://stackoverflow.com/users/11250729/yam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1576849037, "creation_date": 1576839766, "last_edit_date": 1576841490, "question_id": 59424164, "link": "https://stackoverflow.com/questions/59424164/is-it-possible-to-use-writefile-inside-out-of-the-main-function-in-haskell", "title": "Is it possible to use writeFile inside out of the main function (in haskell)?", "body": "<p>I am still a beginner in Haskell, so after reading some <code>writefile</code> tutorials online, I see most of the <code>writefile</code> examples online are used inside the <code>main</code> function (main = IO ())</p>\n\n<p>I am wondering whether it's possible to write a function that writes the results into a file using <code>writefile</code> when it is computed? In some programs (especially games), users might want to stop at a particular points of the game by saving the contents into a .txt file.</p>\n\n<p>For example something like this: (this function does not work, just wondering how to make it work)</p>\n\n<pre><code>concat :: FilePath -&gt; [[a]] -&gt; [a]\nconcat txt [] = []`\nconcat txt (xs : xss) = do\ny &lt;- xs ++ concat xss\nwriteFile txt (unlines y)\n</code></pre>\n\n<p>Thanks:)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1576839819, "post_id": 59424157, "comment_id": 105034493, "body": "<code>Dir</code>, <code>Position</code>, etc. are not <i>values</i> (dat constructors), but types. Hence that does not make much sense."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1576842731, "post_id": 59424157, "comment_id": 105035676, "body": "Casing of names is crucial in Haskell. In particular all variables, including functions, must start with a lowercase letter - the only exception is constructor functions, which are defined as part of <code>data</code> (and <code>newtype</code>) declarations. Had you use <code>dir</code> instead of <code>Dir</code> here you would have been fine."}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 12189211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916d741c3407c241c286e5b38d11478f?s=128&d=identicon&r=PG&f=1", "display_name": "vNSkyline", "link": "https://stackoverflow.com/users/12189211/vnskyline"}, "edited": false, "score": 0, "creation_date": 1576844975, "post_id": 59424220, "comment_id": 105036578, "body": "Now it&#39;s working fine for the Turn instruction, but the Move not coming together. It looks like this : <code>doInstruction (Move) (d, p, l) = (d, nextPos d p, l)</code> and i got typerrors for [Poistion] and Position"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 93, "user_id": 12189211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916d741c3407c241c286e5b38d11478f?s=128&d=identicon&r=PG&f=1", "display_name": "vNSkyline", "link": "https://stackoverflow.com/users/12189211/vnskyline"}, "edited": false, "score": 0, "creation_date": 1576846809, "post_id": 59424220, "comment_id": 105037346, "body": "@vNSkyline You have that <code>p</code> is a list-of-positions, but <code>nextPos</code> only expects one position. Also, <code>nextPos</code> only returns a single position, while you need a list-of-positions in the tuple. I&#39;d recommend to write an auxiliary function <code>nextPosList ::  Dir -&gt; [Position] -&gt; [Position]</code> which can exploit your <code>nextPos</code>. You probaly need to &quot;move&quot; the snake, removing the last element from the list, and adding the new one in the front (or vice versa, depending on which side of the list is the &quot;head&quot; of the snake)."}, {"owner": {"reputation": 93, "user_id": 12189211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916d741c3407c241c286e5b38d11478f?s=128&d=identicon&r=PG&f=1", "display_name": "vNSkyline", "link": "https://stackoverflow.com/users/12189211/vnskyline"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1576848631, "post_id": 59424220, "comment_id": 105038146, "body": "@chi That&#39;s sound good, but how can i iterate through the list of tuples and change their value, or remove them and insert new ones applied with the <code>nextPos</code> function?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 93, "user_id": 12189211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916d741c3407c241c286e5b38d11478f?s=128&d=identicon&r=PG&f=1", "display_name": "vNSkyline", "link": "https://stackoverflow.com/users/12189211/vnskyline"}, "edited": false, "score": 1, "creation_date": 1576859421, "post_id": 59424220, "comment_id": 105042994, "body": "@vNSkyline If I understood correctly, you don&#39;t need to change their values very much. You need to drop the last (<code>init</code> does that), and prepend the new one (<code>x:xs</code> prepends <code>x</code> to <code>xs</code>). Don&#39;t think of the snake as an array (where you would need to change each cell), but as a list (where you can append/prepend cells)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1576839943, "creation_date": 1576839943, "answer_id": 59424220, "question_id": 59424157, "link": "https://stackoverflow.com/questions/59424157/simple-snake-game-function-in-haskell/59424220#59424220", "title": "Simple Snake game function in haskell", "body": "<p>You need to use <em>pattern matching</em> to \"unpack\" the data constructor. Variables in Haskell start with a <em>lowercase</em>. We thus can unpack the <code>Instruction</code> object, and the 3-tuple that represents the snake:</p>\n\n<pre><code>doInstruction :: Instruction -&gt; Snake -&gt; Snake\ndoInstruction <b>(Turn dir) (_, p, l)</b> = (<b>dir, p, l</b>)</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 12189211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916d741c3407c241c286e5b38d11478f?s=128&d=identicon&r=PG&f=1", "display_name": "vNSkyline", "link": "https://stackoverflow.com/users/12189211/vnskyline"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 59424220, "answer_count": 1, "score": 4, "last_activity_date": 1576839943, "creation_date": 1576839749, "question_id": 59424157, "link": "https://stackoverflow.com/questions/59424157/simple-snake-game-function-in-haskell", "title": "Simple Snake game function in haskell", "body": "<p>I need to write a simple snake game for my final school project but i got stuck on my last function. I guess I don't really know how to use the datastructures perfectly. The funcition <code>doInstruction</code> should give back True for this testcase <code>doInstruction (Turn East) (North, [(5, 7), (5, 6)], 2) == (East, [(5, 7), (5, 6)], 2)</code> What am I doing wrong?</p>\n\n<p>My code:</p>\n\n<pre><code>data Dir = West\n    | North\n    | East\n    | South deriving (Eq, Show)\n\ntype Position = (Int, Int)\ntype Snake = (Dir, [Position], Int)\n\ndata Instruction = Move | Turn Dir deriving (Eq, Show)\n\nisOppositeDir :: Dir -&gt; Dir -&gt; Bool\nisOppositeDir West East = True\nisOppositeDir East West = True\nisOppositeDir North South = True\nisOppositeDir South North = True\nisOppositeDir _ _ = False\n\noppositeDir :: Dir -&gt; Dir\noppositeDir West = East\noppositeDir East = West\noppositeDir North = South\noppositeDir South = North\n\nnextPos :: Dir -&gt; Position -&gt; Position\nnextPos x (a,b)\n    | x == West = (a - 1 , b)\n    | x == East = (a + 1 , b)\n    | x == North = (a , b + 1)\n    | x == South = (a , b - 1)\n    | otherwise = (a , b)\n\ndoInstruction :: Instruction -&gt; Snake -&gt; Snake\ndoInstruction ins s \n    | ins == Turn Dir = (oppositeDir Dir, [Position], length [Position])\n</code></pre>\n\n<p>The errors I get: </p>\n\n<pre><code>E:\\\\ELTE\\2019_1_Funkcprog\\hf13.hs:34:19: error:\n    Data constructor not in scope: Dir :: Dir\n   |\n34 |     | ins == Turn Dir = (oppositeDir Dir, [Position], length [Position])\n   |                   ^^^\n\nE:\\\\ELTE\\2019_1_Funkcprog\\hf13.hs:34:38: error:\n    Data constructor not in scope: Dir :: Dir\n   |\n34 |     | ins == Turn Dir = (oppositeDir Dir, [Position], length [Position])\n   |                                      ^^^\n\nE:\\\\ELTE\\2019_1_Funkcprog\\hf13.hs:34:44: error:\n    Data constructor not in scope: Position :: Position\n   |\n34 |     | ins == Turn Dir = (oppositeDir Dir, [Position], length [Position])\n   |                                            ^^^^^^^^\n\nE:\\\\ELTE\\2019_1_Funkcprog\\hf13.hs:34:63: error:\n    Data constructor not in scope: Position\n   |\n34 |     | ins == Turn Dir = (oppositeDir Dir, [Position], length [Position])\n   |                                                               ^^^^^^^^\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "graph", "functional-programming", "depth-first-search"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576837540, "post_id": 59423606, "comment_id": 105033536, "body": "I do not really see why your <code>dfs</code> aims to return a <code>Graph a</code>. Shouldn&#39;t <code>dfs</code> return a path, or a list of paths?"}, {"owner": {"reputation": 697, "user_id": 2897208, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ed280d1219b487ec15a1ede0c9461350?s=128&d=identicon&r=PG&f=1", "display_name": "mboronin", "link": "https://stackoverflow.com/users/2897208/mboronin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576837933, "post_id": 59423606, "comment_id": 105033735, "body": "@WillemVanOnsem the way I was seeing it, is that it should return a subgraph with all the reachable nodes from the node in the input. What is called a connected component, I guess."}, {"owner": {"reputation": 697, "user_id": 2897208, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ed280d1219b487ec15a1ede0c9461350?s=128&d=identicon&r=PG&f=1", "display_name": "mboronin", "link": "https://stackoverflow.com/users/2897208/mboronin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576838073, "post_id": 59423606, "comment_id": 105033795, "body": "Or maybe it makes sense to get all the neighbors for the entire list. But then I am not sure, how to create a function connectedComponent :: Graph a -&gt; Graph a, which will create an emtpy graph and adding all the vertices and edes inside"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576838216, "post_id": 59423606, "comment_id": 105033848, "body": "but then it is not DFS itself you are implementing, but an algorithm (that might make use of dfs as a subrouting): <a href=\"https://en.wikipedia.org/wiki/Strongly_connected_component#Algorithms\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Strongly_connected_component#Algorithm&zwnj;&#8203;s</a>"}, {"owner": {"reputation": 697, "user_id": 2897208, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ed280d1219b487ec15a1ede0c9461350?s=128&d=identicon&r=PG&f=1", "display_name": "mboronin", "link": "https://stackoverflow.com/users/2897208/mboronin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576839823, "post_id": 59423606, "comment_id": 105034496, "body": "@WillemVanOnsem thank you, that actually makes sense, however I need to retrieve a connected component, not a strongly connected."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1576843297, "post_id": 59423606, "comment_id": 105035933, "body": "<a href=\"https://stackoverflow.com/tags/dfs/info\">stackoverflow.com/tags/dfs/info</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 0, "creation_date": 1576854420, "post_id": 59425951, "comment_id": 105040819, "body": "to dfs to work you should keep track of visited nodes somewhere (in vs in your code.) It should start empty and grow as you visit nodes"}], "tags": [], "owner": {"reputation": 697, "user_id": 2897208, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ed280d1219b487ec15a1ede0c9461350?s=128&d=identicon&r=PG&f=1", "display_name": "mboronin", "link": "https://stackoverflow.com/users/2897208/mboronin"}, "is_accepted": false, "score": 0, "last_activity_date": 1576848137, "creation_date": 1576848137, "answer_id": 59425951, "question_id": 59423606, "link": "https://stackoverflow.com/questions/59423606/dfs-implementation-for-abstract-graph-in-haskell/59425951#59425951", "title": "DFS implementation for abstract graph in Haskell", "body": "<p>Here is what I've done in the end, works correctly for me.  </p>\n\n<pre><code>connectedComponent :: Eq a =&gt; Graph a -&gt; a -&gt; Graph a\nconnectedComponent g vrtx | vrtx `notElem`  vertices g = empty\n                            --adds all the nodes and edges to the created graph   \n                          | otherwise = foldl addEdge (foldl (\\graph x -&gt; addVertex graph x) initialGraph nodes) edges\n                                --gets all neighbors of the nodes retrieved in dfs\n                                where \n                                    nodes = concatMap (neighbors g) (dfs g vrtx) \n                                    -- init the graph with the start node\n                                    initialGraph = addVertex empty vrtx\n                                    edges = removeDub [(x,y) | x &lt;- (vertices g), y &lt;- (neighbors g x), x `elem` dfs g vrtx]\n\n-- removes dublicates from the edges if (a,b) and (b,a) exist\nremoveDub ::Eq a =&gt; [(a,a)] -&gt; [(a,a)]\nremoveDub [] = []\nremoveDub ((x,y):xs) | (y,x) `elem` xs = removeDub xs\n                     | otherwise = (x,y) : removeDub xs\n\n\n-- Getting the Graph and a vertex to start from\ndfs :: Eq a =&gt; Graph a -&gt; a -&gt; [a]\ndfs graph node | graph == empty = []\n                 -- stop if this is the node\n               | [x | x&lt;-(vertices graph), x==node] == [] = []\n               | otherwise = dfs' (vertices graph) graph [node]\n\n-- help function for dfs\ndfs' [] _ _ = []\ndfs' _ _ [] = []\ndfs' vs graph (top:stack) | [x | x &lt;- vs, x==top] == [] = dfs' nextv graph stack\n                        -- append the current one and go to the next node\n                     | otherwise = top : dfs' nextv graph (adjacent ++ stack)\n                     where\n                        -- getting all neibourhs for currently viewed node \n                        adjacent = neighbors graph top\n                        -- getting the next node\n                        nextv = [x|x&lt;-vs,x/=top]\n</code></pre>\n"}], "owner": {"reputation": 697, "user_id": 2897208, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ed280d1219b487ec15a1ede0c9461350?s=128&d=identicon&r=PG&f=1", "display_name": "mboronin", "link": "https://stackoverflow.com/users/2897208/mboronin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576848137, "creation_date": 1576837298, "last_edit_date": 1576844565, "question_id": 59423606, "link": "https://stackoverflow.com/questions/59423606/dfs-implementation-for-abstract-graph-in-haskell", "title": "DFS implementation for abstract graph in Haskell", "body": "<p>I am trying to implement in Haskell a DFS algorithm, which will not have access to the <code>Graph</code> internals and constructor, but only will be able to use the provided functions to retrieve all graph vertices and all node's neighbours in the graph:</p>\n\n<pre><code>vertices :: Eq a =&gt; Graph a -&gt; [a]\nneighbors :: Eq a =&gt; Graph a -&gt; a -&gt; [a]\n</code></pre>\n\n<p>As an input, the function gets a <code>Graph a</code> and an object <code>a</code>.</p>\n\n<p>As an output, I am trying to provide a connected component, <code>Graph a</code>, which will have all vertices reachable from the object. </p>\n\n<p>To retrieve an empty graph and add vertices I have implemented functions</p>\n\n<pre><code>empty :: Graph a\naddVertex :: Eq a =&gt; Graph a -&gt; a -&gt; Graph a\n</code></pre>\n\n<p>For the <code>dfs</code>, I have so far implemented a function, which looks more like a general idea but is not even close to being working.\nI feel a bit stuck, so any suggestions or tips are highly appreciated</p>\n\n<p>In the end, I need to get a connected component of the graph containing the node from the input. (Not strongly connected)</p>\n\n<p>So probably <code>dfs</code> itself should return a list of nodes, which then can be used to form a graph using <code>neighbours</code> function..?</p>\n\n<p>So far I have this, but it still does not work correctly yet.</p>\n\n<p><strong>The only issue I have left is to transfer keep the edges in the subgraph</strong></p>\n\n<pre><code>connectedComponent :: Eq a =&gt; Graph a -&gt; a -&gt; Graph a\nconnectedComponent g vrtx | vrtx `notElem`  vertices g = empty\n                            --adds all the points to the created graph   \n                          | otherwise = foldl (\\graph x -&gt; addVertex graph x) initialGraph points \n                                --gets all neighbors of the nodes retrieved in dfs\n                                where \n                                    points = concatMap (neighbors g) (dfs g vrtx) \n                                    initialGraph = addVertex empty vrtx\n\n-- Getting the Graph and a vertex to start from\ndfs :: Eq a =&gt; Graph a -&gt; a -&gt; [a]\ndfs graph node | graph == empty = []\n               | [x|x&lt;-(vertices graph),x==node] == [] = []\n               | otherwise = dfs' (vertices graph) graph [node]\n\ndfs' [] _ _ = []\ndfs' _ _ [] = []\ndfs' v graph (top:stack) | [x|x&lt;-v,x==top] == [] = dfs' nextv graph stack\n                     | otherwise = top : dfs' nextv graph (adjacent ++ stack)\n                     where \n                        adjacent = neighbors graph top\n                        --adjacent = [x | (x,y)&lt;-e,y==top] ++ [x | (y,x)&lt;-e,y==top]\n                        nextv = [x|x&lt;-v,x/=top]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1576829413, "post_id": 59421810, "comment_id": 105030051, "body": "A stack template is in essence a file that has some parameters, and specifies what files to generate: <a href=\"https://github.com/commercialhaskell/stack-templates/blob/master/simple.hsfiles\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack-templates/blob/master/&hellip;</a>"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576829734, "post_id": 59421810, "comment_id": 105030182, "body": "How to pass a local <code>stack template</code> to <code>stack new</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576829827, "post_id": 59421810, "comment_id": 105030214, "body": "you define <code>stack new name-of-package &#47;path&#47;of&#47;template.hsfiles</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576830168, "post_id": 59421810, "comment_id": 105030342, "body": "perfect. Thanks so much."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1576830203, "creation_date": 1576830203, "answer_id": 59421995, "question_id": 59421810, "link": "https://stackoverflow.com/questions/59421810/how-to-create-project-template-in-stack/59421995#59421995", "title": "How to create project template in stack?", "body": "<p>You can alter a Haskell template, you find for example the <a href=\"https://github.com/commercialhaskell/stack-templates/blob/master/simple.hsfiles\" rel=\"nofollow noreferrer\"><code>simple</code> template on GitHub</a>. You can save that modified file locally, for example <code>~/simple-classy.hsfiles</code>, and then construct a new project with:</p>\n\n<pre><code>stack new <i>name</i> <b>~/simple-classy.hsfiles</b></code></pre>\n\n<p>For example here a slightly modified version of <code>simply.hsfiles</code>. You can of course make more significant changes to the template:</p>\n\n<pre><code>{-# START_FILE package.yaml #-}\nname:    {{name}}\nversion: &quot;0.0.0&quot;\n\n<b>dependencies</b>:\n  - base &gt;= 4.7 && &lt; 5\n  - classy-prelude\n\n<b>default-extension</b>:\n  - NoImplicitPrelude\n  - OverloadedStrings\n\n{-# START_FILE {{name}}.cabal #-}\nname:                {{name}}\nversion:             0.1.0.0\n-- synopsis:\n-- description:\nhomepage:            https://github.com/{{github-username}}{{^github-username}}githubuser{{/github-username}}/{{name}}#readme\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              {{author-name}}{{^author-name}}Author name here{{/author-name}}\nmaintainer:          {{author-email}}{{^author-email}}example@example.com{{/author-email}}\ncopyright:           {{copyright}}{{^copyright}}{{year}}{{^year}}2019{{/year}} {{author-name}}{{^author-name}}Author name here{{/author-name}}{{/copyright}}\ncategory:            {{category}}{{^category}}Web{{/category}}\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\nextra-source-files:  README.md\n\nexecutable {{name}}\n  hs-source-dirs:      src\n  main-is:             Main.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 && &lt; 5\n\n{-# START_FILE Setup.hs #-}\nimport Distribution.Simple\nmain = defaultMain\n\n{-# START_FILE README.md #-}\n# {{name}}\n\n{-# START_FILE src/Main.hs #-}\nmodule Main where\n\nmain :: IO ()\nmain = do\n  putStrLn &quot;hello world&quot;\n\n{-# START_FILE LICENSE #-}\nCopyright {{author-name}}{{^author-name}}Author name here{{/author-name}} (c) {{year}}{{^year}}2019{{/year}}\n\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * Neither the name of {{author-name}}{{^author-name}}Author name here{{/author-name}} nor the names of other\n      contributors may be used to endorse or promote products derived\n      from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n&quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 1, "accepted_answer_id": 59421995, "answer_count": 1, "score": 2, "last_activity_date": 1576830203, "creation_date": 1576829229, "question_id": 59421810, "link": "https://stackoverflow.com/questions/59421810/how-to-create-project-template-in-stack", "title": "How to create project template in stack?", "body": "<p>I am going to create several projects. Those projects are going to use same dependencies, for example: </p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- classy-prelude\n\ndefault-extesion:\n- NoImplicitPrelude\n- OverloadedStrings \n</code></pre>\n\n<p>The question, how to create a template in stack, that contains default <code>dependencies</code>, like I listed above.  </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1576830221, "post_id": 59421562, "comment_id": 105030361, "body": "Which <code>resolver</code> are you using?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1576866879, "post_id": 59421562, "comment_id": 105045635, "body": "The <code>resolver</code> is <code>resolver: lts-14.17</code>."}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576829257, "creation_date": 1576827919, "last_edit_date": 1576829257, "question_id": 59421562, "link": "https://stackoverflow.com/questions/59421562/unable-to-add-classy-prelude-dependency", "title": "Unable to add classy-prelude dependency", "body": "<p>I am trying to add <code>classy-prelude</code> dependency to my stack project as follows: </p>\n\n<pre><code>name:                FooService\nversion:             0.1.0.0\ngithub:              \"githubuser/FooService\"\nlicense:             BSD3\nauthor:              \"Author name here\"\nmaintainer:          \"example@example.com\"\ncopyright:           \"2019 Author name here\"\n\nextra-source-files:\n- README.md\n- ChangeLog.md\n\n# Metadata used when publishing your package\n# synopsis:            Short description of your package\n# category:            Web\n\n# To avoid duplicated efforts in documentation and dealing with the\n# complications of embedding Haddock markup inside cabal files, it is\n# common to point users to the README.md file.\ndescription:         Please see the README on GitHub at &lt;https://github.com/githubuser/FooService#readme&gt;\n\ndependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- classy-prelude\n\ndefault-extesion:\n- NoImplicitPrelude\n- OverloadedStrings\n\nlibrary:\n  source-dirs: src\n\nexecutables:\n  FooService-exe:\n    main:                Main.hs\n    source-dirs:         app\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - FooService\n\ntests:\n  FooService-test:\n    main:                Spec.hs\n    source-dirs:         test\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - FooService\n</code></pre>\n\n<p>when call the interactive environment I've got the error message: </p>\n\n<pre><code>Using main module: 1. Package `FooService' component FooService:exe:FooService-exe with main-is file: /home/developer/haskell/FooService/app/Main.hs Cabal file info not found for classy-prelude-1.5.0@sha256:ed1a607f688745bc263be0b2ed2492729a62fd4c9821b68c2bfacbd7a9d9293d,1928, updating Selected mirror https://s3.amazonaws.com/hackage.fpcomplete.com/ Downloading timestamp No package index update available, but didn't update cache last time, running now Calculating hashes to check for hackage-security rebases or filesystem changes Updating preexisting cache, should be quick Populating cache from file size 640326144, hash bb56d41c70c9e6cdd625a6c3c7de5f56823e92cc6fe880f8056259ab31d3e0d5 Populating package index cache ... Failed populating package index cache\n\nError: BadChecksum 0\n\nWarning: Build failed, but trying to launch GHCi anyway The following GHC options are incompatible with GHCi and have not been passed to it:\n-threaded Configuring GHCi with the following packages: FooService GHCi, version 8.6.5: http://www.haskell.org/ghc/  :? for help &lt;command line&gt;: cannot satisfy -package classy-prelude-1.5.0  \n</code></pre>\n\n<p>What is missing?</p>\n"}, {"tags": ["haskell", "haskell-stack", "lld"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1576798619, "post_id": 59418067, "comment_id": 105023671, "body": "I think the key point is the <code>-fPIC</code> flag"}, {"owner": {"reputation": 389, "user_id": 7571907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h7oqD.jpg?s=128&g=1", "display_name": "Kasra Ferdowsi", "link": "https://stackoverflow.com/users/7571907/kasra-ferdowsi"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1576799262, "post_id": 59418067, "comment_id": 105023804, "body": "Thanks! How/where should I set that flag?"}], "answers": [{"tags": [], "owner": {"reputation": 389, "user_id": 7571907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h7oqD.jpg?s=128&g=1", "display_name": "Kasra Ferdowsi", "link": "https://stackoverflow.com/users/7571907/kasra-ferdowsi"}, "is_accepted": false, "score": 0, "last_activity_date": 1609882586, "creation_date": 1609882586, "answer_id": 65586919, "question_id": 59418067, "link": "https://stackoverflow.com/questions/59418067/stack-build-fails-with-lld-errors/65586919#65586919", "title": "Stack build fails with LLD errors", "body": "<p>See <a href=\"https://docs.haskellstack.org/en/stable/faq/#i-get-strange-ld-errors-about-recompiling-with-fpic\" rel=\"nofollow noreferrer\">this</a> answer in <code>stack</code>'s own FAQ!</p>\n"}], "owner": {"reputation": 389, "user_id": 7571907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h7oqD.jpg?s=128&g=1", "display_name": "Kasra Ferdowsi", "link": "https://stackoverflow.com/users/7571907/kasra-ferdowsi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 266, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1609882586, "creation_date": 1576797339, "question_id": 59418067, "link": "https://stackoverflow.com/questions/59418067/stack-build-fails-with-lld-errors", "title": "Stack build fails with LLD errors", "body": "<p>I'm trying to build some Haskell packages with <code>stack</code> (<code>haskell-ide-engine</code> and <code>hlint</code> specifically), but they both fail with many <code>ld.lld</code> error messages, all related to <code>R_X86_64_32S</code> relocation, e.g.:</p>\n\n<pre><code>ld.lld: error: can't create dynamic relocation R_X86_64_32S against symbol: stg_bh_upd_frame_info in readonly segment; recompile object files with -fPIC or pass '-Wl,-z,notext' to allow text relocations in the output\n&gt;&gt;&gt; defined in /home/kas/.stack/programs/x86_64-linux/ghc-tinfo6-8.6.5/lib/ghc-8.6.5/rts/libHSrts_thr.a(Updates.thr_o)\n&gt;&gt;&gt; referenced by /home/kas/.stack/setup-exe-src/setup-shim-mPHDZzAJ.o:(s6WS_info)\n</code></pre>\n\n<p>I tried configuring <code>stack</code> to use a different linker (using <code>ghc-options</code> flags), but I can't get that to work, and it always uses <code>lld</code>.</p>\n\n<p>Does anyone know how I can change <code>stack</code>'s linker, or fix the error some other way?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "type-variables"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576788137, "post_id": 59416331, "comment_id": 105020652, "body": "Please post the definition of <code>Vector2D</code>."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1576788471, "post_id": 59416331, "comment_id": 105020762, "body": "I can&#39;t set up a project to verify this right now, but try <code>storageVector @g v</code> (you&#39;ll need to enable <code>TypeApplications</code> for this)"}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 6, "last_activity_date": 1576971037, "last_edit_date": 1576971037, "creation_date": 1576789687, "answer_id": 59416896, "question_id": 59416331, "link": "https://stackoverflow.com/questions/59416331/how-do-you-bind-this-type-variable-correctly/59416896#59416896", "title": "How do you bind this type variable correctly?", "body": "<p>What's happening here is that in order to call <code>storageVector</code>, the compiler has to choose an instance of <code>Grid</code>, but it can't.</p>\n\n<p>Normally a parameter type would be enough to pick the instance, but in this case the parameter is of type <code>Index g</code>, and <code>Index</code> is a non-injective type family (as the error message states), which means that you can go from <code>g</code> to <code>Index g</code>, but you can't go back. In other words, there is no way to figure out what <code>g</code> is just by knowing <code>Index g</code>. </p>\n\n<p>So the compiler can't choose a <code>Grid</code> instance and rejects the program.</p>\n\n<p>To help the compiler with this, you can explicitly specify the type that should be used for instance lookup. To do that, use the <code>TypeApplications</code> extension:</p>\n\n<pre><code>    where (Vector2D x y) = storageVector @g v\n</code></pre>\n\n<p>This will tell the compiler that it should use instance <code>Grid g</code> for the same <code>g</code>.</p>\n\n<p>Note that for this to work it is crucial to declare <code>g</code> with a <code>forall</code> keyword, which you're already doing. </p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 59416896, "answer_count": 1, "score": 4, "last_activity_date": 1577155192, "creation_date": 1576786256, "last_edit_date": 1577155192, "question_id": 59416331, "link": "https://stackoverflow.com/questions/59416331/how-do-you-bind-this-type-variable-correctly", "title": "How do you bind this type variable correctly?", "body": "<p>I've been digging out some old code (and frankly regretting some design decisions) but I realized I could never get the final function to compile and I don't really understand why. I've got ScopedTypeVariables on which normally solves problems like this for me.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, UndecidableInstances, FlexibleContexts, RankNTypes #-}\n{-# LANGUAGE DeriveTraversable, DerivingStrategies, ScopedTypeVariables #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n\nimport Prelude hiding ((+), (*))\nimport Algebra\nimport Control.Lens.TH (makeLenses)\nimport Data.Semigroup (Semigroup, (&lt;&gt;))\nimport Data.Monoid (mempty, mappend)\nimport Data.Proxy (Proxy)\nimport Data.Function(on)\nimport qualified Data.IntMap as IM\nimport Control.Lens (IxValue, Index, Ixed(..), Traversal', Iso', view, review)\n\nclass (Ixed g) =&gt; Grid g where\n    -- Stored x first, then y\n    gridIso :: Iso' g (IM.IntMap (IM.IntMap (IxValue g)))\n    storageVector :: (Index g) -&gt; Vector2D Int\n\n{-# INLINE gridIx #-}\ngridIx :: forall g . (Grid g) =&gt; (Index g) -&gt; Traversal' g (IxValue g)\ngridIx v = gridIso . (ix x) . (ix y) \n   where (Vector2D x y) = storageVector v\n</code></pre>\n\n<p>instead I get this:</p>\n\n<pre><code>/mnt/c/Users/me/advent2018/src/Vector.hs:92:41: error:\n    \u2022 Couldn't match expected type \u2018Index g0\u2019\n                  with actual type \u2018Index g\u2019\n      NB: \u2018Index\u2019 is a non-injective type family\n      The type variable \u2018g0\u2019 is ambiguous\n    \u2022 In the first argument of \u2018storageVector\u2019, namely \u2018v\u2019\n      In the expression: storageVector v\n      In a pattern binding: (Vector2D x y) = storageVector v\n    \u2022 Relevant bindings include\n        v :: Index g\n          (bound at /mnt/c/Users/me/advent2018/src/Vector.hs:91:8)\n        gridIx :: Index g -&gt; Traversal' g (IxValue g)\n          (bound at /mnt/c/Users/me/advent2018/src/Vector.hs:91:1)\n</code></pre>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1576786382, "post_id": 59415953, "comment_id": 105020007, "body": "You would need to look at the start position of the next node."}, {"owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1576787979, "post_id": 59415953, "comment_id": 105020593, "body": "Yes, the key is to identify where is the next node. If there&#39;s a right sibling, that&#39;s easy. What if the node itself has no right sibling?"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1576788680, "post_id": 59415953, "comment_id": 105020823, "body": "You will have to traverse the tree, going up."}, {"owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1576789173, "post_id": 59415953, "comment_id": 105020972, "body": "Yeah, that&#39;s why I want to see if there is library doing this before implementation. Seems like a common functionality."}], "answers": [{"comments": [{"owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "edited": false, "score": 0, "creation_date": 1577328627, "post_id": 59416955, "comment_id": 105142755, "body": "This solution can work, but it requires me change lots of code using lexeme. I ended up saving the SourcePos before whitespace <a href=\"https://www.reddit.com/r/haskell/comments/ecy3oa/how_to_get_source_range_of_ast_nodes_using/fc0zsb1?utm_source=share&amp;utm_medium=web2x\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/ecy3oa/&hellip;</a>"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1576791607, "last_edit_date": 1576791607, "creation_date": 1576790074, "answer_id": 59416955, "question_id": 59415953, "link": "https://stackoverflow.com/questions/59415953/how-to-get-source-range-of-ast-nodes-using-megaparsec/59416955#59416955", "title": "How to get source range of AST nodes using megaparsec?", "body": "<p>If you want to construct a source span like this for each lexeme:</p>\n\n<pre><code>data Span = Span SourcePos SourcePos\n\ndata Spanned a = Spanned Span a\n</code></pre>\n\n<p>You can just call <code>getSourcePos</code> twice, once at the beginning of a token and once at the end, before consuming any whitespace, assuming you\u2019re at the lexing stage. I\u2019ve used a structure like this in the past to make this more convenient:</p>\n\n<pre><code>-- Augment a parser with a source span.\nspanned :: Parser (a, SourcePos) -&gt; Parser (Spanned a)\nspanned parser = do\n  start &lt;- getSourcePos\n  (x, end) &lt;- parser\n  pure (Spanned (Span start end) x)\n\n-- Consume whitespace following a lexeme, but record\n-- its endpoint as being before the whitespace.\nlexeme :: Parser a -&gt; Parser (a, SourcePos)\nlexeme parser = (,) &lt;$&gt; parser &lt;*&gt; (getSourcePos &lt;* whitespace)\n</code></pre>\n\n<p>Bearing in mind that <code>getSourcePos</code> is somewhat costly, per the documentation, and if I recall correctly this depends on source file size.</p>\n\n<p>If an AST is annotated with spans, you can compute the span of any part of the tree by folding over it with a monoid instance for <code>Span</code> that takes their union (or more specifically their bounding box), i.e. <code>a &lt;&gt; b</code> is a span from <code>(beginRow a, beginCol a) `min` (beginRow b, beginCol b)</code> to <code>(endRow a, endCol a) `max` (endRow b, endCol b)</code>.</p>\n"}], "owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 59416955, "answer_count": 1, "score": 3, "last_activity_date": 1576791607, "creation_date": 1576784432, "question_id": 59415953, "link": "https://stackoverflow.com/questions/59415953/how-to-get-source-range-of-ast-nodes-using-megaparsec", "title": "How to get source range of AST nodes using megaparsec?", "body": "<p>I'm trying to generate a source map for some source file I'm parsing and I want to get the range for each node. <a href=\"https://hackage.haskell.org/package/megaparsec-8.0.0/docs/Text-Megaparsec.html\" rel=\"nofollow noreferrer\">getSourcePos</a> only gives the <a href=\"https://hackage.haskell.org/package/megaparsec-8.0.0/docs/Text-Megaparsec-Pos.html#t:SourcePos\" rel=\"nofollow noreferrer\">start position</a> of a node (src:line:column). How to get its end position?</p>\n"}, {"tags": ["haskell", "vigenere"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576782327, "post_id": 59415464, "comment_id": 105018481, "body": "Possibly not relevant, but what is <code>a</code> in the definition of <code>encrypt</code>?"}, {"owner": {"reputation": 15, "user_id": 2602540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee36a65a444251239878fd16cd8c85d1?s=128&d=identicon&r=PG", "display_name": "user2602540", "link": "https://stackoverflow.com/users/2602540/user2602540"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576782396, "post_id": 59415464, "comment_id": 105018513, "body": "@chepner oh it&#39;s a typo, sry"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576782414, "post_id": 59415464, "comment_id": 105018520, "body": "It <i>looks</i> like the <code>k</code>-list is expected to be shorter than the <code>p</code>-list (how is <code>vig</code> defined when one or both arguments are empty lists?), so <code>ks ++ [k]</code> is just a way to cycle through the <code>k</code>&#39;s until the <code>p</code>&#39;s are exhausted."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1576782487, "post_id": 59415464, "comment_id": 105018549, "body": "Rather than constantly appending like this, something like <code>vig ps ks = vig&#39; ps (cycle ks) where vig&#39; (p:ps) (k:ks) = encrypt p k : vig ps ks</code> would be more efficient."}, {"owner": {"reputation": 15, "user_id": 2602540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee36a65a444251239878fd16cd8c85d1?s=128&d=identicon&r=PG", "display_name": "user2602540", "link": "https://stackoverflow.com/users/2602540/user2602540"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576782799, "post_id": 59415464, "comment_id": 105018683, "body": "I edited in the full code for clarity, and thank you that helps. I&#39;m new to haskell and everything is still confusing hah."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 0, "last_activity_date": 1576787188, "last_edit_date": 1576787188, "creation_date": 1576785797, "answer_id": 59416243, "question_id": 59415464, "link": "https://stackoverflow.com/questions/59415464/understanding-vigenere-cipher-in-haskell/59416243#59416243", "title": "Understanding Vigenere cipher in Haskell", "body": "<p>The idea is that each character in the first list is \"shifted\" by a distance determined by the corresponding character in the second list. The second list, though, may have a different length than the first. If it is longer, there's no problem; you'll just ignore the extra (as seen by the base case <code>vig [] k = []</code>). If it is <em>shorter</em>, though, you'll want to start over at the beginning.</p>\n\n<p>Suppose you start with the call <code>vig \"horse\" \"dog\"</code>. Then you will make the following recursive calls in order:</p>\n\n<pre><code>vig \"orse\" \"ogd\"\nvig \"rse\" \"gdo\"\nvig \"se\" \"dog\"\nvig \"e\" \"ogd\"\nvig \"\" \"gdo\"\n</code></pre>\n\n<p><code>encrypt</code> is what does the actual encryption; it returns a new character based on the character <code>p</code> from the message and the character <code>k</code> from the encryption <code>k</code>. Each message character is used exactly once; each key character could be used multiple times (if the key is shorter than the message) or not at all (if the key is longer).</p>\n\n<p>A simpler (and more efficient way) to do this is to use the <code>cycle</code> function to create an infinite, repeating list from the key. (If <code>ks</code> is already long enough, it just makes an even longer list of characters you'll ultimately ignore. Because Haskell is lazy, there is no cost for this simplifying abstraction.)</p>\n\n<pre><code>vig ps ks = vig' ps (cycle ks)\n  where vig' _ [] = p\n        vig' [] _ = []\n        vig' (p:ps) (k:ks) = encrypt p k : vig' ps ks\n        encrypt a b = ...\n</code></pre>\n\n<p>However, <code>vig'</code> doesn't really care about the contents of either list or what <code>encrypt</code> does. It's kind of like <code>map</code>, except instead of building one list from another by apply a function to each element, it builds one list from <em>two</em> lists by applying a function to each corresponding pair of elements. This pattern is predefined as the <code>zipWith</code> function.</p>\n\n<pre><code>vig ps ks = zipWith encrypt ps ks  -- vig = zipWith encrypt\n  where encrypt a b = ...\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 2602540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee36a65a444251239878fd16cd8c85d1?s=128&d=identicon&r=PG", "display_name": "user2602540", "link": "https://stackoverflow.com/users/2602540/user2602540"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 59416243, "answer_count": 1, "score": -1, "last_activity_date": 1576787188, "creation_date": 1576781803, "last_edit_date": 1576782560, "question_id": 59415464, "link": "https://stackoverflow.com/questions/59415464/understanding-vigenere-cipher-in-haskell", "title": "Understanding Vigenere cipher in Haskell", "body": "<p>I'm having trouble understanding what's exactly going on in the code below. </p>\n\n<p>Specifically the recursive function call and \"ks++[k]\" as well as the chr $ 65. I'm assuming the former is used for recursively iterating through the list, but if someone could explain like i'm 5 I'd be very grateful.</p>\n\n<pre><code>vig (p:ps) (k:ks) = (encrypt p k):(vig ps (ks++[k])) \n  where\n    encrypt b = chr $ 65 + mod (ord a + ord b) 26\n</code></pre>\n\n<p>full code</p>\n\n<pre><code>vig :: [Char] -&gt; [Char] -&gt; [Char]\nvig [] k = []\nvig p [] = []\nvig (p:ps) (k:ks) = (encrypt p k):(vig ps (ks++[k]))\n  where\n    encrypt a b = chr $ 65 + mod (ord a + ord b) 26\n\n</code></pre>\n"}, {"tags": ["haskell", "gloss"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 4, "creation_date": 1576761471, "post_id": 59410530, "comment_id": 105008121, "body": "I think, in the module <code>Graphics.Gloss.Game</code> there is a <code>boundingBox</code> functions which is what you need"}, {"owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "reply_to_user": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1576787268, "post_id": 59410530, "comment_id": 105020331, "body": "There does not seem to be any module called Graphics.Gloss.Game - could you provide a link to the documentation for the boundingBox function?"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1576830001, "post_id": 59410530, "comment_id": 105030291, "body": "oh! apparently is a plug-in package around gloss called <code>gloss-game</code>. <a href=\"http://hackage.haskell.org/package/gloss-game-0.3.3.0/docs/Graphics-Gloss-Game.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/gloss-game-0.3.3.0/docs/&hellip;</a>. By the way, the <code>boundingBox</code> function seems to be incomplete."}], "owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576761257, "creation_date": 1576761257, "question_id": 59410530, "link": "https://stackoverflow.com/questions/59410530/how-do-i-draw-the-bounding-rectangle-of-a-picture-in-gloss", "title": "How do I draw the bounding rectangle of a Picture in gloss?", "body": "<p>Is there a function in gloss that, given a Picture returns the width, height and coordinates of the smallest rectangle that encloses the Picture? If not, is it possible to write one?</p>\n"}, {"tags": ["c", "haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1576841201, "post_id": 59402257, "comment_id": 105035044, "body": "Why <code>&quot;stdio.h printf&quot;</code> instead of <code>&quot;printf&quot;</code>?"}, {"owner": {"reputation": 9, "user_id": 9554032, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Phcrn_ksvf4/AAAAAAAAAAI/AAAAAAAAAC8/cC75rZ75cKk/photo.jpg?sz=128", "display_name": "Adolfo C&#225;rdenas", "link": "https://stackoverflow.com/users/9554032/adolfo-c%c3%a1rdenas"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1576889216, "post_id": 59402257, "comment_id": 105051166, "body": "In some examples I saw this practice"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1576747354, "post_id": 59402387, "comment_id": 105001225, "body": "<code>printf</code> in C is a variadic function, I&#39;m not sure if we can import that so easily ignoring the variadic part of arguments. Maybe we can with <code>ccall</code>. Further, I believe that that <code>CString</code> has to be freed manually (?)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576759880, "post_id": 59402387, "comment_id": 105007341, "body": "A shame <code>Cstring</code> is a type alias, so that you can&#39;t define an <code>IsString</code> instance for it."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576760686, "post_id": 59402387, "comment_id": 105007751, "body": "@chepner you can create instances for aliases (after all, <code>String</code> itself has an instance), the problem is that converting <code>String</code> to <code>CString</code> is not a pure operation."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576763296, "post_id": 59402387, "comment_id": 105009127, "body": "@FyodorSoikin Ah, right. I was confusing that with the case where the aliased type already has an instance, in which case the alias isn&#39;t sufficient for creating a separate instance."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 8, "last_activity_date": 1576723582, "last_edit_date": 1576723582, "creation_date": 1576720873, "answer_id": 59402387, "question_id": 59402257, "link": "https://stackoverflow.com/questions/59402257/how-i-can-convert-haskell-char-to-cstring/59402387#59402387", "title": "How I can convert haskell [char] to CString", "body": "<p>The literal <code>\"hello\"</code> is of type <code>String</code> (also known as <code>[Char]</code>), not of type <code>CString</code>, so you can't pass it to <code>myprintf</code>. The types don't match.</p>\n\n<p>You can convert it to <code>CString</code> via the <a href=\"https://www.stackage.org/haddock/lts-14.17/base-4.12.0.0/Foreign-C-String.html#v:newCString\" rel=\"noreferrer\"><code>newCString</code> function</a>:</p>\n\n<pre><code>main = do\n    str &lt;- newCString \"hello\"\n    myprintf str\n</code></pre>\n\n<p>Or in a more compact way:</p>\n\n<pre><code>main =\n    myprintf =&lt;&lt; newCString \"hello\"\n</code></pre>\n\n<hr>\n\n<p>On a related note, I think your imported signature is incorrect. The function <code>printf</code> from <code>stdio</code> doesn't return a string, it returns an <code>int</code>.</p>\n\n<p>Since you're just discarding the return value, it's no big deal (or is it? not sure how FFI would work here), but if you try to actually use it while assuming it's a <code>CString</code>, unpredictable bad things may happen.</p>\n"}], "owner": {"reputation": 9, "user_id": 9554032, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Phcrn_ksvf4/AAAAAAAAAAI/AAAAAAAAAC8/cC75rZ75cKk/photo.jpg?sz=128", "display_name": "Adolfo C&#225;rdenas", "link": "https://stackoverflow.com/users/9554032/adolfo-c%c3%a1rdenas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576723582, "creation_date": 1576719651, "question_id": 59402257, "link": "https://stackoverflow.com/questions/59402257/how-i-can-convert-haskell-char-to-cstring", "title": "How I can convert haskell [char] to CString", "body": "<p>My code in haskell have some error:\nCouldn't match type \u2018[Char]\u2019 with \u2018Ptr CChar\u2019\n      Expected type: CString\n        Actual type: [Char]</p>\n\n<p>Source code:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\nmodule Main where\n\nimport Foreign.C -- get the C types\nimport Foreign.Ptr (Ptr,nullPtr)\nimport Foreign.C.String\n\nforeign import ccall \"stdio.h printf\"\n  myprintf :: CString -&gt; IO CString\n\nmain = do\n  myprintf \"hello\"\n</code></pre>\n"}]